"use strict";var Bce=Object.defineProperty,Uce=Object.defineProperties,Vce=Object.getOwnPropertyDescriptors,Cw=Object.getOwnPropertySymbols,rU=Object.prototype.hasOwnProperty,oU=Object.prototype.propertyIsEnumerable,sU=(Ft,Yn,fs)=>Yn in Ft?Bce(Ft,Yn,{enumerable:!0,configurable:!0,writable:!0,value:fs}):Ft[Yn]=fs,ne=(Ft,Yn)=>{for(var fs in Yn||(Yn={}))rU.call(Yn,fs)&&sU(Ft,fs,Yn[fs]);if(Cw)for(var fs of Cw(Yn))oU.call(Yn,fs)&&sU(Ft,fs,Yn[fs]);return Ft},Fe=(Ft,Yn)=>Uce(Ft,Vce(Yn)),Er=(Ft,Yn)=>{var fs={};for(var ar in Ft)rU.call(Ft,ar)&&Yn.indexOf(ar)<0&&(fs[ar]=Ft[ar]);if(null!=Ft&&Cw)for(var ar of Cw(Ft))Yn.indexOf(ar)<0&&oU.call(Ft,ar)&&(fs[ar]=Ft[ar]);return fs};(self.webpackChunkangular_barcode_mrz_document_scanner=self.webpackChunkangular_barcode_mrz_document_scanner||[]).push([[179],{58:()=>{function Ft(p){return"function"==typeof p}function Yn(p){const u=p(f=>{Error.call(f),f.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}const fs=Yn(p=>function(u){p(this),this.message=u?`${u.length} errors occurred during unsubscription:\n${u.map((f,g)=>`${g+1}) ${f.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=u});function ar(p,l){if(p){const u=p.indexOf(l);0<=u&&p.splice(u,1)}}class _o{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:u}=this;if(u)if(this._parentage=null,Array.isArray(u))for(const m of u)m.remove(this);else u.remove(this);const{initialTeardown:f}=this;if(Ft(f))try{f()}catch(m){l=m instanceof fs?m.errors:[m]}const{_finalizers:g}=this;if(g){this._finalizers=null;for(const m of g)try{SD(m)}catch(v){l=null!=l?l:[],v instanceof fs?l=[...l,...v.errors]:l.push(v)}}if(l)throw new fs(l)}}add(l){var u;if(l&&l!==this)if(this.closed)SD(l);else{if(l instanceof _o){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=null!==(u=this._finalizers)&&void 0!==u?u:[]).push(l)}}_hasParent(l){const{_parentage:u}=this;return u===l||Array.isArray(u)&&u.includes(l)}_addParent(l){const{_parentage:u}=this;this._parentage=Array.isArray(u)?(u.push(l),u):u?[u,l]:l}_removeParent(l){const{_parentage:u}=this;u===l?this._parentage=null:Array.isArray(u)&&ar(u,l)}remove(l){const{_finalizers:u}=this;u&&ar(u,l),l instanceof _o&&l._removeParent(this)}}_o.EMPTY=(()=>{const p=new _o;return p.closed=!0,p})();const bD=_o.EMPTY;function _D(p){return p instanceof _o||p&&"closed"in p&&Ft(p.remove)&&Ft(p.add)&&Ft(p.unsubscribe)}function SD(p){Ft(p)?p():p.unsubscribe()}const jh={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},tv={setTimeout(p,l,...u){const{delegate:f}=tv;return(null==f?void 0:f.setTimeout)?f.setTimeout(p,l,...u):setTimeout(p,l,...u)},clearTimeout(p){const{delegate:l}=tv;return((null==l?void 0:l.clearTimeout)||clearTimeout)(p)},delegate:void 0};function ED(p){tv.setTimeout(()=>{const{onUnhandledError:l}=jh;if(!l)throw p;l(p)})}function TD(){}const hU=bw("C",void 0,void 0);function bw(p,l,u){return{kind:p,value:l,error:u}}let Hh=null;function iv(p){if(jh.useDeprecatedSynchronousErrorHandling){const l=!Hh;if(l&&(Hh={errorThrown:!1,error:null}),p(),l){const{errorThrown:u,error:f}=Hh;if(Hh=null,u)throw f}}else p()}class _w extends _o{constructor(l){super(),this.isStopped=!1,l?(this.destination=l,_D(l)&&l.add(this)):this.destination=vU}static create(l,u,f){return new nv(l,u,f)}next(l){this.isStopped?Ew(function uU(p){return bw("N",p,void 0)}(l),this):this._next(l)}error(l){this.isStopped?Ew(function dU(p){return bw("E",void 0,p)}(l),this):(this.isStopped=!0,this._error(l))}complete(){this.isStopped?Ew(hU,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(l){this.destination.next(l)}_error(l){try{this.destination.error(l)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const pU=Function.prototype.bind;function Sw(p,l){return pU.call(p,l)}class gU{constructor(l){this.partialObserver=l}next(l){const{partialObserver:u}=this;if(u.next)try{u.next(l)}catch(f){sv(f)}}error(l){const{partialObserver:u}=this;if(u.error)try{u.error(l)}catch(f){sv(f)}else sv(l)}complete(){const{partialObserver:l}=this;if(l.complete)try{l.complete()}catch(u){sv(u)}}}class nv extends _w{constructor(l,u,f){let g;if(super(),Ft(l)||!l)g={next:null!=l?l:void 0,error:null!=u?u:void 0,complete:null!=f?f:void 0};else{let m;this&&jh.useDeprecatedNextContext?(m=Object.create(l),m.unsubscribe=()=>this.unsubscribe(),g={next:l.next&&Sw(l.next,m),error:l.error&&Sw(l.error,m),complete:l.complete&&Sw(l.complete,m)}):g=l}this.destination=new gU(g)}}function sv(p){jh.useDeprecatedSynchronousErrorHandling?function fU(p){jh.useDeprecatedSynchronousErrorHandling&&Hh&&(Hh.errorThrown=!0,Hh.error=p)}(p):ED(p)}function Ew(p,l){const{onStoppedNotification:u}=jh;u&&tv.setTimeout(()=>u(p,l))}const vU={closed:!0,next:TD,error:function mU(p){throw p},complete:TD},Tw="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wh(p){return p}let Kn=(()=>{class p{constructor(u){u&&(this._subscribe=u)}lift(u){const f=new p;return f.source=this,f.operator=u,f}subscribe(u,f,g){const m=function xU(p){return p&&p instanceof _w||function yU(p){return p&&Ft(p.next)&&Ft(p.error)&&Ft(p.complete)}(p)&&_D(p)}(u)?u:new nv(u,f,g);return iv(()=>{const{operator:v,source:y}=this;m.add(v?v.call(m,y):y?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(u){try{return this._subscribe(u)}catch(f){u.error(f)}}forEach(u,f){return new(f=AD(f))((g,m)=>{const v=new nv({next:y=>{try{u(y)}catch(x){m(x),v.unsubscribe()}},error:m,complete:g});this.subscribe(v)})}_subscribe(u){var f;return null===(f=this.source)||void 0===f?void 0:f.subscribe(u)}[Tw](){return this}pipe(...u){return function DD(p){return 0===p.length?Wh:1===p.length?p[0]:function(u){return p.reduce((f,g)=>g(f),u)}}(u)(this)}toPromise(u){return new(u=AD(u))((f,g)=>{let m;this.subscribe(v=>m=v,v=>g(v),()=>f(m))})}}return p.create=l=>new p(l),p})();function AD(p){var l;return null!==(l=null!=p?p:jh.Promise)&&void 0!==l?l:Promise}const wU=Yn(p=>function(){p(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Pl=(()=>{class p extends Kn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(u){const f=new ID(this,this);return f.operator=u,f}_throwIfClosed(){if(this.closed)throw new wU}next(u){iv(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const f of this.currentObservers)f.next(u)}})}error(u){iv(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=u;const{observers:f}=this;for(;f.length;)f.shift().error(u)}})}complete(){iv(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:u}=this;for(;u.length;)u.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var u;return(null===(u=this.observers)||void 0===u?void 0:u.length)>0}_trySubscribe(u){return this._throwIfClosed(),super._trySubscribe(u)}_subscribe(u){return this._throwIfClosed(),this._checkFinalizedStatuses(u),this._innerSubscribe(u)}_innerSubscribe(u){const{hasError:f,isStopped:g,observers:m}=this;return f||g?bD:(this.currentObservers=null,m.push(u),new _o(()=>{this.currentObservers=null,ar(m,u)}))}_checkFinalizedStatuses(u){const{hasError:f,thrownError:g,isStopped:m}=this;f?u.error(g):m&&u.complete()}asObservable(){const u=new Kn;return u.source=this,u}}return p.create=(l,u)=>new ID(l,u),p})();class ID extends Pl{constructor(l,u){super(),this.destination=l,this.source=u}next(l){var u,f;null===(f=null===(u=this.destination)||void 0===u?void 0:u.next)||void 0===f||f.call(u,l)}error(l){var u,f;null===(f=null===(u=this.destination)||void 0===u?void 0:u.error)||void 0===f||f.call(u,l)}complete(){var l,u;null===(u=null===(l=this.destination)||void 0===l?void 0:l.complete)||void 0===u||u.call(l)}_subscribe(l){var u,f;return null!==(f=null===(u=this.source)||void 0===u?void 0:u.subscribe(l))&&void 0!==f?f:bD}}function PD(p){return Ft(null==p?void 0:p.lift)}function Ts(p){return l=>{if(PD(l))return l.lift(function(u){try{return p(u,this)}catch(f){this.error(f)}});throw new TypeError("Unable to lift unknown Observable type")}}function ws(p,l,u,f,g){return new CU(p,l,u,f,g)}class CU extends _w{constructor(l,u,f,g,m,v){super(l),this.onFinalize=m,this.shouldUnsubscribe=v,this._next=u?function(y){try{u(y)}catch(x){l.error(x)}}:super._next,this._error=g?function(y){try{g(y)}catch(x){l.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=f?function(){try{f()}catch(y){l.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var l;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:u}=this;super.unsubscribe(),!u&&(null===(l=this.onFinalize)||void 0===l||l.call(this))}}}function an(p,l){return Ts((u,f)=>{let g=0;u.subscribe(ws(f,m=>{f.next(p.call(l,m,g++))}))})}function Gh(p){return this instanceof Gh?(this.v=p,this):new Gh(p)}function SU(p,l,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g,f=u.apply(p,l||[]),m=[];return g={},v("next"),v("throw"),v("return"),g[Symbol.asyncIterator]=function(){return this},g;function v(T){f[T]&&(g[T]=function(M){return new Promise(function(L,N){m.push([T,M,L,N])>1||y(T,M)})})}function y(T,M){try{!function x(T){T.value instanceof Gh?Promise.resolve(T.value.v).then(w,C):_(m[0][2],T)}(f[T](M))}catch(L){_(m[0][3],L)}}function w(T){y("next",T)}function C(T){y("throw",T)}function _(T,M){T(M),m.shift(),m.length&&y(m[0][0],m[0][1])}}function EU(p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,l=p[Symbol.asyncIterator];return l?l.call(p):(p=function kD(p){var l="function"==typeof Symbol&&Symbol.iterator,u=l&&p[l],f=0;if(u)return u.call(p);if(p&&"number"==typeof p.length)return{next:function(){return p&&f>=p.length&&(p=void 0),{value:p&&p[f++],done:!p}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}(p),u={},f("next"),f("throw"),f("return"),u[Symbol.asyncIterator]=function(){return this},u);function f(m){u[m]=p[m]&&function(v){return new Promise(function(y,x){!function g(m,v,y,x){Promise.resolve(x).then(function(w){m({value:w,done:y})},v)}(y,x,(v=p[m](v)).done,v.value)})}}}const OD=p=>p&&"number"==typeof p.length&&"function"!=typeof p;function LD(p){return Ft(null==p?void 0:p.then)}function FD(p){return Ft(p[Tw])}function ND(p){return Symbol.asyncIterator&&Ft(null==p?void 0:p[Symbol.asyncIterator])}function BD(p){return new TypeError(`You provided ${null!==p&&"object"==typeof p?"an invalid object":`'${p}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const UD=function DU(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function VD(p){return Ft(null==p?void 0:p[UD])}function jD(p){return SU(this,arguments,function*(){const u=p.getReader();try{for(;;){const{value:f,done:g}=yield Gh(u.read());if(g)return yield Gh(void 0);yield yield Gh(f)}}finally{u.releaseLock()}})}function HD(p){return Ft(null==p?void 0:p.getReader)}function Na(p){if(p instanceof Kn)return p;if(null!=p){if(FD(p))return function AU(p){return new Kn(l=>{const u=p[Tw]();if(Ft(u.subscribe))return u.subscribe(l);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(p);if(OD(p))return function IU(p){return new Kn(l=>{for(let u=0;u<p.length&&!l.closed;u++)l.next(p[u]);l.complete()})}(p);if(LD(p))return function PU(p){return new Kn(l=>{p.then(u=>{l.closed||(l.next(u),l.complete())},u=>l.error(u)).then(null,ED)})}(p);if(ND(p))return WD(p);if(VD(p))return function RU(p){return new Kn(l=>{for(const u of p)if(l.next(u),l.closed)return;l.complete()})}(p);if(HD(p))return function MU(p){return WD(jD(p))}(p)}throw BD(p)}function WD(p){return new Kn(l=>{(function kU(p,l){var u,f,g,m;return function bU(p,l,u,f){return new(u||(u=Promise))(function(m,v){function y(C){try{w(f.next(C))}catch(_){v(_)}}function x(C){try{w(f.throw(C))}catch(_){v(_)}}function w(C){C.done?m(C.value):function g(m){return m instanceof u?m:new u(function(v){v(m)})}(C.value).then(y,x)}w((f=f.apply(p,l||[])).next())})}(this,void 0,void 0,function*(){try{for(u=EU(p);!(f=yield u.next()).done;)if(l.next(f.value),l.closed)return}catch(v){g={error:v}}finally{try{f&&!f.done&&(m=u.return)&&(yield m.call(u))}finally{if(g)throw g.error}}l.complete()})})(p,l).catch(u=>l.error(u))})}function Rl(p,l,u,f=0,g=!1){const m=l.schedule(function(){u(),g?p.add(this.schedule(null,f)):this.unsubscribe()},f);if(p.add(m),!g)return m}function Cs(p,l,u=1/0){return Ft(l)?Cs((f,g)=>an((m,v)=>l(f,m,g,v))(Na(p(f,g))),u):("number"==typeof l&&(u=l),Ts((f,g)=>function OU(p,l,u,f,g,m,v,y){const x=[];let w=0,C=0,_=!1;const T=()=>{_&&!x.length&&!w&&l.complete()},M=N=>w<f?L(N):x.push(N),L=N=>{m&&l.next(N),w++;let V=!1;Na(u(N,C++)).subscribe(ws(l,H=>{null==g||g(H),m?M(H):l.next(H)},()=>{V=!0},void 0,()=>{if(V)try{for(w--;x.length&&w<f;){const H=x.shift();v?Rl(l,v,()=>L(H)):L(H)}T()}catch(H){l.error(H)}}))};return p.subscribe(ws(l,M,()=>{_=!0,T()})),()=>{null==y||y()}}(f,g,p,u)))}function Hp(p=1/0){return Cs(Wh,p)}const Ml=new Kn(p=>p.complete());function Aw(p){return p[p.length-1]}function GD(p){return Ft(Aw(p))?p.pop():void 0}function Wp(p){return function FU(p){return p&&Ft(p.schedule)}(Aw(p))?p.pop():void 0}function zD(p,l=0){return Ts((u,f)=>{u.subscribe(ws(f,g=>Rl(f,p,()=>f.next(g),l),()=>Rl(f,p,()=>f.complete(),l),g=>Rl(f,p,()=>f.error(g),l)))})}function $D(p,l=0){return Ts((u,f)=>{f.add(p.schedule(()=>u.subscribe(f),l))})}function YD(p,l){if(!p)throw new Error("Iterable cannot be null");return new Kn(u=>{Rl(u,l,()=>{const f=p[Symbol.asyncIterator]();Rl(u,l,()=>{f.next().then(g=>{g.done?u.complete():u.next(g.value)})},0,!0)})})}function bs(p,l){return l?function WU(p,l){if(null!=p){if(FD(p))return function BU(p,l){return Na(p).pipe($D(l),zD(l))}(p,l);if(OD(p))return function VU(p,l){return new Kn(u=>{let f=0;return l.schedule(function(){f===p.length?u.complete():(u.next(p[f++]),u.closed||this.schedule())})})}(p,l);if(LD(p))return function UU(p,l){return Na(p).pipe($D(l),zD(l))}(p,l);if(ND(p))return YD(p,l);if(VD(p))return function jU(p,l){return new Kn(u=>{let f;return Rl(u,l,()=>{f=p[UD](),Rl(u,l,()=>{let g,m;try{({value:g,done:m}=f.next())}catch(v){return void u.error(v)}m?u.complete():u.next(g)},0,!0)}),()=>Ft(null==f?void 0:f.return)&&f.return()})}(p,l);if(HD(p))return function HU(p,l){return YD(jD(p),l)}(p,l)}throw BD(p)}(p,l):Na(p)}function rv(p){return p<=0?()=>Ml:Ts((l,u)=>{let f=0;l.subscribe(ws(u,g=>{++f<=p&&(u.next(g),p<=f&&u.complete())}))})}function Iw(p,l,...u){return!0===l?(p(),null):!1===l?null:l(...u).pipe(rv(1)).subscribe(()=>p())}function qi(p){for(let l in p)if(p[l]===qi)return l;throw Error("Could not find renamed property on target object.")}function Pw(p,l){for(const u in l)l.hasOwnProperty(u)&&!p.hasOwnProperty(u)&&(p[u]=l[u])}function Bi(p){if("string"==typeof p)return p;if(Array.isArray(p))return"["+p.map(Bi).join(", ")+"]";if(null==p)return""+p;if(p.overriddenName)return`${p.overriddenName}`;if(p.name)return`${p.name}`;const l=p.toString();if(null==l)return""+l;const u=l.indexOf("\n");return-1===u?l:l.substring(0,u)}function Rw(p,l){return null==p||""===p?null===l?"":l:null==l||""===l?p:p+" "+l}const $U=qi({__forward_ref__:qi});function ln(p){return p.__forward_ref__=ln,p.toString=function(){return Bi(this())},p}function Qt(p){return XD(p)?p():p}function XD(p){return"function"==typeof p&&p.hasOwnProperty($U)&&p.__forward_ref__===ln}class Di extends Error{constructor(l,u){super(function Mw(p,l){return`NG0${Math.abs(p)}${l?": "+l:""}`}(l,u)),this.code=l}}function Nt(p){return"string"==typeof p?p:null==p?"":String(p)}function Ds(p){return"function"==typeof p?p.name||p.toString():"object"==typeof p&&null!=p&&"function"==typeof p.type?p.type.name||p.type.toString():Nt(p)}function ov(p,l){const u=l?` in ${l}`:"";throw new Di(-201,`No provider for ${Ds(p)} found${u}`)}function Wr(p,l){null==p&&function Zi(p,l,u,f){throw new Error(`ASSERTION ERROR: ${p}`+(null==f?"":` [Expected=> ${u} ${f} ${l} <=Actual]`))}(l,p,null,"!=")}function wi(p){return{token:p.token,providedIn:p.providedIn||null,factory:p.factory,value:void 0}}function ta(p){return{providers:p.providers||[],imports:p.imports||[]}}function kw(p){return qD(p,av)||qD(p,JD)}function qD(p,l){return p.hasOwnProperty(l)?p[l]:null}function ZD(p){return p&&(p.hasOwnProperty(Ow)||p.hasOwnProperty(KU))?p[Ow]:null}const av=qi({\u0275prov:qi}),Ow=qi({\u0275inj:qi}),JD=qi({ngInjectableDef:qi}),KU=qi({ngInjectorDef:qi});var Pt=(()=>((Pt=Pt||{})[Pt.Default=0]="Default",Pt[Pt.Host=1]="Host",Pt[Pt.Self=2]="Self",Pt[Pt.SkipSelf=4]="SkipSelf",Pt[Pt.Optional=8]="Optional",Pt))();let Lw;function Oc(p){const l=Lw;return Lw=p,l}function QD(p,l,u){const f=kw(p);return f&&"root"==f.providedIn?void 0===f.value?f.value=f.factory():f.value:u&Pt.Optional?null:void 0!==l?l:void ov(Bi(p),"Injector")}function Lc(p){return{toString:p}.toString()}var ia=(()=>((ia=ia||{})[ia.OnPush=0]="OnPush",ia[ia.Default=1]="Default",ia))(),Ba=(()=>{return(p=Ba||(Ba={}))[p.Emulated=0]="Emulated",p[p.None=2]="None",p[p.ShadowDom=3]="ShadowDom",Ba;var p})();const tV="undefined"!=typeof globalThis&&globalThis,iV="undefined"!=typeof window&&window,nV="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Wi=tV||"undefined"!=typeof global&&global||iV||nV,uu={},Ji=[],lv=qi({\u0275cmp:qi}),Fw=qi({\u0275dir:qi}),Nw=qi({\u0275pipe:qi}),KD=qi({\u0275mod:qi}),Ol=qi({\u0275fac:qi}),Gp=qi({__NG_ELEMENT_ID__:qi});let sV=0;function Gr(p){return Lc(()=>{const u={},f={type:p.type,providersResolver:null,decls:p.decls,vars:p.vars,factory:null,template:p.template||null,consts:p.consts||null,ngContentSelectors:p.ngContentSelectors,hostBindings:p.hostBindings||null,hostVars:p.hostVars||0,hostAttrs:p.hostAttrs||null,contentQueries:p.contentQueries||null,declaredInputs:u,inputs:null,outputs:null,exportAs:p.exportAs||null,onPush:p.changeDetection===ia.OnPush,directiveDefs:null,pipeDefs:null,selectors:p.selectors||Ji,viewQuery:p.viewQuery||null,features:p.features||null,data:p.data||{},encapsulation:p.encapsulation||Ba.Emulated,id:"c",styles:p.styles||Ji,_:null,setInput:null,schemas:p.schemas||null,tView:null},g=p.directives,m=p.features,v=p.pipes;return f.id+=sV++,f.inputs=nA(p.inputs,u),f.outputs=nA(p.outputs),m&&m.forEach(y=>y(f)),f.directiveDefs=g?()=>("function"==typeof g?g():g).map(eA):null,f.pipeDefs=v?()=>("function"==typeof v?v():v).map(tA):null,f})}function eA(p){return Gs(p)||function Fc(p){return p[Fw]||null}(p)}function tA(p){return function zh(p){return p[Nw]||null}(p)}const iA={};function Ua(p){return Lc(()=>{const l={type:p.type,bootstrap:p.bootstrap||Ji,declarations:p.declarations||Ji,imports:p.imports||Ji,exports:p.exports||Ji,transitiveCompileScopes:null,schemas:p.schemas||null,id:p.id||null};return null!=p.id&&(iA[p.id]=p.type),l})}function nA(p,l){if(null==p)return uu;const u={};for(const f in p)if(p.hasOwnProperty(f)){let g=p[f],m=g;Array.isArray(g)&&(m=g[1],g=g[0]),u[g]=f,l&&(l[g]=m)}return u}const At=Gr;function Gs(p){return p[lv]||null}function So(p,l){const u=p[KD]||null;if(!u&&!0===l)throw new Error(`Type ${Bi(p)} does not have '\u0275mod' property.`);return u}function Va(p){return Array.isArray(p)&&"object"==typeof p[1]}function sa(p){return Array.isArray(p)&&!0===p[1]}function Vw(p){return 0!=(8&p.flags)}function uv(p){return 2==(2&p.flags)}function fv(p){return 1==(1&p.flags)}function ra(p){return null!==p.template}function hV(p){return 0!=(512&p[2])}function qh(p,l){return p.hasOwnProperty(Ol)?p[Ol]:null}class fV{constructor(l,u,f){this.previousValue=l,this.currentValue=u,this.firstChange=f}isFirstChange(){return this.firstChange}}function To(){return rA}function rA(p){return p.type.prototype.ngOnChanges&&(p.setInput=gV),pV}function pV(){const p=aA(this),l=null==p?void 0:p.current;if(l){const u=p.previous;if(u===uu)p.previous=l;else for(let f in l)u[f]=l[f];p.current=null,this.ngOnChanges(l)}}function gV(p,l,u,f){const g=aA(p)||function mV(p,l){return p[oA]=l}(p,{previous:uu,current:null}),m=g.current||(g.current={}),v=g.previous,y=this.declaredInputs[u],x=v[y];m[y]=new fV(x&&x.currentValue,l,v===uu),p[f]=l}To.ngInherit=!0;const oA="__ngSimpleChanges__";function aA(p){return p[oA]||null}let zw;function Fn(p){return!!p.listen}const lA={createRenderer:(p,l)=>function $w(){return void 0!==zw?zw:"undefined"!=typeof document?document:void 0}()};function es(p){for(;Array.isArray(p);)p=p[0];return p}function pv(p,l){return es(l[p])}function Ao(p,l){return es(l[p.index])}function Yw(p,l){return p.data[l]}function $r(p,l){const u=l[p];return Va(u)?u:u[0]}function Xw(p){return 128==(128&p[2])}function Nc(p,l){return null==l?null:p[l]}function hA(p){p[18]=0}function qw(p,l){p[5]+=l;let u=p,f=p[3];for(;null!==f&&(1===l&&1===u[5]||-1===l&&0===u[5]);)f[5]+=l,u=f,f=f[3]}const Bt={lFrame:xA(null),bindingsEnabled:!0};function uA(){return Bt.bindingsEnabled}function Ne(){return Bt.lFrame.lView}function Ai(){return Bt.lFrame.tView}function ps(){let p=fA();for(;null!==p&&64===p.type;)p=p.parent;return p}function fA(){return Bt.lFrame.currentTNode}function ja(p,l){const u=Bt.lFrame;u.currentTNode=p,u.isParent=l}function Zw(){return Bt.lFrame.isParent}function yu(){return Bt.lFrame.bindingIndex++}function OV(p,l){const u=Bt.lFrame;u.bindingIndex=u.bindingRootIndex=p,Qw(l)}function Qw(p){Bt.lFrame.currentDirectiveIndex=p}function eC(p){Bt.lFrame.currentQueryIndex=p}function FV(p){const l=p[1];return 2===l.type?l.declTNode:1===l.type?p[6]:null}function vA(p,l,u){if(u&Pt.SkipSelf){let g=l,m=p;for(;!(g=g.parent,null!==g||u&Pt.Host||(g=FV(m),null===g||(m=m[15],10&g.type))););if(null===g)return!1;l=g,p=m}const f=Bt.lFrame=yA();return f.currentTNode=l,f.lView=p,!0}function mv(p){const l=yA(),u=p[1];Bt.lFrame=l,l.currentTNode=u.firstChild,l.lView=p,l.tView=u,l.contextLView=p,l.bindingIndex=u.bindingStartIndex,l.inI18n=!1}function yA(){const p=Bt.lFrame,l=null===p?null:p.child;return null===l?xA(p):l}function xA(p){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:p,child:null,inI18n:!1};return null!==p&&(p.child=l),l}function wA(){const p=Bt.lFrame;return Bt.lFrame=p.parent,p.currentTNode=null,p.lView=null,p}const CA=wA;function vv(){const p=wA();p.isParent=!0,p.tView=null,p.selectedIndex=-1,p.contextLView=null,p.elementDepthCount=0,p.currentDirectiveIndex=-1,p.currentNamespace=null,p.bindingRootIndex=-1,p.bindingIndex=-1,p.currentQueryIndex=0}function cr(){return Bt.lFrame.selectedIndex}function Bc(p){Bt.lFrame.selectedIndex=p}function Nn(){const p=Bt.lFrame;return Yw(p.tView,p.selectedIndex)}function yv(p,l){for(let u=l.directiveStart,f=l.directiveEnd;u<f;u++){const m=p.data[u].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:y,ngAfterViewInit:x,ngAfterViewChecked:w,ngOnDestroy:C}=m;v&&(p.contentHooks||(p.contentHooks=[])).push(-u,v),y&&((p.contentHooks||(p.contentHooks=[])).push(u,y),(p.contentCheckHooks||(p.contentCheckHooks=[])).push(u,y)),x&&(p.viewHooks||(p.viewHooks=[])).push(-u,x),w&&((p.viewHooks||(p.viewHooks=[])).push(u,w),(p.viewCheckHooks||(p.viewCheckHooks=[])).push(u,w)),null!=C&&(p.destroyHooks||(p.destroyHooks=[])).push(u,C)}}function xv(p,l,u){bA(p,l,3,u)}function wv(p,l,u,f){(3&p[2])===u&&bA(p,l,u,f)}function tC(p,l){let u=p[2];(3&u)===l&&(u&=2047,u+=1,p[2]=u)}function bA(p,l,u,f){const m=null!=f?f:-1,v=l.length-1;let y=0;for(let x=void 0!==f?65535&p[18]:0;x<v;x++)if("number"==typeof l[x+1]){if(y=l[x],null!=f&&y>=f)break}else l[x]<0&&(p[18]+=65536),(y<m||-1==m)&&(zV(p,u,l,x),p[18]=(4294901760&p[18])+x+2),x++}function zV(p,l,u,f){const g=u[f]<0,m=u[f+1],y=p[g?-u[f]:u[f]];if(g){if(p[2]>>11<p[18]>>16&&(3&p[2])===l){p[2]+=2048;try{m.call(y)}finally{}}}else try{m.call(y)}finally{}}class qp{constructor(l,u,f){this.factory=l,this.resolving=!1,this.canSeeViewProviders=u,this.injectImpl=f}}function Cv(p,l,u){const f=Fn(p);let g=0;for(;g<u.length;){const m=u[g];if("number"==typeof m){if(0!==m)break;g++;const v=u[g++],y=u[g++],x=u[g++];f?p.setAttribute(l,y,x,v):l.setAttributeNS(v,y,x)}else{const v=m,y=u[++g];nC(v)?f&&p.setProperty(l,v,y):f?p.setAttribute(l,v,y):l.setAttribute(v,y),g++}}return g}function _A(p){return 3===p||4===p||6===p}function nC(p){return 64===p.charCodeAt(0)}function bv(p,l){if(null!==l&&0!==l.length)if(null===p||0===p.length)p=l.slice();else{let u=-1;for(let f=0;f<l.length;f++){const g=l[f];"number"==typeof g?u=g:0===u||SA(p,u,g,null,-1===u||2===u?l[++f]:null)}}return p}function SA(p,l,u,f,g){let m=0,v=p.length;if(-1===l)v=-1;else for(;m<p.length;){const y=p[m++];if("number"==typeof y){if(y===l){v=-1;break}if(y>l){v=m-1;break}}}for(;m<p.length;){const y=p[m];if("number"==typeof y)break;if(y===u){if(null===f)return void(null!==g&&(p[m+1]=g));if(f===p[m+1])return void(p[m+2]=g)}m++,null!==f&&m++,null!==g&&m++}-1!==v&&(p.splice(v,0,l),m=v+1),p.splice(m++,0,u),null!==f&&p.splice(m++,0,f),null!==g&&p.splice(m++,0,g)}function EA(p){return-1!==p}function xu(p){return 32767&p}function wu(p,l){let u=function ZV(p){return p>>16}(p),f=l;for(;u>0;)f=f[15],u--;return f}let sC=!0;function _v(p){const l=sC;return sC=p,l}let JV=0;function Jp(p,l){const u=oC(p,l);if(-1!==u)return u;const f=l[1];f.firstCreatePass&&(p.injectorIndex=l.length,rC(f.data,p),rC(l,null),rC(f.blueprint,null));const g=Sv(p,l),m=p.injectorIndex;if(EA(g)){const v=xu(g),y=wu(g,l),x=y[1].data;for(let w=0;w<8;w++)l[m+w]=y[v+w]|x[v+w]}return l[m+8]=g,m}function rC(p,l){p.push(0,0,0,0,0,0,0,0,l)}function oC(p,l){return-1===p.injectorIndex||p.parent&&p.parent.injectorIndex===p.injectorIndex||null===l[p.injectorIndex+8]?-1:p.injectorIndex}function Sv(p,l){if(p.parent&&-1!==p.parent.injectorIndex)return p.parent.injectorIndex;let u=0,f=null,g=l;for(;null!==g;){const m=g[1],v=m.type;if(f=2===v?m.declTNode:1===v?g[6]:null,null===f)return-1;if(u++,g=g[15],-1!==f.injectorIndex)return f.injectorIndex|u<<16}return-1}function Ev(p,l,u){!function QV(p,l,u){let f;"string"==typeof u?f=u.charCodeAt(0)||0:u.hasOwnProperty(Gp)&&(f=u[Gp]),null==f&&(f=u[Gp]=JV++);const g=255&f;l.data[p+(g>>5)]|=1<<g}(p,l,u)}function AA(p,l,u){if(u&Pt.Optional)return p;ov(l,"NodeInjector")}function IA(p,l,u,f){if(u&Pt.Optional&&void 0===f&&(f=null),0==(u&(Pt.Self|Pt.Host))){const g=p[9],m=Oc(void 0);try{return g?g.get(l,f,u&Pt.Optional):QD(l,f,u&Pt.Optional)}finally{Oc(m)}}return AA(f,l,u)}function PA(p,l,u,f=Pt.Default,g){if(null!==p){const m=function ij(p){if("string"==typeof p)return p.charCodeAt(0)||0;const l=p.hasOwnProperty(Gp)?p[Gp]:void 0;return"number"==typeof l?l>=0?255&l:ej:l}(u);if("function"==typeof m){if(!vA(l,p,f))return f&Pt.Host?AA(g,u,f):IA(l,u,f,g);try{const v=m(f);if(null!=v||f&Pt.Optional)return v;ov(u)}finally{CA()}}else if("number"==typeof m){let v=null,y=oC(p,l),x=-1,w=f&Pt.Host?l[16][6]:null;for((-1===y||f&Pt.SkipSelf)&&(x=-1===y?Sv(p,l):l[y+8],-1!==x&&kA(f,!1)?(v=l[1],y=xu(x),l=wu(x,l)):y=-1);-1!==y;){const C=l[1];if(MA(m,y,C.data)){const _=tj(y,l,u,v,f,w);if(_!==RA)return _}x=l[y+8],-1!==x&&kA(f,l[1].data[y+8]===w)&&MA(m,y,l)?(v=C,y=xu(x),l=wu(x,l)):y=-1}}}return IA(l,u,f,g)}const RA={};function ej(){return new Cu(ps(),Ne())}function tj(p,l,u,f,g,m){const v=l[1],y=v.data[p+8],C=function Tv(p,l,u,f,g){const m=p.providerIndexes,v=l.data,y=1048575&m,x=p.directiveStart,C=m>>20,T=g?y+C:p.directiveEnd;for(let M=f?y:y+C;M<T;M++){const L=v[M];if(M<x&&u===L||M>=x&&L.type===u)return M}if(g){const M=v[x];if(M&&ra(M)&&M.type===u)return x}return null}(y,v,u,null==f?uv(y)&&sC:f!=v&&0!=(3&y.type),g&Pt.Host&&m===y);return null!==C?Qp(l,v,C,y):RA}function Qp(p,l,u,f){let g=p[u];const m=l.data;if(function $V(p){return p instanceof qp}(g)){const v=g;v.resolving&&function YU(p,l){const u=l?`. Dependency path: ${l.join(" > ")} > ${p}`:"";throw new Di(-200,`Circular dependency in DI detected for ${p}${u}`)}(Ds(m[u]));const y=_v(v.canSeeViewProviders);v.resolving=!0;const x=v.injectImpl?Oc(v.injectImpl):null;vA(p,f,Pt.Default);try{g=p[u]=v.factory(void 0,m,p,f),l.firstCreatePass&&u>=f.directiveStart&&function GV(p,l,u){const{ngOnChanges:f,ngOnInit:g,ngDoCheck:m}=l.type.prototype;if(f){const v=rA(l);(u.preOrderHooks||(u.preOrderHooks=[])).push(p,v),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(p,v)}g&&(u.preOrderHooks||(u.preOrderHooks=[])).push(0-p,g),m&&((u.preOrderHooks||(u.preOrderHooks=[])).push(p,m),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(p,m))}(u,m[u],l)}finally{null!==x&&Oc(x),_v(y),v.resolving=!1,CA()}}return g}function MA(p,l,u){return!!(u[l+(p>>5)]&1<<p)}function kA(p,l){return!(p&Pt.Self||p&Pt.Host&&l)}class Cu{constructor(l,u){this._tNode=l,this._lView=u}get(l,u,f){return PA(this._tNode,this._lView,l,f,u)}}function aC(p){return XD(p)?()=>{const l=aC(Qt(p));return l&&l()}:qh(p)}const _u="__parameters__";function Eu(p,l,u){return Lc(()=>{const f=function lC(p){return function(...u){if(p){const f=p(...u);for(const g in f)this[g]=f[g]}}}(l);function g(...m){if(this instanceof g)return f.apply(this,m),this;const v=new g(...m);return y.annotation=v,y;function y(x,w,C){const _=x.hasOwnProperty(_u)?x[_u]:Object.defineProperty(x,_u,{value:[]})[_u];for(;_.length<=C;)_.push(null);return(_[C]=_[C]||[]).push(v),x}}return u&&(g.prototype=Object.create(u.prototype)),g.prototype.ngMetadataName=p,g.annotationCls=g,g})}class oi{constructor(l,u){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof u?this.__NG_ELEMENT_ID__=u:void 0!==u&&(this.\u0275prov=wi({token:this,providedIn:u.providedIn||"root",factory:u.factory}))}toString(){return`InjectionToken ${this._desc}`}}const sj=new oi("AnalyzeForEntryComponents");function Ha(p,l){p.forEach(u=>Array.isArray(u)?Ha(u,l):l(u))}function LA(p,l,u){l>=p.length?p.push(u):p.splice(l,0,u)}function Dv(p,l){return l>=p.length-1?p.pop():p.splice(l,1)[0]}function Yr(p,l,u){let f=Tu(p,l);return f>=0?p[1|f]=u:(f=~f,function aj(p,l,u,f){let g=p.length;if(g==l)p.push(u,f);else if(1===g)p.push(f,p[0]),p[0]=u;else{for(g--,p.push(p[g-1],p[g]);g>l;)p[g]=p[g-2],g--;p[l]=u,p[l+1]=f}}(p,f,l,u)),f}function hC(p,l){const u=Tu(p,l);if(u>=0)return p[1|u]}function Tu(p,l){return function BA(p,l,u){let f=0,g=p.length>>u;for(;g!==f;){const m=f+(g-f>>1),v=p[m<<u];if(l===v)return m<<u;v>l?g=m:f=m+1}return~(g<<u)}(p,l,1)}const ng={},uC="__NG_DI_FLAG__",Iv="ngTempTokenPath",pj=/\n/gm,VA="__source",mj=qi({provide:String,useValue:qi});let sg;function jA(p){const l=sg;return sg=p,l}function vj(p,l=Pt.Default){if(void 0===sg)throw new Di(203,"");return null===sg?QD(p,void 0,l):sg.get(p,l&Pt.Optional?null:void 0,l)}function It(p,l=Pt.Default){return(function eV(){return Lw}()||vj)(Qt(p),l)}const yj=It;function fC(p){const l=[];for(let u=0;u<p.length;u++){const f=Qt(p[u]);if(Array.isArray(f)){if(0===f.length)throw new Di(900,"");let g,m=Pt.Default;for(let v=0;v<f.length;v++){const y=f[v],x=xj(y);"number"==typeof x?-1===x?g=y.token:m|=x:g=y}l.push(It(g,m))}else l.push(It(f))}return l}function rg(p,l){return p[uC]=l,p.prototype[uC]=l,p}function xj(p){return p[uC]}const Pv=rg(Eu("Inject",p=>({token:p})),-1),Vc=rg(Eu("Optional"),8),og=rg(Eu("SkipSelf"),4);class ZA{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function jc(p){return p instanceof ZA?p.changingThisBreaksApplicationSecurity:p}const jj=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Hj=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var ts=(()=>((ts=ts||{})[ts.NONE=0]="NONE",ts[ts.HTML=1]="HTML",ts[ts.STYLE=2]="STYLE",ts[ts.SCRIPT=3]="SCRIPT",ts[ts.URL=4]="URL",ts[ts.RESOURCE_URL=5]="RESOURCE_URL",ts))();function CC(p){const l=function hg(){const p=Ne();return p&&p[12]}();return l?l.sanitize(ts.URL,p)||"":function lg(p,l){const u=function Nj(p){return p instanceof ZA&&p.getTypeName()||null}(p);if(null!=u&&u!==l){if("ResourceURL"===u&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${u} (see https://g.co/ng/security#xss)`)}return u===l}(p,"URL")?jc(p):function Ov(p){return(p=String(p)).match(jj)||p.match(Hj)?p:"unsafe:"+p}(Nt(p))}const oI="__ngContext__";function Ys(p,l){p[oI]=l}function _C(p){const l=function dg(p){return p[oI]||null}(p);return l?Array.isArray(l)?l:l.lView:null}function EC(p){return p.ngOriginalError}function dH(p,...l){p.error(...l)}class ug{constructor(){this._console=console}handleError(l){const u=this._findOriginalError(l),f=function hH(p){return p&&p.ngErrorLogger||dH}(l);f(this._console,"ERROR",l),u&&f(this._console,"ORIGINAL ERROR",u)}_findOriginalError(l){let u=l&&EC(l);for(;u&&EC(u);)u=EC(u);return u||null}}const CH=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Wi))();function Ga(p){return p instanceof Function?p():p}var Xr=(()=>((Xr=Xr||{})[Xr.Important=1]="Important",Xr[Xr.DashCase=2]="DashCase",Xr))();function DC(p,l){return undefined(p,l)}function fg(p){const l=p[3];return sa(l)?l[3]:l}function AC(p){return gI(p[13])}function IC(p){return gI(p[4])}function gI(p){for(;null!==p&&!sa(p);)p=p[4];return p}function Pu(p,l,u,f,g){if(null!=f){let m,v=!1;sa(f)?m=f:Va(f)&&(v=!0,f=f[0]);const y=es(f);0===p&&null!==u?null==g?CI(l,u,y):Zh(l,u,y,g||null,!0):1===p&&null!==u?Zh(l,u,y,g||null,!0):2===p?function AI(p,l,u){const f=Fv(p,l);f&&function LH(p,l,u,f){Fn(p)?p.removeChild(l,u,f):l.removeChild(u)}(p,f,l,u)}(l,y,v):3===p&&l.destroyNode(y),null!=m&&function BH(p,l,u,f,g){const m=u[7];m!==es(u)&&Pu(l,p,f,m,g);for(let y=10;y<u.length;y++){const x=u[y];pg(x[1],x,p,l,f,m)}}(l,p,m,u,g)}}function RC(p,l,u){if(Fn(p))return p.createElement(l,u);{const f=null!==u?function wV(p){const l=p.toLowerCase();return"svg"===l?"http://www.w3.org/2000/svg":"math"===l?"http://www.w3.org/1998/MathML/":null}(u):null;return null===f?p.createElement(l):p.createElementNS(f,l)}}function vI(p,l){const u=p[9],f=u.indexOf(l),g=l[3];1024&l[2]&&(l[2]&=-1025,qw(g,-1)),u.splice(f,1)}function MC(p,l){if(p.length<=10)return;const u=10+l,f=p[u];if(f){const g=f[17];null!==g&&g!==p&&vI(g,f),l>0&&(p[u-1][4]=f[4]);const m=Dv(p,10+l);!function DH(p,l){pg(p,l,l[11],2,null,null),l[0]=null,l[6]=null}(f[1],f);const v=m[19];null!==v&&v.detachView(m[1]),f[3]=null,f[4]=null,f[2]&=-129}return f}function yI(p,l){if(!(256&l[2])){const u=l[11];Fn(u)&&u.destroyNode&&pg(p,l,u,3,null,null),function PH(p){let l=p[13];if(!l)return kC(p[1],p);for(;l;){let u=null;if(Va(l))u=l[13];else{const f=l[10];f&&(u=f)}if(!u){for(;l&&!l[4]&&l!==p;)Va(l)&&kC(l[1],l),l=l[3];null===l&&(l=p),Va(l)&&kC(l[1],l),u=l&&l[4]}l=u}}(l)}}function kC(p,l){if(!(256&l[2])){l[2]&=-129,l[2]|=256,function OH(p,l){let u;if(null!=p&&null!=(u=p.destroyHooks))for(let f=0;f<u.length;f+=2){const g=l[u[f]];if(!(g instanceof qp)){const m=u[f+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const y=g[m[v]],x=m[v+1];try{x.call(y)}finally{}}else try{m.call(g)}finally{}}}}(p,l),function kH(p,l){const u=p.cleanup,f=l[7];let g=-1;if(null!==u)for(let m=0;m<u.length-1;m+=2)if("string"==typeof u[m]){const v=u[m+1],y="function"==typeof v?v(l):es(l[v]),x=f[g=u[m+2]],w=u[m+3];"boolean"==typeof w?y.removeEventListener(u[m],x,w):w>=0?f[g=w]():f[g=-w].unsubscribe(),m+=2}else{const v=f[g=u[m+1]];u[m].call(v)}if(null!==f){for(let m=g+1;m<f.length;m++)f[m]();l[7]=null}}(p,l),1===l[1].type&&Fn(l[11])&&l[11].destroy();const u=l[17];if(null!==u&&sa(l[3])){u!==l[3]&&vI(u,l);const f=l[19];null!==f&&f.detachView(p)}}}function xI(p,l,u){return function wI(p,l,u){let f=l;for(;null!==f&&40&f.type;)f=(l=f).parent;if(null===f)return u[0];if(2&f.flags){const g=p.data[f.directiveStart].encapsulation;if(g===Ba.None||g===Ba.Emulated)return null}return Ao(f,u)}(p,l.parent,u)}function Zh(p,l,u,f,g){Fn(p)?p.insertBefore(l,u,f,g):l.insertBefore(u,f,g)}function CI(p,l,u){Fn(p)?p.appendChild(l,u):l.appendChild(u)}function bI(p,l,u,f,g){null!==f?Zh(p,l,u,f,g):CI(p,l,u)}function Fv(p,l){return Fn(p)?p.parentNode(l):l.parentNode}let EI=function SI(p,l,u){return 40&p.type?Ao(p,u):null};function Nv(p,l,u,f){const g=xI(p,f,l),m=l[11],y=function _I(p,l,u){return EI(p,l,u)}(f.parent||l[6],f,l);if(null!=g)if(Array.isArray(u))for(let x=0;x<u.length;x++)bI(m,g,u[x],y,!1);else bI(m,g,u,y,!1)}function Bv(p,l){if(null!==l){const u=l.type;if(3&u)return Ao(l,p);if(4&u)return LC(-1,p[l.index]);if(8&u){const f=l.child;if(null!==f)return Bv(p,f);{const g=p[l.index];return sa(g)?LC(-1,g):es(g)}}if(32&u)return DC(l,p)()||es(p[l.index]);{const f=DI(p,l);return null!==f?Array.isArray(f)?f[0]:Bv(fg(p[16]),f):Bv(p,l.next)}}return null}function DI(p,l){return null!==l?p[16][6].projection[l.projection]:null}function LC(p,l){const u=10+p+1;if(u<l.length){const f=l[u],g=f[1].firstChild;if(null!==g)return Bv(f,g)}return l[7]}function FC(p,l,u,f,g,m,v){for(;null!=u;){const y=f[u.index],x=u.type;if(v&&0===l&&(y&&Ys(es(y),f),u.flags|=4),64!=(64&u.flags))if(8&x)FC(p,l,u.child,f,g,m,!1),Pu(l,p,g,y,m);else if(32&x){const w=DC(u,f);let C;for(;C=w();)Pu(l,p,g,C,m);Pu(l,p,g,y,m)}else 16&x?II(p,l,f,u,g,m):Pu(l,p,g,y,m);u=v?u.projectionNext:u.next}}function pg(p,l,u,f,g,m){FC(u,f,p.firstChild,l,g,m,!1)}function II(p,l,u,f,g,m){const v=u[16],x=v[6].projection[f.projection];if(Array.isArray(x))for(let w=0;w<x.length;w++)Pu(l,p,g,x[w],m);else FC(p,l,x,v[3],g,m,!0)}function PI(p,l,u){Fn(p)?p.setAttribute(l,"style",u):l.style.cssText=u}function NC(p,l,u){Fn(p)?""===u?p.removeAttribute(l,"class"):p.setAttribute(l,"class",u):l.className=u}function RI(p,l,u){let f=p.length;for(;;){const g=p.indexOf(l,u);if(-1===g)return g;if(0===g||p.charCodeAt(g-1)<=32){const m=l.length;if(g+m===f||p.charCodeAt(g+m)<=32)return g}u=g+1}}const MI="ng-template";function VH(p,l,u){let f=0;for(;f<p.length;){let g=p[f++];if(u&&"class"===g){if(g=p[f],-1!==RI(g.toLowerCase(),l,0))return!0}else if(1===g){for(;f<p.length&&"string"==typeof(g=p[f++]);)if(g.toLowerCase()===l)return!0;return!1}}return!1}function kI(p){return 4===p.type&&p.value!==MI}function jH(p,l,u){return l===(4!==p.type||u?p.value:MI)}function HH(p,l,u){let f=4;const g=p.attrs||[],m=function zH(p){for(let l=0;l<p.length;l++)if(_A(p[l]))return l;return p.length}(g);let v=!1;for(let y=0;y<l.length;y++){const x=l[y];if("number"!=typeof x){if(!v)if(4&f){if(f=2|1&f,""!==x&&!jH(p,x,u)||""===x&&1===l.length){if(oa(f))return!1;v=!0}}else{const w=8&f?x:l[++y];if(8&f&&null!==p.attrs){if(!VH(p.attrs,w,u)){if(oa(f))return!1;v=!0}continue}const _=WH(8&f?"class":x,g,kI(p),u);if(-1===_){if(oa(f))return!1;v=!0;continue}if(""!==w){let T;T=_>m?"":g[_+1].toLowerCase();const M=8&f?T:null;if(M&&-1!==RI(M,w,0)||2&f&&w!==T){if(oa(f))return!1;v=!0}}}}else{if(!v&&!oa(f)&&!oa(x))return!1;if(v&&oa(x))continue;v=!1,f=x|1&f}}return oa(f)||v}function oa(p){return 0==(1&p)}function WH(p,l,u,f){if(null===l)return-1;let g=0;if(f||!u){let m=!1;for(;g<l.length;){const v=l[g];if(v===p)return g;if(3===v||6===v)m=!0;else{if(1===v||2===v){let y=l[++g];for(;"string"==typeof y;)y=l[++g];continue}if(4===v)break;if(0===v){g+=4;continue}}g+=m?1:2}return-1}return function $H(p,l){let u=p.indexOf(4);if(u>-1)for(u++;u<p.length;){const f=p[u];if("number"==typeof f)return-1;if(f===l)return u;u++}return-1}(l,p)}function OI(p,l,u=!1){for(let f=0;f<l.length;f++)if(HH(p,l[f],u))return!0;return!1}function LI(p,l){return p?":not("+l.trim()+")":l}function XH(p){let l=p[0],u=1,f=2,g="",m=!1;for(;u<p.length;){let v=p[u];if("string"==typeof v)if(2&f){const y=p[++u];g+="["+v+(y.length>0?'="'+y+'"':"")+"]"}else 8&f?g+="."+v:4&f&&(g+=" "+v);else""!==g&&!oa(v)&&(l+=LI(m,g),g=""),f=v,m=m||!oa(f);u++}return""!==g&&(l+=LI(m,g)),l}const Ut={};function Tn(p){FI(Ai(),Ne(),cr()+p,!1)}function FI(p,l,u,f){if(!f)if(3==(3&l[2])){const m=p.preOrderCheckHooks;null!==m&&xv(l,m,u)}else{const m=p.preOrderHooks;null!==m&&wv(l,m,0,u)}Bc(u)}function Uv(p,l){return p<<17|l<<2}function aa(p){return p>>17&32767}function BC(p){return 2|p}function Nl(p){return(131068&p)>>2}function UC(p,l){return-131069&p|l<<2}function VC(p){return 1|p}function YI(p,l){const u=p.contentQueries;if(null!==u)for(let f=0;f<u.length;f+=2){const g=u[f],m=u[f+1];if(-1!==m){const v=p.data[m];eC(g),v.contentQueries(2,l[m],m)}}}function gg(p,l,u,f,g,m,v,y,x,w){const C=l.blueprint.slice();return C[0]=g,C[2]=140|f,hA(C),C[3]=C[15]=p,C[8]=u,C[10]=v||p&&p[10],C[11]=y||p&&p[11],C[12]=x||p&&p[12]||null,C[9]=w||p&&p[9]||null,C[6]=m,C[16]=2==l.type?p[16]:C,C}function Ru(p,l,u,f,g){let m=p.data[l];if(null===m)m=function qC(p,l,u,f,g){const m=fA(),v=Zw(),x=p.data[l]=function uW(p,l,u,f,g,m){return{type:u,index:f,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,u,l,f,g);return null===p.firstChild&&(p.firstChild=x),null!==m&&(v?null==m.child&&null!==x.parent&&(m.child=x):null===m.next&&(m.next=x)),x}(p,l,u,f,g),function kV(){return Bt.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=u,m.value=f,m.attrs=g;const v=function Xp(){const p=Bt.lFrame,l=p.currentTNode;return p.isParent?l:l.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return ja(m,!0),m}function Mu(p,l,u,f){if(0===u)return-1;const g=l.length;for(let m=0;m<u;m++)l.push(f),p.blueprint.push(f),p.data.push(null);return g}function mg(p,l,u){mv(l);try{const f=p.viewQuery;null!==f&&sb(1,f,u);const g=p.template;null!==g&&XI(p,l,g,1,u),p.firstCreatePass&&(p.firstCreatePass=!1),p.staticContentQueries&&YI(p,l),p.staticViewQueries&&sb(2,p.viewQuery,u);const m=p.components;null!==m&&function cW(p,l){for(let u=0;u<l.length;u++)PW(p,l[u])}(l,m)}catch(f){throw p.firstCreatePass&&(p.incompleteFirstPass=!0,p.firstCreatePass=!1),f}finally{l[2]&=-5,vv()}}function ku(p,l,u,f){const g=l[2];if(256!=(256&g)){mv(l);try{hA(l),function pA(p){return Bt.lFrame.bindingIndex=p}(p.bindingStartIndex),null!==u&&XI(p,l,u,2,f);const v=3==(3&g);if(v){const w=p.preOrderCheckHooks;null!==w&&xv(l,w,null)}else{const w=p.preOrderHooks;null!==w&&wv(l,w,0,null),tC(l,0)}if(function AW(p){for(let l=AC(p);null!==l;l=IC(l)){if(!l[2])continue;const u=l[9];for(let f=0;f<u.length;f++){const g=u[f],m=g[3];0==(1024&g[2])&&qw(m,1),g[2]|=1024}}}(l),function DW(p){for(let l=AC(p);null!==l;l=IC(l))for(let u=10;u<l.length;u++){const f=l[u],g=f[1];Xw(f)&&ku(g,f,g.template,f[8])}}(l),null!==p.contentQueries&&YI(p,l),v){const w=p.contentCheckHooks;null!==w&&xv(l,w)}else{const w=p.contentHooks;null!==w&&wv(l,w,1),tC(l,1)}!function aW(p,l){const u=p.hostBindingOpCodes;if(null!==u)try{for(let f=0;f<u.length;f++){const g=u[f];if(g<0)Bc(~g);else{const m=g,v=u[++f],y=u[++f];OV(v,m),y(2,l[m])}}}finally{Bc(-1)}}(p,l);const y=p.components;null!==y&&function lW(p,l){for(let u=0;u<l.length;u++)IW(p,l[u])}(l,y);const x=p.viewQuery;if(null!==x&&sb(2,x,f),v){const w=p.viewCheckHooks;null!==w&&xv(l,w)}else{const w=p.viewHooks;null!==w&&wv(l,w,2),tC(l,2)}!0===p.firstUpdatePass&&(p.firstUpdatePass=!1),l[2]&=-73,1024&l[2]&&(l[2]&=-1025,qw(l[3],-1))}finally{vv()}}}function hW(p,l,u,f){const g=l[10],v=function cA(p){return 4==(4&p[2])}(l);try{!v&&g.begin&&g.begin(),v&&mg(p,l,f),ku(p,l,u,f)}finally{!v&&g.end&&g.end()}}function XI(p,l,u,f,g){const m=cr(),v=2&f;try{Bc(-1),v&&l.length>20&&FI(p,l,20,!1),u(f,g)}finally{Bc(m)}}function ZC(p,l,u){!uA()||(function xW(p,l,u,f){const g=u.directiveStart,m=u.directiveEnd;p.firstCreatePass||Jp(u,l),Ys(f,l);const v=u.initialInputs;for(let y=g;y<m;y++){const x=p.data[y],w=ra(x);w&&SW(l,u,x);const C=Qp(l,p,y,u);Ys(C,l),null!==v&&EW(0,y-g,C,x,0,v),w&&($r(u.index,l)[8]=C)}}(p,l,u,Ao(u,l)),128==(128&u.flags)&&function wW(p,l,u){const f=u.directiveStart,g=u.directiveEnd,v=u.index,y=function LV(){return Bt.lFrame.currentDirectiveIndex}();try{Bc(v);for(let x=f;x<g;x++){const w=p.data[x],C=l[x];Qw(x),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&n5(w,C)}}finally{Bc(-1),Qw(y)}}(p,l,u))}function JC(p,l,u=Ao){const f=l.localNames;if(null!==f){let g=l.index+1;for(let m=0;m<f.length;m+=2){const v=f[m+1],y=-1===v?u(l,p):p[v];p[g++]=y}}}function ZI(p){const l=p.tView;return null===l||l.incompleteFirstPass?p.tView=Hv(1,null,p.template,p.decls,p.vars,p.directiveDefs,p.pipeDefs,p.viewQuery,p.schemas,p.consts):l}function Hv(p,l,u,f,g,m,v,y,x,w){const C=20+f,_=C+g,T=function dW(p,l){const u=[];for(let f=0;f<l;f++)u.push(f<p?null:Ut);return u}(C,_),M="function"==typeof w?w():w;return T[1]={type:p,blueprint:T,template:u,queries:null,viewQuery:y,declTNode:l,data:T.slice().fill(null,C),bindingStartIndex:C,expandoStartIndex:_,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:x,consts:M,incompleteFirstPass:!1}}function e5(p,l,u){for(let f in p)if(p.hasOwnProperty(f)){const g=p[f];(u=null===u?{}:u).hasOwnProperty(f)?u[f].push(l,g):u[f]=[l,g]}return u}function QC(p,l,u,f){let g=!1;if(uA()){const m=function CW(p,l,u){const f=p.directiveRegistry;let g=null;if(f)for(let m=0;m<f.length;m++){const v=f[m];OI(u,v.selectors,!1)&&(g||(g=[]),Ev(Jp(u,l),p,v.type),ra(v)?(s5(p,u),g.unshift(v)):g.push(v))}return g}(p,l,u),v=null===f?null:{"":-1};if(null!==m){g=!0,r5(u,p.data.length,m.length);for(let C=0;C<m.length;C++){const _=m[C];_.providersResolver&&_.providersResolver(_)}let y=!1,x=!1,w=Mu(p,l,m.length,null);for(let C=0;C<m.length;C++){const _=m[C];u.mergedAttrs=bv(u.mergedAttrs,_.hostAttrs),o5(p,u,l,w,_),_W(w,_,v),null!==_.contentQueries&&(u.flags|=8),(null!==_.hostBindings||null!==_.hostAttrs||0!==_.hostVars)&&(u.flags|=128);const T=_.type.prototype;!y&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((p.preOrderHooks||(p.preOrderHooks=[])).push(u.index),y=!0),!x&&(T.ngOnChanges||T.ngDoCheck)&&((p.preOrderCheckHooks||(p.preOrderCheckHooks=[])).push(u.index),x=!0),w++}!function fW(p,l){const f=l.directiveEnd,g=p.data,m=l.attrs,v=[];let y=null,x=null;for(let w=l.directiveStart;w<f;w++){const C=g[w],_=C.inputs,T=null===m||kI(l)?null:TW(_,m);v.push(T),y=e5(_,w,y),x=e5(C.outputs,w,x)}null!==y&&(y.hasOwnProperty("class")&&(l.flags|=16),y.hasOwnProperty("style")&&(l.flags|=32)),l.initialInputs=v,l.inputs=y,l.outputs=x}(p,u)}v&&function bW(p,l,u){if(l){const f=p.localNames=[];for(let g=0;g<l.length;g+=2){const m=u[l[g+1]];if(null==m)throw new Di(-301,!1);f.push(l[g],m)}}}(u,f,v)}return u.mergedAttrs=bv(u.mergedAttrs,u.attrs),g}function i5(p,l,u,f,g,m){const v=m.hostBindings;if(v){let y=p.hostBindingOpCodes;null===y&&(y=p.hostBindingOpCodes=[]);const x=~l.index;(function yW(p){let l=p.length;for(;l>0;){const u=p[--l];if("number"==typeof u&&u<0)return u}return 0})(y)!=x&&y.push(x),y.push(f,g,v)}}function n5(p,l){null!==p.hostBindings&&p.hostBindings(1,l)}function s5(p,l){l.flags|=2,(p.components||(p.components=[])).push(l.index)}function _W(p,l,u){if(u){if(l.exportAs)for(let f=0;f<l.exportAs.length;f++)u[l.exportAs[f]]=p;ra(l)&&(u[""]=p)}}function r5(p,l,u){p.flags|=1,p.directiveStart=l,p.directiveEnd=l+u,p.providerIndexes=l}function o5(p,l,u,f,g){p.data[f]=g;const m=g.factory||(g.factory=qh(g.type)),v=new qp(m,ra(g),null);p.blueprint[f]=v,u[f]=v,i5(p,l,0,f,Mu(p,u,g.hostVars,Ut),g)}function SW(p,l,u){const f=Ao(l,p),g=ZI(u),m=p[10],v=Wv(p,gg(p,g,null,u.onPush?64:16,f,l,m,m.createRenderer(f,u),null,null));p[l.index]=v}function za(p,l,u,f,g,m){const v=Ao(p,l);!function KC(p,l,u,f,g,m,v){if(null==m)Fn(p)?p.removeAttribute(l,g,u):l.removeAttribute(g);else{const y=null==v?Nt(m):v(m,f||"",g);Fn(p)?p.setAttribute(l,g,y,u):u?l.setAttributeNS(u,g,y):l.setAttribute(g,y)}}(l[11],v,m,p.value,u,f,g)}function EW(p,l,u,f,g,m){const v=m[l];if(null!==v){const y=f.setInput;for(let x=0;x<v.length;){const w=v[x++],C=v[x++],_=v[x++];null!==y?f.setInput(u,_,w,C):u[C]=_}}}function TW(p,l){let u=null,f=0;for(;f<l.length;){const g=l[f];if(0!==g)if(5!==g){if("number"==typeof g)break;p.hasOwnProperty(g)&&(null===u&&(u=[]),u.push(g,p[g],l[f+1])),f+=2}else f+=2;else f+=4}return u}function a5(p,l,u,f){return new Array(p,!0,!1,l,null,0,f,u,null,null)}function IW(p,l){const u=$r(l,p);if(Xw(u)){const f=u[1];80&u[2]?ku(f,u,f.template,u[8]):u[5]>0&&eb(u)}}function eb(p){for(let f=AC(p);null!==f;f=IC(f))for(let g=10;g<f.length;g++){const m=f[g];if(1024&m[2]){const v=m[1];ku(v,m,v.template,m[8])}else m[5]>0&&eb(m)}const u=p[1].components;if(null!==u)for(let f=0;f<u.length;f++){const g=$r(u[f],p);Xw(g)&&g[5]>0&&eb(g)}}function PW(p,l){const u=$r(l,p),f=u[1];(function RW(p,l){for(let u=l.length;u<p.blueprint.length;u++)l.push(p.blueprint[u])})(f,u),mg(f,u,u[8])}function Wv(p,l){return p[13]?p[14][4]=l:p[13]=l,p[14]=l,l}function tb(p){for(;p;){p[2]|=64;const l=fg(p);if(hV(p)&&!l)return p;p=l}return null}function l5(p){!function ib(p){for(let l=0;l<p.components.length;l++){const u=p.components[l],f=_C(u),g=f[1];hW(g,f,g.template,u)}}(p[8])}function sb(p,l,u){eC(0),l(p,u)}const kW=(()=>Promise.resolve(null))();function c5(p){return p[7]||(p[7]=[])}function h5(p){return p.cleanup||(p.cleanup=[])}function u5(p,l){const u=p[9],f=u?u.get(ug,null):null;f&&f.handleError(l)}function f5(p,l,u,f,g){for(let m=0;m<u.length;){const v=u[m++],y=u[m++],x=l[v],w=p.data[v];null!==w.setInput?w.setInput(x,g,f,y):x[y]=g}}function Bl(p,l,u){const f=pv(l,p);!function mI(p,l,u){Fn(p)?p.setValue(l,u):l.textContent=u}(p[11],f,u)}function Gv(p,l,u){let f=u?p.styles:null,g=u?p.classes:null,m=0;if(null!==l)for(let v=0;v<l.length;v++){const y=l[v];"number"==typeof y?m=y:1==m?g=Rw(g,y):2==m&&(f=Rw(f,y+": "+l[++v]+";"))}u?p.styles=f:p.stylesWithoutHost=f,u?p.classes=g:p.classesWithoutHost=g}const rb=new oi("INJECTOR",-1);class p5{get(l,u=ng){if(u===ng){const f=new Error(`NullInjectorError: No provider for ${Bi(l)}!`);throw f.name="NullInjectorError",f}return u}}const ob=new oi("Set Injector scope."),vg={},FW={};let ab;function g5(){return void 0===ab&&(ab=new p5),ab}function m5(p,l=null,u=null,f){const g=v5(p,l,u,f);return g._resolveInjectorDefTypes(),g}function v5(p,l=null,u=null,f){return new NW(p,u,l||g5(),f)}class NW{constructor(l,u,f,g=null){this.parent=f,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];u&&Ha(u,y=>this.processProvider(y,l,u)),Ha([l],y=>this.processInjectorType(y,[],m)),this.records.set(rb,Ou(void 0,this));const v=this.records.get(ob);this.scope=null!=v?v.value:null,this.source=g||("object"==typeof l?null:Bi(l))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(l=>l.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(l,u=ng,f=Pt.Default){this.assertNotDestroyed();const g=jA(this),m=Oc(void 0);try{if(!(f&Pt.SkipSelf)){let y=this.records.get(l);if(void 0===y){const x=function zW(p){return"function"==typeof p||"object"==typeof p&&p instanceof oi}(l)&&kw(l);y=x&&this.injectableDefInScope(x)?Ou(lb(l),vg):null,this.records.set(l,y)}if(null!=y)return this.hydrate(l,y)}return(f&Pt.Self?g5():this.parent).get(l,u=f&Pt.Optional&&u===ng?null:u)}catch(v){if("NullInjectorError"===v.name){if((v[Iv]=v[Iv]||[]).unshift(Bi(l)),g)throw v;return function wj(p,l,u,f){const g=p[Iv];throw l[VA]&&g.unshift(l[VA]),p.message=function Cj(p,l,u,f=null){p=p&&"\n"===p.charAt(0)&&"\u0275"==p.charAt(1)?p.substr(2):p;let g=Bi(l);if(Array.isArray(l))g=l.map(Bi).join(" -> ");else if("object"==typeof l){let m=[];for(let v in l)if(l.hasOwnProperty(v)){let y=l[v];m.push(v+":"+("string"==typeof y?JSON.stringify(y):Bi(y)))}g=`{${m.join(", ")}}`}return`${u}${f?"("+f+")":""}[${g}]: ${p.replace(pj,"\n  ")}`}("\n"+p.message,g,u,f),p.ngTokenPath=g,p[Iv]=null,p}(v,l,"R3InjectorError",this.source)}throw v}finally{Oc(m),jA(g)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(l=>this.get(l))}toString(){const l=[];return this.records.forEach((f,g)=>l.push(Bi(g))),`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Di(205,!1)}processInjectorType(l,u,f){if(!(l=Qt(l)))return!1;let g=ZD(l);const m=null==g&&l.ngModule||void 0,v=void 0===m?l:m,y=-1!==f.indexOf(v);if(void 0!==m&&(g=ZD(m)),null==g)return!1;if(null!=g.imports&&!y){let C;f.push(v);try{Ha(g.imports,_=>{this.processInjectorType(_,u,f)&&(void 0===C&&(C=[]),C.push(_))})}finally{}if(void 0!==C)for(let _=0;_<C.length;_++){const{ngModule:T,providers:M}=C[_];Ha(M,L=>this.processProvider(L,T,M||Ji))}}this.injectorDefTypes.add(v);const x=qh(v)||(()=>new v);this.records.set(v,Ou(x,vg));const w=g.providers;if(null!=w&&!y){const C=l;Ha(w,_=>this.processProvider(_,C,w))}return void 0!==m&&void 0!==l.providers}processProvider(l,u,f){let g=Lu(l=Qt(l))?l:Qt(l&&l.provide);const m=function UW(p,l,u){return x5(p)?Ou(void 0,p.useValue):Ou(y5(p),vg)}(l);if(Lu(l)||!0!==l.multi)this.records.get(g);else{let v=this.records.get(g);v||(v=Ou(void 0,vg,!0),v.factory=()=>fC(v.multi),this.records.set(g,v)),g=l,v.multi.push(l)}this.records.set(g,m)}hydrate(l,u){return u.value===vg&&(u.value=FW,u.value=u.factory()),"object"==typeof u.value&&u.value&&function GW(p){return null!==p&&"object"==typeof p&&"function"==typeof p.ngOnDestroy}(u.value)&&this.onDestroy.add(u.value),u.value}injectableDefInScope(l){if(!l.providedIn)return!1;const u=Qt(l.providedIn);return"string"==typeof u?"any"===u||u===this.scope:this.injectorDefTypes.has(u)}}function lb(p){const l=kw(p),u=null!==l?l.factory:qh(p);if(null!==u)return u;if(p instanceof oi)throw new Di(204,!1);if(p instanceof Function)return function BW(p){const l=p.length;if(l>0)throw function ig(p,l){const u=[];for(let f=0;f<p;f++)u.push(l);return u}(l,"?"),new Di(204,!1);const u=function JU(p){const l=p&&(p[av]||p[JD]);if(l){const u=function QU(p){if(p.hasOwnProperty("name"))return p.name;const l=(""+p).match(/^function\s*([^\s(]+)/);return null===l?"":l[1]}(p);return console.warn(`DEPRECATED: DI is instantiating a token "${u}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${u}" class.`),l}return null}(p);return null!==u?()=>u.factory(p):()=>new p}(p);throw new Di(204,!1)}function y5(p,l,u){let f;if(Lu(p)){const g=Qt(p);return qh(g)||lb(g)}if(x5(p))f=()=>Qt(p.useValue);else if(function jW(p){return!(!p||!p.useFactory)}(p))f=()=>p.useFactory(...fC(p.deps||[]));else if(function VW(p){return!(!p||!p.useExisting)}(p))f=()=>It(Qt(p.useExisting));else{const g=Qt(p&&(p.useClass||p.provide));if(!function WW(p){return!!p.deps}(p))return qh(g)||lb(g);f=()=>new g(...fC(p.deps))}return f}function Ou(p,l,u=!1){return{factory:p,value:l,multi:u?[]:void 0}}function x5(p){return null!==p&&"object"==typeof p&&mj in p}function Lu(p){return"function"==typeof p}let Ar=(()=>{class p{static create(u,f){var g;if(Array.isArray(u))return m5({name:""},f,u,"");{const m=null!==(g=u.name)&&void 0!==g?g:"";return m5({name:m},u.parent,u.providers,m)}}}return p.THROW_IF_NOT_FOUND=ng,p.NULL=new p5,p.\u0275prov=wi({token:p,providedIn:"any",factory:()=>It(rb)}),p.__NG_ELEMENT_ID__=-1,p})();function KW(p,l){yv(_C(p)[1],ps())}function Ui(p){let l=function R5(p){return Object.getPrototypeOf(p.prototype).constructor}(p.type),u=!0;const f=[p];for(;l;){let g;if(ra(p))g=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new Di(903,"");g=l.\u0275dir}if(g){if(u){f.push(g);const v=p;v.inputs=db(p.inputs),v.declaredInputs=db(p.declaredInputs),v.outputs=db(p.outputs);const y=g.hostBindings;y&&nG(p,y);const x=g.viewQuery,w=g.contentQueries;if(x&&tG(p,x),w&&iG(p,w),Pw(p.inputs,g.inputs),Pw(p.declaredInputs,g.declaredInputs),Pw(p.outputs,g.outputs),ra(g)&&g.data.animation){const C=p.data;C.animation=(C.animation||[]).concat(g.data.animation)}}const m=g.features;if(m)for(let v=0;v<m.length;v++){const y=m[v];y&&y.ngInherit&&y(p),y===Ui&&(u=!1)}}l=Object.getPrototypeOf(l)}!function eG(p){let l=0,u=null;for(let f=p.length-1;f>=0;f--){const g=p[f];g.hostVars=l+=g.hostVars,g.hostAttrs=bv(g.hostAttrs,u=bv(u,g.hostAttrs))}}(f)}function db(p){return p===uu?{}:p===Ji?[]:p}function tG(p,l){const u=p.viewQuery;p.viewQuery=u?(f,g)=>{l(f,g),u(f,g)}:l}function iG(p,l){const u=p.contentQueries;p.contentQueries=u?(f,g,m)=>{l(f,g,m),u(f,g,m)}:l}function nG(p,l){const u=p.hostBindings;p.hostBindings=u?(f,g)=>{l(f,g),u(f,g)}:l}let zv=null;function Fu(){if(!zv){const p=Wi.Symbol;if(p&&p.iterator)zv=p.iterator;else{const l=Object.getOwnPropertyNames(Map.prototype);for(let u=0;u<l.length;++u){const f=l[u];"entries"!==f&&"size"!==f&&Map.prototype[f]===Map.prototype.entries&&(zv=f)}}}return zv}function yg(p){return!!function ub(p){return null!==p&&("function"==typeof p||"object"==typeof p)}(p)&&(Array.isArray(p)||!(p instanceof Map)&&Fu()in p)}function Xs(p,l,u){return!Object.is(p[l],u)&&(p[l]=u,!0)}function Ya(p,l,u,f){const g=Ne();return Xs(g,yu(),l)&&(Ai(),za(Nn(),g,p,l,u,f)),Ya}function Zr(p,l,u,f,g,m,v,y){const x=Ne(),w=Ai(),C=p+20,_=w.firstCreatePass?function hG(p,l,u,f,g,m,v,y,x){const w=l.consts,C=Ru(l,p,4,v||null,Nc(w,y));QC(l,u,C,Nc(w,x)),yv(l,C);const _=C.tViews=Hv(2,C,f,g,m,l.directiveRegistry,l.pipeRegistry,null,l.schemas,w);return null!==l.queries&&(l.queries.template(l,C),_.queries=l.queries.embeddedTView(C)),C}(C,w,x,l,u,f,g,m,v):w.data[C];ja(_,!1);const T=x[11].createComment("");Nv(w,x,T,_),Ys(T,x),Wv(x,x[C]=a5(T,x,T,_)),fv(_)&&ZC(w,x,_),null!=v&&JC(x,_,y)}function je(p,l=Pt.Default){const u=Ne();return null===u?It(p,l):PA(ps(),u,Qt(p),l)}function vb(){throw new Error("invalid")}function Qi(p,l,u){const f=Ne();return Xs(f,yu(),l)&&function qr(p,l,u,f,g,m,v,y){const x=Ao(l,u);let C,w=l.inputs;!y&&null!=w&&(C=w[f])?(f5(p,u,C,f,g),uv(l)&&function gW(p,l){const u=$r(l,p);16&u[2]||(u[2]|=64)}(u,l.index)):3&l.type&&(f=function pW(p){return"class"===p?"className":"for"===p?"htmlFor":"formaction"===p?"formAction":"innerHtml"===p?"innerHTML":"readonly"===p?"readOnly":"tabindex"===p?"tabIndex":p}(f),g=null!=v?v(g,l.value||"",f):g,Fn(m)?m.setProperty(x,f,g):nC(f)||(x.setProperty?x.setProperty(f,g):x[f]=g))}(Ai(),Nn(),f,p,l,f[11],u,!1),Qi}function yb(p,l,u,f,g){const v=g?"class":"style";f5(p,u,l.inputs[v],v,f)}function xt(p,l,u,f){const g=Ne(),m=Ai(),v=20+p,y=g[11],x=g[v]=RC(y,l,function WV(){return Bt.lFrame.currentNamespace}()),w=m.firstCreatePass?function MG(p,l,u,f,g,m,v){const y=l.consts,w=Ru(l,p,2,g,Nc(y,m));return QC(l,u,w,Nc(y,v)),null!==w.attrs&&Gv(w,w.attrs,!1),null!==w.mergedAttrs&&Gv(w,w.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,w),w}(v,m,g,0,l,u,f):m.data[v];ja(w,!0);const C=w.mergedAttrs;null!==C&&Cv(y,x,C);const _=w.classes;null!==_&&NC(y,x,_);const T=w.styles;return null!==T&&PI(y,x,T),64!=(64&w.flags)&&Nv(m,g,x,w),0===function TV(){return Bt.lFrame.elementDepthCount}()&&Ys(x,g),function DV(){Bt.lFrame.elementDepthCount++}(),fv(w)&&(ZC(m,g,w),function qI(p,l,u){if(Vw(l)){const g=l.directiveEnd;for(let m=l.directiveStart;m<g;m++){const v=p.data[m];v.contentQueries&&v.contentQueries(1,u[m],m)}}}(m,w,g)),null!==f&&JC(g,w),xt}function ht(){let p=ps();Zw()?function Jw(){Bt.lFrame.isParent=!1}():(p=p.parent,ja(p,!1));const l=p;!function AV(){Bt.lFrame.elementDepthCount--}();const u=Ai();return u.firstCreatePass&&(yv(u,p),Vw(p)&&u.queries.elementEnd(p)),null!=l.classesWithoutHost&&function XV(p){return 0!=(16&p.flags)}(l)&&yb(u,l,Ne(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function qV(p){return 0!=(32&p.flags)}(l)&&yb(u,l,Ne(),l.stylesWithoutHost,!1),ht}function Bn(p,l,u,f){return xt(p,l,u,f),ht(),Bn}function wg(p){return!!p&&"function"==typeof p.then}const Cb=function Q5(p){return!!p&&"function"==typeof p.subscribe};function ki(p,l,u,f){const g=Ne(),m=Ai(),v=ps();return function e4(p,l,u,f,g,m,v,y){const x=fv(f),C=p.firstCreatePass&&h5(p),_=l[8],T=c5(l);let M=!0;if(3&f.type||y){const V=Ao(f,l),H=y?y(V):V,G=T.length,z=y?q=>y(es(q[f.index])):f.index;if(Fn(u)){let q=null;if(!y&&x&&(q=function LG(p,l,u,f){const g=p.cleanup;if(null!=g)for(let m=0;m<g.length-1;m+=2){const v=g[m];if(v===u&&g[m+1]===f){const y=l[7],x=g[m+2];return y.length>x?y[x]:null}"string"==typeof v&&(m+=2)}return null}(p,l,g,f.index)),null!==q)(q.__ngLastListenerFn__||q).__ngNextListenerFn__=m,q.__ngLastListenerFn__=m,M=!1;else{m=bb(f,l,_,m,!1);const te=u.listen(H,g,m);T.push(m,te),C&&C.push(g,z,G,G+1)}}else m=bb(f,l,_,m,!0),H.addEventListener(g,m,v),T.push(m),C&&C.push(g,z,G,v)}else m=bb(f,l,_,m,!1);const L=f.outputs;let N;if(M&&null!==L&&(N=L[g])){const V=N.length;if(V)for(let H=0;H<V;H+=2){const se=l[N[H]][N[H+1]].subscribe(m),ae=T.length;T.push(m,se),C&&C.push(g,f.index,ae,-(ae+1))}}}(m,g,g[11],v,p,l,!!u,f),ki}function t4(p,l,u,f){try{return!1!==u(f)}catch(g){return u5(p,g),!1}}function bb(p,l,u,f,g){return function m(v){if(v===Function)return f;const y=2&p.flags?$r(p.index,l):l;0==(32&l[2])&&tb(y);let x=t4(l,0,f,v),w=m.__ngNextListenerFn__;for(;w;)x=t4(l,0,w,v)&&x,w=w.__ngNextListenerFn__;return g&&!1===x&&(v.preventDefault(),v.returnValue=!1),x}}function Xa(p=1){return function NV(p){return(Bt.lFrame.contextLView=function BV(p,l){for(;p>0;)l=l[15],p--;return l}(p,Bt.lFrame.contextLView))[8]}(p)}function d4(p,l,u,f,g){const m=p[u+1],v=null===l;let y=f?aa(m):Nl(m),x=!1;for(;0!==y&&(!1===x||v);){const C=p[y+1];jG(p[y],l)&&(x=!0,p[y+1]=f?VC(C):BC(C)),y=f?aa(C):Nl(C)}x&&(p[u+1]=f?BC(m):VC(m))}function jG(p,l){return null===p||null==l||(Array.isArray(p)?p[1]:p)===l||!(!Array.isArray(p)||"string"!=typeof l)&&Tu(p,l)>=0}function Xv(p,l){return function ca(p,l,u,f){const g=Ne(),m=Ai(),v=function Fl(p){const l=Bt.lFrame,u=l.bindingIndex;return l.bindingIndex=l.bindingIndex+p,u}(2);m.firstUpdatePass&&function w4(p,l,u,f){const g=p.data;if(null===g[u+1]){const m=g[cr()],v=function x4(p,l){return l>=p.expandoStartIndex}(p,u);(function S4(p,l){return 0!=(p.flags&(l?16:32))})(m,f)&&null===l&&!v&&(l=!1),l=function ZG(p,l,u,f){const g=function Kw(p){const l=Bt.lFrame.currentDirectiveIndex;return-1===l?null:p[l]}(p);let m=f?l.residualClasses:l.residualStyles;if(null===g)0===(f?l.classBindings:l.styleBindings)&&(u=Cg(u=Sb(null,p,l,u,f),l.attrs,f),m=null);else{const v=l.directiveStylingLast;if(-1===v||p[v]!==g)if(u=Sb(g,p,l,u,f),null===m){let x=function JG(p,l,u){const f=u?l.classBindings:l.styleBindings;if(0!==Nl(f))return p[aa(f)]}(p,l,f);void 0!==x&&Array.isArray(x)&&(x=Sb(null,p,l,x[1],f),x=Cg(x,l.attrs,f),function QG(p,l,u,f){p[aa(u?l.classBindings:l.styleBindings)]=f}(p,l,f,x))}else m=function KG(p,l,u){let f;const g=l.directiveEnd;for(let m=1+l.directiveStylingLast;m<g;m++)f=Cg(f,p[m].hostAttrs,u);return Cg(f,l.attrs,u)}(p,l,f)}return void 0!==m&&(f?l.residualClasses=m:l.residualStyles=m),u}(g,m,l,f),function UG(p,l,u,f,g,m){let v=m?l.classBindings:l.styleBindings,y=aa(v),x=Nl(v);p[f]=u;let C,w=!1;if(Array.isArray(u)){const _=u;C=_[1],(null===C||Tu(_,C)>0)&&(w=!0)}else C=u;if(g)if(0!==x){const T=aa(p[y+1]);p[f+1]=Uv(T,y),0!==T&&(p[T+1]=UC(p[T+1],f)),p[y+1]=function JH(p,l){return 131071&p|l<<17}(p[y+1],f)}else p[f+1]=Uv(y,0),0!==y&&(p[y+1]=UC(p[y+1],f)),y=f;else p[f+1]=Uv(x,0),0===y?y=f:p[x+1]=UC(p[x+1],f),x=f;w&&(p[f+1]=BC(p[f+1])),d4(p,C,f,!0),d4(p,C,f,!1),function VG(p,l,u,f,g){const m=g?p.residualClasses:p.residualStyles;null!=m&&"string"==typeof l&&Tu(m,l)>=0&&(u[f+1]=VC(u[f+1]))}(l,C,p,f,m),v=Uv(y,x),m?l.classBindings=v:l.styleBindings=v}(g,m,l,u,v,f)}}(m,p,v,f),l!==Ut&&Xs(g,v,l)&&function b4(p,l,u,f,g,m,v,y){if(!(3&l.type))return;const x=p.data,w=x[y+1];qv(function UI(p){return 1==(1&p)}(w)?_4(x,l,u,g,Nl(w),v):void 0)||(qv(m)||function BI(p){return 2==(2&p)}(w)&&(m=_4(x,null,u,g,y,v)),function UH(p,l,u,f,g){const m=Fn(p);if(l)g?m?p.addClass(u,f):u.classList.add(f):m?p.removeClass(u,f):u.classList.remove(f);else{let v=-1===f.indexOf("-")?void 0:Xr.DashCase;if(null==g)m?p.removeStyle(u,f,v):u.style.removeProperty(f);else{const y="string"==typeof g&&g.endsWith("!important");y&&(g=g.slice(0,-10),v|=Xr.Important),m?p.setStyle(u,f,g,v):u.style.setProperty(f,g,y?"important":"")}}}(f,v,pv(cr(),u),g,m))}(m,m.data[cr()],g,g[11],p,g[v+1]=function iz(p,l){return null==p||("string"==typeof l?p+=l:"object"==typeof p&&(p=Bi(jc(p)))),p}(l,u),f,v)}(p,l,null,!0),Xv}function Sb(p,l,u,f,g){let m=null;const v=u.directiveEnd;let y=u.directiveStylingLast;for(-1===y?y=u.directiveStart:y++;y<v&&(m=l[y],f=Cg(f,m.hostAttrs,g),m!==p);)y++;return null!==p&&(u.directiveStylingLast=y),f}function Cg(p,l,u){const f=u?1:2;let g=-1;if(null!==l)for(let m=0;m<l.length;m++){const v=l[m];"number"==typeof v?g=v:g===f&&(Array.isArray(p)||(p=void 0===p?[]:["",p]),Yr(p,v,!!u||l[++m]))}return void 0===p?null:p}function _4(p,l,u,f,g,m){const v=null===l;let y;for(;g>0;){const x=p[g],w=Array.isArray(x),C=w?x[1]:x,_=null===C;let T=u[g+1];T===Ut&&(T=_?Ji:void 0);let M=_?hC(T,f):C===f?T:void 0;if(w&&!qv(M)&&(M=hC(x,f)),qv(M)&&(y=M,v))return y;const L=p[g+1];g=v?aa(L):Nl(L)}if(null!==l){let x=m?l.residualClasses:l.residualStyles;null!=x&&(y=hC(x,f))}return y}function qv(p){return void 0!==p}function Vi(p,l=""){const u=Ne(),f=Ai(),g=p+20,m=f.firstCreatePass?Ru(f,g,1,l,null):f.data[g],v=u[g]=function PC(p,l){return Fn(p)?p.createText(l):p.createTextNode(l)}(u[11],l);Nv(f,u,v,m),ja(m,!1)}function da(p,l,u){const f=Ne(),g=function Bu(p,l,u,f){return Xs(p,yu(),u)?l+Nt(u)+f:Ut}(f,p,l,u);return g!==Ut&&Bl(f,cr(),g),da}const Zv="en-US";let Y4=Zv;function Db(p,l,u,f,g){if(p=Qt(p),Array.isArray(p))for(let m=0;m<p.length;m++)Db(p[m],l,u,f,g);else{const m=Ai(),v=Ne();let y=Lu(p)?p:Qt(p.provide),x=y5(p);const w=ps(),C=1048575&w.providerIndexes,_=w.directiveStart,T=w.providerIndexes>>20;if(Lu(p)||!p.multi){const M=new qp(x,g,je),L=Ib(y,l,g?C:C+T,_);-1===L?(Ev(Jp(w,v),m,y),Ab(m,p,l.length),l.push(y),w.directiveStart++,w.directiveEnd++,g&&(w.providerIndexes+=1048576),u.push(M),v.push(M)):(u[L]=M,v[L]=M)}else{const M=Ib(y,l,C+T,_),L=Ib(y,l,C,C+T),N=M>=0&&u[M],V=L>=0&&u[L];if(g&&!V||!g&&!N){Ev(Jp(w,v),m,y);const H=function C$(p,l,u,f,g){const m=new qp(p,u,je);return m.multi=[],m.index=l,m.componentProviders=0,vP(m,g,f&&!u),m}(g?w$:x$,u.length,g,f,x);!g&&V&&(u[L].providerFactory=H),Ab(m,p,l.length,0),l.push(y),w.directiveStart++,w.directiveEnd++,g&&(w.providerIndexes+=1048576),u.push(H),v.push(H)}else Ab(m,p,M>-1?M:L,vP(u[g?L:M],x,!g&&f));!g&&f&&V&&u[L].componentProviders++}}}function Ab(p,l,u,f){const g=Lu(l),m=function HW(p){return!!p.useClass}(l);if(g||m){const x=(m?Qt(l.useClass):l).prototype.ngOnDestroy;if(x){const w=p.destroyHooks||(p.destroyHooks=[]);if(!g&&l.multi){const C=w.indexOf(u);-1===C?w.push(u,[f,x]):w[C+1].push(f,x)}else w.push(u,x)}}}function vP(p,l,u){return u&&p.componentProviders++,p.multi.push(l)-1}function Ib(p,l,u,f){for(let g=u;g<f;g++)if(l[g]===p)return g;return-1}function x$(p,l,u,f){return Pb(this.multi,[])}function w$(p,l,u,f){const g=this.multi;let m;if(this.providerFactory){const v=this.providerFactory.componentProviders,y=Qp(u,u[1],this.providerFactory.index,f);m=y.slice(0,v),Pb(g,m);for(let x=v;x<y.length;x++)m.push(y[x])}else m=[],Pb(g,m);return m}function Pb(p,l){for(let u=0;u<p.length;u++)l.push((0,p[u])());return l}function Cn(p,l=[]){return u=>{u.providersResolver=(f,g)=>function y$(p,l,u){const f=Ai();if(f.firstCreatePass){const g=ra(p);Db(u,f.data,f.blueprint,g,!0),Db(l,f.data,f.blueprint,g,!1)}}(f,g?g(p):p,l)}}class yP{}class S${resolveComponentFactory(l){throw function _$(p){const l=Error(`No component factory found for ${Bi(p)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=p,l}(l)}}let Tg=(()=>{class p{}return p.NULL=new S$,p})();function E$(){return Zu(ps(),Ne())}function Zu(p,l){return new Jr(Ao(p,l))}let Jr=(()=>{class p{constructor(u){this.nativeElement=u}}return p.__NG_ELEMENT_ID__=E$,p})();class wP{}let Ul=(()=>{class p{}return p.__NG_ELEMENT_ID__=()=>function A$(){const p=Ne(),u=$r(ps().index,p);return function D$(p){return p[11]}(Va(u)?u:p)}(),p})(),I$=(()=>{class p{}return p.\u0275prov=wi({token:p,providedIn:"root",factory:()=>null}),p})();class Dg{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const P$=new Dg("13.3.10"),Rb={};function ty(p,l,u,f,g=!1){for(;null!==u;){const m=l[u.index];if(null!==m&&f.push(es(m)),sa(m))for(let y=10;y<m.length;y++){const x=m[y],w=x[1].firstChild;null!==w&&ty(x[1],x,w,f)}const v=u.type;if(8&v)ty(p,l,u.child,f);else if(32&v){const y=DC(u,l);let x;for(;x=y();)f.push(x)}else if(16&v){const y=DI(l,u);if(Array.isArray(y))f.push(...y);else{const x=fg(l[16]);ty(x[1],x,y,f,!0)}}u=g?u.projectionNext:u.next}return f}class Ag{constructor(l,u){this._lView=l,this._cdRefInjectingView=u,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const l=this._lView,u=l[1];return ty(u,l,u.firstChild,[])}get context(){return this._lView[8]}set context(l){this._lView[8]=l}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[3];if(sa(l)){const u=l[8],f=u?u.indexOf(this):-1;f>-1&&(MC(l,f),Dv(u,f))}this._attachedToViewContainer=!1}yI(this._lView[1],this._lView)}onDestroy(l){!function KI(p,l,u,f){const g=c5(l);null===u?g.push(f):(g.push(u),p.firstCreatePass&&h5(p).push(f,g.length-1))}(this._lView[1],this._lView,null,l)}markForCheck(){tb(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function nb(p,l,u){const f=l[10];f.begin&&f.begin();try{ku(p,l,p.template,u)}catch(g){throw u5(l,g),g}finally{f.end&&f.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Di(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function IH(p,l){pg(p,l,l[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new Di(902,"");this._appRef=l}}class R$ extends Ag{constructor(l){super(l),this._view=l}detectChanges(){l5(this._view)}checkNoChanges(){}get context(){return null}}class CP extends Tg{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const u=Gs(l);return new Mb(u,this.ngModule)}}function bP(p){const l=[];for(let u in p)p.hasOwnProperty(u)&&l.push({propName:p[u],templateName:u});return l}class Mb extends yP{constructor(l,u){super(),this.componentDef=l,this.ngModule=u,this.componentType=l.type,this.selector=function qH(p){return p.map(XH).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!u}get inputs(){return bP(this.componentDef.inputs)}get outputs(){return bP(this.componentDef.outputs)}create(l,u,f,g){const m=(g=g||this.ngModule)?function k$(p,l){return{get:(u,f,g)=>{const m=p.get(u,Rb,g);return m!==Rb||f===Rb?m:l.get(u,f,g)}}}(l,g.injector):l,v=m.get(wP,lA),y=m.get(I$,null),x=v.createRenderer(null,this.componentDef),w=this.componentDef.selectors[0][0]||"div",C=f?function QI(p,l,u){if(Fn(p))return p.selectRootElement(l,u===Ba.ShadowDom);let f="string"==typeof l?p.querySelector(l):l;return f.textContent="",f}(x,f,this.componentDef.encapsulation):RC(v.createRenderer(null,this.componentDef),w,function M$(p){const l=p.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(w)),_=this.componentDef.onPush?576:528,T=function P5(p,l){return{components:[],scheduler:p||CH,clean:kW,playerHandler:l||null,flags:0}}(),M=Hv(0,null,null,1,0,null,null,null,null,null),L=gg(null,M,T,_,null,null,v,x,y,m);let N,V;mv(L);try{const H=function A5(p,l,u,f,g,m){const v=u[1];u[20]=p;const x=Ru(v,20,2,"#host",null),w=x.mergedAttrs=l.hostAttrs;null!==w&&(Gv(x,w,!0),null!==p&&(Cv(g,p,w),null!==x.classes&&NC(g,p,x.classes),null!==x.styles&&PI(g,p,x.styles)));const C=f.createRenderer(p,l),_=gg(u,ZI(l),null,l.onPush?64:16,u[20],x,f,C,m||null,null);return v.firstCreatePass&&(Ev(Jp(x,u),v,l.type),s5(v,x),r5(x,u.length,1)),Wv(u,_),u[20]=_}(C,this.componentDef,L,v,x);if(C)if(f)Cv(x,C,["ng-version",P$.full]);else{const{attrs:G,classes:z}=function ZH(p){const l=[],u=[];let f=1,g=2;for(;f<p.length;){let m=p[f];if("string"==typeof m)2===g?""!==m&&l.push(m,p[++f]):8===g&&u.push(m);else{if(!oa(g))break;g=m}f++}return{attrs:l,classes:u}}(this.componentDef.selectors[0]);G&&Cv(x,C,G),z&&z.length>0&&NC(x,C,z.join(" "))}if(V=Yw(M,20),void 0!==u){const G=V.projection=[];for(let z=0;z<this.ngContentSelectors.length;z++){const q=u[z];G.push(null!=q?Array.from(q):null)}}N=function I5(p,l,u,f,g){const m=u[1],v=function vW(p,l,u){const f=ps();p.firstCreatePass&&(u.providersResolver&&u.providersResolver(u),o5(p,f,l,Mu(p,l,1,null),u));const g=Qp(l,p,f.directiveStart,f);Ys(g,l);const m=Ao(f,l);return m&&Ys(m,l),g}(m,u,l);if(f.components.push(v),p[8]=v,g&&g.forEach(x=>x(v,l)),l.contentQueries){const x=ps();l.contentQueries(1,v,x.directiveStart)}const y=ps();return!m.firstCreatePass||null===l.hostBindings&&null===l.hostAttrs||(Bc(y.index),i5(u[1],y,0,y.directiveStart,y.directiveEnd,l),n5(l,v)),v}(H,this.componentDef,L,T,[KW]),mg(M,L,null)}finally{vv()}return new L$(this.componentType,N,Zu(V,L),L,V)}}class L$ extends class b${}{constructor(l,u,f,g,m){super(),this.location=f,this._rootLView=g,this._tNode=m,this.instance=u,this.hostView=this.changeDetectorRef=new R$(g),this.componentType=l}get injector(){return new Cu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}class Vl{}class _P{}const Ju=new Map;class TP extends Vl{constructor(l,u){super(),this._parent=u,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new CP(this);const f=So(l);this._bootstrapComponents=Ga(f.bootstrap),this._r3Injector=v5(l,u,[{provide:Vl,useValue:this},{provide:Tg,useValue:this.componentFactoryResolver}],Bi(l)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(l)}get(l,u=Ar.THROW_IF_NOT_FOUND,f=Pt.Default){return l===Ar||l===Vl||l===rb?this:this._r3Injector.get(l,u,f)}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(u=>u()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class kb extends _P{constructor(l){super(),this.moduleType=l,null!==So(l)&&function N$(p){const l=new Set;!function u(f){const g=So(f,!0),m=g.id;null!==m&&(function SP(p,l,u){if(l&&l!==u)throw new Error(`Duplicate module registered for ${p} - ${Bi(l)} vs ${Bi(l.name)}`)}(m,Ju.get(m),f),Ju.set(m,f));const v=Ga(g.imports);for(const y of v)l.has(y)||(l.add(y),u(y))}(p)}(l)}create(l){return new TP(this.moduleType,l)}}function jl(p,l,u){const f=function lr(){const p=Bt.lFrame;let l=p.bindingRootIndex;return-1===l&&(l=p.bindingRootIndex=p.tView.bindingStartIndex),l}()+p,g=Ne();return g[f]===Ut?function $a(p,l,u){return p[l]=u}(g,f,u?l.call(u):l()):function xg(p,l){return p[l]}(g,f)}function Ob(p){return l=>{setTimeout(p,void 0,l)}}const Vn=class eY extends Pl{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,u,f){var g,m,v;let y=l,x=u||(()=>null),w=f;if(l&&"object"==typeof l){const _=l;y=null===(g=_.next)||void 0===g?void 0:g.bind(_),x=null===(m=_.error)||void 0===m?void 0:m.bind(_),w=null===(v=_.complete)||void 0===v?void 0:v.bind(_)}this.__isAsync&&(x=Ob(x),y&&(y=Ob(y)),w&&(w=Ob(w)));const C=super.subscribe({next:y,error:x,complete:w});return l instanceof _o&&l.add(C),C}};Symbol;let Hl=(()=>{class p{}return p.__NG_ELEMENT_ID__=sY,p})();const iY=Hl,nY=class extends iY{constructor(l,u,f){super(),this._declarationLView=l,this._declarationTContainer=u,this.elementRef=f}createEmbeddedView(l){const u=this._declarationTContainer.tViews,f=gg(this._declarationLView,u,l,16,null,u.declTNode,null,null,null,null);f[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(f[19]=m.createEmbeddedView(u)),mg(u,f,l),new Ag(f)}};function sY(){return function iy(p,l){return 4&p.type?new nY(l,p,Zu(p,l)):null}(ps(),Ne())}let ua=(()=>{class p{}return p.__NG_ELEMENT_ID__=rY,p})();function rY(){return function OP(p,l){let u;const f=l[p.index];if(sa(f))u=f;else{let g;if(8&p.type)g=es(f);else{const m=l[11];g=m.createComment("");const v=Ao(p,l);Zh(m,Fv(m,v),g,function FH(p,l){return Fn(p)?p.nextSibling(l):l.nextSibling}(m,v),!1)}l[p.index]=u=a5(f,l,g,p),Wv(l,u)}return new MP(u,p,l)}(ps(),Ne())}const oY=ua,MP=class extends oY{constructor(l,u,f){super(),this._lContainer=l,this._hostTNode=u,this._hostLView=f}get element(){return Zu(this._hostTNode,this._hostLView)}get injector(){return new Cu(this._hostTNode,this._hostLView)}get parentInjector(){const l=Sv(this._hostTNode,this._hostLView);if(EA(l)){const u=wu(l,this._hostLView),f=xu(l);return new Cu(u[1].data[f+8],u)}return new Cu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const u=kP(this._lContainer);return null!==u&&u[l]||null}get length(){return this._lContainer.length-10}createEmbeddedView(l,u,f){const g=l.createEmbeddedView(u||{});return this.insert(g,f),g}createComponent(l,u,f,g,m){const v=l&&!function tg(p){return"function"==typeof p}(l);let y;if(v)y=u;else{const _=u||{};y=_.index,f=_.injector,g=_.projectableNodes,m=_.ngModuleRef}const x=v?l:new Mb(Gs(l)),w=f||this.parentInjector;if(!m&&null==x.ngModule){const T=(v?w:this.parentInjector).get(Vl,null);T&&(m=T)}const C=x.create(w,g,void 0,m);return this.insert(C.hostView,y),C}insert(l,u){const f=l._lView,g=f[1];if(function EV(p){return sa(p[3])}(f)){const C=this.indexOf(l);if(-1!==C)this.detach(C);else{const _=f[3],T=new MP(_,_[6],_[3]);T.detach(T.indexOf(l))}}const m=this._adjustIndex(u),v=this._lContainer;!function RH(p,l,u,f){const g=10+f,m=u.length;f>0&&(u[g-1][4]=l),f<m-10?(l[4]=u[g],LA(u,10+f,l)):(u.push(l),l[4]=null),l[3]=u;const v=l[17];null!==v&&u!==v&&function MH(p,l){const u=p[9];l[16]!==l[3][3][16]&&(p[2]=!0),null===u?p[9]=[l]:u.push(l)}(v,l);const y=l[19];null!==y&&y.insertView(p),l[2]|=128}(g,f,v,m);const y=LC(m,v),x=f[11],w=Fv(x,v[7]);return null!==w&&function AH(p,l,u,f,g,m){f[0]=g,f[6]=l,pg(p,f,u,1,g,m)}(g,v[6],x,f,w,y),l.attachToViewContainerRef(),LA(Fb(v),m,l),l}move(l,u){return this.insert(l,u)}indexOf(l){const u=kP(this._lContainer);return null!==u?u.indexOf(l):-1}remove(l){const u=this._adjustIndex(l,-1),f=MC(this._lContainer,u);f&&(Dv(Fb(this._lContainer),u),yI(f[1],f))}detach(l){const u=this._adjustIndex(l,-1),f=MC(this._lContainer,u);return f&&null!=Dv(Fb(this._lContainer),u)?new Ag(f):null}_adjustIndex(l,u=0){return null==l?this.length+u:l}};function kP(p){return p[8]}function Fb(p){return p[8]||(p[8]=[])}function ry(...p){}const Zb=new oi("Application Initializer");let Jb=(()=>{class p{constructor(u){this.appInits=u,this.resolve=ry,this.reject=ry,this.initialized=!1,this.done=!1,this.donePromise=new Promise((f,g)=>{this.resolve=f,this.reject=g})}runInitializers(){if(this.initialized)return;const u=[],f=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const m=this.appInits[g]();if(wg(m))u.push(m);else if(Cb(m)){const v=new Promise((y,x)=>{m.subscribe({complete:y,error:x})});u.push(v)}}Promise.all(u).then(()=>{f()}).catch(g=>{this.reject(g)}),0===u.length&&f(),this.initialized=!0}}return p.\u0275fac=function(u){return new(u||p)(It(Zb,8))},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const Mg=new oi("AppId",{providedIn:"root",factory:function i8(){return`${Qb()}${Qb()}${Qb()}`}});function Qb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const n8=new oi("Platform Initializer"),s8=new oi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),r8=new oi("appBootstrapListener");let kY=(()=>{class p{log(u){console.log(u)}warn(u){console.warn(u)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();const Gc=new oi("LocaleId",{providedIn:"root",factory:()=>yj(Gc,Pt.Optional|Pt.SkipSelf)||function OY(){return"undefined"!=typeof $localize&&$localize.locale||Zv}()});class FY{constructor(l,u){this.ngModuleFactory=l,this.componentFactories=u}}let o8=(()=>{class p{compileModuleSync(u){return new kb(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){const f=this.compileModuleSync(u),m=Ga(So(u).declarations).reduce((v,y)=>{const x=Gs(y);return x&&v.push(new Mb(x)),v},[]);return new FY(f,m)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const BY=(()=>Promise.resolve(0))();function Kb(p){"undefined"==typeof Zone?BY.then(()=>{p&&p.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",p)}class As{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:u=!1,shouldCoalesceRunChangeDetection:f=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Vn(!1),this.onMicrotaskEmpty=new Vn(!1),this.onStable=new Vn(!1),this.onError=new Vn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!f&&u,g.shouldCoalesceRunChangeDetection=f,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function UY(){let p=Wi.requestAnimationFrame,l=Wi.cancelAnimationFrame;if("undefined"!=typeof Zone&&p&&l){const u=p[Zone.__symbol__("OriginalDelegate")];u&&(p=u);const f=l[Zone.__symbol__("OriginalDelegate")];f&&(l=f)}return{nativeRequestAnimationFrame:p,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function HY(p){const l=()=>{!function jY(p){p.isCheckStableRunning||-1!==p.lastRequestAnimationFrameId||(p.lastRequestAnimationFrameId=p.nativeRequestAnimationFrame.call(Wi,()=>{p.fakeTopEventTask||(p.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{p.lastRequestAnimationFrameId=-1,t2(p),p.isCheckStableRunning=!0,e2(p),p.isCheckStableRunning=!1},void 0,()=>{},()=>{})),p.fakeTopEventTask.invoke()}),t2(p))}(p)};p._inner=p._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(u,f,g,m,v,y)=>{try{return a8(p),u.invokeTask(g,m,v,y)}finally{(p.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||p.shouldCoalesceRunChangeDetection)&&l(),l8(p)}},onInvoke:(u,f,g,m,v,y,x)=>{try{return a8(p),u.invoke(g,m,v,y,x)}finally{p.shouldCoalesceRunChangeDetection&&l(),l8(p)}},onHasTask:(u,f,g,m)=>{u.hasTask(g,m),f===g&&("microTask"==m.change?(p._hasPendingMicrotasks=m.microTask,t2(p),e2(p)):"macroTask"==m.change&&(p.hasPendingMacrotasks=m.macroTask))},onHandleError:(u,f,g,m)=>(u.handleError(g,m),p.runOutsideAngular(()=>p.onError.emit(m)),!1)})}(g)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!As.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(As.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(l,u,f){return this._inner.run(l,u,f)}runTask(l,u,f,g){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+g,l,VY,ry,ry);try{return m.runTask(v,u,f)}finally{m.cancelTask(v)}}runGuarded(l,u,f){return this._inner.runGuarded(l,u,f)}runOutsideAngular(l){return this._outer.run(l)}}const VY={};function e2(p){if(0==p._nesting&&!p.hasPendingMicrotasks&&!p.isStable)try{p._nesting++,p.onMicrotaskEmpty.emit(null)}finally{if(p._nesting--,!p.hasPendingMicrotasks)try{p.runOutsideAngular(()=>p.onStable.emit(null))}finally{p.isStable=!0}}}function t2(p){p.hasPendingMicrotasks=!!(p._hasPendingMicrotasks||(p.shouldCoalesceEventChangeDetection||p.shouldCoalesceRunChangeDetection)&&-1!==p.lastRequestAnimationFrameId)}function a8(p){p._nesting++,p.isStable&&(p.isStable=!1,p.onUnstable.emit(null))}function l8(p){p._nesting--,e2(p)}class WY{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Vn,this.onMicrotaskEmpty=new Vn,this.onStable=new Vn,this.onError=new Vn}run(l,u,f){return l.apply(u,f)}runGuarded(l,u,f){return l.apply(u,f)}runOutsideAngular(l){return l()}runTask(l,u,f,g){return l.apply(u,f)}}let i2=(()=>{class p{constructor(u){this._ngZone=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),u.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{As.assertNotInAngularZone(),Kb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Kb(()=>{for(;0!==this._callbacks.length;){let u=this._callbacks.pop();clearTimeout(u.timeoutId),u.doneCb(this._didWork)}this._didWork=!1});else{let u=this.getPendingTasks();this._callbacks=this._callbacks.filter(f=>!f.updateCb||!f.updateCb(u)||(clearTimeout(f.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(u=>({source:u.source,creationLocation:u.creationLocation,data:u.data})):[]}addCallback(u,f,g){let m=-1;f&&f>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),u(this._didWork,this.getPendingTasks())},f)),this._callbacks.push({doneCb:u,timeoutId:m,updateCb:g})}whenStable(u,f,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(u,f,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(u,f,g){return[]}}return p.\u0275fac=function(u){return new(u||p)(It(As))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})(),GY=(()=>{class p{constructor(){this._applications=new Map,n2.addToWindow(this)}registerApplication(u,f){this._applications.set(u,f)}unregisterApplication(u){this._applications.delete(u)}unregisterAllApplications(){this._applications.clear()}getTestability(u){return this._applications.get(u)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(u,f=!0){return n2.findTestabilityInTree(this,u,f)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();class zY{addToWindow(l){}findTestabilityInTree(l,u,f){return null}}let n2=new zY,Kh=null;const c8=new oi("AllowMultipleToken"),h8=new oi("PlatformOnDestroy");class d8{constructor(l,u){this.name=l,this.token=u}}function u8(p,l,u=[]){const f=`Platform: ${l}`,g=new oi(f);return(m=[])=>{let v=s2();if(!v||v.injector.get(c8,!1)){const y=[...u,...m,{provide:g,useValue:!0}];p?p(y):function qY(p){if(Kh&&!Kh.get(c8,!1))throw new Di(400,"");Kh=p;const l=p.get(f8),u=p.get(n8,null);u&&u.forEach(f=>f())}(function JY(p=[],l){return Ar.create({name:l,providers:[{provide:ob,useValue:"platform"},{provide:h8,useValue:()=>Kh=null},...p]})}(y,f))}return function ZY(p){const l=s2();if(!l)throw new Di(401,"");return l}()}}function s2(){var p;return null!==(p=null==Kh?void 0:Kh.get(f8))&&void 0!==p?p:null}let f8=(()=>{class p{constructor(u){this._injector=u,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(u,f){const y=function QY(p,l){let u;return u="noop"===p?new WY:("zone.js"===p?void 0:p)||new As({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==l?void 0:l.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==l?void 0:l.ngZoneRunCoalescing)}),u}(f?f.ngZone:void 0,{ngZoneEventCoalescing:f&&f.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:f&&f.ngZoneRunCoalescing||!1}),x=[{provide:As,useValue:y}];return y.run(()=>{const w=Ar.create({providers:x,parent:this.injector,name:u.moduleType.name}),C=u.create(w),_=C.injector.get(ug,null);if(!_)throw new Di(402,"");return y.runOutsideAngular(()=>{const T=y.onError.subscribe({next:M=>{_.handleError(M)}});C.onDestroy(()=>{o2(this._modules,C),T.unsubscribe()})}),function KY(p,l,u){try{const f=u();return wg(f)?f.catch(g=>{throw l.runOutsideAngular(()=>p.handleError(g)),g}):f}catch(f){throw l.runOutsideAngular(()=>p.handleError(f)),f}}(_,y,()=>{const T=C.injector.get(Jb);return T.runInitializers(),T.donePromise.then(()=>(function Dz(p){Wr(p,"Expected localeId to be defined"),"string"==typeof p&&(Y4=p.toLowerCase().replace(/_/g,"-"))}(C.injector.get(Gc,Zv)||Zv),this._moduleDoBootstrap(C),C))})})}bootstrapModule(u,f=[]){const g=p8({},f);return function YY(p,l,u){const f=new kb(u);return Promise.resolve(f)}(0,0,u).then(m=>this.bootstrapModuleFactory(m,g))}_moduleDoBootstrap(u){const f=u.injector.get(r2);if(u._bootstrapComponents.length>0)u._bootstrapComponents.forEach(g=>f.bootstrap(g));else{if(!u.instance.ngDoBootstrap)throw new Di(403,"");u.instance.ngDoBootstrap(f)}this._modules.push(u)}onDestroy(u){this._destroyListeners.push(u)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Di(404,"");this._modules.slice().forEach(f=>f.destroy()),this._destroyListeners.forEach(f=>f());const u=this._injector.get(h8,null);null==u||u(),this._destroyed=!0}get destroyed(){return this._destroyed}}return p.\u0275fac=function(u){return new(u||p)(It(Ar))},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();function p8(p,l){return Array.isArray(l)?l.reduce(p8,p):Object.assign(Object.assign({},p),l)}let r2=(()=>{class p{constructor(u,f,g,m){this._zone=u,this._injector=f,this._exceptionHandler=g,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Kn(x=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{x.next(this._stable),x.complete()})}),y=new Kn(x=>{let w;this._zone.runOutsideAngular(()=>{w=this._zone.onStable.subscribe(()=>{As.assertNotInAngularZone(),Kb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,x.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{As.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{x.next(!1)}))});return()=>{w.unsubscribe(),C.unsubscribe()}});this.isStable=function GU(...p){const l=Wp(p),u=function NU(p,l){return"number"==typeof Aw(p)?p.pop():l}(p,1/0),f=p;return f.length?1===f.length?Na(f[0]):Hp(u)(bs(f,l)):Ml}(v,y.pipe(function zU(p={}){const{connector:l=(()=>new Pl),resetOnError:u=!0,resetOnComplete:f=!0,resetOnRefCountZero:g=!0}=p;return m=>{let v=null,y=null,x=null,w=0,C=!1,_=!1;const T=()=>{null==y||y.unsubscribe(),y=null},M=()=>{T(),v=x=null,C=_=!1},L=()=>{const N=v;M(),null==N||N.unsubscribe()};return Ts((N,V)=>{w++,!_&&!C&&T();const H=x=null!=x?x:l();V.add(()=>{w--,0===w&&!_&&!C&&(y=Iw(L,g))}),H.subscribe(V),v||(v=new nv({next:G=>H.next(G),error:G=>{_=!0,T(),y=Iw(M,u,G),H.error(G)},complete:()=>{C=!0,T(),y=Iw(M,f),H.complete()}}),bs(N).subscribe(v))})(m)}}()))}bootstrap(u,f){if(!this._initStatus.done)throw new Di(405,"");let g;g=u instanceof yP?u:this._injector.get(Tg).resolveComponentFactory(u),this.componentTypes.push(g.componentType);const m=function XY(p){return p.isBoundToModule}(g)?void 0:this._injector.get(Vl),y=g.create(Ar.NULL,[],f||g.selector,m),x=y.location.nativeElement,w=y.injector.get(i2,null),C=w&&y.injector.get(GY);return w&&C&&C.registerApplication(x,w),y.onDestroy(()=>{this.detachView(y.hostView),o2(this.components,y),C&&C.unregisterApplication(x)}),this._loadComponent(y),y}tick(){if(this._runningTick)throw new Di(101,"");try{this._runningTick=!0;for(let u of this._views)u.detectChanges()}catch(u){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(u))}finally{this._runningTick=!1}}attachView(u){const f=u;this._views.push(f),f.attachToAppRef(this)}detachView(u){const f=u;o2(this._views,f),f.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u),this._injector.get(r8,[]).concat(this._bootstrapListeners).forEach(g=>g(u))}ngOnDestroy(){this._views.slice().forEach(u=>u.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return p.\u0275fac=function(u){return new(u||p)(It(As),It(Ar),It(ug),It(Jb))},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function o2(p,l){const u=p.indexOf(l);u>-1&&p.splice(u,1)}let m8=!0,oy=(()=>{class p{}return p.__NG_ELEMENT_ID__=iX,p})();function iX(p){return function nX(p,l,u){if(uv(p)&&!u){const f=$r(p.index,l);return new Ag(f,f)}return 47&p.type?new Ag(l[16],l):null}(ps(),Ne(),16==(16&p))}class C8{constructor(){}supports(l){return yg(l)}create(l){return new cX(l)}}const lX=(p,l)=>l;class cX{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||lX}forEachItem(l){let u;for(u=this._itHead;null!==u;u=u._next)l(u)}forEachOperation(l){let u=this._itHead,f=this._removalsHead,g=0,m=null;for(;u||f;){const v=!f||u&&u.currentIndex<_8(f,g,m)?u:f,y=_8(v,g,m),x=v.currentIndex;if(v===f)g--,f=f._nextRemoved;else if(u=u._next,null==v.previousIndex)g++;else{m||(m=[]);const w=y-g,C=x-g;if(w!=C){for(let T=0;T<w;T++){const M=T<m.length?m[T]:m[T]=0,L=M+T;C<=L&&L<w&&(m[T]=M+1)}m[v.previousIndex]=C-w}}y!==x&&l(v,y,x)}}forEachPreviousItem(l){let u;for(u=this._previousItHead;null!==u;u=u._nextPrevious)l(u)}forEachAddedItem(l){let u;for(u=this._additionsHead;null!==u;u=u._nextAdded)l(u)}forEachMovedItem(l){let u;for(u=this._movesHead;null!==u;u=u._nextMoved)l(u)}forEachRemovedItem(l){let u;for(u=this._removalsHead;null!==u;u=u._nextRemoved)l(u)}forEachIdentityChange(l){let u;for(u=this._identityChangesHead;null!==u;u=u._nextIdentityChange)l(u)}diff(l){if(null==l&&(l=[]),!yg(l))throw new Di(900,"");return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let g,m,v,u=this._itHead,f=!1;if(Array.isArray(l)){this.length=l.length;for(let y=0;y<this.length;y++)m=l[y],v=this._trackByFn(y,m),null!==u&&Object.is(u.trackById,v)?(f&&(u=this._verifyReinsertion(u,m,v,y)),Object.is(u.item,m)||this._addIdentityChange(u,m)):(u=this._mismatch(u,m,v,y),f=!0),u=u._next}else g=0,function cG(p,l){if(Array.isArray(p))for(let u=0;u<p.length;u++)l(p[u]);else{const u=p[Fu()]();let f;for(;!(f=u.next()).done;)l(f.value)}}(l,y=>{v=this._trackByFn(g,y),null!==u&&Object.is(u.trackById,v)?(f&&(u=this._verifyReinsertion(u,y,v,g)),Object.is(u.item,y)||this._addIdentityChange(u,y)):(u=this._mismatch(u,y,v,g),f=!0),u=u._next,g++}),this.length=g;return this._truncate(u),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,u,f,g){let m;return null===l?m=this._itTail:(m=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._reinsertAfter(l,m,g)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(f,g))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._moveAfter(l,m,g)):l=this._addAfter(new hX(u,f),m,g),l}_verifyReinsertion(l,u,f,g){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null);return null!==m?l=this._reinsertAfter(m,l._prev,g):l.currentIndex!=g&&(l.currentIndex=g,this._addToMoves(l,g)),l}_truncate(l){for(;null!==l;){const u=l._next;this._addToRemovals(this._unlink(l)),l=u}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,u,f){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const g=l._prevRemoved,m=l._nextRemoved;return null===g?this._removalsHead=m:g._nextRemoved=m,null===m?this._removalsTail=g:m._prevRemoved=g,this._insertAfter(l,u,f),this._addToMoves(l,f),l}_moveAfter(l,u,f){return this._unlink(l),this._insertAfter(l,u,f),this._addToMoves(l,f),l}_addAfter(l,u,f){return this._insertAfter(l,u,f),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,u,f){const g=null===u?this._itHead:u._next;return l._next=g,l._prev=u,null===g?this._itTail=l:g._prev=l,null===u?this._itHead=l:u._next=l,null===this._linkedRecords&&(this._linkedRecords=new b8),this._linkedRecords.put(l),l.currentIndex=f,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const u=l._prev,f=l._next;return null===u?this._itHead=f:u._next=f,null===f?this._itTail=u:f._prev=u,l}_addToMoves(l,u){return l.previousIndex===u||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new b8),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,u){return l.item=u,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class hX{constructor(l,u){this.item=l,this.trackById=u,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class dX{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,u){let f;for(f=this._head;null!==f;f=f._nextDup)if((null===u||u<=f.currentIndex)&&Object.is(f.trackById,l))return f;return null}remove(l){const u=l._prevDup,f=l._nextDup;return null===u?this._head=f:u._nextDup=f,null===f?this._tail=u:f._prevDup=u,null===this._head}}class b8{constructor(){this.map=new Map}put(l){const u=l.trackById;let f=this.map.get(u);f||(f=new dX,this.map.set(u,f)),f.add(l)}get(l,u){const g=this.map.get(l);return g?g.get(l,u):null}remove(l){const u=l.trackById;return this.map.get(u).remove(l)&&this.map.delete(u),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function _8(p,l,u){const f=p.previousIndex;if(null===f)return f;let g=0;return u&&f<u.length&&(g=u[f]),f+l+g}function E8(){return new cy([new C8])}let cy=(()=>{class p{constructor(u){this.factories=u}static create(u,f){if(null!=f){const g=f.factories.slice();u=u.concat(g)}return new p(u)}static extend(u){return{provide:p,useFactory:f=>p.create(u,f||E8()),deps:[[p,new og,new Vc]]}}find(u){const f=this.factories.find(g=>g.supports(u));if(null!=f)return f;throw new Di(901,"")}}return p.\u0275prov=wi({token:p,providedIn:"root",factory:E8}),p})();const mX=u8(null,"core",[]);let vX=(()=>{class p{constructor(u){}}return p.\u0275fac=function(u){return new(u||p)(It(r2))},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({}),p})(),hy=null;function Ja(){return hy}const Ro=new oi("DocumentToken");let td=(()=>{class p{historyGo(u){throw new Error("Not implemented")}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:function(){return function CX(){return It(D8)}()},providedIn:"platform"}),p})();const bX=new oi("Location Initialized");let D8=(()=>{class p extends td{constructor(u){super(),this._doc=u,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ja().getBaseHref(this._doc)}onPopState(u){const f=Ja().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",u,!1),()=>f.removeEventListener("popstate",u)}onHashChange(u){const f=Ja().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",u,!1),()=>f.removeEventListener("hashchange",u)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(u){this.location.pathname=u}pushState(u,f,g){A8()?this._history.pushState(u,f,g):this.location.hash=g}replaceState(u,f,g){A8()?this._history.replaceState(u,f,g):this.location.hash=g}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}}return p.\u0275fac=function(u){return new(u||p)(It(Ro))},p.\u0275prov=wi({token:p,factory:function(){return function _X(){return new D8(It(Ro))}()},providedIn:"platform"}),p})();function A8(){return!!window.history.pushState}function d2(p,l){if(0==p.length)return l;if(0==l.length)return p;let u=0;return p.endsWith("/")&&u++,l.startsWith("/")&&u++,2==u?p+l.substring(1):1==u?p+l:p+"/"+l}function I8(p){const l=p.match(/#|\?|$/),u=l&&l.index||p.length;return p.slice(0,u-("/"===p[u-1]?1:0))+p.slice(u)}function Wl(p){return p&&"?"!==p[0]?"?"+p:p}let Ku=(()=>{class p{historyGo(u){throw new Error("Not implemented")}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:function(){return function SX(p){const l=It(Ro).location;return new P8(It(td),l&&l.origin||"")}()},providedIn:"root"}),p})();const u2=new oi("appBaseHref");let P8=(()=>{class p extends Ku{constructor(u,f){if(super(),this._platformLocation=u,this._removeListenerFns=[],null==f&&(f=this._platformLocation.getBaseHrefFromDOM()),null==f)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=f}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return d2(this._baseHref,u)}path(u=!1){const f=this._platformLocation.pathname+Wl(this._platformLocation.search),g=this._platformLocation.hash;return g&&u?`${f}${g}`:f}pushState(u,f,g,m){const v=this.prepareExternalUrl(g+Wl(m));this._platformLocation.pushState(u,f,v)}replaceState(u,f,g,m){const v=this.prepareExternalUrl(g+Wl(m));this._platformLocation.replaceState(u,f,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,u)}}return p.\u0275fac=function(u){return new(u||p)(It(td),It(u2,8))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})(),EX=(()=>{class p extends Ku{constructor(u,f){super(),this._platformLocation=u,this._baseHref="",this._removeListenerFns=[],null!=f&&(this._baseHref=f)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}path(u=!1){let f=this._platformLocation.hash;return null==f&&(f="#"),f.length>0?f.substring(1):f}prepareExternalUrl(u){const f=d2(this._baseHref,u);return f.length>0?"#"+f:f}pushState(u,f,g,m){let v=this.prepareExternalUrl(g+Wl(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(u,f,v)}replaceState(u,f,g,m){let v=this.prepareExternalUrl(g+Wl(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(u,f,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,u)}}return p.\u0275fac=function(u){return new(u||p)(It(td),It(u2,8))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})(),f2=(()=>{class p{constructor(u,f){this._subject=new Vn,this._urlChangeListeners=[],this._platformStrategy=u;const g=this._platformStrategy.getBaseHref();this._platformLocation=f,this._baseHref=I8(R8(g)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(u=!1){return this.normalize(this._platformStrategy.path(u))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(u,f=""){return this.path()==this.normalize(u+Wl(f))}normalize(u){return p.stripTrailingSlash(function DX(p,l){return p&&l.startsWith(p)?l.substring(p.length):l}(this._baseHref,R8(u)))}prepareExternalUrl(u){return u&&"/"!==u[0]&&(u="/"+u),this._platformStrategy.prepareExternalUrl(u)}go(u,f="",g=null){this._platformStrategy.pushState(g,"",u,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+Wl(f)),g)}replaceState(u,f="",g=null){this._platformStrategy.replaceState(g,"",u,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+Wl(f)),g)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(u=0){var f,g;null===(g=(f=this._platformStrategy).historyGo)||void 0===g||g.call(f,u)}onUrlChange(u){this._urlChangeListeners.push(u),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}))}_notifyUrlChangeListeners(u="",f){this._urlChangeListeners.forEach(g=>g(u,f))}subscribe(u,f,g){return this._subject.subscribe({next:u,error:f,complete:g})}}return p.normalizeQueryParams=Wl,p.joinWithSlash=d2,p.stripTrailingSlash=I8,p.\u0275fac=function(u){return new(u||p)(It(Ku),It(td))},p.\u0275prov=wi({token:p,factory:function(){return function TX(){return new f2(It(Ku),It(td))}()},providedIn:"root"}),p})();function R8(p){return p.replace(/\/index.html$/,"")}class fq{constructor(l,u,f,g){this.$implicit=l,this.ngForOf=u,this.index=f,this.count=g}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let V8=(()=>{class p{constructor(u,f,g){this._viewContainer=u,this._template=f,this._differs=g,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(u){this._ngForOf=u,this._ngForOfDirty=!0}set ngForTrackBy(u){this._trackByFn=u}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(u){u&&(this._template=u)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const u=this._ngForOf;!this._differ&&u&&(this._differ=this._differs.find(u).create(this.ngForTrackBy))}if(this._differ){const u=this._differ.diff(this._ngForOf);u&&this._applyChanges(u)}}_applyChanges(u){const f=this._viewContainer;u.forEachOperation((g,m,v)=>{if(null==g.previousIndex)f.createEmbeddedView(this._template,new fq(g.item,this._ngForOf,-1,-1),null===v?void 0:v);else if(null==v)f.remove(null===m?void 0:m);else if(null!==m){const y=f.get(m);f.move(y,v),j8(y,g)}});for(let g=0,m=f.length;g<m;g++){const y=f.get(g).context;y.index=g,y.count=m,y.ngForOf=this._ngForOf}u.forEachIdentityChange(g=>{j8(f.get(g.currentIndex),g)})}static ngTemplateContextGuard(u,f){return!0}}return p.\u0275fac=function(u){return new(u||p)(je(ua),je(Hl),je(cy))},p.\u0275dir=At({type:p,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),p})();function j8(p,l){p.context.$implicit=l.item}let wy=(()=>{class p{constructor(u,f){this._viewContainer=u,this._context=new pq,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){H8("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){H8("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,f){return!0}}return p.\u0275fac=function(u){return new(u||p)(je(ua),je(Hl))},p.\u0275dir=At({type:p,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),p})();class pq{constructor(){this.$implicit=null,this.ngIf=null}}function H8(p,l){if(l&&!l.createEmbeddedView)throw new Error(`${p} must be a TemplateRef, but received '${Bi(l)}'.`)}let jq=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({}),p})();let zq=(()=>{class p{}return p.\u0275prov=wi({token:p,providedIn:"root",factory:()=>new $q(It(Ro),window)}),p})();class $q{constructor(l,u){this.document=l,this.window=u,this.offset=()=>[0,0]}setOffset(l){this.offset=Array.isArray(l)?()=>l:l}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(l){this.supportsScrolling()&&this.window.scrollTo(l[0],l[1])}scrollToAnchor(l){if(!this.supportsScrolling())return;const u=function Yq(p,l){const u=p.getElementById(l)||p.getElementsByName(l)[0];if(u)return u;if("function"==typeof p.createTreeWalker&&p.body&&(p.body.createShadowRoot||p.body.attachShadow)){const f=p.createTreeWalker(p.body,NodeFilter.SHOW_ELEMENT);let g=f.currentNode;for(;g;){const m=g.shadowRoot;if(m){const v=m.getElementById(l)||m.querySelector(`[name="${l}"]`);if(v)return v}g=f.nextNode()}}return null}(this.document,l);u&&(this.scrollToElement(u),u.focus())}setHistoryScrollRestoration(l){if(this.supportScrollRestoration()){const u=this.window.history;u&&u.scrollRestoration&&(u.scrollRestoration=l)}}scrollToElement(l){const u=l.getBoundingClientRect(),f=u.left+this.window.pageXOffset,g=u.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(f-m[0],g-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const l=$8(this.window.history)||$8(Object.getPrototypeOf(this.window.history));return!(!l||!l.writable&&!l.set)}catch(l){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(l){return!1}}}function $8(p){return Object.getOwnPropertyDescriptor(p,"scrollRestoration")}class D2 extends class qq extends class wX{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function xX(p){hy||(hy=p)}(new D2)}onAndCancel(l,u,f){return l.addEventListener(u,f,!1),()=>{l.removeEventListener(u,f,!1)}}dispatchEvent(l,u){l.dispatchEvent(u)}remove(l){l.parentNode&&l.parentNode.removeChild(l)}createElement(l,u){return(u=u||this.getDefaultDocument()).createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,u){return"window"===u?window:"document"===u?l:"body"===u?l.body:null}getBaseHref(l){const u=function Zq(){return Fg=Fg||document.querySelector("base"),Fg?Fg.getAttribute("href"):null}();return null==u?null:function Jq(p){Cy=Cy||document.createElement("a"),Cy.setAttribute("href",p);const l=Cy.pathname;return"/"===l.charAt(0)?l:`/${l}`}(u)}resetBaseElement(){Fg=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return function hq(p,l){l=encodeURIComponent(l);for(const u of p.split(";")){const f=u.indexOf("="),[g,m]=-1==f?[u,""]:[u.slice(0,f),u.slice(f+1)];if(g.trim()===l)return decodeURIComponent(m)}return null}(document.cookie,l)}}let Cy,Fg=null;const Y8=new oi("TRANSITION_ID"),Kq=[{provide:Zb,useFactory:function Qq(p,l,u){return()=>{u.get(Jb).donePromise.then(()=>{const f=Ja(),g=l.querySelectorAll(`style[ng-transition="${p}"]`);for(let m=0;m<g.length;m++)f.remove(g[m])})}},deps:[Y8,Ro,Ar],multi:!0}];class A2{static init(){!function $Y(p){n2=p}(new A2)}addToWindow(l){Wi.getAngularTestability=(f,g=!0)=>{const m=l.findTestabilityInTree(f,g);if(null==m)throw new Error("Could not find testability for element.");return m},Wi.getAllAngularTestabilities=()=>l.getAllTestabilities(),Wi.getAllAngularRootElements=()=>l.getAllRootElements(),Wi.frameworkStabilizers||(Wi.frameworkStabilizers=[]),Wi.frameworkStabilizers.push(f=>{const g=Wi.getAllAngularTestabilities();let m=g.length,v=!1;const y=function(x){v=v||x,m--,0==m&&f(v)};g.forEach(function(x){x.whenStable(y)})})}findTestabilityInTree(l,u,f){if(null==u)return null;const g=l.getTestability(u);return null!=g?g:f?Ja().isShadowRoot(u)?this.findTestabilityInTree(l,u.host,!0):this.findTestabilityInTree(l,u.parentElement,!0):null}}let eZ=(()=>{class p{build(){return new XMLHttpRequest}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();const by=new oi("EventManagerPlugins");let _y=(()=>{class p{constructor(u,f){this._zone=f,this._eventNameToPlugin=new Map,u.forEach(g=>g.manager=this),this._plugins=u.slice().reverse()}addEventListener(u,f,g){return this._findPluginFor(f).addEventListener(u,f,g)}addGlobalEventListener(u,f,g){return this._findPluginFor(f).addGlobalEventListener(u,f,g)}getZone(){return this._zone}_findPluginFor(u){const f=this._eventNameToPlugin.get(u);if(f)return f;const g=this._plugins;for(let m=0;m<g.length;m++){const v=g[m];if(v.supports(u))return this._eventNameToPlugin.set(u,v),v}throw new Error(`No event manager plugin found for event ${u}`)}}return p.\u0275fac=function(u){return new(u||p)(It(by),It(As))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();class X8{constructor(l){this._doc=l}addGlobalEventListener(l,u,f){const g=Ja().getGlobalEventTarget(this._doc,l);if(!g)throw new Error(`Unsupported event target ${g} for event ${u}`);return this.addEventListener(g,u,f)}}let q8=(()=>{class p{constructor(){this._stylesSet=new Set}addStyles(u){const f=new Set;u.forEach(g=>{this._stylesSet.has(g)||(this._stylesSet.add(g),f.add(g))}),this.onStylesAdded(f)}onStylesAdded(u){}getAllStyles(){return Array.from(this._stylesSet)}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})(),Ng=(()=>{class p extends q8{constructor(u){super(),this._doc=u,this._hostNodes=new Map,this._hostNodes.set(u.head,[])}_addStylesToHost(u,f,g){u.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,g.push(f.appendChild(v))})}addHost(u){const f=[];this._addStylesToHost(this._stylesSet,u,f),this._hostNodes.set(u,f)}removeHost(u){const f=this._hostNodes.get(u);f&&f.forEach(Z8),this._hostNodes.delete(u)}onStylesAdded(u){this._hostNodes.forEach((f,g)=>{this._addStylesToHost(u,g,f)})}ngOnDestroy(){this._hostNodes.forEach(u=>u.forEach(Z8))}}return p.\u0275fac=function(u){return new(u||p)(It(Ro))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();function Z8(p){Ja().remove(p)}const I2={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},P2=/%COMP%/g;function Sy(p,l,u){for(let f=0;f<l.length;f++){let g=l[f];Array.isArray(g)?Sy(p,g,u):(g=g.replace(P2,p),u.push(g))}return u}function K8(p){return l=>{if("__ngUnwrap__"===l)return p;!1===p(l)&&(l.preventDefault(),l.returnValue=!1)}}let R2=(()=>{class p{constructor(u,f,g){this.eventManager=u,this.sharedStylesHost=f,this.appId=g,this.rendererByCompId=new Map,this.defaultRenderer=new M2(u)}createRenderer(u,f){if(!u||!f)return this.defaultRenderer;switch(f.encapsulation){case Ba.Emulated:{let g=this.rendererByCompId.get(f.id);return g||(g=new oZ(this.eventManager,this.sharedStylesHost,f,this.appId),this.rendererByCompId.set(f.id,g)),g.applyToHost(u),g}case 1:case Ba.ShadowDom:return new aZ(this.eventManager,this.sharedStylesHost,u,f);default:if(!this.rendererByCompId.has(f.id)){const g=Sy(f.id,f.styles,[]);this.sharedStylesHost.addStyles(g),this.rendererByCompId.set(f.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return p.\u0275fac=function(u){return new(u||p)(It(_y),It(Ng),It(Mg))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();class M2{constructor(l){this.eventManager=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(l,u){return u?document.createElementNS(I2[u]||u,l):document.createElement(l)}createComment(l){return document.createComment(l)}createText(l){return document.createTextNode(l)}appendChild(l,u){l.appendChild(u)}insertBefore(l,u,f){l&&l.insertBefore(u,f)}removeChild(l,u){l&&l.removeChild(u)}selectRootElement(l,u){let f="string"==typeof l?document.querySelector(l):l;if(!f)throw new Error(`The selector "${l}" did not match any elements`);return u||(f.textContent=""),f}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,u,f,g){if(g){u=g+":"+u;const m=I2[g];m?l.setAttributeNS(m,u,f):l.setAttribute(u,f)}else l.setAttribute(u,f)}removeAttribute(l,u,f){if(f){const g=I2[f];g?l.removeAttributeNS(g,u):l.removeAttribute(`${f}:${u}`)}else l.removeAttribute(u)}addClass(l,u){l.classList.add(u)}removeClass(l,u){l.classList.remove(u)}setStyle(l,u,f,g){g&(Xr.DashCase|Xr.Important)?l.style.setProperty(u,f,g&Xr.Important?"important":""):l.style[u]=f}removeStyle(l,u,f){f&Xr.DashCase?l.style.removeProperty(u):l.style[u]=""}setProperty(l,u,f){l[u]=f}setValue(l,u){l.nodeValue=u}listen(l,u,f){return"string"==typeof l?this.eventManager.addGlobalEventListener(l,u,K8(f)):this.eventManager.addEventListener(l,u,K8(f))}}class oZ extends M2{constructor(l,u,f,g){super(l),this.component=f;const m=Sy(g+"-"+f.id,f.styles,[]);u.addStyles(m),this.contentAttr=function nZ(p){return"_ngcontent-%COMP%".replace(P2,p)}(g+"-"+f.id),this.hostAttr=function sZ(p){return"_nghost-%COMP%".replace(P2,p)}(g+"-"+f.id)}applyToHost(l){super.setAttribute(l,this.hostAttr,"")}createElement(l,u){const f=super.createElement(l,u);return super.setAttribute(f,this.contentAttr,""),f}}class aZ extends M2{constructor(l,u,f,g){super(l),this.sharedStylesHost=u,this.hostEl=f,this.shadowRoot=f.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=Sy(g.id,g.styles,[]);for(let v=0;v<m.length;v++){const y=document.createElement("style");y.textContent=m[v],this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(l,u){return super.appendChild(this.nodeOrShadowRoot(l),u)}insertBefore(l,u,f){return super.insertBefore(this.nodeOrShadowRoot(l),u,f)}removeChild(l,u){return super.removeChild(this.nodeOrShadowRoot(l),u)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}}let lZ=(()=>{class p extends X8{constructor(u){super(u)}supports(u){return!0}addEventListener(u,f,g){return u.addEventListener(f,g,!1),()=>this.removeEventListener(u,f,g)}removeEventListener(u,f,g){return u.removeEventListener(f,g)}}return p.\u0275fac=function(u){return new(u||p)(It(Ro))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();const tR=["alt","control","meta","shift"],hZ={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},iR={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},dZ={alt:p=>p.altKey,control:p=>p.ctrlKey,meta:p=>p.metaKey,shift:p=>p.shiftKey};let uZ=(()=>{class p extends X8{constructor(u){super(u)}supports(u){return null!=p.parseEventName(u)}addEventListener(u,f,g){const m=p.parseEventName(f),v=p.eventCallback(m.fullKey,g,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ja().onAndCancel(u,m.domEventName,v))}static parseEventName(u){const f=u.toLowerCase().split("."),g=f.shift();if(0===f.length||"keydown"!==g&&"keyup"!==g)return null;const m=p._normalizeKey(f.pop());let v="";if(tR.forEach(x=>{const w=f.indexOf(x);w>-1&&(f.splice(w,1),v+=x+".")}),v+=m,0!=f.length||0===m.length)return null;const y={};return y.domEventName=g,y.fullKey=v,y}static getEventFullKey(u){let f="",g=function fZ(p){let l=p.key;if(null==l){if(l=p.keyIdentifier,null==l)return"Unidentified";l.startsWith("U+")&&(l=String.fromCharCode(parseInt(l.substring(2),16)),3===p.location&&iR.hasOwnProperty(l)&&(l=iR[l]))}return hZ[l]||l}(u);return g=g.toLowerCase()," "===g?g="space":"."===g&&(g="dot"),tR.forEach(m=>{m!=g&&dZ[m](u)&&(f+=m+".")}),f+=g,f}static eventCallback(u,f,g){return m=>{p.getEventFullKey(m)===u&&g.runGuarded(()=>f(m))}}static _normalizeKey(u){return"esc"===u?"escape":u}}return p.\u0275fac=function(u){return new(u||p)(It(Ro))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();const vZ=u8(mX,"browser",[{provide:s8,useValue:"browser"},{provide:n8,useValue:function pZ(){D2.makeCurrent(),A2.init()},multi:!0},{provide:Ro,useFactory:function mZ(){return function CV(p){zw=p}(document),document},deps:[]}]),yZ=[{provide:ob,useValue:"root"},{provide:ug,useFactory:function gZ(){return new ug},deps:[]},{provide:by,useClass:lZ,multi:!0,deps:[Ro,As,s8]},{provide:by,useClass:uZ,multi:!0,deps:[Ro]},{provide:R2,useClass:R2,deps:[_y,Ng,Mg]},{provide:wP,useExisting:R2},{provide:q8,useExisting:Ng},{provide:Ng,useClass:Ng,deps:[Ro]},{provide:i2,useClass:i2,deps:[As]},{provide:_y,useClass:_y,deps:[by,As]},{provide:class Xq{},useClass:eZ,deps:[]}];let xZ=(()=>{class p{constructor(u){if(u)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(u){return{ngModule:p,providers:[{provide:Mg,useValue:u.appId},{provide:Y8,useExisting:Mg},Kq]}}}return p.\u0275fac=function(u){return new(u||p)(It(p,12))},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({providers:yZ,imports:[jq,vX]}),p})();"undefined"!=typeof window&&window;const{isArray:PZ}=Array,{getPrototypeOf:RZ,prototype:MZ,keys:kZ}=Object;function rR(p){if(1===p.length){const l=p[0];if(PZ(l))return{args:l,keys:null};if(function OZ(p){return p&&"object"==typeof p&&RZ(p)===MZ}(l)){const u=kZ(l);return{args:u.map(f=>l[f]),keys:u}}}return{args:p,keys:null}}const{isArray:LZ}=Array;function oR(p){return an(l=>function FZ(p,l){return LZ(l)?p(...l):p(l)}(p,l))}function aR(p,l){return p.reduce((u,f,g)=>(u[f]=l[g],u),{})}let lR=(()=>{class p{constructor(u,f){this._renderer=u,this._elementRef=f,this.onChange=g=>{},this.onTouched=()=>{}}setProperty(u,f){this._renderer.setProperty(this._elementRef.nativeElement,u,f)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}}return p.\u0275fac=function(u){return new(u||p)(je(Ul),je(Jr))},p.\u0275dir=At({type:p}),p})(),id=(()=>{class p extends lR{}return p.\u0275fac=function(){let l;return function(f){return(l||(l=function $s(p){return Lc(()=>{const l=p.prototype.constructor,u=l[Ol]||aC(l),f=Object.prototype;let g=Object.getPrototypeOf(p.prototype).constructor;for(;g&&g!==f;){const m=g[Ol]||aC(g);if(m&&m!==u)return m;g=Object.getPrototypeOf(g)}return m=>new m})}(p)))(f||p)}}(),p.\u0275dir=At({type:p,features:[Ui]}),p})();const Qa=new oi("NgValueAccessor"),UZ={provide:Qa,useExisting:ln(()=>Ey),multi:!0},jZ=new oi("CompositionEventMode");let Ey=(()=>{class p extends lR{constructor(u,f,g){super(u,f),this._compositionMode=g,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function VZ(){const p=Ja()?Ja().getUserAgent():"";return/android (\d+)/.test(p.toLowerCase())}())}writeValue(u){this.setProperty("value",null==u?"":u)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}}return p.\u0275fac=function(u){return new(u||p)(je(Ul),je(Jr),je(jZ,8))},p.\u0275dir=At({type:p,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,f){1&u&&ki("input",function(m){return f._handleInput(m.target.value)})("blur",function(){return f.onTouched()})("compositionstart",function(){return f._compositionStart()})("compositionend",function(m){return f._compositionEnd(m.target.value)})},features:[Cn([UZ]),Ui]}),p})();const qs=new oi("NgValidators"),Yc=new oi("NgAsyncValidators");function xR(p){return null!=p}function wR(p){const l=wg(p)?bs(p):p;return Cb(l),l}function CR(p){let l={};return p.forEach(u=>{l=null!=u?Object.assign(Object.assign({},l),u):l}),0===Object.keys(l).length?null:l}function bR(p,l){return l.map(u=>u(p))}function _R(p){return p.map(l=>function WZ(p){return!p.validate}(l)?l:u=>l.validate(u))}function O2(p){return null!=p?function SR(p){if(!p)return null;const l=p.filter(xR);return 0==l.length?null:function(u){return CR(bR(u,l))}}(_R(p)):null}function L2(p){return null!=p?function ER(p){if(!p)return null;const l=p.filter(xR);return 0==l.length?null:function(u){return function NZ(...p){const l=GD(p),{args:u,keys:f}=rR(p),g=new Kn(m=>{const{length:v}=u;if(!v)return void m.complete();const y=new Array(v);let x=v,w=v;for(let C=0;C<v;C++){let _=!1;Na(u[C]).subscribe(ws(m,T=>{_||(_=!0,w--),y[C]=T},()=>x--,void 0,()=>{(!x||!_)&&(w||m.next(f?aR(f,y):y),m.complete())}))}});return l?g.pipe(oR(l)):g}(bR(u,l).map(wR)).pipe(an(CR))}}(_R(p)):null}function TR(p,l){return null===p?[l]:Array.isArray(p)?[...p,l]:[p,l]}function F2(p){return p?Array.isArray(p)?p:[p]:[]}function Dy(p,l){return Array.isArray(p)?p.includes(l):p===l}function IR(p,l){const u=F2(l);return F2(p).forEach(g=>{Dy(u,g)||u.push(g)}),u}function PR(p,l){return F2(l).filter(u=>!Dy(p,u))}class RR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=O2(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=L2(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l){this.control&&this.control.reset(l)}hasError(l,u){return!!this.control&&this.control.hasError(l,u)}getError(l,u){return this.control?this.control.getError(l,u):null}}class Xc extends RR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class fr extends RR{get formDirective(){return null}get path(){return null}}let kR=(()=>{class p extends class MR{constructor(l){this._cd=l}is(l){var u,f,g;return"submitted"===l?!!(null===(u=this._cd)||void 0===u?void 0:u.submitted):!!(null===(g=null===(f=this._cd)||void 0===f?void 0:f.control)||void 0===g?void 0:g[l])}}{constructor(u){super(u)}}return p.\u0275fac=function(u){return new(u||p)(je(Xc,2))},p.\u0275dir=At({type:p,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,f){2&u&&Xv("ng-untouched",f.is("untouched"))("ng-touched",f.is("touched"))("ng-pristine",f.is("pristine"))("ng-dirty",f.is("dirty"))("ng-valid",f.is("valid"))("ng-invalid",f.is("invalid"))("ng-pending",f.is("pending"))},features:[Ui]}),p})();function Bg(p,l){(function U2(p,l){const u=function DR(p){return p._rawValidators}(p);null!==l.validator?p.setValidators(TR(u,l.validator)):"function"==typeof u&&p.setValidators([u]);const f=function AR(p){return p._rawAsyncValidators}(p);null!==l.asyncValidator?p.setAsyncValidators(TR(f,l.asyncValidator)):"function"==typeof f&&p.setAsyncValidators([f]);const g=()=>p.updateValueAndValidity();Ry(l._rawValidators,g),Ry(l._rawAsyncValidators,g)})(p,l),l.valueAccessor.writeValue(p.value),function QZ(p,l){l.valueAccessor.registerOnChange(u=>{p._pendingValue=u,p._pendingChange=!0,p._pendingDirty=!0,"change"===p.updateOn&&LR(p,l)})}(p,l),function eJ(p,l){const u=(f,g)=>{l.valueAccessor.writeValue(f),g&&l.viewToModelUpdate(f)};p.registerOnChange(u),l._registerOnDestroy(()=>{p._unregisterOnChange(u)})}(p,l),function KZ(p,l){l.valueAccessor.registerOnTouched(()=>{p._pendingTouched=!0,"blur"===p.updateOn&&p._pendingChange&&LR(p,l),"submit"!==p.updateOn&&p.markAsTouched()})}(p,l),function JZ(p,l){if(l.valueAccessor.setDisabledState){const u=f=>{l.valueAccessor.setDisabledState(f)};p.registerOnDisabledChange(u),l._registerOnDestroy(()=>{p._unregisterOnDisabledChange(u)})}}(p,l)}function Ry(p,l){p.forEach(u=>{u.registerOnValidatorChange&&u.registerOnValidatorChange(l)})}function LR(p,l){p._pendingDirty&&p.markAsDirty(),p.setValue(p._pendingValue,{emitModelToViewChange:!1}),l.viewToModelUpdate(p._pendingValue),p._pendingChange=!1}function H2(p,l){const u=p.indexOf(l);u>-1&&p.splice(u,1)}const Ug="VALID",ky="INVALID",ef="PENDING",Vg="DISABLED";function G2(p){return(Oy(p)?p.validators:p)||null}function UR(p){return Array.isArray(p)?O2(p):p||null}function z2(p,l){return(Oy(l)?l.asyncValidators:p)||null}function VR(p){return Array.isArray(p)?L2(p):p||null}function Oy(p){return null!=p&&!Array.isArray(p)&&"object"==typeof p}const $2=p=>p instanceof X2;function HR(p){return(p=>p instanceof zR)(p)?p.value:p.getRawValue()}function WR(p,l){const u=$2(p),f=p.controls;if(!(u?Object.keys(f):f).length)throw new Di(1e3,"");if(!f[l])throw new Di(1001,"")}function GR(p,l){$2(p),p._forEachChild((f,g)=>{if(void 0===l[g])throw new Di(1002,"")})}class Y2{constructor(l,u){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=l,this._rawAsyncValidators=u,this._composedValidatorFn=UR(this._rawValidators),this._composedAsyncValidatorFn=VR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===Ug}get invalid(){return this.status===ky}get pending(){return this.status==ef}get disabled(){return this.status===Vg}get enabled(){return this.status!==Vg}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._rawValidators=l,this._composedValidatorFn=UR(l)}setAsyncValidators(l){this._rawAsyncValidators=l,this._composedAsyncValidatorFn=VR(l)}addValidators(l){this.setValidators(IR(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(IR(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(PR(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(PR(l,this._rawAsyncValidators))}hasValidator(l){return Dy(this._rawValidators,l)}hasAsyncValidator(l){return Dy(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(u=>{u.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(u=>{u.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=ef,!1!==l.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=Vg,this.errors=null,this._forEachChild(f=>{f.disable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this._updateValue(),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(f=>f(!0))}enable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=Ug,this._forEachChild(f=>{f.enable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(f=>f(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ug||this.status===ef)&&this._runAsyncValidator(l.emitEvent)),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(u=>u._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Vg:Ug}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=ef,this._hasOwnPendingAsyncValidator=!0;const u=wR(this.asyncValidator(this));this._asyncValidationSubscription=u.subscribe(f=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(f,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,u={}){this.errors=l,this._updateControlsErrors(!1!==u.emitEvent)}get(l){return function sJ(p,l,u){if(null==l||(Array.isArray(l)||(l=l.split(u)),Array.isArray(l)&&0===l.length))return null;let f=p;return l.forEach(g=>{f=$2(f)?f.controls.hasOwnProperty(g)?f.controls[g]:null:(p=>p instanceof oJ)(f)&&f.at(g)||null}),f}(this,l,".")}getError(l,u){const f=u?this.get(u):this;return f&&f.errors?f.errors[l]:null}hasError(l,u){return!!this.getError(l,u)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new Vn,this.statusChanges=new Vn}_calculateStatus(){return this._allControlsDisabled()?Vg:this.errors?ky:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ef)?ef:this._anyControlsHaveStatus(ky)?ky:Ug}_anyControlsHaveStatus(l){return this._anyControls(u=>u.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_isBoxedValue(l){return"object"==typeof l&&null!==l&&2===Object.keys(l).length&&"value"in l&&"disabled"in l}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){Oy(l)&&null!=l.updateOn&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){return!l&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class zR extends Y2{constructor(l=null,u,f){super(G2(u),z2(f,u)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(u),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Oy(u)&&u.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(l)?l.value:l)}setValue(l,u={}){this.value=this._pendingValue=l,this._onChange.length&&!1!==u.emitModelToViewChange&&this._onChange.forEach(f=>f(this.value,!1!==u.emitViewToModelChange)),this.updateValueAndValidity(u)}patchValue(l,u={}){this.setValue(l,u)}reset(l=this.defaultValue,u={}){this._applyFormState(l),this.markAsPristine(u),this.markAsUntouched(u),this.setValue(this.value,u),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){H2(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){H2(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(l){this._isBoxedValue(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}}class X2 extends Y2{constructor(l,u,f){super(G2(u),z2(f,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,u){return this.controls[l]?this.controls[l]:(this.controls[l]=u,u.setParent(this),u._registerOnCollectionChange(this._onCollectionChange),u)}addControl(l,u,f={}){this.registerControl(l,u),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}removeControl(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}setControl(l,u,f={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],u&&this.registerControl(l,u),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,u={}){GR(this,l),Object.keys(l).forEach(f=>{WR(this,f),this.controls[f].setValue(l[f],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(Object.keys(l).forEach(f=>{this.controls[f]&&this.controls[f].patchValue(l[f],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l={},u={}){this._forEachChild((f,g)=>{f.reset(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this._reduceChildren({},(l,u,f)=>(l[f]=HR(u),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(u,f)=>!!f._syncPendingControls()||u);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(u=>{const f=this.controls[u];f&&l(f,u)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(const u of Object.keys(this.controls)){const f=this.controls[u];if(this.contains(u)&&l(f))return!0}return!1}_reduceValue(){return this._reduceChildren({},(l,u,f)=>((u.enabled||this.disabled)&&(l[f]=u.value),l))}_reduceChildren(l,u){let f=l;return this._forEachChild((g,m)=>{f=u(f,g,m)}),f}_allControlsDisabled(){for(const l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class oJ extends Y2{constructor(l,u,f){super(G2(u),z2(f,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(l){return this.controls[l]}push(l,u={}){this.controls.push(l),this._registerControl(l),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}insert(l,u,f={}){this.controls.splice(l,0,u),this._registerControl(u),this.updateValueAndValidity({emitEvent:f.emitEvent})}removeAt(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:u.emitEvent})}setControl(l,u,f={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),u&&(this.controls.splice(l,0,u),this._registerControl(u)),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(l,u={}){GR(this,l),l.forEach((f,g)=>{WR(this,g),this.at(g).setValue(f,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(l.forEach((f,g)=>{this.at(g)&&this.at(g).patchValue(f,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l=[],u={}){this._forEachChild((f,g)=>{f.reset(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this.controls.map(l=>HR(l))}clear(l={}){this.controls.length<1||(this._forEachChild(u=>u._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:l.emitEvent}))}_syncPendingControls(){let l=this.controls.reduce((u,f)=>!!f._syncPendingControls()||u,!1);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){this.controls.forEach((u,f)=>{l(u,f)})}_updateValue(){this.value=this.controls.filter(l=>l.enabled||this.disabled).map(l=>l.value)}_anyControls(l){return this.controls.some(u=>u.enabled&&l(u))}_setUpControls(){this._forEachChild(l=>this._registerControl(l))}_allControlsDisabled(){for(const l of this.controls)if(l.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(l){l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)}}const cJ={provide:Xc,useExisting:ln(()=>Z2)},XR=(()=>Promise.resolve(null))();let Z2=(()=>{class p extends Xc{constructor(u,f,g,m,v){super(),this._changeDetectorRef=v,this.control=new zR,this._registered=!1,this.update=new Vn,this._parent=u,this._setValidators(f),this._setAsyncValidators(g),this.valueAccessor=function j2(p,l){if(!l)return null;let u,f,g;return Array.isArray(l),l.forEach(m=>{m.constructor===Ey?u=m:function nJ(p){return Object.getPrototypeOf(p.constructor)===id}(m)?f=m:g=m}),g||f||u||null}(0,m)}ngOnChanges(u){if(this._checkForErrors(),!this._registered||"name"in u){if(this._registered&&(this._checkName(),this.formDirective)){const f=u.name.previousValue;this.formDirective.removeControl({name:f,path:this._getPath(f)})}this._setUpControl()}"isDisabled"in u&&this._updateDisabled(u),function V2(p,l){if(!p.hasOwnProperty("model"))return!1;const u=p.model;return!!u.isFirstChange()||!Object.is(l,u.currentValue)}(u,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Bg(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(u){XR.then(()=>{var f;this.control.setValue(u,{emitViewToModelChange:!1}),null===(f=this._changeDetectorRef)||void 0===f||f.markForCheck()})}_updateDisabled(u){const f=u.isDisabled.currentValue,g=""===f||f&&"false"!==f;XR.then(()=>{var m;g&&!this.control.disabled?this.control.disable():!g&&this.control.disabled&&this.control.enable(),null===(m=this._changeDetectorRef)||void 0===m||m.markForCheck()})}_getPath(u){return this._parent?function Iy(p,l){return[...l.path,p]}(u,this._parent):[u]}}return p.\u0275fac=function(u){return new(u||p)(je(fr,9),je(qs,10),je(Yc,10),je(Qa,10),je(oy,8))},p.\u0275dir=At({type:p,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Cn([cJ]),Ui,To]}),p})(),ZR=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({}),p})(),LJ=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({imports:[[ZR]]}),p})(),FJ=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({imports:[LJ]}),p})();function ti(...p){return bs(p,Wp(p))}class ga extends Pl{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const u=super._subscribe(l);return!u.closed&&l.next(this._value),u}getValue(){const{hasError:l,thrownError:u,_value:f}=this;if(l)throw u;return this._throwIfClosed(),f}next(l){super.next(this._value=l)}}function pM(p,l,u){p?Rl(u,p,l):l()}function Ly(p,l){const u=Ft(p)?p:()=>p,f=g=>g.error(u());return new Kn(l?g=>l.schedule(f,0,g):f)}const Fy=Yn(p=>function(){p(this),this.name="EmptyError",this.message="no elements in sequence"});function n_(...p){return function UJ(){return Hp(1)}()(bs(p,Wp(p)))}function gM(p){return new Kn(l=>{Na(p()).subscribe(l)})}function mM(){return Ts((p,l)=>{let u=null;p._refCount++;const f=ws(l,void 0,void 0,void 0,()=>{if(!p||p._refCount<=0||0<--p._refCount)return void(u=null);const g=p._connection,m=u;u=null,g&&(!m||g===m)&&g.unsubscribe(),l.unsubscribe()});p.subscribe(f),f.closed||(u=p.connect())})}class VJ extends Kn{constructor(l,u){super(),this.source=l,this.subjectFactory=u,this._subject=null,this._refCount=0,this._connection=null,PD(l)&&(this.lift=l.lift)}_subscribe(l){return this.getSubject().subscribe(l)}getSubject(){const l=this._subject;return(!l||l.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:l}=this;this._subject=this._connection=null,null==l||l.unsubscribe()}connect(){let l=this._connection;if(!l){l=this._connection=new _o;const u=this.getSubject();l.add(this.source.subscribe(ws(u,void 0,()=>{this._teardown(),u.complete()},f=>{this._teardown(),u.error(f)},()=>this._teardown()))),l.closed&&(this._connection=null,l=_o.EMPTY)}return l}refCount(){return mM()(this)}}function sd(p,l){return Ts((u,f)=>{let g=null,m=0,v=!1;const y=()=>v&&!g&&f.complete();u.subscribe(ws(f,x=>{null==g||g.unsubscribe();let w=0;const C=m++;Na(p(x,C)).subscribe(g=ws(f,_=>f.next(l?l(x,_,C,w++):_),()=>{g=null,y()}))},()=>{v=!0,y()}))})}function HJ(p,l,u,f,g){return(m,v)=>{let y=u,x=l,w=0;m.subscribe(ws(v,C=>{const _=w++;x=y?p(x,C,_):(y=!0,C),f&&v.next(x)},g&&(()=>{y&&v.next(x),v.complete()})))}}function vM(p,l){return Ts(HJ(p,l,arguments.length>=2,!0))}function tf(p,l){return Ts((u,f)=>{let g=0;u.subscribe(ws(f,m=>p.call(l,m,g++)&&f.next(m)))})}function qc(p){return Ts((l,u)=>{let m,f=null,g=!1;f=l.subscribe(ws(u,void 0,void 0,v=>{m=Na(p(v,qc(p)(l))),f?(f.unsubscribe(),f=null,m.subscribe(u)):g=!0})),g&&(f.unsubscribe(),f=null,m.subscribe(u))})}function Hg(p,l){return Ft(l)?Cs(p,l,1):Cs(p,1)}function s_(p){return p<=0?()=>Ml:Ts((l,u)=>{let f=[];l.subscribe(ws(u,g=>{f.push(g),p<f.length&&f.shift()},()=>{for(const g of f)u.next(g);u.complete()},void 0,()=>{f=null}))})}function yM(p=WJ){return Ts((l,u)=>{let f=!1;l.subscribe(ws(u,g=>{f=!0,u.next(g)},()=>f?u.complete():u.error(p())))})}function WJ(){return new Fy}function xM(p){return Ts((l,u)=>{let f=!1;l.subscribe(ws(u,g=>{f=!0,u.next(g)},()=>{f||u.next(p),u.complete()}))})}function nf(p,l){const u=arguments.length>=2;return f=>f.pipe(p?tf((g,m)=>p(g,m,f)):Wh,rv(1),u?xM(l):yM(()=>new Fy))}function Qr(p,l,u){const f=Ft(p)||l||u?{next:p,error:l,complete:u}:p;return f?Ts((g,m)=>{var v;null===(v=f.subscribe)||void 0===v||v.call(f);let y=!0;g.subscribe(ws(m,x=>{var w;null===(w=f.next)||void 0===w||w.call(f,x),m.next(x)},()=>{var x;y=!1,null===(x=f.complete)||void 0===x||x.call(f),m.complete()},x=>{var w;y=!1,null===(w=f.error)||void 0===w||w.call(f,x),m.error(x)},()=>{var x,w;y&&(null===(x=f.unsubscribe)||void 0===x||x.call(f)),null===(w=f.finalize)||void 0===w||w.call(f)}))}):Wh}class zl{constructor(l,u){this.id=l,this.url=u}}class r_ extends zl{constructor(l,u,f="imperative",g=null){super(l,u),this.navigationTrigger=f,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Wg extends zl{constructor(l,u,f){super(l,u),this.urlAfterRedirects=f}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class wM extends zl{constructor(l,u,f){super(l,u),this.reason=f}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class $J extends zl{constructor(l,u,f){super(l,u),this.error=f}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class YJ extends zl{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XJ extends zl{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qJ extends zl{constructor(l,u,f,g,m){super(l,u),this.urlAfterRedirects=f,this.state=g,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ZJ extends zl{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class JJ extends zl{constructor(l,u,f,g){super(l,u),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class CM{constructor(l){this.route=l}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bM{constructor(l){this.route=l}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class QJ{constructor(l){this.snapshot=l}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KJ{constructor(l){this.snapshot=l}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eQ{constructor(l){this.snapshot=l}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tQ{constructor(l){this.snapshot=l}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _M{constructor(l,u,f){this.routerEvent=l,this.position=u,this.anchor=f}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ai="primary";class iQ{constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u[0]:u}return null}getAll(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u:[u]}return[]}get keys(){return Object.keys(this.params)}}function sf(p){return new iQ(p)}const SM="ngNavigationCancelingError";function o_(p){const l=Error("NavigationCancelingError: "+p);return l[SM]=!0,l}function sQ(p,l,u){const f=u.path.split("/");if(f.length>p.length||"full"===u.pathMatch&&(l.hasChildren()||f.length<p.length))return null;const g={};for(let m=0;m<f.length;m++){const v=f[m],y=p[m];if(v.startsWith(":"))g[v.substring(1)]=y;else if(v!==y.path)return null}return{consumed:p.slice(0,f.length),posParams:g}}function Ka(p,l){const u=p?Object.keys(p):void 0,f=l?Object.keys(l):void 0;if(!u||!f||u.length!=f.length)return!1;let g;for(let m=0;m<u.length;m++)if(g=u[m],!EM(p[g],l[g]))return!1;return!0}function EM(p,l){if(Array.isArray(p)&&Array.isArray(l)){if(p.length!==l.length)return!1;const u=[...p].sort(),f=[...l].sort();return u.every((g,m)=>f[m]===g)}return p===l}function TM(p){return Array.prototype.concat.apply([],p)}function DM(p){return p.length>0?p[p.length-1]:null}function Is(p,l){for(const u in p)p.hasOwnProperty(u)&&l(p[u],u)}function el(p){return Cb(p)?p:wg(p)?bs(Promise.resolve(p)):ti(p)}const aQ={exact:function PM(p,l,u){if(!od(p.segments,l.segments)||!Ny(p.segments,l.segments,u)||p.numberOfChildren!==l.numberOfChildren)return!1;for(const f in l.children)if(!p.children[f]||!PM(p.children[f],l.children[f],u))return!1;return!0},subset:RM},AM={exact:function lQ(p,l){return Ka(p,l)},subset:function cQ(p,l){return Object.keys(l).length<=Object.keys(p).length&&Object.keys(l).every(u=>EM(p[u],l[u]))},ignored:()=>!0};function IM(p,l,u){return aQ[u.paths](p.root,l.root,u.matrixParams)&&AM[u.queryParams](p.queryParams,l.queryParams)&&!("exact"===u.fragment&&p.fragment!==l.fragment)}function RM(p,l,u){return MM(p,l,l.segments,u)}function MM(p,l,u,f){if(p.segments.length>u.length){const g=p.segments.slice(0,u.length);return!(!od(g,u)||l.hasChildren()||!Ny(g,u,f))}if(p.segments.length===u.length){if(!od(p.segments,u)||!Ny(p.segments,u,f))return!1;for(const g in l.children)if(!p.children[g]||!RM(p.children[g],l.children[g],f))return!1;return!0}{const g=u.slice(0,p.segments.length),m=u.slice(p.segments.length);return!!(od(p.segments,g)&&Ny(p.segments,g,f)&&p.children[ai])&&MM(p.children[ai],l,m,f)}}function Ny(p,l,u){return l.every((f,g)=>AM[u](p[g].parameters,f.parameters))}class rd{constructor(l,u,f){this.root=l,this.queryParams=u,this.fragment=f}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sf(this.queryParams)),this._queryParamMap}toString(){return uQ.serialize(this)}}class Ci{constructor(l,u){this.segments=l,this.children=u,this.parent=null,Is(u,(f,g)=>f.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return By(this)}}class Gg{constructor(l,u){this.path=l,this.parameters=u}get parameterMap(){return this._parameterMap||(this._parameterMap=sf(this.parameters)),this._parameterMap}toString(){return NM(this)}}function od(p,l){return p.length===l.length&&p.every((u,f)=>u.path===l[f].path)}class kM{}class OM{parse(l){const u=new CQ(l);return new rd(u.parseRootSegment(),u.parseQueryParams(),u.parseFragment())}serialize(l){const u=`/${zg(l.root,!0)}`,f=function gQ(p){const l=Object.keys(p).map(u=>{const f=p[u];return Array.isArray(f)?f.map(g=>`${Uy(u)}=${Uy(g)}`).join("&"):`${Uy(u)}=${Uy(f)}`}).filter(u=>!!u);return l.length?`?${l.join("&")}`:""}(l.queryParams);return`${u}${f}${"string"==typeof l.fragment?`#${function fQ(p){return encodeURI(p)}(l.fragment)}`:""}`}}const uQ=new OM;function By(p){return p.segments.map(l=>NM(l)).join("/")}function zg(p,l){if(!p.hasChildren())return By(p);if(l){const u=p.children[ai]?zg(p.children[ai],!1):"",f=[];return Is(p.children,(g,m)=>{m!==ai&&f.push(`${m}:${zg(g,!1)}`)}),f.length>0?`${u}(${f.join("//")})`:u}{const u=function dQ(p,l){let u=[];return Is(p.children,(f,g)=>{g===ai&&(u=u.concat(l(f,g)))}),Is(p.children,(f,g)=>{g!==ai&&(u=u.concat(l(f,g)))}),u}(p,(f,g)=>g===ai?[zg(p.children[ai],!1)]:[`${g}:${zg(f,!1)}`]);return 1===Object.keys(p.children).length&&null!=p.children[ai]?`${By(p)}/${u[0]}`:`${By(p)}/(${u.join("//")})`}}function LM(p){return encodeURIComponent(p).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Uy(p){return LM(p).replace(/%3B/gi,";")}function a_(p){return LM(p).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Vy(p){return decodeURIComponent(p)}function FM(p){return Vy(p.replace(/\+/g,"%20"))}function NM(p){return`${a_(p.path)}${function pQ(p){return Object.keys(p).map(l=>`;${a_(l)}=${a_(p[l])}`).join("")}(p.parameters)}`}const mQ=/^[^\/()?;=#]+/;function jy(p){const l=p.match(mQ);return l?l[0]:""}const vQ=/^[^=?&#]+/,xQ=/^[^&#]+/;class CQ{constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ci([],{}):new Ci([],this.parseChildren())}parseQueryParams(){const l={};if(this.consumeOptional("?"))do{this.parseQueryParam(l)}while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let u={};this.peekStartsWith("/(")&&(this.capture("/"),u=this.parseParens(!0));let f={};return this.peekStartsWith("(")&&(f=this.parseParens(!1)),(l.length>0||Object.keys(u).length>0)&&(f[ai]=new Ci(l,u)),f}parseSegment(){const l=jy(this.remaining);if(""===l&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(l),new Gg(Vy(l),this.parseMatrixParams())}parseMatrixParams(){const l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){const u=jy(this.remaining);if(!u)return;this.capture(u);let f="";if(this.consumeOptional("=")){const g=jy(this.remaining);g&&(f=g,this.capture(f))}l[Vy(u)]=Vy(f)}parseQueryParam(l){const u=function yQ(p){const l=p.match(vQ);return l?l[0]:""}(this.remaining);if(!u)return;this.capture(u);let f="";if(this.consumeOptional("=")){const v=function wQ(p){const l=p.match(xQ);return l?l[0]:""}(this.remaining);v&&(f=v,this.capture(f))}const g=FM(u),m=FM(f);if(l.hasOwnProperty(g)){let v=l[g];Array.isArray(v)||(v=[v],l[g]=v),v.push(m)}else l[g]=m}parseParens(l){const u={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const f=jy(this.remaining),g=this.remaining[f.length];if("/"!==g&&")"!==g&&";"!==g)throw new Error(`Cannot parse url '${this.url}'`);let m;f.indexOf(":")>-1?(m=f.substr(0,f.indexOf(":")),this.capture(m),this.capture(":")):l&&(m=ai);const v=this.parseChildren();u[m]=1===Object.keys(v).length?v[ai]:new Ci([],v),this.consumeOptional("//")}return u}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return!!this.peekStartsWith(l)&&(this.remaining=this.remaining.substring(l.length),!0)}capture(l){if(!this.consumeOptional(l))throw new Error(`Expected "${l}".`)}}class BM{constructor(l){this._root=l}get root(){return this._root.value}parent(l){const u=this.pathFromRoot(l);return u.length>1?u[u.length-2]:null}children(l){const u=l_(l,this._root);return u?u.children.map(f=>f.value):[]}firstChild(l){const u=l_(l,this._root);return u&&u.children.length>0?u.children[0].value:null}siblings(l){const u=c_(l,this._root);return u.length<2?[]:u[u.length-2].children.map(g=>g.value).filter(g=>g!==l)}pathFromRoot(l){return c_(l,this._root).map(u=>u.value)}}function l_(p,l){if(p===l.value)return l;for(const u of l.children){const f=l_(p,u);if(f)return f}return null}function c_(p,l){if(p===l.value)return[l];for(const u of l.children){const f=c_(p,u);if(f.length)return f.unshift(l),f}return[]}class $l{constructor(l,u){this.value=l,this.children=u}toString(){return`TreeNode(${this.value})`}}function rf(p){const l={};return p&&p.children.forEach(u=>l[u.value.outlet]=u),l}class UM extends BM{constructor(l,u){super(l),this.snapshot=u,h_(this,l)}toString(){return this.snapshot.toString()}}function VM(p,l){const u=function bQ(p,l){const v=new Hy([],{},{},"",{},ai,l,null,p.root,-1,{});return new HM("",new $l(v,[]))}(p,l),f=new ga([new Gg("",{})]),g=new ga({}),m=new ga({}),v=new ga({}),y=new ga(""),x=new of(f,g,v,y,m,ai,l,u.root);return x.snapshot=u.root,new UM(new $l(x,[]),u)}class of{constructor(l,u,f,g,m,v,y,x){this.url=l,this.params=u,this.queryParams=f,this.fragment=g,this.data=m,this.outlet=v,this.component=y,this._futureSnapshot=x}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(an(l=>sf(l)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(an(l=>sf(l)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function jM(p,l="emptyOnly"){const u=p.pathFromRoot;let f=0;if("always"!==l)for(f=u.length-1;f>=1;){const g=u[f],m=u[f-1];if(g.routeConfig&&""===g.routeConfig.path)f--;else{if(m.component)break;f--}}return function _Q(p){return p.reduce((l,u)=>({params:Object.assign(Object.assign({},l.params),u.params),data:Object.assign(Object.assign({},l.data),u.data),resolve:Object.assign(Object.assign({},l.resolve),u._resolvedData)}),{params:{},data:{},resolve:{}})}(u.slice(f))}class Hy{constructor(l,u,f,g,m,v,y,x,w,C,_){this.url=l,this.params=u,this.queryParams=f,this.fragment=g,this.data=m,this.outlet=v,this.component=y,this.routeConfig=x,this._urlSegment=w,this._lastPathIndex=C,this._resolve=_}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=sf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(f=>f.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class HM extends BM{constructor(l,u){super(u),this.url=l,h_(this,u)}toString(){return WM(this._root)}}function h_(p,l){l.value._routerState=p,l.children.forEach(u=>h_(p,u))}function WM(p){const l=p.children.length>0?` { ${p.children.map(WM).join(", ")} } `:"";return`${p.value}${l}`}function d_(p){if(p.snapshot){const l=p.snapshot,u=p._futureSnapshot;p.snapshot=u,Ka(l.queryParams,u.queryParams)||p.queryParams.next(u.queryParams),l.fragment!==u.fragment&&p.fragment.next(u.fragment),Ka(l.params,u.params)||p.params.next(u.params),function rQ(p,l){if(p.length!==l.length)return!1;for(let u=0;u<p.length;++u)if(!Ka(p[u],l[u]))return!1;return!0}(l.url,u.url)||p.url.next(u.url),Ka(l.data,u.data)||p.data.next(u.data)}else p.snapshot=p._futureSnapshot,p.data.next(p._futureSnapshot.data)}function u_(p,l){const u=Ka(p.params,l.params)&&function hQ(p,l){return od(p,l)&&p.every((u,f)=>Ka(u.parameters,l[f].parameters))}(p.url,l.url);return u&&!(!p.parent!=!l.parent)&&(!p.parent||u_(p.parent,l.parent))}function $g(p,l,u){if(u&&p.shouldReuseRoute(l.value,u.value.snapshot)){const f=u.value;f._futureSnapshot=l.value;const g=function EQ(p,l,u){return l.children.map(f=>{for(const g of u.children)if(p.shouldReuseRoute(f.value,g.value.snapshot))return $g(p,f,g);return $g(p,f)})}(p,l,u);return new $l(f,g)}{if(p.shouldAttach(l.value)){const m=p.retrieve(l.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=l.value,v.children=l.children.map(y=>$g(p,y)),v}}const f=function TQ(p){return new of(new ga(p.url),new ga(p.params),new ga(p.queryParams),new ga(p.fragment),new ga(p.data),p.outlet,p.component,p)}(l.value),g=l.children.map(m=>$g(p,m));return new $l(f,g)}}function Wy(p){return"object"==typeof p&&null!=p&&!p.outlets&&!p.segmentPath}function Yg(p){return"object"==typeof p&&null!=p&&p.outlets}function f_(p,l,u,f,g){let m={};if(f&&Is(f,(y,x)=>{m[x]=Array.isArray(y)?y.map(w=>`${w}`):`${y}`}),p===l)return new rd(u,m,g);const v=GM(p,l,u);return new rd(v,m,g)}function GM(p,l,u){const f={};return Is(p.children,(g,m)=>{f[m]=g===l?u:GM(g,l,u)}),new Ci(p.segments,f)}class zM{constructor(l,u,f){if(this.isAbsolute=l,this.numberOfDoubleDots=u,this.commands=f,l&&f.length>0&&Wy(f[0]))throw new Error("Root segment cannot have matrix parameters");const g=f.find(Yg);if(g&&g!==DM(f))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class p_{constructor(l,u,f){this.segmentGroup=l,this.processChildren=u,this.index=f}}function $M(p,l,u){if(p||(p=new Ci([],{})),0===p.segments.length&&p.hasChildren())return Gy(p,l,u);const f=function MQ(p,l,u){let f=0,g=l;const m={match:!1,pathIndex:0,commandIndex:0};for(;g<p.segments.length;){if(f>=u.length)return m;const v=p.segments[g],y=u[f];if(Yg(y))break;const x=`${y}`,w=f<u.length-1?u[f+1]:null;if(g>0&&void 0===x)break;if(x&&w&&"object"==typeof w&&void 0===w.outlets){if(!XM(x,w,v))return m;f+=2}else{if(!XM(x,{},v))return m;f++}g++}return{match:!0,pathIndex:g,commandIndex:f}}(p,l,u),g=u.slice(f.commandIndex);if(f.match&&f.pathIndex<p.segments.length){const m=new Ci(p.segments.slice(0,f.pathIndex),{});return m.children[ai]=new Ci(p.segments.slice(f.pathIndex),p.children),Gy(m,0,g)}return f.match&&0===g.length?new Ci(p.segments,{}):f.match&&!p.hasChildren()?g_(p,l,u):f.match?Gy(p,0,g):g_(p,l,u)}function Gy(p,l,u){if(0===u.length)return new Ci(p.segments,{});{const f=function RQ(p){return Yg(p[0])?p[0].outlets:{[ai]:p}}(u),g={};return Is(f,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(g[v]=$M(p.children[v],l,m))}),Is(p.children,(m,v)=>{void 0===f[v]&&(g[v]=m)}),new Ci(p.segments,g)}}function g_(p,l,u){const f=p.segments.slice(0,l);let g=0;for(;g<u.length;){const m=u[g];if(Yg(m)){const x=kQ(m.outlets);return new Ci(f,x)}if(0===g&&Wy(u[0])){f.push(new Gg(p.segments[l].path,YM(u[0]))),g++;continue}const v=Yg(m)?m.outlets[ai]:`${m}`,y=g<u.length-1?u[g+1]:null;v&&y&&Wy(y)?(f.push(new Gg(v,YM(y))),g+=2):(f.push(new Gg(v,{})),g++)}return new Ci(f,{})}function kQ(p){const l={};return Is(p,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[f]=g_(new Ci([],{}),0,u))}),l}function YM(p){const l={};return Is(p,(u,f)=>l[f]=`${u}`),l}function XM(p,l,u){return p==u.path&&Ka(l,u.parameters)}class LQ{constructor(l,u,f,g){this.routeReuseStrategy=l,this.futureState=u,this.currState=f,this.forwardEvent=g}activate(l){const u=this.futureState._root,f=this.currState?this.currState._root:null;this.deactivateChildRoutes(u,f,l),d_(this.futureState.root),this.activateChildRoutes(u,f,l)}deactivateChildRoutes(l,u,f){const g=rf(u);l.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,g[v],f),delete g[v]}),Is(g,(m,v)=>{this.deactivateRouteAndItsChildren(m,f)})}deactivateRoutes(l,u,f){const g=l.value,m=u?u.value:null;if(g===m)if(g.component){const v=f.getContext(g.outlet);v&&this.deactivateChildRoutes(l,u,v.children)}else this.deactivateChildRoutes(l,u,f);else m&&this.deactivateRouteAndItsChildren(u,f)}deactivateRouteAndItsChildren(l,u){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,u):this.deactivateRouteAndOutlet(l,u)}detachAndStoreRouteSubtree(l,u){const f=u.getContext(l.value.outlet),g=f&&l.value.component?f.children:u,m=rf(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],g);if(f&&f.outlet){const v=f.outlet.detach(),y=f.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:v,route:l,contexts:y})}}deactivateRouteAndOutlet(l,u){const f=u.getContext(l.value.outlet),g=f&&l.value.component?f.children:u,m=rf(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],g);f&&f.outlet&&(f.outlet.deactivate(),f.children.onOutletDeactivated(),f.attachRef=null,f.resolver=null,f.route=null)}activateChildRoutes(l,u,f){const g=rf(u);l.children.forEach(m=>{this.activateRoutes(m,g[m.value.outlet],f),this.forwardEvent(new tQ(m.value.snapshot))}),l.children.length&&this.forwardEvent(new KJ(l.value.snapshot))}activateRoutes(l,u,f){const g=l.value,m=u?u.value:null;if(d_(g),g===m)if(g.component){const v=f.getOrCreateContext(g.outlet);this.activateChildRoutes(l,u,v.children)}else this.activateChildRoutes(l,u,f);else if(g.component){const v=f.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){const y=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),v.children.onOutletReAttached(y.contexts),v.attachRef=y.componentRef,v.route=y.route.value,v.outlet&&v.outlet.attach(y.componentRef,y.route.value),d_(y.route.value),this.activateChildRoutes(l,null,v.children)}else{const y=function FQ(p){for(let l=p.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig;if(u&&u.component)return null}return null}(g.snapshot),x=y?y.module.componentFactoryResolver:null;v.attachRef=null,v.route=g,v.resolver=x,v.outlet&&v.outlet.activateWith(g,x),this.activateChildRoutes(l,null,v.children)}}else this.activateChildRoutes(l,null,f)}}class m_{constructor(l,u){this.routes=l,this.module=u}}function Zc(p){return"function"==typeof p}function ad(p){return p instanceof rd}const Xg=Symbol("INITIAL_VALUE");function qg(){return sd(p=>function NJ(...p){const l=Wp(p),u=GD(p),{args:f,keys:g}=rR(p);if(0===f.length)return bs([],l);const m=new Kn(function BJ(p,l,u=Wh){return f=>{pM(l,()=>{const{length:g}=p,m=new Array(g);let v=g,y=g;for(let x=0;x<g;x++)pM(l,()=>{const w=bs(p[x],l);let C=!1;w.subscribe(ws(f,_=>{m[x]=_,C||(C=!0,y--),y||f.next(u(m.slice()))},()=>{--v||f.complete()}))},f)},f)}}(f,l,g?v=>aR(g,v):Wh));return u?m.pipe(oR(u)):m}(p.map(l=>l.pipe(rv(1),function jJ(...p){const l=Wp(p);return Ts((u,f)=>{(l?n_(p,u,l):n_(p,u)).subscribe(f)})}(Xg)))).pipe(vM((l,u)=>{let f=!1;return u.reduce((g,m,v)=>g!==Xg?g:(m===Xg&&(f=!0),f||!1!==m&&v!==u.length-1&&!ad(m)?g:m),l)},Xg),tf(l=>l!==Xg),an(l=>ad(l)?l:!0===l),rv(1)))}class HQ{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Zg,this.attachRef=null}}class Zg{constructor(){this.contexts=new Map}onChildOutletCreated(l,u){const f=this.getOrCreateContext(l);f.outlet=u,this.contexts.set(l,f)}onChildOutletDestroyed(l){const u=this.getContext(l);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){const l=this.contexts;return this.contexts=new Map,l}onOutletReAttached(l){this.contexts=l}getOrCreateContext(l){let u=this.getContext(l);return u||(u=new HQ,this.contexts.set(l,u)),u}getContext(l){return this.contexts.get(l)||null}}let v_=(()=>{class p{constructor(u,f,g,m,v){this.parentContexts=u,this.location=f,this.resolver=g,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new Vn,this.deactivateEvents=new Vn,this.attachEvents=new Vn,this.detachEvents=new Vn,this.name=m||ai,u.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const u=this.parentContexts.getContext(this.name);u&&u.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,f){this.activated=u,this._activatedRoute=f,this.location.insert(u.hostView),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){const u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,f){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=u;const v=(f=f||this.resolver).resolveComponentFactory(u._futureSnapshot.routeConfig.component),y=this.parentContexts.getOrCreateContext(this.name).children,x=new WQ(u,y,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,x),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return p.\u0275fac=function(u){return new(u||p)(je(Zg),je(ua),je(Tg),function Kp(p){return function KV(p,l){if("class"===l)return p.classes;if("style"===l)return p.styles;const u=p.attrs;if(u){const f=u.length;let g=0;for(;g<f;){const m=u[g];if(_A(m))break;if(0===m)g+=2;else if("number"==typeof m)for(g++;g<f&&"string"==typeof u[g];)g++;else{if(m===l)return u[g+1];g+=2}}}return null}(ps(),p)}("name"),je(oy))},p.\u0275dir=At({type:p,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),p})();class WQ{constructor(l,u,f){this.route=l,this.childContexts=u,this.parent=f}get(l,u){return l===of?this.route:l===Zg?this.childContexts:this.parent.get(l,u)}}let qM=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["ng-component"]],decls:1,vars:0,template:function(u,f){1&u&&Bn(0,"router-outlet")},directives:[v_],encapsulation:2}),p})();function ZM(p,l=""){for(let u=0;u<p.length;u++){const f=p[u];GQ(f,zQ(l,f))}}function GQ(p,l){p.children&&ZM(p.children,l)}function zQ(p,l){return l?p||l.path?p&&!l.path?`${p}/`:!p&&l.path?l.path:`${p}/${l.path}`:"":p}function y_(p){const l=p.children&&p.children.map(y_),u=l?Object.assign(Object.assign({},p),{children:l}):Object.assign({},p);return!u.component&&(l||u.loadChildren)&&u.outlet&&u.outlet!==ai&&(u.component=qM),u}function Oo(p){return p.outlet||ai}function JM(p,l){const u=p.filter(f=>Oo(f)===l);return u.push(...p.filter(f=>Oo(f)!==l)),u}const QM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zy(p,l,u){var f;if(""===l.path)return"full"===l.pathMatch&&(p.hasChildren()||u.length>0)?Object.assign({},QM):{matched:!0,consumedSegments:[],remainingSegments:u,parameters:{},positionalParamSegments:{}};const m=(l.matcher||sQ)(u,p,l);if(!m)return Object.assign({},QM);const v={};Is(m.posParams,(x,w)=>{v[w]=x.path});const y=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:u.slice(m.consumed.length),parameters:y,positionalParamSegments:null!==(f=m.posParams)&&void 0!==f?f:{}}}function $y(p,l,u,f,g="corrected"){if(u.length>0&&function XQ(p,l,u){return u.some(f=>Yy(p,l,f)&&Oo(f)!==ai)}(p,u,f)){const v=new Ci(l,function YQ(p,l,u,f){const g={};g[ai]=f,f._sourceSegment=p,f._segmentIndexShift=l.length;for(const m of u)if(""===m.path&&Oo(m)!==ai){const v=new Ci([],{});v._sourceSegment=p,v._segmentIndexShift=l.length,g[Oo(m)]=v}return g}(p,l,f,new Ci(u,p.children)));return v._sourceSegment=p,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:[]}}if(0===u.length&&function qQ(p,l,u){return u.some(f=>Yy(p,l,f))}(p,u,f)){const v=new Ci(p.segments,function $Q(p,l,u,f,g,m){const v={};for(const y of f)if(Yy(p,u,y)&&!g[Oo(y)]){const x=new Ci([],{});x._sourceSegment=p,x._segmentIndexShift="legacy"===m?p.segments.length:l.length,v[Oo(y)]=x}return Object.assign(Object.assign({},g),v)}(p,l,u,f,p.children,g));return v._sourceSegment=p,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:u}}const m=new Ci(p.segments,p.children);return m._sourceSegment=p,m._segmentIndexShift=l.length,{segmentGroup:m,slicedSegments:u}}function Yy(p,l,u){return(!(p.hasChildren()||l.length>0)||"full"!==u.pathMatch)&&""===u.path}function KM(p,l,u,f){return!!(Oo(p)===f||f!==ai&&Yy(l,u,p))&&("**"===p.path||zy(l,p,u).matched)}function e7(p,l,u){return 0===l.length&&!p.children[u]}class Xy{constructor(l){this.segmentGroup=l||null}}class t7{constructor(l){this.urlTree=l}}function Jg(p){return Ly(new Xy(p))}function i7(p){return Ly(new t7(p))}class KQ{constructor(l,u,f,g,m){this.configLoader=u,this.urlSerializer=f,this.urlTree=g,this.config=m,this.allowRedirects=!0,this.ngModule=l.get(Vl)}apply(){const l=$y(this.urlTree.root,[],[],this.config).segmentGroup,u=new Ci(l.segments,l.children);return this.expandSegmentGroup(this.ngModule,this.config,u,ai).pipe(an(m=>this.createUrlTree(x_(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(qc(m=>{if(m instanceof t7)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof Xy?this.noMatchError(m):m}))}match(l){return this.expandSegmentGroup(this.ngModule,this.config,l.root,ai).pipe(an(g=>this.createUrlTree(x_(g),l.queryParams,l.fragment))).pipe(qc(g=>{throw g instanceof Xy?this.noMatchError(g):g}))}noMatchError(l){return new Error(`Cannot match any routes. URL Segment: '${l.segmentGroup}'`)}createUrlTree(l,u,f){const g=l.segments.length>0?new Ci([],{[ai]:l}):l;return new rd(g,u,f)}expandSegmentGroup(l,u,f,g){return 0===f.segments.length&&f.hasChildren()?this.expandChildren(l,u,f).pipe(an(m=>new Ci([],m))):this.expandSegment(l,f,u,f.segments,g,!0)}expandChildren(l,u,f){const g=[];for(const m of Object.keys(f.children))"primary"===m?g.unshift(m):g.push(m);return bs(g).pipe(Hg(m=>{const v=f.children[m],y=JM(u,m);return this.expandSegmentGroup(l,y,v,m).pipe(an(x=>({segment:x,outlet:m})))}),vM((m,v)=>(m[v.outlet]=v.segment,m),{}),function GJ(p,l){const u=arguments.length>=2;return f=>f.pipe(p?tf((g,m)=>p(g,m,f)):Wh,s_(1),u?xM(l):yM(()=>new Fy))}())}expandSegment(l,u,f,g,m,v){return bs(f).pipe(Hg(y=>this.expandSegmentAgainstRoute(l,u,f,y,g,m,v).pipe(qc(w=>{if(w instanceof Xy)return ti(null);throw w}))),nf(y=>!!y),qc((y,x)=>{if(y instanceof Fy||"EmptyError"===y.name)return e7(u,g,m)?ti(new Ci([],{})):Jg(u);throw y}))}expandSegmentAgainstRoute(l,u,f,g,m,v,y){return KM(g,u,m,v)?void 0===g.redirectTo?this.matchSegmentAgainstRoute(l,u,g,m,v):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v):Jg(u):Jg(u)}expandSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v){return"**"===g.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(l,f,g,v):this.expandRegularSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(l,u,f,g){const m=this.applyRedirectCommands([],f.redirectTo,{});return f.redirectTo.startsWith("/")?i7(m):this.lineralizeSegments(f,m).pipe(Cs(v=>{const y=new Ci(v,{});return this.expandSegment(l,y,u,v,g,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(l,u,f,g,m,v){const{matched:y,consumedSegments:x,remainingSegments:w,positionalParamSegments:C}=zy(u,g,m);if(!y)return Jg(u);const _=this.applyRedirectCommands(x,g.redirectTo,C);return g.redirectTo.startsWith("/")?i7(_):this.lineralizeSegments(g,_).pipe(Cs(T=>this.expandSegment(l,u,f,T.concat(w),v,!1)))}matchSegmentAgainstRoute(l,u,f,g,m){if("**"===f.path)return f.loadChildren?(f._loadedConfig?ti(f._loadedConfig):this.configLoader.load(l.injector,f)).pipe(an(_=>(f._loadedConfig=_,new Ci(g,{})))):ti(new Ci(g,{}));const{matched:v,consumedSegments:y,remainingSegments:x}=zy(u,f,g);return v?this.getChildConfig(l,f,g).pipe(Cs(C=>{const _=C.module,T=C.routes,{segmentGroup:M,slicedSegments:L}=$y(u,y,x,T),N=new Ci(M.segments,M.children);if(0===L.length&&N.hasChildren())return this.expandChildren(_,T,N).pipe(an(z=>new Ci(y,z)));if(0===T.length&&0===L.length)return ti(new Ci(y,{}));const V=Oo(f)===m;return this.expandSegment(_,N,T,L,V?ai:m,!0).pipe(an(G=>new Ci(y.concat(G.segments),G.children)))})):Jg(u)}getChildConfig(l,u,f){return u.children?ti(new m_(u.children,l)):u.loadChildren?void 0!==u._loadedConfig?ti(u._loadedConfig):this.runCanLoadGuards(l.injector,u,f).pipe(Cs(g=>g?this.configLoader.load(l.injector,u).pipe(an(m=>(u._loadedConfig=m,m))):function JQ(p){return Ly(o_(`Cannot load children because the guard of the route "path: '${p.path}'" returned false`))}(u))):ti(new m_([],l))}runCanLoadGuards(l,u,f){const g=u.canLoad;return g&&0!==g.length?ti(g.map(v=>{const y=l.get(v);let x;if(function BQ(p){return p&&Zc(p.canLoad)}(y))x=y.canLoad(u,f);else{if(!Zc(y))throw new Error("Invalid CanLoad guard");x=y(u,f)}return el(x)})).pipe(qg(),Qr(v=>{if(!ad(v))return;const y=o_(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw y.url=v,y}),an(v=>!0===v)):ti(!0)}lineralizeSegments(l,u){let f=[],g=u.root;for(;;){if(f=f.concat(g.segments),0===g.numberOfChildren)return ti(f);if(g.numberOfChildren>1||!g.children[ai])return Ly(new Error(`Only absolute redirects can have named outlets. redirectTo: '${l.redirectTo}'`));g=g.children[ai]}}applyRedirectCommands(l,u,f){return this.applyRedirectCreatreUrlTree(u,this.urlSerializer.parse(u),l,f)}applyRedirectCreatreUrlTree(l,u,f,g){const m=this.createSegmentGroup(l,u.root,f,g);return new rd(m,this.createQueryParams(u.queryParams,this.urlTree.queryParams),u.fragment)}createQueryParams(l,u){const f={};return Is(l,(g,m)=>{if("string"==typeof g&&g.startsWith(":")){const y=g.substring(1);f[m]=u[y]}else f[m]=g}),f}createSegmentGroup(l,u,f,g){const m=this.createSegments(l,u.segments,f,g);let v={};return Is(u.children,(y,x)=>{v[x]=this.createSegmentGroup(l,y,f,g)}),new Ci(m,v)}createSegments(l,u,f,g){return u.map(m=>m.path.startsWith(":")?this.findPosParam(l,m,g):this.findOrReturn(m,f))}findPosParam(l,u,f){const g=f[u.path.substring(1)];if(!g)throw new Error(`Cannot redirect to '${l}'. Cannot find '${u.path}'.`);return g}findOrReturn(l,u){let f=0;for(const g of u){if(g.path===l.path)return u.splice(f),g;f++}return l}}function x_(p){const l={};for(const f of Object.keys(p.children)){const m=x_(p.children[f]);(m.segments.length>0||m.hasChildren())&&(l[f]=m)}return function eK(p){if(1===p.numberOfChildren&&p.children[ai]){const l=p.children[ai];return new Ci(p.segments.concat(l.segments),l.children)}return p}(new Ci(p.segments,l))}class n7{constructor(l){this.path=l,this.route=this.path[this.path.length-1]}}class qy{constructor(l,u){this.component=l,this.route=u}}function iK(p,l,u){const f=p._root;return Qg(f,l?l._root:null,u,[f.value])}function Zy(p,l,u){const f=function sK(p){if(!p)return null;for(let l=p.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig}return null}(l);return(f?f.module.injector:u).get(p)}function Qg(p,l,u,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const m=rf(l);return p.children.forEach(v=>{(function rK(p,l,u,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const m=p.value,v=l?l.value:null,y=u?u.getContext(p.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const x=function oK(p,l,u){if("function"==typeof u)return u(p,l);switch(u){case"pathParamsChange":return!od(p.url,l.url);case"pathParamsOrQueryParamsChange":return!od(p.url,l.url)||!Ka(p.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!u_(p,l)||!Ka(p.queryParams,l.queryParams);default:return!u_(p,l)}}(v,m,m.routeConfig.runGuardsAndResolvers);x?g.canActivateChecks.push(new n7(f)):(m.data=v.data,m._resolvedData=v._resolvedData),Qg(p,l,m.component?y?y.children:null:u,f,g),x&&y&&y.outlet&&y.outlet.isActivated&&g.canDeactivateChecks.push(new qy(y.outlet.component,v))}else v&&Kg(l,y,g),g.canActivateChecks.push(new n7(f)),Qg(p,null,m.component?y?y.children:null:u,f,g)})(v,m[v.value.outlet],u,f.concat([v.value]),g),delete m[v.value.outlet]}),Is(m,(v,y)=>Kg(v,u.getContext(y),g)),g}function Kg(p,l,u){const f=rf(p),g=p.value;Is(f,(m,v)=>{Kg(m,g.component?l?l.children.getContext(v):null:l,u)}),u.canDeactivateChecks.push(new qy(g.component&&l&&l.outlet&&l.outlet.isActivated?l.outlet.component:null,g))}class gK{}function s7(p){return new Kn(l=>l.error(p))}class vK{constructor(l,u,f,g,m,v){this.rootComponentType=l,this.config=u,this.urlTree=f,this.url=g,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const l=$y(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,u=this.processSegmentGroup(this.config,l,ai);if(null===u)return null;const f=new Hy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},ai,this.rootComponentType,null,this.urlTree.root,-1,{}),g=new $l(f,u),m=new HM(this.url,g);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(l){const u=l.value,f=jM(u,this.paramsInheritanceStrategy);u.params=Object.freeze(f.params),u.data=Object.freeze(f.data),l.children.forEach(g=>this.inheritParamsAndData(g))}processSegmentGroup(l,u,f){return 0===u.segments.length&&u.hasChildren()?this.processChildren(l,u):this.processSegment(l,u,u.segments,f)}processChildren(l,u){const f=[];for(const m of Object.keys(u.children)){const v=u.children[m],y=JM(l,m),x=this.processSegmentGroup(y,v,m);if(null===x)return null;f.push(...x)}const g=r7(f);return function yK(p){p.sort((l,u)=>l.value.outlet===ai?-1:u.value.outlet===ai?1:l.value.outlet.localeCompare(u.value.outlet))}(g),g}processSegment(l,u,f,g){for(const m of l){const v=this.processSegmentAgainstRoute(m,u,f,g);if(null!==v)return v}return e7(u,f,g)?[]:null}processSegmentAgainstRoute(l,u,f,g){if(l.redirectTo||!KM(l,u,f,g))return null;let m,v=[],y=[];if("**"===l.path){const M=f.length>0?DM(f).parameters:{};m=new Hy(f,M,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,l7(l),Oo(l),l.component,l,o7(u),a7(u)+f.length,c7(l))}else{const M=zy(u,l,f);if(!M.matched)return null;v=M.consumedSegments,y=M.remainingSegments,m=new Hy(v,M.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,l7(l),Oo(l),l.component,l,o7(u),a7(u)+v.length,c7(l))}const x=function xK(p){return p.children?p.children:p.loadChildren?p._loadedConfig.routes:[]}(l),{segmentGroup:w,slicedSegments:C}=$y(u,v,y,x.filter(M=>void 0===M.redirectTo),this.relativeLinkResolution);if(0===C.length&&w.hasChildren()){const M=this.processChildren(x,w);return null===M?null:[new $l(m,M)]}if(0===x.length&&0===C.length)return[new $l(m,[])];const _=Oo(l)===g,T=this.processSegment(x,w,C,_?ai:g);return null===T?null:[new $l(m,T)]}}function wK(p){const l=p.value.routeConfig;return l&&""===l.path&&void 0===l.redirectTo}function r7(p){const l=[],u=new Set;for(const f of p){if(!wK(f)){l.push(f);continue}const g=l.find(m=>f.value.routeConfig===m.value.routeConfig);void 0!==g?(g.children.push(...f.children),u.add(g)):l.push(f)}for(const f of u){const g=r7(f.children);l.push(new $l(f.value,g))}return l.filter(f=>!u.has(f))}function o7(p){let l=p;for(;l._sourceSegment;)l=l._sourceSegment;return l}function a7(p){let l=p,u=l._segmentIndexShift?l._segmentIndexShift:0;for(;l._sourceSegment;)l=l._sourceSegment,u+=l._segmentIndexShift?l._segmentIndexShift:0;return u-1}function l7(p){return p.data||{}}function c7(p){return p.resolve||{}}function h7(p){return[...Object.keys(p),...Object.getOwnPropertySymbols(p)]}function w_(p){return sd(l=>{const u=p(l);return u?bs(u).pipe(an(()=>l)):ti(l)})}class AK extends class DK{shouldDetach(l){return!1}store(l,u){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,u){return l.routeConfig===u.routeConfig}}{}const C_=new oi("ROUTES");class d7{constructor(l,u,f,g){this.injector=l,this.compiler=u,this.onLoadStartListener=f,this.onLoadEndListener=g}load(l,u){if(u._loader$)return u._loader$;this.onLoadStartListener&&this.onLoadStartListener(u);const g=this.loadModuleFactory(u.loadChildren).pipe(an(m=>{this.onLoadEndListener&&this.onLoadEndListener(u);const v=m.create(l);return new m_(TM(v.injector.get(C_,void 0,Pt.Self|Pt.Optional)).map(y_),v)}),qc(m=>{throw u._loader$=void 0,m}));return u._loader$=new VJ(g,()=>new Pl).pipe(mM()),u._loader$}loadModuleFactory(l){return el(l()).pipe(Cs(u=>u instanceof _P?ti(u):bs(this.compiler.compileModuleAsync(u))))}}class PK{shouldProcessUrl(l){return!0}extract(l){return l}merge(l,u){return l}}function RK(p){throw p}function MK(p,l,u){return l.parse("/")}function u7(p,l){return ti(null)}const kK={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},OK={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Kr=(()=>{class p{constructor(u,f,g,m,v,y,x){this.rootComponentType=u,this.urlSerializer=f,this.rootContexts=g,this.location=m,this.config=x,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Pl,this.errorHandler=RK,this.malformedUriErrorHandler=MK,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:u7,afterPreactivation:u7},this.urlHandlingStrategy=new PK,this.routeReuseStrategy=new AK,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Vl),this.console=v.get(kY);const _=v.get(As);this.isNgZoneEnabled=_ instanceof As&&As.isInAngularZone(),this.resetConfig(x),this.currentUrlTree=function oQ(){return new rd(new Ci([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new d7(v,y,T=>this.triggerEvent(new CM(T)),T=>this.triggerEvent(new bM(T))),this.routerState=VM(this.currentUrlTree,this.rootComponentType),this.transitions=new ga({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var u;return null===(u=this.location.getState())||void 0===u?void 0:u.\u0275routerPageId}setupNavigations(u){const f=this.events;return u.pipe(tf(g=>0!==g.id),an(g=>Object.assign(Object.assign({},g),{extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),sd(g=>{let m=!1,v=!1;return ti(g).pipe(Qr(y=>{this.currentNavigation={id:y.id,initialUrl:y.currentRawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),sd(y=>{const x=this.browserUrlTree.toString(),w=!this.navigated||y.extractedUrl.toString()!==x||x!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||w)&&this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return f7(y.source)&&(this.browserUrlTree=y.extractedUrl),ti(y).pipe(sd(_=>{const T=this.transitions.getValue();return f.next(new r_(_.id,this.serializeUrl(_.extractedUrl),_.source,_.restoredState)),T!==this.transitions.getValue()?Ml:Promise.resolve(_)}),function tK(p,l,u,f){return sd(g=>function QQ(p,l,u,f,g){return new KQ(p,l,u,f,g).apply()}(p,l,u,g.extractedUrl,f).pipe(an(m=>Object.assign(Object.assign({},g),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Qr(_=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:_.urlAfterRedirects})}),function CK(p,l,u,f,g){return Cs(m=>function mK(p,l,u,f,g="emptyOnly",m="legacy"){try{const v=new vK(p,l,u,f,g,m).recognize();return null===v?s7(new gK):ti(v)}catch(v){return s7(v)}}(p,l,m.urlAfterRedirects,u(m.urlAfterRedirects),f,g).pipe(an(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,_=>this.serializeUrl(_),this.paramsInheritanceStrategy,this.relativeLinkResolution),Qr(_=>{if("eager"===this.urlUpdateStrategy){if(!_.extras.skipLocationChange){const M=this.urlHandlingStrategy.merge(_.urlAfterRedirects,_.rawUrl);this.setBrowserUrl(M,_)}this.browserUrlTree=_.urlAfterRedirects}const T=new YJ(_.id,this.serializeUrl(_.extractedUrl),this.serializeUrl(_.urlAfterRedirects),_.targetSnapshot);f.next(T)}));if(w&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:T,extractedUrl:M,source:L,restoredState:N,extras:V}=y,H=new r_(T,this.serializeUrl(M),L,N);f.next(H);const G=VM(M,this.rootComponentType).snapshot;return ti(Object.assign(Object.assign({},y),{targetSnapshot:G,urlAfterRedirects:M,extras:Object.assign(Object.assign({},V),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=y.rawUrl,y.resolve(null),Ml}),w_(y=>{const{targetSnapshot:x,id:w,extractedUrl:C,rawUrl:_,extras:{skipLocationChange:T,replaceUrl:M}}=y;return this.hooks.beforePreactivation(x,{navigationId:w,appliedUrlTree:C,rawUrlTree:_,skipLocationChange:!!T,replaceUrl:!!M})}),Qr(y=>{const x=new XJ(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(x)}),an(y=>Object.assign(Object.assign({},y),{guards:iK(y.targetSnapshot,y.currentSnapshot,this.rootContexts)})),function aK(p,l){return Cs(u=>{const{targetSnapshot:f,currentSnapshot:g,guards:{canActivateChecks:m,canDeactivateChecks:v}}=u;return 0===v.length&&0===m.length?ti(Object.assign(Object.assign({},u),{guardsResult:!0})):function lK(p,l,u,f){return bs(p).pipe(Cs(g=>function pK(p,l,u,f,g){const m=l&&l.routeConfig?l.routeConfig.canDeactivate:null;return m&&0!==m.length?ti(m.map(y=>{const x=Zy(y,l,g);let w;if(function jQ(p){return p&&Zc(p.canDeactivate)}(x))w=el(x.canDeactivate(p,l,u,f));else{if(!Zc(x))throw new Error("Invalid CanDeactivate guard");w=el(x(p,l,u,f))}return w.pipe(nf())})).pipe(qg()):ti(!0)}(g.component,g.route,u,l,f)),nf(g=>!0!==g,!0))}(v,f,g,p).pipe(Cs(y=>y&&function NQ(p){return"boolean"==typeof p}(y)?function cK(p,l,u,f){return bs(l).pipe(Hg(g=>n_(function dK(p,l){return null!==p&&l&&l(new QJ(p)),ti(!0)}(g.route.parent,f),function hK(p,l){return null!==p&&l&&l(new eQ(p)),ti(!0)}(g.route,f),function fK(p,l,u){const f=l[l.length-1],m=l.slice(0,l.length-1).reverse().map(v=>function nK(p){const l=p.routeConfig?p.routeConfig.canActivateChild:null;return l&&0!==l.length?{node:p,guards:l}:null}(v)).filter(v=>null!==v).map(v=>gM(()=>ti(v.guards.map(x=>{const w=Zy(x,v.node,u);let C;if(function VQ(p){return p&&Zc(p.canActivateChild)}(w))C=el(w.canActivateChild(f,p));else{if(!Zc(w))throw new Error("Invalid CanActivateChild guard");C=el(w(f,p))}return C.pipe(nf())})).pipe(qg())));return ti(m).pipe(qg())}(p,g.path,u),function uK(p,l,u){const f=l.routeConfig?l.routeConfig.canActivate:null;if(!f||0===f.length)return ti(!0);const g=f.map(m=>gM(()=>{const v=Zy(m,l,u);let y;if(function UQ(p){return p&&Zc(p.canActivate)}(v))y=el(v.canActivate(l,p));else{if(!Zc(v))throw new Error("Invalid CanActivate guard");y=el(v(l,p))}return y.pipe(nf())}));return ti(g).pipe(qg())}(p,g.route,u))),nf(g=>!0!==g,!0))}(f,m,p,l):ti(y)),an(y=>Object.assign(Object.assign({},u),{guardsResult:y})))})}(this.ngModule.injector,y=>this.triggerEvent(y)),Qr(y=>{if(ad(y.guardsResult)){const w=o_(`Redirecting to "${this.serializeUrl(y.guardsResult)}"`);throw w.url=y.guardsResult,w}const x=new qJ(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.triggerEvent(x)}),tf(y=>!!y.guardsResult||(this.restoreHistory(y),this.cancelNavigationTransition(y,""),!1)),w_(y=>{if(y.guards.canActivateChecks.length)return ti(y).pipe(Qr(x=>{const w=new ZJ(x.id,this.serializeUrl(x.extractedUrl),this.serializeUrl(x.urlAfterRedirects),x.targetSnapshot);this.triggerEvent(w)}),sd(x=>{let w=!1;return ti(x).pipe(function bK(p,l){return Cs(u=>{const{targetSnapshot:f,guards:{canActivateChecks:g}}=u;if(!g.length)return ti(u);let m=0;return bs(g).pipe(Hg(v=>function _K(p,l,u,f){return function SK(p,l,u,f){const g=h7(p);if(0===g.length)return ti({});const m={};return bs(g).pipe(Cs(v=>function EK(p,l,u,f){const g=Zy(p,l,f);return el(g.resolve?g.resolve(l,u):g(l,u))}(p[v],l,u,f).pipe(Qr(y=>{m[v]=y}))),s_(1),Cs(()=>h7(m).length===g.length?ti(m):Ml))}(p._resolve,p,l,f).pipe(an(m=>(p._resolvedData=m,p.data=Object.assign(Object.assign({},p.data),jM(p,u).resolve),null)))}(v.route,f,p,l)),Qr(()=>m++),s_(1),Cs(v=>m===g.length?ti(u):Ml))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Qr({next:()=>w=!0,complete:()=>{w||(this.restoreHistory(x),this.cancelNavigationTransition(x,"At least one route resolver didn't emit any value."))}}))}),Qr(x=>{const w=new JJ(x.id,this.serializeUrl(x.extractedUrl),this.serializeUrl(x.urlAfterRedirects),x.targetSnapshot);this.triggerEvent(w)}))}),w_(y=>{const{targetSnapshot:x,id:w,extractedUrl:C,rawUrl:_,extras:{skipLocationChange:T,replaceUrl:M}}=y;return this.hooks.afterPreactivation(x,{navigationId:w,appliedUrlTree:C,rawUrlTree:_,skipLocationChange:!!T,replaceUrl:!!M})}),an(y=>{const x=function SQ(p,l,u){const f=$g(p,l._root,u?u._root:void 0);return new UM(f,l)}(this.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return Object.assign(Object.assign({},y),{targetRouterState:x})}),Qr(y=>{this.currentUrlTree=y.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),this.routerState=y.targetRouterState,"deferred"===this.urlUpdateStrategy&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y),this.browserUrlTree=y.urlAfterRedirects)}),((p,l,u)=>an(f=>(new LQ(l,f.targetRouterState,f.currentRouterState,u).activate(p),f)))(this.rootContexts,this.routeReuseStrategy,y=>this.triggerEvent(y)),Qr({next(){m=!0},complete(){m=!0}}),function zJ(p){return Ts((l,u)=>{try{l.subscribe(u)}finally{u.add(p)}})}(()=>{var y;m||v||this.cancelNavigationTransition(g,`Navigation ID ${g.id} is not equal to the current navigation id ${this.navigationId}`),(null===(y=this.currentNavigation)||void 0===y?void 0:y.id)===g.id&&(this.currentNavigation=null)}),qc(y=>{if(v=!0,function nQ(p){return p&&p[SM]}(y)){const x=ad(y.url);x||(this.navigated=!0,this.restoreHistory(g,!0));const w=new wM(g.id,this.serializeUrl(g.extractedUrl),y.message);f.next(w),x?setTimeout(()=>{const C=this.urlHandlingStrategy.merge(y.url,this.rawUrlTree),_={skipLocationChange:g.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||f7(g.source)};this.scheduleNavigation(C,"imperative",null,_,{resolve:g.resolve,reject:g.reject,promise:g.promise})},0):g.resolve(!1)}else{this.restoreHistory(g,!0);const x=new $J(g.id,this.serializeUrl(g.extractedUrl),y);f.next(x);try{g.resolve(this.errorHandler(y))}catch(w){g.reject(w)}}return Ml}))}))}resetRootComponentType(u){this.rootComponentType=u,this.routerState.root.component=this.rootComponentType}setTransition(u){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),u))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(u=>{const f="popstate"===u.type?"popstate":"hashchange";"popstate"===f&&setTimeout(()=>{var g;const m={replaceUrl:!0},v=(null===(g=u.state)||void 0===g?void 0:g.navigationId)?u.state:null;if(v){const x=Object.assign({},v);delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(m.state=x)}const y=this.parseUrl(u.url);this.scheduleNavigation(y,f,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(u){this.events.next(u)}resetConfig(u){ZM(u),this.config=u.map(y_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(u,f={}){const{relativeTo:g,queryParams:m,fragment:v,queryParamsHandling:y,preserveFragment:x}=f,w=g||this.routerState.root,C=x?this.currentUrlTree.fragment:v;let _=null;switch(y){case"merge":_=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":_=this.currentUrlTree.queryParams;break;default:_=m||null}return null!==_&&(_=this.removeEmptyProps(_)),function DQ(p,l,u,f,g){if(0===u.length)return f_(l.root,l.root,l.root,f,g);const m=function AQ(p){if("string"==typeof p[0]&&1===p.length&&"/"===p[0])return new zM(!0,0,p);let l=0,u=!1;const f=p.reduce((g,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const y={};return Is(m.outlets,(x,w)=>{y[w]="string"==typeof x?x.split("/"):x}),[...g,{outlets:y}]}if(m.segmentPath)return[...g,m.segmentPath]}return"string"!=typeof m?[...g,m]:0===v?(m.split("/").forEach((y,x)=>{0==x&&"."===y||(0==x&&""===y?u=!0:".."===y?l++:""!=y&&g.push(y))}),g):[...g,m]},[]);return new zM(u,l,f)}(u);if(m.toRoot())return f_(l.root,l.root,new Ci([],{}),f,g);const v=function IQ(p,l,u){if(p.isAbsolute)return new p_(l.root,!0,0);if(-1===u.snapshot._lastPathIndex){const m=u.snapshot._urlSegment;return new p_(m,m===l.root,0)}const f=Wy(p.commands[0])?0:1;return function PQ(p,l,u){let f=p,g=l,m=u;for(;m>g;){if(m-=g,f=f.parent,!f)throw new Error("Invalid number of '../'");g=f.segments.length}return new p_(f,!1,g-m)}(u.snapshot._urlSegment,u.snapshot._lastPathIndex+f,p.numberOfDoubleDots)}(m,l,p),y=v.processChildren?Gy(v.segmentGroup,v.index,m.commands):$M(v.segmentGroup,v.index,m.commands);return f_(l.root,v.segmentGroup,y,f,g)}(w,this.currentUrlTree,u,_,null!=C?C:null)}navigateByUrl(u,f={skipLocationChange:!1}){const g=ad(u)?u:this.parseUrl(u),m=this.urlHandlingStrategy.merge(g,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,f)}navigate(u,f={skipLocationChange:!1}){return function LK(p){for(let l=0;l<p.length;l++){const u=p[l];if(null==u)throw new Error(`The requested path contains ${u} segment at index ${l}`)}}(u),this.navigateByUrl(this.createUrlTree(u,f),f)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){let f;try{f=this.urlSerializer.parse(u)}catch(g){f=this.malformedUriErrorHandler(g,this.urlSerializer,u)}return f}isActive(u,f){let g;if(g=!0===f?Object.assign({},kK):!1===f?Object.assign({},OK):f,ad(u))return IM(this.currentUrlTree,u,g);const m=this.parseUrl(u);return IM(this.currentUrlTree,m,g)}removeEmptyProps(u){return Object.keys(u).reduce((f,g)=>{const m=u[g];return null!=m&&(f[g]=m),f},{})}processNavigations(){this.navigations.subscribe(u=>{this.navigated=!0,this.lastSuccessfulId=u.id,this.currentPageId=u.targetPageId,this.events.next(new Wg(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,u.resolve(!0)},u=>{this.console.warn(`Unhandled Navigation Error: ${u}`)})}scheduleNavigation(u,f,g,m,v){var y,x;if(this.disposed)return Promise.resolve(!1);let w,C,_;v?(w=v.resolve,C=v.reject,_=v.promise):_=new Promise((L,N)=>{w=L,C=N});const T=++this.navigationId;let M;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(g=this.location.getState()),M=g&&g.\u0275routerPageId?g.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(x=this.browserPageId)&&void 0!==x?x:0)+1):M=0,this.setTransition({id:T,targetPageId:M,source:f,restoredState:g,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:u,extras:m,resolve:w,reject:C,promise:_,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),_.catch(L=>Promise.reject(L))}setBrowserUrl(u,f){const g=this.urlSerializer.serialize(u),m=Object.assign(Object.assign({},f.extras.state),this.generateNgRouterState(f.id,f.targetPageId));this.location.isCurrentPathEqualTo(g)||f.extras.replaceUrl?this.location.replaceState(g,"",m):this.location.go(g,"",m)}restoreHistory(u,f=!1){var g,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-u.targetPageId;"popstate"!==u.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(g=this.currentNavigation)||void 0===g?void 0:g.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(u),this.browserUrlTree=u.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(f&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=u.currentRouterState,this.currentUrlTree=u.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(u,f){const g=new wM(u.id,this.serializeUrl(u.extractedUrl),f);this.triggerEvent(g),u.resolve(!1)}generateNgRouterState(u,f){return"computed"===this.canceledNavigationResolution?{navigationId:u,\u0275routerPageId:f}:{navigationId:u}}}return p.\u0275fac=function(u){vb()},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();function f7(p){return"imperative"!==p}let em=(()=>{class p{constructor(u,f,g){this.router=u,this.route=f,this.locationStrategy=g,this.commands=null,this.href=null,this.onChanges=new Pl,this.subscription=u.events.subscribe(m=>{m instanceof Wg&&this.updateTargetUrlAndHref()})}set routerLink(u){this.commands=null!=u?Array.isArray(u)?u:[u]:null}ngOnChanges(u){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(u,f,g,m,v){if(0!==u||f||g||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const y={skipLocationChange:af(this.skipLocationChange),replaceUrl:af(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,y),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:af(this.preserveFragment)})}}return p.\u0275fac=function(u){return new(u||p)(je(Kr),je(of),je(Ku))},p.\u0275dir=At({type:p,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(u,f){1&u&&ki("click",function(m){return f.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&u&&Ya("target",f.target)("href",f.href,CC)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[To]}),p})();function af(p){return""===p||!!p}class p7{}class g7{preload(l,u){return ti(null)}}let m7=(()=>{class p{constructor(u,f,g,m){this.router=u,this.injector=g,this.preloadingStrategy=m,this.loader=new d7(g,f,x=>u.triggerEvent(new CM(x)),x=>u.triggerEvent(new bM(x)))}setUpPreloading(){this.subscription=this.router.events.pipe(tf(u=>u instanceof Wg),Hg(()=>this.preload())).subscribe(()=>{})}preload(){const u=this.injector.get(Vl);return this.processRoutes(u,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,f){const g=[];for(const m of f)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;g.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?g.push(this.preloadConfig(u,m)):m.children&&g.push(this.processRoutes(u,m.children));return bs(g).pipe(Hp(),an(m=>{}))}preloadConfig(u,f){return this.preloadingStrategy.preload(f,()=>(f._loadedConfig?ti(f._loadedConfig):this.loader.load(u.injector,f)).pipe(Cs(m=>(f._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return p.\u0275fac=function(u){return new(u||p)(It(Kr),It(o8),It(Ar),It(p7))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})(),__=(()=>{class p{constructor(u,f,g={}){this.router=u,this.viewportScroller=f,this.options=g,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},g.scrollPositionRestoration=g.scrollPositionRestoration||"disabled",g.anchorScrolling=g.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(u=>{u instanceof r_?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof Wg&&(this.lastId=u.id,this.scheduleScrollEvent(u,this.router.parseUrl(u.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(u=>{u instanceof _M&&(u.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(u.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,f){this.router.triggerEvent(new _M(u,"popstate"===this.lastSource?this.store[this.restoredId]:null,f))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return p.\u0275fac=function(u){vb()},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();const ld=new oi("ROUTER_CONFIGURATION"),v7=new oi("ROUTER_FORROOT_GUARD"),UK=[f2,{provide:kM,useClass:OM},{provide:Kr,useFactory:function GK(p,l,u,f,g,m,v={},y,x){const w=new Kr(null,p,l,u,f,g,TM(m));return y&&(w.urlHandlingStrategy=y),x&&(w.routeReuseStrategy=x),function zK(p,l){p.errorHandler&&(l.errorHandler=p.errorHandler),p.malformedUriErrorHandler&&(l.malformedUriErrorHandler=p.malformedUriErrorHandler),p.onSameUrlNavigation&&(l.onSameUrlNavigation=p.onSameUrlNavigation),p.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=p.paramsInheritanceStrategy),p.relativeLinkResolution&&(l.relativeLinkResolution=p.relativeLinkResolution),p.urlUpdateStrategy&&(l.urlUpdateStrategy=p.urlUpdateStrategy),p.canceledNavigationResolution&&(l.canceledNavigationResolution=p.canceledNavigationResolution)}(v,w),v.enableTracing&&w.events.subscribe(C=>{var _,T;null===(_=console.group)||void 0===_||_.call(console,`Router Event: ${C.constructor.name}`),console.log(C.toString()),console.log(C),null===(T=console.groupEnd)||void 0===T||T.call(console)}),w},deps:[kM,Zg,f2,Ar,o8,C_,ld,[class IK{},new Vc],[class TK{},new Vc]]},Zg,{provide:of,useFactory:function $K(p){return p.routerState.root},deps:[Kr]},m7,g7,class BK{preload(l,u){return u().pipe(qc(()=>ti(null)))}},{provide:ld,useValue:{enableTracing:!1}}];function VK(){return new d8("Router",Kr)}let y7=(()=>{class p{constructor(u,f){}static forRoot(u,f){return{ngModule:p,providers:[UK,x7(u),{provide:v7,useFactory:WK,deps:[[Kr,new Vc,new og]]},{provide:ld,useValue:f||{}},{provide:Ku,useFactory:HK,deps:[td,[new Pv(u2),new Vc],ld]},{provide:__,useFactory:jK,deps:[Kr,zq,ld]},{provide:p7,useExisting:f&&f.preloadingStrategy?f.preloadingStrategy:g7},{provide:d8,multi:!0,useFactory:VK},[S_,{provide:Zb,multi:!0,useFactory:YK,deps:[S_]},{provide:w7,useFactory:XK,deps:[S_]},{provide:r8,multi:!0,useExisting:w7}]]}}static forChild(u){return{ngModule:p,providers:[x7(u)]}}}return p.\u0275fac=function(u){return new(u||p)(It(v7,8),It(Kr,8))},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({}),p})();function jK(p,l,u){return u.scrollOffset&&l.setOffset(u.scrollOffset),new __(p,l,u)}function HK(p,l,u={}){return u.useHash?new EX(p,l):new P8(p,l)}function WK(p){return"guarded"}function x7(p){return[{provide:sj,multi:!0,useValue:p},{provide:C_,multi:!0,useValue:p}]}let S_=(()=>{class p{constructor(u){this.injector=u,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Pl}appInitializer(){return this.injector.get(bX,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let f=null;const g=new Promise(y=>f=y),m=this.injector.get(Kr),v=this.injector.get(ld);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),f(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?ti(null):(this.initNavigation=!0,f(!0),this.resultOfPreactivationDone),m.initialNavigation()):f(!0),g})}bootstrapListener(u){const f=this.injector.get(ld),g=this.injector.get(m7),m=this.injector.get(__),v=this.injector.get(Kr),y=this.injector.get(r2);u===y.components[0]&&(("enabledNonBlocking"===f.initialNavigation||void 0===f.initialNavigation)&&v.initialNavigation(),g.setUpPreloading(),m.init(),v.resetRootComponentType(y.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return p.\u0275fac=function(u){return new(u||p)(It(Ar))},p.\u0275prov=wi({token:p,factory:p.\u0275fac}),p})();function YK(p){return p.appInitializer.bind(p)}function XK(p){return p.bootstrapListener.bind(p)}const w7=new oi("Router Initializer");function C7(p,l,u,f,g,m,v){try{var y=p[m](v),x=y.value}catch(w){return void u(w)}y.done?l(x):Promise.resolve(x).then(f,g)}function Q(p){return function(){var l=this,u=arguments;return new Promise(function(f,g){var m=p.apply(l,u);function v(x){C7(m,f,g,v,y,"next",x)}function y(x){C7(m,f,g,v,y,"throw",x)}v(void 0)})}}const ZK=[{id:"reader",name:"Barcode and QR Code Reader",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner",description:"Scan barcode and QR code from camera stream"},{id:"file-detection",name:"Document Detector (File)",description:"Detect document from image files"},{id:"camera-detection",name:"Document Scanner (Camera)",description:"Detect document from camera stream"},{id:"mrz-reader",name:"MRZ Reader",description:"Scan MRZ from image files"},{id:"mrz-scanner",name:"MRZ Scanner",description:"Scan MRZ from camera stream"},{id:"document-viewer",name:"Document Viewer",description:"View, edit and save documents"}];function si(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function cd(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}var hd,tl,wt,p;"function"==typeof SuppressedError&&SuppressedError,(p=hd||(hd={}))[p.BOPM_BLOCK=0]="BOPM_BLOCK",p[p.BOPM_UPDATE=1]="BOPM_UPDATE",function(p){p[p.CCUT_AUTO=0]="CCUT_AUTO",p[p.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",p[p.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",p[p.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",p[p.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",p[p.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(tl||(tl={})),function(p){p[p.IPF_BINARY=0]="IPF_BINARY",p[p.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",p[p.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",p[p.IPF_NV21=3]="IPF_NV21",p[p.IPF_RGB_565=4]="IPF_RGB_565",p[p.IPF_RGB_555=5]="IPF_RGB_555",p[p.IPF_RGB_888=6]="IPF_RGB_888",p[p.IPF_ARGB_8888=7]="IPF_ARGB_8888",p[p.IPF_RGB_161616=8]="IPF_RGB_161616",p[p.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",p[p.IPF_ABGR_8888=10]="IPF_ABGR_8888",p[p.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",p[p.IPF_BGR_888=12]="IPF_BGR_888",p[p.IPF_BINARY_8=13]="IPF_BINARY_8",p[p.IPF_NV12=14]="IPF_NV12",p[p.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(wt||(wt={}));const b7=p=>Object.prototype.toString.call(p),E_=p=>Array.isArray?Array.isArray(p):"[object Array]"===b7(p),T_=p=>"[object Boolean]"===b7(p),jn=p=>"number"==typeof p&&!Number.isNaN(p),ma=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),_7=p=>!(!ma(p)||!(p.bytes instanceof Uint8Array)||!jn(p.width)||p.width<=0||!jn(p.height)||p.height<=0||!jn(p.stride)||p.stride<=0||!("format"in p)||"tag"in p&&!QK(p.tag)),QK=p=>!!ma(p)&&!!jn(p.imageId)&&"type"in p,lf=p=>!!ma(p)&&!!jn(p.x)&&!!jn(p.y);function D_(p,l){return A_.apply(this,arguments)}function A_(){return A_=Q(function*(p,l){return yield new Promise((u,f)=>{let g=new XMLHttpRequest;g.open("GET",p,!0),g.responseType=l,g.send(),g.onloadend=Q(function*(){g.status<200||g.status>=300?f(p+" "+g.status):u(g.response)}),g.onerror=()=>{f(new Error("Network Error: "+g.statusText))}})}),A_.apply(this,arguments)}const eo=(p,l)=>{let u=p.split("."),f=l.split(".");for(let g=0;g<u.length&&g<f.length;++g){let m=u[g],v=f[g];if(m===v)continue;let y=parseInt(u[g]),x=parseInt(f[g]);return y===x||Number.isNaN(y)&&Number.isNaN(x)?m<v?-1:1:y<x||Number.isNaN(y)&&Number.isInteger(x)?-1:1}return u.length===f.length?0:u.length<f.length?-1:1},nee="function"==typeof BigInt;var Jy,ss,dd,tm,im,Lo,ud,I_;class Fo{get _isFetchingStarted(){return si(this,im,"f")}constructor(){Jy.add(this),ss.set(this,[]),dd.set(this,1),tm.set(this,hd.BOPM_BLOCK),im.set(this,!1),Lo.set(this,void 0),ud.set(this,tl.CCUT_AUTO)}setErrorListener(l){}addImageToBuffer(l){var u;if(!_7(l))throw new TypeError("Invalid 'image'.");if((null===(u=l.tag)||void 0===u?void 0:u.hasOwnProperty("imageId"))&&"number"==typeof l.tag.imageId&&this.hasImage(l.tag.imageId))throw new Error("Existed imageId.");if(si(this,ss,"f").length>=si(this,dd,"f"))switch(si(this,tm,"f")){case hd.BOPM_BLOCK:break;case hd.BOPM_UPDATE:if(si(this,ss,"f").push(l),ma(si(this,Lo,"f"))&&jn(si(this,Lo,"f").imageId)&&1==si(this,Lo,"f").keepInBuffer)for(;si(this,ss,"f").length>si(this,dd,"f");){const f=si(this,ss,"f").findIndex(g=>{var m;return(null===(m=g.tag)||void 0===m?void 0:m.imageId)!==si(this,Lo,"f").imageId});si(this,ss,"f").splice(f,1)}else si(this,ss,"f").splice(0,si(this,ss,"f").length-si(this,dd,"f"))}else si(this,ss,"f").push(l)}getImage(){if(0===si(this,ss,"f").length)return null;let l;if(si(this,Lo,"f")&&jn(si(this,Lo,"f").imageId)){const u=si(this,Jy,"m",I_).call(this,si(this,Lo,"f").imageId);if(u<0)throw new Error(`Image with id ${si(this,Lo,"f").imageId} doesn't exist.`);l=si(this,ss,"f").slice(u,u+1)[0]}else l=si(this,ss,"f").pop();if([wt.IPF_RGB_565,wt.IPF_RGB_555,wt.IPF_RGB_888,wt.IPF_ARGB_8888,wt.IPF_RGB_161616,wt.IPF_ARGB_16161616,wt.IPF_ABGR_8888,wt.IPF_ABGR_16161616,wt.IPF_BGR_888].includes(l.format)){if(si(this,ud,"f")===tl.CCUT_RGB_R_CHANNEL_ONLY){Fo._onLog&&Fo._onLog("only get R channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case wt.IPF_RGB_565:case wt.IPF_RGB_555:case wt.IPF_RGB_888:case wt.IPF_RGB_161616:u[f]=l.bytes[3*f+2];break;case wt.IPF_ARGB_8888:case wt.IPF_ARGB_16161616:u[f]=l.bytes[4*f+2];break;case wt.IPF_BGR_888:u[f]=l.bytes[3*f];break;case wt.IPF_ABGR_8888:case wt.IPF_ABGR_16161616:u[f]=l.bytes[4*f]}l.bytes=u,l.stride=l.width,l.format=wt.IPF_GRAYSCALED}else if(si(this,ud,"f")===tl.CCUT_RGB_G_CHANNEL_ONLY){Fo._onLog&&Fo._onLog("only get G channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case wt.IPF_RGB_565:case wt.IPF_RGB_555:case wt.IPF_RGB_888:case wt.IPF_RGB_161616:case wt.IPF_BGR_888:u[f]=l.bytes[3*f+1];break;case wt.IPF_ARGB_8888:case wt.IPF_ARGB_16161616:case wt.IPF_ABGR_8888:case wt.IPF_ABGR_16161616:u[f]=l.bytes[4*f+1]}l.bytes=u,l.stride=l.width,l.format=wt.IPF_GRAYSCALED}else if(si(this,ud,"f")===tl.CCUT_RGB_B_CHANNEL_ONLY){Fo._onLog&&Fo._onLog("only get B channel data.");const u=new Uint8Array(l.width*l.height);for(let f=0;f<u.length;f++)switch(l.format){case wt.IPF_RGB_565:case wt.IPF_RGB_555:case wt.IPF_RGB_888:case wt.IPF_RGB_161616:u[f]=l.bytes[3*f];break;case wt.IPF_ARGB_8888:case wt.IPF_ARGB_16161616:u[f]=l.bytes[4*f];break;case wt.IPF_BGR_888:u[f]=l.bytes[3*f+2];break;case wt.IPF_ABGR_8888:case wt.IPF_ABGR_16161616:u[f]=l.bytes[4*f+2]}l.bytes=u,l.stride=l.width,l.format=wt.IPF_GRAYSCALED}}else[wt.IPF_NV21,wt.IPF_NV12].includes(l.format)&&Fo._onLog&&Fo._onLog("NV21 or NV12 is not supported.");return l}setNextImageToReturn(l,u){if(!((...f)=>0!==f.length&&f.every(g=>jn(g)))(l))throw new TypeError("Invalid 'imageId'.");if(void 0!==u&&!T_(u))throw new TypeError("Invalid 'keepInBuffer'.");cd(this,Lo,{imageId:l,keepInBuffer:u},"f")}_resetNextReturnedImage(){cd(this,Lo,null,"f")}hasImage(l){return si(this,Jy,"m",I_).call(this,l)>=0}startFetching(){cd(this,im,!0,"f")}stopFetching(){cd(this,im,!1,"f")}setMaxImageCount(l){if("number"!=typeof l)throw new TypeError("Invalid 'count'.");if(l<1||Math.round(l)!==l)throw new Error("Invalid 'count'.");for(cd(this,dd,l,"f");si(this,ss,"f")&&si(this,ss,"f").length>l;)si(this,ss,"f").shift()}getMaxImageCount(){return si(this,dd,"f")}getImageCount(){return si(this,ss,"f").length}clearBuffer(){si(this,ss,"f").length=0}isBufferEmpty(){return 0===si(this,ss,"f").length}setBufferOverflowProtectionMode(l){cd(this,tm,l,"f")}getBufferOverflowProtectionMode(){return si(this,tm,"f")}setColourChannelUsageType(l){cd(this,ud,l,"f")}getColourChannelUsageType(){return si(this,ud,"f")}}ss=new WeakMap,dd=new WeakMap,tm=new WeakMap,im=new WeakMap,Lo=new WeakMap,ud=new WeakMap,Jy=new WeakSet,I_=function(p){if("number"!=typeof p)throw new TypeError("Invalid 'imageId'.");return si(this,ss,"f").findIndex(l=>{var u;return(null===(u=l.tag)||void 0===u?void 0:u.imageId)===p})};const Qy="undefined"==typeof self,S7=(()=>{if(!Qy&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),E7=p=>{if(null==p&&(p="./"),!Qy){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};let nm,Yl,Ky,e1,Pr;"undefined"!=typeof navigator&&(nm=navigator,Yl=nm.userAgent,Ky=nm.platform,e1=nm.mediaDevices),function(){if(!Qy){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:nm.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ky,search:"Win"},Mac:{str:Ky},Linux:{str:Ky}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||Yl,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||Yl).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Yl).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Yl.indexOf("Windows NT")&&(g="HarmonyOS"),Pr={browser:u,version:f,OS:g}}Qy&&(Pr={browser:"ssr",version:0,OS:"ssr"})}();const see="undefined"!=typeof WebAssembly&&Yl&&!(/Safari/.test(Yl)&&!/Chrome/.test(Yl)&&/\(.+\s11_2_([2-6]).*\)/.test(Yl)),ree="undefined"!=typeof Worker,T7=!(!e1||!e1.getUserMedia),oee=function(){var p=Q(function*(){let l=!1;if(T7)try{(yield e1.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return p.apply(this,arguments)}}(),D7=p=>p&&"object"==typeof p&&"function"==typeof p.then;class t1 extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(D7(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,D7(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Q(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}const No={},A7=function(){var p=Q(function*(l){let u="string"==typeof l?[l]:l,f=[];for(let g of u)f.push(No[g]=No[g]||new t1);yield Promise.all(f)});return function(u){return p.apply(this,arguments)}}(),i1=function(){var p=Q(function*(l,u){let f,g="string"==typeof l?[l]:l,m=[];for(let v of g){let y;m.push(y=No[v]=No[v]||new t1(f=f||u())),y.isEmpty&&(y.task=f=f||u())}yield Promise.all(m)});return function(u,f){return p.apply(this,arguments)}}();let Rt,I7=0;const bi=()=>I7++,$t={};let Jc,P_=!1;const pr={},Ki={},st={std:{version:"1.2.10",path:E7(S7+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:S7}},sm=new Proxy(st,{get(p,l,u){let f=Reflect.get(p,l,u);return f&&f.path&&(f=f.path),f}}),Bo={dip:{wasm:!0}},to=function(){var p=Q(function*(l){let u;l instanceof Array||(l=l?[l]:[]);{let m=No.core;u=!m||m.isEmpty}let f=new Map;for(let m of l){if(m=m.toLowerCase(),"std"==m||"core"==m)continue;if(!Bo[m])throw Error("The '"+m+"' module cannot be found.");let v=Bo[m].deps;if(null==v?void 0:v.length)for(let x of v){let w=No[x];f.has(x)||f.set(x,!w||w.isEmpty)}let y=No[m];f.has(m)||f.set(m,!y||y.isEmpty)}let g=[];u&&g.push("core"),g.push(...f.keys()),yield i1(g,Q(function*(){const m=[...f.entries()].filter(_=>_[1]).map(_=>_[0]),v={};for(let _ in sm){if("rootDirectory"==_)continue;let T=sm[_];sm.rootDirectory&&(T.startsWith("http://")||T.startsWith("https://")||(T=sm.rootDirectory+"/"+T)),v[_]=E7(T)}const y={};for(let _ of m)y[_]=Bo[_];const x={engineResourcePaths:v,autoResources:y,names:m};let w=new t1;if(u){x.needLoadCore=!0;let _=v.core+Gi._workerName;v.rootDirectory&&(_=v.rootDirectory+_),_.startsWith(location.origin)||(_=yield fetch(_).then(T=>T.blob()).then(T=>URL.createObjectURL(T))),Rt=new Worker(_),Rt.onerror=T=>{let M=new Error(T.message);w.reject(M)},Rt.addEventListener("message",T=>{let M=T.data?T.data:T,N=M.id,V=M.body;switch(M.type){case"log":Jc&&Jc(M.message);break;case"task":try{$t[N](V),delete $t[N]}catch(H){throw delete $t[N],H}break;case"event":try{$t[N](V)}catch(H){throw H}break;default:console.log(T)}}),x.bLog=!!Jc,x.bd=P_,x.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield A7("worker");let C=I7++;$t[C]=_=>{if(_.success)Object.assign(pr,_.versions),"{}"!==JSON.stringify(_.versions)&&(Gi._versions=_.versions),w.resolve(void 0);else{const T=Error(_.message);_.stack&&(T.stack=_.stack),w.reject(T)}},Rt.postMessage({type:"loadWasm",body:x,id:C}),u&&i1("worker",()=>Promise.resolve()),yield w}))});return function(u){return p.apply(this,arguments)}}();class Gi{static get engineResourcePaths(){return sm}static set engineResourcePaths(l){Object.assign(st,l)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Jc}static set _onLog(l){(p=>{Jc=p,Rt&&Rt.postMessage({type:"setBLog",body:{value:!!p}})})(l)}static get _bDebug(){return P_}static set _bDebug(l){(p=>{P_=p,Rt&&Rt.postMessage({type:"setBDebug",body:{value:!!p}})})(l)}static isModuleLoaded(l){return l=(l=l||"core").toLowerCase(),!!No[l]&&No[l].isFulfilled}static loadWasm(l){return Q(function*(){return yield to(l)})()}static detectEnvironment(){return Q(function*(){return yield Q(function*(){return{wasm:see,worker:ree,getUserMedia:T7,camera:yield oee(),browser:Pr.browser,version:Pr.version,OS:Pr.OS}})()})()}static getModuleVersion(){return Q(function*(){return yield new Promise((l,u)=>{let f=bi();$t[f]=function(){var g=Q(function*(m){if(m.success)return l(m.versions);{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,u(v)}});return function(m){return g.apply(this,arguments)}}(),Rt.postMessage({type:"getModuleVersion",id:f})})})()}static getVersion(){return`3.2.30(Worker: ${pr.core&&pr.core.worker||"Not Loaded"}, Wasm: ${pr.core&&pr.core.wasm||"Not Loaded"})`}static enableLogging(){Fo._onLog=console.log,Gi._onLog=console.log}static disableLogging(){Fo._onLog=null,Gi._onLog=null}static cfd(l){return Q(function*(){return yield new Promise((u,f)=>{let g=bi();$t[g]=function(){var m=Q(function*(v){if(v.success)return u();{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,f(y)}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"cfd",id:g,body:{count:l}})})})()}}var en,P7,R_,R7,M7,n1,k7,O7,cf,L7,F7;Gi._bSupportDce4Module=-1,Gi._bSupportIRTModule=-1,Gi._versions=null,Gi._workerName="core.worker.js",Gi.browserInfo=Pr,function(p){p[p.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",p[p.CRIT_BARCODE=2]="CRIT_BARCODE",p[p.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",p[p.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",p[p.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",p[p.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(en||(en={})),function(p){p[p.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",p[p.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",p[p.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",p[p.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(P7||(P7={})),function(p){p[p.EC_OK=0]="EC_OK",p[p.EC_UNKNOWN=-1e4]="EC_UNKNOWN",p[p.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",p[p.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",p[p.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",p[p.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",p[p.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",p[p.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",p[p.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",p[p.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",p[p.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",p[p.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",p[p.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",p[p.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",p[p.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",p[p.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",p[p.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",p[p.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",p[p.EC_TIMEOUT=-10026]="EC_TIMEOUT",p[p.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",p[p.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",p[p.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",p[p.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",p[p.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",p[p.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",p[p.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",p[p.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",p[p.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",p[p.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",p[p.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",p[p.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",p[p.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",p[p.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",p[p.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",p[p.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",p[p.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",p[p.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",p[p.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",p[p.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",p[p.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",p[p.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",p[p.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",p[p.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",p[p.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",p[p.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",p[p.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",p[p.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",p[p.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",p[p.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",p[p.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",p[p.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",p[p.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",p[p.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",p[p.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",p[p.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",p[p.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",p[p.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",p[p.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",p[p.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",p[p.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",p[p.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",p[p.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",p[p.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",p[p.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",p[p.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",p[p.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",p[p.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",p[p.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",p[p.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",p[p.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",p[p.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",p[p.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",p[p.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",p[p.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",p[p.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",p[p.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",p[p.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",p[p.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",p[p.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",p[p.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",p[p.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",p[p.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",p[p.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",p[p.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",p[p.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",p[p.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",p[p.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",p[p.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",p[p.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",p[p.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",p[p.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",p[p.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",p[p.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",p[p.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",p[p.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",p[p.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",p[p.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",p[p.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",p[p.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",p[p.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",p[p.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(R_||(R_={})),function(p){p[p.GEM_SKIP=0]="GEM_SKIP",p[p.GEM_AUTO=1]="GEM_AUTO",p[p.GEM_GENERAL=2]="GEM_GENERAL",p[p.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",p[p.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",p[p.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",p[p.GEM_REV=-2147483648]="GEM_REV"}(R7||(R7={})),function(p){p[p.GTM_SKIP=0]="GTM_SKIP",p[p.GTM_INVERTED=1]="GTM_INVERTED",p[p.GTM_ORIGINAL=2]="GTM_ORIGINAL",p[p.GTM_AUTO=4]="GTM_AUTO",p[p.GTM_REV=-2147483648]="GTM_REV"}(M7||(M7={})),function(p){p[p.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",p[p.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(n1||(n1={})),function(p){p[p.PDFRM_VECTOR=1]="PDFRM_VECTOR",p[p.PDFRM_RASTER=2]="PDFRM_RASTER",p[p.PDFRM_REV=-2147483648]="PDFRM_REV"}(k7||(k7={})),function(p){p[p.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",p[p.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(O7||(O7={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=268435455]="IRUT_ALL"}(cf||(cf={})),function(p){p[p.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",p[p.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",p[p.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",p[p.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",p[p.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",p[p.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",p[p.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",p[p.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",p[p.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(L7||(L7={})),function(p){p[p.ST_NULL=0]="ST_NULL",p[p.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",p[p.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",p[p.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",p[p.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",p[p.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",p[p.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",p[p.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(F7||(F7={}));const Qc="undefined"==typeof self,N7=Qc?{}:self,B7=(()=>{if(!Qc&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),U7=p=>{if(null==p&&(p="./"),!Qc){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p},V7=p=>p&&"object"==typeof p&&"function"==typeof p.then;class M_ extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(V7(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,V7(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Q(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}const s1=" is not allowed to change after `createInstance` or `loadWasm` is called.",cee=!Qc&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",j7=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`license`"+s1);u._license=l};!Qc&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const H7=p=>{if(null==p)p=[];else{p=p instanceof Array?[...p]:[p];for(let l=0;l<p.length;++l){if(!Qc){let u=document.createElement("a");u.href=p[l],p[l]=u.href}p[l].endsWith("/")||(p[l]+="/")}}return p},W7=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`licenseServer`"+s1);u._licenseServer=H7(l)},G7=(p,l)=>{const u=p;if(!u._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+s1);u._deviceFriendlyName=l||""};let rm,om,r1,k_,va;"undefined"!=typeof navigator&&(rm=navigator,om=rm.userAgent,r1=rm.platform,k_=rm.mediaDevices),function(){if(!Qc){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:rm.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:r1,search:"Win"},Mac:{str:r1},Linux:{str:r1}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||om,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||om).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||om).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=om.indexOf("Windows NT")&&(g="HarmonyOS"),va={browser:u,version:f,OS:g}}Qc&&(va={browser:"ssr",version:0,OS:"ssr"})}();const z7=function(){var p=Q(function*(){return to("license"),i1("dynamsoft_inited",Q(function*(){let{lt:l,l:u,ls:f,sp:g,rmk:m,cv:v}=((w,C=!1)=>{const _=w;if(_._pLoad.isEmpty){let T,M,L,N=_._license||"",V=JSON.parse(JSON.stringify(_._licenseServer)),H=_._sessionPassword,G=0;if(N.startsWith("t")||N.startsWith("f"))G=0;else if(0===N.length||N.startsWith("P")||N.startsWith("L")||N.startsWith("Y")||N.startsWith("A"))G=1;else{G=2;const z=N.indexOf(":");-1!=z&&(N=N.substring(z+1));const q=N.indexOf("?");if(-1!=q&&(M=N.substring(q+1),N=N.substring(0,q)),N.startsWith("DLC2"))G=0;else{if(N.startsWith("DLS2")){let te;try{let se=N.substring(4);se=atob(se),te=JSON.parse(se)}catch(se){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(N=te.handshakeCode?te.handshakeCode:te.organizationID?te.organizationID:"","number"==typeof N&&(N=JSON.stringify(N)),0===V.length){let se=[];te.mainServerURL&&(se[0]=te.mainServerURL),te.standbyServerURL&&(se[1]=te.standbyServerURL),V=H7(se)}!H&&te.sessionPassword&&(H=te.sessionPassword),T=te.remark}N&&"200001"!==N&&!N.startsWith("200001-")||(G=1)}}if(G&&(C||(N7.crypto||(L="Please upgrade your browser to support online key."),N7.crypto.subtle||(L="Require https to use online key in this browser."))),L){if(1!==G)throw new Error(L);G=0,console.warn(L),_._lastErrorCode=-1,_._lastErrorString=L}return 1===G&&(N="",console.warn("Applying for a public trial license ...")),{lt:G,l:N,ls:V,sp:H,rmk:T,cv:M}}throw new Error("Can't preprocess license again"+s1)})(tn),y=new M_;tn._pLoad.task=y,Q(function*(){try{yield tn._pLoad}catch(w){}})();let x=bi();$t[x]=w=>{if(w.message&&tn._onAuthMessage){let T=tn._onAuthMessage(w.message);null!=T&&(w.message=T)}let C,_=!1;if(1===l&&(_=!0),w.success?(Jc&&Jc("init license success"),w.message&&console.warn(w.message),Gi._bSupportIRTModule=w.bSupportIRTModule,Gi._bSupportDce4Module=w.bSupportDce4Module,tn.bPassValidation=!0):(C=Error(w.message),w.stack&&(C.stack=w.stack),w.ltsErrorCode&&(C.ltsErrorCode=w.ltsErrorCode),_||111==w.ltsErrorCode&&-1!=w.message.toLowerCase().indexOf("trial license")&&(_=!0)),_){let T=st.license;st.rootDirectory&&(T=st.rootDirectory+"/"+T),T=U7(T),(M=Q(function*(L,N,V){if(!L._bNeverShowDialog)try{let H=yield fetch(L.engineResourcePath+"dls.license.dialog.html");if(!H.ok)throw Error("Get license dialog fail. Network Error: "+H.statusText);let G=yield H.text();if(!G.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let z=document.createElement("div");z.innerHTML=G;let q=[];for(let A=0;A<z.childElementCount;++A){let P=z.children[A];P instanceof HTMLStyleElement&&(q.push(P),document.head.append(P))}let te=1==z.childElementCount?z.children[0]:z;te.remove();let se,ae,j,le,ue,xe=[te],I=te.children;for(let A of I)xe.push(A);for(let A=0;A<xe.length;++A)for(let P of xe[A].children)xe.push(P);for(let A of xe)if(!se&&A.classList.contains("dls-license-mask"))se=A,A.addEventListener("click",P=>{if(A==P.target){te.remove();for(let O of q)O.remove()}});else if(!ae&&A.classList.contains("dls-license-icon-close"))ae=A,A.addEventListener("click",()=>{te.remove();for(let P of q)P.remove()});else if(!j&&A.classList.contains("dls-license-icon-error"))j=A,"error"!=N&&A.remove();else if(!le&&A.classList.contains("dls-license-icon-warn"))le=A,"warn"!=N&&A.remove();else if(!ue&&A.classList.contains("dls-license-msg-content")){ue=A;let P=V;for(;P;){let O=P.indexOf("["),b=P.indexOf("]",O),D=P.indexOf("(",b),k=P.indexOf(")",D);if(-1==O||-1==b||-1==D||-1==k){A.appendChild(new Text(P));break}O>0&&A.appendChild(new Text(P.substring(0,O)));let U=document.createElement("a"),F=P.substring(O+1,b);U.innerText=F;let B=P.substring(D+1,k);U.setAttribute("href",B),U.setAttribute("target","_blank"),A.appendChild(U),P=P.substring(k+1)}}document.body.appendChild(te)}catch(H){L._onLog&&L._onLog(H.message||H)}}),function(L,N,V){return M.apply(this,arguments)})({_bNeverShowDialog:tn._bNeverShowDialog,engineResourcePath:T,_onLog:Jc},w.success?"warn":"error",w.message)}var M;w.success?y.resolve(void 0):y.reject(C)},yield A7("worker"),Rt.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!l,bptk:1===l,l:u,os:va,fn:tn.deviceFriendlyName,ls:f,sp:g,rmk:m,cv:v},id:x}),tn.bCallInitLicense=!0,yield y}))});return function(){return p.apply(this,arguments)}}();let $7;Ki.license={},Ki.license.dynamsoft=z7,Ki.license.getAR=Q(function*(){{let p=No.dynamsoft_inited;p&&p.isRejected&&(yield p)}return Rt?new Promise((p,l)=>{let u=bi();$t[u]=function(){var f=Q(function*(g){if(g.success){delete g.success;{let m=tn.license;m&&(m.startsWith("t")||m.startsWith("f"))&&(g.pk=m)}if(Object.keys(g).length){if(g.lem){let m=Error(g.lem);m.ltsErrorCode=g.lec,delete g.lem,delete g.lec,g.ae=m}p(g)}else p(null)}else{let m=Error(g.message);g.stack&&(m.stack=g.stack),l(m)}});return function(g){return f.apply(this,arguments)}}(),Rt.postMessage({type:"getAR",id:u})}):null});class tn{static setLicenseServer(l){W7(tn,l)}static get license(){return this._license}static set license(l){j7(tn,l)}static get licenseServer(){return this._licenseServer}static set licenseServer(l){W7(tn,l)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(l){G7(tn,l)}static initLicense(l,u){if(j7(tn,l),tn.bCallInitLicense=!0,u)return z7()}static setDeviceFriendlyName(l){G7(tn,l)}static getDeviceFriendlyName(){return tn._deviceFriendlyName}static getDeviceUUID(){return Q(function*(){return yield i1("dynamsoft_uuid",Q(function*(){yield to();let l=new M_,u=bi();$t[u]=f=>{if(f.success)l.resolve(f.uuid);else{const g=Error(f.message);f.stack&&(g.stack=f.stack),l.reject(g)}},Rt.postMessage({type:"getDeviceUUID",id:u}),$7=yield l})),$7})()}}tn._pLoad=new M_,tn.bPassValidation=!1,tn.bCallInitLicense=!1,tn._license=cee,tn._licenseServer=[],tn._deviceFriendlyName="",null==st.license&&(st.license=B7),Bo.license={wasm:!0},Ki.license.LicenseManager=tn;const O_="1.2.10";"string"!=typeof st.std&&eo(st.std.version,O_)<0&&(st.std={version:O_,path:U7(B7+`../../dynamsoft-capture-vision-std@${O_}/dist/`)});const Y7=p=>p&&"object"==typeof p&&"function"==typeof p.then;class hf extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(Y7(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,Y7(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Q(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}class hee{constructor(l){this._cvr=l}getMaxBufferedItems(){var l=this;return Q(function*(){return yield new Promise((u,f)=>{let g=bi();$t[g]=function(){var m=Q(function*(v){if(v.success)return u(v.count);{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,f(y)}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_getMaxBufferedItems",id:g,instanceID:l._cvr._instanceID})})})()}setMaxBufferedItems(l){var u=this;return Q(function*(){return yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f();{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_setMaxBufferedItems",id:m,instanceID:u._cvr._instanceID,body:{count:l}})})})()}getBufferedCharacterItemSet(){var l=this;return Q(function*(){return yield new Promise((u,f)=>{let g=bi();$t[g]=function(){var m=Q(function*(v){if(v.success)return u(v.itemSet);{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,f(y)}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_getBufferedCharacterItemSet",id:g,instanceID:l._cvr._instanceID})})})()}}var dee={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const X7=(p,l)=>{for(let u in l._irrRegistryState)l._irrRegistryState[u]=!1;for(let u of p._intermediateResultReceiverSet)if(u.isDce)l._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let f in u)l._irrRegistryState[f]||(l._irrRegistryState[f]=!!u[f])};class uee{constructor(l){this._irrRegistryState=dee,this._cvr=l}addResultReceiver(l){var u=this;return Q(function*(){if("object"!=typeof l)throw new Error("Invalid receiver.");u._cvr._intermediateResultReceiverSet.add(l),X7(u._cvr,u);let f=-1,g={};if(!l.isDce){if(!l._observedResultUnitTypes||!l._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");f=l._observedResultUnitTypes,l._observedTaskMap.forEach((m,v)=>{g[v]=m}),l._observedTaskMap.clear()}return yield new Promise((m,v)=>{let y=bi();$t[y]=function(){var x=Q(function*(w){if(w.success)return m();{let C=new Error(w.message);return C.stack=w.stack+"\n"+C.stack,v(C)}});return function(w){return x.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_setIrrRegistry",id:y,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState,observedResultUnitTypes:String(f),observedTaskMap:g}})})})()}removeResultReceiver(l){var u=this;return Q(function*(){return u._cvr._intermediateResultReceiverSet.delete(l),X7(u._cvr,u),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f();{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_setIrrRegistry",id:m,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const q7="undefined"==typeof self,L_=(()=>{if(!q7&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Z7=p=>{if(null==p&&(p="./"),!q7){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};var F_;null==st.cvr&&(st.cvr=L_),Bo.cvr={js:!0,wasm:!0,deps:["license","dip"]},Ki.cvr={};const N_="1.2.10";"string"!=typeof st.std&&eo(st.std.version,N_)<0&&(st.std={version:N_,path:Z7(L_+`../../dynamsoft-capture-vision-std@${N_}/dist/`)});const B_="2.2.30";(!st.dip||"string"!=typeof st.dip&&eo(st.dip.version,B_)<0)&&(st.dip={version:B_,path:Z7(L_+`../../dynamsoft-image-processing@${B_}/dist/`)});class J7{static getVersion(){return this._version}}var o1,Q7;function K7(p,l){if(p&&p.location){const u=p.location.points;for(let f of u)f.x=f.x/l,f.y=f.y/l;K7(p.referencedItem,l)}}J7._version=`2.2.30(Worker: ${null===(F_=pr.cvr)||void 0===F_?void 0:F_.worker}, Wasm: loading...`,function(p){p[p.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",p[p.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(o1||(o1={})),function(p){p[p.IRUT_NULL=0]="IRUT_NULL",p[p.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",p[p.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",p[p.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",p[p.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",p[p.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",p[p.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",p[p.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",p[p.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",p[p.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",p[p.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",p[p.IRUT_CONTOURS=1024]="IRUT_CONTOURS",p[p.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",p[p.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",p[p.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",p[p.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",p[p.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",p[p.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",p[p.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",p[p.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",p[p.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",p[p.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",p[p.IRUT_CORNERS=2097152]="IRUT_CORNERS",p[p.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",p[p.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",p[p.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",p[p.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",p[p.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",p[p.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",p[p.IRUT_ALL=134217727]="IRUT_ALL"}(Q7||(Q7={}));class _i{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Gi.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return Q(function*(){if(!Ki.license)throw Error("Module `license` is not existed.");yield Ki.license.dynamsoft(),yield to(["cvr"]);const l=new _i,u=new hf;let f=bi();return $t[f]=function(){var g=Q(function*(m){var v;if(m.success)l._instanceID=m.instanceID,l._currentSettings=JSON.parse(m.outputSettings),J7._version=`2.2.30(Worker: ${null===(v=pr.cvr)||void 0===v?void 0:v.worker}, Wasm: ${m.version})`,0===Gi.bSupportDce4Module&&(l._intermediateResultManager=l.getIntermediateResultManager(!0)),u.resolve(l);else{const y=Error(m.message);m.stack&&(y.stack=m.stack),u.reject(y)}});return function(m){return g.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_createInstance",id:f}),u})()}_singleFrameModeCallback(l){var u=this;return Q(function*(){u._isa.getCameraView().setScanLaserVisible(!0);for(let v of u._resultReceiverSet)u._bNeedOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:l});const f={bytes:new Uint8Array(l.bytes),width:l.width,height:l.height,stride:l.stride,format:l.format,tag:l.tag};u._templateName||(u._templateName=u._currentSettings.CaptureVisionTemplates[0].Name);const g=yield u.capture(f,u._templateName);g.originalImageTag=l.tag;for(let v of u._resultReceiverSet)v.isDce&&v.onCapturedResultReceived(g,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const m={originalImageHashId:g.originalImageHashId,originalImageTag:g.originalImageTag,errorCode:g.errorCode,errorString:g.errorString};for(let v of u._resultReceiverSet)if(v.onDecodedBarcodesReceived&&g.barcodeResultItems&&v.onDecodedBarcodesReceived(Object.assign(Object.assign({},m),{barcodeResultItems:g.barcodeResultItems})),v.onRecognizedTextLinesReceived&&g.textLineResultItems&&v.onRecognizedTextLinesReceived(Object.assign(Object.assign({},m),{textLineResultItems:g.textLineResultItems})),v.onDetectedQuadsReceived&&g.detectedQuadResultItems&&v.onDetectedQuadsReceived(Object.assign(Object.assign({},m),{detectedQuadResultItems:g.detectedQuadResultItems})),v.onNormalizedImagesReceived&&g.normalizedImageResultItems&&v.onNormalizedImagesReceived(Object.assign(Object.assign({},m),{normalizedImageResultItems:g.normalizedImageResultItems})),v.onParsedResultsReceived&&g.parsedResultItems&&v.onParsedResultsReceived(Object.assign(Object.assign({},m),{parsedResultItems:g.parsedResultItems})),v.onCapturedResultReceived&&!v.isDce){if(u._bNeedOutputOriginalImage){const y=g.items.findIndex(x=>1===x.type);-1!==y&&(g.items[y].imageData=l)}v.onCapturedResultReceived(g)}})()}setInput(l){if(this._checkIsDisposed(),l){if(this._isa=l,l.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const u=this._isa.getCameraView();if(u){const f=u._capturedResultReceiver;f.isDce=!0,this._resultReceiverSet.add(f)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(l){if(this._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid ISA state listener.");l&&Object.keys(l)&&this._isaStateListenerSet.add(l)}removeImageSourceStateListener(l){return this._checkIsDisposed(),this._isaStateListenerSet.delete(l)}addResultReceiver(l){if(this._checkIsDisposed(),"object"!=typeof l)throw new Error("Invalid receiver.");l&&Object.keys(l).length&&(this._resultReceiverSet.add(l),this._setCrrRegistry())}removeResultReceiver(l){this._checkIsDisposed(),this._resultReceiverSet.delete(l),this._setCrrRegistry()}_setCrrRegistry(){var l=this;return Q(function*(){const u={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let m of l._resultReceiverSet)m.isDce||(u.onCapturedResultReceived=!!m.onCapturedResultReceived,u.onDecodedBarcodesReceived=!!m.onDecodedBarcodesReceived,u.onRecognizedTextLinesReceived=!!m.onRecognizedTextLinesReceived,u.onDetectedQuadsReceived=!!m.onDetectedQuadsReceived,u.onNormalizedImagesReceived=!!m.onNormalizedImagesReceived,u.onParsedResultsReceived=!!m.onParsedResultsReceived);const f=new hf;let g=bi();return $t[g]=function(){var m=Q(function*(v){if(v.success)f.resolve();else{let y=new Error(v.message);y.stack=v.stack+"\n"+y.stack,f.reject()}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_setCrrRegistry",id:g,instanceID:l._instanceID,body:{receiver:JSON.stringify(u)}}),f})()}addResultFilter(l){var u=this;return Q(function*(){if(u._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid filter.");if(l&&Object.keys(l)){u._resultFilterSet.add(l),u._handleFilterSwitch();for(let f of u._resultFilterSet)yield u._enableResultCrossVerification(f.verificationEnabled),yield u._enableResultDeduplication(f.duplicateFilterEnabled),yield u._setDuplicateForgetTime(f.duplicateForgetTime)}})()}removeResultFilter(l){var u=this;return Q(function*(){u._checkIsDisposed(),u._resultFilterSet.delete(l),u._handleFilterSwitch();for(let f of u._resultFilterSet)yield u._enableResultCrossVerification(f.verificationEnabled),yield u._enableResultDeduplication(f.duplicateFilterEnabled),yield u._setDuplicateForgetTime(f.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let l of this._resultFilterSet)l.isResultCrossVerificationEnabled(en.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),l.isResultCrossVerificationEnabled(en.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),l.isResultCrossVerificationEnabled(en.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),l.isResultCrossVerificationEnabled(en.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(l){var u=this;return Q(function*(){var f,g;if(u._checkIsDisposed(),!u._bPauseScan)return;if(!u._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const m=yield u.containsTask(l);return yield to(m),m.includes("dlr")&&!(null===(f=Ki.dlr)||void 0===f?void 0:f.bLoadConfusableCharsData)&&(yield null===(g=Ki.dlr)||void 0===g?void 0:g.loadRecognitionData("ConfusableChars",st.dlr)),u._isa.isCameraEnhancer&&(m.includes("ddn")?u._isa.setPixelFormat(wt.IPF_ABGR_8888):u._isa.setPixelFormat(wt.IPF_GRAYSCALED)),void 0!==u._isa.singleFrameMode&&"disabled"!==u._isa.singleFrameMode?(u._templateName=l,void u._isa.on("singleFrameAcquired",u._singleFrameModeCallbackBind)):(u._isa.getColourChannelUsageType()===tl.CCUT_AUTO&&u._isa.setColourChannelUsageType(m.includes("ddn")?tl.CCUT_FULL_CHANNEL:tl.CCUT_Y_CHANNEL_ONLY),u._promiseStartScan&&u._promiseStartScan.isPending?u._promiseStartScan:(u._promiseStartScan=new hf((v,y)=>{if(u.disposed)return;let x=bi();$t[x]=function(){var w=Q(function*(C){if(u._promiseStartScan&&!u._promiseStartScan.isFulfilled){if(!C.success){let _=new Error(C.message);return _.stack=C.stack+"\n"+_.stack,y(_)}for(let _ of u._resultFilterSet)yield u.addResultFilter(_);u._bPauseScan=!1,u._bNeedOutputOriginalImage=C.bNeedOutputOriginalImage,u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(Q(function*(){-1!==u._minImageCaptureInterval&&u._isa.startFetching(),u._loopReadVideo(l),v()}),0),u._isa.isCameraEnhancer&&u._isa.getCameraView().setScanLaserVisible(!0)}});return function(C){return w.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_startCapturing",id:x,instanceID:u._instanceID,body:{templateName:l}})}),yield u._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(tl.CCUT_AUTO)))}_clearVerifyList(){var l=this;return Q(function*(){let u=bi();const f=new hf;return $t[u]=function(){var g=Q(function*(m){if(m.success)return f.resolve();{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,f.reject(v)}});return function(m){return g.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_clearVerifyList",id:u,instanceID:l._instanceID}),f})()}_getIntermediateResult(){var l=this;return Q(function*(){l._checkIsDisposed();let u=bi();const f=new hf;return $t[u]=function(){var g=Q(function*(m){if(m.success)f.resolve(m.result);else{let v=new Error(m.message);v.stack=m.stack+"\n"+v.stack,f.reject(v)}});return function(m){return g.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_getIntermediateResult",id:u,instanceID:l._instanceID}),f})()}containsTask(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(JSON.parse(y.tasks));{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_containsTask",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}_loopReadVideo(l){var u=this;return Q(function*(){if(u._dynamsoft=!0,u.disposed||u._bPauseScan)return;if(u._isa.isBufferEmpty())if(u._isa.hasNextImageToFetch())for(let g of u._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(o1.ISS_BUFFER_EMPTY);else if(!u._isa.hasNextImageToFetch())for(let g of u._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(o1.ISS_EXHAUSTED);if(-1===u._minImageCaptureInterval||u._isa.isBufferEmpty())try{u._isa.isBufferEmpty()&&_i._onLog&&_i._onLog("buffer is empty so fetch image"),_i._onLog&&_i._onLog(`DCE: start fetching a frame: ${Date.now()}`),u._dsImage=u._isa.fetchImage(),_i._onLog&&_i._onLog(`DCE: finish fetching a frame: ${Date.now()}`),u._isa.setImageFetchInterval(u._averageTime)}catch(g){return void u._reRunCurrnetFunc(l)}else if(u._isa.setImageFetchInterval(u._averageTime-(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0)),u._dsImage=u._isa.getImage(),u._dsImage.tag&&Date.now()-u._dsImage.tag.timeStamp>200)return void u._reRunCurrnetFunc(l);if(!u._dsImage)return void u._reRunCurrnetFunc(l);for(let g of u._resultReceiverSet)u._bNeedOutputOriginalImage&&g.onOriginalImageResultReceived&&g.onOriginalImageResultReceived({imageData:u._dsImage});const f=Date.now();u._captureDsimage(u._dsImage,l).then(function(){var g=Q(function*(m){if(_i._onLog&&_i._onLog("no js handle time: "+(Date.now()-f)),u._bPauseScan)return void u._reRunCurrnetFunc(l);m.originalImageTag=u._dsImage.tag?u._dsImage.tag:null;for(let x of u._resultReceiverSet)if(x.isDce){const w=Date.now();if(x.onCapturedResultReceived(m,{isDetectVerifyOpen:u._bOpenDetectVerify,isNormalizeVerifyOpen:u._bOpenNormalizeVerify,isBarcodeVerifyOpen:u._bOpenBarcodeVerify,isLabelVerifyOpen:u._bOpenLabelVerify}),_i._onLog){const C=Date.now()-w;C>10&&_i._onLog(`draw result time: ${C}`)}}const v={originalImageHashId:m.originalImageHashId,originalImageTag:m.originalImageTag,errorCode:m.errorCode,errorString:m.errorString};for(let x of u._resultReceiverSet)x.onDecodedBarcodesReceived&&m.barcodeResultItems&&x.onDecodedBarcodesReceived(Object.assign(Object.assign({},v),{barcodeResultItems:m.barcodeResultItems.filter(w=>!w.isFilter)})),x.onRecognizedTextLinesReceived&&m.textLineResultItems&&x.onRecognizedTextLinesReceived(Object.assign(Object.assign({},v),{textLineResultItems:m.textLineResultItems.filter(w=>!w.isFilter)})),x.onDetectedQuadsReceived&&m.detectedQuadResultItems&&x.onDetectedQuadsReceived(Object.assign(Object.assign({},v),{detectedQuadResultItems:m.detectedQuadResultItems.filter(w=>!w.isFilter)})),x.onNormalizedImagesReceived&&m.normalizedImageResultItems&&x.onNormalizedImagesReceived(Object.assign(Object.assign({},v),{normalizedImageResultItems:m.normalizedImageResultItems.filter(w=>!w.isFilter)})),x.onParsedResultsReceived&&m.parsedResultItems&&x.onParsedResultsReceived(Object.assign(Object.assign({},v),{parsedResultItems:m.parsedResultItems.filter(w=>!w.isFilter)})),x.onCapturedResultReceived&&!x.isDce&&(m.items=m.items.filter(w=>!w.isFilter),m.barcodeResultItems&&(m.barcodeResultItems=m.barcodeResultItems.filter(w=>!w.isFilter)),m.textLineResultItems&&(m.textLineResultItems=m.textLineResultItems.filter(w=>!w.isFilter)),m.detectedQuadResultItems&&(m.detectedQuadResultItems=m.detectedQuadResultItems.filter(w=>!w.isFilter)),m.normalizedImageResultItems&&(m.normalizedImageResultItems=m.normalizedImageResultItems.filter(w=>!w.isFilter)),m.parsedResultItems&&(m.parsedResultItems=m.parsedResultItems.filter(w=>!w.isFilter)),x.onCapturedResultReceived(m));const y=Date.now();if(u._minImageCaptureInterval>-1&&(5===u._averageProcessintTimeArray.length&&u._averageProcessintTimeArray.shift(),5===u._averageFetchImageTimeArray.length&&u._averageFetchImageTimeArray.shift(),u._averageProcessintTimeArray.push(Date.now()-f),u._averageFetchImageTimeArray.push(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0),u._averageTime=Math.min(...u._averageProcessintTimeArray)-Math.max(...u._averageFetchImageTimeArray),u._averageTime=u._averageTime>0?u._averageTime:0,_i._onLog&&(_i._onLog(`minImageCaptureInterval: ${u._minImageCaptureInterval}`),_i._onLog(`averageProcessintTimeArray: ${u._averageProcessintTimeArray}`),_i._onLog(`averageFetchImageTimeArray: ${u._averageFetchImageTimeArray}`),_i._onLog(`averageTime: ${u._averageTime}`))),_i._onLog){const x=Date.now()-y;x>10&&_i._onLog(`fetch image calculate time: ${x}`)}_i._onLog&&_i._onLog(`time finish decode: ${Date.now()}`),_i._onLog&&_i._onLog("main time: "+(Date.now()-f)),_i._onLog&&_i._onLog("===================================================="),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=u._minImageCaptureInterval>0&&u._minImageCaptureInterval>=u._averageTime?setTimeout(()=>{u._loopReadVideo(l)},u._minImageCaptureInterval-u._averageTime):setTimeout(()=>{u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,0))});return function(m){return g.apply(this,arguments)}}()).catch(g=>{u._isa.stopFetching(),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(()=>{u._isa.startFetching(),u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,1e3)),"platform error"!==g.message&&setTimeout(()=>{throw g},0)})})()}_reRunCurrnetFunc(l){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(l)},0)}capture(l,u){var f=this;return Q(function*(){var g,m;f._checkIsDisposed(),u||(u=f._currentSettings.CaptureVisionTemplates[0].Name);const v=yield f.containsTask(u);let y;if(yield to(v),v.includes("dlr")&&!(null===(g=Ki.dlr)||void 0===g?void 0:g.bLoadConfusableCharsData)&&(yield null===(m=Ki.dlr)||void 0===m?void 0:m.loadRecognitionData("ConfusableChars",st.dlr)),f._dynamsoft=!1,_7(l))y=yield f._captureDsimage(l,u);else if("string"==typeof l)y="data:image/"==l.substring(0,11)?yield f._captureBase64(l,u):yield f._captureUrl(l,u);else if(l instanceof Blob)y=yield f._captureBlob(l,u);else if(l instanceof HTMLImageElement)y=yield f._captureImage(l,u);else if(l instanceof HTMLCanvasElement)y=yield f._captureCanvas(l,u);else{if(!(l instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");y=yield f._captureVideo(l,u)}return y})()}_captureDsimage(l,u){var f=this;return Q(function*(){return yield f._captureInWorker(l,u)})()}_captureUrl(l,u){var f=this;return Q(function*(){let g=yield D_(l,"blob");return yield f._captureBlob(g,u)})()}_captureBase64(l,u){var f=this;return Q(function*(){l=l.substring(l.indexOf(",")+1);let g=atob(l),m=g.length,v=new Uint8Array(m);for(;m--;)v[m]=g.charCodeAt(m);return yield f._captureBlob(new Blob([v]),u)})()}_captureBlob(l,u){var f=this;return Q(function*(){let g=null,m=null;if("undefined"!=typeof createImageBitmap)try{g=yield createImageBitmap(l)}catch(y){}var y;g||(m=yield(y=Q(function*(x){return yield new Promise((w,C)=>{let _=URL.createObjectURL(x),T=new Image;T.src=_,T.onload=()=>{URL.revokeObjectURL(T.dbrObjUrl),w(T)},T.onerror=M=>{C(new Error("Can't convert blob to image : "+(M instanceof Event?M.type:M)))}})}),function(x){return y.apply(this,arguments)})(l));let v=yield f._captureImage(g||m,u);return g&&g.close(),v})()}_captureImage(l,u){var f=this;return Q(function*(){let g,m,v=l instanceof HTMLImageElement?l.naturalWidth:l.width,y=l instanceof HTMLImageElement?l.naturalHeight:l.height,x=Math.max(v,y);x>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/x,g=Math.round(v*f._compressRate),m=Math.round(y*f._compressRate)):(g=v,m=y),f._canvas||(f._canvas=document.createElement("canvas"));const w=f._canvas;return w.width===g&&w.height===m||(w.width=g,w.height=m),w.ctx2d||(w.ctx2d=w.getContext("2d",{willReadFrequently:!0})),w.ctx2d.drawImage(l,0,0,v,y,0,0,g,m),l.dbrObjUrl&&URL.revokeObjectURL(l.dbrObjUrl),yield f._captureCanvas(w,u)})()}_captureCanvas(l,u){var f=this;return Q(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";if([l.width,l.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const g=l.ctx2d||l.getContext("2d",{willReadFrequently:!0}),m={bytes:Uint8Array.from(g.getImageData(0,0,l.width,l.height).data),width:l.width,height:l.height,stride:4*l.width,format:10};return yield f._captureInWorker(m,u)})()}_captureVideo(l,u){var f=this;return Q(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";let g,m,v=l.videoWidth,y=l.videoHeight,x=Math.max(v,y);x>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/x,g=Math.round(v*f._compressRate),m=Math.round(y*f._compressRate)):(g=v,m=y),f._canvas||(f._canvas=document.createElement("canvas"));const w=f._canvas;return w.width===g&&w.height===m||(w.width=g,w.height=m),w.ctx2d||(w.ctx2d=w.getContext("2d",{willReadFrequently:!0})),w.ctx2d.drawImage(l,0,0,v,y,0,0,g,m),yield f._captureCanvas(w,u)})()}_captureInWorker(l,u){var f=this;return Q(function*(){const{bytes:g,width:m,height:v,stride:y,format:x}=l;let w=bi();const C=new hf;return $t[w]=function(){var _=Q(function*(T){var M,L;if(!T.success){let N=new Error(T.message);return N.stack=T.stack+"\n"+N.stack,C.reject(N)}{const N=Date.now();_i._onLog&&(_i._onLog(`get result time from worker: ${N}`),_i._onLog("worker to main time consume: "+(N-T.workerReturnMsgTime)));try{const V=T.captureResult;l.bytes=T.bytes;for(let G of V.items)0!==f._compressRate&&K7(G,f._compressRate),G.type===en.CRIT_ORIGINAL_IMAGE?G.imageData=l:G.type===en.CRIT_NORMALIZED_IMAGE?null===(M=Ki.ddn)||void 0===M||M.handleNormalizedImageResultItem(G):G.type===en.CRIT_PARSED_RESULT&&(null===(L=Ki.dcp)||void 0===L||L.handleParsedResultItem(G));if(f._dynamsoft)for(let G of f._resultFilterSet)G.onDecodedBarcodesReceived(V.items),G.onRecognizedTextLinesReceived(V.items),G.onDetectedQuadsReceived(V.items),G.onNormalizedImagesReceived(V.items);const H=function(G){const z={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return G.items.forEach(q=>{q.type===en.CRIT_BARCODE?z.barcodeResultItems.push(q):q.type===en.CRIT_TEXT_LINE?z.textLineResultItems.push(q):q.type===en.CRIT_DETECTED_QUAD?z.detectedQuadResultItems.push(q):q.type===en.CRIT_NORMALIZED_IMAGE?z.normalizedImageResultItems.push(q):q.type===en.CRIT_PARSED_RESULT&&z.parsedResultItems.push(q)}),z}(V);if(H.barcodeResultItems.length&&(V.barcodeResultItems=H.barcodeResultItems),H.textLineResultItems.length&&(V.textLineResultItems=H.textLineResultItems),H.detectedQuadResultItems.length&&(V.detectedQuadResultItems=H.detectedQuadResultItems),H.normalizedImageResultItems.length&&(V.normalizedImageResultItems=H.normalizedImageResultItems),H.parsedResultItems.length&&(V.parsedResultItems=H.parsedResultItems),!f._bPauseScan||!f._dynamsoft){const G=V.intermediateResult;if(G){let z=0;for(let q of f._intermediateResultReceiverSet){z++;for(let te of G){if("onTaskResultsReceived"===te.info.callbackName){for(let se of te.intermediateResultUnits)se.originalImageTag=l.tag?l.tag:null;q[te.info.callbackName]&&q[te.info.callbackName]({intermediateResultUnits:te.intermediateResultUnits},te.info)}else q[te.info.callbackName]&&q[te.info.callbackName](te.result,te.info);z===f._intermediateResultReceiverSet.size&&delete te.info.callbackName}}}V&&V.intermediateResult&&delete V.intermediateResult}return f._compressRate=0,C.resolve(V)}catch(V){return C.reject(V)}}});return function(T){return _.apply(this,arguments)}}(),_i._onLog&&_i._onLog(`send buffer to worker: ${Date.now()}`),Rt.postMessage({type:"cvr_capture",id:w,instanceID:f._instanceID,body:{bytes:g,width:m,height:v,stride:y,format:x,templateName:u||"",dynamsoft:f._dynamsoft}},[g.buffer]),C})()}initSettings(l){var u=this;return Q(function*(){return u._checkIsDisposed(),l&&["string","object"].includes(typeof l)?("string"==typeof l?l.startsWith("{")?u._currentSettings=JSON.parse(l):l=yield D_(l,"text"):"object"==typeof l&&(u._currentSettings=l,l=JSON.stringify(l)),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success){const x=JSON.parse(y.response);if(0!==x.exception){let _=new Error(x.description?x.description:"Init Settings Failed.");return _.errorCode=x.exception,g(_)}let w=[],C=JSON.parse(l).CaptureVisionTemplates;for(let _=0;_<C.length;_++){let T=yield u.containsTask(C[_].Name);w=w.concat(T)}return yield to([...new Set(w)]),u._bNeedOutputOriginalImage=1===u._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,f(x)}{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid template.")})()}outputSettings(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success){const x=JSON.parse(y.settings);if(0!==x.errorCode){let w=new Error(x.errorString);return w.errorCode=x.errorCode,g(w)}return delete x.errorCode,delete x.errorString,f(x)}{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_outputSettings",id:m,instanceID:u._instanceID,body:{templateName:l||"*"}})})})()}outputSettingsToFile(l,u,f){var g=this;return Q(function*(){const m=yield g.outputSettings(l),v=new Blob([JSON.stringify(m,null,2,function(y,x){return x instanceof Array?JSON.stringify(x):x},2)],{type:"application/json"});if(f){const y=document.createElement("a");y.href=URL.createObjectURL(v),u.endsWith(".json")&&(u=u.replace(".json","")),y.download=`${u}.json`,y.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(y.href)},500)},y.click()}return v})()}getSimplifiedSettings(l){var u=this;return Q(function*(){u._checkIsDisposed(),l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const f=yield u.containsTask(l);return yield to(f),yield new Promise((g,m)=>{let v=bi();$t[v]=function(){var y=Q(function*(x){if(x.success){const w=JSON.parse(x.settings,(C,_)=>nee&&"barcodeFormatIds"===C?BigInt(_):_);if(w.minImageCaptureInterval=u._minImageCaptureInterval,0!==w.code){let C=new Error(w.codeString);return C.errorCode=w.errorCode,m(C)}return delete w.code,delete w.codeString,g(w)}{let w=new Error(x.message);return w.stack=x.stack+"\n"+w.stack,m(w)}});return function(x){return y.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_getSimplifiedSettings",id:v,instanceID:u._instanceID,body:{templateName:l}})})})()}updateSettings(l,u){var f=this;return Q(function*(){f._checkIsDisposed();const g=yield f.containsTask(l);return yield to(g),yield new Promise((m,v)=>{let y=bi();$t[y]=function(){var x=Q(function*(w){if(w.success){const C=JSON.parse(w.response);if(u.minImageCaptureInterval&&u.minImageCaptureInterval>=-1&&(f._minImageCaptureInterval=u.minImageCaptureInterval),f._bNeedOutputOriginalImage=w.bNeedOutputOriginalImage,0!==C.exception){let _=new Error(C.description?C.description:"Update Settings Failed.");return _.errorCode=C.exception,v(_)}return f._currentSettings=yield f.outputSettings("*"),m(C)}{let C=new Error(w.message);return C.stack=w.stack+"\n"+C.stack,v(C)}});return function(w){return x.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_updateSettings",id:y,instanceID:f._instanceID,body:{settings:u,templateName:l}})})})()}resetSettings(){var l=this;return Q(function*(){return l._checkIsDisposed(),yield new Promise((u,f)=>{let g=bi();$t[g]=function(){var m=Q(function*(v){if(v.success){const y=JSON.parse(v.response);if(0!==y.exception){let x=new Error(y.description?y.description:"Reset Settings Failed.");return x.errorCode=y.exception,f(x)}return l._currentSettings=yield l.outputSettings("*"),u(y)}{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,f(y)}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_resetSettings",id:g,instanceID:l._instanceID})})})()}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new hee(this)),this._bufferdItemsManager}getIntermediateResultManager(l){if(this._checkIsDisposed(),!l&&0!==Gi.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new uee(this)),this._intermediateResultManager}contains(l,u){return function(f,g){let m=g.x,v=g.y,y=f[0].x,x=f[0].y,w=f[1].x,C=f[1].y,_=f[2].x,T=f[2].y,M=f[3].x,L=f[3].y,N=z(m,v,y,x,w,C),V=z(m,v,w,C,_,T),H=z(m,v,_,T,M,L),G=z(m,v,M,L,y,x);function z(q,te,se,ae,j,le){return(q-se)*(le-ae)-(te-ae)*(j-se)}return N>=0&&V>=0&&H>=0&&G>=0||N<=0&&V<=0&&H<=0&&G<=0}(l,u)}parseRequiredResources(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(JSON.parse(y.resources));{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_parseRequiredResources",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}dispose(){var l=this;return Q(function*(){l._checkIsDisposed(),l._promiseStartScan&&l.stopCapturing(),l._isa=null,l._resultReceiverSet.clear(),l._isaStateListenerSet.clear(),l._resultFilterSet.clear(),l.bDestroyed=!0;let u=bi();$t[u]=f=>{if(!f.success){let g=new Error(f.message);throw g.stack=f.stack+"\n"+g.stack,g}},Rt.postMessage({type:"cvr_dispose",id:u,instanceID:l._instanceID})})()}_enableResultCrossVerification(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(y.result);{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_enableResultCrossVerification",id:m,instanceID:u._instanceID,body:{verificationEnabled:l}})})})()}_enableResultDeduplication(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(y.result);{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_enableResultDeduplication",id:m,instanceID:u._instanceID,body:{duplicateFilterEnabled:l}})})})()}_setDuplicateForgetTime(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(y.result);{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_setDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{duplicateForgetTime:l}})})})()}_getDuplicateForgetTime(l){var u=this;return Q(function*(){return u._checkIsDisposed(),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success)return f(y.time);{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"cvr_getDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{type:l}})})})()}_setThresholdValue(l,u,f){var g=this;return Q(function*(){return yield to("ddn"),yield new Promise((m,v)=>{let y=bi();$t[y]=function(){var x=Q(function*(w){if(w.success)return m();{let C=new Error(w.message);return C.stack=w.stack+"\n"+C.stack,v(C)}});return function(w){return x.apply(this,arguments)}}(),Rt.postMessage({type:"ddn_setThresholdValue",id:y,instanceID:g._instanceID,body:{threshold:l,leftLimit:u,rightLimit:f}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}const U_="undefined"==typeof self,fee=(()=>{if(!U_&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();function Z(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function lt(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}let am,Xl,a1,l1,Ps;null==st.dce&&(st.dce=fee),Bo.dce={wasm:!1,js:!1},Ki.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(am=navigator,Xl=am.userAgent,a1=am.platform,l1=am.mediaDevices),function(){if(!U_){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:am.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:a1,search:"Win"},Mac:{str:a1},Linux:{str:a1}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||Xl,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||Xl).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Xl).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Xl.indexOf("Windows NT")&&(g="HarmonyOS"),Ps={browser:u,version:f,OS:g}}U_&&(Ps={browser:"ssr",version:0,OS:"ssr"})}();const pee="undefined"!=typeof WebAssembly&&Xl&&!(/Safari/.test(Xl)&&!/Chrome/.test(Xl)&&/\(.+\s11_2_([2-6]).*\)/.test(Xl)),gee="undefined"!=typeof Worker,ek=!(!l1||!l1.getUserMedia),mee=function(){var p=Q(function*(){let l=!1;if(ek)try{(yield l1.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return p.apply(this,arguments)}}();var vee={653:(p,l,u)=>{var f,g,m,v,y,x,w,C,_,T,L,N,V,H,G,z,q,te,se,ae,I,A,P,O,j=j||{version:"5.2.1"};if(l.fabric=j,"undefined"!=typeof document&&"undefined"!=typeof window)j.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),j.window=window;else{var le=new(u(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;j.document=le.document,j.jsdomImplForWrapper=u(898).implForWrapper,j.nodeCanvas=u(245).Canvas,j.window=le,DOMParser=j.window.DOMParser}function ue(I,A){var P=I.canvas,O=A.targetCanvas,b=O.getContext("2d");b.translate(0,O.height),b.scale(1,-1),b.drawImage(P,0,P.height-O.height,O.width,O.height,0,0,O.width,O.height)}function xe(I,A){var P=A.targetCanvas.getContext("2d"),O=A.destinationWidth,b=A.destinationHeight,D=O*b*4,k=new Uint8Array(this.imageBuffer,0,D),U=new Uint8ClampedArray(this.imageBuffer,0,D);I.readPixels(0,0,O,b,I.RGBA,I.UNSIGNED_BYTE,k);var F=new ImageData(U,O,b);P.putImageData(F,0,0)}j.isTouchSupported="ontouchstart"in j.window||"ontouchstart"in j.document||j.window&&j.window.navigator&&j.window.navigator.maxTouchPoints>0,j.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,j.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],j.DPI=96,j.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",j.commaWsp="(?:\\s+,?\\s*|,\\s*)",j.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,j.reNonWord=/[ \n\.,;!\?\-]/,j.fontPaths={},j.iMatrix=[1,0,0,1,0,0],j.svgNS="http://www.w3.org/2000/svg",j.perfLimitSizeTotal=2097152,j.maxCacheSideLimit=4096,j.minCacheSideLimit=256,j.charWidthsCache={},j.textureSize=2048,j.disableStyleCopyPaste=!1,j.enableGLFiltering=!0,j.devicePixelRatio=j.window.devicePixelRatio||j.window.webkitDevicePixelRatio||j.window.mozDevicePixelRatio||1,j.browserShadowBlurConstant=1,j.arcToSegmentsCache={},j.boundsOfCurveCache={},j.cachesBoundsOfCurve=!0,j.forceGLPutImageData=!1,j.initFilterBackend=function(){return j.enableGLFiltering&&j.isWebglSupported&&j.isWebglSupported(j.textureSize)?(console.log("max texture size: "+j.maxTextureSize),new j.WebglFilterBackend({tileSize:j.textureSize})):j.Canvas2dFilterBackend?new j.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=j),function(){function I(P,O){if(this.__eventListeners[P]){var b=this.__eventListeners[P];O?b[b.indexOf(O)]=!1:j.util.array.fill(b,!1)}}function A(P,O){var b=function(){O.apply(this,arguments),this.off(P,b)}.bind(this);this.on(P,b)}j.Observable={fire:function(P,O){if(!this.__eventListeners)return this;var b=this.__eventListeners[P];if(!b)return this;for(var D=0,k=b.length;D<k;D++)b[D]&&b[D].call(this,O||{});return this.__eventListeners[P]=b.filter(function(U){return!1!==U}),this},on:function(P,O){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var b in P)this.on(b,P[b]);else this.__eventListeners[P]||(this.__eventListeners[P]=[]),this.__eventListeners[P].push(O);return this},once:function(P,O){if(1===arguments.length)for(var b in P)A.call(this,b,P[b]);else A.call(this,P,O);return this},off:function(P,O){if(!this.__eventListeners)return this;if(0===arguments.length)for(P in this.__eventListeners)I.call(this,P);else if(1===arguments.length&&"object"==typeof arguments[0])for(var b in P)I.call(this,b,P[b]);else I.call(this,P,O);return this}}}(),j.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var I=0,A=arguments.length;I<A;I++)this._onObjectAdded(arguments[I]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(I,A,P){var O=this._objects;return P?O[A]=I:O.splice(A,0,I),this._onObjectAdded&&this._onObjectAdded(I),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var I,A=this._objects,P=!1,O=0,b=arguments.length;O<b;O++)-1!==(I=A.indexOf(arguments[O]))&&(P=!0,A.splice(I,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[O]));return this.renderOnAddRemove&&P&&this.requestRenderAll(),this},forEachObject:function(I,A){for(var P=this.getObjects(),O=0,b=P.length;O<b;O++)I.call(A,P[O],O,P);return this},getObjects:function(I){return void 0===I?this._objects.concat():this._objects.filter(function(A){return A.type===I})},item:function(I){return this._objects[I]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(I,A){return this._objects.indexOf(I)>-1||!!A&&this._objects.some(function(P){return"function"==typeof P.contains&&P.contains(I,!0)})},complexity:function(){return this._objects.reduce(function(I,A){return I+(A.complexity?A.complexity():0)},0)}},j.CommonMethods={_setOptions:function(I){for(var A in I)this.set(A,I[A])},_initGradient:function(I,A){!I||!I.colorStops||I instanceof j.Gradient||this.set(A,new j.Gradient(I))},_initPattern:function(I,A,P){!I||!I.source||I instanceof j.Pattern?P&&P():this.set(A,new j.Pattern(I,P))},_setObject:function(I){for(var A in I)this._set(A,I[A])},set:function(I,A){return"object"==typeof I?this._setObject(I):this._set(I,A),this},_set:function(I,A){this[I]=A},toggle:function(I){var A=this.get(I);return"boolean"==typeof A&&this.set(I,!A),this},get:function(I){return this[I]}},f=l,g=Math.sqrt,m=Math.atan2,v=Math.pow,y=Math.PI/180,x=Math.PI/2,j.util={cos:function(I){if(0===I)return 1;switch(I<0&&(I=-I),I/x){case 1:case 3:return 0;case 2:return-1}return Math.cos(I)},sin:function(I){if(0===I)return 0;var A=1;switch(I<0&&(A=-1),I/x){case 1:return A;case 2:return 0;case 3:return-A}return Math.sin(I)},removeFromArray:function(I,A){var P=I.indexOf(A);return-1!==P&&I.splice(P,1),I},getRandomInt:function(I,A){return Math.floor(Math.random()*(A-I+1))+I},degreesToRadians:function(I){return I*y},radiansToDegrees:function(I){return I/y},rotatePoint:function(I,A,P){var O=new j.Point(I.x-A.x,I.y-A.y),b=j.util.rotateVector(O,P);return new j.Point(b.x,b.y).addEquals(A)},rotateVector:function(I,A){var P=j.util.sin(A),O=j.util.cos(A);return{x:I.x*O-I.y*P,y:I.x*P+I.y*O}},createVector:function(I,A){return new j.Point(A.x-I.x,A.y-I.y)},calcAngleBetweenVectors:function(I,A){return Math.acos((I.x*A.x+I.y*A.y)/(Math.hypot(I.x,I.y)*Math.hypot(A.x,A.y)))},getHatVector:function(I){return new j.Point(I.x,I.y).multiply(1/Math.hypot(I.x,I.y))},getBisector:function(I,A,P){var O=j.util.createVector(I,A),b=j.util.createVector(I,P),D=j.util.calcAngleBetweenVectors(O,b),k=D*(0===j.util.calcAngleBetweenVectors(j.util.rotateVector(O,D),b)?1:-1)/2;return{vector:j.util.getHatVector(j.util.rotateVector(O,k)),angle:D}},projectStrokeOnPoints:function(I,A,P){var O=[],b=A.strokeWidth/2,D=A.strokeUniform?new j.Point(1/A.scaleX,1/A.scaleY):new j.Point(1,1),k=function(U){var F=b/Math.hypot(U.x,U.y);return new j.Point(U.x*F*D.x,U.y*F*D.y)};return I.length<=1||I.forEach(function(U,F){var B,W,$=new j.Point(U.x,U.y);0===F?(W=I[F+1],B=P?k(j.util.createVector(W,$)).addEquals($):I[I.length-1]):F===I.length-1?(B=I[F-1],W=P?k(j.util.createVector(B,$)).addEquals($):I[0]):(B=I[F-1],W=I[F+1]);var Y,J,X=j.util.getBisector($,B,W),ie=X.vector;if("miter"===A.strokeLineJoin&&(Y=-b/Math.sin(X.angle/2),J=new j.Point(ie.x*Y*D.x,ie.y*Y*D.y),Math.hypot(J.x,J.y)/b<=A.strokeMiterLimit))return O.push($.add(J)),void O.push($.subtract(J));Y=-b*Math.SQRT2,J=new j.Point(ie.x*Y*D.x,ie.y*Y*D.y),O.push($.add(J)),O.push($.subtract(J))}),O},transformPoint:function(I,A,P){return P?new j.Point(A[0]*I.x+A[2]*I.y,A[1]*I.x+A[3]*I.y):new j.Point(A[0]*I.x+A[2]*I.y+A[4],A[1]*I.x+A[3]*I.y+A[5])},makeBoundingBoxFromPoints:function(I,A){if(A)for(var P=0;P<I.length;P++)I[P]=j.util.transformPoint(I[P],A);var O=[I[0].x,I[1].x,I[2].x,I[3].x],b=j.util.array.min(O),D=j.util.array.max(O)-b,k=[I[0].y,I[1].y,I[2].y,I[3].y],U=j.util.array.min(k);return{left:b,top:U,width:D,height:j.util.array.max(k)-U}},invertTransform:function(I){var A=1/(I[0]*I[3]-I[1]*I[2]),P=[A*I[3],-A*I[1],-A*I[2],A*I[0]],O=j.util.transformPoint({x:I[4],y:I[5]},P,!0);return P[4]=-O.x,P[5]=-O.y,P},toFixed:function(I,A){return parseFloat(Number(I).toFixed(A))},parseUnit:function(I,A){var P=/\D{0,2}$/.exec(I),O=parseFloat(I);switch(A||(A=j.Text.DEFAULT_SVG_FONT_SIZE),P[0]){case"mm":return O*j.DPI/25.4;case"cm":return O*j.DPI/2.54;case"in":return O*j.DPI;case"pt":return O*j.DPI/72;case"pc":return O*j.DPI/72*12;case"em":return O*A;default:return O}},falseFunction:function(){return!1},getKlass:function(I,A){return I=j.util.string.camelize(I.charAt(0).toUpperCase()+I.slice(1)),j.util.resolveNamespace(A)[I]},getSvgAttributes:function(I){var A=["instantiated_by_use","style","id","class"];switch(I){case"linearGradient":A=A.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":A=A.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":A=A.concat(["offset","stop-color","stop-opacity"])}return A},resolveNamespace:function(I){if(!I)return j;var A,P=I.split("."),O=P.length,b=f||j.window;for(A=0;A<O;++A)b=b[P[A]];return b},loadImage:function(I,A,P,O){if(I){var b=j.util.createImage(),D=function(){A&&A.call(P,b,!1),b=b.onload=b.onerror=null};b.onload=D,b.onerror=function(){j.log("Error loading "+b.src),A&&A.call(P,null,!0),b=b.onload=b.onerror=null},0!==I.indexOf("data")&&null!=O&&(b.crossOrigin=O),"data:image/svg"===I.substring(0,14)&&(b.onload=null,j.util.loadImageInDom(b,D)),b.src=I}else A&&A.call(P,I)},loadImageInDom:function(I,A){var P=j.document.createElement("div");P.style.width=P.style.height="1px",P.style.left=P.style.top="-100%",P.style.position="absolute",P.appendChild(I),j.document.querySelector("body").appendChild(P),I.onload=function(){A(),P.parentNode.removeChild(P),P=null}},enlivenObjects:function(I,A,P,O){var b=[],D=0,k=(I=I||[]).length;function U(){++D===k&&A&&A(b.filter(function(F){return F}))}k?I.forEach(function(F,B){F&&F.type?j.util.getKlass(F.type,P).fromObject(F,function(W,$){$||(b[B]=W),O&&O(F,W,$),U()}):U()}):A&&A(b)},enlivenObjectEnlivables:function(I,A,P){var O=j.Object.ENLIVEN_PROPS.filter(function(b){return!!I[b]});j.util.enlivenObjects(O.map(function(b){return I[b]}),function(b){var D={};O.forEach(function(k,U){D[k]=b[U],A&&(A[k]=b[U])}),P&&P(D)})},enlivenPatterns:function(I,A){function P(){++b===D&&A&&A(O)}var O=[],b=0,D=(I=I||[]).length;D?I.forEach(function(k,U){k&&k.source?new j.Pattern(k,function(F){O[U]=F,P()}):(O[U]=k,P())}):A&&A(O)},groupSVGElements:function(I,A,P){var O;return I&&1===I.length?I[0]:(A&&(A.width&&A.height?A.centerPoint={x:A.width/2,y:A.height/2}:(delete A.width,delete A.height)),O=new j.Group(I,A),void 0!==P&&(O.sourcePath=P),O)},populateWithProperties:function(I,A,P){if(P&&Array.isArray(P))for(var O=0,b=P.length;O<b;O++)P[O]in I&&(A[P[O]]=I[P[O]])},createCanvasElement:function(){return j.document.createElement("canvas")},copyCanvasElement:function(I){var A=j.util.createCanvasElement();return A.width=I.width,A.height=I.height,A.getContext("2d").drawImage(I,0,0),A},toDataURL:function(I,A,P){return I.toDataURL("image/"+A,P)},createImage:function(){return j.document.createElement("img")},multiplyTransformMatrices:function(I,A,P){return[I[0]*A[0]+I[2]*A[1],I[1]*A[0]+I[3]*A[1],I[0]*A[2]+I[2]*A[3],I[1]*A[2]+I[3]*A[3],P?0:I[0]*A[4]+I[2]*A[5]+I[4],P?0:I[1]*A[4]+I[3]*A[5]+I[5]]},qrDecompose:function(I){var A=m(I[1],I[0]),P=v(I[0],2)+v(I[1],2),O=g(P),b=(I[0]*I[3]-I[2]*I[1])/O,D=m(I[0]*I[2]+I[1]*I[3],P);return{angle:A/y,scaleX:O,scaleY:b,skewX:D/y,skewY:0,translateX:I[4],translateY:I[5]}},calcRotateMatrix:function(I){if(!I.angle)return j.iMatrix.concat();var A=j.util.degreesToRadians(I.angle),P=j.util.cos(A),O=j.util.sin(A);return[P,O,-O,P,0,0]},calcDimensionsMatrix:function(I){var A=void 0===I.scaleX?1:I.scaleX,P=void 0===I.scaleY?1:I.scaleY,O=[I.flipX?-A:A,0,0,I.flipY?-P:P,0,0],b=j.util.multiplyTransformMatrices,D=j.util.degreesToRadians;return I.skewX&&(O=b(O,[1,0,Math.tan(D(I.skewX)),1],!0)),I.skewY&&(O=b(O,[1,Math.tan(D(I.skewY)),0,1],!0)),O},composeMatrix:function(I){var A=[1,0,0,1,I.translateX||0,I.translateY||0],P=j.util.multiplyTransformMatrices;return I.angle&&(A=P(A,j.util.calcRotateMatrix(I))),(1!==I.scaleX||1!==I.scaleY||I.skewX||I.skewY||I.flipX||I.flipY)&&(A=P(A,j.util.calcDimensionsMatrix(I))),A},resetObjectTransform:function(I){I.scaleX=1,I.scaleY=1,I.skewX=0,I.skewY=0,I.flipX=!1,I.flipY=!1,I.rotate(0)},saveObjectTransform:function(I){return{scaleX:I.scaleX,scaleY:I.scaleY,skewX:I.skewX,skewY:I.skewY,angle:I.angle,left:I.left,flipX:I.flipX,flipY:I.flipY,top:I.top}},isTransparent:function(I,A,P,O){O>0&&(A>O?A-=O:A=0,P>O?P-=O:P=0);var b,D=!0,k=I.getImageData(A,P,2*O||1,2*O||1),U=k.data.length;for(b=3;b<U&&0!=(D=k.data[b]<=0);b+=4);return k=null,D},parsePreserveAspectRatioAttribute:function(I){var A,P="meet",O=I.split(" ");return O&&O.length&&("meet"!==(P=O.pop())&&"slice"!==P?(A=P,P="meet"):O.length&&(A=O.pop())),{meetOrSlice:P,alignX:"none"!==A?A.slice(1,4):"none",alignY:"none"!==A?A.slice(5,8):"none"}},clearFabricFontCache:function(I){(I=(I||"").toLowerCase())?j.charWidthsCache[I]&&delete j.charWidthsCache[I]:j.charWidthsCache={}},limitDimsByArea:function(I,A){var P=Math.sqrt(A*I),O=Math.floor(A/P);return{x:Math.floor(P),y:O}},capValue:function(I,A,P){return Math.max(I,Math.min(A,P))},findScaleToFit:function(I,A){return Math.min(A.width/I.width,A.height/I.height)},findScaleToCover:function(I,A){return Math.max(A.width/I.width,A.height/I.height)},matrixToSVG:function(I){return"matrix("+I.map(function(A){return j.util.toFixed(A,j.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(I,A){var P=j.util.invertTransform(A),O=j.util.multiplyTransformMatrices(P,I.calcOwnMatrix());j.util.applyTransformToObject(I,O)},addTransformToObject:function(I,A){j.util.applyTransformToObject(I,j.util.multiplyTransformMatrices(A,I.calcOwnMatrix()))},applyTransformToObject:function(I,A){var P=j.util.qrDecompose(A),O=new j.Point(P.translateX,P.translateY);I.flipX=!1,I.flipY=!1,I.set("scaleX",P.scaleX),I.set("scaleY",P.scaleY),I.skewX=P.skewX,I.skewY=P.skewY,I.angle=P.angle,I.setPositionByOrigin(O,"center","center")},sizeAfterTransform:function(I,A,P){var O=I/2,b=A/2,D=[{x:-O,y:-b},{x:O,y:-b},{x:-O,y:b},{x:O,y:b}],k=j.util.calcDimensionsMatrix(P),U=j.util.makeBoundingBoxFromPoints(D,k);return{x:U.width,y:U.height}},mergeClipPaths:function(I,A){var P=I,O=A;P.inverted&&!O.inverted&&(P=A,O=I),j.util.applyTransformToObject(O,j.util.multiplyTransformMatrices(j.util.invertTransform(P.calcTransformMatrix()),O.calcTransformMatrix()));var b=P.inverted&&O.inverted;return b&&(P.inverted=O.inverted=!1),new j.Group([P],{clipPath:O,inverted:b})}},function(){var I=Array.prototype.join,A={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},P={m:"l",M:"L"};function O(J,X,ie,oe,de,ve,Ae,Ce,_e,ge,ce){var be=j.util.cos(J),Ie=j.util.sin(J),De=j.util.cos(X),re=j.util.sin(X),he=ie*de*De-oe*ve*re+Ae,we=oe*de*De+ie*ve*re+Ce;return["C",ge+_e*(-ie*de*Ie-oe*ve*be),ce+_e*(-oe*de*Ie+ie*ve*be),he+_e*(ie*de*re+oe*ve*De),we+_e*(oe*de*re-ie*ve*De),he,we]}function b(J,X,ie,oe){var de=Math.atan2(X,J),ve=Math.atan2(oe,ie);return ve>=de?ve-de:2*Math.PI-(de-ve)}function D(J,X,ie){for(var _e=function(be,Ie,De,re,he,we,Pe){var Ee=Math.PI,Me=Pe*Ee/180,Oe=j.util.sin(Me),Be=j.util.cos(Me),Le=0,He=0,We=-Be*be*.5-Oe*Ie*.5,Je=-Be*Ie*.5+Oe*be*.5,Qe=(De=Math.abs(De))*De,Xe=(re=Math.abs(re))*re,St=Je*Je,ni=We*We,Ws=Qe*Xe-Qe*St-Xe*ni,Fa=0;if(Ws<0){var Mc=Math.sqrt(1-Ws/(Qe*Xe));De*=Mc,re*=Mc}else Fa=(he===we?-1:1)*Math.sqrt(Ws/(Qe*St+Xe*ni));var on=Fa*De*Je/re,jr=-Fa*re*We/De,cu=Be*on-Oe*jr+.5*be,Bh=Oe*on+Be*jr+.5*Ie,kc=b(1,0,(We-on)/De,(Je-jr)/re),Uh=b((We-on)/De,(Je-jr)/re,(-We-on)/De,(-Je-jr)/re);0===we&&Uh>0?Uh-=2*Ee:1===we&&Uh<0&&(Uh+=2*Ee);for(var ww=Math.ceil(Math.abs(Uh/Ee*2)),hu=[],Vh=Uh/ww,du=8/3*Math.sin(Vh/4)*Math.sin(Vh/4)/Math.sin(Vh/2),wD=kc+Vh,ev=0;ev<ww;ev++)hu[ev]=O(kc,wD,Be,Oe,De,re,cu,Bh,du,Le,He),Le=hu[ev][5],He=hu[ev][6],kc=wD,wD+=Vh;return hu}(ie[6]-J,ie[7]-X,ie[1],ie[2],ie[4],ie[5],ie[3]),ge=0,ce=_e.length;ge<ce;ge++)_e[ge][1]+=J,_e[ge][2]+=X,_e[ge][3]+=J,_e[ge][4]+=X,_e[ge][5]+=J,_e[ge][6]+=X;return _e}function k(J,X,ie,oe){return Math.sqrt((ie-J)*(ie-J)+(oe-X)*(oe-X))}function U(J,X,ie,oe,de,ve,Ae,Ce){return function(_e){var ge,re,ce=(ge=_e)*ge*ge,be=3*(re=_e)*re*(1-re),Ie=function(re){return 3*re*(1-re)*(1-re)}(_e),De=function(re){return(1-re)*(1-re)*(1-re)}(_e);return{x:Ae*ce+de*be+ie*Ie+J*De,y:Ce*ce+ve*be+oe*Ie+X*De}}}function F(J,X,ie,oe,de,ve,Ae,Ce){return function(_e){var ge=1-_e;return Math.atan2(3*ge*ge*(oe-X)+6*ge*_e*(ve-oe)+3*_e*_e*(Ce-ve),3*ge*ge*(ie-J)+6*ge*_e*(de-ie)+3*_e*_e*(Ae-de))}}function B(J,X,ie,oe,de,ve){return function(Ae){var Ce,be,_e=(Ce=Ae)*Ce,ge=2*(be=Ae)*(1-be),ce=function(be){return(1-be)*(1-be)}(Ae);return{x:de*_e+ie*ge+J*ce,y:ve*_e+oe*ge+X*ce}}}function W(J,X,ie,oe,de,ve){return function(Ae){var Ce=1-Ae;return Math.atan2(2*Ce*(oe-X)+2*Ae*(ve-oe),2*Ce*(ie-J)+2*Ae*(de-ie))}}function $(J,X,ie){var oe,de,ve={x:X,y:ie},Ae=0;for(de=1;de<=100;de+=1)oe=J(de/100),Ae+=k(ve.x,ve.y,oe.x,oe.y),ve=oe;return Ae}function Y(J){for(var X,ie,oe,de,ve=0,Ae=J.length,Ce=0,_e=0,ge=0,ce=0,be=[],Ie=0;Ie<Ae;Ie++){switch(oe={x:Ce,y:_e,command:(X=J[Ie])[0]},X[0]){case"M":oe.length=0,ge=Ce=X[1],ce=_e=X[2];break;case"L":oe.length=k(Ce,_e,X[1],X[2]),Ce=X[1],_e=X[2];break;case"C":ie=U(Ce,_e,X[1],X[2],X[3],X[4],X[5],X[6]),de=F(Ce,_e,X[1],X[2],X[3],X[4],X[5],X[6]),oe.iterator=ie,oe.angleFinder=de,oe.length=$(ie,Ce,_e),Ce=X[5],_e=X[6];break;case"Q":ie=B(Ce,_e,X[1],X[2],X[3],X[4]),de=W(Ce,_e,X[1],X[2],X[3],X[4]),oe.iterator=ie,oe.angleFinder=de,oe.length=$(ie,Ce,_e),Ce=X[3],_e=X[4];break;case"Z":case"z":oe.destX=ge,oe.destY=ce,oe.length=k(Ce,_e,ge,ce),Ce=ge,_e=ce}ve+=oe.length,be.push(oe)}return be.push({length:ve,x:Ce,y:_e}),be}j.util.joinPath=function(J){return J.map(function(X){return X.join(" ")}).join(" ")},j.util.parsePath=function(J){var X,ie,oe,de,ve,Ae=[],Ce=[],_e=j.rePathCommand,ge="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",ce="("+ge+")"+j.commaWsp,be="([01])"+j.commaWsp+"?",Ie=new RegExp(ce+"?"+ce+"?"+ce+be+be+ce+"?("+ge+")","g");if(!J||!J.match)return Ae;for(var De,re=0,he=(ve=J.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;re<he;re++){de=(X=ve[re]).slice(1).trim(),Ce.length=0;var we=X.charAt(0);if(De=[we],"a"===we.toLowerCase())for(var Pe;Pe=Ie.exec(de);)for(var Ee=1;Ee<Pe.length;Ee++)Ce.push(Pe[Ee]);else for(;oe=_e.exec(de);)Ce.push(oe[0]);Ee=0;for(var Me=Ce.length;Ee<Me;Ee++)ie=parseFloat(Ce[Ee]),isNaN(ie)||De.push(ie);var Oe=A[we.toLowerCase()],Be=P[we]||we;if(De.length-1>Oe)for(var Le=1,He=De.length;Le<He;Le+=Oe)Ae.push([we].concat(De.slice(Le,Le+Oe))),we=Be;else Ae.push(De)}return Ae},j.util.makePathSimpler=function(J){var X,ie,oe,de,ve,Ae,Ce=0,_e=0,ge=J.length,ce=0,be=0,Ie=[];for(ie=0;ie<ge;++ie){switch(oe=!1,(X=J[ie].slice(0))[0]){case"l":X[0]="L",X[1]+=Ce,X[2]+=_e;case"L":Ce=X[1],_e=X[2];break;case"h":X[1]+=Ce;case"H":X[0]="L",X[2]=_e,Ce=X[1];break;case"v":X[1]+=_e;case"V":X[0]="L",_e=X[1],X[1]=Ce,X[2]=_e;break;case"m":X[0]="M",X[1]+=Ce,X[2]+=_e;case"M":Ce=X[1],_e=X[2],ce=X[1],be=X[2];break;case"c":X[0]="C",X[1]+=Ce,X[2]+=_e,X[3]+=Ce,X[4]+=_e,X[5]+=Ce,X[6]+=_e;case"C":ve=X[3],Ae=X[4],Ce=X[5],_e=X[6];break;case"s":X[0]="S",X[1]+=Ce,X[2]+=_e,X[3]+=Ce,X[4]+=_e;case"S":"C"===de?(ve=2*Ce-ve,Ae=2*_e-Ae):(ve=Ce,Ae=_e),Ce=X[3],_e=X[4],X[0]="C",X[5]=X[3],X[6]=X[4],X[3]=X[1],X[4]=X[2],X[1]=ve,X[2]=Ae,ve=X[3],Ae=X[4];break;case"q":X[0]="Q",X[1]+=Ce,X[2]+=_e,X[3]+=Ce,X[4]+=_e;case"Q":ve=X[1],Ae=X[2],Ce=X[3],_e=X[4];break;case"t":X[0]="T",X[1]+=Ce,X[2]+=_e;case"T":"Q"===de?(ve=2*Ce-ve,Ae=2*_e-Ae):(ve=Ce,Ae=_e),X[0]="Q",Ce=X[1],_e=X[2],X[1]=ve,X[2]=Ae,X[3]=Ce,X[4]=_e;break;case"a":X[0]="A",X[6]+=Ce,X[7]+=_e;case"A":oe=!0,Ie=Ie.concat(D(Ce,_e,X)),Ce=X[6],_e=X[7];break;case"z":case"Z":Ce=ce,_e=be}oe||Ie.push(X),de=X[0]}return Ie},j.util.getSmoothPathFromPoints=function(J,X){var ie,oe=[],de=new j.Point(J[0].x,J[0].y),ve=new j.Point(J[1].x,J[1].y),Ae=J.length,Ce=1,_e=0,ge=Ae>2;for(ge&&(Ce=J[2].x<ve.x?-1:J[2].x===ve.x?0:1,_e=J[2].y<ve.y?-1:J[2].y===ve.y?0:1),oe.push(["M",de.x-Ce*(X=X||0),de.y-_e*X]),ie=1;ie<Ae;ie++){if(!de.eq(ve)){var ce=de.midPointFrom(ve);oe.push(["Q",de.x,de.y,ce.x,ce.y])}de=J[ie],ie+1<J.length&&(ve=J[ie+1])}return ge&&(Ce=de.x>J[ie-2].x?1:de.x===J[ie-2].x?0:-1,_e=de.y>J[ie-2].y?1:de.y===J[ie-2].y?0:-1),oe.push(["L",de.x+Ce*X,de.y+_e*X]),oe},j.util.getPathSegmentsInfo=Y,j.util.getBoundsOfCurve=function(J,X,ie,oe,de,ve,Ae,Ce){var _e;if(j.cachesBoundsOfCurve&&(_e=I.call(arguments),j.boundsOfCurveCache[_e]))return j.boundsOfCurveCache[_e];var ge,ce,be,Ie,De,re,he,we,Pe=Math.sqrt,Ee=Math.min,Me=Math.max,Oe=Math.abs,Be=[],Le=[[],[]];ce=6*J-12*ie+6*de,ge=-3*J+9*ie-9*de+3*Ae,be=3*ie-3*J;for(var He=0;He<2;++He)if(He>0&&(ce=6*X-12*oe+6*ve,ge=-3*X+9*oe-9*ve+3*Ce,be=3*oe-3*X),Oe(ge)<1e-12){if(Oe(ce)<1e-12)continue;0<(Ie=-be/ce)&&Ie<1&&Be.push(Ie)}else(he=ce*ce-4*be*ge)<0||(0<(De=(-ce+(we=Pe(he)))/(2*ge))&&De<1&&Be.push(De),0<(re=(-ce-we)/(2*ge))&&re<1&&Be.push(re));for(var We,Qe,Xe=Be.length,St=Xe;Xe--;)We=(Qe=1-(Ie=Be[Xe]))*Qe*Qe*J+3*Qe*Qe*Ie*ie+3*Qe*Ie*Ie*de+Ie*Ie*Ie*Ae,Le[0][Xe]=We,Le[1][Xe]=Qe*Qe*Qe*X+3*Qe*Qe*Ie*oe+3*Qe*Ie*Ie*ve+Ie*Ie*Ie*Ce;Le[0][St]=J,Le[1][St]=X,Le[0][St+1]=Ae,Le[1][St+1]=Ce;var ni=[{x:Ee.apply(null,Le[0]),y:Ee.apply(null,Le[1])},{x:Me.apply(null,Le[0]),y:Me.apply(null,Le[1])}];return j.cachesBoundsOfCurve&&(j.boundsOfCurveCache[_e]=ni),ni},j.util.getPointOnPath=function(J,X,ie){ie||(ie=Y(J));for(var oe=0;X-ie[oe].length>0&&oe<ie.length-2;)X-=ie[oe].length,oe++;var de,ve=ie[oe],Ae=X/ve.length,_e=J[oe];switch(ve.command){case"M":return{x:ve.x,y:ve.y,angle:0};case"Z":case"z":return(de=new j.Point(ve.x,ve.y).lerp(new j.Point(ve.destX,ve.destY),Ae)).angle=Math.atan2(ve.destY-ve.y,ve.destX-ve.x),de;case"L":return(de=new j.Point(ve.x,ve.y).lerp(new j.Point(_e[1],_e[2]),Ae)).angle=Math.atan2(_e[2]-ve.y,_e[1]-ve.x),de;case"C":case"Q":return function(ge,ce){for(var be,Ie,De,re=0,he=0,we=ge.iterator,Pe={x:ge.x,y:ge.y},Ee=.01,Me=ge.angleFinder;he<ce&&Ee>1e-4;)be=we(re),De=re,(Ie=k(Pe.x,Pe.y,be.x,be.y))+he>ce?(re-=Ee,Ee/=2):(Pe=be,re+=Ee,he+=Ie);return be.angle=Me(De),be}(ve,X)}},j.util.transformPath=function(J,X,ie){return ie&&(X=j.util.multiplyTransformMatrices(X,[1,0,0,1,-ie.x,-ie.y])),J.map(function(oe){for(var de=oe.slice(0),ve={},Ae=1;Ae<oe.length-1;Ae+=2)ve.x=oe[Ae],ve.y=oe[Ae+1],ve=j.util.transformPoint(ve,X),de[Ae]=ve.x,de[Ae+1]=ve.y;return de})}}(),function(){var I=Array.prototype.slice;function A(P,O,b){if(P&&0!==P.length){var D=P.length-1,k=O?P[D][O]:P[D];if(O)for(;D--;)b(P[D][O],k)&&(k=P[D][O]);else for(;D--;)b(P[D],k)&&(k=P[D]);return k}}j.util.array={fill:function(P,O){for(var b=P.length;b--;)P[b]=O;return P},invoke:function(P,O){for(var b=I.call(arguments,2),D=[],k=0,U=P.length;k<U;k++)D[k]=b.length?P[k][O].apply(P[k],b):P[k][O].call(P[k]);return D},min:function(P,O){return A(P,O,function(b,D){return b<D})},max:function(P,O){return A(P,O,function(b,D){return b>=D})}}}(),function(){function I(A,P,O){if(O)if(!j.isLikelyNode&&P instanceof Element)A=P;else if(P instanceof Array){A=[];for(var b=0,D=P.length;b<D;b++)A[b]=I({},P[b],O)}else if(P&&"object"==typeof P)for(var k in P)"canvas"===k||"group"===k?A[k]=null:P.hasOwnProperty(k)&&(A[k]=I({},P[k],O));else A=P;else for(var k in P)A[k]=P[k];return A}j.util.object={extend:I,clone:function(A,P){return I({},A,P)}},j.util.object.extend(j.util,j.Observable)}(),function(){function I(A,P){var O=A.charCodeAt(P);if(isNaN(O))return"";if(O<55296||O>57343)return A.charAt(P);if(55296<=O&&O<=56319){if(A.length<=P+1)throw"High surrogate without following low surrogate";var b=A.charCodeAt(P+1);if(56320>b||b>57343)throw"High surrogate without following low surrogate";return A.charAt(P)+A.charAt(P+1)}if(0===P)throw"Low surrogate without preceding high surrogate";var D=A.charCodeAt(P-1);if(55296>D||D>56319)throw"Low surrogate without preceding high surrogate";return!1}j.util.string={camelize:function(A){return A.replace(/-+(.)?/g,function(P,O){return O?O.toUpperCase():""})},capitalize:function(A,P){return A.charAt(0).toUpperCase()+(P?A.slice(1):A.slice(1).toLowerCase())},escapeXml:function(A){return A.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(A){var P,O=0,b=[];for(O=0;O<A.length;O++)!1!==(P=I(A,O))&&b.push(P);return b}}}(),function(){var I=Array.prototype.slice,A=function(){},P=function(){for(var k in{toString:1})if("toString"===k)return!1;return!0}(),O=function(k,U,F){for(var B in U)k.prototype[B]=B in k.prototype&&"function"==typeof k.prototype[B]&&(U[B]+"").indexOf("callSuper")>-1?function(W){return function(){var $=this.constructor.superclass;this.constructor.superclass=F;var Y=U[W].apply(this,arguments);if(this.constructor.superclass=$,"initialize"!==W)return Y}}(B):U[B],P&&(U.toString!==Object.prototype.toString&&(k.prototype.toString=U.toString),U.valueOf!==Object.prototype.valueOf&&(k.prototype.valueOf=U.valueOf))};function b(){}function D(k){for(var U=null,F=this;F.constructor.superclass;){var B=F.constructor.superclass.prototype[k];if(F[k]!==B){U=B;break}F=F.constructor.superclass.prototype}return U?arguments.length>1?U.apply(this,I.call(arguments,1)):U.call(this):console.log("tried to callSuper "+k+", method not found in prototype chain",this)}j.util.createClass=function(){var k=null,U=I.call(arguments,0);function F(){this.initialize.apply(this,arguments)}"function"==typeof U[0]&&(k=U.shift()),F.superclass=k,F.subclasses=[],k&&(b.prototype=k.prototype,F.prototype=new b,k.subclasses.push(F));for(var B=0,W=U.length;B<W;B++)O(F,U[B],k);return F.prototype.initialize||(F.prototype.initialize=A),F.prototype.constructor=F,F.prototype.callSuper=D,F}}(),w=!!j.document.createElement("div").attachEvent,C=["touchstart","touchmove","touchend"],j.util.addListener=function(I,A,P,O){I&&I.addEventListener(A,P,!w&&O)},j.util.removeListener=function(I,A,P,O){I&&I.removeEventListener(A,P,!w&&O)},j.util.getPointer=function(I){var b,D,P=j.util.getScrollLeftTop(I.target),O=(D=(b=I).changedTouches)&&D[0]?D[0]:b;return{x:O.clientX+P.left,y:O.clientY+P.top}},j.util.isTouchEvent=function(I){return C.indexOf(I.type)>-1||"touch"===I.pointerType},T="string"==typeof(_=j.document.createElement("div")).style.opacity,L=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,N=function(I){return I},T?N=function(I,A){return I.style.opacity=A,I}:"string"==typeof _.style.filter&&(N=function(I,A){var P=I.style;return I.currentStyle&&!I.currentStyle.hasLayout&&(P.zoom=1),L.test(P.filter)?P.filter=P.filter.replace(L,A=A>=.9999?"":"alpha(opacity="+100*A+")"):P.filter+=" alpha(opacity="+100*A+")",I}),j.util.setStyle=function(I,A){var P=I.style;if(!P)return I;if("string"==typeof A)return I.style.cssText+=";"+A,A.indexOf("opacity")>-1?N(I,A.match(/opacity:\s*(\d?\.?\d*)/)[1]):I;for(var O in A)"opacity"===O?N(I,A[O]):P["float"===O||"cssFloat"===O?void 0===P.styleFloat?"cssFloat":"styleFloat":O]=A[O];return I},function(){var I,A,P,O,b=Array.prototype.slice,D=function(F){return b.call(F,0)};try{I=D(j.document.childNodes)instanceof Array}catch(F){}function k(F,B){var W=j.document.createElement(F);for(var $ in B)"class"===$?W.className=B[$]:"for"===$?W.htmlFor=B[$]:W.setAttribute($,B[$]);return W}function U(F){for(var B=0,W=0,$=j.document.documentElement,Y=j.document.body||{scrollLeft:0,scrollTop:0};F&&(F.parentNode||F.host)&&((F=F.parentNode||F.host)===j.document?(B=Y.scrollLeft||$.scrollLeft||0,W=Y.scrollTop||$.scrollTop||0):(B+=F.scrollLeft||0,W+=F.scrollTop||0),1!==F.nodeType||"fixed"!==F.style.position););return{left:B,top:W}}I||(D=function(F){for(var B=new Array(F.length),W=F.length;W--;)B[W]=F[W];return B}),A=j.document.defaultView&&j.document.defaultView.getComputedStyle?function(F,B){var W=j.document.defaultView.getComputedStyle(F,null);return W?W[B]:void 0}:function(F,B){var W=F.style[B];return!W&&F.currentStyle&&(W=F.currentStyle[B]),W},O="userSelect"in(P=j.document.documentElement.style)?"userSelect":"MozUserSelect"in P?"MozUserSelect":"WebkitUserSelect"in P?"WebkitUserSelect":"KhtmlUserSelect"in P?"KhtmlUserSelect":"",j.util.makeElementUnselectable=function(F){return void 0!==F.onselectstart&&(F.onselectstart=j.util.falseFunction),O?F.style[O]="none":"string"==typeof F.unselectable&&(F.unselectable="on"),F},j.util.makeElementSelectable=function(F){return void 0!==F.onselectstart&&(F.onselectstart=null),O?F.style[O]="":"string"==typeof F.unselectable&&(F.unselectable=""),F},j.util.setImageSmoothing=function(F,B){F.imageSmoothingEnabled=F.imageSmoothingEnabled||F.webkitImageSmoothingEnabled||F.mozImageSmoothingEnabled||F.msImageSmoothingEnabled||F.oImageSmoothingEnabled,F.imageSmoothingEnabled=B},j.util.getById=function(F){return"string"==typeof F?j.document.getElementById(F):F},j.util.toArray=D,j.util.addClass=function(F,B){F&&-1===(" "+F.className+" ").indexOf(" "+B+" ")&&(F.className+=(F.className?" ":"")+B)},j.util.makeElement=k,j.util.wrapElement=function(F,B,W){return"string"==typeof B&&(B=k(B,W)),F.parentNode&&F.parentNode.replaceChild(B,F),B.appendChild(F),B},j.util.getScrollLeftTop=U,j.util.getElementOffset=function(F){var B,W,$=F&&F.ownerDocument,Y={left:0,top:0},J={left:0,top:0},X={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!$)return J;for(var ie in X)J[X[ie]]+=parseInt(A(F,ie),10)||0;return B=$.documentElement,void 0!==F.getBoundingClientRect&&(Y=F.getBoundingClientRect()),W=U(F),{left:Y.left+W.left-(B.clientLeft||0)+J.left,top:Y.top+W.top-(B.clientTop||0)+J.top}},j.util.getNodeCanvas=function(F){var B=j.jsdomImplForWrapper(F);return B._canvas||B._image},j.util.cleanUpJsdomNode=function(F){if(j.isLikelyNode){var B=j.jsdomImplForWrapper(F);B&&(B._image=null,B._canvas=null,B._currentSrc=null,B._attributes=null,B._classList=null)}}}(),function(){function I(){}j.util.request=function(A,P){P||(P={});var U,F,O=P.method?P.method.toUpperCase():"GET",b=P.onComplete||function(){},D=new j.window.XMLHttpRequest,k=P.body||P.parameters;return D.onreadystatechange=function(){4===D.readyState&&(b(D),D.onreadystatechange=I)},"GET"===O&&(k=null,"string"==typeof P.parameters&&(F=P.parameters,A=(U=A)+(/\?/.test(U)?"&":"?")+F)),D.open(O,A,!0),"POST"!==O&&"PUT"!==O||D.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),D.send(k),D}}(),j.log=console.log,j.warn=console.warn,function(){var I=j.util.object.extend,A=j.util.object.clone,P=[];function O(){return!1}function b(F,B,W,$){return-W*Math.cos(F/$*(Math.PI/2))+W+B}j.util.object.extend(P,{cancelAll:function(){var F=this.splice(0);return F.forEach(function(B){B.cancel()}),F},cancelByCanvas:function(F){if(!F)return[];var B=this.filter(function(W){return"object"==typeof W.target&&W.target.canvas===F});return B.forEach(function(W){W.cancel()}),B},cancelByTarget:function(F){var B=this.findAnimationsByTarget(F);return B.forEach(function(W){W.cancel()}),B},findAnimationIndex:function(F){return this.indexOf(this.findAnimation(F))},findAnimation:function(F){return this.find(function(B){return B.cancel===F})},findAnimationsByTarget:function(F){return F?this.filter(function(B){return B.target===F}):[]}});var D=j.window.requestAnimationFrame||j.window.webkitRequestAnimationFrame||j.window.mozRequestAnimationFrame||j.window.oRequestAnimationFrame||j.window.msRequestAnimationFrame||function(F){return j.window.setTimeout(F,1e3/60)},k=j.window.cancelAnimationFrame||j.window.clearTimeout;function U(){return D.apply(j.window,arguments)}j.util.animate=function(F){F||(F={});var B,W=!1,$=function(){var Y=j.runningAnimations.indexOf(B);return Y>-1&&j.runningAnimations.splice(Y,1)[0]};return B=I(A(F),{cancel:function(){return W=!0,$()},currentValue:"startValue"in F?F.startValue:0,completionRate:0,durationRate:0}),j.runningAnimations.push(B),U(function(Y){var J,X=Y||+new Date,ie=F.duration||500,oe=X+ie,de=F.onChange||O,ve=F.abort||O,Ae=F.onComplete||O,Ce=F.easing||b,_e="startValue"in F&&F.startValue.length>0,ge="startValue"in F?F.startValue:0,ce="endValue"in F?F.endValue:100,be=F.byValue||(_e?ge.map(function(Ie,De){return ce[De]-ge[De]}):ce-ge);F.onStart&&F.onStart(),function Ie(De){var re=(J=De||+new Date)>oe?ie:J-X,he=re/ie,we=_e?ge.map(function(Ee,Me){return Ce(re,ge[Me],be[Me],ie)}):Ce(re,ge,be,ie),Pe=Math.abs(_e?(we[0]-ge[0])/be[0]:(we-ge)/be);if(B.currentValue=_e?we.slice():we,B.completionRate=Pe,B.durationRate=he,!W){if(!ve(we,Pe,he))return J>oe?(B.currentValue=_e?ce.slice():ce,B.completionRate=1,B.durationRate=1,de(_e?ce.slice():ce,1,1),Ae(ce,1,1),void $()):(de(we,Pe,he),void U(Ie));$()}}(X)}),B.cancel},j.util.requestAnimFrame=U,j.util.cancelAnimFrame=function(){return k.apply(j.window,arguments)},j.runningAnimations=P}(),function(){function I(A,P,O){var b="rgba("+parseInt(A[0]+O*(P[0]-A[0]),10)+","+parseInt(A[1]+O*(P[1]-A[1]),10)+","+parseInt(A[2]+O*(P[2]-A[2]),10);return(b+=","+(A&&P?parseFloat(A[3]+O*(P[3]-A[3])):1))+")"}j.util.animateColor=function(A,P,O,b){var D=new j.Color(A).getSource(),k=new j.Color(P).getSource(),U=b.onComplete,F=b.onChange;return j.util.animate(j.util.object.extend(b=b||{},{duration:O||500,startValue:D,endValue:k,byValue:k,easing:function(B,W,$,Y){return I(W,$,b.colorEasing?b.colorEasing(B,Y):1-Math.cos(B/Y*(Math.PI/2)))},onComplete:function(B,W,$){if(U)return U(I(k,k,0),W,$)},onChange:function(B,W,$){if(F){if(Array.isArray(B))return F(I(B,B,0),W,$);F(B,W,$)}}}))}}(),function(){function I(b,D,k,U){return b<Math.abs(D)?(b=D,U=k/4):U=0===D&&0===b?k/(2*Math.PI)*Math.asin(1):k/(2*Math.PI)*Math.asin(D/b),{a:b,c:D,p:k,s:U}}function A(b,D,k){return b.a*Math.pow(2,10*(D-=1))*Math.sin((D*k-b.s)*(2*Math.PI)/b.p)}function P(b,D,k,U){return k-O(U-b,0,k,U)+D}function O(b,D,k,U){return(b/=U)<1/2.75?k*(7.5625*b*b)+D:b<2/2.75?k*(7.5625*(b-=1.5/2.75)*b+.75)+D:b<2.5/2.75?k*(7.5625*(b-=2.25/2.75)*b+.9375)+D:k*(7.5625*(b-=2.625/2.75)*b+.984375)+D}j.util.ease={easeInQuad:function(b,D,k,U){return k*(b/=U)*b+D},easeOutQuad:function(b,D,k,U){return-k*(b/=U)*(b-2)+D},easeInOutQuad:function(b,D,k,U){return(b/=U/2)<1?k/2*b*b+D:-k/2*(--b*(b-2)-1)+D},easeInCubic:function(b,D,k,U){return k*(b/=U)*b*b+D},easeOutCubic:function(b,D,k,U){return k*((b=b/U-1)*b*b+1)+D},easeInOutCubic:function(b,D,k,U){return(b/=U/2)<1?k/2*b*b*b+D:k/2*((b-=2)*b*b+2)+D},easeInQuart:function(b,D,k,U){return k*(b/=U)*b*b*b+D},easeOutQuart:function(b,D,k,U){return-k*((b=b/U-1)*b*b*b-1)+D},easeInOutQuart:function(b,D,k,U){return(b/=U/2)<1?k/2*b*b*b*b+D:-k/2*((b-=2)*b*b*b-2)+D},easeInQuint:function(b,D,k,U){return k*(b/=U)*b*b*b*b+D},easeOutQuint:function(b,D,k,U){return k*((b=b/U-1)*b*b*b*b+1)+D},easeInOutQuint:function(b,D,k,U){return(b/=U/2)<1?k/2*b*b*b*b*b+D:k/2*((b-=2)*b*b*b*b+2)+D},easeInSine:function(b,D,k,U){return-k*Math.cos(b/U*(Math.PI/2))+k+D},easeOutSine:function(b,D,k,U){return k*Math.sin(b/U*(Math.PI/2))+D},easeInOutSine:function(b,D,k,U){return-k/2*(Math.cos(Math.PI*b/U)-1)+D},easeInExpo:function(b,D,k,U){return 0===b?D:k*Math.pow(2,10*(b/U-1))+D},easeOutExpo:function(b,D,k,U){return b===U?D+k:k*(1-Math.pow(2,-10*b/U))+D},easeInOutExpo:function(b,D,k,U){return 0===b?D:b===U?D+k:(b/=U/2)<1?k/2*Math.pow(2,10*(b-1))+D:k/2*(2-Math.pow(2,-10*--b))+D},easeInCirc:function(b,D,k,U){return-k*(Math.sqrt(1-(b/=U)*b)-1)+D},easeOutCirc:function(b,D,k,U){return k*Math.sqrt(1-(b=b/U-1)*b)+D},easeInOutCirc:function(b,D,k,U){return(b/=U/2)<1?-k/2*(Math.sqrt(1-b*b)-1)+D:k/2*(Math.sqrt(1-(b-=2)*b)+1)+D},easeInElastic:function(b,D,k,U){var F=0;return 0===b?D:1==(b/=U)?D+k:(F||(F=.3*U),-A(I(k,k,F,1.70158),b,U)+D)},easeOutElastic:function(b,D,k,U){var F=0;if(0===b)return D;if(1==(b/=U))return D+k;F||(F=.3*U);var B=I(k,k,F,1.70158);return B.a*Math.pow(2,-10*b)*Math.sin((b*U-B.s)*(2*Math.PI)/B.p)+B.c+D},easeInOutElastic:function(b,D,k,U){var F=0;if(0===b)return D;if(2==(b/=U/2))return D+k;F||(F=U*(.3*1.5));var B=I(k,k,F,1.70158);return b<1?-.5*A(B,b,U)+D:B.a*Math.pow(2,-10*(b-=1))*Math.sin((b*U-B.s)*(2*Math.PI)/B.p)*.5+B.c+D},easeInBack:function(b,D,k,U,F){return void 0===F&&(F=1.70158),k*(b/=U)*b*((F+1)*b-F)+D},easeOutBack:function(b,D,k,U,F){return void 0===F&&(F=1.70158),k*((b=b/U-1)*b*((F+1)*b+F)+1)+D},easeInOutBack:function(b,D,k,U,F){return void 0===F&&(F=1.70158),(b/=U/2)<1?k/2*(b*b*((1+(F*=1.525))*b-F))+D:k/2*((b-=2)*b*((1+(F*=1.525))*b+F)+2)+D},easeInBounce:P,easeOutBounce:O,easeInOutBounce:function(b,D,k,U){return b<U/2?.5*P(2*b,0,k,U)+D:.5*O(2*b-U,0,k,U)+.5*k+D}}}(),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.util.object.clone,b=A.util.toFixed,D=A.util.parseUnit,k=A.util.multiplyTransformMatrices,U={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},F={stroke:"strokeOpacity",fill:"fillOpacity"},B="font-size",W="clip-path";function $(ge){return ge in U?U[ge]:ge}function Y(ge,ce,be,Ie){var De,re=Array.isArray(ce);if("fill"!==ge&&"stroke"!==ge||"none"!==ce){if("strokeUniform"===ge)return"non-scaling-stroke"===ce;if("strokeDashArray"===ge)ce="none"===ce?null:ce.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===ge)ce=be&&be.transformMatrix?k(be.transformMatrix,A.parseTransformAttribute(ce)):A.parseTransformAttribute(ce);else if("visible"===ge)ce="none"!==ce&&"hidden"!==ce,be&&!1===be.visible&&(ce=!1);else if("opacity"===ge)ce=parseFloat(ce),be&&void 0!==be.opacity&&(ce*=be.opacity);else if("textAnchor"===ge)ce="start"===ce?"left":"end"===ce?"right":"center";else if("charSpacing"===ge)De=D(ce,Ie)/Ie*1e3;else if("paintFirst"===ge){var he=ce.indexOf("fill"),we=ce.indexOf("stroke");ce="fill",(he>-1&&we>-1&&we<he||-1===he&&we>-1)&&(ce="stroke")}else{if("href"===ge||"xlink:href"===ge||"font"===ge)return ce;if("imageSmoothing"===ge)return"optimizeQuality"===ce;De=re?ce.map(D):D(ce,Ie)}}else ce="";return!re&&isNaN(De)?ce:De}function J(ge){return new RegExp("^("+ge.join("|")+")\\b","i")}function X(ge,ce){var Ie,De,re,he=[];for(De=0,re=ce.length;De<re;De++)Ie=ge.getElementsByTagName(ce[De]),he=he.concat(Array.prototype.slice.call(Ie));return he}function ie(ge,ce){var be,Ie=!0;return(be=oe(ge,ce.pop()))&&ce.length&&(Ie=function(De,re){for(var he,we=!0;De.parentNode&&1===De.parentNode.nodeType&&re.length;)we&&(he=re.pop()),we=oe(De=De.parentNode,he);return 0===re.length}(ge,ce)),be&&Ie&&0===ce.length}function oe(ge,ce){var be,Ie,De=ge.nodeName,re=ge.getAttribute("class"),he=ge.getAttribute("id");if(be=new RegExp("^"+De,"i"),ce=ce.replace(be,""),he&&ce.length&&(be=new RegExp("#"+he+"(?![a-zA-Z\\-]+)","i"),ce=ce.replace(be,"")),re&&ce.length)for(Ie=(re=re.split(" ")).length;Ie--;)be=new RegExp("\\."+re[Ie]+"(?![a-zA-Z\\-]+)","i"),ce=ce.replace(be,"");return 0===ce.length}function de(ge,ce){var be;if(ge.getElementById&&(be=ge.getElementById(ce)),be)return be;var Ie,De,re,he=ge.getElementsByTagName("*");for(De=0,re=he.length;De<re;De++)if(ce===(Ie=he[De]).getAttribute("id"))return Ie}A.svgValidTagNamesRegEx=J(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),A.svgViewBoxElementsRegEx=J(["symbol","image","marker","pattern","view","svg"]),A.svgInvalidAncestorsRegEx=J(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),A.svgValidParentsRegEx=J(["symbol","g","a","svg","clipPath","defs"]),A.cssRules={},A.gradientDefs={},A.clipPaths={},A.parseTransformAttribute=function(){function ge(we,Pe,Ee){we[Ee]=Math.tan(A.util.degreesToRadians(Pe[0]))}var ce=A.iMatrix,be=A.reNum,Ie=A.commaWsp,De="(?:(?:(matrix)\\s*\\(\\s*("+be+")"+Ie+"("+be+")"+Ie+"("+be+")"+Ie+"("+be+")"+Ie+"("+be+")"+Ie+"("+be+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+be+")(?:"+Ie+"("+be+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+be+")(?:"+Ie+"("+be+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+be+")(?:"+Ie+"("+be+")"+Ie+"("+be+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+be+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+be+")\\s*\\)))",re=new RegExp("^\\s*(?:(?:"+De+"(?:"+Ie+"*"+De+")*)?)\\s*$"),he=new RegExp(De,"g");return function(we){var Pe=ce.concat(),Ee=[];if(!we||we&&!re.test(we))return Pe;we.replace(he,function(Oe){var We,Je,Be=new RegExp(De).exec(Oe).filter(function(We){return!!We}),Le=Be[1],He=Be.slice(2).map(parseFloat);switch(Le){case"translate":(We=Pe)[4]=(Je=He)[0],2===Je.length&&(We[5]=Je[1]);break;case"rotate":He[0]=A.util.degreesToRadians(He[0]),function(We,Je){var Qe=A.util.cos(Je[0]),Xe=A.util.sin(Je[0]),St=0,ni=0;3===Je.length&&(St=Je[1],ni=Je[2]),We[0]=Qe,We[1]=Xe,We[2]=-Xe,We[3]=Qe,We[4]=St-(Qe*St-Xe*ni),We[5]=ni-(Xe*St+Qe*ni)}(Pe,He);break;case"scale":!function(We,Je){var Xe=2===Je.length?Je[1]:Je[0];We[0]=Je[0],We[3]=Xe}(Pe,He);break;case"skewX":ge(Pe,He,2);break;case"skewY":ge(Pe,He,1);break;case"matrix":Pe=He}Ee.push(Pe.concat()),Pe=ce.concat()});for(var Me=Ee[0];Ee.length>1;)Ee.shift(),Me=A.util.multiplyTransformMatrices(Me,Ee[0]);return Me}}();var ve=new RegExp("^\\s*("+A.reNum+"+)\\s*,?\\s*("+A.reNum+"+)\\s*,?\\s*("+A.reNum+"+)\\s*,?\\s*("+A.reNum+"+)\\s*$");function Ae(ge){if(!A.svgViewBoxElementsRegEx.test(ge.nodeName))return{};var ce,be,Ie,De,re,he,we=ge.getAttribute("viewBox"),Pe=1,Ee=1,Me=ge.getAttribute("width"),Oe=ge.getAttribute("height"),Be=ge.getAttribute("x")||0,Le=ge.getAttribute("y")||0,He=ge.getAttribute("preserveAspectRatio")||"",We=!we||!(we=we.match(ve)),Je=!Me||!Oe||"100%"===Me||"100%"===Oe,Qe=We&&Je,Xe={},St="",ni=0,Ws=0;if(Xe.width=0,Xe.height=0,Xe.toBeParsed=Qe,We&&(Be||Le)&&ge.parentNode&&"#document"!==ge.parentNode.nodeName&&(St=" translate("+D(Be)+" "+D(Le)+") ",re=(ge.getAttribute("transform")||"")+St,ge.setAttribute("transform",re),ge.removeAttribute("x"),ge.removeAttribute("y")),Qe)return Xe;if(We)return Xe.width=D(Me),Xe.height=D(Oe),Xe;if(ce=-parseFloat(we[1]),be=-parseFloat(we[2]),Ie=parseFloat(we[3]),De=parseFloat(we[4]),Xe.minX=ce,Xe.minY=be,Xe.viewBoxWidth=Ie,Xe.viewBoxHeight=De,Je?(Xe.width=Ie,Xe.height=De):(Xe.width=D(Me),Xe.height=D(Oe),Pe=Xe.width/Ie,Ee=Xe.height/De),"none"!==(He=A.util.parsePreserveAspectRatioAttribute(He)).alignX&&("meet"===He.meetOrSlice&&(Ee=Pe=Pe>Ee?Ee:Pe),"slice"===He.meetOrSlice&&(Ee=Pe=Pe>Ee?Pe:Ee),ni=Xe.width-Ie*Pe,Ws=Xe.height-De*Pe,"Mid"===He.alignX&&(ni/=2),"Mid"===He.alignY&&(Ws/=2),"Min"===He.alignX&&(ni=0),"Min"===He.alignY&&(Ws=0)),1===Pe&&1===Ee&&0===ce&&0===be&&0===Be&&0===Le)return Xe;if((Be||Le)&&"#document"!==ge.parentNode.nodeName&&(St=" translate("+D(Be)+" "+D(Le)+") "),re=St+" matrix("+Pe+" 0 0 "+Ee+" "+(ce*Pe+ni)+" "+(be*Ee+Ws)+") ","svg"===ge.nodeName){for(he=ge.ownerDocument.createElementNS(A.svgNS,"g");ge.firstChild;)he.appendChild(ge.firstChild);ge.appendChild(he)}else(he=ge).removeAttribute("x"),he.removeAttribute("y"),re=he.getAttribute("transform")+re;return he.setAttribute("transform",re),Xe}function Ce(ge,ce){var be="xlink:href",Ie=de(ge,ce.getAttribute(be).slice(1));if(Ie&&Ie.getAttribute(be)&&Ce(ge,Ie),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(re){Ie&&!ce.hasAttribute(re)&&Ie.hasAttribute(re)&&ce.setAttribute(re,Ie.getAttribute(re))}),!ce.children.length)for(var De=Ie.cloneNode(!0);De.firstChild;)ce.appendChild(De.firstChild);ce.removeAttribute(be)}A.parseSVGDocument=function(ge,ce,be,Ie){if(ge){!function(Be){for(var Le=X(Be,["use","svg:use"]),He=0;Le.length&&He<Le.length;){var We=Le[He],Je=We.getAttribute("xlink:href")||We.getAttribute("href");if(null===Je)return;var Qe,Xe,St,ni,Ws=Je.slice(1),Fa=We.getAttribute("x")||0,Mc=We.getAttribute("y")||0,on=de(Be,Ws).cloneNode(!0),jr=(on.getAttribute("transform")||"")+" translate("+Fa+", "+Mc+")",cu=Le.length,Bh=A.svgNS;if(Ae(on),/^svg$/i.test(on.nodeName)){var kc=on.ownerDocument.createElementNS(Bh,"g");for(Xe=0,ni=(St=on.attributes).length;Xe<ni;Xe++)Qe=St.item(Xe),kc.setAttributeNS(Bh,Qe.nodeName,Qe.nodeValue);for(;on.firstChild;)kc.appendChild(on.firstChild);on=kc}for(Xe=0,ni=(St=We.attributes).length;Xe<ni;Xe++)"x"!==(Qe=St.item(Xe)).nodeName&&"y"!==Qe.nodeName&&"xlink:href"!==Qe.nodeName&&"href"!==Qe.nodeName&&("transform"===Qe.nodeName?jr=Qe.nodeValue+" "+jr:on.setAttribute(Qe.nodeName,Qe.nodeValue));on.setAttribute("transform",jr),on.setAttribute("instantiated_by_use","1"),on.removeAttribute("id"),We.parentNode.replaceChild(on,We),Le.length===cu&&He++}}(ge);var De,re,he=A.Object.__uid++,we=Ae(ge),Pe=A.util.toArray(ge.getElementsByTagName("*"));if(we.crossOrigin=Ie&&Ie.crossOrigin,we.svgUid=he,0===Pe.length&&A.isLikelyNode){var Ee=[];for(De=0,re=(Pe=ge.selectNodes('//*[name(.)!="svg"]')).length;De<re;De++)Ee[De]=Pe[De];Pe=Ee}var Me=Pe.filter(function(Be){return Ae(Be),A.svgValidTagNamesRegEx.test(Be.nodeName.replace("svg:",""))&&!function(Le,He){for(;Le&&(Le=Le.parentNode);)if(Le.nodeName&&He.test(Le.nodeName.replace("svg:",""))&&!Le.getAttribute("instantiated_by_use"))return!0;return!1}(Be,A.svgInvalidAncestorsRegEx)});if(!Me||Me&&!Me.length)ce&&ce([],{});else{var Oe={};Pe.filter(function(Be){return"clipPath"===Be.nodeName.replace("svg:","")}).forEach(function(Be){var Le=Be.getAttribute("id");Oe[Le]=A.util.toArray(Be.getElementsByTagName("*")).filter(function(He){return A.svgValidTagNamesRegEx.test(He.nodeName.replace("svg:",""))})}),A.gradientDefs[he]=A.getGradientDefs(ge),A.cssRules[he]=A.getCSSRules(ge),A.clipPaths[he]=Oe,A.parseElements(Me,function(Be,Le){ce&&(ce(Be,we,Le,Pe),delete A.gradientDefs[he],delete A.cssRules[he],delete A.clipPaths[he])},O(we),be,Ie)}}};var _e=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+A.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+A.reNum+"))?\\s+(.*)");P(A,{parseFontDeclaration:function(ge,ce){var be=ge.match(_e);if(be){var Ie=be[1],De=be[3],re=be[4],he=be[5],we=be[6];Ie&&(ce.fontStyle=Ie),De&&(ce.fontWeight=isNaN(parseFloat(De))?De:parseFloat(De)),re&&(ce.fontSize=D(re)),we&&(ce.fontFamily=we),he&&(ce.lineHeight="normal"===he?1:he)}},getGradientDefs:function(ge){var ce,be=X(ge,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),Ie=0,De={};for(Ie=be.length;Ie--;)(ce=be[Ie]).getAttribute("xlink:href")&&Ce(ge,ce),De[ce.getAttribute("id")]=ce;return De},parseAttributes:function(ge,ce,be){if(ge){var Ie,De,re,he={};void 0===be&&(be=ge.getAttribute("svgUid")),ge.parentNode&&A.svgValidParentsRegEx.test(ge.parentNode.nodeName)&&(he=A.parseAttributes(ge.parentNode,ce,be));var we=ce.reduce(function(He,We){return(Ie=ge.getAttribute(We))&&(He[We]=Ie),He},{}),Pe=P(function(He,We){var Je={};for(var Qe in A.cssRules[We])if(ie(He,Qe.split(" ")))for(var Xe in A.cssRules[We][Qe])Je[Xe]=A.cssRules[We][Qe][Xe];return Je}(ge,be),A.parseStyleAttribute(ge));we=P(we,Pe),Pe[W]&&ge.setAttribute(W,Pe[W]),De=re=he.fontSize||A.Text.DEFAULT_SVG_FONT_SIZE,we[B]&&(we[B]=De=D(we[B],re));var Ee,Me,Oe={};for(var Be in we)Me=Y(Ee=$(Be),we[Be],he,De),Oe[Ee]=Me;Oe&&Oe.font&&A.parseFontDeclaration(Oe.font,Oe);var Le=P(he,Oe);return A.svgValidParentsRegEx.test(ge.nodeName)?Le:function(He){for(var We in F)if(void 0!==He[F[We]]&&""!==He[We]){if(void 0===He[We]){if(!A.Object.prototype[We])continue;He[We]=A.Object.prototype[We]}if(0!==He[We].indexOf("url(")){var Je=new A.Color(He[We]);He[We]=Je.setAlpha(b(Je.getAlpha()*He[F[We]],2)).toRgba()}}return He}(Le)}},parseElements:function(ge,ce,be,Ie,De){new A.ElementsParser(ge,ce,be,Ie,De).parse()},parseStyleAttribute:function(ge){var De,re,he,ce={},be=ge.getAttribute("style");return be&&("string"==typeof be?(De=ce,be.replace(/;\s*$/,"").split(";").forEach(function(we){var Pe=we.split(":");re=Pe[0].trim().toLowerCase(),he=Pe[1].trim(),De[re]=he})):function(Ie,De){for(var we in Ie)void 0!==Ie[we]&&(De[we.toLowerCase()]=Ie[we])}(be,ce)),ce},parsePointsAttribute:function(ge){if(!ge)return null;var ce,be,Ie=[];for(ce=0,be=(ge=(ge=ge.replace(/,/g," ").trim()).split(/\s+/)).length;ce<be;ce+=2)Ie.push({x:parseFloat(ge[ce]),y:parseFloat(ge[ce+1])});return Ie},getCSSRules:function(ge){var ce,be,Ie=ge.getElementsByTagName("style"),De={};for(ce=0,be=Ie.length;ce<be;ce++){var re=Ie[ce].textContent;""!==(re=re.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&re.split("}").filter(function(he){return he.trim()}).forEach(function(he){var we=he.split("{"),Pe={},Ee=we[1].trim().split(";").filter(function(Le){return Le.trim()});for(ce=0,be=Ee.length;ce<be;ce++){var Me=Ee[ce].split(":"),Oe=Me[0].trim(),Be=Me[1].trim();Pe[Oe]=Be}(he=we[0].trim()).split(",").forEach(function(Le){""!==(Le=Le.replace(/^svg/i,"").trim())&&(De[Le]?A.util.object.extend(De[Le],Pe):De[Le]=A.util.object.clone(Pe))})})}return De},loadSVGFromURL:function(ge,ce,be,Ie){ge=ge.replace(/^\n\s*/,"").trim(),new A.util.request(ge,{method:"get",onComplete:function(De){var re=De.responseXML;if(!re||!re.documentElement)return ce&&ce(null),!1;A.parseSVGDocument(re.documentElement,function(he,we,Pe,Ee){ce&&ce(he,we,Pe,Ee)},be,Ie)}})},loadSVGFromString:function(ge,ce,be,Ie){var De=(new A.window.DOMParser).parseFromString(ge.trim(),"text/xml");A.parseSVGDocument(De.documentElement,function(re,he,we,Pe){ce(re,he,we,Pe)},be,Ie)}})}(l),j.ElementsParser=function(I,A,P,O,b,D){this.elements=I,this.callback=A,this.options=P,this.reviver=O,this.svgUid=P&&P.svgUid||0,this.parsingOptions=b,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=D},(V=j.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},V.createObjects=function(){var I=this;this.elements.forEach(function(A,P){A.setAttribute("svgUid",I.svgUid),I.createObject(A,P)})},V.findTag=function(I){return j[j.util.string.capitalize(I.tagName.replace("svg:",""))]},V.createObject=function(I,A){var P=this.findTag(I);if(P&&P.fromElement)try{P.fromElement(I,this.createCallback(A,I),this.options)}catch(O){j.log(O)}else this.checkIfDone()},V.createCallback=function(I,A){var P=this;return function(O){var b;P.resolveGradient(O,A,"fill"),P.resolveGradient(O,A,"stroke"),O instanceof j.Image&&O._originalElement&&(b=O.parsePreserveAspectRatioAttribute(A)),O._removeTransformMatrix(b),P.resolveClipPath(O,A),P.reviver&&P.reviver(A,O),P.instances[I]=O,P.checkIfDone()}},V.extractPropertyDefinition=function(I,A,P){var O=I[A],b=this.regexUrl;if(b.test(O)){b.lastIndex=0;var D=b.exec(O)[1];return b.lastIndex=0,j[P][this.svgUid][D]}},V.resolveGradient=function(I,A,P){var O=this.extractPropertyDefinition(I,P,"gradientDefs");if(O){var b=A.getAttribute(P+"-opacity"),D=j.Gradient.fromElement(O,I,b,this.options);I.set(P,D)}},V.createClipPathCallback=function(I,A){return function(P){P._removeTransformMatrix(),P.fillRule=P.clipRule,A.push(P)}},V.resolveClipPath=function(I,A){var P,O,b,D,k=this.extractPropertyDefinition(I,"clipPath","clipPaths");if(k){b=[],O=j.util.invertTransform(I.calcTransformMatrix());for(var U=k[0].parentNode,F=A;F.parentNode&&F.getAttribute("clip-path")!==I.clipPath;)F=F.parentNode;F.parentNode.appendChild(U);for(var B=0;B<k.length;B++)this.findTag(P=k[B]).fromElement(P,this.createClipPathCallback(I,b),this.options);k=1===b.length?b[0]:new j.Group(b),D=j.util.multiplyTransformMatrices(O,k.calcTransformMatrix()),k.clipPath&&this.resolveClipPath(k,F);var W=j.util.qrDecompose(D);k.flipX=!1,k.flipY=!1,k.set("scaleX",W.scaleX),k.set("scaleY",W.scaleY),k.angle=W.angle,k.skewX=W.skewX,k.skewY=0,k.setPositionByOrigin({x:W.translateX,y:W.translateY},"center","center"),I.clipPath=k}else delete I.clipPath},V.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(I){return null!=I}),this.callback(this.instances,this.elements))},function(I){var A=I.fabric||(I.fabric={});function P(O,b){this.x=O,this.y=b}A.Point?A.warn("fabric.Point is already defined"):(A.Point=P,P.prototype={type:"point",constructor:P,add:function(O){return new P(this.x+O.x,this.y+O.y)},addEquals:function(O){return this.x+=O.x,this.y+=O.y,this},scalarAdd:function(O){return new P(this.x+O,this.y+O)},scalarAddEquals:function(O){return this.x+=O,this.y+=O,this},subtract:function(O){return new P(this.x-O.x,this.y-O.y)},subtractEquals:function(O){return this.x-=O.x,this.y-=O.y,this},scalarSubtract:function(O){return new P(this.x-O,this.y-O)},scalarSubtractEquals:function(O){return this.x-=O,this.y-=O,this},multiply:function(O){return new P(this.x*O,this.y*O)},multiplyEquals:function(O){return this.x*=O,this.y*=O,this},divide:function(O){return new P(this.x/O,this.y/O)},divideEquals:function(O){return this.x/=O,this.y/=O,this},eq:function(O){return this.x===O.x&&this.y===O.y},lt:function(O){return this.x<O.x&&this.y<O.y},lte:function(O){return this.x<=O.x&&this.y<=O.y},gt:function(O){return this.x>O.x&&this.y>O.y},gte:function(O){return this.x>=O.x&&this.y>=O.y},lerp:function(O,b){return void 0===b&&(b=.5),b=Math.max(Math.min(1,b),0),new P(this.x+(O.x-this.x)*b,this.y+(O.y-this.y)*b)},distanceFrom:function(O){var b=this.x-O.x,D=this.y-O.y;return Math.sqrt(b*b+D*D)},midPointFrom:function(O){return this.lerp(O)},min:function(O){return new P(Math.min(this.x,O.x),Math.min(this.y,O.y))},max:function(O){return new P(Math.max(this.x,O.x),Math.max(this.y,O.y))},toString:function(){return this.x+","+this.y},setXY:function(O,b){return this.x=O,this.y=b,this},setX:function(O){return this.x=O,this},setY:function(O){return this.y=O,this},setFromPoint:function(O){return this.x=O.x,this.y=O.y,this},swap:function(O){var b=this.x,D=this.y;this.x=O.x,this.y=O.y,O.x=b,O.y=D},clone:function(){return new P(this.x,this.y)}})}(l),function(I){var A=I.fabric||(I.fabric={});function P(O){this.status=O,this.points=[]}A.Intersection?A.warn("fabric.Intersection is already defined"):(A.Intersection=P,A.Intersection.prototype={constructor:P,appendPoint:function(O){return this.points.push(O),this},appendPoints:function(O){return this.points=this.points.concat(O),this}},A.Intersection.intersectLineLine=function(O,b,D,k){var U,F=(k.x-D.x)*(O.y-D.y)-(k.y-D.y)*(O.x-D.x),B=(b.x-O.x)*(O.y-D.y)-(b.y-O.y)*(O.x-D.x),W=(k.y-D.y)*(b.x-O.x)-(k.x-D.x)*(b.y-O.y);if(0!==W){var $=F/W,Y=B/W;0<=$&&$<=1&&0<=Y&&Y<=1?(U=new P("Intersection")).appendPoint(new A.Point(O.x+$*(b.x-O.x),O.y+$*(b.y-O.y))):U=new P}else U=new P(0===F||0===B?"Coincident":"Parallel");return U},A.Intersection.intersectLinePolygon=function(O,b,D){var F,B,W=new P,$=D.length;for(B=0;B<$;B++)F=P.intersectLineLine(O,b,D[B],D[(B+1)%$]),W.appendPoints(F.points);return W.points.length>0&&(W.status="Intersection"),W},A.Intersection.intersectPolygonPolygon=function(O,b){var D,k=new P,U=O.length;for(D=0;D<U;D++){var W=P.intersectLinePolygon(O[D],O[(D+1)%U],b);k.appendPoints(W.points)}return k.points.length>0&&(k.status="Intersection"),k},A.Intersection.intersectPolygonRectangle=function(O,b,D){var k=b.min(D),U=b.max(D),F=new A.Point(U.x,k.y),B=new A.Point(k.x,U.y),W=P.intersectLinePolygon(k,F,O),$=P.intersectLinePolygon(F,U,O),Y=P.intersectLinePolygon(U,B,O),J=P.intersectLinePolygon(B,k,O),X=new P;return X.appendPoints(W.points),X.appendPoints($.points),X.appendPoints(Y.points),X.appendPoints(J.points),X.points.length>0&&(X.status="Intersection"),X})}(l),function(I){var A=I.fabric||(I.fabric={});function P(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function O(b,D,k){return k<0&&(k+=1),k>1&&(k-=1),k<1/6?b+6*(D-b)*k:k<.5?D:k<2/3?b+(D-b)*(2/3-k)*6:b}A.Color?A.warn("fabric.Color is already defined."):(A.Color=P,A.Color.prototype={_tryParsingColor:function(b){var D;b in P.colorNameMap&&(b=P.colorNameMap[b]),"transparent"===b&&(D=[255,255,255,0]),D||(D=P.sourceFromHex(b)),D||(D=P.sourceFromRgb(b)),D||(D=P.sourceFromHsl(b)),D||(D=[0,0,0,1]),D&&this.setSource(D)},_rgbToHsl:function(b,D,k){var U,F,B,W=A.util.array.max([b/=255,D/=255,k/=255]),$=A.util.array.min([b,D,k]);if(B=(W+$)/2,W===$)U=F=0;else{var Y=W-$;switch(F=B>.5?Y/(2-W-$):Y/(W+$),W){case b:U=(D-k)/Y+(D<k?6:0);break;case D:U=(k-b)/Y+2;break;case k:U=(b-D)/Y+4}U/=6}return[Math.round(360*U),Math.round(100*F),Math.round(100*B)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),D=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+D[0]+","+D[1]+"%,"+D[2]+"%)"},toHsla:function(){var b=this.getSource(),D=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+D[0]+","+D[1]+"%,"+D[2]+"%,"+b[3]+")"},toHex:function(){var b,D,k,U=this.getSource();return b=1===(b=U[0].toString(16)).length?"0"+b:b,D=1===(D=U[1].toString(16)).length?"0"+D:D,k=1===(k=U[2].toString(16)).length?"0"+k:k,b.toUpperCase()+D.toUpperCase()+k.toUpperCase()},toHexa:function(){var b,D=this.getSource();return b=1===(b=(b=Math.round(255*D[3])).toString(16)).length?"0"+b:b,this.toHex()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var D=this.getSource();return D[3]=b,this.setSource(D),this},toGrayscale:function(){var b=this.getSource(),D=parseInt((.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),10);return this.setSource([D,D,D,b[3]]),this},toBlackWhite:function(b){var D=this.getSource(),k=(.3*D[0]+.59*D[1]+.11*D[2]).toFixed(0),U=D[3];return b=b||127,k=Number(k)<Number(b)?0:255,this.setSource([k,k,k,U]),this},overlayWith:function(b){b instanceof P||(b=new P(b));var D,k=[],U=this.getAlpha(),F=this.getSource(),B=b.getSource();for(D=0;D<3;D++)k.push(Math.round(.5*F[D]+.5*B[D]));return k[3]=U,this.setSource(k),this}},A.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,A.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,A.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,A.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},A.Color.fromRgb=function(b){return P.fromSource(P.sourceFromRgb(b))},A.Color.sourceFromRgb=function(b){var D=b.match(P.reRGBa);if(D){var k=parseInt(D[1],10)/(/%$/.test(D[1])?100:1)*(/%$/.test(D[1])?255:1),U=parseInt(D[2],10)/(/%$/.test(D[2])?100:1)*(/%$/.test(D[2])?255:1),F=parseInt(D[3],10)/(/%$/.test(D[3])?100:1)*(/%$/.test(D[3])?255:1);return[parseInt(k,10),parseInt(U,10),parseInt(F,10),D[4]?parseFloat(D[4]):1]}},A.Color.fromRgba=P.fromRgb,A.Color.fromHsl=function(b){return P.fromSource(P.sourceFromHsl(b))},A.Color.sourceFromHsl=function(b){var D=b.match(P.reHSLa);if(D){var k,U,F,B=(parseFloat(D[1])%360+360)%360/360,W=parseFloat(D[2])/(/%$/.test(D[2])?100:1),$=parseFloat(D[3])/(/%$/.test(D[3])?100:1);if(0===W)k=U=F=$;else{var Y=$<=.5?$*(W+1):$+W-$*W,J=2*$-Y;k=O(J,Y,B+1/3),U=O(J,Y,B),F=O(J,Y,B-1/3)}return[Math.round(255*k),Math.round(255*U),Math.round(255*F),D[4]?parseFloat(D[4]):1]}},A.Color.fromHsla=P.fromHsl,A.Color.fromHex=function(b){return P.fromSource(P.sourceFromHex(b))},A.Color.sourceFromHex=function(b){if(b.match(P.reHex)){var D=b.slice(b.indexOf("#")+1),k=3===D.length||4===D.length,U=8===D.length||4===D.length,F=k?D.charAt(0)+D.charAt(0):D.substring(0,2),B=k?D.charAt(1)+D.charAt(1):D.substring(2,4),W=k?D.charAt(2)+D.charAt(2):D.substring(4,6),$=U?k?D.charAt(3)+D.charAt(3):D.substring(6,8):"FF";return[parseInt(F,16),parseInt(B,16),parseInt(W,16),parseFloat((parseInt($,16)/255).toFixed(2))]}},A.Color.fromSource=function(b){var D=new P;return D.setSource(b),D})}(l),function(I){var A=I.fabric||(I.fabric={}),P=["e","se","s","sw","w","nw","n","ne","e"],O=["ns","nesw","ew","nwse"],b={},D="left",k="top",U="right",F="bottom",B="center",W={top:F,bottom:k,left:U,right:D,center:B},$=A.util.radiansToDegrees,Y=Math.sign||function(re){return(re>0)-(re<0)||+re};function J(re,he){var we=re.angle+$(Math.atan2(he.y,he.x))+360;return Math.round(we%360/45)}function X(re,he){var we=he.transform.target,Pe=we.canvas,Ee=A.util.object.clone(he);Ee.target=we,Pe&&Pe.fire("object:"+re,Ee),we.fire(re,he)}function ie(re,he){var we=he.canvas,Pe=re[we.uniScaleKey];return we.uniformScaling&&!Pe||!we.uniformScaling&&Pe}function oe(re){return re.originX===B&&re.originY===B}function de(re,he,we){var Pe=re.lockScalingX,Ee=re.lockScalingY;return!((!Pe||!Ee)&&(he||!Pe&&!Ee||!we)&&(!Pe||"x"!==he)&&(!Ee||"y"!==he))}function ve(re,he,we,Pe){return{e:re,transform:he,pointer:{x:we,y:Pe}}}function Ae(re){return function(he,we,Pe,Ee){var Me=we.target,Oe=Me.getCenterPoint(),Be=Me.translateToOriginPoint(Oe,we.originX,we.originY),Le=re(he,we,Pe,Ee);return Me.setPositionByOrigin(Be,we.originX,we.originY),Le}}function Ce(re,he){return function(we,Pe,Ee,Me){var Oe=he(we,Pe,Ee,Me);return Oe&&X(re,ve(we,Pe,Ee,Me)),Oe}}function _e(re,he,we,Pe,Ee){var Me=re.target,Oe=Me.controls[re.corner],Be=Me.canvas.getZoom(),Le=Me.padding/Be,He=Me.toLocalPoint(new A.Point(Pe,Ee),he,we);return He.x>=Le&&(He.x-=Le),He.x<=-Le&&(He.x+=Le),He.y>=Le&&(He.y-=Le),He.y<=Le&&(He.y+=Le),He.x-=Oe.offsetX,He.y-=Oe.offsetY,He}function ge(re){return re.flipX!==re.flipY}function ce(re,he,we,Pe,Ee){if(0!==re[he]){var Me=Ee/re._getTransformedDimensions()[Pe]*re[we];re.set(we,Me)}}function be(re,he,we,Pe){var Ee,Me=he.target,Oe=Me._getTransformedDimensions(0,Me.skewY),Be=_e(he,he.originX,he.originY,we,Pe),Le=Math.abs(2*Be.x)-Oe.x,He=Me.skewX;Le<2?Ee=0:(Ee=$(Math.atan2(Le/Me.scaleX,Oe.y/Me.scaleY)),he.originX===D&&he.originY===F&&(Ee=-Ee),he.originX===U&&he.originY===k&&(Ee=-Ee),ge(Me)&&(Ee=-Ee));var We=He!==Ee;if(We){var Je=Me._getTransformedDimensions().y;Me.set("skewX",Ee),ce(Me,"skewY","scaleY","y",Je)}return We}function Ie(re,he,we,Pe){var Ee,Me=he.target,Oe=Me._getTransformedDimensions(Me.skewX,0),Be=_e(he,he.originX,he.originY,we,Pe),Le=Math.abs(2*Be.y)-Oe.y,He=Me.skewY;Le<2?Ee=0:(Ee=$(Math.atan2(Le/Me.scaleY,Oe.x/Me.scaleX)),he.originX===D&&he.originY===F&&(Ee=-Ee),he.originX===U&&he.originY===k&&(Ee=-Ee),ge(Me)&&(Ee=-Ee));var We=He!==Ee;if(We){var Je=Me._getTransformedDimensions().x;Me.set("skewY",Ee),ce(Me,"skewX","scaleX","x",Je)}return We}function De(re,he,we,Pe,Ee){var Me,Oe,Be,Le,He,We,Je=he.target,Qe=Je.lockScalingX,Xe=Je.lockScalingY,St=(Ee=Ee||{}).by,ni=ie(re,Je),Ws=de(Je,St,ni),Fa=he.gestureScale;if(Ws)return!1;if(Fa)Oe=he.scaleX*Fa,Be=he.scaleY*Fa;else{if(Me=_e(he,he.originX,he.originY,we,Pe),He="y"!==St?Y(Me.x):1,We="x"!==St?Y(Me.y):1,he.signX||(he.signX=He),he.signY||(he.signY=We),Je.lockScalingFlip&&(he.signX!==He||he.signY!==We))return!1;if(Le=Je._getTransformedDimensions(),ni&&!St){var Mc=Math.abs(Me.x)+Math.abs(Me.y),on=he.original,jr=Mc/(Math.abs(Le.x*on.scaleX/Je.scaleX)+Math.abs(Le.y*on.scaleY/Je.scaleY));Oe=on.scaleX*jr,Be=on.scaleY*jr}else Oe=Math.abs(Me.x*Je.scaleX/Le.x),Be=Math.abs(Me.y*Je.scaleY/Le.y);oe(he)&&(Oe*=2,Be*=2),he.signX!==He&&"y"!==St&&(he.originX=W[he.originX],Oe*=-1,he.signX=He),he.signY!==We&&"x"!==St&&(he.originY=W[he.originY],Be*=-1,he.signY=We)}var cu=Je.scaleX,Bh=Je.scaleY;return St?("x"===St&&Je.set("scaleX",Oe),"y"===St&&Je.set("scaleY",Be)):(!Qe&&Je.set("scaleX",Oe),!Xe&&Je.set("scaleY",Be)),cu!==Je.scaleX||Bh!==Je.scaleY}b.scaleCursorStyleHandler=function(re,he,we){var Pe=ie(re,we),Ee="";if(0!==he.x&&0===he.y?Ee="x":0===he.x&&0!==he.y&&(Ee="y"),de(we,Ee,Pe))return"not-allowed";var Me=J(we,he);return P[Me]+"-resize"},b.skewCursorStyleHandler=function(re,he,we){if(0!==he.x&&we.lockSkewingY||0!==he.y&&we.lockSkewingX)return"not-allowed";var Ee=J(we,he)%4;return O[Ee]+"-resize"},b.scaleSkewCursorStyleHandler=function(re,he,we){return re[we.canvas.altActionKey]?b.skewCursorStyleHandler(re,he,we):b.scaleCursorStyleHandler(re,he,we)},b.rotationWithSnapping=Ce("rotating",Ae(function(re,he,we,Pe){var Ee=he,Me=Ee.target,Oe=Me.translateToOriginPoint(Me.getCenterPoint(),Ee.originX,Ee.originY);if(Me.lockRotation)return!1;var Be,Le=Math.atan2(Ee.ey-Oe.y,Ee.ex-Oe.x),He=Math.atan2(Pe-Oe.y,we-Oe.x),We=$(He-Le+Ee.theta);if(Me.snapAngle>0){var Je=Me.snapAngle,Qe=Me.snapThreshold||Je,Xe=Math.ceil(We/Je)*Je,St=Math.floor(We/Je)*Je;Math.abs(We-St)<Qe?We=St:Math.abs(We-Xe)<Qe&&(We=Xe)}return We<0&&(We=360+We),Be=Me.angle!==(We%=360),Me.angle=We,Be})),b.scalingEqually=Ce("scaling",Ae(function(re,he,we,Pe){return De(re,he,we,Pe)})),b.scalingX=Ce("scaling",Ae(function(re,he,we,Pe){return De(re,he,we,Pe,{by:"x"})})),b.scalingY=Ce("scaling",Ae(function(re,he,we,Pe){return De(re,he,we,Pe,{by:"y"})})),b.scalingYOrSkewingX=function(re,he,we,Pe){return re[he.target.canvas.altActionKey]?b.skewHandlerX(re,he,we,Pe):b.scalingY(re,he,we,Pe)},b.scalingXOrSkewingY=function(re,he,we,Pe){return re[he.target.canvas.altActionKey]?b.skewHandlerY(re,he,we,Pe):b.scalingX(re,he,we,Pe)},b.changeWidth=Ce("resizing",Ae(function(re,he,we,Pe){var Ee=he.target,Me=_e(he,he.originX,he.originY,we,Pe),Oe=Ee.strokeWidth/(Ee.strokeUniform?Ee.scaleX:1),Be=oe(he)?2:1,Le=Ee.width,He=Math.abs(Me.x*Be/Ee.scaleX)-Oe;return Ee.set("width",Math.max(He,0)),Le!==He})),b.skewHandlerX=function(re,he,we,Pe){var Ee,Me=he.target,Oe=Me.skewX,Be=he.originY;return!Me.lockSkewingX&&(0===Oe?Ee=_e(he,B,B,we,Pe).x>0?D:U:(Oe>0&&(Ee=Be===k?D:U),Oe<0&&(Ee=Be===k?U:D),ge(Me)&&(Ee=Ee===D?U:D)),he.originX=Ee,Ce("skewing",Ae(be))(re,he,we,Pe))},b.skewHandlerY=function(re,he,we,Pe){var Ee,Me=he.target,Oe=Me.skewY,Be=he.originX;return!Me.lockSkewingY&&(0===Oe?Ee=_e(he,B,B,we,Pe).y>0?k:F:(Oe>0&&(Ee=Be===D?k:F),Oe<0&&(Ee=Be===D?F:k),ge(Me)&&(Ee=Ee===k?F:k)),he.originY=Ee,Ce("skewing",Ae(Ie))(re,he,we,Pe))},b.dragHandler=function(re,he,we,Pe){var Ee=he.target,Me=we-he.offsetX,Oe=Pe-he.offsetY,Be=!Ee.get("lockMovementX")&&Ee.left!==Me,Le=!Ee.get("lockMovementY")&&Ee.top!==Oe;return Be&&Ee.set("left",Me),Le&&Ee.set("top",Oe),(Be||Le)&&X("moving",ve(re,he,we,Pe)),Be||Le},b.scaleOrSkewActionName=function(re,he,we){var Pe=re[we.canvas.altActionKey];return 0===he.x?Pe?"skewX":"scaleY":0===he.y?Pe?"skewY":"scaleX":void 0},b.rotationStyleHandler=function(re,he,we){return we.lockRotation?"not-allowed":he.cursorStyle},b.fireEvent=X,b.wrapWithFixedAnchor=Ae,b.wrapWithFireEvent=Ce,b.getLocalPoint=_e,A.controlsUtils=b}(l),A=(I=l).fabric||(I.fabric={}),P=A.util.degreesToRadians,(O=A.controlsUtils).renderCircleControl=function(b,D,k,U,F){U=U||{};var B,W=this.sizeX||U.cornerSize||F.cornerSize,$=this.sizeY||U.cornerSize||F.cornerSize,Y=void 0!==U.transparentCorners?U.transparentCorners:F.transparentCorners,J=Y?"stroke":"fill",X=!Y&&(U.cornerStrokeColor||F.cornerStrokeColor),ie=D,oe=k;b.save(),b.fillStyle=U.cornerColor||F.cornerColor,b.strokeStyle=U.cornerStrokeColor||F.cornerStrokeColor,W>$?(B=W,b.scale(1,$/W),oe=k*W/$):$>W?(B=$,b.scale(W/$,1),ie=D*$/W):B=W,b.lineWidth=1,b.beginPath(),b.arc(ie,oe,B/2,0,2*Math.PI,!1),b[J](),X&&b.stroke(),b.restore()},O.renderSquareControl=function(b,D,k,U,F){U=U||{};var B=this.sizeX||U.cornerSize||F.cornerSize,W=this.sizeY||U.cornerSize||F.cornerSize,$=void 0!==U.transparentCorners?U.transparentCorners:F.transparentCorners,Y=$?"stroke":"fill",J=!$&&(U.cornerStrokeColor||F.cornerStrokeColor),X=B/2,ie=W/2;b.save(),b.fillStyle=U.cornerColor||F.cornerColor,b.strokeStyle=U.cornerStrokeColor||F.cornerStrokeColor,b.lineWidth=1,b.translate(D,k),b.rotate(P(F.angle)),b[Y+"Rect"](-X,-ie,B,W),J&&b.strokeRect(-X,-ie,B,W),b.restore()},function(I){var A=I.fabric||(I.fabric={});A.Control=function(P){for(var O in P)this[O]=P[O]},A.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(P,O){return O.cursorStyle},getActionName:function(P,O){return O.actionName},getVisibility:function(P,O){var b=P._controlsVisibility;return b&&void 0!==b[O]?b[O]:this.visible},setVisibility:function(P){this.visible=P},positionHandler:function(P,O){return A.util.transformPoint({x:this.x*P.x+this.offsetX,y:this.y*P.y+this.offsetY},O)},calcCornerCoords:function(P,O,b,D,k){var U,F,B,W,$=k?this.touchSizeX:this.sizeX,Y=k?this.touchSizeY:this.sizeY;if($&&Y&&$!==Y){var J=Math.atan2(Y,$),X=Math.sqrt($*$+Y*Y)/2,ie=J-A.util.degreesToRadians(P),oe=Math.PI/2-J-A.util.degreesToRadians(P);U=X*A.util.cos(ie),F=X*A.util.sin(ie),B=X*A.util.cos(oe),W=X*A.util.sin(oe)}else X=.7071067812*($&&Y?$:O),ie=A.util.degreesToRadians(45-P),U=B=X*A.util.cos(ie),F=W=X*A.util.sin(ie);return{tl:{x:b-W,y:D-B},tr:{x:b+U,y:D-F},bl:{x:b-U,y:D+F},br:{x:b+W,y:D+B}}},render:function(P,O,b,D,k){"circle"===((D=D||{}).cornerStyle||k.cornerStyle)?A.controlsUtils.renderCircleControl.call(this,P,O,b,D,k):A.controlsUtils.renderSquareControl.call(this,P,O,b,D,k)}}}(l),function(){function I(P,O){var b,D,k,U,F=P.getAttribute("style"),B=P.getAttribute("offset")||0;if(B=(B=parseFloat(B)/(/%$/.test(B)?100:1))<0?0:B>1?1:B,F){var W=F.split(/\s*;\s*/);for(""===W[W.length-1]&&W.pop(),U=W.length;U--;){var $=W[U].split(/\s*:\s*/),Y=$[0].trim(),J=$[1].trim();"stop-color"===Y?b=J:"stop-opacity"===Y&&(k=J)}}return b||(b=P.getAttribute("stop-color")||"rgb(0,0,0)"),k||(k=P.getAttribute("stop-opacity")),D=(b=new j.Color(b)).getAlpha(),k=isNaN(parseFloat(k))?1:parseFloat(k),k*=D*O,{offset:B,color:b.toRgb(),opacity:k}}var A=j.util.object.clone;j.Gradient=j.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(P){P||(P={}),P.coords||(P.coords={});var O,b=this;Object.keys(P).forEach(function(D){b[D]=P[D]}),this.id?this.id+="_"+j.Object.__uid++:this.id=j.Object.__uid++,O={x1:P.coords.x1||0,y1:P.coords.y1||0,x2:P.coords.x2||0,y2:P.coords.y2||0},"radial"===this.type&&(O.r1=P.coords.r1||0,O.r2=P.coords.r2||0),this.coords=O,this.colorStops=P.colorStops.slice()},addColorStop:function(P){for(var O in P){var b=new j.Color(P[O]);this.colorStops.push({offset:parseFloat(O),color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(P){var O={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return j.util.populateWithProperties(this,O,P),O},toSVG:function(P,O){var b,D,k,U,F=A(this.coords,!0),B=(O=O||{},A(this.colorStops,!0)),W=F.r1>F.r2,$=this.gradientTransform?this.gradientTransform.concat():j.iMatrix.concat(),Y=-this.offsetX,J=-this.offsetY,X=!!O.additionalTransform,ie="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(B.sort(function(Ae,Ce){return Ae.offset-Ce.offset}),"objectBoundingBox"===ie?(Y/=P.width,J/=P.height):(Y+=P.width/2,J+=P.height/2),"path"===P.type&&"percentage"!==this.gradientUnits&&(Y-=P.pathOffset.x,J-=P.pathOffset.y),$[4]-=Y,$[5]-=J,U='id="SVGID_'+this.id+'" gradientUnits="'+ie+'"',U+=' gradientTransform="'+(X?O.additionalTransform+" ":"")+j.util.matrixToSVG($)+'" ',"linear"===this.type?k=["<linearGradient ",U,' x1="',F.x1,'" y1="',F.y1,'" x2="',F.x2,'" y2="',F.y2,'">\n']:"radial"===this.type&&(k=["<radialGradient ",U,' cx="',W?F.x1:F.x2,'" cy="',W?F.y1:F.y2,'" r="',W?F.r1:F.r2,'" fx="',W?F.x2:F.x1,'" fy="',W?F.y2:F.y1,'">\n']),"radial"===this.type){if(W)for((B=B.concat()).reverse(),b=0,D=B.length;b<D;b++)B[b].offset=1-B[b].offset;var oe=Math.min(F.r1,F.r2);if(oe>0){var de=oe/Math.max(F.r1,F.r2);for(b=0,D=B.length;b<D;b++)B[b].offset+=de*(1-B[b].offset)}}for(b=0,D=B.length;b<D;b++){var ve=B[b];k.push("<stop ",'offset="',100*ve.offset+"%",'" style="stop-color:',ve.color,void 0!==ve.opacity?";stop-opacity: "+ve.opacity:";",'"/>\n')}return k.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),k.join("")},toLive:function(P){var O,b,D,k=j.util.object.clone(this.coords);if(this.type){for("linear"===this.type?O=P.createLinearGradient(k.x1,k.y1,k.x2,k.y2):"radial"===this.type&&(O=P.createRadialGradient(k.x1,k.y1,k.r1,k.x2,k.y2,k.r2)),b=0,D=this.colorStops.length;b<D;b++){var U=this.colorStops[b].color,F=this.colorStops[b].opacity,B=this.colorStops[b].offset;void 0!==F&&(U=new j.Color(U).setAlpha(F).toRgba()),O.addColorStop(B,U)}return O}}}),j.util.object.extend(j.Gradient,{fromElement:function(P,O,b,D){var k=parseFloat(b)/(/%$/.test(b)?100:1);k=k<0?0:k>1?1:k,isNaN(k)&&(k=1);var U,F,B,W,de,ve,Ae,Ce,_e,ge,$=P.getElementsByTagName("stop"),Y="userSpaceOnUse"===P.getAttribute("gradientUnits")?"pixels":"percentage",J=P.getAttribute("gradientTransform")||"",X=[],ie=0,oe=0;for("linearGradient"===P.nodeName||"LINEARGRADIENT"===P.nodeName?(U="linear",F={x1:(de=P).getAttribute("x1")||0,y1:de.getAttribute("y1")||0,x2:de.getAttribute("x2")||"100%",y2:de.getAttribute("y2")||0}):(U="radial",F=function(de){return{x1:de.getAttribute("fx")||de.getAttribute("cx")||"50%",y1:de.getAttribute("fy")||de.getAttribute("cy")||"50%",r1:0,x2:de.getAttribute("cx")||"50%",y2:de.getAttribute("cy")||"50%",r2:de.getAttribute("r")||"50%"}}(P)),B=$.length;B--;)X.push(I($[B],k));return W=j.parseTransformAttribute(J),ve=F,Ae=D,Ce=Y,Object.keys(ve).forEach(function(ce){"Infinity"===(_e=ve[ce])?ge=1:"-Infinity"===_e?ge=0:(ge=parseFloat(ve[ce],10),"string"==typeof _e&&/^(\d+\.\d+)%|(\d+)%$/.test(_e)&&(ge*=.01,"pixels"===Ce&&("x1"!==ce&&"x2"!==ce&&"r2"!==ce||(ge*=Ae.viewBoxWidth||Ae.width),"y1"!==ce&&"y2"!==ce||(ge*=Ae.viewBoxHeight||Ae.height)))),ve[ce]=ge}),"pixels"===Y&&(ie=-O.left,oe=-O.top),new j.Gradient({id:P.getAttribute("id"),type:U,coords:F,colorStops:X,gradientUnits:Y,gradientTransform:W,offsetX:ie,offsetY:oe})}})}(),H=j.util.toFixed,j.Pattern=j.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(I,A){if(I||(I={}),this.id=j.Object.__uid++,this.setOptions(I),!I.source||I.source&&"string"!=typeof I.source)A&&A(this);else{var P=this;this.source=j.util.createImage(),j.util.loadImage(I.source,function(O,b){P.source=O,A&&A(P,b)},null,this.crossOrigin)}},toObject:function(I){var A,P,O=j.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?A=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(A=this.source.toDataURL()),P={type:"pattern",source:A,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:H(this.offsetX,O),offsetY:H(this.offsetY,O),patternTransform:this.patternTransform?this.patternTransform.concat():null},j.util.populateWithProperties(this,P,I),P},toSVG:function(I){var A="function"==typeof this.source?this.source():this.source,P=A.width/I.width,O=A.height/I.height,b=this.offsetX/I.width,D=this.offsetY/I.height,k="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(O=1,D&&(O+=Math.abs(D))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(P=1,b&&(P+=Math.abs(b))),A.src?k=A.src:A.toDataURL&&(k=A.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+b+'" y="'+D+'" width="'+P+'" height="'+O+'">\n<image x="0" y="0" width="'+A.width+'" height="'+A.height+'" xlink:href="'+k+'"></image>\n</pattern>\n'},setOptions:function(I){for(var A in I)this[A]=I[A]},toLive:function(I){var A=this.source;return A&&(void 0===A.src||A.complete&&0!==A.naturalWidth&&0!==A.naturalHeight)?I.createPattern(A,this.repeat):""}}),function(I){var A=I.fabric||(I.fabric={}),P=A.util.toFixed;A.Shadow?A.warn("fabric.Shadow is already defined."):(A.Shadow=A.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(O){for(var b in"string"==typeof O&&(O=this._parseShadow(O)),O)this[b]=O[b];this.id=A.Object.__uid++},_parseShadow:function(O){var b=O.trim(),D=A.Shadow.reOffsetsAndBlur.exec(b)||[];return{color:(b.replace(A.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(D[1],10)||0,offsetY:parseFloat(D[2],10)||0,blur:parseFloat(D[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(O){var b=40,D=40,k=A.Object.NUM_FRACTION_DIGITS,U=A.util.rotateVector({x:this.offsetX,y:this.offsetY},A.util.degreesToRadians(-O.angle)),F=new A.Color(this.color);return O.width&&O.height&&(b=100*P((Math.abs(U.x)+this.blur)/O.width,k)+20,D=100*P((Math.abs(U.y)+this.blur)/O.height,k)+20),O.flipX&&(U.x*=-1),O.flipY&&(U.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+D+'%" height="'+(100+2*D)+'%" x="-'+b+'%" width="'+(100+2*b)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+P(this.blur?this.blur/2:0,k)+'"></feGaussianBlur>\n\t<feOffset dx="'+P(U.x,k)+'" dy="'+P(U.y,k)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+F.toRgb()+'" flood-opacity="'+F.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var O={},b=A.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(D){this[D]!==b[D]&&(O[D]=this[D])},this),O}}),A.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(l),function(){if(j.StaticCanvas)j.warn("fabric.StaticCanvas is already defined.");else{var I=j.util.object.extend,A=j.util.getElementOffset,P=j.util.removeFromArray,O=j.util.toFixed,b=j.util.transformPoint,D=j.util.invertTransform,k=j.util.getNodeCanvas,U=j.util.createCanvasElement,F=new Error("Could not initialize `canvas` element");j.StaticCanvas=j.util.createClass(j.CommonMethods,{initialize:function(B,W){W||(W={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(B,W)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:j.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(B,W){var $=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(B),this._initOptions(W),this.interactive||this._initRetinaScaling(),W.overlayImage&&this.setOverlayImage(W.overlayImage,$),W.backgroundImage&&this.setBackgroundImage(W.backgroundImage,$),W.backgroundColor&&this.setBackgroundColor(W.backgroundColor,$),W.overlayColor&&this.setOverlayColor(W.overlayColor,$),this.calcOffset()},_isRetinaScaling:function(){return j.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,j.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var B=j.devicePixelRatio;this.__initRetinaScaling(B,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(B,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(B,W,$){W.setAttribute("width",this.width*B),W.setAttribute("height",this.height*B),$.scale(B,B)},calcOffset:function(){return this._offset=A(this.lowerCanvasEl),this},setOverlayImage:function(B,W,$){return this.__setBgOverlayImage("overlayImage",B,W,$)},setBackgroundImage:function(B,W,$){return this.__setBgOverlayImage("backgroundImage",B,W,$)},setOverlayColor:function(B,W){return this.__setBgOverlayColor("overlayColor",B,W)},setBackgroundColor:function(B,W){return this.__setBgOverlayColor("backgroundColor",B,W)},__setBgOverlayImage:function(B,W,$,Y){return"string"==typeof W?j.util.loadImage(W,function(J,X){if(J){var ie=new j.Image(J,Y);this[B]=ie,ie.canvas=this}$&&$(J,X)},this,Y&&Y.crossOrigin):(Y&&W.setOptions(Y),this[B]=W,W&&(W.canvas=this),$&&$(W,!1)),this},__setBgOverlayColor:function(B,W,$){return this[B]=W,this._initGradient(W,B),this._initPattern(W,B,$),this},_createCanvasElement:function(){var B=U();if(!B||(B.style||(B.style={}),void 0===B.getContext))throw F;return B},_initOptions:function(B){var W=this.lowerCanvasEl;this._setOptions(B),this.width=this.width||parseInt(W.width,10)||0,this.height=this.height||parseInt(W.height,10)||0,this.lowerCanvasEl.style&&(W.width=this.width,W.height=this.height,W.style.width=this.width+"px",W.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(B){this.lowerCanvasEl=B&&B.getContext?B:j.util.getById(B)||this._createCanvasElement(),j.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(B,W){return this.setDimensions({width:B},W)},setHeight:function(B,W){return this.setDimensions({height:B},W)},setDimensions:function(B,W){var $;for(var Y in W=W||{},B)$=B[Y],W.cssOnly||(this._setBackstoreDimension(Y,B[Y]),$+="px",this.hasLostContext=!0),W.backstoreOnly||this._setCssDimension(Y,$);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),W.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(B,W){return this.lowerCanvasEl[B]=W,this.upperCanvasEl&&(this.upperCanvasEl[B]=W),this.cacheCanvasEl&&(this.cacheCanvasEl[B]=W),this[B]=W,this},_setCssDimension:function(B,W){return this.lowerCanvasEl.style[B]=W,this.upperCanvasEl&&(this.upperCanvasEl.style[B]=W),this.wrapperEl&&(this.wrapperEl.style[B]=W),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(B){var W,$,Y,J=this._activeObject,X=this.backgroundImage,ie=this.overlayImage;for(this.viewportTransform=B,$=0,Y=this._objects.length;$<Y;$++)(W=this._objects[$]).group||W.setCoords(!0);return J&&J.setCoords(),X&&X.setCoords(!0),ie&&ie.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(B,W){var $=B,Y=this.viewportTransform.slice(0);B=b(B,D(this.viewportTransform)),Y[0]=W,Y[3]=W;var J=b(B,Y);return Y[4]+=$.x-J.x,Y[5]+=$.y-J.y,this.setViewportTransform(Y)},setZoom:function(B){return this.zoomToPoint(new j.Point(0,0),B),this},absolutePan:function(B){var W=this.viewportTransform.slice(0);return W[4]=-B.x,W[5]=-B.y,this.setViewportTransform(W)},relativePan:function(B){return this.absolutePan(new j.Point(-B.x-this.viewportTransform[4],-B.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(B){this.stateful&&B.setupState(),B._set("canvas",this),B.setCoords(),this.fire("object:added",{target:B}),B.fire("added")},_onObjectRemoved:function(B){this.fire("object:removed",{target:B}),B.fire("removed"),delete B.canvas},clearContext:function(B){return B.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=j.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var B={},W=this.width,$=this.height,Y=D(this.viewportTransform);return B.tl=b({x:0,y:0},Y),B.br=b({x:W,y:$},Y),B.tr=new j.Point(B.br.x,B.tl.y),B.bl=new j.Point(B.tl.x,B.br.y),this.vptCoords=B,B},cancelRequestedRender:function(){this.isRendering&&(j.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(B,W){var $=this.viewportTransform,Y=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(B),j.util.setImageSmoothing(B,this.imageSmoothingEnabled),this.fire("before:render",{ctx:B}),this._renderBackground(B),B.save(),B.transform($[0],$[1],$[2],$[3],$[4],$[5]),this._renderObjects(B,W),B.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(B),Y&&(Y.canvas=this,Y.shouldCache(),Y._transformDone=!0,Y.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(B)),this._renderOverlay(B),this.controlsAboveOverlay&&this.interactive&&this.drawControls(B),this.fire("after:render",{ctx:B})},drawClipPathOnCanvas:function(B){var W=this.viewportTransform,$=this.clipPath;B.save(),B.transform(W[0],W[1],W[2],W[3],W[4],W[5]),B.globalCompositeOperation="destination-in",$.transform(B),B.scale(1/$.zoomX,1/$.zoomY),B.drawImage($._cacheCanvas,-$.cacheTranslationX,-$.cacheTranslationY),B.restore()},_renderObjects:function(B,W){var $,Y;for($=0,Y=W.length;$<Y;++$)W[$]&&W[$].render(B)},_renderBackgroundOrOverlay:function(B,W){var $=this[W+"Color"],Y=this[W+"Image"],J=this.viewportTransform,X=this[W+"Vpt"];if($||Y){if($){B.save(),B.beginPath(),B.moveTo(0,0),B.lineTo(this.width,0),B.lineTo(this.width,this.height),B.lineTo(0,this.height),B.closePath(),B.fillStyle=$.toLive?$.toLive(B,this):$,X&&B.transform(J[0],J[1],J[2],J[3],J[4],J[5]),B.transform(1,0,0,1,$.offsetX||0,$.offsetY||0);var ie=$.gradientTransform||$.patternTransform;ie&&B.transform(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]),B.fill(),B.restore()}Y&&(B.save(),X&&B.transform(J[0],J[1],J[2],J[3],J[4],J[5]),Y.render(B),B.restore())}},_renderBackground:function(B){this._renderBackgroundOrOverlay(B,"background")},_renderOverlay:function(B){this._renderBackgroundOrOverlay(B,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new j.Point(this.width/2,this.height/2)},centerObjectH:function(B){return this._centerObject(B,new j.Point(this.getCenterPoint().x,B.getCenterPoint().y))},centerObjectV:function(B){return this._centerObject(B,new j.Point(B.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(B){var W=this.getCenterPoint();return this._centerObject(B,W)},viewportCenterObject:function(B){var W=this.getVpCenter();return this._centerObject(B,W)},viewportCenterObjectH:function(B){var W=this.getVpCenter();return this._centerObject(B,new j.Point(W.x,B.getCenterPoint().y)),this},viewportCenterObjectV:function(B){var W=this.getVpCenter();return this._centerObject(B,new j.Point(B.getCenterPoint().x,W.y))},getVpCenter:function(){var B=this.getCenterPoint(),W=D(this.viewportTransform);return b(B,W)},_centerObject:function(B,W){return B.setPositionByOrigin(W,"center","center"),B.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(B){return this.toDatalessObject(B)},toObject:function(B){return this._toObjectMethod("toObject",B)},toDatalessObject:function(B){return this._toObjectMethod("toDatalessObject",B)},_toObjectMethod:function(B,W){var $=this.clipPath,Y={version:j.version,objects:this._toObjects(B,W)};return $&&!$.excludeFromExport&&(Y.clipPath=this._toObject(this.clipPath,B,W)),I(Y,this.__serializeBgOverlay(B,W)),j.util.populateWithProperties(this,Y,W),Y},_toObjects:function(B,W){return this._objects.filter(function($){return!$.excludeFromExport}).map(function($){return this._toObject($,B,W)},this)},_toObject:function(B,W,$){var Y;this.includeDefaultValues||(Y=B.includeDefaultValues,B.includeDefaultValues=!1);var J=B[W]($);return this.includeDefaultValues||(B.includeDefaultValues=Y),J},__serializeBgOverlay:function(B,W){var $={},Y=this.backgroundImage,J=this.overlayImage,X=this.backgroundColor,ie=this.overlayColor;return X&&X.toObject?X.excludeFromExport||($.background=X.toObject(W)):X&&($.background=X),ie&&ie.toObject?ie.excludeFromExport||($.overlay=ie.toObject(W)):ie&&($.overlay=ie),Y&&!Y.excludeFromExport&&($.backgroundImage=this._toObject(Y,B,W)),J&&!J.excludeFromExport&&($.overlayImage=this._toObject(J,B,W)),$},svgViewportTransformation:!0,toSVG:function(B,W){B||(B={}),B.reviver=W;var $=[];return this._setSVGPreamble($,B),this._setSVGHeader($,B),this.clipPath&&$.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor($,"background"),this._setSVGBgOverlayImage($,"backgroundImage",W),this._setSVGObjects($,W),this.clipPath&&$.push("</g>\n"),this._setSVGBgOverlayColor($,"overlay"),this._setSVGBgOverlayImage($,"overlayImage",W),$.push("</svg>"),$.join("")},_setSVGPreamble:function(B,W){W.suppressPreamble||B.push('<?xml version="1.0" encoding="',W.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(B,W){var $,Y=W.width||this.width,J=W.height||this.height,X='viewBox="0 0 '+this.width+" "+this.height+'" ',ie=j.Object.NUM_FRACTION_DIGITS;W.viewBox?X='viewBox="'+W.viewBox.x+" "+W.viewBox.y+" "+W.viewBox.width+" "+W.viewBox.height+'" ':this.svgViewportTransformation&&(X='viewBox="'+O(-($=this.viewportTransform)[4]/$[0],ie)+" "+O(-$[5]/$[3],ie)+" "+O(this.width/$[0],ie)+" "+O(this.height/$[3],ie)+'" '),B.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',Y,'" ','height="',J,'" ',X,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",j.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(W),"</defs>\n")},createSVGClipPathMarkup:function(B){var W=this.clipPath;return W?(W.clipPathId="CLIPPATH_"+j.Object.__uid++,'<clipPath id="'+W.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(B.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var B=this;return["background","overlay"].map(function(W){var $=B[W+"Color"];if($&&$.toLive){var Y=B[W+"Vpt"],J=B.viewportTransform;return $.toSVG({width:B.width/(Y?J[0]:1),height:B.height/(Y?J[3]:1)},{additionalTransform:Y?j.util.matrixToSVG(J):""})}}).join("")},createSVGFontFacesMarkup:function(){var B,W,$,Y,J,X,ie,oe,de="",ve={},Ae=j.fontPaths,Ce=[];for(this._objects.forEach(function ge(ce){Ce.push(ce),ce._objects&&ce._objects.forEach(ge)}),ie=0,oe=Ce.length;ie<oe;ie++)if(W=(B=Ce[ie]).fontFamily,-1!==B.type.indexOf("text")&&!ve[W]&&Ae[W]&&(ve[W]=!0,B.styles))for(J in $=B.styles)for(X in Y=$[J])!ve[W=Y[X].fontFamily]&&Ae[W]&&(ve[W]=!0);for(var _e in ve)de+=["\t\t@font-face {\n","\t\t\tfont-family: '",_e,"';\n","\t\t\tsrc: url('",Ae[_e],"');\n","\t\t}\n"].join("");return de&&(de=['\t<style type="text/css">',"<![CDATA[\n",de,"]]>","</style>\n"].join("")),de},_setSVGObjects:function(B,W){var $,Y,J,X=this._objects;for(Y=0,J=X.length;Y<J;Y++)($=X[Y]).excludeFromExport||this._setSVGObject(B,$,W)},_setSVGObject:function(B,W,$){B.push(W.toSVG($))},_setSVGBgOverlayImage:function(B,W,$){this[W]&&!this[W].excludeFromExport&&this[W].toSVG&&B.push(this[W].toSVG($))},_setSVGBgOverlayColor:function(B,W){var $=this[W+"Color"],J=this.width,X=this.height;if($)if($.toLive){var ie=$.repeat,oe=j.util.invertTransform(this.viewportTransform),de=this[W+"Vpt"]?j.util.matrixToSVG(oe):"";B.push('<rect transform="'+de+" translate(",J/2,",",X/2,')"',' x="',$.offsetX-J/2,'" y="',$.offsetY-X/2,'" ','width="',"repeat-y"===ie||"no-repeat"===ie?$.source.width:J,'" height="',"repeat-x"===ie||"no-repeat"===ie?$.source.height:X,'" fill="url(#SVGID_'+$.id+')"',"></rect>\n")}else B.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',$,'"',"></rect>\n")},sendToBack:function(B){if(!B)return this;var W,$,Y,J=this._activeObject;if(B===J&&"activeSelection"===B.type)for(W=(Y=J._objects).length;W--;)P(this._objects,$=Y[W]),this._objects.unshift($);else P(this._objects,B),this._objects.unshift(B);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(B){if(!B)return this;var W,$,Y,J=this._activeObject;if(B===J&&"activeSelection"===B.type)for(Y=J._objects,W=0;W<Y.length;W++)P(this._objects,$=Y[W]),this._objects.push($);else P(this._objects,B),this._objects.push(B);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(B,W){if(!B)return this;var $,Y,J,X,ie,oe=this._activeObject,de=0;if(B===oe&&"activeSelection"===B.type)for(ie=oe._objects,$=0;$<ie.length;$++)(J=this._objects.indexOf(Y=ie[$]))>0+de&&(X=J-1,P(this._objects,Y),this._objects.splice(X,0,Y)),de++;else 0!==(J=this._objects.indexOf(B))&&(X=this._findNewLowerIndex(B,J,W),P(this._objects,B),this._objects.splice(X,0,B));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(B,W,$){var Y,J;if($){for(Y=W,J=W-1;J>=0;--J)if(B.intersectsWithObject(this._objects[J])||B.isContainedWithinObject(this._objects[J])||this._objects[J].isContainedWithinObject(B)){Y=J;break}}else Y=W-1;return Y},bringForward:function(B,W){if(!B)return this;var $,Y,J,X,ie,oe=this._activeObject,de=0;if(B===oe&&"activeSelection"===B.type)for($=(ie=oe._objects).length;$--;)(J=this._objects.indexOf(Y=ie[$]))<this._objects.length-1-de&&(X=J+1,P(this._objects,Y),this._objects.splice(X,0,Y)),de++;else(J=this._objects.indexOf(B))!==this._objects.length-1&&(X=this._findNewUpperIndex(B,J,W),P(this._objects,B),this._objects.splice(X,0,B));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(B,W,$){var Y,J,X;if($){for(Y=W,J=W+1,X=this._objects.length;J<X;++J)if(B.intersectsWithObject(this._objects[J])||B.isContainedWithinObject(this._objects[J])||this._objects[J].isContainedWithinObject(B)){Y=J;break}}else Y=W+1;return Y},moveTo:function(B,W){return P(this._objects,B),this._objects.splice(W,0,B),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(j.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(B){B.dispose&&B.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),j.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),j.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),I(j.StaticCanvas.prototype,j.Observable),I(j.StaticCanvas.prototype,j.Collection),I(j.StaticCanvas.prototype,j.DataURLExporter),I(j.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(B){var W=U();if(!W||!W.getContext)return null;var $=W.getContext("2d");return $&&"setLineDash"===B?void 0!==$.setLineDash:null}}),j.StaticCanvas.prototype.toJSON=j.StaticCanvas.prototype.toObject,j.isLikelyNode&&(j.StaticCanvas.prototype.createPNGStream=function(){var B=k(this.lowerCanvasEl);return B&&B.createPNGStream()},j.StaticCanvas.prototype.createJPEGStream=function(B){var W=k(this.lowerCanvasEl);return W&&W.createJPEGStream(B)})}}(),j.BaseBrush=j.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(I){I.strokeStyle=this.color,I.lineWidth=this.width,I.lineCap=this.strokeLineCap,I.miterLimit=this.strokeMiterLimit,I.lineJoin=this.strokeLineJoin,I.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(I){var A=this.canvas.viewportTransform;I.save(),I.transform(A[0],A[1],A[2],A[3],A[4],A[5])},_setShadow:function(){if(this.shadow){var I=this.canvas,A=this.shadow,P=I.contextTop,O=I.getZoom();I&&I._isRetinaScaling()&&(O*=j.devicePixelRatio),P.shadowColor=A.color,P.shadowBlur=A.blur*O,P.shadowOffsetX=A.offsetX*O,P.shadowOffsetY=A.offsetY*O}},needsFullRender:function(){return new j.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var I=this.canvas.contextTop;I.shadowColor="",I.shadowBlur=I.shadowOffsetX=I.shadowOffsetY=0},_isOutSideCanvas:function(I){return I.x<0||I.x>this.canvas.getWidth()||I.y<0||I.y>this.canvas.getHeight()}}),j.PencilBrush=j.util.createClass(j.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(I){this.canvas=I,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(I,A,P){var O=A.midPointFrom(P);return I.quadraticCurveTo(A.x,A.y,O.x,O.y),O},onMouseDown:function(I,A){this.canvas._isMainEvent(A.e)&&(this.drawStraightLine=A.e[this.straightLineKey],this._prepareForDrawing(I),this._captureDrawingPath(I),this._render())},onMouseMove:function(I,A){if(this.canvas._isMainEvent(A.e)&&(this.drawStraightLine=A.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(I))&&this._captureDrawingPath(I)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var P=this._points,O=P.length,b=this.canvas.contextTop;this._saveAndTransform(b),this.oldEnd&&(b.beginPath(),b.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(b,P[O-2],P[O-1],!0),b.stroke(),b.restore()}},onMouseUp:function(I){return!this.canvas._isMainEvent(I.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(I){var A=new j.Point(I.x,I.y);this._reset(),this._addPoint(A),this.canvas.contextTop.moveTo(A.x,A.y)},_addPoint:function(I){return!(this._points.length>1&&I.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(I),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(I){var A=new j.Point(I.x,I.y);return this._addPoint(A)},_render:function(I){var A,P,O=this._points[0],b=this._points[1];if(this._saveAndTransform(I=I||this.canvas.contextTop),I.beginPath(),2===this._points.length&&O.x===b.x&&O.y===b.y){var D=this.width/1e3;O=new j.Point(O.x,O.y),b=new j.Point(b.x,b.y),O.x-=D,b.x+=D}for(I.moveTo(O.x,O.y),A=1,P=this._points.length;A<P;A++)this._drawSegment(I,O,b),O=this._points[A],b=this._points[A+1];I.lineTo(O.x,O.y),I.stroke(),I.restore()},convertPointsToSVGPath:function(I){return j.util.getSmoothPathFromPoints(I,this.width/1e3)},_isEmptySVGPath:function(I){return"M 0 0 Q 0 0 0 0 L 0 0"===j.util.joinPath(I)},createPath:function(I){var A=new j.Path(I,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,A.shadow=new j.Shadow(this.shadow)),A},decimatePoints:function(I,A){if(I.length<=2)return I;var P,O=this.canvas.getZoom(),b=Math.pow(A/O,2),D=I.length-1,k=I[0],U=[k];for(P=1;P<D-1;P++)Math.pow(k.x-I[P].x,2)+Math.pow(k.y-I[P].y,2)>=b&&U.push(k=I[P]);return U.push(I[D]),U},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var I=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(I))this.canvas.requestRenderAll();else{var A=this.createPath(I);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:A}),this.canvas.add(A),this.canvas.requestRenderAll(),A.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:A})}}}),j.CircleBrush=j.util.createClass(j.BaseBrush,{width:10,initialize:function(I){this.canvas=I,this.points=[]},drawDot:function(I){var A=this.addPoint(I),P=this.canvas.contextTop;this._saveAndTransform(P),this.dot(P,A),P.restore()},dot:function(I,A){I.fillStyle=A.fill,I.beginPath(),I.arc(A.x,A.y,A.radius,0,2*Math.PI,!1),I.closePath(),I.fill()},onMouseDown:function(I){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(I)},_render:function(){var I,A,P=this.canvas.contextTop,O=this.points;for(this._saveAndTransform(P),I=0,A=O.length;I<A;I++)this.dot(P,O[I]);P.restore()},onMouseMove:function(I){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(I)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(I),this._render()):this.drawDot(I))},onMouseUp:function(){var I,A,P=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var O=[];for(I=0,A=this.points.length;I<A;I++){var b=this.points[I],D=new j.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&(D.shadow=new j.Shadow(this.shadow)),O.push(D)}var k=new j.Group(O);k.canvas=this.canvas,this.canvas.fire("before:path:created",{path:k}),this.canvas.add(k),this.canvas.fire("path:created",{path:k}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=P,this.canvas.requestRenderAll()},addPoint:function(I){var A=new j.Point(I.x,I.y),P=j.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,O=new j.Color(this.color).setAlpha(j.util.getRandomInt(0,100)/100).toRgba();return A.radius=P,A.fill=O,this.points.push(A),A}}),j.SprayBrush=j.util.createClass(j.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(I){this.canvas=I,this.sprayChunks=[]},onMouseDown:function(I){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(I),this.render(this.sprayChunkPoints)},onMouseMove:function(I){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(I)||(this.addSprayChunk(I),this.render(this.sprayChunkPoints))},onMouseUp:function(){var I=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var A=[],P=0,O=this.sprayChunks.length;P<O;P++)for(var b=this.sprayChunks[P],D=0,k=b.length;D<k;D++){var U=new j.Rect({width:b[D].width,height:b[D].width,left:b[D].x+1,top:b[D].y+1,originX:"center",originY:"center",fill:this.color});A.push(U)}this.optimizeOverlapping&&(A=this._getOptimizedRects(A));var F=new j.Group(A);this.shadow&&F.set("shadow",new j.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:F}),this.canvas.add(F),this.canvas.fire("path:created",{path:F}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=I,this.canvas.requestRenderAll()},_getOptimizedRects:function(I){var A,P,O,b={};for(P=0,O=I.length;P<O;P++)b[A=I[P].left+""+I[P].top]||(b[A]=I[P]);var D=[];for(A in b)D.push(b[A]);return D},render:function(I){var A,P,O=this.canvas.contextTop;for(O.fillStyle=this.color,this._saveAndTransform(O),A=0,P=I.length;A<P;A++){var b=I[A];void 0!==b.opacity&&(O.globalAlpha=b.opacity),O.fillRect(b.x,b.y,b.width,b.width)}O.restore()},_render:function(){var I,A,P=this.canvas.contextTop;for(P.fillStyle=this.color,this._saveAndTransform(P),I=0,A=this.sprayChunks.length;I<A;I++)this.render(this.sprayChunks[I]);P.restore()},addSprayChunk:function(I){this.sprayChunkPoints=[];var A,P,O,b,D=this.width/2;for(b=0;b<this.density;b++){A=j.util.getRandomInt(I.x-D,I.x+D),P=j.util.getRandomInt(I.y-D,I.y+D),O=this.dotWidthVariance?j.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var k=new j.Point(A,P);k.width=O,this.randomOpacity&&(k.opacity=j.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(k)}this.sprayChunks.push(this.sprayChunkPoints)}}),j.PatternBrush=j.util.createClass(j.PencilBrush,{getPatternSrc:function(){var I=j.util.createCanvasElement(),A=I.getContext("2d");return I.width=I.height=25,A.fillStyle=this.color,A.beginPath(),A.arc(10,10,10,0,2*Math.PI,!1),A.closePath(),A.fill(),I},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(I){return I.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(I){this.callSuper("_setBrushStyles",I),I.strokeStyle=this.getPattern(I)},createPath:function(I){var A=this.callSuper("createPath",I),P=A._getLeftTopCoords().scalarAdd(A.strokeWidth/2);return A.stroke=new j.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-P.x,offsetY:-P.y}),A}}),function(){var I=j.util.getPointer,A=j.util.degreesToRadians,P=j.util.isTouchEvent;for(var O in j.Canvas=j.util.createClass(j.StaticCanvas,{initialize:function(b,D){D||(D={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(b,D),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=j.PencilBrush&&new j.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var b,D,k,U=this.getActiveObjects();if(U.length>0&&!this.preserveObjectStacking){D=[],k=[];for(var F=0,B=this._objects.length;F<B;F++)-1===U.indexOf(b=this._objects[F])?D.push(b):k.push(b);U.length>1&&(this._activeObject._objects=k),D.push.apply(D,k)}else D=this._objects;return D},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(b){b.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(b),this.contextTopDirty=!0),b.restore()},renderTop:function(){var b=this.contextTop;return this.clearContext(b),this.renderTopLayer(b),this.fire("after:render"),this},_normalizePointer:function(b,D){var k=b.calcTransformMatrix(),U=j.util.invertTransform(k),F=this.restorePointerVpt(D);return j.util.transformPoint(F,U)},isTargetTransparent:function(b,D,k){if(b.shouldCache()&&b._cacheCanvas&&b!==this._activeObject){var U=this._normalizePointer(b,{x:D,y:k}),F=Math.max(b.cacheTranslationX+U.x*b.zoomX,0),B=Math.max(b.cacheTranslationY+U.y*b.zoomY,0);return j.util.isTransparent(b._cacheContext,Math.round(F),Math.round(B),this.targetFindTolerance)}var W=this.contextCache,$=b.selectionBackgroundColor,Y=this.viewportTransform;return b.selectionBackgroundColor="",this.clearContext(W),W.save(),W.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),b.render(W),W.restore(),b.selectionBackgroundColor=$,j.util.isTransparent(W,D,k,this.targetFindTolerance)},_isSelectionKeyPressed:function(b){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(D){return!0===b[D]}):b[this.selectionKey]},_shouldClearSelection:function(b,D){var k=this.getActiveObjects(),U=this._activeObject;return!D||D&&U&&k.length>1&&-1===k.indexOf(D)&&U!==D&&!this._isSelectionKeyPressed(b)||D&&!D.evented||D&&!D.selectable&&U&&U!==D},_shouldCenterTransform:function(b,D,k){var U;if(b)return"scale"===D||"scaleX"===D||"scaleY"===D||"resizing"===D?U=this.centeredScaling||b.centeredScaling:"rotate"===D&&(U=this.centeredRotation||b.centeredRotation),U?!k:k},_getOriginFromCorner:function(b,D){var k={x:b.originX,y:b.originY};return"ml"===D||"tl"===D||"bl"===D?k.x="right":"mr"!==D&&"tr"!==D&&"br"!==D||(k.x="left"),"tl"===D||"mt"===D||"tr"===D?k.y="bottom":"bl"!==D&&"mb"!==D&&"br"!==D||(k.y="top"),k},_getActionFromCorner:function(b,D,k,U){if(!D||!b)return"drag";var F=U.controls[D];return F.getActionName(k,F,U)},_setupCurrentTransform:function(b,D,k){if(D){var U=this.getPointer(b),F=D.__corner,B=D.controls[F],W=k&&F?B.getActionHandler(b,D,B):j.controlsUtils.dragHandler,$=this._getActionFromCorner(k,F,b,D),Y=this._getOriginFromCorner(D,F),J=b[this.centeredKey],X={target:D,action:$,actionHandler:W,corner:F,scaleX:D.scaleX,scaleY:D.scaleY,skewX:D.skewX,skewY:D.skewY,offsetX:U.x-D.left,offsetY:U.y-D.top,originX:Y.x,originY:Y.y,ex:U.x,ey:U.y,lastX:U.x,lastY:U.y,theta:A(D.angle),width:D.width*D.scaleX,shiftKey:b.shiftKey,altKey:J,original:j.util.saveObjectTransform(D)};this._shouldCenterTransform(D,$,J)&&(X.originX="center",X.originY="center"),X.original.originX=Y.x,X.original.originY=Y.y,this._currentTransform=X,this._beforeTransform(b)}},setCursor:function(b){this.upperCanvasEl.style.cursor=b},_drawSelection:function(b){var D=this._groupSelector,k=new j.Point(D.ex,D.ey),U=j.util.transformPoint(k,this.viewportTransform),F=new j.Point(D.ex+D.left,D.ey+D.top),B=j.util.transformPoint(F,this.viewportTransform),W=Math.min(U.x,B.x),$=Math.min(U.y,B.y),Y=Math.max(U.x,B.x),J=Math.max(U.y,B.y),X=this.selectionLineWidth/2;this.selectionColor&&(b.fillStyle=this.selectionColor,b.fillRect(W,$,Y-W,J-$)),this.selectionLineWidth&&this.selectionBorderColor&&(b.lineWidth=this.selectionLineWidth,b.strokeStyle=this.selectionBorderColor,W+=X,$+=X,Y-=X,J-=X,j.Object.prototype._setLineDash.call(this,b,this.selectionDashArray),b.strokeRect(W,$,Y-W,J-$))},findTarget:function(b,D){if(!this.skipTargetFind){var k,U,F=this.getPointer(b,!0),B=this._activeObject,W=this.getActiveObjects(),$=P(b),Y=W.length>1&&!D||1===W.length;if(this.targets=[],Y&&B._findTargetCorner(F,$)||W.length>1&&!D&&B===this._searchPossibleTargets([B],F))return B;if(1===W.length&&B===this._searchPossibleTargets([B],F)){if(!this.preserveObjectStacking)return B;k=B,U=this.targets,this.targets=[]}var J=this._searchPossibleTargets(this._objects,F);return b[this.altSelectionKey]&&J&&k&&J!==k&&(J=k,this.targets=U),J}},_checkTarget:function(b,D,k){if(D&&D.visible&&D.evented&&D.containsPoint(b)&&(!this.perPixelTargetFind&&!D.perPixelTargetFind||D.isEditing||!this.isTargetTransparent(D,k.x,k.y)))return!0},_searchPossibleTargets:function(b,D){for(var k,U,F=b.length;F--;){var B=b[F],W=B.group?this._normalizePointer(B.group,D):D;if(this._checkTarget(W,B,D)){(k=b[F]).subTargetCheck&&k instanceof j.Group&&(U=this._searchPossibleTargets(k._objects,D))&&this.targets.push(U);break}}return k},restorePointerVpt:function(b){return j.util.transformPoint(b,j.util.invertTransform(this.viewportTransform))},getPointer:function(b,D){if(this._absolutePointer&&!D)return this._absolutePointer;if(this._pointer&&D)return this._pointer;var k,U=I(b),F=this.upperCanvasEl,B=F.getBoundingClientRect(),W=B.width||0,$=B.height||0;W&&$||("top"in B&&"bottom"in B&&($=Math.abs(B.top-B.bottom)),"right"in B&&"left"in B&&(W=Math.abs(B.right-B.left))),this.calcOffset(),U.x=U.x-this._offset.left,U.y=U.y-this._offset.top,D||(U=this.restorePointerVpt(U));var Y=this.getRetinaScaling();return 1!==Y&&(U.x/=Y,U.y/=Y),{x:U.x*(k=0===W||0===$?{width:1,height:1}:{width:F.width/W,height:F.height/$}).width,y:U.y*k.height}},_createUpperCanvas:function(){var b=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),D=this.lowerCanvasEl,k=this.upperCanvasEl;k?k.className="":(k=this._createCanvasElement(),this.upperCanvasEl=k),j.util.addClass(k,"upper-canvas "+b),this.wrapperEl.appendChild(k),this._copyCanvasStyle(D,k),this._applyCanvasStyle(k),this.contextTop=k.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=j.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),j.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),j.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var D=this.width||b.width,k=this.height||b.height;j.util.setStyle(b,{position:"absolute",width:D+"px",height:k+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),b.width=D,b.height=k,j.util.makeElementUnselectable(b)},_copyCanvasStyle:function(b,D){D.style.cssText=b.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var b=this._activeObject;return b?"activeSelection"===b.type&&b._objects?b._objects.slice(0):[b]:[]},_onObjectRemoved:function(b){b===this._activeObject&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared",{target:b}),b.fire("deselected")),b===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",b)},_fireSelectionEvents:function(b,D){var k=!1,U=this.getActiveObjects(),F=[],B=[];b.forEach(function(W){-1===U.indexOf(W)&&(k=!0,W.fire("deselected",{e:D,target:W}),B.push(W))}),U.forEach(function(W){-1===b.indexOf(W)&&(k=!0,W.fire("selected",{e:D,target:W}),F.push(W))}),b.length>0&&U.length>0?k&&this.fire("selection:updated",{e:D,selected:F,deselected:B}):U.length>0?this.fire("selection:created",{e:D,selected:F}):b.length>0&&this.fire("selection:cleared",{e:D,deselected:B})},setActiveObject:function(b,D){var k=this.getActiveObjects();return this._setActiveObject(b,D),this._fireSelectionEvents(k,D),this},_setActiveObject:function(b,D){return this._activeObject!==b&&!!this._discardActiveObject(D,b)&&!b.onSelect({e:D})&&(this._activeObject=b,!0)},_discardActiveObject:function(b,D){var k=this._activeObject;if(k){if(k.onDeselect({e:b,object:D}))return!1;this._activeObject=null}return!0},discardActiveObject:function(b){var D=this.getActiveObjects(),k=this.getActiveObject();return D.length&&this.fire("before:selection:cleared",{target:k,e:b}),this._discardActiveObject(b),this._fireSelectionEvents(D,b),this},dispose:function(){var b=this.wrapperEl;return this.removeListeners(),b.removeChild(this.upperCanvasEl),b.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(D){j.util.cleanUpJsdomNode(this[D]),this[D]=void 0}.bind(this)),b.parentNode&&b.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,j.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(b){var D=this._activeObject;D&&D._renderControls(b)},_toObject:function(b,D,k){var U=this._realizeGroupTransformOnObject(b),F=this.callSuper("_toObject",b,D,k);return this._unwindGroupTransformOnObject(b,U),F},_realizeGroupTransformOnObject:function(b){if(b.group&&"activeSelection"===b.group.type&&this._activeObject===b.group){var D={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(k){D[k]=b[k]}),j.util.addTransformToObject(b,this._activeObject.calcOwnMatrix()),D}return null},_unwindGroupTransformOnObject:function(b,D){D&&b.set(D)},_setSVGObject:function(b,D,k){var U=this._realizeGroupTransformOnObject(D);this.callSuper("_setSVGObject",b,D,k),this._unwindGroupTransformOnObject(D,U)},setViewportTransform:function(b){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),j.StaticCanvas.prototype.setViewportTransform.call(this,b)}}),j.StaticCanvas)"prototype"!==O&&(j.Canvas[O]=j.StaticCanvas[O])}(),function(){var I=j.util.addListener,A=j.util.removeListener,P={passive:!1};function O(b,D){return b.button&&b.button===D-1}j.util.object.extend(j.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(I,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(b,D){var k=this.upperCanvasEl,U=this._getEventPrefix();b(j.window,"resize",this._onResize),b(k,U+"down",this._onMouseDown),b(k,U+"move",this._onMouseMove,P),b(k,U+"out",this._onMouseOut),b(k,U+"enter",this._onMouseEnter),b(k,"wheel",this._onMouseWheel),b(k,"contextmenu",this._onContextMenu),b(k,"dblclick",this._onDoubleClick),b(k,"dragover",this._onDragOver),b(k,"dragenter",this._onDragEnter),b(k,"dragleave",this._onDragLeave),b(k,"drop",this._onDrop),this.enablePointerEvents||b(k,"touchstart",this._onTouchStart,P),"undefined"!=typeof eventjs&&D in eventjs&&(eventjs[D](k,"gesture",this._onGesture),eventjs[D](k,"drag",this._onDrag),eventjs[D](k,"orientation",this._onOrientationChange),eventjs[D](k,"shake",this._onShake),eventjs[D](k,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(A,"remove");var b=this._getEventPrefix();A(j.document,b+"up",this._onMouseUp),A(j.document,"touchend",this._onTouchEnd,P),A(j.document,b+"move",this._onMouseMove,P),A(j.document,"touchmove",this._onMouseMove,P)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(b,D){this.__onTransformGesture&&this.__onTransformGesture(b,D)},_onDrag:function(b,D){this.__onDrag&&this.__onDrag(b,D)},_onMouseWheel:function(b){this.__onMouseWheel(b)},_onMouseOut:function(b){var D=this._hoveredTarget;this.fire("mouse:out",{target:D,e:b}),this._hoveredTarget=null,D&&D.fire("mouseout",{e:b});var k=this;this._hoveredTargets.forEach(function(U){k.fire("mouse:out",{target:D,e:b}),U&&D.fire("mouseout",{e:b})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(U){U.isEditing&&U.hiddenTextarea.focus()})},_onMouseEnter:function(b){this._currentTransform||this.findTarget(b)||(this.fire("mouse:over",{target:null,e:b}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(b,D){this.__onOrientationChange&&this.__onOrientationChange(b,D)},_onShake:function(b,D){this.__onShake&&this.__onShake(b,D)},_onLongPress:function(b,D){this.__onLongPress&&this.__onLongPress(b,D)},_onDragOver:function(b){b.preventDefault();var D=this._simpleEventHandler("dragover",b);this._fireEnterLeaveEvents(D,b)},_onDrop:function(b){return this._simpleEventHandler("drop:before",b),this._simpleEventHandler("drop",b)},_onContextMenu:function(b){return this.stopContextMenu&&(b.stopPropagation(),b.preventDefault()),!1},_onDoubleClick:function(b){this._cacheTransformEventData(b),this._handleEvent(b,"dblclick"),this._resetTransformEventData(b)},getPointerId:function(b){var D=b.changedTouches;return D?D[0]&&D[0].identifier:this.enablePointerEvents?b.pointerId:-1},_isMainEvent:function(b){return!0===b.isPrimary||!1!==b.isPrimary&&("touchend"===b.type&&0===b.touches.length||!b.changedTouches||b.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(b){b.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(b)),this.__onMouseDown(b),this._resetTransformEventData();var D=this.upperCanvasEl,k=this._getEventPrefix();I(j.document,"touchend",this._onTouchEnd,P),I(j.document,"touchmove",this._onMouseMove,P),A(D,k+"down",this._onMouseDown)},_onMouseDown:function(b){this.__onMouseDown(b),this._resetTransformEventData();var D=this.upperCanvasEl,k=this._getEventPrefix();A(D,k+"move",this._onMouseMove,P),I(j.document,k+"up",this._onMouseUp),I(j.document,k+"move",this._onMouseMove,P)},_onTouchEnd:function(b){if(!(b.touches.length>0)){this.__onMouseUp(b),this._resetTransformEventData(),this.mainTouchId=null;var D=this._getEventPrefix();A(j.document,"touchend",this._onTouchEnd,P),A(j.document,"touchmove",this._onMouseMove,P);var k=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){I(k.upperCanvasEl,D+"down",k._onMouseDown),k._willAddMouseDown=0},400)}},_onMouseUp:function(b){this.__onMouseUp(b),this._resetTransformEventData();var D=this.upperCanvasEl,k=this._getEventPrefix();this._isMainEvent(b)&&(A(j.document,k+"up",this._onMouseUp),A(j.document,k+"move",this._onMouseMove,P),I(D,k+"move",this._onMouseMove,P))},_onMouseMove:function(b){!this.allowTouchScrolling&&b.preventDefault&&b.preventDefault(),this.__onMouseMove(b)},_onResize:function(){this.calcOffset()},_shouldRender:function(b){var D=this._activeObject;return!!(!!D!=!!b||D&&b&&D!==b)||!1},__onMouseUp:function(b){var D,k=this._currentTransform,U=this._groupSelector,F=!1,B=!U||0===U.left&&0===U.top;if(this._cacheTransformEventData(b),D=this._target,this._handleEvent(b,"up:before"),O(b,3))this.fireRightClick&&this._handleEvent(b,"up",3,B);else{if(O(b,2))return this.fireMiddleClick&&this._handleEvent(b,"up",2,B),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(b);else if(this._isMainEvent(b)){if(k&&(this._finalizeCurrentTransform(b),F=k.actionPerformed),!B){var W=D===this._activeObject;this._maybeGroupObjects(b),F||(F=this._shouldRender(D)||!W&&D===this._activeObject)}var $,Y;if(D){if($=D._findTargetCorner(this.getPointer(b,!0),j.util.isTouchEvent(b)),D.selectable&&D!==this._activeObject&&"up"===D.activeOn)this.setActiveObject(D,b),F=!0;else{var J=D.controls[$],X=J&&J.getMouseUpHandler(b,D,J);X&&X(b,k,(Y=this.getPointer(b)).x,Y.y)}D.isMoving=!1}if(k&&(k.target!==D||k.corner!==$)){var ie=k.target&&k.target.controls[k.corner],oe=ie&&ie.getMouseUpHandler(b,D,J);Y=Y||this.getPointer(b),oe&&oe(b,k,Y.x,Y.y)}this._setCursorFromEvent(b,D),this._handleEvent(b,"up",1,B),this._groupSelector=null,this._currentTransform=null,D&&(D.__corner=0),F?this.requestRenderAll():B||this.renderTop()}}},_simpleEventHandler:function(b,D){var k=this.findTarget(D),U=this.targets,F={e:D,target:k,subTargets:U};if(this.fire(b,F),k&&k.fire(b,F),!U)return k;for(var B=0;B<U.length;B++)U[B].fire(b,F);return k},_handleEvent:function(b,D,k,U){var F=this._target,B=this.targets||[],W={e:b,target:F,subTargets:B,button:k||1,isClick:U||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===D&&(W.currentTarget=this.findTarget(b),W.currentSubTargets=this.targets),this.fire("mouse:"+D,W),F&&F.fire("mouse"+D,W);for(var $=0;$<B.length;$++)B[$].fire("mouse"+D,W)},_finalizeCurrentTransform:function(b){var D=this._currentTransform,k=D.target,U={e:b,target:k,transform:D,action:D.action};k._scaling&&(k._scaling=!1),k.setCoords(),(D.actionPerformed||this.stateful&&k.hasStateChanged())&&this._fire("modified",U)},_onMouseDownInDrawingMode:function(b){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(b).requestRenderAll();var D=this.getPointer(b);this.freeDrawingBrush.onMouseDown(D,{e:b,pointer:D}),this._handleEvent(b,"down")},_onMouseMoveInDrawingMode:function(b){if(this._isCurrentlyDrawing){var D=this.getPointer(b);this.freeDrawingBrush.onMouseMove(D,{e:b,pointer:D})}this.setCursor(this.freeDrawingCursor),this._handleEvent(b,"move")},_onMouseUpInDrawingMode:function(b){var D=this.getPointer(b);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:b,pointer:D}),this._handleEvent(b,"up")},__onMouseDown:function(b){this._cacheTransformEventData(b),this._handleEvent(b,"down:before");var D=this._target;if(O(b,3))this.fireRightClick&&this._handleEvent(b,"down",3);else if(O(b,2))this.fireMiddleClick&&this._handleEvent(b,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(b);else if(this._isMainEvent(b)&&!this._currentTransform){var k=this._pointer;this._previousPointer=k;var U=this._shouldRender(D),F=this._shouldGroup(b,D);if(this._shouldClearSelection(b,D)?this.discardActiveObject(b):F&&(this._handleGrouping(b,D),D=this._activeObject),!this.selection||D&&(D.selectable||D.isEditing||D===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),D){var B=D===this._activeObject;D.selectable&&"down"===D.activeOn&&this.setActiveObject(D,b);var W=D._findTargetCorner(this.getPointer(b,!0),j.util.isTouchEvent(b));if(D.__corner=W,D===this._activeObject&&(W||!F)){this._setupCurrentTransform(b,D,B);var $=D.controls[W],Y=(k=this.getPointer(b),$&&$.getMouseDownHandler(b,D,$));Y&&Y(b,this._currentTransform,k.x,k.y)}}this._handleEvent(b,"down"),(U||F)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(b){this._resetTransformEventData(),this._pointer=this.getPointer(b,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(b)||null},_beforeTransform:function(b){var D=this._currentTransform;this.stateful&&D.target.saveState(),this.fire("before:transform",{e:b,transform:D})},__onMouseMove:function(b){var D,k;if(this._handleEvent(b,"move:before"),this._cacheTransformEventData(b),this.isDrawingMode)this._onMouseMoveInDrawingMode(b);else if(this._isMainEvent(b)){var U=this._groupSelector;U?(U.left=(k=this._absolutePointer).x-U.ex,U.top=k.y-U.ey,this.renderTop()):this._currentTransform?this._transformObject(b):(D=this.findTarget(b)||null,this._setCursorFromEvent(b,D),this._fireOverOutEvents(D,b)),this._handleEvent(b,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(b,D){var k=this._hoveredTarget,U=this._hoveredTargets,F=this.targets,B=Math.max(U.length,F.length);this.fireSyntheticInOutEvents(b,D,{oldTarget:k,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var W=0;W<B;W++)this.fireSyntheticInOutEvents(F[W],D,{oldTarget:U[W],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=b,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(b,D){var k=this._draggedoverTarget,U=this._hoveredTargets,F=this.targets,B=Math.max(U.length,F.length);this.fireSyntheticInOutEvents(b,D,{oldTarget:k,evtOut:"dragleave",evtIn:"dragenter"});for(var W=0;W<B;W++)this.fireSyntheticInOutEvents(F[W],D,{oldTarget:U[W],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=b},fireSyntheticInOutEvents:function(b,D,k){var U,F,B,W=k.oldTarget,$=W!==b,Y=k.canvasEvtIn,J=k.canvasEvtOut;$&&(U={e:D,target:b,previousTarget:W},F={e:D,target:W,nextTarget:b}),B=b&&$,W&&$&&(J&&this.fire(J,F),W.fire(k.evtOut,F)),B&&(Y&&this.fire(Y,U),b.fire(k.evtIn,U))},__onMouseWheel:function(b){this._cacheTransformEventData(b),this._handleEvent(b,"wheel"),this._resetTransformEventData()},_transformObject:function(b){var D=this.getPointer(b),k=this._currentTransform;k.reset=!1,k.shiftKey=b.shiftKey,k.altKey=b[this.centeredKey],this._performTransformAction(b,k,D),k.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(b,D,k){var B=D.action,W=!1,$=D.actionHandler;$&&(W=$(b,D,k.x,k.y)),"drag"===B&&W&&(D.target.isMoving=!0,this.setCursor(D.target.moveCursor||this.moveCursor)),D.actionPerformed=D.actionPerformed||W},_fire:j.controlsUtils.fireEvent,_setCursorFromEvent:function(b,D){if(!D)return this.setCursor(this.defaultCursor),!1;var k=D.hoverCursor||this.hoverCursor,U=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,F=(!U||!U.contains(D))&&D._findTargetCorner(this.getPointer(b,!0));F?this.setCursor(this.getCornerCursor(F,D,b)):(D.subTargetCheck&&this.targets.concat().reverse().map(function(B){k=B.hoverCursor||k}),this.setCursor(k))},getCornerCursor:function(b,D,k){var U=D.controls[b];return U.cursorStyleHandler(k,U,D)}})}(),G=Math.min,z=Math.max,j.util.object.extend(j.Canvas.prototype,{_shouldGroup:function(I,A){var P=this._activeObject;return P&&this._isSelectionKeyPressed(I)&&A&&A.selectable&&this.selection&&(P!==A||"activeSelection"===P.type)&&!A.onSelect({e:I})},_handleGrouping:function(I,A){var P=this._activeObject;P.__corner||(A!==P||(A=this.findTarget(I,!0))&&A.selectable)&&(P&&"activeSelection"===P.type?this._updateActiveSelection(A,I):this._createActiveSelection(A,I))},_updateActiveSelection:function(I,A){var P=this._activeObject,O=P._objects.slice(0);P.contains(I)?(P.removeWithUpdate(I),this._hoveredTarget=I,this._hoveredTargets=this.targets.concat(),1===P.size()&&this._setActiveObject(P.item(0),A)):(P.addWithUpdate(I),this._hoveredTarget=P,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(O,A)},_createActiveSelection:function(I,A){var P=this.getActiveObjects(),O=this._createGroup(I);this._hoveredTarget=O,this._setActiveObject(O,A),this._fireSelectionEvents(P,A)},_createGroup:function(I){var A=this._objects,P=A.indexOf(this._activeObject)<A.indexOf(I)?[this._activeObject,I]:[I,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new j.ActiveSelection(P,{canvas:this})},_groupSelectedObjects:function(I){var A,P=this._collectObjects(I);1===P.length?this.setActiveObject(P[0],I):P.length>1&&(A=new j.ActiveSelection(P.reverse(),{canvas:this}),this.setActiveObject(A,I))},_collectObjects:function(I){for(var A,P=[],O=this._groupSelector.ex,b=this._groupSelector.ey,D=O+this._groupSelector.left,k=b+this._groupSelector.top,U=new j.Point(G(O,D),G(b,k)),F=new j.Point(z(O,D),z(b,k)),B=!this.selectionFullyContained,W=O===D&&b===k,$=this._objects.length;$--&&!((A=this._objects[$])&&A.selectable&&A.visible&&(B&&A.intersectsWithRect(U,F,!0)||A.isContainedWithinRect(U,F,!0)||B&&A.containsPoint(U,null,!0)||B&&A.containsPoint(F,null,!0))&&(P.push(A),W)););return P.length>1&&(P=P.filter(function(Y){return!Y.onSelect({e:I})})),P},_maybeGroupObjects:function(I){this.selection&&this._groupSelector&&this._groupSelectedObjects(I),this.setCursor(this.defaultCursor),this._groupSelector=null}}),j.util.object.extend(j.StaticCanvas.prototype,{toDataURL:function(I){I||(I={});var A=I.format||"png",P=I.quality||1,O=(I.multiplier||1)*(I.enableRetinaScaling?this.getRetinaScaling():1),b=this.toCanvasElement(O,I);return j.util.toDataURL(b,A,P)},toCanvasElement:function(I,A){var P=((A=A||{}).width||this.width)*(I=I||1),O=(A.height||this.height)*I,b=this.getZoom(),D=this.width,k=this.height,U=b*I,F=this.viewportTransform,$=this.interactive,Y=[U,0,0,U,(F[4]-(A.left||0))*I,(F[5]-(A.top||0))*I],J=this.enableRetinaScaling,X=j.util.createCanvasElement(),ie=this.contextTop;return X.width=P,X.height=O,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=Y,this.width=P,this.height=O,this.calcViewportBoundaries(),this.renderCanvas(X.getContext("2d"),this._objects),this.viewportTransform=F,this.width=D,this.height=k,this.calcViewportBoundaries(),this.interactive=$,this.enableRetinaScaling=J,this.contextTop=ie,X}}),j.util.object.extend(j.StaticCanvas.prototype,{loadFromJSON:function(I,A,P){if(I){var O="string"==typeof I?JSON.parse(I):j.util.object.clone(I),b=this,D=O.clipPath,k=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete O.clipPath,this._enlivenObjects(O.objects,function(U){b.clear(),b._setBgOverlay(O,function(){D?b._enlivenObjects([D],function(F){b.clipPath=F[0],b.__setupCanvas.call(b,O,U,k,A)}):b.__setupCanvas.call(b,O,U,k,A)})},P),this}},__setupCanvas:function(I,A,P,O){var b=this;A.forEach(function(D,k){b.insertAt(D,k)}),this.renderOnAddRemove=P,delete I.objects,delete I.backgroundImage,delete I.overlayImage,delete I.background,delete I.overlay,this._setOptions(I),this.renderAll(),O&&O()},_setBgOverlay:function(I,A){var P={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(I.backgroundImage||I.overlayImage||I.background||I.overlay){var O=function(){P.backgroundImage&&P.overlayImage&&P.backgroundColor&&P.overlayColor&&A&&A()};this.__setBgOverlay("backgroundImage",I.backgroundImage,P,O),this.__setBgOverlay("overlayImage",I.overlayImage,P,O),this.__setBgOverlay("backgroundColor",I.background,P,O),this.__setBgOverlay("overlayColor",I.overlay,P,O)}else A&&A()},__setBgOverlay:function(I,A,P,O){var b=this;if(!A)return P[I]=!0,void(O&&O());"backgroundImage"===I||"overlayImage"===I?j.util.enlivenObjects([A],function(D){b[I]=D[0],P[I]=!0,O&&O()}):this["set"+j.util.string.capitalize(I,!0)](A,function(){P[I]=!0,O&&O()})},_enlivenObjects:function(I,A,P){I&&0!==I.length?j.util.enlivenObjects(I,function(O){A&&A(O)},null,P):A&&A([])},_toDataURL:function(I,A){this.clone(function(P){A(P.toDataURL(I))})},_toDataURLWithMultiplier:function(I,A,P){this.clone(function(O){P(O.toDataURLWithMultiplier(I,A))})},clone:function(I,A){var P=JSON.stringify(this.toJSON(A));this.cloneWithoutData(function(O){O.loadFromJSON(P,function(){I&&I(O)})})},cloneWithoutData:function(I){var A=j.util.createCanvasElement();A.width=this.width,A.height=this.height;var P=new j.Canvas(A);this.backgroundImage?(P.setBackgroundImage(this.backgroundImage.src,function(){P.renderAll(),I&&I(P)}),P.backgroundImageOpacity=this.backgroundImageOpacity,P.backgroundImageStretch=this.backgroundImageStretch):I&&I(P)}}),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.util.object.clone,b=A.util.toFixed,D=A.util.string.capitalize,k=A.util.degreesToRadians;A.Object||(A.Object=A.util.createClass(A.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!A.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(F){F&&this.setOptions(F)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=A.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(F){var B=A.perfLimitSizeTotal,W=F.width,$=F.height,Y=A.maxCacheSideLimit,J=A.minCacheSideLimit;if(W<=Y&&$<=Y&&W*$<=B)return W<J&&(F.width=J),$<J&&(F.height=J),F;var ie=A.util.limitDimsByArea(W/$,B),oe=A.util.capValue,de=oe(J,ie.x,Y),ve=oe(J,ie.y,Y);return W>de&&(F.zoomX/=W/de,F.width=de,F.capped=!0),$>ve&&(F.zoomY/=$/ve,F.height=ve,F.capped=!0),F},_getCacheCanvasDimensions:function(){var F=this.getTotalObjectScaling(),B=this._getTransformedDimensions(0,0),W=B.x*F.scaleX/this.scaleX,$=B.y*F.scaleY/this.scaleY;return{width:W+2,height:$+2,zoomX:F.scaleX,zoomY:F.scaleY,x:W,y:$}},_updateCacheCanvas:function(){var F=this.canvas;if(this.noScaleCache&&F&&F._currentTransform){var W=F._currentTransform.action;if(this===F._currentTransform.target&&W.slice&&"scale"===W.slice(0,5))return!1}var $,Y,J=this._cacheCanvas,X=this._limitCacheSize(this._getCacheCanvasDimensions()),ie=A.minCacheSideLimit,oe=X.width,de=X.height,ve=X.zoomX,Ae=X.zoomY,Ce=oe!==this.cacheWidth||de!==this.cacheHeight,ge=Ce||this.zoomX!==ve||this.zoomY!==Ae,ce=0,be=0,Ie=!1;if(Ce){var De=this._cacheCanvas.width,re=this._cacheCanvas.height,he=oe>De||de>re;Ie=he||(oe<.9*De||de<.9*re)&&De>ie&&re>ie,he&&!X.capped&&(oe>ie||de>ie)&&(ce=.1*oe,be=.1*de)}return this instanceof A.Text&&this.path&&(ge=!0,Ie=!0,ce+=this.getHeightOfLine(0)*this.zoomX,be+=this.getHeightOfLine(0)*this.zoomY),!!ge&&(Ie?(J.width=Math.ceil(oe+ce),J.height=Math.ceil(de+be)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,J.width,J.height)),$=X.x/2,Y=X.y/2,this.cacheTranslationX=Math.round(J.width/2-$)+$,this.cacheTranslationY=Math.round(J.height/2-Y)+Y,this.cacheWidth=oe,this.cacheHeight=de,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(ve,Ae),this.zoomX=ve,this.zoomY=Ae,!0)},setOptions:function(F){this._setOptions(F),this._initGradient(F.fill,"fill"),this._initGradient(F.stroke,"stroke"),this._initPattern(F.fill,"fill"),this._initPattern(F.stroke,"stroke")},transform:function(F){var W=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&F===this.canvas.contextTop));F.transform(W[0],W[1],W[2],W[3],W[4],W[5])},toObject:function(F){var B=A.Object.NUM_FRACTION_DIGITS,W={type:this.type,version:A.version,originX:this.originX,originY:this.originY,left:b(this.left,B),top:b(this.top,B),width:b(this.width,B),height:b(this.height,B),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:b(this.strokeWidth,B),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:b(this.strokeMiterLimit,B),scaleX:b(this.scaleX,B),scaleY:b(this.scaleY,B),angle:b(this.angle,B),flipX:this.flipX,flipY:this.flipY,opacity:b(this.opacity,B),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:b(this.skewX,B),skewY:b(this.skewY,B)};return this.clipPath&&!this.clipPath.excludeFromExport&&(W.clipPath=this.clipPath.toObject(F),W.clipPath.inverted=this.clipPath.inverted,W.clipPath.absolutePositioned=this.clipPath.absolutePositioned),A.util.populateWithProperties(this,W,F),this.includeDefaultValues||(W=this._removeDefaultValues(W)),W},toDatalessObject:function(F){return this.toObject(F)},_removeDefaultValues:function(F){var B=A.util.getKlass(F.type).prototype;return B.stateProperties.forEach(function(W){"left"!==W&&"top"!==W&&(F[W]===B[W]&&delete F[W],Array.isArray(F[W])&&Array.isArray(B[W])&&0===F[W].length&&0===B[W].length&&delete F[W])}),F},toString:function(){return"#<fabric."+D(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var F=A.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(F.scaleX),scaleY:Math.abs(F.scaleY)}},getTotalObjectScaling:function(){var F=this.getObjectScaling(),B=F.scaleX,W=F.scaleY;if(this.canvas){var $=this.canvas.getZoom(),Y=this.canvas.getRetinaScaling();B*=$*Y,W*=$*Y}return{scaleX:B,scaleY:W}},getObjectOpacity:function(){var F=this.opacity;return this.group&&(F*=this.group.getObjectOpacity()),F},_set:function(F,B){var $=this[F]!==B,Y=!1;return("scaleX"===F||"scaleY"===F)&&(B=this._constrainScale(B)),"scaleX"===F&&B<0?(this.flipX=!this.flipX,B*=-1):"scaleY"===F&&B<0?(this.flipY=!this.flipY,B*=-1):"shadow"!==F||!B||B instanceof A.Shadow?"dirty"===F&&this.group&&this.group.set("dirty",B):B=new A.Shadow(B),this[F]=B,$&&(Y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(F)>-1?(this.dirty=!0,Y&&this.group.set("dirty",!0)):Y&&this.stateProperties.indexOf(F)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:A.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(F){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(F.save(),this._setupCompositeOperation(F),this.drawSelectionBackground(F),this.transform(F),this._setOpacity(F),this._setShadow(F,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(F)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(F),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),F.restore())},renderCache:function(F){F=F||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,F.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(F,B){if(F.save(),F.globalCompositeOperation=B.inverted?"destination-out":"destination-in",B.absolutePositioned){var W=A.util.invertTransform(this.calcTransformMatrix());F.transform(W[0],W[1],W[2],W[3],W[4],W[5])}B.transform(F),F.scale(1/B.zoomX,1/B.zoomY),F.drawImage(B._cacheCanvas,-B.cacheTranslationX,-B.cacheTranslationY),F.restore()},drawObject:function(F,B){var W=this.fill,$=this.stroke;B?(this.fill="black",this.stroke="",this._setClippingProperties(F)):this._renderBackground(F),this._render(F),this._drawClipPath(F,this.clipPath),this.fill=W,this.stroke=$},_drawClipPath:function(F,B){B&&(B.canvas=this.canvas,B.shouldCache(),B._transformDone=!0,B.renderCache({forClipping:!0}),this.drawClipPathOnCache(F,B))},drawCacheOnCanvas:function(F){F.scale(1/this.zoomX,1/this.zoomY),F.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(F){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!F&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!F){var B=this.cacheWidth/this.zoomX,W=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-B/2,-W/2,B,W)}return!0}return!1},_renderBackground:function(F){if(this.backgroundColor){var B=this._getNonTransformedDimensions();F.fillStyle=this.backgroundColor,F.fillRect(-B.x/2,-B.y/2,B.x,B.y),this._removeShadow(F)}},_setOpacity:function(F){this.group&&!this.group._transformDone?F.globalAlpha=this.getObjectOpacity():F.globalAlpha*=this.opacity},_setStrokeStyles:function(F,B){var W=B.stroke;W&&(F.lineWidth=B.strokeWidth,F.lineCap=B.strokeLineCap,F.lineDashOffset=B.strokeDashOffset,F.lineJoin=B.strokeLineJoin,F.miterLimit=B.strokeMiterLimit,W.toLive?"percentage"===W.gradientUnits||W.gradientTransform||W.patternTransform?this._applyPatternForTransformedGradient(F,W):(F.strokeStyle=W.toLive(F,this),this._applyPatternGradientTransform(F,W)):F.strokeStyle=B.stroke)},_setFillStyles:function(F,B){var W=B.fill;W&&(W.toLive?(F.fillStyle=W.toLive(F,this),this._applyPatternGradientTransform(F,B.fill)):F.fillStyle=W)},_setClippingProperties:function(F){F.globalAlpha=1,F.strokeStyle="transparent",F.fillStyle="#000000"},_setLineDash:function(F,B){B&&0!==B.length&&(1&B.length&&B.push.apply(B,B),F.setLineDash(B))},_renderControls:function(F,B){var W,$,Y,J=this.getViewportTransform(),X=this.calcTransformMatrix();$=void 0!==(B=B||{}).hasBorders?B.hasBorders:this.hasBorders,Y=void 0!==B.hasControls?B.hasControls:this.hasControls,X=A.util.multiplyTransformMatrices(J,X),W=A.util.qrDecompose(X),F.save(),F.translate(W.translateX,W.translateY),F.lineWidth=1*this.borderScaleFactor,this.group||(F.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(W.angle-=180),F.rotate(k(this.group?W.angle:this.angle)),B.forActiveSelection||this.group?$&&this.drawBordersInGroup(F,W,B):$&&this.drawBorders(F,B),Y&&this.drawControls(F,B),F.restore()},_setShadow:function(F){if(this.shadow){var B,W=this.shadow,$=this.canvas,Y=$&&$.viewportTransform[0]||1,J=$&&$.viewportTransform[3]||1;B=W.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),$&&$._isRetinaScaling()&&(Y*=A.devicePixelRatio,J*=A.devicePixelRatio),F.shadowColor=W.color,F.shadowBlur=W.blur*A.browserShadowBlurConstant*(Y+J)*(B.scaleX+B.scaleY)/4,F.shadowOffsetX=W.offsetX*Y*B.scaleX,F.shadowOffsetY=W.offsetY*J*B.scaleY}},_removeShadow:function(F){this.shadow&&(F.shadowColor="",F.shadowBlur=F.shadowOffsetX=F.shadowOffsetY=0)},_applyPatternGradientTransform:function(F,B){if(!B||!B.toLive)return{offsetX:0,offsetY:0};var W=B.gradientTransform||B.patternTransform,$=-this.width/2+B.offsetX||0,Y=-this.height/2+B.offsetY||0;return"percentage"===B.gradientUnits?F.transform(this.width,0,0,this.height,$,Y):F.transform(1,0,0,1,$,Y),W&&F.transform(W[0],W[1],W[2],W[3],W[4],W[5]),{offsetX:$,offsetY:Y}},_renderPaintInOrder:function(F){"stroke"===this.paintFirst?(this._renderStroke(F),this._renderFill(F)):(this._renderFill(F),this._renderStroke(F))},_render:function(){},_renderFill:function(F){this.fill&&(F.save(),this._setFillStyles(F,this),"evenodd"===this.fillRule?F.fill("evenodd"):F.fill(),F.restore())},_renderStroke:function(F){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(F),F.save(),this.strokeUniform&&this.group){var B=this.getObjectScaling();F.scale(1/B.scaleX,1/B.scaleY)}else this.strokeUniform&&F.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(F,this.strokeDashArray),this._setStrokeStyles(F,this),F.stroke(),F.restore()}},_applyPatternForTransformedGradient:function(F,B){var W,$=this._limitCacheSize(this._getCacheCanvasDimensions()),Y=A.util.createCanvasElement(),J=this.canvas.getRetinaScaling(),X=$.x/this.scaleX/J,ie=$.y/this.scaleY/J;Y.width=X,Y.height=ie,(W=Y.getContext("2d")).beginPath(),W.moveTo(0,0),W.lineTo(X,0),W.lineTo(X,ie),W.lineTo(0,ie),W.closePath(),W.translate(X/2,ie/2),W.scale($.zoomX/this.scaleX/J,$.zoomY/this.scaleY/J),this._applyPatternGradientTransform(W,B),W.fillStyle=B.toLive(F),W.fill(),F.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),F.scale(J*this.scaleX/$.zoomX,J*this.scaleY/$.zoomY),F.strokeStyle=W.createPattern(Y,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var F=A.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",F.scaleX),this.set("scaleY",F.scaleY),this.angle=F.angle,this.skewX=F.skewX,this.skewY=0}},_removeTransformMatrix:function(F){var B=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),B=A.util.transformPoint(B,this.transformMatrix)),this.transformMatrix=null,F&&(this.scaleX*=F.scaleX,this.scaleY*=F.scaleY,this.cropX=F.cropX,this.cropY=F.cropY,B.x+=F.offsetLeft,B.y+=F.offsetTop,this.width=F.width,this.height=F.height),this.setPositionByOrigin(B,"center","center")},clone:function(F,B){var W=this.toObject(B);this.constructor.fromObject?this.constructor.fromObject(W,F):A.Object._fromObject("Object",W,F)},cloneAsImage:function(F,B){var W=this.toCanvasElement(B);return F&&F(new A.Image(W)),this},toCanvasElement:function(F){F||(F={});var B=A.util,W=B.saveObjectTransform(this),$=this.group,Y=this.shadow,J=Math.abs,X=(F.multiplier||1)*(F.enableRetinaScaling?A.devicePixelRatio:1);delete this.group,F.withoutTransform&&B.resetObjectTransform(this),F.withoutShadow&&(this.shadow=null);var ie,oe,ve,Ae=A.util.createCanvasElement(),Ce=this.getBoundingRect(!0,!0),_e=this.shadow,ge={x:0,y:0};_e&&(oe=_e.blur,ie=_e.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),ge.x=2*Math.round(J(_e.offsetX)+oe)*J(ie.scaleX),ge.y=2*Math.round(J(_e.offsetY)+oe)*J(ie.scaleY)),ve=Ce.height+ge.y,Ae.width=Math.ceil(Ce.width+ge.x),Ae.height=Math.ceil(ve);var ce=new A.StaticCanvas(Ae,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===F.format&&(ce.backgroundColor="#fff"),this.setPositionByOrigin(new A.Point(ce.width/2,ce.height/2),"center","center");var be=this.canvas;ce.add(this);var Ie=ce.toCanvasElement(X||1,F);return this.shadow=Y,this.set("canvas",be),$&&(this.group=$),this.set(W).setCoords(),ce._objects=[],ce.dispose(),ce=null,Ie},toDataURL:function(F){return F||(F={}),A.util.toDataURL(this.toCanvasElement(F),F.format||"png",F.quality||1)},isType:function(F){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===F},complexity:function(){return 1},toJSON:function(F){return this.toObject(F)},rotate:function(F){var B=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return B&&this._setOriginToCenter(),this.set("angle",F),B&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(F,B){B=B||this.canvas.getPointer(F);var W=new A.Point(B.x,B.y),$=this._getLeftTopCoords();return this.angle&&(W=A.util.rotatePoint(W,$,k(-this.angle))),{x:W.x-$.x,y:W.y-$.y}},_setupCompositeOperation:function(F){this.globalCompositeOperation&&(F.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){A.runningAnimations&&A.runningAnimations.cancelByTarget(this)}}),A.util.createAccessors&&A.util.createAccessors(A.Object),P(A.Object.prototype,A.Observable),A.Object.NUM_FRACTION_DIGITS=2,A.Object.ENLIVEN_PROPS=["clipPath"],A.Object._fromObject=function(F,B,W,$){var Y=A[F];B=O(B,!0),A.util.enlivenPatterns([B.fill,B.stroke],function(J){void 0!==J[0]&&(B.fill=J[0]),void 0!==J[1]&&(B.stroke=J[1]),A.util.enlivenObjectEnlivables(B,B,function(){var X=$?new Y(B[$],B):new Y(B);W&&W(X)})})},A.Object.__uid=0)}(l),q=j.util.degreesToRadians,te={left:-.5,center:0,right:.5},se={top:-.5,center:0,bottom:.5},j.util.object.extend(j.Object.prototype,{translateToGivenOrigin:function(I,A,P,O,b){var D,k,U,F=I.x,B=I.y;return"string"==typeof A?A=te[A]:A-=.5,"string"==typeof O?O=te[O]:O-=.5,"string"==typeof P?P=se[P]:P-=.5,"string"==typeof b?b=se[b]:b-=.5,k=b-P,((D=O-A)||k)&&(U=this._getTransformedDimensions(),F=I.x+D*U.x,B=I.y+k*U.y),new j.Point(F,B)},translateToCenterPoint:function(I,A,P){var O=this.translateToGivenOrigin(I,A,P,"center","center");return this.angle?j.util.rotatePoint(O,I,q(this.angle)):O},translateToOriginPoint:function(I,A,P){var O=this.translateToGivenOrigin(I,"center","center",A,P);return this.angle?j.util.rotatePoint(O,I,q(this.angle)):O},getCenterPoint:function(){var I=new j.Point(this.left,this.top);return this.translateToCenterPoint(I,this.originX,this.originY)},getPointByOrigin:function(I,A){var P=this.getCenterPoint();return this.translateToOriginPoint(P,I,A)},toLocalPoint:function(I,A,P){var O,b,D=this.getCenterPoint();return O=void 0!==A&&void 0!==P?this.translateToGivenOrigin(D,"center","center",A,P):new j.Point(this.left,this.top),b=new j.Point(I.x,I.y),this.angle&&(b=j.util.rotatePoint(b,D,-q(this.angle))),b.subtractEquals(O)},setPositionByOrigin:function(I,A,P){var O=this.translateToCenterPoint(I,A,P),b=this.translateToOriginPoint(O,this.originX,this.originY);this.set("left",b.x),this.set("top",b.y)},adjustPosition:function(I){var A,P,O=q(this.angle),b=this.getScaledWidth(),D=j.util.cos(O)*b,k=j.util.sin(O)*b;this.left+=D*((P="string"==typeof I?te[I]:I-.5)-(A="string"==typeof this.originX?te[this.originX]:this.originX-.5)),this.top+=k*(P-A),this.setCoords(),this.originX=I},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var I=this.getCenterPoint();this.originX="center",this.originY="center",this.left=I.x,this.top=I.y},_resetOrigin:function(){var I=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=I.x,this.top=I.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var I=j.util,A=I.degreesToRadians,P=I.multiplyTransformMatrices,O=I.transformPoint;I.object.extend(j.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(b,D){return D?b?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),b?this.aCoords:this.lineCoords)},getCoords:function(b,D){return k=this._getCoords(b,D),[new j.Point(k.tl.x,k.tl.y),new j.Point(k.tr.x,k.tr.y),new j.Point(k.br.x,k.br.y),new j.Point(k.bl.x,k.bl.y)];var k},intersectsWithRect:function(b,D,k,U){var F=this.getCoords(k,U);return"Intersection"===j.Intersection.intersectPolygonRectangle(F,b,D).status},intersectsWithObject:function(b,D,k){return"Intersection"===j.Intersection.intersectPolygonPolygon(this.getCoords(D,k),b.getCoords(D,k)).status||b.isContainedWithinObject(this,D,k)||this.isContainedWithinObject(b,D,k)},isContainedWithinObject:function(b,D,k){for(var U=this.getCoords(D,k),B=0,W=b._getImageLines(D?b.aCoords:b.lineCoords);B<4;B++)if(!b.containsPoint(U[B],W))return!1;return!0},isContainedWithinRect:function(b,D,k,U){var F=this.getBoundingRect(k,U);return F.left>=b.x&&F.left+F.width<=D.x&&F.top>=b.y&&F.top+F.height<=D.y},containsPoint:function(b,D,k,U){var F=this._getCoords(k,U),B=(D=D||this._getImageLines(F),this._findCrossPoints(b,D));return 0!==B&&B%2==1},isOnScreen:function(b){if(!this.canvas)return!1;var D=this.canvas.vptCoords.tl,k=this.canvas.vptCoords.br;return!!this.getCoords(!0,b).some(function(U){return U.x<=k.x&&U.x>=D.x&&U.y<=k.y&&U.y>=D.y})||!!this.intersectsWithRect(D,k,!0,b)||this._containsCenterOfCanvas(D,k,b)},_containsCenterOfCanvas:function(b,D,k){return!!this.containsPoint({x:(b.x+D.x)/2,y:(b.y+D.y)/2},null,!0,k)},isPartiallyOnScreen:function(b){if(!this.canvas)return!1;var D=this.canvas.vptCoords.tl,k=this.canvas.vptCoords.br;return!!this.intersectsWithRect(D,k,!0,b)||this.getCoords(!0,b).every(function(U){return(U.x>=k.x||U.x<=D.x)&&(U.y>=k.y||U.y<=D.y)})&&this._containsCenterOfCanvas(D,k,b)},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(b,D){var k,U,F,B=0;for(var W in D)if(!((F=D[W]).o.y<b.y&&F.d.y<b.y||F.o.y>=b.y&&F.d.y>=b.y||(F.o.x===F.d.x&&F.o.x>=b.x?U=F.o.x:(k=(F.d.y-F.o.y)/(F.d.x-F.o.x),U=-(b.y-0*b.x-(F.o.y-k*F.o.x))/(0-k)),U>=b.x&&(B+=1),2!==B)))break;return B},getBoundingRect:function(b,D){var k=this.getCoords(b,D);return I.makeBoundingBoxFromPoints(k)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?b<0?-this.minScaleLimit:this.minScaleLimit:0===b?1e-4:b},scale:function(b){return this._set("scaleX",b),this._set("scaleY",b),this.setCoords()},scaleToWidth:function(b,D){var k=this.getBoundingRect(D).width/this.getScaledWidth();return this.scale(b/this.width/k)},scaleToHeight:function(b,D){var k=this.getBoundingRect(D).height/this.getScaledHeight();return this.scale(b/this.height/k)},calcLineCoords:function(){var b=this.getViewportTransform(),D=this.padding,k=A(this.angle),U=I.cos(k)*D,F=I.sin(k)*D,B=U+F,W=U-F,$=this.calcACoords(),Y={tl:O($.tl,b),tr:O($.tr,b),bl:O($.bl,b),br:O($.br,b)};return D&&(Y.tl.x-=W,Y.tl.y-=B,Y.tr.x+=B,Y.tr.y-=W,Y.bl.x-=B,Y.bl.y+=W,Y.br.x+=W,Y.br.y+=B),Y},calcOCoords:function(){var b=this._calcRotateMatrix(),D=this._calcTranslateMatrix(),k=this.getViewportTransform(),U=P(k,D),F=P(U,b),B=(F=P(F,[1/k[0],0,0,1/k[3],0,0]),this._calculateCurrentDimensions()),W={};return this.forEachControl(function($,Y,J){W[Y]=$.positionHandler(B,F,J)}),W},calcACoords:function(){var b=this._calcRotateMatrix(),D=this._calcTranslateMatrix(),k=P(D,b),U=this._getTransformedDimensions(),F=U.x/2,B=U.y/2;return{tl:O({x:-F,y:-B},k),tr:O({x:F,y:-B},k),bl:O({x:-F,y:B},k),br:O({x:F,y:B},k)}},setCoords:function(b){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),b||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return I.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var b=this.getCenterPoint();return[1,0,0,1,b.x,b.y]},transformMatrixKey:function(b){var D="_",k="";return!b&&this.group&&(k=this.group.transformMatrixKey(b)+D),k+this.top+D+this.left+D+this.scaleX+D+this.scaleY+D+this.skewX+D+this.skewY+D+this.angle+D+this.originX+D+this.originY+D+this.width+D+this.height+D+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(b){var D=this.calcOwnMatrix();if(b||!this.group)return D;var k=this.transformMatrixKey(b),U=this.matrixCache||(this.matrixCache={});return U.key===k?U.value:(this.group&&(D=P(this.group.calcTransformMatrix(!1),D)),U.key=k,U.value=D,D)},calcOwnMatrix:function(){var b=this.transformMatrixKey(!0),D=this.ownMatrixCache||(this.ownMatrixCache={});if(D.key===b)return D.value;var k=this._calcTranslateMatrix(),U={angle:this.angle,translateX:k[4],translateY:k[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return D.key=b,D.value=I.composeMatrix(U),D.value},_getNonTransformedDimensions:function(){var b=this.strokeWidth;return{x:this.width+b,y:this.height+b}},_getTransformedDimensions:function(b,D){void 0===b&&(b=this.skewX),void 0===D&&(D=this.skewY);var k,U,F,B=0===b&&0===D;if(this.strokeUniform?(U=this.width,F=this.height):(U=(k=this._getNonTransformedDimensions()).x,F=k.y),B)return this._finalizeDimensions(U*this.scaleX,F*this.scaleY);var W=I.sizeAfterTransform(U,F,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:b,skewY:D});return this._finalizeDimensions(W.x,W.y)},_finalizeDimensions:function(b,D){return this.strokeUniform?{x:b+this.strokeWidth,y:D+this.strokeWidth}:{x:b,y:D}},_calculateCurrentDimensions:function(){var b=this.getViewportTransform(),D=this._getTransformedDimensions();return O(D,b,!0).scalarAdd(2*this.padding)}})}(),j.util.object.extend(j.Object.prototype,{sendToBack:function(){return this.group?j.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?j.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(I){return this.group?j.StaticCanvas.prototype.sendBackwards.call(this.group,this,I):this.canvas&&this.canvas.sendBackwards(this,I),this},bringForward:function(I){return this.group?j.StaticCanvas.prototype.bringForward.call(this.group,this,I):this.canvas&&this.canvas.bringForward(this,I),this},moveTo:function(I){return this.group&&"activeSelection"!==this.group.type?j.StaticCanvas.prototype.moveTo.call(this.group,this,I):this.canvas&&this.canvas.moveTo(this,I),this}}),function(){function I(P,O){if(O){if(O.toLive)return P+": url(#SVGID_"+O.id+"); ";var b=new j.Color(O),D=P+": "+b.toRgb()+"; ",k=b.getAlpha();return 1!==k&&(D+=P+"-opacity: "+k.toString()+"; "),D}return P+": none; "}var A=j.util.toFixed;j.util.object.extend(j.Object.prototype,{getSvgStyles:function(P){var O=this.fillRule?this.fillRule:"nonzero",b=this.strokeWidth?this.strokeWidth:"0",D=this.strokeDashArray?this.strokeDashArray.join(" "):"none",k=this.strokeDashOffset?this.strokeDashOffset:"0",U=this.strokeLineCap?this.strokeLineCap:"butt",F=this.strokeLineJoin?this.strokeLineJoin:"miter",B=this.strokeMiterLimit?this.strokeMiterLimit:"4",W=void 0!==this.opacity?this.opacity:"1",$=this.visible?"":" visibility: hidden;",Y=P?"":this.getSvgFilter(),J=I("fill",this.fill);return[I("stroke",this.stroke),"stroke-width: ",b,"; ","stroke-dasharray: ",D,"; ","stroke-linecap: ",U,"; ","stroke-dashoffset: ",k,"; ","stroke-linejoin: ",F,"; ","stroke-miterlimit: ",B,"; ",J,"fill-rule: ",O,"; ","opacity: ",W,";",Y,$].join("")},getSvgSpanStyles:function(P,O){var b="; ",D=P.fontFamily?"font-family: "+(-1===P.fontFamily.indexOf("'")&&-1===P.fontFamily.indexOf('"')?"'"+P.fontFamily+"'":P.fontFamily)+b:"",k=P.strokeWidth?"stroke-width: "+P.strokeWidth+b:"",U=P.fontSize?"font-size: "+P.fontSize+"px"+b:"",F=P.fontStyle?"font-style: "+P.fontStyle+b:"",B=P.fontWeight?"font-weight: "+P.fontWeight+b:"",W=P.fill?I("fill",P.fill):"",$=P.stroke?I("stroke",P.stroke):"",Y=this.getSvgTextDecoration(P);return Y&&(Y="text-decoration: "+Y+b),[$,k,D,U,F,B,Y,W,P.deltaY?"baseline-shift: "+-P.deltaY+"; ":"",O?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(P){return["overline","underline","line-through"].filter(function(O){return P[O.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(P,O){var b=P?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+j.util.matrixToSVG(b)+(O||"")+'" '},_setSVGBg:function(P){if(this.backgroundColor){var O=j.Object.NUM_FRACTION_DIGITS;P.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',A(-this.width/2,O),'" y="',A(-this.height/2,O),'" width="',A(this.width,O),'" height="',A(this.height,O),'"></rect>\n')}},toSVG:function(P){return this._createBaseSVGMarkup(this._toSVG(P),{reviver:P})},toClipPathSVG:function(P){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(P),{reviver:P})},_createBaseClipPathSVGMarkup:function(P,O){var b=(O=O||{}).reviver,k=[this.getSvgTransform(!0,O.additionalTransform||""),this.getSvgCommons()].join(""),U=P.indexOf("COMMON_PARTS");return P[U]=k,b?b(P.join("")):P.join("")},_createBaseSVGMarkup:function(P,O){var b,D,k=(O=O||{}).noStyle,U=O.reviver,F=k?"":'style="'+this.getSvgStyles()+'" ',B=O.withShadow?'style="'+this.getSvgFilter()+'" ':"",W=this.clipPath,$=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",Y=W&&W.absolutePositioned,J=this.stroke,X=this.fill,ie=this.shadow,oe=[],de=P.indexOf("COMMON_PARTS"),ve=O.additionalTransform;return W&&(W.clipPathId="CLIPPATH_"+j.Object.__uid++,D='<clipPath id="'+W.clipPathId+'" >\n'+W.toClipPathSVG(U)+"</clipPath>\n"),Y&&oe.push("<g ",B,this.getSvgCommons()," >\n"),oe.push("<g ",this.getSvgTransform(!1),Y?"":B+this.getSvgCommons()," >\n"),b=[F,$,k?"":this.addPaintOrder()," ",ve?'transform="'+ve+'" ':""].join(""),P[de]=b,X&&X.toLive&&oe.push(X.toSVG(this)),J&&J.toLive&&oe.push(J.toSVG(this)),ie&&oe.push(ie.toSVG(this)),W&&oe.push(D),oe.push(P.join("")),oe.push("</g>\n"),Y&&oe.push("</g>\n"),U?U(oe.join("")):oe.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var I=j.util.object.extend,A="stateProperties";function P(b,D,k){var U={};k.forEach(function(F){U[F]=b[F]}),I(b[D],U,!0)}function O(b,D,k){if(b===D)return!0;if(Array.isArray(b)){if(!Array.isArray(D)||b.length!==D.length)return!1;for(var U=0,F=b.length;U<F;U++)if(!O(b[U],D[U]))return!1;return!0}if(b&&"object"==typeof b){var B,W=Object.keys(b);if(!D||"object"!=typeof D||!k&&W.length!==Object.keys(D).length)return!1;for(U=0,F=W.length;U<F;U++)if("canvas"!==(B=W[U])&&"group"!==B&&!O(b[B],D[B]))return!1;return!0}}j.util.object.extend(j.Object.prototype,{hasStateChanged:function(b){var D="_"+(b=b||A);return Object.keys(this[D]).length<this[b].length||!O(this[D],this,!0)},saveState:function(b){var D=b&&b.propertySet||A,k="_"+D;return this[k]?(P(this,k,this[D]),b&&b.stateProperties&&P(this,k,b.stateProperties),this):this.setupState(b)},setupState:function(b){var D=(b=b||{}).propertySet||A;return b.propertySet=D,this["_"+D]={},this.saveState(b),this}})}(),function(){var I=j.util.degreesToRadians;j.util.object.extend(j.Object.prototype,{_findTargetCorner:function(A,P){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var O,b,D,k=A.x,U=A.y,F=Object.keys(this.oCoords),B=F.length-1;for(this.__corner=0;B>=0;B--)if(this.isControlVisible(D=F[B])&&(b=this._getImageLines(P?this.oCoords[D].touchCorner:this.oCoords[D].corner),0!==(O=this._findCrossPoints({x:k,y:U},b))&&O%2==1))return this.__corner=D,D;return!1},forEachControl:function(A){for(var P in this.controls)A(this.controls[P],P,this)},_setCornerCoords:function(){var A=this.oCoords;for(var P in A){var O=this.controls[P];A[P].corner=O.calcCornerCoords(this.angle,this.cornerSize,A[P].x,A[P].y,!1),A[P].touchCorner=O.calcCornerCoords(this.angle,this.touchCornerSize,A[P].x,A[P].y,!0)}},drawSelectionBackground:function(A){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;A.save();var P=this.getCenterPoint(),O=this._calculateCurrentDimensions(),b=this.canvas.viewportTransform;return A.translate(P.x,P.y),A.scale(1/b[0],1/b[3]),A.rotate(I(this.angle)),A.fillStyle=this.selectionBackgroundColor,A.fillRect(-O.x/2,-O.y/2,O.x,O.y),A.restore(),this},drawBorders:function(A,P){P=P||{};var O=this._calculateCurrentDimensions(),b=this.borderScaleFactor,D=O.x+b,k=O.y+b,U=void 0!==P.hasControls?P.hasControls:this.hasControls,F=!1;return A.save(),A.strokeStyle=P.borderColor||this.borderColor,this._setLineDash(A,P.borderDashArray||this.borderDashArray),A.strokeRect(-D/2,-k/2,D,k),U&&(A.beginPath(),this.forEachControl(function(B,W,$){B.withConnection&&B.getVisibility($,W)&&(F=!0,A.moveTo(B.x*D,B.y*k),A.lineTo(B.x*D+B.offsetX,B.y*k+B.offsetY))}),F&&A.stroke()),A.restore(),this},drawBordersInGroup:function(A,P,O){O=O||{};var b=j.util.sizeAfterTransform(this.width,this.height,P),D=this.strokeWidth,k=this.strokeUniform,U=this.borderScaleFactor,F=b.x+D*(k?this.canvas.getZoom():P.scaleX)+U,B=b.y+D*(k?this.canvas.getZoom():P.scaleY)+U;return A.save(),this._setLineDash(A,O.borderDashArray||this.borderDashArray),A.strokeStyle=O.borderColor||this.borderColor,A.strokeRect(-F/2,-B/2,F,B),A.restore(),this},drawControls:function(A,P){P=P||{},A.save();var O,b,D=this.canvas.getRetinaScaling();return A.setTransform(D,0,0,D,0,0),A.strokeStyle=A.fillStyle=P.cornerColor||this.cornerColor,this.transparentCorners||(A.strokeStyle=P.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(A,P.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(O=this.group.calcTransformMatrix()),this.forEachControl(function(k,U,F){b=F.oCoords[U],k.getVisibility(F,U)&&(O&&(b=j.util.transformPoint(b,O)),k.render(A,b.x,b.y,P,F))}),A.restore(),this},isControlVisible:function(A){return this.controls[A]&&this.controls[A].getVisibility(this,A)},setControlVisible:function(A,P){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[A]=P,this},setControlsVisibility:function(A){for(var P in A||(A={}),A)this.setControlVisible(P,A[P]);return this},onDeselect:function(){},onSelect:function(){}})}(),j.util.object.extend(j.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(I,A){var P=function(){},O=(A=A||{}).onComplete||P,b=A.onChange||P,D=this;return j.util.animate({target:this,startValue:I.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(k){I.set("left",k),D.requestRenderAll(),b()},onComplete:function(){I.setCoords(),O()}})},fxCenterObjectV:function(I,A){var P=function(){},O=(A=A||{}).onComplete||P,b=A.onChange||P,D=this;return j.util.animate({target:this,startValue:I.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(k){I.set("top",k),D.requestRenderAll(),b()},onComplete:function(){I.setCoords(),O()}})},fxRemove:function(I,A){var P=function(){},O=(A=A||{}).onComplete||P,b=A.onChange||P,D=this;return j.util.animate({target:this,startValue:I.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(k){I.set("opacity",k),D.requestRenderAll(),b()},onComplete:function(){D.remove(I),O()}})}}),j.util.object.extend(j.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var I,P=[],O=[];for(I in arguments[0])P.push(I);for(var b=0,D=P.length;b<D;b++)O.push(this._animate(I=P[b],arguments[0][I],arguments[1],b!==D-1));return O}return this._animate.apply(this,arguments)},_animate:function(I,A,P,O){var b,D=this;A=A.toString(),P=P?j.util.object.clone(P):{},~I.indexOf(".")&&(b=I.split("."));var k=D.colorProperties.indexOf(I)>-1||b&&D.colorProperties.indexOf(b[1])>-1,U=b?this.get(b[0])[b[1]]:this.get(I);"from"in P||(P.from=U),k||(A=~A.indexOf("=")?U+parseFloat(A.replace("=","")):parseFloat(A));var F={target:this,startValue:P.from,endValue:A,byValue:P.by,easing:P.easing,duration:P.duration,abort:P.abort&&function(B,W,$){return P.abort.call(D,B,W,$)},onChange:function(B,W,$){b?D[b[0]][b[1]]=B:D.set(I,B),O||P.onChange&&P.onChange(B,W,$)},onComplete:function(B,W,$){O||(D.setCoords(),P.onComplete&&P.onComplete(B,W,$))}};return k?j.util.animateColor(F.startValue,F.endValue,F.duration,F):j.util.animate(F)}}),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.util.object.clone,b={x1:1,x2:1,y1:1,y2:1};function D(k,U){var F=k.origin,B=k.axis1,W=k.axis2,$=k.dimension,Y=U.nearest,J=U.center,X=U.farthest;return function(){switch(this.get(F)){case Y:return Math.min(this.get(B),this.get(W));case J:return Math.min(this.get(B),this.get(W))+.5*this.get($);case X:return Math.max(this.get(B),this.get(W))}}}A.Line?A.warn("fabric.Line is already defined"):(A.Line=A.util.createClass(A.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:A.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(k,U){k||(k=[0,0,0,0]),this.callSuper("initialize",U),this.set("x1",k[0]),this.set("y1",k[1]),this.set("x2",k[2]),this.set("y2",k[3]),this._setWidthHeight(U)},_setWidthHeight:function(k){k||(k={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in k?k.left:this._getLeftToOriginX(),this.top="top"in k?k.top:this._getTopToOriginY()},_set:function(k,U){return this.callSuper("_set",k,U),void 0!==b[k]&&this._setWidthHeight(),this},_getLeftToOriginX:D({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:D({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(k){k.beginPath();var U=this.calcLinePoints();k.moveTo(U.x1,U.y1),k.lineTo(U.x2,U.y2),k.lineWidth=this.strokeWidth;var F=k.strokeStyle;k.strokeStyle=this.stroke||k.fillStyle,this.stroke&&this._renderStroke(k),k.strokeStyle=F},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(k){return P(this.callSuper("toObject",k),this.calcLinePoints())},_getNonTransformedDimensions:function(){var k=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(k.y-=this.strokeWidth),0===this.height&&(k.x-=this.strokeWidth)),k},calcLinePoints:function(){var k=this.x1<=this.x2?-1:1,U=this.y1<=this.y2?-1:1;return{x1:k*this.width*.5,x2:k*this.width*-.5,y1:U*this.height*.5,y2:U*this.height*-.5}},_toSVG:function(){var k=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',k.x1,'" y1="',k.y1,'" x2="',k.x2,'" y2="',k.y2,'" />\n']}}),A.Line.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),A.Line.fromElement=function(k,U,F){F=F||{};var B=A.parseAttributes(k,A.Line.ATTRIBUTE_NAMES);U(new A.Line([B.x1||0,B.y1||0,B.x2||0,B.y2||0],P(B,F)))},A.Line.fromObject=function(k,U){var F=O(k,!0);F.points=[k.x1,k.y1,k.x2,k.y2],A.Object._fromObject("Line",F,function(B){delete B.points,U&&U(B)},"points")})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.degreesToRadians;A.Circle?A.warn("fabric.Circle is already defined."):(A.Circle=A.util.createClass(A.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:A.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(O,b){return this.callSuper("_set",O,b),"radius"===O&&this.setRadius(b),this},toObject:function(O){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(O))},_toSVG:function(){var O,b=(this.endAngle-this.startAngle)%360;if(0===b)O=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var D=P(this.startAngle),k=P(this.endAngle),U=this.radius;O=['<path d="M '+A.util.cos(D)*U+" "+A.util.sin(D)*U," A "+U+" "+U," 0 ",+(b>180?"1":"0")+" 1"," "+A.util.cos(k)*U+" "+A.util.sin(k)*U,'" ',"COMMON_PARTS"," />\n"]}return O},_render:function(O){O.beginPath(),O.arc(0,0,this.radius,P(this.startAngle),P(this.endAngle),!1),this._renderPaintInOrder(O)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(O){return this.radius=O,this.set("width",2*O).set("height",2*O)}}),A.Circle.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),A.Circle.fromElement=function(O,b){var D,k=A.parseAttributes(O,A.Circle.ATTRIBUTE_NAMES);if(!("radius"in(D=k)&&D.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");k.left=(k.left||0)-k.radius,k.top=(k.top||0)-k.radius,b(new A.Circle(k))},A.Circle.fromObject=function(O,b){A.Object._fromObject("Circle",O,b)})}(l),function(I){var A=I.fabric||(I.fabric={});A.Triangle?A.warn("fabric.Triangle is already defined"):(A.Triangle=A.util.createClass(A.Object,{type:"triangle",width:100,height:100,_render:function(P){var O=this.width/2,b=this.height/2;P.beginPath(),P.moveTo(-O,b),P.lineTo(0,-b),P.lineTo(O,b),P.closePath(),this._renderPaintInOrder(P)},_toSVG:function(){var P=this.width/2,O=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-P+" "+O,"0 "+-O,P+" "+O].join(","),'" />']}}),A.Triangle.fromObject=function(P,O){return A.Object._fromObject("Triangle",P,O)})}(l),function(I){var A=I.fabric||(I.fabric={}),P=2*Math.PI;A.Ellipse?A.warn("fabric.Ellipse is already defined."):(A.Ellipse=A.util.createClass(A.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:A.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(O){this.callSuper("initialize",O),this.set("rx",O&&O.rx||0),this.set("ry",O&&O.ry||0)},_set:function(O,b){switch(this.callSuper("_set",O,b),O){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(O){return this.callSuper("toObject",["rx","ry"].concat(O))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(O){O.beginPath(),O.save(),O.transform(1,0,0,this.ry/this.rx,0,0),O.arc(0,0,this.rx,0,P,!1),O.restore(),this._renderPaintInOrder(O)}}),A.Ellipse.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),A.Ellipse.fromElement=function(O,b){var D=A.parseAttributes(O,A.Ellipse.ATTRIBUTE_NAMES);D.left=(D.left||0)-D.rx,D.top=(D.top||0)-D.ry,b(new A.Ellipse(D))},A.Ellipse.fromObject=function(O,b){A.Object._fromObject("Ellipse",O,b)})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend;A.Rect?A.warn("fabric.Rect is already defined"):(A.Rect=A.util.createClass(A.Object,{stateProperties:A.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:A.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(O){this.callSuper("initialize",O),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(O){var b=this.rx?Math.min(this.rx,this.width/2):0,D=this.ry?Math.min(this.ry,this.height/2):0,k=this.width,U=this.height,F=-this.width/2,B=-this.height/2,W=0!==b||0!==D,$=.4477152502;O.beginPath(),O.moveTo(F+b,B),O.lineTo(F+k-b,B),W&&O.bezierCurveTo(F+k-$*b,B,F+k,B+$*D,F+k,B+D),O.lineTo(F+k,B+U-D),W&&O.bezierCurveTo(F+k,B+U-$*D,F+k-$*b,B+U,F+k-b,B+U),O.lineTo(F+b,B+U),W&&O.bezierCurveTo(F+$*b,B+U,F,B+U-$*D,F,B+U-D),O.lineTo(F,B+D),W&&O.bezierCurveTo(F,B+$*D,F+$*b,B,F+b,B),O.closePath(),this._renderPaintInOrder(O)},toObject:function(O){return this.callSuper("toObject",["rx","ry"].concat(O))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),A.Rect.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),A.Rect.fromElement=function(O,b,D){if(!O)return b(null);D=D||{};var k=A.parseAttributes(O,A.Rect.ATTRIBUTE_NAMES);k.left=k.left||0,k.top=k.top||0,k.height=k.height||0,k.width=k.width||0;var U=new A.Rect(P(D?A.util.object.clone(D):{},k));U.visible=U.visible&&U.width>0&&U.height>0,b(U)},A.Rect.fromObject=function(O,b){return A.Object._fromObject("Rect",O,b)})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.util.array.min,b=A.util.array.max,D=A.util.toFixed,k=A.util.projectStrokeOnPoints;A.Polyline?A.warn("fabric.Polyline is already defined"):(A.Polyline=A.util.createClass(A.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:A.Object.prototype.cacheProperties.concat("points"),initialize:function(U,F){F=F||{},this.points=U||[],this.callSuper("initialize",F),this._setPositionDimensions(F)},_projectStrokeOnPoints:function(){return k(this.points,this,!0)},_setPositionDimensions:function(U){var F,B=this._calcDimensions(U),W=this.exactBoundingBox?this.strokeWidth:0;this.width=B.width-W,this.height=B.height-W,U.fromSVG||(F=this.translateToGivenOrigin({x:B.left-this.strokeWidth/2+W/2,y:B.top-this.strokeWidth/2+W/2},"left","top",this.originX,this.originY)),void 0===U.left&&(this.left=U.fromSVG?B.left:F.x),void 0===U.top&&(this.top=U.fromSVG?B.top:F.y),this.pathOffset={x:B.left+this.width/2+W/2,y:B.top+this.height/2+W/2}},_calcDimensions:function(){var U=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,F=O(U,"x")||0,B=O(U,"y")||0;return{left:F,top:B,width:(b(U,"x")||0)-F,height:(b(U,"y")||0)-B}},toObject:function(U){return P(this.callSuper("toObject",U),{points:this.points.concat()})},_toSVG:function(){for(var U=[],F=this.pathOffset.x,B=this.pathOffset.y,W=A.Object.NUM_FRACTION_DIGITS,$=0,Y=this.points.length;$<Y;$++)U.push(D(this.points[$].x-F,W),",",D(this.points[$].y-B,W)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',U.join(""),'" />\n']},commonRender:function(U){var F,B=this.points.length,W=this.pathOffset.x,$=this.pathOffset.y;if(!B||isNaN(this.points[B-1].y))return!1;U.beginPath(),U.moveTo(this.points[0].x-W,this.points[0].y-$);for(var Y=0;Y<B;Y++)U.lineTo((F=this.points[Y]).x-W,F.y-$);return!0},_render:function(U){this.commonRender(U)&&this._renderPaintInOrder(U)},complexity:function(){return this.get("points").length}}),A.Polyline.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat(),A.Polyline.fromElementGenerator=function(U){return function(F,B,W){if(!F)return B(null);W||(W={});var $=A.parsePointsAttribute(F.getAttribute("points")),Y=A.parseAttributes(F,A[U].ATTRIBUTE_NAMES);Y.fromSVG=!0,B(new A[U]($,P(Y,W)))}},A.Polyline.fromElement=A.Polyline.fromElementGenerator("Polyline"),A.Polyline.fromObject=function(U,F){return A.Object._fromObject("Polyline",U,F,"points")})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.projectStrokeOnPoints;A.Polygon?A.warn("fabric.Polygon is already defined"):(A.Polygon=A.util.createClass(A.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return P(this.points,this)},_render:function(O){this.commonRender(O)&&(O.closePath(),this._renderPaintInOrder(O))}}),A.Polygon.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat(),A.Polygon.fromElement=A.Polyline.fromElementGenerator("Polygon"),A.Polygon.fromObject=function(O,b){A.Object._fromObject("Polygon",O,b,"points")})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.array.min,O=A.util.array.max,b=A.util.object.extend,D=A.util.object.clone,k=A.util.toFixed;A.Path?A.warn("fabric.Path is already defined"):(A.Path=A.util.createClass(A.Object,{type:"path",path:null,cacheProperties:A.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:A.Object.prototype.stateProperties.concat("path"),initialize:function(U,F){delete(F=D(F||{})).path,this.callSuper("initialize",F),this._setPath(U||[],F)},_setPath:function(U,F){this.path=A.util.makePathSimpler(Array.isArray(U)?U:A.util.parsePath(U)),A.Polyline.prototype._setPositionDimensions.call(this,F||{})},_renderPathCommands:function(U){var F,B=0,W=0,$=0,Y=0,ie=-this.pathOffset.x,oe=-this.pathOffset.y;U.beginPath();for(var de=0,ve=this.path.length;de<ve;++de)switch((F=this.path[de])[0]){case"L":U.lineTo(($=F[1])+ie,(Y=F[2])+oe);break;case"M":B=$=F[1],W=Y=F[2],U.moveTo($+ie,Y+oe);break;case"C":U.bezierCurveTo(F[1]+ie,F[2]+oe,F[3]+ie,F[4]+oe,($=F[5])+ie,(Y=F[6])+oe);break;case"Q":U.quadraticCurveTo(F[1]+ie,F[2]+oe,F[3]+ie,F[4]+oe),$=F[3],Y=F[4];break;case"z":case"Z":$=B,Y=W,U.closePath()}},_render:function(U){this._renderPathCommands(U),this._renderPaintInOrder(U)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(U){return b(this.callSuper("toObject",U),{path:this.path.map(function(F){return F.slice()})})},toDatalessObject:function(U){var F=this.toObject(["sourcePath"].concat(U));return F.sourcePath&&delete F.path,F},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',A.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var U=A.Object.NUM_FRACTION_DIGITS;return" translate("+k(-this.pathOffset.x,U)+", "+k(-this.pathOffset.y,U)+")"},toClipPathSVG:function(U){var F=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:U,additionalTransform:F})},toSVG:function(U){var F=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:U,additionalTransform:F})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var U,F,B=[],W=[],$=0,Y=0,J=0,X=0,ie=0,oe=this.path.length;ie<oe;++ie){switch((U=this.path[ie])[0]){case"L":J=U[1],X=U[2],F=[];break;case"M":$=J=U[1],Y=X=U[2],F=[];break;case"C":F=A.util.getBoundsOfCurve(J,X,U[1],U[2],U[3],U[4],U[5],U[6]),J=U[5],X=U[6];break;case"Q":F=A.util.getBoundsOfCurve(J,X,U[1],U[2],U[1],U[2],U[3],U[4]),J=U[3],X=U[4];break;case"z":case"Z":J=$,X=Y}F.forEach(function(Ae){B.push(Ae.x),W.push(Ae.y)}),B.push(J),W.push(X)}var de=P(B)||0,ve=P(W)||0;return{left:de,top:ve,width:(O(B)||0)-de,height:(O(W)||0)-ve}}}),A.Path.fromObject=function(U,F){"string"==typeof U.sourcePath?A.loadSVGFromURL(U.sourcePath,function(W){var $=W[0];$.setOptions(U),F&&F($)}):A.Object._fromObject("Path",U,F,"path")},A.Path.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat(["d"]),A.Path.fromElement=function(U,F,B){var W=A.parseAttributes(U,A.Path.ATTRIBUTE_NAMES);W.fromSVG=!0,F(new A.Path(W.d,b(W,B)))})}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.array.min,O=A.util.array.max;A.Group||(A.Group=A.util.createClass(A.Object,A.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(b,D,k){D=D||{},this._objects=[],k&&this.callSuper("initialize",D),this._objects=b||[];for(var U=this._objects.length;U--;)this._objects[U].group=this;if(k)this._updateObjectsACoords();else{var F=D&&D.centerPoint;void 0!==D.originX&&(this.originX=D.originX),void 0!==D.originY&&(this.originY=D.originY),F||this._calcBounds(),this._updateObjectsCoords(F),delete D.centerPoint,this.callSuper("initialize",D)}this.setCoords()},_updateObjectsACoords:function(){for(var b=this._objects.length;b--;)this._objects[b].setCoords(!0)},_updateObjectsCoords:function(b){b=b||this.getCenterPoint();for(var D=this._objects.length;D--;)this._updateObjectCoords(this._objects[D],b)},_updateObjectCoords:function(b,D){b.set({left:b.left-D.x,top:b.top-D.y}),b.group=this,b.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(b){var D=!!this.group;return this._restoreObjectsState(),A.util.resetObjectTransform(this),b&&(D&&A.util.removeTransformFromObject(b,this.group.calcTransformMatrix()),this._objects.push(b),b.group=this,b._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,D?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(b){return this._restoreObjectsState(),A.util.resetObjectTransform(this),this.remove(b),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(b){this.dirty=!0,b.group=this,b._set("canvas",this.canvas)},_onObjectRemoved:function(b){this.dirty=!0,delete b.group},_set:function(b,D){var k=this._objects.length;if(this.useSetOnGroup)for(;k--;)this._objects[k].setOnGroup(b,D);if("canvas"===b)for(;k--;)this._objects[k]._set(b,D);A.Object.prototype._set.call(this,b,D)},toObject:function(b){var D=this.includeDefaultValues,k=this._objects.filter(function(F){return!F.excludeFromExport}).map(function(F){var B=F.includeDefaultValues;F.includeDefaultValues=D;var W=F.toObject(b);return F.includeDefaultValues=B,W}),U=A.Object.prototype.toObject.call(this,b);return U.objects=k,U},toDatalessObject:function(b){var D,k=this.sourcePath;if(k)D=k;else{var U=this.includeDefaultValues;D=this._objects.map(function(B){var W=B.includeDefaultValues;B.includeDefaultValues=U;var $=B.toDatalessObject(b);return B.includeDefaultValues=W,$})}var F=A.Object.prototype.toDatalessObject.call(this,b);return F.objects=D,F},render:function(b){this._transformDone=!0,this.callSuper("render",b),this._transformDone=!1},shouldCache:function(){var b=A.Object.prototype.shouldCache.call(this);if(b)for(var D=0,k=this._objects.length;D<k;D++)if(this._objects[D].willDrawShadow())return this.ownCaching=!1,!1;return b},willDrawShadow:function(){if(A.Object.prototype.willDrawShadow.call(this))return!0;for(var b=0,D=this._objects.length;b<D;b++)if(this._objects[b].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(b){for(var D=0,k=this._objects.length;D<k;D++)this._objects[D].render(b);this._drawClipPath(b,this.clipPath)},isCacheDirty:function(b){if(this.callSuper("isCacheDirty",b))return!0;if(!this.statefullCache)return!1;for(var D=0,k=this._objects.length;D<k;D++)if(this._objects[D].isCacheDirty(!0)){if(this._cacheCanvas){var U=this.cacheWidth/this.zoomX,F=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-U/2,-F/2,U,F)}return!0}return!1},_restoreObjectsState:function(){var b=this.calcOwnMatrix();return this._objects.forEach(function(D){A.util.addTransformToObject(D,b),delete D.group,D.setCoords()}),this},destroy:function(){return this._objects.forEach(function(b){b.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(b){b.dispose&&b.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var b=this._objects,D=this.canvas;this._objects=[];var k=this.toObject();delete k.objects;var U=new A.ActiveSelection([]);return U.set(k),U.type="activeSelection",D.remove(this),b.forEach(function(F){F.group=U,F.dirty=!0,D.add(F)}),U.canvas=D,U._objects=b,D._activeObject=U,U.setCoords(),U}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(b){b.setCoords(!0)}),this},_calcBounds:function(b){for(var D,k,U,F,B=[],W=[],$=["tr","br","bl","tl"],Y=0,J=this._objects.length,X=$.length;Y<J;++Y){for(U=(D=this._objects[Y]).calcACoords(),F=0;F<X;F++)B.push(U[k=$[F]].x),W.push(U[k].y);D.aCoords=U}this._getBounds(B,W,b)},_getBounds:function(b,D,k){var U=new A.Point(P(b),P(D)),F=new A.Point(O(b),O(D)),B=U.y||0,W=U.x||0,Y=F.y-U.y||0;this.width=F.x-U.x||0,this.height=Y,k||this.setPositionByOrigin({x:W,y:B},"left","top")},_toSVG:function(b){for(var D=["<g ","COMMON_PARTS"," >\n"],k=0,U=this._objects.length;k<U;k++)D.push("\t\t",this._objects[k].toSVG(b));return D.push("</g>\n"),D},getSvgStyles:function(){var D=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),D].join("")},toClipPathSVG:function(b){for(var D=[],k=0,U=this._objects.length;k<U;k++)D.push("\t",this._objects[k].toClipPathSVG(b));return this._createBaseClipPathSVGMarkup(D,{reviver:b})}}),A.Group.fromObject=function(b,D){var k=b.objects,U=A.util.object.clone(b,!0);delete U.objects,"string"!=typeof k?A.util.enlivenObjects(k,function(F){var B=A.util.object.clone(b,!0);delete B.objects,A.util.enlivenObjectEnlivables(b,B,function(){D&&D(new A.Group(F,B,!0))})}):A.loadSVGFromURL(k,function(F){var B=A.util.groupSVGElements(F,b,k);B.set(U),D&&D(B)})})}(l),function(I){var A=I.fabric||(I.fabric={});A.ActiveSelection||(A.ActiveSelection=A.util.createClass(A.Group,{type:"activeSelection",initialize:function(P,O){O=O||{},this._objects=P||[];for(var b=this._objects.length;b--;)this._objects[b].group=this;O.originX&&(this.originX=O.originX),O.originY&&(this.originY=O.originY),this._calcBounds(),this._updateObjectsCoords(),A.Object.prototype.initialize.call(this,O),this.setCoords()},toGroup:function(){var P=this._objects.concat();this._objects=[];var O=A.Object.prototype.toObject.call(this),b=new A.Group([]);if(delete O.type,b.set(O),P.forEach(function(k){k.canvas.remove(k),k.group=b}),b._objects=P,!this.canvas)return b;var D=this.canvas;return D.add(b),D._activeObject=b,b.setCoords(),b},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(P,O,b){P.save(),P.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",P,O),void 0===(b=b||{}).hasControls&&(b.hasControls=!1),b.forActiveSelection=!0;for(var D=0,k=this._objects.length;D<k;D++)this._objects[D]._renderControls(P,b);P.restore()}}),A.ActiveSelection.fromObject=function(P,O){A.util.enlivenObjects(P.objects,function(b){delete P.objects,O&&O(new A.ActiveSelection(b,P,!0))})})}(l),function(I){var A=j.util.object.extend;I.fabric||(I.fabric={}),I.fabric.Image?j.warn("fabric.Image is already defined."):(j.Image=j.util.createClass(j.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:j.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:j.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(P,O){O||(O={}),this.filters=[],this.cacheKey="texture"+j.Object.__uid++,this.callSuper("initialize",O),this._initElement(P,O)},getElement:function(){return this._element||{}},setElement:function(P,O){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=P,this._originalElement=P,this._initConfig(O),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(P){var O=j.filterBackend;O&&O.evictCachesForKey&&O.evictCachesForKey(P)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(P){j.util.cleanUpJsdomNode(this[P]),this[P]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var P=this.getElement();return{width:P.naturalWidth||P.width,height:P.naturalHeight||P.height}},_stroke:function(P){if(this.stroke&&0!==this.strokeWidth){var O=this.width/2,b=this.height/2;P.beginPath(),P.moveTo(-O,-b),P.lineTo(O,-b),P.lineTo(O,b),P.lineTo(-O,b),P.lineTo(-O,-b),P.closePath()}},toObject:function(P){var O=[];this.filters.forEach(function(D){D&&O.push(D.toObject())});var b=A(this.callSuper("toObject",["cropX","cropY"].concat(P)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:O});return this.resizeFilter&&(b.resizeFilter=this.resizeFilter.toObject()),b},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var P,O=[],b=[],D=this._element,k=-this.width/2,U=-this.height/2,F="",B="";if(!D)return[];if(this.hasCrop()){var W=j.Object.__uid++;O.push('<clipPath id="imageCrop_'+W+'">\n','\t<rect x="'+k+'" y="'+U+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),F=' clip-path="url(#imageCrop_'+W+')" '}if(this.imageSmoothing||(B='" image-rendering="optimizeSpeed'),b.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',k-this.cropX,'" y="',U-this.cropY,'" width="',D.width||D.naturalWidth,'" height="',D.height||D.height,B,'"',F,"></image>\n"),this.stroke||this.strokeDashArray){var $=this.fill;this.fill=null,P=["\t<rect ",'x="',k,'" y="',U,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=$}return"fill"!==this.paintFirst?O.concat(P,b):O.concat(b,P)},getSrc:function(P){var O=P?this._element:this._originalElement;return O?O.toDataURL?O.toDataURL():this.srcFromAttribute?O.getAttribute("src"):O.src:this.src||""},setSrc:function(P,O,b){return j.util.loadImage(P,function(D,k){this.setElement(D,b),this._setWidthHeight(),O&&O(this,k)},this,b&&b.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var P=this.resizeFilter,O=this.minimumScaleTrigger,b=this.getTotalObjectScaling(),D=b.scaleX,k=b.scaleY,U=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!P||D>O&&k>O)return this._element=U,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=D,void(this._lastScaleY=k);j.filterBackend||(j.filterBackend=j.initFilterBackend());var F=j.util.createCanvasElement(),B=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,W=U.width,$=U.height;F.width=W,F.height=$,this._element=F,this._lastScaleX=P.scaleX=D,this._lastScaleY=P.scaleY=k,j.filterBackend.applyFilters([P],U,W,$,this._element,B),this._filterScalingX=F.width/this._originalElement.width,this._filterScalingY=F.height/this._originalElement.height},applyFilters:function(P){if(P=(P=P||this.filters||[]).filter(function(U){return U&&!U.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===P.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var O=this._originalElement,b=O.naturalWidth||O.width,D=O.naturalHeight||O.height;if(this._element===this._originalElement){var k=j.util.createCanvasElement();k.width=b,k.height=D,this._element=k,this._filteredEl=k}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,b,D),this._lastScaleX=1,this._lastScaleY=1;return j.filterBackend||(j.filterBackend=j.initFilterBackend()),j.filterBackend.applyFilters(P,this._originalElement,b,D,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(P){j.util.setImageSmoothing(P,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(P),this._renderPaintInOrder(P)},drawCacheOnCanvas:function(P){j.util.setImageSmoothing(P,this.imageSmoothing),j.Object.prototype.drawCacheOnCanvas.call(this,P)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(P){var O=this._element;if(O){var b=this._filterScalingX,D=this._filterScalingY,k=this.width,U=this.height,F=Math.min,B=Math.max,W=B(this.cropX,0),$=B(this.cropY,0),Y=O.naturalWidth||O.width,J=O.naturalHeight||O.height,X=W*b,ie=$*D,oe=F(k*b,Y-X),de=F(U*D,J-ie),ve=-k/2,Ae=-U/2,Ce=F(k,Y/b-W),_e=F(U,J/D-$);O&&P.drawImage(O,X,ie,oe,de,ve,Ae,Ce,_e)}},_needsResize:function(){var P=this.getTotalObjectScaling();return P.scaleX!==this._lastScaleX||P.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(P,O){this.setElement(j.util.getById(P),O),j.util.addClass(this.getElement(),j.Image.CSS_CANVAS)},_initConfig:function(P){P||(P={}),this.setOptions(P),this._setWidthHeight(P)},_initFilters:function(P,O){P&&P.length?j.util.enlivenObjects(P,function(b){O&&O(b)},"fabric.Image.filters"):O&&O()},_setWidthHeight:function(P){P||(P={});var O=this.getElement();this.width=P.width||O.naturalWidth||O.width||0,this.height=P.height||O.naturalHeight||O.height||0},parsePreserveAspectRatioAttribute:function(){var P,O=j.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),b=this._element.width,D=this._element.height,k=1,U=1,F=0,B=0,W=0,$=0,Y=this.width,J=this.height,X={width:Y,height:J};return!O||"none"===O.alignX&&"none"===O.alignY?(k=Y/b,U=J/D):("meet"===O.meetOrSlice&&(P=(Y-b*(k=U=j.util.findScaleToFit(this._element,X)))/2,"Min"===O.alignX&&(F=-P),"Max"===O.alignX&&(F=P),P=(J-D*U)/2,"Min"===O.alignY&&(B=-P),"Max"===O.alignY&&(B=P)),"slice"===O.meetOrSlice&&(P=b-Y/(k=U=j.util.findScaleToCover(this._element,X)),"Mid"===O.alignX&&(W=P/2),"Max"===O.alignX&&(W=P),P=D-J/U,"Mid"===O.alignY&&($=P/2),"Max"===O.alignY&&($=P),b=Y/k,D=J/U)),{width:b,height:D,scaleX:k,scaleY:U,offsetLeft:F,offsetTop:B,cropX:W,cropY:$}}}),j.Image.CSS_CANVAS="canvas-img",j.Image.prototype.getSvgSrc=j.Image.prototype.getSrc,j.Image.fromObject=function(P,O){var b=j.util.object.clone(P);j.util.loadImage(b.src,function(D,k){k?O&&O(null,!0):j.Image.prototype._initFilters.call(b,b.filters,function(U){b.filters=U||[],j.Image.prototype._initFilters.call(b,[b.resizeFilter],function(F){b.resizeFilter=F[0],j.util.enlivenObjectEnlivables(b,b,function(){var B=new j.Image(D,b);O(B,!1)})})})},null,b.crossOrigin)},j.Image.fromURL=function(P,O,b){j.util.loadImage(P,function(D,k){O&&O(new j.Image(D,b),k)},null,b&&b.crossOrigin)},j.Image.ATTRIBUTE_NAMES=j.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),j.Image.fromElement=function(P,O,b){var D=j.parseAttributes(P,j.Image.ATTRIBUTE_NAMES);j.Image.fromURL(D["xlink:href"],O,A(b?j.util.object.clone(b):{},D))})}(l),j.util.object.extend(j.Object.prototype,{_getAngleValueForStraighten:function(){var I=this.angle%360;return I>0?90*Math.round((I-1)/90):90*Math.round(I/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(I){var A=function(){},P=(I=I||{}).onComplete||A,O=I.onChange||A,b=this;return j.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(D){b.rotate(D),O()},onComplete:function(){b.setCoords(),P()}})}}),j.util.object.extend(j.StaticCanvas.prototype,{straightenObject:function(I){return I.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(I){return I.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function I(P,O){var b="precision "+O+" float;\nvoid main(){}",D=P.createShader(P.FRAGMENT_SHADER);return P.shaderSource(D,b),P.compileShader(D),!!P.getShaderParameter(D,P.COMPILE_STATUS)}function A(P){P&&P.tileSize&&(this.tileSize=P.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}j.isWebglSupported=function(P){if(j.isLikelyNode)return!1;P=P||j.WebglFilterBackend.prototype.tileSize;var O=document.createElement("canvas"),b=O.getContext("webgl")||O.getContext("experimental-webgl"),D=!1;if(b){j.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE),D=j.maxTextureSize>=P;for(var k=["highp","mediump","lowp"],U=0;U<3;U++)if(I(b,k[U])){j.webGlPrecision=k[U];break}}return this.isSupported=D,D},j.WebglFilterBackend=A,A.prototype={tileSize:2048,resources:{},setupGLContext:function(P,O){this.dispose(),this.createWebGLCanvas(P,O),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(P,O)},chooseFastestCopyGLTo2DMethod:function(P,O){var b,D=void 0!==window.performance;try{new ImageData(1,1),b=!0}catch(J){b=!1}var k="undefined"!=typeof ArrayBuffer,U="undefined"!=typeof Uint8ClampedArray;if(D&&b&&k&&U){var F=j.util.createCanvasElement(),B=new ArrayBuffer(P*O*4);if(j.forceGLPutImageData)return this.imageBuffer=B,void(this.copyGLTo2D=xe);var W,$,Y={imageBuffer:B,destinationWidth:P,destinationHeight:O,targetCanvas:F};F.width=P,F.height=O,W=window.performance.now(),ue.call(Y,this.gl,Y),$=window.performance.now()-W,W=window.performance.now(),xe.call(Y,this.gl,Y),$>window.performance.now()-W?(this.imageBuffer=B,this.copyGLTo2D=xe):this.copyGLTo2D=ue}},createWebGLCanvas:function(P,O){var b=j.util.createCanvasElement();b.width=P,b.height=O;var D={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},k=b.getContext("webgl",D);k||(k=b.getContext("experimental-webgl",D)),k&&(k.clearColor(0,0,0,0),this.canvas=b,this.gl=k)},applyFilters:function(P,O,b,D,k,U){var F,B=this.gl;U&&(F=this.getCachedTexture(U,O));var Y,J,oe,de,W={originalWidth:O.width||O.originalWidth,originalHeight:O.height||O.originalHeight,sourceWidth:b,sourceHeight:D,destinationWidth:b,destinationHeight:D,context:B,sourceTexture:this.createTexture(B,b,D,!F&&O),targetTexture:this.createTexture(B,b,D),originalTexture:F||this.createTexture(B,b,D,!F&&O),passes:P.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:k},$=B.createFramebuffer();return B.bindFramebuffer(B.FRAMEBUFFER,$),P.forEach(function(Y){Y&&Y.applyTo(W)}),de=(Y=W).destinationHeight,(J=Y.targetCanvas).width===(oe=Y.destinationWidth)&&J.height===de||(J.width=oe,J.height=de),this.copyGLTo2D(B,W),B.bindTexture(B.TEXTURE_2D,null),B.deleteTexture(W.sourceTexture),B.deleteTexture(W.targetTexture),B.deleteFramebuffer($),k.getContext("2d").setTransform(1,0,0,1,0,0),W},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(P,O,b,D){var k=P.createTexture();return P.bindTexture(P.TEXTURE_2D,k),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.NEAREST),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),D?P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,D):P.texImage2D(P.TEXTURE_2D,0,P.RGBA,O,b,0,P.RGBA,P.UNSIGNED_BYTE,null),k},getCachedTexture:function(P,O){if(this.textureCache[P])return this.textureCache[P];var b=this.createTexture(this.gl,O.width,O.height,O);return this.textureCache[P]=b,b},evictCachesForKey:function(P){this.textureCache[P]&&(this.gl.deleteTexture(this.textureCache[P]),delete this.textureCache[P])},copyGLTo2D:ue,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var P=this.gl,O={renderer:"",vendor:""};if(!P)return O;var b=P.getExtension("WEBGL_debug_renderer_info");if(b){var D=P.getParameter(b.UNMASKED_RENDERER_WEBGL),k=P.getParameter(b.UNMASKED_VENDOR_WEBGL);D&&(O.renderer=D.toLowerCase()),k&&(O.vendor=k.toLowerCase())}return this.gpuInfo=O,O}}}(),function(){var I=function(){};function A(){}j.Canvas2dFilterBackend=A,A.prototype={evictCachesForKey:I,dispose:I,clearWebGLCaches:I,resources:{},applyFilters:function(P,O,b,D,k){var U=k.getContext("2d");U.drawImage(O,0,0,b,D);var F={sourceWidth:b,sourceHeight:D,imageData:U.getImageData(0,0,b,D),originalEl:O,originalImageData:U.getImageData(0,0,b,D),canvasEl:k,ctx:U,filterBackend:this};return P.forEach(function(B){B.applyTo(F)}),F.imageData.width===b&&F.imageData.height===D||(k.width=F.imageData.width,k.height=F.imageData.height),U.putImageData(F.imageData,0,0),F}}}(),j.Image=j.Image||{},j.Image.filters=j.Image.filters||{},j.Image.filters.BaseFilter=j.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(I){I&&this.setOptions(I)},setOptions:function(I){for(var A in I)this[A]=I[A]},createProgram:function(I,A,P){A=A||this.fragmentSource,P=P||this.vertexSource,"highp"!==j.webGlPrecision&&(A=A.replace(/precision highp float/g,"precision "+j.webGlPrecision+" float"));var O=I.createShader(I.VERTEX_SHADER);if(I.shaderSource(O,P),I.compileShader(O),!I.getShaderParameter(O,I.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+I.getShaderInfoLog(O));var b=I.createShader(I.FRAGMENT_SHADER);if(I.shaderSource(b,A),I.compileShader(b),!I.getShaderParameter(b,I.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+I.getShaderInfoLog(b));var D=I.createProgram();if(I.attachShader(D,O),I.attachShader(D,b),I.linkProgram(D),!I.getProgramParameter(D,I.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+I.getProgramInfoLog(D));var k=this.getAttributeLocations(I,D),U=this.getUniformLocations(I,D)||{};return U.uStepW=I.getUniformLocation(D,"uStepW"),U.uStepH=I.getUniformLocation(D,"uStepH"),{program:D,attributeLocations:k,uniformLocations:U}},getAttributeLocations:function(I,A){return{aPosition:I.getAttribLocation(A,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(I,A,P){var O=A.aPosition,b=I.createBuffer();I.bindBuffer(I.ARRAY_BUFFER,b),I.enableVertexAttribArray(O),I.vertexAttribPointer(O,2,I.FLOAT,!1,0,0),I.bufferData(I.ARRAY_BUFFER,P,I.STATIC_DRAW)},_setupFrameBuffer:function(I){var A,P,O=I.context;I.passes>1?(P=I.destinationHeight,I.sourceWidth===(A=I.destinationWidth)&&I.sourceHeight===P||(O.deleteTexture(I.targetTexture),I.targetTexture=I.filterBackend.createTexture(O,A,P)),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,I.targetTexture,0)):(O.bindFramebuffer(O.FRAMEBUFFER,null),O.finish())},_swapTextures:function(I){I.passes--,I.pass++;var A=I.targetTexture;I.targetTexture=I.sourceTexture,I.sourceTexture=A},isNeutralState:function(){var I=this.mainParameter,A=j.Image.filters[this.type].prototype;if(I){if(Array.isArray(A[I])){for(var P=A[I].length;P--;)if(this[I][P]!==A[I][P])return!1;return!0}return A[I]===this[I]}return!1},applyTo:function(I){I.webgl?(this._setupFrameBuffer(I),this.applyToWebGL(I),this._swapTextures(I)):this.applyTo2d(I)},retrieveShader:function(I){return I.programCache.hasOwnProperty(this.type)||(I.programCache[this.type]=this.createProgram(I.context)),I.programCache[this.type]},applyToWebGL:function(I){var A=I.context,P=this.retrieveShader(I);A.bindTexture(A.TEXTURE_2D,0===I.pass&&I.originalTexture?I.originalTexture:I.sourceTexture),A.useProgram(P.program),this.sendAttributeData(A,P.attributeLocations,I.aPosition),A.uniform1f(P.uniformLocations.uStepW,1/I.sourceWidth),A.uniform1f(P.uniformLocations.uStepH,1/I.sourceHeight),this.sendUniformData(A,P.uniformLocations),A.viewport(0,0,I.destinationWidth,I.destinationHeight),A.drawArrays(A.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(I,A,P){I.activeTexture(P),I.bindTexture(I.TEXTURE_2D,A),I.activeTexture(I.TEXTURE0)},unbindAdditionalTexture:function(I,A){I.activeTexture(A),I.bindTexture(I.TEXTURE_2D,null),I.activeTexture(I.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(I){this[this.mainParameter]=I},sendUniformData:function(){},createHelpLayer:function(I){if(!I.helpLayer){var A=document.createElement("canvas");A.width=I.sourceWidth,A.height=I.sourceHeight,I.helpLayer=A}},toObject:function(){var I={type:this.type},A=this.mainParameter;return A&&(I[A]=this[A]),I},toJSON:function(){return this.toObject()}}),j.Image.filters.BaseFilter.fromObject=function(I,A){var P=new j.Image.filters[I.type](I);return A&&A(P),P},function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.ColorMatrix=(0,A.util.createClass)(P.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(b){this.callSuper("initialize",b),this.matrix=this.matrix.slice(0)},applyTo2d:function(b){var D,k,U,F,B,W=b.imageData.data,$=W.length,Y=this.matrix,J=this.colorsOnly;for(B=0;B<$;B+=4)D=W[B],k=W[B+1],U=W[B+2],J?(W[B]=D*Y[0]+k*Y[1]+U*Y[2]+255*Y[4],W[B+1]=D*Y[5]+k*Y[6]+U*Y[7]+255*Y[9],W[B+2]=D*Y[10]+k*Y[11]+U*Y[12]+255*Y[14]):(W[B]=D*Y[0]+k*Y[1]+U*Y[2]+(F=W[B+3])*Y[3]+255*Y[4],W[B+1]=D*Y[5]+k*Y[6]+U*Y[7]+F*Y[8]+255*Y[9],W[B+2]=D*Y[10]+k*Y[11]+U*Y[12]+F*Y[13]+255*Y[14],W[B+3]=D*Y[15]+k*Y[16]+U*Y[17]+F*Y[18]+255*Y[19])},getUniformLocations:function(b,D){return{uColorMatrix:b.getUniformLocation(D,"uColorMatrix"),uConstants:b.getUniformLocation(D,"uConstants")}},sendUniformData:function(b,D){var k=this.matrix,F=[k[4],k[9],k[14],k[19]];b.uniformMatrix4fv(D.uColorMatrix,!1,[k[0],k[1],k[2],k[3],k[5],k[6],k[7],k[8],k[10],k[11],k[12],k[13],k[15],k[16],k[17],k[18]]),b.uniform4fv(D.uConstants,F)}}),A.Image.filters.ColorMatrix.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Brightness=(0,A.util.createClass)(P.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(b){if(0!==this.brightness){var D,k=b.imageData.data,U=k.length,F=Math.round(255*this.brightness);for(D=0;D<U;D+=4)k[D]=k[D]+F,k[D+1]=k[D+1]+F,k[D+2]=k[D+2]+F}},getUniformLocations:function(b,D){return{uBrightness:b.getUniformLocation(D,"uBrightness")}},sendUniformData:function(b,D){b.uniform1f(D.uBrightness,this.brightness)}}),A.Image.filters.Brightness.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.Image.filters;O.Convolute=(0,A.util.createClass)(O.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(D){var k=Math.sqrt(this.matrix.length),U=this.type+"_"+k+"_"+(this.opaque?1:0),F=this.fragmentSource[U];return D.programCache.hasOwnProperty(U)||(D.programCache[U]=this.createProgram(D.context,F)),D.programCache[U]},applyTo2d:function(D){var k,U,F,B,W,$,Y,J,X,ie,oe,de,ve,Ae=D.imageData,Ce=Ae.data,_e=this.matrix,ge=Math.round(Math.sqrt(_e.length)),ce=Math.floor(ge/2),be=Ae.width,Ie=Ae.height,De=D.ctx.createImageData(be,Ie),re=De.data,he=this.opaque?1:0;for(oe=0;oe<Ie;oe++)for(ie=0;ie<be;ie++){for(W=4*(oe*be+ie),k=0,U=0,F=0,B=0,ve=0;ve<ge;ve++)for(de=0;de<ge;de++)$=ie+de-ce,(Y=oe+ve-ce)<0||Y>=Ie||$<0||$>=be||(k+=Ce[J=4*(Y*be+$)]*(X=_e[ve*ge+de]),U+=Ce[J+1]*X,F+=Ce[J+2]*X,he||(B+=Ce[J+3]*X));re[W]=k,re[W+1]=U,re[W+2]=F,re[W+3]=he?Ce[W+3]:B}D.imageData=De},getUniformLocations:function(D,k){return{uMatrix:D.getUniformLocation(k,"uMatrix"),uOpaque:D.getUniformLocation(k,"uOpaque"),uHalfSize:D.getUniformLocation(k,"uHalfSize"),uSize:D.getUniformLocation(k,"uSize")}},sendUniformData:function(D,k){D.uniform1fv(k.uMatrix,this.matrix)},toObject:function(){return P(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),A.Image.filters.Convolute.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Grayscale=(0,A.util.createClass)(P.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(b){var D,k,U=b.imageData.data,F=U.length,B=this.mode;for(D=0;D<F;D+=4)"average"===B?k=(U[D]+U[D+1]+U[D+2])/3:"lightness"===B?k=(Math.min(U[D],U[D+1],U[D+2])+Math.max(U[D],U[D+1],U[D+2]))/2:"luminosity"===B&&(k=.21*U[D]+.72*U[D+1]+.07*U[D+2]),U[D]=k,U[D+1]=k,U[D+2]=k},retrieveShader:function(b){var D=this.type+"_"+this.mode;return b.programCache.hasOwnProperty(D)||(b.programCache[D]=this.createProgram(b.context,this.fragmentSource[this.mode])),b.programCache[D]},getUniformLocations:function(b,D){return{uMode:b.getUniformLocation(D,"uMode")}},sendUniformData:function(b,D){b.uniform1i(D.uMode,1)},isNeutralState:function(){return!1}}),A.Image.filters.Grayscale.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Invert=(0,A.util.createClass)(P.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(b){var D,k=b.imageData.data,U=k.length;for(D=0;D<U;D+=4)k[D]=255-k[D],k[D+1]=255-k[D+1],k[D+2]=255-k[D+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(b,D){return{uInvert:b.getUniformLocation(D,"uInvert")}},sendUniformData:function(b,D){b.uniform1i(D.uInvert,this.invert)}}),A.Image.filters.Invert.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.Image.filters;O.Noise=(0,A.util.createClass)(O.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(D){if(0!==this.noise){var k,U,B,F=D.imageData.data,W=this.noise;for(k=0,B=F.length;k<B;k+=4)U=(.5-Math.random())*W,F[k]+=U,F[k+1]+=U,F[k+2]+=U}},getUniformLocations:function(D,k){return{uNoise:D.getUniformLocation(k,"uNoise"),uSeed:D.getUniformLocation(k,"uSeed")}},sendUniformData:function(D,k){D.uniform1f(k.uNoise,this.noise/255),D.uniform1f(k.uSeed,Math.random())},toObject:function(){return P(this.callSuper("toObject"),{noise:this.noise})}}),A.Image.filters.Noise.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Pixelate=(0,A.util.createClass)(P.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(b){var D,k,U,F,B,W,$,Y,J,X,ie,oe=b.imageData,de=oe.data,ve=oe.height,Ae=oe.width;for(k=0;k<ve;k+=this.blocksize)for(U=0;U<Ae;U+=this.blocksize)for(F=de[D=4*k*Ae+4*U],B=de[D+1],W=de[D+2],$=de[D+3],X=Math.min(k+this.blocksize,ve),ie=Math.min(U+this.blocksize,Ae),Y=k;Y<X;Y++)for(J=U;J<ie;J++)de[D=4*Y*Ae+4*J]=F,de[D+1]=B,de[D+2]=W,de[D+3]=$},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(b,D){return{uBlocksize:b.getUniformLocation(D,"uBlocksize"),uStepW:b.getUniformLocation(D,"uStepW"),uStepH:b.getUniformLocation(D,"uStepH")}},sendUniformData:function(b,D){b.uniform1f(D.uBlocksize,this.blocksize)}}),A.Image.filters.Pixelate.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.extend,O=A.Image.filters;O.RemoveColor=(0,A.util.createClass)(O.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(D){var k,U,F,B,W=D.imageData.data,$=255*this.distance,Y=new A.Color(this.color).getSource(),J=[Y[0]-$,Y[1]-$,Y[2]-$],X=[Y[0]+$,Y[1]+$,Y[2]+$];for(k=0;k<W.length;k+=4)F=W[k+1],B=W[k+2],(U=W[k])>J[0]&&F>J[1]&&B>J[2]&&U<X[0]&&F<X[1]&&B<X[2]&&(W[k+3]=0)},getUniformLocations:function(D,k){return{uLow:D.getUniformLocation(k,"uLow"),uHigh:D.getUniformLocation(k,"uHigh")}},sendUniformData:function(D,k){var U=new A.Color(this.color).getSource(),F=parseFloat(this.distance),W=[U[0]/255+F,U[1]/255+F,U[2]/255+F,1];D.uniform4fv(k.uLow,[0+U[0]/255-F,0+U[1]/255-F,0+U[2]/255-F,1]),D.uniform4fv(k.uHigh,W)},toObject:function(){return P(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),A.Image.filters.RemoveColor.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters,O=A.util.createClass,b={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var D in b)P[D]=O(P.ColorMatrix,{type:D,matrix:b[D],mainParameter:!1,colorsOnly:!0}),A.Image.filters[D].fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric,P=A.Image.filters;P.BlendColor=(0,A.util.createClass)(P.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(b){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[b]+"}\n}"},retrieveShader:function(b){var D,k=this.type+"_"+this.mode;return b.programCache.hasOwnProperty(k)||(D=this.buildSource(this.mode),b.programCache[k]=this.createProgram(b.context,D)),b.programCache[k]},applyTo2d:function(b){var D,k,U,F,B,W,$,Y=b.imageData.data,J=Y.length,X=1-this.alpha;D=($=new A.Color(this.color).getSource())[0]*this.alpha,k=$[1]*this.alpha,U=$[2]*this.alpha;for(var ie=0;ie<J;ie+=4)switch(F=Y[ie],B=Y[ie+1],W=Y[ie+2],this.mode){case"multiply":Y[ie]=F*D/255,Y[ie+1]=B*k/255,Y[ie+2]=W*U/255;break;case"screen":Y[ie]=255-(255-F)*(255-D)/255,Y[ie+1]=255-(255-B)*(255-k)/255,Y[ie+2]=255-(255-W)*(255-U)/255;break;case"add":Y[ie]=F+D,Y[ie+1]=B+k,Y[ie+2]=W+U;break;case"diff":case"difference":Y[ie]=Math.abs(F-D),Y[ie+1]=Math.abs(B-k),Y[ie+2]=Math.abs(W-U);break;case"subtract":Y[ie]=F-D,Y[ie+1]=B-k,Y[ie+2]=W-U;break;case"darken":Y[ie]=Math.min(F,D),Y[ie+1]=Math.min(B,k),Y[ie+2]=Math.min(W,U);break;case"lighten":Y[ie]=Math.max(F,D),Y[ie+1]=Math.max(B,k),Y[ie+2]=Math.max(W,U);break;case"overlay":Y[ie]=D<128?2*F*D/255:255-2*(255-F)*(255-D)/255,Y[ie+1]=k<128?2*B*k/255:255-2*(255-B)*(255-k)/255,Y[ie+2]=U<128?2*W*U/255:255-2*(255-W)*(255-U)/255;break;case"exclusion":Y[ie]=D+F-2*D*F/255,Y[ie+1]=k+B-2*k*B/255,Y[ie+2]=U+W-2*U*W/255;break;case"tint":Y[ie]=D+F*X,Y[ie+1]=k+B*X,Y[ie+2]=U+W*X}},getUniformLocations:function(b,D){return{uColor:b.getUniformLocation(D,"uColor")}},sendUniformData:function(b,D){var k=new A.Color(this.color).getSource();k[0]=this.alpha*k[0]/255,k[1]=this.alpha*k[1]/255,k[2]=this.alpha*k[2]/255,k[3]=this.alpha,b.uniform4fv(D.uColor,k)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),A.Image.filters.BlendColor.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric,P=A.Image.filters;P.BlendImage=(0,A.util.createClass)(P.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(b){var D=this.type+"_"+this.mode,k=this.fragmentSource[this.mode];return b.programCache.hasOwnProperty(D)||(b.programCache[D]=this.createProgram(b.context,k)),b.programCache[D]},applyToWebGL:function(b){var D=b.context,k=this.createTexture(b.filterBackend,this.image);this.bindAdditionalTexture(D,k,D.TEXTURE1),this.callSuper("applyToWebGL",b),this.unbindAdditionalTexture(D,D.TEXTURE1)},createTexture:function(b,D){return b.getCachedTexture(D.cacheKey,D._element)},calculateMatrix:function(){var b=this.image;return[1/b.scaleX,0,0,0,1/b.scaleY,0,-b.left/b._element.width,-b.top/b._element.height,1]},applyTo2d:function(b){var D,k,U,F,B,W,$,Y,J,X,ie,oe=b.imageData,de=b.filterBackend.resources,ve=oe.data,Ae=ve.length,Ce=oe.width,_e=oe.height,ge=this.image;de.blendImage||(de.blendImage=A.util.createCanvasElement()),X=(J=de.blendImage).getContext("2d"),J.width!==Ce||J.height!==_e?(J.width=Ce,J.height=_e):X.clearRect(0,0,Ce,_e),X.setTransform(ge.scaleX,0,0,ge.scaleY,ge.left,ge.top),X.drawImage(ge._element,0,0,Ce,_e),ie=X.getImageData(0,0,Ce,_e).data;for(var ce=0;ce<Ae;ce+=4)switch(B=ve[ce],W=ve[ce+1],$=ve[ce+2],Y=ve[ce+3],D=ie[ce],k=ie[ce+1],U=ie[ce+2],F=ie[ce+3],this.mode){case"multiply":ve[ce]=B*D/255,ve[ce+1]=W*k/255,ve[ce+2]=$*U/255,ve[ce+3]=Y*F/255;break;case"mask":ve[ce+3]=F}},getUniformLocations:function(b,D){return{uTransformMatrix:b.getUniformLocation(D,"uTransformMatrix"),uImage:b.getUniformLocation(D,"uImage")}},sendUniformData:function(b,D){var k=this.calculateMatrix();b.uniform1i(D.uImage,1),b.uniformMatrix3fv(D.uTransformMatrix,!1,k)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),A.Image.filters.BlendImage.fromObject=function(b,D){A.Image.fromObject(b.image,function(k){var U=A.util.object.clone(b);U.image=k,D(new A.Image.filters.BlendImage(U))})}}(l),function(I){var A=I.fabric||(I.fabric={}),P=Math.pow,O=Math.floor,b=Math.sqrt,D=Math.abs,k=Math.round,U=Math.sin,F=Math.ceil,B=A.Image.filters;B.Resize=(0,A.util.createClass)(B.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function($,Y){return{uDelta:$.getUniformLocation(Y,"uDelta"),uTaps:$.getUniformLocation(Y,"uTaps")}},sendUniformData:function($,Y){$.uniform2fv(Y.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),$.uniform1fv(Y.uTaps,this.taps)},retrieveShader:function($){var Y=this.getFilterWindow(),J=this.type+"_"+Y;if(!$.programCache.hasOwnProperty(J)){var X=this.generateShader(Y);$.programCache[J]=this.createProgram($.context,X)}return $.programCache[J]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var $=this.lanczosCreate(this.lanczosLobes),Y=this.tempScale,J=this.getFilterWindow(),X=new Array(J),ie=1;ie<=J;ie++)X[ie-1]=$(ie*Y);return X},generateShader:function($){for(var Y=new Array($),J=this.fragmentSourceTOP,X=1;X<=$;X++)Y[X-1]=X+".0 * uDelta";return J+="uniform float uTaps["+$+"];\n",J+="void main() {\n",J+="  vec4 color = texture2D(uTexture, vTexCoord);\n",J+="  float sum = 1.0;\n",Y.forEach(function(ie,oe){J+="  color += texture2D(uTexture, vTexCoord + "+ie+") * uTaps["+oe+"];\n",J+="  color += texture2D(uTexture, vTexCoord - "+ie+") * uTaps["+oe+"];\n",J+="  sum += 2.0 * uTaps["+oe+"];\n"}),J+="  gl_FragColor = color / sum;\n",J+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function($){$.webgl?($.passes++,this.width=$.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=$.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),$.destinationWidth=this.dW,this._setupFrameBuffer($),this.applyToWebGL($),this._swapTextures($),$.sourceWidth=$.destinationWidth,this.height=$.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),$.destinationHeight=this.dH,this._setupFrameBuffer($),this.applyToWebGL($),this._swapTextures($),$.sourceHeight=$.destinationHeight):this.applyTo2d($)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function($){return function(Y){if(Y>=$||Y<=-$)return 0;if(Y<1.1920929e-7&&Y>-1.1920929e-7)return 1;var J=(Y*=Math.PI)/$;return U(Y)/Y*U(J)/J}},applyTo2d:function($){var Y=$.imageData,J=this.scaleX,X=this.scaleY;this.rcpScaleX=1/J,this.rcpScaleY=1/X;var ie,oe=Y.width,de=Y.height,ve=k(oe*J),Ae=k(de*X);"sliceHack"===this.resizeType?ie=this.sliceByTwo($,oe,de,ve,Ae):"hermite"===this.resizeType?ie=this.hermiteFastResize($,oe,de,ve,Ae):"bilinear"===this.resizeType?ie=this.bilinearFiltering($,oe,de,ve,Ae):"lanczos"===this.resizeType&&(ie=this.lanczosResize($,oe,de,ve,Ae)),$.imageData=ie},sliceByTwo:function($,Y,J,X,ie){var oe,de,ve=$.imageData,Ce=!1,_e=!1,ge=.5*Y,ce=.5*J,be=A.filterBackend.resources,Ie=0,De=0,re=Y,he=0;for(be.sliceByTwo||(be.sliceByTwo=document.createElement("canvas")),((oe=be.sliceByTwo).width<1.5*Y||oe.height<J)&&(oe.width=1.5*Y,oe.height=J),(de=oe.getContext("2d")).clearRect(0,0,1.5*Y,J),de.putImageData(ve,0,0),X=O(X),ie=O(ie);!Ce||!_e;)Y=ge,J=ce,X<O(.5*ge)?ge=O(.5*ge):(ge=X,Ce=!0),ie<O(.5*ce)?ce=O(.5*ce):(ce=ie,_e=!0),de.drawImage(oe,Ie,De,Y,J,re,he,ge,ce),Ie=re,De=he,he+=ce;return de.getImageData(Ie,De,X,ie)},lanczosResize:function($,Y,J,X,ie){var oe=$.imageData.data,de=$.ctx.createImageData(X,ie),ve=de.data,Ae=this.lanczosCreate(this.lanczosLobes),Ce=this.rcpScaleX,_e=this.rcpScaleY,ge=2/this.rcpScaleX,ce=2/this.rcpScaleY,be=F(Ce*this.lanczosLobes/2),Ie=F(_e*this.lanczosLobes/2),De={},re={},he={};return function we(Pe){var Ee,Me,Oe,Be,Le,He,We,Je,Qe,Xe,St;for(re.x=(Pe+.5)*Ce,he.x=O(re.x),Ee=0;Ee<ie;Ee++){for(re.y=(Ee+.5)*_e,he.y=O(re.y),Le=0,He=0,We=0,Je=0,Qe=0,Me=he.x-be;Me<=he.x+be;Me++)if(!(Me<0||Me>=Y)){Xe=O(1e3*D(Me-re.x)),De[Xe]||(De[Xe]={});for(var ni=he.y-Ie;ni<=he.y+Ie;ni++)ni<0||ni>=J||(St=O(1e3*D(ni-re.y)),De[Xe][St]||(De[Xe][St]=Ae(b(P(Xe*ge,2)+P(St*ce,2))/1e3)),(Oe=De[Xe][St])>0&&(Le+=Oe,He+=Oe*oe[Be=4*(ni*Y+Me)],We+=Oe*oe[Be+1],Je+=Oe*oe[Be+2],Qe+=Oe*oe[Be+3]))}ve[Be=4*(Ee*X+Pe)]=He/Le,ve[Be+1]=We/Le,ve[Be+2]=Je/Le,ve[Be+3]=Qe/Le}return++Pe<X?we(Pe):de}(0)},bilinearFiltering:function($,Y,J,X,ie){var oe,de,ve,Ae,Ce,_e,ge,be,Ie=0,De=this.rcpScaleX,re=this.rcpScaleY,he=4*(Y-1),we=$.imageData.data,Pe=$.ctx.createImageData(X,ie),Ee=Pe.data;for(ve=0;ve<ie;ve++)for(Ae=0;Ae<X;Ae++)for(Ce=De*Ae-(oe=O(De*Ae)),_e=re*ve-(de=O(re*ve)),be=4*(de*Y+oe),ge=0;ge<4;ge++)Ee[Ie++]=we[be+ge]*(1-Ce)*(1-_e)+we[be+4+ge]*Ce*(1-_e)+we[be+he+ge]*_e*(1-Ce)+we[be+he+4+ge]*Ce*_e;return Pe},hermiteFastResize:function($,Y,J,X,ie){for(var oe=this.rcpScaleX,de=this.rcpScaleY,ve=F(oe/2),Ae=F(de/2),Ce=$.imageData.data,_e=$.ctx.createImageData(X,ie),ge=_e.data,ce=0;ce<ie;ce++)for(var be=0;be<X;be++){for(var Ie=4*(be+ce*X),De=0,re=0,he=0,we=0,Pe=0,Ee=0,Me=0,Oe=(ce+.5)*de,Be=O(ce*de);Be<(ce+1)*de;Be++)for(var Le=D(Oe-(Be+.5))/Ae,He=(be+.5)*oe,We=Le*Le,Je=O(be*oe);Je<(be+1)*oe;Je++){var Qe=D(He-(Je+.5))/ve,Xe=b(We+Qe*Qe);Xe>1&&Xe<-1||(De=2*Xe*Xe*Xe-3*Xe*Xe+1)>0&&(Me+=De*Ce[3+(Qe=4*(Je+Be*Y))],he+=De,Ce[Qe+3]<255&&(De=De*Ce[Qe+3]/250),we+=De*Ce[Qe],Pe+=De*Ce[Qe+1],Ee+=De*Ce[Qe+2],re+=De)}ge[Ie]=we/re,ge[Ie+1]=Pe/re,ge[Ie+2]=Ee/re,ge[Ie+3]=Me/he}return _e},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),A.Image.filters.Resize.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Contrast=(0,A.util.createClass)(P.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(b){if(0!==this.contrast){var D,k=b.imageData.data,U=k.length,F=Math.floor(255*this.contrast),B=259*(F+255)/(255*(259-F));for(D=0;D<U;D+=4)k[D]=B*(k[D]-128)+128,k[D+1]=B*(k[D+1]-128)+128,k[D+2]=B*(k[D+2]-128)+128}},getUniformLocations:function(b,D){return{uContrast:b.getUniformLocation(D,"uContrast")}},sendUniformData:function(b,D){b.uniform1f(D.uContrast,this.contrast)}}),A.Image.filters.Contrast.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Saturation=(0,A.util.createClass)(P.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(b){if(0!==this.saturation){var D,k,U=b.imageData.data,F=U.length,B=-this.saturation;for(D=0;D<F;D+=4)k=Math.max(U[D],U[D+1],U[D+2]),U[D]+=k!==U[D]?(k-U[D])*B:0,U[D+1]+=k!==U[D+1]?(k-U[D+1])*B:0,U[D+2]+=k!==U[D+2]?(k-U[D+2])*B:0}},getUniformLocations:function(b,D){return{uSaturation:b.getUniformLocation(D,"uSaturation")}},sendUniformData:function(b,D){b.uniform1f(D.uSaturation,-this.saturation)}}),A.Image.filters.Saturation.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Vibrance=(0,A.util.createClass)(P.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(b){if(0!==this.vibrance){var D,k,F,B=b.imageData.data,W=B.length,$=-this.vibrance;for(D=0;D<W;D+=4)k=Math.max(B[D],B[D+1],B[D+2]),F=2*Math.abs(k-(B[D]+B[D+1]+B[D+2])/3)/255*$,B[D]+=k!==B[D]?(k-B[D])*F:0,B[D+1]+=k!==B[D+1]?(k-B[D+1])*F:0,B[D+2]+=k!==B[D+2]?(k-B[D+2])*F:0}},getUniformLocations:function(b,D){return{uVibrance:b.getUniformLocation(D,"uVibrance")}},sendUniformData:function(b,D){b.uniform1f(D.uVibrance,-this.vibrance)}}),A.Image.filters.Vibrance.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Blur=(0,A.util.createClass)(P.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(b){b.webgl?(this.aspectRatio=b.sourceWidth/b.sourceHeight,b.passes++,this._setupFrameBuffer(b),this.horizontal=!0,this.applyToWebGL(b),this._swapTextures(b),this._setupFrameBuffer(b),this.horizontal=!1,this.applyToWebGL(b),this._swapTextures(b)):this.applyTo2d(b)},applyTo2d:function(b){b.imageData=this.simpleBlur(b)},simpleBlur:function(b){var D,k,U=b.filterBackend.resources,F=b.imageData.width,B=b.imageData.height;U.blurLayer1||(U.blurLayer1=A.util.createCanvasElement(),U.blurLayer2=A.util.createCanvasElement()),k=U.blurLayer2,(D=U.blurLayer1).width===F&&D.height===B||(k.width=D.width=F,k.height=D.height=B);var W,$,Y,J,X=D.getContext("2d"),ie=k.getContext("2d"),oe=.06*this.blur*.5;for(X.putImageData(b.imageData,0,0),ie.clearRect(0,0,F,B),J=-15;J<=15;J++)Y=oe*($=J/15)*F+(W=(Math.random()-.5)/4),ie.globalAlpha=1-Math.abs($),ie.drawImage(D,Y,W),X.drawImage(k,0,0),ie.globalAlpha=1,ie.clearRect(0,0,k.width,k.height);for(J=-15;J<=15;J++)Y=oe*($=J/15)*B+(W=(Math.random()-.5)/4),ie.globalAlpha=1-Math.abs($),ie.drawImage(D,W,Y),X.drawImage(k,0,0),ie.globalAlpha=1,ie.clearRect(0,0,k.width,k.height);b.ctx.drawImage(D,0,0);var de=b.ctx.getImageData(0,0,D.width,D.height);return X.globalAlpha=1,X.clearRect(0,0,D.width,D.height),de},getUniformLocations:function(b,D){return{delta:b.getUniformLocation(D,"uDelta")}},sendUniformData:function(b,D){var k=this.chooseRightDelta();b.uniform2fv(D.delta,k)},chooseRightDelta:function(){var b,D=1,k=[0,0];return this.horizontal?this.aspectRatio>1&&(D=1/this.aspectRatio):this.aspectRatio<1&&(D=this.aspectRatio),b=D*this.blur*.12,this.horizontal?k[0]=b:k[1]=b,k}}),P.Blur.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Gamma=(0,A.util.createClass)(P.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(b){this.gamma=[1,1,1],P.BaseFilter.prototype.initialize.call(this,b)},applyTo2d:function(b){var D,k=b.imageData.data,U=this.gamma,F=k.length,B=1/U[0],W=1/U[1],$=1/U[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),D=0,F=256;D<F;D++)this.rVals[D]=255*Math.pow(D/255,B),this.gVals[D]=255*Math.pow(D/255,W),this.bVals[D]=255*Math.pow(D/255,$);for(D=0,F=k.length;D<F;D+=4)k[D]=this.rVals[k[D]],k[D+1]=this.gVals[k[D+1]],k[D+2]=this.bVals[k[D+2]]},getUniformLocations:function(b,D){return{uGamma:b.getUniformLocation(D,"uGamma")}},sendUniformData:function(b,D){b.uniform3fv(D.uGamma,this.gamma)}}),A.Image.filters.Gamma.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.Composed=(0,A.util.createClass)(P.BaseFilter,{type:"Composed",subFilters:[],initialize:function(b){this.callSuper("initialize",b),this.subFilters=this.subFilters.slice(0)},applyTo:function(b){b.passes+=this.subFilters.length-1,this.subFilters.forEach(function(D){D.applyTo(b)})},toObject:function(){return A.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(b){return b.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(b){return!b.isNeutralState()})}}),A.Image.filters.Composed.fromObject=function(b,D){var k=(b.subFilters||[]).map(function(F){return new A.Image.filters[F.type](F)}),U=new A.Image.filters.Composed({subFilters:k});return D&&D(U),U}}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.Image.filters;P.HueRotation=(0,A.util.createClass)(P.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var b=this.rotation*Math.PI,D=A.util.cos(b),k=A.util.sin(b),U=1/3,F=Math.sqrt(U)*k,B=1-D;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=D+B/3,this.matrix[1]=U*B-F,this.matrix[2]=U*B+F,this.matrix[5]=U*B+F,this.matrix[6]=D+U*B,this.matrix[7]=U*B-F,this.matrix[10]=U*B-F,this.matrix[11]=U*B+F,this.matrix[12]=D+U*B},isNeutralState:function(b){return this.calculateMatrix(),P.BaseFilter.prototype.isNeutralState.call(this,b)},applyTo:function(b){this.calculateMatrix(),P.BaseFilter.prototype.applyTo.call(this,b)}}),A.Image.filters.HueRotation.fromObject=A.Image.filters.BaseFilter.fromObject}(l),function(I){var A=I.fabric||(I.fabric={}),P=A.util.object.clone;if(A.Text)A.warn("fabric.Text is already defined");else{var O="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");A.Text=A.util.createClass(A.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:A.Object.prototype.stateProperties.concat(O),cacheProperties:A.Object.prototype.cacheProperties.concat(O),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(b,D){this.styles=D&&D.styles||{},this.text=b,this.__skipDimension=!0,this.callSuper("initialize",D),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var b=this.path;b&&(b.segmentsInfo=A.util.getPathSegmentsInfo(b.path))},getMeasuringContext:function(){return A._measuringContext||(A._measuringContext=this.canvas&&this.canvas.contextCache||A.util.createCanvasElement().getContext("2d")),A._measuringContext},_splitText:function(){var b=this._splitTextIntoLines(this.text);return this.textLines=b.lines,this._textLines=b.graphemeLines,this._unwrappedTextLines=b._unwrappedLines,this._text=b.graphemeText,b},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var b,D,U,F,B,W,$=0,Y=this._textLines.length;$<Y;$++)if(("justify"===this.textAlign||$!==Y-1&&!this.isEndOfWrapping($))&&(U=0,F=this._textLines[$],(D=this.getLineWidth($))<this.width&&(W=this.textLines[$].match(this._reSpacesAndTabs)))){b=(this.width-D)/W.length;for(var J=0,X=F.length;J<=X;J++)B=this.__charBounds[$][J],this._reSpaceAndTab.test(F[J])?(B.width+=b,B.kernedWidth+=b,B.left+=U,U+=b):B.left+=U}},isEndOfWrapping:function(b){return b===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var b=this.callSuper("_getCacheCanvasDimensions"),D=this.fontSize;return b.width+=D*b.zoomX,b.height+=D*b.zoomY,b},_render:function(b){var D=this.path;D&&!D.isNotVisible()&&D._render(b),this._setTextStyles(b),this._renderTextLinesBackground(b),this._renderTextDecoration(b,"underline"),this._renderText(b),this._renderTextDecoration(b,"overline"),this._renderTextDecoration(b,"linethrough")},_renderText:function(b){"stroke"===this.paintFirst?(this._renderTextStroke(b),this._renderTextFill(b)):(this._renderTextFill(b),this._renderTextStroke(b))},_setTextStyles:function(b,D,k){if(b.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":b.textBaseline="middle";break;case"ascender":b.textBaseline="top";break;case"descender":b.textBaseline="bottom"}b.font=this._getFontDeclaration(D,k)},calcTextWidth:function(){for(var b=this.getLineWidth(0),D=1,k=this._textLines.length;D<k;D++){var U=this.getLineWidth(D);U>b&&(b=U)}return b},_renderTextLine:function(b,D,k,U,F,B){this._renderChars(b,D,k,U,F,B)},_renderTextLinesBackground:function(b){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var D,k,U,F,B,W,$,Y=b.fillStyle,J=this._getLeftOffset(),X=this._getTopOffset(),ie=0,oe=0,de=this.path,ve=0,Ae=this._textLines.length;ve<Ae;ve++)if(D=this.getHeightOfLine(ve),this.textBackgroundColor||this.styleHas("textBackgroundColor",ve)){U=this._textLines[ve],k=this._getLineLeftOffset(ve),oe=0,ie=0,F=this.getValueOfPropertyAt(ve,0,"textBackgroundColor");for(var Ce=0,_e=U.length;Ce<_e;Ce++)B=this.__charBounds[ve][Ce],W=this.getValueOfPropertyAt(ve,Ce,"textBackgroundColor"),de?(b.save(),b.translate(B.renderLeft,B.renderTop),b.rotate(B.angle),b.fillStyle=W,W&&b.fillRect(-B.width/2,-D/this.lineHeight*(1-this._fontSizeFraction),B.width,D/this.lineHeight),b.restore()):W!==F?($=J+k+ie,"rtl"===this.direction&&($=this.width-$-oe),b.fillStyle=F,F&&b.fillRect($,X,oe,D/this.lineHeight),ie=B.left,oe=B.width,F=W):oe+=B.kernedWidth;W&&!de&&($=J+k+ie,"rtl"===this.direction&&($=this.width-$-oe),b.fillStyle=W,b.fillRect($,X,oe,D/this.lineHeight)),X+=D}else X+=D;b.fillStyle=Y,this._removeShadow(b)}},getFontCache:function(b){var D=b.fontFamily.toLowerCase();A.charWidthsCache[D]||(A.charWidthsCache[D]={});var k=A.charWidthsCache[D],U=b.fontStyle.toLowerCase()+"_"+(b.fontWeight+"").toLowerCase();return k[U]||(k[U]={}),k[U]},_measureChar:function(b,D,k,U){var F,B,W,$,Y=this.getFontCache(D),J=k+b,X=this._getFontDeclaration(D)===this._getFontDeclaration(U),ie=D.fontSize/this.CACHE_FONT_SIZE;if(k&&void 0!==Y[k]&&(W=Y[k]),void 0!==Y[b]&&($=F=Y[b]),X&&void 0!==Y[J]&&($=(B=Y[J])-W),void 0===F||void 0===W||void 0===B){var oe=this.getMeasuringContext();this._setTextStyles(oe,D,!0)}return void 0===F&&($=F=oe.measureText(b).width,Y[b]=F),void 0===W&&X&&k&&(W=oe.measureText(k).width,Y[k]=W),X&&void 0===B&&(B=oe.measureText(J).width,Y[J]=B,$=B-W),{width:F*ie,kernedWidth:$*ie}},getHeightOfChar:function(b,D){return this.getValueOfPropertyAt(b,D,"fontSize")},measureLine:function(b){var D=this._measureLine(b);return 0!==this.charSpacing&&(D.width-=this._getWidthOfCharSpacing()),D.width<0&&(D.width=0),D},_measureLine:function(b){var D,k,U,F,B,W,$=0,Y=this._textLines[b],J=new Array(Y.length),X=0,ie=this.path,oe="right"===this.pathSide;for(this.__charBounds[b]=J,D=0;D<Y.length;D++)F=this._getGraphemeBox(k=Y[D],b,D,U),J[D]=F,$+=F.kernedWidth,U=k;if(J[D]={left:F?F.left+F.width:0,width:0,kernedWidth:0,height:this.fontSize},ie){switch(W=ie.segmentsInfo[ie.segmentsInfo.length-1].length,(B=A.util.getPointOnPath(ie.path,0,ie.segmentsInfo)).x+=ie.pathOffset.x,B.y+=ie.pathOffset.y,this.textAlign){case"left":X=oe?W-$:0;break;case"center":X=(W-$)/2;break;case"right":X=oe?0:W-$}for(X+=this.pathStartOffset*(oe?-1:1),D=oe?Y.length-1:0;oe?D>=0:D<Y.length;oe?D--:D++)X>W?X%=W:X<0&&(X+=W),this._setGraphemeOnPath(X,F=J[D],B),X+=F.kernedWidth}return{width:$,numOfSpaces:0}},_setGraphemeOnPath:function(b,D,k){var F=this.path,B=A.util.getPointOnPath(F.path,b+D.kernedWidth/2,F.segmentsInfo);D.renderLeft=B.x-k.x,D.renderTop=B.y-k.y,D.angle=B.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(b,D,k,U,F){var B,W=this.getCompleteStyleDeclaration(D,k),$=U?this.getCompleteStyleDeclaration(D,k-1):{},Y=this._measureChar(b,W,U,$),J=Y.kernedWidth,X=Y.width;0!==this.charSpacing&&(X+=B=this._getWidthOfCharSpacing(),J+=B);var ie={width:X,left:0,height:W.fontSize,kernedWidth:J,deltaY:W.deltaY};if(k>0&&!F){var oe=this.__charBounds[D][k-1];ie.left=oe.left+oe.width+Y.kernedWidth-Y.width}return ie},getHeightOfLine:function(b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var D=this._textLines[b],k=this.getHeightOfChar(b,0),U=1,F=D.length;U<F;U++)k=Math.max(this.getHeightOfChar(b,U),k);return this.__lineHeights[b]=k*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var b,D=0,k=0,U=this._textLines.length;k<U;k++)b=this.getHeightOfLine(k),D+=k===U-1?b/this.lineHeight:b;return D},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(b,D){b.save();for(var k=0,U=this._getLeftOffset(),F=this._getTopOffset(),B=0,W=this._textLines.length;B<W;B++){var $=this.getHeightOfLine(B),Y=$/this.lineHeight,J=this._getLineLeftOffset(B);this._renderTextLine(D,b,this._textLines[B],U+J,F+k+Y,B),k+=$}b.restore()},_renderTextFill:function(b){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(b,"fillText")},_renderTextStroke:function(b){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b),b.save(),this._setLineDash(b,this.strokeDashArray),b.beginPath(),this._renderTextCommon(b,"strokeText"),b.closePath(),b.restore())},_renderChars:function(b,D,k,U,F,B){var W,$,Y,J,ie=this.getHeightOfLine(B),oe=-1!==this.textAlign.indexOf("justify"),de="",ve=0,Ae=this.path,Ce=!oe&&0===this.charSpacing&&this.isEmptyStyles(B)&&!Ae,_e="ltr"===this.direction,ge="ltr"===this.direction?1:-1,ce=D.canvas.getAttribute("dir");if(D.save(),ce!==this.direction&&(D.canvas.setAttribute("dir",_e?"ltr":"rtl"),D.direction=_e?"ltr":"rtl",D.textAlign=_e?"left":"right"),F-=ie*this._fontSizeFraction/this.lineHeight,Ce)return this._renderChar(b,D,B,0,k.join(""),U,F,ie),void D.restore();for(var be=0,Ie=k.length-1;be<=Ie;be++)J=be===Ie||this.charSpacing||Ae,de+=k[be],Y=this.__charBounds[B][be],0===ve?(U+=ge*(Y.kernedWidth-Y.width),ve+=Y.width):ve+=Y.kernedWidth,oe&&!J&&this._reSpaceAndTab.test(k[be])&&(J=!0),J||(W=W||this.getCompleteStyleDeclaration(B,be),$=this.getCompleteStyleDeclaration(B,be+1),J=this._hasStyleChanged(W,$)),J&&(Ae?(D.save(),D.translate(Y.renderLeft,Y.renderTop),D.rotate(Y.angle),this._renderChar(b,D,B,be,de,-ve/2,0,ie),D.restore()):this._renderChar(b,D,B,be,de,U,F,ie),de="",W=$,U+=ge*ve,ve=0);D.restore()},_applyPatternGradientTransformText:function(b){var D,k=A.util.createCanvasElement(),U=this.width+this.strokeWidth,F=this.height+this.strokeWidth;return k.width=U,k.height=F,(D=k.getContext("2d")).beginPath(),D.moveTo(0,0),D.lineTo(U,0),D.lineTo(U,F),D.lineTo(0,F),D.closePath(),D.translate(U/2,F/2),D.fillStyle=b.toLive(D),this._applyPatternGradientTransform(D,b),D.fill(),D.createPattern(k,"no-repeat")},handleFiller:function(b,D,k){var U,F;return k.toLive?"percentage"===k.gradientUnits||k.gradientTransform||k.patternTransform?(b.translate(U=-this.width/2,F=-this.height/2),b[D]=this._applyPatternGradientTransformText(k),{offsetX:U,offsetY:F}):(b[D]=k.toLive(b,this),this._applyPatternGradientTransform(b,k)):(b[D]=k,{offsetX:0,offsetY:0})},_setStrokeStyles:function(b,D){return b.lineWidth=D.strokeWidth,b.lineCap=this.strokeLineCap,b.lineDashOffset=this.strokeDashOffset,b.lineJoin=this.strokeLineJoin,b.miterLimit=this.strokeMiterLimit,this.handleFiller(b,"strokeStyle",D.stroke)},_setFillStyles:function(b,D){return this.handleFiller(b,"fillStyle",D.fill)},_renderChar:function(b,D,k,U,F,B,W){var $,Y,J=this._getStyleDeclaration(k,U),X=this.getCompleteStyleDeclaration(k,U),ie="fillText"===b&&X.fill,oe="strokeText"===b&&X.stroke&&X.strokeWidth;(oe||ie)&&(D.save(),ie&&($=this._setFillStyles(D,X)),oe&&(Y=this._setStrokeStyles(D,X)),D.font=this._getFontDeclaration(X),J&&J.textBackgroundColor&&this._removeShadow(D),J&&J.deltaY&&(W+=J.deltaY),ie&&D.fillText(F,B-$.offsetX,W-$.offsetY),oe&&D.strokeText(F,B-Y.offsetX,W-Y.offsetY),D.restore())},setSuperscript:function(b,D){return this._setScript(b,D,this.superscript)},setSubscript:function(b,D){return this._setScript(b,D,this.subscript)},_setScript:function(b,D,k){var U=this.get2DCursorLocation(b,!0),F=this.getValueOfPropertyAt(U.lineIndex,U.charIndex,"fontSize"),B=this.getValueOfPropertyAt(U.lineIndex,U.charIndex,"deltaY");return this.setSelectionStyles({fontSize:F*k.size,deltaY:B+F*k.baseline},b,D),this},_hasStyleChanged:function(b,D){return b.fill!==D.fill||b.stroke!==D.stroke||b.strokeWidth!==D.strokeWidth||b.fontSize!==D.fontSize||b.fontFamily!==D.fontFamily||b.fontWeight!==D.fontWeight||b.fontStyle!==D.fontStyle||b.deltaY!==D.deltaY},_hasStyleChangedForSvg:function(b,D){return this._hasStyleChanged(b,D)||b.overline!==D.overline||b.underline!==D.underline||b.linethrough!==D.linethrough},_getLineLeftOffset:function(b){var D=this.getLineWidth(b),k=this.width-D,U=this.textAlign,F=this.direction,B=0,W=this.isEndOfWrapping(b);return"justify"===U||"justify-center"===U&&!W||"justify-right"===U&&!W||"justify-left"===U&&!W?0:("center"===U&&(B=k/2),"right"===U&&(B=k),"justify-center"===U&&(B=k/2),"justify-right"===U&&(B=k),"rtl"===F&&(B-=k),B)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var b=this._forceClearCache;return b||(b=this.hasStateChanged("_dimensionAffectingProps")),b&&(this.dirty=!0,this._forceClearCache=!1),b},getLineWidth:function(b){if(void 0!==this.__lineWidths[b])return this.__lineWidths[b];var D=this.measureLine(b).width;return this.__lineWidths[b]=D,D},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(b,D,k){var U=this._getStyleDeclaration(b,D);return U&&void 0!==U[k]?U[k]:this[k]},_renderTextDecoration:function(b,D){if(this[D]||this.styleHas(D)){for(var k,U,F,B,W,$,Y,J,X,ie,oe,de,ve,Ae,Ce,_e,ge=this._getLeftOffset(),ce=this._getTopOffset(),be=this.path,Ie=this._getWidthOfCharSpacing(),De=this.offsets[D],re=0,he=this._textLines.length;re<he;re++)if(k=this.getHeightOfLine(re),this[D]||this.styleHas(D,re)){Y=this._textLines[re],Ae=k/this.lineHeight,B=this._getLineLeftOffset(re),ie=0,oe=0,J=this.getValueOfPropertyAt(re,0,D),_e=this.getValueOfPropertyAt(re,0,"fill"),X=ce+Ae*(1-this._fontSizeFraction),U=this.getHeightOfChar(re,0),W=this.getValueOfPropertyAt(re,0,"deltaY");for(var we=0,Pe=Y.length;we<Pe;we++)if(de=this.__charBounds[re][we],ve=this.getValueOfPropertyAt(re,we,D),Ce=this.getValueOfPropertyAt(re,we,"fill"),F=this.getHeightOfChar(re,we),$=this.getValueOfPropertyAt(re,we,"deltaY"),be&&ve&&Ce)b.save(),b.fillStyle=_e,b.translate(de.renderLeft,de.renderTop),b.rotate(de.angle),b.fillRect(-de.kernedWidth/2,De*F+$,de.kernedWidth,this.fontSize/15),b.restore();else if((ve!==J||Ce!==_e||F!==U||$!==W)&&oe>0){var Ee=ge+B+ie;"rtl"===this.direction&&(Ee=this.width-Ee-oe),J&&_e&&(b.fillStyle=_e,b.fillRect(Ee,X+De*U+W,oe,this.fontSize/15)),ie=de.left,oe=de.width,J=ve,_e=Ce,U=F,W=$}else oe+=de.kernedWidth;Ee=ge+B+ie,"rtl"===this.direction&&(Ee=this.width-Ee-oe),b.fillStyle=Ce,ve&&Ce&&b.fillRect(Ee,X+De*U+W,oe-Ie,this.fontSize/15),ce+=k}else ce+=k;this._removeShadow(b)}},_getFontDeclaration:function(b,D){var k=b||this,U=this.fontFamily,F=A.Text.genericFonts.indexOf(U.toLowerCase())>-1,B=void 0===U||U.indexOf("'")>-1||U.indexOf(",")>-1||U.indexOf('"')>-1||F?k.fontFamily:'"'+k.fontFamily+'"';return[A.isLikelyNode?k.fontWeight:k.fontStyle,A.isLikelyNode?k.fontStyle:k.fontWeight,D?this.CACHE_FONT_SIZE+"px":k.fontSize+"px",B].join(" ")},render:function(b){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",b)))},_splitTextIntoLines:function(b){for(var D=b.split(this._reNewline),k=new Array(D.length),U=["\n"],F=[],B=0;B<D.length;B++)k[B]=A.util.string.graphemeSplit(D[B]),F=F.concat(k[B],U);return F.pop(),{_unwrappedLines:k,lines:D,graphemeText:F,graphemeLines:k}},toObject:function(b){var D=O.concat(b),k=this.callSuper("toObject",D);return k.styles=P(this.styles,!0),k.path&&(k.path=this.path.toObject()),k},set:function(b,D){this.callSuper("set",b,D);var k=!1,U=!1;if("object"==typeof b)for(var F in b)"path"===F&&this.setPathInfo(),k=k||-1!==this._dimensionAffectingProps.indexOf(F),U=U||"path"===F;else k=-1!==this._dimensionAffectingProps.indexOf(b),U="path"===b;return U&&this.setPathInfo(),k&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),A.Text.ATTRIBUTE_NAMES=A.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),A.Text.DEFAULT_SVG_FONT_SIZE=16,A.Text.fromElement=function(b,D,k){if(!b)return D(null);var U=A.parseAttributes(b,A.Text.ATTRIBUTE_NAMES),F=U.textAnchor||"left";if((k=A.util.object.extend(k?P(k):{},U)).top=k.top||0,k.left=k.left||0,U.textDecoration){var B=U.textDecoration;-1!==B.indexOf("underline")&&(k.underline=!0),-1!==B.indexOf("overline")&&(k.overline=!0),-1!==B.indexOf("line-through")&&(k.linethrough=!0),delete k.textDecoration}"dx"in U&&(k.left+=U.dx),"dy"in U&&(k.top+=U.dy),"fontSize"in k||(k.fontSize=A.Text.DEFAULT_SVG_FONT_SIZE);var W="";"textContent"in b?W=b.textContent:"firstChild"in b&&null!==b.firstChild&&"data"in b.firstChild&&null!==b.firstChild.data&&(W=b.firstChild.data),W=W.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var $=k.strokeWidth;k.strokeWidth=0;var Y=new A.Text(W,k),J=Y.getScaledHeight()/Y.height,X=((Y.height+Y.strokeWidth)*Y.lineHeight-Y.height)*J,ie=Y.getScaledHeight()+X,oe=0;"center"===F&&(oe=Y.getScaledWidth()/2),"right"===F&&(oe=Y.getScaledWidth()),Y.set({left:Y.left-oe,top:Y.top-(ie-Y.fontSize*(.07+Y._fontSizeFraction))/Y.lineHeight,strokeWidth:void 0!==$?$:1}),D(Y)},A.Text.fromObject=function(b,D){var k=P(b),U=b.path;return delete k.path,A.Object._fromObject("Text",k,function(F){U?A.Object._fromObject("Path",U,function(B){F.set("path",B),D(F)},"path"):D(F)},"text")},A.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],A.util.createAccessors&&A.util.createAccessors(A.Text)}}(l),j.util.object.extend(j.Text.prototype,{isEmptyStyles:function(I){if(!this.styles||void 0!==I&&!this.styles[I])return!0;var A=void 0===I?this.styles:{line:this.styles[I]};for(var P in A)for(var O in A[P])for(var b in A[P][O])return!1;return!0},styleHas:function(I,A){if(!this.styles||!I||""===I||void 0!==A&&!this.styles[A])return!1;var P=void 0===A?this.styles:{0:this.styles[A]};for(var O in P)for(var b in P[O])if(void 0!==P[O][b][I])return!0;return!1},cleanStyle:function(I){if(!this.styles||!I||""===I)return!1;var A,P,O=this.styles,b=0,D=!0,k=0;for(var U in O){for(var F in A=0,O[U]){var B;b++,(B=O[U][F]).hasOwnProperty(I)?(P?B[I]!==P&&(D=!1):P=B[I],B[I]===this[I]&&delete B[I]):D=!1,0!==Object.keys(B).length?A++:delete O[U][F]}0===A&&delete O[U]}for(var W=0;W<this._textLines.length;W++)k+=this._textLines[W].length;D&&b===k&&(this[I]=P,this.removeStyle(I))},removeStyle:function(I){if(this.styles&&I&&""!==I){var A,P,O,b=this.styles;for(P in b){for(O in A=b[P])delete A[O][I],0===Object.keys(A[O]).length&&delete A[O];0===Object.keys(A).length&&delete b[P]}}},_extendStyles:function(I,A){var P=this.get2DCursorLocation(I);this._getLineStyle(P.lineIndex)||this._setLineStyle(P.lineIndex),this._getStyleDeclaration(P.lineIndex,P.charIndex)||this._setStyleDeclaration(P.lineIndex,P.charIndex,{}),j.util.object.extend(this._getStyleDeclaration(P.lineIndex,P.charIndex),A)},get2DCursorLocation:function(I,A){void 0===I&&(I=this.selectionStart);for(var P=A?this._unwrappedTextLines:this._textLines,O=P.length,b=0;b<O;b++){if(I<=P[b].length)return{lineIndex:b,charIndex:I};I-=P[b].length+this.missingNewlineOffset(b)}return{lineIndex:b-1,charIndex:P[b-1].length<I?P[b-1].length:I}},getSelectionStyles:function(I,A,P){void 0===I&&(I=this.selectionStart||0),void 0===A&&(A=this.selectionEnd||I);for(var O=[],b=I;b<A;b++)O.push(this.getStyleAtPosition(b,P));return O},getStyleAtPosition:function(I,A){var P=this.get2DCursorLocation(I);return(A?this.getCompleteStyleDeclaration(P.lineIndex,P.charIndex):this._getStyleDeclaration(P.lineIndex,P.charIndex))||{}},setSelectionStyles:function(I,A,P){void 0===A&&(A=this.selectionStart||0),void 0===P&&(P=this.selectionEnd||A);for(var O=A;O<P;O++)this._extendStyles(O,I);return this._forceClearCache=!0,this},_getStyleDeclaration:function(I,A){var P=this.styles&&this.styles[I];return P?P[A]:null},getCompleteStyleDeclaration:function(I,A){for(var P,O=this._getStyleDeclaration(I,A)||{},b={},D=0;D<this._styleProperties.length;D++)b[P=this._styleProperties[D]]=void 0===O[P]?this[P]:O[P];return b},_setStyleDeclaration:function(I,A,P){this.styles[I][A]=P},_deleteStyleDeclaration:function(I,A){delete this.styles[I][A]},_getLineStyle:function(I){return!!this.styles[I]},_setLineStyle:function(I){this.styles[I]={}},_deleteLineStyle:function(I){delete this.styles[I]}}),function(){function I(A){A.textDecoration&&(A.textDecoration.indexOf("underline")>-1&&(A.underline=!0),A.textDecoration.indexOf("line-through")>-1&&(A.linethrough=!0),A.textDecoration.indexOf("overline")>-1&&(A.overline=!0),delete A.textDecoration)}j.IText=j.util.createClass(j.Text,j.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(A,P){this.callSuper("initialize",A,P),this.initBehavior()},setSelectionStart:function(A){A=Math.max(A,0),this._updateAndFire("selectionStart",A)},setSelectionEnd:function(A){A=Math.min(A,this.text.length),this._updateAndFire("selectionEnd",A)},_updateAndFire:function(A,P){this[A]!==P&&(this._fireSelectionChanged(),this[A]=P),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(A){this.clearContextTop(),this.callSuper("render",A),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(A){this.callSuper("_render",A)},clearContextTop:function(A){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var P=this.canvas.contextTop,O=this.canvas.viewportTransform;P.save(),P.transform(O[0],O[1],O[2],O[3],O[4],O[5]),this.transform(P),this._clearTextArea(P),A||P.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var A=this._getCursorBoundaries(),P=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(A,P):this.renderSelection(A,P),P.restore()}},_clearTextArea:function(A){var P=this.width+4,O=this.height+4;A.clearRect(-P/2,-O/2,P,O)},_getCursorBoundaries:function(A){void 0===A&&(A=this.selectionStart);var P=this._getLeftOffset(),O=this._getTopOffset(),b=this._getCursorBoundariesOffsets(A);return{left:P,top:O,leftOffset:b.left,topOffset:b.top}},_getCursorBoundariesOffsets:function(A){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var P,O,b,D,k=0,U=0,F=this.get2DCursorLocation(A);b=F.charIndex,O=F.lineIndex;for(var B=0;B<O;B++)k+=this.getHeightOfLine(B);P=this._getLineLeftOffset(O);var W=this.__charBounds[O][b];return W&&(U=W.left),0!==this.charSpacing&&b===this._textLines[O].length&&(U-=this._getWidthOfCharSpacing()),D={top:k,left:P+(U>0?U:0)},"rtl"===this.direction&&(D.left*=-1),this.cursorOffsetCache=D,this.cursorOffsetCache},renderCursor:function(A,P){var O=this.get2DCursorLocation(),b=O.lineIndex,D=O.charIndex>0?O.charIndex-1:0,k=this.getValueOfPropertyAt(b,D,"fontSize"),U=this.scaleX*this.canvas.getZoom(),F=this.cursorWidth/U,B=A.topOffset,W=this.getValueOfPropertyAt(b,D,"deltaY");B+=(1-this._fontSizeFraction)*this.getHeightOfLine(b)/this.lineHeight-k*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(A,P),P.fillStyle=this.cursorColor||this.getValueOfPropertyAt(b,D,"fill"),P.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,P.fillRect(A.left+A.leftOffset-F/2,B+A.top+W,F,k)},renderSelection:function(A,P){for(var O=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,b=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,D=-1!==this.textAlign.indexOf("justify"),k=this.get2DCursorLocation(O),U=this.get2DCursorLocation(b),F=k.lineIndex,B=U.lineIndex,W=k.charIndex<0?0:k.charIndex,$=U.charIndex<0?0:U.charIndex,Y=F;Y<=B;Y++){var J,X=this._getLineLeftOffset(Y)||0,ie=this.getHeightOfLine(Y),oe=0,de=0;if(Y===F&&(oe=this.__charBounds[F][W].left),Y>=F&&Y<B)de=D&&!this.isEndOfWrapping(Y)?this.width:this.getLineWidth(Y)||5;else if(Y===B)if(0===$)de=this.__charBounds[B][$].left;else{var ve=this._getWidthOfCharSpacing();de=this.__charBounds[B][$-1].left+this.__charBounds[B][$-1].width-ve}J=ie,(this.lineHeight<1||Y===B&&this.lineHeight>1)&&(ie/=this.lineHeight);var Ae=A.left+X+oe,Ce=de-oe,_e=ie,ge=0;this.inCompositionMode?(P.fillStyle=this.compositionColor||"black",_e=1,ge=ie):P.fillStyle=this.selectionColor,"rtl"===this.direction&&(Ae=this.width-Ae-Ce),P.fillRect(Ae,A.top+A.topOffset+ge,Ce,_e),A.topOffset+=J}},getCurrentCharFontSize:function(){var A=this._getCurrentCharIndex();return this.getValueOfPropertyAt(A.l,A.c,"fontSize")},getCurrentCharColor:function(){var A=this._getCurrentCharIndex();return this.getValueOfPropertyAt(A.l,A.c,"fill")},_getCurrentCharIndex:function(){var A=this.get2DCursorLocation(this.selectionStart,!0);return{l:A.lineIndex,c:A.charIndex>0?A.charIndex-1:0}}}),j.IText.fromObject=function(A,P){if(I(A),A.styles)for(var O in A.styles)for(var b in A.styles[O])I(A.styles[O][b]);j.Object._fromObject("IText",A,P,"text")}}(),ae=j.util.object.clone,j.util.object.extend(j.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var I=this;this.on("added",function(){var A=I.canvas;A&&(A._hasITextHandlers||(A._hasITextHandlers=!0,I._initCanvasHandlers(A)),A._iTextInstances=A._iTextInstances||[],A._iTextInstances.push(I))})},initRemovedHandler:function(){var I=this;this.on("removed",function(){var A=I.canvas;A&&(A._iTextInstances=A._iTextInstances||[],j.util.removeFromArray(A._iTextInstances,I),0===A._iTextInstances.length&&(A._hasITextHandlers=!1,I._removeCanvasHandlers(A)))})},_initCanvasHandlers:function(I){I._mouseUpITextHandler=function(){I._iTextInstances&&I._iTextInstances.forEach(function(A){A.__isMousedown=!1})},I.on("mouse:up",I._mouseUpITextHandler)},_removeCanvasHandlers:function(I){I.off("mouse:up",I._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(I,A,P,O){var b;return b={isAborted:!1,abort:function(){this.isAborted=!0}},I.animate("_currentCursorOpacity",A,{duration:P,onComplete:function(){b.isAborted||I[O]()},onChange:function(){I.canvas&&I.selectionStart===I.selectionEnd&&I.renderCursorOrSelection()},abort:function(){return b.isAborted}}),b},_onTickComplete:function(){var I=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){I._currentTickCompleteState=I._animateCursor(I,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(I){var A=this,P=I?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){A._tick()},P)},abortCursorAnimation:function(){var I=this._currentTickState||this._currentTickCompleteState,A=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,I&&A&&A.clearContext(A.contextTop||A.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(I){var A=0,P=I-1;if(this._reSpace.test(this._text[P]))for(;this._reSpace.test(this._text[P]);)A++,P--;for(;/\S/.test(this._text[P])&&P>-1;)A++,P--;return I-A},findWordBoundaryRight:function(I){var A=0,P=I;if(this._reSpace.test(this._text[P]))for(;this._reSpace.test(this._text[P]);)A++,P++;for(;/\S/.test(this._text[P])&&P<this._text.length;)A++,P++;return I+A},findLineBoundaryLeft:function(I){for(var A=0,P=I-1;!/\n/.test(this._text[P])&&P>-1;)A++,P--;return I-A},findLineBoundaryRight:function(I){for(var A=0,P=I;!/\n/.test(this._text[P])&&P<this._text.length;)A++,P++;return I+A},searchWordBoundary:function(I,A){for(var P=this._text,O=this._reSpace.test(P[I])?I-1:I,b=P[O],D=j.reNonWord;!D.test(b)&&O>0&&O<P.length;)b=P[O+=A];return D.test(b)&&(O+=1===A?0:1),O},selectWord:function(I){var A=this.searchWordBoundary(I=I||this.selectionStart,-1),P=this.searchWordBoundary(I,1);this.selectionStart=A,this.selectionEnd=P,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(I){var A=this.findLineBoundaryLeft(I=I||this.selectionStart),P=this.findLineBoundaryRight(I);return this.selectionStart=A,this.selectionEnd=P,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(I){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(I),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(I){I._iTextInstances&&I._iTextInstances.forEach(function(A){A.selected=!1,A.isEditing&&A.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(I){if(this.__isMousedown&&this.isEditing){var A=this.getSelectionStartFromPointer(I.e),P=this.selectionStart,O=this.selectionEnd;(A===this.__selectionStartOnMouseDown&&P!==O||P!==A&&O!==A)&&(A>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=A):(this.selectionStart=A,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===P&&this.selectionEnd===O||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(I,A,P){var O=P.slice(0,I),b=j.util.string.graphemeSplit(O).length;if(I===A)return{selectionStart:b,selectionEnd:b};var D=P.slice(I,A);return{selectionStart:b,selectionEnd:b+j.util.string.graphemeSplit(D).length}},fromGraphemeToStringSelection:function(I,A,P){var O=P.slice(0,I).join("").length;return I===A?{selectionStart:O,selectionEnd:O}:{selectionStart:O,selectionEnd:O+P.slice(I,A).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var I=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=I.selectionStart,this.hiddenTextarea.selectionEnd=I.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var I=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=I.selectionEnd,this.inCompositionMode||(this.selectionStart=I.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var I=this._calcTextareaPosition();this.hiddenTextarea.style.left=I.left,this.hiddenTextarea.style.top=I.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var I=this.inCompositionMode?this.compositionStart:this.selectionStart,A=this._getCursorBoundaries(I),P=this.get2DCursorLocation(I),D=this.getValueOfPropertyAt(P.lineIndex,P.charIndex,"fontSize")*this.lineHeight,k=A.leftOffset,U=this.calcTransformMatrix(),F={x:A.left+k,y:A.top+A.topOffset+D},B=this.canvas.getRetinaScaling(),W=this.canvas.upperCanvasEl,$=W.width/B,Y=W.height/B,J=$-D,X=Y-D,ie=W.clientWidth/$,oe=W.clientHeight/Y;return F=j.util.transformPoint(F,U),(F=j.util.transformPoint(F,this.canvas.viewportTransform)).x*=ie,F.y*=oe,F.x<0&&(F.x=0),F.x>J&&(F.x=J),F.y<0&&(F.y=0),F.y>X&&(F.y=X),F.x+=this.canvas._offset.left,F.y+=this.canvas._offset.top,{left:F.x+"px",top:F.y+"px",fontSize:D+"px",charHeight:D}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var I=this._textBeforeEdit!==this.text,A=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,A&&(A.blur&&A.blur(),A.parentNode&&A.parentNode.removeChild(A)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),I&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),I&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var I in this.styles)this._textLines[I]||delete this.styles[I]},removeStyleFromTo:function(I,A){var P,O,b=this.get2DCursorLocation(I,!0),D=this.get2DCursorLocation(A,!0),k=b.lineIndex,U=b.charIndex,F=D.lineIndex,B=D.charIndex;if(k!==F){if(this.styles[k])for(P=U;P<this._unwrappedTextLines[k].length;P++)delete this.styles[k][P];if(this.styles[F])for(P=B;P<this._unwrappedTextLines[F].length;P++)(O=this.styles[F][P])&&(this.styles[k]||(this.styles[k]={}),this.styles[k][U+P-B]=O);for(P=k+1;P<=F;P++)delete this.styles[P];this.shiftLineStyles(F,k-F)}else if(this.styles[k]){O=this.styles[k];var W,$,Y=B-U;for(P=U;P<B;P++)delete O[P];for($ in this.styles[k])(W=parseInt($,10))>=B&&(O[W-Y]=O[$],delete O[$])}},shiftLineStyles:function(I,A){var P=ae(this.styles);for(var O in this.styles){var b=parseInt(O,10);b>I&&(this.styles[b+A]=P[b],P[b-A]||delete this.styles[b])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(I,A,P,O){var b,D={},k=!1,U=this._unwrappedTextLines[I].length===A;for(var F in P||(P=1),this.shiftLineStyles(I,P),this.styles[I]&&(b=this.styles[I][0===A?A:A-1]),this.styles[I]){var B=parseInt(F,10);B>=A&&(k=!0,D[B-A]=this.styles[I][F],U&&0===A||delete this.styles[I][F])}var W=!1;for(k&&!U&&(this.styles[I+P]=D,W=!0),W&&P--;P>0;)O&&O[P-1]?this.styles[I+P]={0:ae(O[P-1])}:b?this.styles[I+P]={0:ae(b)}:delete this.styles[I+P],P--;this._forceClearCache=!0},insertCharStyleObject:function(I,A,P,O){this.styles||(this.styles={});var b=this.styles[I],D=b?ae(b):{};for(var k in P||(P=1),D){var U=parseInt(k,10);U>=A&&(b[U+P]=D[U],D[U-P]||delete b[U])}if(this._forceClearCache=!0,O)for(;P--;)Object.keys(O[P]).length&&(this.styles[I]||(this.styles[I]={}),this.styles[I][A+P]=ae(O[P]));else if(b)for(var F=b[A?A-1:1];F&&P--;)this.styles[I][A+P]=ae(F)},insertNewStyleBlock:function(I,A,P){for(var O=this.get2DCursorLocation(A,!0),b=[0],D=0,k=0;k<I.length;k++)"\n"===I[k]?b[++D]=0:b[D]++;for(b[0]>0&&(this.insertCharStyleObject(O.lineIndex,O.charIndex,b[0],P),P=P&&P.slice(b[0]+1)),D&&this.insertNewlineStyleObject(O.lineIndex,O.charIndex+b[0],D),k=1;k<D;k++)b[k]>0?this.insertCharStyleObject(O.lineIndex+k,0,b[k],P):P&&this.styles[O.lineIndex+k]&&P[0]&&(this.styles[O.lineIndex+k][0]=P[0]),P=P&&P.slice(b[k]+1);b[k]>0&&this.insertCharStyleObject(O.lineIndex+k,0,b[k],P)},setSelectionStartEndWithShift:function(I,A,P){P<=I?(A===I?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=I),this.selectionStart=P):P>I&&P<A?"right"===this._selectionDirection?this.selectionEnd=P:this.selectionStart=P:(A===I?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=A),this.selectionEnd=P)},setSelectionInBoundaries:function(){var I=this.text.length;this.selectionStart>I?this.selectionStart=I:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>I?this.selectionEnd=I:this.selectionEnd<0&&(this.selectionEnd=0)}}),j.util.object.extend(j.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(I){if(this.canvas){this.__newClickTime=+new Date;var A=I.pointer;this.isTripleClick(A)&&(this.fire("tripleclick",I),this._stopEvent(I.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=A,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(I){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===I.x&&this.__lastPointer.y===I.y},_stopEvent:function(I){I.preventDefault&&I.preventDefault(),I.stopPropagation&&I.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(I){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(I.e))},tripleClickHandler:function(I){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(I.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(I){!this.canvas||!this.editable||I.e.button&&1!==I.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(I.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(I){!this.canvas||!this.editable||I.e.button&&1!==I.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(I){if(this.__isMousedown=!1,!(!this.editable||this.group||I.transform&&I.transform.actionPerformed||I.e.button&&1!==I.e.button)){if(this.canvas){var A=this.canvas._activeObject;if(A&&A!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(I.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(I){var A=this.getSelectionStartFromPointer(I);I.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,A):(this.selectionStart=A,this.selectionEnd=A),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(I){for(var A,P=this.getLocalPointer(I),O=0,b=0,D=0,k=0,U=0,F=0,B=this._textLines.length;F<B&&D<=P.y;F++)D+=this.getHeightOfLine(F)*this.scaleY,U=F,F>0&&(k+=this._textLines[F-1].length+this.missingNewlineOffset(F-1));b=this._getLineLeftOffset(U)*this.scaleX,A=this._textLines[U],"rtl"===this.direction&&(P.x=this.width*this.scaleX-P.x+b);for(var W=0,$=A.length;W<$&&(O=b,(b+=this.__charBounds[U][W].kernedWidth*this.scaleX)<=P.x);W++)k++;return this._getNewSelectionStartFromOffset(P,O,b,k,$)},_getNewSelectionStartFromOffset:function(I,A,P,O,b){var k=P-I.x,U=O+(k>I.x-A||k<0?0:1);return this.flipX&&(U=b-U),U>this._text.length&&(U=this._text.length),U}}),j.util.object.extend(j.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=j.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var I=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+I.top+"; left: "+I.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+I.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):j.document.body.appendChild(this.hiddenTextarea),j.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),j.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),j.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),j.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),j.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),j.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),j.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),j.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),j.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(j.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(I){if(this.isEditing){var A="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(I.keyCode in A)this[A[I.keyCode]](I);else{if(!(I.keyCode in this.ctrlKeysMapDown)||!I.ctrlKey&&!I.metaKey)return;this[this.ctrlKeysMapDown[I.keyCode]](I)}I.stopImmediatePropagation(),I.preventDefault(),I.keyCode>=33&&I.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(I){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:I.keyCode in this.ctrlKeysMapUp&&(I.ctrlKey||I.metaKey)&&(this[this.ctrlKeysMapUp[I.keyCode]](I),I.stopImmediatePropagation(),I.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(I){var A=this.fromPaste;if(this.fromPaste=!1,I&&I.stopPropagation(),this.isEditing){var P,O,b,D,k,U=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,F=this._text.length,B=U.length,W=B-F,$=this.selectionStart,Y=this.selectionEnd,J=$!==Y;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var X=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),ie=$>X.selectionStart;J?(P=this._text.slice($,Y),W+=Y-$):B<F&&(P=ie?this._text.slice(Y+W,Y):this._text.slice($,$-W)),O=U.slice(X.selectionEnd-W,X.selectionEnd),P&&P.length&&(O.length&&(b=this.getSelectionStyles($,$+1,!1),b=O.map(function(){return b[0]})),J?(D=$,k=Y):ie?(D=Y-P.length,k=Y):(D=Y,k=Y+P.length),this.removeStyleFromTo(D,k)),O.length&&(A&&O.join("")===j.copiedText&&!j.disableStyleCopyPaste&&(b=j.copiedTextStyle),this.insertNewStyleBlock(O,$,b)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(I){this.compositionStart=I.target.selectionStart,this.compositionEnd=I.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(j.copiedText=this.getSelectedText(),j.copiedTextStyle=j.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(I){return I&&I.clipboardData||j.window.clipboardData},_getWidthBeforeCursor:function(I,A){var P,O=this._getLineLeftOffset(I);return A>0&&(O+=(P=this.__charBounds[I][A-1]).left+P.width),O},getDownCursorOffset:function(I,A){var P=this._getSelectionForOffset(I,A),O=this.get2DCursorLocation(P),b=O.lineIndex;if(b===this._textLines.length-1||I.metaKey||34===I.keyCode)return this._text.length-P;var D=O.charIndex,k=this._getWidthBeforeCursor(b,D),U=this._getIndexOnLine(b+1,k);return this._textLines[b].slice(D).length+U+1+this.missingNewlineOffset(b)},_getSelectionForOffset:function(I,A){return I.shiftKey&&this.selectionStart!==this.selectionEnd&&A?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(I,A){var P=this._getSelectionForOffset(I,A),O=this.get2DCursorLocation(P),b=O.lineIndex;if(0===b||I.metaKey||33===I.keyCode)return-P;var D=O.charIndex,k=this._getWidthBeforeCursor(b,D),U=this._getIndexOnLine(b-1,k),F=this._textLines[b].slice(0,D),B=this.missingNewlineOffset(b-1);return-this._textLines[b-1].length+U-F.length+(1-B)},_getIndexOnLine:function(I,A){for(var P,O,b=this._textLines[I],D=this._getLineLeftOffset(I),k=0,U=0,F=b.length;U<F;U++)if((D+=P=this.__charBounds[I][U].width)>A){O=!0;var W=D,$=Math.abs(D-P-A);k=Math.abs(W-A)<$?U:U-1;break}return O||(k=b.length-1),k},moveCursorDown:function(I){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",I)},moveCursorUp:function(I){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",I)},_moveCursorUpOrDown:function(I,A){var P=this["get"+I+"CursorOffset"](A,"right"===this._selectionDirection);A.shiftKey?this.moveCursorWithShift(P):this.moveCursorWithoutShift(P),0!==P&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(I){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+I:this.selectionEnd+I),0!==I},moveCursorWithoutShift:function(I){return I<0?(this.selectionStart+=I,this.selectionEnd=this.selectionStart):(this.selectionEnd+=I,this.selectionStart=this.selectionEnd),0!==I},moveCursorLeft:function(I){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",I)},_move:function(I,A,P){var O;if(I.altKey)O=this["findWordBoundary"+P](this[A]);else{if(!I.metaKey&&35!==I.keyCode&&36!==I.keyCode)return this[A]+="Left"===P?-1:1,!0;O=this["findLineBoundary"+P](this[A])}if(void 0!==typeof O&&this[A]!==O)return this[A]=O,!0},_moveLeft:function(I,A){return this._move(I,A,"Left")},_moveRight:function(I,A){return this._move(I,A,"Right")},moveCursorLeftWithoutShift:function(I){var A=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(A=this._moveLeft(I,"selectionStart")),this.selectionEnd=this.selectionStart,A},moveCursorLeftWithShift:function(I){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(I,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(I,"selectionStart")):void 0},moveCursorRight:function(I){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",I)},_moveCursorLeftOrRight:function(I,A){var P="moveCursor"+I+"With";this._currentCursorOpacity=1,this[P+=A.shiftKey?"Shift":"outShift"](A)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(I){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(I,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(I,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(I){var A=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(A=this._moveRight(I,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,A},removeChars:function(I,A){void 0===A&&(A=I+1),this.removeStyleFromTo(I,A),this._text.splice(I,A-I),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(I,A,P,O){void 0===O&&(O=P),O>P&&this.removeStyleFromTo(P,O);var b=j.util.string.graphemeSplit(I);this.insertNewStyleBlock(b,P,A),this._text=[].concat(this._text.slice(0,P),b,this._text.slice(O)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var I=j.util.toFixed,A=/  +/g;j.util.object.extend(j.Text.prototype,{_toSVG:function(){var P=this._getSVGLeftTopOffsets(),O=this._getSVGTextAndBg(P.textTop,P.textLeft);return this._wrapSVGTextAndBg(O)},toSVG:function(P){return this._createBaseSVGMarkup(this._toSVG(),{reviver:P,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(P){var O=this.getSvgTextDecoration(this);return[P.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",O?'text-decoration="'+O+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",P.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(P,O){var b,D=[],k=[],U=P;this._setSVGBg(k);for(var F=0,B=this._textLines.length;F<B;F++)b=this._getLineLeftOffset(F),(this.textBackgroundColor||this.styleHas("textBackgroundColor",F))&&this._setSVGTextLineBg(k,F,O+b,U),this._setSVGTextLineText(D,F,O+b,U),U+=this.getHeightOfLine(F);return{textSpans:D,textBgRects:k}},_createTextCharSpan:function(P,O,b,D){var k=P!==P.trim()||P.match(A),U=this.getSvgSpanStyles(O,k),F=U?'style="'+U+'"':"",B=O.deltaY,W="",$=j.Object.NUM_FRACTION_DIGITS;return B&&(W=' dy="'+I(B,$)+'" '),['<tspan x="',I(b,$),'" y="',I(D,$),'" ',W,F,">",j.util.string.escapeXml(P),"</tspan>"].join("")},_setSVGTextLineText:function(P,O,b,D){var k,U,F,B,W,$=this.getHeightOfLine(O),Y=-1!==this.textAlign.indexOf("justify"),J="",X=0,ie=this._textLines[O];D+=$*(1-this._fontSizeFraction)/this.lineHeight;for(var oe=0,de=ie.length-1;oe<=de;oe++)W=oe===de||this.charSpacing,J+=ie[oe],F=this.__charBounds[O][oe],0===X?(b+=F.kernedWidth-F.width,X+=F.width):X+=F.kernedWidth,Y&&!W&&this._reSpaceAndTab.test(ie[oe])&&(W=!0),W||(k=k||this.getCompleteStyleDeclaration(O,oe),U=this.getCompleteStyleDeclaration(O,oe+1),W=this._hasStyleChangedForSvg(k,U)),W&&(B=this._getStyleDeclaration(O,oe)||{},P.push(this._createTextCharSpan(J,B,b,D)),J="",k=U,b+=X,X=0)},_pushTextBgRect:function(P,O,b,D,k,U){var F=j.Object.NUM_FRACTION_DIGITS;P.push("\t\t<rect ",this._getFillAttributes(O),' x="',I(b,F),'" y="',I(D,F),'" width="',I(k,F),'" height="',I(U,F),'"></rect>\n')},_setSVGTextLineBg:function(P,O,b,D){for(var k,U,F=this._textLines[O],B=this.getHeightOfLine(O)/this.lineHeight,W=0,$=0,Y=this.getValueOfPropertyAt(O,0,"textBackgroundColor"),J=0,X=F.length;J<X;J++)k=this.__charBounds[O][J],(U=this.getValueOfPropertyAt(O,J,"textBackgroundColor"))!==Y?(Y&&this._pushTextBgRect(P,Y,b+$,D,W,B),$=k.left,W=k.width,Y=U):W+=k.kernedWidth;U&&this._pushTextBgRect(P,U,b+$,D,W,B)},_getFillAttributes:function(P){var O=P&&"string"==typeof P?new j.Color(P):"";return O&&O.getSource()&&1!==O.getAlpha()?'opacity="'+O.getAlpha()+'" fill="'+O.setAlpha(1).toRgb()+'"':'fill="'+P+'"'},_getSVGLineTopOffset:function(P){for(var O,b=0,D=0;D<P;D++)b+=this.getHeightOfLine(D);return O=this.getHeightOfLine(D),{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*O/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(P){return j.Object.prototype.getSvgStyles.call(this,P)+" white-space: pre;"}})}(),function(I){var A=I.fabric||(I.fabric={});A.Textbox=A.util.createClass(A.IText,A.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:A.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(P){for(var O=0,b=0,D=0,k={},U=0;U<P.graphemeLines.length;U++)"\n"===P.graphemeText[D]&&U>0?(b=0,D++,O++):!this.splitByGrapheme&&this._reSpaceAndTab.test(P.graphemeText[D])&&U>0&&(b++,D++),k[U]={line:O,offset:b},D+=P.graphemeLines[U].length,b+=P.graphemeLines[U].length;return k},styleHas:function(P,O){if(this._styleMap&&!this.isWrapping){var b=this._styleMap[O];b&&(O=b.line)}return A.Text.prototype.styleHas.call(this,P,O)},isEmptyStyles:function(P){if(!this.styles)return!0;var O,b,D=0,k=!1,U=this._styleMap[P],F=this._styleMap[P+1];for(var B in U&&(P=U.line,D=U.offset),F&&(k=F.line===P,O=F.offset),b=void 0===P?this.styles:{line:this.styles[P]})for(var W in b[B])if(W>=D&&(!k||W<O))for(var $ in b[B][W])return!1;return!0},_getStyleDeclaration:function(P,O){if(this._styleMap&&!this.isWrapping){var b=this._styleMap[P];if(!b)return null;P=b.line,O=b.offset+O}return this.callSuper("_getStyleDeclaration",P,O)},_setStyleDeclaration:function(P,O,b){var D=this._styleMap[P];this.styles[P=D.line][O=D.offset+O]=b},_deleteStyleDeclaration:function(P,O){var b=this._styleMap[P];delete this.styles[P=b.line][O=b.offset+O]},_getLineStyle:function(P){return!!this.styles[this._styleMap[P].line]},_setLineStyle:function(P){this.styles[this._styleMap[P].line]={}},_wrapText:function(P,O){var b,D=[];for(this.isWrapping=!0,b=0;b<P.length;b++)D=D.concat(this._wrapLine(P[b],b,O));return this.isWrapping=!1,D},_measureWord:function(P,O,b){var D,k=0;b=b||0;for(var U=0,F=P.length;U<F;U++)k+=this._getGraphemeBox(P[U],O,U+b,D,!0).kernedWidth,D=P[U];return k},_wrapLine:function(P,O,b,D){var k=0,U=this.splitByGrapheme,F=[],B=[],W=U?A.util.string.graphemeSplit(P):P.split(this._wordJoiners),$="",Y=0,J=U?"":" ",X=0,ie=0,oe=0,de=!0,ve=this._getWidthOfCharSpacing();D=D||0,0===W.length&&W.push([]),b-=D;for(var Ae=0;Ae<W.length;Ae++)$=U?W[Ae]:A.util.string.graphemeSplit(W[Ae]),X=this._measureWord($,O,Y),Y+=$.length,(k+=ie+X-ve)>b&&!de?(F.push(B),B=[],k=X,de=!0):k+=ve,de||U||B.push(J),B=B.concat($),ie=U?0:this._measureWord([J],O,Y),Y++,de=!1,X>oe&&(oe=X);return Ae&&F.push(B),oe+D>this.dynamicMinWidth&&(this.dynamicMinWidth=oe-ve+D),F},isEndOfWrapping:function(P){return!this._styleMap[P+1]||this._styleMap[P+1].line!==this._styleMap[P].line},missingNewlineOffset:function(P){return this.splitByGrapheme?this.isEndOfWrapping(P)?1:0:1},_splitTextIntoLines:function(P){for(var O=A.Text.prototype._splitTextIntoLines.call(this,P),b=this._wrapText(O.lines,this.width),D=new Array(b.length),k=0;k<b.length;k++)D[k]=b[k].join("");return O.lines=D,O.graphemeLines=b,O},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var P={};for(var O in this._styleMap)this._textLines[O]&&(P[this._styleMap[O].line]=1);for(var O in this.styles)P[O]||delete this.styles[O]},toObject:function(P){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(P))}}),A.Textbox.fromObject=function(P,O){return A.Object._fromObject("Textbox",P,O,"text")}}(l),function(){var I=j.controlsUtils,A=I.scaleSkewCursorStyleHandler,P=I.scaleCursorStyleHandler,O=I.scalingEqually,b=I.scalingYOrSkewingX,D=I.scalingXOrSkewingY,k=I.scaleOrSkewActionName,U=j.Object.prototype.controls;if(U.ml=new j.Control({x:-.5,y:0,cursorStyleHandler:A,actionHandler:D,getActionName:k}),U.mr=new j.Control({x:.5,y:0,cursorStyleHandler:A,actionHandler:D,getActionName:k}),U.mb=new j.Control({x:0,y:.5,cursorStyleHandler:A,actionHandler:b,getActionName:k}),U.mt=new j.Control({x:0,y:-.5,cursorStyleHandler:A,actionHandler:b,getActionName:k}),U.tl=new j.Control({x:-.5,y:-.5,cursorStyleHandler:P,actionHandler:O}),U.tr=new j.Control({x:.5,y:-.5,cursorStyleHandler:P,actionHandler:O}),U.bl=new j.Control({x:-.5,y:.5,cursorStyleHandler:P,actionHandler:O}),U.br=new j.Control({x:.5,y:.5,cursorStyleHandler:P,actionHandler:O}),U.mtr=new j.Control({x:0,y:-.5,actionHandler:I.rotationWithSnapping,cursorStyleHandler:I.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),j.Textbox){var F=j.Textbox.prototype.controls={};F.mtr=U.mtr,F.tr=U.tr,F.br=U.br,F.tl=U.tl,F.bl=U.bl,F.mt=U.mt,F.mb=U.mb,F.mr=new j.Control({x:.5,y:0,actionHandler:I.changeWidth,cursorStyleHandler:A,actionName:"resizing"}),F.ml=new j.Control({x:-.5,y:0,actionHandler:I.changeWidth,cursorStyleHandler:A,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},tk={};function fd(p){var l=tk[p];if(void 0!==l)return l.exports;var u=tk[p]={exports:{}};return vee[p](u,u.exports,fd),u.exports}fd.d=(p,l)=>{for(var u in l)fd.o(l,u)&&!fd.o(p,u)&&Object.defineProperty(p,u,{enumerable:!0,get:l[u]})},fd.o=(p,l)=>Object.prototype.hasOwnProperty.call(p,l);var ik={};(()=>{let p;fd.d(ik,{R:()=>p}),p="undefined"!=typeof document&&"undefined"!=typeof window?fd(653).fabric:{version:"5.2.1"}})();var Rs,io,Kc,nk,ii=ik.R;(function(p){p[p.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",p[p.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",p[p.DIMT_TEXT=4]="DIMT_TEXT",p[p.DIMT_ARC=8]="DIMT_ARC",p[p.DIMT_IMAGE=16]="DIMT_IMAGE",p[p.DIMT_POLYGON=32]="DIMT_POLYGON",p[p.DIMT_LINE=64]="DIMT_LINE",p[p.DIMT_GROUP=128]="DIMT_GROUP"})(Rs||(Rs={})),function(p){p[p.DIS_DEFAULT=1]="DIS_DEFAULT",p[p.DIS_SELECTED=2]="DIS_SELECTED"}(io||(io={})),function(p){p[p.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",p[p.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",p[p.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Kc||(Kc={})),function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(nk||(nk={}));const df=p=>"number"==typeof p&&!Number.isNaN(p),V_=p=>"string"==typeof p;var c1,lm,uf,j_,il,h1;(function(p){p[p.ARC=0]="ARC",p[p.IMAGE=1]="IMAGE",p[p.LINE=2]="LINE",p[p.POLYGON=3]="POLYGON",p[p.QUAD=4]="QUAD",p[p.RECT=5]="RECT",p[p.TEXT=6]="TEXT",p[p.GROUP=7]="GROUP"})(il||(il={})),function(p){p[p.DEFAULT=0]="DEFAULT",p[p.SELECTED=1]="SELECTED"}(h1||(h1={}));class Rr{get mediaType(){return new Map([["rect",Rs.DIMT_RECTANGLE],["quad",Rs.DIMT_QUADRILATERAL],["text",Rs.DIMT_TEXT],["arc",Rs.DIMT_ARC],["image",Rs.DIMT_IMAGE],["polygon",Rs.DIMT_POLYGON],["line",Rs.DIMT_LINE],["group",Rs.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(Z(this,lm,"f")){case io.DIS_DEFAULT:return"default";case io.DIS_SELECTED:return"selected"}}set drawingStyleId(l){this.styleId=l}get drawingStyleId(){return this.styleId}set coordinateBase(l){if(!["view","image"].includes(l))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===Z(this,uf,"f")&&"view"===l?this.updateCoordinateBaseFromImageToView():"view"===Z(this,uf,"f")&&"image"===l&&this.updateCoordinateBaseFromViewToImage()),lt(this,uf,l,"f")}get coordinateBase(){return Z(this,uf,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(l,u){if(c1.add(this),lm.set(this,void 0),uf.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=u&&!df(u))throw new TypeError("Invalid 'drawingStyleId'.");l&&this._setFabricObject(l),this.setState(io.DIS_DEFAULT),this.styleId=u}_setFabricObject(l){this._fabricObject=l,this._fabricObject.on("selected",()=>{this.setState(io.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(io.DIS_SELECTED):this.setState(io.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),l.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(l){lt(this,lm,l,"f")}getState(){return Z(this,lm,"f")}_on(l,u){if(!u)return;const f=l.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${l}' does not exist.`);let m=g.get(u);m||(m=v=>{const y=v.e;if(!y)return void(u&&u.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const x={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let w,C,_,T;const M=y.target.getBoundingClientRect();w=M.left,C=M.top,_=w+window.scrollX,T=C+window.scrollY;const{width:L,height:N}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),V=this._drawingLayer.width,H=this._drawingLayer.height,G=L/N,z=V/H,q=this._drawingLayer._getObjectFit();let te,se,ae,j,le=1;if("contain"===q)G<z?(le=L/V,te=w+this.get("x")*le,se=C+this.get("y")*le+(N-H*le)/2,ae=_+this.get("x")*le,j=T+this.get("y")*le+(N-H*le)/2):(le=N/H,te=w+this.get("x")*le+(L-V*le)/2,se=C+this.get("y")*le,ae=_+this.get("x")*le+(L-V*le)/2,j=T+this.get("y")*le);else if("cover"===q)if(G<z){le=N/H;let ue=this.get("x")*le-(V*le-L)/2;ue=Math.max(ue,0),ue=Math.min(ue,L),te=w+ue,se=C+this.get("y")*le,ae=_+ue,j=T+this.get("y")*le}else{le=L/V;let ue=this.get("y")*le-(H*le-N)/2;ue=Math.max(ue,0),ue=Math.min(ue,N),te=w+this.get("x")*le,se=C+ue,ae=_+this.get("x")*le,j=T+ue}x.itemClientX=Math.round(te),x.itemClientY=Math.round(se),x.itemPageX=Math.round(ae),x.itemPageY=Math.round(j)}for(let w of Object.getOwnPropertyNames(x))Object.defineProperty(y,w,{value:x[w],writable:!0});u&&u.apply(this,[y])},g.set(u,m),this._fabricObject.on("dblclick"===f?"mousedblclick":f,m))}on(l,u){this._on(l,u)}_off(l,u){const f=l.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${l}' does not exist.`);let m=g.get(u);m&&(g.delete(u),this._fabricObject.off("dblclick"===f?"mousedblclick":f,m))}off(l,u){this._off(l,u)}_setEditable(l){const u=this._fabricObject;l?(u.selectable=!0,u.hasControls=!0,u.hoverCursor=null):(u.selectable=!1,u.hasControls=!1,u.hoverCursor="default")}hasNote(l){return this.mapNoteName_Content.has(l)}addNote(l,u){if(this.hasNote(l.name)&&!u)throw new Error("A note with the same name already exists, please use a different name.");const f=l.content?JSON.parse(JSON.stringify(l.content)):l.content;this.mapNoteName_Content.set(l.name,[f])}getNote(l){const u=this.mapNoteName_Content.get(l);return u?1===u.length?{name:l,content:u[0]?JSON.parse(JSON.stringify(u[0])):u[0]}:{name:l,content:JSON.parse(JSON.stringify(u))}:null}getNotes(){const l=[];for(let u of this.mapNoteName_Content){let f=1===u[1].length?u[1][0]:u[1];f=f&&JSON.parse(JSON.stringify(f)),l.push({name:u[0],content:f})}return l}updateNote(l,u,f){const g=this.mapNoteName_Content.get(l);if(!g)throw new Error("The note name does not exist.");f||(g.length=0),u=u&&JSON.parse(JSON.stringify(u)),g.push(u)}deleteNote(l){this.mapNoteName_Content.delete(l)}clearNotes(){this.mapNoteName_Content.clear()}set(l,u){if(!this.extendSet(l,u))if("x"===l){const f=this._fabricObject.group;f?(this._fabricObject.set("left",u-f.left-f.width/2),f.addWithUpdate()):this._fabricObject.set("left",u)}else if("y"===l){const f=this._fabricObject.group;f?(this._fabricObject.set("top",u-f.top-f.height/2),f.addWithUpdate()):this._fabricObject.set("top",u)}else"styleId"===l?this.styleId=u:this._fabricObject.set(l,u);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(l)&&this._fabricObject.setCoords()}get(l){let u=this.extendGet(l);if(void 0===u)if("x"===l){const f=this._fabricObject.group;u=f?this._fabricObject.get("left")+f.left+f.width/2:this._fabricObject.get("left")}else if("y"===l){const f=this._fabricObject.group;u=f?this._fabricObject.get("top")+f.top+f.height/2:this._fabricObject.get("top")}else u="scaledWidth"===l?this._fabricObject.getScaledWidth():"scaledHeight"===l?this._fabricObject.getScaledHeight():["type","mediaType"].includes(l)?this.mediaType:"state"===l?this.getState():"styleId"===l?this.styleId:"drawingLayerId"===l?this.drawingLayerId:this._fabricObject.get(l);return u}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l*Z(this,c1,"m",j_).call(this)}convertPropFromViewToImage(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l/Z(this,c1,"m",j_).call(this)}_setLineWidth(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",l)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",l)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}lm=new WeakMap,uf=new WeakMap,c1=new WeakSet,j_=function(){const p=this._drawingLayer;if(!p)return 1;const l=p.width,u=p.height,{width:f,height:g}=p.fabricCanvas.wrapperEl.getBoundingClientRect();if(f<=0||g<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const m=f/l,v=g/u,y=p._getObjectFit();let x=1;return"contain"===y?x=m<v?f/l:g/u:"cover"===y&&(x=m<v?g/u:f/l),x},Rr.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Rr.mapItemType=new Map([[il.ARC,"arc"],[il.IMAGE,"image"],[il.LINE,"line"],[il.POLYGON,"polygon"],[il.QUAD,"quad"],[il.RECT,"rect"],[il.TEXT,"text"],[il.GROUP,"group"]]),Rr.arrStyleSelectors=["default","selected"],Rr.mapItemState=new Map([[h1.DEFAULT,"default"],[h1.SELECTED,"selected"]]);const sk=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),H_=p=>!!V_(p)&&""!==p,G_=p=>!(!ma(p)||!jn(p.left)||p.left<0||!jn(p.top)||p.top<0||!jn(p.right)||p.right<0||!jn(p.bottom)||p.bottom<0||p.left>=p.right||p.top>=p.bottom||!T_(p.isMeasuredInPercentage)),ok=p=>!!ma(p)&&!!E_(p.points)&&0!=p.points.length&&!p.points.some(l=>!lf(l)),yee=lf,ak=p=>!!ma(p)&&!!E_(p.points)&&0!=p.points.length&&4==p.points.length&&!p.points.some(l=>!lf(l)),ql=p=>!(!ma(p)||!jn(p.x)||!jn(p.y)||!jn(p.width)||p.width<0||!jn(p.height)||p.height<0||"isMeasuredInPercentage"in p&&!T_(p.isMeasuredInPercentage)),lk=p=>!(!sk(p)||"id"in p&&!df(p.id)||"lineWidth"in p&&!df(p.lineWidth)||"fillStyle"in p&&!H_(p.fillStyle)||"strokeStyle"in p&&!H_(p.strokeStyle)||"paintMode"in p&&!["fill","stroke","strokeAndFill"].includes(p.paintMode)||"fontFamily"in p&&!H_(p.fontFamily)||"fontSize"in p&&!df(p.fontSize));class d1{static convert(l,u,f){const g={x:0,y:0,width:u,height:f};if(!l)return g;if(ql(l))l.isMeasuredInPercentage?(g.x=l.x/100*u,g.y=l.y/100*f,g.width=l.width/100*u,g.height=l.height/100*f):(g.x=l.x,g.y=l.y,g.width=l.width,g.height=l.height);else{if(!G_(l))throw TypeError("Invalid region.");l.isMeasuredInPercentage?(g.x=l.left/100*u,g.y=l.top/100*f,g.width=(l.right-l.left)/100*u,g.height=(l.bottom-l.top)/100*f):(g.x=l.left,g.y=l.top,g.width=l.right-l.left,g.height=l.bottom-l.top)}return g.x=Math.round(g.x),g.y=Math.round(g.y),g.width=Math.round(g.width),g.height=Math.round(g.height),g}}var pd,u1;class ck{constructor(){pd.set(this,new Map),u1.set(this,!1)}get disposed(){return Z(this,u1,"f")}on(l,u){l=l.toLowerCase();const f=Z(this,pd,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else Z(this,pd,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=Z(this,pd,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=Z(this,pd,"f").get(l);u&&(u.length=0)}fire(l,u=[],f={async:!1,copy:!0}){u||(u=[]),l=l.toLowerCase();const g=Z(this,pd,"f").get(l);if(g&&g.length){f=Object.assign({async:!1,copy:!0},f);for(let m of g){if(!m)continue;let v=[];if(f.copy)for(let x of u){try{x=JSON.parse(JSON.stringify(x))}catch(w){}v.push(x)}else v=u;let y=!1;if(f.async)setTimeout(()=>{this.disposed||g.includes(m)&&m.apply(f.target,v)},0);else try{y=m.apply(f.target,v)}catch(x){}if(!0===y)break}}}dispose(){lt(this,u1,!0,"f")}}function xee(p,l,u){return(u.x-p.x)*(l.y-p.y)==(l.x-p.x)*(u.y-p.y)&&Math.min(p.x,l.x)<=u.x&&u.x<=Math.max(p.x,l.x)&&Math.min(p.y,l.y)<=u.y&&u.y<=Math.max(p.y,l.y)}function z_(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function f1(p,l,u,f){let g=p[0]*(u[1]-l[1])+l[0]*(p[1]-u[1])+u[0]*(l[1]-p[1]),m=p[0]*(f[1]-l[1])+l[0]*(p[1]-f[1])+f[0]*(l[1]-p[1]);return!((g^m)>=0&&0!==g&&0!==m||(g=u[0]*(p[1]-f[1])+f[0]*(u[1]-p[1])+p[0]*(f[1]-u[1]),m=u[0]*(l[1]-f[1])+f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1]),(g^m)>=0&&0!==g&&0!==m))}pd=new WeakMap,u1=new WeakMap;const $_=function(){var p=Q(function*(l){if("string"!=typeof l)throw new TypeError("Invalid url.");const u=yield fetch(l);if(!u.ok)throw Error("Network Error: "+u.statusText);const f=yield u.text();if(!f.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const g=document.createElement("div");g.insertAdjacentHTML("beforeend",f);for(let m=0;m<g.childElementCount;++m){let v=g.children[m];v instanceof HTMLStyleElement&&document.head.append(v)}return 1==g.childElementCount?g.children[0]:g});return function(u){return p.apply(this,arguments)}}();var eh,th,nh;class ff extends Rr{constructor(l,u){if(super(null,u),eh.set(this,void 0),!ql(l))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ii.Rect({left:l.x,top:l.y,width:l.width,height:l.height})),lt(this,eh,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="rect"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(l){this.setRect(l)}getPosition(){return this.getRect()}updatePosition(){Z(this,eh,"f")&&this.setRect(Z(this,eh,"f"))}setRect(l){if(!ql(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width)),this.set("height",this.convertPropFromViewToImage(l.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width),this.set("height",l.height)}this._drawingLayer.renderAll()}else lt(this,eh,JSON.parse(JSON.stringify(l)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Z(this,eh,"f")?JSON.parse(JSON.stringify(Z(this,eh,"f"))):null}}function Y_(p,l,u){return ii.util.transformPoint({x:u.points[this.pointIndex].x-u.pathOffset.x,y:u.points[this.pointIndex].y-u.pathOffset.y},u.calcTransformMatrix())}function hk(p){let l=new ii.Point(p.strokeUniform?1/p.scaleX:1,p.strokeUniform?1/p.scaleY:1).multiply(p.strokeWidth);return new ii.Point(p.width+l.x,p.height+l.y)}function X_(p,l,u,f){let g=l.target,m=g.controls[g.__corner],v=g.toLocalPoint(new ii.Point(u,f),"center","center"),y=hk(g),x=g._getTransformedDimensions(0,0);return g.points[m.pointIndex]={x:v.x*y.x/x.x+g.pathOffset.x,y:v.y*y.y/x.y+g.pathOffset.y},ii.controlsUtils.fireEvent("scaling",{e:p,transform:l,pointer:{x:u,y:f}}),!0}function q_(p,l){return function(u,f,g,m){let v=f.target,y=ii.util.transformPoint({x:v.points[p].x-v.pathOffset.x,y:v.points[p].y-v.pathOffset.y},v.calcTransformMatrix()),x=l(u,f,g,m);v._setPositionDimensions({});let w=hk(v);return v.setPositionByOrigin(y,(v.points[p].x-v.pathOffset.x)/w.x+.5,(v.points[p].y-v.pathOffset.y)/w.y+.5),x}}eh=new WeakMap;class Z_ extends Rr{constructor(l,u){if(super(null,u),th.set(this,void 0),!ok(l))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new ii.Polygon(l.points,{objectCaching:!1}));const f=this._fabricObject;let g=f.points.length-1;f.controls=f.points.reduce(function(m,v,y){return m["p"+y]=new ii.Control({positionHandler:Y_,actionHandler:q_(y>0?y-1:g,X_),actionName:"modifyPolygon",pointIndex:y}),m},{}),lt(this,th,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="polygon"}extendSet(l,u){if("vertices"===l){const f=this._fabricObject;if(f.group){const m=f.group;f.points=u.map(v=>({x:v.x-m.left-m.width/2,y:v.y-m.top-m.height/2})),m.addWithUpdate()}else f.points=u;const g=f.points.length-1;return f.controls=f.points.reduce(function(m,v,y){return m["p"+y]=new ii.Control({positionHandler:Y_,actionHandler:q_(y>0?y-1:g,X_),actionName:"modifyPolygon",pointIndex:y}),m},{}),f._setPositionDimensions({}),!0}}extendGet(l){if("vertices"===l){const u=[],f=this._fabricObject;if(f.selectable&&!f.group)for(let g in f.oCoords)u.push({x:f.oCoords[g].x,y:f.oCoords[g].y});else for(let g of f.points){const y=ii.util.transformPoint({x:g.x-f.pathOffset.x,y:g.y-f.pathOffset.y},f.calcTransformMatrix());u.push({x:y.x,y:y.y})}return u}}updateCoordinateBaseFromImageToView(){const l=this.get("vertices").map(u=>({x:this.convertPropFromViewToImage(u.x),y:this.convertPropFromViewToImage(u.y)}));this.set("vertices",l)}updateCoordinateBaseFromViewToImage(){const l=this.get("vertices").map(u=>({x:this.convertPropFromImageToView(u.x),y:this.convertPropFromImageToView(u.y)}));this.set("vertices",l)}setPosition(l){this.setPolygon(l)}getPosition(){return this.getPolygon()}updatePosition(){Z(this,th,"f")&&this.setPolygon(Z(this,th,"f"))}setPolygon(l){if(!ok(l))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else lt(this,th,JSON.parse(JSON.stringify(l)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Z(this,th,"f")?JSON.parse(JSON.stringify(Z(this,th,"f"))):null}}th=new WeakMap;const dk=p=>{let l=p.split("\n").map(f=>f.split("\t"));return(u=>{for(let f=0;;f++){let g=-1;for(let m=0;m<u.length;m++){let v=u[m][f];void 0!==v&&v.length>g&&(g=v.length)}if(-1===g)break;for(let m=0;m<u.length;m++){if(f>=u[m].length-1)continue;let v=" ".repeat(g+2-u[m][f].length);u[m][f]=u[m][f].concat(v)}}})(l),(u=>{let f="";for(let g=0;g<u.length;g++)f=f.concat(...u[g],g===u.length-1?"":"\n");return f})(l)};class wee extends Rr{constructor(l,u,f){if(super(null,f),nh.set(this,void 0),!V_(l))throw new TypeError("Invalid 'text'.");if(!ql(u))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ii.Textbox(dk(l),{left:u.x,top:u.y,width:u.width})),this._text=l,lt(this,nh,JSON.parse(JSON.stringify(u)),"f"),this._mediaType="text"}extendSet(l,u){if("text"===l)return this._text=u,this._fabricObject.set("text",dk(u)),!0}extendGet(l){if("text"===l)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(l){this.setTextRect(l)}getPosition(){return this.getTextRect()}updatePosition(){Z(this,nh,"f")&&this.setTextRect(Z(this,nh,"f"))}setText(l){if(!V_(l))throw new TypeError("Invalid 'text'.");this.set("text",l)}getText(){return this.get("text")}setTextRect(l){if(!ql(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width)}this._drawingLayer.renderAll()}else lt(this,nh,JSON.parse(JSON.stringify(l)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return Z(this,nh,"f")?JSON.parse(JSON.stringify(Z(this,nh,"f"))):null}}var rh,oh,pf,J_,gf,cm,mf,no,hm,dm,um,uk,fk,pk,gk,p1,ji,fm,pm,gm,rs,g1,m1,v1,ah,mm,vm,Q_,so,y1,mk,K_,eS,ym,x1;nh=new WeakMap;class Cee extends Z_{constructor(l,u){if(super({points:null==l?void 0:l.points},u),rh.set(this,void 0),!ak(l))throw new TypeError("Invalid 'quad'.");lt(this,rh,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="quad"}setPosition(l){this.setQuad(l)}getPosition(){return this.getQuad()}updatePosition(){Z(this,rh,"f")&&this.setQuad(Z(this,rh,"f"))}setPolygon(){}getPolygon(){return null}setQuad(l){if(!ak(l))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else lt(this,rh,JSON.parse(JSON.stringify(l)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return Z(this,rh,"f")?JSON.parse(JSON.stringify(Z(this,rh,"f"))):null}}rh=new WeakMap;class bee extends Rr{constructor(l){super(new ii.Group(l.map(u=>u._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(io.DIS_SELECTED);const u=this._fabricObject._objects;for(let f of u)setTimeout(()=>{f&&f.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(io.DIS_DEFAULT);const u=this._fabricObject._objects;for(let f of u)setTimeout(()=>{f&&f.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(l=>l.getDrawingItem())}setChildDrawingItems(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"add"):this._fabricObject.addWithUpdate(l._getFabricObject())}removeChildItem(l){l&&l.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"remove"):this._fabricObject.removeWithUpdate(l._getFabricObject()))}}class $e{static createDrawingStyle(l){if(!lk(l))throw new Error("Invalid style definition.");let u,f=$e.USER_START_STYLE_ID;for(;Z($e,oh,"f",pf).has(f);)f++;u=f;const g=JSON.parse(JSON.stringify(l));g.id=u;for(let m in Z($e,oh,"f",J_))g.hasOwnProperty(m)||(g[m]=Z($e,oh,"f",J_)[m]);return Z($e,oh,"f",pf).set(u,g),g.id}static _getDrawingStyle(l,u){if("number"!=typeof l)throw new Error("Invalid style id.");const f=Z($e,oh,"f",pf).get(l);return f?u?JSON.parse(JSON.stringify(f)):f:null}static getDrawingStyle(l){return this._getDrawingStyle(l,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(Z($e,oh,"f",pf).values())))}static _updateDrawingStyle(l,u){if(!lk(u))throw new Error("Invalid style definition.");const f=Z($e,oh,"f",pf).get(l);if(f)for(let g in u)f.hasOwnProperty(g)&&(f[g]=u[g])}static updateDrawingStyle(l,u){this._updateDrawingStyle(l,u)}}oh=$e,$e.STYLE_BLUE_STROKE=1,$e.STYLE_GREEN_STROKE=2,$e.STYLE_ORANGE_STROKE=3,$e.STYLE_YELLOW_STROKE=4,$e.STYLE_BLUE_STROKE_FILL=5,$e.STYLE_GREEN_STROKE_FILL=6,$e.STYLE_ORANGE_STROKE_FILL=7,$e.STYLE_YELLOW_STROKE_FILL=8,$e.STYLE_BLUE_STROKE_TRANSPARENT=9,$e.STYLE_GREEN_STROKE_TRANSPARENT=10,$e.STYLE_ORANGE_STROKE_TRANSPARENT=11,$e.USER_START_STYLE_ID=1024,pf={value:new Map([[$e.STYLE_BLUE_STROKE,{id:$e.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[$e.STYLE_GREEN_STROKE,{id:$e.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_ORANGE_STROKE,{id:$e.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_YELLOW_STROKE,{id:$e.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[$e.STYLE_BLUE_STROKE_FILL,{id:$e.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_GREEN_STROKE_FILL,{id:$e.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_ORANGE_STROKE_FILL,{id:$e.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_YELLOW_STROKE_FILL,{id:$e.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_BLUE_STROKE_TRANSPARENT,{id:$e.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_GREEN_STROKE_TRANSPARENT,{id:$e.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[$e.STYLE_ORANGE_STROKE_TRANSPARENT,{id:$e.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},J_={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(ii.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(ii.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ii.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},ii.Object.prototype.transparentCorners=!1,ii.Object.prototype.cornerSize=20,ii.Object.prototype.touchCornerSize=100,ii.Object.prototype.cornerColor="rgb(254,142,20)",ii.Object.prototype.cornerStyle="circle",ii.Object.prototype.strokeUniform=!0,ii.Object.prototype.hasBorders=!1,ii.Canvas.prototype.containerClass="",ii.Canvas.prototype.getPointer=function(p,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var u,f=this.upperCanvasEl,g=ii.util.getPointer(p,f),m=f.getBoundingClientRect(),v=m.width||0,y=m.height||0;v&&y||("top"in m&&"bottom"in m&&(y=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(v=Math.abs(m.right-m.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,l||(g=this.restorePointerVpt(g));var x=this.getRetinaScaling();if(1!==x&&(g.x/=x,g.y/=x),0!==v&&0!==y){var w=window.getComputedStyle(f).objectFit,C=f.width,_=f.height;u={width:C/v,height:_/y};var V=C/_,H=v/y;return"contain"===w?V>H?{x:g.x*u.width,y:(g.y-(y-v/V)/2)*u.width}:{x:(g.x-(v-y*V)/2)*u.height,y:g.y*u.height}:"cover"===w?V>H?{x:(C-u.height*v)/2+g.x*u.height,y:g.y*u.height}:{x:g.x*u.width,y:(_-u.width*y)/2+g.y*u.width}:{x:g.x*u.width,y:g.y*u.height}}return{x:g.x*(u={width:1,height:1}).width,y:g.y*u.height}},ii.Canvas.prototype._onTouchStart=function(p){var l=this.findTarget(p);!this.allowTouchScrolling&&p.cancelable&&p.preventDefault&&p.preventDefault(),l&&p.cancelable&&p.preventDefault&&p.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var u=this.upperCanvasEl,f=this._getEventPrefix();ii.util.addListener(ii.document,"touchend",this._onTouchEnd,{passive:!1}),ii.util.addListener(ii.document,"touchmove",this._onMouseMove,{passive:!1}),ii.util.removeListener(u,f+"down",this._onMouseDown)},ii.Textbox.prototype._wrapLine=function(p,l,u,f){const g=p.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var v=0,y=this.splitByGrapheme||!(!g||!g.length),x=[],w=[],C=y?ii.util.string.graphemeSplit(p):p.split(this._wordJoiners),_="",T=0,M=y?"":" ",L=0,N=0,V=0,H=!0,G=this._getWidthOfCharSpacing();f=f||0,0===C.length&&C.push([]),u-=f;for(var z=0;z<C.length;z++)_=y?C[z]:ii.util.string.graphemeSplit(C[z]),L=this._measureWord(_,l,T),T+=_.length,(v+=N+L-G)>u&&!H?(x.push(w),w=[],v=L,H=!0):v+=G,H||y||w.push(M),w=w.concat(_),N=y?0:this._measureWord([M],l,T),T++,H=!1,L>V&&(V=L);return z&&x.push(w),V+f>this.dynamicMinWidth&&(this.dynamicMinWidth=V-G+f),x});class dn{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(l){this.fabricCanvas.selection=l,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(l,u,f){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,l.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=l.getFabricCanvas();else{let v=this.fabricCanvas=new ii.Canvas(l,Object.assign(f,{allowTouchScrolling:!0,selection:!1}));v.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),v.lowerCanvasEl.className="",v.upperCanvasEl.className="",v.on("selection:created",function(y){const x=y.selected,w=[];for(let C of x){const _=C.getDrawingItem()._drawingLayer;_&&!w.includes(_)&&w.push(_)}for(let C of w){const _=[];for(let T of x){const M=T.getDrawingItem();M._drawingLayer===C&&_.push(M)}setTimeout(()=>{C.onSelectionChanged&&C.onSelectionChanged(_,[])},0)}}),v.on("before:selection:cleared",function(y){const x=this.getActiveObjects(),w=[];for(let C of x){const _=C.getDrawingItem()._drawingLayer;_&&!w.includes(_)&&w.push(_)}for(let C of w){const _=[];for(let T of x){const M=T.getDrawingItem();M._drawingLayer===C&&_.push(M)}setTimeout(()=>{const T=[];for(let M of _)C.hasDrawingItem(M)&&T.push(M);T.length>0&&C.onSelectionChanged&&C.onSelectionChanged([],T)},0)}}),v.on("selection:updated",function(y){const x=y.selected,w=y.deselected,C=[];for(let _ of x){const T=_.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let _ of w){const T=_.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let _ of C){const T=[],M=[];for(let L of x){const N=L.getDrawingItem();N._drawingLayer===_&&T.push(N)}for(let L of w){const N=L.getDrawingItem();N._drawingLayer===_&&M.push(N)}setTimeout(()=>{_.onSelectionChanged&&_.onSelectionChanged(T,M)},0)}}),v.wrapperEl.style.position="absolute",l.getFabricCanvas=()=>this.fabricCanvas}let g,m;switch(this.id=u,u){case dn.DDN_LAYER_ID:g=$e.getDrawingStyle($e.STYLE_BLUE_STROKE),m=$e.getDrawingStyle($e.STYLE_BLUE_STROKE_FILL);break;case dn.DBR_LAYER_ID:g=$e.getDrawingStyle($e.STYLE_ORANGE_STROKE),m=$e.getDrawingStyle($e.STYLE_ORANGE_STROKE_FILL);break;case dn.DLR_LAYER_ID:g=$e.getDrawingStyle($e.STYLE_GREEN_STROKE),m=$e.getDrawingStyle($e.STYLE_GREEN_STROKE_FILL);break;default:g=$e.getDrawingStyle($e.STYLE_YELLOW_STROKE),m=$e.getDrawingStyle($e.STYLE_YELLOW_STROKE_FILL)}for(let v of Rr.arrMediaTypes)this.mapType_StateAndStyleId.set(v,{default:g.id,selected:m.id})}getId(){return this.id}setVisible(l){if(l){for(let u of this._arrFabricObject)u.visible=!0,u.hasControls=!0;this._visible=!0}else{for(let u of this._arrFabricObject)u.visible=!1,u.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(l){return l.styleId?$e.getDrawingStyle(l.styleId):$e.getDrawingStyle(l._mapState_StyleId.get(l.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(l,u,f,g){const m=this.getDrawingItems(v=>v._mediaType===l);for(let v of m)v.styleSelector===u&&this._changeItemStyle(v,f,!0);g||this.fabricCanvas.renderAll()}_changeItemStyle(l,u,f){if(!l||!u)return;const g=l._getFabricObject();"number"==typeof l.styleId&&(u=$e.getDrawingStyle(l.styleId)),g.strokeWidth=u.lineWidth,"fill"===u.paintMode?(g.fill=u.fillStyle,g.stroke=u.fillStyle):"stroke"===u.paintMode?(g.fill="transparent",g.stroke=u.strokeStyle):"strokeAndFill"===u.paintMode&&(g.fill=u.fillStyle,g.stroke=u.strokeStyle),g.fontFamily&&(g.fontFamily=u.fontFamily),g.fontSize&&(g.fontSize=u.fontSize),g.group||(g.dirty=!0),f||this.fabricCanvas.renderAll()}_updateGroupItem(l,u,f){if(!l||!u)return;const g=l.getChildDrawingItems();if("add"===f){if(g.includes(u))return;const m=u._getFabricObject();if(this.fabricCanvas.getObjects().includes(m)){if(!this._arrFabricObject.includes(m))throw new Error("Existed in other drawing layers.");u._zIndex=null}else{let v;if(u.styleId)v=$e.getDrawingStyle(u.styleId);else{const y=this.mapType_StateAndStyleId.get(u._mediaType);v=$e.getDrawingStyle(y[l.styleSelector]);const x=()=>{this._changeItemStyle(u,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).selected),!0)},w=()=>{this._changeItemStyle(u,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).default),!0)};u._on("selected",x),u._on("deselected",w),u._funcChangeStyleToSelected=x,u._funcChangeStyleToDefault=w}u._drawingLayer=this,u._drawingLayerId=this.id,this._changeItemStyle(u,v,!0)}l._fabricObject.addWithUpdate(u._getFabricObject())}else{if("remove"!==f||!g.includes(u))return;u._zIndex=null,u._drawingLayer=null,u._drawingLayerId=null,u._off("selected",u._funcChangeStyleToSelected),u._off("deselected",u._funcChangeStyleToDefault),u._funcChangeStyleToSelected=null,u._funcChangeStyleToDefault=null,l._fabricObject.removeWithUpdate(u._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(l,u){if(!(l instanceof Rr))throw new TypeError("Invalid 'drawingItem'.");if(l._drawingLayer){if(l._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let f=l._getFabricObject();const g=this.fabricCanvas.getObjects();let m,v;if(g.includes(f)){if(this._arrFabricObject.includes(f))return;throw new Error("Existed in other drawing layers.")}if("group"===l._mediaType){m=l.getChildDrawingItems();for(let w of m)if(w._drawingLayer&&w._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(u&&"object"==typeof u&&!Array.isArray(u))for(let w in u)f.set(w,u[w]);if(m){for(let w of m){const C=this.mapType_StateAndStyleId.get(w._mediaType);for(let _ of Rr.arrStyleSelectors)w._mapState_StyleId.set(_,C[_]);if(w.styleId)v=$e.getDrawingStyle(w.styleId);else{v=$e.getDrawingStyle(C.default);const _=()=>{this._changeItemStyle(w,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(w._mediaType).selected),!0)},T=()=>{this._changeItemStyle(w,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(w._mediaType).default),!0)};w._on("selected",_),w._on("deselected",T),w._funcChangeStyleToSelected=_,w._funcChangeStyleToDefault=T}w._drawingLayer=this,w._drawingLayerId=this.id,this._changeItemStyle(w,v,!0)}f.dirty=!0,this.fabricCanvas.renderAll()}else{const w=this.mapType_StateAndStyleId.get(l._mediaType);for(let C of Rr.arrStyleSelectors)l._mapState_StyleId.set(C,w[C]);if(l.styleId)v=$e.getDrawingStyle(l.styleId);else{v=$e.getDrawingStyle(w.default);const C=()=>{this._changeItemStyle(l,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).selected))},_=()=>{this._changeItemStyle(l,$e.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).default))};l._on("selected",C),l._on("deselected",_),l._funcChangeStyleToSelected=C,l._funcChangeStyleToDefault=_}this._changeItemStyle(l,v)}l._zIndex=this.id,l._drawingLayer=this,l._drawingLayerId=this.id;const y=this._arrFabricObject.length;let x=g.length;if(y)x=g.indexOf(this._arrFabricObject[y-1])+1;else for(let w=0;w<g.length;w++)if(l._zIndex<g[w].getDrawingItem()._zIndex){x=w;break}this._arrDrwaingItem.push(l),this._arrFabricObject.push(f),f.visible=!!this._visible,this.fabricCanvas.insertAt(f,x,!1)}addDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)l._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");l._setEditable(!0)}this._addDrawingItem(l),l.updatePosition()}addDrawingItems(l){for(let u of l)this.addDrawingItem(u)}removeDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(l))return;if(l._zIndex=null,l._drawingLayer=null,l._drawingLayerId=null,"group"===l._mediaType){const f=l.getChildDrawingItems();for(let g of f)g._zIndex=null,g._drawingLayer=null,g._drawingLayerId=null,g._off("selected",g._funcChangeStyleToSelected),g._off("deselected",g._funcChangeStyleToDefault),g._funcChangeStyleToSelected=null,g._funcChangeStyleToDefault=null,g._mapState_StyleId.clear()}else l._off("selected",l._funcChangeStyleToSelected),l._off("deselected",l._funcChangeStyleToDefault),l._funcChangeStyleToSelected=null,l._funcChangeStyleToDefault=null,l._mapState_StyleId.clear();const u=l._getFabricObject();"selected"===l.styleSelector&&(u.group?u.group.removeWithUpdate(u):this.fabricCanvas._activeObject=null,l.setState(io.DIS_DEFAULT)),this.fabricCanvas.remove(u),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(l),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(u),1)}removeDrawingItems(l){for(let u of l)this.removeDrawingItem(u)}setDrawingItems(l){this.clearDrawingItems(),this.addDrawingItems(l)}getDrawingItems(l){return l&&"function"==typeof l?this._arrDrwaingItem.filter(l):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const l=this.fabricCanvas.getActiveObjects(),u=[];for(let f of l)this._arrFabricObject.includes(f)&&u.push(f.getDrawingItem());return u}hasDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(l)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(l,u,f){u?u.forEach(v=>v.toLowerCase()):u=Rr.arrMediaTypes,f?f.forEach(v=>v.toLowerCase()):f=Rr.arrStyleSelectors;const g=$e.getDrawingStyle(l);if(!g)throw new Error(`The 'drawingStyle' with id '${l}' doesn't exist.`);let m;for(let v of u)if(m=this.mapType_StateAndStyleId.get(v),m)for(let y of f){this._changeMediaTypeCurStyleInStyleSelector(v,y,g,!0),m[y]=l;for(let x of this._arrDrwaingItem)x._mediaType===v&&x._mapState_StyleId.set(y,l)}this.fabricCanvas.renderAll()}setDefaultStyle(l,u,f){const g=[];f&Rs.DIMT_RECTANGLE&&g.push("rect"),f&Rs.DIMT_QUADRILATERAL&&g.push("quad"),f&Rs.DIMT_TEXT&&g.push("text"),f&Rs.DIMT_ARC&&g.push("arc"),f&Rs.DIMT_IMAGE&&g.push("image"),f&Rs.DIMT_POLYGON&&g.push("polygon"),f&Rs.DIMT_LINE&&g.push("line");const m=[];u&io.DIS_DEFAULT&&m.push("default"),u&io.DIS_SELECTED&&m.push("selected"),this._setDefaultStyle(l,g.length?g:null,m.length?m:null)}setMode(l){if("viewer"===(l=l.toLowerCase())){for(let u of this._arrDrwaingItem)u._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==l)throw new RangeError("Invalid value.");for(let u of this._arrDrwaingItem)u._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(l,u){this.fabricCanvas.setDimensions(l,u)}_setObjectFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=l,this.fabricCanvas.upperCanvasEl.style.objectFit=l}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let l of this._arrDrwaingItem){const u=this._getItemCurrentStyle(l);this._changeItemStyle(l,u,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}dn.DDN_LAYER_ID=1,dn.DBR_LAYER_ID=2,dn.DLR_LAYER_ID=3,dn.USER_DEFINED_LAYER_BASE_ID=100,dn.TIP_LAYER_ID=999;class _ee{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(l,u){if(this.getDrawingLayer(u))throw new Error("Existed drawing layer id.");const f=new dn(l,u,{enableRetinaScaling:!1});return f._manager=this,this._arrDrawingLayer.push(f),this._switchPointerEvent(),f}deleteDrawingLayer(l){const u=this.getDrawingLayer(l);if(!u)return;const f=this._arrDrawingLayer;u.dispose(),f.splice(f.indexOf(u),1),this._switchPointerEvent()}clearDrawingLayers(){for(let l of this._arrDrawingLayer)l.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(l){for(let u of this._arrDrawingLayer)if(u.getId()===l)return u;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const l=this._getFabricCanvas().getActiveObjects(),u=[];for(let f of l)u.push(f.getDrawingItem());return u}setDimensions(l,u){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(l,u)}setObjectFit(l){for(let u of this._arrDrawingLayer)u&&u._setObjectFit(l)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(l){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=l?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let l of this._arrDrawingLayer)l.getMode()}}class See extends wee{constructor(l,u,f,g,m){super(l,{x:u,y:f,width:g,height:0},m),gf.set(this,void 0),cm.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var v=0,y=0,x=this._textLines.length;y<x;y++)v+=this.getHeightOfLine(y);return v+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(l){lt(this,gf,l,"f"),Z(this,cm,"f")&&clearTimeout(Z(this,cm,"f")),Z(this,gf,"f")>=0&&lt(this,cm,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},Z(this,gf,"f")),"f")}getDuration(){return Z(this,gf,"f")}}gf=new WeakMap,cm=new WeakMap,no=new WeakMap,hm=new WeakMap,dm=new WeakMap,um=new WeakMap,mf=new WeakSet,uk=function(p,l,u,f,g,m){const v=new See(p,l,u,f,m);return v.coordinateBase=g,v},fk=function(p,l){l.hasDrawingItem(p)||l.addDrawingItems([p])},pk=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},gk=function(){if(!this._tip)return;const p=Z(this,no,"f");this._tip.coordinateBase=p.coordinateBase,this._tip.setTextRect({x:p.topLeftPoint.x,y:p.topLeftPoint.y,width:p.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class tS extends HTMLElement{constructor(){super(),p1.set(this,void 0);const l=document.createElement("template").content,u=document.createElement("div");u.setAttribute("class","wrapper"),l.appendChild(u),lt(this,p1,u,"f");const f=document.createElement("slot");f.setAttribute("name","single-frame-input-container"),u.append(f);const g=document.createElement("slot");g.setAttribute("name","content"),u.append(g);const m=document.createElement("slot");m.setAttribute("name","drawing-layer"),u.append(m);const v=document.createElement("style");v.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',l.appendChild(v),this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}getWrapper(){return Z(this,p1,"f")}setElement(l,u){if(!(u instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");this.removeElement(l),u.setAttribute("slot",l),this.appendChild(u)}getElement(l){if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${l}"]`)}removeElement(l){var u;if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");null===(u=this.querySelectorAll(`[slot="${l}"]`))||void 0===u||u.forEach(f=>f.remove())}}p1=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",tS);class vf extends HTMLElement{constructor(){super();const l=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}showScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="")}hideScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="none")}getElement(l){return this.shadowRoot.querySelector(l)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class An extends class Eee{constructor(){mf.add(this),no.set(this,void 0),hm.set(this,void 0),dm.set(this,void 0),um.set(this,!0),this._drawingLayerManager=new _ee}createDrawingLayerBaseCvs(l,u,f="contain"){if("number"!=typeof l||l<=1)throw new Error("Invalid 'width'.");if("number"!=typeof u||u<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(f))throw new Error("Unsupported 'objectFit'.");const g=document.createElement("canvas");return g.width==l&&g.height==u||(g.width=l,g.height=u),g.style.objectFit=f,g}_createDrawingLayer(l,u,f,g){if(!this._layerBaseCvs){let y;try{y=this.getContentDimensions()}catch(x){if("Invalid content dimensions."!==(x.message||x))throw x}u||(u=(null==y?void 0:y.width)||1280),f||(f=(null==y?void 0:y.height)||720),g||(g=(null==y?void 0:y.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(u,f,g)}const m=this._layerBaseCvs,v=this._drawingLayerManager.createDrawingLayer(m,l);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",m.parentElement),v}createDrawingLayer(){let l;for(let u=dn.USER_DEFINED_LAYER_BASE_ID;;u++)if(!this._drawingLayerManager.getDrawingLayer(u)&&u!==dn.TIP_LAYER_ID){l=u;break}return this._createDrawingLayer(l)}deleteDrawingLayer(l){var u;this._drawingLayerManager.deleteDrawingLayer(l),this._drawingLayerManager.getAllDrawingLayers().length||(null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(l){if("number"!=typeof l)throw new TypeError("Invalid id.");if(l<dn.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${l} is not defined by users.`);this.deleteDrawingLayer(l)}_clearDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l)this.deleteDrawingLayer(u.getId())}clearUserDefinedDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l){const f=u.getId();f<dn.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(f)}}getDrawingLayer(l){return l==dn.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(l)||([dn.DDN_LAYER_ID,dn.DBR_LAYER_ID,dn.DLR_LAYER_ID].includes(l)?this._createDrawingLayer(l):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(l=>l.getId()>=0&&l.getId()!==dn.TIP_LAYER_ID)}updateDrawingLayers(l){((u,f,g)=>{if(!(u<=1||f<=1)){if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:u,height:f},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(g)}})(l.width,l.height,l.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(l){if(!(sk(u=l)&&yee(u.topLeftPoint)&&df(u.width))||u.width<=0||!df(u.duration)||"coordinateBase"in u&&!["view","image"].includes(u.coordinateBase))throw new Error("Invalid tip config.");var u;lt(this,no,JSON.parse(JSON.stringify(l)),"f"),Z(this,no,"f").coordinateBase||(Z(this,no,"f").coordinateBase="view"),lt(this,dm,l.duration,"f"),Z(this,mf,"m",gk).call(this)}getTipConfig(){return Z(this,no,"f")?Z(this,no,"f"):null}setTipVisible(l){if("boolean"!=typeof l)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",l),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),lt(this,um,l,"f")}isTipVisible(){return Z(this,um,"f")}updateTipMessage(l){if(!Z(this,no,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=$e.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(dn.TIP_LAYER_ID)||this._createDrawingLayer(dn.TIP_LAYER_ID)),this._tip?this._tip.set("text",l):this._tip=Z(this,mf,"m",uk).call(this,l,Z(this,no,"f").topLeftPoint.x,Z(this,no,"f").topLeftPoint.y,Z(this,no,"f").width,Z(this,no,"f").coordinateBase,this._tipStyleId),Z(this,mf,"m",fk).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",Z(this,um,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),Z(this,hm,"f")&&clearTimeout(Z(this,hm,"f")),Z(this,dm,"f")>=0&&lt(this,hm,setTimeout(()=>{Z(this,mf,"m",pk).call(this)},Z(this,dm,"f")),"f")}}{static get engineResourcePath(){return Gi.engineResourcePaths.dce}static set defaultUIElementURL(l){An._defaultUIElementURL=l}static get defaultUIElementURL(){var l;return null===(l=An._defaultUIElementURL)||void 0===l?void 0:l.replace("@engineResourcePath/",An.engineResourcePath)}static createInstance(l){return Q(function*(){customElements.get(An.uiComponentName)||customElements.define(An.uiComponentName,vf);const u=new An;return yield u.setUIElement(l||An.defaultUIElementURL),u})()}static _transformCoordinates(l,u,f,g,m,v,y){const w=y/m;l.x=Math.round(l.x/(v/g)+u),l.y=Math.round(l.y/w+f)}set _singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(l!==Z(this,mm,"f")){if(lt(this,mm,l,"f"),Z(this,ji,"m",so).call(this))lt(this,rs,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!Z(this,rs,"f")){const u=document.createElement("video");u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.objectFit=this.getVideoFit(),u.setAttribute("autoplay","true"),u.setAttribute("playsinline","true"),u.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Ps.OS)&&u.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),lt(this,rs,u,"f");const f=document.createElement("div");f.append(u),f.style.overflow="hidden",this._videoContainer=f,this._innerComponent.setElement("content",f)}Z(this,ji,"m",so).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return Z(this,mm,"f")}get disposed(){return Z(this,Q_,"f")}constructor(){var l;super(),l=this,ji.add(this),fm.set(this,void 0),pm.set(this,void 0),gm.set(this,void 0),this.containerClassName="dce-video-container",rs.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,g1.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,m1.set(this,!1),v1.set(this,!1),ah.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{Z(this,ji,"m",ym).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&Z(this,ji,"m",eS).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{An._onLog&&An._onLog("window resize event triggered."),Z(this,ah,"f").width===document.documentElement.clientWidth&&Z(this,ah,"f").height===document.documentElement.clientHeight||(Z(this,ah,"f").width=document.documentElement.clientWidth,Z(this,ah,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},mm.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!Z(this,ji,"m",so).call(this))return;let u;if(this._singleFrameInputContainer)u=this._singleFrameInputContainer.firstElementChild;else{u=document.createElement("input"),u.setAttribute("type","file"),"camera"===this._singleFrameMode?(u.setAttribute("capture",""),u.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(u.removeAttribute("capture"),u.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),u.addEventListener("change",Q(function*(){const g=u.files[0];u.value="";{const m=function(){var M=Q(function*(L){let N=null,V=null;if("undefined"!=typeof createImageBitmap)try{if(N=yield createImageBitmap(L),N)return N}catch(G){}var H;return N||(V=yield(H=L,new Promise((G,z)=>{let q=URL.createObjectURL(H),te=new Image;te.src=q,te.onload=()=>{URL.revokeObjectURL(te.src),G(te)},te.onerror=se=>{z(new Error("Can't convert blob to image : "+(se instanceof Event?se.type:se)))}}))),V});return function(N){return M.apply(this,arguments)}}(),v=(M,L,N,V)=>{M.width==N&&M.height==V||(M.width=N,M.height=V);const H=M.getContext("2d");H.clearRect(0,0,M.width,M.height),H.drawImage(L,0,0)},y=yield m(g),x=y instanceof HTMLImageElement?y.naturalWidth:y.width,w=y instanceof HTMLImageElement?y.naturalHeight:y.height;let C=l._cvsSingleFrameMode;const _=null==C?void 0:C.width,T=null==C?void 0:C.height;C||(C=document.createElement("canvas"),l._cvsSingleFrameMode=C),v(C,y,x,w),l._innerComponent.setElement("content",C),_===C.width&&T===C.height||l.eventHandler.fire("content:updated",null,{async:!1})}l._onSingleFrameAcquired&&setTimeout(()=>{l._onSingleFrameAcquired(l._cvsSingleFrameMode)},0)})),u.style.position="absolute",u.style.top="-9999px",u.style.backgroundColor="transparent",u.style.color="transparent";const f=document.createElement("div");f.append(u),this._innerComponent.setElement("single-frame-input-container",f),this._singleFrameInputContainer=f}null==u||u.click()},vm.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(u,f)=>{var g,m,v,y;if(this.disposed||(this.clearAllInnerDrawingItems(),!u))return;const x=u.originalImageTag;if(!x)return;const w=u.items;if(!(null==w?void 0:w.length))return;const C=(null===(g=x.cropRegion)||void 0===g?void 0:g.left)||0,_=(null===(m=x.cropRegion)||void 0===m?void 0:m.top)||0,T=(null===(v=x.cropRegion)||void 0===v?void 0:v.right)?x.cropRegion.right-C:x.originalWidth,M=(null===(y=x.cropRegion)||void 0===y?void 0:y.bottom)?x.cropRegion.bottom-_:x.originalHeight,L=x.currentWidth,N=x.currentHeight,V=(z,q,te,se,ae,j,le,ue,xe=[],I)=>{q.forEach(P=>An._transformCoordinates(P,te,se,ae,j,le,ue));const A=new Cee({points:[{x:q[0].x,y:q[0].y},{x:q[1].x,y:q[1].y},{x:q[2].x,y:q[2].y},{x:q[3].x,y:q[3].y}]},I);for(let P of xe)A.addNote(P);z.addDrawingItems([A]),Z(this,vm,"f").push(A)};let H,G;for(let z of w)switch(z.type){case en.CRIT_ORIGINAL_IMAGE:break;case en.CRIT_BARCODE:H=this.getDrawingLayer(dn.DBR_LAYER_ID),G=[{name:"format",content:z.formatString},{name:"text",content:z.text}],(null==f?void 0:f.isBarcodeVerifyOpen)?z.verified?V(H,z.location.points,C,_,T,M,L,N,G):V(H,z.location.points,C,_,T,M,L,N,G,$e.STYLE_ORANGE_STROKE_TRANSPARENT):V(H,z.location.points,C,_,T,M,L,N,G);break;case en.CRIT_TEXT_LINE:H=this.getDrawingLayer(dn.DLR_LAYER_ID),G=[{name:"text",content:z.text}],f.isLabelVerifyOpen?z.verified?V(H,z.location.points,C,_,T,M,L,N,G):V(H,z.location.points,C,_,T,M,L,N,G,$e.STYLE_GREEN_STROKE_TRANSPARENT):V(H,z.location.points,C,_,T,M,L,N,G);break;case en.CRIT_DETECTED_QUAD:H=this.getDrawingLayer(dn.DDN_LAYER_ID),(null==f?void 0:f.isDetectVerifyOpen)?z.verified?V(H,z.location.points,C,_,T,M,L,N,[]):V(H,z.location.points,C,_,T,M,L,N,[],$e.STYLE_BLUE_STROKE_TRANSPARENT):V(H,z.location.points,C,_,T,M,L,N,[]);break;case en.CRIT_NORMALIZED_IMAGE:H=this.getDrawingLayer(dn.DDN_LAYER_ID),(null==f?void 0:f.isNormalizeVerifyOpen)?z.verified?V(H,z.location.points,C,_,T,M,L,N,[]):V(H,z.location.points,C,_,T,M,L,N,[],$e.STYLE_BLUE_STROKE_TRANSPARENT):V(H,z.location.points,C,_,T,M,L,N,[]);break;case en.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},Q_.set(this,!1),this.eventHandler=new ck,this.eventHandler.on("content:updated",()=>{Z(this,fm,"f")&&clearTimeout(Z(this,fm,"f")),lt(this,fm,setTimeout(()=>{if(this.disposed)return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateDrawingLayers(u),this.updateConvertedRegion(u)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{Z(this,pm,"f")&&clearTimeout(Z(this,pm,"f")),lt(this,pm,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(l){l instanceof HTMLTemplateElement?(window._dce_default_template=l,this.UIElement=new vf):this.UIElement=l,this._unbindUI(),this._bindUI()}setUIElement(l){var u=this;return Q(function*(){let f;if(f="string"==typeof l?yield $_(l):l,f instanceof HTMLDivElement&&0==f.childElementCount){const g=yield $_(An.defaultUIElementURL);g instanceof HTMLTemplateElement?(window._dce_default_template=g,f.append(new vf)):f.append(g),u._setUIElement(f)}else u._setUIElement(f)})()}getUIElement(){return this.UIElement}_bindUI(){var l;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let u,f=this.UIElement;if(f instanceof vf?u=f.getElement(`.${this.containerClassName}`):f instanceof HTMLDivElement&&1===f.childElementCount&&f.firstElementChild instanceof vf?(u=f.firstElementChild.getElement(`.${this.containerClassName}`),f=f.firstElementChild):u=f.classList.contains(this.containerClassName)?f:f.querySelector(`.${this.containerClassName}`),!u)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new tS,u.appendChild(this._innerComponent),!Z(this,ji,"m",so).call(this)){const g=document.createElement("video");g.style.position="absolute",g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%",g.style.objectFit=this.getVideoFit(),g.setAttribute("autoplay","true"),g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Ps.OS)&&g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),lt(this,rs,g,"f");const m=document.createElement("div");m.append(g),m.style.overflow="hidden",this._videoContainer=m,this._innerComponent.setElement("content",m)}if(f instanceof vf?(this._selRsl=f.getElement(".dce-sel-resolution"),this._selMinLtr=f.getElement(".dlr-sel-minletter"),this._divScanArea=f.getElement(".dce-scanarea"),this._divScanLight=f.getElement(".dce-scanlight"),this._bgLoading=f.getElement(".dce-bg-loading"),this._bgCamera=f.getElement(".dce-bg-camera"),this._selCam=f.getElement(".dce-sel-camera"),this._optGotRsl=f.getElement(".dce-opt-gotResolution"),this._btnClose=f.getElement(".dce-btn-close"),this._optGotMinLtr=f.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=f.querySelector(".dce-sel-resolution"),this._selMinLtr=f.querySelector(".dlr-sel-minletter"),this._divScanArea=f.querySelector(".dce-scanarea"),this._divScanLight=f.querySelector(".dce-scanlight"),this._bgLoading=f.querySelector(".dce-bg-loading"),this._bgCamera=f.querySelector(".dce-bg-camera"),this._selCam=f.querySelector(".dce-sel-camera"),this._optGotRsl=f.querySelector(".dce-opt-gotResolution"),this._btnClose=f.querySelector(".dce-btn-close"),this._optGotMinLtr=f.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||Z(this,ji,"m",so).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||Z(this,ji,"m",so).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||Z(this,ji,"m",ym).call(this),Z(this,ji,"m",so).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),Z(this,ji,"m",so).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(m=>{var v;An._onLog&&An._onLog("resize observer triggered.");for(let y of m)y.target===(null===(v=this._innerComponent)||void 0===v?void 0:v.getWrapper())&&this._videoResizeListener()}));const g=null===(l=this._innerComponent)||void 0===l?void 0:l.getWrapper();g&&this._resizeObserver.observe(g)}Z(this,ah,"f").width=document.documentElement.clientWidth,Z(this,ah,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var l,u,f,g;Z(this,ji,"m",so).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),Z(this,ji,"m",ym).call(this),null===(l=this._drawingLayerManager)||void 0===l||l.clearDrawingLayers(),null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(f=this._innerComponent)||void 0===f||f.remove(),this._innerComponent=null,lt(this,rs,null,"f"),null===(g=this._videoContainer)||void 0===g||g.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(l,u){if(!this._selCam)return;let f;this._selCam.textContent="";for(let g of u){const m=document.createElement("option");m.value=g.deviceId,m.innerText=g.label,this._selCam.append(m),g.deviceId&&l&&l.deviceId==g.deviceId&&(f=m)}this._selCam.value=f?f.value:""}_renderResolutionInfo(l){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",l.width),this._optGotRsl.setAttribute("data-height",l.height),this._optGotRsl.innerText="got "+l.width+"x"+l.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return Z(this,rs,"f")}isVideoLoaded(){return!!Z(this,rs,"f")&&4==Z(this,rs,"f").readyState}setVideoFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);if(this.videoFit=l,!Z(this,rs,"f")||(Z(this,rs,"f").style.objectFit=l,Z(this,ji,"m",so).call(this)))return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}Z(this,ji,"m",x1).call(this,u,this.getConvertedRegion()),this.updateDrawingLayers(u)}getVideoFit(){return this.videoFit}getContentDimensions(){var l,u,f,g;let m,v,y;if(Z(this,ji,"m",so).call(this)?(m=null===(f=this._cvsSingleFrameMode)||void 0===f?void 0:f.width,v=null===(g=this._cvsSingleFrameMode)||void 0===g?void 0:g.height,y="contain"):(m=null===(l=Z(this,rs,"f"))||void 0===l?void 0:l.videoWidth,v=null===(u=Z(this,rs,"f"))||void 0===u?void 0:u.videoHeight,y=this.getVideoFit()),!m||!v)throw new Error("Invalid content dimensions.");return{width:m,height:v,objectFit:y}}updateConvertedRegion(l){const u=d1.convert(this.scanRegion,l.width,l.height);lt(this,g1,u,"f"),Z(this,gm,"f")&&clearTimeout(Z(this,gm,"f")),lt(this,gm,setTimeout(()=>{let f;try{f=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}Z(this,ji,"m",y1).call(this,f,u),Z(this,ji,"m",x1).call(this,f,u)},0),"f")}getConvertedRegion(){return Z(this,g1,"f")}setScanRegion(l){if(null!=l&&!G_(l)&&!ql(l))throw TypeError("Invalid 'region'.");let u;this.scanRegion=l?JSON.parse(JSON.stringify(l)):null;try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateConvertedRegion(u)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(l){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const u=Z(this,rs,"f").videoWidth,f=Z(this,rs,"f").videoHeight,g=this.getVideoFit(),{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let y;const x={x:0,y:0,width:u,height:f,isMeasuredInPercentage:!1};if("cover"===g&&(m/v<u/f?(y=v/f,x.x=Math.floor((u-m/y)/2),x.y=0,x.width=Math.ceil(m/y),x.height=f):(y=m/u,x.x=0,x.y=Math.floor((f-v/y)/2),x.width=u,x.height=Math.ceil(v/y))),null==l?void 0:l.inPixels)return x;const w=x;return w.x=Math.ceil(w.x/f*100),w.y=Math.ceil(w.y/u*100),w.width=Math.floor(w.width/u*100),w.height=Math.floor(w.height/f*100),w.isMeasuredInPercentage=!0,x}setScanRegionMask(l,u,f,g){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||Z(this,ji,"m",K_).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=$e.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=$e.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const m=this._drawingLayerOfMask.width,v=this._drawingLayerOfMask.height,y=new ff({x:0,y:0,width:m,height:v},this._maskBackRectStyleId),x=new ff({x:-m/2,y:-v/2+u,width:l,height:g}),w=new ff({x:-m/2+l+f,y:-v/2+u,width:m-l-f<0?0:m-l-f,height:g}),C=new ff({x:-m/2,y:-v/2,width:m,height:u}),_=new ff({x:-m/2,y:-v/2+u+g,width:m,height:v-u-g<0?0:v-u-g});x.set("strokeWidth",0),w.set("strokeWidth",0),C.set("strokeWidth",0),_.set("strokeWidth",0);const T=new bee([x,w,C,_])._getFabricObject();y.set("clipPath",T);const M=new ff({x:l,y:u,width:f,height:g},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([y,M])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(l){lt(this,m1,l,"f"),l?Z(this,ji,"m",mk).call(this):Z(this,ji,"m",K_).call(this)}setScanRegionMaskVisible(l){this._setScanRegionMaskVisible(l),this._userSetMaskVisible=l}isScanRegionMaskVisible(){return Z(this,m1,"f")}setScanRegionMaskStyle(l){if(!l)return;let u;l.fillStyle&&(this.regionMaskFillStyle=l.fillStyle),l.strokeStyle&&(this.regionMaskStrokeStyle=l.strokeStyle),l.lineWidth&&(this.regionMaskLineWidth=l.lineWidth),this._maskBackRectStyleId&&$e.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&$e.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{u=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}Z(this,ji,"m",y1).call(this,u,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(l){lt(this,v1,l,"f"),l?Z(this,ji,"m",eS).call(this):Z(this,ji,"m",ym).call(this)}setScanLaserVisible(l){this._setScanLaserVisible(l),this._userSetLaserVisible=l}isScanLaserVisible(){return Z(this,v1,"f")}_updateVideoContainer(){if(!Z(this,rs,"f")||Z(this,ji,"m",so).call(this))return;let l=1;const u=Z(this,rs,"f").style.transform.match(/scale\((.+)\)/);u&&(l=parseFloat(u[1]));const f=this._videoContainer;if("contain"===this.videoFit&&l>1){const g=Z(this,rs,"f").videoWidth,m=Z(this,rs,"f").videoHeight,{width:v,height:y}=this._innerComponent.getBoundingClientRect(),x=g/m;if(v/y<x){let w=v/x;f.style.left="0",f.style.top=(y-w)/2/y*100+"%",f.style.width="100%",f.style.height=w/y*100+"%"}else{let w=y*x;f.style.left=(v-w)/2/v*100+"%",f.style.top="0",f.style.width=w/v*100+"%",f.style.height="100%"}}else f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%"}updateLayers(){let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}const u=this.getConvertedRegion();Z(this,ji,"m",x1).call(this,l,u),this.updateDrawingLayers(l),Z(this,ji,"m",y1).call(this,l,u)}clearAllInnerDrawingItems(){Z(this,vm,"f").forEach(l=>l.remove()),Z(this,vm,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"disposed",{value:!0})}}function me(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function ui(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}fm=new WeakMap,pm=new WeakMap,gm=new WeakMap,rs=new WeakMap,g1=new WeakMap,m1=new WeakMap,v1=new WeakMap,ah=new WeakMap,mm=new WeakMap,vm=new WeakMap,Q_=new WeakMap,ji=new WeakSet,so=function(){return"disabled"!==this._singleFrameMode},y1=function(p,l){!l||0===l.x&&0===l.y&&l.width===p.width&&l.height===p.height?this.clearScanRegionMask():this.setScanRegionMask(l.x,l.y,l.width,l.height)},mk=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},K_=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},eS=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},ym=function(){this._divScanLight&&(this._divScanLight.style.display="none")},x1=function(p,l){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:u,height:f,objectFit:g}=p;l||(l={x:0,y:0,width:u,height:f});const{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)return;const y=m/v,x=u/f;let w,C,_,T,M=1;if("contain"===g)y<x?(M=m/u,w=0,C=(v-f*M)/2):(M=v/f,w=(m-u*M)/2,C=0),w+=l.x*M,C+=l.y*M,_=l.width*M,T=l.height*M;else if("cover"===g)if(y<x){M=v/f,w=l.x*M-(u*M-m)/2,w=Math.max(w,0),w=Math.min(w,m),C=l.y*M;let L=(l.x+l.width)*M-(u*M-m)/2;L=Math.max(L,0),L=Math.min(L,m),_=L-w,T=l.height*M}else{M=m/u,w=l.x*M,C=l.y*M-(f*M-v)/2,C=Math.max(C,0),C=Math.min(C,v);let L=(l.y+l.height)*M-(f*M-v)/2;L=Math.max(L,0),L=Math.min(L,v),_=l.width*M,T=L-C}else w=0,C=0,_=0,T=0;this._divScanArea.style.left=w+"px",this._divScanArea.style.top=C+"px",this._divScanArea.style.width=_+"px",this._divScanArea.style.height=T+"px"},An.uiComponentName="default-camera-view",An._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const vk="undefined"==typeof self;let xm,wm,w1,iS,Zs;function gr(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function ya(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"undefined"!=typeof navigator&&(xm=navigator,wm=xm.userAgent,w1=xm.platform,iS=xm.mediaDevices),function(){if(!vk){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:xm.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:w1,search:"Win"},Mac:{str:w1},Linux:{str:w1}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||wm,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||wm).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||wm).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=wm.indexOf("Windows NT")&&(g="HarmonyOS"),Zs={browser:u,version:f,OS:g}}vk&&(Zs={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let Jl=class{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const y=[l[v],l[v+3],l[v+6]].reduce((x,w,C)=>x+w*m[C],0);f.push(y)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return st.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return st.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return st.multiply(l,[u,0,0,0,f,0,0,0,1])}};var fi,Ql,Kl,C1,yf,Cm,bm,xf,b1,gd,_1,nS,dt,Yt,Si,S1,E1,zi,Uo,ec,wf,T1,nl,tc,ro,Cf,bf,_m,D1,_f,md,ic,nc,sS,os,rS,vd,yk,A1,I1,xk,xa,oS,aS,Sf,Sm,P1,oo,Ef,lS,cS,wk;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(fi||(fi={}));class Mt{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(ya(Mt,Ql,!1,"f",Kl),!1):(ya(Mt,Ql,!0,"f",Kl),!0)}get disposed(){return gr(this,b1,"f")}constructor(){C1.set(this,fi.RGBA),yf.set(this,null),Cm.set(this,null),bm.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,xf.set(this,null),b1.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==gr(Mt,Ql,"f",Kl)&&Mt.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!gr(Mt,Ql,"f",Kl))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let y;Mt._onLog&&(y=Date.now(),Mt._onLog("drawImage(), START: "+y));let x=0,w=0,C=f,_=g,T=0,M=0,L=f,N=g;m&&(m.sx&&(x=Math.round(m.sx)),m.sy&&(w=Math.round(m.sy)),m.sWidth&&(C=Math.round(m.sWidth)),m.sHeight&&(_=Math.round(m.sHeight)),m.dx&&(T=Math.round(m.dx)),m.dy&&(M=Math.round(m.dy)),m.dWidth&&(L=Math.round(m.dWidth)),m.dHeight&&(N=Math.round(m.dHeight)));let V,H=fi.RGBA;if((null==v?void 0:v.pixelFormat)&&(H=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(V=v.bufferContainer,V.length<4*L*N))throw new Error("Unexpected size of the 'bufferContainer'.");const G=l;if(!gr(Mt,Ql,"f",Kl)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){Mt._onLog&&Mt._onLog("drawImage() in context2d."),G.ctx2d||(G.ctx2d=G.getContext("2d",{willReadFrequently:!0}));const z=G.ctx2d;if(!z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N),z.drawImage(u,x,w,C,_,T,M,L,N),Mt._onLog&&Mt._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:fi.RGBA,bUseWebGL:!1}}Mt._onLog&&Mt._onLog("drawImage() in WebGL.");try{(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N,G.ctxWebGL&&G.ctxWebGL.viewport(0,0,T+L,M+N));const z=G.ctxWebGL||G.getContext("webgl",{antialias:!1})||G.getContext("experimental-webgl",{antialias:!1});if(!z){Mt._onLog&&Mt._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const j=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw j.name="WebGLError",j}if(!G.ctxWebGL||H!==gr(this,C1,"f")){G.ctxWebGL=z;const j=b=>{const D=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,D),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW);const k=b.createBuffer();return b.bindBuffer(b.ARRAY_BUFFER,k),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW),{positions:D,texCoords:k}},le=b=>{const D=b.createTexture();return b.bindTexture(b.TEXTURE_2D,D),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),D},ue=(b,D)=>{const k=b.createProgram();if(D.forEach(U=>b.attachShader(k,U)),b.linkProgram(k),!b.getProgramParameter(k,b.LINK_STATUS)){const U=new Error(`An error occured linking the program: ${b.getProgramInfoLog(k)}.`);throw U.name="WebGLError",U}return b.useProgram(k),k},xe=(b,D,k)=>{const U=b.createShader(D);if(b.shaderSource(U,k),b.compileShader(U),!b.getShaderParameter(U,b.COMPILE_STATUS)){const F=new Error(`An error occured compiling the shader: ${b.getShaderInfoLog(U)}.`);throw F.name="WebGLError",F}return U},I="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let A="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(A=H.slice(0,3));const P=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${A} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,O=ue(z,[xe(z,z.VERTEX_SHADER,I),xe(z,z.FRAGMENT_SHADER,P)]);ya(this,Cm,{program:O,attribLocations:{vertexPosition:z.getAttribLocation(O,"a_position"),texPosition:z.getAttribLocation(O,"a_texCoord")},uniformLocations:{uSampler:z.getUniformLocation(O,"u_image"),uColorFactor:z.getUniformLocation(O,"uColorFactor"),uMatrix:z.getUniformLocation(O,"u_matrix"),uTextureMatrix:z.getUniformLocation(O,"u_textureMatrix")}},"f"),ya(this,bm,j(z),"f"),ya(this,yf,le(z),"f"),ya(this,C1,H,"f")}const q=(j,le,ue)=>{j.bindBuffer(j.ARRAY_BUFFER,le),j.enableVertexAttribArray(ue),j.vertexAttribPointer(ue,2,j.FLOAT,!1,0,0)},se=(j,le,ue,xe)=>{j.clearColor(0,0,0,1),j.clearDepth(1),j.enable(j.DEPTH_TEST),j.depthFunc(j.LEQUAL),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT),q(j,ue.positions,le.attribLocations.vertexPosition),q(j,ue.texCoords,le.attribLocations.texPosition),j.activeTexture(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,xe),j.uniform1i(le.uniformLocations.uSampler,0),j.uniform1f(le.uniformLocations.uColorFactor,[fi.GREY,fi.GREY32].includes(H)?1:0);let I,A,P=Jl.translate(Jl.identity(),-1,-1);P=Jl.scale(P,2,2),P=Jl.scale(P,1/j.canvas.width,1/j.canvas.height),I=Jl.translate(P,T,M),I=Jl.scale(I,L,N),j.uniformMatrix3fv(le.uniformLocations.uMatrix,!1,I),A=Jl.translate(Jl.identity(),x/f,w/g),A=Jl.scale(A,C/f,_/g),j.uniformMatrix3fv(le.uniformLocations.uTextureMatrix,!1,A),j.drawArrays(j.TRIANGLES,0,6)};((j,le,ue)=>{const xe=j.RGBA,I=j.RGBA,A=j.UNSIGNED_BYTE;j.bindTexture(j.TEXTURE_2D,le),j.texImage2D(j.TEXTURE_2D,0,xe,I,A,ue)})(z,gr(this,yf,"f"),u),se(z,gr(this,Cm,"f"),gr(this,bm,"f"),gr(this,yf,"f"));const ae=V||new Uint8Array(4*L*N);if(z.readPixels(T,M,L,N,z.RGBA,z.UNSIGNED_BYTE,ae),255!==ae[3]){Mt._onLog&&Mt._onLog("Incorrect WebGL drawing .");const j=new Error("WebGL error: incorrect drawing.");throw j.name="WebGLError",j}return Mt._onLog&&Mt._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:H===fi.GREY?fi.GREY32:H,bUseWebGL:!0}}catch(z){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return Mt._onLog&&Mt._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw z.name="WebGLError",z}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,y=l.canvas.width,x=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(y=u.width),u.height&&(x=u.height)),(null==f?void 0:f.length)<4*y*x)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const w=l;f?(w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*y*x)):(g=new Uint8Array(4*y*x),w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let w;w=l.getImageData(m,v,y,x),g=new Uint8Array(w.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(Mt._onLog&&(m=Date.now(),Mt._onLog("transformPixelFormat(), START: "+m)),u===f)return Mt._onLog&&Mt._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const y=[fi.RGBA,fi.RBGA,fi.GRBA,fi.GBRA,fi.BRGA,fi.BGRA];if(y.includes(u))if(f===fi.GREY){v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=.21*l[x]+.71*l[x+1]+.07*l[x+2]}else if(f===fi.GREY32){v=g?new Uint8Array(l):l;for(let x=0;x<l.length;x+=4){const w=.21*l[x]+.71*l[x+1]+.07*l[x+2];v[x]=w,v[x+1]=w,v[x+2]=w}}else{if(!y.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4)v[L+_]=l[L+x],v[L+T]=l[L+w],v[L+M]=l[L+C]}else{v=l;const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4){let N=[l[L],l[L+1],l[L+2]];v[L+_]=N[x],v[L+T]=N[w],v[L+M]=N[C]}}}else if(u===fi.GREY){if(f!==fi.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let x=0;x<l.length;x++)v[4*x]=l[x],v[4*x+1]=l[x],v[4*x+2]=l[x],v[4*x+3]=255}else{if(u!==fi.GREY32)throw new Error("Unable to transform.");if(f!==fi.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=l[x]}return Mt._onLog&&Mt._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==gr(Mt,Ql,"f",Kl)&&Mt.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!gr(Mt,Ql,"f",Kl))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;Mt._onLog&&(v=Date.now(),Mt._onLog("getImageData(), START: "+v));const y=Math.round(g.sx),x=Math.round(g.sy),w=Math.round(g.sWidth),C=Math.round(g.sHeight),_=Math.round(g.dWidth),T=Math.round(g.dHeight);let M=fi.RGBA;(null==m?void 0:m.pixelFormat)&&(M=m.pixelFormat);let L,N,V,H=null;if((null==m?void 0:m.bufferContainer)&&(H=m.bufferContainer),gr(Mt,Ql,"f",Kl)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){Mt._onLog&&Mt._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),L=this._reusedWebGLCvs;try{if(H)if(M===fi.GREY){if(V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}}else N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:H}),V=new Uint8Array(H.buffer,0,4*_*T),V=this.transformPixelFormat(V,N.pixelFormat,M);else M===fi.GREY?((!gr(this,xf,"f")||gr(this,xf,"f").length<4*_*T)&&ya(this,xf,new Uint8Array(4*_*T),"f"),V=new Uint8Array(gr(this,xf,"f").buffer,0,4*_*T)):V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M)}catch(G){if("WebGLError"===G.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return Mt._onLog&&Mt._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},Object.assign({},m,{bUseWebGL:!1}));throw G}}else if(Mt._onLog&&Mt._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),L=this._reusedCvs,N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:fi.RGBA,bUseWebGL:!1}),V=this.readCvsData(N.context,{width:_,height:T},null),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}return Mt._onLog&&Mt._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:V,pixelFormat:M,width:_,height:T,bUseWebGL:N.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===fi.GREY){v=new Uint8ClampedArray(4*u*f);for(let x=0;x<v.length;x+=4)v[x]=l[x/4],v[x+1]=l[x/4],v[x+2]=l[x/4],v[x+3]=255}else v=new Uint8ClampedArray(l.buffer);const y=new ImageData(v,u,f);return m.getContext("2d").putImageData(y,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),ya(this,yf,null,"f"),ya(this,Cm,null,"f"),ya(this,bm,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),ya(this,b1,!0,"f")}}Ql=Mt,C1=new WeakMap,yf=new WeakMap,Cm=new WeakMap,bm=new WeakMap,xf=new WeakMap,b1=new WeakMap,Kl={value:void 0};class Tee{constructor(){gd.set(this,new Map),_1.set(this,!1)}get disposed(){return me(this,_1,"f")}on(l,u){l=l.toLowerCase();const f=me(this,gd,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else me(this,gd,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=me(this,gd,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=me(this,gd,"f").get(l);u&&(u.length=0)}fire(l,u=[],f={async:!1,copy:!0}){var g=this;return Q(function*(){u||(u=[]),l=l.toLowerCase();const m=me(g,gd,"f").get(l);if(m&&m.length){f=Object.assign({async:!1,copy:!0},f);for(let v of m){if(!v)continue;let y=[];if(f.copy)for(let w of u){try{w=JSON.parse(JSON.stringify(w))}catch(C){}y.push(w)}else y=u;let x=!1;if(f.async)setTimeout(()=>{g.disposed||v.apply(f.target,y)},0);else try{x=v.apply(f.target,y)}catch(w){}if(!0===x)break}}})()}dispose(){ui(this,_1,!0,"f")}}gd=new WeakMap,_1=new WeakMap;const Mr=(p,l,u,f)=>{if(!u)return p;let g=l+Math.round((p-l)/u)*u;return f&&(g=Math.min(g,f)),g};class Tt{static get version(){return"2.0.7"}static isStorageAvailable(l){let u;try{u=window[l];const f="__storage_test__";return u.setItem(f,f),u.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let f=!1;if((null==u?void 0:u.getMainCamera)&&(f=!0),f){const g=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>g.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const g=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],y=l.filter(C=>{const _=C.label.toLowerCase();return g.some(T=>_.includes(T))});if(!y.length)return null;const x=y.find(C=>{const _=C.label.toLowerCase();return m.some(T=>_.includes(T))});if(x)return x.deviceId;const w=y.find(C=>{const _=C.label.toLowerCase();return v.some(T=>_.includes(T))});return w?w.deviceId:y[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(Zs.OS))return Tt.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let g of l){const m=g.label.toLowerCase();if(m&&f.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return g.deviceId}return["Android","HarmonyOS"].includes(Zs.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,f){return l&&l.length?"environment"===u?this.findBestRearCamera(l,f):"user"===u?null:u?void 0:null:null}static playVideo(l,u,f){return Q(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return new Promise(function(){var g=Q(function*(m,v){let y;const x=()=>{l.removeEventListener("loadstart",T),l.removeEventListener("abort",M),l.removeEventListener("play",L),l.removeEventListener("error",N),l.removeEventListener("loadedmetadata",G)};let w=!1;const C=()=>{w=!0,y&&clearTimeout(y),x(),m(l)},_=z=>{y&&clearTimeout(y),x(),v(z)},T=()=>{l.addEventListener("abort",M,{once:!0})},M=()=>{const z=new Error("Video playing was interrupted.");z.name="AbortError",_(z)},L=()=>{C()},N=()=>{_(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};let V;const H=new Promise(z=>{V=z}),G=()=>{V()};if(l.addEventListener("loadstart",T,{once:!0}),l.addEventListener("play",L,{once:!0}),l.addEventListener("error",N,{once:!0}),l.addEventListener("loadedmetadata",G,{once:!0}),"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,l.autoplay&&(yield new Promise(z=>{setTimeout(z,1e3)})),!w){f&&(y=setTimeout(()=>{x(),v(new Error("Failed to play video. Timeout."))},f));try{l.src&&(yield l.load()),yield l.play(),C()}catch(z){console.warn("1st play error: "+((null==z?void 0:z.message)||z))}if(!w){yield H;try{yield l.play(),C()}catch(z){console.warn("2rd play error: "+((null==z?void 0:z.message)||z)),_(z)}}}});return function(m,v){return g.apply(this,arguments)}}())})()}static testCameraAccess(l){return Q(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==g||g.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!me(this,ro,"f"))return"closed";if("pending"===me(this,ro,"f"))return"opening";if("fulfilled"===me(this,ro,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l?Tt.isStorageAvailable("localStorage")?ui(this,wf,!0,"f"):(ui(this,wf,!1,"f"),console.warn("Local storage is unavailable")):ui(this,wf,!1,"f")}get ifSaveLastUsedCamera(){return me(this,wf,"f")}get isVideoPlaying(){return!(!me(this,Yt,"f")||me(this,Yt,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,f,g;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=me(this,md,"f"))||void 0===u||u.removeEventListener("click",me(this,_f,"f")),null===(f=me(this,md,"f"))||void 0===f||f.removeEventListener("touchend",me(this,_f,"f")),null===(g=me(this,md,"f"))||void 0===g||g.removeEventListener("touchmove",me(this,D1,"f")),ui(this,md,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Zs.OS)?(l.addEventListener("touchend",me(this,_f,"f")),l.addEventListener("touchmove",me(this,D1,"f"))):l.addEventListener("click",me(this,_f,"f")))}get tapFocusEventBoundEl(){return me(this,md,"f")}get disposed(){return me(this,I1,"f")}constructor(l){var f,g,u=this;dt.add(this),Yt.set(this,null),Si.set(this,void 0),S1.set(this,()=>{"opened"===this.state&&me(this,os,"f").fire("resumed",null,{target:this,async:!1})}),E1.set(this,()=>{me(this,os,"f").fire("paused",null,{target:this,async:!1})}),zi.set(this,void 0),Uo.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],ec.set(this,void 0),wf.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,T1.set(this,void 0),nl.set(this,!0),tc.set(this,void 0),ro.set(this,void 0),Cf.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},bf.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let y,x;const w=window.getComputedStyle(me(this,Yt,"f")).objectFit,C=this.getResolution(),_=me(this,Yt,"f").getBoundingClientRect(),T=_.left,M=_.top,{width:L,height:N}=me(this,Yt,"f").getBoundingClientRect();if(L<=0||N<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const V=L/N,H=C.width/C.height;let G=1;if("contain"===w)H>V?(G=L/C.width,y=(m-T)/G,x=(v-M-(N-L/H)/2)/G):(G=N/C.height,x=(v-M)/G,y=(m-T-(L-N*H)/2)/G);else{if("cover"!==w)throw new Error("Unsupported object-fit.");H>V?(G=N/C.height,x=(v-M)/G,y=(m-T+(N*H-L)/2)/G):(G=L/C.width,y=(m-T)/G,x=(v-M+(L/H-N)/2)/G)}return{x:y,y:x}},_m.set(this,!1),D1.set(this,()=>{ui(this,_m,!0,"f")}),_f.set(this,function(){var m=Q(function*(v){var y;if(me(u,_m,"f"))return void ui(u,_m,!1,"f");if(!(me(u,bf,"f")&&u.isVideoPlaying&&me(u,Si,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(y=u.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let x,w;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)x=v.clientX,w=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;x=v.changedTouches[0].clientX,w=v.changedTouches[0].clientY}const C=u.getResolution(),_=2*Math.round(Math.min(C.width,C.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let T;try{T=u.calculateCoordInVideo(x,w)}catch(H){}if(T.x<0||T.x>C.width||T.y<0||T.y>C.height)return;const M={x:T.x+"px",y:T.y+"px"},L=_+"px",N=L;let V;Tt._onLog&&(V=Date.now());try{yield me(u,dt,"m",lS).call(u,M,L,N,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(H){if(Tt._onLog)throw Tt._onLog(H),H}Tt._onLog&&Tt._onLog(`Tap focus costs: ${Date.now()-V} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var H;Tt._onLog&&Tt._onLog("Back to continuous focus."),null===(H=me(u,Si,"f"))||void 0===H||H.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),me(u,os,"f").fire("tapfocus",null,{target:u,async:!1})});return function(v){return m.apply(this,arguments)}}()),md.set(this,null),ic.set(this,1),nc.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!me(this,Yt,"f"))return;const m=me(this,ic,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)me(this,Yt,"f").style.transform="";else{const v=window.getComputedStyle(me(this,Yt,"f")).objectFit,y=me(this,Yt,"f").videoWidth,x=me(this,Yt,"f").videoHeight,{width:w,height:C}=me(this,Yt,"f").getBoundingClientRect();if(w<=0||C<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const _=w/C,T=y/x;let M=1;"contain"===v?M=_<T?w/(y/m):C/(x/m):"cover"===v&&(M=T>_?C/(y/m):w/(x/m));const L=M*(1-1/m)*(y/2-me(this,nc,"f").x),N=M*(1-1/m)*(x/2-me(this,nc,"f").y);me(this,Yt,"f").style.transform=`translate(${L}px, ${N}px) scale(${m})`}},sS.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===fi.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<v.length;x+=4)v[x]=this.data[x/4],v[x+1]=this.data[x/4],v[x+2]=this.data[x/4],v[x+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const y=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(y,0,0),m}),os.set(this,void 0),rS.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],vd.set(this,new Map),yk.set(this,!1),A1.set(this,Q(function*(){var m,v;if("visible"===document.visibilityState){if(Tt._onLog&&Tt._onLog("document visible. video paused: "+(null===(m=me(u,Yt,"f"))||void 0===m?void 0:m.paused)),"opening"==u.state||"opened"==u.state){let y=!1;if(!u.isVideoPlaying){Tt._onLog&&Tt._onLog("document visible. Not auto resume. 1st resume start.");try{yield u.resume(),y=!0}catch(x){Tt._onLog&&Tt._onLog("document visible. 1st resume video failed, try open instead.")}y||(yield me(u,dt,"m",Sf).call(u))}if(yield new Promise(x=>setTimeout(x,300)),!u.isVideoPlaying){Tt._onLog&&Tt._onLog("document visible. 1st open failed. 2rd resume start."),y=!1;try{yield u.resume(),y=!0}catch(x){Tt._onLog&&Tt._onLog("document visible. 2rd resume video failed, try open instead.")}y||(yield me(u,dt,"m",Sf).call(u))}}}else"hidden"===document.visibilityState&&(Tt._onLog&&Tt._onLog("document hidden. video paused: "+(null===(v=me(u,Yt,"f"))||void 0===v?void 0:v.paused)),"opening"==u.state||"opened"==u.state&&u.isVideoPlaying&&u.pause())})),I1.set(this,!1),(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia)||setTimeout(()=>{Tt.onWarning&&Tt.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),ui(this,os,new Tee,"f"),this.imageDataGetter=new Mt,document.addEventListener("visibilitychange",me(this,A1,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",me(this,S1,"f")),l.addEventListener("pause",me(this,E1,"f")),ui(this,Yt,l,"f")}getVideoEl(){return me(this,Yt,"f")}releaseVideoEl(){var l,u;null===(l=me(this,Yt,"f"))||void 0===l||l.removeEventListener("play",me(this,S1,"f")),null===(u=me(this,Yt,"f"))||void 0===u||u.removeEventListener("pause",me(this,E1,"f")),ui(this,Yt,null,"f")}isVideoLoaded(){return!!me(this,Yt,"f")&&4==me(this,Yt,"f").readyState}open(){var l=this;return Q(function*(){if(me(l,tc,"f")&&!me(l,nl,"f")){if("pending"===me(l,ro,"f"))return me(l,tc,"f");if("fulfilled"===me(l,ro,"f"))return}me(l,os,"f").fire("before:open",null,{target:l}),yield me(l,dt,"m",Sf).call(l),me(l,os,"f").fire("played",null,{target:l,async:!1}),me(l,os,"f").fire("opened",null,{target:l,async:!1})})()}close(){var l=this;return Q(function*(){if("closed"===l.state)return;me(l,os,"f").fire("before:close",null,{target:l});const u=me(l,tc,"f");if(me(l,dt,"m",P1).call(l),u&&"pending"===me(l,ro,"f")){try{yield u}catch(f){}if(!1===me(l,nl,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}ui(l,tc,null,"f"),ui(l,ro,null,"f"),me(l,os,"f").fire("closed",null,{target:l,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");me(this,Yt,"f").pause()}resume(){var l=this;return Q(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield me(l,Yt,"f").play()})()}setCamera(l){var u=this;return Q(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof me(u,zi,"f").video&&(me(u,zi,"f").video={}),delete me(u,zi,"f").video.facingMode,me(u,zi,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&me(u,nl,"f"))){me(u,os,"f").fire("before:camera:change",[],{target:u,async:!1}),yield me(u,dt,"m",Sm).call(u);try{u.resetSoftwareScale()}catch(f){}return me(u,Uo,"f")}})()}switchToFrontCamera(l){var u=this;return Q(function*(){if("object"!=typeof me(u,zi,"f").video&&(me(u,zi,"f").video={}),(null==l?void 0:l.resolution)&&(me(u,zi,"f").video.width={ideal:l.resolution.width},me(u,zi,"f").video.height={ideal:l.resolution.height}),delete me(u,zi,"f").video.deviceId,me(u,zi,"f").video.facingMode={exact:"user"},ui(u,ec,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&me(u,nl,"f"))){me(u,os,"f").fire("before:camera:change",[],{target:u,async:!1}),me(u,dt,"m",Sm).call(u);try{u.resetSoftwareScale()}catch(f){}return me(u,Uo,"f")}})()}getCamera(){var l;if(me(this,Uo,"f"))return me(this,Uo,"f");{let u=(null===(l=me(this,zi,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let f of this._arrCameras)if(f.deviceId===u)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return Q(function*(){var f,g;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let x=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(w=>"videoinput"===w.kind),x.getTracks().forEach(w=>{w.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(x=>"videoinput"===x.kind);const v=[],y=[];if(u._arrCameras)for(let x of u._arrCameras)x._checked&&y.push(x);for(let x=0;x<m.length;x++){let w,C=m[x];for(let _ of y)if(C.deviceId==_.deviceId){w=_;break}w||(w={deviceId:C.deviceId,label:C.label?C.label:"camera "+x,_checked:!1}),w.deviceId&&v.push(w)}return u._arrCameras=v,Tt._onLog&&Tt._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return Q(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const g=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!g||!g.length||g[0].deviceId))})()}getAllCameras(){var l=this;return Q(function*(){return l.getCameras()})()}setResolution(l,u,f){var g=this;return Q(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof me(g,zi,"f").video&&(me(g,zi,"f").video={}),f?(me(g,zi,"f").video.width={exact:l},me(g,zi,"f").video.height={exact:u}):(me(g,zi,"f").video.width={ideal:l},me(g,zi,"f").video.height={ideal:u}),"closed"===g.state||g.videoSrc||"opening"===g.state&&me(g,nl,"f"))return null;me(g,os,"f").fire("before:resolution:change",[],{target:g,async:!1}),yield me(g,dt,"m",Sm).call(g);try{g.resetSoftwareScale()}catch(v){}const m=g.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&me(this,Yt,"f"))return{width:me(this,Yt,"f").videoWidth,height:me(this,Yt,"f").videoHeight};if(me(this,Si,"f")){const l=me(this,Si,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:me(this,Yt,"f").videoWidth,height:me(this,Yt,"f").videoHeight};{const l={width:0,height:0};let u=me(this,zi,"f").video.width||0,f=me(this,zi,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),f&&(l.height=f.exact||f.ideal||f),l}}getResolutions(l){var u=this;return Q(function*(){var f,g,m,v,y,x,w,C,_,T,M;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let L="";const N=(V,H)=>{const G=me(u,vd,"f").get(V);if(!G||!G.length)return!1;for(let z of G)if(z.width===H.width&&z.height===H.height)return!0;return!1};if(u._mediaStream){L=null===(M=me(u,Uo,"f"))||void 0===M?void 0:M.deviceId;let V=me(u,vd,"f").get(L);if(V&&!l)return JSON.parse(JSON.stringify(V));V=[],me(u,vd,"f").set(L,V),ui(u,Cf,!0,"f");try{for(let H of u.detectedResolutions){yield me(u,Si,"f").applyConstraints({width:{ideal:H.width},height:{ideal:H.height}}),me(u,dt,"m",xa).call(u);const G=me(u,Si,"f").getSettings(),z={width:G.width,height:G.height};N(L,z)||V.push({width:z.width,height:z.height})}}catch(H){throw me(u,dt,"m",P1).call(u),ui(u,Cf,!1,"f"),H}try{yield me(u,dt,"m",Sf).call(u)}catch(H){if("AbortError"===H.name)return V;throw H}finally{ui(u,Cf,!1,"f")}return V}{const V=function(){var z=Q(function*(q,te,se){const ae={video:{deviceId:{exact:q},width:{ideal:te},height:{ideal:se}}};let j=null;try{j=yield navigator.mediaDevices.getUserMedia(ae)}catch(xe){return null}if(!j)return null;const le=j.getVideoTracks();let ue=null;try{const xe=le[0].getSettings();ue={width:xe.width,height:xe.height}}catch(xe){const I=document.createElement("video");I.srcObject=j,ue={width:I.videoWidth,height:I.videoHeight},I.srcObject=null}return le.forEach(xe=>{xe.stop()}),ue});return function(te,se,ae){return z.apply(this,arguments)}}();let H=(null===(y=null===(v=null===(m=me(u,zi,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===y?void 0:y.exact)||(null===(C=null===(w=null===(x=me(u,zi,"f"))||void 0===x?void 0:x.video)||void 0===w?void 0:w.deviceId)||void 0===C?void 0:C.ideal)||(null===(T=null===(_=me(u,zi,"f"))||void 0===_?void 0:_.video)||void 0===T?void 0:T.deviceId);if(!H)return[];let G=me(u,vd,"f").get(H);if(G&&!l)return JSON.parse(JSON.stringify(G));G=[],me(u,vd,"f").set(H,G);for(let z of u.detectedResolutions){const q=yield V(H,z.width,z.height);q&&!N(H,q)&&G.push({width:q.width,height:q.height})}return G}})()}setMediaStreamConstraints(l,u){var f=this;return Q(function*(){if(null===(g=l)||"[object Object]"!==Object.prototype.toString.call(g))throw new TypeError("Invalid 'mediaStreamConstraints'.");var g;ui(f,zi,JSON.parse(JSON.stringify(l)),"f"),ui(f,ec,null,"f"),u&&me(f,dt,"m",Sm).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(me(this,zi,"f")))}resetMediaStreamConstraints(){ui(this,zi,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!me(this,Si,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return me(this,Si,"f").getCapabilities?me(this,Si,"f").getCapabilities():{}}getCameraSettings(){if(!me(this,Si,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return me(this,Si,"f").getSettings()}turnOnTorch(){var l=this;return Q(function*(){if(!me(l,Si,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield me(l,Si,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return Q(function*(){if(!me(l,Si,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield me(l,Si,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!me(f,Si,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Mr(l,m.min,m.step,m.max)),yield me(f,Si,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!me(f,Si,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Mr(l,m.min,m.step,m.max)),yield me(f,Si,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!me(f,Si,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=f.getResolution();return yield me(f,Si,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var f=this;return Q(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!me(f,Si,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const g=f.getCameraCapabilities(),m=null==g?void 0:g.focusMode,v=null==g?void 0:g.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const y=l.mode.toLowerCase();if(!m.includes(y))throw Error("Unsupported focus mode.");if("manual"===y){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let x=l.distance;u&&(x<v.min?x=v.min:x>v.max&&(x=v.max),x=Mr(x,v.min,v.step,v.max)),f._focusParameters.focusArea=null,yield me(f,Si,"f").applyConstraints({advanced:[{focusMode:y,focusDistance:x}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const x=l.area.centerPoint;let w=l.area.width,C=l.area.height;if(!w||!C){const _=f.getResolution();w||(w=2*Math.round(Math.min(_.width,_.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),C||(C=2*Math.round(Math.min(_.width,_.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:x.x,y:x.y},width:w,height:C},yield me(f,dt,"m",lS).call(f,x,w,C)}}}else f._focusParameters.focusArea=null,yield me(f,Si,"f").applyConstraints({advanced:[{focusMode:y}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return Q(function*(){ui(l,bf,!0,"f")})()}disableTapToFocus(){ui(this,bf,!1,"f")}isTapToFocusEnabled(){return me(this,bf,"f")}setZoom(l){var u=this;return Q(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?me(u,dt,"m",cS).call(u,l.centerPoint):u.resetScaleCenter();try{if(me(u,dt,"m",wk).call(u,me(u,nc,"f"))){const f=yield u.setHardwareScale(l.factor,!0);let g=u.getHardwareScale();1==g&&1!=f&&(g=f),u.setSoftwareScale(l.factor>g?l.factor/g:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(f){const g=f.message||f;if("Not supported."!==g&&"Camera is not open."!==g)throw f;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*me(this,ic,"f")}}resetZoom(){var l=this;return Q(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!me(f,Si,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Mr(l,m.min,m.step,m.max)),yield me(f,Si,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&me(this,dt,"m",cS).call(this,u),ui(this,ic,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return me(this,ic,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();ui(this,nc,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||me(this,Cf,"f"))return null;const u=Date.now();Tt._onLog&&Tt._onLog("getFrameData() START: "+u);const f=me(this,Yt,"f").videoWidth,g=me(this,Yt,"f").videoHeight;let m={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=fi.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let y=me(this,ic,"f");(null==l?void 0:l.scale)&&(y=l.scale);let x=me(this,nc,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let T=0,M=0;if(l.scaleCenter.x.endsWith("px"))T=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");T=parseFloat(l.scaleCenter.x)/100*f}if(l.scaleCenter.y.endsWith("px"))M=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");M=parseFloat(l.scaleCenter.y)/100*g}if(isNaN(T)||isNaN(M))throw new Error("Invalid scale center.");x.x=Math.round(T),x.y=Math.round(M)}let w=null;if((null==l?void 0:l.bufferContainer)&&(w=l.bufferContainer),0==f||0==g)return null;1!==y&&(m.sWidth=Math.round(m.sWidth/y),m.sHeight=Math.round(m.sHeight/y),m.sx=Math.round((1-1/y)*x.x+m.sx/y),m.sy=Math.round((1-1/y)*x.y+m.sy/y));const C=this.imageDataGetter.getImageData(me(this,Yt,"f"),f,g,m,{pixelFormat:v,bufferContainer:w});if(!C)return null;const _=Date.now();return Tt._onLog&&Tt._onLog("getFrameData() END: "+_),{data:C.data,width:C.width,height:C.height,pixelFormat:C.pixelFormat,timeSpent:_-u,timeStamp:_,toCanvas:me(this,sS,"f")}}on(l,u){if(!me(this,rS,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);me(this,os,"f").on(l,u)}off(l,u){me(this,os,"f").off(l,u)}dispose(){var l=this;return Q(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),me(l,os,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",me(l,A1,"f")),ui(l,I1,!0,"f")})()}}var Em,R1,Tf,yd,M1,Df,Ck,bk,pi,hS,dS,ct,mt,Tm,sc,xd,k1,O1,L1,Dm,wd,F1,rc,ao,bn,pt,sl,uS,$i,_k,Sk,fS,pS;Yt=new WeakMap,Si=new WeakMap,S1=new WeakMap,E1=new WeakMap,zi=new WeakMap,Uo=new WeakMap,ec=new WeakMap,wf=new WeakMap,T1=new WeakMap,nl=new WeakMap,tc=new WeakMap,ro=new WeakMap,Cf=new WeakMap,bf=new WeakMap,_m=new WeakMap,D1=new WeakMap,_f=new WeakMap,md=new WeakMap,ic=new WeakMap,nc=new WeakMap,sS=new WeakMap,os=new WeakMap,rS=new WeakMap,vd=new WeakMap,yk=new WeakMap,A1=new WeakMap,I1=new WeakMap,dt=new WeakSet,xk=function(){var p=Q(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(me(this,ec,"f"))delete u.video.facingMode,u.video.deviceId={exact:me(this,ec,"f")};else if(this.ifSaveLastUsedCamera&&Tt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),g=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&g&&(u.video.width=f,u.video.height=g)}else if(!this.ifSkipCameraInspection){const f=function(){var v=Q(function*(y){let x=null;return"environment"===y&&["Android","HarmonyOS","iPhone","iPad"].includes(Zs.OS)?(yield l._getCameras(!1),me(l,dt,"m",xa).call(l),x=Tt.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):y||["Android","HarmonyOS","iPhone","iPad"].includes(Zs.OS)||(yield l._getCameras(!1),me(l,dt,"m",xa).call(l),x=Tt.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),x});return function(x){return v.apply(this,arguments)}}();let g=u.video.facingMode;g instanceof Array&&g.length&&(g=g[0]),"object"==typeof g&&(g=g.exact||g.ideal);const m=yield f(g);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return p.apply(this,arguments)}}(),xa=function(){if(me(this,nl,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},oS=function(){var p=Q(function*(l){var f,g,u=this;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{Tt._onLog&&Tt._onLog("======try getUserMedia========");let v=[0,500,1e3,2e3],y=null;const x=function(){var w=Q(function*(C){for(let _ of v){_&&(yield new Promise(T=>setTimeout(T,_)),me(u,dt,"m",xa).call(u));try{Tt._onLog&&Tt._onLog("ask "+JSON.stringify(C)),m=yield navigator.mediaDevices.getUserMedia(C),me(u,dt,"m",xa).call(u);break}catch(T){if("NotFoundError"===T.name||"NotAllowedError"===T.name||"AbortError"===T.name||"OverconstrainedError"===T.name)throw T;y=T,Tt._onLog&&Tt._onLog(T.message||T)}}});return function(_){return w.apply(this,arguments)}}();if(yield x(l),m||"object"!=typeof l.video||(l.video.deviceId&&(delete l.video.deviceId,yield x(l)),!m&&l.video.facingMode&&(delete l.video.facingMode,yield x(l)),m||!l.video.width&&!l.video.height||(delete l.video.width,delete l.video.height,yield x(l))),!m)throw y;return m}catch(v){throw null==m||m.getTracks().forEach(y=>{y.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return p.apply(this,arguments)}}(),aS=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),ui(this,Si,null,"f")},Sf=function(){var p=Q(function*(){var l=this;ui(this,nl,!1,"f");const u=ui(this,T1,Symbol(),"f");if(me(this,tc,"f")&&"pending"===me(this,ro,"f")){try{yield me(this,tc,"f")}catch(g){}me(this,dt,"m",xa).call(this)}return u!==me(this,T1,"f")?void 0:ui(this,tc,Q(function*(){ui(l,ro,"pending","f");try{if(l.videoSrc){if(!me(l,Yt,"f"))throw new Error("'videoEl' should be set.");yield Tt.playVideo(me(l,Yt,"f"),l.videoSrc,l.cameraOpenTimeout),me(l,dt,"m",xa).call(l)}else{let g=yield me(l,dt,"m",xk).call(l);me(l,dt,"m",aS).call(l);let m=yield me(l,dt,"m",oS).call(l,g);yield l._getCameras(!1),me(l,dt,"m",xa).call(l);const v=()=>{const C=m.getVideoTracks();let _,T;if(C.length&&(_=C[0]),_){const M=_.getSettings();if(M)for(let L of l._arrCameras)if(M.deviceId===L.deviceId){L._checked=!0,L.label=_.label,T=L;break}}return T},y=me(l,zi,"f");if("object"==typeof y.video){let C=y.video.facingMode;if(C instanceof Array&&C.length&&(C=C[0]),"object"==typeof C&&(C=C.exact||C.ideal),!(me(l,ec,"f")||l.ifSaveLastUsedCamera&&Tt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||y.video.deviceId)){const _=v(),T=Tt.findBestCamera(l._arrCameras,C,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});T&&T!=(null==_?void 0:_.deviceId)&&(m.getTracks().forEach(M=>{M.stop()}),g.video.deviceId={exact:T},m=yield me(l,dt,"m",oS).call(l,g),me(l,dt,"m",xa).call(l))}}const x=v();(null==x?void 0:x.deviceId)&&(ui(l,ec,x&&x.deviceId,"f"),l.ifSaveLastUsedCamera&&Tt.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",me(l,ec,"f")),"object"==typeof g.video&&g.video.width&&g.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(g.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(g.video.height))))),me(l,Yt,"f")&&(yield Tt.playVideo(me(l,Yt,"f"),m,l.cameraOpenTimeout),me(l,dt,"m",xa).call(l)),l._mediaStream=m;const w=m.getVideoTracks();(null==w?void 0:w.length)&&ui(l,Si,w[0],"f"),ui(l,Uo,x,"f")}}catch(g){throw me(l,dt,"m",P1).call(l),ui(l,ro,null,"f"),g}ui(l,ro,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),Sm=function(){var p=Q(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=me(this,Uo,"f"))||void 0===l?void 0:l.deviceId,f=this.getResolution();yield me(this,dt,"m",Sf).call(this);const g=this.getResolution();u&&u!==me(this,Uo,"f").deviceId&&me(this,os,"f").fire("camera:changed",[me(this,Uo,"f").deviceId,u],{target:this,async:!1}),f.width==g.width&&f.height==g.height||me(this,os,"f").fire("resolution:changed",[{width:g.width,height:g.height},{width:f.width,height:f.height}],{target:this,async:!1}),me(this,os,"f").fire("played",null,{target:this,async:!1})});return function(){return p.apply(this,arguments)}}(),P1=function(){me(this,dt,"m",aS).call(this),ui(this,Uo,null,"f"),me(this,Yt,"f")&&(me(this,Yt,"f").srcObject=null,this.videoSrc&&(me(this,Yt,"f").pause(),me(this,Yt,"f").currentTime=0)),ui(this,nl,!0,"f");try{this.resetSoftwareScale()}catch(p){}},oo=function(){var p=Q(function*(u,f){const g=V=>{if(!me(this,Si,"f")||!this.isVideoPlaying||V.focusTaskId!=this._focusParameters.curFocusTaskId){me(this,Si,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const H=new Error(`Focus task ${V.focusTaskId} canceled.`);throw H.name="DeprecatedTaskError",H}1===this._focusParameters.isDoingFocus&&Date.now()-V.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;f=Mr(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield me(this,Si,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),g(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(V=>{setTimeout(V,m)}),g(u);let v=u.focusL-u.focusW/2,y=u.focusT-u.focusH/2,x=u.focusW,w=u.focusH;const C=this.getResolution();if(v>=C.width||y>=C.height)throw new Error("Invalid area.");v+x>C.width&&(x=C.width-v),y+w>C.height&&(w=C.height-y),v=Math.round(v),y=Math.round(y),x=Math.round(x),w=Math.round(w);const _=4*C.width*C.height*this._focusParameters.defaultTempBufferContainerLenRatio,T=4*x*w;let M=this._focusParameters.tempBufferContainer;if(M){const V=M.length;_>V&&_>=T?M=new Uint8Array(_):T>V&&T>=_&&(M=new Uint8Array(T))}else M=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(_,T));if(!this.imageDataGetter.getImageData(me(this,Yt,"f"),C.width,C.height,{sx:v,sy:y,sWidth:x,sHeight:w,dWidth:x,dHeight:w},{pixelFormat:fi.RGBA,bufferContainer:M}))return me(this,dt,"m",l).call(this,u,f);const L=M;let N=0;for(let V=0,H=T-8;V<H;++V){let G=L[V]-L[V+8];++V;let z=L[V]-L[V+8];++V;let q=L[V]-L[V+8];++V,N+=G*G+z*z+q*q}return-N});function l(u,f){return p.apply(this,arguments)}return l}(),Ef=function(){var p=Q(function*(u,f,g,m,v,y,x){let w;if(f=Mr(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=Mr(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y?y=Mr(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(y=Mr(Math.sqrt((f||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),x=yield me(this,dt,"m",oo).call(this,u,y)),x<=g&&x<=v?w=3:g<v&&g<x?w=1:v<g&&v<x&&(w=2),(m-f)/2<=this._focusParameters.fds.step)return 3===w||(1===w?yield me(this,Si,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===w&&(yield me(this,Si,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===w)return yield me(this,dt,"m",l).call(this,u,f,g,y,x);if(2===w)return yield me(this,dt,"m",l).call(this,u,y,x,m,v);if(3!==w)return g=yield me(this,dt,"m",oo).call(this,u,f),v=yield me(this,dt,"m",oo).call(this,u,m),yield me(this,dt,"m",l).call(this,u,f,g,m,v);let C=Mr(Math.sqrt((f||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_=Mr(Math.sqrt((m||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/C)<=Math.abs(1/this._focusParameters.oldDistance-1/_)){let T=yield me(this,dt,"m",oo).call(this,u,C);if(T<x)return yield me(this,dt,"m",l).call(this,u,f,g,y,x,C,T);if(T==x)return yield me(this,dt,"m",l).call(this,u,C,T,y,x);let M=yield me(this,dt,"m",oo).call(this,u,_);if(T>x&&x<M)return yield me(this,dt,"m",l).call(this,u,C,T,_,M,y,x);if(x==M)return yield me(this,dt,"m",l).call(this,u,y,x,_,M);if(x>M)return yield me(this,dt,"m",l).call(this,u,y,x,m,v,_,M)}else{let T=yield me(this,dt,"m",oo).call(this,u,_);if(x>T)return yield me(this,dt,"m",l).call(this,u,y,x,m,v,_,T);if(x==T)return yield me(this,dt,"m",l).call(this,u,y,x,_,T);let M=yield me(this,dt,"m",oo).call(this,u,C);if(M>x&&x<T)return yield me(this,dt,"m",l).call(this,u,C,M,_,T,y,x);if(M==x)return yield me(this,dt,"m",l).call(this,u,C,M,y,x);if(M<x)return yield me(this,dt,"m",l).call(this,u,f,g,y,x,C,M)}return!1});function l(u,f,g,m,v,y,x){return p.apply(this,arguments)}return l}(),lS=function(){var p=Q(function*(l,u,f,g,m){var y,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const x=this.getResolution();let w=0,C=0;if(l.x.endsWith("px"))w=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");w=parseFloat(l.x)/100*x.width}if(l.y.endsWith("px"))C=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(l.y)/100*x.height}if(isNaN(w)||isNaN(C)||w<0||w>x.width||C<0||C>x.height)throw new Error("Invalid 'centerPoint'.");let _=0;if(u.endsWith("px"))_=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");_=parseFloat(u)/100*x.width}if(isNaN(_)||_<0)throw new Error("Invalid 'width'.");let T=0;if(f.endsWith("px"))T=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");T=parseFloat(f)/100*x.height}if(isNaN(T)||T<0)throw new Error("Invalid 'height'.");if(1!==me(this,ic,"f")){const N=me(this,ic,"f"),V=me(this,nc,"f");_/=N,T/=N,w=(1-1/N)*V.x+w/N,C=(1-1/N)*V.y+C/N}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(y=this.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const M={focusL:w,focusT:C,focusW:_,focusH:T,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},L=function(){var N=Q(function*(V,H,G){try{(null==H||H<v._focusParameters.fds.min)&&(H=v._focusParameters.fds.min),(null==G||G>v._focusParameters.fds.max)&&(G=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let z=Mr(Math.sqrt(G*(H||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),q=Mr(Math.sqrt((H||v._focusParameters.fds.step)*z),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),te=Mr(Math.sqrt(z*G),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),se=yield me(v,dt,"m",oo).call(v,V,te),ae=yield me(v,dt,"m",oo).call(v,V,q),j=yield me(v,dt,"m",oo).call(v,V,z);if(ae>j&&j<se){const le=yield me(v,dt,"m",Ef).call(v,V,q,ae,te,se,z,j);return v._focusParameters.isDoingFocus=0,le}if(ae<j&&ae<se){let le=yield me(v,dt,"m",oo).call(v,V,H);const ue=yield me(v,dt,"m",Ef).call(v,V,H,le,z,j,q,ae);return v._focusParameters.isDoingFocus=0,ue}if(j>se&&ae>se){let le=yield me(v,dt,"m",oo).call(v,V,G);const ue=yield me(v,dt,"m",Ef).call(v,V,z,j,G,le,te,se);return v._focusParameters.isDoingFocus=0,ue}if(ae==j&&j<se){const le=yield me(v,dt,"m",Ef).call(v,V,q,ae,z,j);return v._focusParameters.isDoingFocus=0,le}if(j==se&&ae>j){const le=yield me(v,dt,"m",Ef).call(v,V,z,j,te,se);return v._focusParameters.isDoingFocus=0,le}return L(V,H,G)}catch(z){if("DeprecatedTaskError"!==z.name)throw z}});return function(H,G,z){return N.apply(this,arguments)}}();return L(M,g,m)});return function(u,f,g,m,v){return p.apply(this,arguments)}}(),cS=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,f=0;if(p.x.endsWith("px"))u=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(p.x)/100*l.width}if(p.y.endsWith("px"))f=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(p.y)/100*l.height}if(isNaN(u)||isNaN(f))throw new Error("Invalid scale center.");ui(this,nc,{x:u,y:f},"f")},wk=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return p&&p.x==l.width/2&&p.y==l.height/2},Tt.browserInfo=Zs,Tt.onWarning=null===(nS=null==window?void 0:window.console)||void 0===nS?void 0:nS.warn;class oc{constructor(l){Em.add(this),R1.set(this,void 0),Tf.set(this,0),yd.set(this,void 0),M1.set(this,0),Df.set(this,!1),lt(this,R1,l,"f")}startCharging(){Z(this,Df,"f")||(oc._onLog&&oc._onLog("start charging."),Z(this,Em,"m",bk).call(this),lt(this,Df,!0,"f"))}stopCharging(){Z(this,yd,"f")&&clearTimeout(Z(this,yd,"f")),Z(this,Df,"f")&&(oc._onLog&&oc._onLog("stop charging."),lt(this,Tf,Date.now()-Z(this,M1,"f"),"f"),lt(this,Df,!1,"f"))}}R1=new WeakMap,Tf=new WeakMap,yd=new WeakMap,M1=new WeakMap,Df=new WeakMap,Em=new WeakSet,Ck=function(){Gi.cfd(1),oc._onLog&&oc._onLog("charge 1.")},bk=function p(){0==Z(this,Tf,"f")&&Z(this,Em,"m",Ck).call(this),lt(this,M1,Date.now(),"f"),Z(this,yd,"f")&&clearTimeout(Z(this,yd,"f")),lt(this,yd,setTimeout(()=>{lt(this,Tf,0,"f"),Z(this,Em,"m",p).call(this)},Z(this,R1,"f")-Z(this,Tf,"f")),"f")};const Ek=new Map([[wt.IPF_GRAYSCALED,fi.GREY],[wt.IPF_ABGR_8888,fi.RGBA],[wt.IPF_ARGB_8888,fi.BGRA]]),Tk=new Map([[fi.GREY,wt.IPF_GRAYSCALED],[fi.RGBA,wt.IPF_ABGR_8888],[fi.BGRA,wt.IPF_ARGB_8888]]),gS="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class jt extends Fo{static set _onLog(l){lt(jt,hS,l,"f",dS),Tt._onLog=l,oc._onLog=l}static get _onLog(){return Z(jt,hS,"f",dS)}static detectEnvironment(){return Q(function*(){return yield Q(function*(){return{wasm:pee,worker:gee,getUserMedia:ek,camera:yield mee(),browser:Ps.browser,version:Ps.version,OS:Ps.OS}})()})()}static testCameraAccess(){return Q(function*(){const l=yield Tt.testCameraAccess();return l.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===l.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===l.errorName||"NotFoundError"===l.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===l.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===l.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===l.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===l.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:l.errorMessage}})()}static createInstance(l){return Q(function*(){var u,f;if(l&&!(l instanceof An))throw new TypeError("Invalid view.");if(null===(u=Ki.license)||void 0===u?void 0:u.LicenseManager){if(!(null===(f=Ki.license)||void 0===f?void 0:f.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield Gi.loadWasm(["license"]),yield Ki.license.dynamsoft()}const g=new jt(l);return jt.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{jt.onWarning&&jt.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{jt.onWarning&&jt.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),g})()}get video(){return Z(this,ct,"f").getVideoEl()}set videoSrc(l){if(!Z(this,ct,"f"))throw new Error("Camera manager is null.");Z(this,mt,"f")&&(Z(this,mt,"f")._hideDefaultSelection=!0),Z(this,ct,"f").videoSrc=l}get videoSrc(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.videoSrc}set ifSaveLastUsedCamera(l){if(!Z(this,ct,"f"))throw new Error("Camera manager is null.");Z(this,ct,"f").ifSaveLastUsedCamera=l}get ifSaveLastUsedCamera(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.ifSaveLastUsedCamera}set ifSkipCameraInspection(l){if(!Z(this,ct,"f"))throw new Error("Camera manager is null.");Z(this,ct,"f").ifSkipCameraInspection=l}get ifSkipCameraInspection(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.ifSkipCameraInspection}set cameraOpenTimeout(l){if(!Z(this,ct,"f"))throw new Error("Camera manager is null.");Z(this,ct,"f").cameraOpenTimeout=l}get cameraOpenTimeout(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.cameraOpenTimeout}set singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");lt(this,k1,l,"f")}get singleFrameMode(){return Z(this,k1,"f")}get _isFetchingStarted(){return Z(this,rc,"f")}get disposed(){return Z(this,uS,"f")}constructor(l){var u;if(super(),u=this,pi.add(this),ct.set(this,void 0),mt.set(this,void 0),Tm.set(this,"closed"),sc.set(this,void 0),xd.set(this,!1),k1.set(this,void 0),this._onCameraSelChange=Q(function*(){u.isOpen()&&Z(u,mt,"f")&&!Z(u,mt,"f").disposed&&(yield u.selectCamera(Z(u,mt,"f")._selCam.value))}),this._onResolutionSelChange=Q(function*(){if(!u.isOpen()||!Z(u,mt,"f")||Z(u,mt,"f").disposed)return;let f,g;if(Z(u,mt,"f")._selRsl&&-1!=Z(u,mt,"f")._selRsl.selectedIndex){let m=Z(u,mt,"f")._selRsl.options[Z(u,mt,"f")._selRsl.selectedIndex];f=parseInt(m.getAttribute("data-width")),g=parseInt(m.getAttribute("data-height"))}yield u.setResolution({width:f,height:g})}),this._onCloseBtnClick=Q(function*(){u.isOpen()&&Z(u,mt,"f")&&!Z(u,mt,"f").disposed&&u.close()}),O1.set(this,(f,g,m,v)=>{const y=Date.now(),x={sx:v.x,sy:v.y,sWidth:v.width,sHeight:v.height,dWidth:v.width,dHeight:v.height},w=Math.max(x.dWidth,x.dHeight);if(this.canvasSizeLimit&&w>this.canvasSizeLimit){const T=this.canvasSizeLimit/w;x.dWidth>x.dHeight?(x.dWidth=this.canvasSizeLimit,x.dHeight=Math.round(x.dHeight*T)):(x.dWidth=Math.round(x.dWidth*T),x.dHeight=this.canvasSizeLimit)}const C=Z(this,ct,"f").imageDataGetter.getImageData(f,g,m,x,{pixelFormat:Ek.get(this.getPixelFormat())});let _=null;if(C){const T=Date.now();let M;M=C.pixelFormat===fi.GREY?C.width:4*C.width;let L=!0;0===x.sx&&0===x.sy&&x.sWidth===g&&x.sHeight===m&&(L=!1),_={bytes:C.data,width:C.width,height:C.height,stride:M,format:Tk.get(C.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:n1.ITT_FILE_IMAGE,isCropped:L,cropRegion:{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height,isMeasuredInPercentage:!1},originalWidth:g,originalHeight:m,currentWidth:C.width,currentHeight:C.height,timeSpent:T-y,timeStamp:T},toCanvas:Z(this,L1,"f"),isDCEFrame:!0}}return _}),this._onSingleFrameAcquired=f=>{let g;g=Z(this,mt,"f")?Z(this,mt,"f").getConvertedRegion():d1.convert(Z(this,wd,"f"),f.width,f.height),g||(g={x:0,y:0,width:f.width,height:f.height});const m=Z(this,O1,"f").call(this,f,f.width,f.height,g);Z(this,sc,"f").fire("singleFrameAcquired",[m],{async:!1,copy:!1})},L1.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const f=document.createElement("canvas");let g;if(f.width=this.width,f.height=this.height,this.format===wt.IPF_GRAYSCALED){g=new Uint8ClampedArray(this.width*this.height*4);for(let m=0;m<g.length;m+=4)g[m]=this.bytes[m/4],g[m+1]=this.bytes[m/4],g[m+2]=this.bytes[m/4],g[m+3]=255}else g=new Uint8ClampedArray(this.bytes.buffer);return f.getContext("2d").putImageData(new ImageData(g,this.width,this.height),0,0),f}),Dm.set(this,void 0),wd.set(this,void 0),F1.set(this,wt.IPF_ABGR_8888),rc.set(this,!1),this._imageId=-1,ao.set(this,void 0),this.fetchInterval=0,bn.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),pt.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),sl.set(this,void 0),uS.set(this,!1),this.isCameraEnhancer=!0,l&&!(l instanceof An))throw new TypeError("Invalid view.");lt(this,sc,new ck,"f"),lt(this,ct,new Tt,"f"),this._imageDataGetter=Z(this,ct,"f").imageDataGetter,Z(this,ct,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const f=Z(this,ct,"f").getSoftwareScale();if(f<1)throw new RangeError("Invalid scale value.");Z(this,mt,"f")&&!Z(this,mt,"f").disposed?(this.video.style.transform=1===f?"":`scale(${f})`,Z(this,mt,"f")._updateVideoContainer()):this.video.style.transform=1===f?"":`scale(${f})`},["iPhone","iPad","Android","HarmonyOS"].includes(Ps.OS)?Z(this,ct,"f").setResolution(1280,720):Z(this,ct,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",l&&this.setCameraView(l),this._on("before:camera:change",()=>{Z(this,sl,"f").stopCharging();const f=Z(this,mt,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const f=Z(this,mt,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),l.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{Z(this,sl,"f").stopCharging(),Z(this,mt,"f")}),this._on("resumed",()=>{Z(this,mt,"f")}),this._on("tapfocus",()=>{Z(this,bn,"f").tapToFocus&&Z(this,sl,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var f=Q(function*(g,m){var v,y,x,w;if(Z(u,pi,"m",$i).call(u)||!u.isOpen()||u.isPaused())return;const C=g.intermediateResultUnits;jt._onLog&&(jt._onLog("intermediateResultUnits:"),jt._onLog(C));let _=!1,T=!1;for(let M of C){if(M.unitType===cf.IRUT_DECODED_BARCODES&&M.decodedBarcodes.length){_=!0;break}M.unitType===cf.IRUT_LOCALIZED_BARCODES&&M.localizedBarcodes.length&&(T=!0)}if(jt._onLog&&(jt._onLog("hasLocalizedBarcodes:"),jt._onLog(T)),Z(u,bn,"f").autoZoom||Z(u,bn,"f").enhancedFocus)if(_)Z(u,pt,"f").autoZoomInFrameArray.length=0,Z(u,pt,"f").autoZoomOutFrameCount=0,Z(u,pt,"f").frameArrayInIdealZoom.length=0,Z(u,pt,"f").autoFocusFrameArray.length=0;else{const M=function(){var N=Q(function*(V){yield u.setZoom(V),Z(u,bn,"f").autoZoom&&Z(u,sl,"f").startCharging()});return function(H){return N.apply(this,arguments)}}(),L=function(){var N=Q(function*(V){yield u.setFocus(V),Z(u,bn,"f").enhancedFocus&&Z(u,sl,"f").startCharging()});return function(H){return N.apply(this,arguments)}}();if(T){const N=C[0].originalImageTag,V=(null===(v=N.cropRegion)||void 0===v?void 0:v.left)||0,H=(null===(y=N.cropRegion)||void 0===y?void 0:y.top)||0,G=(null===(x=N.cropRegion)||void 0===x?void 0:x.right)?N.cropRegion.right-V:N.originalWidth,z=(null===(w=N.cropRegion)||void 0===w?void 0:w.bottom)?N.cropRegion.bottom-H:N.originalHeight,q=N.currentWidth,te=N.currentHeight;let se;{let ae,j,le,ue,xe;{const P=u.video.videoWidth*(1-Z(u,pt,"f").autoZoomDetectionArea)/2,O=u.video.videoWidth*(1+Z(u,pt,"f").autoZoomDetectionArea)/2,b=O,D=P,k=u.video.videoHeight*(1-Z(u,pt,"f").autoZoomDetectionArea)/2,U=k,F=u.video.videoHeight*(1+Z(u,pt,"f").autoZoomDetectionArea)/2;xe=[{x:P,y:k},{x:O,y:U},{x:b,y:F},{x:D,y:F}]}jt._onLog&&(jt._onLog("detectionArea:"),jt._onLog(xe));const I=[];{const P=(O,b)=>{const D=(U,F)=>{if(!U&&!F)throw new Error("Invalid arguments.");return function(B,W,$){let Y=!1;const J=B.length;if(J<=2)return!1;for(let X=0;X<J;X++){const ie=B[X],oe=B[(X+1)%J];if(xee(ie,oe,{x:W,y:$}))return!0;z_(ie.y-$)>0!=z_(oe.y-$)>0&&z_(W-($-ie.y)*(ie.x-oe.x)/(ie.y-oe.y)-ie.x)<0&&(Y=!Y)}return Y}(F,U.x,U.y)},k=(U,F)=>!!(f1([U[0],U[1]],[U[2],U[3]],[F[0].x,F[0].y],[F[1].x,F[1].y])||f1([U[0],U[1]],[U[2],U[3]],[F[1].x,F[1].y],[F[2].x,F[2].y])||f1([U[0],U[1]],[U[2],U[3]],[F[2].x,F[2].y],[F[3].x,F[3].y])||f1([U[0],U[1]],[U[2],U[3]],[F[3].x,F[3].y],[F[0].x,F[0].y]));return!!(D({x:O[0].x,y:O[0].y},b)||D({x:O[1].x,y:O[1].y},b)||D({x:O[2].x,y:O[2].y},b)||D({x:O[3].x,y:O[3].y},b))||!!(D({x:b[0].x,y:b[0].y},O)||D({x:b[1].x,y:b[1].y},O)||D({x:b[2].x,y:b[2].y},O)||D({x:b[3].x,y:b[3].y},O))||!!(k([b[0].x,b[0].y,b[1].x,b[1].y],O)||k([b[1].x,b[1].y,b[2].x,b[2].y],O)||k([b[2].x,b[2].y,b[3].x,b[3].y],O)||k([b[3].x,b[3].y,b[0].x,b[0].y],O))};for(let O of C)if(O.unitType===cf.IRUT_LOCALIZED_BARCODES)for(let b of O.localizedBarcodes){if(!b)continue;const D=b.location.points;D.forEach(k=>{An._transformCoordinates(k,V,H,G,z,q,te)}),P(xe,D)&&I.push(b)}if(jt._debug&&Z(u,mt,"f")){const O=u.__layer||(u.__layer=Z(u,mt,"f")._createDrawingLayer(99));O.clearDrawingItems();const b=u.__styleId2||(u.__styleId2=$e.createDrawingStyle({strokeStyle:"red"}));for(let D of C)if(D.unitType===cf.IRUT_LOCALIZED_BARCODES)for(let k of D.localizedBarcodes){if(!k)continue;const F=new Z_({points:k.location.points},b);O.addDrawingItems([F])}}}if(jt._onLog&&(jt._onLog("intersectedResults:"),jt._onLog(I)),!I.length)return;let A;if(I.length){let P=I.filter(O=>O.possibleFormats==gS.BF_QR_CODE||O.possibleFormats==gS.BF_DATAMATRIX);if(P.length||(P=I.filter(O=>O.possibleFormats==gS.BF_ONED),P.length||(P=I)),P.length){const O=D=>{const k=D.location.points,U=(k[0].x+k[1].x+k[2].x+k[3].x)/4,F=(k[0].y+k[1].y+k[2].y+k[3].y)/4;return(U-q/2)*(U-q/2)+(F-te/2)*(F-te/2)};A=P[0];let b=O(A);if(1!=P.length)for(let D=1;D<P.length;D++){const k=O(P[D]);(P[D].confidence>1.1*A.confidence||P[D].confidence>.9*A.confidence&&k<b)&&(A=P[D],b=k)}}}if(jt._onLog&&(jt._onLog("highPriorityResult:"),jt._onLog(A)),A){const P=A.location.points;ae=Math.min(P[0].x,P[1].x,P[2].x,P[3].x),j=Math.max(P[0].x,P[1].x,P[2].x,P[3].x),le=Math.min(P[0].y,P[1].y,P[2].y,P[3].y),ue=Math.max(P[0].y,P[1].y,P[2].y,P[3].y),se={points:[{x:ae,y:le},{x:j,y:le},{x:j,y:ue},{x:ae,y:ue}],result:A}}}if(jt._onLog&&(jt._onLog("boundingRect:"),jt._onLog(se)),!se)return;if(jt._debug&&Z(u,mt,"f")&&(null==se?void 0:se.points)){const ae=u.__layer||(u.__layer=Z(u,mt,"f")._createDrawingLayer(99)),j=u.__styleId1||(u.__styleId1=$e.createDrawingStyle({strokeStyle:"blue"})),le=new Z_({points:se.points},j);ae.addDrawingItems([le])}if(Z(u,pt,"f").autoZoomOutFrameCount=0,Z(u,bn,"f").autoZoom){const ae=Z(u,pt,"f").autoZoomIdealArea[1];let j=(1-Z(u,pt,"f").autoZoomTargetBorder)/2;const le=se.points[0].x/G,ue=(G-se.points[2].x)/G,xe=se.points[0].y/z,I=(z-se.points[2].y)/z;if(le>ae&&ue>ae&&xe>ae&&I>ae&&se.result.moduleSize<Z(u,pt,"f").autoZoomInIdealModuleSize){if(Z(u,pt,"f").autoZoomInFrameArray.push(!0),Z(u,pt,"f").autoZoomInFrameArray.splice(0,Z(u,pt,"f").autoZoomInFrameArray.length-Z(u,pt,"f").autoZoomInFrameLimit[0]),Z(u,pt,"f").frameArrayInIdealZoom.length=0,Z(u,bn,"f").enhancedFocus&&L({mode:"continuous"}).catch(()=>{}),Z(u,pt,"f").autoZoomInFrameArray.filter(A=>!0===A).length>=Z(u,pt,"f").autoZoomInFrameLimit[1]){Z(u,pt,"f").autoZoomInFrameArray.length=0;const A=[(.5-j)/(.5-le),(.5-j)/(.5-ue),(.5-j)/(.5-xe),(.5-j)/(.5-I)].filter(k=>k>0),P=Math.min(...A,Z(u,pt,"f").autoZoomInIdealModuleSize/se.result.moduleSize),O=u.getZoomSettings().factor;let b=Math.max(Math.pow(O*P,1/Z(u,pt,"f").autoZoomInMaxTimes),Z(u,pt,"f").autoZoomInMinStep);b=Math.min(b,P);let D=O*b;D=Math.max(Z(u,pt,"f").minValue,D),D=Math.min(Z(u,pt,"f").maxValue,D);try{yield M({factor:D})}catch(k){console.warn(k.message||k)}u.clearBuffer()}}else if(Z(u,pt,"f").autoZoomInFrameArray.length=0,Z(u,pt,"f").frameArrayInIdealZoom.push(!0),Z(u,pt,"f").frameArrayInIdealZoom.splice(0,Z(u,pt,"f").frameArrayInIdealZoom.length-Z(u,pt,"f").frameLimitInIdealZoom[0]),Z(u,pt,"f").frameArrayInIdealZoom.filter(A=>!0===A).length>=Z(u,pt,"f").frameLimitInIdealZoom[1]&&(Z(u,pt,"f").frameArrayInIdealZoom.length=0,Z(u,bn,"f").enhancedFocus)){const A=se.points;try{yield L({mode:"manual",area:{centerPoint:{x:(A[0].x+A[2].x)/2+"px",y:(A[0].y+A[2].y)/2+"px"},width:A[2].x-A[0].x+"px",height:A[2].y-A[0].y+"px"}})}catch(P){console.warn(P.message||P)}u.clearBuffer()}}if(!Z(u,bn,"f").autoZoom&&Z(u,bn,"f").enhancedFocus&&(Z(u,pt,"f").autoFocusFrameArray.push(!0),Z(u,pt,"f").autoFocusFrameArray.splice(0,Z(u,pt,"f").autoFocusFrameArray.length-Z(u,pt,"f").autoFocusFrameLimit[0]),Z(u,pt,"f").autoFocusFrameArray.filter(ae=>!0===ae).length>=Z(u,pt,"f").autoFocusFrameLimit[1])){Z(u,pt,"f").autoFocusFrameArray.length=0;try{const ae=se.points;yield L({mode:"manual",area:{centerPoint:{x:(ae[0].x+ae[2].x)/2+"px",y:(ae[0].y+ae[2].y)/2+"px"},width:ae[2].x-ae[0].x+"px",height:ae[2].y-ae[0].y+"px"}})}catch(ae){console.warn(ae.message||ae)}u.clearBuffer()}}else{if(Z(u,bn,"f").autoZoom){if(Z(u,pt,"f").autoZoomInFrameArray.push(!1),Z(u,pt,"f").autoZoomInFrameArray.splice(0,Z(u,pt,"f").autoZoomInFrameArray.length-Z(u,pt,"f").autoZoomInFrameLimit[0]),Z(u,pt,"f").autoZoomOutFrameCount++,Z(u,pt,"f").frameArrayInIdealZoom.push(!1),Z(u,pt,"f").frameArrayInIdealZoom.splice(0,Z(u,pt,"f").frameArrayInIdealZoom.length-Z(u,pt,"f").frameLimitInIdealZoom[0]),Z(u,pt,"f").autoZoomOutFrameCount>=Z(u,pt,"f").autoZoomOutFrameLimit){Z(u,pt,"f").autoZoomOutFrameCount=0;const N=u.getZoomSettings().factor;let V=N-Math.max((N-1)*Z(u,pt,"f").autoZoomOutStepRate,Z(u,pt,"f").autoZoomOutMinStep);V=Math.max(Z(u,pt,"f").minValue,V),V=Math.min(Z(u,pt,"f").maxValue,V);try{yield M({factor:V})}catch(H){console.warn(H.message||H)}u.clearBuffer()}Z(u,bn,"f").enhancedFocus&&L({mode:"continuous"}).catch(()=>{})}!Z(u,bn,"f").autoZoom&&Z(u,bn,"f").enhancedFocus&&(Z(u,pt,"f").autoFocusFrameArray.length=0,L({mode:"continuous"}).catch(()=>{}))}}});return function(g,m){return f.apply(this,arguments)}}(),lt(this,sl,new oc(1e4),"f")}setCameraView(l){if(!(l instanceof An))throw new TypeError("Invalid view.");if(l.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),l._singleFrameMode=this.singleFrameMode,l._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(Z(this,mt,"f")._hideDefaultSelection=!0),Z(this,pi,"m",$i).call(this)||Z(this,ct,"f").setVideoEl(l.getVideoElement()),lt(this,mt,l,"f"),this.addListenerToView()}getCameraView(){return Z(this,mt,"f")}releaseCameraView(){Z(this,mt,"f")&&(this.removeListenerFromView(),Z(this,mt,"f").disposed||(Z(this,mt,"f")._singleFrameMode="disabled",Z(this,mt,"f")._onSingleFrameAcquired=null,Z(this,mt,"f")._hideDefaultSelection=!1),Z(this,ct,"f").releaseVideoEl(),lt(this,mt,null,"f"))}addListenerToView(){if(!Z(this,mt,"f"))return;if(Z(this,mt,"f").disposed)throw new Error("'cameraView' has been disposed.");const l=Z(this,mt,"f");Z(this,pi,"m",$i).call(this)||this.videoSrc||(l._innerComponent&&(Z(this,ct,"f").tapFocusEventBoundEl=l._innerComponent),l._selCam&&l._selCam.addEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.addEventListener("change",this._onResolutionSelChange)),l._btnClose&&l._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!Z(this,mt,"f")||Z(this,mt,"f").disposed)return;const l=Z(this,mt,"f");Z(this,ct,"f").tapFocusEventBoundEl=null,l._selCam&&l._selCam.removeEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.removeEventListener("change",this._onResolutionSelChange),l._btnClose&&l._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return Z(this,pi,"m",$i).call(this)?Z(this,Tm,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(Z(this,ct,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var l=this;return Q(function*(){const u=Z(l,mt,"f");if(null==u?void 0:u.disposed)throw new Error("'cameraView' has been disposed.");u&&(u._singleFrameMode=l.singleFrameMode,Z(l,pi,"m",$i).call(l)?u._clickIptSingleFrameMode():(Z(l,ct,"f").setVideoEl(u.getVideoElement()),u._startLoading()));let f={width:0,height:0,deviceId:""};if(!Z(l,pi,"m",$i).call(l)){try{yield Z(l,ct,"f").open()}catch(m){throw u&&u._stopLoading(),m}Z(l,xd,"f")&&l.turnOnTorch().catch(()=>{});const g=l.getResolution();f.width=g.width,f.height=g.height,f.deviceId=l.getSelectedCamera().deviceId}return lt(l,Tm,"open","f"),u&&(u._innerComponent.style.display="",Z(l,pi,"m",$i).call(l)||(u._stopLoading(),u._renderCamerasInfo(l.getSelectedCamera(),Z(l,ct,"f")._arrCameras),u._renderResolutionInfo({width:f.width,height:f.height}),u.eventHandler.fire("content:updated",null,{async:!1}),u.eventHandler.fire("videoEl:resized",null,{async:!1}))),Z(l,sc,"f").fire("opened",null,{target:l,async:!1}),f})()}close(){const l=Z(this,mt,"f");if(null==l?void 0:l.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),Z(this,pi,"m",$i).call(this)||Z(this,ct,"f").close(),lt(this,Tm,"closed","f"),Z(this,sl,"f").stopCharging(),l&&(l._innerComponent.style.display="none",Z(this,pi,"m",$i).call(this)&&l._innerComponent.removeElement("content"),l._stopLoading()),Z(this,sc,"f").fire("closed",null,{target:this,async:!1})}pause(){if(Z(this,pi,"m",$i).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");Z(this,ct,"f").pause()}isPaused(){var l;return!Z(this,pi,"m",$i).call(this)&&!0===(null===(l=this.video)||void 0===l?void 0:l.paused)}resume(){var l=this;return Q(function*(){if(Z(l,pi,"m",$i).call(l))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield Z(l,ct,"f").resume()})()}selectCamera(l){var u=this;return Q(function*(){if(!l)throw new Error("Invalid value.");let f;f="string"==typeof l?l:l.deviceId,yield Z(u,ct,"f").setCamera(f),lt(u,xd,!1,"f");const g=u.getResolution(),m=Z(u,mt,"f");return m&&!m.disposed&&(m._stopLoading(),m._renderCamerasInfo(u.getSelectedCamera(),Z(u,ct,"f")._arrCameras),m._renderResolutionInfo({width:g.width,height:g.height})),{width:g.width,height:g.height,deviceId:u.getSelectedCamera().deviceId}})()}getSelectedCamera(){return Z(this,ct,"f").getCamera()}getAllCameras(){var l=this;return Q(function*(){return Z(l,ct,"f").getCameras()})()}setResolution(l){var u=this;return Q(function*(){yield Z(u,ct,"f").setResolution(l.width,l.height),Z(u,xd,"f")&&u.turnOnTorch().catch(()=>{});const f=u.getResolution(),g=Z(u,mt,"f");return g&&!g.disposed&&(g._stopLoading(),g._renderResolutionInfo({width:f.width,height:f.height})),{width:f.width,height:f.height,deviceId:u.getSelectedCamera().deviceId}})()}getResolution(){return Z(this,ct,"f").getResolution()}getAvailableResolutions(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getResolutions()}_on(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?Z(this,sc,"f").on(l,u):Z(this,ct,"f").on(l,u)}_off(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?Z(this,sc,"f").off(l,u):Z(this,ct,"f").off(l,u)}on(l,u){const f=l.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._on(g,u)}off(l,u){const f=l.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._off(g,u)}getVideoSettings(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getMediaStreamConstraints()}updateVideoSettings(l){var u=this;return Q(function*(){var f;yield null===(f=Z(u,ct,"f"))||void 0===f?void 0:f.setMediaStreamConstraints(l,!0)})()}getCapabilities(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getCameraCapabilities()}getCameraSettings(){return Z(this,ct,"f").getCameraSettings()}turnOnTorch(){var l=this;return Q(function*(){var u;if(Z(l,pi,"m",$i).call(l))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(u=Z(l,ct,"f"))||void 0===u?void 0:u.turnOnTorch(),lt(l,xd,!0,"f")})()}turnOffTorch(){var l=this;return Q(function*(){var u;if(Z(l,pi,"m",$i).call(l))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(u=Z(l,ct,"f"))||void 0===u?void 0:u.turnOffTorch(),lt(l,xd,!1,"f")})()}setColorTemperature(l){var u=this;return Q(function*(){if(Z(u,pi,"m",$i).call(u))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield Z(u,ct,"f").setColorTemperature(l,!0)})()}getColorTemperature(){return Z(this,ct,"f").getColorTemperature()}setExposureCompensation(l){var u=this;return Q(function*(){var f;if(Z(u,pi,"m",$i).call(u))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(f=Z(u,ct,"f"))||void 0===f?void 0:f.setExposureCompensation(l,!0)})()}getExposureCompensation(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getExposureCompensation()}_setZoom(l){var u=this;return Q(function*(){var f;if(Z(u,pi,"m",$i).call(u))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(f=Z(u,ct,"f"))||void 0===f?void 0:f.setZoom(l)})()}setZoom(l){var u=this;return Q(function*(){yield u._setZoom(l)})()}getZoomSettings(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getZoom()}resetZoom(){var l=this;return Q(function*(){var u;if(Z(l,pi,"m",$i).call(l))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(u=Z(l,ct,"f"))||void 0===u?void 0:u.resetZoom()})()}setFrameRate(l){var u=this;return Q(function*(){var f;if(Z(u,pi,"m",$i).call(u))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(f=Z(u,ct,"f"))||void 0===f?void 0:f.setFrameRate(l,!0)})()}getFrameRate(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getFrameRate()}setFocus(l){var u=this;return Q(function*(){var f;if(Z(u,pi,"m",$i).call(u))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(f=Z(u,ct,"f"))||void 0===f?void 0:f.setFocus(l,!0)})()}getFocusSettings(){var l;return null===(l=Z(this,ct,"f"))||void 0===l?void 0:l.getFocus()}setAutoZoomRange(l){Z(this,pt,"f").minValue=l.min,Z(this,pt,"f").maxValue=l.max}getAutoZoomRange(){return{min:Z(this,pt,"f").minValue,max:Z(this,pt,"f").maxValue}}enableEnhancedFeatures(l){var u=this;return Q(function*(){var f,g;if(!(null===(g=null===(f=Ki.license)||void 0===f?void 0:f.LicenseManager)||void 0===g?void 0:g.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==Gi.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");l&Kc.EF_ENHANCED_FOCUS&&(Z(u,bn,"f").enhancedFocus=!0),l&Kc.EF_AUTO_ZOOM&&(Z(u,bn,"f").autoZoom=!0),l&Kc.EF_TAP_TO_FOCUS&&(Z(u,bn,"f").tapToFocus=!0,Z(u,ct,"f").enableTapToFocus())})()}disableEnhancedFeatures(l){l&Kc.EF_ENHANCED_FOCUS&&(Z(this,bn,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),l&Kc.EF_AUTO_ZOOM&&(Z(this,bn,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),l&Kc.EF_TAP_TO_FOCUS&&(Z(this,bn,"f").tapToFocus=!1,Z(this,ct,"f").disableTapToFocus()),Z(this,pi,"m",Sk).call(this)&&Z(this,pi,"m",_k).call(this)||Z(this,sl,"f").stopCharging()}_setScanRegion(l){if(null!=l&&!G_(l)&&!ql(l))throw TypeError("Invalid 'region'.");lt(this,wd,l?JSON.parse(JSON.stringify(l)):null,"f"),Z(this,mt,"f")&&!Z(this,mt,"f").disposed&&Z(this,mt,"f").setScanRegion(l)}setScanRegion(l){this._setScanRegion(l),Z(this,mt,"f")&&!Z(this,mt,"f").disposed&&(null===l?Z(this,mt,"f").setScanRegionMaskVisible(!1):Z(this,mt,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(Z(this,wd,"f")))}setErrorListener(l){if(!l)throw new TypeError("Invalid 'listener'");lt(this,Dm,l,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!Z(this,ct,"f").isVideoLoaded()||Z(this,pi,"m",$i).call(this))}startFetching(){if(Z(this,pi,"m",$i).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");Z(this,rc,"f")||(lt(this,rc,!0,"f"),Z(this,pi,"m",fS).call(this))}stopFetching(){Z(this,rc,"f")&&(jt._onLog&&jt._onLog("DCE: stop fetching loop: "+Date.now()),Z(this,ao,"f")&&clearTimeout(Z(this,ao,"f")),lt(this,rc,!1,"f"))}fetchImage(){if(Z(this,pi,"m",$i).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const l=this.getResolution();if(!(null==l?void 0:l.width)||!(null==l?void 0:l.height))throw new Error("The video is not loaded.");let u;if(u=d1.convert(Z(this,wd,"f"),l.width,l.height),u||(u={x:0,y:0,width:l.width,height:l.height}),u.x>l.width||u.y>l.height)throw new Error("Invalid scan region.");u.x+u.width>l.width&&(u.width=l.width-u.x),u.y+u.height>l.height&&(u.height=l.height-u.y);const f={sx:u.x,sy:u.y,sWidth:u.width,sHeight:u.height,dWidth:u.width,dHeight:u.height},g=Math.max(f.dWidth,f.dHeight);if(this.canvasSizeLimit&&g>this.canvasSizeLimit){const x=this.canvasSizeLimit/g;f.dWidth>f.dHeight?(f.dWidth=this.canvasSizeLimit,f.dHeight=Math.round(f.dHeight*x)):(f.dWidth=Math.round(f.dWidth*x),f.dHeight=this.canvasSizeLimit)}const m=Z(this,ct,"f").getFrameData({position:f,pixelFormat:Ek.get(this.getPixelFormat())});if(!m)return null;let v;v=m.pixelFormat===fi.GREY?m.width:4*m.width;let y=!0;return 0===f.sx&&0===f.sy&&f.sWidth===l.width&&f.sHeight===l.height&&(y=!1),{bytes:m.data,width:m.width,height:m.height,stride:v,format:Tk.get(m.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:n1.ITT_VIDEO_FRAME,isCropped:y,cropRegion:{left:u.x,top:u.y,right:u.x+u.width,bottom:u.y+u.height,isMeasuredInPercentage:!1},originalWidth:l.width,originalHeight:l.height,currentWidth:m.width,currentHeight:m.height,timeSpent:m.timeSpent,timeStamp:m.timeStamp},toCanvas:Z(this,L1,"f"),isDCEFrame:!0}}setImageFetchInterval(l){this.fetchInterval=l,Z(this,rc,"f")&&(Z(this,ao,"f")&&clearTimeout(Z(this,ao,"f")),lt(this,ao,setTimeout(()=>{this.disposed||Z(this,pi,"m",fS).call(this)},l),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(l){lt(this,F1,l,"f")}getPixelFormat(){return Z(this,F1,"f")}takePhoto(l){var u=this;if(!this.isOpen())throw new Error("Not open.");if(Z(this,pi,"m",$i).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),f.setAttribute("capture",""),f.style.position="absolute",f.style.top="-9999px",f.style.backgroundColor="transparent",f.style.color="transparent",f.addEventListener("click",()=>{const g=this.isOpen();this.close(),window.addEventListener("focus",()=>{g&&this.open(),f.remove()},{once:!0})}),f.addEventListener("change",Q(function*(){const g=f.files[0],m=yield(C=Q(function*(_){let T=null,M=null;if("undefined"!=typeof createImageBitmap)try{if(T=yield createImageBitmap(_),T)return T}catch(N){}var L;return T||(M=yield(L=_,new Promise((N,V)=>{let H=URL.createObjectURL(L),G=new Image;G.src=H,G.onload=()=>{URL.revokeObjectURL(G.src),N(G)},G.onerror=z=>{V(new Error("Can't convert blob to image : "+(z instanceof Event?z.type:z)))}}))),M}),function(_){return C.apply(this,arguments)})(g),v=m instanceof HTMLImageElement?m.naturalWidth:m.width,y=m instanceof HTMLImageElement?m.naturalHeight:m.height;var C;let x=d1.convert(Z(u,wd,"f"),v,y);x||(x={x:0,y:0,width:v,height:y});const w=Z(u,O1,"f").call(u,m,v,y,x);l&&l(w)})),document.body.appendChild(f),f.click()}convertToPageCoordinates(l){const u=Z(this,pi,"m",pS).call(this,l);return{x:u.pageX,y:u.pageY}}convertToClientCoordinates(l){const u=Z(this,pi,"m",pS).call(this,l);return{x:u.clientX,y:u.clientY}}dispose(){this.close(),Z(this,ct,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function mr(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function wa(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}hS=jt,ct=new WeakMap,mt=new WeakMap,Tm=new WeakMap,sc=new WeakMap,xd=new WeakMap,k1=new WeakMap,O1=new WeakMap,L1=new WeakMap,Dm=new WeakMap,wd=new WeakMap,F1=new WeakMap,rc=new WeakMap,ao=new WeakMap,bn=new WeakMap,pt=new WeakMap,sl=new WeakMap,uS=new WeakMap,pi=new WeakSet,$i=function(){return"disabled"!==this.singleFrameMode},_k=function(){return!this.videoSrc&&"opened"===Z(this,ct,"f").state},Sk=function(){for(let p in Z(this,bn,"f"))if(1==Z(this,bn,"f")[p])return!0;return!1},fS=function p(){if(this.disposed)return;if("open"!==this.getCameraState()||!Z(this,rc,"f"))return Z(this,ao,"f")&&clearTimeout(Z(this,ao,"f")),void lt(this,ao,setTimeout(()=>{this.disposed||Z(this,pi,"m",p).call(this)},this.fetchInterval),"f");const l=()=>{var u;let f;jt._onLog&&jt._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{f=this.fetchImage()}catch(g){const m=g.message||g;if("The video is not loaded."===m)return;if(null===(u=Z(this,Dm,"f"))||void 0===u?void 0:u.onErrorReceived)return void setTimeout(()=>{var v;null===(v=Z(this,Dm,"f"))||void 0===v||v.onErrorReceived(R_.EC_IMAGE_READ_FAILED,m)},0);console.warn(g)}f?(this.addImageToBuffer(f),jt._onLog&&jt._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),Z(this,sc,"f").fire("frameAddedToBuffer",null,{async:!1})):jt._onLog&&jt._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case hd.BOPM_BLOCK:break;case hd.BOPM_UPDATE:l()}else l();Z(this,ao,"f")&&clearTimeout(Z(this,ao,"f")),lt(this,ao,setTimeout(()=>{this.disposed||Z(this,pi,"m",p).call(this)},this.fetchInterval),"f")},pS=function(p){if(!Z(this,mt,"f"))throw new Error("Camera view is not set.");if(Z(this,mt,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!Z(this,pi,"m",$i).call(this)&&!Z(this,ct,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(Z(this,pi,"m",$i).call(this)&&!Z(this,mt,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const l=Z(this,mt,"f")._innerComponent.getBoundingClientRect(),u=l.left,f=l.top,g=u+window.scrollX,m=f+window.scrollY,{width:v,height:y}=Z(this,mt,"f")._innerComponent.getBoundingClientRect();if(v<=0||y<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let x,w,C;if(Z(this,pi,"m",$i).call(this)){const G=Z(this,mt,"f")._innerComponent.getElement("content");x=G.width,w=G.height,C="contain"}else{const G=this.getVideoEl();x=G.videoWidth,w=G.videoHeight,C=Z(this,mt,"f").getVideoFit()}const _=v/y,T=x/w;let M,L,N,V,H=1;if("contain"===C)_<T?(H=v/x,M=u+p.x*H,L=f+p.y*H+(y-w*H)/2,N=g+p.x*H,V=m+p.y*H+(y-w*H)/2):(H=y/w,M=u+p.x*H+(v-x*H)/2,L=f+p.y*H,N=g+p.x*H+(v-x*H)/2,V=m+p.y*H);else if("cover"===C)if(_<T){H=y/w;let G=p.x*H-(x*H-v)/2;G=Math.max(G,0),G=Math.min(G,v),M=u+G,L=f+p.y*H,N=g+G,V=m+p.y*H}else{H=v/x;let G=p.y*H-(w*H-y)/2;G=Math.max(G,0),G=Math.min(G,y),M=u+p.x*H,L=f+G,N=g+p.x*H,V=m+G}return{clientX:M,clientY:L,pageX:N,pageY:V}},jt._debug=!1,dS={value:void 0},jt.browserInfo=Ps,"function"==typeof SuppressedError&&SuppressedError;class lo{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const y=[l[v],l[v+3],l[v+6]].reduce((x,w,C)=>x+w*m[C],0);f.push(y)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return lo.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return lo.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return lo.multiply(l,[u,0,0,0,f,0,0,0,1])}}var un,ac,lc,N1,Af,Am,Im,If,B1,Vo,Dk,yS,Mm,km;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(un||(un={}));class kt{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(wa(kt,ac,!1,"f",lc),!1):(wa(kt,ac,!0,"f",lc),!0)}get disposed(){return mr(this,B1,"f")}constructor(){N1.set(this,un.RGBA),Af.set(this,null),Am.set(this,null),Im.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,If.set(this,null),B1.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==mr(kt,ac,"f",lc)&&kt.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!mr(kt,ac,"f",lc))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let y;kt._onLog&&(y=Date.now(),kt._onLog("drawImage(), START: "+y));let x=0,w=0,C=f,_=g,T=0,M=0,L=f,N=g;m&&(m.sx&&(x=Math.round(m.sx)),m.sy&&(w=Math.round(m.sy)),m.sWidth&&(C=Math.round(m.sWidth)),m.sHeight&&(_=Math.round(m.sHeight)),m.dx&&(T=Math.round(m.dx)),m.dy&&(M=Math.round(m.dy)),m.dWidth&&(L=Math.round(m.dWidth)),m.dHeight&&(N=Math.round(m.dHeight)));let V,H=un.RGBA;if((null==v?void 0:v.pixelFormat)&&(H=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(V=v.bufferContainer,V.length<4*L*N))throw new Error("Unexpected size of the 'bufferContainer'.");const G=l;if(!mr(kt,ac,"f",lc)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){kt._onLog&&kt._onLog("drawImage() in context2d."),G.ctx2d||(G.ctx2d=G.getContext("2d",{willReadFrequently:!0}));const z=G.ctx2d;if(!z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N),z.drawImage(u,x,w,C,_,T,M,L,N),kt._onLog&&kt._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:un.RGBA,bUseWebGL:!1}}kt._onLog&&kt._onLog("drawImage() in WebGL.");try{(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N,G.ctxWebGL&&G.ctxWebGL.viewport(0,0,T+L,M+N));const z=G.ctxWebGL||G.getContext("webgl",{antialias:!1})||G.getContext("experimental-webgl",{antialias:!1});if(!z){kt._onLog&&kt._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const j=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw j.name="WebGLError",j}if(!G.ctxWebGL||H!==mr(this,N1,"f")){G.ctxWebGL=z;const j=b=>{const D=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,D),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW);const k=b.createBuffer();return b.bindBuffer(b.ARRAY_BUFFER,k),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW),{positions:D,texCoords:k}},le=b=>{const D=b.createTexture();return b.bindTexture(b.TEXTURE_2D,D),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),D},ue=(b,D)=>{const k=b.createProgram();if(D.forEach(U=>b.attachShader(k,U)),b.linkProgram(k),!b.getProgramParameter(k,b.LINK_STATUS)){const U=new Error(`An error occured linking the program: ${b.getProgramInfoLog(k)}.`);throw U.name="WebGLError",U}return b.useProgram(k),k},xe=(b,D,k)=>{const U=b.createShader(D);if(b.shaderSource(U,k),b.compileShader(U),!b.getShaderParameter(U,b.COMPILE_STATUS)){const F=new Error(`An error occured compiling the shader: ${b.getShaderInfoLog(U)}.`);throw F.name="WebGLError",F}return U},I="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let A="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(A=H.slice(0,3));const P=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${A} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,O=ue(z,[xe(z,z.VERTEX_SHADER,I),xe(z,z.FRAGMENT_SHADER,P)]);wa(this,Am,{program:O,attribLocations:{vertexPosition:z.getAttribLocation(O,"a_position"),texPosition:z.getAttribLocation(O,"a_texCoord")},uniformLocations:{uSampler:z.getUniformLocation(O,"u_image"),uColorFactor:z.getUniformLocation(O,"uColorFactor"),uMatrix:z.getUniformLocation(O,"u_matrix"),uTextureMatrix:z.getUniformLocation(O,"u_textureMatrix")}},"f"),wa(this,Im,j(z),"f"),wa(this,Af,le(z),"f"),wa(this,N1,H,"f")}const q=(j,le,ue)=>{j.bindBuffer(j.ARRAY_BUFFER,le),j.enableVertexAttribArray(ue),j.vertexAttribPointer(ue,2,j.FLOAT,!1,0,0)},se=(j,le,ue,xe)=>{j.clearColor(0,0,0,1),j.clearDepth(1),j.enable(j.DEPTH_TEST),j.depthFunc(j.LEQUAL),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT),q(j,ue.positions,le.attribLocations.vertexPosition),q(j,ue.texCoords,le.attribLocations.texPosition),j.activeTexture(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,xe),j.uniform1i(le.uniformLocations.uSampler,0),j.uniform1f(le.uniformLocations.uColorFactor,[un.GREY,un.GREY32].includes(H)?1:0);let I,A,P=lo.translate(lo.identity(),-1,-1);P=lo.scale(P,2,2),P=lo.scale(P,1/j.canvas.width,1/j.canvas.height),I=lo.translate(P,T,M),I=lo.scale(I,L,N),j.uniformMatrix3fv(le.uniformLocations.uMatrix,!1,I),A=lo.translate(lo.identity(),x/f,w/g),A=lo.scale(A,C/f,_/g),j.uniformMatrix3fv(le.uniformLocations.uTextureMatrix,!1,A),j.drawArrays(j.TRIANGLES,0,6)};((j,le,ue)=>{const xe=j.RGBA,I=j.RGBA,A=j.UNSIGNED_BYTE;j.bindTexture(j.TEXTURE_2D,le),j.texImage2D(j.TEXTURE_2D,0,xe,I,A,ue)})(z,mr(this,Af,"f"),u),se(z,mr(this,Am,"f"),mr(this,Im,"f"),mr(this,Af,"f"));const ae=V||new Uint8Array(4*L*N);if(z.readPixels(T,M,L,N,z.RGBA,z.UNSIGNED_BYTE,ae),255!==ae[3]){kt._onLog&&kt._onLog("Incorrect WebGL drawing .");const j=new Error("WebGL error: incorrect drawing.");throw j.name="WebGLError",j}return kt._onLog&&kt._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:H===un.GREY?un.GREY32:H,bUseWebGL:!0}}catch(z){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return kt._onLog&&kt._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw z.name="WebGLError",z}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,y=l.canvas.width,x=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(y=u.width),u.height&&(x=u.height)),(null==f?void 0:f.length)<4*y*x)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const w=l;f?(w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*y*x)):(g=new Uint8Array(4*y*x),w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let w;w=l.getImageData(m,v,y,x),g=new Uint8Array(w.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(kt._onLog&&(m=Date.now(),kt._onLog("transformPixelFormat(), START: "+m)),u===f)return kt._onLog&&kt._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const y=[un.RGBA,un.RBGA,un.GRBA,un.GBRA,un.BRGA,un.BGRA];if(y.includes(u))if(f===un.GREY){v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=.21*l[x]+.71*l[x+1]+.07*l[x+2]}else if(f===un.GREY32){v=g?new Uint8Array(l):l;for(let x=0;x<l.length;x+=4){const w=.21*l[x]+.71*l[x+1]+.07*l[x+2];v[x]=w,v[x+1]=w,v[x+2]=w}}else{if(!y.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4)v[L+_]=l[L+x],v[L+T]=l[L+w],v[L+M]=l[L+C]}else{v=l;const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4){let N=[l[L],l[L+1],l[L+2]];v[L+_]=N[x],v[L+T]=N[w],v[L+M]=N[C]}}}else if(u===un.GREY){if(f!==un.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let x=0;x<l.length;x++)v[4*x]=l[x],v[4*x+1]=l[x],v[4*x+2]=l[x],v[4*x+3]=255}else{if(u!==un.GREY32)throw new Error("Unable to transform.");if(f!==un.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=l[x]}return kt._onLog&&kt._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==mr(kt,ac,"f",lc)&&kt.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!mr(kt,ac,"f",lc))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;kt._onLog&&(v=Date.now(),kt._onLog("getImageData(), START: "+v));const y=Math.round(g.sx),x=Math.round(g.sy),w=Math.round(g.sWidth),C=Math.round(g.sHeight),_=Math.round(g.dWidth),T=Math.round(g.dHeight);let M=un.RGBA;(null==m?void 0:m.pixelFormat)&&(M=m.pixelFormat);let L,N,V,H=null;if((null==m?void 0:m.bufferContainer)&&(H=m.bufferContainer),mr(kt,ac,"f",lc)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){kt._onLog&&kt._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),L=this._reusedWebGLCvs;try{if(H)if(M===un.GREY){if(V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}}else N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:H}),V=new Uint8Array(H.buffer,0,4*_*T),V=this.transformPixelFormat(V,N.pixelFormat,M);else M===un.GREY?((!mr(this,If,"f")||mr(this,If,"f").length<4*_*T)&&wa(this,If,new Uint8Array(4*_*T),"f"),V=new Uint8Array(mr(this,If,"f").buffer,0,4*_*T)):V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M)}catch(G){if("WebGLError"===G.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return kt._onLog&&kt._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},Object.assign({},m,{bUseWebGL:!1}));throw G}}else if(kt._onLog&&kt._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),L=this._reusedCvs,N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:un.RGBA,bUseWebGL:!1}),V=this.readCvsData(N.context,{width:_,height:T},null),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}return kt._onLog&&kt._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:V,pixelFormat:M,width:_,height:T,bUseWebGL:N.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===un.GREY){v=new Uint8ClampedArray(4*u*f);for(let x=0;x<v.length;x+=4)v[x]=l[x/4],v[x+1]=l[x/4],v[x+2]=l[x/4],v[x+3]=255}else v=new Uint8ClampedArray(l.buffer);const y=new ImageData(v,u,f);return m.getContext("2d").putImageData(y,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),wa(this,Af,null,"f"),wa(this,Am,null,"f"),wa(this,Im,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),wa(this,B1,!0,"f")}}ac=kt,N1=new WeakMap,Af=new WeakMap,Am=new WeakMap,Im=new WeakMap,If=new WeakMap,B1=new WeakMap,lc={value:void 0};class Rf{static beep(){if(!this.beepSoundSource)return;let l;if(Z(this,Vo,"f",Mm).size&&(l=Z(this,Vo,"f",Mm).values().next().value,this.beepSoundSource==l.src?(Z(this,Vo,"f",Mm).delete(l),l.play()):l=null),!l)if(Z(this,Vo,"f",km).size<64){l=new Audio(this.beepSoundSource);let u=null,f=()=>{l.removeEventListener("loadedmetadata",f),l.play(),u=setTimeout(()=>{Z(this,Vo,"f",km).delete(l)},2e3*l.duration)};l.addEventListener("loadedmetadata",f),l.addEventListener("ended",()=>{null!=u&&(clearTimeout(u),u=null),l.pause(),l.currentTime=0,Z(this,Vo,"f",km).delete(l),Z(this,Vo,"f",Mm).add(l)})}else Z(this,Vo,"f",yS)||(lt(this,Vo,!0,"f",yS),console.warn("The requested audio tracks exceed 64 and will not be played."));l&&Z(this,Vo,"f",km).add(l)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Rf.vibrateDuration)}}Vo=Rf,Dk={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},yS={value:!1},Mm={value:new Set},km={value:new Set},Rf.beepSoundSource=Z(Rf,Vo,"f",Dk),Rf.vibrateDuration=300;const Ik="undefined"==typeof self,xS=(()=>{if(!Ik&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Pk=p=>{if(null==p&&(p="./"),!Ik){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==st.dbr&&(st.dbr=xS),Bo.dbr={js:!1,wasm:!0,deps:["license","dip"]},Ki.dbr={};"string"!=typeof st.std&&eo(st.std.version,"1.2.0")<0&&(st.std={version:"1.2.0",path:Pk(xS+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const CS="2.2.10";var Rk,Mk,kk,Ok;(!st.dip||"string"!=typeof st.dip&&eo(st.dip.version,CS)<0)&&(st.dip={version:CS,path:Pk(xS+`../../dynamsoft-image-processing@${CS}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(p){p[p.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",p[p.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",p[p.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(Rk||(Rk={})),function(p){p[p.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",p[p.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",p[p.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",p[p.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Mk||(Mk={})),function(p){p[p.LM_AUTO=1]="LM_AUTO",p[p.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",p[p.LM_STATISTICS=4]="LM_STATISTICS",p[p.LM_LINES=8]="LM_LINES",p[p.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",p[p.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",p[p.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",p[p.LM_CENTRE=128]="LM_CENTRE",p[p.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",p[p.LM_REV=-2147483648]="LM_REV",p[p.LM_SKIP=0]="LM_SKIP"}(kk||(kk={})),function(p){p[p.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",p[p.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",p[p.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",p[p.DM_SMOOTHING=8]="DM_SMOOTHING",p[p.DM_MORPHING=16]="DM_MORPHING",p[p.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",p[p.DM_SHARPENING=64]="DM_SHARPENING",p[p.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",p[p.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",p[p.DM_REV=-2147483648]="DM_REV",p[p.DM_SKIP=0]="DM_SKIP"}(Ok||(Ok={}));const Fk="undefined"==typeof self,bS=(()=>{if(!Fk&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Nk=p=>{if(null==p&&(p="./"),!Fk){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==st.utility&&(st.utility=bS),Bo.utility={js:!0,wasm:!0};const _S="1.2.10";"string"!=typeof st.std&&eo(st.std.version,_S)<0&&(st.std={version:_S,path:Nk(bS+`../../dynamsoft-capture-vision-std@${_S}/dist/`)});const SS="2.2.30";(!st.dip||"string"!=typeof st.dip&&eo(st.dip.version,SS)<0)&&(st.dip={version:SS,path:Nk(bS+`../../dynamsoft-image-processing@${SS}/dist/`)});let lh="./";if(document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}lh=p.substring(0,p.lastIndexOf("/")+1)}const Cd=p=>{null==p&&(p="./");let l=document.createElement("a");return l.href=p,(p=l.href).endsWith("/")||(p+="/"),p};Gi.engineResourcePaths={std:Cd(lh+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:Cd(lh+"../../dynamsoft-image-processing@2.2.30/dist/"),core:Cd(lh+"../../dynamsoft-core@3.2.30/dist/"),license:Cd(lh+"../../dynamsoft-license@3.2.21/dist/"),cvr:Cd(lh+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:Cd(lh+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:Cd(lh+"../../dynamsoft-barcode-reader@10.2.10/dist/")};const Bk="undefined"==typeof self,DS=(()=>{if(!Bk&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Uk=p=>{if(null==p&&(p="./"),!Bk){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p},AS=p=>{const l=document.createElement("canvas");return l.width=p.width,l.height=p.height,l.getContext("2d",{willReadFrequently:!0}).putImageData(p,0,0),l},Vk=function(){var p=Q(function*(l,u){const f=AS(u);return new Promise((g,m)=>{f.toBlob(v=>g(v),l)})});return function(u,f){return p.apply(this,arguments)}}();null==st.ddn&&(st.ddn=DS),Bo.ddn={js:!0,wasm:!0,deps:["license","dip"]},Ki.ddn={handleNormalizedImageResultItem:function(p){let l=p,u=(f=>{let g,m=f.bytes;if(!(m&&m instanceof Uint8Array))throw Error("Parameter type error");if(Number(f.format)===wt.IPF_BGR_888){const v=m.length/3;g=new Uint8ClampedArray(4*v);for(let y=0;y<v;++y)g[4*y]=m[3*y],g[4*y+1]=m[3*y+1],g[4*y+2]=m[3*y+2],g[4*y+3]=255}else if(Number(f.format)===wt.IPF_RGB_888){const v=m.length/3;g=new Uint8ClampedArray(4*v);for(let y=0;y<v;++y)g[4*y]=m[3*y+2],g[4*y+1]=m[3*y+1],g[4*y+2]=m[3*y],g[4*y+3]=255}else if(Number(f.format)===wt.IPF_GRAYSCALED){const v=m.length;g=new Uint8ClampedArray(4*v);for(let y=0;y<v;y++)g[4*y]=g[4*y+1]=g[4*y+2]=m[y],g[4*y+3]=255}else if(Number(f.format)===wt.IPF_BINARY_8){const v=m.length,y=f.width,w=f.stride;g=new Uint8ClampedArray(y*f.height*4);for(let C=0;C<v;C++){let _=m[C],T=C%w,M=Math.floor(C/w);for(let L=0;L<8;L++){let N=T+L,V=4*(M*y+N);if(N>=y)break;g[V]=g[V+1]=g[V+2]=(128&_)/128*255,g[V+3]=255,_<<=1}}}else if(Number(f.format)===wt.IPF_ABGR_8888){const v=m.length/4;g=new Uint8ClampedArray(m.length);for(let y=0;y<v;++y)g[4*y]=m[4*y],g[4*y+1]=m[4*y+1],g[4*y+2]=m[4*y+2],g[4*y+3]=m[4*y+3]}else if(Number(f.format)===wt.IPF_ARGB_8888){const v=m.length/4;g=new Uint8ClampedArray(m.length);for(let y=0;y<v;++y)g[4*y]=m[4*y],g[4*y+1]=m[4*y+1],g[4*y+2]=m[4*y+2],g[4*y+3]=m[4*y+3]}return new ImageData(g,f.width,f.height)})(l.imageData);l.toCanvas=()=>AS(u),l.toImage=f=>((g,m)=>{const v=AS(m);let y=new Image,x=v.toDataURL(g);return y.src=x,y})(f,u),l.toBlob=f=>Vk(f,u),l.saveToFile=function(){var f=Q(function*(g,m){if(!g)return null;if("string"!=typeof g)throw new TypeError("FileName must be of type string.");return(v=Q(function*(y,x,w){return yield new Promise(function(){var C=Q(function*(_,T){try{const M=x.split(".");let L=M[M.length-1];const N=yield Vk(`image/${L}`,y);M.length<=1&&(L="png");const V=new File([N],x,{type:`image/${L}`});if(w){const H=URL.createObjectURL(V),G=document.createElement("a");G.href=H,G.download=x,G.click()}return _(V)}catch(M){return T()}});return function(_,T){return C.apply(this,arguments)}}())}),function(y,x,w){return v.apply(this,arguments)})(u,g,m);var v});return function(g,m){return f.apply(this,arguments)}}()}};"string"!=typeof st.std&&eo(st.std.version,"1.2.0")<0&&(st.std={version:"1.2.0",path:Uk(DS+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const PS="2.2.10";var rl;(!st.dip||"string"!=typeof st.dip&&eo(st.dip.version,PS)<0)&&(st.dip={version:PS,path:Uk(DS+`../../dynamsoft-image-processing@${PS}/dist/`)}),function(p){p[p.ICM_COLOUR=0]="ICM_COLOUR",p[p.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",p[p.ICM_BINARY=2]="ICM_BINARY"}(rl||(rl={}));const jk="undefined"==typeof self,Om=(()=>{if(!jk&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Lm=p=>{if(null==p&&(p="./"),!jk){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p};null==st.dlr&&(st.dlr=Om),null==st.dlrData&&(st.dlrData=Lm(Om+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")),Bo.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},Bo.dnn={wasm:!0};const RS="1.2.10";"string"!=typeof st.std&&eo(st.std.version,RS)<0&&(st.std={version:RS,path:Lm(Om+`../../dynamsoft-capture-vision-std@${RS}/dist/`)});const MS="2.2.30";(!st.dip||"string"!=typeof st.dip&&eo(st.dip.version,MS)<0)&&(st.dip={version:MS,path:Lm(Om+`../../dynamsoft-image-processing@${MS}/dist/`)});const kS="1.0.20";(!st.dnn||"string"!=typeof st.dnn&&eo(st.dnn.version,kS)<0)&&(st.dnn={version:kS,path:Lm(Om+`../../dynamsoft-capture-vision-dnn@${kS}/dist/`)});let Hk=!1;class Fm{static getVersion(){return`3.2.30(Worker: ${pr.dlr&&pr.dlr.worker||"Not Loaded"}, Wasm: ${pr.dlr&&pr.dlr.wasm||"Not Loaded"})`}static loadRecognitionData(l,u){return Q(function*(){return yield to("dlr"),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var y=Q(function*(x){if(x.success){const w=x.result;if(0!==w.exception){let C=new Error(w.description);return C.errorCode=w.exception,g(C)}return w.bModel||(Hk=!0),f(w)}{let w=new Error(x.message);return w.stack=x.stack+"\n"+w.stack,g(w)}});return function(x){return y.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),u||"ConfusableChars"!==l||(u=Gi.engineResourcePaths.dlr);let v=Gi.engineResourcePaths.dlrData;Gi.engineResourcePaths.rootDirectory&&(v.startsWith("http://")||v.startsWith("https://")||(v=Gi.engineResourcePaths.rootDirectory+"/"+v)),Gi.engineResourcePaths.dlrData=Lm(v),Rt.postMessage({type:"dlr_loadData",id:m,body:{dataName:l,dataPath:u||Gi.engineResourcePaths.dlrData}})})})()}}var W1,G1;function Wk(p){delete p.moduleId;const l=JSON.parse(p.jsonString).ResultInfo,u=p.fullCodeString;p.getFieldValue=f=>"fullcodestring"===f.toLowerCase()?u:Gk(l,f),p.getFieldMappingStatus=f=>zk(l,f),p.getFieldValidationStatus=f=>$k(l,f),delete p.fullCodeString}function Gk(p,l){for(let u of p){if(u.FieldName===l)return u.Value;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=Gk(g,l);if(null!==f)return f}}return null}function zk(p,l){for(let u of p){if(u.FieldName===l)return u.MappingStatus?Number(W1[u.MappingStatus]):W1.MS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=zk(g,l);if(null!==f)return f}}return null}function $k(p,l){for(let u of p){if(u.FieldName===l&&u.ValidationStatus)return u.ValidationStatus?Number(G1[u.ValidationStatus]):G1.VS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let f;for(let g of u.ChildFields)f=$k(g,l);if(null!==f)return f}}return null}function z1(p){if(p.disposed)throw new Error('"CodeParser" instance has been disposed')}Ki.dlr={filterVINResult:function(p){let l="";if(18===p.characterResults.length){let u=p.characterResults[9].location.points[0].x-p.characterResults[8].location.points[1].x;u<2&&(u=2);let f=p.characterResults[1].location.points[0].x-p.characterResults[0].location.points[1].x,g=p.characterResults[17].location.points[0].x-p.characterResults[16].location.points[1].x,m=2===u?3:u;f-u>=m&&g-u<m?p.characterResults.shift():g-u>=m&&f-u<m||p.characterResults[0].characterHConfidence>p.characterResults[17].characterHConfidence?p.characterResults.pop():p.characterResults.shift()}else if(19===p.characterResults.length){let u=p.characterResults[10].location.points[0].x-p.characterResults[9].location.points[1].x;u<2&&(u=2);let f,g,m,v=p.characterResults[1].location.points[0].x-p.characterResults[0].location.points[1].x,y=p.characterResults[18].location.points[0].x-p.characterResults[17].location.points[1].x,x=p.characterResults[2].location.points[0].x-p.characterResults[1].location.points[1].x,w=p.characterResults[17].location.points[0].x-p.characterResults[16].location.points[1].x,C=2===u?3:u;if("1"===p.characterResults[1].characterH||"1"===p.characterResults[2].characterH||"1"===p.characterResults[16].characterH||"1"===p.characterResults[17].characterH){for(let _=9;_<p.characterResults.length;_++)if("1"!==p.characterResults[_].characterH){m=p.characterResults[_].location.points[1].x-p.characterResults[_].location.points[0].x;break}"1"===p.characterResults[1].characterH&&(f=m-(p.characterResults[1].location.points[1].x-p.characterResults[1].location.points[0].x)+3),"1"===p.characterResults[2].characterH&&(f=m-(p.characterResults[2].location.points[1].x-p.characterResults[2].location.points[0].x)+3),"1"===p.characterResults[16].characterH&&(g=m-(p.characterResults[16].location.points[1].x-p.characterResults[16].location.points[0].x)+3),"1"===p.characterResults[17].characterH&&(g=m-(p.characterResults[17].location.points[1].x-p.characterResults[17].location.points[0].x)+3)}if(x-u>=(f||C)&&w-u<(g||C))p.characterResults.splice(0,2);else if(w-u>=(g||C)&&x-u<(f||C))p.characterResults.splice(17,2);else if(v>u&&y>u)p.characterResults.pop(),p.characterResults.shift();else{let _=p.characterResults[0].characterHConfidence+p.characterResults[1].characterHConfidence,T=p.characterResults[17].characterHConfidence+p.characterResults[18].characterHConfidence,M=p.characterResults[0].characterHConfidence+p.characterResults[18].characterHConfidence,L=Math.min(_,T,M);L===_?p.characterResults.splice(0,2):L===T?p.characterResults.splice(17,2):L===M&&(p.characterResults.pop(),p.characterResults.shift())}}for(let u of p.characterResults)l+=u.characterH;return l},loadRecognitionData:Fm.loadRecognitionData,get bLoadConfusableCharsData(){return Hk}},$t[-1]=function(){var p=Q(function*(l){Fm.onDataLoadProgressChanged&&Fm.onDataLoadProgressChanged(l.resourcesPath,l.tag,{loaded:l.loaded,total:l.total})});return function(l){return p.apply(this,arguments)}}(),function(p){p[p.MS_NONE=0]="MS_NONE",p[p.MS_SUCCEEDED=1]="MS_SUCCEEDED",p[p.MS_FAILED=2]="MS_FAILED"}(W1||(W1={})),function(p){p[p.VS_NONE=0]="VS_NONE",p[p.VS_SUCCEEDED=1]="VS_SUCCEEDED",p[p.VS_FAILED=2]="VS_FAILED"}(G1||(G1={}));const Yk=p=>p&&"object"==typeof p&&"function"==typeof p.then;class Ree extends Promise{constructor(l){let u,f;super((g,m)=>{u=g,f=m}),this._s="pending",this.resolve=g=>{this.isPending&&(Yk(g)?this.task=g:(this._s="fulfilled",u(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let f;this._task=l,Yk(l)?f=l:"function"==typeof l&&(f=new Promise(l)),f&&Q(function*(){try{const g=yield f;l===u._task&&u.resolve(g)}catch(g){l===u._task&&u.reject(g)}})()}get isEmpty(){return null==this._task}}class $1{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static createInstance(){return Q(function*(){if(!Ki.license)throw Error("Module `license` is not existed.");yield Ki.license.dynamsoft(),yield to("dcp");const l=new $1,u=new Ree;let f=bi();return $t[f]=function(){var g=Q(function*(m){if(m.success)l._instanceID=m.instanceID,u.resolve(l);else{const v=Error(m.message);m.stack&&(v.stack=m.stack),u.reject(v)}});return function(m){return g.apply(this,arguments)}}(),Rt.postMessage({type:"dcp_createInstance",id:f}),u})()}dispose(){var l=this;return Q(function*(){z1(l);let u=bi();l.bDestroyed=!0,$t[u]=f=>{if(!f.success){let g=new Error(f.message);throw g.stack=f.stack+"\n"+g.stack,g}},Rt.postMessage({type:"dcp_dispose",id:u,instanceID:l._instanceID})})()}get disposed(){return this.bDestroyed}initSettings(l){var u=this;return Q(function*(){return z1(u),l&&["string","object"].includes(typeof l)?("string"==typeof l&&function iee(p){return/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(p)}(l)&&(l=yield D_(l,"text")),"object"==typeof l&&(l=JSON.stringify(l)),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var v=Q(function*(y){if(y.success){const x=JSON.parse(y.response);if(0!==x.exception){let w=new Error(x.description?x.description:"Init Settings Failed.");return w.errorCode=x.exception,g(w)}return f(x)}{let x=new Error(y.message);return x.stack=y.stack+"\n"+x.stack,g(x)}});return function(y){return v.apply(this,arguments)}}(),Rt.postMessage({type:"dcp_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid settings.")})()}resetSettings(){var l=this;return Q(function*(){return z1(l),yield new Promise((u,f)=>{let g=bi();$t[g]=function(){var m=Q(function*(v){if(v.success)return u();{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,f(y)}});return function(v){return m.apply(this,arguments)}}(),Rt.postMessage({type:"dcp_resetSettings",id:g,instanceID:l._instanceID})})})()}parse(l,u=""){var f=this;return Q(function*(){if(z1(f),!l||!(l instanceof Array||l instanceof Uint8Array||"string"==typeof l))throw new Error("`parse` must pass in an Array or Uint8Array or string");return yield new Promise((g,m)=>{let v=bi();l instanceof Array&&(l=Uint8Array.from(l)),"string"==typeof l&&(l=Uint8Array.from(function(y){let x=[];for(let w=0;w<y.length;++w)x.push(y.charCodeAt(w));return x}(l))),$t[v]=function(){var y=Q(function*(x){if(x.success){let w=JSON.parse(x.parseResponse);return w.exception?m(new Error(w.description)):(Wk(w),g(w))}{let w=new Error(x.message);return w.stack=x.stack+"\n"+w.stack,m(w)}});return function(x){return y.apply(this,arguments)}}(),Rt.postMessage({type:"dcp_parse",id:v,instanceID:f._instanceID,body:{source:l,taskSettingName:u}})})})()}}const Xk="undefined"==typeof self,qk=(()=>{if(!Xk&&document.currentScript){let p=document.currentScript.src,l=p.indexOf("?");if(-1!=l)p=p.substring(0,l);else{let u=p.indexOf("#");-1!=u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();null==st.dcp&&(st.dcp=qk),Bo.dcp={js:!0,wasm:!0,deps:["license"]},Ki.dcp={handleParsedResultItem:Wk};"string"!=typeof st.std&&eo(st.std.version,"1.2.0")<0&&(st.std={version:"1.2.0",path:(p=>{if(null==p&&(p="./"),!Xk){let l=document.createElement("a");l.href=p,p=l.href}return p.endsWith("/")||(p+="/"),p})(qk+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});class jo{static getVersion(){return`2.2.10(Worker: ${pr.dcp&&pr.dcp.worker||"Not Loaded"}, Wasm: ${pr.dcp&&pr.dcp.wasm||"Not Loaded"})`}static loadSpec(l,u){return Q(function*(){return yield to("dcp"),yield new Promise((f,g)=>{let m=bi();$t[m]=function(){var y=Q(function*(x){if(x.success)return f();{let w=new Error(x.message);return w.stack=x.stack+"\n"+w.stack,g(w)}});return function(x){return y.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),Rt.postMessage({type:"dcp_appendResourceBuffer",id:m,body:{specificationPath:u||Gi.engineResourcePaths.dcp+"specification/",specificationNames:l instanceof Array?l:[l]}})})})()}}function Zk(p){const l={};let u=p.getFieldValue("documentCode");l["Document Type"]=JSON.parse(p.jsonString).CodeType;let f=p.getFieldValue("issuingState");l["Issuing State"]=f;let g=p.getFieldValue("primaryIdentifier");l.Surname=g;let m=p.getFieldValue("secondaryIdentifier");l["Given Name"]=m;let v=p.getFieldValue("P"===u?"passportNumber":"documentNumber");l["Passport Number"]=v;let y=p.getFieldValue("nationality");l.Nationality=y;let x=p.getFieldValue("sex");l.Gender=x;let w=p.getFieldValue("birthYear"),C=p.getFieldValue("birthMonth"),_=p.getFieldValue("birthDay");w=parseInt(w)>(new Date).getFullYear()%100?"19"+w:"20"+w,l["Date of Birth (YYYY-MM-DD)"]=w+"-"+C+"-"+_;let T=p.getFieldValue("expiryYear"),M=p.getFieldValue("expiryMonth"),L=p.getFieldValue("expiryDay");return T=parseInt(T)>=60?"19"+T:"20"+T,l["Date of Expiry (YYYY-MM-DD)"]=T+"-"+M+"-"+L,l}function co(p){return`${window.location.protocol}//${window.location.host}${window.location.pathname}${p}`}function ye(p,l,u){if("function"==typeof p?p===l:p.has(l))return arguments.length<3?l:u;throw new TypeError("Private element is not present on this object")}function Jk(p,l){if(l.has(p))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ee(p,l){return p.get(ye(p,l))}function Ht(p,l,u){Jk(p,l),l.set(p,u)}function gt(p,l,u){return p.set(ye(p,l),u),u}function ol(p,l,u){return u(ye(p,l))}function Js(p,l){Jk(p,l),l.add(p)}function S(p,l,u){return(l="symbol"==typeof(g=function(m,v){if("object"!=typeof m||!m)return m;var y=m[Symbol.toPrimitive];if(void 0!==y){var x=y.call(m,"string");if("object"!=typeof x)return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(l))?g:g+"")in p?Object.defineProperty(p,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):p[l]=u,p;var g}function Ze(p,l,u,f){return new(u||(u=Promise))(function(g,m){function v(w){try{x(f.next(w))}catch(C){m(C)}}function y(w){try{x(f.throw(w))}catch(C){m(C)}}function x(w){var C;w.done?g(w.value):(C=w.value,C instanceof u?C:new u(function(_){_(C)})).then(v,y)}x((f=f.apply(p,l||[])).next())})}function K(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function ke(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}var Ii,_n,vn,LS,cc,Ho,ho,ys,Qk,Ca,Y1,Nm,X1,Ue,q1,FS,Z1,J1,NS,Q1,K1,Kk,bd,kf,Ss,BS,US,Wo,_d,e3,Of,t3,i3,Lf,Ff,Nf,n3,kr,eO,tO,ba,s3,Ms,Bf,al,Sd,iO,nO,ch,r3,hh,_a,Bm,o3,a3,l3,Ed,sO,rO,VS,oO,jS,HS,Hn,Qs,Um,Zn,Uf,aO,Vm,c3,Go,Vf,WS,GS,lO,cO,hO,dO,uO,zS,fO,pO,gO,jm,mO,vO,ks,$S,YS,uo,jf,Os,Oi,h3,Hf,Hm,XS,qS,ZS,d3,fo,hc,Wm,Gm,zm,u3,f3,yO,Wf,p3,JS,QS,xO,wO,CO,g3,KS,e6,Gf,bO,dh,uh,m3,t6,Td,$m,v3,_O,zo,Dd,zf,Ad,Ym,SO,Xm,EO,TO,fh,y3,dc,Id,Pd,DO,AO,IO,PO,RO,ze,$f,ph,fn,pn,Yf,uc,fc,i6,MO,kO,OO;"function"==typeof SuppressedError&&SuppressedError,function(p){p.logInfo="logInfo",p.logDebug="logDebug",p.logAll="logAll",p.imgIO="imgIO",p.core="imgCore",p.imgProc="imgProc",p.pdfR="pdfReader",p.pdfW="pdfWriter",p.crypto="crypto",p.binaryBlobType="application/octet-stream",p.wasmExtension=".wasm"}(Ii||(Ii={})),function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(_n||(_n={})),function(p){p.pending="pending",p.ready="ready",p.failed="failed",p.destroyed="destroyed",p.init="init"}(vn||(vn={})),function(p){p.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",p.TIMEOUT="Timeout no Response = ",p.FILE_STREAM_ERROR="File Stream Error = ",p.WASM_EXCEPTION_ERROR="An WASM exception occurred."}(LS||(LS={})),function(p){p[p.LONG_KEY=0]="LONG_KEY",p[p.DLS_KEY=1]="DLS_KEY"}(cc||(cc={})),function(p){p[p.wasmSucceed=0]="wasmSucceed",p[p.wasmBase=-4e3]="wasmBase",p[p.wasmException=-4001]="wasmException",p[p.wasmNoModule=-4002]="wasmNoModule",p[p.wasmJsBase=-4100]="wasmJsBase",p[p.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",p[p.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",p[p.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",p[p.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",p[p.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",p[p.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",p[p.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",p[p.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",p[p.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",p[p.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",p[p.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",p[p.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed"}(Ho||(Ho={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(ho||(ho={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(ys||(ys={})),function(p){p[p.SF_DEF=0]="SF_DEF",p[p.SF_ENABLE=1]="SF_ENABLE",p[p.SF_DISABLE=2]="SF_DISABLE"}(Qk||(Qk={})),function(p){p.imgIOVer="2.0.0",p.coreVer="2.0.0",p.imgProcVer="2.0.0",p.pdfRVer="2.0.0",p.pdfWVer="2.0.0",p.cryptoVer="2.0.0"}(kr||(kr={}));class ut{static setLogFunc(l,u,f){ke(this,Ca,l,"f",Y1),ke(this,Ca,u,"f",Nm),ke(this,Ca,f,"f",X1)}static get level(){return K(this,Ca,"f",Y1)}static get func(){return K(this,Ca,"f",Nm)}static get context(){return K(this,Ca,"f",X1)}static logAll(l){this.log(Ii.logAll,l)}static logD(l){this.log(Ii.logDebug,l)}static log(l,u){K(this,Ca,"f",Nm)&&K(this,Ca,"f",Y1)===l&&K(this,Ca,"f",Nm).call(this,u,K(this,Ca,"f",X1))}}Ca=ut,Y1={value:""},Nm={value:void 0},X1={value:null};class et{static unload(){ke(this,Ue,"","f",q1),ke(this,Ue,"","f",Z1),ke(this,Ue,null,"f",J1),ke(this,Ue,{name:Ii.imgIO,workerName:_n.core,autoLoad:!1,ver:kr.imgIOVer,prefixName:et.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:K(et,Ue,"f",Wo)},"f",t3),ke(this,Ue,{name:Ii.crypto,workerName:_n.core,autoLoad:!1,ver:kr.cryptoVer,prefixName:et.CryptoPrefixName,dependencyModules:[Ii.imgIO],fetchOptions:K(et,Ue,"f",Wo)},"f",i3),ke(this,Ue,{name:Ii.pdfR,workerName:_n.reader,autoLoad:!1,ver:kr.pdfRVer,prefixName:et.PdfReaderPrefixName,dependencyModules:[Ii.imgIO,Ii.core],fetchOptions:K(et,Ue,"f",Wo)},"f",Lf),ke(this,Ue,{name:Ii.core,workerName:_n.core,autoLoad:!1,ver:kr.coreVer,prefixName:et.ImagecorePrefixName,dependencyModules:[Ii.imgIO],fetchOptions:K(et,Ue,"f",Wo)},"f",Ff),ke(this,Ue,{name:Ii.imgProc,workerName:_n.core,autoLoad:!1,ver:kr.imgProcVer,prefixName:et.ImageProcPrefixName,dependencyModules:[Ii.imgIO,Ii.core],useSimd:et.UseSimd},"f",Nf),ut.setLogFunc("",void 0,null)}static get UseSimd(){return K(this,Ue,"f",Q1)}static set UseSimd(l){ke(this,Ue,l,"f",Q1)}static get License(){return K(this,Ue,"f",q1)}static set License(l){ke(this,Ue,l,"f",q1)}static get LicMode(){return K(this,Ue,"f",FS)}static set LicMode(l){ke(this,Ue,l,"f",FS),K(this,Ue,"m",Kk).call(this)}static get UUID(){return K(this,Ue,"f",Z1)}static set UUID(l){ke(this,Ue,l,"f",Z1)}static get NavInfo(){return K(this,Ue,"f",J1)}static set NavInfo(l){ke(this,Ue,l,"f",J1)}static get Mobile(){return K(this,Ue,"f",NS)}static set Mobile(l){ke(this,Ue,l,"f",NS)}static get DefHeapSize(){return K(this,Ue,"f",bd)}static set DefHeapSize(l){ke(this,Ue,l,"f",bd)}static get MaxHeapSize(){return K(this,Ue,"f",kf)}static get HeapConfig(){return K(this,Ue,"m",BS).call(this),Object.assign({},K(this,Ue,"f",Ss))}static getWorkerHeap(l){return void 0!==K(this,Ue,"f",Ss)[l]?K(this,Ue,"f",Ss)[l]:{maxHeapSize:K(this,Ue,"f",kf),initHeapSize:K(this,Ue,"f",bd)}}static UpdateHeapConfig(l,u,f){K(this,Ue,"m",BS).call(this),u&&void 0!==K(this,Ue,"f",Ss)[l]&&(K(this,Ue,"f",Ss)[l].maxHeapSize=u),f&&void 0!==K(this,Ue,"f",Ss)[l]&&(K(this,Ue,"f",Ss)[l].initHeapSize=f)}static get ImageIOWorkerJS(){return"ddv-imageio.worker.js?v="+kr.imgIOVer}static get PdfReaderWorkerJS(){return"dynamsoft.pdfReader_wasm-"+kr.pdfRVer+".js"}static get ImageIOPrefixName(){return"ddv-imageio"}static get ImagecorePrefixName(){return"ddv-imagecore"}static get ImageProcPrefixName(){return"ddv-imageproc"}static get PdfReaderPrefixName(){return"ddv-pdfreader"}static get CryptoPrefixName(){return"ddv-crypto"}static get ImageIOResource(){return K(this,Ue,"f",_d)}static set ImageIOResource(l){ke(this,Ue,K(this,Ue,"m",US).call(this,l),"f",_d),K(this,Ue,"m",Of).call(this,K(this,Ue,"f",_d),K(this,Ue,"f",t3)),K(this,Ue,"m",Of).call(this,K(this,Ue,"f",_d),K(this,Ue,"f",i3)),K(this,Ue,"m",Of).call(this,K(this,Ue,"f",_d),K(this,Ue,"f",Ff)),K(this,Ue,"m",Of).call(this,K(this,Ue,"f",_d),K(this,Ue,"f",Nf))}static get PdfReaderResource(){return K(this,Ue,"f",e3)}static set PdfReaderResource(l){l.useFastCompEdition=!1,ke(this,Ue,K(this,Ue,"m",US).call(this,l),"f",e3),K(this,Ue,"m",Of).call(this,K(this,Ue,"f",e3),K(this,Ue,"f",Lf)),this.PdfReaderModule.singleInstance=!0}static get ImageIOModule(){return K(this,Ue,"f",t3)}static get CryptoModule(){return K(this,Ue,"f",i3)}static get PdfReaderModule(){return K(this,Ue,"f",Lf)}static get ImagecoreModule(){return K(this,Ue,"f",Ff)}static get ImageReadereModule(){const l=Object.assign({},K(this,Ue,"f",Ff));return l.workerName=_n.reader,l}static get ImageProcModule(){return K(this,Ue,"f",Nf)}static get DetectorModule(){return ke(this,Ue,Object.assign({},K(this,Ue,"f",Nf)),"f",n3),K(this,Ue,"f",n3).workerName=_n.detector,K(this,Ue,"f",n3)}static get PdfWriterModule(){const l=Object.assign({},K(this,Ue,"f",Lf));return l.workerName=_n.core,l}static setLogFunc(l,u,f){ut.setLogFunc(l,u,f)}}Ue=et,K1=function(p){this.LicMode==cc.DLS_KEY&&p.dependencyModules&&-1!=p.dependencyModules.indexOf(Ii.imgIO)&&-1==p.dependencyModules.indexOf(Ii.crypto)&&p.dependencyModules.push(Ii.crypto)},Kk=function(){K(this,Ue,"m",K1).call(this,K(this,Ue,"f",Ff)),K(this,Ue,"m",K1).call(this,K(this,Ue,"f",Nf)),K(this,Ue,"m",K1).call(this,K(this,Ue,"f",Lf))},BS=function(){0===Object.keys(K(this,Ue,"f",Ss)).length&&(K(this,Ue,"f",Ss)[_n.core]={},K(this,Ue,"f",Ss)[_n.core].maxHeapSize=K(this,Ue,"f",kf),K(this,Ue,"f",Ss)[_n.core].initHeapSize=K(this,Ue,"f",bd),K(this,Ue,"f",Ss)[_n.reader]={},K(this,Ue,"f",Ss)[_n.reader].maxHeapSize=K(this,Ue,"f",kf),K(this,Ue,"f",Ss)[_n.reader].initHeapSize=K(this,Ue,"f",bd),K(this,Ue,"f",Ss)[_n.detector]={},K(this,Ue,"f",Ss)[_n.detector].maxHeapSize=K(this,Ue,"f",kf),K(this,Ue,"f",Ss)[_n.detector].initHeapSize=K(this,Ue,"f",bd))},US=function(p){var l,u,f;let g={crossScript:!1,resourceDir:p.resourceDir,workerScript:p.workerScript,useFastCompEdition:null!==(l=p.useFastCompEdition)&&void 0!==l&&l,useSimd:null!==(u=p.useSimd)&&void 0!==u?u:K(this,Ue,"f",Q1),fetchOptions:null!==(f=p.fetchOptions)&&void 0!==f?f:K(this,Ue,"f",Wo)};return g.workerScript=p.resourceDir+p.workerScript,g.workerScript.startsWith("http://")||g.workerScript.startsWith("https://")?(g.resourceDir=p.resourceDir,g.workerScript.startsWith(location.origin)||(g.crossScript=!0)):p.resourceDir.startsWith("/")?null!=location.origin&&(g.resourceDir=location.origin+p.resourceDir):null!=location.href&&(g.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+p.resourceDir),g.resourceDir.endsWith("/")||(g.resourceDir+="/"),p.useFastCompEdition&&(g.resourceDir+="fastcomp/",g.workerScript=g.resourceDir+p.workerScript),g},Of=function(p,l){l.resourceDir=p.resourceDir,l.crossScript=p.crossScript,l.useSimd=l.name===Ii.imgProc&&p.useSimd,l.script=p.workerScript,l.fetchOptions=p.fetchOptions},q1={value:""},FS={value:cc.LONG_KEY},Z1={value:""},J1={value:null},NS={value:!1},Q1={value:!1},bd={value:32},kf={value:200},Ss={value:Object.create(null)},_d={value:{resourceDir:"",workerScript:et.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:K(et,Ue,"f",Wo={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}})}},e3={value:{resourceDir:"",workerScript:et.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:K(et,Ue,"f",Wo)}},t3={value:{name:Ii.imgIO,workerName:_n.core,autoLoad:!1,ver:kr.imgIOVer,prefixName:et.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:K(et,Ue,"f",Wo)}},i3={value:{name:Ii.crypto,workerName:_n.core,autoLoad:!1,ver:kr.cryptoVer,prefixName:et.CryptoPrefixName,dependencyModules:[Ii.imgIO],fetchOptions:K(et,Ue,"f",Wo)}},Lf={value:{name:Ii.pdfR,workerName:_n.reader,autoLoad:!1,ver:kr.pdfRVer,prefixName:et.PdfReaderPrefixName,dependencyModules:[Ii.imgIO,Ii.core],fetchOptions:K(et,Ue,"f",Wo)}},Ff={value:{name:Ii.core,workerName:_n.core,autoLoad:!1,ver:kr.coreVer,prefixName:et.ImagecorePrefixName,dependencyModules:[Ii.imgIO],fetchOptions:K(et,Ue,"f",Wo)}},Nf={value:{name:Ii.imgProc,workerName:_n.core,autoLoad:!1,ver:kr.imgProcVer,prefixName:et.ImageProcPrefixName,dependencyModules:[Ii.imgIO,Ii.core],useSimd:et.UseSimd}},n3={value:void 0};class gh{static read(l){return new Promise(function(u,f){let g=Object.prototype.toString.call(l);if("[object String]"===g){if(0===l.indexOf("blob:")||l.indexOf(".jpg")>0||l.indexOf(".jpeg")>0||l.indexOf(".png")>0||l.indexOf(".bmp")>0||l.indexOf(".dib")>0||l.indexOf(".pdf")>0||l.indexOf(".tiff")>0||l.indexOf(".tif")>0)return fetch(l,{mode:"cors"}).then(function(m){return m.arrayBuffer()}).then(function(m){return u(m)}).catch(function(m){return Promise.reject(m)});f("Error url: Can not read the file URL")}else if("[object Blob]"===g||"[object FileList]"===g||"[object File]"===g){let m=l;"[object FileList]"!==g&&"[object File]"!==g||(m=l[0]?l[0]:l),K(gh,eO,"m",tO).call(gh,m,u,f)}else"[object ArrayBuffer]"===g||"[object Uint8ClampedArray]"===g?u(l):f("Not support source type: "+g)})}}eO=gh,tO=function(p,l,u){let f,g,m=0;try{f=new ArrayBuffer(p.size),g=new Uint8Array(f)}catch(v){u(v)}!function v(){const y=new FileReader;y.onload=function(C){var _;if(null===(_=null==C?void 0:C.target)||void 0===_?void 0:_.result){const T=C.target.result;g.set(new Uint8Array(T),m),m+=T.byteLength,m<p.size?v():l(f)}else u(C)},y.onerror=function(C){u(C)},y.onabort=function(C){u(C)};const x=Math.min(m+1048576,p.size),w=p.slice(m,x);y.readAsArrayBuffer(w)}()};class Oee{constructor(l,u,f,g,m,v){ba.add(this),s3.set(this,void 0),Ms.set(this,void 0),Bf.set(this,void 0),al.set(this,void 0),Sd.set(this,void 0),iO.set(this,void 0),nO.set(this,void 0),ch.set(this,void 0),r3.set(this,void 0),hh.set(this,void 0),_a.set(this,void 0),Bm.set(this,void 0),o3.set(this,void 0),a3.set(this,0),l3.set(this,{}),Ed.set(this,null),ke(this,s3,l,"f"),ke(this,r3,g,"f"),ke(this,o3,f,"f"),ke(this,Bf,[],"f"),ke(this,al,!1,"f"),ke(this,Sd,!1,"f"),ke(this,a3,u,"f"),ke(this,Ed,Object.create(null),"f"),K(this,l3,"f").modulesInfo=[],ke(this,_a,Object.create(null),"f"),ke(this,ch,null,"f"),ke(this,hh,0,"f"),ke(this,Bm,0,"f"),ke(this,Ms,K(this,ba,"m",rO).call(this,K(this,s3,"f")),"f"),K(this,Ms,"f").on("message",K(this,ba,"m",oO),this),K(this,Ms,"f").on("error",K(this,ba,"m",VS),this),K(this,Ms,"f").on("exit",function(y,x,w){let C="Worker #terminated Unexpectedly\n";C+=" exitCode: `"+y+"`\n",C+=" signalCode: `"+x+"`\n",C+=" #script: `"+l+"`\n",K(w,ba,"m",VS).call(w,new Error(C),w)},this)}get WorkerScript(){return K(this,r3,"f")}get id(){return K(this,a3,"f")}get Module(){return K(this,l3,"f")}get Instances(){return K(this,Ed,"f")}get WorkerName(){return K(this,o3,"f")}execTask(l,u,f){f||((f={}).promise=new Promise(function(v,y){f.resolve=v,f.reject=y}));let g=ke(this,Bm,+K(this,Bm,"f")+1,"f");K(this,_a,"f")[g]={id:g,insId:u.insId,resolver:f,cost:u.cost},delete u.cost;let m={id:g,func:l,params:u};return ut.logD("["+u.insId+"] "+l+" send"),K(this,Sd,"f")?f.reject(new Error("Worker is #terminated")):K(this,al,"f")?f.reject(new Error("Worker is #terminating")):K(this,Ms,"f").wasmReady||K(this,Ms,"f").ready&&"loadWasm"===l?K(this,Ms,"f").send(m):K(this,Bf,"f").push(m),f.promise}get memSize(){return K(this,hh,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(K(this,_a,"f")).length}get alive(){return!K(this,al,"f")&&!K(this,Sd,"f")}terminate(l,u){if(ut.logD("["+this.id+"] worker terminate "+l),l&&K(this,ba,"m",HS).call(this,"Worker has been #terminated"),"function"==typeof u&&ke(this,ch,u,"f"),this.busy)ke(this,al,!0,"f");else{if(K(this,Ms,"f")){if("function"!=typeof K(this,Ms,"f").terminate)throw new Error("Failed to terminate worker");ut.logD("["+this.id+"] will be terminated"),K(this,Ms,"f").terminate(),ke(this,Ms,null,"f")}ke(this,al,!1,"f"),ke(this,Sd,!0,"f"),K(this,ch,"f")&&K(this,ch,"f").call(this,this)}}hasInstance(l){if(l){const u=K(this,Ed,"f")[l];if(u)return 0!=Object.keys(u).length}else{const u=Object.keys(K(this,Ed,"f"));for(const f of u)if(0!=Object.keys(K(this,Ed,"f")[f]).length)return!0}return!1}exceedMaxMemory(){const l=1024*et.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return!!(K(this,hh,"f")&&K(this,hh,"f")>l&&0!=l)&&(ut.logD("[w-"+this.id+"] current memSize="+K(this,hh,"f")+", max="+l),!0)}shouldBeFreed(){return!(!this.exceedMaxMemory()||this.hasInstance(void 0)||(ut.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}s3=new WeakMap,Ms=new WeakMap,Bf=new WeakMap,al=new WeakMap,Sd=new WeakMap,iO=new WeakMap,nO=new WeakMap,ch=new WeakMap,r3=new WeakMap,hh=new WeakMap,_a=new WeakMap,Bm=new WeakMap,o3=new WeakMap,a3=new WeakMap,l3=new WeakMap,Ed=new WeakMap,ba=new WeakSet,sO=function(p){let l=new Error(""),u=Object.keys(p);for(let f=0;f<u.length;f++)l[u[f]]=p[u[f]];return l},rO=function(p){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let l=new Worker(p,{name:this.WorkerName});return l.on=function(u,f,g){this.addEventListener(u,function(m){"exit"===u?f(m.data,"",g):f(m.data,g)})},l.send=function(u){if(null!=u&&null!=u.params&&null!=u.params.input){let f=Object.prototype.toString.call(u.params.input);if("[object Array]"===Object.prototype.toString.call(u.params.input)){if(f=Object.prototype.toString.call(u.params.input[0]),"[object ArrayBuffer]"===f||"[object Uint8ClampedArray]"===f||"[object Uint8Array]"===f)return void this.postMessage(u,[null!=u.params.input[0].buffer?u.params.input[0].buffer:u.params.input[0]])}else if("[object ArrayBuffer]"===f||"[object Uint8ClampedArray]"===f||"[object Uint8Array]"===f)return void this.postMessage(u,[null!=u.params.input.buffer?u.params.input.buffer:u.params.input])}this.postMessage(u)},l},VS=function(p,l){ke(l,Sd,!0,"f"),ut.logD("[js]["+l.id+"] worker error "+JSON.stringify(p)),K(l,al,"f")&&K(l,ch,"f")&&K(l,ch,"f").call(l,l),ke(l,al,!1,"f"),K(l,ba,"m",HS).call(l)},oO=function(p,l){let u=p.id,f=K(l,_a,"f")[u];if(p&&p.cost&&f&&f.cost){const g=f.cost;g.exec=p.cost;const m=Date.now();g.total=m-g.ctime,g.msgQueue=p.ctime-g.time;const v=m-p.time;delete g.time,delete g.ctime,p.cost=g,p.cost.receive=v,delete p.ctime,delete p.time}if(ut.logD(p.log?p.log:p),"string"==typeof p&&"ready"===p)K(l,Ms,"f").ready=!0,setTimeout(()=>{K(l,ba,"m",jS).call(l)},0);else if(!p.log){if("object"==typeof p){let g=p.result;"object"==typeof g?(null!=g.errorCode&&(g.code=g.errorCode,delete g.errorCode),null!=g.errorMessage&&(g.message=g.errorMessage,delete g.errorMessage)):"string"==typeof g&&(g=g.replace('"errorCode"','"code"'),g=g.replace("'errorCode'","'code'"),g=g.replace('"errorMessage"','"message"'),g=g.replace("'errorMessage'","'message'"),p.result=g),null!=p.memSize&&ke(l,hh,p.memSize,"f")}if(void 0!==f){const g=f.insId;delete K(l,_a,"f")[u],ut.logD("["+g+"] "+p.func+" received"),!0===K(l,al,"f")&&l.terminate(),"loadWasm"===p.func&&null!=p.result&&(K(l,Ms,"f").wasmReady=!0,setTimeout(()=>{K(l,ba,"m",jS).call(l)},0)),p.error?f.resolver.reject(K(l,ba,"m",sO).call(l,p.error)):p.result&&f.resolver.resolve(p.result)}}},jS=function(){this.alive&&(K(this,Bf,"f").forEach(K(this,Ms,"f").send.bind(K(this,Ms,"f"))),ke(this,Bf,[],"f"))},HS=function(p){for(let l in K(this,_a,"f"))void 0!==K(this,_a,"f")[l]&&K(this,_a,"f")[l].resolver.reject(new Error(p));ke(this,_a,Object.create(null),"f")};class Ei{constructor(){Hn.add(this),Zn.set(this,[]),Uf.set(this,4),aO.set(this,60),Vm.set(this,!1),c3.set(this,0),Vf.set(this,!1)}static get Instance(){return K(this,Qs,"f",Um)||ke(this,Qs,new Ei,"f",Um),K(this,Qs,"f",Um)}get Terminated(){return K(this,Vm,"f")}getModuleLoadedError(l){for(let u of K(Ei,Qs,"f",Go))if(u.name==l)return u.error}getModuleStatus(l){for(let u of K(Ei,Qs,"f",Go))if(u.name==l)return u.status;return""}addModules(l,u){let f=!1;if(K(Ei,Qs,"f",Go).forEach(function(g,m,v){g.name==l.name&&(g.ver==l.ver?f=!0:v.splice(m,1))}),!f){let g=l;g.status=u||"",g.wasmModule=null,K(Ei,Qs,"f",Go).push(g)}}loadModule(l,u){return Ze(this,void 0,void 0,function*(){null==u&&(u=0!=K(this,Hn,"m",zS).call(this,l).length),this.addModules(l);for(let v of l.dependencyModules)v===Ii.imgIO?(this.addModules(et.ImageIOModule,vn.pending),et.LicMode===cc.DLS_KEY&&l.name!=Ii.crypto&&this.addModules(et.CryptoModule,vn.pending)):v===Ii.core&&this.addModules(et.ImagecoreModule,vn.pending);let f,g;for(let v of K(Ei,Qs,"f",Go))if(v.name===l.name){if(v.status===vn.pending)return!1;if(v.wasmModule){if(u)return!0;f=v.wasmModule,g=v.wasmBinary;break}break}let m=null;if(f)m=l,m.wasmModule=f,m.wasmBinary=g,m.status=vn.pending;else if(m=l,""===m.status)m.status=vn.pending,m.wasmModule=null;else{if(m.status===vn.pending)return!1;u||(m.error={code:0,message:""},m.status=vn.pending)}return K(this,Hn,"m",WS).call(this,m)})}get busy(){K(this,Hn,"m",jm).call(this);let l=K(this,Zn,"f");for(let u of l)if(u.busy)return!0;return!1}getWorker(l,u){return Ze(this,void 0,void 0,function*(){if(K(this,Hn,"m",fO).call(this,l.name))return K(this,Hn,"m",gO).call(this),{worker:null,workers:0};let f=K(this,Hn,"m",zS).call(this,l,!0);return 0!=f.length?{worker:K(this,Hn,"m",mO).call(this,f,u,l),workers:f.length}:(yield this.loadModule(l,!1),{worker:null,workers:0})})}removeInstanceInWorker(l,u,f,g){if(K(this,Hn,"m",vO).call(this,u,l.name,f),g&&u&&u.shouldBeFreed()){let m=K(this,Zn,"f").indexOf(u);-1!==m&&K(this,Zn,"f").splice(m,1)}}terminate(l){ke(Ei,Qs,null,"f",Um),ut.logD("worker pool terminate "+l),ke(this,Vm,!0,"f");let u=[],f=K(this,Zn,"f").slice();return ke(this,Zn,[],"f"),f.forEach(function(g){let m={};m.promise=new Promise(function(v,y){m.resolve=v,m.reject=y}),u.push(m.promise),g.terminate(l,function(v){m.resolve(v)})}),Promise.all(u)}static unload(){ke(this,Qs,new Array,"f",Go)}terminateWorker(l){K(this,Zn,"f").splice(0,K(this,Zn,"f").length,...K(this,Zn,"f").filter(u=>u.WorkerName!==l||(u.terminate(!0),!1)))}getMemoryUsed(){let l=K(this,Zn,"f"),u=[],f=0;for(let g of l)g&&null!=g.memSize&&(u[f]={},u[f].size=g.memSize,u[f].limit=1024*et.getWorkerHeap(g.WorkerName).maxHeapSize*1024,u[f].name=g.WorkerName,u[f].id=g.id,f+=1);return u}}Qs=Ei,Zn=new WeakMap,Uf=new WeakMap,aO=new WeakMap,Vm=new WeakMap,c3=new WeakMap,Vf=new WeakMap,Hn=new WeakSet,WS=function(p){return Ze(this,void 0,void 0,function*(){let l=this,u=yield K(this,Hn,"m",dO).call(this,p);if(u){let f={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:p.fetchOptions}};if(f.params.resourceDir=p.resourceDir,f.params.initMemory=et.getWorkerHeap(p.workerName).initHeapSize,f.params.module){for(let g of K(Ei,Qs,"f",Go))for(let m of p.dependencyModules)m==g.name&&f.params.module.modulesInfo.push(g);f.params.module.modulesInfo.push(p)}yield K(this,Hn,"m",lO).call(this,u,f),ke(l,Uf,K(l,Hn,"m",hO).call(l),"f"),p.status===vn.pending&&(p.status="")}else p.status="",p.wasmModule=null})},GS=function(p,l,u,f){for(let g of K(Ei,Qs,"f",Go))if(g.name===p){g.status=l,g.wasmModule=u.wasmModule,g.wasmBinary=u.wasmBinary,g.error=f;break}},lO=function(p,l,u){return Ze(this,void 0,void 0,function*(){let f=this;try{const g=yield p.execTask(l.func,l.params);let m=!1;return void 0===g.code||g.modules?m=K(f,Hn,"m",cO).call(f,g,p):ut.logD(g),m}catch(g){return ut.logD(g),!1}finally{u&&u()}})},cO=function(p,l){if(ut.logD("handleWasmLoad:"),ut.logD(p),K(this,Vm,"f"))return l.terminate(),!1;if(("object"!=typeof p||null==p.modules)&&"object"==typeof p)return!1;let u=!1;for(const f of p.modules)p.code?(K(this,Hn,"m",GS).call(this,f.name,vn.failed,null,{code:p.code,message:p.message}),l.Module.modulesInfo[f.name]=!1):(K(this,Hn,"m",GS).call(this,f.name,vn.ready,f.wasmResource,void 0),l.Module.modulesInfo[f.name]=!0,u=!0);return u},hO=function(){let p=2;return"hardwareConcurrency"in self.navigator&&(p=self.navigator.hardwareConcurrency),Math.max(Math.min(K(this,Uf,"f"),Math.max(K(this,Uf,"f"),p/2)),1)},dO=function(p){return Ze(this,void 0,void 0,function*(){K(this,Hn,"m",jm).call(this);let l=K(this,Zn,"f");for(let u of l)if(u.WorkerName===p.workerName)return u.busy?null:u;return K(this,Hn,"m",uO).call(this,p)})},uO=function(p){var l;return Ze(this,void 0,void 0,function*(){let u=this,f=K(u,Zn,"f");if(f.length<K(u,Uf,"f")&&!K(u,Vf,"f")){ke(u,Vf,!0,"f");let g=p.script;p.crossScript&&(g=yield class kee{static fetchRetry(l,u,f,g){let m=u.retries,v=u.retryDelay;return new Promise(function(y,x){const w=function(C){return fetch(l,u).then(function(_){y(_)}).catch(function(_){var T;C<m?(T=C,f&&f(_,g),setTimeout(function(){w(++T)},v)):x(_)})};return w(0)})}}.fetchRetry(p.script,p.fetchOptions,ut.func,u).then(v=>v.blob()).then(v=>URL.createObjectURL(v)).catch(v=>(ut.logD("get new worker fetch failed: "),ut.logD(v),ke(u,Vf,!1,"f"),null)));let m=new Oee(g,ke(l=u,c3,+K(l,c3,"f")+1,"f"),p.workerName,p.script,ut.func,ut.context);return f.push(m),ke(u,Vf,!1,"f"),ut.logAll(f),ut.logD("[wl-"+K(u,Zn,"f").length+"] got new worker w-"+m.id+"("+m.WorkerName+") succeed!"),m}return null})},zS=function(p,l){K(this,Hn,"m",jm).call(this);let u=K(this,Zn,"f");ut.logAll(u);let f=[];for(let g of u)if(g.Module.modulesInfo[p.name]){let m=!0;if(p.dependencyModules.forEach(v=>{g.Module.modulesInfo[v]||(m=!1)}),!m||l&&g.WorkerName!==p.workerName)continue;f.push(g)}return ut.logAll("[wl-"+u.length+"] got workers for module "+p.name),ut.logAll(f),f},fO=function(p){for(let l of K(Ei,Qs,"f",Go))if(l.name===p&&l.status===vn.pending)return!0;return!1},pO=function(){return Ze(this,void 0,void 0,function*(){this.terminate(!0);for(let p of K(Ei,Qs,"f",Go))yield K(this,Hn,"m",WS).call(this,p)})},gO=function(){K(this,Hn,"m",jm).call(this),0==K(this,Zn,"f").length&&0!=K(Ei,Qs,"f",Go).length&&(ut.logD("no worker ready, reinit"),K(this,Hn,"m",pO).call(this))},jm=function(){K(this,Zn,"f").splice(0,K(this,Zn,"f").length,...K(this,Zn,"f").filter(function(p){return p.alive}))},mO=function(p,l,u){ut.logAll("[wl-"+K(this,Zn,"f").length+"] getWorkerByIntanceId"),ut.logAll(p);let f,g=9007199254740991;for(let m of p){if(u.singleInstance&&m.hasInstance(u.name))continue;const v=m.Instances[u.name];if(!v||null!=v[l]){f=m;break}{let y=m.howManyTasks;y<g&&(f=m,g=y)}}if(f){if(f.shouldBeFreed())return null;const m=f.Instances[u.name];if(m)m[l]="";else{const v=Object.create(null);v[l]="",f.Instances[u.name]=v}return ut.logAll(p),ut.logD("[wl-"+p.length+"]["+l+"] got worker w-"+f.id),f}return ut.logAll("#getWorkerByIntanceId: no suitable worker"),null},vO=function(p,l,u){let f=K(this,Zn,"f");ut.logAll("removeInstanceInWorkerInner"),ut.logAll(f);for(let g of f)if(g===p){const m=g.Instances[l];if(m){null!=m[u]?(delete m[u],ut.logAll(f),ut.logD("[w-"+g.id+"] removeInstanceInWorkerInner "+u+" in "+p.id+" succeed!")):ut.logD("[w-"+g.id+"] not found instance "+u);break}}},Um={value:null},Go={value:new Array};class qm{constructor(l,u){var f,g,m,v;ks.add(this),uo.set(this,void 0),this._outputType=ho.IT_JPG,this._inputType=ho.IT_ALL,this._jpegQuality=80,jf.set(this,null!==(f=et.License)&&void 0!==f?f:""),Os.set(this,[]),Oi.set(this,null),h3.set(this,0),Hf.set(this,ke(v=qm,$S,+K(v,$S,"f",YS)+1,"f",YS)),Hm.set(this,null),XS.set(this,JSON.parse(JSON.stringify(et.NavInfo))),qS.set(this,et.Mobile),ZS.set(this,location.origin),d3.set(this,""),fo.set(this,vn.init),hc.set(this,!1),Wm.set(this,null!==(g=et.LicMode)&&void 0!==g?g:cc.LONG_KEY),Gm.set(this,null!==(m=et.UUID)&&void 0!==m?m:""),zm.set(this,0),u3.set(this,!1),f3.set(this,!1),this._handleBooleanResult=function(y,x){return!0},ke(this,uo,l,"f"),ke(this,jf,null!=u?u:et.License,"f")}_prepareModule(l){}get workerId(){return K(this,Oi,"f")&&K(this,Oi,"f").alive?K(this,Oi,"f").id:0}get id(){return K(this,Hf,"f")}hasTask(){return K(this,Os,"f").length>0}_canTerminateWork(){return!1}_makeSureWorkerMemoryNotExceed(){return!(K(this,Oi,"f")&&K(this,Oi,"f").alive&&this._canTerminateWork()&&K(this,Oi,"f").exceedMaxMemory()&&(ut.logD(`[${this.id}] try to termiate worker [${K(this,Oi,"f").id}]`),K(this,Oi,"f").terminate(!0),ke(this,Oi,null,"f"),ke(this,fo,vn.init,"f"),1))}_workerChanged(l){}_handleBasicResult(l,u){return delete l.code,delete l.message,l}_handleImageData(l,u){var f,g,m;if("object"==typeof l.imageData)if(null!=l.imageCount&&l.imageCount>1)for(let v=0;v<l.imageCount;v++)l.imageData[v]=K(f=u.context,ks,"m",p3).call(f,l.imageData[v],l.blobType,u.params.returnBlob);else l.imageData=K(g=u.context,ks,"m",p3).call(g,l.imageData,l.blobType,u.params.returnBlob);return"object"==typeof l.pdfData&&(l.pdfData=K(m=u.context,ks,"m",p3).call(m,l.pdfData,l.blobType,u.params.returnBlob)),l}_handleResult(l,u){var f,g;let m=K(g=u.context,ks,"m",JS).call(g,l);if(void 0===m.code||!m.code&&"Successful."===m.message)m=u.handleResult(m,u),setTimeout(()=>{var v;K(v=u.context,ks,"m",Wf).call(v)},0),(0,u.resolve)(m);else{let v={code:m.code,message:m.code===Ho.wasmException?LS.WASM_EXCEPTION_ERROR+"("+(null===(f=u.params)||void 0===f?void 0:f.moduleName)+":"+u.func+":"+m.message+")":m.message};u.context.terminated?u.resolve(v):u.reject(v)}}_execTask(l){let u=this,f=K(u,Oi,"f");if(ut.logAll(l),f)try{if(l.params.cost){const g=l.params.cost.time;l.params.cost.time=Date.now(),l.params.cost.taskQueue=l.params.cost.time-g}f.execTask(l.func,l.params).then(function(g){u._handleResult(K(u,ks,"m",JS).call(u,g),l)}).catch(function(g){ut.logD(g),setTimeout(()=>{K(u,ks,"m",Wf).call(u)},0);let m=g;"object"==typeof g&&null!=g.message&&(m=g.message);let v={code:Ho.wasmJsWorkerRunFailed,message:m};K(u,hc,"f")?l.resolve(v):l.reject(v)})}catch(g){setTimeout(()=>{K(u,ks,"m",Wf).call(u)},0),ut.logD(g);let m={code:Ho.wasmJsWorkerRunException,message:g.message,stack:g.stack};K(u,hc,"f")?l.resolve(m):l.reject(m)}}_cancelAllTasks(l,u){for(let f of K(this,Os,"f"))if(void 0!==f){let g={code:l,message:u};K(this,hc,"f")?f.resolve(g):f.reject(g)}ke(this,Os,[],"f")}_createTask(l,u,f){let g={moduleName:K(this,uo,"f").name,insId:K(this,Hf,"f")},m={id:ke(this,h3,+K(this,h3,"f")+1,"f"),func:l,params:g};return m.promise=new Promise(function(v,y){m.resolve=v,m.reject=y}),m.func=l,m.context=this,m.handleResult=void 0!==f&&f?f:this._handleBasicResult,m.params.input=void 0!==u&&u?u:"",m.params.returnType=ys.RT_AUTO,m.params.returnBlob=!0,m.params.logLevel=ut.level,m.params.cost={},m.params.cost.ctime=Date.now(),m.params.cost.time=m.params.cost.ctime,m}_addTask(l,u){if(l.params.cost){const f=l.params.cost.time;l.params.cost.time=Date.now(),l.params.cost.create=l.params.cost.time-f}return K(this,fo,"f")===vn.destroyed?l.reject({code:Ho.wasmJsObjectNotInit,message:K(this,hc,"f")?"object has been disposed":"object not init"}):K(this,fo,"f")===vn.failed?l.reject({code:Ho.wasmJsObjectInitFailed,message:K(this,d3,"f")}):(u?K(this,Os,"f").unshift(l):K(this,Os,"f").push(l),K(this,ks,"m",Wf).call(this)),l.promise}terminate(l){let u=this;K(u,u3,"f")?ke(u,hc,!0,"f"):(ke(this,f3,!0,"f"),K(u,ks,"m",xO).call(u).then(function(f){ut.logD("["+u.id+"] "+K(u,uo,"f").name+" destroy return: "),ut.logD(f)}).catch(function(f){ut.logD(K(u,uo,"f").name+" destroy failed"),ut.logD(f)}).finally(()=>{let f=Ei.Instance;f&&f.removeInstanceInWorker(K(u,uo,"f"),K(u,Oi,"f"),K(u,Hf,"f"),null==l||l),ke(u,Oi,null,"f"),ke(u,hc,!0,"f"),ke(u,f3,!1,"f")})),ke(u,fo,"","f")}_readFile(l){return gh.read(l).catch(function(u){let f=u;return"object"!=typeof f&&(f={},f.code=Ho.wasmJsReadFileFailed,f.message=u),Promise.reject(f)})}updateLicense(l,u,f){return Ze(this,void 0,void 0,function*(){ke(this,jf,l,"f"),ke(this,Wm,null!=u?u:cc.LONG_KEY,"f"),ke(this,Gm,null!=f?f:"","f");let g=this,m=g._createTask("UpdateLicense");return m.params.input=[K(g,jf,"f"),K(g,Wm,"f"),K(g,Gm,"f")],g._addTask(m),m.promise})}}$S=qm,uo=new WeakMap,jf=new WeakMap,Os=new WeakMap,Oi=new WeakMap,h3=new WeakMap,Hf=new WeakMap,Hm=new WeakMap,XS=new WeakMap,qS=new WeakMap,ZS=new WeakMap,d3=new WeakMap,fo=new WeakMap,hc=new WeakMap,Wm=new WeakMap,Gm=new WeakMap,zm=new WeakMap,u3=new WeakMap,f3=new WeakMap,ks=new WeakSet,yO=function p(l){let u=null!=l?l:this;if(K(u,Hm,"f")&&clearTimeout(K(u,Hm,"f")),K(u,hc,"f")&&ut.logD(`[${u.id}"] has been termiated.(getWorker)`),K(u,Oi,"f")&&K(u,Oi,"f").alive)return K(u,Oi,"f");let f=Ei.Instance;f?f.getWorker(K(u,uo,"f"),K(u,Hf,"f")).then(g=>{if(ke(u,Oi,g.worker,"f"),K(u,Oi,"f")&&K(u,Oi,"f").alive)K(u,zm,"f")!=K(u,Oi,"f").id&&(0!==K(u,zm,"f")&&u._workerChanged(K(u,Oi,"f").id),ke(u,zm,K(u,Oi,"f").id,"f")),K(u,Os,"f").length>0&&setTimeout(()=>{K(u,ks,"m",Wf).call(u)},0);else{let m=f.getModuleLoadedError(K(u,uo,"f").name);if(null==m?void 0:m.code)return u._cancelAllTasks(Ho.wasmJsNotLoaded,m.message),K(u,Oi,"f");K(u,Os,"f").length>0&&ke(u,Hm,setTimeout(K(u,ks,"m",p),50,u),"f")}return K(u,Oi,"f")}).catch(g=>K(u,Oi,"f")):u._cancelAllTasks(Ho.wasmJsNotLoaded,"wasm env not loaded or unloaded")},Wf=function(){if(ut.logAll(K(this,Os,"f")),K(this,fo,"f")!=vn.init)if(K(this,Oi,"f")&&K(this,Oi,"f").alive){if(K(this,Os,"f").length>0){let p=K(this,Os,"f")[0];K(this,fo,"f")!==vn.ready&&"init"!==p.func||(delete K(this,Os,"f")[0],K(this,Os,"f").splice(0,1),this._execTask(p))}}else{if(K(this,Oi,"f")&&!K(this,Oi,"f").alive&&K(this,Os,"f").length>0&&"init"!=K(this,Os,"f")[0].func)return ke(this,Oi,null,"f"),void K(this,ks,"m",QS).call(this);K(this,Os,"f").length>0&&K(this,uo,"f").script&&K(this,ks,"m",yO).call(this,this)}else K(this,ks,"m",QS).call(this)},p3=function(p,l,u){if(u){let f;return f=null!=l?new Blob([p],{type:l}):new Blob([p]),f}return p},JS=function(p){try{return"string"==typeof p?JSON.parse(p):p}catch(l){return p}},QS=function(){let p=this;p._prepareModule(K(this,uo,"f"));let l=this._createTask("init");l.params.key=K(this,jf,"f"),l.params.uuid=K(this,Gm,"f"),l.params.licMode=K(this,Wm,"f"),l.params.val={nv:K(this,XS,"f"),mb:K(this,qS,"f"),dm:K(this,ZS,"f")},l.handleResult=function(u,f){return ke(f.context,fo,vn.ready,"f"),u},ke(this,fo,vn.pending,"f"),this._addTask(l,!0),l.promise.then(function(u){ut.logD("["+p.id+"] "+K(p,uo,"f").name+" init return: "),ut.logD(u),ke(p,u3,!1,"f")}).catch(function(u){ke(p,fo,vn.failed,"f"),ke(p,d3,u.message,"f"),ut.logD(K(p,uo,"f").name+" init failed"),ut.logD(u),p._cancelAllTasks(Ho.wasmJsObjectInitFailed,u.message)})},xO=function(){if(K(this,fo,"f")==vn.pending||K(this,fo,"f")==vn.ready){let p=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(p),p.promise}return Promise.resolve(!0)},YS={value:0};class mh extends qm{constructor(l,u){super(l,u)}_prepareModule(l){let u=Ei.Instance;u.addModules(et.ImageIOModule),et.LicMode===cc.DLS_KEY&&u.addModules(et.CryptoModule),K(mh,wO,"m",CO).call(mh,et.ImageIOModule,l),u.addModules(l)}}wO=mh,CO=function(p,l){l.resourceDir=p.resourceDir,l.crossScript=p.crossScript,l.script=p.script,l.useSimd=p.useSimd,l.useSimd=l.name===Ii.imgProc&&et.UseSimd,l.fetchOptions=p.fetchOptions};class LO extends mh{constructor(l){super(et.ImagecoreModule,l),g3.add(this),KS.set(this,0)}getImageFormat(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetImageFormat");const g=yield u._readFile(l);return f.params.input=g,u._addTask(f),f.promise})}readImageInfo(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("ReadImageInfo");const g=yield u._readFile(l);return f.params.input=g,u._addTask(f),f.promise})}getMD5(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetMD5");const g=yield u._readFile(l);return f.params.input=g,f.handleResult=function(m,v){return m.MD5},u._addTask(f),f.promise})}getLicenseInfo(){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetLicenseInfo"))})}getAesResult(l){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetAesResult",[l=null!=l?l:""]))})}saveImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){return(m=null!=m&&m)?K(this,g3,"m",e6).call(this,l,void 0,void 0,void 0,1,void 0,void 0,u,f,g):K(this,g3,"m",e6).call(this,l,void 0,void 0,void 0,void 0,void 0,void 0,u,f,g)})}readImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){u=null!=u?u:this._outputType,f=null!=f?f:this._jpegQuality,g=null!=g&&g,m=null!=m&&m;let v=this,y=v._createTask("ReadImage");const x=yield v._readFile(l);y.params.input=[x,u,f,m],y.params.returnType=g?ys.RT_BASE64:ys.RT_AUTO,y.params.returnBlob=!g,y.handleResult=v._handleImageData,v._addTask(y);const w=yield y.promise;if(w.srcBuffer){let C=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=C&&"[object Uint8ClampedArray]"!=C&&delete w.srcBuffer}return w})}openTiff(l,u){return Ze(this,void 0,void 0,function*(){let f=this,g=f._createTask("LoadTiff");u=null!=u&&u;const m=yield f._readFile(l);g.params.input=[m,u],f._addTask(g);const v=yield g.promise;if(v.srcBuffer){let y=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=y&&"[object Uint8ClampedArray]"!=y&&delete v.srcBuffer}return v})}readTiff(l,u,f,g){l=null!=l?l:0,u=null!=u?u:this._outputType,f=null!=f&&f,g=null!=g&&g;let m=this._createTask("ReadTiffPage");return m.params.input=[l,u,g],m.params.returnType=f?ys.RT_BASE64:ys.RT_AUTO,m.params.returnBlob=!f,m.handleResult=this._handleImageData,this._addTask(m)}readTiffInfos(l){let u=this._createTask("GetTiffPageInfos");return u.params.input=[l],this._addTask(u)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){u=null!=u?u:this._inputType,f=null!=f?f:K(this,KS,"f"),g=null!=g?g:this._jpegQuality,m=null!=m&&m;let v=this,y=v._createTask("AppendImageToTiff");const x=yield v._readFile(l);return y.params.input=[x,u,f,g,m],y.handleResult=v._handleBooleanResult,v._addTask(y),y.promise})}addTag(l,u,f){return this._addTask(this._createTask("AddTagToNextPage",[l,u,f=null!=f&&f],this._handleBooleanResult))}getTiff(l){let u=this._createTask("GetTiffStream");return u.handleResult=this._handleImageData,u.params.returnType=null!=l?l:ys.RT_AUTO,u.params.returnBlob=l!=ys.RT_AUTO,this._addTask(u)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,function(l,u){return l.memoryUsed}))}getMultiPartFile(l,u){return this._addTask(this._createTask("ds_get_file",[l,u],function(f,g){return f}))}}KS=new WeakMap,g3=new WeakSet,e6=function(p,l,u,f,g,m,v,y,x,w){return Ze(this,void 0,void 0,function*(){let C=this;l=null!=l?l:this._inputType,u=null!=u?u:0,f=null!=f?f:0,g=null!=g?g:24,m=null!=m?m:96,v=null!=v?v:96,y=null!=y?y:this._outputType,x=null!=x?x:this._jpegQuality,w=null!=w?w:ys.RT_AUTO;let _=C._createTask("SaveImage");const T=yield C._readFile(p);return _.params.input=[T,l,u,f,g,m,v,y,x],_.params.returnType=w,_.params.returnBlob=w!=ys.RT_BASE64,_.handleResult=C._handleImageData,C._addTask(_),_.promise})};class Lee extends mh{constructor(l){super(et.ImageReadereModule,l),Gf.add(this),bO.set(this,0),dh.set(this,!1),uh.set(this,null),m3.set(this,void 0),t6.set(this,0),Td.set(this,void 0),$m.set(this,void 0)}workerChanged(l){ke(this,dh,!1,"f"),l&&(ut.logD("["+this.id+"] worker changed to "+l),ke(this,t6,l,"f"))}setExternalWorkerChanged(l,u){ke(this,Td,l,"f"),ke(this,$m,u,"f")}_workerChanged(l){this.workerChanged(l),K(this,Td,"f")&&K(this,Td,"f").call(this,K(this,$m,"f"),this,l)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(ke(this,dh,!1,"f"),K(this,Td,"f")&&K(this,Td,"f").call(this,K(this,$m,"f"),this))}getImageFormat(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("GetImageFormat");const g=yield u._readFile(l.fileSource);return f.params.input=g,u._addTask(f),f.promise})}readImageInfo(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("ReadImageInfo");const g=yield u._readFile(l.fileSource);return f.params.input=g,u._addTask(f),f.promise})}readImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){u=null!=u?u:this._outputType,f=null!=f?f:this._jpegQuality,g=null!=g&&g,m=null!=m&&m;let v=this,y=v._createTask("ReadImage");const x=yield v._readFile(l.fileSource);y.params.input=[x,u,f,m],y.params.returnType=g?ys.RT_BASE64:ys.RT_AUTO,y.params.returnBlob=!g,y.handleResult=v._handleImageData,v._addTask(y);const w=yield y.promise;if(w.srcBuffer){let C=Object.prototype.toString.call(l.fileSource);"[object ArrayBuffer]"!=C&&"[object Uint8ClampedArray]"!=C&&delete w.srcBuffer}return w})}openTiff(l,u){return Ze(this,void 0,void 0,function*(){u=null!=u&&u;let f,g=this,m=g._createTask("LoadTiff");if(l!=K(this,uh,"f")){const y=yield g._readFile(l);l instanceof Blob?ke(g,uh,l,"f"):ke(g,uh,new Blob([y]),"f")}f||(f=yield g._readFile(K(g,uh,"f"))),m.params.input=[f,u],g._addTask(m);const v=yield m.promise;if(ke(g,dh,!0,"f"),v.srcBuffer){let y=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=y&&"[object Uint8ClampedArray]"!=y&&delete v.srcBuffer}return ke(g,m3,{pageCount:v.pageCount},"f"),v})}readTiffPage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){yield K(this,Gf,"m",v3).call(this,l.fileSource),u=null!=u?u:0,f=null!=f?f:this._outputType,g=null!=g&&g,m=null!=m&&m;let v=this._createTask("ReadTiffPage");return v.params.input=[u,f,m],v.params.returnType=g?ys.RT_BASE64:ys.RT_AUTO,v.params.returnBlob=!g,v.handleResult=this._handleImageData,this._addTask(v)})}getTiffInfo(l,u){return Ze(this,void 0,void 0,function*(){return yield K(this,Gf,"m",v3).call(this,l.fileSource),K(this,m3,"f")})}getTiffPageInfos(l,u){return Ze(this,void 0,void 0,function*(){yield K(this,Gf,"m",v3).call(this,l.fileSource);let f=this._createTask("GetTiffPageInfos");return f.params.input=[u],this._addTask(f)})}}bO=new WeakMap,dh=new WeakMap,uh=new WeakMap,m3=new WeakMap,t6=new WeakMap,Td=new WeakMap,$m=new WeakMap,Gf=new WeakSet,v3=function(p){return Ze(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),K(this,dh,"f")){if(K(this,uh,"f")===p)return void ut.logD("["+this.id+"] already opened in "+this.workerId);yield K(this,Gf,"m",_O).call(this)}ut.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(p,!1)})},_O=function(){if(ke(this,uh,null,"f"),K(this,dh,"f"))return ke(this,dh,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))},function(p){p[p.render=1]="render",p[p.extractImageOnly=2]="extractImageOnly",p[p.auto=3]="auto",p[p.renderWithAnnot=4]="renderWithAnnot"}(RO||(RO={}));class vh extends qm{constructor(l){super(et.PdfReaderModule,l),zo.add(this),Ad.set(this,void 0),Ym.set(this,void 0),Xm.set(this,0),EO.set(this,200),TO.set(this,3),fh.set(this,!1),y3.set(this,void 0),dc.set(this,null),Id.set(this,""),this._outputType=ho.IT_ALL}static get fonts(){return K(this,Dd,"f",zf)}static addPdfFont(l,u){return Ze(this,void 0,void 0,function*(){return K(this,Dd,"m",SO).call(this,l,u)})}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){ke(this,Dd,Object.create(null),"f",zf)}workerChanged(l){ke(this,fh,!1,"f"),l&&(ut.logD("["+this.id+"] worker changed to "+l),ke(this,Xm,l,"f"))}setExternalWorkerChanged(l,u){ke(this,Ad,l,"f"),ke(this,Ym,u,"f")}_workerChanged(l){this.workerChanged(l),K(this,Ad,"f")&&K(this,Ad,"f").call(this,K(this,Ym,"f"),this,l)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(ke(this,fh,!1,"f"),K(this,Ad,"f")&&K(this,Ad,"f").call(this,K(this,Ym,"f"),this))}getPdfInfo(l){return Ze(this,void 0,void 0,function*(){return yield K(this,zo,"m",Pd).call(this,l),K(this,y3,"f")})}readPage(l,u,f,g,m,v,y,x){return Ze(this,void 0,void 0,function*(){return this.readPageEx(l,u,{convertMode:g,renderOptions:{resolution:f}},m,v,y,x)})}readPageEx(l,u,f,g,m,v,y){return Ze(this,void 0,void 0,function*(){yield K(this,zo,"m",Pd).call(this,l),u=null!=u?u:0,g=null!=g?g:this._outputType,v=null!=v&&v,m=null!=m&&m,y=null!=y&&y;let x=f?JSON.stringify(f):"{}",w=this._createTask("ReadPdfPageEx");return w.params.input=[u,x,g,m,y],w.params.returnType=v?ys.RT_BASE64:ys.RT_AUTO,w.params.returnBlob=!v,w.handleResult=this._handleImageData,this._addTask(w)})}readPageImageInfos(l,u,f,g){return Ze(this,void 0,void 0,function*(){yield K(this,zo,"m",Pd).call(this,l),g=null!=g?g:this._outputType;let m=f?JSON.stringify(f):"{}",v=this._createTask("ReadPageImageInfos");return v.params.input=[u,m,g],this._addTask(v)})}readPageAnnot(l,u){return Ze(this,void 0,void 0,function*(){yield K(this,zo,"m",Pd).call(this,l);let f=this._createTask("GetPageAnnot",[u=null!=u?u:0]);return this._addTask(f)})}findText(l,u,f,g){return Ze(this,void 0,void 0,function*(){return yield K(this,zo,"m",Pd).call(this,l),this._addTask(this._createTask("SearchText",[u,f,g=null!=g?g:0]))})}getPageInfos(l,u){return Ze(this,void 0,void 0,function*(){return yield K(this,zo,"m",Pd).call(this,l),this._addTask(this._createTask("GetPdfPageInfos",[u]))})}}Dd=vh,Ad=new WeakMap,Ym=new WeakMap,Xm=new WeakMap,EO=new WeakMap,TO=new WeakMap,fh=new WeakMap,y3=new WeakMap,dc=new WeakMap,Id=new WeakMap,zo=new WeakSet,SO=function(p,l){return Ze(this,void 0,void 0,function*(){if("string"==typeof p&&0!==p.length||Promise.reject("The 'name' should be a valid string"),void 0===K(this,Dd,"f",zf)[p])if(l instanceof Blob)K(this,Dd,"f",zf)[p]=l;else{const u=yield gh.read(l);K(this,Dd,"f",zf)[p]=new Blob([u])}})},Pd=function(p){var l,u;return Ze(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),K(this,fh,"f")){if(K(this,dc,"f")===p.fileSource)return void ut.logD("["+this.id+"] already opened in "+this.workerId);yield K(this,zo,"m",PO).call(this)}ut.logD("["+this.id+"] reopen in worker "+this.workerId),yield K(this,zo,"m",IO).call(this,null!==(l=p.fileSource)&&void 0!==l?l:K(this,dc,"f"),null!==(u=p.password)&&void 0!==u?u:K(this,Id,"f"))})},DO=function(){return Ze(this,void 0,void 0,function*(){if(0===K(this,Xm,"f")||K(this,Xm,"f")!==this.workerId){ut.logD("["+this.id+"] load font in worker "+this.workerId);const p=vh.fonts,l=Object.keys(p);for(let u of l){const f=p[u],g=yield gh.read(f);g&&(yield K(this,zo,"m",AO).call(this,u,g))}}})},AO=function(p,l){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("AddSystemFont",[p,l]))})},IO=function(p,l){return Ze(this,void 0,void 0,function*(){yield K(this,zo,"m",DO).call(this),l=null!=l?l:"";let u,f=this,g=f._createTask("LoadPdf");if(p!==K(f,dc,"f")||l!==K(f,Id,"f")){const m=yield f._readFile(p);p instanceof Blob?ke(f,dc,p,"f"):ke(f,dc,new Blob([m]),"f"),u=m,ke(f,Id,l,"f")}else l=K(f,Id,"f");return u||(u=yield f._readFile(K(f,dc,"f"))),g.params.input=[u,l],g.handleResult=function(m,v){if(m.srcBuffer){let x=Object.prototype.toString.call(p);"[object ArrayBuffer]"!=x&&"[object Uint8ClampedArray]"!=x&&delete m.srcBuffer}let y=class Fee{static decode(l){const u={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function f(g){let m,v,y,x,w,C,_,T=[],M=g.length;for(m=0;m<M;m++)x=g.charCodeAt(m),x>>7&255?6==(x>>5&255)?(w=g.charCodeAt(++m),v=(31&x)<<6,y=63&w,_=v|y,T.push(String.fromCharCode(_))):14==(x>>4&255)&&(w=g.charCodeAt(++m),C=g.charCodeAt(++m),v=x<<4|w>>2&15,y=(3&w)<<6|63&C,_=(255&v)<<8|y,T.push(String.fromCharCode(_))):T.push(g.charAt(m));return T.join("")}return function(g){let m,v,y,x,w=[],C=0,_=g.length;for(;C<_;){do{m=u.decodeChars[255&g.charCodeAt(C++)]}while(C<_&&-1==m);if(-1==m)break;do{v=u.decodeChars[255&g.charCodeAt(C++)]}while(C<_&&-1==v);if(-1==v)break;w.push(String.fromCharCode(m<<2|(48&v)>>4));do{if(y=255&g.charCodeAt(C++),61==y)return f(w.join(""));y=u.decodeChars[y]}while(C<_&&-1==y);if(-1==y)break;w.push(String.fromCharCode((15&v)<<4|(60&y)>>2));do{if(x=255&g.charCodeAt(C++),61==x)return f(w.join(""));x=u.decodeChars[x]}while(C<_&&-1==x);if(-1==x)break;w.push(String.fromCharCode((3&y)<<6|x))}return f(w.join(""))}(l)}}.decode(m.infoBase64);try{let x;try{y.replace(new RegExp("\\\\","gi"),"\\\\"),x=JSON.parse(y)}catch(C){x=y}let w={PdfCount:m.pageCount,PdfInfo:x,isTextBased:m.isTextBased};return m.srcBuffer&&(w.srcBuffer=m.srcBuffer,delete m.srcBuffer),ke(f,fh,!0,"f"),ke(f,y3,w,"f"),w}catch(x){v.reject({code:Ho.wasmJsInvalidJson,message:x.message,stack:x.stack})}},f._addTask(g)})},PO=function(){return Ze(this,void 0,void 0,function*(){if(ke(this,dc,null,"f"),ke(this,Id,"","f"),K(this,fh,"f"))return ke(this,fh,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))})},zf={value:Object.create(null)};const n6=["readPdfPage","readTiffPage","readImage"];class FO{constructor(l){this.items=[],l&&(this.items=l)}push(l){this.items.push(l)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(l){let u;-1!==n6.indexOf(l.api)&&this.push(l);for(let f of this.items)f.api===l.api&&f.params[0]===l.params[0]&&f.params[1]===l.params[1]&&(u=f);u?(u.resolves=[...u.resolves,...l.resolves],u.rejects=[...u.rejects,...l.rejects]):this.push(l)}remove(l){-1!==n6.indexOf(l.api)&&this.items.forEach((u,f)=>{u.api===l.api&&u.params[0]===l.params[0]&&u.params[1]===l.params[1]&&this.items.splice(f,1).forEach(g=>{null==g||g.resolves.forEach(m=>{m(null)})})})}}class nn{static unload(){if(ke(this,ze,[],"f",$f),ke(this,ze,new FO,"f",ph),ke(this,ze,!1,"f",Yf),vh.removeFont(),K(this,ze,"f",fn)){ut.logD("pdfReader destroy");const l=K(this,ze,"f",fn);ke(this,ze,null,"f",fn),l.terminate()}if(K(this,ze,"f",pn)){ut.logD("imageReader destroy");const l=K(this,ze,"f",pn);ke(this,ze,null,"f",pn),l.terminate()}}static updateLicense(l,u,f){return Ze(this,void 0,void 0,function*(){let g=[];return K(this,ze,"f",fn)&&g.push(K(this,ze,"f",fn).updateLicense(l,u,f)),K(this,ze,"f",pn)&&g.push(K(this,ze,"f",pn).updateLicense(l,u,f)),Promise.all(g)})}static add(l){return Ze(this,void 0,void 0,function*(){K(this,ze,"f",$f).push(l),K(this,ze,"f",fn)||(ke(this,ze,new vh,"f",fn),K(this,ze,"f",fn).setExternalWorkerChanged(K(nn,ze,"m",i6),this),this.initPdfReaderFunctionMap()),K(this,ze,"f",pn)||(ke(this,ze,new Lee,"f",pn),K(this,ze,"f",pn).setExternalWorkerChanged(K(nn,ze,"m",i6),this),this.initImageReaderFunctionMap())})}static addFont(l,u){return Ze(this,void 0,void 0,function*(){vh.addPdfFont(l,u)})}static getFonts(){return vh.getPdfFonts()}static delete(l){const u=K(this,ze,"f",$f).indexOf(l);if(u>=0&&(K(this,ze,"f",$f).splice(u,1),0===K(this,ze,"f",$f).length&&!K(this,ze,"f",Yf))){if(K(this,ze,"f",fn)){ut.logD("pdfReader destroy");const f=K(this,ze,"f",fn);ke(this,ze,null,"f",fn),f.terminate()}if(K(this,ze,"f",pn)){ut.logD("imageReader destroy");const f=K(this,ze,"f",pn);ke(this,ze,null,"f",pn),f.terminate()}}}static createTask(l,u){const f={api:l,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const m of u)f.params.push(m);const g=new Promise(function(m,v){f.resolves.push(m),f.rejects.push(v)});return f.promise.push(g),K(this,ze,"m",MO).call(this,f),g}static cancelTask(l,u){if(-1!==n6.indexOf(l)){const f={api:l,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const g of u)f.params.push(g);K(this,ze,"f",ph).remove(f)}}static initPdfReaderFunctionMap(){var l,u,f,g,m,v;K(this,ze,"f",uc).findPdfText=null===(l=K(this,ze,"f",fn))||void 0===l?void 0:l.findText,K(this,ze,"f",uc).getPdfPageInfos=null===(u=K(this,ze,"f",fn))||void 0===u?void 0:u.getPageInfos,K(this,ze,"f",uc).getPdfInfo=null===(f=K(this,ze,"f",fn))||void 0===f?void 0:f.getPdfInfo,K(this,ze,"f",uc).readPdfPageAnnot=null===(g=K(this,ze,"f",fn))||void 0===g?void 0:g.readPageAnnot,K(this,ze,"f",uc).readPdfPage=null===(m=K(this,ze,"f",fn))||void 0===m?void 0:m.readPageEx,K(this,ze,"f",uc).readPdfPageImageInfos=null===(v=K(this,ze,"f",fn))||void 0===v?void 0:v.readPageImageInfos}static initImageReaderFunctionMap(){var l,u,f,g,m,v;K(this,ze,"f",fc).readImage=null===(l=K(this,ze,"f",pn))||void 0===l?void 0:l.readImage,K(this,ze,"f",fc).getImageFormat=null===(u=K(this,ze,"f",pn))||void 0===u?void 0:u.getImageFormat,K(this,ze,"f",fc).readImageInfo=null===(f=K(this,ze,"f",pn))||void 0===f?void 0:f.readImageInfo,K(this,ze,"f",fc).getTiffInfo=null===(g=K(this,ze,"f",pn))||void 0===g?void 0:g.getTiffInfo,K(this,ze,"f",fc).readTiffPage=null===(m=K(this,ze,"f",pn))||void 0===m?void 0:m.readTiffPage,K(this,ze,"f",fc).getTiffPageInfos=null===(v=K(this,ze,"f",pn))||void 0===v?void 0:v.getTiffPageInfos}}ze=nn,i6=function(p,l,u){let f=null!=p?p:this;K(f,ze,"f",fn)&&K(f,ze,"f",fn)!==l&&K(f,ze,"f",fn).workerChanged(u),K(f,ze,"f",pn)&&K(f,ze,"f",pn)!==l&&K(f,ze,"f",pn).workerChanged(u)},MO=function(p){K(this,ze,"f",ph).add(p),K(this,ze,"f",Yf)||(ke(this,ze,!0,"f",Yf),K(this,ze,"m",OO).call(this))},kO=function(){try{K(this,ze,"f",pn)&&K(this,ze,"f",pn).makeSureWorkerMemoryNotExceed(),K(this,ze,"f",fn)&&K(this,ze,"f",fn).makeSureWorkerMemoryNotExceed()}catch(p){}},OO=function(){return Ze(this,void 0,void 0,function*(){do{if(K(this,ze,"f",ph).isEmpty()||!K(this,ze,"f",fn)||!K(this,ze,"f",pn))break;const p=K(this,ze,"f",ph).pop();if(p)try{let l,u=K(this,ze,"f",uc)[p.api];u?(l=yield K(this,ze,"f",uc)[p.api].apply(K(this,ze,"f",fn),p.params),K(this,ze,"f",fn).makeSureWorkerMemoryNotExceed()):(u=K(this,ze,"f",fc)[p.api],u&&(l=yield K(this,ze,"f",fc)[p.api].apply(K(this,ze,"f",pn),p.params),K(this,ze,"f",pn).makeSureWorkerMemoryNotExceed())),null==p||p.resolves.forEach(f=>{f(l)})}catch(l){ut.logD(l),p.retry<1?(p.retry+=1,K(this,ze,"m",kO).call(this),K(this,ze,"f",ph).push(p)):null==p||p.rejects.forEach(u=>{u(l)})}}while(!K(this,ze,"f",ph).isEmpty());ke(this,ze,!1,"f",Yf)})},$f={value:[]},ph={value:new FO},fn={value:void 0},pn={value:void 0},Yf={value:!1},uc={value:Object.create(null)},fc={value:Object.create(null)};class Nee{constructor(){nn.add(this)}destroy(){nn.delete(this)}readImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){return nn.createTask("readImage",[l,u,f,g,m])})}getImageFormat(l){return Ze(this,void 0,void 0,function*(){return nn.createTask("getImageFormat",[l])})}readImageInfo(l){return Ze(this,void 0,void 0,function*(){return nn.createTask("readImageInfo",[l])})}cancelReadImage(l,u){return nn.cancelTask("readImage",[l,u])}getTiffInfo(l){return Ze(this,void 0,void 0,function*(){return nn.createTask("getTiffInfo",[l,!1])})}readTiffPage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){return nn.createTask("readTiffPage",[l,u,f,g,m])})}cancelReadTiffPage(l,u){return nn.cancelTask("readTiffPage",[l,u])}getTiffPageInfos(l,u){return Ze(this,void 0,void 0,function*(){return nn.createTask("getTiffPageInfos",[l,u])})}}var vr,Or,Xf,pc,Zm,NO,s6,BO,UO,VO,jO,HO,WO,GO,zO,$O,YO,XO,qO,ZO;!function(p){p[p.NearestNeighbour=1]="NearestNeighbour",p[p.Bilinear=2]="Bilinear",p[p.Bicublic=3]="Bicublic",p[p.BestQuality=5]="BestQuality"}(Xf||(Xf={}));class Bee extends mh{constructor(l){super(et.ImageProcModule,l),vr.add(this)}initImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){u=null!=u&&u,f=null!=f?f:0,g=null!=g?g:0,m=null!=m&&m;let v=this,y=v._createTask("InitImageObject");if(y.params.input=[l,f,g],u||m)y.params.input.push(u?ho.IT_RGBA:ho.IT_BGRA),v._addTask(y);else{const w=yield v._readFile(l);y.params.input[0]=w,y.params.input.push(ho.IT_ALL),v._addTask(y)}const x=yield y.promise;if(x.srcBuffer){let w=Object.prototype.toString.call(l);"[object ArrayBuffer]"!=w&&"[object Uint8ClampedArray]"!=w&&delete x.srcBuffer}return x})}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(l,u,f){var g,m,v,y,x,w,C,_,T,M;let L=this;u=null!=u?u:{},f=null!=f?f:{};let N=L._createTask("Filter");if(N.params.input=[],N.params.input.push(l),"toBW"===l)N.params.input.push(JSON.stringify(K(L,vr,"m",Or).call(L,u)));else if("toGray"===l)N.params.input.push(JSON.stringify(K(L,vr,"m",Or).call(L,u)));else if("removeShadow"===l)N.params.input.push(JSON.stringify(K(L,vr,"m",Or).call(L,u)));else if("enhance"===l)N.params.input.push(JSON.stringify(K(L,vr,"m",Or).call(L,u)));else if("invert"===l)N.params.input.push(JSON.stringify(K(L,vr,"m",Or).call(L,u)));else if("brightnessAndContrast"===l){let j=null!==(g=u.brightness)&&void 0!==g?g:0,le=null!==(m=u.contrast)&&void 0!==m?m:0;N.params.input.push(j),N.params.input.push(le)}let V=null!==(v=f.returnType)&&void 0!==v?v:ho.IT_JPG,H=null!==(y=f.jpegQuality)&&void 0!==y?y:this._jpegQuality,G=null!==(x=f.bRGBA)&&void 0!==x&&x,z=null!==(w=f.bitDepth)&&void 0!==w?w:0,q=null!==(C=f.xdpi)&&void 0!==C?C:0,te=null!==(_=f.ydpi)&&void 0!==_?_:0,se=null===(T=f.returnBlob)||void 0===T||T;V=G&&null==V?ho.IT_JPG:null!=V?V:ho.IT_ALL;let ae=null!==(M=f.is1BitTo8Bit)&&void 0!==M&&M;return N.params.input.push([V,z,q,te,!1,H,!1,ae]),N.params.returnBlob=se,N.handleResult=this._handleImageData,L._addTask(N),N.promise}rotate(l,u,f,g){return((l=null!=l?l:0)<0||l>360)&&(l%=360)<0&&(l+=360),this._addTask(this._createTask("RotateEx",[l,f=null!=f&&f,g=null!=g?g:Xf.Bicublic,u=null!=u?u:"FFFFFF"],this._handleBooleanResult))}flip(l){l=null!=l?l:1;let u=this._createTask("");return u.handleResult=this._handleBooleanResult,1===l?u.func="Flip":-1===l&&(u.func="Mirror"),this._addTask(u),u.promise}erase(l,u,f,g,m){let v=this,y=v._createTask("Erase");return y.handleResult=this._handleBooleanResult,y.params.input=[l,u,f,g,JSON.stringify(K(v,vr,"m",Or).call(v,m))],v._addTask(y),y.promise}crop(l,u,f,g){return this._addTask(this._createTask("Crop",[l,u,f,g],this._handleBooleanResult))}resize(l,u,f){return this._addTask(this._createTask("ChangeImageSize",[l,u,f=null!=f?f:Xf.BestQuality],this._handleBooleanResult))}toGrayscaleLevel(l){(l=null!=l?l:1)<1&&(l=1),l>3&&(l=3);let u={};return 2===l?(u.clean=!0,u.sigma=3,u.scaleLimit=720,u.alpha=1.05):3===l&&(u.clean=!0,u.sigma=5,u.scaleLimit=1080,u.alpha=1.05),this.toGrayscale(u)}toGrayscale(l){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(K(this,vr,"m",Or).call(this,l)),this._handleBooleanResult))}toBinaryLevel(l,u){(u=null!=u?u:1)<1&&(u=1),u>3&&(u=3);let f={};return null!=l&&(l?f.method="adaptiveThreshold":(f.method="threshold",2===u?(f.clean=!0,f.sigma=3,f.scaleLimit=720,f.alpha=1.05):3===u&&(f.clean=!0,f.sigma=5,f.scaleLimit=1080,f.alpha=1.05))),this.toBinary(f)}toBinary(l){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(K(this,vr,"m",Or).call(this,l)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(l,u){return this._addTask(this._createTask("SetImageWidth",[l,JSON.stringify(K(this,vr,"m",Or).call(this,u))],this._handleBooleanResult))}setImageHeight(l,u){return this._addTask(this._createTask("SetImageHeight",[l,JSON.stringify(K(this,vr,"m",Or).call(this,u))],this._handleBooleanResult))}setDPI(l,u,f,g,m,v){return this._addTask(this._createTask("SetDPI",[l,u,f,g,m=null!=m&&m,v=null!=v?v:Xf.Bilinear],this._handleBooleanResult))}getImage(l,u,f,g,m,v,y,x,w){l=null!=l?l:this._jpegQuality,u=null==u||u,g=null!=g?g:0,m=null!=m?m:0,v=null!=v?v:0,y=null==y||y,x=(f=null!=f&&f)&&null==x?ho.IT_JPG:null!=x?x:ho.IT_ALL,w=null!=w&&w;let C=this._createTask("GetCurrentImage");return C.params.input=[x,g,m,v,!1,l,u,w],C.params.returnBlob=y,C.handleResult=this._handleImageData,this._addTask(C)}getSkewAngle(l){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(K(this,vr,"m",Or).call(this,l))],function(u,f){return u.skewAngle}))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(l,u,f,g,m){return this._addTask(this._createTask("DocumentDetect",[l=null!=l?l:Xf.Bilinear,(u=null!=u?u:75)/100,f=null!=f?f:100,(g=null!=g?g:0)/255,m=null!=m?m:"","1"]))}perspective(l,u,f,g,m,v,y,x){return this._addTask(this._createTask("Perspective",[l,u,f,g,m,v,y,x],this._handleBooleanResult))}changeBrightness(l,u){return l=null!=l?l:0,0!=(u=null!=u?u:1)&&1!=u&&(u=0),this._addTask(1===u?this._createTask("ChangeBrightnessAndContrast",[l,0],this._handleBooleanResult):this._createTask("ChangeBrightness",[Math.floor(l/1e3*255)],this._handleBooleanResult))}changeContrast(l,u){return l=null!=l?l:0,0!=(u=null!=u?u:1)&&1!=u&&(u=0),this._addTask(1===u?this._createTask("ChangeBrightnessAndContrast",[0,l],this._handleBooleanResult):this._createTask("ChangeContrast",[1+l/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(l,u){return this._addTask(this._createTask("ChangeBrightnessAndContrast",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))}removeShadowLevel(l,u){u=null!=u?u:1.05,(l=null!=l?l:1)<1&&(l=1),l>3&&(l=3);let f={};return 1===l&&(f.sigma=3,f.scaleLimit=720,f.alpha=u),2===l?(f.sigma=5,f.scaleLimit=1080,f.alpha=u):3===l&&(f.sigma=10,f.scaleLimit=0,f.alpha=u),this.removeShadow(f)}removeShadow(l){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(K(this,vr,"m",Or).call(this,l))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],function(l,u){return l.blurryScore}))}drawQuadrangle(l,u,f,g,m,v,y,x,w){return this._addTask(this._createTask("DrawQuadrangle",[l,u,f,g,m,v,y,x,JSON.stringify(K(this,vr,"m",Or).call(this,w))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}vr=new WeakSet,Or=function(p){let l={};if(null!=p&&"object"==typeof p)for(let u in p)l[u]=p[u];return l};class x3{constructor(){nn.add(this)}destroy(){nn.delete(this)}static addPdfFont(l,u){return Ze(this,void 0,void 0,function*(){return nn.addFont(l,u)})}static getPdfFonts(){return nn.getFonts()}getPdfInfo(l){return Ze(this,void 0,void 0,function*(){return nn.createTask("getPdfInfo",[l])})}readPage(l,u,f,g,m,v,y,x){return Ze(this,void 0,void 0,function*(){return this.readPageEx(l,u,{convertMode:g,renderOptions:{resolution:f}},m,v,y,x)})}readPageEx(l,u,f,g,m,v,y){return Ze(this,void 0,void 0,function*(){return nn.createTask("readPdfPage",[l,u,f,g,m,v,y])})}cancelReadPage(l,u){return nn.cancelTask("readPdfPage",[l,u])}readPageImageInfos(l,u,f,g,m,v,y){return Ze(this,void 0,void 0,function*(){return nn.createTask("readPdfPageImageInfos",[l,u,f,g,m,v,y])})}readPageAnnot(l,u){return Ze(this,void 0,void 0,function*(){return nn.createTask("readPdfPageAnnot",[l,u])})}findText(l,u,f,g){return Ze(this,void 0,void 0,function*(){return nn.createTask("findPdfText",[l,u,f,g])})}getPageInfos(l,u){return Ze(this,void 0,void 0,function*(){return nn.createTask("getPdfPageInfos",[l,u])})}}!function(p){p[p.auto=0]="auto",p[p.store=1]="store"}(BO||(BO={}));class Uee extends mh{constructor(l){super(et.PdfWriterModule,l),pc.add(this)}initPdfSetting(l){return Ze(this,void 0,void 0,function*(){let u=this,f=u._createTask("CreateDocument");return f.params.input=[JSON.stringify(K(u,pc,"m",s6).call(u,l))],f.handleResult=this._handleBooleanResult,u._addTask(f)})}appendPage(l,u){return Ze(this,void 0,void 0,function*(){let f=this,g=f._createTask("InsertImagePage");u=null!=u&&u;const m=yield f._readFile(l);return g.params.input=[m,-1,u],g.handleResult=f._handleBooleanResult,f._addTask(g),g.promise})}insertPage(l,u,f){return Ze(this,void 0,void 0,function*(){let g=this,m=g._createTask("InsertImagePage");f=null!=f&&f;const v=yield g._readFile(l);return m.params.input=[v,u,f],m.handleResult=g._handleBooleanResult,g._addTask(m),m.promise})}writePdf(l){return Ze(this,void 0,void 0,function*(){let u=this._createTask("GetCurrentPdf");return u.params.returnType=null!=l?l:ys.RT_AUTO,u.params.returnBlob=l!=ys.RT_AUTO,u.handleResult=this._handleImageData,this._addTask(u)})}insertBlankPage(l,u,f){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("InsertBlankPage",[l=null!=l?l:0,u=null!=u?u:595,f=null!=f?f:842]))})}deletePage(l){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePdfPage",[l=null!=l?l:0],this._handleBooleanResult))})}pageSetRotation(l,u){return Ze(this,void 0,void 0,function*(){l=null!=l?l:0,0!=(u=((u=null!=u?u:0)%360+360)%360)&&90!==u&&180!==u&&270!==u&&(u=0);let f=this._createTask("SetPageRotation");return f.params.input=[l,u],f.handleResult=this._handleBooleanResult,this._addTask(f)})}pageSetCropBox(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){l=null!=l?l:0,u=null!=u?u:0,f=null!=f?f:0,(g=null!=g?g:u)<u&&(g=u),(m=null!=m?m:f)<f&&(m=f);let v=this._createTask("SetPageCropBox");return v.params.input=[l,u,f,g,m],v.handleResult=this._handleBooleanResult,this._addTask(v)})}pageSetMediaBox(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){l=null!=l?l:0,u=null!=u?u:0,f=null!=f?f:0,(g=null!=g?g:u)<u&&(g=u),(m=null!=m?m:f)<f&&(m=f);let v=this._createTask("SetPageMediaBox");return v.params.input=[l,u,f,g,m],v.handleResult=this._handleBooleanResult,this._addTask(v)})}pageAddImage(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){let v=this,y=v._createTask("PageAddImage"),x=JSON.stringify(K(v,pc,"m",s6).call(v,f));const w=yield v._readFile(l);return y.params.input=[w,u,x,g,m],y.handleResult=v._handleBooleanResult,v._addTask(y),y.promise})}pageAddText(l,u){return Ze(this,void 0,void 0,function*(){yield K(this,pc,"m",Zm).call(this);let f=JSON.stringify(u);return this._addTask(this._createTask("PageAddText",[l,f],this._handleBooleanResult))})}pageAddPath(l,u){return Ze(this,void 0,void 0,function*(){let f=JSON.stringify(u);return this._addTask(this._createTask("PageAddPath",[l,f],this._handleBooleanResult))})}pageClearObjects(l){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageClearObjects",[l=null!=l?l:0],this._handleBooleanResult))})}pageSetAnnot(l,u){return Ze(this,void 0,void 0,function*(){let f;return l=null!=l?l:0,Array.isArray(u)?(f="[",u.forEach((g,m)=>{m>0&&(f+=","),f+=JSON.stringify(g)}),f+="]"):f=JSON.stringify(u),yield K(this,pc,"m",Zm).call(this),this._addTask(this._createTask("SetPageAnnot",[l,f],this._handleBooleanResult))})}getFontFromTextObject(l){return l.fontName?l.fontName:""}getFontFromAnnot(l){let u=[];return l&&l.normalAppearance&&l.normalAppearance.objs&&l.normalAppearance.objs.forEach(g=>{if("text"===g.type){const v=this.getFontFromTextObject(g);v&&u.push(v)}}),u=[...new Set(u)],u}getFontFromAnnots(l){let u=[];return Array.isArray(l)?l.forEach(g=>{const m=this.getFontFromAnnot(g);u=u.concat(m)}):u=this.getFontFromAnnot(l),u=[...new Set(u)],u}pageAddAnnot(l,u){return Ze(this,void 0,void 0,function*(){let f;return l=null!=l?l:0,Array.isArray(u)?(f="[",u.forEach((g,m)=>{m>0&&(f+=","),f+=JSON.stringify(g)}),f+="]"):f=JSON.stringify(u),yield K(this,pc,"m",Zm).call(this),this._addTask(this._createTask("PageAddAnnot",[l,f],this._handleBooleanResult))})}pageDeleteAnnot(l,u){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnot",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))})}pageDeleteAnnotByTypes(l,u){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByTypes",[l=null!=l?l:0,u=null!=u?u:""],this._handleBooleanResult))})}pageDeleteAnnotByNames(l,u){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByNames",[l=null!=l?l:0,u=null!=u?u:""],this._handleBooleanResult))})}mergePdf(l,u,f,g,m){return Ze(this,void 0,void 0,function*(){g=null!=g?g:-1,f=null!=f?f:[],u=null!=u?u:"",m=null!=m&&m;let v=this,y=v._createTask("MergePdfPages");const x=yield v._readFile(l);return y.params.input=[x,g,u,f,m],y.handleResult=v._handleBooleanResult,v._addTask(y),y.promise})}pageFlatten(l,u){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageFlatten",[l=null!=l?l:0,u=null!=u?u:0],this._handleBooleanResult))})}GetFontInfo(l){return Ze(this,void 0,void 0,function*(){const u=yield this._readFile(l);return this._addTask(this._createTask("GetFontInfo",[u]))})}IfFontsExist(l){return Ze(this,void 0,void 0,function*(){let u=JSON.stringify(l);return yield K(this,pc,"m",Zm).call(this),this._addTask(this._createTask("IfFontsExist",[u]))})}}pc=new WeakSet,Zm=function(){return Ze(this,void 0,void 0,function*(){ut.logD("["+this.id+"] load font in worker "+this.workerId);const p=vh.fonts,l=Object.keys(vh.fonts);for(let u of l){const f=p[u],g=yield gh.read(f);g&&(yield K(this,pc,"m",NO).call(this,u,g))}})},NO=function(p,l){return Ze(this,void 0,void 0,function*(){return this._addTask(this._createTask("LoadFont",[l,p]))})},s6=function(p){let l={};if(null!=p&&"object"==typeof p)for(let u in p)l[u]=p[u];return l},function(p){p.Text="Text",p.Link="Link",p.FreeText="FreeText",p.Line="Line",p.Square="Square",p.Circle="Circle",p.Polygon="Polygon",p.PolyLine="PolyLine",p.Hignlight="Highlight",p.Underline="Underline",p.Squiggly="Squiggly",p.StrikeOut="StrikeOut",p.Stamp="Stamp",p.Caret="Caret",p.Ink="Ink",p.Popup="Popup"}(UO||(UO={})),function(p){p.None="none",p.Invisible="invisible",p.Hidden="hidden",p.Print="print",p.NoZoom="nozoom",p.NoRotate="norotate",p.NoView="noview",p.ReadOnly="readonly",p.Locked="locked",p.ToggleNoView="togglenoview",p.LockedContents="lockedcontents"}(VO||(VO={})),function(p){p.Solid="S",p.Dashed="D",p.Beveled="B",p.Insert="I",p.Underline="U"}(jO||(jO={})),function(p){p.NoEffect="S",p.Cloudy="C"}(HO||(HO={})),function(p){p.Comment="Comment",p.Key="Key",p.Note="Note",p.Help="Help",p.NewParagraph="NewParagraph",p.Paragraph="Paragraph",p.Insert="Insert"}(WO||(WO={})),function(p){p.Marked="Marked",p.Review="Review"}(GO||(GO={})),function(p){p.Accepted="Accepted",p.Rejected="Rejected",p.Cancelled="Cancelled",p.Completed="Completed",p.None="None"}(zO||(zO={})),function(p){p.None="None",p.Square="Square",p.Circle="Circle",p.Diamond="Diamond",p.OpenArrow="OpenArrow",p.ClosedArrow="ClosedArrow",p.Butt="Butt",p.ROpenArrow="ROpenArrow",p.RClosedArrow="RClosedArrow",p.Slash="Slash"}($O||($O={})),function(p){p[p.LeftJustified=0]="LeftJustified",p[p.Centered=1]="Centered",p[p.RightJustified=2]="RightJustified"}(YO||(YO={})),function(p){p.FreeText="FreeText",p.FreeTextCallout="FreeTextCallout",p.FreeTextTypeWriter="FreeTextTypeWriter"}(XO||(XO={})),function(p){p.LineArrow="LineArrow",p.LineDimension="LineDimension"}(qO||(qO={})),function(p){p.Approved="Approved",p.Experimental="Experimental",p.NotApproved="NotApproved",p.Asls="Asls",p.Expired="Expired",p.NotForPublicRelease="NotForPublicRelease",p.Confidential="Confidential",p.Final="Final",p.Sold="Sold",p.Departmental="Departmental",p.ForComment="ForComment",p.TopSecret="TopSecret",p.Draft="Draft",p.ForPublicRelease="ForPublicRelease"}(ZO||(ZO={}));const Rd="undefined"==typeof self,Md=Rd?{}:self;let Jm,Qm,w3,r6,Ks;"undefined"!=typeof navigator&&(Jm=navigator,Qm=Jm.userAgent,w3=Jm.platform,r6=Jm.mediaDevices),function(){if(!Rd){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Jm.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:w3,search:"Win"},Mac:{str:w3},Linux:{str:w3}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||Qm,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||Qm).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Qm).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=Qm.indexOf("Windows NT")&&(g="HarmonyOS"),Ks={browser:u,version:f,OS:g}}Rd&&(Ks={browser:"ssr",version:0,OS:"ssr"})}();const Vee="Chrome"===Ks.browser&&Ks.version>66||"Safari"===Ks.browser&&Ks.version>13||"OPR"===Ks.browser&&Ks.version>43||"Edge"===Ks.browser&&Ks.version>15,qf="\\s*([+-]?\\d+)\\s*",Km="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ll="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",JO=/^#([0-9a-f]{3,8})$/,QO=new RegExp(`^rgb\\(${qf},${qf},${qf}\\)$`),KO=new RegExp(`^rgb\\(${ll},${ll},${ll}\\)$`),e9=new RegExp(`^rgba\\(${qf},${qf},${qf},${Km}\\)$`),t9=new RegExp(`^rgba\\(${ll},${ll},${ll},${Km}\\)$`),i9=new RegExp(`^hsl\\(${Km},${ll},${ll}\\)$`),n9=new RegExp(`^hsla\\(${Km},${ll},${ll},${Km}\\)$`),s9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let kd=class{constructor(p,l,u,f){S(this,"r",void 0),S(this,"g",void 0),S(this,"b",void 0),S(this,"opacity",void 0),this.r=p,this.g=l,this.b=u,this.opacity=f}};function r9(p){return new kd(p>>16&255,p>>8&255,255&p,1)}function C3(p,l,u,f){return f<=0&&(p=NaN,l=NaN,u=NaN),new kd(p,l,u,f)}function o9(p,l,u,f){return f<=0?(p=NaN,l=NaN,u=NaN):u<=0||u>=1?(p=NaN,l=NaN):l<=0&&(p=NaN),{h:p,s:l,l:u,opacity:f}}function o6(p,l,u){return p<60?(l+(u-l)*p)/60*255:p<180?255*u:p<240?(l+(u-l)*(240-p))/60*255:255*l}function a9(p){const l=p.h<0?p.h%360+360:p.h%360,u=Number.isNaN(l)||Number.isNaN(p.s)?0:p.s,{l:f}=p,g=f+(f<.5?f:1-f)*u,m=2*f-g;return new kd(o6(l>=240?l-240:l+120,m,g),o6(l,m,g),o6(l<120?l+240:l-120,m,g),p.opacity)}const jee=p=>{let l,u;if(p=`${p}`.trim().toLowerCase(),JO.exec(p))switch(l=JO.exec(p),u=l[1].length,l=parseInt(l[1],16),u){case 6:return r9(l);case 3:return new kd(l>>8&15|l>>4&240,l>>4&15|240&l,(15&l)<<4|15&l,1);case 8:return C3(l>>24&255,l>>16&255,l>>8&255,(255&l)/255);case 4:return C3(l>>12&15|l>>8&240,l>>8&15|l>>4&240,l>>4&15|240&l,((15&l)<<4|15&l)/255);default:return null}return QO.exec(p)?(l=QO.exec(p),new kd(l[1],l[2],l[3],1)):KO.exec(p)?(l=KO.exec(p),new kd(255*l[1]/100,255*l[2]/100,255*l[3]/100,1)):e9.exec(p)?(l=e9.exec(p),C3(l[1],l[2],l[3],l[4])):t9.exec(p)?(l=t9.exec(p),C3(255*l[1]/100,255*l[2]/100,255*l[3]/100,l[4])):i9.exec(p)?(l=i9.exec(p),a9(o9(l[1],l[2]/100,l[3]/100,1))):n9.exec(p)?(l=n9.exec(p),a9(o9(l[1],l[2]/100,l[3]/100,l[4]))):s9.hasOwnProperty(p)?r9(s9[p]):"transparent"===p?new kd(NaN,NaN,NaN,0):null},Hee=p=>p.replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`),e0=p=>Object.prototype.toString.call(p),Xt=p=>Array.isArray?Array.isArray(p):"[object Array]"===e0(p),vt=p=>null!==p&&"[object Object]"===e0(p),qe=p=>{let l=null;return Xt(p)&&(l||(l=[]),p.forEach(u=>{l.push(qe(u))})),vt(p)&&(l||(l={}),Object.keys(p).forEach(u=>{l[u]=qe(p[u])})),l||p},Se=p=>void 0===p,l9=(p,l)=>{var u;p=null!==(u=p)&&void 0!==u?u:"yyyy-MM-dd hh:mm:ss";const f=Se(l)?new Date:new Date(l),g={"M+":(f.getMonth()+1).toString(),"d+":f.getDate().toString(),"h+":f.getHours().toString(),"m+":f.getMinutes().toString(),"s+":f.getSeconds().toString(),"q+":Math.floor((f.getMonth()+3)/3).toString(),S:f.getMilliseconds().toString()};return/(y+)/.test(p)&&(p=p.replace(RegExp.$1,`${f.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(g).forEach(m=>{new RegExp(`(${m})`).test(p)&&(p=p.replace(RegExp.$1,1===RegExp.$1.length?g[m]:`00${g[m]}`.substring(`${g[m]}`.length)))}),p},b3=p=>"[object ArrayBuffer]"===e0(p),er=p=>"[object Blob]"===e0(p),Jn=p=>"[object Boolean]"===e0(p),Zf=p=>"function"==typeof p,gi=()=>"ontouchstart"in document.documentElement,Ve=p=>"number"==typeof p&&!Number.isNaN(p),nt=p=>"string"==typeof p,Pi=(p,l,u)=>Math.min(Math.max(p,l),u);let c9=0;const qt=()=>(c9+=1,`${(new Date).getTime().toString(36)}${c9.toString(36)}`),_3=p=>{const l=window.URL||window.webkitURL;let u="string";return nt(p)?u="string":er(p)?(u="blob",p=l.createObjectURL(p)):(b3(p)||Xt(p))&&(u="blob",p=l.createObjectURL(new Blob([p]))),{type:u,data:p}};function Jf(p){return"object"==typeof HTMLElement?p instanceof HTMLElement:p&&"object"==typeof p&&1===p.nodeType&&"string"==typeof p.nodeName}let cl=class aU{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";S(this,"prefix",void 0),S(this,"postfix",void 0),S(this,"isDestroyed",!1),S(this,"uid",qt()),S(this,"cacheEvents",void 0),S(this,"events",void 0),S(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=l,this.postfix=u}static create(l,u){return new aU(l,u)}save(){this.isCached=!0}restore(){this.isCached=!1,this.cacheEvents.forEach(l=>{let{eventName:u,param:f}=l;this.emit(u,...f)}),this.cacheEvents.length=0}destroy(){if(!this.isDestroyed){for(const l in this.events)if(Object.prototype.hasOwnProperty.call(this.events,l)){const u=this.events[l];u&&u.slice().forEach(f=>{let{name:g,fn:m,context:v,once:y}=f;this.off(g,m,v,y)})}this.events={},this.isDestroyed=!0}}on(l,u,f){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:m}=this,v={name:l=this.format(l),uid:qt(),context:f,once:g,fn:u};return m[l]||(m[l]=[]),m[l].indexOf(v)<0&&m[l].push(v),v}once(l,u,f){return this.on(l,u,f,!0)}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];if(this.isCached)return this.cacheEvents.push({eventName:l,param:f}),!0;const{events:m}=this,v=m[l=this.format(l)];return!(!v||!v.length||(v.slice().forEach(y=>{let{fn:x,context:w}=y;x.call(w||null,...f)}),v.slice().forEach(y=>{let{fn:x,context:w,once:C}=y;C&&this.off(l,x,w,C)}),0))}off(l,u,f,g){const{events:m}=this,v=m[l=this.format(l)];if(!v)return!1;if(!arguments.length)return v.length=0,!0;for(let y=v.length-1;y>=0;y--){const x=v[y];u&&x.fn!==u||f&&x.context!==f||g&&x.once!==g||v.splice(y,1)}return!0}removeAllEventListeners(l){if(l){l=this.format(l);const u=this.cacheEvents.findIndex(f=>f.eventName===l);u>-1&&this.cacheEvents.splice(u,1),this.events[l]&&delete this.events[l]}else this.cacheEvents=[],this.events={}}getAllEvents(){return this.events}format(l){return`${this.prefix||""}${l}${this.postfix||""}`}};const a6="default";let Sn=class lU{constructor(){S(this,"emitter",new cl)}static create(){return new lU}on(l){this.emitter.on(a6,l)}emit(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];this.emitter.emit(a6,...u)}off(l){this.emitter.off(a6,l)}};function gc(){return new Sn}let Wee=class jp{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new jp(l.x,l.y,l.z)}static fromTwoPoint(l,u){var f,g,m,v,y,x;return new jp((null!==(f=u.x)&&void 0!==f?f:0)-(null!==(g=l.x)&&void 0!==g?g:0),(null!==(m=u.y)&&void 0!==m?m:0)-(null!==(v=l.y)&&void 0!==v?v:0),(null!==(y=u.z)&&void 0!==y?y:0)-(null!==(x=l.z)&&void 0!==x?x:0))}static fromValue(l,u,f){return new jp(l,u,f)}setFromVector(l){var u;this.x=l.x,this.y=l.y,this.z=null!==(u=l.z)&&void 0!==u?u:0}clone(){return new jp(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(l){var u;return this.x*l.x+this.y*l.y+this.z*(null!==(u=l.z)&&void 0!==u?u:0)}projectionTo(l){const u=Math.hypot(l.x,l.y,l.z);return this.dot(l)/u}angle(l){const u=this.norm()*Math.hypot(l.x,l.y,l.z),f=u&&this.dot(l)/u;return Math.acos(Pi(f,-1,1))}equals(l){var u;return this.x===l.x&&this.y===l.y&&this.z===(null!==(u=l.z)&&void 0!==u?u:0)}distance(l){var u;return Math.hypot(this.x-l.x,this.y-l.y,this.z-(null!==(u=l.z)&&void 0!==u?u:0))}lerp(l){var u;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:g,y:m,z:v}=this;return new jp(g+f*(l.x-g),m+f*(l.y-m),v+f*((null!==(u=l.z)&&void 0!==u?u:0)-v))}normalize(){const l=this,u=l.norm();return l.x/=u,l.y/=u,l.z/=u,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(l){const u=this;return{x:u.y*l.z-u.z*l.y,y:u.z*l.x-u.x*l.z,z:u.x*l.y-u.y*l.x}}add(l){return this.x+=l.x,this.y+=l.y,this.z+=l.z,this}multiply(l){return this.x*=l.x,this.y*=l.y,this.z*=l.z,this}};function S3(p,l){return Wee.fromTwoPoint(p,l)}let l6=class cU{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new cU(l.x,l.y,l.z)}matrixTransform(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:u,y:f,z:g}=this,{m11:m,m21:v,m31:y,m41:x,m12:w,m22:C,m32:_,m42:T,m13:M,m23:L,m33:N,m43:V,m14:H,m24:G,m34:z,m44:q}=l,te=H*u+G*f+z*g+q;return E3({x:(m*u+v*f+y*g+x)/te,y:(w*u+C*f+_*g+T)/te,z:(M*u+L*f+N*g+V)/te})}setFromPoint(l){return this.x=l.x||0,this.y=l.y||0,this.z=l.z||0,this}clone(){return E3(this)}equals(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return m.x===u&&m.y===f&&m.z===g}distanceTo(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return Math.hypot(m.x-u,m.y-f,m.z-g)}lerpTo(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:f=0,y:g=0,z:m=0}=l,v=this;return E3({x:v.x+u*(f-v.x),y:v.y+u*(g-v.y),z:v.z+u*(m-v.z)})}footPointInSegment(l,u){const f=S3(l,this),g=S3(l,u),m=g.norm(),v=E3(l);if(0===m)return v;const y=f.projectionTo(g)/m;return v.lerpTo(u,y)}perpendicularToSegment(l,u){const f=this.footPointInSegment(l,u);return this.distanceTo(f)}};function E3(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ve(p)?new l6(p,l,u):new l6(p.x,p.y,p.z)}let h9=class{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),S(this,"w",void 0),this.x=p,this.y=l,this.z=u,this.w=f}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const p=this.norm();this.x/=p,this.y/=p,this.z/=p,this.w/=p}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}};function yh(p,l){return((p.x-l.x)**2+(p.y-l.y)**2)**.5}class d9{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;S(this,"x",0),S(this,"y",0),S(this,"left",0),S(this,"top",0),S(this,"right",0),S(this,"bottom",0),S(this,"width",0),S(this,"height",0),this.update(l,u,f,g)}update(l,u,f,g){this.x=l,this.y=u,this.left=l,this.top=u,this.right=l+f,this.bottom=u+g,this.width=f,this.height=g}toJSON(){}}const c6=new class{constructor(){S(this,"tasks",[])}createTimer(p,l){const u=qt();return this.tasks.push({uid:u,callback:p,time:l}),this.executeTimer(u),u}executeTimer(p){const l=this.tasks.find(f=>f.uid===p);if(!l)return;const u=()=>{l.callback(),null!==l.timer&&(l.timer=setTimeout(u,l.time))};l.timer=setTimeout(u,l.time)}clearTimer(p){const l=this.tasks.findIndex(u=>u.uid===p);l>-1&&(clearTimeout(this.tasks[l].timer),this.tasks[l].timer=null,this.tasks.splice(l,1))}};function Gee(p,l,u,f){if(g=p,m=l,v=u,y=f,Math.min(g[0],m[0])<=Math.max(v[0],y[0])&&Math.min(v[0],y[0])<=Math.max(g[0],m[0])&&Math.min(g[1],m[1])<=Math.max(v[1],y[1])&&Math.min(v[1],y[1])<=Math.max(g[1],m[1])&&function(g,m,v,y){let x=g[0]*(v[1]-m[1])+m[0]*(g[1]-v[1])+v[0]*(m[1]-g[1]),w=g[0]*(y[1]-m[1])+m[0]*(g[1]-y[1])+y[0]*(m[1]-g[1]);return!((x^w)>=0&&0!==x&&0!==w||(x=v[0]*(g[1]-y[1])+y[0]*(v[1]-g[1])+g[0]*(y[1]-v[1]),w=v[0]*(m[1]-y[1])+y[0]*(v[1]-m[1])+m[0]*(y[1]-v[1]),(x^w)>=0&&0!==x&&0!==w))}(p,l,u,f)){let g=(f[0]-u[0])*(p[1]-l[1])-(l[0]-p[0])*(u[1]-f[1]),m=(p[1]-u[1])*(l[0]-p[0])*(f[0]-u[0])+u[0]*(f[1]-u[1])*(l[0]-p[0])-p[0]*(l[1]-p[1])*(f[0]-u[0]);if(0===g||0===m){const y=u9(p,l),x=u9(u,f),w=y[0],C=y[1],_=x[0],T=x[1];if(C[0]===_[0]&&C[1]===_[1])return C;if(w[0]===T[0]&&w[1]===T[1])return w;if(xh(C,x)&&xh(_,y))return[_,C];if(xh(w,x)&&xh(T,y))return[w,T];if(xh(w,x)&&xh(C,x))return[w,C];if(xh(_,x)&&xh(T,x))return[_,T]}const v=m/g;return g=(p[0]-l[0])*(f[1]-u[1])-(l[1]-p[1])*(u[0]-f[0]),m=l[1]*(p[0]-l[0])*(f[1]-u[1])+(f[0]-l[0])*(f[1]-u[1])*(p[1]-l[1])-f[1]*(u[0]-f[0])*(l[1]-p[1]),[v,m/g]}var g,m,v,y;return!1}function u9(p,l){return p[0]===l[0]?p[1]<l[1]?[p,l]:[l,p]:p[0]<l[0]?[p,l]:[l,p]}function xh(p,l){return l[0][0]===l[1][0]?p[1]>=l[0][1]&&p[1]<=l[1][1]:p[0]>=l[0][0]&&p[0]<=l[1][0]}function T3(p){const l=[];let u=null;const f=p.slice(0,8).concat(p[0],p[1]);for(let g=0;g<4;g++){const m=f[2*(g+1)+1]-f[2*g+1],v=f[2*(g+1)]-f[2*g];u=0===m&&0===v?0:m/v,l.push(u)}return l}function D3(p){const[l,u,f,g,m,v,y,x]=p,w=(y-l)*(g-u)-(x-u)*(f-l),C=(l-f)*(v-g)-(u-g)*(m-f),_=(f-m)*(x-v)-(g-v)*(y-m),T=(m-y)*(u-x)-(v-x)*(l-y);if(w*C*_*T<0)return!1;const M=p.slice().concat(p.slice(0,2)),L=T3(p);if(L.length)for(let N=0;N<2;N++)if(L[N]!==L[N+2]&&Gee(M.slice(2*N,2*(N+1)),M.slice(2*(N+1),2*(N+2)),M.slice(2*(N+2),2*(N+3)),M.slice(2*(N+3),2*(N+4))))return!1;return w*C*_*T>0}function wh(p,l){return((p.x-l.x)**2+(p.y-l.y)**2)**.5}function zee(p){const{type:l,value:u}=p;return"hex"===l?`#${u}`:"literal"===l?u:"rgb"===l?`rgb(${u.join(",")})`:`rgba(${u.join(",")})`}const $ee=function(){const p_linearGradient=/^(linear\-gradient)/i,p_repeatingLinearGradient=/^(repeating\-linear\-gradient)/i,p_radialGradient=/^(radial\-gradient)/i,p_repeatingRadialGradient=/^(repeating\-radial\-gradient)/i,p_conicGradient=/^(conic\-gradient)/i,p_sideOrCorner=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,p_extentKeywords=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,p_positionKeywords=/^(left|center|right|top|bottom)/i,p_pixelValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,p_percentageValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,p_emValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,p_angleValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,p_startCall=/^\(/,p_endCall=/^\)/,p_comma=/^,/,p_hexColor=/^\#([0-9a-fA-F]+)/,p_literalColor=/^([a-zA-Z]+)/,p_rgbColor=/^rgb/i,p_rgbaColor=/^rgba/i,p_number=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/;let l="";function u(q){throw new Error(`${l}: ${q}`)}function f(){return g("linear-gradient",p_linearGradient,v)||g("repeating-linear-gradient",p_repeatingLinearGradient,v)||g("radial-gradient",p_radialGradient,y)||g("repeating-radial-gradient",p_repeatingRadialGradient,y)||g("conic-gradient",p_conicGradient,y)}function g(q,te,se){return m(te,ae=>{const j=se();return j&&(G(p_comma)||u("Missing comma before color stops")),{type:q,orientation:j,colorStops:T(M)}})}function m(q,te){const se=G(q);if(se){G(p_startCall)||u("Missing (");const ae=te(se);return G(p_endCall)||u("Missing )"),ae}}function v(){return H("directional",p_sideOrCorner,1)||H("angular",p_angleValue,1)}function y(){let q,te,se=x();return se&&(q=[],q.push(se),te=l,G(p_comma)&&(se=x(),se?q.push(se):l=te)),q}function x(){let q=function(){const te=H("shape",/^(circle)/i,0);return te&&(te.style=V()||w()),te}()||function(){const te=H("shape",/^(ellipse)/i,0);return te&&(te.style=N()||w()),te}();if(q)q.at=C();else{const te=w();if(te){q=te;const se=C();se&&(q.at=se)}else{const se=_();se&&(q={type:"default-radial",at:se})}}return q}function w(){return H("extent-keyword",p_extentKeywords,1)}function C(){if(H("position",/^at/,0)){const q=_();return q||u("Missing positioning value"),q}}function _(){const q={x:N(),y:N()};if(q.x||q.y)return{type:"position",value:q}}function T(q){let te=q();const se=[];if(te)for(se.push(te);G(p_comma);)te=q(),te?se.push(te):u("One extra comma");return se}function M(){const q=H("hex",p_hexColor,1)||m(p_rgbaColor,()=>({type:"rgba",value:T(L)}))||m(p_rgbColor,()=>({type:"rgb",value:T(L)}))||H("literal",p_literalColor,0);return q||u("Expected color definition"),q.length=N(),q}function L(){return G(p_number)[1]}function N(){return H("%",p_percentageValue,1)||H("position-keyword",p_positionKeywords,1)||V()}function V(){return H("px",p_pixelValue,1)||H("em",p_emValue,1)}function H(q,te,se){const ae=G(te);if(ae)return{type:q,value:ae[se]}}function G(q){const te=/^[\n\r\t\s]+/.exec(l);te&&z(te[0].length);const se=q.exec(l);return se&&z(se[0].length),se}function z(q){l=l.substring(q)}return function(q){return l=q,function(){const te=T(f);return l.length>0&&u("Invalid input not EOF"),te}()}}(),f9=(p,l,u)=>{try{void 0===l?u.appendChild(p):u.insertBefore(p,l)}catch(f){}},t0=()=>{const p=window;if(p){if(p.devicePixelRatio)return p.devicePixelRatio;if(p.screen.deviceXDPI&&p.screen.logicalXDPI)return p.screen.deviceXDPI/p.screen.logicalXDPI}return 1};function n0(p){let l="0px",u="",f="solid";if(!Se(p)&&""!==p){const g=document.createElement("div");g.style.border=p;const{borderWidth:m,borderColor:v,borderStyle:y}=g.style;"initial"!==m&&""!==m&&(l=m),"initial"!==v&&""!==v&&(u=v),"initial"!==y&&""!==y&&(f=y)}return{borderWidth:l,borderColor:u,borderStyle:f}}const Qf=p=>{const{pointerType:l}=p;return"touch"===l||"pen"===l||void 0===l},p9=function(p,l){const u=p.indexOf(l);return!(u<0||(p.splice(u,1),0))},g9=function(p,l,u){if(Ve(u)){let f=[],g=[];if(l.includes(u)){const w=l.length;if(w>1){const C=l.indexOf(u);0===C?g=l.slice(1):C===w-1?f=l.slice(0,-1):(f=l.slice(0,C),g=l.slice(C+1))}}else f=l;const m=p[u],v=f.map(w=>p[w]),y=g.map(w=>p[w]);v.forEach(w=>{const C=p.indexOf(w);C>-1&&p.splice(C,1)}),y.forEach(w=>{const C=p.indexOf(w);C>-1&&p.splice(C,1)});const x=p.indexOf(m);p.splice(x+1,0,...y),p.splice(x,0,...v)}else l.map(f=>p[f]).forEach(f=>{const g=p.indexOf(f);p.splice(g,1),p.push(f)});return!0},m9=function(p,l,u){if(l===u)return!0;const f=p[l];return p[l]=p[u],p[u]=f,!0},v9=function(p,l){const u=l.length;return!(p.length!==u||!u||(l.every((f,g)=>f===g)||l.map(f=>p[f]).forEach((f,g)=>{p[g]=f}),0))};function tr(p){return null==p}const A3=(p,l)=>p in l,y9=(p,l)=>{const u=[];for(;p;){const f=p.match(l);if(!f)break;u.push(f),p=p.substring(f.index+f[0].length)}return u};function gn(p,l){return Object.keys(p).forEach(u=>{Se(l[u])?l[u]=p[u]:vt(p[u])?gn(p[u],l[u]):l[u]=p[u]}),l}class h6{static read(l){return new Promise((u,f)=>{const g=Object.prototype.toString.call(l);if("[object String]"===g){if(0===l.indexOf("blob:")||l.indexOf(".jpg")>0||l.indexOf(".jpeg")>0||l.indexOf(".png")>0||l.indexOf(".bmp")>0||l.indexOf(".dib")>0||l.indexOf(".pdf")>0||l.indexOf(".tiff")>0||l.indexOf(".tif")>0)return fetch(l,{mode:"cors"}).then(m=>m.arrayBuffer()).then(m=>u(m)).catch(m=>Promise.reject(m));f("Error url: Can not read the file URL")}else if("[object Blob]"===g||"[object FileList]"===g||"[object File]"===g){let m=l;"[object FileList]"!==g&&"[object File]"!==g||(m=l[0]?l[0]:l),Yee.call(h6,m,u,f)}else"[object ArrayBuffer]"===g||"[object Uint8ClampedArray]"===g?u(l):f(`Not support source type: ${g}`)})}}function Yee(p,l,u){let f,g,m=0;try{f=new ArrayBuffer(p.size),g=new Uint8Array(f)}catch(v){u(v)}!function v(){const y=new FileReader;y.onload=function(C){var _;if(null!=C&&null!==(_=C.target)&&void 0!==_&&_.result){const T=C.target.result;g.set(new Uint8Array(T),m),m+=T.byteLength,m<p.size?v():l(f)}else u(C)},y.onerror=function(C){u(C)},y.onabort=function(C){u(C)};const x=Math.min(m+1048576,p.size),w=p.slice(m,x);y.readAsArrayBuffer(w)}()}function I3(p){return d6.apply(this,arguments)}function d6(){return d6=Q(function*(p){let l;if(p instanceof ArrayBuffer)p.byteLength>12&&(l=new Uint8Array(p.slice(0,12)));else if(p instanceof Blob&&p.size>12){const u=p.slice(0,12),f=yield h6.read(u);l=new Uint8Array(f)}if(l){if(37===(u=l)[0]&&80===u[1]&&68===u[2]&&70===u[3])return"application/pdf";if(function(u){return 137===u[0]&&80===u[1]&&78===u[2]&&71===u[3]}(l))return"image/png";if(function(u){return 255===u[0]&&216===u[1]}(l))return"image/jpeg";if(function(u){return 66===u[0]&&77===u[1]}(l))return"image/bmp";if(function(u){return 73===u[0]&&73===u[1]&&42===u[2]&&0===u[3]||77===u[0]&&77===u[1]&&0===u[2]&&42===u[3]}(l))return"image/tiff";if(function(u){return 0===u[0]&&0===u[1]&&0===u[2]&&12===u[3]&&106===u[4]&&80===u[5]&&32===u[6]&&32===u[7]||255===u[0]&&79===u[1]&&255===u[2]&&81===u[3]}(l))return"image/jp2";if(function(u){return 82===u[0]&&73===u[1]&&70===u[2]&&70===u[3]&&87===u[8]&&69===u[9]&&66===u[10]&&80===u[11]}(l))return null;if(p instanceof Blob&&("application/pdf"===p.type||"image/bmp"===p.type||"image/jp2"===p.type||"image/jpeg"===p.type||"image/png"===p.type||"image/tiff"===p.type||"image/rgba"===p.type))return p.type}var u;return p instanceof Blob&&"application/ddv-blank-image"===p.type?p.type:null}),d6.apply(this,arguments)}function bt(p,l,u){return l===u?p:Ve(p)?p/l*u:Xt(p)?p.map(f=>Xt(f)?[f[0]/l*u,f[1]/l*u]:f/l*u):(p=ne({},p),Object.keys(p).forEach(f=>{p[f]=p[f]/l*u}),p)}function u6(p,l){return p.every((u,f)=>{let[g,m]=u;const[v,y]=l[f];return g===v&&m===y})}function hl(p,l){return Number.parseFloat(p.toFixed(l))}class x9{constructor(){S(this,"disposed",!1),S(this,"toDispose",new Set)}get isDisposed(){return this.disposed}add(l){if(!l)return l;if(l===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(l),l}delete(l){if(l){if(l===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(l),l.dispose()}}dispose(){this.disposed||(this.disposed=!0,this.clear())}clear(){try{for(const l of this.toDispose)if(l)try{l.dispose()}catch(u){throw new Error("can not dispose an object")}}finally{this.toDispose.clear()}}}class mi{constructor(){S(this,"store",new x9)}dispose(){this.store.dispose()}register(l){if(l===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(l)}}class P3{static create(l){return new P3(l)}constructor(l){S(this,"isDisposed",!1),S(this,"listeners",void 0),S(this,"options",void 0),this.options=l,this.listeners=[]}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null))}on(l,u,f){var g,m,v,y;if(this.isDisposed)return{dispose:()=>{}};const x={uid:qt(),callback:l,context:u};this.listeners.length?this.listeners.push(x):(null!==(g=this.options)&&void 0!==g&&null!==(m=g.beforeAddFirstListener)&&void 0!==m&&m.call(g,this),this.listeners.push(x),null===(v=this.options)||void 0===v||null===(y=v.afterAddFirstListener)||void 0===y||y.call(v,this));const w={dispose:()=>{this.remove(x)}};return f instanceof x9?f.add(w):Array.isArray(f)?f.push(w):f instanceof mi&&f.register(w),w}remove(l){var u,f,g,m;if(null!==(u=this.options)&&void 0!==u&&null!==(f=u.beforeRemoveListener)&&void 0!==f&&f.call(u,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(g=this.options)||void 0===g||null===(m=g.afterRemoveLastListener)||void 0===m||m.call(g,this));const v=this.listeners.indexOf(l);if(v<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(v,1)}off(l){if(this.isDisposed||!this.listeners)return;const u=this.listeners.findIndex(f=>f.callback===l);u>-1&&this.listeners.splice(u,1)}emit(l){this.listeners&&this.listeners.length&&this.listeners.slice().forEach(u=>{try{u.context?u.callback.call(u.context,l):u.callback(l)}catch(f){}})}}function In(p,l,u){return{on:(f,g)=>{const m=new P3({beforeAddFirstListener:()=>{p.addEventListener(l,f,g)},afterRemoveLastListener:()=>{p.removeEventListener(l,f)}});u.register(m.on(()=>{})),u.register(m)}}}function Re(p){const l=p.register(new P3);return{on:(u,f)=>l.on(u,p,f),emit:u=>{l.emit(u)}}}var f6,Kf;!function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(Kf||(Kf={}));class Ke{static get isApple(){return ye(Ke,this,C9)._}static get version(){return et.CryptoModule.ver}static enableDebugOutput(l,u){l?et.setLogFunc("logDebug",g=>{var m,v,y;let x=qe(g);x.srcBuffer&&(x.srcBuffer=ye(Ke,this,s0).call(this,x.srcBuffer)),null!==(m=x.result)&&void 0!==m&&m.srcBuffer&&(x.result.srcBuffer=ye(Ke,this,s0).call(this,x.result.srcBuffer)),null!==(v=x.result)&&void 0!==v&&v.imageData&&(x.result.imageData=ye(Ke,this,s0).call(this,x.result.imageData)),null!==(y=x.result)&&void 0!==y&&y.pdfData&&(x.result.pdfData=ye(Ke,this,s0).call(this,x.result.pdfData)),x.imageData&&(x.imageData=ye(Ke,this,s0).call(this,x.imageData)),u&&(nt(x)&&(x=`[${Date.now()}]${x}`),u(x))}):et.setLogFunc("",void 0)}static getMemoryUsed(){return Ei.Instance.getMemoryUsed()}static get heapConfig(){return et.HeapConfig}static updateHeapConfig(l,u,f){et.UpdateHeapConfig(l,u,f),ye(Ke,this,ep)._[l]||(ye(Ke,this,ep)._[l]={}),u&&(ye(Ke,this,ep)._[l].maxHeapSize=u),f&&(ye(Ke,this,ep)._[l].initHeapSize=f)}static getLicenseInfo(l,u,f){var g=this;return Q(function*(){g.Init(l,u,f),u&&(yield Ei.Instance.loadModule(et.CryptoModule)),yield Ei.Instance.loadModule(et.ImageIOModule),yield nn.updateLicense(ye(Ke,g,r0)._,ye(Ke,g,p6)._,ye(Ke,g,R3)._);const m=new LO(ye(Ke,g,r0)._);try{return yield m.getLicenseInfo()}finally{m.terminate()}})()}static Init(l,u,f){var g;r0._=ye(Ke,this,null!=l?l:ye(Ke,this,r0)._),void 0!==u&&(p6._=ye(Ke,this,u?1:0)),R3._=ye(Ke,this,null!=f?f:ye(Ke,this,R3)._);const m={bMac:"Mac"===Ks.OS,biPhone:"iPhone"===Ks.OS,biPad:"iPad"===Ks.OS};C9._=ye(Ke,this,m.bMac||m.biPhone||m.biPad),et.NavInfo=m,et.License=ye(Ke,this,r0)._,et.UUID=ye(Ke,this,R3)._,et.LicMode=ye(Ke,this,p6)._,ye(Ke,this,w9).call(this),et.UpdateHeapConfig(Kf.detector,null!==(g=ye(Ke,this,Xee).call(this,Kf.detector))&&void 0!==g?g:100)}static isResourceDirValid(){var l=arguments,u=this;return Q(function*(){let f=l.length>0&&void 0!==l[0]?l[0]:3,g=l.length>1&&void 0!==l[1]?l[1]:1e3;ye(Ke,u,w9).call(u);let m=0;for(;m<f;){try{const v=et.PdfReaderModule;if(ye(Ke,u,b9)._===v.script)return!0;const y=ne({},v.fetchOptions);if(y.method="HEAD",(yield fetch(v.script,y)).ok)return b9._=ye(Ke,u,v.script),!0}catch(v){}yield new Promise(v=>setTimeout(v,g)),m+=1}return!1})()}static loadPdfReader(l,u,f){var g=this;return Q(function*(){return g.Init(l,u,f),ye(Ke,g,yr)._||(yield Ei.Instance.loadModule(et.ImageProcModule),yr._=ye(Ke,g,Ei.Instance.loadModule(et.PdfReaderModule)),yield ye(Ke,g,yr)._),ye(Ke,g,yr)._})()}static loadMain(l,u,f){var g=this;return Q(function*(){return g.Init(l,u,f),ye(Ke,g,$o)._||($o._=ye(Ke,g,Ei.Instance.loadModule(et.ImagecoreModule)),yield ye(Ke,g,$o)._,Ei.Instance.loadModule(et.ImageProcModule)),ye(Ke,g,$o)._})()}static load(l,u,f){var g=this;return Q(function*(){Ei.Instance.terminate(!0),g.Init(l,u,f),yield g.loadMain(l,u,f)})()}static preloadModule(l){var u=this;return Q(function*(){let f;const g=ne({},et.PdfReaderModule),m=ne({},et.ImageProcModule);switch(l){case"core":if(ye(Ke,u,$o)._){f=ye(Ke,u,$o)._;break}$o._=ye(Ke,u,Ei.Instance.loadModule(et.ImagecoreModule)),f=ye(Ke,u,$o)._,yield ye(Ke,u,$o)._;break;case"pdf":case"proc":if(ye(Ke,u,yr)._){f=ye(Ke,u,yr)._;break}m.workerName=Kf.loader,yr._=ye(Ke,u,Ei.Instance.loadModule(m)),f=ye(Ke,u,yr)._,yield ye(Ke,u,yr)._,g.workerName=Kf.loader,yr._=ye(Ke,u,Ei.Instance.loadModule(g)),f=ye(Ke,u,yr)._,yield ye(Ke,u,yr)._,Ei.Instance.terminateWorker(g.workerName)}return f})()}static unloadMainWorker(){$o._=ye(Ke,this,void 0),Ei.Instance.terminateWorker(et.ImageIOModule.workerName)}static unloadPdfReaderWorker(){yr._=ye(Ke,this,void 0),Ei.Instance.terminateWorker(et.PdfReaderModule.workerName)}static unloadDocumentDetectorWorker(){Ei.Instance.terminateWorker(et.DetectorModule.workerName)}static unloadWorker(){var l=this;return Q(function*(){$o._=ye(Ke,l,void 0),yr._=ye(Ke,l,void 0),yield Ei.Instance.terminate(!0)})()}static unload(){var l=this;return Q(function*(){Ei.unload(),et.unload(),nn.unload(),$o._=ye(Ke,l,void 0),yr._=ye(Ke,l,void 0);try{yield Ei.Instance.terminate(!0)}catch(u){}})()}static getUseSimd(){if(this.enableSimd){var l;const u=navigator;if(null!==(l=u.userAgentData)&&void 0!==l&&l.brands)for(const{brand:f,version:g}of u.userAgentData.brands)if(f&&("Chromium"===f||"Google Chrome"===f)&&g&&parseInt(g,10)>=94)return!0}return!1}static getPdfFonts(){return x3.getPdfFonts()}static getPdfInfo(l,u){return Q(function*(){let f;try{f=new x3;const g=yield f.getPdfInfo({fileSource:l,password:u});return f.destroy(),g}catch(g){return null}finally{f&&f.destroy()}})()}}function s0(p){return p instanceof ArrayBuffer?{type:"ArrayBuffer",length:p.byteLength}:p instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:p.byteLength}:{type:Object.prototype.toString.call(p)}}function Xee(p){return void 0!==ye(f6,this,ep)._[p]?ye(f6,this,ep)._[p].maxHeapSize:null}function w9(){et.UseSimd=!!this.enableSimd&&this.getUseSimd();const p={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:et.UseSimd,fetchOptions:this.fetchOptions};p.workerScript=et.ImageIOWorkerJS,et.ImageIOResource=p;const l=ne({},p);l.workerScript=et.ImageIOWorkerJS,et.PdfReaderResource=l}f6=Ke,S(Ke,"resourceDir","");var r0={_:""},p6={_:cc.LONG_KEY},R3={_:""};S(Ke,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),S(Ke,"enableSimd",!0);var Ri,Ls,M3,yr={_:void 0},$o={_:void 0},C9={_:!1},b9={_:void 0},ep={_:Object.create(null)};class Ch{constructor(){S(this,"processor",void 0),this.processor=new Bee}initImage(l){var u=this;return Q(function*(){return u.processor.initImage(l.source,l.isRGBA,l.width,l.height,l.isBGRA)})()}getImage(l){var u=this;return Q(function*(){return yield u.processor.getImage(l.jpegQuality,l.ifDeleteObject,l.isRGBA,l.bitDepth,l.xDpi,l.yDpi,l.returnBlob,l.returnType,Ke.isApple)})()}getImageInfo(){var l=this;return Q(function*(){return yield l.processor.getImageInfo()})()}freeReservedData(){var l=this;return Q(function*(){l.processor.freeReservedData()})()}toBinaryLevel(l,u){var f=this;return Q(function*(){return f.processor.toBinaryLevel(l,u)})()}toGrayscale(l){var u=this;return Q(function*(){return u.processor.toGrayscale(l)})()}removeShadowLevel(l,u){var f=this;return Q(function*(){return f.processor.removeShadowLevel(l,u)})()}brighten(){var l=this;return Q(function*(){return l.processor.brighten()})()}invert(){var l=this;return Q(function*(){return l.processor.invert()})()}changeBrightnessAndContrast(l,u){var f=this;return Q(function*(){return f.processor.changeBrightnessAndContrast(l,u)})()}perspective(l){var u=this;return Q(function*(){return u.processor.perspective(l[0][0],l[0][1],l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1])})()}getSkewAngle(l){var u=this;return Q(function*(){return u.processor.getSkewAngle(l)})()}rotate(l){var u=this;return Q(function*(){return u.processor.rotate(l.angle,l.fillColor,l.keepSize,l.mode)})()}flip(){var l=this;return Q(function*(){return l.processor.flip()})()}resize(l,u,f){var g=this;return Q(function*(){return g.processor.resize(l,u,f)})()}resizeWidth(l,u){var f=this;return Q(function*(){return f.processor.setImageWidth(l,u)})()}resizeHeight(l,u){var f=this;return Q(function*(){return f.processor.setImageHeight(l,u)})()}crop(l){var u=this;return Q(function*(){return u.processor.crop(l.left,l.top,l.left+l.width,l.top+l.height)})()}erase(l,u){var f=this;return Q(function*(){return f.processor.erase(l.left,l.top,l.left+l.width,l.top+l.height,u)})()}setDpi(l){var u=this;return Q(function*(){return u.processor.setDPI(l.rawResolutionX,l.rawResolutionY,l.resolutionX,l.resolutionY,l.resample,l.mode)})()}drawQuadrangle(l){var u=this;return Q(function*(){return u.processor.drawQuadrangle(l.location[0][0],l.location[0][1],l.location[1][0],l.location[1][1],l.location[2][0],l.location[2][1],l.location[3][0],l.location[3][1],l)})()}filter(l,u,f){var g=this;return Q(function*(){return g.processor.filter(l,u,f)})()}setImageWidth(l,u){var f=this;return Q(function*(){return f.processor.setImageWidth(l,u)})()}setImageHeight(l,u){var f=this;return Q(function*(){return f.processor.setImageHeight(l,u)})()}terminate(l){return this.processor.terminate(l)}}class Od{constructor(){S(this,"reader",void 0),this.reader=new Nee}readImage(l){var u=this;return Q(function*(){return yield u.reader.readImage(l.source,l.outputType,l.jpegQuality,l.returnBase64,Ke.isApple)})()}readImageInfo(l){var u=this;return Q(function*(){return yield u.reader.readImageInfo(l)})()}cancelReadImage(l,u){this.reader.cancelReadImage(l,u)}readTiffPage(l){var u=this;return Q(function*(){return yield u.reader.readTiffPage(l.source,l.index,l.outputType,l.returnBase64,Ke.isApple)})()}readTiffPageInfo(l,u){var f=this;return Q(function*(){const{imageInfos:g}=yield f.reader.getTiffPageInfos(l,u);return g})()}getTiffPageCount(l){var u=this;return Q(function*(){return(yield u.reader.getTiffInfo(l)).pageCount})()}cancelReadTiffPage(l,u){this.reader.cancelReadTiffPage(l,u)}destroy(){var l;null===(l=this.reader)||void 0===l||l.destroy(),this.reader=void 0}}(function(p){p[p.RGBA=1]="RGBA",p[p.BGRA=2]="BGRA",p[p.JPEG=3]="JPEG",p[p.PNG=4]="PNG"})(Ri||(Ri={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(Ls||(Ls={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(M3||(M3={}));class _9{constructor(){S(this,"writer",void 0),this.writer=new LO}terminate(){var l;null===(l=this.writer)||void 0===l||l.terminate(),this.writer=void 0}createTiff(){return this.writer.createTiff()}addTiffTag(l,u,f){return this.writer.addTag(l,u,f)}appendImage(l,u){var f=this;return Q(function*(){var g;return u=null!==(g=u)&&void 0!==g?g:{},yield f.writer.appendImage(l,u.inputType,u.tiffFormat,u.jpegQuality,u.is1Bit)})()}getTiff(){var l=this;return Q(function*(){return(yield l.writer.getTiff(M3.RT_BINARY)).imageData})()}saveImage(l,u){var f=this;return Q(function*(){var g;return u=null!==(g=u)&&void 0!==g?g:{},(yield f.writer.saveImage(l,u.outputType,u.jpegQuality,u.returnType)).imageData})()}}class k3{constructor(){S(this,"reader",void 0),this.reader=new x3}initFonts(l){var u;const f=null==l||null===(u=l.renderOptions)||void 0===u?void 0:u.fonts;if(f)for(const g of f)g.name&&g.data&&k3.addPdfFont(g.name,g.data)}static addPdfFont(l,u){x3.addPdfFont(l,u)}readPageImageInfos(l){var u=this;return Q(function*(){yield u.initFonts(l.readOptions);const{imageInfos:f}=yield u.reader.readPageImageInfos(l.source,l.indices,l.readOptions,l.outputType,l.isInfoOnly,l.returnBase64,Ke.isApple);return f})()}readPage(l){var u=this;return Q(function*(){return yield u.initFonts(l.readOptions),yield u.reader.readPageEx(l.source,l.index,l.readOptions,l.outputType,l.isInfoOnly,l.returnBase64,Ke.isApple)})()}cancelReadPage(l,u){this.reader.cancelReadPage(l,u)}getPdfPageCount(l,u){var f=this;return Q(function*(){return yield f.initFonts(u),(yield f.reader.getPdfInfo(l)).PdfCount})()}readAnnotations(l,u){var f=this;return Q(function*(){const{annot:{annots:g}}=yield f.reader.readPageAnnot(l,u);return g})()}destroy(){this.reader.destroy(),this.reader=null}}class S9{constructor(){S(this,"writer",void 0),this.writer=new Uee}terminate(){var l;null===(l=this.writer)||void 0===l||l.terminate(),this.writer=null}initPdfSetting(l){var u=this;return Q(function*(){return u.writer.initPdfSetting(l)})()}insertBlankPage(l,u,f){var g=this;return Q(function*(){return g.writer.insertBlankPage(l,u,f)})()}appendPage(l,u){var f=this;return Q(function*(){return f.writer.appendPage(l,u)})()}addImageToPages(l,u,f,g,m){var v=this;return Q(function*(){return v.writer.pageAddImage(l,u,f,g,m)})()}mergeRawPdfPages(l,u,f){var g=this;return Q(function*(){return g.writer.mergePdf(l,u,f)})()}setPageRotation(l,u){var f=this;return Q(function*(){return f.writer.pageSetRotation(l,u)})()}clearPageObjects(l){var u=this;return Q(function*(){return u.writer.pageClearObjects(l)})()}setPageCropBox(l,u,f,g,m){var v=this;return Q(function*(){return v.writer.pageSetCropBox(l,u,f,g,m)})()}setPageMediaBox(l,u,f,g,m){var v=this;return Q(function*(){return v.writer.pageSetMediaBox(l,u,f,g,m)})()}setPageAnnotations(l,u){var f=this;return Q(function*(){return f.writer.pageSetAnnot(l,u)})()}addAnnotationsToPage(l,u){var f=this;return Q(function*(){return f.writer.pageAddAnnot(l,u)})()}deletePageAnnotationsByTypes(l,u){var f=this;return Q(function*(){return f.writer.pageDeleteAnnotByTypes(l,u)})()}deletePageAnnotations(l){var u=this;return Q(function*(){return u.writer.pageDeleteAnnot(l)})()}flattenPage(l,u){var f=this;return Q(function*(){return f.writer.pageFlatten(l,u)})()}getPdf(l){var u=this;return Q(function*(){return(yield u.writer.writePdf(l)).pdfData})()}getFontInfo(l){var u=this;return Q(function*(){return yield u.writer.GetFontInfo(l)})()}ifFontsExist(l){var u=this;return Q(function*(){return(yield u.writer.IfFontsExist(l)).fontsExist})()}}class E9{constructor(l){S(this,"items",[]),l&&(this.items=l)}push(l){this.items.push(l)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(l){"filter"===l.api&&this.items.forEach((u,f)=>{u.api===l.api&&u.params[0]===l.params[0]&&u.params[1]===l.params[1]&&u.params[2]===l.params[2]&&this.items.splice(f,1).forEach(g=>{null==g||g.resolve(null)})})}}const o0={[Ri.BGRA]:Ls.IT_BGRA,[Ri.RGBA]:Ls.IT_RGBA,[Ri.PNG]:Ls.IT_PNG,[Ri.JPEG]:Ls.IT_JPG},qee={[Ls.IT_BGRA]:Ri.BGRA,[Ls.IT_RGBA]:Ri.RGBA,[Ls.IT_PNG]:Ri.PNG,[Ls.IT_JPG]:Ri.JPEG},yt={displayResolution:96,dataResolution:72,pdfResolution:72,enableResolution:!0,autoReleaseImg:gi(),autoReleaseBlob:!0};class T9{constructor(){S(this,"db",void 0),this.db=new Map}has(l){throw new Error("Method not implemented.")}save(l){throw new Error("Method not implemented.")}getSaverConstructor(l){return this.db.get(l)}setSaverConstructor(l,u){this.db.set(l,u)}deleteSaverConstructor(l){this.db.delete(l)}clear(){this.db.clear()}}const g6=new T9,Zee=new T9,Jee=new class{constructor(p,l){S(this,"saverConstructorRepo",void 0),S(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=p,this.customSaverConstructorRepo=l}execute(p){let l=this.customSaverConstructorRepo.getSaverConstructor(p);return l||(l=this.saverConstructorRepo.getSaverConstructor(p)),new l}}(g6,Zee),Qee=new class{constructor(p){S(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){let{mime:l,saverConstructor:u}=p;this.saverConstructorRepo.setSaverConstructor(l,u)}}(g6),Kee=new class{constructor(p){S(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){this.saverConstructorRepo.deleteSaverConstructor(p)}}(g6);var mc,vc,En,dl;(function(p){p.TIFF_AUTO="tiff/auto",p.TIFF_FAX3="tiff/fax3",p.TIFF_FAX4="tiff/fax4",p.TIFF_LZW="tiff/lzw",p.TIFF_JPEG="tiff/jpeg"})(mc||(mc={})),function(p){p.PDF_AUTO="pdf/auto",p.PDF_FAX4="pdf/fax4",p.PDF_LZW="pdf/lzw",p.PDF_JPEG="pdf/jpeg",p.PDF_JP2000="pdf/jp2000",p.PDF_JBIG2="pdf/jbig2"}(vc||(vc={})),function(p){p.PAGE_DEFAULT="page/default",p.PAGE_A4="page/a4",p.PAGE_A4_REVERSE="page/a4reverse",p.PAGE_A3="page/a3",p.PAGE_A3_REVERSE="page/a3reverse",p.PAGE_LETTER="page/letter",p.PAGE_LETTER_REVERSE="page/letterreverse",p.PAGE_LEGAL="page/legal",p.PAGE_LEGAL_REVERSE="page/legalreverse"}(En||(En={})),function(p){p.PRINT="print",p.MODIFY_CONTENTS="modify_contents",p.COPY_CONTENTS="copy_contents",p.EXTRACT_CONTENTS="extract_contents",p.MODIFY_ANNOTATIONS="modify_annotations",p.FILL_IN="fill_in",p.ASSEMBLY="assembly",p.DEGRADED_PRINT="degraded_print"}(dl||(dl={}));const m6=new Map([[En.PAGE_DEFAULT,0],[En.PAGE_A4,2],[En.PAGE_A4_REVERSE,3],[En.PAGE_A3,4],[En.PAGE_A3_REVERSE,5],[En.PAGE_LETTER,6],[En.PAGE_LETTER_REVERSE,7],[En.PAGE_LEGAL,8],[En.PAGE_LEGAL_REVERSE,9]]),v6=new Map([[vc.PDF_AUTO,0],[vc.PDF_FAX4,2],[vc.PDF_LZW,3],[vc.PDF_JPEG,5],[vc.PDF_JP2000,6],[vc.PDF_JBIG2,7]]),O3=new Map([[mc.TIFF_AUTO,0],[mc.TIFF_FAX3,1],[mc.TIFF_FAX4,2],[mc.TIFF_LZW,3],[mc.TIFF_JPEG,5]]);var Pn=new WeakMap,ul=new WeakMap,bh=new WeakMap;class ete{constructor(){Ht(this,Pn,void 0),Ht(this,ul,void 0),Ht(this,bh,void 0),gt(Pn,this,new S9),gt(ul,this,new Map)}destroy(){var l;null===(l=ee(Pn,this))||void 0===l||l.terminate(),gt(Pn,this,void 0)}convertPageSize(l,u){let f=0,g=0,m=0,v=0,y=0,x=0,w=0,C=0;const{pdfResolution:_,displayResolution:T}=yt;switch(l){case En.PAGE_A4:m=210/25.4*_,v=297/25.4*_,w=m,x=v;break;case En.PAGE_A4_REVERSE:m=297/25.4*_,v=210/25.4*_,w=m,x=v;break;case En.PAGE_A3:m=297/25.4*_,v=420/25.4*_,w=m,x=v;break;case En.PAGE_A3_REVERSE:m=420/25.4*_,v=297/25.4*_,w=m,x=v;break;case En.PAGE_LETTER:m=8.5*_,v=11*_,w=m,x=v;break;case En.PAGE_LETTER_REVERSE:m=11*_,v=8.5*_,w=m,x=v;break;case En.PAGE_LEGAL:m=8.5*_,v=14*_,w=m,x=v;break;case En.PAGE_LEGAL_REVERSE:m=14*_,v=8.5*_,w=m,x=v;break;default:f=u.mediaBox.left/T*_,g=u.mediaBox.top/T*_,m=u.mediaBox.width/T*_,v=u.mediaBox.height/T*_,y=u.cropBox.left/T*_,x=2*g+v-u.cropBox.top/T*_,w=y+u.cropBox.width/T*_,C=x-u.cropBox.height/T*_}return{left:f,top:g,width:m,height:v,cropLeft:y,cropTop:x,cropRight:w,cropBottom:C}}convertPdfSettings(l){const u={};return u.author=null==l?void 0:l.author,u.compression=null!=l&&l.compression?v6.get(l.compression):void 0,u.creationDate=null==l?void 0:l.creationDate,u.creator=null==l?void 0:l.creator,u.keyWords=null==l?void 0:l.keyWords,u.modifiedDate=null==l?void 0:l.modifiedDate,u.pageType=null!=l&&l.pageType?m6.get(l.pageType):void 0,u.producer=null==l?void 0:l.producer,u.quality=null==l?void 0:l.quality,u.subject=null==l?void 0:l.subject,u.title=null==l?void 0:l.title,u.version=null==l?void 0:l.version,null!=l&&l.password&&(u.encryptOptions={},u.encryptOptions.enabled=!0,u.encryptOptions.userPassword=l.password),u}init(l){var u=this;return Q(function*(){gt(bh,u,l||{});const f=u.convertPdfSettings(l);yield ee(Pn,u).initPdfSetting(f)})()}appendImagePage(l,u){var f=this;return Q(function*(){const{mediaBox:g}=u,m=f.convertPageSize(ee(bh,f).pageType,u);let v=yield ee(Pn,f).insertBlankPage(-1,m.left+m.width,m.top+m.height);const{pageIndex:y}=v;yield ee(Pn,f).setPageMediaBox(y,m.left,m.top,m.left+m.width,m.top+m.height),u.rotation&&(yield ee(Pn,f).setPageRotation(y,u.rotation));const{displayResolution:x,pdfResolution:w}=yt;let C=m.width,_=m.height,T=0,M=0;if(ee(bh,f).pageType&&ee(bh,f).pageType!==En.PAGE_DEFAULT){const H={width:g.width/x*w,height:g.height/x*w},G=m.width/H.width,z=m.height/H.height;if(G<z){const q=H.height*G;M=(m.height-q)/2,C=m.width,_=q}else{const q=H.width*z;T=(m.width-q)/2,C=q,_=m.height}ee(ul,f).set(y,[C/H.width,0,0,_/H.height,T,M])}T+=m.left,M+=m.top;let L=u.width,N=u.height,V=l;if(ee(bh,f).imageScaleFactor){let H=Math.floor(u.width*ee(bh,f).imageScaleFactor+.5),G=Math.floor(u.height*ee(bh,f).imageScaleFactor+.5);if(H<1&&(H=1),G<1&&(G=1),H!==L&&G!==N){const z=new Ch;yield z.initImage({source:l}),yield z.resize(H,G),V=(yield z.getImage({})).imageData,L=H,N=G,yield z.freeReservedData()}}return v=yield ee(Pn,f).addImageToPages(V,[y],{type:"image",imageWidth:C,imageHeight:_,position:[T,M]},L,N),yield ee(Pn,f).setPageCropBox(y,m.cropLeft,m.cropBottom,m.cropRight,m.cropTop),v})()}appendRawPdfPages(l,u,f){var g=this;return Q(function*(){yield ee(Pn,g).mergeRawPdfPages(l,u,f)})()}changePageImage(l,u,f){var g=this;return Q(function*(){const m=g.convertPageSize(En.PAGE_DEFAULT,f);return yield ee(Pn,g).clearPageObjects(l),yield ee(Pn,g).addImageToPages(u,[l],{type:"image",imageWidth:m.width,imageHeight:m.height,position:[m.left,m.top]},f.width,f.height)})()}setPageInfo(l){var u=this;return Q(function*(){for(const[f,g]of l){const m=u.convertPageSize(En.PAGE_DEFAULT,g),{rotation:v}=g;yield ee(Pn,u).setPageCropBox(f,m.cropLeft,m.cropBottom,m.cropRight,m.cropTop),yield ee(Pn,u).setPageRotation(f,(v%360+360)%360)}})()}setPageRotation(l){var u=this;return Q(function*(){for(const[f,g]of l){const m=(g%360+360)%360;yield ee(Pn,u).setPageRotation(f,m)}})()}getPdf(l){var u=this;return Q(function*(){return ee(Pn,u).getPdf(l)})()}updateAnnotPoint(l,u){return[l[0]*u[0]+l[1]*u[2]+u[4],l[0]*u[1]+l[1]*u[3]+u[5]]}fixAnnotationPosition(l,u){ee(ul,this).has(l)&&u.forEach(f=>{const g=this.updateAnnotPoint([f.rect[0],f.rect[1]],ee(ul,this).get(l)),m=this.updateAnnotPoint([f.rect[2],f.rect[3]],ee(ul,this).get(l));f.rect=[g[0],g[1],m[0],m[1]],"Highlight"!==f.type&&"StrikeOut"!==f.type&&"Underline"!==f.type&&"Squiggly"!==f.type||f.quadPoints.forEach(v=>{const y=this.updateAnnotPoint([v[0],v[1]],ee(ul,this).get(l)),x=this.updateAnnotPoint([v[2],v[3]],ee(ul,this).get(l)),w=this.updateAnnotPoint([v[4],v[5]],ee(ul,this).get(l)),C=this.updateAnnotPoint([v[6],v[7]],ee(ul,this).get(l));v=[y[0],y[1],x[0],x[1],w[0],w[1],C[0],C[1]]})})}removePageAnnotations(l){var u=this;return Q(function*(){yield ee(Pn,u).deletePageAnnotationsByTypes(l,"")})()}setPageAnnotations(l,u,f){var g=this;return Q(function*(){let m;return u&&u.length>0&&g.fixAnnotationPosition(l,u),f?u&&u.length>0&&(m=yield ee(Pn,g).addAnnotationsToPage(l,u)):m=yield ee(Pn,g).setPageAnnotations(l,u),m})()}flattenPage(l){var u=this;return Q(function*(){return yield ee(Pn,u).flattenPage(l)})()}getFontInfo(l){var u=this;return Q(function*(){return yield ee(Pn,u).getFontInfo(l)})()}ifFontsExist(l){var u=this;return Q(function*(){return yield ee(Pn,u).ifFontsExist(l)})()}}class D9{constructor(){S(this,"imageWriter",void 0),this.imageWriter=new _9}destroy(){var l;null===(l=this.imageWriter)||void 0===l||l.terminate(),this.imageWriter=void 0}save(l){var u=arguments,f=this;return Q(function*(){let g=u.length>1&&void 0!==u[1]?u[1]:{};return yield f.imageWriter.saveImage(l,{outputType:g.outputType,jpegQuality:g.jpegQuality,returnType:g.returnType})})()}}class tte{constructor(){S(this,"imageWriter",void 0),S(this,"tiffCompression",void 0),S(this,"tiffQuality",void 0),this.imageWriter=new _9,this.tiffCompression=O3.get(mc.TIFF_AUTO)}destroy(){var l;null===(l=this.imageWriter)||void 0===l||l.terminate(),this.imageWriter=void 0}init(l){var u=this;return Q(function*(){if(yield u.imageWriter.createTiff(),l&&(u.tiffQuality=l.quality,l.compression&&(u.tiffCompression=O3.get(l.compression)),l.customTag))for(let f=0;f<l.customTag.length;f++)yield u.imageWriter.addTiffTag(l.customTag[f].id,l.customTag[f].content,l.customTag[f].contentIsBase64)})()}appendPage(l){var u=this;return Q(function*(){yield u.imageWriter.appendImage(l,{inputType:void 0,tiffFormat:u.tiffCompression,jpegQuality:u.tiffQuality})})()}getTiff(){var l=this;return Q(function*(){return l.imageWriter.getTiff()})()}}class tp{constructor(l){S(this,"uid",void 0),this.uid=l||qt()}equals(l){return null!=l&&void 0!==l&&(this===l||!!(l instanceof tp)&&this.uid===l.uid)}}class ite extends tp{}let xr=class{constructor(p){S(this,"type",void 0),S(this,"uid",void 0),this.type=p,this.uid=qt()}};class a0{constructor(l){S(this,"bubbles",!0),S(this,"cancelBubble",!0),S(this,"cancelable",!1),S(this,"composed",!1),S(this,"currentTarget",void 0),S(this,"defaultPrevented",!1),S(this,"eventPhase",a0.prototype.NONE),S(this,"isTrusted",void 0),S(this,"returnValue",void 0),S(this,"srcElement",void 0),S(this,"target",void 0),S(this,"timeStamp",void 0),S(this,"type",void 0),S(this,"detail",void 0),S(this,"view",void 0),S(this,"which",void 0),S(this,"path",void 0),S(this,"immediatePropagationStopped",!1),S(this,"propagationStopped",!1),S(this,"nativeEvent",void 0),S(this,"originalEvent",void 0),S(this,"eventService",void 0),S(this,"NONE",0),S(this,"CAPTURING_PHASE",1),S(this,"AT_TARGET",2),S(this,"BUBBLING_PHASE",3),this.eventService=l}initUIEvent(l,u,f,g,m){}composedPath(){const{path:l,eventService:u,target:f}=this;return!u||l&&l[this.path.length-1]===f||(this.path=f?u.getPropagationPath(f):[]),this.path}bindEvents(l,u,f){}preventDefault(){const{nativeEvent:l}=this;l instanceof Event&&l.cancelable&&l.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.immediatePropagationStopped=!0}stopPropagation(){this.propagationStopped=!0}}function l0(p,l){l.isTrusted=p.isTrusted,l.srcElement=p.srcElement,l.timeStamp=performance.now(),l.type=p.type,l.detail=p.detail,l.view=p.view,l.which=p.which}class _h extends a0{constructor(l,u){super(null),this.type=l,this.detail=u}}class A9{constructor(){S(this,"pubsub",cl.create())}addEventListener(l,u,f){let g,m=Jn(f)&&f;vt(f)&&(m=f.capture,g=f.once),l=m?`${l}:capture`:l,u=Zf(u)?u:u.handleEvent,this.pubsub.on(l,u,this,g)}dispatchEvent(l){const u=this.ownerDocument||this.document;var f;return u&&(l.eventService=(null===(f=u.defaultView)||void 0===f?void 0:f.eventService)||null,l.defaultPrevented=!1,l.path=[],l.target=this,Es(l)),!l.defaultPrevented}removeEventListener(l,u,f){let g=Jn(f)&&f;vt(f)&&(g=f.capture),l=g?`${l}:capture`:l,u=Zf(u)?u:u.handleEvent,this.pubsub.off(l,u)}removeAllEventListeners(){this.pubsub.removeAllEventListeners()}getAllEvents(){return this.pubsub.getAllEvents()}}function po(p,l){const u=p.currentTarget.getAllEvents()[l]||[];for(let f=0,g=u.length;f<g;f++){if(p.immediatePropagationStopped)return;const{context:m,fn:v}=u[f];v.call(m,p)}}function Es(p,l){var u;if(l=null!==(u=l)&&void 0!==u?u:p.type,p.propagationStopped=!1,p.immediatePropagationStopped=!1,!p.target)return;const f=p.composedPath(),g=f.length;p.eventPhase=p.CAPTURING_PHASE;for(let m=0;m<g-1;m++)if(p.currentTarget=f[m],po(p,`${l}:capture`),y6(p))return;if(p.eventPhase=p.AT_TARGET,p.currentTarget=p.target,po(p,l),!y6(p)){p.eventPhase=p.BUBBLING_PHASE;for(let m=g-2;m>=0;m--)if(p.currentTarget=f[m],po(p,l),y6(p))return}}function y6(p){return p.propagationStopped||p.immediatePropagationStopped}const ip=p=>p/180*Math.PI,L3=p=>p/Math.PI*180;class Sh{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),S(this,"w",void 0),this.x=l,this.y=u,this.z=f,this.w=g}static fromQuat(l){return(new Sh).setFromQuat(l)}static fromEuler(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l=ip(l)/2,u=ip(u)/2,f=ip(f)/2;const g=Math.sin(l),m=Math.cos(l),v=Math.sin(u),y=Math.cos(u),x=Math.sin(f),w=Math.cos(f),C=new Sh;return C.setFromQuat({x:g*y*w-m*v*x,y:m*v*w+g*y*x,z:m*y*x-g*v*w,w:m*y*w+g*v*x}),C}clone(){const l=new Sh;return l.setFromQuat(this),l}setFromQuat(l){var u,f,g,m;const v=this;return v.x=null!==(u=l.x)&&void 0!==u?u:0,v.y=null!==(f=l.y)&&void 0!==f?f:0,v.z=null!==(g=l.z)&&void 0!==g?g:0,v.w=null!==(m=l.w)&&void 0!==m?m:1,this}toEuler(){const{x:l,y:u,z:f,w:g}=this,m=.4990234375,v=this.w*this.y-this.x*this.z;if(v<-m||v>m){const y=Math.sign(v);return{z:-2*y*Math.atan2(this.x,this.w),y:y*(Math.PI/2),x:0}}return{x:L3(Math.atan2(2*(u*f+g*l),g*g-l*l-u*u+f*f)),y:L3(Math.asin(-2*(l*f-g*u))),z:L3(Math.atan2(2*(l*u+g*f),g*g+l*l-u*u-f*f))}}invert(){const{x:l,y:u,z:f,w:g}=this,m=l*l+u*u+f*f+g*g,v=m?1/m:0;return this.x=-l*v,this.y=-u*v,this.z=-f*v,this.w=g*v,this}multiply(l){const{x:u,y:f,z:g,w:m}=this,{x:v,y,z:x,w}=l;return this.x=u*w+m*v+f*x-g*y,this.y=f*w+m*y+g*v-u*x,this.z=g*w+m*x+u*y-f*v,this.w=m*w-u*v-f*y-g*x,this}normalize(){const{x:l,y:u,z:f,w:g}=this,m=l*l+u*u+f*f+g*g;return this.x/=m,this.y/=m,this.z/=m,this.w/=m,this}}function F3(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Ve(p)?new Sh(p,l,u,f):Sh.fromQuat(p)}function N3(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Sh.fromEuler(p,l,u)}class ls{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new ls(l.x,l.y,l.z)}static fromTwoPoint(l,u){var f,g,m,v,y,x;return new ls((null!==(f=u.x)&&void 0!==f?f:0)-(null!==(g=l.x)&&void 0!==g?g:0),(null!==(m=u.y)&&void 0!==m?m:0)-(null!==(v=l.y)&&void 0!==v?v:0),(null!==(y=u.z)&&void 0!==y?y:0)-(null!==(x=l.z)&&void 0!==x?x:0))}static fromValue(l,u,f){return new ls(l,u,f)}setFromVector(l){var u;this.x=l.x,this.y=l.y,this.z=null!==(u=l.z)&&void 0!==u?u:0}clone(){return new ls(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(l){var u;return this.x*l.x+this.y*l.y+this.z*(null!==(u=l.z)&&void 0!==u?u:0)}projectionTo(l){const u=Math.hypot(l.x,l.y,l.z);return this.dot(l)/u}angle(l){const u=this.norm()*Math.hypot(l.x,l.y,l.z),f=u&&this.dot(l)/u;return Math.acos(Pi(f,-1,1))}equals(l){var u;return this.x===l.x&&this.y===l.y&&this.z===(null!==(u=l.z)&&void 0!==u?u:0)}distance(l){var u;return Math.hypot(this.x-l.x,this.y-l.y,this.z-(null!==(u=l.z)&&void 0!==u?u:0))}lerp(l){var u;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:g,y:m,z:v}=this;return new ls(g+f*(l.x-g),m+f*(l.y-m),v+f*((null!==(u=l.z)&&void 0!==u?u:0)-v))}normalize(){const l=this,u=l.norm();return l.x/=u,l.y/=u,l.z/=u,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(l){const u=this;return{x:u.y*l.z-u.z*l.y,y:u.z*l.x-u.x*l.z,z:u.x*l.y-u.y*l.x}}add(l){return this.x+=l.x,this.y+=l.y,this.z+=l.z,this}multiply(l){return this.x*=l.x,this.y*=l.y,this.z*=l.z,this}}function Fi(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ve(p)?ls.fromValue(p,l,u):ls.fromPoint(p)}function I9(p,l){return ls.fromTwoPoint(p,l)}class Mi{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),this.x=l,this.y=u,this.z=f}static fromPoint(l){return new Mi(l.x,l.y,l.z)}matrixTransform(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:u,y:f,z:g}=this,{m11:m,m21:v,m31:y,m41:x,m12:w,m22:C,m32:_,m42:T,m13:M,m23:L,m33:N,m43:V,m14:H,m24:G,m34:z,m44:q}=l,te=H*u+G*f+z*g+q;return c0({x:(m*u+v*f+y*g+x)/te,y:(w*u+C*f+_*g+T)/te,z:(M*u+L*f+N*g+V)/te})}setFromPoint(l){return this.x=l.x||0,this.y=l.y||0,this.z=l.z||0,this}clone(){return c0(this)}equals(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return m.x===u&&m.y===f&&m.z===g}distanceTo(l){const{x:u=0,y:f=0,z:g=0}=l,m=this;return Math.hypot(m.x-u,m.y-f,m.z-g)}lerpTo(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:f=0,y:g=0,z:m=0}=l,v=this;return c0({x:v.x+u*(f-v.x),y:v.y+u*(g-v.y),z:v.z+u*(m-v.z)})}footPointInSegment(l,u){const f=I9(l,this),g=I9(l,u),m=g.norm(),v=c0(l);if(0===m)return v;const y=f.projectionTo(g)/m;return v.lerpTo(u,y)}perpendicularToSegment(l,u){const f=this.footPointInSegment(l,u);return this.distanceTo(f)}}function c0(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ve(p)?new Mi(p,l,u):new Mi(p.x,p.y,p.z)}const P9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class sn{constructor(l){if(S(this,"a",1),S(this,"b",0),S(this,"c",0),S(this,"d",1),S(this,"e",0),S(this,"f",0),S(this,"m11",1),S(this,"m12",0),S(this,"m13",0),S(this,"m14",0),S(this,"m21",0),S(this,"m22",1),S(this,"m23",0),S(this,"m24",0),S(this,"m31",0),S(this,"m32",0),S(this,"m33",1),S(this,"m34",0),S(this,"m41",0),S(this,"m42",0),S(this,"m43",0),S(this,"m44",1),S(this,"is2D",void 0),l||(l=P9),!nt(l)){if(!Xt(l))throw new Error("Matrix4 error.");C6(l,this)}}static fromQuat(l){const{x:u,y:f,z:g,w:m}=l,v=new sn;return v.m11=1-2*(f*f+g*g),v.m12=2*(u*f+g*m),v.m13=2*(u*g-f*m),v.m21=2*(u*f-g*m),v.m22=1-2*(u*u+g*g),v.m23=2*(f*g+u*m),v.m31=2*(u*g+f*m),v.m32=2*(f*g-u*m),v.m33=1-2*(u*u+f*f),v.setFromMatrix(v),v}static fromMatrix(l){const u=new sn;return u.setFromMatrix(l),u.is2D=!!l.is2D,u}static fromFloat32Array(l){const u=new sn;return C6(l,u),u}static fromFloat64Array(l){const u=new sn;return C6(l,u),u}get isIdentity(){const l=this.toArray();for(let u=0;u<16;u++)if(l[u]!==P9[u])return!1;return!0}translate(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(l,u,f)}scale(l,u,f,g,m,v){var y,x,w,C,_;return null!==(y=l)&&void 0!==y||(l=1),null!==(x=u)&&void 0!==x||(u=1),null!==(w=g)&&void 0!==w||(g=0),null!==(C=m)&&void 0!==C||(m=0),null!==(_=v)&&void 0!==_||(v=0),Se(u)&&(u=l),this.clone().scaleSelf(l,u,f,g,m,v)}scale3d(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(l,u,f,g)}rotate(l,u,f){var g;return null!==(g=l)&&void 0!==g||(l=0),this.clone().rotateSelf(l,u,f)}rotateFromVector(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(l,u)}rotateAxisAngle(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(l,u,f,g)}skewX(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(l)}skewY(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(l)}multiply(l){return this.clone().multiplySelf(l)}flipX(){return this.clone().multiplySelf(new sn([-1,0,0,1,0,0]))}flipY(){return this.clone().multiplySelf(new sn([1,0,0,-1,0,0]))}inverse(){return this.clone().invertSelf()}transformPoint(l){return c0(l).matrixTransform(this)}toFloat32Array(){const l=this.toArray();return new Float32Array(l)}toFloat64Array(){const l=this.toArray();return new Float64Array(l)}toJSON(){}multiplySelf(){const l=M9(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(l),this}preMultiplySelf(){const l=M9(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(l),this}translateSelf(){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const u=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{m11:1,m21:0,m31:0,m41:f,m12:0,m22:1,m32:0,m42:g,m13:0,m23:0,m33:1,m43:m,m14:0,m24:0,m34:0,m44:1}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l);return this.multiplySelf(u),l&&(this.is2D=!1),this}scaleSelf(l,u,f,g,m,v){var y,x,w,C,_;null!==(y=l)&&void 0!==y||(l=1),null!==(x=u)&&void 0!==x||(u=1),null!==(w=g)&&void 0!==w||(g=0),null!==(C=m)&&void 0!==C||(m=0),null!==(_=v)&&void 0!==_||(v=0),(g||m||v)&&this.translateSelf(g,m,v),Se(u)&&(u=l);const T=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{m11:M,m21:0,m31:0,m41:0,m12:0,m22:L,m32:0,m42:0,m13:0,m23:0,m33:N,m43:0,m14:0,m24:0,m34:0,m44:1}}(l,u,f);return this.multiplySelf(T),this.translateSelf(-g,-m,-v),1!==f&&(this.is2D=!1),this}scale3dSelf(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.scaleSelf(l,l,l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}rotateSelf(l,u,f){var g,m,v;null!==(g=l)&&void 0!==g||(l=0),Se(u)&&Se(f)&&(f=l,l=0,u=0),null!==(m=u)&&void 0!==m||(u=0),null!==(v=f)&&void 0!==v||(f=0),0===l&&0===u||(this.is2D=!1);const y=h0(f,[0,0,1]),x=h0(u,[0,1,0]),w=h0(l,[1,0,0]);return this.multiplySelf(y),this.multiplySelf(x),this.multiplySelf(w),this}rotateFromVectorSelf(){const l=Fi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),u=Fi(1,0),f=h0(l.angle(u),[0,0,1]);return this.multiplySelf(f),this}rotateAxisAngleSelf(){const l=h0(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(l),this}skewXSelf(){const l=k9(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(l),this}skewYSelf(){const l=k9(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(l),this}invertSelf(){const l=function(u){if(u[0].length!==u.length)throw new Error;const f=w6(u),g=function(m){if(m[0].length!==m.length)throw new Error("Not square matrix.");const v=m.length,y=new Array(v).fill(0).map(x=>new Array(v).fill(0));for(let x=0;x<v;x++)for(let w=0;w<v;w++)y[x][w]=R9(m,x,w);return function(x){const w=new Array(x.length).fill(0).map(C=>new Array(x[0].length).fill(0));for(let C=0;C<w.length;C++)for(let _=0;_<w[0].length;_++)w[C][_]=x[_][C];return w}(y)}(u);for(let m=0;m<g.length;m++)for(let v=0;v<g.length;v++)g[m][v]/=f;return g}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(l),this}setMatrixValue(l){return new sn}setFromMatrix(l){const u=this;u.m11=l.m11,u.m12=l.m12,u.m13=l.m13,u.m14=l.m14,u.m21=l.m21,u.m22=l.m22,u.m23=l.m23,u.m24=l.m24,u.m31=l.m31,u.m32=l.m32,u.m33=l.m33,u.m34=l.m34,u.m41=l.m41,u.m42=l.m42,u.m43=l.m43,u.m44=l.m44,u.a=l.m11,u.b=l.m12,u.c=l.m21,u.d=l.m22,u.e=l.m41,u.f=l.m42,!1===l.is2D&&(u.is2D=!1)}setFromTwoDimensionalArray(l){const[[u,f,g,m],[v,y,x,w],[C,_,T,M],[L,N,V,H]]=l;this.setFromMatrix({m11:u,m21:f,m31:g,m41:m,m12:v,m22:y,m32:x,m42:w,m13:C,m23:_,m33:T,m43:M,m14:L,m24:N,m34:V,m44:H})}clone(){return sn.fromMatrix(this)}determinant(){return w6(this.toTwoDimensionalArray())}toTwoDimensionalArray(){const l=this;return[[l.m11,l.m21,l.m31,l.m41],[l.m12,l.m22,l.m32,l.m42],[l.m13,l.m23,l.m33,l.m43],[l.m14,l.m24,l.m34,l.m44]]}toArray(){const l=this;return[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44]}decompose(){if(0===this.m44)return{};let l=function(_){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Ve(_)?new h9(_,T,M,L):new h9(_.x,_.y,_.z,_.w)}(0,0,0,1);const u=F3(0,0,0,1),f=Fi(0,0,0),g=Fi(0,0,0),m=Fi(0,0,0),v=this;v.normalize();const y=v.clone();if(y.m14=0,y.m24=0,y.m34=0,y.m44=1,0===y.determinant())return!1;if(0!==v.m14||0!==v.m24||0!==v.m34){const _={x:v.m14,y:v.m24,z:v.m34,w:v.m44};l=y.invertSelf().transposeSelf().multiplyVector(_)}else l.x=0,l.y=0,l.z=0,l.w=1;m.x=v.m41,m.y=v.m42,m.z=v.m43;const x=[Fi(v.m11,v.m12,v.m13),Fi(v.m21,v.m22,v.m23),Fi(v.m31,v.m32,v.m33)];f.x=x[0].norm(),x[0].normalize(),g.x=x[0].dot(x[1]),x[1]=Fi(x6(x[1],x[0],1,-g.x)),f.y=x[1].norm(),x[1].normalize(),g.x/=f.y,g.y=x[0].dot(x[2]),x[2]=Fi(x6(x[2],x[0],1,-g.y)),g.z=x[1].dot(x[2]),x[2]=Fi(x6(x[2],x[1],1,-g.z)),f.z=x[2].norm(),x[2].normalize(),g.y/=f.z,g.z/=f.z;const w=x[1].cross(x[2]);let C;if(x[0].dot(w)<0&&(f.negate(),x[0].negate(),x[1].negate(),x[2].negate()),u.x=.5*Math.max(1+x[0].x-x[1].y-x[2].z,0)**.5,u.y=.5*Math.max(1-x[0].x+x[1].y-x[2].z,0)**.5,u.z=.5*Math.max(1-x[0].x-x[1].y+x[2].z,0)**.5,u.w=.5*Math.max(1+x[0].x+x[1].y+x[2].z,0)**.5,x[2].y>x[1].z&&(u.x*=-1),x[0].z>x[2].x&&(u.y*=-1),x[1].x>x[0].y&&(u.z*=-1),u.x<.001&&u.x>=0&&u.y<.001&&u.y>=0){const _=Math.atan2(x[0].y,x[0].x);C={x:0,y:0,z:Number(L3(_).toFixed(3))}}else C=u.toEuler();return{rotation:C,scale:f,translation:m,skew:g,quaternion:u,perspective:l}}multiplyVector(l){const u=this,{x:f,y:g,z:m,w:v}=l;return{x:u.m11*f+u.m21*g+u.m31*m+u.m41*v,y:u.m12*f+u.m22*g+u.m32*m+u.m42*v,z:u.m13*f+u.m23*g+u.m33*m+u.m43*v,w:u.m14*f+u.m24*g+u.m34*m+u.m44*v}}transpose(){const l=this.clone();return l.transposeSelf(),l}transposeSelf(){const{m11:l,m21:u,m31:f,m41:g,m12:m,m22:v,m32:y,m42:x,m13:w,m23:C,m33:_,m43:T,m14:M,m24:L,m34:N,m44:V}=this;return this.setFromMatrix({m11:l,m21:m,m31:w,m41:M,m12:u,m22:v,m32:C,m42:L,m13:f,m23:y,m33:_,m43:N,m14:g,m24:x,m34:T,m44:V}),this}normalize(){const l=this,u=l.m44;l.m11/=u,l.m12/=u,l.m13/=u,l.m14/=u,l.m21/=u,l.m22/=u,l.m23/=u,l.m24/=u,l.m31/=u,l.m32/=u,l.m33/=u,l.m34/=u,l.m41/=u,l.m42/=u,l.m43/=u,l.m44/=u}getTranslation(){return Fi(this.m41,this.m42,this.m43)}getRotation(){const l=this,u=.5*(l.m11+l.m22+l.m33+1)**.5;return F3(.25*(l.m23-l.m32)/u,.25*(l.m31-l.m13)/u,.25*(l.m12-l.m21)/u,u)}getScaling(){const l=this;return Fi(Math.hypot(l.m11,l.m12,l.m13),Math.hypot(l.m21,l.m22,l.m23),Math.hypot(l.m31,l.m32,l.m33))}toEuler(){const l=this.getRotation().toEuler();return Fi(l.x,l.y,l.z)}}function x6(p,l,u,f){return{x:u*p.x+f*l.x,y:u*p.y+f*l.y,z:u*p.z+f*l.z}}function w6(p){if(p.length!==p[0].length)throw new Error;const l=p.length;let u=0;if(l>3)for(let f=0;f<l;f++)u+=p[0][f]*R9(p,0,f);else 3===l?u=p[0][0]*p[1][1]*p[2][2]+p[0][1]*p[1][2]*p[2][0]+p[0][2]*p[1][0]*p[2][1]-p[0][2]*p[1][1]*p[2][0]-p[0][1]*p[1][0]*p[2][2]-p[0][0]*p[1][2]*p[2][1]:2===l?u=p[0][0]*p[1][1]-p[0][1]*p[1][0]:1===l&&([[u]]=p);return u}function R9(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const f=p.length,g=new Array(f-1).fill(0).map(m=>new Array(f-1).fill(0));for(let m=0;m<f-1;m++)for(let v=0;v<f-1;v++)g[m][v]=p[m<l?m:m+1][v<u?v:v+1];return(-1)**(l+u)*w6(g)}function C6(p,l){const[u,f,g,m,v,y,x,w,C,_,T,M,L,N,V,H]=p;if(6===p.length)l.m11=u,l.m12=f,l.m21=g,l.m22=m,l.m41=v,l.m42=y,l.m13=0,l.m14=0,l.m23=0,l.m24=0,l.m31=0,l.m32=0,l.m34=0,l.m33=1,l.m44=1,l.is2D=!0;else{if(16!==p.length)throw new Error;l.m11=u,l.m12=f,l.m13=g,l.m14=m,l.m21=v,l.m22=y,l.m23=x,l.m24=w,l.m31=C,l.m32=_,l.m33=T,l.m34=M,l.m41=L,l.m42=N,l.m43=V,l.m44=H,l.is2D=!1}}function M9(p,l){const u={},{m11:f,m21:g,m31:m,m41:v,m12:y,m22:x,m32:w,m42:C,m13:_,m23:T,m33:M,m43:L,m14:N,m24:V,m34:H,m44:G}=p,{m11:z,m21:q,m31:te,m41:se,m12:ae,m22:j,m32:le,m42:ue,m13:xe,m23:I,m33:A,m43:P,m14:O,m24:b,m34:D,m44:k}=l;return u.m11=f*z+g*ae+m*xe+v*O,u.m21=f*q+g*j+m*I+v*b,u.m31=f*te+g*le+m*A+v*D,u.m41=f*se+g*ue+m*P+v*k,u.m12=y*z+x*ae+w*xe+C*O,u.m22=y*q+x*j+w*I+C*b,u.m32=y*te+x*le+w*A+C*D,u.m42=y*se+x*ue+w*P+C*k,u.m13=_*z+T*ae+M*xe+L*O,u.m23=_*q+T*j+M*I+L*b,u.m33=_*te+T*le+M*A+L*D,u.m43=_*se+T*ue+M*P+L*k,u.m14=N*z+V*ae+H*xe+G*O,u.m24=N*q+V*j+H*I+G*b,u.m34=N*te+V*le+H*A+G*D,u.m44=N*se+V*ue+H*P+G*k,u}function h0(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];p=ip(p);const u=Math.sin(p/2)*Math.cos(p/2),f=Math.sin(p/2)**2,[g,m,v]=l;return{m11:1-2*(m**2+v**2)*f,m21:2*(g*m*f-v*u),m31:2*(g*v*f+m*u),m41:0,m12:2*(g*m*f+v*u),m22:1-2*(g**2+m**2)*f,m32:2*(m*v*f-g*u),m42:0,m13:2*(g*v*f-m*u),m23:2*(m*v*f+g*u),m33:1-2*(g**2+m**2)*f,m43:0,m14:0,m24:0,m34:0,m44:1}}function k9(p,l){const u=new sn;return p&&(u.m21=Math.tan(ip(p))),l&&(u.m12=Math.tan(ip(l))),u}class O9{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;S(this,"x",void 0),S(this,"y",void 0),S(this,"z",void 0),S(this,"w",void 0),this.x=l,this.y=u,this.z=f,this.w=g}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const l=this.norm();this.x/=l,this.y/=l,this.z/=l,this.w/=l}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}}function B3(p,l,u){const f=p.x-l.x,g=p.y-l.y;let m=(u.x-p.x)*f+(u.y-p.y)*g;return m/=f*f+g*g,new Mi(p.x+m*f,p.y+m*g)}function b6(p,l,u,f){let g=p[0]*(u[1]-l[1])+l[0]*(p[1]-u[1])+u[0]*(l[1]-p[1]),m=p[0]*(f[1]-l[1])+l[0]*(p[1]-f[1])+f[0]*(l[1]-p[1]);return!((g^m)>=0&&0!==g&&0!==m||(g=u[0]*(p[1]-f[1])+f[0]*(u[1]-p[1])+p[0]*(f[1]-u[1]),m=u[0]*(l[1]-f[1])+f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1]),(g^m)>=0&&0!==g&&0!==m))}const li=new class{recursiveUpdateHierarchy(p){const{transform:l,childNodes:u}=p;l.frozen||(l.frozen=!0,(l.localDirty||l.worldDirty)&&this.updateHierarchy(p),u.forEach(f=>{this.recursiveUpdateHierarchy(f)}))}querySelector(p,l){return p.startsWith("#")?l.find(u=>u.id===p.substring(1)):null}querySelectorAll(p,l){return[]}append(p,l,u){p.parentNode&&this.remove(p),p.parentNode=l;const{childNodes:f,sortable:g}=l;void 0!==u?f.splice(u,0,p):f.push(p),g&&(g.dirty=!0);const{transform:m}=p;m&&this.dirtyWorld(p,m),m.frozen&&this.unfreezeParentToRoot(p)}remove(p){const{parentNode:l}=p;let u=!0;if(!l)return u=!1,u;const{sortable:f}=l;f&&(f.dirty=!0);const{childNodes:g}=l,m=g.indexOf(p);m>-1?(u=!0,g.splice(m,1)):u=!1;const{transform:v}=p;return v&&this.dirtyWorld(p,v),p.parentNode=null,u}isChildExist(p){const{parentNode:l}=p;if(!l)return!1;const{childNodes:u}=l;return!(u.indexOf(p)<0)}setOrigin(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ve(l)&&(l=ls.fromValue(l,u));const{transform:f}=p;f.origin.equals(l)||(f.origin.setFromVector(l),this.dirtyLocal(p,f))}getOrigin(p){return p.transform.origin}setPosition(p,l){const{transform:u}=p,f=ls.fromValue(l.x,l.y,l.z||0),g=this.getPosition(p);if(f.equals(g))return;let m=this.getWorldTransform(p);const v=this.getPosition(p),y=f.x-v.x,x=f.y-v.y,w=f.z-v.z;if(u.position=f,p.hasParentTransform()){m=(new sn).translateSelf(y,x,w).multiply(m);const{worldTransform:C}=p.parentNode.transform,_=this.getWorldTransform(p);_.m41=f.x,_.m42=f.y,_.m43=f.z;const T=C.inverse().multiply(m),M=this.getOrigin(p),L=T.getScaling(),N=this.createScaleMatrix(L.x,L.y,L.z),V=sn.fromMatrix(N).inverse(),H=T.translate(M.x,M.y,M.z).multiply(V),G=H.getRotation(),z=sn.fromQuat(G).inverse(),q=H.multiply(z).getTranslation();q.x-=M.x,q.y-=M.y,q.z-=M.z,u.localPosition.setFromVector(q)}else u.localPosition=f;this.dirtyLocal(p,u)}setLocalPosition(p,l){const{transform:u}=p,f=ls.fromValue(l.x,l.y,l.z||0);f.equals(u.localPosition)||(u.localPosition=f,this.dirtyLocal(p,u))}getPosition(p){const l=this.getWorldTransform(p),{transform:u}=p,f=l.getTranslation();return u.position.setFromVector(f),p.transform.position}getLocalPosition(p){return p.transform.localPosition}translate(p,l){if(l.equals(new ls))return;const u=this.getPosition(p),f=this.getWorldTransform(p),g=f.getScaling(),m=this.createScaleMatrix(g.x,g.y,g.z),v=f.multiply(sn.fromMatrix(m).inverse()).getRotation(),y=sn.fromQuat(v).transformPoint(l);180===p.getAngle()&&(y.x=-y.x,y.y=-y.y),u.add(y),this.setPosition(p,u)}translateLocal(p,l){const{transform:u}=p;if(l.equals(new ls))return;l.multiply(u.localScale);const f=sn.fromQuat(u.localRotation).transformPoint(l);u.localPosition.add(f),this.dirtyLocal(p,u)}scaleLocal(p,l){const{transform:u}=p;u.localScale.multiply(l),this.dirtyLocal(p,u)}setLocalScale(p,l){const{transform:u}=p,f=ls.fromValue(l.x,l.y,l.z||u.localScale.z);f.equals(u.localScale)||(u.localScale=f,this.dirtyLocal(p,u))}getScale(p){const{transform:l}=p,u=this.getWorldTransform(p).getScaling();return l.scale.setFromVector(u),l.scale}getLocalScale(p){return p.transform.localScale}getRotation(p){const{transform:l}=p,u=this.getWorldTransform(p),f=u.getScaling(),g=this.createScaleMatrix(f.x,f.y,f.z),m=u.multiply(sn.fromMatrix(g).inverse()).getRotation();return l.rotation.setFromQuat(m),l.rotation}getLocalRotation(p){return p.transform.localRotation}rotate(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{transform:g}=p;if(Ve(l)&&(l=Fi(l,u,f)),p.hasParentTransform()){const m=N3(l.x,l.y,l.z),v=this.getRotation(p),y=this.getRotation(p.parentNode).clone().invert().multiply(m).multiply(v).normalize();g.localRotation.setFromQuat(y),this.dirtyLocal(p,g)}else this.rotateLocal(p,l)}rotateLocal(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Ve(l)&&(l=Fi(l,u,f));const{transform:g}=p,m=N3(l.x,l.y,l.z);g.localRotation.multiply(m),this.dirtyLocal(p,g)}setAngle(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Ve(l)&&(l=Fi(l,u,f));const{transform:g}=p;if(p.hasParentTransform()){const m=N3(l.x,l.y,l.z);g.localRotation.setFromQuat(m);const v=this.getRotation(p.parentNode);v.invert(),g.localRotation.setFromQuat(v.multiply(g.localRotation)),this.dirtyLocal(p,g)}else this.setLocalAngle(p,l)}setLocalAngle(p,l){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Ve(l)&&(l=Fi(l,u,f));const{transform:g}=p,m=N3(l.x,l.y,l.z);g.localRotation.setFromQuat(m),this.dirtyLocal(p,g)}setRotation(p,l){const{transform:u}=p;if(p.hasParentTransform()){let f=this.getRotation(p.parentNode);f=f.clone().invert().multiply(l).normalize(),u.localRotation.setFromQuat(f),this.dirtyLocal(p,u)}else this.setLocalRotation(p,l)}setLocalRotation(p,l){const{transform:u}=p;u.localRotation.setFromQuat(l),this.dirtyLocal(p,u)}getAngle(p){const l=this.getWorldTransform(p);return Sh.fromQuat(l.decompose().quaternion).toEuler()}getLocalAngle(p){return this.getLocalRotation(p).toEuler()}setLocalTransform(p,l){const u=this.getOrigin(p),{rotation:g,scale:m}=l.decompose(),v=this.createScaleMatrix(m.x,m.y,m.z),y=sn.fromMatrix(v).inverse(),x=l.translate(u.x,u.y,u.z).multiply(y).getTranslation();x.x-=u.x,x.y-=u.y,x.z-=u.z,this.setLocalPosition(p,x),this.setLocalAngle(p,g.x,g.y,g.z),this.setLocalScale(p,m)}createScaleMatrix(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}resetLocalTransform(p){this.setLocalScale(p,new ls(1,1,1)),this.setLocalPosition(p,new ls(0,0,0)),this.setLocalAngle(p,0)}getWorldTransform(p){const{transform:l}=p;if(!l.worldDirty&&!l.localDirty)return l.worldTransform;const{parentNode:u}=p;return u&&u.transform&&this.getWorldTransform(u),this.updateHierarchy(p),l.worldTransform}getLocalTransform(p){const{transform:l}=p;return l.localDirty&&l.updateLocalTransform(),l.localTransform}getBounds(p,l){const{renderable:u,childNodes:f}=p;if(l&&!u.renderBoundsDirty&&u)return u.renderBounds;if(!l&&!u.boundsDirty&&u.bounds)return u.bounds;let g=this.getTransformedGeometryBounds(p,l);f.forEach(v=>{const y=this.getBounds(v,l);y&&(g?g.addBounds(y):g=wr.fromBounds(y))});const{clipPath:m}=p.style;if(m){const v=this.getTransformedGeometryBounds(m,!0);let y=null;v&&(y=wr.create(),y.setFromTransformedBounds(this.getWorldTransform(p),v)),g?y&&(g=y.intersection(g)):g=y}return l?(u.renderBoundsDirty=!1,g&&(u.renderBounds=g)):(u.boundsDirty=!1,g&&(u.bounds=g)),g||wr.create()}getLocalBounds(p){const{parentNode:l}=p;if(l){let u=new sn;l.transform&&(u=this.getWorldTransform(l).inverse());const f=this.getBounds(p);if(!wr.isEmpty(f)){const g=wr.create();return g.setFromTransformedBounds(u,f),g}}return this.getBounds(p)}getGeometryBounds(p,l){const{geometry:u}=p;return(l?u.renderBounds:u.contentBounds)||wr.create()}getBoundingClientRect(p){var l;let u;const f=this.getGeometryBounds(p);wr.isEmpty(f)||(u=wr.create(),u.setFromTransformedBounds(this.getWorldTransform(p),f));const g=null===(l=p.ownerDocument)||void 0===l?void 0:l.defaultView.getContextService().getBoundingClientRect();return u?{x:u.minX+((null==g?void 0:g.left)||0),y:u.minY+((null==g?void 0:g.top)||0),width:u.maxX-u.minX,height:u.maxY-u.minY}:{x:(null==g?void 0:g.left)||0,y:(null==g?void 0:g.top)||0,width:0,height:0}}updateHierarchy(p){const{transform:l}=p;if(l.localDirty&&l.updateLocalTransform(),l.worldDirty){var u;let f=null==p||null===(u=p.parentNode)||void 0===u?void 0:u.transform;p.parentNode&&f||(f=new L9),l.updateWorldTransform(f)}}getTransformedGeometryBounds(p){const u=this.getGeometryBounds(p,arguments.length>1&&void 0!==arguments[1]&&arguments[1]);if(!wr.isEmpty(u)){const f=wr.create();return this.getWorldTransform(p),f.setFromTransformedBounds(this.getWorldTransform(p),u),f}return null}dirtyLocal(p,l){l.localDirty||(l.localDirty=!0,l.worldDirty||this.dirtyWorld(p,l))}dirtyWorld(p,l){l.worldDirty||this.unfreezeParentToRoot(p),this.recursiveDirtyWorld(p,l),function(u){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=u;for(;g;){const{renderable:v}=g;v&&(v.boundsDirty=!0,v.renderBoundsDirty=!0),g=g.parentNode}const m=new _h("bounds-changed",{affectChildren:f});u.dispatchEvent(m)}(p,!0)}recursiveDirtyWorld(p,l){if(l.worldDirty)return;l.worldDirty=!0,l.frozen=!1,p.childNodes.forEach(g=>{const{transform:m}=g;m.worldDirty||this.recursiveDirtyWorld(g,m)});const{renderable:u}=p;u&&(u.boundsDirty=!0,u.renderBoundsDirty=!0);const f=new Bd("DOMAttrModified",p,null,null,"modelMatrix",Bd.MODIFICATION,null,null);p.dispatchEvent(f)}unfreezeParentToRoot(p){let l=p;for(;l;){const{transform:u}=l;u&&(u.frozen=!1),l=l.parentNode}}};class nte{constructor(){S(this,"contentBounds",void 0),S(this,"renderBounds",void 0)}}class ste{constructor(){S(this,"boundsDirty",!0),S(this,"bounds",void 0),S(this,"renderBoundsDirty",!0),S(this,"renderBounds",void 0)}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0}}class rte{constructor(){S(this,"renderOrder",0),S(this,"lastSortedIndex",void 0),S(this,"sorted",void 0),S(this,"dirty",!1)}}let L9=class{constructor(){S(this,"frozen",!0),S(this,"worldDirty",!1),S(this,"localDirty",!1),S(this,"localRotation",F3(0,0,0,1)),S(this,"rotation",F3(0,0,0,1)),S(this,"localScale",Fi(1,1,1)),S(this,"scale",Fi(1,1,1)),S(this,"localPosition",Fi(0,0,0)),S(this,"position",Fi(0,0,0)),S(this,"localSkew",Fi(0,0,0)),S(this,"skew",Fi(0,0,0)),S(this,"origin",Fi(0,0,0)),S(this,"worldTransform",new sn),S(this,"localTransform",new sn)}updateLocalTransform(){const{origin:p,localScale:l,localPosition:u,localRotation:f,localSkew:g}=this,m=new sn;m.translateSelf(p.x,p.y,p.z);const v=function(x){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Ve(x)?new O9(x,w,C,_):new O9(x.x,x.y,x.z,x.w)}(0,0,0,1),y=this.compose(v,u,f,g,l);m.multiplySelf(y),m.translateSelf(-p.x,-p.y,-p.z),this.localTransform.setFromMatrix(m),this.localDirty=!1}updateWorldTransform(p){const l=p.worldTransform.clone();l.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(l),this.worldDirty=!1}compose(p,l,u,f,g){const m=new sn;m.m14=p.x,m.m24=p.y,m.m34=p.z,m.m44=p.w,m.translateSelf(l.x,l.y,l.z);const v=sn.fromQuat(u);m.multiplySelf(v);const y=new sn;return f.z&&(y.m32=f.z,m.multiplySelf(y)),f.y&&(y.m32=0,y.m31=f.y,m.multiplySelf(y)),f.x&&(y.m31=0,y.m21=f.x,m.multiplySelf(y)),m.scaleSelf(g.x,g.y,g.z),m}};function _6(p,l){if(Number.isNaN(l))return{unit:"px",value:0};if(tr(l))return{unit:"px",value:0};if(Ve(l))return{unit:"px",value:l};if(l=l.trim().toLowerCase(),Number.isFinite(Number(l))&&"px".search(p)>=0)return{unit:"px",value:Number(l)};const u=[];l=l.replace(p,g=>(u.push(g),`U${g}`));const f=`U(${p.source})`;return u.map(g=>({unit:g,value:Number(l.replace(new RegExp(`U${g}`,"g"),"").replace(new RegExp(f,"g"),"*0"))}))[0]}const Dt=p=>_6(/px|pt/g,p),Ld=p=>_6(/px|%|em/g,p),d0=p=>_6(/deg|rad|grad|turn/g,p);class U3{constructor(l,u,f){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];S(this,"r",void 0),S(this,"g",void 0),S(this,"b",void 0),S(this,"alpha",void 0),S(this,"isNone",void 0),S(this,"formatted",""),this.r=l,this.g=u,this.b=f,this.alpha=g,this.isNone=m,this.formatted=`rgba(${l}, ${u}, ${f}, ${g})`}clone(){return new U3(this.r,this.g,this.b,this.alpha)}}class np{constructor(l,u){S(this,"type",void 0),S(this,"value",void 0),this.type=l,this.value=u}clone(){return new np(this.type,this.value)}}const ote={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},ate=p=>{let l;return l="angular"===p.type?Number(p.value):ote[p.value]||0,{value:l,unit:"deg"}},lte=p=>{if(p.includes("linear")||p.includes("radial"))return $ee(p).map(l=>{let{type:u,orientation:f,colorStops:g}=l;!function(v){var y;const{length:x}=v;var w;v[x-1].length=null!==(y=v[x-1].length)&&void 0!==y?y:{type:"%",value:"100"},x>1&&(v[0].length=null!==(w=v[0].length)&&void 0!==w?w:{type:"%",value:"0"});let C=0,_=Number(v[0].length.value);for(let M=1;M<x;M++){var T;const L=null===(T=v[M].length)||void 0===T?void 0:T.value;if(!tr(L)&&!tr(_)){for(let N=1;N<M-C;N++)v[C+N].length={type:"%",value:`${_+(Number(L)-_)*N/(M-C)}`};C=M,_=Number(L)}}}(g);const m=g.map(v=>({offset:{value:v.length.value,unit:"%"},color:zee(v)}));if("linear-gradient"===u)return new np(1,{angle:f?ate(f):{value:0,unit:"deg"},steps:m});if("radial-gradient"===u){f||(f=[{type:"shape",value:"circle"}]);const v=f[0];if("shape"===(null==v?void 0:v.type)&&"circle"===(null==v?void 0:v.value)){const{cx:y,cy:x}=(C=>{let _=50,T=50,M="%",L="%";if("position"===(null==C?void 0:C.type)){const{x:N,y:V}=C.value;"position-keyword"===(null==N?void 0:N.type)&&("left"===N.value?_=0:"center"===N.value?_=50:"right"===N.value?_=100:"top"===N.value?T=0:"bottom"===N.value&&(T=100)),"position-keyword"===(null==V?void 0:V.type)&&("left"===V.value?_=0:"center"===V.value?T=50:"right"===V.value?_=100:"top"===V.value?T=0:"bottom"===V.value&&(T=100)),"px"!==(null==N?void 0:N.type)&&"%"!==(null==N?void 0:N.type)&&"em"!==(null==N?void 0:N.type)||(M=null==N?void 0:N.type,_=Number(N.value)),"px"!==(null==V?void 0:V.type)&&"%"!==(null==V?void 0:V.type)&&"em"!==(null==V?void 0:V.type)||(L=null==V?void 0:V.type,T=Number(V.value))}return{cx:{value:_,unit:M},cy:{value:T,unit:L}}})(null==v?void 0:v.at);let w;if(null!=v&&v.style){const{type:C,value:_}=v.style;w="extent-keyword"===C?_:{value:_,unit:u}}return new np(2,{cx:y,cy:x,size:w,steps:m})}}})};function V3(p){const l=p.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),u=parseFloat(l[3]||"1"),f=Math.floor(u*parseInt(l[0],10)+255*(1-u)),g=Math.floor(u*parseInt(l[1],10)+255*(1-u)),m=Math.floor(u*parseInt(l[2],10)+255*(1-u));return`#${`0${f.toString(16)}`.slice(-2)}${`0${g.toString(16)}`.slice(-2)}${`0${m.toString(16)}`.slice(-2)}`}function cte(p){return/^hsla?\(.+\)$/i.test(p)}function Sa(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(tr(p))return null;if("currentColor"===p&&(p="black"),"transparent"===p)return new U3(0,0,0,0);const l=lte(p);if(l)return l;if(cte){const g=document.createElement("div");g.style.color=p,p=g.style.color}const u=jee(p),f=[0,0,0,0];return null!==u&&(f[0]=parseInt(u.r,10)||0,f[1]=parseInt(u.g,10)||0,f[2]=parseInt(u.b,10)||0,f[3]=parseFloat(u.opacity)),new U3(...f)}function hte(p){let l=null;Xt(p)&&(l=p),nt(p)&&(l=p.split(" "));for(let f=0;f<3;f++)l[f]=l[f]?Dt(l[f]).value:0;const u=Sa(l[3]);return l[3]=u?u.formatted:"black",l.slice(0,4)}function dte(p){const l=[];return nt(p)?p.split(" ").forEach(u=>{const f=Dt(u);f&&l.push(f.value)}):l.push(...p),1===l.length?[l[0],l[0]]:l}const ute=p=>{let l=p;if(nt(p)){const u=Ld(p);"%"===u.unit&&(l=u.value/100),"px"===u.unit&&(l=u.value)}return l>1&&(l=1),l},go={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},F9={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function fte(p){const l=[];return p.forEach(u=>{l.push(Fe(ne(ne({},F9),u),{fontSize:Dt(u.fontSize||F9.fontSize)}))}),l}function pte(p,l,u,f){const{x:g=0,y:m=0}=u.parsedStyle,{x:v,y}=u.getLocalPosition();u.boundsDirty=!0,"x"===f&&g===v||"y"===f&&m===y||u.setLocalPosition(g,m)}function gte(p,l,u){if(!(u instanceof $3||u instanceof P6||u instanceof Z9)||p===l)return;u.pathDirty=!0,u.boundsDirty=!0,u.getPath();const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function mte(p,l,u){u instanceof p0&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.setTextFont(),u.calculateTextPosition(),u.calculateLineWarp(),u.calculateCharPosition(),u.updateOrigin())}function vte(p,l,u){!(u instanceof Gn)||u instanceof M6||u instanceof Nd||p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath(),u.updateOrigin())}function yte(p,l,u){(u instanceof X9||u instanceof Eh||u instanceof q9)&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function xte(p,l,u){if(!(u instanceof R6||u instanceof P6)||p===l)return;u.pathDirty=!0,u.boundsDirty=!0,u.getPath();const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function wte(p,l,u){p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function Cte(p,l,u){u instanceof Y3&&p!==l&&(u.pathDirty=!0,u.boundsDirty=!0,u.getPath())}function bte(p,l,u,f){u instanceof tL&&p!==l&&(u.setLimitWidth(u.parsedStyle.width.value),u.pathDirty=!0,u.boundsDirty=!0,("freeTextWriter"!==u.textType||"freeTextWriter"===u.textType&&["width","textContents"].includes(f))&&u.calculateContentLines(),u.getPath(),null!=u&&u.isEditMode||u.updateOrigin())}function j3(p,l,u,f,g){const m=g||[],v=p[l],y=p[u];let x=0,w=1;for(let T=l+1;T<u;T++){const L=(((C=B3(v,y,p[T])).x-(_=p[T]).x)**2+(C.y-_.y)**2)**.5;L>x&&(x=L,w=T)}var C,_;return x>=f?(j3(p,l,w,f,m),j3(p,w,u,f,m)):(!m.length&&v&&m.push(v),m.push(y)),m}function _te(p,l,u,f,g,m){const v=function(x,w,C,_,T,M){const L=function(le,ue,xe){const I=Math.cos(le),A=Math.sin(le);return function(P,O){return{x:I*(P-ue)+A*(O-xe),y:-A*(P-ue)+I*(O-xe)}}}(Math.atan2(M-w,T-x),(x+T)/2,(w+M)/2),N=L(x,w),V=L(C,_),H=L(T,M),G=Math.abs(N.x),[z,q]=[V.y/2,0].sort((le,ue)=>le-ue);let ae,j;return[ae,j]=V.x>=N.x&&V.x<=H.y?[N.x,H.x]:V.x>0?[N.x,.5*(V.x+G*G/V.x)]:[.5*(V.x+G*G/V.x),H.x],function(le,ue,xe){const I=L(le,ue);return!(I.x<ae-xe||I.x>j+xe||I.y<z-xe||I.y>q+xe)}}(p,l,u,f,g,m),{getDistance:y}=function(x,w,C,_,T,M){const L=[C-x,_-w],N=[x-2*C+T,w-2*_+M],V=[2*L[0],2*L[1]],H=1/Fd(N,N),G=H*Fd(L,N),z=G*G,q=Fd(L,L),se=0===Fd(N,N)?function(ae){return 0===q?0:H3(-Fd(L,ae)/2/q,0,1)}:function(ae){const j=H*(2*q+Fd(ae,N))/3,le=H*Fd(ae,L),ue=j-z,xe=G*(2*z-3*j)+le;let I=xe*xe+ue*ue*ue*4;if(I>=0){I=Math.sqrt(I);const D=(I-xe)/2,k=(-I-xe)/2;return H3(Math.sign(D)*Math.abs(D)**(1/3)+Math.sign(k)*Math.abs(k)**(1/3)-G,0,1)}const A=Math.sqrt(-ue),P=Math.acos(xe/(ue*A*2))/3,O=Math.cos(P),b=1.7320508075688772*Math.sin(P);return[H3((O+O)*A-G,0,1),H3((-b-O)*A-G,0,1)]};return{getDistance(ae,j){const le=[x-ae,w-j],ue=se(le);if("number"==typeof ue)return Math.sqrt(S6((V[0]+N[0]*ue)*ue+le[0],(V[1]+N[1]*ue)*ue+le[1]));const[xe,I]=ue;return Math.sqrt(Math.min(S6(le[0]+(V[0]+N[0]*xe)*xe,le[1]+(V[1]+N[1]*xe)*xe),S6(le[0]+(V[0]+N[0]*I)*I,le[1]+(V[1]+N[1]*I)*I)))}}}(p,l,u,f,g,m);return{isHit:function(x,w){return!!v(C=x[0],_=x[1],T=w)&&y(C,_)<=T;var C,_,T}}}function H3(p,l,u){return Math.min(Math.max(p,l),u)}function Fd(p,l){return p[0]*l[0]+p[1]*l[1]}function S6(p,l){return p*p+l*l}function N9(p,l,u,f,g){const{PI:m,cos:v,sin:y,min:x,max:w,tan:C}=Math;g-f>2*m&&(g=f+2*m);let _=w(m/12,(g-f)/12);const T=[];for(T.push({x:p+u*v(f),y:l+u*y(f)});f<g;){const M=p+u*v(f),L=l+u*y(f),N=x(g,f+_);_=x(g-f,_);const V=p+u*v(N),H=l+u*y(N),G=u*C(_/3);T.push({x:M-(L-l)/u*G,y:L+(M-p)/u*G},{x:V+(H-l)/u*G,y:H-(V-p)/u*G},{x:V,y:H}),f+=_}return T}function B9(p,l,u,f){const g=p-u,m=p+u,v=l-f,y=l+f,x=.551915024494,w=x*u,C=x*f,_=[];return _.push({x:m,y:l}),_.push({x:m,y:l+C},{x:p+w,y},{x:p,y}),_.push({x:p-w,y},{x:g,y:l+C},{x:g,y:l}),_.push({x:g,y:l-C},{x:p-w,y:v},{x:p,y:v}),_.push({x:p+w,y:v},{x:m,y:l-C},{x:m,y:l}),_}function cs(p,l){return{type:p,data:l}}function E6(p){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=p.length;if(u<=1)return[];const f=[],[g]=p;f.push(cs("moveTo",[g]));for(let m=0;m+3<u;m+=3)f.push(cs("bezierCurveTo",[p[m+1],p[m+2],p[m+3]]));return l&&p.length>2&&f.push(cs("lineTo",[g])),f}function u0(p,l){return Math.sqrt((p.x-l.x)*(p.x-l.x)+(p.y-l.y)*(p.y-l.y))}function T6(p,l){const u=p.length;if(u<=1)return[];if(2===u)return[{index:0,ops:[cs("moveTo",[p[0]])]},{index:1,ops:[cs("lineTo",[p[1]])]}];let f=u-l;u<=l&&(f=0);const g=[];let m=[],v={index:f,ops:[]};if(g.push(v),u<=l){const N=cs("moveTo",[p[0]]);v.ops.push(N),m=[...p]}else m=p.slice(-l);const y=function(N,V,H){const G=[];for(let z=1;z<N.length-1;z++){const q=180*Dte(Q9(N[z-1],N[z]),Q9(N[z],N[z+1]))/Math.PI;q>=45&&q<=135&&G.push(z)}return G}(m),x=[];for(let N=0;N<m.length;N++)if(y.includes(N)){const V=p[N-1],H=p[N+1],G=u0(p[N],V),z=u0(p[N],H);let q,te;G>6&&(q=W3(V,p[N],.2),x.push({val:q})),x.push({index:N+f,val:m[N]}),z>6&&(te=W3(H,p[N],.2),x.push({val:te}))}else x.push({index:N+f,val:m[N]});for(let N=0;N<x.length;N++){var w,C,_,T,M,L;const V=x[N],H=x[N].val,G=null!==(w=null===(C=x[N-1])||void 0===C?void 0:C.val)&&void 0!==w?w:H,z=null!==(_=null===(T=x[N+1])||void 0===T?void 0:T.val)&&void 0!==_?_:H,q=Ste(G,H,z,null!==(M=null===(L=x[N+2])||void 0===L?void 0:L.val)&&void 0!==M?M:z);void 0!==V.index&&(V.index!==f&&(v={index:void 0,ops:[]},g.push(v)),v.index=V.index),v.ops.push(q)}return g}function Ste(p,l,u,f){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const m=u0(l,u);let v={x:l.x+(u.x-p.x)/g,y:l.y+(u.y-p.y)/g},y={x:u.x-(f.x-l.x)/g,y:u.y-(f.y-l.y)/g};const x=u0(v,l),w=u0(y,u);return x>m&&(v=W3(v,l,m)),w>m&&(y=W3(y,u,m)),cs("bezierCurveTo",[v,y,u])}function Ete(p,l,u){const f=(p.x+l.x)/2,g=(p.y+l.y)/2,m=(l.x+u.x)/2,v=(l.y+u.y)/2;return cs("bezierCurveTo",[{x:f+2*(l.x-f)/3,y:g+2*(l.y-g)/3},{x:m+2*(l.x-m)/3,y:v+2*(l.y-v)/3},l])}function sp(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[];let[f]=p;u.push(cs("moveTo",[f]));for(let g=1;g<p.length;g++)f=p[g],u.push(cs("lineTo",[f]));return l&&p.length>2&&([f]=p,u.push(cs("lineTo",[f]))),u}function rp(p,l){const{data:u,type:f}=l,[g,m,v]=u;switch(f){case"moveTo":p.moveTo(g.x,g.y);break;case"lineTo":p.lineTo(g.x,g.y);break;case"bezierCurveTo":p.bezierCurveTo(g.x,g.y,m.x,m.y,v.x,v.y);break;case"quadraticCurveTo":p.quadraticCurveTo(g.x,g.y,m.x,m.y)}}function yc(p){let{x:l,y:u}=p[0],f=l,g=u;for(let m=1;m<p.length;m++){const{x:v,y}=p[m];l=Math.min(l,v),f=Math.max(f,v),u=Math.min(u,y),g=Math.max(g,y)}return{left:l,top:u,right:f,bottom:g,width:f-l,height:g-u}}function W3(p,l,u){const f=l.x-p.x,g=l.y-p.y,m=Math.abs(f)/Math.abs(g);let v=Math.sqrt(u*u/(m*m+1)),y=v*m;return 0===f&&(y=0,v=Math.sqrt(u)),0===g&&(v=0,y=Math.sqrt(u)),{x:l.x-(f>=0?y:-y),y:l.y-(g>=0?v:-v)}}function U9(p){if(p.length<1)return[];const l=[];let u=[];for(let f=0;f<p.length;f++){const g=p[f];0===g.step?(f>0&&l.push({step:u,close:p[f-1].close}),u=[],u.push(cs("moveTo",[{x:g.x,y:g.y}]))):1===g.step?u.push(cs("lineTo",[{x:g.x,y:g.y}])):2===g.step&&f+2<p.length&&2===p[f+1].step&&2===p[f+2].step&&(u.push(cs("bezierCurveTo",[g,p[f+1],p[f+2]])),f+=2)}return l.push({step:u,close:p[p.length-1].close}),l}function D6(p){return 180*p/Math.PI}function A6(p){return p<0?p%360+360:p%360}function G3(p,l,u,f){return p/(u*u)+l/(f*f)}function f0(p,l,u,f){let g=0,m=0,v=0,y=0;const x=[p,l],w=yc(x),C=function(_,T,M,L){let N=L/2,V=L/2;const H=T.y-_.y,G=T.x-_.x;if(0===H||0===G)return[G,H];const q=Math.atan(-1/((T.y-_.y)/(T.x-_.x)));return"square"===M?(N=Math.sqrt(2)*L/2,V=Math.sqrt(2)*L/2):"round"===M?(N=L/2,V=L/2):(N=Math.abs(Math.cos(q)*L)/2,V=Math.abs(Math.sin(q)*L)/2),[N,V]}(x[0],x[1],f,u||0);return 0===C[1]?(g=w.left,m=w.top-u/2,v=w.width,y=w.height+u,"square"!==f&&"round"!==f||(g-=u/2,v+=u)):0===C[0]?(g=w.left-u/2,m=w.top,v=w.width+u,y=w.height,"square"!==f&&"round"!==f||(m-=u/2,y+=u)):(g=w.left-C[0],m=w.top-C[1],v=w.width+2*C[0],y=w.height+2*C[1]),{x:g,y:m,width:v,height:y}}function I6(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function z3(p,l,u,f){const{x:g,y:m}=p,{x:v,y}=l,{x,y:w}=f,C=Math.min(g,v),_=Math.max(g,v),T=Math.min(m,y),M=Math.max(m,y),L=u/2;return x>=C-L&&x<=_+L&&w>=T-L&&w<=M+L&&function(N,V,H,G,z,q){const te=[H-N,G-V];if(new ls(te[0],te[1]).equals({x:0,y:0}))return Math.sqrt((z-N)*(z-N)+(q-V)*(q-V));const se=[-te[1],te[0]],ae=new ls(se[0],se[1]);ae.normalize();const j=[z-N,q-V],le=new ls(j[0],j[1]);return Math.abs(le.dot(ae))}(g,m,v,y,x,w)<=u/2}function V9(p,l,u,f,g){const m=p.length;if(m<2)return!1;for(let v=0;v<m-1;v++)if(z3(p[v],p[v+1],l,{x:u,y:f}))return!0;return!(!g||!z3(p[0],p[m-1],l,{x:u,y:f}))}function op(p,l,u,f,g,m){return g>=p&&g<=p+u&&m>=l&&m<=l+f}function j9(p,l,u,f,g,m){const v=m;let y=f.x,x=f.y,w=g.x,C=g.y;0===l&&(y=g.x,x=g.y,w=f.x,C=f.y);let _=Math.PI/2;const T=w-y>=0?1:-1,M=C-x>=0?1:-1;y!==w&&(_=Math.atan(Math.abs(C-x)/Math.abs(w-y)));const L=Math.cos(_),N=Math.sin(_),V=u?1:-1,H={x:w+7.8*V*v*L*T-4.5*v*N*T,y:C+7.8*V*v*N*M+4.5*v*L*M,step:0,close:!1},G={x:w,y:C,step:1,close:!1};u&&(G.x=w+v*V*L*T,G.y=C+v*V*N*M),p.push(H,G,{x:w+7.8*V*v*L*T+4.5*v*N*T,y:C+7.8*V*v*N*M-4.5*v*L*M,step:1,close:!1})}function H9(p,l,u,f,g,m){const v=m;let y=f.x,x=f.y,w=g.x,C=g.y;0===l&&(y=g.x,x=g.y,w=f.x,C=f.y);let _=Math.PI/2;const T=w-y>=0?1:-1,M=C-x>=0?1:-1;y!==w&&(_=Math.atan(Math.abs(C-x)/Math.abs(w-y)));const L=Math.cos(_),N=Math.sin(_),V=u?1:-1,H={x:w+7.8*V*v*L*T-4.5*v*N*T,y:C+7.8*V*v*N*M+4.5*v*L*M,step:0,close:!1},G={x:w,y:C,step:1,close:!1};u&&(G.x=w+v*V*L*T,G.y=C+v*V*N*M),p.push(H,G,{x:w+7.8*V*v*L*T+4.5*v*N*T,y:C+7.8*V*v*N*M-4.5*v*L*M,step:1,close:!0})}function W9(p,l,u,f,g){const m=g;let v=u.x,y=u.y,x=f.x,w=f.y;0===l&&(v=f.x,y=f.y,x=u.x,w=u.y);let C=Math.PI/2;const _=x-v>=0?1:-1,T=w-y>=0?1:-1;v!==x&&(C=Math.atan(Math.abs(w-y)/Math.abs(x-v)));const M=Math.cos(C),L=Math.sin(C);p.push({x:x-3*m*L*_,y:w+3*m*M*T,step:0,close:!1},{x:x+3*m*L*_,y:w-3*m*M*T,step:1,close:!1})}function G9(p,l,u,f,g){const m=g;let v=u.x,y=u.y,x=f.x,w=f.y;0===l&&(v=f.x,y=f.y,x=u.x,w=u.y);let C=Math.PI/2;const _=x-v>=0?1:-1,T=w-y>=0?1:-1,M=w>=y&&x>=v||w<=y&&x<=v?-1:1;v!==x&&(C=Math.atan(Math.abs(w-y)/Math.abs(x-v)));const L=Math.cos(C),N=Math.sin(C),V=4.5*Math.sqrt(3)*m;p.push({x:x+4.5*m*L*_-V*N*_*M,y:w+4.5*m*N*T+V*L*T*M,step:0,close:!1},{x:x-4.5*m*L*_+V*N*_*M,y:w-4.5*m*N*T-V*L*T*M,step:1,close:!1})}function z9(p,l,u,f,g){const m=g;let{x:v,y}=f;0===l&&(v=u.x,y=u.y),p.push({x:v-3*m,y:y-3*m,step:0,close:!1},{x:v+3*m,y:y-3*m,step:1,close:!1},{x:v+3*m,y:y+3*m,step:1,close:!1},{x:v-3*m,y:y+3*m,step:1,close:!0})}function $9(p,l,u,f,g){const m=g;let{x:v,y}=f;0===l&&(v=u.x,y=u.y),p.push({x:v-3*m,y,step:0,close:!1},{x:v,y:y-3*m,step:1,close:!1},{x:v+3*m,y,step:1,close:!1},{x:v,y:y+3*m,step:1,close:!0})}function Y9(p,l,u,f,g){const m=g;let{x:v,y}=f;0===l&&(v=u.x,y=u.y);const x=3*m-0*m,w=B9(v,y,x,x);w.forEach((C,_)=>{p.push({x:C.x,y:C.y,step:0===_?0:2,close:_===w.length-1})})}class Tte{constructor(l){S(this,"lineAlign",void 0),S(this,"owner",void 0),this.owner=l,this.reset()}reset(){this.lineAlign=.5}get x(){return this.owner.getAttribute("x")}set x(l){this.owner.setAttribute("x",l)}get y(){return this.owner.getAttribute("y")}set y(l){this.owner.setAttribute("y",l)}get r(){return this.owner.getAttribute("r")}set r(l){this.owner.setAttribute("r",l)}get width(){return this.owner.getAttribute("width")}set width(l){this.owner.setAttribute("width",l)}get height(){return this.owner.getAttribute("height")}set height(l){this.owner.setAttribute("height",l)}get points(){return this.owner.getAttribute("points")}set points(l){this.owner.setAttribute("points",l)}get origin(){return this.owner.getAttribute("origin")}set origin(l){this.owner.setAttribute("origin",l)}get anchor(){return this.owner.getAttribute("anchor")}set anchor(l){this.owner.setAttribute("anchor",l)}get visibility(){return this.owner.getAttribute("visibility")}set visibility(l){this.owner.setAttribute("visibility",l)}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(l){this.owner.setAttribute("zIndex",l)}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(l){this.owner.setAttribute("borderWidth",l)}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(l){this.owner.setAttribute("borderColor",l)}get opacity(){return this.owner.getAttribute("opacity")}set opacity(l){this.owner.setAttribute("opacity",l)}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(l){this.owner.setAttribute("fillOpacity",l)}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(l){this.owner.setAttribute("borderOpacity",l)}get background(){return this.owner.getAttribute("background")}set background(l){this.owner.setAttribute("background",l)}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(l){this.owner.setAttribute("clipPath",l)}get cursor(){return this.owner.getAttribute("cursor")}set cursor(l){this.owner.setAttribute("cursor",l)}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(l){this.owner.setAttribute("hitArea",l)}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(l){this.owner.setAttribute("pointerEvents",l)}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(l){this.owner.setAttribute("miterLimit",l)}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(l){this.owner.setAttribute("roundedRadius",l)}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(l){this.owner.setAttribute("lineCap",l)}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(l){this.owner.setAttribute("lineJoin",l)}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(l){this.owner.setAttribute("lineDash",l)}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(l){this.owner.setAttribute("lineDashOffset",l)}get shadow(){return this.owner.getAttribute("shadow")}set shadow(l){this.owner.setAttribute("shadow",l)}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(l){this.owner.setAttribute("shadowOffsetX",l)}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(l){this.owner.setAttribute("shadowOffsetY",l)}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(l){this.owner.setAttribute("shadowBlur",l)}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(l){this.owner.setAttribute("shadowColor",l)}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(l){this.owner.setAttribute("startAngle",l)}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(l){this.owner.setAttribute("endAngle",l)}get rx(){return this.owner.getAttribute("rx")}set rx(l){this.owner.setAttribute("rx",l)}get ry(){return this.owner.getAttribute("ry")}set ry(l){this.owner.setAttribute("ry",l)}get img(){return this.owner.getAttribute("img")}set img(l){this.owner.setAttribute("img",l)}get src(){return this.owner.getAttribute("src")}set src(l){this.owner.setAttribute("src",l)}get text(){return this.owner.getAttribute("text")}set text(l){this.owner.setAttribute("text",l)}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(l){this.owner.setAttribute("wordWarp",l)}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(l){this.owner.setAttribute("wordBreak",l)}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(l){this.owner.setAttribute("textMaxWidth",l)}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(l){this.owner.setAttribute("letterSpacing",l)}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(l){this.owner.setAttribute("textBaseLine",l)}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(l){this.owner.setAttribute("textTransform",l)}get color(){return this.owner.getAttribute("color")}set color(l){this.owner.setAttribute("color",l)}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(l){this.owner.setAttribute("fontStyle",l)}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(l){this.owner.setAttribute("fontVariant",l)}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(l){this.owner.setAttribute("fontWeight",l)}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(l){this.owner.setAttribute("fontSize",l)}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(l){this.owner.setAttribute("lineHeight",l)}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(l){this.owner.setAttribute("fontFamily",l)}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(l){this.owner.setAttribute("startPoint",l)}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(l){this.owner.setAttribute("endPoint",l)}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(l){this.owner.setAttribute("lineEnding",l)}get segments(){return this.owner.getAttribute("segments")}set segments(l){this.owner.setAttribute("segments",l)}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(l){this.owner.setAttribute("stampPoints",l)}get imageData(){return this.owner.getAttribute("imageData")}set imageData(l){this.owner.setAttribute("imageData",l)}get iconName(){return this.owner.getAttribute("iconName")}set iconName(l){this.owner.setAttribute("iconName",l)}get textContents(){return this.owner.getAttribute("textContents")}set textContents(l){this.owner.setAttribute("textContents",function(u){const f=[];return u.forEach(g=>{g.content.length&&f.push(g)}),f}(l))}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(l){this.owner.setAttribute("textAlign",l)}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(l){this.owner.setAttribute("renderBlendMode",l)}}const Yo=new class{constructor(){S(this,"parsers",void 0),S(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater()}getStyleParser(p){return this.parsers.get(p)}getStyleUpdaters(p){return this.updaters.get(p)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],Dt,void 0),this.bindHandler(["startAngle","endAngle"],d0,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],Dt,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],Sa,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],ute,void 0),this.bindHandler(["lineDash"],dte,void 0),this.bindHandler(["shadow"],hte,void 0),this.bindHandler(["textContents"],fte,void 0)}initUpdater(){this.bindHandler(["borderWidth"],void 0,wte),this.bindHandler(["x","y"],void 0,pte),this.bindHandler(["width","height"],void 0,vte),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,yte),this.bindHandler(["points","segments"],void 0,gte),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,xte),this.bindHandler(["text","textTransform","textBaseLine","x","y","width","wordWarp","lineHeight","fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,mte),this.bindHandler(["stampPoints"],void 0,Cte),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,bte)}bindHandler(p,l,u){for(let f=0;f<p.length;f++)if(l&&this.parsers.set(p[f],l),u){const g=this.updaters.get(p[f])||[];g.push(u),this.updaters.set(p[f],g)}}};class Wn extends A9{constructor(l){super(),S(this,"attributes",{}),S(this,"id",void 0),S(this,"pageUid",void 0),S(this,"index",void 0),S(this,"name",void 0),S(this,"renderable",new ste),S(this,"sortable",new rte),S(this,"geometry",new nte),S(this,"transform",new L9),S(this,"parsedStyle",{}),S(this,"style",void 0),S(this,"isDestroyed",!1),S(this,"childNodes",[]),S(this,"nodeName",""),S(this,"nodeType",0),S(this,"nodeValue",null),S(this,"ownerDocument",null),S(this,"parentNode",null),S(this,"isConnected",!1),S(this,"textContent",void 0),S(this,"shapeType",void 0),S(this,"config",void 0),S(this,"path",void 0),S(this,"steps",void 0),S(this,"pathDirty",!0),S(this,"boundsDirty",!0),S(this,"bounds",void 0),S(this,"strokePath",void 0),S(this,"strokeSteps",void 0),S(this,"externalMatrices",[]),S(this,"clippable",!1),S(this,"imageData",null),this.config=l,this.id=l.id||l.uid||"",this.name=l.name||"",this.index=l.index,this.nodeName=l.type||"container",this.pageUid=l.pageUid||"",(l.className||l.class)&&(this.className=l.className||l.class),this.style=new Tte(this),this.initAttributes(l)}static isNode(l){return!!l.childNodes}set className(l){this.setAttribute("class",l)}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter(l=>""!==l)}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:l}=this;return l.length>0?l[l.length-1]:null}get nextSibling(){const{parentNode:l}=this;if(l){const u=l.childNodes.indexOf(this);return l.childNodes[u+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:l}=this;if(l){const u=l.childNodes.indexOf(this);return l.childNodes[u-1]}return null}getAttribute(l){const u=this.attributes[l];return null==u?null:u}getElementsByName(l){return li.querySelectorAll(`[name="${l}"]`,this)}getElementsByClassName(l){return li.querySelectorAll(`.${l}`,this)}getElementsByTagName(l){return li.querySelectorAll(l,this)}hasAttribute(l){return Object.keys(this.attributes).indexOf(l)>-1}removeAttribute(l){this.setAttribute(l,null),delete this.attributes[l]}appendChild(l,u){li.append(l,this,u);const f=new _h("child-inserted",{child:l});this.dispatchEvent(f);const g=new Bd("DOMNodeInserted",this,"","","",0,"","");return l.dispatchEvent(g),l}cloneNode(l){return null}insertBefore(l,u){if(u){const f=this.childNodes.indexOf(u);this.appendChild(l,f-1)}else this.appendChild(l);return l}removeChild(l){const u=new Bd("removed",this,"","","",0,"","");l.dispatchEvent(u);const f=new _h("child-removed",{child:l});return this.dispatchEvent(f),li.remove(l),l}isChildExist(l){return li.isChildExist(l)}replaceChild(l,u){const f=this.childNodes.indexOf(u);return this.removeChild(u),this.appendChild(l,f),u}destroy(){const l=new _h("destroy",{});this.dispatchEvent(l),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0}after(){const{parentNode:l}=this;if(l){const m=l.childNodes.indexOf(this);for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];f.forEach((v,y)=>{null==l||l.appendChild(v,m+y+1)})}}before(){const{parentNode:l}=this;if(l){const m=l.childNodes.indexOf(this);for(var u=arguments.length,f=new Array(u),g=0;g<u;g++)f[g]=arguments[g];f.forEach((v,y)=>{null==l||l.appendChild(v,m+y)})}}remove(){this.parentNode&&this.parentNode.removeChild(this)}replaceWith(){this.after(...arguments),this.remove()}append(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];u.forEach(g=>{this.appendChild(g)})}prepend(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];u.forEach((g,m)=>{this.appendChild(g,m)})}querySelector(l){return li.querySelector(l,this)}querySelectorAll(l){return li.querySelectorAll(l,this)}find(l){let u=null;return this.recursiveCall(f=>!(f!==this||!l(f)||(u=f,0))),u}findAll(l){const u=[];return this.recursiveCall(f=>{f===this&&l(f)&&u.push(f)}),u}contains(l){let u=l;for(;u&&this!==u;)u=u.parentNode;return!!u}getRootNode(l){return this.parentNode?this.parentNode.getRootNode(l):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(l){return this===l}isSameNode(l){return this.isEqualNode(l)}normalize(){throw new Error("Method to be implemented")}recursiveCall(l){l(this)||this.childNodes.forEach(u=>{u.recursiveCall(l)})}hasParentTransform(){return!(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return li.getGeometryBounds(this)}getRenderBounds(){return li.getBounds(this,!0)}getBounds(){return li.getBounds(this)}getLocalBounds(){return li.getLocalBounds(this)}getBoundingClientRect(){return li.getBoundingClientRect(this)}get isVisible(){return"visible"===this.parsedStyle.visibility}get isInteractive(){return"none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const u in l)if(A3(u,l)){if("style"===u)continue;this.attributes[u]=l[u]}for(const u in l.style)A3(u,l.style)&&(this.parseStyleProperty(u,l.style[u]),this.attributes[u]=l.style[u]);this.renderable.toRenderable()}setAttribute(l,u){if(Se(u))return;const g=this.attributes[l];(u!==this.attributes[l]||"x"===l||"y"===l)&&(this.attributes[l]=u,Object.keys(this.config).includes(l)||(this.parseStyleProperty(l,u),this.updateStyleProperty(l,g,u)))}parseStyleProperty(l,u){const f=Yo.getStyleParser(l);this.parsedStyle[l]=f?f(u,this,l):u}updateStyleProperty(l,u,f){const g=Yo.getStyleUpdaters(l);g&&g.forEach(m=>{m(u,f,this,l)})}toFront(){const{parentNode:l}=this;if(l){const u=Math.max(...l.children.map(f=>f.style.zIndex));this.style.zIndex=u+1}return this}toBack(){const{parentNode:l}=this;if(l){const u=Math.min(...l.children.map(f=>f.style.zIndex));this.style.zIndex=u-1}return this}setOrigin(l){return li.setOrigin(this,l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}getOrigin(){return li.getOrigin(this)}setPosition(l){return li.setPosition(this,l),this}setLocalPosition(l){const u=Fi(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return li.setLocalPosition(this,u),this}getPosition(){return li.getPosition(this)}getLocalPosition(){return li.getLocalPosition(this)}translate(l){const u=Fi(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return li.translate(this,u),this}translateLocal(l){const u=Fi(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return li.translateLocal(this,u),this}scale(l,u,f){return this.scaleLocal(l,u,f)}scaleLocal(l,u,f){return Ve(l)&&(l=Fi(l,u=u||l,f=f||l)),li.scaleLocal(this,l),this}setLocalScale(l,u,f){return Ve(l)&&(l=Fi(l,u=u||l,f=f||l)),li.setLocalScale(this,l),this}getScale(){return li.getScale(this)}getLocalScale(){return li.getLocalScale(this)}rotate(l,u,f){return Se(u)&&Se(f)?li.rotate(this,0,0,l):li.rotate(this,l,u,f),this}rotateLocal(l,u,f){return Se(u)&&Se(f)?li.rotateLocal(this,0,0,l):li.rotateLocal(this,l,u,f),this}setAngle(l){return li.setAngle(this,0,0,l),this}setLocalAngle(l){return 180===Math.abs(l%360)&&(l-=.001),li.setLocalAngle(this,0,0,l),this}getAngle(){return li.getAngle(this).z}getLocalAngle(){return li.getLocalAngle(this).z}getLocalTransform(){return li.getLocalTransform(this)}getWorldTransform(){return li.getWorldTransform(this)}setLocalTransform(l){return li.setLocalTransform(this,l),this}resetLocalTransform(){li.resetLocalTransform(this)}getPath(){}getBoundingRect(){return{x:0,y:0,width:0,height:0}}isPointInPath(l){return!1}updateStyle(l){Object.keys(l).forEach(u=>{A3(u,l)&&(this.style[u]=l[u])})}updatePosition(l,u){this.style.x=l||0,this.style.y=u||0}updateOrigin(){const{width:l,height:u}=this.getBoundingRect();this.setOrigin(l/2,u/2)}getBoundingRectObject(){const{x:l,y:u,width:f,height:g}=this.getBoundingRect();return new Gn({style:{x:l,y:u,width:f,height:g,borderWidth:1,background:"transparent"}})}}class X9 extends Wn{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Er(m,["style"]);super(ne({type:"arc",style:ne(Fe(ne({},go),{r:0,startAngle:0,endAngle:1.5*Math.PI}),l)},u)),S(this,"shapeType","arc");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}normAngle(){const{startAngle:l,endAngle:u}=this.style;let f=d0(l).value,g=d0(u).value;if(f>g){const m=f;f=g,g=m}if(Math.abs(g-f)>=2*Math.PI-1e-5&&(f=0,g=2*Math.PI),f<-2*Math.PI||g<-2*Math.PI){const m=Math.max(Math.floor(f/(-2*Math.PI)),Math.floor(g/(-2*Math.PI)));f+=2*Math.PI*m,g+=2*Math.PI*m}if(f>2*Math.PI||g>2*Math.PI){const m=Math.max(Math.floor(f/(2*Math.PI)),Math.floor(g/(2*Math.PI)));f-=2*Math.PI*m,g-=2*Math.PI*m}this.parsedStyle.startAngle=d0(f),this.parsedStyle.endAngle=d0(g)}updateOrigin(){const{width:l,height:u,x:f,y:g}=this.getBoundingRect();this.setOrigin(f-this.style.x+l/2,g-this.style.y+u/2)}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:l,borderWidth:u,startAngle:f,endAngle:g}=this.parsedStyle;return this.path=N9(0,0,l.value-.5*((null==u?void 0:u.value)||0),f.value,g.value),this.steps=E6(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,r:f,startAngle:g,endAngle:m}=this.parsedStyle,y=f.value,x=g.value,w=m.value;if(g===m)return{x:l-y-0,y:u-y-0,width:2*y+0,height:2*y+0};const{sin:C,cos:_,PI:T}=Math,M=[l+y*_(x),l+y*_(w)],L=[u+y*C(x),u+y*C(w)];return x<0&&w>0&&M.push(l+y),(x<.5*T&&w>.5*T||x<-1.5*T&&w>-1.5*T)&&L.push(u+y),(x<T&&w>T||x<-T&&w>-T)&&M.push(l-y),(x<1.5*T&&w>1.5*T||x<-.5*T&&w>-.5*T)&&L.push(u-y),M.sort((N,V)=>N-V),L.sort((N,V)=>N-V),this.boundsDirty=!1,this.bounds={x:M[0]-0,y:L[0]-0,width:M[M.length-1]-M[0]+0,height:L[L.length-1]-L[0]+0},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(l,u))return!1;const{x:f,y:g,r:m,startAngle:v,endAngle:y,background:x,borderWidth:w}=this.parsedStyle,C=A6(D6(v.value)),_=A6(D6(y.value)),T=A6(D6(v.value+y.value)/2),M=nt(this.style.background)&&""!==this.style.background,L=w&&w.value,V=(w.value+(M?0:u)||0)/2,H=m.value-V,G=new Mi(f+H*Math.cos(C*Math.PI/180),g+H*Math.sin(C*Math.PI/180)),z=new Mi(f+H*Math.cos(_*Math.PI/180),g+H*Math.sin(_*Math.PI/180)),q=new Mi(f+H*Math.cos(T*Math.PI/180),g+H*Math.sin(T*Math.PI/180)),te=new Mi(l.x,l.y),se=te.distanceTo({x:f,y:g}),ae=b6([G.x,G.y],[q.x,q.y],[te.x,te.y],[f,g]),j=b6([z.x,z.y],[q.x,q.y],[te.x,te.y],[f,g]),le=b6([G.x,G.y],[z.x,z.y],[te.x,te.y],[f,g]);if(se>H+V)return!1;const ue=z3(G,z,2*V,l);if(_-C<180&&_-C>0||_-C<-180){if(x&&le||ue||!x&&L&&se>=H-V&&se<=H+V&&le)return!0}else if(180===Math.abs(_-C)){if(x&&(ae||j||function(xe,I,A,P){const{x:O,y:b}=xe,{x:D,y:k}=I,{x:U,y:F}=A,{x:B,y:W}=P;return!(((B-O)*(k-b)-(W-b)*(D-O))*((U-O)*(k-b)-(F-b)*(D-O))<=0||((B-U)*(k-F)-(W-F)*(D-U))*((O-U)*(k-F)-(b-F)*(D-U))<=0||((B-O)*(F-b)-(W-b)*(U-O))*((D-O)*(F-b)-(k-b)*(U-O))<=0)}(G,q,z,l))||!x&&L&&se>=H-V&&se<=H+V&&(ae||j))return!0}else if(x&&(ae||j||!le)||!x&&L&&se>=H-V&&se<=H+V&&(ae||j))return!0;return!!ue}}class Eh extends Wn{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Er(m,["style"]);super(ne({type:"circle",style:ne(Fe(ne({},go),{r:0,anchor:[.5,.5]}),l)},u)),S(this,"shapeType","circle");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{r:l,borderWidth:u}=this.parsedStyle;let f=.5*((null==u?void 0:u.value)||0);return l.value===f&&(f=0),this.path=N9(0,0,l.value-f,0,2*Math.PI),this.steps=E6(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,r:f}=this.parsedStyle,g=f.value;return this.boundsDirty=!1,this.bounds={x:l-g-0,y:u-g-0,width:2*g+0,height:2*g+0},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(l,u))return!1;const{x:f,y:g,r:m,background:v,borderWidth:y}=this.parsedStyle,x=nt(this.style.background)&&""!==this.style.background,w=y&&y.value,_=(y.value+(x?0:u)||0)/2,T=m.value-_,M=new Mi(l.x,l.y).distanceTo({x:f,y:g});return v&&w?M<=T+_:v?M<=T:!!w&&M>=T-_&&M<=T+_}}let q9=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"ellipse",style:ne(Fe(ne({},go),{rx:"",ry:"",borderWidth:0,anchor:[.5,.5]}),p)},l)),S(this,"shapeType","ellipse");const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{rx:p,ry:l,borderWidth:u}=this.parsedStyle,f=.5*u.value;return this.path=B9(0,0,p.value-f,l.value-f),this.steps=E6(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,rx:u,ry:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p-u.value-0,y:l-f.value-0,width:2*u.value+0,height:2*f.value+0},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{x:u,y:f,rx:g,ry:m,borderWidth:v}=this.parsedStyle,y=nt(this.style.background)&&""!==this.style.background,x=v&&v.value,w=y?0:l,C=(v.value||0)/2,_=g.value-C,T=m.value-C,M=(p.x-u)*(p.x-u),L=(p.y-f)*(p.y-f);return y&&x?G3(M,L,_+C,T+C)<=1:y?G3(M,L,_,T)<=1:!!x&&G3(M,L,_-C-w/2,T-C-w/2)>=1&&G3(M,L,_+C+w/2,T+C+w/2)<=1}},Nd=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"image",style:ne(Fe(ne({},go),{width:0,height:0,img:""}),p)},l)),S(this,"shapeType","image"),S(this,"meteData",void 0),this.meteData=(null==l?void 0:l.metadata)||null;const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,width:u,height:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:l,width:u.value,height:f.value},this.bounds}isPointInPath(p){return this.getBoundingRectObject().isPointInPath(p)}},Z9=class extends Wn{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=u,l=Er(u,["style"]);super(ne({type:"ink",style:ne(Fe(ne({},go),{segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),p)},l)),S(this,"shapeType","ink"),S(this,"inkPaths",[]),S(this,"inkSteps",[]),S(this,"inkRenderPaths",[]),S(this,"inkOriginalRenderPath",void 0),S(this,"inkRenderSteps",[]),S(this,"initialRect",void 0),S(this,"useDouglasPeucker",!0),S(this,"douglasPeuckerPoints",[]),S(this,"partDirty",!1),S(this,"optimizedOpSteps",[]),S(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height)}addSegment(){const{segments:p}=this.style;p[p.length-1].length&&this.style.segments.push([])}addPoint(p){const l=[...this.style.segments],u=this.style.segments.length,f=l[u-1],g=f[f.length-1];if((null==g?void 0:g.x)!==p.x||(null==g?void 0:g.y)!==p.y){this.partDirty=!0;const m=this.getBoundingRect(),v=this.parsedStyle.borderWidth.value/2;(p.x<m.x+v||p.y<m.y+v)&&(this.positionDirty=!0),l[u-1].push(p),this.style.segments=l;const y=this.getBoundingRect();(p.x<y.x||p.y<y.y||p.x>y.x+y.width||p.y>y.y+y.height)&&(this.boundsDirty=!0)}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:p}=this.parsedStyle;if(this.partDirty){const l=p.length;if(l>1)for(let g=0;g<l-1;g++){const m=p[g];if(!this.optimizedOpSteps[g]){let v=[...m];1===v.length?v=this.offsetPoints(m[0],.1):(v=j3(v,0,v.length-1,1),v.length<=3&&v.push(ne({},v[v.length-1])));const y=T6(v,v.length).map(x=>x.ops).flat(2);this.optimizedOpSteps[g]=y}if(this.positionDirty||!this.inkRenderSteps[g]){const v=this.getRenderStep(this.optimizedOpSteps[g]);this.inkRenderSteps[g]=v}}let u=p[l-1];1===u.length?u=this.offsetPoints(u[0],.1):u.length<=3&&u.push(u[u.length-1]),u=this.getRenderPath(u);const f=function(g){const m=g.length;if(m<=1)return[];if(2===m)return[cs("moveTo",[g[0]]),cs("lineTo",[g[1]])];const v=[cs("moveTo",[g[0]])];for(let y=0;y<m-1;y++)v.push(Ete(g[y-1]||g[y],g[y],g[y+1]||g[y]));return v}(u);this.inkRenderSteps[l-1]=f}else this.pathDirty&&(this.reset(),p.forEach((l,u)=>{if(0===l.length)return;let f=[...l];1===l.length?f=this.offsetPoints(l[0],.1):(f=j3(f,0,f.length-1,1),f.length<=3&&f.push(ne({},f[f.length-1]))),this.inkPaths[u]=f;const g=T6(f,f.length);this.inkSteps[u]=g.map(y=>y.ops).flat(2);const m=this.getRenderPath(f),v=T6(m,m.length).map(y=>y.ops).flat(2);this.inkRenderSteps[u]=v}));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:u,y:f}=p;return[{x:u-l,y:f-l},{x:u+l,y:f-l},{x:u+l,y:f+l},{x:u-l,y:f+l}]}getRenderStep(p){return p.map(l=>Fe(ne({},l),{data:this.getRenderPath(l.data)}))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:p}=this.parsedStyle,l=[];for(let u=0;u<p.length;u++){const f=this.getRenderPath(p[u]);l.push(f)}this.inkOriginalRenderPath=l}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u})}),f}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p}=this.parsedStyle,l=[],u=[];this.parsedStyle.segments.forEach(x=>{x.forEach(w=>{w&&(l.push(w.x),u.push(w.y))})});const{min:f,max:g}=J9(l),{min:m,max:v}=J9(u),y=p.value/2;return this.boundsDirty=!1,this.bounds={x:f-y,y:m-y,width:g-f+2*y,height:v-m+2*y},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u}=this.parsedStyle;for(let f=0;f<this.inkSteps.length;f++){const g=this.inkSteps[f];for(let m=1;m<g.length;m+=2){const v=g[m-1].data[0],y=g[m].data[0],x=g[m].data[1];if(_te(v.x,v.y,y.x,y.y,x.x,x.y).isHit([p.x,p.y],u.value+l))return!0}}return!1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[]}};function J9(p){if(0===p.length)return{min:void 0,max:void 0};let l=p[0],u=p[0];for(let f=1;f<p.length;f++)p[f]<l&&(l=p[f]),p[f]>u&&(u=p[f]);return{min:l,max:u}}function Q9(p,l){return{x:l.x-p.x,y:l.y-p.y}}function K9(p){return Math.sqrt(p.x*p.x+p.y*p.y)}function Dte(p,l){const u=(m=p).x*(v=l).x+m.y*v.y,f=K9(p),g=K9(l);var m,v;return Math.acos(u/(f*g))}let $3=class extends Wn{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,l=Er(v,["style"]);super(ne({type:"polygon",style:ne(Fe(ne({},go),{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2}),p)},l)),S(this,"shapeType","polygon"),S(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:u,y:f,width:g,height:m}=this.getBoundingRect();this.updatePosition(u,f),this.setOrigin(g/2,m/2)}addPoint(p){const l=[...this.style.points];l.push(p),this.style.points=l}updatePoints(){const{renderPath:p}=this,l=this.getLocalPosition(),u=[];p.forEach(f=>{u.push({x:f.x+l.x,y:f.y+l.y})}),this.style.points=u}getPath(){if(!this.pathDirty)return this.path;const{x:p,y:l}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map(u=>({x:u.x-p,y:u.y-l})),this.steps=sp(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,points:l,lineCap:u}=this.parsedStyle;if(2===l.length)return this.boundsDirty=!1,this.bounds=f0(l[0],l[1],p.value,u),this.bounds;const f=yc(l),g=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:f.left-g,y:f.top-g,width:f.width+2*g,height:f.height+2*g},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u,points:f}=this.parsedStyle,g=nt(this.style.background)&&""!==this.style.background;let v=!1;return u&&u.value&&(v=V9(f,u.value+(g?0:l),p.x,p.y,!0)),!v&&g&&(v=function(y,x,w){let C=!1;const _=y.length;if(_<=2)return!1;for(let N=0;N<_;N++){const V=y[N],H=y[(N+1)%_];if(((L={x,y:w}).x-(T=V).x)*((M=H).y-T.y)==(M.x-T.x)*(L.y-T.y)&&Math.min(T.x,M.x)<=L.x&&L.x<=Math.max(T.x,M.x)&&Math.min(T.y,M.y)<=L.y&&L.y<=Math.max(T.y,M.y))return!0;I6(V.y-w)>0!=I6(H.y-w)>0&&I6(x-(w-V.y)*(V.x-H.x)/(V.y-H.y)-V.x)<0&&(C=!C)}var T,M,L;return C}(f,p.x,p.y)),v}},P6=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"polyline",style:ne(Fe(ne({},go),{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4}),p)},l)),S(this,"shapeType","polyline"),S(this,"renderPath",void 0),this.getPath();const{x:u,y:f}=this.getBoundingRect();this.updatePosition(u,f),this.updateOrigin()}initPath(){const{points:p,lineEnding:l}=this.parsedStyle,u=[];if(p.forEach((f,g)=>{u.push(0===g?{x:f.x,y:f.y,step:0,close:!1}:{x:f.x,y:f.y,step:1,close:!1})}),l&&u.length>1)for(let f=0;f<l.length;f++)switch(l[f]){case"OpenArrow":this.addOpenArrow(u,f,!1);break;case"ROpenArrow":this.addOpenArrow(u,f,!0);break;case"ClosedArrow":this.addCloseArrow(u,f,!1);break;case"RClosedArrow":this.addCloseArrow(u,f,!0);break;case"Butt":this.addButt(u,f);break;case"Slash":this.addSlash(u,f);break;case"Square":this.addSquare(u,f);break;case"Diamond":this.addDiamond(u,f);break;case"Circle":this.addCircle(u,f)}return u}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u,step:g.step,close:g.close})}),f}addPoint(p){const l=[...this.style.points];l.push(p),this.style.points=l}updatePoints(){const{length:p}=this.parsedStyle.points,l=this.getLocalPosition(),u=[];this.renderPath.slice(0,p).forEach(f=>{u.push({x:f.x+l.x,y:f.y+l.y})}),this.style.points=u}updatePoint(){const p=this.getLocalPosition(),l=this.parsedStyle.points.length,u=[];for(let f=0;f<l;f++)u.push({x:this.renderPath[f].x+p.x,y:this.renderPath[f].y+p.y});this.updateStyle({points:u})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=U9(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:l}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=f0(this.path[0],this.path[1],p.value,l),this.bounds;const u=yc(this.path),f=p.value/2;return this.boundsDirty=!1,this.bounds={x:u.left-f,y:u.top-f,width:u.width+2*f,height:u.height+2*f},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{borderWidth:u,points:f}=this.parsedStyle;return V9(f,u.value+l,p.x,p.y,!1)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addOpenArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:f,borderWidth:g}=this.parsedStyle,{length:m}=f;let v=f[m-2],y=f[m-1];0===l&&(v=ne({},f[0]),y=ne({},f[1])),j9(p,l,u,v,y,g.value)}addCloseArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:f,borderWidth:g}=this.parsedStyle,{length:m}=f;let v=f[m-2],y=f[m-1];0===l&&(v=ne({},f[0]),y=ne({},f[1])),H9(p,l,u,v,y,g.value)}addCircle(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;Y9(p,l,u[0],u[g-1],f.value)}addDiamond(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;$9(p,l,u[0],u[g-1],f.value)}addSquare(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;z9(p,l,u[0],u[g-1],f.value)}addSlash(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;let m=u[g-2],v=u[g-1];0===l&&(m=ne({},u[0]),v=ne({},u[1])),G9(p,l,m,v,f.value)}addButt(p,l){const{points:u,borderWidth:f}=this.parsedStyle,{length:g}=u;let m=u[g-2],v=u[g-1];0===l&&(m=ne({},u[0]),v=ne({},u[1])),W9(p,l,m,v,f.value)}},Gn=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"rect",style:ne(Fe(ne({},go),{width:0,height:0}),p)},l)),S(this,"shapeType","rect");const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}getPath(){if(!this.pathDirty)return this.path;const{width:p,height:l,borderWidth:u}=this.parsedStyle,f=(null==u?void 0:u.value)||0,v=p.value-2*f,y=l.value-2*f;return this.path=[{x:f,y:f},{x:f+v,y:f},{x:f+v,y:f+y},{x:f,y:f+y}],this.steps=sp(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:p,height:l,borderWidth:u}=this.parsedStyle,f=.5*((null==u?void 0:u.value)||0),v=p.value-2*f,y=l.value-2*f;this.strokePath=[{x:f,y:f},{x:f+v,y:f},{x:f+v,y:f+y},{x:f,y:f+y}],this.strokeSteps=sp(this.strokePath)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,width:u,height:f}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:l,width:u.value,height:f.value},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:u,y:f,borderWidth:g,width:m,height:v}=this.parsedStyle,y=nt(this.style.background)&&""!==this.style.background,x=g&&g.value,w=l/2;return y?op(u,f,m.value,v.value,p.x,p.y):!!x&&(M=v.value+l,op(C=u-w,_=f-w,T=m.value+l,L=g.value+l,N=p.x,V=p.y)||op(C,_,L,M,N,V)||op(C,_+M-L,T,L,N,V)||op(C+T-L,_,L,M,N,V));var C,_,T,M,L,N,V}},p0=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"text",style:ne(Fe(ne({},go),{text:"",width:300,wordWarp:!0,wordBreak:!0,textAlign:"left",textBaseLine:"top",textTransform:"none",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:1,letterSpacing:0}),p)},l)),S(this,"shapeType","text"),S(this,"font",void 0),S(this,"lines",[]),S(this,"chars",[]),S(this,"underlines",[]),S(this,"strikeouts",[]),S(this,"textX",void 0),S(this,"textY",void 0),S(this,"rowWidth",void 0),S(this,"realWidth",void 0),S(this,"totalHeight",void 0),this.setTextFont(),this.calculateTextPosition(),this.calculateLineWarp(),this.calculateCharPosition();const{x:u,y:f}=this.parsedStyle;this.setLocalPosition(u,f),this.updateOrigin()}setTextFont(){const{fontStyle:p,fontVariant:l,fontWeight:u,fontFamily:f,fontSize:g}=this.parsedStyle;this.font=`${p} ${l} ${u} ${g.value}${g.unit} ${f}`}updateOrigin(){if(!this.chars[0])return;const{width:p,height:l}=this.getBoundingRect(),u=this.chars[0].height/10||0,f=this.chars[0].height/2||0;let g=0;switch(this.parsedStyle.textBaseLine){case"top":g=l/2-u;break;case"hanging":g=l/2;break;case"middle":g=f*(this.lines.length-1)-u;break;case"ideographic":g=1.5*-u+f*(this.lines.length-2);break;case"bottom":g=f*(this.lines.length-2)-u;break;default:g=u+f*(this.lines.length-2)}this.setOrigin(p/2-u,g)}calculateTextPosition(){const{x:p,y:l,width:u,letterSpacing:f,borderWidth:g}=this.parsedStyle,m=((null==g?void 0:g.value)||0)/2;this.textX=p+m+f.value,this.textY=l+m+f.value,this.rowWidth=u.value-2*m-2*f.value}calculateLineWarp(){this.totalHeight=0,this.realWidth=0;const{textX:p,rowWidth:l,parsedStyle:u}=this,{lineHeight:f,wordWarp:g,fontSize:m,borderWidth:v}=u,y=document.createElement("canvas").getContext("2d");y.font=this.font;const x=Math.max(m.value,f),w=this.transformText(this.parsedStyle.text);w.length||(this.lines=[],this.totalHeight=0);let C=0;if(w.length){const _=[];let{textY:T}=this,M="";for(let L=0;L<w.length;L++){const N=w.charAt(L);if("\n"!==N&&"\r"!==N){if(M+=N,y.measureText(M).width>=l&&g){if(M=M.substring(0,M.length-1),""===M){M=N;continue}C+=M.length;const V=y.measureText(M).width;V>this.realWidth&&(this.realWidth=y.measureText(M).width),_.push({text:M,x:p,y:T,lineWidth:V,length:M.length,sum:C}),M=N,T+=x,this.totalHeight+=x}}else{const V=y.measureText(M).width;V>this.realWidth&&(this.realWidth=y.measureText(M).width),M+=N,C+=M.length,_.push({text:M,x:p,y:T,lineWidth:V,length:M.length,sum:C}),M="",T+=x,this.totalHeight+=x}}if(""!==M){C+=M.length;const L=y.measureText(M).width;L>this.realWidth&&(this.realWidth=y.measureText(M).width),_.push({text:M,x:p,y:T,lineWidth:L,length:M.length,sum:C})}this.totalHeight+=x,this.lines=_}1===this.lines.length&&(this.realWidth=y.measureText(this.lines[0].text).width),v&&v.value&&(this.realWidth+=v.value)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:l,textBaseLine:u,fontSize:f,lineHeight:g}=this.parsedStyle,m=f.value>g?f.value:g,v=eL(u,l,m),y=m/10;return this.boundsDirty=!1,this.bounds={x:p-y,y:v-y,width:this.realWidth+2*y,height:this.totalHeight},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getBoundingRectObject().isPointInPath(p,l)}calculateCharPosition(){this.chars=[];const{lines:p}=this,{fontSize:l,textBaseLine:u}=this.parsedStyle,f=document.createElement("canvas").getContext("2d"),g=l.value;f.font=this.font;let m=0;p.forEach((v,y)=>{let x=v.x;for(let w=0;w<v.text.length;w++){const C=v.text.charAt(w);let{width:_}=f.measureText(C);"\n"!==C&&"\r"!==C||(_=.1),this.chars.push({char:C,index:m+w+1,charIndex:w+1,lineIndex:y,x,y:eL(u,v.y,g),width:_,height:g}),x+=f.measureText(C).width,w===v.text.length-1&&(m+=v.text.length)}})}getCharByPosition(p,l){const u={x:p,y:l};for(let f=0;f<this.chars.length;f++)if(this.getCharBoundingRect(f).isPointInPath(u))return this.chars[f];return null}getCharBoundingRect(p){const{x:l,y:u,width:f,height:g}=this.chars[p];return new Gn({style:{x:l,y:u-g/10,width:f,height:g,borderWidth:1,background:"transparent"}})}transformText(p){const{textTransform:l}=this.parsedStyle;switch(l){case"capitalize":p=p[0].toUpperCase()+p.substring(1);break;case"uppercase":p.toLowerCase();break;case"lowercase":p.toUpperCase()}return p}getRelativeYAxis(p){const{height:l}=this.chars[0];return p-this.getTextBaseLineOffset(l)}getTextBaseLineOffset(p){const{textBaseLine:l}=this.parsedStyle,u=p/10;let f;switch(l){case"top":f=u;break;case"hanging":f=0;break;case"middle":f=p/2+u;break;case"ideographic":f=p+1*u;break;case"bottom":f=p+.5*u;break;default:f=p-1.5*u}return f}};function eL(p,l,u){let f;const g=u/10;switch(p){case"top":f=l-.5*g;break;case"hanging":f=l+.5*g;break;case"middle":f=l-u/2-.5*g;break;case"ideographic":f=l-u-.5*g;break;case"bottom":f=l-u;break;default:f=l+2*g-u}return f}class Y3 extends Wn{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=f,u=Er(f,["style"]);super(ne({type:"stampPath",style:ne(Fe(ne({},go),{stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),l)},u)),S(this,"shapeType","stampPath"),S(this,"renderPath",void 0),this.getPath()}getRenderPath(l){const{x:u,y:f}=this.getBoundingRect(),g=[];return l.forEach(m=>{!m||Number.isNaN(m.x)||Number.isNaN(m.y)||g.push({x:m.x-u,y:m.y-f,step:m.step})}),g}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(l){if(l.length<1)return[];const u=[];for(let f=0;f<l.length;f++){const g=l[f];0===g.step?u.push(cs("lineTo",[g])):1===g.step?f+2<l.length&&1===l[f+1].step&&1===l[f+2].step&&(u.push(cs("bezierCurveTo",[g,l[f+1],l[f+2]])),f+=2):2===g.step&&u.push(cs("moveTo",[g]))}return u}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:l,stampPoints:u,lineCap:f}=this.parsedStyle;if(2===u.length)return this.boundsDirty=!1,this.bounds=f0(u[0],u[1],l.value,f),this.bounds;const g=yc(u),m=l.value/2;return this.boundsDirty=!1,this.bounds={x:g.left-m,y:g.top-m,width:g.width+2*m,height:g.height+2*m},this.bounds}}let R6=class extends Wn{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=g,l=Er(g,["style"]);super(ne({type:"line",style:ne(Fe(ne({},go),{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2}),p)},l)),S(this,"shapeType","line"),S(this,"renderPath",void 0),this.getPath();const{x:u,y:f}=this.getBoundingRect();this.updatePosition(u,f),this.updateOrigin()}initPath(){const{startPoint:p,endPoint:l,lineEnding:u}=this.parsedStyle,f=[Fe(ne({},p),{step:0,close:!1}),Fe(ne({},l),{step:1,close:!1})];if(u)for(let g=0;g<u.length;g++)switch(u[g]){case"OpenArrow":this.addOpenArrow(f,g,!1);break;case"ROpenArrow":this.addOpenArrow(f,g,!0);break;case"ClosedArrow":this.addCloseArrow(f,g,!1);break;case"RClosedArrow":this.addCloseArrow(f,g,!0);break;case"Butt":this.addButt(f,g);break;case"Slash":this.addSlash(f,g);break;case"Square":this.addSquare(f,g);break;case"Diamond":this.addDiamond(f,g);break;case"Circle":this.addCircle(f,g)}return f}getRenderPath(p){const{x:l,y:u}=this.getBoundingRect(),f=[];return p.forEach(g=>{!g||Number.isNaN(g.x)||Number.isNaN(g.y)||f.push({x:g.x-l,y:g.y-u,step:g.step,close:g.close})}),f}updatePoints(){const p=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+p.x,y:this.renderPath[0].y+p.y},endPoint:{x:this.renderPath[1].x+p.x,y:this.renderPath[1].y+p.y}})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=U9(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:l}=this.parsedStyle,u=yc(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=f0(this.path[0],this.path[1],p.value,l),this.bounds;const f=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:u.left-f,y:u.top-f,width:u.width+2*f,height:u.height+2*f},this.bounds}isPointInPath(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,l))return!1;const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;return z3(u,f,g.value+l,p)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addCircle(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;Y9(p,l,u,f,g.value)}addDiamond(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;$9(p,l,u,f,g.value)}addSquare(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;z9(p,l,u,f,g.value)}addSlash(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;G9(p,l,u,f,g.value)}addButt(p,l){const{startPoint:u,endPoint:f,borderWidth:g}=this.parsedStyle;W9(p,l,u,f,g.value)}addOpenArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:f,endPoint:g,borderWidth:m}=this.parsedStyle;j9(p,l,u,f,g,m.value)}addCloseArrow(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:f,endPoint:g,borderWidth:m}=this.parsedStyle;H9(p,l,u,f,g,m.value)}},Ate=class extends Gn{constructor(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=u,l=Er(u,["style"]);super(ne({type:"stamp",style:Fe(ne({},p),{background:"transparent",borderColor:"transparent"})},l)),S(this,"shapeType","stamp"),S(this,"stampConfig",[]),S(this,"stampItemShapes",[]),S(this,"renderType","stamp"),S(this,"initialWidth",0),S(this,"initialHeight",0),this.stampConfig=p.stampConfig||[]}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle())}initStampItem(){if(!Xt(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:p,stampItemShapes:l}=this,{renderBlendMode:u}=this.parsedStyle;for(let f=0;f<p.length;f++){let g;"path"===p[f].type&&(g=new Y3({style:ne({opacity:this.style.opacity,renderBlendMode:u},p[f])})),"text"===p[f].type&&(g=new p0({style:ne({opacity:this.style.opacity,renderBlendMode:u},p[f])})),"image"===p[f].type&&(g=new Nd({style:ne({opacity:this.style.opacity,renderBlendMode:u},p[f])})),g&&l.push(g)}}initStampStyle(){if(!Xt(this.stampConfig))return;const p=[],l=[],{stampItemShapes:u}=this;for(let f=0;f<u.length;f++){const g=u[f];if(!(g instanceof p0)){const m=g.getBoundingRect();p.push(m.x,m.x+m.width),l.push(m.y,m.y+m.height)}this.appendChild(g)}this.initialWidth=Math.max(...p)-Math.min(...p),this.initialHeight=Math.max(...l)-Math.min(...l),this.updateStyle({x:Math.min(...p),y:Math.min(...l),width:this.initialWidth,height:this.initialHeight});for(let f=0;f<u.length;f++){const g=u[f].getBoundingRect();u[f].setLocalPosition(g.x-this.style.x,g.y-this.style.y)}this.updateOrigin()}isPointInPath(p,l){return super.isPointInPath(p,0)}};class M6 extends Wn{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Er(m,["style"]);super(ne({type:"roundedRect",style:ne(Fe(ne({},go),{roundedRadius:0,width:0,height:0}),l)},u)),S(this,"shapeType","roundedRect");const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,width:f,height:g}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:l,y:u,width:f.value,height:g.value},this.bounds}isPointInPath(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:f,y:g,width:m,height:v,borderWidth:y}=this.parsedStyle,x=(y.value+u||0)/2;return op(f-x,g-x,m.value+2*x,v.value+2*x,l.x,l.y)}getCenterPosition(){const{width:l,height:u}=this.parsedStyle,f=new Eh({style:{x:l.value/2,y:u.value/2}});this.appendChild(f);const{x:g,y:m}=f.getPosition();return f.destroy(),{x:g,y:m}}}class tL extends Wn{constructor(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:l}=m,u=Er(m,["style"]);super(ne({type:"freeText",style:ne(Fe(ne({},go),{width:0,height:0,textAlign:"left"}),l)},u)),S(this,"shapeType","freeText"),S(this,"lines",void 0),S(this,"textType","textBox"),S(this,"renderClipPath",void 0),S(this,"renderClipStep",void 0),S(this,"totalTextHeight",0),S(this,"limitWidth",1),S(this,"textMaxWidth",0),S(this,"borderOffset",0),S(this,"padding",1),this.textType=l.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateContentLines();const{x:f,y:g}=this.parsedStyle;this.setLocalPosition(f,g),this.updateOrigin()}getLimitTextWithoutSpace(l,u){const{textContents:f}=this.parsedStyle,g=qe(l),v=g.segmentation[g.segmentation.length-1],y=Xo(" ",f[v.freeContentIndex]),x=v.text.split(" ").length-1;let w;for(let C=0;C<x&&(w=C+1,!(g.width-w*y<u));C++);for(let C=0;C<w;C++)g.word=g.word.slice(0,-1),g.width-=y,v.text=v.text.slice(0,-1),v.width-=y;return g}splitWordSegment(l,u){const f=l,g=[],m=[];let v=u;const y=f.segmentation.length;for(let w=0;w<y;w++){const C=f.segmentation[w];if(!(C.width<v)){if(C.width===v){g.push(ne({},C)),m.push(...f.segmentation.slice(y-w-1));break}{const _=this.parsedStyle.textContents[C.freeContentIndex],T=Ite(C.text,v,_);2===T.length?(g.push({text:T[0],width:Xo(T[0],_),freeContentIndex:C.freeContentIndex}),m.push({text:T[1],width:Xo(T[1],_),freeContentIndex:C.freeContentIndex})):m.push(ne({},C));const M=y-w-1;M>0&&m.push(...f.segmentation.slice(-M));break}}g.push(ne({},C)),v-=C.width}const x=w=>{let C="",_=0;return w.forEach(T=>{C+=T.text,_+=T.width}),{word:C,width:_,segmentation:w}};return 0===g.length?[x(m)]:[x(g),x(m)]}getWordSegmentation(){const{textContents:l}=this.parsedStyle;let u="";const f=[0];l.forEach(x=>{u+=x.content,f.push(u.length)});const g=u.match(/\S+\s*/g)||[],m=[];let v=0;const y=function(x){const C=x.match(/^(?:\r\n|\r|\n)*/);if(C){const _=C[0];let T=0;for(const M of _)"\n"!==M&&"\r"!==M||(T+=1);return _.includes("\r\n")&&(T-=1),Array.from({length:T},()=>"\n")}return[]}(u);if(y.length&&g.unshift(...y)," "===u[0]){const x=u.match(/^ +/)[0];g[0]=g[0]?x+g[0]:x}for(let x=0;x<g.length;x++){const w=g[x].split(/(\r\n|[\r\n])/).filter(C=>""!==C);w.length>2&&(g[x]=w[0]+w[1],g.splice(x+1,0,...w.slice(2)))}return g.forEach(x=>{const w=v+x.length-1,C=[...f.filter(_=>_>v&&_<=w)];if(0===C.length){const _=f.filter(M=>M<=v).length,T=Xo(x,l[_-1]);m.push({word:x,segmentation:[{text:x,width:T,freeContentIndex:_-1}],width:T})}else{const _=[];let T=0;C.forEach((M,L)=>{const N=M-(C[L-1]||v),V=C[L-1]-v||0,H=x.substring(V,V+N),G=Xo(H,l[f.indexOf(M)-1]);if(_.push({text:H,width:G,freeContentIndex:f.indexOf(M)-1}),T+=G,L===C.length-1){const z=Xo(x.substring(V+N),l[f.indexOf(M)]);_.push({text:x.substring(V+N),freeContentIndex:f.indexOf(M),width:z}),T+=z}}),m.push({word:x,width:T,segmentation:_})}v+=x.length}),m}organizeLine(){if(0===this.lines.length)return;const{y:l}=this.parsedStyle;let u=l+this.borderOffset+this.padding,f=0,g=0;this.lines.forEach((m,v)=>{g=0,f=Math.max(m.width,f);let y=0,x="";if(0===m.width&&""===m.words[0].text){const w=Xo(" ",m.words[0].style);m.width=w,m.words[0].wordWidth=w,m.words[0].text=" "}if(m.words.forEach(w=>{x+=w.text,y=Math.max(y,w.wordHeight),w.widthWithoutLf=g0(w.text)?Xo(w.text,w.style,!0):w.wordWidth,g+=w.widthWithoutLf}),"textBox"===this.textType&&"justify"===this.style.textAlign&&v!==this.lines.length-1){const w=[],C=/\b\w/g;let _,T=0;for(;null!==(_=C.exec(x));)w.push(_.index);if(w.length>1){const M=(this.limitWidth-g)/(w.length-1),L=N=>{for(let V=0;V<w.length;V++)if(w[V]>N)return V;return w.length};m.words.forEach((N,V)=>{V>0&&(N.x+=M*(L(T)-1)),T+=N.text.length}),g=this.limitWidth,m.width=this.limitWidth}}m.widthWithoutLF=g,m.height=y,m.y=.8*y+u,u+=y,v>0&&(m.y+=.2*this.lines[v-1].height,u+=.2*this.lines[v-1].height)}),this.textMaxWidth=f}getTextAlignOffset(l){if("freeTextWriter"===this.textType)return 0;const{limitWidth:u}=this,{textAlign:f}=this.parsedStyle,g=l?l.widthWithoutLF:0;let m=0;return"center"===f?m=(u-g)/2:"right"===f&&(m=u-g),m}getPath(){var l;if(!this.pathDirty)return this.path;const{width:u,height:f}=this.getBoundingRect(),g=.5*((null===(l=this.parsedStyle.borderWidth)||void 0===l?void 0:l.value)||0),m=g,v=g,y=u-2*g,x=f-2*g;if(this.path=[{x:m,y:v},{x:m+y,y:v},{x:m+y,y:v+x},{x:m,y:v+x}],this.borderOffset){const w=this.borderOffset/2;this.renderClipPath=[{x:m+w,y:v+w},{x:m+y-w,y:v+w},{x:m+y-w,y:v+x-w},{x:m+w,y:v+x-w}],this.renderClipStep=sp(this.renderClipPath)}return this.steps=sp(this.path),this.pathDirty=!1,this.path}setLimitWidth(l){const{borderWidth:u,borderColor:f}=this.parsedStyle;"textBox"===this.textType&&u.value&&!f.isNone&&(this.borderOffset=u.value,this.padding=u.value),this.limitWidth=l-2*this.borderOffset-2*this.padding}calculateContentLines(){const{textContents:l,x:u}=this.parsedStyle;if(null==l||!l.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const f=this.getWordSegmentation(),g=[],m=u+this.borderOffset+this.padding;let v=m,y=0,x=[];const w=function(T){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T;T.segmentation.forEach((L,N)=>{const V=l[L.freeContentIndex];x.push({text:L.text,originText:M.segmentation[N].text,freeContentIndex:L.freeContentIndex,x:v,wordWidth:L.width,wordHeight:V.fontSize.value,style:V}),v+=L.width,y+=L.width})},C=()=>{0!==x.length&&(g.push({words:x,width:y,x:m}),v=m,y=0,x=[])},_=(T,M)=>{if(T.width<=M)w(T),g0(T.word)&&C();else{const L=this.getLimitTextWithoutSpace(T,M);if(L.width<=M)w(L,T);else{const N=this.splitWordSegment(T,M);if(2===N.length){const V=N[1].word;"\r"!==V&&"\n"!==V&&"\r\n"!==V?(w(N[0]),C(),_(N[1],M)):(w(T),C())}else{const V=Xo(T.word[0],l[T.segmentation[0].freeContentIndex]),H=this.splitWordSegment(T,V+.1);w(H[0]),C(),_(H[1],M)}}}};f.forEach(T=>{const M=this.limitWidth-y;if(T.width<=M)w(T),g0(T.word)&&C();else{const L=this.getLimitTextWithoutSpace(T,M);L.width>M?T.width>this.limitWidth?(C(),_(T,this.limitWidth)):(C(),w(T),g0(T.word)&&C()):(w(L,T),C())}}),C(),this.lines=g,this.organizeLine(),this.calculateTotalHeight()}calculateTotalHeight(){const{y:l,height:u}=this.parsedStyle,f=this.lines.length;if(f){const g=this.lines[f-1];let m=g.y+.2*g.height+-l+2*this.borderOffset;g0(g.words[0].text)&&(m+=1.2*g.height),this.totalTextHeight=m>u.value?m:u.value}else this.totalTextHeight=u.value}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:l,y:u,height:f}=this.parsedStyle;let g=f.value,m=this.limitWidth+2*this.borderOffset+2*this.padding;return"freeTextWriter"===this.textType?(m=this.textMaxWidth+2*this.borderOffset+2*this.padding,g=this.totalTextHeight):m=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:l,y:u,width:m,height:g},this.bounds}isPointInPath(l){return this.getBoundingRectObject().isPointInPath(l)}}function Xo(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:f,fontStyle:g,fontFamily:m,fontWeight:v}=l,y=document.createElement("canvas").getContext("2d"),x=""===(null==m?void 0:m.trim())?"sans-serif":m;y.font=null!=m&&m.includes(" ")?`${g} ${v} ${f.value}${f.unit} '${x}'`:`${g} ${v} ${f.value}${f.unit} ${x}`;let w=0;for(let C=0;C<p.length;C++){const _=p.charAt(C);u&&Pte(_)||(w+=y.measureText(_).width)}return w}function Ite(p,l,u){let f=0;for(let g=0;g<p.length;g++)if(Xo(p.substring(0,g+1),u)>l){f=g;break}return 0===f?[p]:[p.substring(0,f),p.substring(f)]}function Pte(p){return/^[\r\n]+$/.test(p)}function g0(p){return p.endsWith("\n")||p.endsWith("\r")||p.endsWith("\r\n")}const X3=1/0;class wr{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X3,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;S(this,"minX",void 0),S(this,"maxX",void 0),S(this,"minY",void 0),S(this,"maxY",void 0),S(this,"rect",void 0),S(this,"updateId",void 0),this.minX=l,this.maxX=u,this.minY=f,this.maxY=g,this.rect=null,this.updateId=-1}static isEmpty(l){return l.minX===l.maxX&&l.minY===l.maxY}static fromBounds(l){return(new wr).setFromBounds(l)}static create(){return new wr}setFromBounds(l){return this.minX=l.minX,this.minY=l.minY,this.maxX=l.maxX,this.maxY=l.maxY,this}clear(){return this.minX=X3,this.maxX=-1/0,this.minY=X3,this.maxY=-1/0,this}getRect(l){const{minX:u,minY:f,maxX:g,maxY:m}=this;if(u>g||f>m)return new d9(0,0,0,0);const v=l||new d9;return v.update(u,f,g-u,m-f),v}addPoint(l){return this.addBounds({minX:l.x,maxX:l.x,minY:l.y,maxY:l.y})}addBounds(l){const u=k6(this,l);return this.setFromBounds(u)}addBoundsMask(l,u){const f=iL(l,u);if(f.minX<=f.maxX&&f.minY<=f.maxY){const g=k6(f,this);this.setFromBounds(g)}return this}intersection(l){if(!((u=this).minX<=(f=l).maxX&&u.maxX>=f.minX&&u.minY<=f.maxY&&u.maxY>=f.minY))return null;var u,f;const g=iL(this,l);return wr.fromBounds(g)}union(l){const u=k6(this,l);return wr.fromBounds(u)}addBoundsArea(l,u){const{x:f,y:g,width:m,height:v}=u;return this.addBoundsMask(l,{minX:f,minY:g,maxX:f+m,maxY:g+v})}addFrame(l,u){return this.setFromTransformedBounds(l.worldTransform,u)}setFromTransformedBounds(l,u){for(let f=0;f<2;f++){const g=l.transformPoint({x:f?u.maxX:u.minX,y:f?u.maxY:u.minY});this.addPoint(g)}return this}addQuad(l){for(let u=0;u<4;u++)this.addPoint({x:l[2*u],y:l[2*u+1]})}}function iL(p,l){return{minX:p.minX>l.minX?p.minX:l.minX,minY:p.minY>l.minY?p.minY:l.minY,maxX:p.maxX<l.maxX?p.maxX:l.maxX,maxY:p.maxY<l.maxY?p.maxY:l.maxY}}function k6(p,l){return{minX:p.minX<l.minX?p.minX:l.minX,minY:p.minY<l.minY?p.minY:l.minY,maxX:p.maxX>l.maxX?p.maxX:l.maxX,maxY:p.maxY>l.maxY?p.maxY:l.maxY}}class Rte extends Wn{constructor(){super({}),S(this,"name","Document"),S(this,"defaultView",void 0),S(this,"documentElement",void 0),S(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new Wn({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement]}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(l,u){return new(this.defaultView.customElements.get(l))(u)}getElementById(l){return null}getElementsByName(l){return this.documentElement.getElementsByTagName(l)}getElementsByTagName(l){return this.documentElement.getElementsByTagName(l)}getElementsByClassName(l){return this.documentElement.getElementsByClassName(l)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(l){return this.documentElement.querySelector(l)}querySelectorAll(l){return this.documentElement.querySelectorAll(l)}find(l){return this.documentElement.find(l)}findAll(l){return this.documentElement.findAll(l)}appendChild(l){return this.documentElement.appendChild(l)}cloneNode(l){return this.documentElement.cloneNode(l)}insertBefore(l,u){return this.documentElement.insertBefore(l,u)}removeChild(l){return this.documentElement.removeChild(l)}replaceChild(l,u){return this.documentElement.replaceChild(l,u)}destroy(){}}class nL extends a0{constructor(){super(...arguments),S(this,"altKey",void 0),S(this,"button",void 0),S(this,"buttons",void 0),S(this,"ctrlKey",void 0),S(this,"metaKey",void 0),S(this,"shiftKey",void 0),S(this,"relatedTarget",void 0),S(this,"client",new Mi),S(this,"movement",new Mi),S(this,"offset",new Mi),S(this,"page",new Mi),S(this,"screen",new Mi),S(this,"global",new Mi),S(this,"canvas",new Mi)}initEvent(l,u,f){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(l){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(l)}initMouseEvent(l,u,f,g,m,v,y,x,w,C,_,T,M,L,N){throw this.initUIEvent(l,f,f,g,m),new Error("initMouseEvent() DOM API is deprecated.")}}function O6(p,l){l.altKey=p.altKey,l.button=p.button,l.buttons=p.buttons,l.ctrlKey=p.ctrlKey,l.metaKey=p.metaKey,l.shiftKey=p.shiftKey,l.relatedTarget=null,l.client.setFromPoint(p.client),l.movement.setFromPoint(p.movement),l.offset.setFromPoint(p.offset),l.page.setFromPoint(p.page),l.screen.setFromPoint(p.screen),l.global.setFromPoint(p.global),l.canvas.setFromPoint(p.canvas)}class L6 extends nL{constructor(){super(...arguments),S(this,"deltaMode",void 0),S(this,"deltaX",void 0),S(this,"deltaY",void 0),S(this,"deltaZ",void 0),S(this,"DOM_DELTA_PIXEL",0),S(this,"DOM_DELTA_LINE",1),S(this,"DOM_DELTA_PAGE",2)}}function sL(p,l){l.deltaMode=p.deltaMode,l.deltaX=p.deltaX,l.deltaY=p.deltaY,l.deltaZ=p.deltaZ}class Th extends nL{constructor(l){super(l),S(this,"height",0),S(this,"isPrimary",void 0),S(this,"pointerId",void 0),S(this,"pointerType",void 0),S(this,"pressure",void 0),S(this,"tangentialPressure",void 0),S(this,"tiltX",void 0),S(this,"tiltY",void 0),S(this,"twist",void 0),S(this,"width",0),S(this,"getCoalescedEvents",void 0),S(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0}}function F6(p,l){l.isPrimary=p.isPrimary,l.width=p.width,l.height=p.height,l.tiltX=p.tiltX,l.tiltY=p.tiltY,l.pointerType=p.pointerType,l.pointerId=p.pointerId,l.pressure=p.pressure,l.twist=p.twist,l.tangentialPressure=p.tangentialPressure}class Mte{constructor(l,u){S(this,"root",void 0),S(this,"cursor","default"),S(this,"events",void 0),S(this,"trackingData",void 0),S(this,"contextService",void 0),this.root=l,this.contextService=u,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this))}clientToCanvas(l){const u=this.contextService.getBoundingClientRect();return new Mi(l.x-(u.x||0),l.y-(u.y||0))}canvasToClient(l){const u=this.root.defaultView.contextService.getBoundingClientRect();return new Mi(l.x+(u.x||0),l.y+(u.y||0))}getPropagationPath(l){const u=[l];for(;Wn.isNode(l)&&l!==this.root;)u.push(l=l.parentNode);return u.reverse()}getHitTarget(l,u){const{root:f}=this,{isInteractive:g}=f,m=rL(f,g,new Mi(l,u));return m?m[0]:null}on(l,u){this.events[l]||(this.events[l]=[]),this.events[l].push({fn:u,order:0}),this.events[l].sort((f,g)=>f.order-g.order)}emit(l){if(!this.root)return;const u=this.events[l.type]||[];for(let f=0;f<u.length;f++)u[f].fn(l)}onPointerdown(l){if(!(l instanceof Th))return;const u=this.generatePointerEvent(l);let f;Es(u,"pointerdown"),"touch"===u.pointerType?f="touchstart":ap(u)&&(f=2===u.button?"rightdown":"mousedown"),Es(u,f),this.getTrackingData(l.pointerId).pressTargetsByButton[l.button]=u.composedPath()}onPointermove(l){if(!(l instanceof Th))return;const u=this.generatePointerEvent(l),f=ap(u),g=this.getTrackingData(l.pointerId),m=N6(g.overTargets);if(m&&m!==u.target){const x=this.generatePointerEvent(l,"mousemove"===l.type?"mouseout":"pointerout",m);Es(x,"pointerout"),f&&Es(x,"mouseout");const w=u.composedPath();if(!w.includes(m)){const C=this.generatePointerEvent(l,"pointerleave",m);for(C.eventPhase=C.AT_TARGET;C.target&&!w.includes(C.target);)C.currentTarget=C.target,po(C,C.type),f&&po(C,"mouseleave"),C.target=C.target.parentNode}}if(m!==u.target){const x=this.clonePointerEvent(u,"mousemove"===l.type?"mouseover":"pointerover");Es(x,"pointerover"),f&&Es(x,"mouseover");let w=Wn.isNode(m)&&(null==m?void 0:m.parentNode);for(;w&&w!==(Wn.isNode(this.root)&&this.root.parentNode)&&w!==u.target;)w=w.parentNode;if(!w||w===this.root.parentNode){const C=this.clonePointerEvent(u,"pointerenter");for(C.eventPhase=C.AT_TARGET;C.target&&C.target!==m&&C.target!==this.root.parentNode;)C.currentTarget=C.target,po(C,C.type),f&&po(C,"mouseenter"),C.target=C.target.parentNode}}var v;Es(u,"pointermove"),"touch"===u.pointerType&&Es(u,"touchmove"),f&&(Es(u,"mousemove"),this.cursor=null===(v=u.target)||void 0===v?void 0:v.cursor),g.overTargets=u.composedPath()}onPointerup(l){if(!(l instanceof Th))return;const u=performance.now(),f=this.generatePointerEvent(l);Es(f,"pointerup");const{pointerType:g}=f;let m;"touch"===g?m="touchend":ap(f)&&(m=2===f.button?"rightup":"mouseup"),Es(f,m);const v=this.getTrackingData(l.pointerId),y=N6(v.pressTargetsByButton[l.button]);let x=y;const w=f.composedPath();if(y&&!w.includes(y)){let C=y;for(;C&&!w.includes(C);)f.currentTarget=C,po(f,"pointerupoutside"),"touch"===g?m="touchendoutside":ap(f)&&(m=2===f.button?"rightupoutside":"mouseupoutside"),po(f,m),C=C.parentNode;delete v.pressTargetsByButton[l.button],x=C}if(x){const C=this.clonePointerEvent(f,"click");C.target=x,C.path=null,v.clicksByButton[l.button]||(v.clicksByButton[l.button]={clickCount:0,target:C.target,timeStamp:u});const _=v.clicksByButton[l.button];_.target===C.target&&u-_.timeStamp<200?_.clickCount+=1:_.clickCount=1,_.target=C.target,_.timeStamp=u,C.detail=_.clickCount,m="mouse"===g?"click":"touch"===g?"tap":"pointertap",Es(C,m)}}onPointerout(l){if(!(l instanceof Th))return;const u=this.getTrackingData(l.pointerId);if(u.overTargets){const f=ap(l),g=N6(u.overTargets),m=this.generatePointerEvent(l,"pointerout",g);Es(m),f&&Es(m,"mouseout");const v=this.generatePointerEvent(l,"pointerleave",g);for(v.eventPhase=v.AT_TARGET;v.target&&v.target!==this.root.parentNode;)v.currentTarget=v.target,po(v,v.type),f&&po(v,"mouseleave"),v.target=v.target.parentNode;u.overTargets=null}this.cursor=null}onPointerover(l){if(!(l instanceof Th))return;const u=this.getTrackingData(l.pointerId),f=this.generatePointerEvent(l),g=ap(l);var m;Es(f,"pointerover"),g&&Es(f,"mouseover"),"mouse"===f.pointerType&&(this.cursor=null===(m=f.target)||void 0===m?void 0:m.cursor);const v=this.clonePointerEvent(f,"pointerenter");for(v.eventPhase=v.AT_TARGET;v.target&&v.target!==this.root.parentNode;)v.currentTarget=f.target,po(v,v.type),g&&po(v,"mouseenter"),v.target=v.target.parentNode;u.overTargets=f.composedPath()}onWheel(l){l instanceof L6&&Es(this.generateWheelEvent(l))}generatePointerEvent(l,u,f){const g=new Th(this);return F6(l,g),O6(l,g),l0(l,g),g.nativeEvent=l.nativeEvent,g.originalEvent=l,g.target=null!=f?f:this.getHitTarget(g.globalX,g.globalY),g.type=null!=u?u:g.type,g}generateWheelEvent(l){const u=new L6(this);return sL(l,u),O6(l,u),l0(l,u),u.nativeEvent=l.nativeEvent,u.originalEvent=l,u.target=this.getHitTarget(u.globalX,u.globalY),u}clonePointerEvent(l,u){const f=new Th(this);return F6(l,f),O6(l,f),l0(l,f),f.nativeEvent=l.nativeEvent,f.originalEvent=l,f.target=l.target,f.path=l.composedPath().slice(),f}getTrackingData(l){return this.trackingData[l]||(this.trackingData[l]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[l]}}function ap(p){const{pointerType:l}=p;return"mouse"===l||"pen"===l}function N6(p){if(!p)return null;let l=p[0]||null;for(let u=1,f=p.length;u<f&&p[u].parentNode===l;u++)l=p[u];return l}function rL(p,l,u){if(!p||"visible"!==p.style.visibility)return null;const{hitArea:f}=p.style;if(f){const{x:m,y:v}=p.transform.worldTransform.transformPoint(u);if(!f.contains(m,v))return null}const{clipPath:g}=p.style;if(g&&!g.containPoint(u))return null;if(p.isChildrenInteractive&&p.children){const{children:m}=p;for(let v=m.length-1;v>=0;v--){const y=m[v],x=rL(y,l||y.isInteractive,u);if(x)return(x.length>0||p.isInteractive)&&x.push(p),x}}return l&&p.containPoint(u)?p.isInteractive?[p]:[]:null}S(class{constructor(){S(this,"canvasConfig",void 0),S(this,"contextService",void 0),S(this,"renderingContext",void 0),S(this,"eventService",void 0),S(this,"rootPointerEvent",new Th(null)),S(this,"rootWheelEvent",new L6(null)),S(this,"autoPreventDefault",!0)}init(p){const{renderingService:l,renderingContext:u,contextService:f,canvasConfig:g}=p;this.eventService=new Mte(u.root.parentNode,f),p.eventService=this.eventService,this.renderingContext=u,this.contextService=f,this.canvasConfig=g,l.hooks.wheel.on(this.onWheel),l.hooks.pointerdown.on(this.onPointerdown),l.hooks.pointermove.on(this.onPointermove),l.hooks.pointerup.on(this.onPointerup),l.hooks.pointerout.on(this.onPointermove),l.hooks.pointerover.on(this.onPointermove)}destroy(){}onWheel(p){const l=this.normalizeWheelEvent(p);this.eventService.emit(l)}onPointerdown(p){if(this.isTouchEvent(p))return;const l=this.normalizeToPointerEvent(p);this.autoPreventDefault&&l.isNormalized&&(p.cancelable||!("cancelable"in p))&&p.preventDefault();const u=this.bootstrapEvent(l,this.rootPointerEvent);this.eventService.emit(u),this.setCursor(this.eventService.cursor)}onPointermove(p){if(this.isTouchEvent(p))return;const l=this.normalizeToPointerEvent(p),u=this.bootstrapEvent(l,this.rootPointerEvent);this.eventService.emit(u),this.setCursor(this.eventService.cursor)}onPointerup(p){if(this.isTouchEvent(p))return;const l=this.contextService.getDomElement(),u=p.target===l?"":"outside",f=this.normalizeToPointerEvent(p),g=this.bootstrapEvent(f,this.rootPointerEvent);g.type+=u,this.eventService.emit(g),this.setCursor(this.eventService.cursor)}setCursor(p){this.contextService.setCursor(p||this.canvasConfig.cursor||"default")}normalizeWheelEvent(p){const l=this.rootWheelEvent;l.nativeEvent=p,this.transferMouseData(p,l),sL(p,l);const u=new Mi(p.clientX,p.clientY),{x:f,y:g}=this.eventService.clientToCanvas(u);return l.canvas.x=f,l.canvas.y=g,l.offset.setFromPoint(l.canvas),l.global.setFromPoint(l.canvas),l0(p,l),l}normalizeToPointerEvent(p){const l=this.renderingContext.root.ownerDocument.defaultView;if(l.supportTouchEvent&&p instanceof TouchEvent){const u=p;u.isNormalized=!0,u.pointerType="touch"}else if(!MouseEvent||p instanceof MouseEvent&&(!l.supportPointerEvent||!(p instanceof PointerEvent))){const u=p;u.isPrimary=!0,u.width=1,u.height=1,u.tiltX=0,u.tiltY=0,u.pointerType="mouse",u.pointerId=1,u.pressure=.5,u.twist=0,u.tangentialPressure=0,u.isNormalized=!0}return p}bootstrapEvent(p,l){l.originalEvent=null,l.nativeEvent=p,F6(p,l),this.transferMouseData(p,l);const{x:u,y:f}=this.eventService.clientToCanvas(new Mi(p.clientX,p.clientY));return l.canvas.x=u,l.canvas.y=f,l.offset.setFromPoint(l.canvas),l.global.setFromPoint(l.canvas),l0(p,l),"pointerleave"===l.type&&(l.type="pointerout"),l.type.startsWith("mouse")&&l.type.replace("mouse","pointer"),l}transferMouseData(p,l){l.altKey=p.altKey,l.button=p.button,l.buttons=p.buttons,l.ctrlKey=p.ctrlKey,l.metaKey=p.metaKey,l.shiftKey=p.shiftKey,l.relatedTarget=null,l.client.x=p.clientX,l.client.y=p.clientY,l.movement.x=p.movementX,l.movement.y=p.movementY,l.page.x=p.pageX,l.page.y=p.pageY,l.screen.x=p.screenX,l.screen.y=p.screenY}isTouchEvent(p){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===p.pointerType}},"moduleName","Event");class Bd extends a0{constructor(l,u,f,g,m,v,y,x){super(null),S(this,"relatedNode",void 0),S(this,"prevValue",void 0),S(this,"newValue",void 0),S(this,"attrName",void 0),S(this,"attrChange",void 0),S(this,"prevParsedValue",void 0),S(this,"newParsedValue",void 0),this.type=l,this.relatedNode=u,this.prevValue=f,this.newValue=g,this.attrName=m,this.attrChange=v,this.prevParsedValue=y,this.newParsedValue=x}}S(Bd,"ADDITION",2),S(Bd,"MODIFICATION",1),S(Bd,"REMOVAL",3);class Ote{constructor(l){S(this,"hooks",{init:Sn.create(),beginFrame:Sn.create(),beforeRender:Sn.create(),render:Sn.create(),afterRender:Sn.create(),putImageData:Sn.create(),endFrame:Sn.create(),destroy:Sn.create(),pointerdown:Sn.create(),pointerup:Sn.create(),pointermove:Sn.create(),pointerout:Sn.create(),pointerover:Sn.create(),pointerCancel:Sn.create(),wheel:Sn.create()}),S(this,"isInited",!1),S(this,"zIndexCounter",0),S(this,"renderingContext",void 0),this.renderingContext=l}init(){this.hooks.init.emit(),this.isInited=!0}destroy(){this.isInited=!1,this.hooks.destroy.emit()}render(){const{root:l}=this.renderingContext;this.zIndexCounter=0,li.recursiveUpdateHierarchy(l),this.isInited&&(this.renderDisplayObject(l),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear())}renderDisplayObject(l){if(!l.isVisible)return;const{sortable:u}=l;if(u.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),l.imageData)return void this.hooks.putImageData.emit(l);this.hooks.beforeRender.emit(l),this.hooks.render.emit(l),this.hooks.afterRender.emit(l);let f=!1;u.dirty&&(u.sorted=l.childNodes.slice().sort(Lte),u.dirty=!1,f=!0);const g=u.sorted||l.childNodes;g.length>1&&g.sort((m,v)=>m.style.zIndex-v.style.zIndex),g.forEach(m=>{this.renderDisplayObject(m)}),g.sort((m,v)=>m.index-v.index),f&&l.recursiveCall(m=>{const v=new _h("renderOrderChanged",{renderOrder:m.sortable.renderOrder});m.dispatchEvent(v)})}dirty(){this.renderingContext.renderCondition.add(0)}}function Lte(p,l){const u=Number(p.style.zIndex),f=Number(l.style.zIndex);if(u===f&&p.parentNode){const{childNodes:g=[]}=p.parentNode;return g.indexOf(p)-g.indexOf(l)}return u-f}class oL extends A9{constructor(l){super(),S(this,"document",void 0),S(this,"customElements",void 0),S(this,"devicePixelRatio",void 0),S(this,"eventService",void 0),S(this,"renderingService",void 0),S(this,"renderingContext",void 0),S(this,"canvasConfig",void 0),S(this,"renderer",void 0),S(this,"supportTouchEvent",void 0),S(this,"supportPointerEvent",void 0),S(this,"contextService",void 0);const{renderer:u,dpr:f,width:g,height:m,canvas:v,supportPointerEvent:y,supportTouchEvent:x}=l;this.supportPointerEvent=null!=y?y:!!globalThis.PointerEvent,this.supportTouchEvent=null!=x?x:"touchstart"in window;let w=g,C=m,_=f;v&&(_=f||window.devicePixelRatio||1,w=g||v.width/_,C=m||v.height/_),this.canvasConfig=Fe(ne({},l),{width:w,height:C,dpr:_}),this.canvasConfig=l,this.renderer=u,this.document=new Rte,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new Ote(this.renderingContext),this.initRenderer(u)}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",l=>{this.mountChildren(l.detail.child)}),this.document.documentElement.addEventListener("child-removed",l=>{this.unmountChildren(l.detail.child)})}initRenderer(l){this.renderingService.init(),l.initPlugins(this),this.contextService.init(),l.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(u=>{const{renderable:f}=u;f&&(f.boundsDirty=!0,f.renderBoundsDirty=!0)}),this.mountChildren(this.document.documentElement)}render(){const l=new _h("beforeRender",{});this.dispatchEvent(l),this.contextService.clearCanvas(),this.renderingService.render()}setDPR(l){this.canvasConfig.dpr=l,this.contextService.setDPR(l)}resize(l,u){this.canvasConfig.width=l,this.canvasConfig.height=u,this.contextService.resize(l,u)}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(l,u){return this.document.documentElement.appendChild(l,u)}insertBefore(l,u){return this.document.documentElement.insertBefore(l,u)}removeChild(l){return this.document.documentElement.removeChild(l)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(l){l.recursiveCall(u=>{if(!u.isConnected){u.isConnected=!0,u.ownerDocument=this.document;const f=new _h("DOMNodeInsertedIntoDocument",{});u.dispatchEvent(f)}})}unmountChildren(l){const u=[];l.recursiveCall(f=>{f.isConnected&&u.push(f)}),u.reverse().forEach(f=>{f.isConnected=!1;const g=new _h("DOMNodeRemovedFromDocument",{});f.dispatchEvent(g),f!==this.document.documentElement&&(f.ownerDocument=null)})}}class Fs extends class Fte{}{constructor(){super(...arguments),S(this,"close",!0),S(this,"shape",void 0),S(this,"ctx",void 0)}render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!tr(f)&&!f.isNone,y=!tr(g)&&!g.isNone;this.renderPath(l,u),v&&this.renderFill(l,u),this.renderStrokePath(l,u),y&&this.renderStroke(l,u)}renderPath(l,u){l.getPath(),u.beginPath(),l.steps.forEach(f=>{rp(u,f)}),this.close&&l.steps.length>2&&u.closePath()}renderStrokePath(l,u){Zf(null==l?void 0:l.getStrokePath)&&(l.getStrokePath(),0!==l.strokePath.length&&(u.beginPath(),l.strokeSteps.forEach(f=>{rp(u,f)}),this.close&&l.strokeSteps.length>2&&u.closePath()))}renderFill(l,u){const{parsedStyle:f}=l,{background:g,opacity:m,fillOpacity:v,renderBlendMode:y}=f;if(u.save(),u.globalAlpha=m*v,"normal"!==y&&(u.globalCompositeOperation=y),Array.isArray(g)){this.setShapeGradientOrigin(l,u);for(let x=0;x<g.length;x++)0===x&&this.setShadow(l,u),u.fillStyle=this.getColor(l,g[x],u),u.fill()}else this.setShadow(l,u),u.fillStyle=g.formatted,u.fill();u.restore()}renderStroke(l,u){const{parsedStyle:f}=l,{borderWidth:g,borderColor:m,opacity:v,lineCap:y,lineJoin:x,miterLimit:w,lineDash:C,lineDashOffset:_,borderOpacity:T,renderBlendMode:M}=f;g&&g.value>0&&(u.save(),tr(g)||(u.lineWidth=g.value),"normal"!==M&&(u.globalCompositeOperation=M),u.miterLimit=w,u.globalAlpha=v*T,u.lineCap=y,u.lineJoin=x,u.setLineDash(C),u.lineDashOffset=_.value,Array.isArray(m)?(this.setShapeGradientOrigin(l,u),m.forEach(L=>{u.strokeStyle=this.getColor(l,L,u),u.stroke()})):(u.strokeStyle=m.formatted,u.stroke()),u.restore())}setShadow(l,u){const{shadow:f,shadowOffsetX:g,shadowOffsetY:m,shadowBlur:v,shadowColor:y}=l.parsedStyle;(f||y)&&(u.shadowOffsetX=(null==g?void 0:g.value)||f[0],u.shadowOffsetY=(null==m?void 0:m.value)||f[1],u.shadowBlur=(null==v?void 0:v.value)||f[2],u.shadowColor=(null==y?void 0:y.formatted)||f[3])}getColor(l,u,f){let g;if(1===u.type||2===u.type){const m=l.getBoundingRect(),{width:v,height:y}=m,x=v,w=y;g=function(C,_){const{type:T,steps:M,width:L,height:N,angle:V,cx:H,cy:G,size:z}=C;let q=null;if(1===T){const{x1:te,y1:se,x2:ae,y2:j}=function(le,ue,xe){const I=xe*Math.PI/180,A=0+le/2,P=0+ue/2,O=Math.abs(le*Math.cos(I))+Math.abs(ue*Math.sin(I));return{x1:A-Math.cos(I)*O/2,y1:P-Math.sin(I)*O/2,x2:A+Math.cos(I)*O/2,y2:P+Math.sin(I)*O/2}}(L,N,V.value);q=_.createLinearGradient(te,se,ae,j)}else if(2===T){const{x:te,y:se,r:ae}=function(j,le,ue,xe,I){let A=ue.value,P=xe.value;"%"===ue.unit&&(A=ue.value/100*j),"%"===xe.unit&&(P=xe.value/100*le);let O=Math.max(wh({x:0,y:0},{x:A,y:P}),wh({x:0,y:le},{x:A,y:P}),wh({x:j,y:le},{x:A,y:P}),wh({x:j,y:0},{x:A,y:P}));return I&&(vt(I)?O=I.value:nt(I)&&("closest-side"===I?O=Math.min(A,j-A,P,le-P):"farthest-side"===I?O=Math.max(A,j-A,P,le-P):"closest-corner"===I&&(O=Math.min(wh({x:0,y:0},{x:A,y:P}),wh({x:0,y:le},{x:A,y:P}),wh({x:j,y:le},{x:A,y:P}),wh({x:j,y:0},{x:A,y:P}))))),{x:A,y:P,r:O}}(L,N,H,G,z);q=_.createRadialGradient(te,se,0,te,se,ae)}return q&&M.forEach(te=>{let{offset:se,color:ae}=te;var j;"%"===se.unit&&(null===(j=q)||void 0===j||j.addColorStop(se.value/100,ae.toString()))}),q}(Fe(ne({type:u.type},u.value),{width:x,height:w}),f)}return g}setShapeGradientOrigin(l,u){const{type:f}=l.config;switch(f){case"circle":case"arc":{const{r:g}=l.parsedStyle;u.translate(0-g.value,0-g.value);break}case"ellipse":{const{rx:g,ry:m}=l.parsedStyle;u.translate(0-g.value,0-m.value);break}default:u.translate(0,0)}}}class Nte extends Fs{constructor(){super(),this.close=!1}}class Bte extends Fs{}class Ute extends Fs{}class aL extends Fs{render(l,u){const{width:f,height:g,img:m,opacity:v,visibility:y}=l.parsedStyle;"hidden"!==y&&(nt(m)||m&&(u.save(),u.globalAlpha=v,m instanceof ImageData?u.putImageData(m,0,0):(u.imageSmoothingEnabled=!0,u.imageSmoothingQuality&&(u.imageSmoothingQuality="high"),u.drawImage(m,0,0,f.value,g.value)),u.restore()))}}class lL extends Fs{constructor(){super(...arguments),S(this,"close",!1)}render(l,u){const{visibility:f}=l.parsedStyle;"hidden"!==f&&(this.renderPath(l,u),this.renderStroke(l,u))}renderPath(l,u){l.getPath(),u.beginPath(),l.inkRenderSteps.forEach(f=>{f.forEach(g=>{rp(u,g)})})}}class Vte extends Fs{}class cL extends Fs{render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!tr(f)&&!f.isNone,y=!tr(g)&&!g.isNone;l.getPath();const x=l.steps.length;for(let w=0;w<x;w++){const C=l.steps[w];u.beginPath(),C.step.forEach(_=>{rp(u,_)}),C.close&&(u.closePath(),v&&this.renderFill(l,u)),y&&this.renderStroke(l,u)}}}class jte extends Fs{}class hL extends Fs{render(l,u){l&&this.renderText(l,u)}renderText(l,u){var f;const{parsedStyle:g,lines:m}=l,{color:v,borderWidth:y,borderColor:x,textBaseLine:w,opacity:C,textAlign:_,lineDash:T,fillOpacity:M,borderOpacity:L,letterSpacing:N}=g;l.setTextFont(),u.save(),v&&Array.isArray(v)?v.forEach(H=>{u.fillStyle=this.getColor(l,H,u)}):u.fillStyle=v.formatted,x&&Array.isArray(x)?x.forEach(H=>{u.strokeStyle=this.getColor(l,H,u)}):u.strokeStyle=x.formatted,this.setShadow(l,u),u.font=l.font,u.globalAlpha=C,u.lineWidth=null==y?void 0:y.value,u.textAlign=_,u.textBaseline=w,u.letterSpacing=`${N.value}px`,u.setLineDash(T),u.beginPath();const V=(null===(f=m[0])||void 0===f?void 0:f.y)||0;m.forEach(H=>{let{text:G}=H;const z=H.y-V;G=l.transformText(G),v&&this.fillText(u,G,0,z,M),y&&y.value&&y.value>0&&this.strokeText(u,G,0,z,L)}),u.closePath(),u.restore()}fillText(l,u,f,g,m,v){let y;const x=!tr(m)&&1!==m;x&&(y=l.globalAlpha,l.globalAlpha=m*m),l.fillText(u,f,g,v),x&&(l.globalAlpha=y)}strokeText(l,u,f,g,m,v){let y;const x=!tr(m)&&1!==m;x&&(y=l.globalAlpha,l.globalAlpha=m),l.strokeText(u,f,g,v),x&&(l.globalAlpha=y)}}class Hte extends Fs{constructor(){super(...arguments),S(this,"close",!0)}}class dL extends Fs{render(l,u){const{background:f,borderColor:g,visibility:m}=l.parsedStyle;if("hidden"===m)return;const v=!tr(f)&&!f.isNone,y=!tr(g)&&!g.isNone;l.getPath();const x=l.steps.length;for(let w=0;w<x;w++){const C=l.steps[w];u.beginPath(),C.step.forEach(_=>{rp(u,_)}),C.close&&(u.closePath(),v&&this.renderFill(l,u)),y&&this.renderStroke(l,u)}}}class Wte extends Fs{render(l,u){const{width:f,height:g,roundedRadius:m,background:v,borderWidth:y,visibility:x}=l.parsedStyle;if("hidden"!==x){for(let w=0;w<4;w++){u.beginPath();const C=m.value;if(0===C)u.rect(0,0,f.value,g.value);else{const{PI:_}=Math;u.arc(C,C,C,_,3*_/2),u.arc(f.value-C,C,C,3*_/2,2*_),u.arc(f.value-C,g.value-C,C,0,_/2),u.arc(C,g.value-C,C,_/2,_)}}u.closePath(),v&&this.renderFill(l,u),y.value>0&&this.renderStroke(l,u)}}}class uL extends Fs{render(l,u){l&&"hidden"!==l.parsedStyle.visibility&&(this.renderBox(l,u),u.save(),l.renderClipStep&&(u.beginPath(),l.renderClipStep.forEach(f=>{rp(u,f)}),u.closePath(),u.clip()),this.renderText(l,u),u.restore())}renderBox(l,u){const{background:f,borderColor:g}=l.parsedStyle,m="textBox"===l.textType&&!tr(f)&&!f.isNone,v="textBox"===l.textType&&!tr(g)&&!g.isNone;this.renderPath(l,u),m&&this.renderFill(l,u),v&&this.renderStroke(l,u)}renderText(l,u){const{parsedStyle:f,lines:g}=l,{opacity:m,y:v,x:y}=f;u.globalAlpha=m,g.forEach(x=>{const w=x.height/30,C=l.getTextAlignOffset(x);x.words.forEach(_=>{const{color:T,fontFamily:M,fontSize:L,fontStyle:N,fontWeight:V,lineThrough:H,underline:G}=_.style;u.fillStyle=T;const z=""===M.trim()?"sans-serif":M;u.font=M.includes(" ")?`${N} ${V} ${L.value}${L.unit} '${z}'`:`${N} ${V} ${L.value}${L.unit} ${z}`;let q=_.x-y+C;for(let te=0;te<_.text.length;te++){const se=_.text.charAt(te);u.fillText(se,q,x.y-v),q+=u.measureText(se).width}G&&u.fillRect(_.x-y+C,x.y-v+w,_.widthWithoutLf,w),H&&u.fillRect(_.x-y+C,x.y-_.wordHeight/3-v,_.widthWithoutLf,L.value/30)})})}}class Gte{constructor(l){S(this,"canvasConfig",void 0),S(this,"container",void 0),S(this,"canvas",void 0),S(this,"dpr",void 0),S(this,"context",void 0),S(this,"shapeRenderers",{}),this.canvasConfig=l}init(){const{container:l,canvas:u,dpr:f,willReadFrequently:g}=this.canvasConfig;if(u){this.canvas=u;const{parentElement:m}=u;l&&m!==l&&l.appendChild(u),this.container=m,this.canvasConfig.container=m}else if(l&&(this.container=l,nt(l)&&(this.container=document.getElementById(l)),this.container)){const m=document.createElement("canvas");this.container.appendChild(m),this.canvas=m}this.context=this.canvas.getContext("2d",{willReadFrequently:g}),this.dpr=f||t0(),this.resize(this.canvasConfig.width,this.canvasConfig.height)}registerShapeRenderer(l,u){this.shapeRenderers[l]||(this.shapeRenderers[l]=u)}getShapeRenderer(l){return this.shapeRenderers[l]}destroy(){const{canvas:l,container:u}=this;u&&null!=l&&l.parentNode&&u.removeChild(l)}resize(l,u){const{canvas:f,dpr:g}=this;f&&(f.width=l*g,f.height=u*g,this.context.scale(g,g))}getDPR(){return this.dpr}setDPR(l){this.canvasConfig.dpr=l,this.dpr=l}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(l){var u;null!=this&&null!==(u=this.container)&&void 0!==u&&u.style&&(this.container.style.cursor=l)}getBoundingClientRect(){var l;return null===(l=this.canvas)||void 0===l?void 0:l.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr))}}class fL{constructor(){S(this,"restoreStack",[])}init(l){const{hooks:u}=l.renderingService;u.endFrame.on(()=>{const{contextService:f}=l,g=f.getContext();this.restoreStack.forEach(()=>{g.restore()}),this.restoreStack=[]}),u.render.on(f=>{this.renderDisplayObject(f,l)}),u.putImageData.on(f=>{if(f.imageData){const{x:g,y:m}=f.getPosition(),v=l.contextService.getContext(),y=l.contextService.getDPR();v.putImageData(f.imageData,Math.floor(g*y+.5),Math.floor(m*y+.5))}})}renderDisplayObject(l,u){if(!l.isVisible)return;const{contextService:f}=u,g=f.getContext();let m=this.restoreStack[this.restoreStack.length-1];for(;m&&l.parentNode!==m;)g.restore(),this.restoreStack.pop(),m=this.restoreStack[this.restoreStack.length-1];g.save(),this.applyTransform(g,l);const{clipPath:v}=l.style;v&&(g.save(),this.applyTransform(g,v),g.restore(),g.clip()),this.useAnchor(g,l);const y=f.getShapeRenderer(l.shapeType);y&&(y.render(l,g),l.clippable&&g.clip()),this.restoreStack.push(l)}applyTransform(l,u){u.externalMatrices.length&&u.externalMatrices.slice().reverse().forEach(C=>{const{a:_,b:T,c:M,d:L,e:N,f:V}=C;l.transform(_,T,M,L,N,V)});const f=u.getLocalTransform(),{a:g,b:m,c:v,d:y,e:x,f:w}=f;l.transform(g,m,v,y,x,w)}applyAttributes(l,u,f){}useAnchor(l,u){const{anchor:f}=u.parsedStyle||{};if(!f||0===f[0]&&0===f[1])return;const g=u.getGeometryBounds().getRect();l.translate(-(f&&f[0]||0)*g.width,-(f&&f[1]||0)*g.height)}destroy(){}}S(fL,"moduleName",void 0);class zte{init(l){const u=new Gte(l.canvasConfig);l.contextService=u,[{name:"arc",renderer:new Nte},{name:"circle",renderer:new Bte},{name:"ellipse",renderer:new Ute},{name:"line",renderer:new dL},{name:"image",renderer:new aL},{name:"ink",renderer:new lL},{name:"polygon",renderer:new Vte},{name:"polyline",renderer:new cL},{name:"rect",renderer:new jte},{name:"stampPath",renderer:new Hte},{name:"text",renderer:new hL},{name:"roundedRect",renderer:new Wte},{name:"freeText",renderer:new uL}].forEach(f=>{let{name:g,renderer:m}=f;u.registerShapeRenderer(g,m)})}destroy(){}}class pL extends class kte{constructor(l){S(this,"contextService",void 0),S(this,"renderingPlugins",[]),S(this,"config",{autoRendering:!0}),Object.assign(this.config,l)}use(l){this.renderingPlugins.includes(l)||this.renderingPlugins.push(l)}initPlugins(l){this.renderingPlugins.forEach(u=>{u.init(l)})}destroyPlugins(){this.renderingPlugins.forEach(l=>{l.destroy()})}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}{constructor(l){super(l),this.use(new zte),this.use(new fL)}}function gL(p,l,u){const v=(l.x-p.x)*(u.y-p.y)-(l.y-p.y)*(u.x-p.x),y=yh(p,l),x=yh(p,u);let w=(y**2+x**2-yh(l,u)**2)/(2*y*x);w<-1&&(w=-1),w>1&&(w=1);let C=180*Math.acos(w)/Math.PI;return C=Math.round(100*C)/100,v<0?-C:C}function B6(p,l,u){const f=S3(l,p);return S3(l,u).angle(f)>Math.PI/2?-1:1}function qo(p,l){return(l=p.getWorldTransform().inverse().transformPoint(l)).x+=p.parsedStyle.x,l.y+=p.parsedStyle.y,l}function m0(p){if(!p)return!1;const{shapeType:l}=p;return"annotationRect"===l||"annotationFreeText"===l&&"textBox"===p.textType||"annotationStamp"===l&&"image"===p.renderType}function Dh(p){return!!p&&("annotationPolyline"===p.shapeType||"annotationPolygon"===p.shapeType||"annotationLine"===p.shapeType)}function v0(p){return!!p&&("annotationFreeText"===p.shapeType||"annotationTextBox"===p.shapeType)}function Ea(p,l){const u=window.TouchEvent&&l instanceof TouchEvent?l.targetTouches[0]:l,f=p.getBoundingClientRect();return{offsetX:u.pageX-window.scrollX-f.left,offsetY:u.pageY-window.scrollY-f.top}}function mL(p){let l,u;if(p.controls){const{width:f,height:g}=p.controls.getLength();l=f,u=g}else{const{x:f,y:g}=p.getScale(),{width:m,height:v}=p.getBoundingRect();l=m*f,u=v*g}return{width:l,height:u}}function lp(p){return/^[\r\n]+$/.test(p)}function vL(p,l,u){return p.slice(0,l)+p.slice(u+1)}function U6(p,l){const{textContents:u}=p.style,f=[];return u.forEach(g=>{f.push(ne(ne({},g),l))}),f}function V6(p,l){const{textContents:u}=p.style,{textSelection:f}=p.textEditEventHandler;if(!f.length)return u;const[g,m]=f,v=g.freeContentIndex,y=m.freeContentIndex,x=u.slice(0,v),w=u.slice(v,y+1),C=u.slice(y+1),_=[];if(g.freeContentIndex===m.freeContentIndex){const{content:T}=w[0],M=T.slice(0,g.indexInFreeContent),L=T.slice(g.indexInFreeContent,m.indexInFreeContent+1),N=T.slice(m.indexInFreeContent+1);M&&_.push(Fe(ne({},w[0]),{content:M})),L&&_.push(Fe(ne(ne({},w[0]),l),{content:L})),N&&_.push(Fe(ne({},w[0]),{content:N}))}else for(let T=0;T<w.length;T++){const M=w[T];0===T?(_.push(Fe(ne({},M),{content:M.content.slice(0,g.indexInFreeContent)})),_.push(Fe(ne(ne({},M),l),{content:M.content.slice(g.indexInFreeContent)}))):T===w.length-1?(_.push(Fe(ne(ne({},M),l),{content:M.content.slice(0,m.indexInFreeContent+1)})),_.push(Fe(ne({},M),{content:M.content.slice(m.indexInFreeContent+1)}))):_.push(ne(ne({},M),l))}return[...x,..._,...C]}function yL(p){if(!p)return!1;let l=p,u="visible"===l.parsedStyle.visibility;for(;l;)l.parsedStyle.visibility&&"hidden"===l.parsedStyle.visibility&&(u=!1),l=l.parentNode;return u}var Zt;!function(p){p.REJECTED="SBRejected",p.ACCEPTED="SHAccepted",p.INITIAL_HERE="SHInitialHere",p.SIGN_HERE="SHSignHere",p.WITNESS="SHWitness",p.APPROVED="SBApproved",p.NOT_APPROVED="SBNotApproved",p.DRAFT="SBDraft",p.FINAL="SBFinal",p.COMPLETED="SBCompleted",p.CONFIDENTIAL="SBConfidential",p.VOID="SBVoid"}(Zt||(Zt={}));const Ud={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},xL={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},ci={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:Zt.DRAFT,imageData:null,textAlign:"left",textContent:ne({},xL)},$te={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},Yte={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,inkCreateDelay:3e3,controlsStyle:Ud,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class mo{constructor(l){S(this,"shape",void 0),S(this,"startTime",void 0),S(this,"startPoint",void 0),S(this,"lastPoint",void 0),S(this,"limitPosition",void 0),S(this,"limitAngle",void 0),S(this,"unLimitPosition",void 0),S(this,"unLimitScale",void 0),S(this,"unLimitStyle",void 0),S(this,"limitArea",void 0),this.shape=l}setLimitArea(l){this.limitArea=l}updateShapeByLimitArea(){const{shapeType:l}=this.shape,{left:u,right:f,top:g,bottom:m}=this.isOutOfLimitArea(1,1),v=u||f||g||m,y=m0(this.shape)||"annotationEllipse"===l;v?(y?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(y&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone())}getShapeOriginPosition(){const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=new Eh({style:{x:l-this.shape.style.x+f/2,y:u-this.shape.style.y+g/2}});this.shape.appendChild(m);const{x:v,y}=m.getPosition();return m.destroy(),{x:v,y}}getShapeVertexPosition(){const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=[];for(let v=0;v<4;v++){let y=l-this.shape.style.x,x=u-this.shape.style.y;switch(v){case 1:y+=f;break;case 2:y+=f,x+=g;break;case 3:x+=g}const w=new Eh({style:{x:y,y:x}});this.shape.appendChild(w);const{x:C,y:_}=w.getPosition();m.push({x:C,y:_}),w.destroy()}return m}isOutOfLimitArea(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.limitArea)return{left:!1,right:!1,top:!1,bottom:!1};const{x:f,y:g,width:m,height:v}=this.limitArea;let y=!1,x=!1,w=!1,C=!1;const _=this.getShapeVertexPosition();for(let T=0;T<4;T++){const{x:M,y:L}=_[T];y=M<f-l||y,x=M>f+m+l||x,w=L<g-u||w,C=L>g+v+u||C}return{left:y,right:x,top:w,bottom:C}}getLimitPosition(){if(!this.limitArea)return null;const l=this.getShapeVertexPosition(),{x:u,y:f}=l[0],{x:g,y:m,width:v,height:y}=this.limitArea,x=l[1].x-u,w=l[2].x-u,C=l[3].x-u,_=l[1].y-f,T=l[2].y-f,M=l[3].y-f;let L=g-Math.min(x,w,C),N=g+v-Math.max(x,w,C),V=m-Math.min(_,T,M),H=m+y-Math.max(_,T,M);if(x>=0&&w>=0&&C>=0?L=g:x<=0&&w<=0&&C<=0&&(N=g+v),_>=0&&T>=0&&M>=0?V=m:_<=0&&T<=0&&M<=0&&(H=m+y),(G=this.shape)&&("annotationEllipse"===G.shapeType||"annotationCircle"===G.shapeType)){const{x:z,y:q}=this.getShapeOriginPosition(),te=z-u,se=q-f;L+=te,N+=te,V+=se,H+=se}var G;return{minPosX:L,maxPosX:N,minPosY:V,maxPosY:H}}getLimitRotateAngle(){if(!this.limitArea)return[];const l=function(m,v){const y=m,[x,w,C,_]=y,{x:T,y:M,width:L,height:N}=v,V=T+L,H=M+N,G=(x.x+w.x+C.x+_.x)/4,z=(x.y+w.y+C.y+_.y)/4,q=Math.sqrt((G-x.x)**2+(z-x.y)**2),te=G-q,se=G+q,ae=z-q,j=z+q;if(te>T&&ae>M&&se<V&&j<H)return[];const le=A=>{const P=q*q-(A-G)**2;return[{x:A,y:z-Math.sqrt(P)},{x:A,y:z+Math.sqrt(P)}]},ue=A=>{const P=q*q-(A-z)**2;return[{x:G-Math.sqrt(P),y:A},{x:G+Math.sqrt(P),y:A}]},xe=(A,P)=>{const O=[];return A.forEach(b=>{m.forEach(D=>{let k=gL({x:G,y:z},D,b);0===k&&(k=G>D.x?z>D.y?-0:0:z>D.y?0:-0,"top"!==P&&"bottom"!==P||(k=-k)),O.push(k)})}),O},I=[];if(te<T){const A=le(T);I.push(...xe(A,"left"))}if(ae<M){const A=ue(M);I.push(...xe(A,"top"))}if(se>V){const A=le(V);I.push(...xe(A,"right"))}if(j>H){const A=ue(H);I.push(...xe(A,"bottom"))}return I}(this.getShapeVertexPosition(),this.limitArea);if(0===l.length)return[];let u=0;if(l.forEach(m=>{0===m&&u++}),u>=2)return[0,0];const{maxNegative:f,minPositive:g}=function(m){let v=-1/0,y=1/0;for(let x=0;x<m.length;x++)m[x]<0&&m[x]>v||Object.is(m[x],-0)?v=m[x]:(m[x]>0&&m[x]<y||Object.is(m[x],0))&&(y=m[x]);return v===-1/0&&(v=0),y===1/0&&(y=0),{maxNegative:v,minPositive:y}}(l);return[f,g]}moveShape(l){const{shape:u,startPoint:f}=this,{lastWorldPosition:g,controlsFlags:m}=u.context;if(!m.enableMove||new Mi(l.x,l.y).distanceTo(f)<0)return;let x=g.x+(l.x-f.x),w=g.y+(l.y-f.y);const{left:C,right:_,top:T,bottom:M}=this.isOutOfLimitArea(1,1);if(this.limitPosition&&!(C||_||T||M)){const{minPosX:N,maxPosX:V,minPosY:H,maxPosY:G}=this.limitPosition;x<N&&(x=N),x>V&&(x=V),w<H&&(w=H),w>G&&(w=G)}this.shape.setPosition({x,y:w})}moveVertex(l){const{shape:u}=this,{context:f,shapeType:g}=u,{hitControlPoint:m,lastLocalScale:v,lastControlsWidth:y,lastControlsHeight:x,keepAspectRatio:w,lastHitControlPoint:C,lastShareAxisYPoint:_,lastShareAxisXPoint:T,lastLocalTransform:M}=f,L=B3(C,T,l).distanceTo(T)||1;if(B6(C,T,l)<0)return;let N=L-y,V=L/y;const H=B3(C,_,l).distanceTo(_)||1;if(B6(C,_,l)<0)return;let G=H-x,z=H/x;w&&(V>=z?(z=V,G=z*x-x):(V=z,N=V*y-y));const{left:q,right:te,top:se,bottom:ae}=this.isOutOfLimitArea(1,1),j=q||te||se||ae,le="annotationEllipse"===g;m0(u)?this.moveRectVertex(m,N,G):le?this.moveEllipseVertex(m,N,G):(m<2&&(G=-G),0!==m&&3!==m||(N=-N),u.setLocalTransform(M),u.translate(N/2,G/2),u.setLocalScale(V*v.x,z*v.y,1)),j||0===u.getAngle()||this.updateShapeByLimitArea(),u.context.updateControls()}moveEllipseVertex(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeWidth:y,lastShapeHeight:x,lastLocalTransform:w}=this.shape.context,C=(y+u/Math.abs(m))/2,_=(x+f/Math.abs(v))/2;g.style.rx=C<1?1:C,g.style.ry=_<1?1:_,l<2&&(f=-f),0!==l&&3!==l||(u=-u),this.shape.setLocalTransform(w),this.shape.translate(u/2,f/2)}moveRectVertex(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeWidth:y,lastShapeHeight:x,lastLocalTransform:w,lastWorldPosition:C}=this.shape.context,_=l,T=y+u/Math.abs(m),M=x+f/Math.abs(v);if(g.style.width=T<1?1:T,g.style.height=M<1?1:M,2===_)g.setPosition({x:C.x,y:C.y});else switch(g.setLocalTransform(w),_){case 1:g.translate(0,-f);break;case 3:g.translate(-u,0);break;default:g.translate(-u,-f)}}moveMidpoints(l){const{shape:u}=this,{context:f,shapeType:g}=u,{lastLocalScale:m,lastControlsWidth:v,lastControlsHeight:y,lastLocalTransform:x,lastHitControlPoint:w,lastShareAxisPoint:C,hitControlPoint:_}=f,T=_-4,M=B3(w,C,l).distanceTo(C);if(B6(w,C,l)<0)return;const L="annotationEllipse"===g,N=M/v*m.x,V=M/y*m.y,H=(1===T?1:-1)*(M-v),G=(2===T?1:-1)*(M-y),{left:z,right:q,top:te,bottom:se}=this.isOutOfLimitArea(1,1),ae=z||q||te||se;m0(u)?this.moveRectMidPoint(T,H,G):L?this.moveEllipseMidPoint(T,H,G):T%2?(this.shape.setLocalTransform(x),this.shape.translate(H/2,0),this.shape.setLocalScale(N,m.y,1)):(this.shape.setLocalTransform(x),this.shape.translate(0,G/2),this.shape.setLocalScale(m.x,V,1)),ae||0===u.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls()}moveRectMidPoint(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeHeight:y,lastWorldPosition:x,lastLocalTransform:w,lastShapeWidth:C}=g.context;if(l%2){const _=(1===l?u:-u)/Math.abs(m)+C;g.style.width=_<1?1:_,1===l?this.shape.setPosition({x:x.x,y:x.y}):(this.shape.setLocalTransform(w),this.shape.translate(u,0))}else{const _=(2===l?f:-f)/Math.abs(v)+y;g.style.height=_<1?1:_,2===l?this.shape.setPosition({x:x.x,y:x.y}):(this.shape.setLocalTransform(w),this.shape.translate(0,f))}}moveEllipseMidPoint(l,u,f){const{shape:g}=this,{x:m,y:v}=g.getScale(),{lastShapeHeight:y,lastLocalTransform:x,lastShapeWidth:w}=g.context;if(l%2){const C=(1===l?u:-u)/Math.abs(m)+w;g.style.rx=C<2?1:C/2,this.shape.setLocalTransform(x),this.shape.translate(u/2,0)}else{const C=(2===l?f:-f)/Math.abs(v)+y;g.style.ry=C<2?1:C/2,this.shape.setLocalTransform(x),this.shape.translate(0,f/2)}}moveRotationPoint(l){const{startPoint:u,shape:f}=this,{lastOriginWorldPosition:g,lastLocalTransform:m}=f.context,v=gL(g,u,l);this.shape.setLocalTransform(m),this.shape.rotateLocal(v)}isHit(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:f}=this,{context:g,parsedStyle:m}=f;if("hidden"===m.visibility||!g.controlsFlags.enableControl)return-1;if(g.isGrouped)return g.unHitShape(),-1;let{controls:v}=f,y=!0;v||(y=!1,g.initControls(),g.renderControls(),v=f.controls);let x=v.checkHitArea(l.x,l.y);return Dh(f)&&!f.context.controlsFlags.useDefaultControls&&(8===x?x=-1:x>0&&(x=9),-1!==f.pointEventsHandler.isHitPoint(l)&&(x=0)),x<0?(u&&(g.unHitShape(),y||f.context.destroyControls()),-1):x}startHandler(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=this.isHit(l);if(-1===f&&!u)return;-1===f&&u&&(f=9);const{shape:g}=this,{context:m,controls:v}=g;if(m.isStart=!0,this.lastPoint=ne({},l),this.startPoint=ne({},l),this.startTime=(new Date).getTime(),Dh(g)&&(g.pointEventsHandler.enableEditMode(),g.pointEventsHandler.editStartHandler(l)),v0(g)&&g.textEditEventHandler.editStartHandler(l),this.limitPosition=this.getLimitPosition(),m.controlsFlags.useDefaultControls){m.hitShape(),m.hitControlPoint=f;const{ctrlWidth:y,ctrlHeight:x}=m.parsedControlsStyle,w=y/2,C=x/2;if(f<4){const _=v.controlPoints.slice(0,4),T=_[f].getPosition().x+w,M=_[f].getPosition().y+C;m.lastHitControlPoint=ne({},l),m.lastHitControlPointCenter={x:T,y:M},m.lastShareAxisYPoint={x:_[3-f].getPosition().x+w+l.x-T,y:_[3-f].getPosition().y+C+l.y-M},m.lastShareAxisXPoint={x:_[f%2?f-1:f+1].getPosition().x+w+l.x-T,y:_[f%2?f-1:f+1].getPosition().y+C+l.y-M}}else if(f<8){const _=v.controlPoints.slice(4,8),T=_[f-4].getPosition().x+w,M=_[f-4].getPosition().y+C;m.lastHitControlPoint=ne({},l),m.lastHitControlPointCenter={x:T,y:M},m.lastShareAxisPoint={x:_[(f-2)%4].getPosition().x+w+l.x-T,y:_[(f-2)%4].getPosition().y+C+l.y-M}}}else m.isHit=!0,m.hitControlPoint=9,m.lastWorldPosition=g.getPosition(),m.lastControlsWorldPosition=g.controls.getPosition()}moveHandler(l,u){const{shape:f,lastPoint:g}=this,{context:m,controls:v}=f,{isHit:y,isStart:x,hitControlPoint:w}=m,C=Dh(f),_=v0(f);y&&x&&v&&(g.x=l.x,g.y=l.y,C&&-1!==f.pointEventsHandler.hitIndex?f.pointEventsHandler.editMoveHandler(l):_&&f.textEditEventHandler.editMode?f.textEditEventHandler.editMoveHandler(l):w<4?(m.keepAspectRatio=u,this.moveVertex(l)):w<8?this.moveMidpoints(l):w<9?this.moveRotationPoint(l):(this.moveShape(l),C&&f.pointEventsHandler.updateLineControls()))}endHandler(l){const{shape:u,startPoint:f,lastPoint:g}=this,{context:m}=u,{isStart:v,isHit:y}=u.context;if(!v||!y)return;const _=(new Date).getTime()-this.startTime<=200&&((g.x-f.x)**2+(g.y-f.y)**2)**.5<2,T=Dh(u),M=v0(u);if(T&&u.pointEventsHandler.editEndHandler(),M&&u.textEditEventHandler.editEndHandler(),!m.isActive&&_&&(m.isActive=!0),l){if(M&&u.textEditEventHandler.editMode)return void(m.hitControlPoint=-1);const L=[];if(8===m.hitControlPoint)L.push("rotated");else{const{lastControlsWorldPosition:V,lastControlsWidth:H,lastControlsHeight:G,lastWorldPosition:z}=m,{width:q,height:te}=u.controls.getLength(),se=u.controls.getPosition(),ae=u.getPosition(),j=u instanceof Vd?V:z,le=u instanceof Vd?se:ae;le.x.toFixed(1)===j.x.toFixed(1)&&le.y.toFixed(1)===j.y.toFixed(1)||L.push("moved");const ue=T&&-1!==u.pointEventsHandler.hitIndex,xe=!(!H||!G||q.toFixed(3)===H.toFixed(3)&&te.toFixed(3)===G.toFixed(3));u instanceof xc||!ue&&!xe||L.push("resized")}const N=[...new Set(L)];N.length&&l.emitModifyAnnotation(N,[u])}m.isHit=!1,m.keepAspectRatio=!1}}class Xte extends Wn{constructor(l,u){super({type:"annotationGroup",style:{visibility:"visible"}}),S(this,"shapeType","annotationControls"),S(this,"container",void 0),S(this,"borders",void 0),S(this,"rotationPoint",void 0),S(this,"controlPoints",void 0),S(this,"rotationBorder",void 0),S(this,"rotationPointOffset",30),S(this,"vertexes",[]),S(this,"midpoints",[]),this.container=l;for(const f in u)A3(f,u)&&(this[f]=u[f]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls()}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&yL(null==this?void 0:this.container)}initBorders(){const{borderColor:l,borderWidth:u,lineDash:f,background:g}=this.container.context.parsedControlsStyle,{width:m}=this.container.getBoundingRect(),v=u/2;this.borders=new $3({style:{points:this.vertexes,borderWidth:u,background:g,borderColor:l,lineDash:f}}),this.borders.setLocalPosition(-v,-v),this.rotationBorder=new $3({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:u,borderColor:l,lineDash:f}});const y=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(m/2-v,-y),this.appendChild(this.borders),this.appendChild(this.rotationBorder)}initControls(){const{vertexes:l,midpoints:u,rotationPoint:f}=this,{ctrlBorderColor:g,ctrlBorderWidth:m,ctrlLineDash:v,ctrlBackground:y,ctrlWidth:x,ctrlHeight:w,ctrlBorderRadius:C}=this.container.context.parsedControlsStyle,{x:_,y:T}=this.container.getBoundingRect(),M=[...l,...u,f],L={background:y,borderColor:g,borderWidth:m,lineDash:v,width:x,height:w,roundedRadius:C};M.forEach(N=>{const V=new M6({style:ne({x:N.x,y:N.y},L)});V.setLocalPosition(N.x-Dt(x).value/2-_,N.y-Dt(w).value/2-T),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(V),this.appendChild(V)})}calculateMidpoints(l){const u=[];for(let f=0,g=l.length;f<g;f++){const m=new Mi((l[f].x+l[(f+1)%g].x)/2,(l[f].y+l[(f+1)%g].y)/2);u.push(m)}return u}calculateRotationPoint(l){const u=l[0].distanceTo(l[2]);return l[2].lerpTo(l[0],this.rotationPointOffset/u+1)}update(l){const{midpoints:u,rotationPoint:f,container:g}=this,{ctrlWidth:m,ctrlHeight:v,borderWidth:y}=this.container.context.parsedControlsStyle,x=[...l,...u,f],{x:w,y:C,width:_,height:T}=g.getBoundingRect(),M=y/2;this.controlPoints.forEach((V,H)=>{const{x:G,y:z}=x[H];V.updateStyle({x:G,y:z}),V.setLocalPosition(G-m/2-w,z-v/2-C)}),this.borders.updateStyle({points:l}),this.borders.setLocalPosition(_<0?_:-M,T<0?T:-M);const L=Math.min(u[0].x,f.x),N=Math.min(u[0].y,f.y);this.rotationBorder.updateStyle({points:[u[0],f]}),this.rotationBorder.setLocalPosition(L-w-M,N-C)}updateOrigin(){this.setOrigin(this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y)}updateControlPoints(l){this.vertexes=l,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints)}getLength(){return{width:this.midpoints[1].x-this.midpoints[3].x,height:this.midpoints[2].y-this.midpoints[0].y}}setVisible(l){this.style.visibility=l}setBoxVisible(l){this.borders.style.visibility=l}setRotationPointVisible(l){this.rotationBorder.style.visibility=l,this.controlPoints[8].style.visibility=l}setControlPointVisible(l){this.controlPoints.forEach((u,f)=>{f<8&&(u.style.visibility=l)})}checkHitArea(l,u){const f=this.getWorldTransform().inverse().transformPoint({x:l,y:u}),{x:g,y:m}=this.controlPoints[0].parsedStyle,v={x:f.x+g,y:f.y+m},{ctrlWidth:y,ctrlHeight:x}=this.container.context.parsedControlsStyle;f.x+=g+y/2,f.y+=m+x/2;const w=gi()?10:0;let C=-1;for(let _=0;_<this.controlPoints.length;_++){const T=this.controlPoints[_];if("visible"===T.style.visibility&&T.isPointInPath({x:f.x,y:f.y},w)){C=_;break}}return C>-1?C:this.borders.isPointInPath(v)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null)}}class vo{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};S(this,"shape",void 0),S(this,"referencePoint",void 0),S(this,"controlsStyle",void 0),S(this,"controlsFlags",void 0),S(this,"parsedControlsStyle",void 0),S(this,"keepAspectRatio",!1),S(this,"isInGroup",!1),S(this,"isGrouped",!1),S(this,"isActive",!1),S(this,"isStart",!1),S(this,"isHit",!1),S(this,"hitControlPoint",-1),S(this,"lastHitControlPoint",void 0),S(this,"lastHitControlPointCenter",void 0),S(this,"lastLocalTransform",void 0),S(this,"lastWorldPosition",void 0),S(this,"lastLocalScale",void 0),S(this,"lastOriginWorldPosition",void 0),S(this,"lastControlsWorldPosition",void 0),S(this,"lastControlsWidth",void 0),S(this,"lastControlsHeight",void 0),S(this,"lastShareAxisPoint",void 0),S(this,"lastShareAxisXPoint",void 0),S(this,"lastShareAxisYPoint",void 0),S(this,"lastShapeWidth",void 0),S(this,"lastShapeHeight",void 0),this.shape=l,this.controlsStyle=ne(ne({},Ud),u),this.controlsFlags=ne({},$te),this.parseControlsStyle()}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:l,y:u}=this.shape.getBoundingRect(),m=new Eh({style:{x:l-this.shape.style.x,y:u-this.shape.style.y,r:0}});this.shape.appendChild(m),this.referencePoint=m}updateReferenceBox(){if(!this.referencePoint)return;const{x:l,y:u}=this.shape.getBoundingRect();this.referencePoint.updateStyle({x:l-this.shape.style.x,y:u-this.shape.style.y})}getControlVertexes(){const{shape:l}=this,{x:u,y:f,width:g,height:m}=l.getBoundingRect();return[new Mi(u,f),new Mi(u+g,f),new Mi(u+g,f+m),new Mi(u,f+m)]}getScaledControlVertexes(){const{shape:l}=this,{x:u,y:f}=l.getScale(),{x:g,y:m,width:v,height:y}=l.getBoundingRect(),x=v*Math.abs(u)||1,w=y*Math.abs(f)||1;return[new Mi(g,m),new Mi(g+x,m),new Mi(g+x,m+w),new Mi(g,m+w)]}showControls(){this.initReferenceBox();const{shape:l,referencePoint:u}=this,{x:f,y:g}=u.getPosition(),m=l.getAngle(),v=f,y=g;l.controls.setAngle(m),l.controls.setPosition({x:v,y})}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:l,border:u,ctrlWidth:f,ctrlHeight:g,ctrlBackground:m,ctrlBorderRadius:v,ctrlBorder:y}=this.controlsStyle,x=u||Ud.border,{borderColor:w,borderStyle:C,borderWidth:_}=n0(x),T=Dt(_).value,M=y||Ud.ctrlBorder,{borderColor:L,borderStyle:N,borderWidth:V}=n0(M),H=Dt(V).value,G=Dt(f).value,z=Ld(v);this.parsedControlsStyle={background:l||Ud.background,ctrlBackground:m||Ud.ctrlBackground,ctrlBorderRadius:"%"===z.unit?z.value/100*G:v||Ud.ctrlBorderRadius,borderColor:w,borderWidth:T,lineDash:"solid"===C?[0,0]:[2*T,T],ctrlWidth:G,ctrlHeight:Dt(g).value,ctrlBorderColor:L,ctrlBorderWidth:H,ctrlLineDash:"solid"===N?[0,0]:[2*H,H]}}updateControlsFlags(l){const{enableEdit:u,enableRotate:f,enableControl:g,isVisible:m}=l;this.shape.controls&&(Jn(u)&&this.shape.controls.setControlPointVisible(u?"visible":"hidden"),Jn(f)&&this.shape.controls.setRotationPointVisible(f?"visible":"hidden"),Jn(g)&&!g&&this.destroyControls()),Jn(m)&&(this.shape.style.visibility=m?"visible":"hidden"),this.controlsFlags=ne(ne({},this.controlsFlags),l)}hitShape(){const{shape:l}=this,{shapeType:u,controls:f}=l;this.isHit=!0,this.lastWorldPosition=l.getPosition().clone(),this.lastLocalTransform=l.getLocalTransform().clone(),this.lastLocalScale=l.getLocalScale(),this.lastControlsWorldPosition=f.getPosition().clone(),this.lastControlsWidth=f.getLength().width,this.lastControlsHeight=f.getLength().height;const g=l.getBoundingRect(),m=new Eh({style:{x:g.x-l.style.x+g.width/2,y:g.y-l.style.y+g.height/2,r:0}});l.appendChild(m),this.lastOriginWorldPosition=m.getPosition(),m.destroy(),"annotationEllipse"===u&&(this.lastShapeWidth=2*l.parsedStyle.rx.value,this.lastShapeHeight=2*l.parsedStyle.ry.value),m0(this.shape)&&(this.lastShapeWidth=l.parsedStyle.width.value,this.lastShapeHeight=l.parsedStyle.height.value)}unHitShape(){const{context:l}=this.shape;l.isStart=!1,l.isHit=!1,l.isActive=!1,l.hitControlPoint=-1,v0(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),Dh(this.shape)&&this.shape.pointEventsHandler.disableEditMode()}initControls(){const{shape:l}=this,u=this.getControlVertexes(),f=new Xte(l,{vertexes:u});l.controls=f,l.getRootNode().appendChild(f),this.updateControlsFlags(this.controlsFlags)}updateControls(){var l,u,f,g;const{shape:m}=this,v=this.getScaledControlVertexes();JSON.stringify(v)!==JSON.stringify(null===(l=m.controls)||void 0===l?void 0:l.vertexes)&&(null===(u=m.controls)||void 0===u||u.updateControlPoints(v),null===(f=m.controls)||void 0===f||f.update(v),null===(g=m.controls)||void 0===g||g.updateOrigin())}renderControls(){const{shape:l,isStart:u,isActive:f,controlsFlags:g,isInGroup:m}=this,{useDefaultControls:v}=g,{controls:y}=l;let x="hidden";y&&(v&&(u||f||m)&&(x="visible"),y&&y.setVisible(x),this.updateControls(),this.showControls())}destroyControls(){var l,u;null===(l=this.referencePoint)||void 0===l||l.destroy(),this.referencePoint=null,null===(u=this.shape.controls)||void 0===u||u.destroy(),this.shape.controls=null}getTransform(){const{parentNode:l}=this.shape,u=l instanceof xc&&this.shape.context.isGrouped;u&&l.delete(this.shape,!1);const f=ne({},this.shape.getLocalPosition()),g=this.shape.getLocalAngle(),m=ne({},this.shape.getLocalScale());return u&&l.add(this.shape),{angle:g,scale:m,position:f}}setTransform(l){if(l){const{scale:u,angle:f,position:g}=l;g&&this.shape.setLocalPosition(g),Se(f)||this.shape.setLocalAngle(f),Se(u)||this.shape.setLocalScale(u)}}getCommonStyleConfig(){const{lineCap:l,lineJoin:u,lineDash:f,background:g,opacity:v,miterLimit:x,borderColor:w,borderWidth:C}=this.shape.attributes;return{lineCap:l,lineJoin:u,lineDash:f,background:g,opacity:v,borderColor:w,borderWidth:C,miterLimit:x}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:l,y:u,width:f,height:g}=this.shape.getBoundingRect(),m=[],{useDefaultControls:v,enableRotate:y}=this.shape.context.controlsFlags,x=v&&y?5:4;for(let w=0;w<x;w++){let C=l-this.shape.style.x,_=u-this.shape.style.y;1!==w&&2!==w||(C+=f),2!==w&&3!==w||(_+=g),4===w&&(C+=f/2,_-=30/this.shape.getScale().y);const T=new Eh({style:{x:C,y:_,r:0}});this.shape.appendChild(T);const{x:M,y:L}=T.getPosition();m.push({x:M,y:L}),T.destroy()}return yc(m)}}class wL extends X9{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationArc"},l)),S(this,"shapeType","annotationArc"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}getAnnotationConfig(){const l=this.context.getTransform(),{position:u}=l,{r:f,startAngle:g,endAngle:m}=this.attributes;return{type:"annotationArc",style:ne({x:u.x,y:u.y,r:f,startAngle:g,endAngle:m},this.context.getCommonStyleConfig()),transform:l}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}class CL extends Eh{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationCircle"},l)),S(this,"shapeType","annotationCircle"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{position:u}=l,{r:f}=this.attributes;return{type:"annotationCircle",style:ne({x:u.x,y:u.y,r:f},this.context.getCommonStyleConfig()),transform:l}}}class Vd extends q9{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationEllipse"},l)),S(this,"shapeType","annotationEllipse"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{rx:u,ry:f}=this.parsedStyle,{position:g}=l;return{type:"annotationEllipse",style:ne({x:g.x-u.value,y:g.y-f.value,width:2*u.value,height:2*f.value},this.context.getCommonStyleConfig()),transform:l}}}class qte extends Nd{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationImage"},l)),S(this,"shapeType","annotationImage"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:l,y:u,img:f,opacity:g,visibility:m,width:v,height:y}=this.attributes;return{type:"annotationImage",style:{x:l,y:u,width:v,height:y,img:f,opacity:g,visibility:m},meteData:this.meteData,transform:this.context.getTransform()}}}class Ta extends Z9{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationInk"},l)),S(this,"shapeType","annotationInk"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l),this.update()}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}setUseDouglasPeucker(l){l?(this.boundsDirty=!0,this.pathDirty=!0,this.useDouglasPeucker=!0):this.useDouglasPeucker=!1}getAnnotationConfig(){let l=this.attributes.segments;const u=this.context.getTransform(),f=this.getBoundingRect(),{position:g}=u;return(g.x!==f.x||g.y!==f.y)&&(l=[],this.attributes.segments.forEach(m=>{const v=[];m.forEach(y=>{v.push({x:y.x-f.x+g.x,y:y.y-f.y+g.y,z:0})}),l.push(v)}),this.context.isGrouped||(this.style.segments=l)),{type:"annotationInk",style:ne({segments:l},this.context.getCommonStyleConfig()),transform:u}}}class q3 extends Gn{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationRect"},l)),S(this,"shapeType","annotationRect"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const l=this.context.getTransform(),{width:u,height:f}=this.attributes,{position:g}=l;return{type:"annotationRect",id:this.id,style:ne({x:g.x,y:g.y,width:u,height:f},this.context.getCommonStyleConfig()),transform:l}}getPath(){if(!this.pathDirty)return this.path;const{width:l,height:u,borderWidth:f}=this.parsedStyle,g=.5*((null==f?void 0:f.value)||0),y=l.value-2*g,x=u.value-2*g;return this.path=[{x:g,y:g},{x:g+y,y:g},{x:g+y,y:g+x},{x:g,y:g+x}],this.steps=sp(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class Zte extends p0{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(ne({type:"annotationText"},l)),S(this,"shapeType","annotationText"),S(this,"controls",void 0),S(this,"eventHandler",void 0),S(this,"context",void 0),S(this,"editMode",!1),S(this,"textCursor",void 0),S(this,"textArea",void 0),S(this,"startSelectText",!1),S(this,"selectRectArray",[]),S(this,"inputChinese",!1),S(this,"curIndex",0),S(this,"startIndex",0),S(this,"endIndex",0),S(this,"lastEndIndex",0),S(this,"renderHooks",void 0),this.init(l.transform,l.selectableStyle),u&&(this.renderHooks=u)}init(l,u){this.context=new vo(this,u),this.eventHandler=new mo(this),this.context.setTransform(l)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:l,y:u,color:f,text:g,wordWarp:m,textBaseLine:v,fontStyle:y,fontVariant:x,fontWeight:w,fontFamily:C,fontSize:_,lineHeight:T,textAlign:M}=this.attributes;return{type:"annotationText",style:ne({x:l,y:u,color:f,text:g,wordWarp:m,textBaseLine:v,fontStyle:y,fontVariant:x,fontWeight:w,fontFamily:C,fontSize:_,lineHeight:T,textAlign:M},this.context.getCommonStyleConfig()),transform:this.context.getTransform()}}startEditor(l,u){const f=qo(this,{x:l,y:u});if(l=f.x,u=f.y,this.textArea&&(document.body.removeChild(this.textArea),this.textArea=void 0),!this.getCharByPosition(l,u))return void this.closeEditor();const g=this.getCharByPosition(l,u),m=.9*g.height;let v=0,y=0;if(l<g.x+g.width/2?(this.curIndex=g.index-1,v=g.x-this.chars[0].x):(this.curIndex=g.index,v=g.x-this.chars[0].x+g.width),y=g.y-this.chars[0].y,!this.textCursor){const w=new R6({style:{startPoint:{x:0,y:0},endPoint:{x:0,y:m},borderWidth:this.parsedStyle.fontSize.value/50,borderColor:"black"}});this.appendChild(w),this.textCursor=w}this.textCursor.setLocalPosition(v,this.getRelativeYAxis(y)),this.openTextarea(l,u)}closeEditor(){this.textCursor&&this.removeChild(this.textCursor),this.textArea&&(this.textArea.removeEventListener("input",l=>this.textareaInput(l)),this.textArea.removeEventListener("compositionstart",l=>this.textareaCompositionstart(l)),this.textArea.removeEventListener("compositionend",l=>this.textareaCompositionend(l)),this.textArea.removeEventListener("keydown",l=>this.textareaKeydown(l)),document.body.removeChild(this.textArea)),this.clearTextSelection(),this.textCursor=void 0,this.textArea=void 0,this.curIndex=0,this.editMode=!1}textStartHandler(){0!==this.selectRectArray.length&&this.clearTextSelection(),this.editMode&&(this.startSelectText=!0,this.startIndex=this.curIndex,this.endIndex=this.curIndex)}textMoveHandler(l){if(!this.editMode||!this.startSelectText)return;const{x:u,y:f}=qo(this,l),g=this.getCharByPosition(u,f);if(this.endIndex=u<g.x+g.width/2?g.index-1:g.index,!g){const{lines:m,chars:v,parsedStyle:y}=this,{textBaseLine:x}=y,{height:w}=v[0],C=w/10;let _=0,T=f;switch(x){case"alphabetic":T=f+w-1.5*C;break;case"middle":T=f+w/2+C;break;case"ideographic":T=f+w+C;break;case"bottom":T=f+w+.5*C}for(let N=m.length;N>0;N--)if(T>m[N-1].y){_=N-1;break}const M=m[_].sum-m[_].length,L=m[_].sum-1;this.endIndex=M;for(let N=L;N>=M;N--)if(u>this.chars[N].x+this.chars[N].width/2){this.endIndex=N+1;break}}this.endIndex!==this.lastEndIndex&&(this.lastEndIndex=this.endIndex,this.endIndex!==this.startIndex?(this.textCursor&&(this.removeChild(this.textCursor),this.textCursor=void 0),this.createTextSelectionArea(this.startIndex,this.endIndex)):this.clearTextSelection())}textEndHandler(){if(this.editMode){if(this.startSelectText=!1,this.startIndex!==this.endIndex&&this.textArea){var l;const{startIndex:u,endIndex:f}=this,g=Math.min(u,f),m=Math.max(u,f);null===(l=this.textArea)||void 0===l||l.setSelectionRange(g,m)}this.startIndex=0,this.endIndex=0}}openTextarea(l,u){if(!this.context.isActive)return;const f=document.createElement("input");f.type="text",f.setAttribute("style","position:fixed; opacity:0; width:1; height:1; top:80%; left:80%; z-index:-999; word-break:break-all"),f.value=this.parsedStyle.text,document.body.appendChild(f);const g=this.curIndex;this.textArea=f,f.setSelectionRange(g,g),f.addEventListener("input",m=>this.textareaInput(m),!1),f.addEventListener("compositionstart",m=>this.textareaCompositionstart(m),!1),f.addEventListener("compositionend",m=>this.textareaCompositionend(m),!1),f.addEventListener("keydown",m=>this.textareaKeydown(m),!1),f.focus()}moveTextCursor(l,u){if(!this.textCursor)return;if(0===this.chars.length)return void this.destroy();const f=l+u-1;let g,m;f<-1||f===this.chars.length||(-1===f?(g=0,m=0):(g=this.chars[f].x-this.chars[0].x+this.chars[f].width,m=this.chars[f].y-this.chars[0].y),this.curIndex+=u,this.textCursor.setLocalPosition(g,this.getRelativeYAxis(m)))}updateTextCursor(l){if(!this.textCursor||l<0||l>this.chars.length)return;let u,f;0===l?(u=0,f=0):(u=this.chars[l-1].x-this.chars[0].x+this.chars[l-1].width,f=this.chars[l-1].y-this.chars[0].y),this.curIndex=l,this.textCursor.setLocalPosition(u,this.getRelativeYAxis(f)),setTimeout(()=>{this.textArea.setSelectionRange(this.curIndex,this.curIndex)},0)}createTextSelectionArea(l,u){this.clearTextSelection();const f=Math.min(l,u),g=Math.max(l,u),m=[[]];let v=this.chars[f].lineIndex;for(let x=f;x<g;x++)v!==this.chars[x].lineIndex&&(m.push([]),v=this.chars[x].lineIndex),m[m.length-1].push(this.chars[x]);const y=this.chars[0].height;for(let x=0;x<m.length;x++){const C=m[x][0],_=m[x][m[x].length-1],T=C.x-this.lines[C.lineIndex].x,L=_.x-this.lines[_.lineIndex].x-T+_.width,N=new Gn({style:{x:T,y:this.getRelativeYAxis(C.y-this.chars[0].y)-2,height:y,width:L,background:"rgba(85,160,255,0.6)",borderColor:"transparent"}});this.selectRectArray.push(N),this.renderSelectedRect()}}renderSelectedRect(){if(0!==this.selectRectArray.length)for(let l=0;l<this.selectRectArray.length;l++)this.appendChild(this.selectRectArray[l])}clearTextSelection(){if(0!==this.selectRectArray.length){for(let l=0;l<this.selectRectArray.length;l++)this.selectRectArray[l].destroy();this.selectRectArray=[]}}textareaInput(l){var u;if(this.inputChinese)return;const{length:f}=this.parsedStyle.text;this.style.text=this.textArea.value,""===this.textArea.value?(this.style.text=" ",this.textArea.value=" ",this.updateTextCursor(0)):this.moveTextCursor(this.curIndex,this.textArea.value.length-f),this.updateOrigin(),null===(u=this.renderHooks)||void 0===u||u.emit()}textareaCompositionstart(l){this.inputChinese=!0}textareaCompositionend(l){var u;const f=this.textArea.value.length-this.style.text.length;this.inputChinese=!1,this.style.text=this.textArea.value,this.moveTextCursor(this.curIndex,f),this.updateOrigin(),null===(u=this.renderHooks)||void 0===u||u.emit()}textareaKeydown(l){var u;if("ArrowLeft"===l.key&&this.moveTextCursor(this.curIndex,-1),"ArrowRight"===l.key&&this.moveTextCursor(this.curIndex,1),"ArrowUp"===l.key){if(0===this.curIndex)return;if(0===this.chars[this.curIndex-1].lineIndex)this.updateTextCursor(0);else{const{charIndex:f,lineIndex:g}=this.chars[this.curIndex-1];this.curIndex=f>this.lines[g-1].length?this.lines[g-1].sum:g-1==0?f:this.lines[g-2].sum+f,this.updateTextCursor(this.curIndex)}}if("ArrowDown"===l.key){if(this.curIndex===this.chars.length)return;if(0===this.curIndex)return void this.updateTextCursor(this.lines[0].length+1);if(this.chars[this.curIndex-1].lineIndex===this.lines.length-1)this.updateTextCursor(this.chars.length);else{const{charIndex:f,lineIndex:g}=this.chars[this.curIndex-1];this.curIndex=f>this.lines[g+1].length?this.lines[g+1].sum:this.lines[g].sum+f,this.updateTextCursor(this.curIndex)}}if("Backspace"===l.key){if(0===this.selectRectArray.length)return;this.clearTextSelection()}null===(u=this.renderHooks)||void 0===u||u.emit()}}class Jte{constructor(l){S(this,"shape",void 0),S(this,"textCursor",void 0),S(this,"textCursorInitCache",void 0),S(this,"inputComposition",!1),S(this,"startChar",void 0),S(this,"startDirection",void 0),S(this,"startPoint",void 0),S(this,"textRects",[]),S(this,"virtualChar",void 0),S(this,"isStart",!1),S(this,"canvas",void 0),S(this,"textClipboard",[]),S(this,"lineChars",void 0),S(this,"flatChars",void 0),S(this,"editMode",void 0),S(this,"textarea",void 0),S(this,"textSelection",[]),this.shape=l,this.calculateCharPosition()}getLineIndexByMoved(l){const{lines:u}=this.shape;let f=0;for(let g=0;g<u.length;g++){const{y:m,height:v}=u[g];l.y>m-.8*v&&(f=g)}return f}getLineIndexByPosition(l){const{lines:u,limitWidth:f}=this.shape;for(let g=0;g<u.length;g++){const m=u[g],{x:v,y,height:x}=m;if(new Gn({style:{x:v,y:y-.8*x,width:f,height:x*(g===u.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(l))return g}return-1}getCharByPosition(l,u){if(-1===u)return null;const{lineChars:f}=this,g=f[u];for(let m=0;m<g.length;m++){const v=g[m],{x:y,y:x,charWidth:w,charHeight:C}=v;if(new Gn({style:{x:y,y:x-.8*C,width:w,height:C*(v.lineIndex===f.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(l))return v}return null}getCharAndDirection(l){const u=this.getLineIndexByPosition(l);let f,g=1;if(-1===u)return f=this.flatChars[this.flatChars.length-1],g=1,{char:f,direction:g};const m="textBox"===this.shape.textType;if(f=this.getCharByPosition(l,u),f){const{x:v,charWidth:y}=f;g=l.x<v+y/2?0:1}else{const v=this.lineChars[u];f=v[v.length-1],g=1,m&&l.x<v[0].x&&(f=v[0],g=0)}return"\r"!==f.text&&"\n"!==f.text&&"\r\n"!==f.text||(g=0),0===g&&0!==f.indexInLine&&(f=this.lineChars[f.lineIndex][f.indexInLine-1],g=1),{char:f,direction:g}}createCursor(l,u,f,g){if(!this.textCursor){const m=document.createElement("div");return m.className="ddv-annotation-cursor",m.style.left=l-.5+"px",m.style.top=`${u}px`,m.style.transform=`rotate(${f}deg)`,m.style.width="1px",m.style.height=`${g}px`,this.canvas.parentNode.appendChild(m),void(this.textCursor=m)}this.textCursor.style.left=l-.5+"px",this.textCursor.style.top=`${u}px`,this.textCursor.style.height=`${g}px`,this.textCursor.style.transform=`rotate(${f}deg)`,this.textCursor.style.animation="none",this.textCursor.style.animation=""}showTextCursor(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=(_,T)=>{const{x:M,y:L,charWidth:N,charHeight:V,lineIndex:H}=_;return new Gn({style:{x:(T?M+N:M)-this.shape.style.x,y:L-.8*V-this.shape.style.y,borderWidth:"1px",height:V*(H>=this.lineChars.length-1?1:1.2)}})},m=_=>{this.shape.appendChild(_);const T=this.shape.getScale().y,M=_.getAngle();_.setAngle(0);const{x:L,y:N}=_.getPosition();_.destroy(),this.createCursor(L,N,M,_.parsedStyle.height.value*T)};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:v,shape:y}=this;if(!v.length&&this.virtualChar){const{fontSize:_}=this.shape.freeTextContentStyle,T=Dt(_).value;if(T!==this.virtualChar.charHeight){const{borderOffset:M,padding:L}=this.shape,{y:N}=this.shape.style;this.virtualChar.charHeight=T,this.virtualChar.y=N+M+L+.8*T}return m(g(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let x=v[l];if(Se(l)&&(x=v[0],u=0),!v[l])return;"justify"===y.style.textAlign&&"textBox"===y.textType&&" "===x.text&&u&&v[x.totalIndex+1]&&(x=v[x.totalIndex+1],u=0);const w=v[x.totalIndex+1];let C;lp(x.text)&&u&&w&&(x=w,u=0),C=lp(x.text)&&u&&!w?g(this.virtualChar,1):g(x,u),m(C),this.startChar=x,this.startDirection=u,this.textCursorInitCache={char:x,isBack:u},f&&this.shape.hooks.selectTextChars.emit({startChar:x,endChar:x,isBack:!!u,needUpdate:!1})}moveTextCursor(l){const{textSelection:u}=this;let f,g;if(2===u.length){const[w,C]=u;switch(l){case"up":case"left":f=w.totalIndex,g=0;break;default:f=C.totalIndex,g=1}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(f,g)}const m=this.flatChars,v=m.length,{startChar:y,startDirection:x}=this;if(y){if("left"===l){const w=x?y.totalIndex-1:y.totalIndex-2;f=w>=0?w:0,g=w>=0?1:0}else if("right"===l){const w=x?y.totalIndex+1:y.totalIndex;f=w>v-1?v-1:w,g=1}else{const{x:w,charWidth:C,lineIndex:_}=y;if(0===_&&"up"===l)f=0,g=0;else if(_===this.lineChars.length-1&&"down"===l)f=m.length-1,g=1;else{const T=x?w+C:w,M="up"===l?this.lineChars[_-1]:this.lineChars[_+1];f=M[0].totalIndex,g=0,M.forEach(L=>{T>L.x+C/2&&(f=L.totalIndex,g=1)})}}this.showTextCursor(f,g)}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null)}showTextSelection(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=[],{lines:m,parsedStyle:v,textType:y}=this.shape;if(this.hideTextSelection(),this.textSelection=[l,u],!l||!u)return;const x=["right","justify"].includes(v.textAlign)&&"textBox"===y;if(l.y===u.y){const _=lp(l.text),T=lp(u.text);if(_&&T)return;g.push({x:l.x,y:l.y,lineIndex:l.lineIndex,width:l.x===u.x?l.charWidth:T?u.x-l.x:u.x-l.x+u.charWidth,height:m[l.lineIndex].height})}else{const _=this.shape.getTextAlignOffset(m[l.lineIndex]),{x:T,height:M}=m[l.lineIndex];if(g.push({x:l.x,y:l.y,lineIndex:l.lineIndex,width:T+(x?m[l.lineIndex].widthWithoutLF:m[l.lineIndex].width)+_-l.x,height:M}),u.lineIndex-l.lineIndex>1)for(let q=l.lineIndex+1;q<u.lineIndex;q++){const{x:te,y:se,height:ae}=m[q],j=x?m[q].widthWithoutLF:m[q].width,le=this.shape.getTextAlignOffset(m[q]);g.push({x:te+le,y:se,width:j,height:ae,lineIndex:q})}const N=this.shape.getTextAlignOffset(m[u.lineIndex]),{x:V,y:H,height:G}=m[u.lineIndex],z=x&&lp(u.text)?0:u.charWidth;g.push({x:V+N,y:H,width:u.x+z-V-N,height:G,lineIndex:u.lineIndex})}const{x:w,y:C}=this.shape.style;this.hideTextCursor(),g.forEach(_=>{const M=new Gn({style:{x:_.x-w,y:_.y-C-.8*_.height,width:_.width,height:_.height*(_.lineIndex===this.lineChars.length-1?1:1.2),background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(M),this.textRects.push(M)}),this.shape.hooks.selectTextChars.emit({startChar:l,endChar:u,isBack:!0,needUpdate:f})}hideTextSelection(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach(u=>{u.destroy()}),this.textSelection=[],this.textRects=[],l){const{char:u,isBack:f}=this.textCursorInitCache;this.showTextCursor(u.totalIndex,f)}}addText(l,u,f){if(!f||""===f)return;if(!l){const M=Fe(ne({},this.shape.freeTextContentStyle),{content:f});return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[M]}),this.shape.hooks.textContentUpdated.emit(),void this.showTextCursor(f.length-1,1)}const g=qe(this.shape.style.textContents),{freeContentIndex:m,indexInFreeContent:v}=l,y=g[m],{content:x}=y,w=bL(this.shape.freeTextContentStyle,y),C=()=>Fe(ne({},this.shape.freeTextContentStyle),{content:f});if(u&&v===x.length-1)w?y.content+=f:g.splice(m+1,0,C());else if(u||v)if(w){const M=0===u?v:v+1;y.content=x.slice(0,M)+f+x.slice(M)}else{const M=[],L=x.slice(0,u?v+1:v),N=x.slice(u?v+1:v);L&&M.push(Fe(ne({},y),{content:L})),M.push(C()),N&&M.push(Fe(ne({},y),{content:N})),g.splice(m,1,...M)}else m?bL(this.shape.freeTextContentStyle,g[m-1])?g[m-1].content+=f:g.splice(m,0,C()):w?y.content=f+y.content:g.unshift(C());this.shape.updateStyle({textContents:[...g]}),this.shape.hooks.textContentUpdated.emit();const{char:_,isBack:T}=this.textCursorInitCache;this.showTextCursor(T?_.totalIndex+f.length:_.totalIndex+f.length-1,1)}deleteText(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u=qe(this.shape.style.textContents);if(!u.length)return;let f=0;if(2===this.textSelection.length){const[g,m]=this.textSelection;if(g.freeContentIndex===m.freeContentIndex){const v=u[g.freeContentIndex];v.content=vL(v.content,g.indexInFreeContent,m.indexInFreeContent)}else{const v=u[g.freeContentIndex],y=u[m.freeContentIndex];v.content=v.content.substring(0,g.indexInFreeContent),y.content=y.content.substring(m.indexInFreeContent+1);for(let x=g.freeContentIndex+1;x<m.freeContentIndex;x++)u[x].content=""}f=g.totalIndex-1}else{const{startChar:g,startDirection:m}=this;if(!g)return;const v=m?g:this.flatChars[g.totalIndex-1];if(!v)return;const{freeContentIndex:y,indexInFreeContent:x}=v,w=u[y];if(!w.color)return;w.content=vL(w.content,x,x),f=v.totalIndex-1}this.shape.updateStyle({textContents:[...u]}),l&&this.shape.hooks.textContentUpdated.emit(),this.hideTextSelection(),this.showTextCursor(f,1,!1),this.shape.hooks.reRenderText.emit()}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:l}=this.shape.style,[u,f]=this.textSelection,g=[],m=u.freeContentIndex,v=f.freeContentIndex;if(m===v){const y=l[m],x=y.content.slice(u.indexInFreeContent,f.indexInFreeContent+1);g.push(Fe(ne({},y),{content:x}))}else for(let y=m;y<=v;y++){const x=ne({},l[y]),w=x.content;y===m?x.content=w.slice(u.indexInFreeContent):y===v&&(x.content=w.slice(0,f.indexInFreeContent+1)),g.push(ne({},x))}this.textClipboard=[...g],function(y){let x="";y.forEach(w=>{x+=w.content});try{navigator.clipboard.writeText(x)}catch(w){}}(g)}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:l,char:u}=this.textCursorInitCache,{textContents:f}=this.shape.style,g=l?u:this.flatChars[u.totalIndex-1];let m=0,v=(null==g?void 0:g.totalIndex)||-1;if(this.textClipboard.forEach(y=>{m+=y.content.length}),g)if(this.flatChars.length){const y=f[u.freeContentIndex];if(y.content.length===g.indexInFreeContent+1)f.splice(u.freeContentIndex+1,0,...qe(this.textClipboard)),this.shape.updateStyle({textContents:[...f]});else{const{content:x}=y,{indexInFreeContent:w}=g,C=[Fe(ne({},y),{content:x.slice(0,w+1)}),...qe(this.textClipboard),Fe(ne({},y),{content:x.slice(w+1)})];f.splice(u.freeContentIndex,1,...C),this.shape.updateStyle({textContents:[...f]})}}else this.shape.updateStyle({textContents:qe(this.textClipboard)}),v=-1;else f.unshift(...qe(this.textClipboard)),this.shape.updateStyle({textContents:f});this.showTextCursor(v+m,1),this.shape.hooks.textContentUpdated.emit()}selectAllText(){this.flatChars.length&&(this.showTextSelection(this.flatChars[0],this.flatChars[this.flatChars.length-1]),this.shape.hooks.reRenderText.emit())}updateTextSelection(){if(!this.textSelection.length)return;const[l,u]=this.textSelection;this.showTextSelection(this.flatChars[l.totalIndex],this.flatChars[u.totalIndex],!0),this.shape.hooks.reRenderText.emit()}calculateCharPosition(){const{lines:l}=this.shape,u=[];let f=0,g=0,m=0,v=0;l.forEach((w,C)=>{const _=w.height,T=[],M=this.shape.getTextAlignOffset(w),L=(N,V,H,G,z)=>{T.push({text:N,x:V,y:H,charWidth:G,charHeight:_,freeContentIndex:z,lineIndex:C,indexInLine:g,indexInFreeContent:f,totalIndex:v})};g=0,w.words.forEach(N=>{const{wordWidth:V,freeContentIndex:H,x:G,text:z}=N;if(H!==m&&(f=0,m=H),1===N.text.length)L(z,G+M,w.y,V,H),v+=1,g+=1,f+=1;else{let q=N.x+M;for(let te=0;te<z.length;te++){const se=z.charAt(te),ae=Xo(se,N.style);L(se,q,w.y,ae,H),q+=ae,v+=1,f+=1,g+=1}N.text.length!==N.originText.length&&(f+=N.originText.length-N.text.length)}}),u.push(T)});const y=this.shape.getTextAlignOffset();if(this.flatChars=u.flat(),this.lineChars=u,this.virtualChar=null,!l.length){const{x:w,y:C,textAlign:_}=this.shape.parsedStyle,{borderOffset:T,padding:M}=this.shape,{fontSize:L}=this.shape.freeTextContentStyle,N=Dt(L).value;return void(this.virtualChar={x:"right"===_?w+M+y:w+T+M+y,y:C+T+M+.8*N,charWidth:1,charHeight:N,lineIndex:0})}const x=this.flatChars[this.flatChars.length-1];lp(x.text)&&(this.virtualChar={x:this.shape.lines[0].x+y,y:x.y+1.2*this.shape.lines[x.lineIndex].height,charWidth:1,charHeight:x.charHeight,lineIndex:x.lineIndex+1})}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:l,isBack:u}=this.textCursorInitCache;this.showTextCursor(l.totalIndex,u)}enableEditMode(l,u){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateContentLines(),this.shape.hooks.reRenderText.emit()),this.calculateCharPosition(),this.editMode=!0,this.canvas=u;let f=!1;if("textBox"===this.shape.textType){const{totalTextHeight:g}=this.shape,{height:m}=this.shape.parsedStyle;g!==m.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0)}if(this.flatChars.length){const g=qo(this.shape,l),m=this.getCharAndDirection(g),{char:v,direction:y}=m;this.startChar=v,this.startDirection=y,this.showTextCursor(v.totalIndex,y)}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(f=!0);this.shape.context.updateControlsFlags({useDefaultControls:f,enableMove:!1}),this.shape.hooks.enableTextEditMode.emit(),this.openTextarea(l)}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:l}=this.shape,{height:u}=this.shape.parsedStyle;l!==u.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit())}this.shape.hooks.disableTextEditMode.emit()}}editStartHandler(l){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const u=qo(this.shape,l),f=this.getCharAndDirection(u);this.hideTextSelection();const{char:g,direction:m}=f;this.showTextCursor(g.totalIndex,m),this.isStart=!0,this.startChar=g,this.startDirection=m,this.startPoint=u,this.shape.hooks.reRenderText.emit()}editMoveHandler(l){if(!this.editMode||!this.isStart)return;const{lineChars:u}=this,f=qo(this.shape,l),g=this.getLineIndexByMoved(f);let{startChar:m,startDirection:v}=this,y=null;const x=u[g],w=g===this.startChar.lineIndex?f.x>this.startPoint.x:f.y>this.startPoint.y,{lineIndex:C,indexInLine:_}=this.startChar;if(!this.startDirection&&!w){if(0===m.totalIndex)return void this.hideTextSelection(!0);const V=m.lineIndex===u.length-1;if(V&&f.y<this.startPoint.y)m=this.flatChars[m.totalIndex-1],v=1;else if(V)return void this.hideTextSelection(!0)}if(w&&v&&(m=u[C][_+1],v=0,!m))return void this.hideTextSelection(!0);if(w&&f.x<x[0].x+x[0].charWidth/2&&m.lineIndex!==g){const V=u[g-1];return y=V[V.length-1],void this.showTextSelection(m,y)}if(w)x.forEach((V,H)=>{const{x:G,charWidth:z}=V;f.x>G+z/2&&(y=x[H])});else for(let V=x.length-1;V>=0;V--){const{x:H,charWidth:G}=x[V];H+G/2>f.x&&(y=x[V])}if(!y)return void this.hideTextSelection(!0);const{lineIndex:T,indexInLine:M}=m,{lineIndex:L,indexInLine:N}=y;w&&T===L&&M===N+1||!w&&T===L&&M===N-1?this.hideTextSelection(!0):w?this.showTextSelection(m,y):this.showTextSelection(y,m)}editEndHandler(){this.isStart=!1}editClickHandler(l,u){this.editMode&&(this.canvas=u,this.openTextarea(l))}openTextarea(l){if(this.editMode){if(!this.textarea){const u=document.createElement("textarea");u.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(u),this.textarea=u,u.addEventListener("input",f=>{this.inputComposition||this.textareaInput(f)},!1),u.addEventListener("compositionstart",f=>this.textareaCompositionstart(f),!1),u.addEventListener("compositionend",f=>{this.inputComposition=!1,this.textareaInput(f)},!1),u.addEventListener("keydown",f=>this.textareaKeydown(f),!1)}if(l){const{x:u,y:f}=l;this.textarea.style.left=`${u}px`,this.textarea.style.top=`${f}px`}this.textarea.value="",this.textarea.focus()}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null)}textareaInput(l){const u=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:f,isBack:g}=this.textCursorInitCache;this.addText(f,g,u)}else this.addText(void 0,void 0,u);this.textarea.value=""}textareaCompositionstart(l){this.inputComposition=!0}textareaKeydown(l){if(this.inputComposition||"Backspace"!==l.key||8!==l.keyCode)switch(l.ctrlKey&&"C"===l.key.toLocaleUpperCase()&&this.copyText(),l.ctrlKey&&"X"===l.key.toLocaleUpperCase()&&(this.copyText(),this.textSelection.length&&this.deleteText()),l.ctrlKey&&"V"===l.key.toLocaleUpperCase()&&this.textClipboard.length&&(l.preventDefault(),this.pasteText()),l.ctrlKey&&"Z"===l.key.toLocaleUpperCase()&&l.stopPropagation(),l.ctrlKey&&"A"===l.key.toLocaleUpperCase()&&this.selectAllText(),l.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down")}else this.deleteText()}}function bL(p,l){return p.color===l.color&&p.fontFamily===l.fontFamily&&p.fontSize===l.fontSize&&p.fontStyle===l.fontStyle&&p.fontWeight===l.fontWeight&&p.lineThrough===l.lineThrough&&p.underline===l.underline}class vi extends tL{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xL,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:l.id,style:ne({freeTextType:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox"},l.style)}),S(this,"lastSelectedEndChar",void 0),S(this,"lastIsBack",void 0),S(this,"shapeType","annotationFreeText"),S(this,"textEditEventHandler",void 0),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),S(this,"freeTextContentStyle",void 0),S(this,"inputModeTimer",void 0),S(this,"hooks",{reRenderText:gc(),selectTextChars:gc(),textContentUpdated:gc(),enableTextEditMode:gc(),disableTextEditMode:gc()}),this.freeTextContentStyle=f,this.init(l.transform,l.selectableStyle,g),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on(m=>{const v=m.endChar;if(this.isSameChar(v,this.lastSelectedEndChar)&&m.isBack===this.lastIsBack&&!m.needUpdate)return;let y=v.freeContentIndex;v.indexInFreeContent||!v.freeContentIndex||m.isBack||(y-=1);const x=this.style.textContents[y];this.lastSelectedEndChar=v,this.lastIsBack=m.isBack,this.freeTextContentStyle=Fe(ne({},x),{content:this.freeTextContentStyle.content})})}get isEditMode(){var l;return null===(l=this.textEditEventHandler)||void 0===l?void 0:l.editMode}get hasSelectedChars(){var l;return(null===(l=this.textEditEventHandler)||void 0===l?void 0:l.textSelection.length)>0}init(l,u,f){if("freeTextWriter"===this.textType&&f&&super.updateOrigin(),this.context=new vo(this,u),this.textEditEventHandler=new Jte(this),this.eventHandler=new mo(this),this.context.setTransform(l),"freeTextWriter"===this.textType&&f){const{x:g,y:m}=this.getPosition();this.updateOrigin(),this.setPosition({x:g,y:m})}}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin()}getAnnotationConfig(){const l="textBox"===this.textType?"annotationTextBox":"annotationFreeText",u=this.context.getTransform(),{position:f}=u,{width:g,height:m,textContents:v}=this.attributes,y={type:l,style:Fe(ne({x:f.x,y:f.y,textContents:qe(v),textAlign:this.style.textAlign},this.context.getCommonStyleConfig()),{width:g}),transform:u};return"textBox"===this.textType&&(y.style.height=m),y}calculateTotalHeight(){var l,u;const f=Dt((null===(l=this.freeTextContentStyle)||void 0===l?void 0:l.fontSize)||16);if(null!==(u=this.lines)&&void 0!==u&&u.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=f.value+2*this.borderOffset;else{const{height:g}=this.parsedStyle;this.totalTextHeight=g.value>f.value+2*this.borderOffset?g.value:f.value+2*this.borderOffset+2*this.padding}}getBoundingRect(){var l;if(!this.boundsDirty)return this.bounds;const{x:u,y:f}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(l=this.lines)||void 0===l||!l.length)){var g;const m=Dt((null===(g=this.freeTextContentStyle)||void 0===g?void 0:g.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:u,y:f,width:Xo("  ",Fe(ne({},this.freeTextContentStyle),{fontSize:m})),height:m.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight),this.bounds}updateFreeTextContentStyle(l){this.freeTextContentStyle=l,this.textEditEventHandler.updateCursor();const{flatChars:u}=this.textEditEventHandler;this.isEditMode&&!u.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit())}focusTexture(){const l=gi();this.isEditMode&&this.textEditEventHandler.textarea&&(l||this.textEditEventHandler.textarea.focus())}updateCursor(){this.textEditEventHandler.updateCursor()}isSameChar(l,u){return!(!l||!u)&&l.charHeight===u.charHeight&&l.charWidth===u.charWidth&&l.freeContentIndex===u.freeContentIndex&&l.indexInFreeContent===u.indexInFreeContent&&l.indexInLine===u.indexInLine&&l.text===u.text&&l.totalIndex===u.totalIndex}}class xc extends Gn{constructor(l){super({id:l,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),S(this,"shapeType","annotationGroup"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),S(this,"parent",void 0),S(this,"parentPosition",void 0),S(this,"shapes",[]),S(this,"clickedShape",null),S(this,"state",!1),S(this,"groupMode",0),this.context=new vo(this),this.eventHandler=new mo(this),this.eventHandler.isHit=this.isHit.bind(this),this.context.updateControlsFlags(this.groupMode?{enableEdit:!1}:{useDefaultControls:!1})}isHit(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:f,parsedStyle:g}=this;let{controls:m}=this;if(!this.state||"hidden"===g.visibility||!f.controlsFlags.enableControl)return this.clickedShape=null,-1;m||(f.initControls(),f.renderControls(),m=this.controls);let v=-1;if(this.groupMode)v=m.checkHitArea(l.x,l.y);else for(let y=0;y<this.shapes.length;y++)if(this.shapes[y].controls||(this.shapes[y].context.initControls(),this.shapes[y].context.renderControls()),this.shapes[y].controls.checkHitArea(l.x,l.y)>=0){this.clickedShape=this.shapes[y],v=9;break}return v<0&&u?(this.clickedShape=null,f.unHitShape(),this.context.destroyControls(),-1):v}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach(l=>{l instanceof vi&&l.isEditMode&&l.textEditEventHandler.disableEditMode(),this.appendChild(l),l.context.isGrouped=!0}),this.update(),this.context.initControls()}add(l){if(!this.parent){const u=l.parentNode;this.parent=u,this.parentPosition=u.getPosition()}if("hidden"!==l.parsedStyle.visibility&&-1===this.shapes.indexOf(l)){if(l.context.isInGroup=!0,this.shapes.push(l),this.state){const u=[];this.shapes.forEach(f=>{u.push(f.getWorldTransform().clone())}),l instanceof vi&&l.isEditMode&&l.textEditEventHandler.disableEditMode(),l.context.isGrouped=!0,this.appendChild(l),this.groupMode||this.showAllControls(l),this.shapes.forEach((f,g)=>{const m=this.getWorldTransform().inverse().multiply(u[g]);f.setLocalTransform(m)}),this.update()}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init())}}update(){const l=[],u=[],f=[];for(let C=0;C<this.shapes.length;C++){const _=this.shapes[C];let{controls:T}=_;T||(_.context.initControls(),T=_.controls),_.context.renderControls(),this.groupMode&&_.context.unHitShape();const M=T.controlPoints.slice(0,4);for(let L=0;L<4;L++){const{x:N,y:V}=M[L].getCenterPosition();l.push(N),u.push(V)}f.push(this.shapes[C].getWorldTransform().clone())}const g=Math.max(...l),m=Math.min(...l),v=Math.max(...u),y=Math.min(...u);this.updateStyle({x:0,y:0,width:g-m,height:v-y}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1,1);const{x,y:w}=this.getScale();this.scale(1/Math.abs(x),1/Math.abs(w)),this.setPosition({x:m,y}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach((C,_)=>{const T=this.getWorldTransform().inverse().multiply(f[_]);C.setLocalTransform(T)})}delete(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent||-1===this.shapes.indexOf(l))return;const f=l.getWorldTransform().clone();this.parent.appendChild(l);const g=this.parent.getWorldTransform().inverse().multiply(f);l.setLocalTransform(g),l.context.isInGroup=!1,l.context.isGrouped=!1,l.context.isActive=!1,l.context.destroyControls(),"freeTextWriter"!==(null==l?void 0:l.textType)&&l.context.updateControlsFlags({enableRotate:!0}),Dh(l)&&l.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(l),1),u&&this.update(),0===this.shapes.length&&this.clear()}clear(){const{length:l}=this.shapes;for(let u=l-1;u>=0;u--)this.delete(this.shapes[u],!1);this.context.destroyControls(),this.reset()}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden"}destroy(){const{length:l}=this.shapes;for(let u=l-1;u>=0;u--)this.shapes[u].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0})}showAllControls(l){if(!this.state||this.groupMode)return;const u=f=>{Dh(f)&&f.pointEventsHandler.enableEditMode(),f.controls||f.context.initControls(),f.context.updateControlsFlags({enableRotate:!1}),f.context.isActive=!0,f.context.renderControls()};l?u(l):this.shapes.forEach(f=>{u(f)})}getAnnotationConfig(){return{type:"annotationGroup"}}}class Qte extends Gn{constructor(l){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),S(this,"shapeType","annotationLineControls"),S(this,"container",void 0),this.container=l}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&yL(null==this?void 0:this.container)}}class j6{constructor(l){S(this,"shape",void 0),S(this,"editMode",void 0),S(this,"hitIndex",-1),S(this,"hitPointPos",void 0),S(this,"startPoint",void 0),S(this,"controlsBox",void 0),S(this,"controlsPoints",[]),this.shape=l}getLineShapePoints(){const{shape:l}=this,{shapeType:u}=l;if("annotationLine"===u){const{startPoint:g,endPoint:m}=l.style;return[g,m]}const{points:f}=this.shape.parsedStyle;return f.slice(0,f.length)}initLineControls(){const{shape:l}=this;l.updatePoints();const{x:u,y:f}=this.shape.getScale(),{ctrlBorderColor:g,ctrlBorderWidth:m,ctrlLineDash:v,borderColor:y,borderWidth:x,lineDash:w,ctrlBorderRadius:C,ctrlWidth:_,ctrlHeight:T,background:M,ctrlBackground:L}=l.context.parsedControlsStyle,N={background:L,borderColor:g,borderWidth:m,lineDash:v},V=this.shape.getBoundingRect(),H=this.getLineShapePoints();this.controlsBox=new Qte(this.shape,{style:{width:V.width*u,height:V.height*f,borderColor:y,borderWidth:x,background:M,lineDash:w}}),H.forEach(G=>{const z=new M6({style:ne({width:_,height:T,roundedRadius:C},N)}),q=(G.x-V.x)*u-Dt(_).value/2,te=(G.y-V.y)*f-Dt(T).value/2;z.setLocalPosition(q,te),this.controlsPoints.push(z),this.controlsBox.appendChild(z)}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox)}isHitPoint(l){if(!this.editMode)return-1;for(let u=0;u<this.controlsPoints.length;u++){const f=qo(this.controlsPoints[u],l);if(this.controlsPoints[u].isPointInPath(f))return u}return-1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length||!this.editMode)return;const{ctrlWidth:l,ctrlHeight:u}=this.shape.context.parsedControlsStyle,{x:f,y:g}=this.shape.getScale(),m=this.shape.getBoundingRect(),v=this.getLineShapePoints();this.controlsPoints.length!==v.length&&(this.destroyLineControls(),this.initLineControls()),v.forEach((y,x)=>{this.controlsPoints[x].setLocalPosition((y.x-m.x)*f-l/2,(y.y-m.y)*g-u/2)}),this.controlsBox.updateStyle({width:m.width*f,height:m.height*g}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height)}destroyLineControls(){var l;null===(l=this.controlsBox)||void 0===l||l.destroy(),this.controlsPoints.forEach(u=>{u.destroy(),u=null}),this.controlsBox=null,this.controlsPoints=[]}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount||this.controlsPoints.length>0)return;const{shape:l}=this;this.editMode||this.initLineControls(),this.editMode=!0,l.context.isHit=!0,l.controls&&(l.context.lastControlsWidth=l.controls.getLength().width,l.context.lastControlsHeight=l.controls.getLength().height)}disableEditMode(){this.destroyLineControls(),this.editMode=!1}editStartHandler(l){if(!this.editMode)return;this.hitIndex=-1;const u=this.isHitPoint(l);-1!==u&&(this.hitIndex=u,this.hitPointPos=ne({},this.shape.path[this.hitIndex])),this.startPoint=l,this.shape.context.lastLocalTransform=this.shape.getLocalTransform()}editMoveHandler(l){if(!this.editMode||-1===this.hitIndex)return;const{shape:u}=this,f="annotationLine"===u.shapeType,g=f?[...u.path]:[...u.parsedStyle.points],m=qo(u,l);g[this.hitIndex]=m,f?u.updateStyle({startPoint:{x:g[0].x,y:g[0].y},endPoint:{x:g[1].x,y:g[1].y}}):u.style.points=g,this.updateLineControls()}editEndHandler(){this.editMode&&this.shape.updatePoints()}}class y0 extends $3{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationPolygon"},l)),S(this,"shapeType","annotationPolygon"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),S(this,"pointEventsHandler",void 0),S(this,"pointerLimitCount",200),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.pointEventsHandler=new j6(this),this.eventHandler=new mo(this),this.context.setTransform(l),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{position:f}=l;let m=this.attributes.points;return(f.x!==u.x||f.y!==u.y)&&(m=[],this.attributes.points.forEach(v=>{m.push({x:v.x-u.x+f.x,y:v.y-u.y+f.y})})),{type:"annotationPolygon",style:ne({points:m},this.context.getCommonStyleConfig()),transform:l}}}class x0 extends P6{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationPolyline"},l)),S(this,"shapeType","annotationPolyline"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),S(this,"pointEventsHandler",void 0),S(this,"pointerLimitCount",200),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.pointEventsHandler=new j6(this),this.eventHandler=new mo(this),this.context.setTransform(l),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{position:f}=l;let m=this.attributes.points;return(f.x!==u.x||f.y!==u.y)&&(m=[],this.attributes.points.forEach(v=>{m.push({x:v.x-u.x+f.x,y:v.y-u.y+f.y})})),{type:"annotationPolyline",style:ne({points:m,lineEnding:this.attributes.lineEnding},this.context.getCommonStyleConfig()),transform:l}}}class w0 extends R6{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(ne({type:"annotationLine"},l)),S(this,"shapeType","annotationLine"),S(this,"eventHandler",void 0),S(this,"controls",void 0),S(this,"context",void 0),S(this,"pointEventsHandler",void 0),this.init(l.transform,l.selectableStyle)}init(l,u){this.context=new vo(this,u),this.pointEventsHandler=new j6(this),this.eventHandler=new mo(this),this.context.setTransform(l),this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const l=this.context.getTransform(),u=this.getBoundingRect(),{startPoint:f,endPoint:g,lineEnding:m}=this.attributes,{position:v}=l,y=v.x!==u.x||v.y!==u.y;return{type:"annotationLine",style:ne({startPoint:y?{x:f.x-u.x+v.x,y:f.y-u.y+v.y}:f,endPoint:y?{x:g.x-u.x+v.x,y:g.y-u.y+v.y}:g,lineEnding:m},this.context.getCommonStyleConfig()),transform:l}}}const Kte=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],eie=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],tie=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],iie=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],nie=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],sie=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],rie=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],oie=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],aie=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],lie=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],cie=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],hie=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class yo extends Ate{constructor(l){var u;super(Fe(ne({type:"annotationStamp"},l),{style:Fe(ne({},l.style),{stampConfig:(null==l||null===(u=l.style)||void 0===u?void 0:u.stampConfig)||_L(null==l?void 0:l.style.iconName)})})),S(this,"shapeType","annotationStamp"),S(this,"stampType","base"),S(this,"controls",void 0),S(this,"eventHandler",void 0),S(this,"context",void 0),S(this,"shapes",[]),S(this,"initialRect",void 0),S(this,"iconName",void 0),S(this,"imageLoadedByDraw",!1),S(this,"initByDraw",!1),S(this,"hooks",{reRenderImage:gc()}),this.initByDraw=(null==l?void 0:l.initByDraw)||!1,this.initStamp(),this.init(l.transform,l.selectableStyle),this.initSize(l.style,l.transform)}init(l,u){this.eventHandler=new mo(this),this.context=new vo(this,u),this.context.setTransform(l),this.initialRect=this.getBoundingRect()}initStamp(){const{imageData:l,width:u,height:f}=this.style;if(this.stampItemShapes.forEach(g=>{g.destroy()}),this.stampItemShapes=[],l){let g;this.renderType="image",this.imageLoadedByDraw=!1,g=l instanceof Blob?URL.createObjectURL(l):l;const m=new Image;m.src=g,this.style.img=m,m.onload=()=>{if(this.initByDraw||!Ve(u)||!Ve(f)){const{width:v,height:y}=m;let x=v,w=y;if(v>400||y>400){const C=Math.max(v/400,y/400);x/=C,w/=C}this.updateStyle({width:x,height:w}),this.setLocalScale(1,1,1),this.initialWidth=x,this.initialHeight=w,this.initByDraw=!1,this.imageLoadedByDraw=!0}this.hooks.reRenderImage.emit()}}else this.initByDraw=!1,super.initStamp()}initSize(l,u){if("image"===this.renderType){const{x,y:w}=this.getLocalScale();1===x&&1===w||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value)}const f={},g=this.getAnnotationConfig(),{x:m,y:v}=(null==u?void 0:u.scale)||{x:1,y:1};var y;Ve(null==l?void 0:l.x)&&(null==l?void 0:l.x)!==g.style.x&&(f.x=l.x),Ve(null==l?void 0:l.y)&&(null==l?void 0:l.y)!==g.style.y&&(f.y=l.y),Ve(null==l?void 0:l.width)&&l.width*m!==g.style.width&&(f.width=l.width),Ve(null==l?void 0:l.height)&&l.height*v!==g.style.height&&(f.height=l.height),y=f,(0!==Object.keys(y).length||y.constructor!==Object)&&this.updateStampStyle(f)}update(){this.updateOrigin(),this.context.updateControls()}updateSize(l,u){const{x:f,y:g}=this.getLocalScale(),{x:m,y:v}=this.getPosition();if("image"===this.renderType){const{x:_,y:T}=this.getLocalPosition(),M=this.getAngle(),L=l*f,N=u*g;this.setAngle(0),this.setLocalScale(1,1,1),this.updateStyle({width:L,height:N});const V=_+(l-L)/2,H=T+(u-N)/2;return this.initialWidth=L,this.initialHeight=N,this.setLocalPosition({x:V,y:H}),void this.setAngle(M)}const{width:y,height:x}=this.parsedStyle;this.setLocalScale((l||y.value*f)/y.value,(u||x.value*g)/x.value),this.setPosition({x:m,y:v})}updateStampStyle(l){const{x:u,y:f}=this.getLocalPosition(),{x:g,y:m}=this.getLocalScale(),{width:v,height:y}=this.parsedStyle,{width:x,height:w}=l,{imageData:C,iconName:_}=this.style;let T=u,M=f;C||Se(null==l?void 0:l.imageData)||this.setLocalScale(1),null!=l&&l.imageData&&l.imageData!==C?(this.style.imageData=l.imageData,this.initStamp()):null!=l&&l.iconName&&l.iconName!==_&&(this.style.imageData=null,this.style.iconName=l.iconName,this.stampConfig=_L(l.iconName),this.initStamp()),Ve(null==l?void 0:l.opacity)&&(null==l?void 0:l.opacity)!==this.style.opacity&&(this.style.opacity=l.opacity),this.updateSize(Ve(x)?x:v.value*g,Ve(w)?w:y.value*m);const{x:L,y:N}=this.getLocalScale();Ve(null==l?void 0:l.x)&&(T=l.x-(this.initialWidth-this.initialWidth*L)/2),Ve(null==l?void 0:l.y)&&(M=l.y-(this.initialHeight-this.initialHeight*N)/2),this.setLocalPosition(T,M)}getAnnotationConfig(){const l=this.context.getTransform(),{x:u,y:f}=this.style,g=qe(l);if(g.position.x===u&&g.position.y===f&&1===g.scale.x&&1===g.scale.y&&(delete g.position,delete g.scale),this.style.imageData)return{type:"annotationStamp",style:{x:l.position.x,y:l.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:ne({},g)};const{initialWidth:m,initialHeight:v}=this,y=m*l.scale.x,x=v*l.scale.y;return{type:"annotationStamp",style:{x:l.position.x+(m-y)/2,y:l.position.y+(v-x)/2,width:y,height:x,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:ne({},g)}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}function _L(p){return[aie,Kte,eie,oie,tie,nie,sie,cie,iie,rie,lie,hie][[Zt.REJECTED,Zt.ACCEPTED,Zt.APPROVED,Zt.NOT_APPROVED,Zt.COMPLETED,Zt.DRAFT,Zt.FINAL,Zt.VOID,Zt.CONFIDENTIAL,Zt.INITIAL_HERE,Zt.SIGN_HERE,Zt.WITNESS].indexOf(p)]}var Da;!function(p){p.HIGHLIGHT="highlight",p.UNDERLINE="underline",p.STRIKEOUT="strikeout"}(Da||(Da={}));class fl extends yo{constructor(l,u){super(ne({},l)),S(this,"stampType","textAssist"),S(this,"textAssistType",void 0),S(this,"annotationRaw",void 0),this.textAssistType=u,this.annotationRaw=l.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const l=super.getAnnotationConfig();return this.annotationRaw&&(l.style.annotationRaw=this.annotationRaw),l}}class H6 extends yo{constructor(l){super(ne({},l)),S(this,"stampType","raw"),S(this,"annotationRaw",void 0),this.annotationRaw=l.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const l=super.getAnnotationConfig();return this.annotationRaw&&(l.style.annotationRaw=this.annotationRaw),l}}function die(p,l,u){var f;(u instanceof CL||u instanceof Vd||u instanceof wL)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function uie(p,l,u){p!==l&&u.childNodes.length>0&&u.childNodes.forEach(f=>{f&&f.style&&(f.style.opacity=l)})}function fie(p,l,u){var f;(u instanceof Ta||u instanceof y0||u instanceof x0)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function pie(p,l,u){if(!(u instanceof y0||u instanceof x0||u instanceof w0||u instanceof Ta)||p===l)return;const{x:f,y:g}=u.getBoundingRect();u.updatePosition(f,g),u.updateOrigin()}function gie(p,l,u){var f;(u instanceof q3||u instanceof vi)&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function SL(p,l,u){var f;u instanceof Zte&&p!==l&&(null===(f=u.context)||void 0===f||f.updateControls())}function mie(p,l,u){var f;u instanceof w0&&p!==l&&(null==u||null===(f=u.context)||void 0===f||f.updateControls())}function vie(p,l,u){u instanceof vi&&p!==l&&(u.textEditEventHandler.calculateCharPosition(),u.updateCursor(),u.hooks.reRenderText.emit())}function yie(p,l,u){u instanceof vi&&p!==l&&(u.textEditEventHandler.calculateCharPosition(),u.textEditEventHandler.updateTextSelection(),u.hooks.reRenderText.emit())}const xie={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class wie{constructor(l){S(this,"eraser",void 0),S(this,"eraserPath",void 0),S(this,"erasedShapeIds",[]),S(this,"selectionBox",void 0),S(this,"startCanvasPoint",void 0),S(this,"startLocalPoint",void 0),S(this,"lastMovePoint",void 0),S(this,"resetActivatedZIndex",!0),S(this,"isSeparateText",!1),S(this,"lastClickPointerType",""),S(this,"drawType","annotationRect"),S(this,"isStartEdit",!1),S(this,"isStartDraw",!1),S(this,"controller",void 0),S(this,"eventArea",void 0),S(this,"eventMode","none"),S(this,"defaultGroup",void 0),S(this,"activatedShape",void 0),S(this,"activatedZIndex",0),S(this,"drawLineShape",!1),S(this,"stampPreview",void 0),S(this,"inkDelayTimeout",void 0),S(this,"drawInkShape",!1),this.controller=l,this.defaultGroup=new xc("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5}isDefaultGroup(l){return l===this.defaultGroup}getDrawInitStyle(l,u){var f,g;let m={};const{defaultStyleConfig:v,eraserStyle:y,selectionStyle:x}=this.controller.interactiveConfig,w={x:u.x,y:u.y};switch(l){case"annotationInk":m={lineCap:"round",lineJoin:"round",segments:[[u]]};break;case"annotationPolygon":case"annotationPolyline":m={points:[u]};break;case"annotationLine":m={startPoint:u,endPoint:u};break;case"annotationFreeText":m=Fe(ne({},w),{textContents:[ne(ne({},ci.textContent),null==v||null===(f=v.textTypewriter)||void 0===f?void 0:f.textContent)]});break;case"annotationTextBox":m=Fe(ne({},w),{textContents:[ne(ne({},ci.textContent),null==v||null===(g=v.textBox)||void 0===g?void 0:g.textContent)]});break;default:m=w}let C=ne(ne({},ci),v[xie[l]]||{});return"select"===this.eventMode?C=Fe(ne({},x),{zIndex:999}):"erase"===this.eventMode&&(C=y),ne(ne({},C),m)}getDrawUpdateStyle(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=(this.startLocalPoint.x+u.x)/2,m=(this.startLocalPoint.y+u.y)/2,v=u.x-this.startLocalPoint.x,y=u.y-this.startLocalPoint.y;const x=["annotationCircle","annotationEllipse"].includes(l),w=Math.min(Math.abs(v),Math.abs(y));f&&(v=u.x>=this.startLocalPoint.x?w:-w,y=u.y>=this.startLocalPoint.y?w:-w,x&&(g=(2*this.startLocalPoint.x+v)/2,m=(2*this.startLocalPoint.y+y)/2));let C={};switch(l){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":C={x:g,y:m,r:w};break;case"annotationEllipse":C={x:g,y:m,rx:Math.abs(v)/2,ry:Math.abs(y)/2};break;case"annotationLine":C={endPoint:u};break;default:C={width:v,height:y}}return C}limitPoint(l,u,f){if(!this.eventArea)return;const{x:g,y:m,width:v,height:y}=this.eventArea;let x=0,w=0,C=0;if(u){const{lastHitControlPoint:_,lastHitControlPointCenter:T}=this.activatedShape.context;_&&T&&(w=_.x-T.x,C=_.y-T.y)}else x=m0(f)?f.parsedStyle.borderWidth.value:0;l.x<g+x+w&&(l.x=g+x+w),l.y<m+x+C&&(l.y=m+x+C),l.x>g+v+w&&(l.x=g+v+w),l.y>m+y+C&&(l.y=m+y+C)}executeErase(){var l;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(l=this.eraserPath)||void 0===l?void 0:l.id],!1),this.eraser=null,this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[])}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:l,containerId:u}=this.controller,f=[],g=l.get(u),{width:m,height:v}=this.selectionBox.parsedStyle;if(m.value<2&&v.value<2){const y=[];g.forEach(x=>{if("hidden"===x.style.visibility||!x.context.controlsFlags.enableControl||x===this.selectionBox||"annotationGroup"===x.shapeType)return;const w=qo(x,this.startCanvasPoint);!x.context.isGrouped&&x.isPointInPath(w,this.getHitBorderOffset(x))&&y.push(x)}),y.length&&(y.sort((x,w)=>x.style.zIndex-w.style.zIndex),f.push(y[y.length-1]))}else g.forEach(y=>{"annotationGroup"!==y.shapeType&&"visible"===y.style.visibility&&y.context.controlsFlags.enableControl&&y!==this.selectionBox&&function(x,w){w.controls||w.context.initControls(),w.context.renderControls();const C=w.controls.controlPoints.slice(0,4);for(let q=0;q<4;q++){const te=qo(x,C[q].getPosition());if(x.isPointInPath(te))return!0}const _=[],{x:T,y:M}=x.getPosition(),{width:L,height:N}=x.parsedStyle,V=Math.abs(x.getScale().x),H=Math.abs(x.getScale().y);_.push({x:T,y:M},{x:T+L.value*V,y:M},{x:T+L.value*V,y:M+N.value*H},{x:T,y:M+N.value*H});const G=w.getBoundingRectObject();G.setLocalTransform(w.getLocalTransform()),w.parentNode.appendChild(G);const z=G.getWorldTransform().inverse();for(let q=0;q<4;q++){const te=z.transformPoint(_[q]);if(te.x+=G.parsedStyle.x,te.y+=G.parsedStyle.y,G.isPointInPath(te))return G.destroy(),!0}return G.destroy(),w.context.destroyControls(),!1}(this.selectionBox,y)&&f.push(y)});1===f.length?this.selectShapes([f[0]]):f.length>1?this.selectShapes(f):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender()}activateShape(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!l||"hidden"===l.style.visibility||!l.context.controlsFlags.enableControl||this.activatedShape===l&&l.context.isActive)return;const{showOnTopWhenSelected:g}=this.controller.interactiveConfig;var m;this.activatedShape&&this.activatedShape!==l&&(u?(g&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(m=this.activatedShape)||void 0===m?void 0:m.parentNode)===(null==l?void 0:l.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape()),this.activatedShape=l,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),g&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||l.context.initControls(),l.context.renderControls(),Dh(l)&&l.pointEventsHandler.enableEditMode(),this.isDefaultGroup(l)&&l.showAllControls(),u||this.controller.hooks.emitSelectAnnotation(l),f&&this.controller.hooks.emitAnnotationRender()}inactivateShape(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:f}=this.controller.interactiveConfig;if(f&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof Ta&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof vi&&"freeTextWriter"===this.activatedShape.textType){const{textContents:g}=this.activatedShape.style;let m="";g.forEach(v=>{m+=(null==v?void 0:v.content)||""}),0===m.length&&this.controller.deleteShape([this.activatedShape.id],!0)}this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),l&&this.controller.hooks.emitSelectAnnotation(null,u)}setEventArea(l){this.eventArea=l,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea)}setEventMode(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof Ta&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const f=[...this.activatedShape.style.points];gi()||f.pop(),this.activatedShape.style.points=f}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=l,this.drawType=u,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==l&&(this.inactivateShape(!0),"erase"===l&&(this.drawType="annotationInk"),"select"===l&&(this.drawType="annotationRect"))}getFreeTextLimitWidth(l,u,f,g,m,v){const y=l,x=u,w=Math.round(f),C=Math.round(v);if(!y)return 0;let _=y,T=g;if(C!==w){if(0===C)switch(w){case 90:return m;case 180:return g;case-90:_=x,T=m}if(-90===C)switch(w){case 0:return m;case 90:return g;case 180:_=x,T=m}if(180===C||-180===C)switch(w){case 0:return g;case-90:return m;case 90:_=x,T=m}if(90===C)switch(w){case 180:return m;case-90:return g;case 0:_=x,T=m}}let M=_-T;return M<0&&(M=_),M}selectShapes(l){const u=[];return l.forEach(f=>{"visible"===f.parsedStyle.visibility&&f.context.controlsFlags.enableControl&&u.push(f)}),this.inactivateShape(!l.length),!!u.length&&(this.defaultGroup.clear(),1===u.length?this.activateShape(u[0],!1,!0):(u.forEach(f=>{this.defaultGroup.add(f)}),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(l){if("none"!==this.eventMode||!this.activatedShape)return;const{offsetX:u,offsetY:f}=Ea(this.controller.canvas,l),g={x:u,y:f};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(g,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape)}editMoveHandler(l){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:u,offsetY:f}=Ea(this.controller.canvas,l),g={x:u,y:f};this.limitPoint(g,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(g,l.shiftKey),this.controller.hooks.emitAnnotationRender()}editEndHandler(l){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape))}drawStartHandler(l){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==l.pointerType&&"pen"!==l.pointerType||this.drawStampMoveHandler(l,!1));if(!this.eventArea)return;const{controller:u}=this,{drawType:f,drawLineShape:g,eventMode:m}=this,{offsetX:v,offsetY:y}=Ea(u.canvas,l),{x,y:w,width:C,height:_}=this.eventArea;if(v<x||v>x+C||y<w||y>w+_)return;const T={x:v,y},M=u.container.getWorldTransform().inverse().transformPoint(T);if(this.isStartDraw=!0,this.startCanvasPoint=T,this.startLocalPoint=M,this.lastMovePoint=null,"select"===m&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===m&&(g||this.drawInkShape)){const G=this.activatedShape instanceof Ta;return G&&(this.activatedShape.addSegment(),this.activatedShape.setUseDouglasPeucker(!1)),this.activatedShape.addPoint(M),void(G||"touch"!==l.pointerType&&"pen"!==l.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(f)&&(this.drawLineShape=!0),"draw"===m&&-1!==["annotationInk"].indexOf(f)&&(this.drawInkShape=!0);const L={style:this.getDrawInitStyle(this.drawType,M)};if("annotationFreeText"===this.drawType){const{cropBoxRect:G}=this.controller.container.parentNode.parentNode.parentNode,z=this.getFreeTextLimitWidth(G.width,G.height,this.controller.container.getAngle(),L.style.x-G.left||0,L.style.y-G.top||0,0);L.style.width=z||L.style.width}const N=this.controller.addShape(this.drawType,L,!1);N.style.zIndex=999,N instanceof Ta&&N.setUseDouglasPeucker(!1);const V=()=>{0!==this.controller.container.getAngle()&&EL(N)&&(N.setAngle(0),N.setPosition(T))},{container:H}=this.controller;if("draw"===m)this.controller.hooks.emitBeforeAnnotationDraw(N),V();else if("erase"===m){if(N.style.background=null,H){const G=N.style.borderWidth/H.getScale().x;N.style.borderWidth=G}this.eraserPath=N}else{if(H){const G=N.style.borderWidth/H.getScale().x;N.style.borderWidth=G}this.selectionBox=N,V()}this.activatedShape=N,this.controller.hooks.emitAnnotationRender()}drawMoveHandler(l,u){const{activatedShape:f,eventMode:g,isStartDraw:m,drawType:v}=this;if("none"===g)return;if("draw"===g&&"annotationStamp"===v)return void this.drawStampMoveHandler(l,u);if("draw"===g&&"annotationFreeText"===v||!m)return;const{offsetX:y,offsetY:x}=Ea(this.controller.canvas,l),w={x:y,y:x};this.limitPoint(w,!1,this.activatedShape);const C=this.controller.container.getWorldTransform().inverse().transformPoint(w);if("annotationPolyline"===v||"annotationPolygon"===v){const _=qe(f.parsedStyle.points),T=_.length;1===T?_[T]=C:_[T-1]=C,f.style.points=_}else if("annotationInk"===v)f.addPoint(C);else{const _=this.getDrawUpdateStyle(this.drawType,C,l.shiftKey),T=this.controller.container.getAngle();if(0!==T&&EL(f)){if(90===Math.abs(Math.round(T))){const M=_.width;_.width=_.height,_.height=M}_.width=w.x-this.startCanvasPoint.x>0?Math.abs(_.width):-Math.abs(_.width),_.height=w.y-this.startCanvasPoint.y>0?Math.abs(_.height):-Math.abs(_.height),f.updateStyle(_),f.setPosition(ne({},this.startCanvasPoint))}else f.updateStyle(_)}this.controller.hooks.emitAnnotationRender()}drawStampMoveHandler(l,u){const{offsetX:f,offsetY:g}=Ea(this.controller.canvas,l),m={x:f,y:g},v=this.controller.container.getRootNode(),y=v.getWorldTransform().inverse().transformPoint(m),x=()=>{if(!this.stampPreview)return;const w=this.stampPreview.getBoundingRect(),C=(null==l?void 0:l.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!u&&C?"visible":"hidden",this.stampPreview.setLocalPosition(y.x-w.width/2,y.y-w.height/2)};if(!this.stampPreview){const{defaultStyleConfig:w}=this.controller.interactiveConfig,{stamp:C}=w,_=(null==C?void 0:C.stampIcon)||(null==ci?void 0:ci.stampIcon),T=(null==C?void 0:C.imageData)||(null==ci?void 0:ci.imageData);if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:_,imageData:T,opacity:Ve(C.opacity)?C.opacity:.5,zIndex:9999},initByDraw:!0}),v.appendChild(this.stampPreview),!T&&_){const{width:M,height:L}=this.stampPreview.parsedStyle;if(L.value>60){const N=L.value/60;this.stampPreview.updateSize(M.value/N,L.value/N)}this.stampPreview.hooks.reRenderImage.on(()=>{this.controller.hooks.emitAnnotationRender()})}else this.stampPreview.hooks.reRenderImage.on(()=>{x(),this.controller.hooks.emitAnnotationRender()})}x(),this.controller.hooks.emitAnnotationRender()}eraseMoveHandler(l){const{eventMode:f,eraser:g,isStartDraw:m,erasedShapeIds:v,controller:y}=this;if("erase"!==f&&g&&(this.eraser=null,g.destroy()),"erase"!==f||!y.container||!m)return;const{offsetX:x,offsetY:w}=Ea(y.canvas,l),C={x,y:w};this.lastMovePoint||(this.lastMovePoint=C),y.shapeArrMap.get(y.containerId).forEach(_=>{_!==this.eraserPath&&"visible"===_.parsedStyle.visibility&&_.context.controlsFlags.enableControl&&function(T,M,L){const N=qo(T,M),V=yh(M,L),H=T.isPointInPath(N,5);if(H||V<=.9)return H;const G=V/1,z=(M.x-L.x)/G,q=(M.y-L.y)/G;for(let te=0;te<Math.abs(G);te++){const se=qo(T,{x:L.x+z*te,y:L.y+q*te});if(T.isPointInPath(se,5))return!0}return!1}(_,C,this.lastMovePoint)&&(_.style.opacity=.5,v.push(_.id))}),this.lastMovePoint=C,this.controller.hooks.emitAnnotationRender()}drawEndHandler(l){const{eventMode:u,isStartDraw:f,drawLineShape:g,drawType:m,activatedShape:v,controller:y}=this;if("draw"===u&&"annotationStamp"===m)return void this.drawStampEndHandler(l);if("none"===u||!f||g)return;if(this.isStartDraw=!1,["annotationRect","annotationTextBox"].includes(m)){const{width:w,height:C,borderWidth:_}=v.parsedStyle,{x:T,y:M}=v.getPosition(),{x:L,y:N}=v.getScale(),V=(null==_?void 0:_.value)||0;let H=T,G=M;w.value<0&&(H=T-(-w.value+V)*L,v.style.width=2*V-w.value),C.value<0&&(G=M-(-C.value+V)*N,v.style.height=2*V-C.value),v.setPosition({x:H,y:G})}if("draw"===u&&this.drawInkShape)return v.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?y.hooks.emitAddAnnotation("draw",[this.activatedShape]):y.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout(()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof Ta&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)))},this.controller.interactiveConfig.inkCreateDelay));if("draw"===u&&"annotationFreeText"!==m&&"annotationStamp"!==m){const{offsetX:w,offsetY:C}=Ea(y.canvas,l);((this.startCanvasPoint.x-w)**2+(this.startCanvasPoint.y-C)**2)**.5<2&&"annotationStamp"!==v.shapeType&&(y.deleteShape([v.id],!1),y.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null)}const x=(w,C)=>{w instanceof vi&&(w.textEditEventHandler.enableEditMode(this.startCanvasPoint,C),"textBox"===w.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===w.textType&&setTimeout(()=>{document.activeElement instanceof HTMLTextAreaElement||w.textEditEventHandler.enableEditMode(this.startCanvasPoint,C)},10))};if("draw"===u&&this.activatedShape){const w=this.activatedShape,{canvas:C}=this.controller;y.hooks.emitAddAnnotation("draw",[this.activatedShape]),y.interactiveConfig.enableContinuousDrawing?v instanceof vi?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),x(v,C)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),y.hooks.emitAfterAnnotationDraw(w),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),x(v,C))}"erase"===u&&this.executeErase(),"select"===u&&this.executeBoxSelect()}drawStampEndHandler(l){const{offsetX:u,offsetY:f}=Ea(this.controller.canvas,l);if(!this.stampPreview||!this.eventArea||this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return;const{x:g,y:m,width:v,height:y}=this.eventArea;if(u<g||u>v+g||f<m||f>y+m)return;const{defaultStyleConfig:x}=this.controller.interactiveConfig,{stamp:w}=x,C=Ve(null==w?void 0:w.opacity)?null==w?void 0:w.opacity:null==ci?void 0:ci.opacity,_=this.stampPreview;_.style.opacity=C;const{containerId:T,container:M,shapeArrMap:L}=this.controller,N=ne({},_.getPosition()),V=ne({},_.getScale()),H=M.getScale(),G=V.x/H.x,z=V.y/H.y;if(L.get(T).set(_.id,_),_.index=L.get(T).size,_.pageUid=T,M.appendChild(_),_.style.imageData){const{width:q,height:te}=_.parsedStyle;_.updateStyle({width:q.value*G,height:te.value*z}),_.setLocalScale(1,1,1)}else _.scale(G,z);_.setAngle(0),_.setPosition(N),this.stampPreview=null,this.activatedShape=_,this.controller.hooks.emitBeforeAnnotationDraw(_),this.controller.hooks.emitAddAnnotation("draw",[_]),this.controller.interactiveConfig.enableContinuousDrawing||(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(_,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(_))}dblClickHandler(l){const{activatedShape:u,controller:f}=this;if(!u)return;const{shapeType:g}=u;if(this.drawLineShape&&("annotationPolygon"===g||"annotationPolyline"===g)){const m=[...u.style.points],v=m.length;return gi()?yh(m[v-1],m[v-2])<=15&&m.pop():m.pop(),"mouse"===this.lastClickPointerType&&(m.pop(),this.lastClickPointerType=""),m.length<2?(f.deleteShape([u.id],!1),this.activatedShape=null):(u.style.points=m,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!f.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(u),this.resetActivatedZIndex=!1,this.activateShape(u,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===g&&!this.isSeparateText){const{offsetX:m,offsetY:v}=Ea(this.controller.canvas,l),{textEditEventHandler:y}=u,x={x:m,y:v};if(this.activatedShape instanceof vi&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:w}=this.controller.container.parentNode.parentNode.parentNode,C=this.getFreeTextLimitWidth(w.width,w.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-w.left,this.activatedShape.getLocalPosition().y-w.top,this.activatedShape.getAngle());C!==this.activatedShape.style.width&&(this.activatedShape.style.width=C,this.controller.hooks.emitModifyAnnotation(["appearanceChanged"],[this.activatedShape]))}y.enableEditMode(x,this.controller.canvas),this.controller.hooks.emitAnnotationRender()}}clickHandler(l){const{activatedShape:u,eventMode:f}=this;if(!u)return;const{shapeType:g}=u,m=()=>{if("annotationFreeText"===g){const{offsetX:v,offsetY:y}=Ea(this.controller.canvas,l),{textEditEventHandler:x}=u;x.editClickHandler({x:v,y},this.controller.canvas)}};if(this.lastClickPointerType=null==l?void 0:l.pointerType,this.isSeparateText=!1,"none"===f){if(l.ctrlKey){if(this.isDefaultGroup(u)){const{clickedShape:v}=u;this.defaultGroup.delete(v);const{shapes:y}=this.defaultGroup;if(y.length<2&&(this.defaultGroup.context.isActive=!1),1===y.length){const x=y[0];this.activateShape(x,!1,!1),this.isSeparateText=x instanceof vi}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(u),m());return void this.controller.hooks.emitAnnotationRender()}m()}}keyDownHandler(l){const{activatedShape:u}=this;if(u&&("Delete"===l.key||"Backspace"===l.key)){if(v0(u)&&u.textEditEventHandler.editMode)return;this.controller.deleteShape([u.id]),this.inactivateShape()}}getHitBorderOffset(l){if(!l)return 10;const u=l.getScale();if(u.x<1||u.y<1){const f=Math.min(u.x,u.y);return Math.round(Math.abs(10/f))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:l}=this.controller.interactiveConfig,{stamp:u}=l,f=(null==u?void 0:u.stampIcon)||(null==ci?void 0:ci.stampIcon),g=(null==u?void 0:u.imageData)||(null==ci?void 0:ci.imageData),m=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:f,imageData:g,opacity:Ve(u.opacity)?u.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),m.appendChild(this.stampPreview),!g&&f){const{width:v,height:y}=this.stampPreview.parsedStyle;if(y.value>60){const x=y.value/60;this.stampPreview.updateSize(v.value/x,y.value/x)}}}}function EL(p){return["annotationFreeText","annotationTextBox","annotationRect"].includes(p.shapeType)}var ir,pl,Z3=new WeakMap;class Cie extends mi{constructor(){super(...arguments),S(this,"renderAnnotation",Re(this)),S(this,"addAnnotation",Re(this)),S(this,"deleteAnnotation",Re(this)),S(this,"selectAnnotation",Re(this)),S(this,"modifyAnnotation",Re(this)),S(this,"annotationModeChanged",Re(this)),S(this,"beforeAnnotationEdit",Re(this)),S(this,"afterAnnotationEdit",Re(this)),S(this,"beforeAnnotationDraw",Re(this)),S(this,"afterAnnotationDraw",Re(this)),S(this,"selectAnnotationTextChars",Re(this)),S(this,"enableAnnotationTextEditMode",Re(this)),S(this,"disableAnnotationTextEditMode",Re(this)),Ht(this,Z3,[])}emitAddAnnotation(l,u){const f=[];u.forEach(g=>{f.push({uid:g.id,shape:g})}),this.addAnnotation.emit({action:l,shapes:f})}emitDeleteAnnotation(l){const u=[];l.forEach(f=>{u.push({uid:f.id,shape:f})}),this.deleteAnnotation.emit({shapes:u})}emitSelectAnnotation(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=[];l instanceof xc?l.shapes.forEach(g=>{f.push(g.id)}):l&&f.push(l.id),(f.length||ee(Z3,this).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...f],oldAnnotationsUids:[...ee(Z3,this)],emitSelected:u}),gt(Z3,this,f))}emitModifyAnnotation(l,u){const f=[];u.forEach(g=>{g instanceof xc?g.shapes.forEach(m=>{f.push({uid:m.id,shape:m})}):f.push({uid:g.id,shape:g})}),this.modifyAnnotation.emit({actions:l,shapes:f})}emitAnnotationModeChanged(l){this.annotationModeChanged.emit(l)}emitBeforeAnnotationEdit(l){l instanceof vi&&l.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(l)}emitAfterAnnotationEdit(l){this.afterAnnotationEdit.emit(l)}emitAnnotationRender(){this.renderAnnotation.emit()}emitSelectAnnotationTextChar(l){this.selectAnnotationTextChars.emit(l)}emitBeforeAnnotationDraw(l){this.beforeAnnotationDraw.emit(l)}emitAfterAnnotationDraw(l){this.afterAnnotationDraw.emit(l)}emitEnableAnnotationTextEditMode(l){this.enableAnnotationTextEditMode.emit(l)}emitDisableAnnotationTextEditMode(l){this.disableAnnotationTextEditMode.emit(l)}}class bie{constructor(l){S(this,"shapeArrMap",void 0),S(this,"shapeMap",void 0),S(this,"annotationMode","none"),S(this,"brush","annotationRect"),S(this,"canvas",void 0),S(this,"hooks",void 0),S(this,"interactiveConfig",qe(Yte)),S(this,"eventService",void 0),S(this,"containerId",void 0),S(this,"container",void 0),Yo.bindHandler(["opacity"],void 0,uie),Yo.bindHandler(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,SL),Yo.bindHandler(["text","width","wordWarp","borderWidth","lineHeight","fontWeight","textTransform","textBaseLine"],void 0,SL),Yo.bindHandler(["width","height","borderWidth"],void 0,gie),Yo.bindHandler(["startPoint","endPoint","lineEnding"],void 0,mie),Yo.bindHandler(["r","rx","ry","borderWidth"],void 0,die),Yo.bindHandler(["points","segments"],void 0,fie),Yo.bindHandler(["borderWidth"],void 0,pie),Yo.bindHandler(["textContents","borderWidth","textAlign"],void 0,vie),Yo.bindHandler(["textAlign"],void 0,yie),this.canvas=l,this.eventService=new wie(this),this.hooks=new Cie,this.shapeArrMap=new Map,this.shapeMap=new Map}set drawType(l){this.brush=l,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",l)}get drawType(){return this.brush}bindFreeTextHooks(l){if(!(l instanceof vi))return;const u=l.hooks;let f;u.reRenderText.on(()=>{this.hooks.emitAnnotationRender()}),u.textContentUpdated.on(()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[l])}),u.selectTextChars.on(g=>{var m;if(g.startChar===g.endChar&&l.isSameChar(f,g.endChar)&&!g.needUpdate)return;const{freeTextContentStyle:v}=l,y="freeTextWriter"===l.textType?"textTypewriter":"textBox",{defaultStyleConfig:x}=this.interactiveConfig;x[y]||(x[y]={}),x[y].textContent=Fe(ne({},v),{content:null===(m=x[y])||void 0===m||null===(m=m.textContent)||void 0===m?void 0:m.content}),f=g.endChar,this.hooks.emitSelectAnnotationTextChar(l)}),u.enableTextEditMode.on(g=>{this.hooks.emitEnableAnnotationTextEditMode(l)}),u.disableTextEditMode.on(g=>{f=null,this.hooks.emitDisableAnnotationTextEditMode(l)})}bindStampHooks(l){l instanceof yo&&l.hooks.reRenderImage.on(()=>{this.hooks.emitAnnotationRender()})}isHitShape(l){const{offsetX:u,offsetY:f}=Ea(this.canvas,l),{activatedShape:g,defaultGroup:m}=this.eventService,v={x:u,y:f},{shapeArrMap:y,shapeMap:x,containerId:w}=this,C=y.get(w)||x;if(g&&(m===this.eventService.activatedShape&&(null==m?void 0:m.parentNode)===this.container||C.has(g.id))){const N=g.eventHandler.isHit(v,!1);if(-1!==N)return{isHit:!0,isHitSelected:!0,hitControlPointIndex:N,shape:g}}const T=[];let M=!1,L=null;return C.forEach(N=>{if("hidden"===N.style.visibility||!N.context.controlsFlags.enableControl||N===g)return;const V=qo(N,v);!N.context.isGrouped&&N.isPointInPath(V,this.eventService.getHitBorderOffset(N))&&(M=!0,T.push(N))}),M&&(T.sort((N,V)=>N.style.zIndex-V.style.zIndex),L=T[T.length-1]),{isHit:M,shape:L,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return!!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof vi)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=l,this.eventService.setEventMode(l,this.drawType),gi()&&"draw"===l&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==l&&this.eventService.inactivateShape(),u&&this.hooks.emitAnnotationModeChanged(l)}setAnnotationContainer(l,u){if(u!==this.container){const{activatedShape:f,drawLineShape:g,drawInkShape:m,drawType:v}=this.eventService;if("draw"===this.eventService.eventMode&&f){if(m&&f instanceof Ta&&(clearTimeout(this.eventService.inkDelayTimeout),f.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),g){const y=[...f.style.points];f.style.points=y,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1}"annotationInk"!==v&&(this.hooks.emitAddAnnotation("draw",[f]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(f)),this.eventService.activatedShape=null)}}this.containerId=l,this.container=u,this.shapeArrMap.get(l)||this.shapeArrMap.set(l,new Map)}setAnnotationInteractiveConfig(l){const u=qe(l),{controlsStyle:f,defaultStyleConfig:g,eraserStyle:m,selectionStyle:v}=this.interactiveConfig;u.defaultStyleConfig=(null==u?void 0:u.defaultStyleConfig)||{};const{stamp:y}=g,{stamp:x}=u.defaultStyleConfig,w=(null==y?void 0:y.stampIcon)||ci.stampIcon,C=(null==x?void 0:x.stampIcon)||ci.stampIcon,_=(null==y?void 0:y.imageData)||ci.imageData,T=(null==x?void 0:x.imageData)||ci.imageData;this.interactiveConfig=Fe(ne(ne({},this.interactiveConfig),u),{controlsStyle:gn((null==u?void 0:u.controlsStyle)||{},f),defaultStyleConfig:gn((null==u?void 0:u.defaultStyleConfig)||{},g),eraserStyle:gn((null==u?void 0:u.eraserStyle)||{},m),selectionStyle:gn((null==u?void 0:u.selectionStyle)||{},v)}),null!=u&&u.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:M}=this.eventService;var L;M&&M.style.opacity!==(null==x?void 0:x.opacity)&&(this.eventService.stampPreview.style.opacity=null==x?void 0:x.opacity),w===C&&_===T||!this.eventService.stampPreview||(null===(L=this.eventService.stampPreview)||void 0===L||L.destroy(),this.eventService.stampPreview=null)}setAnnotationFlags(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=this.getShape(l);if(!(g instanceof H6||g instanceof fl)&&g){if(g!==this.eventService.activatedShape||!1!==u.enableControl&&!1!==u.isVisible||this.eventService.inactivateShape(!0),g.context.updateControlsFlags(ne({},u)),g.context.isInGroup&&(!g.context.controlsFlags.isVisible||!g.context.controlsFlags.enableControl)){const{defaultGroup:m}=this.eventService;m.delete(g),this.eventService.activatedShape===m&&1===m.shapes.length&&this.eventService.activateShape(m.shapes[0],!1,!0)}f&&this.hooks.emitAnnotationRender()}}getShape(l){return"ddvDefaultGroup"===l?this.eventService.defaultGroup:this.shapeMap.get(l)||null}getSelectedShapeUids(){const{activatedShape:l}=this.eventService;if(!l)return[];const u=[];return l instanceof xc?l.shapes.forEach(f=>{u.push(f.id)}):u.push(l.id),u}createShape(l,u){var f,g;let m;if(u.selectableStyle=ne(ne({},this.interactiveConfig.controlsStyle),u.selectableStyle),"annotationEllipse"===l){const{style:y}=u;y.x+=y.width/2||0,y.y+=y.height/2||0,y.rx=y.width/2||y.rx,y.ry=y.height/2||y.ry}const{defaultStyleConfig:v}=this.interactiveConfig;switch(l){case"annotationRect":m=new q3(u);break;case"annotationGroup":m=new xc(null==u?void 0:u.id);break;case"annotationArc":m=new wL(u);break;case"annotationCircle":m=new CL(u);break;case"annotationEllipse":m=new Vd(u);break;case"annotationLine":m=new w0(u);break;case"annotationInk":m=new Ta(u);break;case"annotationPolygon":m=new y0(u);break;case"annotationPolyline":m=new x0(u);break;case"annotationFreeText":m=new vi(u,"freeTextWriter",ne(ne({},ci.textContent),null===(f=v.textTypewriter)||void 0===f?void 0:f.textContent));break;case"annotationTextBox":m=new vi(u,"textBox",ne(ne({},ci.textContent),null===(g=v.textBox)||void 0===g?void 0:g.textContent));break;case"annotationImage":m=new qte(u);break;case"annotationStamp":m=new yo(u);break;case"annotationHighlight":m=new fl(u,Da.HIGHLIGHT);break;case"annotationUnderline":m=new fl(u,Da.UNDERLINE);break;case"annotationStrikeout":m=new fl(u,Da.STRIKEOUT);break;default:m=new H6(u)}return m?(m.id||(m.id=qt()),this.shapeMap.set(m.id,m),m):null}addShape(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=u&&u.id){const m=this.getShape(null==u?void 0:u.id);if(m)return m}const g=this.createShape(l,u);return this.containerId&&this.shapeArrMap.get(this.containerId).set(g.id,g),this.container&&(g.index=this.shapeArrMap.get(this.containerId).size,g.pageUid=this.containerId,this.container.appendChild(g),f&&this.hooks.emitAddAnnotation("data",[g])),this.bindFreeTextHooks(g),this.bindStampHooks(g),g}updateShape(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=this.getShape(l);if(!g)return!1;const{isGrouped:m}=g.context;if(m&&this.eventService.defaultGroup.delete(g),null!=u&&u.style)if(g instanceof yo)g.updateStampStyle(ne({},u.style));else{if(g instanceof Vd){const{x:v,y,width:x,height:w}=u.style,{x:C,y:_}=g.getLocalPosition(),T=x?Dt(x).value/2:0,M=w?Dt(w).value/2:0,L=Ve(v)?v+T:C,N=Ve(y)?y+M:_,V=T||g.style.rx,H=M||g.style.ry;u.style=Fe(ne({},u.style),{x:L,y:N,rx:V,ry:H})}g.updateStyle(ne({},u.style))}if(null!=u&&u.transform){const{angle:v,scale:y}=u.transform;Se(v)||g.setLocalAngle(v),Se(y)||g instanceof yo||g.setLocalScale(y)}return f&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[g]),m&&this.eventService.defaultGroup.add(g),!0}updateAllShapeControlsStyle(l){let u=!1;this.shapeMap.forEach(f=>{f.context.controlsStyle=l,f.context.parseControlsStyle(),f.controls&&(f.controls.isVisible&&(u=!0),f.context.destroyControls(),f.context.initControls(),f.context.renderControls())}),u&&this.hooks.emitAnnotationRender()}updateFreeTextDefaultConfig(){const{defaultStyleConfig:l}=this.interactiveConfig;this.shapeMap.forEach(u=>{if(u instanceof vi){const f=ci.textContent,g="freeTextWriter"===u.textType?"textTypewriter":"textBox",{textContent:m}=l[g]||{};u.updateFreeTextContentStyle(Fe(ne(ne({},f),m),{content:f.content}))}})}updateLayer(l,u){const f=this.getShape(l);return!!f&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===f?this.eventService.activatedZIndex=u:f.updateStyle({zIndex:u}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&f.updateStyle({zIndex:u}),!0)}deleteShape(l){var u;let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const m=[],{eventService:v}=this,y=l.includes(null==v||null===(u=v.activatedShape)||void 0===u?void 0:u.id);if(l.forEach(_=>{const T=this.getShape(_);T&&(T instanceof xc?(m.push(...T.shapes),T.clear()):m.push(T))}),!m.length)return!1;f&&this.hooks.emitDeleteAnnotation(m),m.forEach(_=>{_.context.isInGroup&&this.eventService.defaultGroup.delete(_),this.shapeMap.delete(_.id),this.shapeArrMap.get(_.pageUid)&&this.shapeArrMap.get(_.pageUid).delete(_.id),_.destroy()});const{activatedShape:x,defaultGroup:w}=v;return(y||x===w&&!w.state)&&this.eventService.inactivateShape(!0,g),!0}selectShape(l){const u=[];return l.forEach(f=>{u.push(this.getShape(f))}),this.eventService.selectShapes(u)}moveShape(l,u,f){l.forEach(g=>{const m=this.getShape(g);if(!m)return;const y=this.shapeArrMap.get(m.pageUid);y&&y.delete(g),this.shapeArrMap.get(u)||this.shapeArrMap.set(u,new Map),this.shapeArrMap.get(u).set(g,m),m.context.isGrouped&&m.parentNode.delete(m,!0),f.appendChild(m)})}setShapeLayout(l,u){var f;if(!l.parentNode)return;const g=l.parentNode;let m,v;if(g instanceof Nd)m=g.width,v=g.height;else{const{width:te,height:se}=mL(g);m=te,v=se}const{x:y,y:x}=g.getLocalScale();g.scale(y<0?-1:1,x<0?-1:1);const w=g.getAngle(),{width:C,height:_}=mL(l),{x:T,y:M}=g.getPosition(),{x:L,y:N}=l.getPosition(),{shapeType:V}=l;let H,G;if(g.setAngle(0),null!=g&&null!==(f=g.context)&&void 0!==f&&f.referencePoint){const{x:te,y:se}=g.context.referencePoint.getPosition();H=te,G=se}else H=T,G=M;switch(u){case"left":G=N;break;case"top":H=L;break;case"right":H+=m-C,G=N;break;case"bottom":H=L,G+=v-_;break;case"center":H+=m/2-C/2,G+=v/2-_/2;break;case"horizontal-center":H+=m/2-C/2,G=N;break;case"vertical-center":H=L,G+=v/2-_/2}const z=l.getAngle();if(l.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(V)&&(["left","right","horizontal-center"].includes(u)?H+=C/2:(["top","bottom","vertical-center"].includes(u)||(H+=C/2),G+=_/2)),"annotationText"===V&&["top","bottom","vertical-center","center"].includes(u)){var q;const{lineHeight:te}=l.parsedStyle,se=null===(q=l.chars[0])||void 0===q?void 0:q.height,ae=Math.max(te,se);G+=l.getTextBaseLineOffset(ae)/2}l.setPosition({x:H,y:G}),l.setAngle(z),g.setAngle(w),g.scale(y<0?-1:1,x<0?-1:1),this.hooks.emitAnnotationRender()}clickHandler(l){this.eventService.clickHandler(l)}dblClickHandler(l){this.eventService.dblClickHandler(l)}keyDownHandler(l){this.eventService.keyDownHandler(l)}startHandler(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=this.isHitShape(l);if("none"===this.annotationMode&&u&&(f.isHit?this.eventService.activateShape(f.shape,l.ctrlKey,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||f.isHit||this.annotationMode===this.eventService.eventMode||this.eventService.setEventMode(this.annotationMode,this.brush),"draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&f.isHit&&(this.eventService.setEventMode("none"),this.eventService.activateShape(f.shape,l.ctrlKey,!0)),"select"===this.annotationMode){const{isHitSelected:g,isHit:m}=f;g?this.eventService.setEventMode("none"):!g&&m&&l.ctrlKey?(this.eventService.setEventMode("none"),this.eventService.activateShape(f.shape,l.ctrlKey,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear())}this.eventService.editStartHandler(l),this.eventService.drawStartHandler(l)}moveHandler(l,u){this.eventService.editMoveHandler(l),this.eventService.drawMoveHandler(l,u),this.eventService.eraseMoveHandler(l)}endHandler(l){this.eventService.editEndHandler(l),this.eventService.drawEndHandler(l)}cursorHandler(l,u,f){if(!(this.container&&l.target instanceof HTMLCanvasElement))return;if(u||!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(l.target.style.cursor=f);if("erase"===this.eventService.eventMode)return void(l.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const g=this.isHitShape(l);if(this.eventService.isStartEdit){if(!g.isHitSelected||9!==g.hitControlPointIndex)return;l.target.style.cursor="move"}"draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType)?l.target.style.cursor="crosshair":g.isHit?g.isHitSelected?(l.target.style.cursor=9===g.hitControlPointIndex?"move":"grab",9===g.hitControlPointIndex&&g.shape instanceof vi&&g.shape.isEditMode&&(l.target.style.cursor="text")):l.target.style.cursor="pointer":l.target.style.cursor="draw"===this.annotationMode?"crosshair":f}}class cp extends Fs{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class _ie extends cp{constructor(){super(),this.close=!1}}class Sie extends cp{render(l,u){super.render(l,u)}}class Eie extends cp{}class Tie extends dL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class Die extends cp{}class Aie extends aL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class Iie extends lL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class Pie extends cp{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class Rie extends cL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&(l.pointEventsHandler.updateLineControls(),l.context.renderControls()))}}class Mie extends cp{}class kie extends Fs{render(l,u){if("hidden"!==l.parsedStyle.visibility){if("stamp"===l.renderType)super.render(l,u);else{const{width:f,height:g,img:m,opacity:v}=l.parsedStyle;if(nt(m))return;u.save(),u.globalAlpha=v,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality&&(u.imageSmoothingQuality="high"),u.drawImage(m,0,0,f.value,g.value),u.restore()}l.controls&&l.context.renderControls()}}}class Oie extends hL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class Lie extends uL{render(l,u){"hidden"!==l.parsedStyle.visibility&&(super.render(l,u),l.controls&&l.context.renderControls())}}class Fie extends Fs{render(l,u){"hidden"!==l.parsedStyle.visibility&&TL(l,u)}}function TL(p,l){const{container:u}=p,f=p.parentNode;if(!f)return;const g=f.getLocalTransform(),{a:m,b:v,c:y,d:x,e:w,f:C}=g;let _=null,T=u.parentNode;for(;!_&&T;)"pageCropBox"===T.name&&(_=T),T=T.parentNode;if(_){const{x:M,y:L,width:N,height:V}=function(H){let{x:G,y:z}=H.getPosition(),{width:q,height:te}=H;const ae=(H.parentNode.parentNode.rotation%360+360)%360/90,j=devicePixelRatio;if(1===ae?G-=te:2===ae?(G-=q,z-=te):3===ae&&(z-=q),1===ae||3===ae){const le=q;q=te,te=le}return{x:G*j,y:z*j,width:q*j,height:te*j}}(_);l.save(),l.setTransform(m,v,y,x,w,C),l.beginPath(),l.moveTo(M,L),l.lineTo(M+N,L),l.lineTo(M+N,L+V),l.lineTo(M,L+V),l.closePath(),l.restore(),l.clip()}}class Nie extends Fs{render(l,u){"hidden"!==l.parsedStyle.visibility&&(TL(l,u),super.render(l,u))}}class DL{init(l){[{name:"annotationArc",renderer:new _ie},{name:"annotationCircle",renderer:new Sie},{name:"annotationEllipse",renderer:new Eie},{name:"annotationLine",renderer:new Tie},{name:"annotationImage",renderer:new Aie},{name:"annotationInk",renderer:new Iie},{name:"annotationPolygon",renderer:new Pie},{name:"annotationPolyline",renderer:new Rie},{name:"annotationRect",renderer:new Mie},{name:"annotationText",renderer:new Oie},{name:"annotationFreeText",renderer:new Lie},{name:"annotationGroup",renderer:new Die},{name:"annotationStamp",renderer:new kie},{name:"annotationControls",renderer:new Fie},{name:"annotationLineControls",renderer:new Nie}].forEach(u=>{let{name:f,renderer:g}=u;l.contextService.registerShapeRenderer(f,g)})}destroy(){}}function hp(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yt.displayResolution;const u={left:0,top:0,width:p.imageWidth/p.imageXResolution*l,height:p.imageHeight/p.imageYResolution*l};return{fileIndex:0,mediaBox:u,cropBox:ne({},u),resource:{data:p.imageData,width:p.imageWidth,height:p.imageHeight,resolutionX:p.imageXResolution,resolutionY:p.imageYResolution,bitDepth:p.imageBitDepth}}}class J3 extends tp{constructor(){super(),S(this,"type","imageParser"),S(this,"once",!1),S(this,"imgReader",void 0),S(this,"isDestroy",!1),S(this,"source",void 0),S(this,"parserOptions",void 0),this.imgReader=new Od}initParser(l,u){this.source={fileSource:l},u&&(this.parserOptions=u)}getPageCount(){return Q(function*(){return 1})()}destroy(){var l;null===(l=this.imgReader)||void 0===l||l.destroy(),this.imgReader=null,this.isDestroy=!0}parse(){var l=this;return Q(function*(){return l.isDestroy?null:[hp(yield l.imgReader.readImageInfo(l.source))]})()}getPage(){var l=this;return Q(function*(){var u;if(l.isDestroy)return null;const f={"image/jpeg":Ls.IT_JPG,"image/png":Ls.IT_PNG,"image/bmp":Ls.IT_BMP},{outputType:g,jpegQuality:m,returnBase64:v}=null!==(u=l.parserOptions)&&void 0!==u?u:{},y=yield l.imgReader.readImage({source:l.source,outputType:null!=g?g:f[l.source.fileSource.type],jpegQuality:m,returnBase64:v});return y?hp(y):null})()}cancelGetPage(l){var u;if(this.isDestroy)return;const{outputType:f}=null!==(u=this.parserOptions)&&void 0!==u?u:{};this.imgReader.cancelReadImage(this.source,f)}}class Bie{constructor(){S(this,"type","tiffParser"),S(this,"once",!1),S(this,"imgReader",void 0),S(this,"parserOptions",void 0),S(this,"source",void 0),S(this,"isDestroy",!1),this.imgReader=new Od}initParser(l,u){this.source={fileSource:l},u&&(this.parserOptions=u)}getPageCount(){var l=this;return Q(function*(){return l.imgReader.getTiffPageCount(l.source)})()}destroy(){var l;null===(l=this.imgReader)||void 0===l||l.destroy(),this.imgReader=void 0,this.isDestroy=!0}parse(l){var u=this;return Q(function*(){return u.isDestroy||!u.source?null:(yield u.imgReader.readTiffPageInfo(u.source,l)).map(f=>{const g=hp(f);return g.fileIndex=f.pageIndex,g})})()}getPage(l){var u=this;return Q(function*(){var f;if(u.isDestroy||!u.source)return null;const{outputType:g,returnBase64:m}=null!==(f=u.parserOptions)&&void 0!==f?f:{},v=yield u.imgReader.readTiffPage({source:u.source,index:l,outputType:g,returnBase64:m});if(v){const y=hp(v);return y.fileIndex=v.pageIndex,y}return null})()}cancelGetPage(l){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,l)}}function dp(p,l){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=Sa(p),g=l||1;if(Xt(f)&&f[0]&&f[0]instanceof np){const C=f[0].value.steps,{length:_}=f[0].value.steps,T=[0,0,0];C.forEach(L=>{const N=Sa(L.color);T[0]+=N.r,T[1]+=N.g,T[2]+=N.b});const M=[T[0]/_,T[1]/_,T[2]/_];return u&&(M[3]=255),M}const{r:m,g:v,b:y,alpha:x}=f,w=[m,v,y];return u&&(w[3]=Math.floor(x*g*255+.5)),w}function up(p,l){return{strokeColor:p?dp(p,1,!1):null,fillColor:l?dp(l,1,!1):null}}function jd(p,l,u){let f,g;return f=p?dp(p,u,!0):null,g=l?dp(l,u,!0):null,{apStrokeColor:f,apFillColor:g}}function Hd(p,l,u){const f=p.value?p.value/u:0,g=Wd(l||[],u);return g.length?{width:f,style:"D",dash:g}:{width:f}}function AL(p){const l=p.getLocalTransform().clone(),{a:u,b:f,c:g,d:m}=l;return[Q3(u),-Q3(f),-Q3(g),Q3(m),0,0]}function IL(p,l){const{min:u,max:f}=Math;let g=p[0][0],m=p[0][1],v=p[0][0],y=p[0][1];for(let x=1;x<p.length;x++){const w=p[x];g=u(g,w[0]),v=f(v,w[0]),y=u(y,w[1]),m=f(m,w[1])}return g===v&&(g-=1,v+=1),y===m&&(y-=1,m+=1),[g-l/2,y-l/2,v+l/2,m+l/2]}function Ah(p,l,u,f,g,m){const v=[],y=yc(l),x=u/2,w=[{x:y.left-x*f,y:y.bottom+x*g},{x:y.right+x*f,y:y.bottom+x*g},{x:y.right+x*f,y:y.top-x*g},{x:y.left-x*f,y:y.top-x*g}],C=p.getLocalTransform();return w.forEach(_=>{const T=C.transformPoint({x:_.x,y:_.y});v.push([T.x/f,m-T.y/g])}),IL(v,0)}function PL(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[],{length:f}=p;if(f>50&&l){const g=Math.floor(f/2),m=Math.floor(f/4);u.push(p[0][0],p[0][1]),u.push(p[m][0],p[m][1]),u.push(p[g][0],p[g][1]),u.push(p[f-m][0],p[f-m][1]),u.push(p[f-1][0],p[f-1][1]),u.push(p[0][0],p[0][1])}else p.forEach(g=>{u.push(g[0],g[1])});return u}function Uie(p){const l=[];for(let u=0;u<p.length;u++){const f=[];p[u].forEach(g=>{f.push(g[0],g[1])}),l.push(f)}return l}function Wd(p,l){return p?2===p.length&&0===p[0]&&0===p[1]?[]:p.map(u=>u/l):[]}function Vie(p){return Math.max(["butt","round","square"].indexOf(p),0)}function jie(p){return Math.max(["miter","round","bevel"].indexOf(p),0)}function RL(p){const l=[],u=p.getLocalTransform();return p.renderPath.forEach(f=>{const g=u.transformPoint({x:f.x,y:f.y});l.push({x:g.x,y:g.y})}),l}function Hie(p,l){const u=Sa(p);let f=0,g=0,m=99999,v=99999;if(Xt(u)&&u[0]&&u[0]instanceof np){const y=(_=>{const T=_.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!T)return null;const M=T[0],L=T.slice(1);return{direction:M.replace(/\s+/g," ").trim(),colors:L.map(N=>N.trim())}})(p);l.forEach(_=>{f=Math.max(f,_[0]),m=Math.min(m,_[0]),g=Math.max(g,_[1]),v=Math.min(v,_[1])});const x=[m,g,f,v];y.direction.includes("left")&&(x[0]=f,x[2]=m),y.direction.includes("top")&&(x[1]=v,x[3]=g);const w=Sa(y.colors[0]),C=Sa(y.colors[1]);return{coords:x,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[w.r/255,w.g/255,w.b/255],c1:[C.r/255,C.g/255,C.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function Ih(p){return p.map(l=>l.toLowerCase())}function ML(p,l,u,f,g){const{width:m,height:v}=p.parsedStyle;let y=m.value,x=v.value;if(p instanceof vi){const{width:V,height:H}=p.getBoundingRect();y=V,x=H}const{x:w,y:C}=p.getLocalPosition(),_=l/2,T=w/u,M=g-C/f,L=y/u,N=x/f;return[[T+_,M-N+_,2,!1],[T+L-_,M-N+_,0,!1],[T+L-_,M-_,0,!1],[T+_,M-_,0,!1],[T+_,M-N+_,0,!0]]}function kL(p,l,u,f){p.renderPath||p.getPath();const{renderPath:g}=p,m=[],{x:v,y}=p.getLocalPosition();let x=[];for(let w=0;w<g.length;w++){const{step:C,close:_}=g[w],T=(g[w].x+v)/l,M=f-(g[w].y+y)/u;0!==w?0!==C||0===w?x.push([T,M,0,_]):(m.push(x),x=[],x.push([T,M,2,_])):x.push([T,M,2,_])}return m.push(x),m}function OL(p,l,u,f){const g=p.childNodes,m=[];for(let v=0;v<g.length;v++){if(!(g[v]instanceof Y3))continue;const y=[],{renderPath:x}=g[v],{x:w,y:C}=g[v].getLocalPosition();x.forEach((_,T)=>{const M=[(_.x+w)/l,f-(_.y+C)/u,_.step,!1];T===x.length-1&&(M[3]=!0),y.push(M)}),m.push(y)}return m}function Gd(p,l,u,f,g,m,v){let y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:x}=p.parsedStyle,w=AL(p),C=IL(m,g),_=[];return y&&_.push(fp(p,m,l,u,g,Wd(x,v))),{bbox:C,matrix:w,transform:C,objs:_}}function fp(p,l,u,f,g,m){const{miterLimit:v,lineCap:y,lineJoin:x}=p.parsedStyle;return{dashArray:m,dashPhase:0,fillColor:u||[0,0,0,0],fillType:u?2:0,isStroke:g>0,lineCap:Vie(y),lineJoin:jie(x),lineWidth:g,miterLimit:v,objMatrix:[1,0,0,1,0,0],segments:l,strokeColor:f||[0,0,0,0],type:"path"}}function Wie(p,l,u,f){const{fontSize:g,fontFamily:m,fontWeight:v,fontStyle:y,opacity:x,text:w}=p.parsedStyle,{color:C,borderColor:_}=p.style,{x:T,y:M}=p.getLocalPosition(),{fillColor:L,strokeColor:N}=up(_,C),V=LL(v),H="italic"===y;return{type:"text",charSpace:0,wordSpace:0,fillColor:L?[...L,255*x]:[0,0,0,255],strokeColor:N?[...N,255*x]:[0,0,0,255],fontName:m,renderMode:0,fontIsBold:V,fontIsItalic:H,fontSize:g.value/l,fontPitchFamily:16,text:w,position:[T/l,M/u],objMatrix:[1,0,0,1,T/l,f-M/u]}}function Q3(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const u=p.toFixed(l);return Number.parseFloat(u)}function LL(p){return"bold"===p||Ve(p)&&p>=600}function K3(p,l,u){return p.replace(new RegExp(l,"g"),u)}function ex(p,l,u,f,g){const{segments:m,lineWidth:v,strokeColor:y,fillType:x,fillColor:w,dashArray:C,lineCap:_,lineJoin:T,miterLimit:M,isStroke:L,pattern:N}=p,V={type:"path",stampPoints:Gie(m,u,f,g),borderWidth:L?(v||1)*u:0,borderColor:zn(y,l),background:x>0?zn(w,l):null,lineDash:ml(C,u),lineCap:zd(_),lineJoin:$d(T),miterLimit:M};return N&&(V.background=function(H,G,z,q){var te,se,ae,j;const{coords:le,type:ue}=H;if("shading"!==ue)return null;const xe_y=q-le[1]*z,I_y=q-le[3]*z;if(!H||null==H||!H.function||null==H||null===(te=H.function[0])||void 0===te||!te.functions)return null;let O=null==H||null===(se=H.function[0])||void 0===se||null===(se=se.functions[0])||void 0===se?void 0:se.c0,b=null==H||null===(ae=H.function[0])||void 0===ae||null===(ae=ae.functions[0])||void 0===ae?void 0:ae.c1;if(!O||!b)return null;const D=(null==H||null===(j=H.function[0])||void 0===j?void 0:j.encode)||[1,0];if(D[0]>D[D.length-1]){const F=b;b=O,O=F}const U=`rgb(${255*b[0]},${255*b[1]},${255*b[2]})`;return`linear-gradient(to ${le[0]*G<le[2]*G?"right":"left"} ${xe_y===I_y?"":xe_y<I_y?"bottom":"top"}, ${V3(`rgb(${255*O[0]},${255*O[1]},${255*O[2]})`)}, ${V3(U)})`}(N,u,f,g)||V.background),V}function W6(p,l,u,f,g){const{text:m,renderMode:v,fontIsBold:y,fontIsItalic:x,fillColor:w,fontSize:C,fontName:_,strokeColor:T,objMatrix:M}=p,L=new sn(M),{scale:N}=L.decompose(),V=function(H,G,z,q,te,se){const ae=gl(H,G,[1,0,0,1,0,0]);return[ae[0]*z,(te-ae[1])*q]}(M[4],M[5],u,f,g);return{type:"text",text:m,color:zn(w,l),borderWidth:v?u:"0px",borderColor:zn(T,l),fontWeight:y?"bold":"normal",fontStyle:x?"italic":"normal",fontSize:C*u*Math.abs(N.x),fontFamily:_,textBaseLine:"alphabetic",x:V[0],y:V[1]+Math.floor(C*u*Math.abs(N.x))}}function FL(p,l,u){const f=function(y,x){const w=y.replace(/[^A-Za-z0-9\+\/]/g,""),C=w.length,_=3*C+1>>>2,T=new Uint8Array(_);for(let M,L,N=0,V=0,H=0;H<C;H++)if(L=3&H,N|=zie(w.charCodeAt(H))<<18-6*L,3===L||C-H==1){for(M=0;M<3&&V<_;M++,V++)T[V]=N>>>(16>>>M&24)&255;N=0}return T}(p),g=new ImageData(new Uint8ClampedArray(f),l,u);let m=document.createElement("canvas");m.width=l,m.height=u,m.getContext("2d").putImageData(g,0,0);const v=m.toDataURL();return m=null,v}function gl(p,l,u){return[u[0]*p+u[2]*l+u[4],u[1]*p+u[3]*l+u[5]]}function xo(p,l,u,f,g,m){let v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const y=new sn(u),x=y.decompose(),w={x:(l[2]+l[0])/2,y:(l[1]+l[3])/2},C=(l[2]-l[0])/2,_=(l[1]-l[3])/2,T=y.transformPoint(w),M={x:(T.x-C)*f,y:(m-T.y+_)*g},L=-x.rotation.z,N={x:x.scale.x,y:x.scale.y};let V=M;var H;return v&&(V=null!==(H=function(G,z,q,te,se,ae){const j=[];let le=!0;if(G.forEach(ue=>{let xe;"path"===ue.type?(xe=ex(ue,1,te,se,ae),le=!1):"text"===ue.type&&(xe=W6(ue,1,te,se,ae),le=!1),xe&&j.push(xe)}),le)return null;if(j.length){const ue=function(xe,I,A,P,O){const b_x=I[0]*A,b_y=(O-I[3])*P,D=[],k=[];return xe.forEach(B=>{if("path"!==B.type)return;const{borderWidth:W,stampPoints:$,lineCap:Y}=B;if(2===$.length){const J=f0($[0],$[1],Dt(W).value,Y);D.push(J.x,J.x+J.width),k.push(J.y,J.y+J.height)}else{const J=yc($),X=Dt(W).value/2,ie=J.left-X,oe=J.top-X,ve=J.height+2*X;D.push(ie,ie+(J.width+2*X)),k.push(oe,oe+ve)}}),0===D.length?{offsetX:0,offsetY:0}:{offsetX:Math.min(...D)-b_x,offsetY:Math.min(...k)-b_y}}(j,z,te,se,ae);q.x+=ue.offsetX,q.y+=ue.offsetY}return q}(p,l,ne({},M),f,g,m))&&void 0!==H?H:V),{position:V,angle:L,scale:N}}function G6(p,l,u,f){const g=[];return p.forEach(m=>{g.push({x:m[0]*l,y:(f-m[1])*u})}),g}function Gie(p,l,u,f){const g=[];return p.forEach(m=>{g.push({x:m[0]*l,y:(f-m[1])*u,step:m[2]})}),g}function zd(p){return["butt","round","square"][null!=p?p:0]}function $d(p){return["miter","round","bevel"][null!=p?p:0]}function zn(p,l){return p.length<3?null:4===p.length?`rgba(${p.slice(0,3).join()},${p[3]/255/(l||1)})`:`rgb(${p.join()})`}function ml(p,l){return p&&0!==p.length?p.map(u=>u*l):[0,0]}function Zo(p){let l=[];for(let u=0;u<p.length;u++)p[u]instanceof Array?l=l.concat(Zo(p[u])):l.push(qe(p[u]));return l}function zie(p){return p>64&&p<91?p-65:p>96&&p<123?p-71:p>47&&p<58?p+4:43===p?62:47===p?63:0}function C0(p,l){if(!p)return"";let u="";return p.split(";").forEach(f=>{const g=f.split(":");g[0].trim()===l&&(u=g[1].trim())}),u}function NL(p){if(!p)return{contents:[],textStyle:{}};const l=new DOMParser,u='xmlns="http://www.w3.org/1999/xhtml"';let f=p;p.includes('xmlns="')||(f=p.replace(/<body/,`<body ${u}`)),f=K3(f,'xmlns=""',u);const g=l.parseFromString(f,"text/xml"),m=g.getElementsByTagName("body")[0],v=g.getElementsByTagName("span"),y=g.getElementsByTagName("p"),x=G=>{for(const z in G)null!=G[z]&&""!==G[z]||delete G[z];return G},{color:w,fontFamily:C,fontSize:_,fontWeight:T,fontStyle:M,textDecoration:L}=m.style,N=x({color:w,fontFamily:C,fontSize:_,fontWeight:T,fontStyle:M,lineThrough:L.includes("line-through"),underline:L.includes("word")||L.includes("underline")}),V=[];return(G=>{for(let z=0;z<G.length;z++){const q=G[z],{color:te,fontFamily:se,fontSize:ae,fontStyle:j,fontWeight:le}=q.style||{},ue=C0(q.getAttribute("style"),"text-decoration"),xe=x({content:q.textContent,color:te,fontFamily:se,fontSize:ae,fontWeight:le,fontStyle:j,lineThrough:ue.includes("line-through")||void 0,underline:ue.includes("word")||ue.includes("underline")||void 0});V.push(xe)}})(v.length?v:y),{textStyle:N,contents:V}}class $ie{constructor(){S(this,"pageWidth",void 0),S(this,"pageHeight",void 0),S(this,"ratioX",0),S(this,"ratioY",0)}setParserConfig(l,u,f,g){this.pageWidth=l,this.pageHeight=u,this.ratioX=f,this.ratioY=g}parseAnnotation(l){let u=null;switch(l.type){case"FreeText":u=l.intent&&"FreeText"!==l.intent?"freetexttypewriter"===l.intent.toLocaleLowerCase()?this.parseFreeText(l):this.parseIncomplete(l):this.parseTextBox(l);break;case"Circle":u=this.parseCircle(l);break;case"Square":u=this.parseRect(l);break;case"Line":u=l.intent&&"linedimension"===l.intent.toLocaleLowerCase()?this.parseIncomplete(l):this.parseLine(l);break;case"Polygon":u=!l.intent||"polygondimension"!==l.intent.toLocaleLowerCase()&&"polygoncloud"!==l.intent.toLocaleLowerCase()?this.parsePolygon(l):this.parseIncomplete(l);break;case"PolyLine":u=l.intent&&"polylinedimension"===l.intent.toLocaleLowerCase()?this.parseIncomplete(l):this.parsePolyline(l);break;case"Ink":u=this.parseInk(l);break;case"Stamp":u=this.parseStamp(l);break;case"Highlight":u=this.parseTextAssist(l,"highlight");break;case"StrikeOut":u=this.parseTextAssist(l,"strikeout");break;case"Underline":u=this.parseTextAssist(l,"underline");break;default:u=l.normalAppearance?this.parseIncomplete(l):this.parseUnknown(l)}if(u||(u=l.normalAppearance?this.parseIncomplete(l):this.parseUnknown(l)),u){var f;const{opacity:g}=l,m=u.style;if(u.raw=l,m.opacity=Ve(m.opacity)?m.opacity:null!=g?g:1,null!=l&&l.normalAppearance){const{blendMode:v}=l.normalAppearance;u.style.renderBlendMode=v.toLowerCase()}null!==(f=u)&&void 0!==f&&f.transform&&u.transform.angle<0&&(u.transform.angle+=360),u.uid=qt()}return u}parseFreeText(l){const{normalAppearance:u,richText:f,rect:g,defaultAppearanceData:m,defaultStyle:v}=l,{objs:y,transform:x,bbox:w}=u,{ratioX:C,ratioY:_,pageHeight:T}=this,{position:M,angle:L,scale:N}=xo(0===y.length?null:Zo(y),w,x,C,_,T,!1),{x:V,y:H}=M;let G;(Math.round(L)+360)/90%2==0?(G=(g[2]-g[0])*this.ratioX+12,G+V>this.pageWidth*this.ratioX&&(G=this.pageWidth*this.ratioX-V)):(G=(g[3]-g[1])*this.ratioY,G+V>this.pageHeight*this.ratioY&&(G=this.pageHeight*this.ratioY-V));const{fontName:z,fontSize:q,fontColor:te}=m,se={content:"",fontFamily:z,color:C0(v,"color")||`rgb(${te[0]},${te[1]},${te[2]})`,fontSize:q},ae=NL(f),j=[];return ae.contents.forEach(le=>{const ue=ne(ne(ne({},se),ae.textStyle),le),xe=Dt(ue.fontSize);ue.fontFamily=ue.fontFamily.replace(/^"|"$/g,""),(Ve(ue.fontSize)||"pt"===xe.unit)&&(ue.fontSize=xe.value*this.ratioX),j.push(ue)}),{type:"textTypewriter",style:{x:V,y:H,width:G,textContents:j},transform:{scale:N,angle:L},iconColor:se.color}}parseTextBox(l){const{normalAppearance:u,richText:f,defaultAppearanceData:g,defaultStyle:m,opacity:v}=l;if(!u)return null;const{objs:y,transform:x,bbox:w}=u;if(!y||0===y.length)return null;const{fillType:C,fillColor:_,dashArray:T,isStroke:M,lineWidth:L,strokeColor:N,segments:V}=y[0],{ratioX:H,ratioY:G,pageHeight:z}=this,{position:q,angle:te,scale:se}=xo(Zo(y),w,x,H,G,z,"path"===y[0].type),ae="path"===y[0].type?(V[1][0]-V[0][0]+L)*this.ratioX:(w[2]-w[0])*this.ratioX,j="path"===y[0].type?(V[2][1]-V[0][1]+L)*this.ratioY:(w[3]-w[1])*this.ratioY,{x:le,y:ue}=q,{fontName:xe,fontSize:I,fontColor:A}=g,P={content:"",fontFamily:xe,color:C0(m,"color")||`rgb(${A[0]},${A[1]},${A[2]})`,fontSize:I},O=NL(f);let b=C0(f,"text-align")||C0(m,"text-align");"justify-center"===b&&(b="justify");const D=[];if(O.contents.forEach(k=>{const U=ne(ne(ne({},P),O.textStyle),k),F=Dt(U.fontSize);U.fontFamily=U.fontFamily.replace(/^"|"$/g,""),(Ve(U.fontSize)||"pt"===F.unit)&&(U.fontSize=F.value*this.ratioX),D.push(U)}),0===D.length&&l.contents){const k=Fe(ne({},P),{content:l.contents});Ve(k.fontSize)&&(k.fontSize*=this.ratioX),D.push(k)}return{type:"textBox",style:{x:le,y:ue,width:ae,height:j,borderWidth:M?(L||1)*this.ratioX:0,borderColor:zn(N,v),background:C>0?zn(_,v):"",lineDash:ml(T,this.ratioX),textContents:D,textAlign:b},transform:{scale:se,angle:te},iconColor:P.color}}parseCircle(l){const{normalAppearance:u,opacity:f,color:m,interiorColor:v,borderStyle:y}=l,{objs:x,transform:w,bbox:C}=u,{ratioX:_,ratioY:T,pageHeight:M}=this;let L;if(0===x.length){var N;const{position:V,angle:H,scale:G}=xo(null,C,w,_,T,M,!1),{x:z,y:q}=V,te=(C[2]-C[0])*this.ratioX,se=(C[3]-C[1])*this.ratioY,ae=zn(m||[0,0,0],f),j=v?zn(v,f):"";L={type:"ellipse",style:{x:z,y:q,width:te,height:se,borderWidth:(null!==(N=null==y?void 0:y.width)&&void 0!==N?N:1)*this.ratioX,borderColor:ae,background:v?j:"",lineDash:ml(null==y?void 0:y.dash,this.ratioX)},transform:{angle:H,scale:G},iconColor:v?j:ae}}else{if("path"!==x[0].type)return null;{const{fillColor:V,strokeColor:H,lineWidth:G,dashArray:z,fillType:q,isStroke:te}=x[0],{position:se,angle:ae,scale:j}=xo(Zo(x),C,w,_,T,M),{x:le,y:ue}=se,xe=(C[2]-C[0])*this.ratioX,I=(C[3]-C[1])*this.ratioY,A=zn(H,f),P=zn(V,f);L={type:"ellipse",style:{x:le,y:ue,width:xe,height:I,borderWidth:te?(G||1)*this.ratioX:0,borderColor:A,background:q>0?P:"",lineDash:ml(z,this.ratioX)},transform:{angle:ae,scale:j},iconColor:q>0?P:A}}}return L}parseRect(l){const{normalAppearance:u,opacity:f,color:m,interiorColor:v,borderStyle:y}=l,{objs:x,transform:w,bbox:C}=u,{ratioX:_,ratioY:T,pageHeight:M}=this;let L;if(0===x.length){var N;const{position:V,angle:H,scale:G}=xo(null,C,w,_,T,M,!1),{x:z,y:q}=V,te=(C[2]-C[0])*this.ratioX,se=(C[3]-C[1])*this.ratioY,ae=zn(m||[0,0,0],f),j=v?zn(v,f):"";L={type:"rectangle",style:{x:z,y:q,width:te,height:se,borderWidth:(null!==(N=null==y?void 0:y.width)&&void 0!==N?N:1)*this.ratioX,borderColor:ae,background:j,lineDash:ml(null==y?void 0:y.dash,this.ratioX),lineCap:zd(0),lineJoin:$d(0)},transform:{scale:G,angle:H},iconColor:v?j:ae}}else{const{fillColor:V,strokeColor:H,lineWidth:G,dashArray:z,isStroke:q,fillType:te,segments:se,lineCap:ae,lineJoin:j}=x[0],{position:le,angle:ue,scale:xe}=xo(Zo(x),C,w,_,T,M),{x:I,y:A}=le,P=(se[1][0]-se[0][0]+G)*this.ratioX,O=(se[2][1]-se[0][1]+G)*this.ratioY,b=zn(H,f),D=zn(V,f);L={type:"rectangle",style:{x:I,y:A,width:P,height:O,borderWidth:q?(G||1)*this.ratioX:0,borderColor:b,background:te>0?D:"",lineDash:ml(z,this.ratioX),lineCap:zd(ae),lineJoin:$d(j)},transform:{scale:xe,angle:ue},iconColor:te>0?D:b}}return L}parseLine(l){const{normalAppearance:u,lineEnding:f,interiorColor:g,opacity:m}=l;if(!u)return null;const{objs:v,bbox:y}=u;let{transform:x}=u;if(0===v.length)return null;const{strokeColor:w,lineWidth:C,dashArray:_,lineCap:T,lineJoin:M,miterLimit:L,isStroke:N,segments:V}=v[0],{ratioX:H,ratioY:G,pageHeight:z}=this;if(1!==Math.abs(x[0])||1!==Math.abs(x[3])){const j=gl(y[0],y[1],x),le=gl(y[2],y[3],x);v.forEach(ue=>{ue.segments.forEach(xe=>{const I=gl(xe[0],xe[1],x);xe[0]=I[0],xe[1]=I[1]})}),y[0]=j[0],y[1]=j[1],y[2]=le[0],y[3]=le[1],x=[1,0,0,1,0,0]}const{position:q,angle:te,scale:se}=xo(Zo(v),y,x,H,G,z),ae=zn(w,m);return{type:"line",style:{startPoint:{x:V[0][0]*this.ratioX,y:(this.pageHeight-V[0][1])*this.ratioY},endPoint:{x:V[1][0]*this.ratioX,y:(this.pageHeight-V[1][1])*this.ratioY},lineEnding:f||["None","None"],borderColor:ae,borderWidth:N?(C||1)*this.ratioX:0,background:g?zn(g,m):"",lineCap:zd(T),lineJoin:$d(M),miterLimit:L,lineDash:ml(_,this.ratioX)},transform:{position:q,scale:se,angle:te},iconColor:ae}}parsePolygon(l){const{normalAppearance:u,opacity:f}=l,{objs:g,bbox:m}=u;let{transform:v}=u;if(0===g.length)return null;const{dashArray:y,fillColor:x,fillType:w,lineCap:C,lineJoin:_,lineWidth:T,miterLimit:M,segments:L,strokeColor:N}=g[0],{ratioX:V,ratioY:H,pageHeight:G}=this;if(1!==Math.abs(v[0])||1!==Math.abs(v[3])){const xe=gl(m[0],m[1],v),I=gl(m[2],m[3],v);g.forEach(A=>{A.segments.forEach(P=>{const O=gl(P[0],P[1],v);P[0]=O[0],P[1]=O[1]})}),m[0]=xe[0],m[1]=xe[1],m[2]=I[0],m[3]=I[1],v=[1,0,0,1,0,0]}const{position:z,angle:q,scale:te}=xo(Zo(g),m,v,V,H,G),se=G6(L,this.ratioX,this.ratioY,this.pageHeight),ae=zn(N,f),j=zn(x,f);var le,ue;return se.length>2&&(le=se[0]).x===(ue=se[se.length-1]).x&&le.y===ue.y&&se.pop(),{type:"polygon",style:{points:se,borderWidth:(T||0)*this.ratioX,borderColor:ae,background:w>0?j:"",lineDash:ml(y,this.ratioX),lineCap:zd(C),lineJoin:$d(_),miterLimit:M},transform:{position:z,scale:te,angle:q},iconColor:w>0?j:ae}}parsePolyline(l){const{normalAppearance:u,interiorColor:f,opacity:g}=l,{objs:m,bbox:v}=u;let{transform:y}=u;if(0===m.length)return null;const{dashArray:x,lineCap:w,lineJoin:C,lineWidth:_,miterLimit:T,segments:M,strokeColor:L,isStroke:N}=m[0],{ratioX:V,ratioY:H,pageHeight:G}=this;if(1!==Math.abs(y[0])||1!==Math.abs(y[3])){const j=gl(v[0],v[1],y),le=gl(v[2],v[3],y);m.forEach(ue=>{ue.segments.forEach(xe=>{const I=gl(xe[0],xe[1],y);xe[0]=I[0],xe[1]=I[1]})}),v[0]=j[0],v[1]=j[1],v[2]=le[0],v[3]=le[1],y=[1,0,0,1,0,0]}const{position:z,angle:q,scale:te}=xo(Zo(m),v,y,V,H,G),se=G6(M,this.ratioX,this.ratioY,this.pageHeight),ae=zn(L,g);return{type:"polyline",style:{points:se,borderWidth:N?(_||1)*this.ratioX:0,borderColor:ae,background:f?zn(f,g):"",lineDash:ml(x,this.ratioX),lineCap:zd(w),lineJoin:$d(C),lineEnding:l.lineEnding||["None","None"],miterLimit:T},transform:{position:z,scale:te,angle:q},iconColor:ae}}parseInk(l){const{normalAppearance:u,inkList:f,opacity:g}=l,{objs:m,transform:v,bbox:y}=u;if(0===m.length||!f)return null;const{dashArray:x,lineCap:w,fillColor:C,lineJoin:_,lineWidth:T,miterLimit:M,strokeColor:L,fillType:N,isStroke:V}=m[0],H=[];for(let le=0;le<f.length;le++){const ue=f[le],xe=[];for(let A=0;A<ue.length;A+=2)xe.push([ue[A],ue[A+1],1,!1]);const I=G6(xe,this.ratioX,this.ratioY,this.pageHeight);H.push(I)}const{ratioX:G,ratioY:z,pageHeight:q}=this,{position:te,angle:se,scale:ae}=xo(Zo(m),y,v,G,z,q),j=zn(L,g);return{type:"ink",style:{segments:H,borderWidth:V?(T||1)*this.ratioX:0,borderColor:j,background:N>0?zn(C,g):"",lineDash:ml(x,this.ratioX),lineCap:zd(w),lineJoin:$d(_),miterLimit:M},transform:{position:te,scale:ae,angle:se},iconColor:j}}parseStamp(l){const{icon:u,opacity:f}=l,{objs:g,transform:m,bbox:v}=l.normalAppearance;if(0===g.length)return null;const y=Zo(g),x=[],{ratioX:w,ratioY:C,pageHeight:_}=this,{position:T,angle:M,scale:L}=xo(y,v,m,w,C,_),N={position:T,angle:M,scale:L};for(let V=0;V<y.length;V++){let H;if("path"===y[V].type&&(H=ex(y[V],f,this.ratioX,this.ratioY,this.pageHeight)),"text"===y[V].type&&(H=W6(y[V],f,this.ratioX,this.ratioY,this.pageHeight)),"image"===y[V].type){let G;return G=y[V].jpegBase64?`data:image/jpeg;base64,${y[V].jpegBase64}`:FL(y[V].RGBABase64,y[V].width,y[V].height),{type:"stamp",style:{imageData:G,width:v[2]*this.ratioX,height:v[3]*this.ratioY},transform:N}}H&&x.push(H)}return{type:"stamp",style:{iconName:u,stampConfig:x},transform:N,iconColor:"#868E96"}}parseTextAssist(l,u){const{objs:f,transform:g,bbox:m}=l.normalAppearance,{opacity:v}=l;if(0===f.length)return null;const y=Zo(f),x=[],{ratioX:w,ratioY:C,pageHeight:_}=this,{position:T,angle:M,scale:L}=xo(y,m,g,w,C,_),N={position:T,angle:M,scale:L};for(let V=0;V<y.length;V++){let H;"path"===y[V].type&&(H=ex(y[V],v,this.ratioX,this.ratioY,this.pageHeight)),H&&x.push(H)}return{type:u,style:{opacity:v||1,stampConfig:x,annotationRaw:l},transform:N}}parseIncomplete(l){const{normalAppearance:u,opacity:f}=l;if(!u)return null;const{objs:g,transform:m,bbox:v}=l.normalAppearance;if(!g||0===g.length)return null;const y=Zo(g),x=[],{ratioX:w,ratioY:C,pageHeight:_}=this,{position:T,angle:M,scale:L}=xo(y,v,m,w,C,_),N={position:T,angle:M,scale:L};for(let V=0;V<y.length;V++){let H;if("path"===y[V].type)H=ex(y[V],f,w,C,_);else if("text"===y[V].type)H=W6(y[V],f,w,C,_);else if("image"===y[V].type){let G;return G=y[V].jpegBase64?`data:image/jpeg;base64,${y[V].jpegBase64}`:FL(y[V].RGBABase64,y[V].width,y[V].height),{type:"incomplete",style:{imageData:G,width:v[2]*this.ratioX,height:v[3]*this.ratioY,annotationRaw:l},transform:N}}H&&x.push(H)}return{type:"incomplete",style:{stampConfig:x,annotationRaw:l},transform:N}}parseUnknown(l){return{type:"unknown",style:{annotationRaw:l}}}}class Yie{constructor(){S(this,"map",new Map),S(this,"ratioX",yt.displayResolution/yt.pdfResolution),S(this,"ratioY",yt.displayResolution/yt.pdfResolution)}toPdfAnnotations(l,u){var f=this;return Q(function*(){const g=[],m=[...l];m.sort((v,y)=>v.layer-y.layer);for(let v=0;v<m.length;v++){const y=m[v];if(y){const x=yield f.toPdfAnnotation(y,{width:u.width/f.ratioX,height:u.height/f.ratioY});x&&(x.oriIndex=y.oriIndex,x.modified=y.modified,g.push(x))}}return g})()}toPdfAnnotation(l,u){var f=this;return Q(function*(){if("stamp"===l.type&&l.style.imageData&&(!Ve(l.style.width)||!Ve(l.style.height))){const v=new Od,y=yield v.readImageInfo({fileSource:l.style.imageData});let x=y.imageWidth,w=y.imageHeight;if(x>400||w>400){const C=Math.max(x/400,w/400);x/=C,w/=C}l.style.width=x,l.style.height=w}const g=f.createShape(l);if(g instanceof vi&&"freeTextWriter"===g.textType){const{width:v,height:y}=g.getBoundingRect();g.setOrigin(v/2,y/2)}let m=null;switch(l.type){case"rectangle":case"ellipse":m=f.toPdfRectOrEllipse(l,u,g);break;case"polyline":case"polygon":m=f.toPdfPolygonal(l,u,g);break;case"line":m=f.toPdfLine(l,u,g);break;case"ink":m=f.toPdfInk(l,u,g);break;case"stamp":m=yield f.toPdfStamp(l,u,g);break;case"textBox":m=f.toPdfFreeText(l,u,g,"textBox");break;case"textTypewriter":m=f.toPdfFreeText(l,u,g,"freeTextWriter");break;case"highlight":m=f.toPdfTextAssist(l,"Highlight",u,g);break;case"underline":m=f.toPdfTextAssist(l,"Underline",u,g);break;case"strikeout":m=f.toPdfTextAssist(l,"StrikeOut",u,g);break;case"incomplete":m=l.style.annotationRaw}return m&&(m.title=l.comment.author,m.subject=l.comment.subject,m.creationdate=l.comment.creationDate),m})()}toPdfRectOrEllipse(l,u,f){const{borderColor:g,background:m,lineDash:v}=l.style,{borderWidth:y,opacity:x}=f.parsedStyle,{strokeColor:w,fillColor:C}=up(g,m),{apStrokeColor:_,apFillColor:T}=jd(g,m,x),M=Hd(y,v,this.ratioX),L=M.width,V=Gd(f,T,_,x,L,"rectangle"===l.type?ML(f,L,this.ratioX,this.ratioY,u.height):function(H,G,z,q){const{x:te,y:se}=H.getLocalPosition();H.path||H.getPath();const{path:ae}=H,j=[];for(let le=0;le<ae.length;le++){const ue=(ae[le].x+te)/G,xe=q-(ae[le].y+se)/z;0===le?(j.push([ue,xe,2,!1]),j.push([ue,xe,0,!1])):j.push(le===ae.length-1?[ue,xe,1,!0]:[ue,xe,1,!1])}return j}(f,this.ratioX,this.ratioY,u.height),this.ratioX);return f.path||f.getPath(),{type:"rectangle"===l.type?"Square":"Circle",normalAppearance:V,interiorColor:C,color:w,borderStyle:M,opacity:x,rect:Ah(f,f.path,L,this.ratioX,this.ratioY,u.height),flags:Ih([...l.flags]),date:l.comment.modificationDate,name:l.uid,contents:""}}toPdfPolygonal(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:y,lineEnding:x,lineDash:w}=l.style,C="polyline"===l.type,{strokeColor:_,fillColor:T}=up(v,y),{apStrokeColor:M,apFillColor:L}=jd(v,y,m),N=Hd(g,w,this.ratioX),V=N.width;let H,G,z;C?(H=kL(f,this.ratioX,this.ratioY,u.height),G=H.flat(),z=PL(H[0])):(H=function(se,ae,j,le){se.renderPath||se.getPath();const{x:ue,y:xe}=se.getLocalPosition(),{renderPath:I}=se,A=[];for(let P=0;P<I.length;P++){const O=(I[P].x+ue)/ae,b=le-(I[P].y+xe)/j;if(0!==P){if(P===I.length-1){A.push([O,b,0,!0]);break}A.push([O,b,0,!1])}else A.push([O,b,2,!1])}return A}(f,this.ratioX,this.ratioY,u.height),G=H,z=PL(G));const q=Gd(f,L,M,m,V,G,this.ratioX,!C);if(C){const se=[];H.forEach(ae=>{se.push(fp(f,ae,L,M,V,Wd(w,this.ratioX)))}),q.objs=se}const te={type:C?"PolyLine":"Polygon",borderStyle:N,color:_,interiorColor:T,normalAppearance:q,vertices:z,opacity:m,rect:Ah(f,f.renderPath,V,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:Ih([...l.flags]),date:l.comment.modificationDate};return C&&f.isLineArrow()&&(te.lineEnding=x),te}toPdfLine(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:y,lineEnding:x,lineDash:w}=l.style,{strokeColor:C,fillColor:_}=up(v,y),{apStrokeColor:T,apFillColor:M}=jd(v,y,m),L=Hd(g,w,this.ratioX),N=L.width,V=kL(f,this.ratioX,this.ratioY,u.height),H=V.flat(),G=[];V.forEach(te=>{G.push(fp(f,te,M,T,N,Wd(w,this.ratioX)))});const z=Gd(f,M,T,m,N,H,this.ratioX,!1);z.objs=G;const q={type:"Line",line:[H[0][0],H[0][1],H[1][0],H[1][1]],interiorColor:_,color:C,normalAppearance:z,borderStyle:L,opacity:m,rect:Ah(f,f.renderPath,N,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:Ih([...l.flags]),date:l.comment.modificationDate,toJsonString:()=>""};return f.isLineArrow()&&(q.lineEnding=x,q.intent="LineArrow"),q}toPdfInk(l,u,f){const{borderWidth:g,opacity:m}=f.parsedStyle,{borderColor:v,background:y,lineDash:x}=l.style,{strokeColor:w}=up(v,y),{apStrokeColor:C,apFillColor:_}=jd(v,y,m),T=Hd(g,x,this.ratioX),M=T.width,L=function(se,ae,j,le){se.inkOriginalRenderPath||se.getInkOriginalRenderPath();const{x:ue,y:xe}=se.getLocalPosition(),{inkOriginalRenderPath:I}=se,A=[];for(let P=0;P<I.length;P++){const O=I[P],b=[];for(let D=0;D<O.length;D++){const k=(O[D].x+ue)/ae,U=le-(O[D].y+xe)/j;b.push(0===D?[k,U,2,!1]:[k,U,1,!1])}if(b.length&&b.length<4)for(;b.length<4;)b.push([...b[b.length-1]]);A.push(b)}return A}(f,this.ratioX,this.ratioY,u.height),N=L.flat(),V=[],{x:H,y:G}=f.getLocalPosition();f.getPath();const{inkRenderSteps:z}=f,q=[];z.forEach(se=>{const ae=[];se.forEach((j,le)=>{0===le?ae.push([(j.data[0].x+H)/this.ratioX,u.height-(j.data[0].y+G)/this.ratioY,2,!1]):j.data.forEach(ue=>{ae.push([(ue.x+H)/this.ratioX,u.height-(ue.y+G)/this.ratioY,1,!1])})}),q.push(ae)}),q.forEach(se=>{V.push(fp(f,se,_,C,M,Wd(x,this.ratioX)))});const te=Gd(f,_,C,m,M,N,this.ratioX,!1);return te.objs=V,{type:"Ink",color:w,normalAppearance:te,borderStyle:T,opacity:m,inkList:Uie(L),rect:Ah(f,f.inkOriginalRenderPath.flat(),M,this.ratioX,this.ratioY,u.height),name:l.uid,contents:"",flags:Ih([...l.flags]),date:l.comment.modificationDate}}toPdfStamp(l,u,f){var g=this;return Q(function*(){const{imageData:m,iconName:v,opacity:y}=l.style;if(m)return yield g.toPdfStampImage(l,u,f);const x=f.childNodes,w=OL(f,g.ratioX,g.ratioY,u.height),C=[],_=[];let T=0,M=0;for(let N=0;N<x.length;N++){let V;if(x[N].style.opacity=x[N].parsedStyle.opacity/(l.style.opacity||1),x[N]instanceof Y3){const G=RL(x[N]);_.push(...G);const{borderWidth:z,lineDash:q}=x[N].parsedStyle,{borderColor:te,background:se}=x[N].style,{apStrokeColor:ae,apFillColor:j}=jd(te,se,y),le=Hd(z,q,g.ratioX).width,ue=Hie(se,w[T]);M=Math.max(le,M),V=fp(x[N],w[T],j,ae,le,Wd(q,g.ratioX)),ue&&(V.pattern=ue),T+=1,C.push(V)}x[N]instanceof p0&&(V=Wie(x[N],g.ratioX,g.ratioY,u.height),C.push(V))}const L=Gd(f,null,null,y,M,w.flat(),g.ratioX,!1);return L.objs=C,{type:"Stamp",icon:v,rect:Ah(f,_,M,g.ratioX,g.ratioY,u.height),normalAppearance:L,opacity:y,name:l.uid,contents:"",flags:Ih([...l.flags]),date:l.comment.modificationDate}})()}toPdfStampImage(l,u,f){var g=this;return Q(function*(){const{imageData:m,opacity:v}=l.style;let y=m,x=[];nt(m)&&(x=m.split(","),x[0].match(/:(.*?);/),y=function(N){let V=null;const H=N.split(","),G=H[0].match(/:(.*?);/)[1],z=window.atob(H[1]);let q=z.length;const te=new Uint8Array(q);for(;q--;)te[q]=z.charCodeAt(q);return V=new Blob([te],{type:G}),V}(m));const{width:w,height:C}=f.parsedStyle,_=AL(f),T=[0,0,w.value/g.ratioX,C.value/g.ratioY],M=yield(N=Q(function*(V,H,G,z){const{width:q,height:te}=V.parsedStyle,se=q.value/G,ae=te.value/z;let j;if("image/jpeg"===H.type){const le=new Od,ue=yield le.readImage({source:{fileSource:H},outputType:1,returnBase64:!0});le.destroy(),j={type:"image",jpegBase64:ue.imageData,objMatrix:[se,0,0,ae,0,0],rect:[0,0,se,ae]}}else{const le=new Od,ue=yield le.readImage({source:{fileSource:H},outputType:-2,returnBase64:!0});le.destroy(),j={type:"image",RGBABase64:ue.imageData,height:ue.imageHeight,width:ue.imageWidth,objMatrix:[se,0,0,ae,0,0],rect:[0,0,se,ae]}}return j}),function(V,H,G,z){return N.apply(this,arguments)})(f,y,g.ratioX,g.ratioY),L=function(N,V,H,G){const{width:z,height:q}=N.parsedStyle,{x:te,y:se}=N.getLocalScale(),{x:ae,y:j}=N.getLocalPosition(),le=N.getAngle();let P=new Gn({style:{x:ae+z.value/2-z.value*te*.5,y:G*H-q.value*se-(G*H-q.value*se*.5-(j+q.value/2)),width:z.value*te,height:q.value*se}});P.setAngle(le),P.getPath();const O=Ah(P,P.path,0,V,H,G);return P=null,O}(f,g.ratioX,g.ratioY,u.height);var N;return{type:"Stamp",normalAppearance:{bbox:T,matrix:_,objs:[M],transform:_},rect:L,opacity:v,name:l.uid,contents:"",flags:Ih([...l.flags]),date:l.comment.modificationDate}})()}toPdfFreeText(l,u,f,g){const{opacity:m,textContents:v,borderColor:y,background:x,lineDash:w,textAlign:C}=l.style;"freeTextWriter"===g&&(f.style.borderWidth=0);const{borderWidth:_}=f.parsedStyle,{strokeColor:T,fillColor:M}=up(y,x),{apStrokeColor:L,apFillColor:N}=jd(y,x,m),V="textBox"===g?Hd(_,w,this.ratioX):{width:0},H=V.width,G=Gd(f,N,L,m,H,ML(f,H,this.ratioX,this.ratioY,u.height),this.ratioX,"textBox"===g),z=function(xe,I,A,P){const{lines:O}=xe,{opacity:b}=xe.parsedStyle,D=[],k=(U,F,B)=>({type:"path",strokeColor:U,fillColor:U,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:B,objMatrix:[1,0,0,1,0,0],segments:F,dashArray:[],dashPhase:0});return O.forEach(U=>{const F=U.height/30,B=xe.getTextAlignOffset(U);U.words.forEach(W=>{const{fontFamily:$,fontSize:Y,fontStyle:J,fontWeight:X,color:ie,underline:oe,lineThrough:de}=W.style,ve=dp(ie,1,!1),Ae=ve?[...ve,255*b]:[0,0,0,255],Ce=(W.x+B)/I,_e=P-U.y/A,ge={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:Ae,fontName:$,fontIsBold:LL(X),fontIsItalic:"italic"===J,fontSize:Y.value/I,text:(ce=W.text,ce.replace(/\r?\n$/,"")),objMatrix:[1,0,0,1,Ce,_e],position:[Ce,_e]};var ce;if(D.push(ge),oe){const be=P-(U.y+F)/A,Ie=k(Ae,[[Ce,be,2,!1],[Ce+W.widthWithoutLf/I,be,0,!1]],F/A);D.push(Ie)}if(de){const be=P-(U.y-W.wordHeight/3)/A,Ie=k(Ae,[[Ce,be,2,!1],[Ce+W.widthWithoutLf/I,be,0,!1]],F/A);D.push(Ie)}})}),D}(f,this.ratioX,this.ratioY,u.height);"textBox"===g?G.objs.push(...z):G.objs=z;const{defaultAppearance:q,defaultAppearanceData:te,defaultStyle:se}=function(xe,I,A,P,O){const b=A[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:D,fontSize:k,fontStyle:U,fontWeight:F,color:B}=b,W=dp(B,1,!1),$=V3(`rgb(${W[0]}, ${W[1]}, ${W[2]})`),Y=Dt(k).value/O,J=K3(D," ","");return{defaultAppearance:"textBox"===xe?`${I[0]/255} ${I[1]/255} ${I[2]/255} rg /${J} ${Y} Tf`:`${W[0]/255} ${W[1]/255} ${W[2]/255} rg /${J} ${Y} Tf`,defaultStyle:`font:${"bold"===F?"bold":""} ${"italic"===U?"italic":""} '${D}' ${Y}pt; text-align:${"justify"===P?"justify-center":P}; color:${$.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:W,fontSize:Y,fontName:D}}}(g,T||[0,0,0],v,"freeTextWriter"===g?"left":C,this.ratioX);f.getPath();const ae=Ah(f,f.path,H,this.ratioX,this.ratioY,u.height);let j="";v.forEach(xe=>{j+=xe.content});const le=function(xe,I,A){if(!xe||!xe.length)return null;const P=document.implementation.createDocument(null,"body",null),O=P.documentElement;O.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),O.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),O.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),O.setAttribute("xfa:spec","2.0.2");const b=Ce=>`font-size:${Dt(Ce).value/A}pt;`,D=Ce=>`font-weight:${"bold"===Ce?"bold":"normal"};`,k=Ce=>`font-style:${"italic"===Ce?"italic":"normal"};`,U=Ce=>`color:${V3(Sa(Ce).formatted)};`,F=Ce=>`font-family:'${Ce}';`,B=xe[0],{fontFamily:W,fontSize:$,fontStyle:Y,fontWeight:J,color:X}=B,ie=Sa(X),oe=`${b($)}text-align:${"justify"===I?"justify-center":I};${U(ie.formatted)}${D(J)}${k(Y)}${F(W)}font-stretch:normal;`;O.setAttribute("style",oe);const de=P.createElement("p");de.setAttribute("dir","ltr"),xe.forEach(Ce=>{if(!Ce.content.length)return;const _e=P.createElement("span"),ge=P.createTextNode(Ce.content);_e.appendChild(ge);let ce="";W!==Ce.fontFamily&&(ce+=F(Ce.fontFamily)),$!==Ce.fontSize&&(ce+=b(Ce.fontSize)),Y!==Ce.fontStyle&&(ce+=k(Ce.fontStyle)),J!==Ce.fontWeight&&(ce+=D(Ce.fontWeight)),X!==Ce.color&&(ce+=U(Ce.color)),(Ce.lineThrough||Ce.underline)&&(ce+=`text-decoration:${Ce.underline?"word":""} ${Ce.lineThrough?"line-through":""}`),ce&&_e.setAttribute("style",ce),de.appendChild(_e)}),O.appendChild(de);const ve=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(P)}`,Ae='xmlns="http://www.w3.org/1999/xhtml"';return ve.includes(Ae)?K3(ve,'xmlns=""',Ae):K3(ve.replace(/<body/,`<body ${Ae}`),'xmlns=""',Ae)}(v,C,this.ratioX),ue={borderStyle:V,type:"FreeText",color:M,normalAppearance:G,defaultAppearance:q,defaultAppearanceData:te,defaultStyle:se,rect:ae,name:l.uid,contents:j,opacity:m,flags:Ih([...l.flags]),date:l.comment.modificationDate};return"freeTextWriter"===g&&(ue.intent="FreeTextTypeWriter"),le&&(ue.richText=le),ue}toPdfTextAssist(l,u,f,g){if(l.style.annotationRaw)return l.style.annotationRaw;const{opacity:m}=l.style,v=g.childNodes,y=OL(g,this.ratioX,this.ratioY,f.height),x=[],w=[];for(let M=0;M<v.length;M++){const L=RL(v[M]);w.push(...L);const{borderWidth:N,lineDash:V}=v[M].parsedStyle,{borderColor:H,background:G}=v[M].style,{apStrokeColor:z,apFillColor:q}=jd(H,G,m),te=Hd(N,V,this.ratioX).width,se=fp(v[M],y[M],q,z,te,Wd(V,this.ratioX));x.push(se)}const C=Gd(g,null,null,m,0,y.flat(),this.ratioX,!1);C.objs=x;const _=Ah(g,w,0,this.ratioX,this.ratioY,f.height),T=[];return y.forEach(M=>{const L=[];M.forEach(q=>{L.push({x:q[0],y:q[1]})});const N=yc(L),{left:V,bottom:H,top:G,right:z}=N;T.push([V,H,z,H,V,G,z,G])}),{type:u,rect:_,normalAppearance:C,opacity:m,quadPoints:T,name:l.uid,flags:Ih([...l.flags]),date:l.comment.modificationDate}}createShape(l){const{type:u,transform:f,style:g}=qe(l),m={id:l.uid,style:g,transform:f};let v;switch("ellipse"===u&&(g.x+=g.width/2||0,g.y+=g.height/2||0,g.rx=g.width/2||g.rx,g.ry=g.height/2||g.ry),u){case"rectangle":v=new q3(m);break;case"ellipse":v=new Vd(m);break;case"line":v=new w0(m);break;case"ink":v=new Ta(m);break;case"polygon":v=new y0(m);break;case"polyline":v=new x0(m);break;case"textTypewriter":v=new vi(m,"freeTextWriter",{},!1);break;case"textBox":v=new vi(m,"textBox");break;case"stamp":v=new yo(m);break;case"highlight":v=new fl(m,Da.HIGHLIGHT);break;case"underline":v=new fl(m,Da.UNDERLINE);break;case"strikeout":v=new fl(m,Da.STRIKEOUT)}return v}}class BL{constructor(){S(this,"annotationParser",new $ie),S(this,"annotationWriter",new Yie)}getParsedAnnotations(l,u,f){const g=yt.displayResolution/yt.pdfResolution;l=l.filter(v=>null!==v),this.annotationParser.setParserConfig(u,f,g,g),this.moveReplyToAnnotation(l);const m=[];return l.forEach(v=>{if(v){const x=this.annotationParser.parseAnnotation(v);if(x){var y;x.flags=this.parseFlags(v.flags||[]);const w=this.parseReply(v);null!==(y=v.replies)&&void 0!==y&&y.length&&(w.replies=v.replies.map(C=>this.parseReply(C))||[]),x.comment=w,m.push(x)}}}),m}moveReplyToAnnotation(l){l.forEach(u=>{if(u&&"Text"===u.type&&!Se(u.inreplyto)){const f=l[u.inreplyto];"Review"===u.statemodel?(f.reviewStates||(f.reviewStates=[]),f.reviewStates.push(u)):"Marked"===u.statemodel?(f.markedStates||(f.markedStates=[]),f.markedStates.push(u)):(f.replies||(f.replies=[]),f.replies.push(u))}}),l.slice().forEach(u=>{if(!u||"Popup"===u.type||!Se(u.inreplyto)){const f=l.findIndex(g=>g===u);l.splice(f,1)}})}parseReply(l){var u,f;const g=this.parseCommon(l);return g.subject=l.subject,null!==(u=l.reviewStates)&&void 0!==u&&u.length&&(g.reviewStates=l.reviewStates.map(m=>this.parseState(m))),null!==(f=l.markedStates)&&void 0!==f&&f.length&&(g.markedStates=l.markedStates.map(m=>this.parseState(m))),g}parseFlags(l){const u=[],f={readonly:"readOnly",noview:"noView"};return l.forEach(g=>{u.push(f[g]||g)}),u}parseState(l){return Fe(ne({},this.parseCommon(l)),{state:l.state,stateModel:l.statemodel})}parseCommon(l){const u=l.creationdate,f=l.date;return{uid:qt(),author:l.title,contents:l.contents,type:l.type,creationDate:u||f,modifiedDate:f||u,flags:l.flags?[...l.flags]:[]}}parseDate(l){if(!l)return;let u=2;if(!l)return"";const f=[4,2,2,2,2,2].map(m=>{const v=l.slice(u,u+m);return u+=m,parseInt(v,10)});f[1]-=1;const g=new Date(...f).getTime();return l9("yyyy.MM.dd hh:mm:ss",g)}getOriginalAnnotations(l,u){var f=this;return Q(function*(){return yield f.annotationWriter.toPdfAnnotations(l,u)})()}}function tx(p){return{left:p[0],top:p[1],width:p[2]-p[0],height:p[3]-p[1]}}(function(p){p.CM_RENDERALL="cm/renderall",p.CM_IMAGEONLY="cm/imageonly",p.CM_AUTO="cm/auto"})(ir||(ir={})),function(p){p.NO_ANNOTATIONS="noAnnotations",p.RENDER_ANNOTATIONS="renderAnnotations",p.LOAD_ANNOTATIONS="loadAnnotations"}(pl||(pl={}));var ix=new WeakSet;class Xie{constructor(){Js(this,ix),S(this,"type","pdfParser"),S(this,"once",!1),S(this,"pdfReader",void 0),S(this,"parserOptions",{convertMode:ir.CM_AUTO}),S(this,"source",void 0),S(this,"isDestroy",!1),S(this,"annotationMapper",void 0),this.pdfReader=new k3,this.annotationMapper=new BL}initParser(l,u){this.parserOptions=null!=u?u:{convertMode:ir.CM_AUTO},this.source={fileSource:l,password:this.parserOptions.password}}getPageCount(){var l=this;return Q(function*(){return l.pdfReader.getPdfPageCount(l.source,ye(ix,l,z6).call(l))})()}destroy(){var l;null===(l=this.pdfReader)||void 0===l||l.destroy(),this.pdfReader=null,this.isDestroy=!0}parse(l){var u=this;return Q(function*(){if(u.isDestroy||!u.source)return null;const f=[],g=yield u.pdfReader.readPageImageInfos({source:u.source,indices:(null==l?void 0:l.slice())||[],readOptions:ye(ix,u,z6).call(u),outputType:Ls.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:m,pdfResolution:v}=yt;for(let C=0;C<g.length;++C){var y,x,w;const _=g[C],T=1===_.realReadMode,M=T?tx(_.mediaBox):{left:0,top:0,width:_.imageWidth/_.imageXResolution*v,height:_.imageHeight/_.imageYResolution*v},L=T?tx([_.cropBox[0],_.mediaBox[1]+_.mediaBox[3]-_.cropBox[3],_.cropBox[2],_.mediaBox[1]+_.mediaBox[3]-_.cropBox[1]]):ne({},M),N={fileIndex:_.pageIndex,rotation:_.rotation,mediaBox:bt(M,v,m),cropBox:bt(L,v,m),resource:{width:_.imageWidth,height:_.imageHeight,resolutionX:_.imageXResolution,resolutionY:_.imageYResolution,bitDepth:_.imageBitDepth},pdfOptions:{convertMode:T?ir.CM_RENDERALL:ir.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(y=u.parserOptions.renderOptions)||void 0===y?void 0:y.renderAnnotations,renderGrayscale:null===(x=u.parserOptions.renderOptions)||void 0===x?void 0:x.renderGrayscale}},annotations:[]};if(T&&(null===(w=u.parserOptions.renderOptions)||void 0===w?void 0:w.renderAnnotations)===pl.LOAD_ANNOTATIONS){const V=yield u.pdfReader.readAnnotations(u.source,N.fileIndex);V.length&&(N.annotations=u.annotationMapper.getParsedAnnotations(V,2*M.left+M.width,2*M.top+M.height))}f.push(N)}return f})()}getPage(l){var u=this;return Q(function*(){if(u.isDestroy||!u.source)return null;const f=yield u.pdfReader.readPage({source:u.source,index:l,readOptions:ye(ix,u,z6).call(u),outputType:Ls.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(f){const{displayResolution:g,pdfResolution:m}=yt,v=f.imageInfos[0];return{fileIndex:f.pageIndex,rotation:f.rotation,mediaBox:bt(tx(f.mediaBox),m,g),cropBox:bt(tx(f.cropBox),m,g),resource:{data:f.imageData,width:v.imageWidth,height:v.imageHeight,resolutionX:v.imageXResolution,resolutionY:v.imageYResolution,bitDepth:v.imageBitDepth}}}return null})()}cancelGetPage(l){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,l)}}function z6(){var p,l;if(this.isDestroy||!this.parserOptions)return null;const u={[pl.NO_ANNOTATIONS]:0,[pl.RENDER_ANNOTATIONS]:1,[pl.LOAD_ANNOTATIONS]:2};return{convertMode:{[ir.CM_IMAGEONLY]:2,[ir.CM_RENDERALL]:1,[ir.CM_AUTO]:3}[(null===(p=this.parserOptions)||void 0===p?void 0:p.convertMode)||ir.CM_AUTO],renderOptions:Fe(ne({},this.parserOptions.renderOptions||{}),{renderAnnotations:u[null===(l=this.parserOptions.renderOptions)||void 0===l?void 0:l.renderAnnotations]||0,renderIgnoreCrop:!0})}}class qie{constructor(){S(this,"type","rgbaParser"),S(this,"once",!1),S(this,"processor",void 0),S(this,"cachePage",[]),S(this,"source",void 0),S(this,"parserOptions",void 0),this.processor=new Ch}initParser(l,u){this.source=l,this.parserOptions=u}getPageCount(){return Q(function*(){return 1})()}destroy(){var l;null===(l=this.processor)||void 0===l||l.terminate(),this.processor=void 0}parse(){var l=this;return Q(function*(){var u;const{outputType:f,jpegQuality:g,width:v,height:y,bitDepth:x,xResolution:w,yResolution:C}=null!==(u=l.parserOptions)&&void 0!==u?u:{},_=yield l.source.arrayBuffer();yield l.processor.initImage({source:_,isRGBA:!0,width:v,height:y,isBGRA:!1});const M=hp(yield l.processor.getImage({jpegQuality:g,ifDeleteObject:!0,isRGBA:!0,bitDepth:x,xDpi:w,yDpi:C,returnBlob:!0,returnType:f}));return l.cachePage=[M],l.cachePage})()}getPage(){var l=this;return Q(function*(){return Promise.resolve(l.cachePage[0])})()}cancelGetPage(l){}}class UL{constructor(){S(this,"db",void 0),this.db=new Map}saveByMime(l,u){this.db.set(l,u)}hasByMime(l){return this.db.has(l)}deleteConstructorByMime(l){return!!this.hasByMime(l)&&(this.db.delete(l),!0)}getConstructorByMime(l){return this.db.get(l)}has(l){throw new Error("Method not implemented.")}save(l){throw new Error("Method not implemented.")}clear(){this.db.clear()}}const pp=new class{constructor(){S(this,"db",void 0),this.db=new Map}saveByFileUid(p,l){this.db.set(p,l)}getParserByFileUid(p){return this.db.get(p)}deleteParserByFileUid(p){return this.db.delete(p)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}getAllParsers(){return Array.from(this.db.values())}},nx=new UL,b0=new UL,_0=new class{constructor(){S(this,"db",void 0),this.db=new Map}getDefaultOptionsByMime(p){return this.db.get(p)}deleteDefaultOptionsByMime(p){return this.db.delete(p)}saveDefaultOptionsByMime(p,l){this.db.set(p,l)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}},$6=new class{constructor(p,l,u){S(this,"parserRepo",void 0),S(this,"parserConstructorRepo",void 0),S(this,"customParserConstructorRepo",void 0),this.parserRepo=p,this.parserConstructorRepo=l,this.customParserConstructorRepo=u}getParser(p,l){let u=this.parserRepo.getParserByFileUid(p);return u||(u=new(this.customParserConstructorRepo.getConstructorByMime(l)||this.parserConstructorRepo.getConstructorByMime(l)),u.once||this.parserRepo.saveByFileUid(p,u),u)}}(pp,nx,b0),Zie=new class{constructor(p){S(this,"parserRepo",void 0),this.parserRepo=p}execute(p){let{fileIndex:l,fileUid:u}=p;const f=this.parserRepo.getParserByFileUid(u);f&&f.cancelGetPage(l)}}(pp),Jie=new class{constructor(p){S(this,"parserRepo",void 0),this.parserRepo=p}execute(p){const l=this.parserRepo.getParserByFileUid(p);l&&(l.destroy(),this.parserRepo.deleteParserByFileUid(p))}}(pp),Qie=new class{constructor(p,l){S(this,"parserService",void 0),S(this,"parserRepo",void 0),this.parserService=p,this.parserRepo=l}execute(p){var l=this;return Q(function*(){const{fileData:u,mime:f,fileUid:g,fileIndex:m}=p;let v=l.parserRepo.getParserByFileUid(g);return v||(v=l.parserService.getParser(g,f),v.initParser(u)),v.getPage(m)})()}}($6,pp),Kie=new class{constructor(p,l){S(this,"parserService",void 0),S(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=l}execute(p){var l=this;return Q(function*(){const{fileData:u,mime:f,fileUid:g,indices:m}=p;let{parseOptions:v}=p;v=v||l.defaultParserOptionsRepo.getDefaultOptionsByMime(f);const y=l.parserService.getParser(g,f);return y.initParser(u,v),y.parse(m)})()}}($6,_0),ene=new class{constructor(p){S(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){let{mime:l,parser:u}=p;this.parserConstructorRepo.saveByMime(l,u)}}(nx),tne=new class{constructor(p){S(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){this.parserConstructorRepo.deleteConstructorByMime(p)}}(b0),ine=new class{constructor(p){S(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){let{mime:l,parser:u}=p;this.customParserConstructorRepo.saveByMime(l,u)}}(nx),nne=new class{constructor(p){S(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){this.customParserConstructorRepo.deleteConstructorByMime(p)}}(b0),sne=new class{constructor(p){S(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=p}execute(p){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(p)}}(_0),rne=new class{constructor(p,l,u){S(this,"defaultParserOptionsRepo",void 0),S(this,"parserConstructorRepo",void 0),S(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=p,this.parserConstructorRepo=l,this.customParserConstructorRepo=u}execute(p){let{mime:l,options:u}=p;return!(!u||!vt(u)||!this.customParserConstructorRepo.hasByMime(l)&&!this.parserConstructorRepo.hasByMime(l)||(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(l,qe(u)),0))}}(_0,nx,b0),one=new class{constructor(p){S(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){return this.customParserConstructorRepo.getConstructorByMime(p)}}(b0),ane=new class{constructor(p,l){S(this,"parserService",void 0),S(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=l}execute(p){var l=this;return Q(function*(){var u,f;let{fileData:g,mime:m,fileUid:v,options:y}=p;y=y||l.defaultParserOptionsRepo.getDefaultOptionsByMime(m);const x=l.parserService.getParser(v,m);return x.initParser(g,y),{pageCount:yield x.getPageCount(),batchSize:null!==(u=null===(f=y)||void 0===f?void 0:f.batchSize)&&void 0!==u?u:0}})()}}($6,_0);class lne{constructor(){S(this,"type",void 0),S(this,"once",!1),S(this,"cachedPage",void 0),S(this,"parserOptions",void 0)}initParser(l,u){this.parserOptions=u}getPageCount(){return Q(function*(){return Promise.resolve(1)})()}destroy(){}parse(){var l=this;return Q(function*(){const{width:u,height:f,bitDepth:g,resolutionX:m,resolutionY:v}=l.parserOptions,y=hp({imageBitDepth:g,imageHeight:f,imageWidth:u,imageXResolution:m,imageYResolution:v});return l.cachedPage=y,[l.cachedPage]})()}getPage(){var l=this;return Q(function*(){const u=yield l.createBlankPage(l.parserOptions.width,l.parserOptions.height);return l.cachedPage.resource.data=u,l.cachedPage})()}cancelGetPage(){}createBlankPage(l,u){var f=this;return Q(function*(){var g,m,v;const y=new Uint8Array([255,255,255,255]),x=new Ch;yield x.initImage({source:y,isRGBA:!0,width:1,height:1,isBGRA:!1}),yield x.resize(l,u);const w=yield x.getImage({jpegQuality:null!==(g=f.parserOptions.jpegQuality)&&void 0!==g?g:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(m=f.parserOptions.resolutionX)&&void 0!==m?m:96,yDpi:null!==(v=f.parserOptions.resolutionY)&&void 0!==v?v:96,returnBlob:!1,returnType:o0[Ri.JPEG]});return new Blob([w.imageData],{type:w.blobType})})()}}var Ns;!function(p){p.GOOD="Good",p.AUTO_CAPTURE="AutoCaptured",p.SMALL_SIZE="SmallSize",p.OFF_CENTER="OffCenter",p.SKEW="Skew",p.NOTHING_DETECTED="NothingDetected"}(Ns||(Ns={}));var hs,Bs=new WeakSet;class VL{constructor(){Js(this,Bs),S(this,"detector",void 0),S(this,"succeedDetect",0),S(this,"failedDetect",0),S(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0}destroy(){this.clear()}clear(){var l;null===(l=this.detector)||void 0===l||l.terminate(),this.detector=void 0}detect(l,u){return Q(function*(){return Promise.resolve({success:!1})})()}getStatusMsg(l){switch(l){case Ns.AUTO_CAPTURE:return"Auto capture completed.";case Ns.GOOD:return"Capturing your document... Please do not move the camera.";case Ns.SMALL_SIZE:return"The document is too small. Try moving closer.";case Ns.OFF_CENTER:return"Try holding the device at the center of the document.";case Ns.SKEW:return"Please hold the device over a document to start scanning.";case Ns.NOTHING_DETECTED:return"No document is detected."}}processDetectResult(l){if([].concat(...l.location).every(w=>0===w))return{success:!1,confidence:0,status:Ns.NOTHING_DETECTED};let u;const f=this.calculateConfidence(l.location,l.width,l.height);u=Se(l.confidence)?this.calculateTotalConfidence(f):l.confidence;const g={success:!0,location:l.location,confidence:u},{angleConfidence:m,areaConfidence:v,centerConfidence:y}=f,{config:x}=l;return u>=(null==x?void 0:x.acceptedPolygonConfidence)?(this.succeedDetect+=1,g.status=Ns.GOOD,null!=x&&x.enableAutoCapture?this.autoCaptureStartTime<=0?this.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-this.autoCaptureStartTime>x.autoCaptureDelay&&(this.autoCaptureStartTime=0,g.status=Ns.AUTO_CAPTURE):this.autoCaptureStartTime=0):.45*m+.45*y+10>=(null==x?void 0:x.acceptedPolygonConfidence)?(this.reset(),g.status=Ns.SMALL_SIZE):.45*m+.45*v+10>=(null==x?void 0:x.acceptedPolygonConfidence)?(this.reset(),g.status=Ns.OFF_CENTER):.45*v+.45*y+10>=(null==x?void 0:x.acceptedPolygonConfidence)?(this.reset(),g.status=Ns.SKEW):(g.success=!1,g.status=Ns.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0),this.failedDetect>5&&this.reset(),g.statusMsg=this.getStatusMsg(g.status),g}calculateConfidence(l,u,f){return ye(Bs,this,hne).call(this,ye(Bs,this,cne).call(this,l),u,f)}calculateTotalConfidence(l){const{angleConfidence:u,areaConfidence:f,centerConfidence:g}=l;return u&&f&&g?.3*u+.3*f+.3*g+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0}}function cne(p){return p?[p[0][0],p[0][1],p[1][0],p[1][1],p[2][0],p[2][1],p[3][0],p[3][1]]:[0,0,0,0,0,0,0,0]}function hne(p,l,u){return{angleConfidence:ye(Bs,this,dne).call(this,p),areaConfidence:ye(Bs,this,une).call(this,p,l,u),centerConfidence:ye(Bs,this,fne).call(this,p,l,u)}}function dne(p){let l=0;const u=ye(Bs,this,rx).call(this,[p[0],p[1]],[p[2],p[3]],[p[4],p[5]]),f=ye(Bs,this,rx).call(this,[p[2],p[3]],[p[4],p[5]],[p[6],p[7]]),g=ye(Bs,this,rx).call(this,[p[4],p[5]],[p[6],p[7]],[p[0],p[1]]),m=ye(Bs,this,rx).call(this,[p[6],p[7]],[p[0],p[1]],[p[2],p[3]]);return l+=Math.abs(u-90),l+=Math.abs(f-90),l+=Math.abs(g-90),l+=Math.abs(m-90),Math.max(0,100*Math.min(1,1-.025*l))}function une(p,l,u){const f=ye(Bs,this,pne).call(this,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7]);return Math.min(100,400*Math.max(0,f/(l*u)))}function fne(p,l,u){const f=[(p[0]+p[2]+p[4]+p[6])/4,(p[1]+p[3]+p[5]+p[7])/4],g=ye(Bs,this,sx).call(this,f,[l/2,u/2]);return Math.max(0,100*Math.min(1,1-g/Math.min(l,u)))}function sx(p,l){return Math.sqrt((l[0]-p[0])*(l[0]-p[0])+(l[1]-p[1])*(l[1]-p[1]))}function rx(p,l,u){const f=ye(Bs,this,sx).call(this,l,p),g=ye(Bs,this,sx).call(this,l,u),m=ye(Bs,this,sx).call(this,p,u);return 0===f||0===g?0:Math.acos((f*f+g*g-m*m)/(2*f*g))/Math.PI*180}function jL(p,l,u,f,g,m){return(p*f+l*g+u*m-g*f-m*p-u*l)/2}function pne(p,l,u,f,g,m,v,y){return ye(Bs,this,jL).call(this,p,l,u,f,g,m)+ye(Bs,this,jL).call(this,p,l,g,m,v,y)}!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert",p.BRIGHTNESS="brightness",p.CONTRAST="contrast",p.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast"}(hs||(hs={}));var Yd=new WeakMap,ox=new WeakMap,ax=new WeakSet;function gne(p,l,u,f){return Y6.apply(this,arguments)}function Y6(){return Y6=Q(function*(p,l,u,f){var g;return yield null===(g=this.filter)||void 0===g?void 0:g.applyFilter(p,l)}),Y6.apply(this,arguments)}function mne(p){return ee(Yd,this).push(p),ee(ox,this)||(gt(ox,this,!0),ye(ax,this,vne).call(this)),p.promise}function vne(){return X6.apply(this,arguments)}function X6(){return X6=Q(function*(){do{if(ee(Yd,this).isEmpty())break;const p=ee(Yd,this).pop();try{let l;"filter"===(null==p?void 0:p.api)&&(l=yield ye(ax,this,gne).apply(this,p.params)),null==p||p.resolve(l)}catch(l){p.retry<1?(p.retry+=1,ee(Yd,this).push(p)):null==p||p.reject(l)}}while(!ee(Yd,this).isEmpty());gt(ox,this,!1)}),X6.apply(this,arguments)}const HL=new Map([[hs.NONE,"None"],[hs.BLACK_AND_WHITE,"toBW"],[hs.GRAY,"toGray"],[hs.REMOVE_SHADOW,"removeShadow"],[hs.SAVE_INK,"toBW"],[hs.ENHANCE,"enhance"],[hs.INVERT,"invert"],[hs.CONTRAST,"brightnessAndContrast"],[hs.BRIGHTNESS,"brightnessAndContrast"],[hs.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var $n,q6=new WeakSet;function yne(p,l){const u=ne({},l||{});return p===hs.SAVE_INK&&(u.method="adaptiveThreshold"),u}function xne(p){var l,u;return p.returnType=o0[p.outputType],p.bRGBA=p.outputType===Ri.RGBA,p.returnBlob=null!==(l=p.returnBlob)&&void 0!==l&&l,p.returnType=p.bRGBA&&void 0===p.returnType?Ls.IT_JPG:null!==(u=p.returnType)&&void 0!==u?u:Ls.IT_ALL,p.is1BitTo8Bit=Ke.isApple,p}class fe{static replaceMessage(l,u,f){let g=l;return u&&(g=g.replace("<%api%>",u)),f&&(g=g.replace("<%param%>",f)),g}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null}static buildError(l,u,f){if(l&&!l.code&&l.cause&&l.cause.code&&l.cause.message)return nt(l.message)&&(l.message=this.replaceMessage(l.message,u,f)),l;const g={code:l.code,message:l.message};null!=l&&l.details&&(g.details=l.details);let m=ne({},l);return g.code>-8e4&&0!==g.code?g.code<=-2e4||(g.code=fe.WASM_ERR.code,g.message=fe.WASM_ERR.message,m.actualCode=m.code,m.code=g.code):g.code?(g.message=this.replaceMessage(g.message,u,f),m=ne({},g),Array.isArray(g.details)&&0!==g.details.length&&(m.details=g.details)):(g.code=fe.EXTERNAL_ERR.code,g.message=fe.EXTERNAL_ERR.message,m.actualCode=l.code,m.message=l.message,l.name&&(m.name=l.name),l.stack&&(m.stack=l.stack),m.code=g.code,m.actualError=l),new Error(g.message,{cause:m})}static warning(l,u,f){const g=fe.buildError(l,u,f);this.lastError=g,this.onWarning.emit(g)}static error(l,u,f){const g=fe.buildError(l,u,f);throw this.lastError=g,this.onError.emit(g),g}static verbose(l,u,f){this.onVerbose.emit(l)}static throw(l,u,f){const g=fe.buildError(l,u,f);throw this.lastError=g,this.onError.emit(g),g}static reject(l,u,f){const g=fe.buildError(l,u,f);return this.lastError=g,this.onError.emit(g),Promise.reject(g)}static on(l,u){"error"===l?this.onError.on(u):"verbose"===l?(this.onVerbose.on(u),0===this.verboseListenerCount&&(Ke.enableDebugOutput(!0,f=>{this.verbose(f)}),this.verboseListenerCount+=1)):"warning"===l&&this.onWarning.on(u)}static off(l,u){"error"===l?this.onError.off(u):"verbose"===l?(this.onVerbose.off(u),this.verboseListenerCount-=1,0===this.verboseListenerCount&&Ke.enableDebugOutput(!1,void 0)):"warning"===l&&this.onWarning.off(u)}}function tt(p,l,u,f){return l?u?`${l}${f?"":"."}${u}`:`${l}`:u?`${p}${f?"":"."}${u}`:`${p}`}S(fe,"onError",new Sn),S(fe,"onWarning",new Sn),S(fe,"onVerbose",new Sn),S(fe,"verboseListenerCount",0),S(fe,"lastError",void 0),S(fe,"LIC_EMPTY",{code:-8e4,message:"No license."}),S(fe,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),S(fe,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),S(fe,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),S(fe,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),S(fe,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),S(fe,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),S(fe,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),S(fe,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),S(fe,"WASM_ERR",{code:-81e3,message:"WASM Error"}),S(fe,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),S(fe,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),S(fe,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),S(fe,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),S(fe,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),S(fe,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),S(fe,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),S(fe,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),S(fe,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),S(fe,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),S(fe,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),S(fe,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),S(fe,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),S(fe,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),S(fe,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),S(fe,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),S(fe,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),S(fe,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),S(fe,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),S(fe,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),S(fe,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),S(fe,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),S(fe,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),S(fe,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),S(fe,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),S(fe,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),S(fe,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),S(fe,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),S(fe,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),S(fe,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),S(fe,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),S(fe,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),S(fe,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),S(fe,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),S(fe,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),S(fe,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),S(fe,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),S(fe,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class Te{static makeSureValid(l,u,f,g){const m=this.composeError(f,g);fe.throw(m,l,u)}static output(l,u,f,g,m){let v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=this.composeError(g,m);return 2===l?fe.reject(y,u,f):1===l?(fe.warning(y,u,f),v):0===l?fe.error(y,u,f):3===l?fe.verbose(y,u,f):void 0}static error(l,u,f,g){const m=this.composeError(f,g);fe.throw(m,l,u)}static warning(l,u,f,g){let m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const v=this.composeError(f,g);return fe.warning(v,l,u),m}static verbose(l,u,f,g){const m=this.composeError(f,g);fe.verbose(m,l,u)}static reject(l,u,f,g){const m=this.composeError(f,g);return fe.reject(m,l,u)}static composeError(l,u){const f=ne({},Se(u)?fe.PARAM_INVALID:u);return l&&(f.details=l),f}static formatDetails(l,u){const f=[];if(Jn(u))u||f.push(`'${l}' is invalid.`);else{const{isValid:g,isInRange:m,isSupported:v}=u;!1===g&&f.push(`'${l}' is invalid.`),!1===m&&f.push(`'${l}' is out of range.`),!1===v&&f.push(`'${l}' is not supported.`)}return f}static formatError(l,u){const{isValid:f,isInRange:g,isSupported:m}=l;if(!1===f||!1===g||!1===m){if(u)return u;if(!f)return fe.PARAM_INVALID;if(!g)return fe.PARAM_OUT_OF_RANGE;if(!m)return fe.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(l){return b3(l)||er(l)}static isArrayAndMeetMinLength(l,u){return Xt(l)?Ve(u)?{isValid:0!==l.length,isInRange:l.length>=u}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(l,u,f){return Ve(l)?{isValid:!0,isInRange:!(!Se(u)&&l<u||!Se(f)&&l>f)}:{isValid:!1}}static isStringAndNotEmpty(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return nt(l)?u?{isValid:!0}:{isValid:0!==l.trim().length}:{isValid:!1}}static isPdfDate(l){if(!nt(l))return{isValid:!1};const u=l.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let f=!1;if(u){const[,g,m,v,y,x,w,C,_,T]=u,M=new Date(`${g}-${m}-${v}T${y}:${x}:${w}`);if(f=!0,M.getFullYear()===parseInt(g,10)&&M.getMonth()+1===parseInt(m,10)&&M.getDate()===parseInt(v,10)&&M.getHours()===parseInt(y,10)&&M.getMinutes()===parseInt(x,10)&&M.getSeconds()===parseInt(w,10)||(f=!1),f&&C){const L=parseInt(_,10),N=parseInt(T,10);(L<0||L>12||N<0||N>59||"+"!==C&&"-"!==C)&&(f=!1)}}return{isSupported:f}}}!function(p){p[p.BlackAndWhite=1]="BlackAndWhite",p[p.Gray=2]="Gray",p[p.RemoveShadow=3]="RemoveShadow",p[p.Enhance=4]="Enhance",p[p.Invert=5]="Invert",p[p.Brightness=6]="Brightness",p[p.Contrast=7]="Contrast",p[p.BrightnessAndContrast=8]="BrightnessAndContrast",p[p.Perspective=9]="Perspective",p[p.Deskew=10]="Deskew",p[p.Rotate=11]="Rotate",p[p.Flip=12]="Flip",p[p.Resize=13]="Resize",p[p.SetHeight=14]="SetHeight",p[p.SetWidth=15]="SetWidth",p[p.SetDPI=16]="SetDPI",p[p.Crop=17]="Crop",p[p.Erase=18]="Erase",p[p.DrawPolygon=19]="DrawPolygon"}($n||($n={}));var Z6=new WeakSet;class wne{constructor(){Js(this,Z6)}process(l,u,f){var g=this;return Q(function*(){Xt(u)||(u=[u]),ye(Z6,g,Cne).call(g,u);const m=new Ch,v={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var y,x,w,C;const _=yield m.initImage({source:l.data,isRGBA:l.type===Ri.RGBA,width:l.width,height:l.height,isBGRA:l.type===Ri.BGRA});_.srcBuffer&&(l.data=_.srcBuffer);for(const M of u)ye(Z6,g,bne).call(g,m,M);const T=yield m.getImage({jpegQuality:null==f||null===(y=f.params)||void 0===y?void 0:y.jpegQuality,ifDeleteObject:!0,isRGBA:l.type===Ri.RGBA,bitDepth:null==f||null===(x=f.params)||void 0===x?void 0:x.bitDepth,xDpi:null==f||null===(w=f.params)||void 0===w?void 0:w.xDpi,yDpi:null==f||null===(C=f.params)||void 0===C?void 0:C.yDpi,returnBlob:!1,returnType:o0[null==f?void 0:f.type]});yield m.freeReservedData(),v.output=T.imageData,v.outputContentType=T.blobType,v.outputImageInfo={width:T.imageWidth,height:T.imageHeight,bitDepth:T.imageBitDepth,resolutionX:T.imageXResolution,resolutionY:T.imageYResolution},v.outputType=qee[T.imageType]}finally{try{yield m.terminate()}catch(_){fe.warning(_)}}return v})()}}function Cne(p){for(const l of p);}function bne(p,l){return J6.apply(this,arguments)}function J6(){return J6=Q(function*(p,l){var u;const f=null!==(u=l.params)&&void 0!==u?u:{};switch(l.type){case $n.BlackAndWhite:return p.toBinaryLevel(f.saveInk,f.level);case $n.Gray:return p.toGrayscale(f.level);case $n.RemoveShadow:return p.removeShadowLevel(f.level,f.alpha);case $n.Enhance:return p.brighten();case $n.Invert:return p.invert();case $n.Contrast:return p.changeBrightnessAndContrast(void 0,f.contrast);case $n.Brightness:return p.changeBrightnessAndContrast(f.brightness,void 0);case $n.BrightnessAndContrast:return p.changeBrightnessAndContrast(f.brightness,f.contrast);case $n.Perspective:return p.perspective(f.location);case $n.Deskew:{var g;const m=yield p.getSkewAngle(f.options);return p.rotate({angle:m,fillColor:f.fillColor,keepSize:null===(g=f.keepSize)||void 0===g||g,mode:f.mode})}case $n.Rotate:return p.rotate({angle:f.angle,fillColor:f.fillColor,keepSize:f.keepSize,mode:f.mode});case $n.Flip:return p.flip();case $n.Resize:{const{newWidth:m,newHeight:v,mode:y}=f;return p.resize(m,v,y)}case $n.SetHeight:{const{newHeight:m,fillColor:v}=f;return p.setImageHeight(m,v)}case $n.SetWidth:{const{newWidth:m,fillColor:v}=f;return p.setImageWidth(m,v)}case $n.SetDPI:return p.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:f.xRes,resolutionY:f.yRes,resample:!1});case $n.Crop:return p.crop({left:f.left,top:f.top,width:f.right-f.left,height:f.bottom-f.top});case $n.Erase:return p.erase({left:f.left,top:f.top,width:f.right-f.left,height:f.bottom-f.top},f.fillColor);case $n.DrawPolygon:return p.drawQuadrangle({location:f.location,strokeColor:f.strokeColor,lineWidth:f.lineWidth})}}),J6.apply(this,arguments)}!Rd&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!Rd&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const WL=function(){var p=Q(function*(l,u,f){if(!l._bNeverShowDialog)try{let g=yield fetch(l.engineResourcePath+"dls.license.dialog.html");if(!g.ok)throw Error("Get license dialog fail. Network Error: "+g.statusText);let m=yield g.text();if(!m.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let v=document.createElement("div");v.innerHTML=m;let y=[];for(let V=0;V<v.childElementCount;++V){let H=v.children[V];H instanceof HTMLStyleElement&&(y.push(H),document.head.append(H))}let x=1==v.childElementCount?v.children[0]:v;x.remove();let w,C,_,T,M,L=[x],N=x.children;for(let V of N)L.push(V);for(let V=0;V<L.length;++V)for(let H of L[V].children)L.push(H);for(let V of L)if(!w&&V.classList.contains("dls-license-mask"))w=V,V.addEventListener("click",H=>{if(V==H.target){x.remove();for(let G of y)G.remove()}});else if(!C&&V.classList.contains("dls-license-icon-close"))C=V,V.addEventListener("click",()=>{x.remove();for(let H of y)H.remove()});else if(!_&&V.classList.contains("dls-license-icon-error"))_=V,"error"!=u&&V.remove();else if(!T&&V.classList.contains("dls-license-icon-warn"))T=V,"warn"!=u&&V.remove();else if(!M&&V.classList.contains("dls-license-msg-content")){M=V;let H=f;for(;H;){let G=H.indexOf("["),z=H.indexOf("]",G),q=H.indexOf("(",z),te=H.indexOf(")",q);if(-1==G||-1==z||-1==q||-1==te){V.appendChild(new Text(H));break}G>0&&V.appendChild(new Text(H.substring(0,G)));let se=document.createElement("a"),ae=H.substring(G+1,z);se.innerText=ae;let j=H.substring(q+1,te);se.setAttribute("href",j),se.setAttribute("target","_blank"),V.appendChild(se),H=H.substring(te+1)}}document.body.appendChild(x)}catch(g){l._onLog&&l._onLog(g.message||g)}});return function(u,f,g){return p.apply(this,arguments)}}();var gp=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(p){return}}();function GL(p,l){p=p||[],l=l||{};try{return new Blob(p,l)}catch(g){if("TypeError"!==g.name)throw g;for(var u=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),f=0;f<p.length;f+=1)u.append(p[f]);return u.getBlob(l.type)}}function Cr(p,l){l&&p.then(function(u){l(null,u)},function(u){l(u)})}function S0(p,l,u){"function"==typeof l&&p.then(l),"function"==typeof u&&p.catch(u)}function mp(p){return"string"!=typeof p&&(p=String(p)),p}function zL(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Q6="local-forage-detect-blob-support";let lx;const Jo={},Sne=Object.prototype.toString,K6="readonly",cx="readwrite";function hx(p){var l=Jo[p.name],u={};u.promise=new Promise(function(f,g){u.resolve=f,u.reject=g}),l.deferredOperations.push(u),l.dbReady=l.dbReady?l.dbReady.then(function(){return u.promise}):u.promise}function eE(p){var l=Jo[p.name].deferredOperations.pop();if(l)return l.resolve(),l.promise}function tE(p,l){var u=Jo[p.name].deferredOperations.pop();if(u)return u.reject(l),u.promise}function $L(p,l){return new Promise(function(u,f){if(Jo[p.name]=Jo[p.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},p.db){if(!l)return u(p.db);hx(p),p.db.close()}var g=[p.name];l&&g.push(p.version);var m=gp.open.apply(gp,g);l&&(m.onupgradeneeded=function(v){var y=m.result;try{y.createObjectStore(p.storeName),v.oldVersion<=1&&y.createObjectStore(Q6)}catch(x){if("ConstraintError"!==x.name)throw x}}),m.onerror=function(v){v.preventDefault(),f(m.error)},m.onsuccess=function(){var v=m.result;v.onversionchange=function(y){y.target.close()},u(v),eE(p)}})}function iE(p){return $L(p,!1)}function nE(p){return $L(p,!0)}function YL(p,l){if(!p.db)return!0;var u=!p.db.objectStoreNames.contains(p.storeName),g=p.version>p.db.version;if(p.version<p.db.version&&(p.version=p.db.version),g||u){if(u){var m=p.db.version+1;m>p.version&&(p.version=m)}return!0}return!1}function Dne(p){var l=this,u=l._initReady().then(function(){var f=Jo[l._dbInfo.name];if(f&&f.dbReady)return f.dbReady});return S0(u,p,p),u}function Xd(p,l,u,f){void 0===f&&(f=1);try{var g=p.db.transaction(p.storeName,l);u(null,g)}catch(m){if(f>0&&(!p.db||"InvalidStateError"===m.name||"NotFoundError"===m.name))return Promise.resolve().then(()=>{if(!p.db||"NotFoundError"===m.name&&!p.db.objectStoreNames.contains(p.storeName)&&p.version<=p.db.version)return p.db&&(p.version=p.db.version+1),nE(p)}).then(()=>function(v){hx(v);for(var y=Jo[v.name],x=y.forages,w=0;w<x.length;w++){const C=x[w];C._dbInfo.db&&(C._dbInfo.db.close(),C._dbInfo.db=null)}return v.db=null,iE(v).then(C=>(v.db=C,YL(v)?nE(v):C)).then(C=>{v.db=y.db=C;for(var _=0;_<x.length;_++)x[_]._dbInfo.db=C}).catch(C=>{throw tE(v,C),C})}(p).then(function(){Xd(p,l,u,f-1)})).catch(u);u(m)}}var Ane={_driver:"asyncStorage",_initStorage:function(p){var l=this,u={db:null};if(p)for(var f in p)u[f]=p[f];var g=Jo[u.name];g||(Jo[u.name]=g={forages:[],db:null,dbReady:null,deferredOperations:[]}),g.forages.push(l),l._initReady||(l._initReady=l.ready,l.ready=Dne);var m=[];function v(){return Promise.resolve()}for(var y=0;y<g.forages.length;y++){var x=g.forages[y];x!==l&&m.push(x._initReady().catch(v))}var w=g.forages.slice(0);return Promise.all(m).then(function(){return u.db=g.db,iE(u)}).then(function(C){return u.db=C,YL(u)?nE(u):C}).then(function(C){u.db=g.db=C,l._dbInfo=u;for(var _=0;_<w.length;_++){var T=w[_];T!==l&&(T._dbInfo.db=u.db,T._dbInfo.version=u.version)}})},_support:function(){try{if(!gp||!gp.open)return!1;var p="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),l="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!p||l)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(u){return!1}}(),getItem:function(p,l){var u=this;p=mp(p);var f=new Promise(function(g,m){u.ready().then(function(){Xd(u._dbInfo,K6,function(v,y){if(v)return m(v);try{var x=y.objectStore(u._dbInfo.storeName).get(p);x.onsuccess=function(){var C,w=x.result;void 0===w&&(w=null),(C=w)&&C.__local_forage_encoded_blob&&(w=function Tne(p){return GL([function(u){for(var f=u.length,g=new ArrayBuffer(f),m=new Uint8Array(g),v=0;v<f;v++)m[v]=u.charCodeAt(v);return g}(atob(p.data))],{type:p.type})}(w)),g(w)},x.onerror=function(){m(x.error)}}catch(w){m(w)}})}).catch(m)});return Cr(f,l),f},setItem:function(p,l,u){var f=this;p=mp(p);var g=new Promise(function(m,v){var y;f.ready().then(function(){return y=f._dbInfo,"[object Blob]"===Sne.call(l)?function Ene(p){return"boolean"==typeof lx?Promise.resolve(lx):(l=p,new Promise(function(u){var f=l.transaction(Q6,cx),g=GL([""]);f.objectStore(Q6).put(g,"key"),f.onabort=function(m){m.preventDefault(),m.stopPropagation(),u(!1)},f.oncomplete=function(){var m=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);u(v||!m||parseInt(m[1],10)>=43)}}).catch(function(){return!1})).then(function(l){return lx=l,lx});var l}(y.db).then(function(x){return x?l:(w=l,new Promise(function(C,_){var T=new FileReader;T.onerror=_,T.onloadend=function(M){var L=btoa(M.target.result||"");C({__local_forage_encoded_blob:!0,data:L,type:w.type})},T.readAsBinaryString(w)}));var w}):l}).then(function(x){Xd(f._dbInfo,cx,function(w,C){if(w)return v(w);try{var _=C.objectStore(f._dbInfo.storeName);null===x&&(x=void 0);var T=_.put(x,p);C.oncomplete=function(){void 0===x&&(x=null),m(x)},C.onabort=C.onerror=function(){v(T.error?T.error:T.transaction.error)}}catch(M){v(M)}})}).catch(v)});return Cr(g,u),g},removeItem:function(p,l){var u=this;p=mp(p);var f=new Promise(function(g,m){u.ready().then(function(){Xd(u._dbInfo,cx,function(v,y){if(v)return m(v);try{var x=y.objectStore(u._dbInfo.storeName).delete(p);y.oncomplete=function(){g()},y.onerror=function(){m(x.error)},y.onabort=function(){m(x.error?x.error:x.transaction.error)}}catch(w){m(w)}})}).catch(m)});return Cr(f,l),f},clear:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Xd(l._dbInfo,cx,function(m,v){if(m)return g(m);try{var y=v.objectStore(l._dbInfo.storeName).clear();v.oncomplete=function(){f()},v.onabort=v.onerror=function(){g(y.error?y.error:y.transaction.error)}}catch(x){g(x)}})}).catch(g)});return Cr(u,p),u},length:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Xd(l._dbInfo,K6,function(m,v){if(m)return g(m);try{var y=v.objectStore(l._dbInfo.storeName).count();y.onsuccess=function(){f(y.result)},y.onerror=function(){g(y.error)}}catch(x){g(x)}})}).catch(g)});return Cr(u,p),u},keys:function(p){var l=this,u=new Promise(function(f,g){l.ready().then(function(){Xd(l._dbInfo,K6,function(m,v){if(m)return g(m);try{var y=v.objectStore(l._dbInfo.storeName).openKeyCursor(),x=[];y.onsuccess=function(){var w=y.result;w?(x.push(w.key),w.continue()):f(x)},y.onerror=function(){g(y.error)}}catch(w){g(w)}})}).catch(g)});return Cr(u,p),u},dropInstance:function(p,l){l=zL.apply(this,arguments);var u,f=this.config();if((p="function"!=typeof p&&p||{}).name||(p.name=p.name||f.name,p.storeName=p.storeName||f.storeName),p.name){u=(p.name===f.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):iE(p).then(m=>{const v=Jo[p.name],y=v.forages;v.db=m;for(var x=0;x<y.length;x++)y[x]._dbInfo.db=m;return m})).then(p.storeName?m=>{if(!m.objectStoreNames.contains(p.storeName))return;const v=m.version+1;hx(p);const y=Jo[p.name],x=y.forages;m.close();for(let C=0;C<x.length;C++){const _=x[C];_._dbInfo.db=null,_._dbInfo.version=v}return new Promise((C,_)=>{const T=gp.open(p.name,v);T.onerror=M=>{T.result.close(),_(M)},T.onupgradeneeded=()=>{T.result.deleteObjectStore(p.storeName)},T.onsuccess=()=>{const M=T.result;M.close(),C(M)}}).then(C=>{y.db=C;for(let _=0;_<x.length;_++){const T=x[_];T._dbInfo.db=C,eE(T._dbInfo)}}).catch(C=>{throw(tE(p,C)||Promise.resolve()).catch(()=>{}),C})}:m=>{hx(p);const v=Jo[p.name],y=v.forages;m.close();for(var x=0;x<y.length;x++)y[x]._dbInfo.db=null;return new Promise((C,_)=>{var T=gp.deleteDatabase(p.name);T.onerror=()=>{const M=T.result;M&&M.close(),_(T.error)},T.onblocked=()=>{},T.onsuccess=()=>{const M=T.result;M&&M.close(),C(M)}}).then(C=>{v.db=C;for(var _=0;_<y.length;_++)eE(y[_]._dbInfo)}).catch(C=>{throw(tE(p,C)||Promise.resolve()).catch(()=>{}),C})})}else u=Promise.reject("Invalid arguments");return Cr(u,l),u}};const vl=new Map;function XL(p,l){let u=p.name+"/";return p.storeName!==l.storeName&&(u+=p.storeName+"/"),u}var Ine={_driver:"tempStorageWrapper",_initStorage:function(){var p=Q(function*(l){const u={};if(l)for(let g in l)u[g]=l[g];const f=u.keyPrefix=XL(l,this._defaultConfig);this._dbInfo=u,vl.has(f)||vl.set(f,new Map)});return function(u){return p.apply(this,arguments)}}(),getItem:function(p,l){p=mp(p);const u=this.ready().then(()=>vl.get(this._dbInfo.keyPrefix).get(p));return Cr(u,l),u},setItem:function(p,l,u){p=mp(p);const f=this.ready().then(()=>(void 0===l&&(l=null),vl.get(this._dbInfo.keyPrefix).set(p,l),l));return Cr(f,u),f},removeItem:function(p,l){p=mp(p);const u=this.ready().then(()=>{vl.get(this._dbInfo.keyPrefix).delete(p)});return Cr(u,l),u},clear:function(p){const l=this.ready().then(()=>{const u=this._dbInfo.keyPrefix;vl.has(u)&&vl.delete(u)});return Cr(l,p),l},length:function(p){const l=this.ready().then(()=>vl.get(this._dbInfo.keyPrefix).size);return Cr(l,p),l},keys:function(p){const l=this.ready().then(()=>[...vl.get(this._dbInfo.keyPrefix).keys()]);return Cr(l,p),l},dropInstance:function(p,l){if(l=zL.apply(this,arguments),!(p="function"!=typeof p&&p||{}).name){const f=this.config();p.name=p.name||f.name,p.storeName=p.storeName||f.storeName}let u;return u=p.name?new Promise(f=>{f(p.storeName?XL(p,this._defaultConfig):`${p.name}/`)}).then(f=>{vl.delete(f)}):Promise.reject("Invalid arguments"),Cr(u,l),u}};const Pne=(p,l)=>p===l||"number"==typeof p&&"number"==typeof l&&isNaN(p)&&isNaN(l),Rne=(p,l)=>{const u=p.length;let f=0;for(;f<u;){if(Pne(p[f],l))return!0;f++}return!1},qL=Array.isArray||function(p){return"[object Array]"===Object.prototype.toString.call(p)},E0={},ZL={},T0={INDEXEDDB:Ane,TEMPSTORAGE:Ine},Mne=[T0.INDEXEDDB._driver,T0.TEMPSTORAGE._driver],dx=["dropInstance"],sE=["clear","getItem","keys","length","removeItem","setItem"].concat(dx),kne={description:"",driver:Mne.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function One(p,l){p[l]=function(){const u=arguments;return p.ready().then(function(){return p[l].apply(p,u)})}}function rE(){for(let p=1;p<arguments.length;p++){const l=arguments[p];if(l)for(let u in l)l.hasOwnProperty(u)&&(arguments[0][u]=qL(l[u])?l[u].slice():l[u])}return arguments[0]}class oE{constructor(l){for(let u in T0)if(T0.hasOwnProperty(u)){const f=T0[u],g=f._driver;this[u]=g,E0[g]||this.defineDriver(f)}this._defaultConfig=rE({},kne),this._config=rE({},this._defaultConfig,l),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(()=>{})}config(l){if("object"==typeof l){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let u in l){if("storeName"===u&&(l[u]=l[u].replace(/\W/g,"_")),"version"===u&&"number"!=typeof l[u])return new Error("Database version must be a number.");this._config[u]=l[u]}return!("driver"in l)||!l.driver||this.setDriver(this._config.driver)}return"string"==typeof l?this._config[l]:this._config}defineDriver(l,u,f){const g=new Promise(function(m,v){try{const y=l._driver,x=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver)return void v(x);const w=sE.concat("_initStorage");for(let T=0,M=w.length;T<M;T++){const L=w[T];if((!Rne(dx,L)||l[L])&&"function"!=typeof l[L])return void v(x)}!function(){const T=function(M){return function(){const L=new Error(`Method ${M} is not implemented by the current driver`),N=Promise.reject(L);return Cr(N,arguments[arguments.length-1]),N}};for(let M=0,L=dx.length;M<L;M++){const N=dx[M];l[N]||(l[N]=T(N))}}();const _=function(T){E0[y]=l,ZL[y]=T,m()};"_support"in l?l._support&&"function"==typeof l._support?l._support().then(_,v):_(!!l._support):_(!0)}catch(y){v(y)}});return S0(g,u,f),g}driver(){return this._driver||null}getDriver(l,u,f){const g=E0[l]?Promise.resolve(E0[l]):Promise.reject(new Error("Driver not found."));return S0(g,u,f),g}ready(l){const u=this,f=u._driverSet.then(()=>(null===u._ready&&(u._ready=u._initDriver()),u._ready));return S0(f,l,l),f}setDriver(l,u,f){const g=this;qL(l)||(l=[l]);const m=this._getSupportedDrivers(l);function v(){g._config.driver=g.driver()}function y(w){return g._extend(w),v(),g._ready=g._initStorage(g._config),g._ready}const x=null!==this._driverSet?this._driverSet.catch(()=>Promise.resolve()):Promise.resolve();return this._driverSet=x.then(()=>{const w=m[0];return g._dbInfo=null,g._ready=null,g.getDriver(w).then(C=>{var _;g._driver=C._driver,v(),g._wrapLibraryMethodsWithReady(),g._initDriver=(_=m,function(){let T=0;return function M(){for(;T<_.length;){let N=_[T];return T++,g._dbInfo=null,g._ready=null,g.getDriver(N).then(y).catch(M)}v();const L=new Error("No available storage method found.");return g._driverSet=Promise.reject(L),g._driverSet}()})})}).catch(()=>{v();const w=new Error("No available storage method found.");return g._driverSet=Promise.reject(w),g._driverSet}),S0(this._driverSet,u,f),this._driverSet}supports(l){return!!ZL[l]}_extend(l){rE(this,l)}_getSupportedDrivers(l){const u=[];for(let f=0,g=l.length;f<g;f++){const m=l[f];this.supports(m)&&u.push(m)}return u}_wrapLibraryMethodsWithReady(){for(let l=0,u=sE.length;l<u;l++)One(this,sE[l])}createInstance(l){return new oE(l)}}var Lne=new oE;Date.prototype.kUtilFormat=function(p){const l={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(p)&&(p=p.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let u in l)new RegExp("("+u+")").test(p)&&(p=p.replace(RegExp.$1,1==RegExp.$1.length?l[u]:("000"+l[u]).substr(("000"+l[u]).length-RegExp.$1.length)));return p},String.prototype.startsWith||(String.prototype.startsWith=function(p){return 0==this.indexOf(p)});let Fne=p=>{let l,u,f,g,m,v,y,x,w,C,_,T,M,L,N,V,H,G,z,q,te,se,ae=p.fetch||Md.fetch,j=p.btoa||Md.btoa,le=p.atob||Md.atob,ue=p.bd,xe=p.dm,I=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],A=!1,P=Promise.resolve(),O=p.lf,b=p.log&&function(){try{for(var De=arguments.length,re=new Array(De),he=0;he<De;he++)re[he]=arguments[he];p.log.apply(null,re)}catch(we){setTimeout(()=>{throw we},0)}}||(()=>{}),D=ue&&b||(()=>{}),k=p.fol,U=p.sutlcb,F=p.feab,B=De=>le(le(De.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),W=De=>j(String.fromCharCode(97+25*Math.random())+j(De)).replace(/\+/g,"\n").replace(/=/g," "),$=()=>{if(se)return se;if(Md.crypto){let De=new Uint8Array(36);Md.crypto.getRandomValues(De);let re="";for(let he=0;he<36;++he){let we=De[he]%36;re+=we<10?we:String.fromCharCode(we+87)}return re}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(De){var re=16*Math.random()|0;return("x"==De?re:3&re|8).toString(16)})};const Y=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let J,X,ie,oe,de={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+Y,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+Y,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},ve=function(){var De=Q(function*(){return J=J||Q(function*(){if(yield Q(function*(){O||(O=Lne)})(),yield(yield O.createInstance({name:"dynamjssdkhello"})).setItem("dynamjssdkhello","available"),V=yield O.createInstance({name:"dynamdlsinfo"}),H=se?null:j(j("v2")+String.fromCharCode(xe.charCodeAt(xe.length/2)+1)+j(xe)),!se){try{var re,he;let we=yield V.getItem(H);!we&&null!==(re=yield null===(he=self.indexedDB)||void 0===he?void 0:he.databases())&&void 0!==re&&re.some(Pe=>"dynamltsinfo"===(null==Pe?void 0:Pe.name))&&(we=yield(yield O.createInstance({name:"dynamltsinfo"})).getItem(H),we&&(yield V.setItem(H,we))),we&&([y,M]=JSON.parse(yield B(we)))}catch(we){}try{null==y&&(y=$(),V.setItem(H,yield W(JSON.stringify([y,null]))))}catch(we){}}})(),J});return function(){return De.apply(this,arguments)}}(),Ae=function(){var De=Q(function*(re){ie=Date.now(),X||(X=Q(function*(){try{let he={pd:l,vm:f,v:u,dt:v||"browser",ed:"javascript",cu:y,ad:xe,os:x,fn:w};T&&(he.rmk=T),g&&(-1!=g.indexOf("-")?he.hs=g:he.og=g);let we={};if(M&&!se){let Ee=yield V.getItem(H);Ee&&([y,M]=JSON.parse(yield B(Ee))),we["lts-time"]=M}_&&(he.sp=_),m=yield Promise.race([Q(function*(){let Ee,Me=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");M&&!se&&(V.setItem(H,yield W(JSON.stringify([y,Me]))),M=Me);let Oe,Be="auth/?ext="+encodeURIComponent(j(JSON.stringify(he))),Le=!1,He=!1,We=function(){var Qe=Q(function*(Xe){if(Xe&&!Xe.ok)try{let St=yield Xe.text();if(St){let ni=JSON.parse(St);ni.errorCode&&(Oe=ni,ni.errorCode>100&&ni.errorCode<200&&(m=null,Le=!0,He=!0))}}catch(St){}});return function(St){return Qe.apply(this,arguments)}}();try{Ee=yield ae(I[0]+Be,{headers:we,cache:re?"reload":"default",mode:"cors",timeout:1e4}),yield We(Ee)}catch(Qe){}if(!(m||Ee&&Ee.ok||Le))try{Ee=yield ae(I[1]+Be,{headers:we,mode:"cors",timeout:3e4})}catch(Qe){}if(!(m||Ee&&Ee.ok||Le))try{Ee=yield ae(I[0]+Be,{headers:we,mode:"cors",timeout:3e4}),yield We(Ee)}catch(Qe){}Oe&&151==Oe.errorCode&&!se&&(V.removeItem(H),V.removeItem(G),y=$(),he.cu=y,M=void 0,Be="auth/?ext="+encodeURIComponent(j(JSON.stringify(he))),Ee=yield ae(I[0]+Be,{headers:we,mode:"cors",timeout:3e4}),yield We(Ee)),(()=>{if(!Ee||!Ee.ok){let Qe;He&&V.setItem(G,""),Oe?111==Oe.errorCode?Qe=Oe.message:(Qe=Oe.message.trim(),Qe.endsWith(".")||(Qe+="."),Qe=C?`An error occurred during authorization: ${Qe} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${Qe} Contact the site administrator for more information.`):Qe=C?de.publicTrialFailConnect:de.failConnect;let Xe=Error(Qe);throw Oe&&Oe.errorCode&&(Xe.ltsErrorCode=Oe.errorCode),Xe}})();let Je=yield Ee.text();try{M||se||(V.setItem(H,yield W(JSON.stringify([y,Me]))),M=Me),V.setItem(G,Je)}catch(Qe){}return Je})(),new Promise((Ee,Me)=>{let Oe;Oe=C?de.publicTrialNetworkTimeout:de.networkTimeout,setTimeout(()=>Me(new Error(Oe)),m?3e3:15e3)})])}catch(he){L=he}X=null})()),yield X});return function(he){return De.apply(this,arguments)}}(),Ce=function(){var De=Q(function*(){oe||(oe=Q(function*(){if(D(y),!m){if(!A)throw b(L.message),L;return}let re={dm:xe};ue&&(re.bd=!0),re.brtk=!0,re.ls=I[0],g&&(-1!=g.indexOf("-")?re.hs=g:re.og=g),re.cu=y,w&&(re.fn=w),l&&(re.pd=l),u&&(re.v=u),v&&(re.dt=v),x&&(re.os=x),T&&(re.rmk=T),D(m);try{re.ar=m,re.bafc=!!L}catch(he){}D(re);try{yield z(re)}catch(he){D("error updl")}yield _e(),A||(A=!0),oe=null})()),yield oe});return function(){return De.apply(this,arguments)}}(),_e=function(){var De=Q(function*(){let re=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),he=yield te();if(D(he),he&&he<re)throw L?new Error(de.dlsErrorAndCacheExpire):new Error(de.checkLocalTime)});return function(){return De.apply(this,arguments)}}(),ge=null;const ce=new Promise(De=>{ge=()=>{ce.isPending=!1,ce.isFulfilled=!0,De()}});let be=null,Ie=function(){var De=Q(function*(re,he){return P=P.then(Q(function*(){try{let we=yield N.keys();if(he||(ce.isFulfilled?re&&(we=we.filter(Pe=>Pe<re)):re&&we.includes(re)?we=[re]:(we=[],D("Unexpected null key"))),!we.length)return;for(let Pe=0;Pe<we.length/1e3;++Pe){let Ee=we.slice(1e3*Pe,1e3*(Pe+1)),Me=[];for(let Oe=0;Oe<Ee.length;++Oe)Me.push(yield N.getItem(Ee[Oe]));if(M=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!se){let Oe=yield V.getItem(H);Oe&&([y]=JSON.parse(yield B(Oe))),V.setItem(H,yield W(JSON.stringify([y,M])))}try{let Oe,Be,Le=I[0]+"verify/v2";M&&!se&&(Le+="?ltstime="+encodeURIComponent(M));try{Oe=ae(Le,{method:"POST",body:Me.join(";"),keepalive:!0})}finally{!ce.isFulfilled&&Vee&&ge()}try{Be=yield Oe}finally{ce.isFulfilled||ge()}if(!Be.ok)throw new Error("verify failed. Status Code: "+Be.status);for(let He=0;He<Ee.length;++He)yield N.removeItem(Ee[He])}catch(Oe){throw ce.isFulfilled||ge(),k&&(k(Oe),k=null),Oe}}U&&U()}catch(we){}})),yield P});return function(he,we){return De.apply(this,arguments)}}();return{i:(De=Q(function*(re){return l=re.pd,u=re.v,f=u.split(".")[0],re.dt&&(v=re.dt),g=re.l||"",x="string"!=typeof re.os?JSON.stringify(re.os):re.os,w=re.fn,"string"==typeof w&&(w=w.substring(0,255)),re.ls&&re.ls.length&&(I=re.ls,1==I.length&&I.push(I[0])),C=!g||"200001"===g||g.startsWith("200001-"),_=re.sp,T=re.rmk,"string"==typeof T&&(T=T.substring(0,255)),re.lf&&(O=re.lf),re.lsu&&(y=se=re.lsu),re.feab&&(F=re.feab),z=re.updl,q=re.mnet,te=re.mxet,re.sutlcb&&(U=re.sutlcb),yield ve(),yield Q(function*(){G=j(String.fromCharCode(g.charCodeAt(0)+10)+j(l)+j(g)+f+j(""+v)),N=yield O.createInstance({name:"dynamdlsuns"+j(j("v2"))+j(String.fromCharCode(g.charCodeAt(0)+10)+j(l)+j(g)+f+j(""+v))});try{m=yield V.getItem(G)}catch(he){}})(),yield Ae(),yield Ce(),(!L||L.ltsErrorCode>=102&&L.ltsErrorCode<=120)&&Ie(null,!0),{ar:m,cu:y}}),function(he){return De.apply(this,arguments)}),c:function(){var De=Q(function*(){let re=new Date;if(re.getTime()<ie+36e4)return;let he=re.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),we=yield q(),Pe=yield te();if(Pe&&Pe<he)yield Ae(!0),yield Ce();else if(we&&we<he){let Ee=new Date(re.getTime());Ee.setMinutes(re.getMinutes()-6);let Me=Ee.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");M<Me&&Ae().then(()=>Ce())}});return function(){return De.apply(this,arguments)}}(),s:function(){var De=Q(function*(re,he,we,Pe){if(he){try{let Ee;Ee=he.startsWith("{")&&he.endsWith("}")?yield F(he):he,Ee?(D("bs "+we),yield N.setItem(we,Ee),D("ss "+we)):D("ept ecpt")}catch(Ee){}Pe&&(D("bd "+we),yield Ie(we,2==Pe),D("sd "+we)),be&&clearTimeout(be),be=setTimeout(Q(function*(){yield Ie()}),36e4)}else yield Ie(we)});return function(he,we,Pe,Ee){return De.apply(this,arguments)}}(),p:ce,u:function(){var De=Q(function*(){return yield ve(),y});return function(){return De.apply(this,arguments)}}(),caret:_e};var De};var wc;class Wt{static init(){D0._=ye(Wt,this,void 0),A0._=ye(Wt,this,void 0),vp._=ye(Wt,this,"init")}static reset(){D0._=ye(Wt,this,void 0),A0._=ye(Wt,this,void 0),vp._=ye(Wt,this,"")}static setLicenseInfo(l){var u;vp._=ye(Wt,this,"done"),D0._=ye(Wt,this,[]),D0._=ye(Wt,this,null!==(u=null==l?void 0:l.modules)&&void 0!==u?u:[])}static setLicenseErr(l){A0._=ye(Wt,this,l),vp._=ye(Wt,this,"done")}static makeSureLoadLicenseExist(){return ye(Wt,this,ux).call(this,3101,5001)}static makeSureCoreLicenseExist(){return ye(Wt,this,ux).call(this,3101)}static makeSureCameraLicenseExist(){return ye(Wt,this,ux).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return ye(Wt,this,ux).call(this,15)}static annotationLicenseModuleIsExist(){return ye(Wt,this,Nne).call(this,15)}}function aE(p){for(const l of ye(wc,this,D0)._)if(l.module===p)return l;return{code:fe.LIC_MISS_MODULE.code,message:fe.LIC_MISS_MODULE.message,module:p}}function ux(p,l){""===ye(wc,this,vp)._&&fe.throw(fe.INIT_SHOULD_SET_CONFIG),"done"!==ye(wc,this,vp)._&&fe.throw(fe.INIT_CONFIG_NOT_DONE),ye(wc,this,A0)._&&fe.throw(ye(wc,this,A0)._);const u=ye(wc,this,aE).call(this,p);0!==u.code&&(!l||l&&0!==ye(wc,this,aE).call(this,l).code)&&fe.throw({code:u.code,message:u.message})}function Nne(p){return 0===ye(wc,this,aE).call(this,p).code}wc=Wt;var D0={_:void 0},A0={_:void 0},vp={_:""};function JL(p){let l;if(p){let u;const f=p.message;u=p.ltsErrorCode,Ve(u)?111===u?u=fe.LIC_EXPIRED.code:106===u||108===u?u=fe.LIC_INVALID.code:u>0&&(u=-(2e4+u)):u=fe.LIC_INVALID.code,l={code:u,message:f}}else l=fe.LIC_INVALID;return l}const QL="2.0.0";var Cc;!function(p){p[p.publicTrial=0]="publicTrial",p[p.privateTrial=1]="privateTrial",p[p.normal=2]="normal"}(Cc||(Cc={}));var yl,I0=new WeakMap,fx=new WeakMap,px=new WeakMap,gx=new WeakMap,mx=new WeakMap,Ph=new WeakMap,vx=new WeakMap,P0=new WeakMap,qd=new WeakSet;class Bne{constructor(l){Js(this,qd),Ht(this,I0,void 0),Ht(this,fx,void 0),Ht(this,px,void 0),Ht(this,gx,void 0),Ht(this,mx,void 0),Ht(this,Ph,void 0),Ht(this,vx,void 0),Ht(this,P0,void 0),gt(fx,this,void 0),gt(I0,this,void 0),gt(px,this,""),gt(gx,this,""),gt(Ph,this,Cc.publicTrial),gt(P0,this,void 0),gt(vx,this,"");const u=function(p){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=p;if(u._pLoad.isEmpty){let f,g,m,v=u._license||"",y=JSON.parse(JSON.stringify(u._licenseServer)),x=u._sessionPassword,w=0;if(v.startsWith("t")||v.startsWith("f"))w=0;else if(0===v.length||v.startsWith("P")||v.startsWith("L")||v.startsWith("Y")||v.startsWith("A"))w=1;else{w=2;const C=v.indexOf(":");-1!=C&&(v=v.substring(C+1));const _=v.indexOf("?");if(-1!=_&&(g=v.substring(_+1),v=v.substring(0,_)),v.startsWith("DLC2"))w=0;else{if(v.startsWith("DLS2")){let T;try{let M=v.substring(4);M=atob(M),T=JSON.parse(M)}catch(M){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(v=T.handshakeCode?T.handshakeCode:T.organizationID?T.organizationID:"","number"==typeof v&&(v=JSON.stringify(v)),0===y.length){let M=[];T.mainServerURL&&(M[0]=T.mainServerURL),T.standbyServerURL&&(M[1]=T.standbyServerURL),y=(L=>{if(null==L)L=[];else{L=L instanceof Array?[...L]:[L];for(let N=0;N<L.length;++N){if(!Rd){let V=document.createElement("a");V.href=L[N],L[N]=V.href}L[N].endsWith("/")||(L[N]+="/")}}return L})(M)}!x&&T.sessionPassword&&(x=T.sessionPassword),f=T.remark}v&&"200001"!==v&&!v.startsWith("200001-")||(w=1)}}if(w&&(l||(Md.crypto||(m="Please upgrade your browser to support online key."),Md.crypto.subtle||(m="Require https to use online key in this browser."))),m){if(1!==w)throw new Error(m);w=0,u._lastErrorCode=-1,u._lastErrorString=m}return 1===w&&(v=""),{lt:w,l:v,ls:y,sp:x,rmk:f,cv:g}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")}({_pLoad:{isEmpty:!0},_license:l,_licenseServer:[]},!0);let f;if(u&&nt(u.l)?(f=u.l.trim(),gt(Ph,this,1===u.lt?Cc.publicTrial:2===u.lt?Cc.privateTrial:Cc.normal)):(f="",gt(Ph,this,Cc.publicTrial)),""===f?gt(I0,this,f):f.includes("-")?gt(fx,this,f):gt(I0,this,f),Xt(u.ls)){u.ls.length>0&&gt(P0,this,u.ls);const g=ee(P0,this);let m,v;if(g&&g.length>0){for(m=0;m<g.length;m++)v=g[m],v.endsWith("/")||(g[m]=`${v}/`);ye(qd,this,Une).call(this,g,f)&&gt(Ph,this,Cc.publicTrial)}}gt(vx,this,u.sp)}init(l,u,f){var g=this;return Q(function*(){let m=l;m.endsWith("/")||(m=`${m}/`),ee(mx,g)||(yield ye(qd,g,jne).call(g,f));try{yield ye(qd,g,Gne).call(g,u)}catch(v){const y=JL(v);let x=!1;y.code===fe.LIC_EXPIRED.code?-1!==y.message.toLowerCase().indexOf("trial license")&&(x=!0):g.isPublicTrial()&&(x=!0),x&&WL({_bNeverShowDialog:!1,engineResourcePath:m,_onLog:console.log},"error",y.message),fe.throw(y)}})()}getClientUUID(){return ee(gx,this)}getAuthResult(){return ee(px,this)}isPublicTrial(){return ee(Ph,this)===Cc.publicTrial}setClientUUID(l){gt(gx,this,l)}setAuthResult(l){gt(px,this,l)}}function Une(p,l){let u=!0;if(Xt(p)&&p.length>0){const f=p[0];nt(f)&&""!==f&&!f.includes("https://mlts.dynamsoft.com")&&(u=!1)}return u&&(!l||"200001"===l||l.startsWith("200001-"))}function Vne(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function jne(p){const l={dm:ye(qd,this,Vne).call(this),fetch:window.fetch};p&&(l.bd=!0,l.log=console.log),gt(mx,this,Fne(l))}function Hne(){return this.isPublicTrial()?"":ee(fx,this)||ee(I0,this)}function Wne(){const p=[];return p.push(Ks.browser),p.push(Ks.version.toString()),p.push(Ks.OS),p.join(" ")}function Gne(p){return lE.apply(this,arguments)}function lE(){return lE=Q(function*(p){if(this.getAuthResult()&&this.getClientUUID())return{ar:this.getAuthResult(),cu:this.getClientUUID()};const l={pd:"ddv",dt:"browser",v:QL,os:ye(qd,this,Wne).call(this),l:ye(qd,this,Hne).call(this),ls:ee(P0,this),sp:ee(vx,this),fn:p||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(l.lsu=this.getClientUUID()),l.updateLicense=f=>{this.setAuthResult(f.ar),this.getClientUUID()||this.setClientUUID(f.cu)};const u=yield ee(mx,this).i(l);return this.getAuthResult()||this.setAuthResult(u.ar),this.getClientUUID()||this.setClientUUID(u.cu),u}),lE.apply(this,arguments)}function cE(){return cE=Q(function*(p){let l=p.engineResourcePath.trim();if(l.endsWith("/")||(l=`${l}/`),Ke.resourceDir=l,Wt.init(),!(yield Ke.isResourceDirValid()))return Wt.reset(),fe.reject(fe.RESOURCE_NOT_FOUND,"DDV.Core.init");yield Ke.preloadModule("core");const u=p.license.trim();let f,g,m=u.startsWith("DLS")||0===u.length,v=!1,y=!1;if(m)try{var x;let _=!1;if(!u&&null!==(x=window)&&void 0!==x&&null!==(x=x.Dynamsoft)&&void 0!==x&&x.DWT){let T=window.Dynamsoft.DWT,M=T.lgar(T.EnumInstance.dwt_desktop,""),L=T.li({instanceMode:T.EnumInstance.dwt_desktop},"");M&&L&&(f=M,g=L,v=T.isPublicLicense(),_=!0)}if(!_){var w;let T;if(null!=Ki&&Ki.license?T=yield Ki.license.getAR():null!==(w=window)&&void 0!==w&&null!==(w=w.Dynamsoft)&&void 0!==w&&null!==(w=w.Core)&&void 0!==w&&null!==(w=w.mapPackageRegister)&&void 0!==w&&w.license&&(T=yield window.Dynamsoft.Core.mapPackageRegister.license.getAR()),T)f=T.ar,g=T.u,v=T.pt,T.pk?(f=T.pk,m=!1):y=!0,Se(f)&&T.ae&&fe.throw(JL(T.ae));else{const M=yield(L=Q(function*(N,V,H,G){const z=new Bne(N);return yield z.init(V,H,G),{authResult:z.getAuthResult(),clientUUID:z.getClientUUID(),bPublicTrial:z.isPublicTrial()}}),function(N,V,H,G){return L.apply(this,arguments)})(u,l,p.deviceFriendlyName||"");f=M.authResult,g=M.clientUUID,v=M.bPublicTrial}}}catch(_){throw Wt.setLicenseErr(_),_}else f=u,g="";var L;const C={licenseInfo:null};try{const _=yield Ke.getLicenseInfo(f,m,g);C.licenseInfo=_,Wt.setLicenseInfo(_),!y&&v&&_.trial&&_.msg&&WL({_bNeverShowDialog:!1,engineResourcePath:l,_onLog:console.log},"warn",_.msg)}catch(_){throw _&&_.code<=-8e4&&Wt.setLicenseErr(_),_}return m&&(C.deviceUuid=g),C}),cE.apply(this,arguments)}const $ne={scrollToLatest:!1};class Yne{constructor(l){S(this,"viewerUids",void 0),S(this,"groupUid",void 0),S(this,"config",void 0),S(this,"isSetScrollToLatest",!1),this.groupUid=l,this.viewerUids=new Set,this.config=qe($ne)}getViewerUids(){return[...this.viewerUids.values()]}updateConfig(){Object.assign(this.config,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}var KL,Rn;(function(p){p.LEFT="left",p.TOP="top",p.RIGHT="right",p.BOTTOM="bottom"})(KL||(KL={})),function(p){p.DEFAULT="default",p.CAPTURE="capture",p.PERSPECTIVE="perspective",p.THUMBNAIL="thumbnail"}(Rn||(Rn={}));class eF{constructor(){S(this,"db",void 0),this.db=new Map}set(l,u){var f=this;return Q(function*(){return new Promise((g,m)=>{f.db.has(l)?m(new Error(`The item ${l} already exists.`)):(f.db.set(l,u),g(`Save ${l} to database successful.`))})})()}get(l){var u=this;return Q(function*(){return new Promise((f,g)=>{u.db.has(l)?f(u.db.get(l)):g(new Error(`The item ${l} does not exist.`))})})()}remove(l){var u=this;return Q(function*(){return new Promise((f,g)=>{const m=u.db.get(l);u.db.delete(l),f(m)})})()}update(l,u){var f=this;return Q(function*(){return new Promise((g,m)=>{f.db.has(l)?(f.db.set(l,u),g(`Update ${l} successful.`)):m(new Error(`The item ${l} does not exist.`))})})()}dispose(){this.db.clear()}reset(){this.db.clear()}}class Xne extends mi{constructor(){super(),S(this,"openDocument",void 0),S(this,"closeDocument",void 0),S(this,"syncDocument",void 0),S(this,"addPagesToDoc",void 0),S(this,"deletePages",void 0),S(this,"updatePage",void 0),S(this,"selectedPageChanged",void 0),S(this,"viewerModeChanged",void 0),S(this,"pageChanged",void 0),S(this,"currentPageChanged",void 0),S(this,"pageChangedAfterRender",void 0),S(this,"pageExistenceChanged",void 0),S(this,"tabChanged",void 0),S(this,"displayModeChanged",void 0),S(this,"fitModeChanged",void 0),S(this,"filterChanged",void 0),S(this,"toolModeChanged",void 0),S(this,"zoomChanged",void 0),S(this,"visibleChanged",void 0),S(this,"cropRectDrawn",void 0),S(this,"cropRectDeleted",void 0),S(this,"cropModeChanged",void 0),S(this,"quadModified",void 0),S(this,"autoCaptureChanged",void 0),S(this,"autoDetectChanged",void 0),S(this,"torchChanged",void 0),S(this,"cameraPlayed",void 0),S(this,"cameraClosed",void 0),S(this,"cameraInit",void 0),S(this,"beforeLayout",void 0),S(this,"afterLayout",void 0),S(this,"beforeRender",void 0),S(this,"afterRender",void 0),S(this,"destroy",void 0),S(this,"canvasCursorStyleChanged",void 0),S(this,"quadSelectionStyleChanged",void 0),S(this,"perspectiveQuadChanged",void 0),S(this,"beforeCropPages",void 0),S(this,"operationsChanged",void 0),S(this,"resize",void 0),S(this,"annotationsUpdated",void 0),S(this,"annotationModeChanged",void 0),S(this,"annotationDefaultStyleChanged",void 0),S(this,"selectedAnnotationsChanged",void 0),S(this,"annotationLayerStateChanged",void 0),S(this,"beforeAnnotationEdit",void 0),S(this,"afterAnnotationEdit",void 0),S(this,"beforeAnnotationDraw",void 0),S(this,"afterAnnotationDraw",void 0),S(this,"annotationTextCharsSelected",void 0),S(this,"scroll",void 0),this.openDocument=Re(this),this.closeDocument=Re(this),this.syncDocument=Re(this),this.addPagesToDoc=Re(this),this.deletePages=Re(this),this.updatePage=Re(this),this.selectedPageChanged=Re(this),this.viewerModeChanged=Re(this),this.pageChanged=Re(this),this.currentPageChanged=Re(this),this.pageChangedAfterRender=Re(this),this.pageExistenceChanged=Re(this),this.tabChanged=Re(this),this.displayModeChanged=Re(this),this.fitModeChanged=Re(this),this.filterChanged=Re(this),this.toolModeChanged=Re(this),this.zoomChanged=Re(this),this.visibleChanged=Re(this),this.cropRectDrawn=Re(this),this.cropRectDeleted=Re(this),this.cropModeChanged=Re(this),this.quadModified=Re(this),this.autoCaptureChanged=Re(this),this.autoDetectChanged=Re(this),this.torchChanged=Re(this),this.cameraPlayed=Re(this),this.cameraClosed=Re(this),this.cameraInit=Re(this),this.beforeLayout=Re(this),this.afterLayout=Re(this),this.beforeRender=Re(this),this.afterRender=Re(this),this.destroy=Re(this),this.canvasCursorStyleChanged=Re(this),this.quadSelectionStyleChanged=Re(this),this.perspectiveQuadChanged=Re(this),this.beforeCropPages=Re(this),this.operationsChanged=Re(this),this.resize=Re(this),this.annotationModeChanged=Re(this),this.selectedAnnotationsChanged=Re(this),this.annotationLayerStateChanged=Re(this),this.annotationDefaultStyleChanged=Re(this),this.beforeAnnotationEdit=Re(this),this.afterAnnotationEdit=Re(this),this.beforeAnnotationDraw=Re(this),this.afterAnnotationDraw=Re(this),this.annotationsUpdated=Re(this),this.annotationTextCharsSelected=Re(this),this.scroll=Re(this)}}class Ge{static numberArrayIsValid(l,u,f,g,m){return ye(Ge,this,yx).call(this,l,1,u,f,m,g)}static stringArrayIsValid(l,u){return ye(Ge,this,yx).call(this,l,2,void 0,void 0,0,u)}static blobArrayIsValid(l,u){return ye(Ge,this,yx).call(this,l,4,void 0,void 0,void 0,u)}static quadIsValid(l,u){const f=[],g="Quad";ye(Ge,this,rn).call(this,f,l,6,ye(Ge,this,Yi).call(this,g,u,void 0),4);let m=0;for(const v of l){const y=`[${m}]`;f.push(...ye(Ge,this,yx).call(this,v,1,void 0,void 0,2,ye(Ge,this,Yi).call(this,g,u,y,!0))),m+=1}return f}static docDetectConfigIsValid(l,u){const f=[],g="DocumentDetectConfig";return ye(Ge,this,rn).call(this,f,l,5,ye(Ge,this,Yi).call(this,g,u)),ye(Ge,this,rn).call(this,f,l.autoCaptureDelay,1,ye(Ge,this,Yi).call(this,g,u,"autoCaptureDelay")),Se(l.acceptedPolygonConfidence)||ye(Ge,this,rn).call(this,f,l.acceptedPolygonConfidence,1,ye(Ge,this,Yi).call(this,g,u,"acceptedPolygonConfidence")),Se(l.enableAutoCapture)||ye(Ge,this,rn).call(this,f,l.enableAutoCapture,3,ye(Ge,this,Yi).call(this,g,u,"enableAutoCapture")),f}static docDetectConfIsValid(l,u){const f=[],g="DocumentDetectConfidence";return ye(Ge,this,rn).call(this,f,l,5,ye(Ge,this,Yi).call(this,g,u)),ye(Ge,this,rn).call(this,f,l.angleConfidence,1,ye(Ge,this,Yi).call(this,g,u,"angleConfidence"),0,100),ye(Ge,this,rn).call(this,f,l.areaConfidence,1,ye(Ge,this,Yi).call(this,g,u,"areaConfidence"),0,100),ye(Ge,this,rn).call(this,f,l.centerConfidence,1,ye(Ge,this,Yi).call(this,g,u,"centerConfidence"),0,100),f}static imageDataIsValid(l,u){const f=[],g="VImageData";return ye(Ge,this,rn).call(this,f,l,5,ye(Ge,this,Yi).call(this,g,u)),ye(Ge,this,rn).call(this,f,l.data,8,ye(Ge,this,Yi).call(this,g,u,"data")),ye(Ge,this,rn).call(this,f,l.type,9,ye(Ge,this,Yi).call(this,g,u,"type")),Se(l.height)||ye(Ge,this,rn).call(this,f,l.height,1,ye(Ge,this,Yi).call(this,g,u,"height")),Se(l.width)||ye(Ge,this,rn).call(this,f,l.width,1,ye(Ge,this,Yi).call(this,g,u,"width")),f}static filterTypeIsValid(l,u){const f=[];return ye(Ge,this,rn).call(this,f,l,10,ye(Ge,this,Yi).call(this,"EnumImageFilterType",u)),f}static imageEncodeOptionIsValid(l,u){const f=[],g="ImageEncodeOption";return ye(Ge,this,rn).call(this,f,l,5,ye(Ge,this,Yi).call(this,g,u)),ye(Ge,this,rn).call(this,f,l.type,9,ye(Ge,this,Yi).call(this,g,u,"type")),Se(l.params)||ye(Ge,this,rn).call(this,f,l.params,5,ye(Ge,this,Yi).call(this,g,u,"params")),f}static makeSureNumberValid(l,u,f,g,m,v){return ye(Ge,this,tF).call(this,ye(Ge,this,iF).call(this,l,u,f),g,m,v)}static makeSureStringValid(l,u,f,g){return ye(Ge,this,tF).call(this,{isValid:ye(Ge,this,dE).call(this,l)},u,f,g)}static makeSureDetectResultValid(l,u,f,g){const m=[],v="DetectResult";ye(Ge,this,rn).call(this,m,l,5,ye(Ge,this,Yi).call(this,v,g)),m.push(...Ge.quadIsValid(null==l?void 0:l.location,v)),ye(Ge,this,rn).call(this,m,null==l?void 0:l.width,1,ye(Ge,this,Yi).call(this,v,g,"width"),1,void 0),ye(Ge,this,rn).call(this,m,null==l?void 0:l.height,1,ye(Ge,this,Yi).call(this,v,g,"height"),1,void 0),m.push(...Ge.docDetectConfigIsValid(null==l?void 0:l.config,v)),null!=l&&l.confidence&&ye(Ge,this,rn).call(this,m,l.confidence,1,ye(Ge,this,Yi).call(this,v,g,"confidence")),this.makeSureValid(m,u,f)}static makeSureValid(l,u,f,g){0!==l.length&&ye(Ge,this,hE).call(this,l,u,f,g)}static makeSureMissing(l,u,f){Se(l)&&ye(Ge,this,hE).call(this,void 0,u,f,fe.PARAM_MISS)}static makeSureCameraObject(l,u,f){const g=[],m=f;this.makeSureMissing(l,u,f),nt(l)?this.makeSureStringValid(l,u,f):(ye(Ge,this,rn).call(this,g,l,5,ye(Ge,this,Yi).call(this,m)),ye(Ge,this,rn).call(this,g,l.deviceId,2,ye(Ge,this,Yi).call(this,m,void 0,"deviceId")),ye(Ge,this,rn).call(this,g,l.label,2,ye(Ge,this,Yi).call(this,m,void 0,"label")),this.makeSureValid(g,u,f))}static initTypeCheckMap(){ye(Ge,this,Us)._[7]=b3,ye(Ge,this,Us)._[15]=nt,ye(Ge,this,Us)._[3]=Jn,ye(Ge,this,Us)._[5]=vt,ye(Ge,this,Us)._[4]=er,ye(Ge,this,Us)._[2]=ye(Ge,this,dE),ye(Ge,this,Us)._[8]=ye(Ge,this,Zne),ye(Ge,this,Us)._[11]=ye(Ge,this,ese),ye(Ge,this,Us)._[12]=ye(Ge,this,tse),ye(Ge,this,Us)._[13]=ye(Ge,this,ise),ye(Ge,this,Us)._[14]=ye(Ge,this,nse),ye(Ge,this,Us)._[1]=ye(Ge,this,iF),ye(Ge,this,Us)._[6]=ye(Ge,this,Jne),ye(Ge,this,Us)._[9]=ye(Ge,this,Qne),ye(Ge,this,Us)._[10]=ye(Ge,this,Kne),ye(Ge,this,Us)._[16]=ye(Ge,this,sse)}}function yx(p,l,u,f,g,m){const v=[],y="Array";if(ye(yl,this,rn).call(this,v,p,6,ye(yl,this,Yi).call(this,y,m),g),v.length>0)return v;let x=0;for(const w of p){const C=`[${x}]`;ye(yl,this,rn).call(this,v,w,l,ye(yl,this,Yi).call(this,y,m,C,!0),u,f),x+=1}return v}function tF(p,l,u,f){const{isValid:g,isInRange:m,isSupported:v}=p,y=!!Se(g)||g,x=!!Se(m)||m,w=!!Se(v)||v;y&&x&&w||(f||(f=y?x?fe.PARAM_NOT_SUPPORT:fe.PARAM_OUT_OF_RANGE:fe.PARAM_INVALID),ye(yl,this,hE).call(this,void 0,l,u,f))}function Yi(p,l,u,f){return l?u?`${l}${f?"":"."}${u}`:`${l}`:u?`${p}${f?"":"."}${u}`:`${p}`}function hE(p,l,u,f){const g=Se(f)?ne({},fe.PARAM_INVALID):ne({},f);p&&(g.details=p),fe.throw(g,l,u)}function rn(p,l,u,f,g,m){const v=ye(yl,this,qne).call(this,l,u,f,g,m);v&&p.push(v)}function qne(p,l,u,f,g){if(Se(p))return`${u} is missing.`;const m=ye(yl,this,Us)._[l];if(m){const v=m.bind(this)(p,f,g);if(Jn(v)){if(!v)return`${u} is invalid.`}else if(vt(v)){const{isValid:y,isInRange:x,isSupported:w}=v;if(!1===y)return`${u} is invalid.`;if(!1===x)return`${u} is out of range.`;if(!1===w)return`${u} is not supported.`}}}function Zne(p){return b3(p)||er(p)}function Jne(p,l){return Xt(p)?Ve(l)&&0===p.length||!Se(l)&&p.length<l?{isValid:!1}:{isValid:!0,isInRange:!!Se(l)||p.length>=l}:{isValid:!1}}function Qne(p){return Ve(p)?{isValid:!0,isInRange:p>=Ri.RGBA&&p<=Ri.PNG}:{isValid:!1}}function Kne(p){return nt(p)?{isValid:!0,isInRange:(l=p,!!HL.get(l))}:{isValid:!1};var l}function ese(p){return void 0!==v6.get(p)}function tse(p){return void 0!==O3.get(p)}function ise(p){return void 0!==m6.get(p)}function nse(p){if(nt(p)){const l=p.trim();return-1!==ye(yl,this,rse)._.indexOf(l)}return!1}function iF(p,l,u){let f=!0;return Ve(p)?(Se(l)||(f=p>=l),!Se(u)&&f&&(f=p<=u),{isValid:!0,isInRange:f}):{isValid:!1}}function dE(p){return!!nt(p)&&0!==p.trim().length}function sse(p){if(!ye(yl,this,dE).call(this,p))return{isValid:!1};const l=p.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let u=!1;if(l){const[,f,g,m,v,y,x,w,C,_]=l,T=new Date(`${f}-${g}-${m}T${v}:${y}:${x}`);if(u=!0,T.getFullYear()===parseInt(f,10)&&T.getMonth()+1===parseInt(g,10)&&T.getDate()===parseInt(m,10)&&T.getHours()===parseInt(v,10)&&T.getMinutes()===parseInt(y,10)&&T.getSeconds()===parseInt(x,10)||(u=!1),u&&w){const M=parseInt(C,10),L=parseInt(_,10);("+"===w&&(M<0||M>12||L<0||L>59)||"-"===w&&(M<0||M>12||L<0||L>59))&&(u=!1)}}return{isSupported:u}}yl=Ge;var rse={_:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},Us={_:Object.create(null)};Ge.initTypeCheckMap();class ose{constructor(l){S(this,"maxConcurrency",void 0),S(this,"currentConcurrency",void 0),S(this,"queue",void 0),this.maxConcurrency=l,this.currentConcurrency=0,this.queue=[]}acquire(){var l=this;return Q(function*(){return new Promise(u=>{l.currentConcurrency<l.maxConcurrency?(l.currentConcurrency+=1,u(!0)):l.queue.push(u)})})()}release(){this.queue.length>0?this.queue.shift()():this.currentConcurrency-=1}}class R0 extends class ase{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;S(this,"tasks",void 0),S(this,"semaphore",void 0),this.tasks=[],this.semaphore=new ose(l)}process(l){var u=this;return Q(function*(){yield u.semaphore.acquire();let f=null;try{l.cancelled||(f=yield u.handler(l.taskUid))}catch(g){f=null}if(l.completed=!0,u.tasks.includes(l)){const g=u.tasks.indexOf(l);u.tasks.splice(g,1)}l.emitter.emit(l.taskUid,f),u.semaphore.release()})()}executeTask(l){var u=this;return Q(function*(){return new Promise((f,g)=>{let m=u.tasks.find(v=>v.taskUid===l);m||(m={taskUid:l,emitter:new cl,completed:!1,cancelled:!1,running:!1},u.tasks.push(m)),m.cancelled=!1,m.emitter.on(l,v=>{f(v)}),m.running||(m.running=!0,u.process(m))})})()}cancel(l){const u=this.tasks.find(f=>f.taskUid===l);u&&(u.cancelled=!0)}destroy(){this.tasks=[]}handler(l){return Q(function*(){return Promise.resolve(null)})()}}{handler(l){return Q(function*(){return new Promise((u,f)=>{const g=new Image;g.crossOrigin="Anonymous",g.onload=()=>{g.onload=null,g.onerror=null,u(g)},g.onerror=m=>{g.onload=null,g.onerror=null,u(null)},g.src=l})})()}}class lse extends R0{constructor(l,u){super(),S(this,"core",void 0),S(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Q(function*(){let f=u.core.pageService.getPage(l);if(!f||f.isDestroyed)return null;let{img:g}=f.raw;if(!g){let{url:m}=f.raw;if(!m){let v=f.raw.data;if(!v){let y=yield u.core.imageDataService.getRaw(l);const x=u.core.pageService.getPage(l);if(!x||(f.isDestroyed&&!x.isDestroyed&&(y=yield u.core.imageDataService.getRaw(l,!0)),!y||x.isDestroyed))return null;v=y.data}m=URL.createObjectURL(v),f.raw.url=m}if(g=yield u.imageLoader.executeTask(m),f=u.core.pageService.getPage(l),!f||f.isDestroyed)return null;f.raw.img=g}return g})()}}class cse extends R0{constructor(l,u){super(),S(this,"core",void 0),S(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Q(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.original)||void 0===f?void 0:f.img;if(!m){var v;let x=null===(v=g.original)||void 0===v?void 0:v.url;if(!x){var y;let w=null===(y=g.original)||void 0===y?void 0:y.data;if(!w){let C=yield u.core.imageDataService.getOriginal(l);const _=u.core.pageService.getPage(l);if(!_||(g.isDestroyed&&!_.isDestroyed&&(C=yield u.core.imageDataService.getRaw(l,!0)),!C||_.isDestroyed))return null;w=C.data}x=URL.createObjectURL(w),g.original.url=x}if(m=yield u.imageLoader.executeTask(x),g=u.core.pageService.getPage(l),!g||g.isDestroyed)return null;g.original.img=m}return m})()}}class hse extends R0{constructor(l,u){super(),S(this,"core",void 0),S(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Q(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.display)||void 0===f?void 0:f.img;if(!m){var v;let x=null===(v=g.display)||void 0===v?void 0:v.url;if(!x){var y;let C=null===(y=g.display)||void 0===y?void 0:y.data;if(!C){let _=yield u.core.imageDataService.getDisplay(l,!0);const T=u.core.pageService.getPage(l);if(!T||(g.isDestroyed&&!T.isDestroyed&&(_=yield u.core.imageDataService.getDisplay(l,!0)),!_||T.isDestroyed))return null;C=_.data}x=URL.createObjectURL(C),g.display.url=x}const{filter:w}=g;if(m=yield u.imageLoader.executeTask(x),g=u.core.pageService.getPage(l),!g||g.isDestroyed)return null;if(w!==g.filter)return u.handler(g.uid);g.display.img=m}return m})()}}class dse extends R0{constructor(l,u){super(),S(this,"core",void 0),S(this,"imageLoader",void 0),this.core=l,this.imageLoader=u}handler(l){var u=this;return Q(function*(){var f;let g=u.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=null===(f=g.thumbnail)||void 0===f?void 0:f.img;if(!m){var v;let x=null===(v=g.thumbnail)||void 0===v?void 0:v.url;if(!x){var y;let w=null===(y=g.thumbnail)||void 0===y?void 0:y.data;if(!w){const C=yield u.core.imageDataService.getThumbnail(l);if(g=u.core.pageService.getPage(l),!C||g.isDestroyed)return null;w=C.data}x=URL.createObjectURL(w),g.thumbnail.url=x}if(m=yield u.imageLoader.executeTask(x),g=u.core.pageService.getPage(l),g.isDestroyed)return null;g.thumbnail.img=m}return m})()}}class use{constructor(l){S(this,"rawImageLoader",void 0),S(this,"originalImageLoader",void 0),S(this,"displayImageLoader",void 0),S(this,"thumbnailImageLoader",void 0);const u=new R0;this.rawImageLoader=new lse(l,u),this.originalImageLoader=new cse(l,u),this.displayImageLoader=new hse(l,u),this.thumbnailImageLoader=new dse(l,u)}loadRawImage(l){var u=this;return Q(function*(){return u.rawImageLoader.executeTask(l)})()}cancelLoadRawImage(l){this.rawImageLoader.cancel(l)}loadOriginalImage(l){var u=this;return Q(function*(){return u.originalImageLoader.executeTask(l)})()}cancelLoadOriginalImage(l){this.originalImageLoader.cancel(l)}loadDisplayImage(l){var u=this;return Q(function*(){return u.displayImageLoader.executeTask(l)})()}cancelLoadDisplayImage(l){this.displayImageLoader.cancel(l)}loadThumbnailImage(l){var u=this;return Q(function*(){return u.thumbnailImageLoader.executeTask(l)})()}cancelLoadThumbnailImage(l){this.thumbnailImageLoader.cancel(l)}}class fse{constructor(l,u,f){S(this,"worker",void 0),S(this,"id",void 0),S(this,"manager",void 0),S(this,"callbacks",{}),S(this,"busy",!1),S(this,"counter",0),S(this,"tasks",[]),this.worker=l,this.id=u,this.manager=f,this.worker.addEventListener("message",g=>{this.onMessage(g)},!1)}cancel(l){const u=this.tasks.findIndex(f=>{var g;return(null===(g=f.data)||void 0===g?void 0:g.taskUid)===l});if(u>=0){const f=this.tasks.splice(u,1)[0];this.callbacks[f.callbackId]&&delete this.callbacks[f.callbackId],this.setBusy(!1)}}setBusy(l){if(this.busy=l,!l)if(this.tasks.length){const u=this.tasks.shift();this.send(u)}else this.worker.terminate(),this.manager.removeActor(this)}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(l){this.setBusy(!1);const{callbackId:u}=l.data,f=u?this.callbacks[u]:null;f&&f(l.data),delete this.callbacks[u]}send(l,u){if(this.busy)return void this.tasks.push(ne({},l));this.setBusy(!0);const f=`${this.id}-${l.action}-cb-${this.counter}`;l.callback&&(this.callbacks[f]=l.callback,this.counter+=1),l.callbackId=f;const g=Fe(ne({},l.data),{callbackId:f});u?this.worker.postMessage(g,[u.data.buffer]):this.worker.postMessage(g)}}class pse{constructor(l,u){S(this,"concurrency",1),S(this,"actors",[]),S(this,"workerUrl",void 0),this.workerUrl=l,this.concurrency=u}send(l,u){this.getActor().send(l,u)}getActor(){const l=this.actors.filter(f=>!f.isBusy())[0];if(l)return l;if(this.actors.length<this.concurrency){const f=new Worker(this.workerUrl),g=new fse(f,this.actors.length,this);return this.actors.push(g),g}const u=Math.floor(Math.random()*this.concurrency);return this.actors[u]}removeActor(l){const u=this.actors.indexOf(l);this.actors.splice(u,1)}cancel(l){for(const u of this.actors)u.cancel(l)}clear(){for(const l of this.actors)l.getWorker().terminate();this.actors=[]}}function gse(){onmessage=p=>{const{index:l}=p.data,u=p.data.sourceWidth,f=p.data.sourceHeight,g=p.data.width,m=p.data.height,v=p.data.source.data,y=g*m*4,x=new ArrayBuffer(y);let w=null;try{w=new Uint8ClampedArray(x,0,y)}catch(_){w=new Uint8Array(x,0,y)}for(let _=0;_<m;_++){const T=_*f/m,M=Math.floor(T),L=1-(T-M),N=M,V=(_+1)*f/m,H=Math.floor(V-1e-5),G=V-H,z=H;let q=_*g*4;for(let te=0;te<g;te++){const se=te*u/g,ae=Math.floor(se),j=1-(se-ae),le=ae,ue=(te+1)*u/g,xe=Math.floor(ue-1e-5),I=ue-xe,A=xe;let P=0,O=0,b=0,D=0,k=0;const U=255;let F,B,W=(N+1)*u*4+4*le;for(F=N+1;F<z;++F)P+=v[W+2]*j*U,O+=v[W+1]*j*U,b+=v[W]*j*U,D+=v[W+3]*j*U,k+=U*j,W+=4*u;let $=(N+1)*u*4+4*A;for(F=N+1;F<z;++F)P+=v[$+2]*I*U,O+=v[$+1]*I*U,b+=v[$]*I*U,D+=v[$+3]*I*U,k+=U*I,$+=4*u;let Y=N*u*4+4*(le+1);for(B=le+1;B<A;++B)P+=v[Y+2]*L*U,O+=v[Y+1]*L*U,b+=v[Y]*L*U,D+=v[Y+3]*L*U,k+=U*L,Y+=4;let J=z*u*4+4*(le+1);for(B=le+1;B<A;++B)P+=v[J+2]*G*U,O+=v[J+1]*G*U,b+=v[J]*G*U,D+=v[J+3]*G*U,k+=U*G,J+=4;for(F=N+1;F<z;++F){let ce=F*u*4+4*(le+1);for(B=le+1;B<A;++B)P+=v[ce+2]*U,O+=v[ce+1]*U,b+=v[ce]*U,D+=v[ce+3]*U,k+=U,ce+=4}let X=N*u*4+4*le;P+=v[X+2]*(L*j)*U,O+=v[X+1]*(L*j)*U,b+=v[X]*(L*j)*U,D+=v[X+3]*(L*j)*U,k+=U*(L*j),X=N*u*4+4*A,P+=v[X+2]*(L*I)*U,O+=v[X+1]*(L*I)*U,b+=v[X]*(L*I)*U,D+=v[X+3]*(L*I)*U,k+=U*(L*I),X=z*u*4+4*le,P+=v[X+2]*(G*j)*U,O+=v[X+1]*(G*j)*U,b+=v[X]*(G*j)*U,D+=v[X+3]*(G*j)*U,k+=U*(G*j),X=z*u*4+4*A,P+=v[X+2]*(G*I)*U,O+=v[X+1]*(G*I)*U,b+=v[X]*(G*I)*U,D+=v[X+3]*(G*I)*U,k+=U*(G*I);let Ae=D/k,Ce=0,_e=0,ge=0;0!==Ae&&(Ce=P/k,_e=O/k,ge=b/k),Ce+=.5,_e+=.5,ge+=.5,Ae+=.5,w[q]=Math.floor(ge),q+=1,w[q]=Math.floor(_e),q+=1,w[q]=Math.floor(Ce),q+=1,w[q]=Math.floor(Ae),q+=1}}const C={index:l,target:w,taskUid:p.data.taskUid,callbackId:p.data.callbackId};try{postMessage(C,[w.buffer])}catch(_){postMessage(C,null)}w=null}}class vse{constructor(){}reset(){}perspectivePreview(l,u,f,g){var m=arguments;return Q(function*(){var v,y,x;let w=m.length>4&&void 0!==m[4]?m[4]:{};const C=new Ch,_=yield C.initImage({source:l,isRGBA:u===Ri.RGBA,width:g.width,height:g.height,isBGRA:u===Ri.BGRA});_.srcBuffer&&(l=_.srcBuffer);let T=g.width,M=g.height;const L=null!==(v=g.angle)&&void 0!==v?v:0;90!==L&&270!==L||(T=g.height,M=g.width);const N=Math.min((null!==(y=w.width)&&void 0!==y?y:T)/T,(null!==(x=w.height)&&void 0!==x?x:M)/M),V=Math.floor(T*N+.5),H=Math.floor(M*N+.5);yield C.resize(V,H,w.mode),null!=g&&g.angle&&(yield C.rotate({angle:g.angle}));const G=[[Math.floor(f[0][0]*N+.5),Math.floor(f[0][1]*N+.5)],[Math.floor(f[1][0]*N+.5),Math.floor(f[1][1]*N+.5)],[Math.floor(f[2][0]*N+.5),Math.floor(f[2][1]*N+.5)],[Math.floor(f[3][0]*N+.5),Math.floor(f[3][1]*N+.5)]];yield C.drawQuadrangle({location:G,strokeColor:w.strokeColor,lineWidth:w.lineWidth});const z=yield C.getImage({ifDeleteObject:!0,isRGBA:u===Ri.RGBA,returnBlob:!1});yield C.freeReservedData();const q={data:new Blob([z.imageData],{type:z.blobType}),width:z.imageWidth,height:z.imageHeight,resolutionX:z.imageXResolution,resolutionY:z.imageYResolution};return C.terminate(),q})()}resize(l,u,f,g,m){var v=arguments;return Q(function*(){let y=v.length>5&&void 0!==v[5]?v[5]:{};const x=new Ch,w=yield x.initImage({source:l,isRGBA:u===Ri.RGBA,width:f,height:g,isBGRA:u===Ri.BGRA});if(w.srcBuffer&&(l=w.srcBuffer),m>0){let T=1;T=f>g?f/m:g/m;const M=Math.floor(f/T+.5),L=Math.floor(g/T+.5);yield x.resize(M,L,y.mode)}const C=yield x.getImage({ifDeleteObject:!0,isRGBA:u===Ri.RGBA,returnBlob:!1});yield x.freeReservedData();const _={data:new Blob([C.imageData],{type:C.blobType}),width:C.imageWidth,height:C.imageHeight,resolutionX:C.imageXResolution,resolutionY:C.imageYResolution};return x.terminate(),_})()}}class Ct{constructor(l){}}class uE extends Ct{static create(l,u){return new uE(l,u)}constructor(l,u){super("cameraChanged"),S(this,"oldDeviceId",void 0),S(this,"newDeviceId",void 0),this.oldDeviceId=l,this.newDeviceId=u}}class fE extends Ct{static create(l){return new fE(l)}constructor(l){super("captured"),S(this,"pageUid",void 0),this.pageUid=l}}class pE extends Ct{static create(l){return new pE(l)}constructor(l){super("cropRectDeleted"),S(this,"rect",void 0),this.rect=l}}class gE extends Ct{static create(l){return new gE(l)}constructor(l){super("cropRectDrawn"),S(this,"rect",void 0),this.rect=l}}class mE extends Ct{static create(l,u){return new mE(l,u)}constructor(l,u){super("cropRectModified"),S(this,"oldRect",void 0),S(this,"newRect",void 0),this.oldRect=l,this.newRect=u}}class vE extends Ct{static create(l,u){return new vE(l,u)}constructor(l,u){super("currentIndexChanged"),S(this,"oldIndex",void 0),S(this,"newIndex",void 0),this.oldIndex=l,this.newIndex=u}}class yE extends Ct{static create(l,u){return new yE(l,u)}constructor(l,u){super("displayModeChanged"),S(this,"oldDisplayMode",void 0),S(this,"newDisplayMode",void 0),this.oldDisplayMode=l,this.newDisplayMode=u}}class xx extends Ct{static create(l,u){return new xx(l,u)}constructor(l,u){super("document"),S(this,"docUid",void 0),S(this,"docName",void 0),this.docUid=l,this.docName=u}}class yp extends Ct{static create(l,u){return new yp(l,u)}constructor(l,u){super("fitModeChanged"),S(this,"oldFitMode",void 0),S(this,"newFitMode",void 0),this.oldFitMode=l,this.newFitMode=u}}class xE extends Ct{static create(l,u){return new xE(l,u)}constructor(l,u){super("pagesDragged"),S(this,"indices",void 0),S(this,"pageUids",void 0),this.indices=l,this.pageUids=u}}class wE extends Ct{static create(l,u,f){return new wE(l,u,f)}constructor(l,u,f){super("pagesDropped"),S(this,"indicesBefore",void 0),S(this,"indicesAfter",void 0),S(this,"pageUids",void 0),this.indicesBefore=l,this.indicesAfter=u,this.pageUids=f}}class CE extends Ct{static create(l,u){return new CE(l,u)}constructor(l,u){super("pageRendered"),S(this,"index",void 0),S(this,"pageUid",void 0),this.index=l,this.pageUid=u}}class xp extends Ct{static create(l,u,f){return new xp(l,u,f)}constructor(l,u,f){super("pagesAdded"),S(this,"docUid",void 0),S(this,"indices",void 0),S(this,"pageUids",void 0),this.docUid=l,this.indices=u,this.pageUids=f}}class wx extends Ct{static create(l,u,f){return new wx(l,u,f)}constructor(l,u,f){super("pagesDeleted"),S(this,"docUid",void 0),S(this,"pageUids",void 0),S(this,"indices",void 0),this.docUid=l,this.pageUids=u,this.indices=f}}class bE extends Ct{static create(l,u){return new bE(l,u)}constructor(l,u){super("played"),S(this,"deviceId",void 0),S(this,"resolution",void 0),this.deviceId=l,this.resolution=u}}class Cx extends Ct{static create(l,u){return new Cx(l,u)}constructor(l,u){super("quadModified"),S(this,"oldQuad",void 0),S(this,"newQuad",void 0),this.oldQuad=l,this.newQuad=u}}class _E extends Ct{static create(l,u,f,g){return new _E(l,u,f,g)}constructor(l,u,f,g){super("resized"),S(this,"oldWidth",void 0),S(this,"oldHeight",void 0),S(this,"newWidth",void 0),S(this,"newHeight",void 0),this.oldWidth=l,this.oldHeight=u,this.newWidth=f,this.newHeight=g}}class SE extends Ct{static create(l,u,f,g){return new SE(l,u,f,g)}constructor(l,u,f,g){super("selectedPagesChanged"),S(this,"oldIndices",void 0),S(this,"newIndices",void 0),S(this,"oldPageUids",void 0),S(this,"newPageUids",void 0),this.oldIndices=l,this.newIndices=u,this.oldPageUids=f,this.newPageUids=g}}class EE extends Ct{static create(l){return new EE(l)}constructor(l){super("stopped"),S(this,"deviceId",void 0),this.deviceId=l}}class TE extends Ct{static create(l,u){return new TE(l,u)}constructor(l,u){super("toolModeChanged"),S(this,"oldToolMode",void 0),S(this,"newToolMode",void 0),this.oldToolMode=l,this.newToolMode=u}}class bx extends Ct{static create(l,u,f,g,m,v,y){return new bx(l,u,f,g,m,v,y)}constructor(l,u,f,g,m,v,y){super("vPointer"),S(this,"index",void 0),S(this,"pageUid",void 0),S(this,"imageX",void 0),S(this,"imageY",void 0),S(this,"canvasX",void 0),S(this,"canvasY",void 0),S(this,"nativeEvent",void 0),this.index=l,this.pageUid=u,this.imageX=f,this.imageY=g,this.canvasX=m,this.canvasY=v,this.nativeEvent=y}}class DE extends Ct{static create(l,u){return new DE(l,u)}constructor(l,u){super("zoomChanged"),S(this,"oldZoomRatio",void 0),S(this,"newZoomRatio",void 0),this.oldZoomRatio=l,this.newZoomRatio=u}}class AE extends Ct{static create(l,u){return new AE(l,u)}constructor(l,u){super("currentPageChanged"),S(this,"oldPageUid",void 0),S(this,"newPageUid",void 0),this.oldPageUid=l,this.newPageUid=u}}class IE extends Ct{static create(l,u){return new IE(l,u)}constructor(l,u){super("selectedAnnotationsChanged"),S(this,"oldAnnotationUids",void 0),S(this,"newAnnotationUids",void 0),this.oldAnnotationUids=l,this.newAnnotationUids=u}}class PE extends Ct{static create(l,u){return new PE(l,u)}constructor(l,u){super("annotationModeChanged"),S(this,"oldAnnotationMode",void 0),S(this,"newAnnotationMode",void 0),this.oldAnnotationMode=l,this.newAnnotationMode=u}}class RE extends Ct{static create(l){return new RE(l)}constructor(l){super("annotationLayerStateChanged"),S(this,"state",void 0),this.state=l}}class ME extends Ct{static create(l,u,f,g){return new ME(l,u,f,g)}constructor(l,u,f,g){super("addPagesToDoc"),S(this,"docUid",void 0),S(this,"pageUids",void 0),S(this,"indices",void 0),S(this,"index",void 0),this.docUid=l,this.pageUids=u,this.indices=f,this.index=g}}class kE extends Ct{static create(l,u,f){return new kE(l,u,f)}constructor(l,u,f){super("createPage"),S(this,"pageUid",void 0),S(this,"fileUid",void 0),S(this,"fileIndex",void 0),this.pageUid=l,this.fileUid=u,this.fileIndex=f}}class OE extends Ct{static create(l,u,f){return new OE(l,u,f)}constructor(l,u,f){super("movePages"),S(this,"docUid",void 0),S(this,"indices",void 0),S(this,"insertBeforeIndex",void 0),this.docUid=l,this.indices=u,this.insertBeforeIndex=f}}class LE extends Ct{static create(l,u,f){return new LE(l,u,f)}constructor(l,u,f){super("renameDocument"),S(this,"docUid",void 0),S(this,"oldName",void 0),S(this,"newName",void 0),this.docUid=l,this.oldName=u,this.newName=f}}class FE extends Ct{static create(l,u){return new FE(l,u)}constructor(l,u){super("reorderPages"),S(this,"docUid",void 0),S(this,"indices",void 0),this.docUid=l,this.indices=u}}class NE extends Ct{static create(l,u,f){return new NE(l,u,f)}constructor(l,u,f){super("switchPage"),S(this,"docUid",void 0),S(this,"one",void 0),S(this,"another",void 0),this.docUid=l,this.one=u,this.another=f}}class BE extends Ct{static create(l,u,f){return new BE(l,u,f)}constructor(l,u,f){super("updatePage"),S(this,"docUid",void 0),S(this,"pageUid",void 0),S(this,"data",void 0),this.docUid=l,this.pageUid=u,this.data=f}}class UE extends Ct{static create(l){return new UE(l)}constructor(l){super("autoCaptureChanged"),S(this,"enableAutoCapture",void 0),this.enableAutoCapture=l}}class VE extends Ct{static create(l){return new VE(l)}constructor(l){super("autoDetectChanged"),S(this,"enableAutoDetect",void 0),this.enableAutoDetect=l}}class jE extends Ct{static create(l){return new jE(l)}constructor(l){super("torchChanged"),S(this,"torchState",void 0),this.torchState=l}}class HE extends Ct{static create(l){return new HE(l)}constructor(l){super("cameraPlayed"),S(this,"resolution",void 0),this.resolution=l}}class M0 extends Ct{static create(l,u){return new M0(l,u)}constructor(l,u){super("paginationChanged"),S(this,"current",void 0),S(this,"total",void 0),this.current=l,this.total=u}}class WE extends Ct{static create(l,u){return new WE(l,u)}constructor(l,u){super("visibleChanged"),S(this,"newVisibility",void 0),S(this,"oldVisibility",void 0),this.newVisibility=l,this.oldVisibility=u}}class GE extends Ct{static create(l,u,f){return new GE(l,u,f)}constructor(l,u,f){super("openDocument"),S(this,"doc",void 0),S(this,"viewerUid",void 0),S(this,"groupUid",void 0),this.doc=l,this.viewerUid=u,this.groupUid=f}}class zE extends Ct{static create(l,u,f){return new zE(l,u,f)}constructor(l,u,f){super("closeDocument"),S(this,"doc",void 0),S(this,"viewerUid",void 0),S(this,"groupUid",void 0),this.doc=l,this.viewerUid=u,this.groupUid=f}}class $E extends Ct{static create(l,u,f,g){return new $E(l,u,f,g)}constructor(l,u,f,g){super("gotoPage"),S(this,"docUid",void 0),S(this,"groupUid",void 0),S(this,"viewerUid",void 0),S(this,"index",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.index=g}}class _x extends Ct{static create(l){return new _x(l)}constructor(l){super("cameraInit"),S(this,"enableConvert",void 0),this.enableConvert=l}}class YE extends Ct{static create(l,u,f,g){return new YE(l,u,f,g)}constructor(l,u,f,g){super("selectPages"),S(this,"docUid",void 0),S(this,"groupUid",void 0),S(this,"viewerUid",void 0),S(this,"indices",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.indices=g}}class Sx extends Ct{static create(l,u,f){return new Sx(l,u,f)}constructor(l,u,f){super("filterChanged"),S(this,"docUid",void 0),S(this,"pageUids",void 0),S(this,"filterType",void 0),this.docUid=l,this.pageUids=u,this.filterType=f}}class Ex extends Ct{static create(l,u,f,g){return new Ex(l,u,f,g)}constructor(l,u,f,g){super("currentChangedByScroll"),S(this,"docUid",void 0),S(this,"groupUid",void 0),S(this,"viewerUid",void 0),S(this,"current",void 0),this.docUid=l,this.groupUid=u,this.viewerUid=f,this.current=g}}class Tx extends Ct{static create(l,u,f){return new Tx(l,u,f)}constructor(l,u,f){super("rotatePages"),S(this,"docUid",void 0),S(this,"angle",void 0),S(this,"pageUids",void 0),this.docUid=l,this.angle=u,this.pageUids=f}}class Dx extends Ct{static create(l,u,f){return new Dx(l,u,f)}constructor(l,u,f){super("cropPages"),S(this,"docUid",void 0),S(this,"rect",void 0),S(this,"pageUids",void 0),this.docUid=l,this.rect=u,this.pageUids=f}}class wp extends Ct{static create(l,u){return new wp(l,u)}constructor(l,u){super("perspectiveQuadChanged"),S(this,"quad",void 0),S(this,"isFull",void 0),this.quad=l,this.isFull=u}}class k0 extends Ct{static create(l){return new k0(l)}constructor(l){super("deletePages"),S(this,"pageUids",void 0),this.pageUids=l}}class XE extends Ct{static create(l,u,f){return new XE(l,u,f)}constructor(l,u,f){super("operationsChanged"),S(this,"docUid",void 0),S(this,"undo",void 0),S(this,"redo",void 0),this.docUid=l,this.undo=u,this.redo=f}}class qE extends Ct{static create(l,u,f,g,m){return new qE(l,u,f,g,m)}constructor(l,u,f,g,m){super("perspective"),S(this,"docUid",void 0),S(this,"pageUid",void 0),S(this,"quad",void 0),S(this,"width",void 0),S(this,"height",void 0),this.docUid=l,this.pageUid=u,this.quad=f,this.width=g,this.height=m}}class ZE extends Ct{static create(l){return new ZE(l)}constructor(l){super("pageExistenceChanged"),S(this,"pageCount",void 0),this.pageCount=l}}class JE extends Ct{static create(l){return new JE(l)}constructor(l){super("deleteDocs"),S(this,"docUids",void 0),this.docUids=l}}class Ax extends Ct{static create(l,u,f,g){return new Ax(l,u,f,g)}constructor(l,u,f,g){super("pagePreloadChanged"),S(this,"docUid",void 0),S(this,"viewerUid",void 0),S(this,"viewerMode",void 0),S(this,"changes",void 0),this.docUid=l,this.viewerUid=u,this.viewerMode=f,this.changes=g}}class QE extends Ct{static create(l){return new QE(l)}constructor(l){super("viewerCreated"),S(this,"viewer",void 0),this.viewer=l}}class KE extends Ct{static create(l,u){return new KE(l,u)}constructor(l,u){super("annotationsUpdated"),S(this,"uids",void 0),S(this,"actions",void 0),this.uids=l,this.actions=u}}class eT extends Ct{static create(l,u,f,g){return new eT(l,u,f,g)}constructor(l,u,f,g){super("copyPage"),S(this,"pageUid",void 0),S(this,"fileUid",void 0),S(this,"fileIndex",void 0),S(this,"annotations",void 0),this.pageUid=l,this.fileUid=u,this.fileIndex=f,this.annotations=g}}let nF=0;const sF=()=>{const p=`doc-${Date.now().toString()}-${nF.toString()}`;return nF+=1,p};function Lr(p){if(p||(p=`D:${l9("yyyyMMddhhmmss")}`),/[+-]\d{2}'\d{2}'$/.test(p))return p;const l=-(new Date).getTimezoneOffset();return`${p}${l>=0?"+":"-"}${String(Math.floor(Math.abs(l)/60)).padStart(2,"0")}'${String(Math.abs(l)%60).padStart(2,"0")}'`}class yse{constructor(){var l,u;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,"type",void 0),S(this,"uid",void 0),S(this,"name",void 0),S(this,"pages",void 0),S(this,"tags",void 0),S(this,"creationDate",void 0),S(this,"author",void 0),S(this,"isDestroyed",void 0),S(this,"pageSize",void 0),this.uid=qt(),this.name=null!==(l=f.name)&&void 0!==l?l:sF(),this.type=f.type||"document",this.pages=[],this.tags=f.tags||[],this.creationDate=Lr(f.creationDate),this.author=null!==(u=f.author)&&void 0!==u?u:"",this.pageSize="none"}dispose(){this.isDestroyed=!0}}class xse{constructor(){S(this,"users",void 0),this.users=[]}addUser(l){this.users.push(l)}deleteUser(l){const u=this.users.indexOf(l);u>-1&&this.users.splice(u,1)}}var rF;!function(p){p.IMAGE_PNG="image/png",p.IMAGE_JPEG="image/jpeg",p.IMAGE_BMP="image/bmp",p.IMAGE_TIFF="image/tiff",p.IMAGE_JP2="image/jp2",p.APPLICATION_PDF="application/pdf"}(rF||(rF={}));class wse{constructor(l){let{uid:u,mime:f,pageCount:g}=l;S(this,"uid",void 0),S(this,"mime",void 0),S(this,"pageCount",void 0),S(this,"name",void 0),S(this,"count",void 0),S(this,"pages",void 0),this.uid=u,this.mime=f,this.count=0,this.pages=[],this.pageCount=g;for(let m=0;m<g;m++){const v=new xse;this.pages.push(v)}}getPageByIndex(l){return this.pages[l]}addUser(l,u){const f=this.pages[l];return!!f&&(f.addUser(u),this.count+=1,!0)}deleteUser(l,u){const f=this.pages[l];return!!f&&(f.deleteUser(u),this.count-=1,!0)}}function oF(p,l,u,f){if(0==(l=(l%360+360)%360))return p;const g=l/90;for(let m=0;m<4;m++){const v=p[2*m],y=p[2*m+1];1===g?(p[2*m]=y,p[2*m+1]=f-v):2===g?(p[2*m]=u-v,p[2*m+1]=f-y):3===g&&(p[2*m]=u-y,p[2*m+1]=v)}return aF(p,8-2*g),p}function tT(p,l,u,f){if(0==(l=(l%360+360)%360))return p;const g=l/90;for(let m=0;m<4;m++){const v=p[2*m],y=p[2*m+1];1===g?(p[2*m]=f-y,p[2*m+1]=v):2===g?(p[2*m]=u-v,p[2*m+1]=f-y):3===g&&(p[2*m]=y,p[2*m+1]=u-v)}return aF(p,2*g),p}function iT(p,l,u){for(;l<u;){const f=p[l];p[l]=p[u],p[u]=f,l+=1,u-=1}}function aF(p,l){const u=l%p.length;0!==u&&(iT(p,0,p.length-1),iT(p,0,u-1),iT(p,u,p.length-1))}const Ix=p=>Array(4).fill(0).map((l,u)=>[p[2*u],p[2*u+1]]),lF=(p,l,u)=>0===p[0][0]&&0===p[0][1]&&p[1][0]===l&&0===p[1][1]&&p[2][0]===l&&p[2][1]===u&&0===p[3][0]&&p[3][1]===u;class xl{constructor(l){S(this,"data",void 0),S(this,"width",void 0),S(this,"height",void 0),S(this,"url",void 0),S(this,"img",void 0),S(this,"users",void 0),S(this,"isDestroyed",void 0),S(this,"isAvailable",void 0),S(this,"pageWidth",void 0),S(this,"pageHeight",void 0),S(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=l}getImageDetail(){const{docPage:l}=this;return{data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:l.resolutionX,resolutionY:l.resolutionY,url:this.url,img:this.img}}getPageSize(){return{width:this.pageWidth,height:this.pageHeight}}updateImageDetail(l){if(!l)return;l.data&&(this.isAvailable=!0,this.data=l.data);const{docPage:u}=this;this.width=l.width,this.height=l.height,this.pageWidth=l.width/u.resolutionX*yt.displayResolution,this.pageHeight=l.height/u.resolutionY*yt.displayResolution}addUser(l){this.getUserIndex(l)<0&&this.users.push(l)}deleteUser(l){const u=this.getUserIndex(l);u>-1&&this.users.splice(u,1)}hasUser(){return!!this.users.length}reset(){this.resetBlob(),this.resetImg()}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null}getUserIndex(l){return this.users.findIndex(u=>{let{viewerUid:f,docUid:g,pageUid:m}=u;return f===l.viewerUid&&g===l.docUid&&m===l.pageUid})}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset()}}function cF(p){const l=function(m){[...m].sort((M,L)=>L[1]-M[1]);let y=Number.MAX_SAFE_INTEGER,x=0;m.forEach((M,L)=>{M[1]<y&&([,y]=M,x=L)});const w=(x+3)%4,C=(x+1)%4,_=hF(m[w],m[x]);return hF(m[C],m[x])>_?w:x}(p),u=p.map((m,v)=>{let y=p[v+1];return 3===v&&([y]=p),dF(y,m)});let f=Math.max(u[l],u[(l+2)%4]),g=Math.max(u[(l+1)%4],u[(l+3)%4]);return f=Math.round(f),g=Math.round(g),{width:f,height:g}}function hF(p,l){const u=Math.abs(p[0]-l[0]),f=dF(p,l);return Math.acos(u/f)}function dF(p,l){return((p[0]-l[0])**2+(p[1]-l[1])**2)**.5}const Rh=p=>{!p||p.forEach(l=>{const u=Math.ceil(l[0]);l[0]=u-l[0]<=1e-7?u:Math.floor(l[0]);const f=Math.ceil(l[1]);l[1]=f-l[1]<=1e-7?f:Math.floor(l[1])})};function O0(p,l,u,f){l=(l%360+360)%360;const g=ne({},p),{left:m,top:v,width:y,height:x}=p,w=Math.floor(l/90);return 1===w?(g.left=f-v-x,g.top=m):2===w?(g.left=u-m-y,g.top=f-v-x):3===w&&(g.left=v,g.top=u-m-y),w%2>0&&(g.width=x,g.height=y),g}class Px{constructor(l,u){let{fileIndex:f,pageUid:g,fileUid:m,rotation:v,filter:y,perspectiveQuad:x,annotations:w,pdfOptions:C,resource:_,cropBox:T,mediaBox:M,pageSize:L}=l;S(this,"uid",void 0),S(this,"doc",void 0),S(this,"metadata",void 0),S(this,"customData",void 0),S(this,"fileUid",void 0),S(this,"fileIndex",void 0),S(this,"resolutionX",void 0),S(this,"resolutionY",void 0),S(this,"filter",void 0),S(this,"rotation",void 0),S(this,"quad",void 0),S(this,"activeQuad",void 0),S(this,"isFull",void 0),S(this,"raw",void 0),S(this,"original",void 0),S(this,"display",void 0),S(this,"thumbnail",void 0),S(this,"editedDisplay",void 0),S(this,"initRotation",void 0),S(this,"editRotation",void 0),S(this,"actionRotation",void 0),S(this,"actions",void 0),S(this,"pActions",void 0),S(this,"actionResult",void 0),S(this,"pActionResult",void 0),S(this,"isDestroyed",void 0),S(this,"annotations",void 0),S(this,"pageSize",void 0),S(this,"cropBox",void 0),S(this,"mediaBox",void 0),S(this,"resource",void 0),S(this,"editCaches",void 0),S(this,"pdfOptions",void 0),S(this,"initState",void 0),this.uid=g,this.doc=u,this.annotations=w||[],this.resolutionX=_.resolutionX,this.resolutionY=_.resolutionY,this.fileIndex=f,this.fileUid=m,this.pageSize=null!=L?L:"none",this.resource=_,"none"===this.pageSize&&(this.mediaBox=ne({},M),this.cropBox=ne({},T)),this.filter=y,this.rotation=v||0,this.initRotation=v||0,this.editRotation=v||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=C,this.raw=new xl(this),this.original=new xl(this),this.display=new xl(this),this.thumbnail=new xl(this),this.editedDisplay=new xl(this);let N={width:_.width,height:_.height};if(this.raw.updateImageDetail(N),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:v},x){N=cF(x),this.mediaBox={left:0,top:0,width:bt(N.width,_.resolutionX,yt.displayResolution),height:bt(N.height,_.resolutionY,yt.displayResolution)},this.cropBox=ne({},this.mediaBox);const V=this.quadToDisplayPPI(x);this.setQuad(V)}this.original.updateImageDetail(N),this.display.updateImageDetail(N),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map}isMediaBoxEqualCropBox(){const{mediaBox:l,cropBox:u}=this;return l.left===u.left&&l.top===u.top&&l.width===u.width&&l.height===u.height}getPageSize(){return"inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(l,u){const f=new Px({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:l,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&qe(this.pdfOptions),mediaBox:qe(this.mediaBox),cropBox:qe(this.cropBox),resource:qe(this.resource),annotations:[]},u),g=qe(this.actions);g.forEach(y=>{y.docUid=u.uid});const m=qe(this.pActions);m.forEach(y=>{y.docUid=u.uid}),f.actions=g,f.pActions=m,f.initRotation=this.initRotation,f.actionRotation=this.actionRotation,f.editRotation=this.editRotation,f.quad=qe(this.quad),f.activeQuad=qe(this.activeQuad),f.isFull=this.isFull,f.actionResult=new Map(this.actionResult),f.pActionResult=new Map(this.pActionResult);const v={width:this.mediaBox.width||this.display.width||f.raw.width,height:this.mediaBox.height||this.display.height||f.raw.height};return f.original.updateImageDetail(v),f.display.updateImageDetail(v),f}setQuad(l){const u=this.isQuadFull(l);let f=!1;if(this.isFull=u,u)this.quad&&(f=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else{const{width:g,height:m}=this.raw.getPageSize(),v=oF(l.flat(),this.rotation,g,m),y=Ix(v);let x,w;this.quad&&(w=this.quadToPixelPPI(y),x=this.quadToPixelPPI(this.quad),Rh(x),Rh(w)),this.quad&&u6(x,w)||(this.quad=y,this.activeQuad=y,f=!0),this.editRotation=this.actionRotation}return f&&this.clearActions(),f}setActiveQuad(l){const{width:u,height:f}=this.raw.getPageSize();if(!this.isFull){const g=oF(l.flat(),this.rotation,u,f),m=Ix(g);this.activeQuad=m}}getQuadVertices(){let l;const{width:u,height:f}=this.raw.getPageSize();return l=this.isFull?[0,0,u,0,u,f,0,f]:this.activeQuad.flat(),l=tT(l,this.rotation,u,f),l}getProcessedQuad(){if(this.quad){let{width:l,height:u}=this.raw.getPageSize(),{quad:f}=this;f=this.quad.map(m=>[this.toPixelPPI(m[0],!1),this.toPixelPPI(m[1],!0)]),l=this.toPixelPPI(l,!1),u=this.toPixelPPI(u,!0);const g=tT(f.flat(),this.initRotation,l,u);return Ix(g)}return null}toggleFull(){let l=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,l=!0):this.isFull||(this.isFull=!0,l=!0),l}isQuadFull(l){let{width:u,height:f}=this.raw.getPageSize();const g=Math.abs((this.rotation%360+360)%360);if(90===g||270===g){const m=u;u=f,f=m}return lF(l,u,f)}getEditResultForPixel(){const l=this.getEditResult();return{rWidth:this.toPixelPPI(l.rWidth,!1),rHeight:this.toPixelPPI(l.rHeight,!0),cropLeft:this.toPixelPPI(l.cropLeft,!1),cropTop:this.toPixelPPI(l.cropTop,!0),cropWidth:this.toPixelPPI(l.cropWidth,!1),cropHeight:this.toPixelPPI(l.cropHeight,!0),rotation:l.rotation}}getEditResult(){if(!this.actions.length){const m=O0(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return{rWidth:m.width,rHeight:m.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:ne({},this.mediaBox),cropBox:ne({},this.cropBox)}}const l=this.actions[this.actions.length-1],{rotatedCropBox:u,cropBox:f,rotation:g}=this.actionResult.get(l.actionUid).to;return{rWidth:u.width,rHeight:u.height,cropLeft:f.left,cropTop:f.top,cropWidth:f.width,cropHeight:f.height,rotation:g,mediaBox:ne({},this.mediaBox),cropBox:ne({},f)}}getEditResultForPerspective(){const l=this.raw.getPageSize(),u={left:0,top:0,width:l.width,height:l.height};if(!this.pActions.length){const y=O0(u,this.rotation,u.width,u.height);return{rWidth:y.width,rHeight:y.height,cropLeft:0,cropTop:0,cropWidth:l.width,cropHeight:l.height,rotation:this.rotation,cropBox:ne({},u),mediaBox:u}}const f=this.pActions[this.pActions.length-1],{rotatedCropBox:g,cropBox:m,rotation:v}=this.pActionResult.get(f.actionUid).to;return{rWidth:g.width,rHeight:g.height,cropLeft:m.left,cropTop:m.top,cropWidth:m.width,cropHeight:m.height,rotation:v,mediaBox:u,cropBox:ne({},m)}}getActions(){return[...this.actions]}getPerspectiveActions(){return this.pActions}addAction(l){let u=null;if(this.actions.length){const f=this.actionResult.get(this.actions[this.actions.length-1].actionUid);u={mediaBox:ne({},f.to.mediaBox),cropBox:ne({},f.to.cropBox),rotation:f.to.rotation,rotatedCropBox:ne({},f.to.rotatedCropBox)}}else u={mediaBox:ne({},this.mediaBox),cropBox:ne({},this.cropBox),rotation:this.rotation,rotatedCropBox:ne({},this.cropBox)};if(this.actions.push(l),!this.actionResult.has(l.actionUid)){const f=function(g,m,v,y){let x=ne({},g);const w=m.left+m.width,C=m.top+m.height;let _=v,T=O0(g,_,w,C);if("rotate"===y.type)_+=y.angle,T=O0(g,_,w,C);else if("crop"===y.type){const M=y.rect;T={left:M.left+T.left,top:M.top+T.top,width:M.width,height:M.height},x=function(L,N,V,H){N=(N%360+360)%360;const G=ne({},L),{left:z,top:q,width:te,height:se}=L,ae=Math.floor(N/90);return 1===ae?(G.left=q,G.top=H-te-z):2===ae?(G.left=V-te-z,G.top=H-se-q):3===ae&&(G.left=V-se-q,G.top=z),ae%2>0&&(G.width=se,G.height=te),G}(T,_,w,C)}return{rotatedCropBox:T,cropBox:x,mediaBox:m,rotation:_}}(u.cropBox,this.mediaBox,this.rotation,l);this.actionResult.set(l.actionUid,{from:u,to:f}),this.cropBox=ne({},f.cropBox),this.mediaBox=ne({},f.mediaBox)}if("rotate"===l.type){let f=null;const{width:g,height:m}=this.raw.getPageSize(),v={left:0,top:0,width:g,height:m};if(this.pActions.length){const y=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);f={mediaBox:ne({},y.to.mediaBox),cropBox:ne({},y.to.cropBox),rotation:y.to.rotation,rotatedCropBox:ne({},y.to.rotatedCropBox)}}else f={mediaBox:ne({},v),cropBox:ne({},v),rotation:this.rotation,rotatedCropBox:ne({},v)};if(this.pActions.push(l),!this.pActionResult.has(l.actionUid)){const y=function(x,w,C,_){const T=C+_.angle;return{rotatedCropBox:O0(x,T,w.left+w.width,w.top+w.height),cropBox:x,mediaBox:w,rotation:T}}({left:0,top:0,width:g,height:m},{left:0,top:0,width:g,height:m},this.rotation,l);this.pActionResult.set(l.actionUid,{from:f,to:y})}this.rotation+=l.angle}}deleteAction(l){var u,f;if((null===(u=this.actions[this.actions.length-1])||void 0===u?void 0:u.actionUid)===l){this.actions.pop();const g=this.actionResult.get(l);this.cropBox=ne({},g.from.cropBox),this.mediaBox=ne({},g.from.mediaBox),this.rotation=g.from.rotation,this.actionResult.delete(l)}(null===(f=this.pActions[this.pActions.length-1])||void 0===f?void 0:f.actionUid)===l&&(this.pActions.pop(),this.pActionResult.delete(l))}clearActions(){this.actions=[]}toDisplayPPI(l,u){const{resolutionX:f,resolutionY:g}=this;return u?l/g*yt.displayResolution:l/f*yt.displayResolution}toPixelPPI(l,u){const{resolutionX:f,resolutionY:g}=this;return u?l*g/yt.displayResolution:l*f/yt.displayResolution}quadToDisplayPPI(l){const u=qe(l);for(let f=0;f<4;f++)u[f][0]=this.toDisplayPPI(u[f][0],!1),u[f][1]=this.toDisplayPPI(u[f][1],!0);return u}quadToPixelPPI(l){const u=qe(l);for(let f=0;f<4;f++)u[f][0]=this.toPixelPPI(u[f][0],!1),u[f][1]=this.toPixelPPI(u[f][1],!0);return u}rectToDisplayPPI(l){const u=ne({},l);return u.left=this.toDisplayPPI(l.left,!1),u.top=this.toDisplayPPI(l.top,!0),u.width=this.toDisplayPPI(l.width,!1),u.height=this.toDisplayPPI(l.height,!0),u}rectToPixelPPI(l){const u=ne({},l);return u.left=this.toPixelPPI(l.left,!1),u.top=this.toPixelPPI(l.top,!0),u.width=this.toPixelPPI(l.width,!1),u.height=this.toPixelPPI(l.height,!0),u}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0}getAnnotationUids(){return[...this.annotations]}}class Cse extends mi{constructor(){super(),S(this,"uid",void 0),S(this,"emitter",void 0),S(this,"repo",void 0),S(this,"onDocumentCreated",Re(this)),S(this,"onDocumentDeleted",Re(this)),S(this,"onDocumentRenamed",Re(this)),S(this,"onPagesAdded",Re(this)),S(this,"onAddPagesToDoc",Re(this)),S(this,"onBeforeDeletePagesFromDoc",Re(this)),S(this,"onDeletePagesFromDoc",Re(this)),S(this,"onBeforeDeleteAllPagesFromDoc",Re(this)),S(this,"onDeleteAllPagesFromDoc",Re(this)),S(this,"onMovePages",Re(this)),S(this,"onSwitchPage",Re(this)),S(this,"onReorderPages",Re(this)),S(this,"onBeforeDeleteDocs",Re(this)),S(this,"onAfterDeleteDocs",Re(this)),S(this,"onOpenDocument",Re(this)),S(this,"onCloseDocument",Re(this)),this.emitter=new cl,this.uid=qt(),this.repo=new Map}dispose(){this.repo.forEach(l=>l.dispose()),this.repo.clear(),super.dispose()}reset(){this.repo.clear()}createDocument(){const l=new yse(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(l.uid,l);const u=xx.create(l.uid,l.name);return this.onDocumentCreated.emit(u),l}getDocument(l){return this.repo.get(l)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(l,u){const f=this.repo.get(l);if(!f)return!1;const g=LE.create(l,f.name,u);return f.name=u,this.onDocumentRenamed.emit(g),!0}deleteDocuments(l){return l.forEach(u=>{const f=this.getDocument(u);f.dispose(),this.repo.delete(u);const g=xx.create(u,f.name);this.onDocumentDeleted.emit(g)}),!0}addPagesToDocument(l,u,f){const g=this.repo.get(l);if(!g)return!1;const{length:m}=u,v=[];let y=g.pages.length;Ve(f)?(g.pages.splice(f,0,...u),y=f):g.pages.push(...u);for(let w=0;w<m;w++)v.push(y+w);const x=ME.create(l,u,v,f);return this.onAddPagesToDoc.emit(x),!0}removePagesFromDocument(l,u){const f=this.getDocument(l);if(!f)return!1;const g=u.map(v=>f.pages.indexOf(v));u.forEach(v=>{p9(f.pages,v)});const m=wx.create(l,u,g);return this.onBeforeDeletePagesFromDoc.emit(m),this.onDeletePagesFromDoc.emit(m),!0}removeAllPagesFromDocument(l){const u=this.getDocument(l);if(!u)return!1;const f=[...u.pages.keys()],g=[...u.pages];u.pages.length=0;const m=wx.create(l,g,f);return this.onBeforeDeleteAllPagesFromDoc.emit(m),this.onDeleteAllPagesFromDoc.emit(m),!0}movePages(l,u,f){const g=this.repo.get(l);if(!g)return!1;g9(g.pages,u,f);const m=OE.create(l,u,f);return this.onMovePages.emit(m),!0}swapPages(l,u,f){const g=this.repo.get(l);if(!g)return!1;m9(g.pages,u,f);const m=NE.create(l,u,f);return this.onSwitchPage.emit(m),!0}reorderPages(l,u){const f=this.repo.get(l);if(!f)return!1;v9(f.pages,u);const g=FE.create(l,u);return this.onReorderPages.emit(g),!0}}class uF{on(l,u){}emit(l){}}(new uF).on("debug",function(){});class bse{constructor(){S(this,"undoStack",void 0),S(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[]}getOperation(){return{undo:this.undoStack.length,redo:this.redoStack.length}}execute(l){return!!l.execute()&&(this.undoStack.push(l),this.redoStack.length>0&&(this.redoStack.forEach(u=>{u.dispose()}),this.redoStack.length=0),!0)}undo(){const l=this.undoStack.pop();return l&&(l.undo(),this.redoStack.push(l)),!!l}redo(){const l=this.redoStack.pop();return l&&(l.execute(),this.undoStack.push(l)),!!l}removeUidsFromCommand(l){this.removeFromStack(this.undoStack,l),this.removeFromStack(this.redoStack,l)}removeFromStack(l,u){l.slice().forEach(f=>{if(!f.isValid){const g=l.indexOf(f);l.splice(g,1),f.dispose()}})}reset(){this.undoStack.forEach(l=>{l.dispose()}),this.redoStack.forEach(l=>{l.dispose()}),this.undoStack=[],this.redoStack=[]}}class _se extends mi{constructor(){super(),S(this,"invokers",void 0),S(this,"onOperationsChanged",Re(this)),S(this,"onBeforeRefreshCommands",Re(this)),S(this,"onRefreshCommands",Re(this)),this.invokers=new Map}createInvoker(l){if(!this.invokers.has(l)){const u=new bse;this.invokers.set(l,u)}}deleteInvokers(l){l.forEach(u=>{if(this.invokers.has(u)){const f=this.invokers.get(u);null==f||f.reset(),this.invokers.delete(u)}})}execute(l,u){const f=this.invokers.get(u);null!=f&&f.execute(l)&&this.emitOperationsChanged(u)}undo(l){const u=this.invokers.get(l),f=!(null==u||!u.undo());return f&&this.emitOperationsChanged(l),f}redo(l){const u=this.invokers.get(l),f=!(null==u||!u.redo());return f&&this.emitOperationsChanged(l),f}saveOperations(l){const u=this.invokers.get(l);return!!u&&(u.reset(),this.emitOperationsChanged(l),!0)}getOperationState(l){return this.invokers.get(l).getOperation()}removePageFromCommand(l,u){this.onBeforeRefreshCommands.emit({docUid:l,pageUids:u}),this.invokers.get(l).removeUidsFromCommand(u),this.emitOperationsChanged(l)}emitOperationsChanged(l){const u=this.invokers.get(l);let f=0,g=0;if(u){const v=u.getOperation();f=v.undo,g=v.redo}const m=XE.create(l,f,g);this.onOperationsChanged.emit(m)}dispose(){this.invokers.clear(),super.dispose()}reset(){this.invokers.forEach(l=>{l.reset()}),this.invokers.clear()}}class Sse extends mi{constructor(){super(),S(this,"files",void 0),S(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=Re(this)}dispose(){this.files.clear(),super.dispose()}reset(){this.files.clear()}addFile(l,u,f){const g=new wse({uid:l,mime:u,pageCount:f});this.files.set(l,g)}getByUid(l){return this.files.get(l)}addUser(l,u,f){const g=this.getByUid(l);return null==g?void 0:g.addUser(u,f)}addUsersByParsedPages(l,u){u.forEach(f=>{this.addUser(l,f.fileIndex,f.pageUid)})}deleteUser(l,u,f){const g=this.getByUid(l);return g&&(g.deleteUser(u,f),g.count||(this.onDeleteFileData.emit(l),this.files.delete(l))),!1}}class Ese extends mi{constructor(l){super(),S(this,"pages",void 0),S(this,"core",void 0),S(this,"onUpdatePage",Re(this)),S(this,"onCreatePage",Re(this)),S(this,"onCopyPage",Re(this)),S(this,"onDeletePages",Re(this)),S(this,"onBeforeDeletePages",Re(this)),S(this,"onAfterDeletePages",Re(this)),S(this,"onBeforeCopyPages",Re(this)),S(this,"onCopyPages",Re(this)),this.core=l,this.pages=new Map}handlePagePreloadChange(l){let{viewerUid:u,viewerMode:f,docUid:g,changes:m}=l;m.forEach(v=>{let{pageUid:y,from:x,to:w}=v;const C=this.getPage(y),_={viewerUid:u,docUid:g,pageUid:y},{autoReleaseBlob:T,autoReleaseImg:M}=yt;x&&!w?(C.raw.deleteUser(_),C.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(y),this.core.parserService.cancelGetPage(C.fileUid,C.fileIndex),T&&C.raw.resetBlob(),M&&C.raw.resetImg()),f!==Rn.DEFAULT&&f!==Rn.THUMBNAIL||(C.original.deleteUser(_),C.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(y),T&&C.original.resetBlob(),M&&C.original.resetImg()),C.display.deleteUser(_),C.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(y),T&&C.display.resetBlob(),M&&C.display.resetImg())),f===Rn.THUMBNAIL&&(C.thumbnail.deleteUser(_),C.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(y),T&&C.thumbnail.resetBlob(),M&&C.thumbnail.resetImg())),C.raw.hasUser()||this.core.parserService.cancelGetPage(C.fileUid,C.fileIndex)):(C.raw.addUser(_),f!==Rn.DEFAULT&&f!==Rn.THUMBNAIL||(C.original.addUser(_),C.display.addUser(_)),f===Rn.THUMBNAIL&&C.thumbnail.addUser(_))})}dispose(){this.pages.clear(),super.dispose()}reset(){this.pages.clear()}getPage(l){return this.pages.get(l)}createPagesByParsedPages(l,u,f,g){l.forEach((m,v)=>{this.createPage(Fe(ne({},m),{fileUid:f,annotations:u[v]}),g)})}createPage(l,u){const f=new Px(l,u);this.pages.set(f.uid,f);const g=kE.create(l.pageUid,l.fileUid,l.fileIndex);return this.onCreatePage.emit(g),f}copyPage(l,u,f){const g=f.copy(l,u);return this.pages.set(g.uid,g),eT.create(l,g.fileUid,g.fileIndex,f.annotations.slice()),g}deletePages(l){const u=k0.create(l);this.onBeforeDeletePages.emit(u),l.forEach(f=>{const g=this.pages.get(f);g&&g.dispose(),this.pages.delete(f)}),this.onDeletePages.emit(u),this.onAfterDeletePages.emit(u)}updatePage(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const g=this.pages.get(l);if(g){const{doc:m,customData:v}=g;g.dispose();const y=new Px(Fe(ne({},f),{pageUid:l}),m);y.customData=v,this.pages.set(l,y);const x=BE.create(m.uid,l,u);this.onUpdatePage.emit(x)}}getPageCount(){return this.pages.size}}var nT=new WeakSet;class Tse{constructor(l){Js(this,nT),S(this,"core",void 0),S(this,"annotationMapper",void 0),this.core=l,this.annotationMapper=new BL}reset(){}saveToPng(l,u){var f=this;return Q(function*(){const g=f.core.pageService.getPage(l);if(!g)return Promise.resolve(null);const m=yield f.core.getPageData(l,{display:!0,renderAnnotation:!(null==u||!u.saveAnnotation)});if((null==u||!u.saveAnnotation)&&m.fileData&&"image/png"===m.fileData.type&&!ye(nT,f,fF).call(f,g))return m.fileData;const v=f.core.saverService.getSaver("image/png");try{return yield v.save(m.display.data,{outputType:3})}finally{v.destroy()}})()}saveToJpeg(l,u){var f=this;return Q(function*(){const g=f.core.pageService.getPage(l);if(!g)return Promise.resolve(null);const m=yield f.core.getPageData(l,{display:!0,renderAnnotation:!(null==u||!u.saveAnnotation)});if((null==u||!u.saveAnnotation)&&m.fileData&&"image/jpeg"===m.fileData.type&&!ye(nT,f,fF).call(f,g))return m.fileData;const v=f.core.saverService.getSaver("image/jpeg");try{return yield v.save(m.display.data,{outputType:1,jpegQuality:null==u?void 0:u.quality})}finally{v.destroy()}})()}saveToTiff(l,u){var f=this;return Q(function*(){const g=f.core.saverService.getSaver("image/tiff"),m=!(null==u||!u.saveAnnotation);try{yield g.init(u);for(let v=0;v<l.length;v++){const y=l[v];if(!f.core.pageService.getPage(y))break;const x=yield f.core.getPageData(y,{display:!0,renderAnnotation:m});yield g.appendPage(x.display.data)}return yield g.getTiff()}finally{g.destroy()}})()}saveToPdf(l,u){var f=this;return Q(function*(){null!=u&&u.creationDate&&(u.creationDate=Lr(u.creationDate)),null!=u&&u.modifiedDate&&(u.modifiedDate=Lr(u.modifiedDate)),!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation||Wt.makeSureAnnotationLicenseExist();const g=f.core.saverService.getSaver("application/pdf");try{yield g.init(u);const C=new Map,_=u&&u.pageType&&u.pageType!==En.PAGE_DEFAULT;let T=0;for(let L=0;L<l.length;L++){var m,v;const N=l[L],V=f.core.pageService.getPage(N);if(!V)break;const H=yield f.core.getPageData(N,{raw:!0,display:!0,renderAnnotation:"image"===(null==u?void 0:u.saveAnnotation)}),G=yield f.core.imageDataService.getNotRotatedDisplay(N,"image"===(null==u?void 0:u.saveAnnotation)),z=_||(null===(m=V.pdfOptions)||void 0===m?void 0:m.convertMode)===ir.CM_IMAGEONLY||(null===(v=V.pdfOptions)||void 0===v?void 0:v.renderOptions.renderGrayscale),q=[],te=[];if(H.fileData&&"application/pdf"===H.fileData.type&&!z)for(let se=L;se<l.length;se++){var y,x;const ae=l[se],j=f.core.pageService.getPage(ae);if(!j||j.fileUid!==V.fileUid||!j.isFull||"image"===(null==u?void 0:u.saveAnnotation)&&j.annotations.length>0||(null===(y=j.pdfOptions)||void 0===y?void 0:y.convertMode)===ir.CM_IMAGEONLY||null!==(x=j.pdfOptions)&&void 0!==x&&x.renderOptions.renderGrayscale)break;let le=!1;j.filter&&"none"!==j.filter&&(le=!0);const ue=j.getActions(),xe=j.getPerspectiveActions();ue.every(A=>"rotate"===A.type||"crop"===A.type)&&xe.every(A=>"rotate"===A.type||"crop"===A.type)||(le=!0);let I=!1;if(le&&f.core.getAnnotationsByPageUid(l[L]).forEach(A=>{A.oriIndex>=0&&!A.modified&&(I=!0)}),le&&!I)break;C.set(T+q.length,{mediaBox:j.mediaBox,cropBox:j.cropBox,rotation:j.rotation}),q.push(j.fileIndex),I&&te.push({pageUid:ae,pageIndex:se})}if(q.length>0){var w;const se=null===(w=(yield f.core.sourceStore.get(V.fileUid)).loadOptions)||void 0===w?void 0:w.password;yield g.appendRawPdfPages(H.fileData,se,q),L+=q.length-1,T+=q.length;for(let ae=0;ae<te.length;ae++){const j=yield f.core.imageDataService.getNotRotatedDisplay(te[ae].pageUid,"image"===(null==u?void 0:u.saveAnnotation));yield g.changePageImage(te[ae].pageIndex,j.data,{cropBox:V.cropBox,mediaBox:V.mediaBox,rotation:V.rotation,width:G.width,height:G.height})}}else yield g.appendImagePage(G.data,{cropBox:V.cropBox,mediaBox:V.mediaBox,rotation:V.rotation,width:G.width,height:G.height}),T+=1}C.size>0&&(yield g.setPageInfo(C));const M=[];for(let L=0;L<l.length;L++)if(!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation)yield g.removePageAnnotations(L);else{const N=f.core.pageService.getPage(l[L]);if(!N)continue;const V=N.pdfOptions&&N.pdfOptions.convertMode===ir.CM_RENDERALL&&N.pdfOptions.renderOptions.renderAnnotations===pl.RENDER_ANNOTATIONS,H=f.core.getAnnotationsByPageUid(l[L]);if(!H.length){V||(yield g.removePageAnnotations(L));continue}H.forEach(z=>{!["textBox","textTypewriter"].includes(z.type)||!z.modified&&Ve(null==z?void 0:z.oriIndex)||z.style.textContents.forEach(q=>{M.push({family:q.fontFamily,isBlob:"bold"===q.fontWeight,isItalic:"italic"===q.fontStyle})})});const G=yield f.annotationMapper.getOriginalAnnotations(H,{width:N.mediaBox.left+N.mediaBox.width,height:2*N.mediaBox.top+N.mediaBox.height});yield g.setPageAnnotations(L,G,V),"flatten"===u.saveAnnotation&&(yield g.flattenPage(L))}return M.length&&((yield g.ifFontsExist(M))||fe.warning(fe.WASM_FONT_LOSS)),yield g.getPdf(M3.RT_BINARY)}finally{g.destroy()}})()}}function fF(p){return!!(!p.isFull||p.filter&&"none"!==p.filter||p.getActions().some(l=>"rotate"!==l.type))||!!p.getPerspectiveActions().some(l=>"rotate"!==l.type)||0!==p.rotation}const L0=p=>{const l=new Set(p);return Array.from(l.values())};class Dse extends mi{constructor(){super(),S(this,"observer",void 0),S(this,"onResizeObserver",Re(this)),this.observer=new ResizeObserver(l=>{l.forEach(u=>{this.onResizeObserver.emit(u)})})}observe(l){this.observer.observe(l)}unobserve(l){this.observer.unobserve(l)}reset(){this.observer.disconnect()}dispose(){this.observer.disconnect(),this.observer=null,super.dispose()}}class Ase{constructor(){S(this,"canvas",void 0),S(this,"renderer",void 0),S(this,"root",void 0),document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),this.renderer=new pL,this.canvas=new oL({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new DL).init(this.canvas)}render(l,u,f){this.root.children.slice().forEach(g=>{this.root.removeChild(g)}),this.root.appendChild(l),this.canvas.resize(u||l.width,f||l.height),this.canvas.render()}reset(){this.root.children.slice().forEach(l=>{this.root.removeChild(l)}),this.root.sortable.sorted=[]}getCanvas(){return this.canvas.contextService.getDomElement()}}let sT;const pF="p".charCodeAt(0),gF="H".charCodeAt(0),mF="Y".charCodeAt(0),vF="s".charCodeAt(0);class kse{constructor(l){S(this,"core",void 0),this.core=l}getRaw(l){var u=arguments,f=this;return Q(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];try{const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.raw.isAvailable)return m.raw.getImageDetail();const{fileUid:v,fileIndex:y}=m,x=yield f.core.sourceStore.get(v);let w;w=f.core.parserService.getCustomParserClasses(x.fileData.type)?x.fileData.type:yield I3(x.fileData),w||fe.throw(fe.FILE_NOT_SUPPORT);const C=yield f.core.parserService.getPage(x.fileData,w,v,y);if(!C)return null;let{raw:_}=m;return g||(_=new xl(m)),_.updateImageDetail(C.resource),_.getImageDetail()}catch(m){return fe.error(m),null}})()}getOriginal(l){var u=arguments,f=this;return Q(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;const{original:v}=m;if(v.isAvailable)return v.getImageDetail();const y=yield f.getRaw(l);if(!y)return null;const x=yield f.handlePerspectiveQuad(l,y);return g&&x&&m.original.updateImageDetail(x),x})()}handlePerspectiveQuad(l,u){var f=this;return Q(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;let m=u;const v=g.getProcessedQuad();if(v&&(m=yield f.core.perspectiveService.perspective({data:u.data,type:Ri.JPEG},v,{angle:g.initRotation}),!m))return null;const y=new xl(g);return y.updateImageDetail(m),y.getImageDetail()})()}getDisplay(l){var u=arguments,f=this;return Q(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.display.isAvailable)return m.display.getImageDetail();const v=yield f.getOriginal(l);if(!v)return null;const{filter:y}=m,x=yield f.handleFilter(l,v);return m.filter!==y?f.getDisplay(l):(g&&x&&m.display.updateImageDetail(x),x)})()}handleFilter(l,u){var f=this;return Q(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;const m=u,{filter:v}=g;if(v&&"none"!==v){const x=yield f.core.filterService.applyFilter({data:u.data,type:Ri.JPEG,width:u.width,height:u.height},v);if(!x)return null;m.data=x}const y=new xl(g);return y.updateImageDetail(m),y.getImageDetail()})()}getEditedDisplay(l,u){var f=arguments,g=this;return Q(function*(){let m=f.length>2&&void 0!==f[2]&&f[2];const v=g.core.pageService.getPage(l);if(!v||v.isDestroyed)return null;const y=yield g.getDisplay(l,!1);if(v.getActions().length||0!==v.rotation||!v.isMediaBoxEqualCropBox()||u&&v.annotations.length){const x=yield g.applyEditToDisplay(l,u,m),w=new xl(v);return w.updateImageDetail(x),w.getImageDetail()}return y})()}getNotRotatedDisplay(l,u){var f=this;return Q(function*(){const g=f.core.pageService.getPage(l);if(!g||g.isDestroyed)return null;const m=yield f.getOriginal(l);if(!m)return null;const v=yield f.handleFilter(l,m);if(u&&g.annotations.length){const y=yield f.applyEditToDisplay(l,u,!1,!1),x=new xl(g);return x.updateImageDetail(y),x.getImageDetail()}return v})()}getThumbnail(l){var u=arguments,f=this;return Q(function*(){let g=!(u.length>1&&void 0!==u[1])||u[1];const m=f.core.pageService.getPage(l);if(!m||m.isDestroyed)return null;if(m.thumbnail.isAvailable)return m.thumbnail.getImageDetail();const v=yield f.getDisplay(l,!0);if(!v)return null;const y=yield f.displayToThumbnail(v.data);return y?(g&&m.thumbnail.updateImageDetail(y),y):null})()}displayToThumbnail(l){return Q(function*(){return l})()}applyEditToDisplay(l,u){var f=arguments,g=this;return Q(function*(){let m=f.length>2&&void 0!==f[2]&&f[2],v=!(f.length>3&&void 0!==f[3])||f[3];const y=yield g.core.imageLoadService.loadDisplayImage(l),x=g.core.pageService.getPage(l),w=yield g.getDisplay(l,!1);let C;if(v)C=x.getEditResultForPixel();else{const[N,V]=bt([x.initState.mediaBox.width,x.initState.mediaBox.height],yt.displayResolution,x.resource.resolutionX);C={rWidth:N,rHeight:V,cropLeft:0,cropTop:0,cropWidth:N,cropHeight:V,rotation:0}}const _={width:Math.round(C.rWidth),height:Math.round(C.rHeight),data:null},T=new Nd({style:{x:-C.cropLeft,y:-C.cropTop,img:y,width:w.width,height:w.height}}),M=new Gn({style:{x:-(C.cropWidth-C.rWidth)/2,y:-(C.cropHeight-C.rHeight)/2,width:C.cropWidth,height:C.cropHeight}});if(M.appendChild(T),M.setLocalAngle(C.rotation),g.core.annotationService&&x.annotations.length&&u){const N=new Gn({style:{x:-C.cropLeft,y:-C.cropTop,width:x.original.pageWidth,height:x.original.pageHeight}});yield g.applyAnnotationToPage(N,l,m),M.appendChild(N)}g.core.commonCanvas.render(M,C.rWidth,C.rHeight),g.core.commonCanvas.reset();const L=g.core.commonCanvas.getCanvas();return new Promise((N,V)=>{L.toBlob(function(){var H=Q(function*(G){G=yield function Mse(p,l){const u=p.slice(0,33);return new Promise((f,g)=>{const m=new FileReader;m.onload=()=>{const v=new Uint8Array(m.result),y=p.slice(33),x=function(C,_,T,M){if("image/jpeg"===T)return C[13]=1,C[14]=_>>8,C[15]=255&_,C[16]=_>>8,C[17]=255&_,C;if("image/png"===T){const L=new Uint8Array(13);_*=39.3701,L[0]=pF,L[1]=gF,L[2]=mF,L[3]=vF,L[4]=_>>>24,L[5]=_>>>16,L[6]=_>>>8,L[7]=255&_,[L[8],L[9],L[10],L[11]]=[L[4],L[5],L[6],L[7]],L[12]=1;const N=function Ise(p){let l=-1;sT||(sT=function(){const u=new Int32Array(256);for(let f=0;f<256;f++){let g=f;for(let m=0;m<8;m++)g=1&g?3988292384^g>>>1:g>>>1;u[f]=g}return u}());for(let u=0;u<p.length;u++)l=sT[255&(l^p[u])]^l>>>8;return~l}(L),V=new Uint8Array(4);if(V[0]=N>>>24,V[1]=N>>>16,V[2]=N>>>8,void(V[3]=255&N)){const z=function(q){for(let te=q.length-1;te>=4;te--)if(9===q[te-4]&&q[te-3]===pF&&q[te-2]===gF&&q[te-1]===mF&&q[te]===vF)return te-3;return-1}(C);return C.set(L,z),C.set(V,z+13),C}const H=new Uint8Array(4);H[0]=0,H[1]=0,H[2]=0,H[3]=9;const G=new Uint8Array(54);return G.set(C,0),G.set(H,33),G.set(L,37),G.set(V,50),G}throw new Error(`The format ${T} is not supported.`)}(v,l,p.type),w=new Blob([x,y],{type:p.type});f(w)},m.onerror=v=>{g(v)},m.readAsArrayBuffer(u)})}(G,x.resolutionX||yt.displayResolution),_.data=G,N(_)});return function(G){return H.apply(this,arguments)}}(),"image/jpeg",1)})})()}applyAnnotationToPage(l,u){var f=arguments,g=this;return Q(function*(){let m=f.length>2&&void 0!==f[2]&&f[2];const v=g.core.pageService.getPage(u),y=[];v.annotations.forEach(x=>{const w=g.core.annotationService.getAnnotationByUid(x);y.push(w)}),y.sort((x,w)=>x.layer-w.layer);for(let x=0;x<y.length;x++){if(m&&!y[x].flags.includes("print"))continue;if("stamp"===y[x].type&&y[x].style.imageData&&(!Ve(y[x].style.width)||!Ve(y[x].style.height))){const C=new Od,_=yield C.readImageInfo({fileSource:y[x].style.imageData});let T=_.imageWidth,M=_.imageHeight;if(T>400||M>400){const L=Math.max(T/400,M/400);T/=L,M/=L}y[x].style.width=T,y[x].style.height=M}const w=g.core.annotationService.createAnnotationShape(y[x],v);w instanceof yo&&w.style.imageData&&w.style.img instanceof HTMLImageElement&&(yield new Promise(C=>{w.style.img.onload=()=>{C()}})),w&&l.appendChild(w)}})()}}class Ose{constructor(l){S(this,"name",void 0),this.name=l||"Guest"}getUser(){return this.name}setUser(l){this.name=l}}class Rx extends Ct{static create(l){return new Rx(l)}constructor(l){super("setExternalHandler"),S(this,"handlerType",void 0),this.handlerType=l}}class rT{static makeSureSourcesTypeSupported(l,u,f,g){const m=[];if(Xt(l))l.forEach((v,y)=>{if(!v||0===v.length){const x=tt("Source[]",u,`[${y}].fileData`,!0);m.push(`${x}: ${fe.FILE_NOT_SUPPORT.message}`)}});else if(!l||0===l.length){const v=tt("Source",u,"fileData");m.push(`${v}: ${fe.FILE_NOT_SUPPORT.message}`)}m.length>0&&fe.throw(Fe(ne({},fe.FILE_NOT_SUPPORT),{details:m}),f,g)}}const oT=new Map,aT=[];let Zd=class CD extends mi{constructor(l,u,f,g,m){super(),S(this,"parserService",void 0),S(this,"saverService",void 0),S(this,"perspectiveService",void 0),S(this,"filterService",void 0),S(this,"detectorService",void 0),S(this,"viewerService",void 0),S(this,"editService",void 0),S(this,"annotationService",void 0),S(this,"documentService",void 0),S(this,"trackerService",void 0),S(this,"imageLoadService",void 0),S(this,"optimizationService",void 0),S(this,"processService",void 0),S(this,"commandService",void 0),S(this,"fileSaveService",void 0),S(this,"fileService",void 0),S(this,"pageService",void 0),S(this,"resizeService",void 0),S(this,"imageDataService",void 0),S(this,"userService",void 0),S(this,"sourceStore",void 0),S(this,"commonCanvas",void 0),S(this,"onBeforeLoadSource",void 0),S(this,"onSetExternalHandler",void 0),S(this,"onAfterPerspective",void 0),S(this,"onFilterChanged",void 0),S(this,"onUnload",void 0),this.parserService=l,this.saverService=u,this.perspectiveService=f,this.filterService=g,this.detectorService=m,this.onBeforeLoadSource=Re(this),this.onSetExternalHandler=Re(this),this.onUnload=Re(this),this.onAfterPerspective=Re(this),this.onFilterChanged=Re(this),this.commonCanvas=new Ase,this.sourceStore=new eF,this.trackerService=new uF,this.documentService=new Cse,this.fileService=new Sse,this.pageService=new Ese(this),this.imageLoadService=new use(this),this.optimizationService=new class{constructor(){S(this,"actorSystem",void 0),S(this,"concurrency",3);const p=window.URL.createObjectURL(new Blob(["(",gse.toString(),")()"],{type:"text/plain"}));this.actorSystem=new pse(p,this.concurrency)}cancel(p){this.actorSystem.cancel(p)}optimize(p,l,u,f,g,m){return new Promise((v,y)=>{const x=p.getContext("2d"),w=Math.floor(l)||1,C=Math.floor(u)||1,_=x.getImageData(0,0,w,C),T={action:"optimize",data:{taskUid:m,sourceWidth:w,sourceHeight:C,width:Math.ceil(f)||1,height:Math.ceil(g)||1,source:_},callback(M){v(M)}};this.actorSystem.send(T,T.data.source)})}},this.processService=new vse,this.commandService=new _se,this.fileSaveService=new Tse(this),this.resizeService=new Dse,this.imageDataService=new kse(this),this.userService=new Ose("Guest"),aT.forEach(v=>{var y;null===(y=v.apply)||void 0===y||y.call(v,this)}),this.initServiceEvent()}initServiceEvent(){const{documentService:l,commandService:u,pageService:f,viewerService:g,fileService:m,parserService:v}=this;l.onDocumentCreated.on(y=>{u.createInvoker(y.docUid)},u),l.onDocumentDeleted.on(y=>{u.deleteInvokers([y.docUid])},u),g.onPagePreloadChanged.on(y=>{f.handlePagePreloadChange(y)},f),m.onDeleteFileData.on(y=>{this.sourceStore.remove(y)}),m.onDeleteFileData.on(y=>{v.freeParserByFileUid(y)},v)}static getClass(l){return oT.get(l)}static setClass(l,u){oT.set(l,u)}static registerPlugin(l){aT.includes(l)||aT.push(l),l.install&&l.install(CD)}getClass(l){return oT.get(l)}createAsyncRepository(){return new eF}createViewer(l){const u=CD.getClass("Viewer"),f=Fe(ne({},l),{core:this,groupUid:l.groupUid||qt()}),g=this.viewerService.createViewer(u,f);return g.context.isInitialized=!0,g}removeViewer(l){this.viewerService.removeViewer(l.uid)}getViewer(l){return this.viewerService.getViewer(l)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(l){return this.parserService.getDefaultParserOptions(l)}setFileParserDefaultOptions(l,u){return this.parserService.setDefaultParserOptions(l,u)}setFileParser(l,u){this.parserService.registerCustomParser(l,u)}getSourceParseOptions(l,u){if("application/pdf"===u){var f;const g=l;return g.convertMode=null!==(f=g.convertMode)&&void 0!==f?f:ir.CM_AUTO,qe(g)}if("width"in l)return qe(l)}loadSource(l,u,f){var g=this;return Q(function*(){Xt(l)||(l=[l]);const m=g.documentService.getDocument(u);if(!m)return[];const v=Ve(f)?{insertBeforeIndex:f}:ne({},f),y="ignore"===v.exception,x=yield g.getSourcesMimeTypes(l);y||rT.makeSureSourcesTypeSupported(x,"sources");const w=function(){var _=Q(function*(T,M){const L=x[M];y&&rT.makeSureSourcesTypeSupported(L,`sources[${M}]`);const N=[],V=qt(),H=g.getSourceParseOptions(T,L),{fileData:G}=T,{pageCount:z,batchSize:q}=yield g.parserService.getParseInfo(G,L,V,H);g.sourceStore.set(V,{fileData:L===G.type?G:G.slice(0,G.size,L),loadOptions:H}),g.fileService.addFile(V,L,z);const te=g.getBatchIndices(q,z);for(const ae of te){var se;const j=yield g.parserService.parse(G,L,V,ae,H).catch(xe=>{throw xe});null===(se=T.extraPageData)||void 0===se||se.forEach(xe=>{const I=j.find(A=>A.fileIndex===xe.index);if(I){const A=ne({},xe);delete A.index,Ve(I.rotation)&&Ve(A.rotation)&&(A.rotation+=I.rotation),Se(A.filter)||(I.filter=A.filter),Se(A.rotation)||(I.rotation=A.rotation),Se(A.perspectiveQuad)||(I.perspectiveQuad=A.perspectiveQuad),Se(A.index)||(I.index=A.index)}});const le=j.map(xe=>{var I;const A=qt();return xe.pageUid=A,null!==(I=xe.filter)&&void 0!==I||(xe.filter=g.filterService.getDefaultFilterType()||"none"),A});g.fileService.addUsersByParsedPages(V,j);const ue=g.annotationService.createAnnotationsByParsedPages(u,j);g.pageService.createPagesByParsedPages(j,ue,V,m),g.documentService.addPagesToDocument(u,le,v.insertBeforeIndex),Se(v.insertBeforeIndex)||(v.insertBeforeIndex+=j.length),N.push(...le)}return N});return function(M,L){return _.apply(this,arguments)}}();g.onBeforeLoadSource.emit({docUid:u});const C=[];for(const[_,T]of l.entries())try{const M=yield w(T,_);C.push(...M)}catch(M){if(!y)throw M;fe.warning(M)}return g.documentService.onPagesAdded.emit(xp.create(u,C.map(_=>m.pages.indexOf(_)),C)),C})()}getSourcesMimeTypes(l){var u=this;return Q(function*(){const f=[];for(const g of l){const m=u.parserService.getCustomParserClasses(g.fileData.type)?g.fileData.type:yield I3(g.fileData);f.push(m)}return f})()}getAnnotationsByPageUid(l){const u=this.pageService.getPage(l);return u?u.annotations.map(f=>this.annotationService.getAnnotationByUid(f)):[]}getBatchIndices(l,u){const f=[];for(let g=0;g<u;){const m=l>0?Math.min(l,u-g):u;f.push(Array.from({length:m},(v,y)=>g+y)),g+=m}return f}getPageData(l,u){var f=this;return Q(function*(){var g;null!==(g=u)&&void 0!==g||(u={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1});const m=f.pageService.getPage(l);if(!m)return null;const v=yield f.sourceStore.get(m.fileUid);let{quad:y}=m;y&&(y=m.quadToPixelPPI(y),Rh(y));const x={uid:m.uid,fileData:"application/ddv-blank-image"!==v.fileData.type?v.fileData:null,fileIndex:m.fileIndex,perspectiveQuad:y,rotation:m.rotation,filter:m.filter,mediaBox:ne({},m.mediaBox),cropBox:ne({},m.cropBox)};if(u.raw){const w=yield f.imageDataService.getRaw(l);x.raw=ne({},w)}if(u.display){const w=yield f.imageDataService.getEditedDisplay(l,u.renderAnnotation,u.isGetPrintPageData);x.display=ne({},w)}if(u.thumbnail){const w=yield f.imageDataService.getEditedDisplay(l,u.renderAnnotation,u.isGetPrintPageData);x.thumbnail=ne({},w)}return x})()}setCustomData(l,u){var f=this;return Q(function*(){const g=f.pageService.getPage(l);return g?(g.customData=qe(u),!0):Promise.reject()})()}getCustomData(l){var u=this;return Q(function*(){const f=u.pageService.getPage(l);return f?qe(f.customData):Promise.reject()})()}updatePage(l,u){var f=arguments,g=this;return Q(function*(){var m,v;let y=f.length>2&&void 0!==f[2]?f[2]:{};const x=g.pageService.getPage(l);if(!x)return!1;const w=qt(),C=g.parserService.getCustomParserClasses(u.type)?u.type:yield I3(u);rT.makeSureSourcesTypeSupported([C],"data");const _=g.getSourceParseOptions({fileData:u},C),{pageCount:T}=yield g.parserService.getParseInfo(u,C,w,_);if(Ve(y.fileIndex)&&(y.fileIndex>=T||y.fileIndex<0))return fe.reject(fe.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");g.sourceStore.set(w,{fileData:u,loadOptions:_}),g.fileService.addFile(w,C,T);const[M]=yield g.parserService.parse(u,C,w,[y.fileIndex||0],_).catch(N=>{throw N});M.pageUid=l,null!==(m=M.filter)&&void 0!==m||(M.filter=g.filterService.getDefaultFilterType()||"none");const L=g.annotationService.createAnnotationsByParsedPages(x.doc.uid,[M]);return g.commandService.removePageFromCommand(x.doc.uid,[l]),g.fileService.addUser(w,y.fileIndex,l),g.fileService.deleteUser(x.fileUid,x.fileIndex,l),null===(v=g.annotationService)||void 0===v||v.deleteAnnotations(x.annotations,!1),g.pageService.updatePage(l,u,Fe(ne(ne({},M),y),{fileUid:w,annotations:L[0]})),!0})()}getPerspectivePreviewData(l,u,f){var g=this;return Q(function*(){const m=g.pageService.getPage(l),v=yield g.imageDataService.getRaw(l);if(!m||!v)return null;let{quad:y}=m;y||(y=[[0,0],[v.width,0],[v.width,v.height],[0,v.height]]);const x=yield g.processService.perspectivePreview(v.data,4,y,{width:v.width,height:v.height},ne(ne({},u),f));return Promise.resolve(x)})()}createDocument(l){return this.documentService.createDocument(l)}getDocument(l){return this.documentService.getDocument(l)}deleteDocuments(l){const{documentService:u,pageService:f}=this;if(l.map(v=>u.getDocument(v)).includes(void 0))return!1;const g=JE.create(l);u.onBeforeDeleteDocs.emit(g),l.forEach(v=>{const y=u.getDocument(v);var x;y&&(y.pages.forEach(w=>{const C=f.getPage(w);this.fileService.deleteUser(C.fileUid,C.fileIndex,w)}),null===(x=this.annotationService)||void 0===x||x.deleteAnnotationPages([...y.pages]),f.deletePages(y.pages))});const m=u.deleteDocuments(l);return u.onAfterDeleteDocs.emit(g),m}renameDocument(l,u){this.documentService.renameDocument(l,u)}transferDocument(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:g}=this,m=g.getDocument(l),v=g.getDocument(u);if(!m||!v)return!1;if(l===u&&!f.copy)return!f.sourceIndices||this.movePages(l,f.sourceIndices,f.insertBeforeIndex);let y=[];if(y=null!=f&&f.sourceIndices?L0(f.sourceIndices).map(w=>m.pages[w]):[...m.pages],!y.length)return!0;f.copy?y.forEach((w,C,_)=>{const T=this.pageService.getPage(w),M=qt();if(this.fileService.addUser(T.fileUid,T.fileIndex,M),this.pageService.copyPage(M,v,T),!1!==(null==f?void 0:f.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(M);const L=T.annotations.map(N=>Fe(ne({},this.annotationService.getAnnotationByUid(N).getConfig()),{docUid:v.uid,pageUid:M,uid:qt()}));L.length&&this.annotationService.annotationApp.createAnnotations(L)}_[C]=M}):(g.removePagesFromDocument(m.uid,y),y.forEach(w=>{const C=this.pageService.getPage(w);var _;C.doc=v,!1===(null==f?void 0:f.includeAnnotations)&&(null===(_=this.annotationService)||void 0===_||_.deleteAnnotations(C.annotations),C.annotations=[])})),g.addPagesToDocument(v.uid,y,f.insertBeforeIndex);const x=y.map(w=>v.pages.indexOf(w));return g.onPagesAdded.emit(xp.create(v.uid,x,y)),!0}mergeDocuments(l,u){const{documentService:f}=this,g=f.createDocument(u);if(!l.length)return g;l=L0(l);const m=[];if(l.forEach(v=>{const y=f.getDocument(v);m.push(...y.pages)}),null!=u&&u.deleteOriginal?(f.deleteDocuments(l),m.forEach(v=>{const y=this.pageService.getPage(v);var x;y.doc=g,!1===(null==u?void 0:u.includeAnnotations)&&(null===(x=this.annotationService)||void 0===x||x.deleteAnnotations(y.annotations),y.annotations=[])})):m.forEach((v,y,x)=>{const w=this.pageService.getPage(v),C=qt();if(this.fileService.addUser(w.fileUid,w.fileIndex,C),this.pageService.copyPage(C,g,w),!1!==(null==u?void 0:u.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(C);const _=w.annotations.map(T=>Fe(ne({},this.annotationService.getAnnotationByUid(T).getConfig()),{docUid:g.uid,pageUid:C,uid:qt()}));_.length&&this.annotationService.annotationApp.createAnnotations(_)}x[y]=C}),m.length){f.addPagesToDocument(g.uid,m);const v=m.map(y=>g.pages.indexOf(y));f.onPagesAdded.emit(xp.create(g.uid,v,m))}return g}openDocument(l,u){return this.openOrCloseDocument(l,u)}closeDocument(l,u){return this.openOrCloseDocument(l,u,!0)}openOrCloseDocument(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=this.documentService.getDocument(l);if(!g||!this.viewerService.hasViewer(u))return!1;const m=this.viewerService.getViewer(u);return f?this.documentService.onCloseDocument.emit(zE.create(g,u,m.groupUid)):this.documentService.onOpenDocument.emit(GE.create(g,u,m.groupUid)),this.commandService.emitOperationsChanged(l),!0}deletePages(l,u){var f;return u=L0(u),this.commandService.removePageFromCommand(l,[...u]),u.forEach(g=>{const m=this.pageService.getPage(g);this.fileService.deleteUser(m.fileUid,m.fileIndex,g)}),null===(f=this.annotationService)||void 0===f||f.deleteAnnotationPages(u),this.documentService.removePagesFromDocument(l,[...u]),this.pageService.deletePages(u),!0}deleteAllPages(l){var u;const f=this.documentService.getDocument(l),g=[...f.pages];return this.commandService.removePageFromCommand(l,g),f.pages.forEach(m=>{const v=this.pageService.getPage(m);this.fileService.deleteUser(v.fileUid,v.fileIndex,m)}),null===(u=this.annotationService)||void 0===u||u.deleteAnnotationPages(f.pages),this.documentService.removeAllPagesFromDocument(l),this.pageService.deletePages(g),!0}movePages(l,u,f){return u=L0(u),this.documentService.movePages(l,u,f)}swapPages(l,u,f){return this.documentService.swapPages(l,u,f)}reorderPages(l,u){return u=L0(u),this.documentService.reorderPages(l,u)}printPages(l,u,f){var g=this;return Q(function*(){const m=g.documentService.getDocument(l);if(!m)return Promise.reject(fe.DOC_NOT_EXIST);const v=u||Array.from(Array(m.pages.length).keys()),y=[];for(let C=0;C<v.length;C++){var x;const _=yield g.getPageData(m.pages[v[C]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(x=null==f?void 0:f.printAnnotation)||void 0===x||x,isGetPrintPageData:!0});y.push(_)}if(0===y.length)return Promise.reject();const w=[];return y.forEach(C=>{w.push({data:C.display.data,width:C.display.width,height:C.display.height})}),function(C){let _,T,M="";C.forEach((H,G)=>{let z=1120,q=850;const te=q/H.width,se=z/H.height;te<se?z=Math.floor(H.height*te):te>se&&(q=Math.floor(H.width*se)),M+=`<div class="imageContainer"><img id="DDV_Image${G}" src='${_3(H.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,_+=q,T+=z});const N=window.open("about:blank","_blank",`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${_}, height=${T}`);if(N){N.document.write(`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                width: 100%;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${M}</body></html>`),N.document.close(),N.focus();const H=N.document.getElementById("DDV_body");H&&(H.onload=()=>{N&&N.print()})}}(w),!0})()}setDetectHandler(l,u){this.onSetExternalHandler.emit(Rx.create("detect")),this.detectorService.setDetector(u)}setImageFilterHandler(l){this.onSetExternalHandler.emit(Rx.create("filter")),this.filterService.setImageFilter(l)}clearExternalHandler(l){if(nt(l))switch(l){case"documentBoundariesDetect":this.setDetectHandler(l,null);break;case"imageFilter":this.setImageFilterHandler(null)}}unload(){var l;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(l=this.annotationService)||void 0===l||l.reset(),Wt.reset(),Ke.unload()}preloadModule(l){Ke.preloadModule(l)}perspectivePage(l,u,f){var g=this;return Q(function*(){let m;const v=g.pageService.getPage(u);if(v.setQuad(f)){if(g.annotationService.deleteAnnotations(v.annotations),g.commandService.removePageFromCommand(l,[u]),v.quad){const{width:w,height:C}=cF(v.quad);v.original.updateImageDetail({width:w,height:C}),v.display.updateImageDetail({width:w,height:C})}g.imageLoadService.cancelLoadOriginalImage(u),v.original.reset(),m=yield g.imageDataService.getOriginal(u),g.imageLoadService.cancelLoadDisplayImage(u),g.imageLoadService.cancelLoadThumbnailImage(u),v.display.reset(),v.thumbnail.reset();const{width:y,height:x}=v.original.getPageSize();v.isFull?(v.mediaBox=ne({},v.initState.mediaBox),v.cropBox=ne({},v.initState.cropBox)):(v.mediaBox={left:0,top:0,width:y,height:x},v.cropBox=ne({},v.mediaBox)),g.onAfterPerspective.emit(qE.create(l,u,f,y,x))}return m||g.imageDataService.getOriginal(u)})()}filterPages(l,u,f){var g=this;return Q(function*(){u.forEach(v=>{const y=g.pageService.getPage(v);y.filter!==f&&(y.filter=f,y.display.reset(),y.thumbnail.reset())});const m=Sx.create(l,u,f);return g.onFilterChanged.emit(m),!0})()}insertBlankPage(l,u,f,g,m,v){const y=this.documentService.getDocument(l);if(!y)return"";this.onBeforeLoadSource.emit({docUid:l});const x=qt(),w={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=u?u:816,height:null!=f?f:1056,resolutionX:null!=g?g:96,resolutionY:null!=m?m:96},C=this.getSourceParseOptions(w,"application/ddv-blank-image");this.sourceStore.set(x,{fileData:w.fileData,loadOptions:C}),this.fileService.addFile(x,"application/ddv-blank-image",1),this.parserService.parse(w.fileData,"application/ddv-blank-image",x,[0],C);const{displayResolution:_}=yt,T=qt();this.fileService.addUser(x,0,T);const M={resource:{data:w.fileData,width:w.width,height:w.height,resolutionX:w.resolutionX,resolutionY:w.resolutionY},mediaBox:{left:0,top:0,width:w.width/w.resolutionX*_,height:w.height/w.resolutionY*_},cropBox:{left:0,top:0,width:w.width/w.resolutionX*_,height:w.height/w.resolutionY*_},annotations:[],fileIndex:0,pageUid:T,fileUid:x};return this.pageService.createPage(M,y),this.annotationService.createAnnotationsByParsedPages(l,[M]),this.documentService.addPagesToDocument(l,[T],v),this.documentService.onPagesAdded.emit(xp.create(l,[y.pages.indexOf(T)],[T])),T}};function Mh(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:u,style:f,id:g,className:m,children:v}=p,y=document.createElement(u);return g&&(y.id=g+l),m&&(y.className=m),f&&function(x,w){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(nt(w))x.style.cssText=w;else if(C){let _="";Object.keys(w).forEach(T=>{_+=`${T}:${w[T]};`}),x.style.cssText=_}else Object.keys(w).forEach(_=>{x.style[_]=w[_]})}(y,f),v&&v.forEach(x=>{const w=Mh(x,l);y.appendChild(w)}),y}function yF(p){p&&(p.style.display="none")}function lT(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";p&&(p.style.display=l)}const Cp=p=>parseFloat(Number(p).toFixed(4));class wl extends mi{constructor(){super(),S(this,"uid",void 0),S(this,"type",void 0),S(this,"action",void 0),S(this,"isValid",void 0),this.isValid=!0,this.uid=qt()}execute(){return null}undo(){return null}}new class extends mi{constructor(){super(...arguments),S(this,"docCreated",Re(this)),S(this,"docDeleted",Re(this)),S(this,"pageAdded",Re(this)),S(this,"pageDeleted",Re(this)),S(this,"annotationCreated",Re(this)),S(this,"annotationDeleted",Re(this)),S(this,"annotationUpdated",Re(this)),S(this,"replyToAnnotation",Re(this)),S(this,"commentDeleted",Re(this)),S(this,"commentUpdated",Re(this))}};const Lse={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,visibility:"visible",viewerMode:Rn.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWidthKeyboard:!0,enableZoomOutWidthKeyboard:!0,enableUndoWidthKeyboard:!0,enableRedoWidthKeyboard:!0,enableDeleteWidthKeyboard:!0,enableSelectAllWidthKeyboard:!0,enableMoveAnnotationWidthKeyboard:!0,enableSaveWidthKeyboard:!0,enableLoadSourceWidthKeyboard:!0,enablePrintWidthKeyboard:!0,enableSelectPageWidthKeyboard:!0,enableCopyCutPasteWidthKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class Fse extends Wn{constructor(){super({name:"Checkbox"}),S(this,"shapeType","checkbox"),S(this,"checkboxStyle",void 0),S(this,"parsedCheckboxStyle",void 0),S(this,"isChecked",!1)}get checked(){return this.isChecked}set checked(l){this.isChecked=l}updateStyle(l){Object.assign(this.style,l)}}class Nse extends Wn{constructor(){super({name:"PageNumber"}),S(this,"shapeType","pageNumber"),S(this,"text",void 0),S(this,"parsedPageNumberStyle",void 0),this.text="0"}updateText(l){this.text=l}updateStyle(l){Object.assign(this.style,l)}}class Bse extends Gn{constructor(l){super(Fe(ne({},l),{name:"TabPage"})),S(this,"uid",void 0),S(this,"tab",void 0),S(this,"isSelected",!1),S(this,"isHovered",!1),S(this,"isDragging",!1),S(this,"isLoading",!1),S(this,"isPreload",!1),S(this,"isLoaded",!1),S(this,"rWidth",void 0),S(this,"rHeight",void 0),S(this,"rotation",0),S(this,"cropLeft",void 0),S(this,"cropTop",void 0),S(this,"cropWidth",void 0),S(this,"cropHeight",void 0),S(this,"mediaBoxRect",void 0),S(this,"cropBoxRect",void 0),S(this,"isOptimized",!1),S(this,"optimizedUid","1"),S(this,"optimizationUid","2"),S(this,"editUid",void 0),S(this,"editedUid",void 0),S(this,"zoom",1),S(this,"image",void 0),S(this,"borderBox",void 0),S(this,"checkbox",void 0),S(this,"pageNumber",void 0),S(this,"curBox",void 0),S(this,"mediaBox",void 0),S(this,"cropBox",void 0),S(this,"realTimeBox",void 0),this.tab=l.tab,this.uid=l.uid,this.rWidth=l.style.width,this.rHeight=l.style.height,this.initSubShapes(l)}initSubShapes(l){this.updateStyle({visibility:"hidden"});const u=new Nd({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),f=new Gn({name:"pageOptimizedBox",style:{x:0,y:0}}),g=new Gn({name:"pageCropBox"});g.clippable=!0;const m=new Gn({name:"pageMediaBox"}),v=new Gn({name:"pageBorderBox",style:ne(ne({},l.style),l.formattedPageStyle)}),y=new Gn({name:"currentStyleBox",style:{visibility:"hidden"}}),x=new Fse,w=new Nse;m.appendChild(u),g.appendChild(m),v.appendChild(f),v.appendChild(g),v.appendChild(y),v.appendChild(x),this.appendChild(w),this.appendChild(v),this.image=u,this.borderBox=v,this.realTimeBox=f,this.pageNumber=w,this.checkbox=x,this.curBox=y,this.cropBox=g,this.mediaBox=m}getRect(){const l=this.realTimeBox.getPosition();return{left:l.x,top:l.y,width:this.rWidth,height:this.rHeight}}setImgDom(l){this.image.style.img=l}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=qt()}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null}setPage(l,u,f,g){this.updateStyle({x:l,y:u,width:f,height:g})}setBorderBox(l,u,f,g,m){Se(m)?this.borderBox.updateStyle({x:l,y:u,width:f,height:g}):this.borderBox.updateStyle({x:l,y:u,width:f,height:g,borderWidth:m})}setCropBox(l,u,f,g,m){let v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:l,y:u,width:f,height:g}),this.cropBox.setLocalScale(m),this.cropBox.setLocalAngle(v),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9)}setRealTimeBox(l,u,f,g,m){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:l,y:u,width:f,height:g}),this.realTimeBox.setLocalScale(m,m,1)}setMediaBox(l,u,f,g){this.mediaBox.updateStyle({x:l,y:u,width:f,height:g})}setCurBox(l,u,f,g){this.curBox.updateStyle({x:l,y:u,width:f,height:g})}setImage(l,u,f,g){this.image.updateStyle({x:l,y:u,width:f,height:g})}}function cT(p){const{borderWidth:l,borderColor:u,borderStyle:f}=n0(p),g=parseInt(l||"0px",10);let m=[0,0];return"dashed"===f&&(m=[2*g,g]),{borderWidth:g,borderStyle:m,borderColor:u||"",lineDash:m}}const bp=p=>{const{border:l}=p;if(!l)return 0;const u=l.match(/[0-9]+/g)[0];return parseInt(u||"0",10)};function kh(p,l){if(Se(p)||""===p)return null;const u=Ld(p);return"%"===u.unit?l*u.value/100:u.value}function _p(p,l,u){p.style.width=`${l}px`,p.style.height=`${u}px`}function Jd(p){const l=devicePixelRatio;return Ve(p)&&p>0?(p=Math.floor(p*l)/l)||(p=1/l):p=0,p}function bc(p){const l=devicePixelRatio;return Ve(p)?(p=Math.round(p*l)/l)||(p=1/l):p=0,p}function nr(p){return bc(p)}const hT=()=>{const p=document.createElement("div");p.style.width="100px",p.style.height="100px",p.style.overflow="scroll",p.style.position="absolute",p.style.top="-9999px",document.body.appendChild(p);const l=p.offsetWidth-p.clientWidth;return document.body.removeChild(p),l};class Use{constructor(l,u){S(this,"tab",void 0),S(this,"viewerContext",void 0),S(this,"viewportWidth",600),S(this,"viewportHeight",800),S(this,"currentViewportWidth",0),S(this,"currentViewportHeight",0),S(this,"currentLayoutWidth",0),S(this,"currentLayoutHeight",0),S(this,"placeholderPages",[]),S(this,"scrollLeft",0),S(this,"scrollTop",0),S(this,"maxScrollLeft",0),S(this,"maxScrollTop",0),S(this,"startRow",0),S(this,"endRow",0),S(this,"startColumn",0),S(this,"endColumn",0),S(this,"preloadCount",1),S(this,"pagePreloadChanges",[]),S(this,"direction","vertical"),S(this,"displayMode",void 0),S(this,"fitMode",void 0),S(this,"rows",void 0),S(this,"columns",void 0),S(this,"zoom",void 0),S(this,"defaultReference",void 0),S(this,"zoomReference",void 0),S(this,"resizeReference",void 0),S(this,"oldZoom",void 0),S(this,"isZoomChanged",void 0),S(this,"isOutOfBounds",void 0),S(this,"isScrollbarResized",!0),S(this,"scrollbarWidthCache",void 0),S(this,"defaultWidth",void 0),S(this,"defaultHeight",void 0),this.tab=l,this.viewerContext=u;const{viewerConfig:f}=u;this.rows=f.rows,this.columns=f.columns,this.zoom=f.zoom,this.oldZoom=f.zoom,this.displayMode=f.displayMode,this.fitMode=f.fitMode,this.direction=f.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1}get isVertical(){return"vertical"===this.direction}get isContinuousDisplay(){return"continuous"===this.displayMode}get isSingleDisplay(){return"single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const l=hT();return this.scrollbarWidthCache=l,this.isScrollbarResized=!1,l}getRealRowAndColumnContinuous(){const{rows:l,columns:u,isVertical:f}=this,{total:g}=this.tab;let m=l,v=u;return f?(m=Math.ceil(g/u),g<=u&&(v=Math.max(1,g),m=1)):(v=Math.ceil(g/l),g<=l&&(m=Math.max(1,g),v=1)),{realRow:m,realColumn:v}}getRealRowAndColumnThumbnail(){const{total:l}=this.tab,{rows:u,columns:f,isVertical:g}=this,m=g?f:Math.ceil(l/u);return{realRow:g?Math.ceil(l/f):u,realColumn:m}}getZoomOriginCord(){const{zoomOrigin:l}=this.viewerContext.viewerConfig,u={start:0,center:.5,end:1};return{originX:this.currentViewportWidth*u[l.x],originY:this.currentViewportHeight*u[l.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:l}=this.viewerContext,{borderWidth:u}=l.getParsedPageStyle();return{borderWidth:u,selectedBorderWidth:l.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:l.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(l,u){return this.viewerContext.styleService.getParsedPageNumberStyle({width:l,height:u})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(l,u){return this.viewerContext.styleService.getParsedCheckboxStyle({width:l,height:u})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(l){if(nt(l)){if(/px/.test(l)){const[f]=l.match(/(\d+)/);return parseInt(f,10)}const u=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(l)){const f=u.width/t0(),[g]=l.match(/(\d+)/);return f*parseInt(g,10)/100}if(/em/.test(l)){const f=getComputedStyle(u).fontSize,[g]=f.match(/(\d+)/),[m]=l.match(/(\d+)/);return parseInt(g,10)*parseInt(m,10)}}return Ve(l)?l:parseInt(l,10)}setZoom(l){this.oldZoom=this.zoom,this.zoom=l,this.tab.pages.forEach(u=>{u.zoom=l})}getTabOffset(){const{maxScrollLeft:l,maxScrollTop:u,currentLayoutWidth:f,currentLayoutHeight:g,currentViewportWidth:m,currentViewportHeight:v,scrollLeft:y,scrollTop:x}=this;let w=0,C=0;const _=this.getParsedCanvasStyle().borderWidth||0;return w=l>0?-y:(m-(f-2*_))/2,C=u>0?-x:(v-(g-2*_))/2,{offsetX:w,offsetY:C}}parseReferenceDefault(){const{tab:l,maxScrollLeft:u,maxScrollTop:f}=this,m=this.placeholderPages[l.current];if(!m)return{scrollLeft:0,scrollTop:0};const v=this.getMargin();let y=m.x-v,x=m.y-v;return this.isContinuousDisplay&&(y=m.pageX-v,x=m.pageY-v),y=Pi(y,0,u),x=Pi(x,0,f),{scrollLeft:y,scrollTop:x}}parseReferenceZoom(l,u,f){if(Se(l)&&(l=this.zoomReference),Se(u)||Se(f)){const{originX:x,originY:w}=this.getZoomOriginCord();u=x,f=w}let{scrollLeft:g,scrollTop:m}=this.parseReference(l,u,f);const{maxScrollLeft:v,maxScrollTop:y}=this;return g=Pi(g,0,v),m=Pi(m,0,y),{scrollLeft:g,scrollTop:m}}parseReferenceResize(){const{resizeReference:l}=this;let{scrollLeft:u,scrollTop:f}=this.parseReference(l,0,0);const{maxScrollLeft:g,maxScrollTop:m}=this;return u=Math.min(u,g),f=Math.min(f,m),{scrollLeft:u,scrollTop:f}}updateReference(){const{currentViewportWidth:l,currentViewportHeight:u}=this,f=this.generateReference(0,0),g=this.generateReference(l/2,u/2),{originX:m,originY:v}=this.getZoomOriginCord(),y=this.generateReference(m,v);this.defaultReference=g,this.resizeReference=f,this.zoomReference=y}generateReference(l,u){let f,g,m,v,y=null,x=Number.MAX_VALUE;const{offsetX:w,offsetY:C}=this.getTabOffset(),{zoom:_}=this;return this.placeholderPages.forEach(T=>{if(T&&("single"===this.displayMode&&T.uid===this.tab.currentUid||"continuous"===this.displayMode)){const M=T.x+w,L=T.y+C,N=new l6(M+T.width/2,L+T.height/2).distanceTo({x:l,y:u});N<x&&(x=N,y=T.uid,l<M?(f="start",m=M-l):l>M+T.width?(f="end",m=l-(M+T.width)):(f="center",m=(l-M)/_),u<L?(g="start",v=L-u):u>L+T.height?(g="end",v=u-(L+T.height)):(g="center",v=(u-L)/_))}}),{pageX:m,pageY:v,positionX:f,positionY:g,pageUid:y}}parseReference(l,u,f){const{pageX:g,pageY:m,positionX:v,positionY:y,pageUid:x}=l,w=this.placeholderPages.find(N=>N.uid===x),{zoom:C}=this;let _,T,M=0,L=0;return w&&("start"===v?_=w.x-g:"center"===v?_=w.x+g*C:"end"===v&&(_=w.x+w.width+g),"start"===y?T=w.y-m:"center"===y?T=w.y+m*C:"end"===y&&(T=w.y+w.height+m)),M=_-u,L=T-f,{scrollLeft:M,scrollTop:L}}getScrollValuesByCurrentChanged(){const{placeholderPages:l,currentViewportWidth:u,currentViewportHeight:f,startRow:g,endRow:m,startColumn:v,endColumn:y,isVertical:x}=this,{current:w}=this.tab,C=this.getMargin(),{realRow:_,realColumn:T}=this.getRealRowAndColumnThumbnail();let M=w,L=w;x?(M=g*T+v,L=m*T+y):(M=v*_+g,L=y*_+y);let N=Pi(this.scrollLeft,0,this.maxScrollLeft),V=Pi(this.scrollTop,0,this.maxScrollTop);if(w>=M&&w<=L)return{scrollLeft:N,scrollTop:V};const H=l[w];return H&&(x?(N=0,w<M?V=H.y-C:w>L&&(V=H.y+H.height+C-f)):(V=0,w<M?N=H.x-C:w>L&&(N=H.x+H.width+C-u))),N=Pi(N,0,this.maxScrollLeft),V=Pi(V,0,this.maxScrollTop),{scrollLeft:N,scrollTop:V}}getCurrentByScroll(){let l=this.tab.current;const{placeholderPages:u,currentViewportWidth:f,currentViewportHeight:g,startRow:m,endRow:v,startColumn:y,endColumn:x,isVertical:w}=this,{realRow:C,realColumn:_}=this.getRealRowAndColumnContinuous(),T=f/2,M=g/2,{offsetX:L,offsetY:N}=this.getTabOffset(),{current:V}=this.tab;let H=Number.MAX_VALUE,G=Number.MAX_VALUE,z=w?Math.floor(V/_):V%C,q=w?V%_:Math.floor(V/C);for(let te=m;te<=v;te++){const se=u[te*_];if(!se)continue;const{y:ae,height:j}=se,le=ae+N,ue=le-M,xe=M-le-j;if(ue<=0&&xe<=0){z=te;break}ue>0&&ue<G?(G=ue,z=te):xe>0&&xe<G&&(G=xe,z=te)}for(let te=y;te<=x;te++){const se=u[y];if(!se)continue;const{x:ae,width:j}=se,le=ae+L,ue=le-T,xe=T-le-j;if(ue<=0&&xe<=0){q=te;break}ue>0&&ue<H?(H=ue,q=te):xe>0&&xe<H&&(H=xe,q=te)}return l=z*_+q,l===this.tab.current?null:l}setTabScrollValue(l,u){this.scrollLeft=l,this.scrollTop=u;const{offsetX:f,offsetY:g}=this.getTabOffset();this.tab.setPosition({x:f,y:g})}}class Vse extends Wn{constructor(l,u){super({name:"DocTab"}),S(this,"uid",void 0),S(this,"docType",void 0),S(this,"docName",void 0),S(this,"doc",void 0),S(this,"isActive",!1),S(this,"currentUid",void 0),S(this,"total",void 0),S(this,"selected",void 0),S(this,"context",void 0),S(this,"viewerContext",void 0),S(this,"shiftReference",void 0),S(this,"oldCurrentUid",void 0),S(this,"oldCurrent",void 0),this.doc=l,this.uid=l.uid,this.docName=l.name,this.docType=l.type,this.total=0,this.selected=[],this.viewerContext=u,this.context=new Use(this,u),this.oldCurrent=-1,this.oldCurrentUid=void 0,l.pages.forEach(f=>{const g=this.createPage(f);this.appendChild(g)}),this.total=l.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid)}get scrollToLatest(){let{scrollToLatest:l}=this.viewerContext.viewer.group.config;return Se(l)&&(l=this.viewerContext.viewerConfig.scrollToLatest),l}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return"document"===this.docType}createPage(l){const{pageStyle:u,pageNumberStyle:f,checkboxStyle:g,removeBtnStyle:m,blankFillColor:v}=this.viewerContext.viewerConfig,y=function(C){const{border:_,background:T}=C;let M={};return _&&(M=cT(_)),ne({background:T},M)}(u),{width:x,height:w}=this.viewerContext.getPageRenderSize(l);return new Bse({tab:this,uid:l,formattedPageStyle:y,pageNumberStyle:f,checkboxStyle:g,removeBtnStyle:m,blankFillColor:v,style:{pointerEvents:"auto",width:x,height:w}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current}updateViewportSize(l,u){this.context.viewportWidth=l,this.context.viewportHeight=u}rename(l){this.docName=l}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map(l=>l.uid)}appendPages(l,u,f){const g=l.length;if(!g)return;const m=Ve(f);if(l.forEach((y,x)=>{const w=this.createPage(y);this.appendChild(w,m?f+x:void 0)}),this.total=this.pages.length,u)this.currentUid=this.indexToUid(m?f+g-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var v;this.currentUid=null===(v=this.pages[0])||void 0===v?void 0:v.uid,this.updateDefaultReference()}}deletePages(l){this.updateOldInfo();const u=[...l],f=l.includes(this.currentUid);if(f){const g=l.indexOf(this.currentUid);u.splice(g,1),u.push(this.currentUid)}u.forEach(g=>{const m=this.getPageByUid(g);if(f&&m.uid===this.currentUid){if(1===this.total)this.currentUid=null;else{const{current:v}=this;this.currentUid=this.indexToUid(v+(v===this.total-1?-1:1))}this.updateDefaultReference()}p9(this.selected,g),this.removeChild(m),this.total-=1})}deleteAllPages(){this.updateOldInfo(),[...this.pages].forEach(l=>{this.removeChild(l)}),this.currentUid=null,this.selected=[],this.total=0}movePages(l,u){return this.updateOldInfo(),g9(this.pages,l,u)}switchPage(l,u){return this.updateOldInfo(),m9(this.pages,l,u)}reorderPages(l){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),v9(this.pages,l)}gotoPage(l){return 0===this.total?-1:(this.updateOldInfo(),l!==this.current&&(l=Pi(l,0,this.total-1),this.currentUid=this.indexToUid(l),this.updateDefaultReference()),this.updateShiftReference(),l)}selectPages(l){this.pages.forEach(u=>{u.isSelected=l.includes(u.uid)}),this.selected=l}selectPagesByIndices(l){const u=this.indicesToUids(l);this.selectPages(u)}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map(l=>this.uidToIndex(l))}getPageByIndex(l){return this.pages[l]}getPageByUid(l){return this.pages.find(u=>u.uid===l)}getPageIndex(l){return this.pages.findIndex(u=>u.uid===l.uid)}uidToIndex(l){return this.pages.findIndex(u=>u.uid===l)}uidsToIndices(l){return l.map(u=>this.uidToIndex(u))}indexToUid(l){var u;return null===(u=this.pages[l])||void 0===u?void 0:u.uid}indicesToUids(l){return l.map(u=>this.indexToUid(u))}updateShiftReference(){this.shiftReference=this.currentUid}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid}}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0}}class jse extends mi{constructor(l){super(),S(this,"tabActivationStack",void 0),S(this,"tabs",void 0),S(this,"activeTabUid",void 0),S(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=l}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose()}updateViewportSize(l,u){const f=this.getActiveTab();null!=f&&f.isDocType&&f.updateViewportSize(l,u)}createTab(l){if(this.tabs.has(l.uid))return this.tabs.get(l.uid);let u=null;return"document"===l.type&&(u=new Vse(l,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(u.uid,u),u}closeTab(l){if(!this.tabs.has(l))return!1;const{tabActivationStack:u}=this;if(u.includes(l)){const f=u.indexOf(l);u.splice(f,1)}return this.getTab(l).isActive=!1,this.tabs.delete(l),this.activeTabUid===l&&(this.activeTabUid=u[u.length-1]),!0}getTab(l){return this.tabs.get(l)}getDocTab(l){const u=this.getTab(l);return null!=u&&u.isDocType?u:null}hasTab(l){return this.tabs.has(l)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(l){if(!this.tabs.has(l))return!1;const{tabActivationStack:u}=this;if(this.context.viewerConfig.enableMultiTab){if(u.includes(l)){const f=u.indexOf(l);u.splice(f,1)}}else u.length=0;return u.push(l),this.activeTabUid=l,this.tabs.forEach(f=>{f.isActive=f.uid===l}),!0}clearTabs(){this.getAllTabs().forEach(l=>{l.destroy()}),this.tabs.clear()}resizeScrollbar(){this.tabs.forEach(l=>{l.context.isScrollbarResized=!0})}}class Hse{constructor(l){S(this,"parsedPageStyleCache",void 0),S(this,"parsedCurrentPageStyleCache",void 0),S(this,"parsedSelectedPageStyleCache",void 0),S(this,"parsedHoveredPageStyleCache",void 0),S(this,"parsedPlaceholderStyleCache",void 0),S(this,"parsedCheckboxStyleCache",void 0),S(this,"parsedPageNumberStyleCache",void 0),S(this,"parsedQuadSelectionStyleCache",void 0),S(this,"parsedCanvasStyleCache",void 0),S(this,"context",void 0),S(this,"isPageStyleChanged",void 0),S(this,"isCurrentPageStyleChanged",void 0),S(this,"isSelectedPageStyleChanged",void 0),S(this,"isHoveredPageStyleChanged",void 0),S(this,"isPlaceholderStyleChanged",void 0),S(this,"isCheckboxStyleChanged",void 0),S(this,"isPageNumberStyleChanged",void 0),S(this,"isQuadSelectionStyleChanged",void 0),S(this,"isCanvasStyleChanged",void 0),this.context=l}getParsedCanvasStyle(){return!this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=_c(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(l){return!this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=_c(this.context.viewerConfig.checkboxStyle,l),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(l){return!this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=_c(this.context.viewerConfig.pageNumberStyle,l),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return!this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=_c(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return!this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=_c(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return!this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=_c(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return!this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=_c(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return!this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=_c(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return!this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=_c(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:l}=this.context;return bp(l.pageStyle)===bp(l.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:l}=this.context;return bp(l.selectedPageStyle)===bp(l.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:l}=this.context;return bp(l.pageStyle)===bp(l.selectedPageStyle)}}function _c(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const u={};if(function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:m,ctrlBorder:v}=f;if(!Se(m)){const y=cT(m);Object.assign(g,y)}if(!Se(v)){const y=cT(v);Object.assign(g,{ctrlBorderWidth:y.borderWidth,ctrlBorderColor:y.borderColor,ctrlBorderStyle:y.borderStyle})}}(p,u),function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Wse.forEach(m=>{Se(f[m])||(g[m]=Dt(f[m]).value||0)})}(p,u),function(f){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Gse.forEach(m=>{Se(f[m])||(g[m]=f[m])})}(p,u),function(f,g){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!Se(f.width)&&(m.width=kh(f.width,g.width),Se(f.translateX)||(m.translateX=kh(f.translateX,m.width)),!Se(f.borderRadius))){const v=kh(f.borderRadius,m.width);m.borderRadiusX=Math.max(0,Math.min(v,m.width/2))}if(!Se(f.height)&&(m.height=kh(f.height,g.height),Se(f.translateY)||(m.translateY=kh(f.translateY,m.height)),!Se(f.borderRadius))){const v=kh(f.borderRadius,m.height);m.borderRadiusY=Math.max(0,Math.min(v,m.height/2))}if(!Se(f.borderRadius)){const v=kh(f.borderRadius,g.width);m.borderRadius=Math.max(0,Math.min(v,g.height/2,g.width/2))}if(!Se(f.ctrlBorderRadius)){const v=kh(f.ctrlBorderRadius,m.ctrlWidth);m.ctrlBorderRadius=Math.max(0,Math.min(v,m.ctrlWidth/2,m.ctrlHeight/2))}zse.forEach(v=>{const y=["left","right"].includes(v)?g.width:g.height,x=Ld(f[v]);let w=x.value;"%"===x.unit&&(w=y*x.value/100),m[v]=w})}(p,l,u),p.left||p.right||p.bottom||p.top){const{left:f,top:g,right:m,bottom:v,width:y,height:x,translateX:w,translateY:C}=u;u.x=""!==p.left?f+w||0:""!==p.right&&Ve(y)&&l.width-y-m+w||0,u.y=""!==p.top?g+C||0:""!==p.bottom&&Ve(x)&&l.height-x-v+C||0}return u}const Wse=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],Gse=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],zse=["left","top","right","bottom"],F0="visible",Cl="hidden";class $se{constructor(l){S(this,"context",void 0),this.context=l}handleVisibility(l){if(this.context.isDestroyed||l.isDestroyed||!l.total||!l.isActive)return;const{context:u}=this;if(u.isDefaultViewer?l.context.isContinuousDisplay?this.continuousVisibility(l):l.context.isSingleDisplay&&this.singleVisibility(l):u.isThumbnailViewer?this.thumbnailVisibility(l):u.isPerspectiveViewer&&l.context.isSingleDisplay&&this.singleVisibility(l),l.context.pagePreloadChanges.length){l.context.pagePreloadChanges.forEach(g=>{if(g.from&&!g.to){const m=l.getPageByUid(g.pageUid);m&&(m.isLoaded=!1)}});const f=Ax.create(l.uid,u.uid,u.viewerConfig.viewerMode,l.context.pagePreloadChanges);u.core.viewerService.onPagePreloadChanged.emit(f)}}thumbnailVisibility(l){const{total:u}=l;if(!u)return;const f=l.context;if(f.isOutOfBounds)return void l.pages.forEach(k=>{k.updateStyle({visibility:"hidden"})});const{rows:g,columns:m,placeholderPages:v,preloadCount:y,isVertical:x}=f,{width:w,height:C}=v[0],_=f.getParsedPageStyle(),T=f.getParsedCurrentPageStyle(),M=f.getParsedSelectedPageStyle(),L=f.getParsedHoveredPageStyle(),N=f.getParsedPlaceholderStyle(),V=f.getParsedPageNumberStyle(w,C),H=f.getParsedCheckboxStyle(w,C),{visibility:G,top:z,bottom:q,onPage:te,height:se}=V;let ae=0;const j="visible"===G,le=f.getPageNumberStyle();if(j){const k=""!==le.top?z:q||0;te||(ae=""!==le.top?se+k:0)}const{realColumn:ue,realRow:xe}=f.getRealRowAndColumnThumbnail(),{startRow:I,endRow:A}=this.getVisibleRow(l,xe,ue),{startColumn:P,endColumn:O}=this.getVisibleColumn(l,xe,ue);l.context.startRow=I,l.context.endRow=A,l.context.startColumn=P,l.context.endColumn=O;const b=Jd(T.borderWidth),D=[];l.pages.forEach((k,U)=>{const F=x?Math.floor(U/m):U%g,B=x?U%m:Math.floor(U/g),W=F>=I-y&&F<=A+y&&B>=P-y&&B<=O+y,$=F>=I&&F<=A&&B>=P&&B<=O?F0:Cl;k.isPreload!==W&&D.push({from:k.isPreload,to:W,pageUid:k.uid,index:U});let Y={borderWidth:0,background:"#ffffff00"};k.isDragging&&(Y=N);let J=_;k.isHovered&&(J=L),k.isSelected&&(J=M);const X=Jd(J.borderWidth);if(k.isPreload=W,k.updateStyle(ne({visibility:$},Y)),k.borderBox.updateStyle(Fe(ne({},J),{visibility:$,borderWidth:X})),j){let oe=V.y;te||(oe=""!==le.top?-ae:V.y+V.bottom),k.pageNumber.parsedPageNumberStyle=Fe(ne({},V),{y:oe}),k.pageNumber.updateText((U+1).toString())}k.pageNumber.updateStyle({visibility:V.visibility,zIndex:V.onPage?1:0});let ie=H.visibility;H.visibleByHover&&(ie=k.isHovered||k.isSelected?H.visibility:"hidden"),k.checkbox.parsedCheckboxStyle=ne({},H),k.checkbox.updateStyle({visibility:ie}),k.checkbox.checked=k.isSelected,k.curBox.updateStyle(Fe(ne({},T),{visibility:k.uid===l.currentUid?F0:Cl,borderWidth:b}))}),l.context.pagePreloadChanges=D}continuousVisibility(l){const{preloadCount:u,isVertical:f}=l.context,{pages:g}=l,m=l.context.getParsedPageStyle(),v=l.context.getParsedCurrentPageStyle(),{realRow:y,realColumn:x}=l.context.getRealRowAndColumnContinuous(),{startRow:w,endRow:C}=this.getVisibleRow(l,y,x),{startColumn:_,endColumn:T}=this.getVisibleColumn(l,y,x);l.context.startRow=w,l.context.endRow=C,l.context.startColumn=_,l.context.endColumn=T;const M=Jd(m.borderWidth),L=Jd(v.borderWidth),N=[];g.forEach((V,H)=>{const G=f?Math.floor(H/x):H%y,z=f?H%x:Math.floor(H/y),q=G>=w&&G<=C&&z>=_&&z<=T,te=G>=w-u&&G<=C+u&&z>=_-u&&z<=T+u;V.isPreload!==te&&N.push({from:V.isPreload,to:te,pageUid:V.uid,index:H}),V.checkbox.updateStyle({visibility:Cl}),V.pageNumber.updateStyle({visibility:Cl}),V.curBox.updateStyle(Fe(ne({},v),{visibility:V.uid===l.currentUid?F0:Cl,borderWidth:L})),V.borderBox.updateStyle(Fe(ne({},m),{borderWidth:M})),V.updateStyle({visibility:q?F0:Cl}),V.isPreload=te}),l.context.pagePreloadChanges=N}singleVisibility(l){const{preloadCount:u}=l.context,{current:f,total:g,pages:m}=l,v=l.getCurrentPage(),y=l.context.getParsedPageStyle(),x=Math.max(f-u,0),w=Math.min(f+u,g-1);v.checkbox.updateStyle({visibility:Cl}),v.pageNumber.updateStyle({visibility:Cl});const C=Jd(y.borderWidth),_=[];m.forEach((T,M)=>{const L=M>=x&&M<=w,N=T.uid===v.uid;T.isPreload!==L&&_.push({from:T.isPreload,to:L,pageUid:T.uid,index:M}),T.borderBox.updateStyle(Fe(ne({},y),{borderWidth:C})),T.updateStyle({visibility:N?F0:Cl}),T.isPreload=L,T.curBox.updateStyle({visibility:Cl})}),l.context.pagePreloadChanges=_}getVisibleColumn(l,u,f){const{scrollLeft:g,placeholderPages:m,currentViewportWidth:v,isVertical:y}=l.context;let x=0,w=f-1;if(y&&this.context.isThumbnailViewer)return{startColumn:x,endColumn:w};let C=Number.MAX_VALUE,_=Number.MAX_VALUE,T=null,M=null;for(let L=0;L<f;L++){const N=m[y?L:L*u];if(!N)continue;const{width:V,x:H}=N;if(null===T){const G=H-g;G<=0&&g-(H+V)<-1?(T=L,x=L):G>0&&G<C&&(C=G,x=L)}if(null===M){const G=g+v,z=G-(H+V);H-G<-1&&z<=0?(M=L,w=L):z>0&&z<_&&(_=z,w=L)}if(null!==T&&null!==M)break}return{startColumn:x,endColumn:w}}getVisibleRow(l,u,f){const{scrollTop:g,placeholderPages:m,currentViewportHeight:v,isVertical:y}=l.context;let x=0,w=u-1;if(!y&&this.context.isThumbnailViewer)return{startRow:x,endRow:w};let C=Number.MAX_VALUE,_=Number.MAX_VALUE,T=null,M=null;for(let L=0;L<u;L++){const N=m[y?L*f:L];if(!N)continue;const{y:V,height:H}=N;if(null===T){const G=V-g;G<=0&&g-(V+H)<-1?(T=L,x=L):G>0&&G<C&&(C=G,x=L)}if(null===M){const G=g+v,z=G-(V+H);V-G<-1&&z<=0?(M=L,w=L):z>0&&z<_&&(_=z,w=L)}if(null!==T&&null!==M)break}return{startRow:x,endRow:w}}}function xF(p,l,u,f){const g={isOver:!1,pointerX:-1,pointerY:-1,page:p};if(p&&f){const{x:m,y:v}=p.getPosition(),{width:y,height:x}=p;g.isOver=l>=m&&u>=v&&l<=m+y&&u<=v+x;const w=p.getScale();g.pointerX=(l-m)/w.x,g.pointerY=(u-v)/w.y}return g}const Yse={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},Xse={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},qse={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},Zse={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},Jse={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},Qse={tag:"div",id:"ddv-core",className:"ddv-core"};class Kse extends mi{constructor(l,u){super(),S(this,"container",void 0),S(this,"defaultDom",void 0),S(this,"mainAndThbContainer",void 0),S(this,"thumbnailContainer",void 0),S(this,"mainContainer",void 0),S(this,"scrollerAndCanvasContainer",void 0),S(this,"scrollContainer",void 0),S(this,"scrollContent",void 0),S(this,"canvasContainer",void 0),S(this,"videoContainer",void 0),S(this,"audioContainer",void 0),S(this,"rootDom",void 0),S(this,"hooks",void 0),S(this,"isBindContainer",!1),S(this,"viewportWidth",void 0),S(this,"viewportHeight",void 0),S(this,"context",void 0),S(this,"dpr",t0()),S(this,"hasScrollbarX",!1),S(this,"hasScrollbarY",!1),this.context=l,this.hooks=u;const f=Mh(Qse,l.postfix);this.defaultDom=f}dispose(){var l,u;null===(l=this.rootDom)||void 0===l||l.remove(),null===(u=this.thumbnailContainer)||void 0===u||u.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose()}createMainAndThbContainer(){if(!this.mainAndThbContainer){const u=Mh(Jse,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainAndThbContainer=u,this.defaultDom.appendChild(u)}}createMainContainer(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const u=Mh(Xse,l);this.mainContainer=u,this.mainAndThbContainer.appendChild(u);const f=u.querySelector(`#ddv-scroller-and-canvas${l}`),g=u.querySelector(`#ddv-canvas-container${l}`),m=u.querySelector(`#ddv-scroll-container${l}`),v=u.querySelector(`#ddv-scroll-content${l}`);this.scrollerAndCanvasContainer=f,this.canvasContainer=g,this.scrollContainer=m,this.scrollContent=v;const y=w=>{w.target===u&&this.isBindContainer&&this.context.isInitialized&&this.context.resize()},{resizeService:x}=this.context.core;x.observe(u),x.onResizeObserver.on(y,this),this.context.hooks.destroy.on(()=>{x.unobserve(u)})}}createThumbnailContainer(){if(!this.thumbnailContainer){const u=Mh(Yse,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.thumbnailContainer=u,this.mainAndThbContainer.insertBefore(u,this.mainContainer)}}createVideoContainer(){if(!this.videoContainer){const u=Mh(qse,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(u)}}createAudioContainer(){if(!this.audioContainer){const u=Mh(Zse,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(u)}}getViewportSize(){if(!this.mainContainer)return{width:0,height:0};const{offsetWidth:l,offsetHeight:u}=this.getElSize(this.mainContainer),f=this.getCanvasBorderSize();return{width:l-2*f,height:u-2*f}}resetViewport(){const{scrollContent:l,canvasContainer:u}=this;_p(u,0,0),_p(l,0,0);const{width:f,height:g}=this.getViewportSize();this.viewportWidth=f,this.viewportHeight=g,this.updateCanvasContainerSize()}resizeViewport(){const{canvasContainer:l,scrollContainer:u}=this;_p(l,0,0);const{offsetWidth:f,offsetHeight:g}=this.getElSize(u);this.viewportWidth=f,this.viewportHeight=g,this.updateCanvasContainerSize()}checkIsRound(l){const u=getComputedStyle(l);return{roundWidth:parseFloat(u.width)%1>=.5,roundHeight:parseFloat(u.height)%1>=.5}}getElSize(l){const{roundWidth:u,roundHeight:f}=this.checkIsRound(l);let{clientWidth:g,clientHeight:m,offsetWidth:v,offsetHeight:y}=l;return u&&(g-=1,v-=1),f&&(m-=1,y-=1),{clientWidth:g,clientHeight:m,offsetWidth:v,offsetHeight:y}}getMaxScrollValue(){const{scrollContainer:l}=this;return{scrollLeft:l.scrollWidth-l.clientWidth,scrollTop:l.scrollHeight-l.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const l=t0();return this.dpr!==l&&(this.dpr=l,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(l){let u=l;return l&&nt(l)&&(u=document.querySelector(`#${l}`)),u instanceof HTMLElement&&(u.appendChild(this.defaultDom),this.container=u,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return!1;for(let l=0;l<this.container.children.length;l++)if(this.container.children[l]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(l,u){const{scrollContainer:f}=this;f.scrollTo?f.scrollTo(l,u):(f.scrollLeft=l,f.scrollTop=u)}scrollBy(l,u){const{scrollContainer:f}=this;f.scrollBy?f.scrollBy(l,u):(f.scrollLeft+=l,f.scrollTop+=u)}updateScrollerContentSize(l){const{currentLayoutWidth:u,currentLayoutHeight:f}=l.context,{scrollContent:g,canvasContainer:m,scrollContainer:v}=this;_p(m,10,10),_p(g,u,f);const y=v.scrollWidth-v.clientWidth,x=v.scrollHeight-v.clientHeight;l.context.maxScrollLeft=y,l.context.maxScrollTop=x;const w=y>0,C=x>0;let _=!1;w!==this.hasScrollbarX&&(this.hasScrollbarX=w,_=!0),C!==this.hasScrollbarY&&(this.hasScrollbarY=C,_=!0),_&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize()}updateCanvasContainerSize(){const{scrollContainer:l,canvasContainer:u}=this,{width:f,height:g}=getComputedStyle(this.scrollContainer);let m,v=parseFloat(f),y=parseFloat(g);l.offsetWidth!==l.clientWidth&&(Ve(m)||(m=hT()),v-=m),l.offsetHeight!==l.clientHeight&&(Ve(m)||(m=hT()),y-=m),_p(u,v,y)}getCanvasBorderSize(){const{canvasContainer:l}=this;return(l.offsetWidth-l.clientWidth)/2}}class ere{constructor(){S(this,"canvasDom",void 0),S(this,"canvas",void 0),S(this,"renderer",void 0),S(this,"isInitialized",!1),S(this,"canvasWidth",0),S(this,"canvasHeight",0)}clear(){var l;const u=null===(l=this.canvas)||void 0===l?void 0:l.document.documentElement;!u||(u.children.slice().forEach(f=>{u.removeChild(f)}),u.sortable.sorted=[])}render(l){var u;const f=null===(u=this.canvas)||void 0===u?void 0:u.document.documentElement;if(f){if(l)0===f.children.length?f.appendChild(l):f.children.indexOf(l)<0&&f.replaceChild(l,f.children[0]);else{const g=[...f.children];for(let m=g.length;m>=0;m--)f.removeChild(g[m])}this.canvas.render()}}initCanvas(l){let{container:u,width:f,height:g}=l;const m=new pL({}),v=new oL({renderer:m,container:u,width:f,height:g});this.canvasWidth=f,this.canvasHeight=g,this.renderer=m,this.canvas=v,this.canvasDom=v.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0}registerShapeRenderer(l,u){this.canvas.contextService.registerShapeRenderer(l,u)}getCanvasPosition(){const l=this.canvasDom.getBoundingClientRect(),{scrollX:u,scrollY:f}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return{x:l.left+u,y:l.top+f}}resize(l,u){const f=t0();this.canvas.setDPR(f),this.canvasWidth=l,this.canvasHeight=u,this.canvas.resize(l,u)}}class tre{render(l,u){const{opacity:f,visibility:g}=l.parsedCheckboxStyle;0!==f&&"hidden"!==g&&(u.save(),u.globalAlpha=f,this.renderBox(l,u,"out"),u.clip(),this.renderBox(l,u,"in"),this.fill(l,u),this.renderBox(l,u,"center"),this.stroke(l,u),this.renderCheckMark(l,u),u.restore())}renderBox(l,u,f){const{x:g,y:m,width:v,height:y,borderWidth:x,borderRadiusX:w,borderRadiusY:C}=l.parsedCheckboxStyle;let _=0;"center"===f?_=x/2:"in"===f&&(_=x);const T=[{x:g+w,y:m+C,start:Math.PI,end:3*Math.PI/2},{x:g+v-w,y:m+C,start:3*Math.PI/2,end:2*Math.PI},{x:g+v-w,y:m+y-C,start:0,end:Math.PI/2},{x:g+w,y:m+y-C,start:Math.PI/2,end:Math.PI}],M=Math.max(w-_,0),L=Math.max(C-_,0);if(u.beginPath(),u.ellipse&&M&&L)for(let N=0;N<4;N++){const{x:V,y:H,start:G,end:z}=T[N];u.ellipse(V,H,M,L,0,G,z)}else u.rect(g,m,v,y);u.closePath()}fill(l,u){const{background:f}=l.parsedCheckboxStyle;f&&""!==f&&(u.fillStyle=f,u.fill())}stroke(l,u){const{borderColor:f,borderWidth:g,borderStyle:m}=l.parsedCheckboxStyle;u.setLineDash(m),u.strokeStyle=f,u.lineWidth=g,g>0&&f&&""!==f&&u.stroke()}renderCheckMark(l,u){if(!l.checked)return;const{x:f,y:g,width:m,height:v,borderWidth:y,checkMarkLineWidth:x,checkMarkColor:w}=l.parsedCheckboxStyle,C=Math.max(Math.min(m-2*y,v-2*y),0);let _=f,T=g;0!==C&&(m<v?(_+=y,T=T+y+(v-m)/2):(_=_+y+(m-v)/2,T+=y),u.setLineDash([0,0]),u.lineWidth=x,u.strokeStyle=w,u.beginPath(),u.moveTo(_+.15*C,T+.5*C),u.lineTo(_+.4*C,T+.8*C),u.lineTo(_+.85*C,T+.2*C),u.stroke())}}class ire{render(l,u){const{opacity:f,visibility:g}=l.parsedPageNumberStyle;0!==f&&"hidden"!==g&&(u.save(),u.globalAlpha=f,this.renderBox(l,u,"out"),u.clip(),this.renderBox(l,u,"in"),this.fill(l,u),this.renderBox(l,u,"center"),this.stroke(l,u),this.renderFont(l,u),u.restore())}renderBox(l,u,f){const{x:g,y:m,width:v,height:y,borderWidth:x,borderRadiusX:w,borderRadiusY:C}=l.parsedPageNumberStyle;let _=0;"center"===f?_=x/2:"in"===f&&(_=x);const T=[{x:g+w,y:m+C,start:Math.PI,end:3*Math.PI/2},{x:g+v-w,y:m+C,start:3*Math.PI/2,end:2*Math.PI},{x:g+v-w,y:m+y-C,start:0,end:Math.PI/2},{x:g+w,y:m+y-C,start:Math.PI/2,end:Math.PI}],M=Math.max(w-_,0),L=Math.max(C-_,0);if(u.beginPath(),u.ellipse&&M&&L)for(let N=0;N<4;N++){const{x:V,y:H,start:G,end:z}=T[N];u.ellipse(V,H,M,L,0,G,z)}else u.rect(g,m,v,y);u.closePath()}renderFont(l,u){const{x:f,y:g,width:m,height:v,fontSize:y,color:x,fontFamily:w}=l.parsedPageNumberStyle;u.fillStyle=x,u.textAlign="center",u.textBaseline="middle",u.font=w.includes(" ")?`${y}px '${w}'`:`${y}px ${w}`,u.fillText(l.text,f+m/2,g+v/2+y/8,m)}fill(l,u){const{background:f}=l.parsedPageNumberStyle;f&&""!==f&&(u.fillStyle=f,u.fill())}stroke(l,u){const{borderColor:f,borderWidth:g,borderStyle:m}=l.parsedPageNumberStyle;u.setLineDash(m),u.strokeStyle=f,u.lineWidth=g,g>0&&f&&""!==f&&u.stroke()}}class nre extends mi{constructor(l,u){super(),S(this,"context",void 0),S(this,"docRenderer",void 0),S(this,"hooks",void 0),this.context=l,this.hooks=u,this.docRenderer=new ere}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null}initRenderer(l,u,f){this.docRenderer.isInitialized||(Object.assign(l.style,this.context.viewerConfig.canvasStyle),this.docRenderer.initCanvas({container:l,width:u,height:f}),this.docRenderer.registerShapeRenderer("checkbox",new tre),this.docRenderer.registerShapeRenderer("pageNumber",new ire))}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const l=this.getCanvasDom();!l||l.getContext("2d").clearRect(0,0,l.width,l.height)}resize(l,u){this.docRenderer&&this.docRenderer.resize(l,u)}updateCanvasSize(){if(this.docRenderer){const l=this.getCanvasDom();if(!l)return;const{clientWidth:u,clientHeight:f}=l;this.docRenderer.resize(u,f)}}render(l){l.isDestroyed||(this.hooks.beforeRender.emit(l),this.docRenderer.render(l),this.hooks.afterRender.emit(l),l.pages.forEach((u,f)=>{if(u.isVisible&&u.isLoaded){const g=CE.create(f,u.uid);this.context.emit("pageRendered",g)}}))}getCanvasPosition(){const l=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:u,scrollY:f}=window;return{x:l.left+u,y:l.top+f}}}function sre(p){const l=p.getPages(),u=l.length;if(!u)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);let{viewportWidth:f,viewportHeight:g}=p;const{rows:m,columns:v,scrollbarWidth:y,tab:x,isVertical:w}=p,C=p.getMargin();v*m<u&&(w?f-=y:g-=y);let _=0,T=0;w?(_=(f-(v+1)*C)/v,T=(g-(m+1)*C)/m):(T=(g-(m+1)*C)/m,_=(f-(v+1)*C)/v);let M=!1;(_<0||T<0)&&(M=!0,_=Math.max(0,_),T=Math.max(0,T));const L=w?Math.max(m,Math.ceil(u/v)):m,N=w?v:Math.max(v,Math.ceil(u/m)),V=_*N+(N+1)*C,H=T*L+(L+1)*C,G=x.pages.map(F=>({uid:F.uid,x:0,y:0,width:_,height:T})),z=p.getParsedPageStyle(),q=p.getParsedSelectedPageStyle(),te=p.getParsedHoveredPageStyle(),se=p.getParsedPageNumberStyle(_,T),{visibility:ae,top:j,bottom:le,onPage:ue,height:xe}=se;let I=_,A=T;const P=_;let O=T,b=0;const D="visible"===ae,k=p.getPageNumberStyle();if(D){const F=""!==k.top?j:le||0;ue||(A=T-xe-F,O=T-xe-F,b=""!==k.top?xe+F:0)}A<0&&(M=!0,A=Math.max(0,A)),(I-2*z.borderWidth<0||A-2*z.borderWidth<0)&&(M=!0);const U=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=M?0:V+2*U,p.currentLayoutHeight=M?0:H+2*U,p.currentViewportWidth=M?p.viewportWidth:f,p.currentViewportHeight=M?p.viewportHeight:g,p.isOutOfBounds=M,M||(I=nr(I),A=nr(A),l.forEach((F,B)=>{let W=z.borderWidth;F.isHovered&&(W=te.borderWidth),F.isSelected&&(W=q.borderWidth),W=Jd(W);const $=w?B%v:Math.floor(B/m),Y=w?Math.floor(B/v):B%m,J=C+$*(C+_),X=C+Y*(C+T);G[B].x=J,G[B].y=X;let ie=I-2*W,oe=A-2*W;ie=Math.max(ie,0),oe=Math.max(oe,0);const de=F.rWidth,ve=F.rHeight;let Ae=de,Ce=ve,_e=1;(de>ie||ve>oe)&&(de/ve>ie/oe?(_e=ie/de,Ae=ie,Ce=ve*_e):(_e=oe/ve,Ce=oe,Ae=de*_e)),F.zoom=_e;const ge=bc(J),ce=bc(X+b);let be=W+(ie-Ae)/2,Ie=W+(oe-Ce)/2;be=bc(be),Ie=bc(Ie);const De=nr(de),re=nr(ve),he=de*(1-_e)/2,we=ve*(1-_e)/2,Pe=F.cropWidth,Ee=F.cropHeight,Me=be-he-(Pe-De)/2,Oe=Ie-we-(Ee-re)/2,Be=be-he,Le=Ie-we,He=De,We=re,Je=be,Qe=Ie,Xe=nr(Ae),St=nr(Ce);F.setPage(ge,ce,P,O),F.setBorderBox(0,0,I,A,W),F.setCropBox(Me,Oe,Pe,Ee,_e,F.rotation),F.setRealTimeBox(Be,Le,He,We,_e);const{width:ni,height:Ws}=p.viewerContext.getPageRenderSize(F.uid);F.setMediaBox(-F.cropLeft,-F.cropTop,ni,Ws),F.setImage(0,0,ni,Ws),F.setCurBox(Je,Qe,Xe,St)}),p.placeholderPages=G)}function wF(p){const{tab:l}=p,u=l.getCurrentPage();if(!u)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);const{viewportWidth:f,viewportHeight:g,scrollbarWidth:m,fitMode:v}=p,y=p.getMargin(),x=p.getParsedPageStyle(),{borderWidth:w=0}=x,C=2*w,_=u.rWidth,T=u.rHeight,M=2*y,L=C+M,N=C+M,V=f-L,H=g-N;let{zoom:G}=p;const z=CF(v,{zoom:G,validLayoutWidth:_,validLayoutHeight:T,scrollbarWidth:m,fitViewportWidth:V,fitViewportHeight:H,isZoomChanged:p.isZoomChanged},rre);p.isZoomChanged=!1;const{zoomedLayoutWidth:q,zoomedLayoutHeight:te,zoomedViewportWidth:se,zoomedViewportHeight:ae,newFitMode:j}=z;if(G=z.zoom,j&&v!==j){p.fitMode=j,p.viewerContext.viewerConfig.fitMode=j;const ce=yp.create(v,j);p.viewerContext.hooks.fitModeChanged.emit(ce)}p.setZoom(G);const le=q+L,ue=te+N,xe=se+L,I=ae+N,A=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=le+2*A,p.currentLayoutHeight=ue+2*A,p.currentViewportWidth=xe,p.currentViewportHeight=I,u.zoom=G,p.tab.setPosition({x:-0,y:-0});const P=l.pages.map(ce=>{let{uid:be}=ce;return{uid:be,x:y,y,width:q+C,height:te+C}});p.placeholderPages=P;const O=nr(q+C),b=nr(te+C),D=bc(y),k=D,U=Jd(w),F=U,B=nr(_),W=nr(T),$=_*(1-G)/2,Y=T*(1-G)/2,J=u.cropWidth,X=u.cropHeight,ie=U-$-(J-B)/2,oe=F-Y-(X-W)/2,de=U-$,ve=F-Y,Ae=B,Ce=W;u.setPage(D,k,O,b),u.setBorderBox(0,0,O,b),u.setCropBox(ie,oe,J,X,G,u.rotation),u.setRealTimeBox(de,ve,Ae,Ce,G);const{width:_e,height:ge}=p.viewerContext.getPageRenderSize(u.uid);u.setMediaBox(-u.cropLeft,-u.cropTop,_e,ge),u.setImage(0,0,_e,ge)}function rre(p,l){let{zoom:u,validLayoutWidth:f,validLayoutHeight:g,scrollbarWidth:m,fitViewportWidth:v,fitViewportHeight:y}=l;return"none"===p||"actualSize"===p?("actualSize"===p&&(u=1),Math.floor(f*u)>v&&(y-=m),Math.floor(g*u)>y&&(v-=m)):"width"===p||"window"===p&&f/v>=g/y?(u=v/f,g*u>y&&(v-=m,u=v/f)):(u=y/g,f*u>v&&(y-=m,u=y/g)),{zoom:u,zoomedLayoutWidth:f*u,zoomedLayoutHeight:g*u,zoomedViewportWidth:v,zoomedViewportHeight:y}}function CF(p,l,u){const{zoom:f,isZoomChanged:g}=l;let m={};if(g){let v;const y=Cp(f);1===f?(v="actualSize",m=u("actualSize",l)):(m=u("width",l),Cp(m.zoom)===y?(v="width","window"===p&&(v="window")):(m=u("height",l),y===Cp(m.zoom)&&(v="height","window"===p&&(v="window")))),v?m.newFitMode=v:(m=u("none",l),m.newFitMode="none")}else m=u(p,l);return m}function ore(p,l){let{zoom:u,fitWidth:f,fitHeight:g,validLayoutWidth:m,validLayoutHeight:v,scrollbarWidth:y,isVertical:x,fitViewportWidth:w,fitViewportHeight:C}=l;return"none"===p||"actualSize"===p?("actualSize"===p&&(u=1),Math.floor(m*u)>w&&(C-=y),Math.floor(v*u)>C&&(w-=y)):"width"===p||"window"===p&&f/w>=g/C?(u=w/f,x?v*u>C&&(w-=y,u=w/f):(m*u>w&&(C-=y),g*u>C&&(w-=y,u=w/f))):(u=C/g,x?(v*u>C&&(w-=y),f*u>w&&(C-=y,u=C/g)):m*u>w&&(C-=y,u=C/g)),{zoom:u,zoomedLayoutWidth:m*u,zoomedLayoutHeight:v*u,zoomedViewportWidth:w,zoomedViewportHeight:C}}const bF=p=>{const l=p.getPages();if(!l.length)return;const{tab:u}=p,f=u.current,g=l[f-1],m=l[f+1];g&&_F(p,g,-1),m&&_F(p,m,1)};function _F(p,l,u){const{viewportWidth:f,viewportHeight:g}=p,m=p.getParsedPageStyle(),{borderWidth:v=0}=m,y=p.getMargin(),{rWidth:x,rHeight:w}=l,C=f-2*y-2*v,_=g-2*y-2*v;let T=0,M=0,L=1;x/w>C/_?(T=C,L=C/x,M=w*L):(M=_,L=_/w,T=x*L);let N=(C-T)/2+y,V=(_-M)/2+y;N=Math.max(y,N),V=Math.max(y,V);const{x:H,y:G}=p.tab.getPosition();-1===u?(N=-f+N-H,V-=G):1===u&&(N=f+N-H,V-=G);const le=l.cropWidth,ue=l.cropHeight,xe=v-x*(1-L)/2-(le-x)/2,I=v-w*(1-L)/2-(ue-w)/2,A="visible",P="hidden";l.updateStyle({visibility:A,x:N,y:V,width:T+2*v,height:M+2*v}),l.borderBox.updateStyle(Fe(ne({x:0,y:0,width:T+2*v,height:M+2*v},m),{background:"#ffffff00",visibility:A})),l.cropBox.setLocalScale(1),l.cropBox.updateStyle({x:xe,y:I,width:le,height:ue}),l.cropBox.setLocalScale(L,L,1),l.cropBox.setLocalAngle(l.rotation);const{width:O,height:b}=p.viewerContext.getPageRenderSize(l.uid);l.mediaBox.updateStyle({x:-l.cropLeft,y:-l.cropTop,width:O,height:b}),l.zoom=L,l.checkbox.updateStyle({visibility:P}),l.pageNumber.updateStyle({visibility:P}),l.setImage(0,0,O,b)}function are(p){const{displayMode:l}=p;"single"===l?wF(p):"continuous"===l?function(u){const f=u.getPages();if(!f.length)return u.currentLayoutWidth=0,void(u.currentLayoutHeight=0);let{zoom:g}=u;const{viewportWidth:m,viewportHeight:v,tab:y,fitMode:x,scrollbarWidth:w,isVertical:C}=u,_=u.getParsedPageStyle(),{borderWidth:T}=_,M=2*T,L=u.getMargin(),{realRow:N,realColumn:V}=u.getRealRowAndColumnContinuous(),H=new Array(V).fill(0),G=new Array(N).fill(0);let z=0,q=0;f.forEach((de,ve)=>{const Ae=C?Math.floor(ve/V):ve%N,Ce=C?ve%V:Math.floor(ve/N),ge=de.rHeight+M;H[Ce]=Math.max(H[Ce],de.rWidth+M),G[Ae]=Math.max(G[Ae],ge),z=Math.max(H[Ce],z),q=Math.max(G[Ae],q)});let te=H.reduce((de,ve)=>de+ve,0),se=G.reduce((de,ve)=>de+ve,0);const ae=(V+1)*L,j=(N+1)*L,le=V*M+ae,ue=N*M+j;te+=ae,se+=j;const xe=te-le,I=se-ue;let A=0,P=0,O=0,b=0;C?(A=m-le,P=v-2*L-M,O=H.reduce((de,ve)=>de+ve-M,0),b=q-M):(A=m-2*L-M,P=v-ue,O=z-M,b=G.reduce((de,ve)=>de+ve-M,0));const D=CF(x,{zoom:g,fitWidth:O,fitHeight:b,validLayoutWidth:xe,validLayoutHeight:I,scrollbarWidth:w,isVertical:C,fitViewportWidth:A,fitViewportHeight:P,isZoomChanged:u.isZoomChanged},ore);u.isZoomChanged=!1;const{zoomedLayoutWidth:k,zoomedLayoutHeight:U,zoomedViewportWidth:F,zoomedViewportHeight:B,newFitMode:W}=D;if(g=D.zoom,W&&x!==W){u.fitMode=W,u.viewerContext.viewerConfig.fitMode=W;const de=yp.create(x,W);u.viewerContext.hooks.fitModeChanged.emit(de)}u.setZoom(g);const $=k+le,Y=U+ue;let J=0,X=0;C?(J=F+(V+1)*L+V*M,X=B+2*L+M):(J=F+2*L+M,X=B+(N+1)*L+N*M);const ie=u.viewerContext.viewService.getCanvasBorderSize();u.currentLayoutWidth=$+2*ie,u.currentLayoutHeight=Y+2*ie,u.currentViewportWidth=J,u.currentViewportHeight=X,u.tab.setPosition({x:-0,y:-0});const oe=y.pages.map(de=>({uid:de.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0}));f.forEach((de,ve)=>{const Ae=C?Math.floor(ve/V):ve%N,Ce=C?ve%V:Math.floor(ve/N),_e=(H[Ce]-M)*g+M,ge=(G[Ae]-M)*g+M,ce=de.rWidth,be=de.rHeight;let Ie=0,De=0;if(0===Ce)Ie=L;else{const du=oe[C?ve-1:(Ce-1)*N+Ae];Ie=du.x+du.width+L}if(0===Ae)De=L;else{const du=oe[C?(Ae-1)*V+Ce:ve-1];De=du.y+du.height+L}const re=oe[ve];re.width=_e,re.height=ge,re.x=Ie,re.y=De,de.zoom=g;const he=ce*g,we=be*g,Pe=De+(ge-we)/2-T,Ee=bc(Ie+(_e-he)/2-T),Me=bc(Pe);re.pageX=Ee,re.pageY=Me;let Oe=he+M,Be=we+M;Oe=nr(Oe),Be=nr(Be);const Le=bc(T),He=Le,We=nr(ce),Je=nr(be),Qe=ce*(1-g)/2,Xe=be*(1-g)/2,St=Le,ni=Le,Ws=nr(he),Fa=nr(we),Mc=de.cropWidth,on=de.cropHeight,jr=Le-Qe-(Mc-We)/2,cu=He-Xe-(on-Je)/2,Bh=Le-Qe,kc=He-Xe,Uh=We,ww=Je;de.setPage(Ee,Me,Oe,Be),de.setBorderBox(0,0,Oe,Be),de.setCropBox(jr,cu,Mc,on,g,de.rotation),de.setRealTimeBox(Bh,kc,Uh,ww,g);const{width:hu,height:Vh}=u.viewerContext.getPageRenderSize(de.uid);de.setMediaBox(-de.cropLeft,-de.cropTop,hu,Vh),de.setImage(de.mediaBoxRect.left,de.mediaBoxRect.top,hu,Vh),de.setCurBox(St,ni,Ws,Fa)}),u.placeholderPages=oe}(p):"slide"===l&&bF(p)}class lre{constructor(l,u){S(this,"context",void 0),S(this,"hooks",void 0),this.context=l,this.hooks=u}layout(l){if(l.isDestroyed||!l.isActive)return;let u;if(this.context.isDefaultViewer)u=are;else if(this.context.isThumbnailViewer)u=sre;else if(this.context.isPerspectiveViewer){const{displayMode:f}=l.context;"single"===f?u=wF:"slide"===f&&(u=bF)}u&&(this.hooks.beforeLayout.emit(l),u(l.context),this.hooks.afterLayout.emit(l))}}const cre=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class hre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"handlers",{}),this.context=l}dispose(){this.context=null,this.handlers={},super.dispose()}updateConfig(l){for(const[u,f]of Object.entries(l))cre.includes(u)&&this[u](f)}registerHandler(l,u){return!this[l]&&(this[l]=u,!0)}viewerMode(l){const{context:u}=this;u.viewerConfig.viewerMode=l}toolMode(l){const{context:u}=this,f=u.viewerConfig.toolMode;l!==f&&(u.viewerConfig.toolMode=l,u.hooks.toolModeChanged.emit(TE.create(f,l)))}annotationMode(l){const{context:u}=this,f=u.viewerConfig.annotationMode;l!==f&&(u.viewerConfig.annotationMode=l),u.hooks.annotationModeChanged.emit(PE.create(f,l))}fitMode(l){const{context:u}=this,f=u.getActiveTab();if(!f){const m=u.viewerConfig.fitMode;return m===l?void 0:(u.viewerConfig.fitMode=l,void u.hooks.fitModeChanged.emit(yp.create(m,l)))}const g=f.context.fitMode;g!==l&&(f.context.fitMode=l,"none"!==l&&(u.showTab(f,!0),u.hooks.fitModeChanged.emit(yp.create(g,l))))}displayMode(l){const{context:u}=this,f=u.getActiveTab();let g;if(f){if(g=f.context.displayMode,l===g)return;f.context.displayMode=l,u.showTab(f,!0)}else{if(g=u.viewerConfig.displayMode,l===g)return;u.viewerConfig.displayMode=l}if("slide"!==g&&"slide"!==l){const m=yE.create(g,l);u.viewer.hooks.displayModeChanged.emit(m)}}margin(l){const{context:u}=this;u.viewerConfig.margin!==l&&(u.viewerConfig.margin=l,u.showCurrentTab(!0))}rows(l){const{context:u}=this,f=u.getActiveTab();f?l!==f.context.rows&&(u.styleService.isCheckboxStyleChanged=!0,u.styleService.isPageNumberStyleChanged=!0,f.context.rows=l,this.context.showTab(f,!0)):u.viewerConfig.rows=l}columns(l){const{context:u}=this,f=u.getActiveTab();f?l!==f.context.columns&&(u.styleService.isCheckboxStyleChanged=!0,u.styleService.isPageNumberStyleChanged=!0,f.context.columns=l,this.context.showTab(f,!0)):u.viewerConfig.columns=l}maxColumns(l){l=Math.max(1,l);const{context:u}=this;u.viewerConfig.maxColumns=l;const f=u.getActiveTab();f&&f.context.columns>l&&this.columns(l)}maxRows(l){l=Math.max(1,l);const{context:u}=this;u.viewerConfig.maxRows=l;const f=u.getActiveTab();f&&f.context.rows>l&&this.rows(l)}zoom(l){const{context:u}=this;u.getActiveTab()&&u.zoomTo(l)}visibility(l){const{context:u}=this;if(l===u.viewerConfig.visibility)return;const{rootDom:f,defaultDom:g,thumbnailContainer:m}=u.viewService;if(!f)return;const{ui:v}=u.viewer,y=!m&&v.container.classList.contains("ddv-thumbnail-container"),x=u.viewerConfig.visibility;u.viewerConfig.visibility=l,"visible"===l?(f.style.display="flex",g.style.display="flex",y&&(v.container.style.display="flex"),u.core.viewerService.onResize.emit()):(f.style.display="none",y&&(v.container.style.display="none",u.core.viewerService.onResize.emit()));const w=WE.create(l,x);u.hooks.visibleChanged.emit(w)}zoomOrigin(l){const{context:u}=this;u.viewerConfig.zoomOrigin=l}minZoom(l){const{context:u}=this;u.viewerConfig.minZoom=l}maxZoom(l){const{context:u}=this;u.viewerConfig.maxZoom=l}multiselectMode(l){const{context:u}=this;u.viewerConfig.multiselectMode=l}canvasStyle(l){const{context:u}=this;if(vt(l))if(Object.assign(u.viewerConfig.canvasStyle,l),u.isCaptureViewer){var f;const g=null===(f=u.viewer)||void 0===f||null===(f=f.cameraContext)||void 0===f?void 0:f.cameraContainer;g&&Object.assign(g.style,l)}else{const{canvasContainer:g}=u.viewService,m=u.rendererService.getCanvasDom();g&&(Object.assign(g.style,l),l.cursor&&m&&Object.assign(m.style,{cursor:l.cursor}),u.styleService.isCanvasStyleChanged=!0,l.border&&u.resize(),l.cursor&&u.hooks.canvasCursorStyleChanged.emit())}}pageStyle(l){const{context:u}=this;vt(l)&&(Object.assign(u.viewerConfig.pageStyle,l),u.styleService.isPageStyleChanged=!0,u.showCurrentTab(!0))}selectedPageStyle(l){const{context:u}=this;vt(l)&&(Object.assign(u.viewerConfig.selectedPageStyle,l),u.styleService.isSelectedPageStyleChanged=!0,u.showCurrentTab(!0))}hoveredPageStyle(l){const{context:u}=this;vt(l)&&(Object.assign(u.viewerConfig.hoveredPageStyle,l),u.styleService.isHoveredPageStyleChanged=!0,u.showCurrentTab(!0))}placeholderStyle(l){const{context:u}=this;vt&&(Object.assign(u.viewerConfig.placeholderStyle,l),u.styleService.isPlaceholderStyleChanged=!0,u.showCurrentTab())}currentPageStyle(l){const{context:u}=this;vt&&(Object.assign(u.viewerConfig.currentPageStyle,l),u.styleService.isCurrentPageStyleChanged=!0,u.showCurrentTab())}pageNumberStyle(l){const{context:u}=this;if(vt(l)){const{pageNumberStyle:f}=u.viewerConfig,g=(null==l?void 0:l.onPage)!==(null==f?void 0:f.onPage);Object.assign(f,l),u.styleService.isPageNumberStyleChanged=!0,u.showCurrentTab(g)}}checkboxStyle(l){const{context:u}=this;vt(l)&&(Object.assign(u.viewerConfig.checkboxStyle,l),u.styleService.isCheckboxStyleChanged=!0,u.showCurrentTab())}quadSelectionStyle(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:u}=this;vt(l)&&(Object.assign(u.viewerConfig.quadSelectionStyle,l),u.styleService.isQuadSelectionStyleChanged=!0,u.hooks.quadSelectionStyleChanged.emit(),u.showCurrentTab())}scrollDirection(l){const{context:u}=this;u.viewerConfig.scrollDirection=l;const f=u.getActiveTab();f&&(f.context.direction=l,u.resize())}}class dre extends mi{constructor(l){super(),S(this,"context",void 0),this.context=l}dispose(){super.dispose(),this.context=null}handleExternalEvents(){const{context:l}=this,{hooks:u}=this.context;if(u.pageChanged.on(f=>{const g=this.context.getActiveTab();let m;!g||0===g.total||-1===g.current&&-1!==g.oldCurrent?m=0:-1!==g.current&&-1===g.oldCurrent&&(m=f.total),Se(m)||u.pageExistenceChanged.emit(ZE.create(m))}),u.pageChangedAfterRender.on(f=>{const g=this.context.getActiveTab();if(!g)return;const{current:m,oldCurrent:v,currentUid:y,oldCurrentUid:x}=g;if(v!==m){const w=vE.create(v,m);l.emit("currentIndexChanged",w)}if(x!==y){const w=AE.create(x||"",y||"");l.emit("currentPageChanged",w),u.currentPageChanged.emit(f)}}),u.displayModeChanged.on(f=>{l.emit("displayModeChanged",ne({},f))}),u.fitModeChanged.on(f=>{l.emit("fitModeChanged",ne({},f))}),u.toolModeChanged.on(f=>{l.emit("toolModeChanged",ne({},f))}),u.zoomChanged.on(f=>{f.oldZoomRatio!==f.newZoomRatio&&this.context.viewer.emit("zoomChanged",ne({},f))}),!this.context.isCaptureViewer){const f=this.context.rendererService.getCanvasDom();In(f,"click",this).on(g=>{const m=this.formatEvent(g);l.emit("click",m)}),In(f,"dblclick",this).on(g=>{const m=this.formatEvent(g);l.emit("dblclick",m)}),In(document.body,"dblclick",this).on(g=>{}),In(f,"contextmenu",this).on(g=>{g.preventDefault();const m=this.formatEvent(g);l.emit("rightclick",m)})}}formatEvent(l){var u,f;const[g]=this.context.formatTouches(l),m=this.context.getPointerOverPageInfo(g.pageX,g.pageY),v=yt.displayResolution,y=yt.dataResolution,{pointerX:x,pointerY:w}=m.imageInfo;return bx.create(m.index,null!==(u=null===(f=m.pageInfo.page)||void 0===f?void 0:f.uid)&&void 0!==u?u:"",x<0?-1:hl(bt(x,v,y),2),w<0?-1:hl(bt(w,v,y),2),Math.floor(g.pageX),Math.floor(g.pageY),l)}}class ure extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"offsetX",0),S(this,"offsetY",0),S(this,"startX",0),S(this,"startY",0),S(this,"isDragging",!1),S(this,"startPage",void 0),S(this,"newIndexes",void 0),S(this,"cacheChildren",void 0),S(this,"cacheSelectedIndexes",void 0),S(this,"isMousedown",!1),S(this,"starDragIndices",[]),this.context=l}dispose(){super.dispose(),this.context=null}startHandler(l){const{context:u}=this,{viewerConfig:f}=u;if("pan"!==f.toolMode||u.isLoadSource)return;const m=u.getActiveTab();if(null==m||!m.total)return;this.isMousedown=!0;const[v]=u.formatTouches(l),{page:y}=u.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo;if(y&&y){this.startX=v.pageX,this.startY=v.pageY;const x=y.getPosition();this.offsetX=v.pageX-x.x,this.offsetY=v.pageY-x.y,this.startPage=y,this.cacheChildren=m.pages.slice()}}moveHandler(l){const{context:u}=this,f=u.getActiveTab();if(!f||!u.isThumbnailViewer)return;const[g]=u.formatTouches(l),m=u.getPointerOverPageInfo(g.pageX,g.pageY),{page:v}=m.pageInfo;if(this.isDragging){var y,x,w;if(v&&!v.isSelected){const L=f.selected.map(z=>f.uidToIndex(z)).sort((z,q)=>z-q),N=L[0],V=f.getPageIndex(v),H=f.pages.slice();L.slice().reverse().forEach(z=>{H.splice(z,1)});let G=H.indexOf(v);V>N&&(G+=1),this.cacheSelectedIndexes.forEach((z,q)=>{const te=f.getPageByUid(z.uid);H.splice(G+q,0,te)}),this.newIndexes=H.map(z=>f.getPageIndex(z)),f.reorderPages(this.newIndexes,!1),u.layoutService.layout(f),u.visibilityService.handleVisibility(f)}const C=u.styleService.getParsedPlaceholderStyle(),_=devicePixelRatio;let T=g.pageX-this.offsetX,M=g.pageY-this.offsetY;T=Math.round(T*_)/_,M=Math.round(M*_)/_,f.selected.forEach(L=>{const N=f.getPageByUid(L);N.isDragging=!0,N.updateStyle(ne({},C)),N.borderBox.updateStyle({visibility:"hidden"})}),null===(y=this.startPage)||void 0===y||y.updateStyle({zIndex:1}),null===(x=this.startPage)||void 0===x||x.borderBox.updateStyle({visibility:"visible"}),null===(w=this.startPage)||void 0===w||w.borderBox.setPosition({x:T,y:M}),u.loadVisiblePages(f),u.rendererService.render(f)}else if(v&&v===this.startPage&&v.isSelected&&((g.pageX-this.startX)**2+(g.pageY-this.startY)**2)**.5>=u.viewerConfig.dragThreshold&&this.startPage&&u.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=f.selected.map(_=>({uid:_,index:f.uidToIndex(_)})).sort((_,T)=>_.index-T.index);const C=f.uidsToIndices(f.selected);this.starDragIndices=[...C],u.viewer.emit("pagesDragged",xE.create(C,[...f.selected]))}}endHandler(l){var u;if(!this.isMousedown)return;const{context:f}=this,g=f.getActiveTab();if(g){if(this.isDragging){if(this.newIndexes){const v=g.pages.map(y=>this.cacheChildren.indexOf(y));g.childNodes=this.cacheChildren,f.viewer.reorderPages(v),this.newIndexes=null}g.selected.forEach(v=>{const y=g.getPageByUid(v);y.borderBox.setLocalPosition({x:0,y:0}),y.isDragging=!1,y.borderBox.updateStyle({visibility:"visible"})});const m=g.uidsToIndices(g.selected);f.viewer.emit("pagesDropped",wE.create(this.starDragIndices,m,[...g.selected]))}null===(u=this.startPage)||void 0===u||u.updateStyle({zIndex:0}),this.isDragging&&(f.scrollByCurrentChanged=!0,f.layoutService.layout(g),f.visibilityService.handleVisibility(g),f.rendererService.render(g)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1}}}class fre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"isStart",!1),S(this,"startX",void 0),S(this,"startY",void 0),S(this,"lastX",void 0),S(this,"lastY",void 0),S(this,"startTime",void 0),S(this,"startScrollLeft",void 0),S(this,"startScrollTop",void 0),S(this,"isScrolling",void 0),S(this,"scrollTimer",void 0),S(this,"scrollDirectionX","left"),S(this,"scrollDirectionY","top"),S(this,"canvasElX",void 0),S(this,"canvasElY",void 0),this.context=l,this.isScrolling=!1}startHandler(l){const{context:u}=this;if(u.isPanning||u.isZooming)return;const f=u.getActiveTab();if(null==f||!f.total)return;const g=u.formatTouches(l);if(g.length>1)return;this.canvasElX=l.screenX,this.canvasElY=l.screenY;const{pageX:m,pageY:v}=g[0];this.isStart=!0,this.startX=m,this.startY=v,this.lastX=m,this.lastY=v,this.startTime=(new Date).getTime();const{scrollLeft:y,scrollTop:x}=f.context;this.startScrollLeft=y,this.startScrollTop=x,this.isScrolling=!1,this.scrollTimer&&(c6.clearTimer(this.scrollTimer),this.scrollTimer=null)}moveHandler(l){if(!this.isStart)return;l instanceof PointerEvent&&l.cancelable&&l.preventDefault();const{context:u}=this;if(u.isZooming)return;const f=u.formatTouches(l);if(f.length>1)return;const g=u.getActiveTab(),{maxScrollLeft:m,maxScrollTop:v}=g.context;let{scrollLeft:y,scrollTop:x}=g.context;if(!m&&!v)return;const{viewerConfig:w}=u,{panThreshold:C,enablePanX:_,enablePanY:T}=w,{pageX:M,pageY:L}=f[0],N=M-this.startX,V=L-this.startY,H=M-this.lastX,G=L-this.lastY;if(u.isPanning){if(!y&&!x&&H>=0&&G>=0||y===m&&x===v&&H<=0&&G<=0)return;_&&(y=this.startScrollLeft-N),T&&(x=this.startScrollTop-V),y=Pi(y,0,m),x=Pi(x,0,v),u.viewService.scrollTo(y,x)}else u.isPanning=_&&Math.abs(N)>=C||T&&Math.abs(V)>=C;this.lastX=M,this.lastY=L}endHandler(l){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:u}=this,f=u.formatTouches(l,!0);if(f.length>1||u.isZooming||"mouse"===l.pointerType||this.canvasElX===l.screenX&&this.canvasElY===l.screenY)return;const{scrollLeft:g,scrollTop:m}=this.context.viewService.getMaxScrollValue(),{scrollLeft:v,scrollTop:y}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(g>0||m>0)){const x=(new Date).getTime(),_=f[0].pageX-this.startX,T=f[0].pageY-this.startY;let M=!1,L=!1;_>0?(M=0!==v,this.scrollDirectionX="right"):(M=v!==g,this.scrollDirectionX="left"),T>0?(L=0!==y,this.scrollDirectionY="bottom"):(L=y!==m,this.scrollDirectionY="top");const N=x-this.startTime;if((Math.abs(_)>10||Math.abs(T)>10)&&N>0&&N<300&&(M||L)){let V=Math.abs(_)/N,H=Math.abs(T)/N;(V>.4||H>.4)&&(V=Math.min(V,2.8),H=Math.min(H,2.8),this.scroll(V,H,-.05))}}}scroll(l,u,f){this.isScrolling=!0;const{scrollLeft:g,scrollTop:m}=this.context.viewService.scrollContainer;let v=0,y=0;this.scrollTimer=c6.createTimer(()=>{const{scrollLeft:x,scrollTop:w}=this.context.viewService.getMaxScrollValue();if(l<=0&&u<=0||!1===this.isScrolling)return c6.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);l>=0&&("right"===this.scrollDirectionX?v-=40*l:v+=40*l,l+=f),u>=0&&("bottom"===this.scrollDirectionY?y-=40*u:y+=40*u,u+=f);const C=Pi(g+v,0,x),_=Pi(m+y,0,w);this.context.viewService.scrollTo(C,_)},25)}}class pre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"scrollTimer",void 0),this.context=l}scrollHandler(l){const{context:u}=this;if(u.scrollByCurrentChanged)return void(u.scrollByCurrentChanged=!1);const f=u.getActiveTab();if(null==f||!f.total)return;const{scrollLeft:g,scrollTop:m}=l.target;f.context.setTabScrollValue(g,m),u.visibilityService.handleVisibility(f),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{if(!u.isDestroyed&&f.isActive){if(u.isDefaultViewer){if(f.context.updateReference(),f.context.isContinuousDisplay&&u.viewerConfig.autoChangeIndex){const v=f.context.getCurrentByScroll();null!==v&&(f.gotoPage(v),u.visibilityService.handleVisibility(f),u.emitPageChangedEvent(f),u.emitPageChangedAfterRenderEvent(f),u.core.viewerService.onCurrentChangedByScroll.emit(Ex.create(f.uid,u.groupUid,u.uid,v)))}u.loadVisiblePages(f)}else u.isThumbnailViewer&&u.loadVisiblePages(f);this.scrollTimer=null}},42),u.rendererService.render(f),u.hooks.scroll.emit()}wheelHandler(l){const{context:u}=this;let{wheelDelta:f}=l;if(l.deltaY&&(f=-l.deltaY),1===l.deltaMode?f*=16:2===l.deltaMode&&(f=f<0?-100:100),!l.ctrlKey){const{scrollLeft:g,scrollTop:m}=u.viewService.getMaxScrollValue();if(g>0||m>0)l.shiftKey&&g>0?(l.cancelable&&l.preventDefault(),u.scrollByCurrentChanged=!1,u.viewService.scrollBy(-f,0)):(l.cancelable&&l.preventDefault(),u.scrollByCurrentChanged=!1,u.viewService.scrollBy(0,-f));else{const v=u.getActiveTab();if("single"===v.context.displayMode){l.cancelable&&l.preventDefault();let y=v.current;f>0&&0!==v.current?y-=1:f<0&&v.current!==v.total-1&&(y+=1),v.current!==y&&u.viewer.gotoPage(y)}}}}}class gre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"wheelTimer",void 0),S(this,"isStart",void 0),S(this,"isZooming",void 0),S(this,"startDistance",void 0),S(this,"touchZoomTimer",void 0),S(this,"startZoom",void 0),this.context=l,this.isZooming=!1,this.isStart=!1,this.startZoom=1}zoomTo(l,u,f){l=Cp(l);const{context:g}=this;if(!g.isDefaultViewer)return;const m=g.getActiveTab();if(null==m||!m.total)return;const{viewerConfig:v}=g;if((l=Pi(l,v.minZoom,v.maxZoom))===v.zoom)return;Ve(u)&&Ve(f)||({originX:u,originY:f}=m.context.getZoomOriginCord());const y=m.context.generateReference(u,f),x=m.context.zoom;m.context.setZoom(l),v.zoom=l,m.context.isZoomChanged=!0,g.layoutService.layout(m),g.viewService.updateScrollerContentSize(m),g.rendererService.updateCanvasSize();const{scrollLeft:w,scrollTop:C}=m.context.parseReferenceZoom(y,u,f);m.context.setTabScrollValue(w,C),g.viewService.scrollTo(w,C),g.visibilityService.handleVisibility(m),g.loadVisiblePages(m),g.clearCurrentTabOptimization(),g.rendererService.render(m),m.context.oldZoom=x,g.emitZoomChangedEvent(m)}wheelHandler(l){const{context:u}=this,{viewerConfig:f}=u;let{wheelDelta:g}=l;l.deltaY&&(g=-l.deltaY),l.ctrlKey&&!l.shiftKey&&f.enableZoom&&f.enableZoomWithCtrl&&(l.cancelable&&l.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout(()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const v=f.wheelZoomFactor||1,y=g>0?v:1/v,{x,y:w}=u.rendererService.getCanvasPosition();this.zoomTo(f.zoom*y,l.pageX-x,l.pageY-w)},40)))}touchstartHandler(l){const{context:u}=this,f=u.getActiveTab(),{displayMode:g}=f.context;if(!u.viewerConfig.enableZoom||"continuous"!==g&&"single"!==g)return;const v=u.formatTouches(l);v.length<2||(u.isZooming=!0,this.startZoom=f.context.zoom,this.startDistance=SF(v),this.isStart=!0)}touchmoveHandler(l){if(!this.isStart)return;l.cancelable&&l.preventDefault();const{context:u}=this,f=u.formatTouches(l);if(f.length<2)return;const g=(f[0].pageX+f[1].pageX)/2,m=(f[0].pageY+f[1].pageY)/2;let v=SF(f)/this.startDistance;l.scale&&(v=l.scale);const y=u.getActiveTab();let{zoom:x}=y.context;const w=x;x=this.startZoom*v,x!==w&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout(()=>{this.zoomTo(x,g,m),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null},25))),u.isZooming=!0}touchendHandler(l){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1)}tapZoomHandler(l){const{toolMode:u,enableZoom:f,tapZoomFactor:g}=this.context.viewerConfig;if(!f)return;const m="zoomIn"===u,v="zoomOut"===u;if(!m&&!v)return;const y=this.context.formatTouches(l);if(y.length>1)return;const x=(y[0].pageX+y[1].pageX)/2,w=(y[0].pageY+y[1].pageY)/2,C=this.context.getActiveTab();let{zoom:_}=C.context;m?_*=g||1:v&&(_/=g||1),this.zoomTo(_,x,w)}}function SF(p){return((p[0].pageX-p[1].pageX)**2+(p[0].pageY-p[1].pageY)**2)**.5}class mre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"isStart",!1),S(this,"startX",void 0),S(this,"isSliding",void 0),S(this,"slideDistance",void 0),S(this,"slideDirection",void 0),S(this,"slideRAF",void 0),S(this,"tabX",void 0),S(this,"tabY",void 0),this.context=l,this.isSliding=!1}startHandler(l){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const u=this.context.getActiveTab();if(null==u||!u.total)return;const{scrollLeft:f,scrollTop:g}=this.context.viewService.getMaxScrollValue();if(f||g)return;const m=this.context.formatTouches(l);if(m.length>1)return;const v=u.getPosition();this.tabX=v.x,this.tabY=v.y,this.startX=m[0].pageX,this.isStart=!0}moveHandler(l){if(!this.isStart)return;const{context:u}=this,f=u.getActiveTab(),g=u.formatTouches(l)[0].pageX-this.startX;if(g>0?this.slideDirection="right":g<0&&(this.slideDirection="left"),this.slideDistance=Math.min(f.context.viewportWidth,Math.abs(g)),this.isSliding)"right"===this.slideDirection?f.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&f.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),u.render();else if("single"===f.context.displayMode&&"pan"===u.viewerConfig.toolMode&&u.viewerConfig.enableSlide){const{scrollLeft:m,scrollTop:v}=this.context.viewService.getMaxScrollValue();Math.abs(g)>u.viewerConfig.startSlideThreshold&&!m&&!v&&(this.isSliding=!0,this.context.isSliding=!0,u.configService.updateConfig({displayMode:"slide"}))}}endHandler(l){if(!this.isStart)return;const{context:u}=this;this.context.formatTouches(l,!0);const f=u.getActiveTab(),{displayMode:g}=f.context;"slide"===g&&this.slide(f),this.isStart=!1}slide(l){let u,f=0,g=0,m=0,v=!1;const{viewerConfig:y}=this.context;this.slideDistance>=Math.max(l.context.viewportWidth*y.slideThresholdForPerspective,y.startSlideThreshold)?(g=l.context.viewportWidth,u=g-this.slideDistance,"left"===this.slideDirection?l.current!==l.total-1?(m=-this.slideDistance,f=-u/6):(g=0,u=this.slideDistance,v=!0,m=-this.slideDistance,f=u/6):0!==l.current?(m=this.slideDistance,f=u/6):(g=0,u=this.slideDistance,v=!0,m=this.slideDistance,f=-u/6)):(v=!0,g=0,u=this.slideDistance,"left"===this.slideDirection?(m=-this.slideDistance,f=u/6):(m=this.slideDistance,f=-u/6));const w=()=>{m+=f;const C=m>=0;if(Math.abs(m)>=g&&(m=g,C||(m*=-1)),l.setPosition({x:m+this.tabX,y:this.tabY,z:0}),Math.abs(m)===g)return v||(this.context.viewer.gotoPage("right"===this.slideDirection?l.current-1:l.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(w),this.context.render()};this.slideRAF=requestAnimationFrame(w)}}class vre extends mi{constructor(l){super(),S(this,"context",void 0),this.context=l}handleOptimizationEvents(){this.context.hooks.afterRender.on(l=>{this.optimizeTab(l)})}dispose(){super.dispose(),this.context=null}optimizeTab(l){this.context.viewerConfig.enableOptimizePage&&l.pages.forEach((u,f)=>{!gi()&&!u.isOptimized&&u.isVisible&&u.isLoaded&&u.zoom<1&&setTimeout(()=>{!u.isOptimized&&u.isVisible&&u.isLoaded&&u.zoom<1&&this.optimizePage(u.uid)},500)})}cancelOptimization(l){this.context.core.optimizationService.cancel(l)}optimizePage(l){if(!this.context)return;const{context:u}=this,{viewerConfig:f}=u;if(!f.enableOptimizePage)return;const g=u.getActiveTab();if(!g)return;const m=g.getPageByUid(l);if(!m||m.isOptimized||!m.isVisible||!m.isLoaded||m.optimizationUid===m.optimizedUid||u.isSliding||u.isDestroyed)return;const v=u.core.pageService.getPage(l);if(null==v||!v.display.img)return;const{img:y}=m.image.style;if(!y)return;const{naturalWidth:x,naturalHeight:w}=y;let C=x,_=w;const{maxOptimizationSize:T}=f;if(C>T||_>T||m.rWidth>T||m.rHeight>T)return;let M=0,L=0,N=0,V=0,H=0;({rWidth:C,rHeight:_,cropLeft:M,cropTop:L,cropWidth:N,cropHeight:V,rotation:H}=v.getEditResultForPixel());const G=bt(v.mediaBox.left,yt.displayResolution,v.resource.resolutionX),z=bt(v.mediaBox.top,yt.displayResolution,v.resource.resolutionX),q=new Nd({style:{x:-M+G,y:-L+z,img:y,width:x,height:w}});let te="rgba(0,0,0,0)";if(f.enableFillColor)te=f.blankFillColor;else if(f.viewerMode===Rn.THUMBNAIL){let I=f.pageStyle;m.isSelected?I=f.selectedPageStyle:m.isHovered&&(I=f.hoveredPageStyle),te=I.background}const se=new Gn({style:{x:-(N-C)/2,y:-(V-_)/2,width:N,height:V,background:te}});se.appendChild(q),se.setLocalAngle(H);const{commonCanvas:ae}=u.core;ae.render(se,C,_),ae.reset();const j=ae.getCanvas(),le=devicePixelRatio,ue=Math.floor(m.realTimeBox.width*le+.5)||1,xe=Math.floor(m.realTimeBox.height*le+.5)||1;m.isOptimized=!0,u.core.optimizationService.optimize(j,C,_,ue,xe,m.optimizationUid).then(I=>{if(!u.isDestroyed&&I.taskUid===m.optimizationUid){m.isOptimized=!0,m.optimizedUid=m.optimizationUid;const A=j.getContext("2d",{willReadFrequently:!0}).createImageData(ue,xe);A.data.set(I.target),m.realTimeBox.imageData=A,m.image.updateStyle({visibility:"hidden"}),m.isVisible&&u.render()}}).catch(I=>{m.isOptimized=!1})}}class yre extends mi{constructor(l,u,f,g,m,v){super(),S(this,"context",void 0),S(this,"panModeInteraction",void 0),S(this,"cropModeInteraction",void 0),S(this,"annotationModeInteraction",void 0),S(this,"zoomInModeInteraction",void 0),S(this,"zoomOutModeInteraction",void 0),this.context=l,this.panModeInteraction=u,this.cropModeInteraction=f,this.annotationModeInteraction=g,this.zoomInModeInteraction=m,this.zoomOutModeInteraction=v}handleEvents(){if(this.context.isCaptureViewer)return;const l=this.context.rendererService.getCanvasDom();In(l,"pointerdown",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointerdownHandler(u),this.cropModeInteraction.pointerdownHandler(u),this.annotationModeInteraction.pointerdownHandler(u),this.zoomInModeInteraction.startHandler(u),this.zoomOutModeInteraction.startHandler(u))}),In(l,"pointermove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointermoveHandler(u,!1),this.cropModeInteraction.pointermoveHandler(u),this.annotationModeInteraction.cursorHandler(u))},{passive:!1}),In(l,"pointerup",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&this.panModeInteraction.pointerupHandler(u)}),In(document,"pointerdown",this).on(u=>{}),In(document,"pointermove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointermoveHandler(u,!0),this.annotationModeInteraction.pointermoveHandler(u))},{passive:!1}),In(document,"pointerup",this).on(u=>{if(0!==u.button)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.pointerupHandler(u),this.cropModeInteraction.pointerupHandler(u),this.annotationModeInteraction.pointerupHandler(u),this.zoomInModeInteraction.endHandler(u),this.zoomOutModeInteraction.endHandler(u))}),In(l,"touchstart",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.touchstartHandler(u),this.cropModeInteraction.touchstartHandler(u))},{passive:!1}),In(l,"touchmove",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(u.cancelable&&u.preventDefault(),this.panModeInteraction.touchmoveHandler(u),this.cropModeInteraction.touchmoveHandler(u))},{passive:!1}),In(l,"touchend",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.touchendHandler(u),this.cropModeInteraction.touchendHandler(u))}),In(l,"wheel",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.wheelHandler(u),this.cropModeInteraction.wheelHandler(u),this.annotationModeInteraction.wheelHandler(u))},{passive:!1}),In(this.context.viewService.scrollContainer,"scroll",this).on(u=>{const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.scrollHandler(u),this.cropModeInteraction.scrollHandler(u),this.annotationModeInteraction.scrollHandler(u))}),In(document,"keydown",this).on(u=>{if(!this.context.isFocused||!this.context.viewerConfig.enableKeyboardInteraction)return;const f=this.context.getActiveTab();null!=f&&f.total&&(this.panModeInteraction.keydownHandler(u),this.cropModeInteraction.keydownHandler(u),this.annotationModeInteraction.keydownHandler(u),this.zoomInModeInteraction.keydownHandler(u),this.zoomOutModeInteraction.keydownHandler(u))}),In(document,"click",this).on(u=>{const f=this.context.rendererService.getCanvasDom();this.context.isFocused=u.target===f})}}class xre extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"isPointerdown",!1),S(this,"startPage",void 0),S(this,"mouseOverPage",void 0),this.context=l}startHandler(l){const{context:u}=this,{viewerConfig:f,styleService:g}=u,m=this.context.getActiveTab();if(null==m||!m.total)return;this.isPointerdown=!0;const[v]=u.formatTouches(l),{page:y}=u.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo;if(!y||(this.startPage=y,l.ctrlKey))return;const x=m.getPageIndex(y),w=m.getCurrentPage(),C=l.shiftKey&&f.enableSelectWithShift;if(C&&m.selected.length){if(C&&w!==y&&m.shiftReference){const _=m.uidToIndex(m.shiftReference),T=Math.min(x,_),M=Math.max(x,_),L=[];for(let N=T;N<=M;N++)L.push(N);if(u.viewerConfig.enableOptimizePage){g.isSelectedBorderWidthEqualHovered()||u.clearOptimization([y.uid]),g.isSelectedBorderWidthEqualNormal()||L.forEach(V=>{const H=m.getPageByIndex(T+V);m.selected.includes(H.uid)||H.uid===y.uid||g.isSelectedBorderWidthEqualNormal()||u.clearOptimization([H.uid])});const N=m.indicesToUids(L);g.isSelectedBorderWidthEqualNormal()||m.selected.forEach(V=>{if(!N.includes(V)){const H=m.getPageByUid(V);H&&u.clearOptimization([H.uid])}})}x>_&&L.reverse(),u.viewer.gotoPage(x),u.viewer.selectPagesByIndices(L)}}else f.multiselectMode||(y.uid!==m.currentUid&&u.viewer.gotoPage(x),y.isSelected||(u.viewerConfig.enableOptimizePage&&(g.isSelectedBorderWidthEqualNormal()||m.selected.forEach(_=>{const T=m.getPageByUid(_);T&&u.clearOptimization([T.uid])}),g.isSelectedBorderWidthEqualHovered()||u.clearOptimization([y.uid])),u.viewer.selectPagesByIndices([x])))}moveHandler(l){const{context:u}=this,{styleService:f}=u,g=u.getActiveTab();if(null==g||!g.total)return;const[m]=u.formatTouches(l),v=u.getPointerOverPageInfo(m.pageX,m.pageY),{page:y}=v.pageInfo,{mouseOverPage:x}=this;u.viewerConfig.enableOptimizePage&&!f.isBorderWidthEqualHovered()&&(x&&!x.isSelected&&(y&&x===y||u.clearOptimization([x.uid])),y&&!y.isSelected&&(x&&x===y||u.clearOptimization([y.uid]))),this.mouseOverPage=y;let w=!1;"mouse"===l.pointerType&&g.pages.forEach(C=>{y&&y.uid===C.uid?(C.isHovered||(w=!0),C.isHovered=!0):(C.isHovered&&(w=!0),C.isHovered=!1)}),w&&(u.layoutService.layout(g),u.visibilityService.handleVisibility(g),u.rendererService.render(g))}endHandler(l){if(!this.isPointerdown)return;const{context:u}=this,{styleService:f}=u,[g]=u.formatTouches(l,!0),m=u.getActiveTab();if(null==m||!m.total)return;const v=u.getPointerOverPageInfo(g.pageX,g.pageY).pageInfo.page;if(v&&v===this.startPage&&!l.shiftKey)if(l.ctrlKey&&u.viewerConfig.enableSelectWithCtrl||u.viewerConfig.multiselectMode){const y=m.selected.slice(),x=y.indexOf(v.uid);v.isSelected?y.splice(x,1):y.push(v.uid);const w=m.uidsToIndices(y);if(v.uid!==m.currentUid){const C=m.uidToIndex(v.uid);u.viewer.gotoPage(C)}!f.isSelectedBorderWidthEqualHovered()&&u.viewerConfig.enableOptimizePage&&u.clearOptimization([v.uid]),u.viewer.selectPagesByIndices(w)}else if(!l.ctrlKey&&!l.shiftKey){const y=m.getPageIndex(v);v.uid!==m.currentUid&&u.viewer.gotoPage(y),u.viewerConfig.enableOptimizePage&&(f.isSelectedBorderWidthEqualNormal()||m.selected.forEach(x=>{const w=m.getPageByUid(x);w&&u.clearOptimization([w.uid])}),f.isSelectedBorderWidthEqualHovered()||u.clearOptimization([v.uid])),u.viewer.selectPagesByIndices([y])}this.isPointerdown=!1,this.startPage=null}keydownHandler(l){}}class wre extends mi{constructor(l){super(),S(this,"context",void 0),this.context=l}undoHandler(l){l.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(l.preventDefault(),this.context.viewer.undo())}redoHandler(l){l.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(l.preventDefault(),this.context.viewer.redo())}zoomInHandler(l){l.ctrlKey&&this.context.viewerConfig.enableZoomInWidthKeyboard&&(l.preventDefault(),this.context.viewer.zoomIn())}zoomOutHandler(l){l.ctrlKey&&this.context.viewerConfig.enableZoomOutWidthKeyboard&&(l.preventDefault(),this.context.viewer.zoomOut())}arrowLeftHandler(l){}arrowRightHandler(l){}arrowUpHandler(l){}arrowDownHandler(l){}escapeHandler(l){}enterHandler(l){}pageUpHandler(l){}pageDownHandler(l){}homeHandler(l){}endHandler(l){}scrollHandler(l){}selectPageHandler(l){}}class Cre{constructor(l){S(this,"context",void 0),S(this,"isEditAnnotation",!1),S(this,"isMove",!1),S(this,"isSlide",!1),S(this,"isActivateAnnotation",!1),S(this,"isTouchstart",!1),S(this,"isPointerdown",!1),S(this,"isFirstMove",!0),S(this,"isPointerOnAnnotation",!1),S(this,"isAnnotationActive",!1),S(this,"activeShape",void 0),S(this,"pointerNum",0),S(this,"startPoint",void 0),S(this,"dragTimer",void 0),S(this,"isDragPages",!1),S(this,"isMoveForThumbnail",!1),S(this,"isMoved",!1),S(this,"keyboardHandlerMapForDefault",void 0),S(this,"keyboardHandlerMapForThumbnail",void 0),S(this,"canScroll",!0),S(this,"startX",void 0),S(this,"startY",void 0),this.context=l}get isPanMode(){return"pan"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(this.isPointerdown||!this.isPanMode)return;const u=this.context.getActiveTab();if(null==u||!u.total||"slide"===this.context.viewerConfig.displayMode)return;const{isDefaultViewer:f,isThumbnailViewer:g,viewService:m,hasAnnotationModule:v,annotationEditService:y,selectPagesService:x,moveService:w,dragService:C,slideService:_,viewerConfig:{dragStartTimeThreshold:T,enableSlide:M,enableDragPage:L}}=this.context,{displayMode:N}=u.context;if(this.isPointerdown=!0,this.isFirstMove=!0,f){const{scrollLeft:V,scrollTop:H}=m.getMaxScrollValue();if(v){const[G]=this.context.formatTouches(l),{page:z}=this.context.getPointerOverPageInfo(G.pageX,G.pageY).pageInfo;if(this.startPoint={x:G.pageX,y:G.pageY},z){let{x:ae,y:j}=z.cropBox.getPosition(),{width:le,height:ue}=z.cropBox;const xe=(z.rotation%360+360)%360/90;if(1===xe?ae-=ue:2===xe?(ae-=le,j-=ue):3===xe&&(j-=le),1===xe||3===xe){const I=le;le=ue,ue=I}y.setAnnotationContainer(z),y.setAnnotationInteractionArea({x:ae,y:j,width:le,height:ue})}const{isHit:q,shape:te,isHitSelected:se}=this.context.annotationEditService.isHitAnnotation(l);q&&z?(this.activeShape=te,this.isPointerOnAnnotation=!0,"touch"===l.pointerType||"pen"===l.pointerType?se?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,y.startHandler(l,!1)):this.isActivateAnnotation=!0:"mouse"===l.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,y.startHandler(l,!0)),y.hasActiveAnnotation()&&(this.canScroll=!1)):y.deactivateAnnotation()}this.isPointerOnAnnotation||(V||H?(this.isMove=!0,this.isSlide=!1,w.startHandler(l)):"single"===N&&M&&(this.isMove=!1,this.isSlide=!0,_.startHandler(l)))}else if(g){x.startHandler(l);const[V]=this.context.formatTouches(l),{page:H}=this.context.getPointerOverPageInfo(V.pageX,V.pageY).pageInfo;H&&!l.ctrlKey?"touch"===l.pointerType||"pen"===l.pointerType?(L?this.dragTimer=setTimeout(()=>{this.isMoveForThumbnail||(this.isDragPages=!0,C.startHandler(l))},T):(this.isMoveForThumbnail=!0,w.startHandler(l)),this.startX=l.pageX,this.startY=l.pageY):"mouse"===l.pointerType&&(L?(this.isDragPages=!0,C.startHandler(l)):(this.isMoveForThumbnail=!0,w.startHandler(l))):(this.isMoveForThumbnail=!0,w.startHandler(l))}}pointermoveHandler(l,u){if(this.pointerNum>1)return;const f=this.context.getActiveTab();if(null==f||!f.total)return;const{isDefaultViewer:g,isThumbnailViewer:m,viewService:v,moveService:y,slideService:x,annotationEditService:w,dragService:C,selectPagesService:_}=this.context,{displayMode:T}=f.context;if(g&&!u&&this.isPointerdown){if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){const[M]=this.context.formatTouches(l);yh(this.startPoint,{x:M.pageX,y:M.pageY})>1&&(this.isActivateAnnotation=!1);const{scrollLeft:L,scrollTop:N}=v.getMaxScrollValue();L||N?(this.isMove=!0,this.isSlide=!1,y.startHandler(l)):"single"===T&&(this.isMove=!1,this.isSlide=!0,x.startHandler(l))}if(this.isEditAnnotation){const[M]=this.context.formatTouches(l),{page:L}=this.context.getPointerOverPageInfo(M.pageX,M.pageY).pageInfo;w.moveHandler(l,!L)}else this.isMove?y.moveHandler(l):this.isSlide&&x.moveHandler(l);this.isFirstMove=!1}else if(m&&u)if(_.moveHandler(l),"touch"===l.pointerType){const M=yh({x:this.startX,y:this.startY},{x:l.pageX,y:l.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||y.startHandler(l),M>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,C.moveHandler(l)):!this.isDragPages&&this.isPointerdown&&(M>5&&(this.isMoveForThumbnail=!0,y.moveHandler(l)),this.isMoved=!0)}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||y.startHandler(l),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,C.moveHandler(l)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,y.moveHandler(l),this.isMoved=!0)}pointerupHandler(l){if(!this.isPointerdown)return;const{isDefaultViewer:u,isThumbnailViewer:f,annotationEditService:g,moveService:m,slideService:v,dragService:y,selectPagesService:x}=this.context;if(u)this.isEditAnnotation?g.endHandler(l):this.isActivateAnnotation?(g.activateAnnotation(this.activeShape,l.ctrlKey),this.context.render()):this.isMove?m.endHandler(l):this.isSlide&&v.endHandler(l);else if(f){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const w=yh({x:this.startX,y:this.startY},{x:l.pageX,y:l.pageY});(!this.isMoved||w<5)&&x.endHandler(l),this.isDragPages?y.endHandler(l):m.endHandler(l)}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null}touchstartHandler(l){if(this.pointerNum=l.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:u,enableZoomInPanMode:f,enableZoomWithTouch:g}=this.context.viewerConfig;if(!this.isPanMode||2!==l.targetTouches.length||this.isTouchstart||!u||!g||!f)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(l)}}touchmoveHandler(l){this.pointerNum=l.targetTouches.length,2===l.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(l)}touchendHandler(l){this.pointerNum=l.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(l))}wheelHandler(l){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void l.preventDefault();const{isDefaultViewer:u,isThumbnailViewer:f,viewerConfig:{enableZoom:g,enableZoomInPanMode:m,enableZoomWithCtrl:v},zoomService:y,scrollService:x}=this.context;if(u)if(l.ctrlKey){if(!g||!m||!v)return;y.wheelHandler(l)}else x.wheelHandler(l);else f&&x.wheelHandler(l)}scrollHandler(l){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isPanMode)return;const{context:u,context:{keyboardService:f,annotationEditService:g,viewerConfig:{enableKeyboardInteraction:m,enableZoom:v,enableZoomInPanMode:y,enableZoomOutWidthKeyboard:x,enableZoomInWidthKeyboard:w,enableCopyCutPasteWidthKeyboard:C,enableUndoWidthKeyboard:_,enableRedoWidthKeyboard:T},hasAnnotationModule:L}}=this;if(!m)return;const N=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(u.isDefaultViewer){let V=this.keyboardHandlerMapForDefault;if(V||(V={c:H=>{C&&g.copyAnnotations()},x:H=>{C&&g.cutAnnotations()},v:H=>{C&&g.pasteAnnotations()},y:H=>{T&&f.redoHandler(H)},z:H=>{_&&f.undoHandler(H)},"-":H=>{v&&y&&x&&f.zoomOutHandler(H)},"=":H=>{v&&y&&w&&f.zoomInHandler(H)},Escape:H=>{f.escapeHandler(H)},Enter:H=>{f.enterHandler(H)},PageUp:H=>{f.pageUpHandler(H)},PageDown:H=>{f.pageDownHandler(H)},Home:H=>{f.homeHandler(H)},End:H=>{f.endHandler(H)}},this.keyboardHandlerMapForDefault=V),l.ctrlKey){const H=V[l.key];H&&l.ctrlKey?H(l):N.includes(l.key)&&(L&&g.hasActiveAnnotation()?g.moveAnnotationByKeyboard(l):f.scrollHandler(l))}}else if(u.isThumbnailViewer){let V=this.keyboardHandlerMapForThumbnail;V||(V={PageUp:G=>{f.pageUpHandler(G)},PageDown:G=>{f.pageDownHandler(G)},Home:G=>{f.homeHandler(G)},End:G=>{f.endHandler(G)}},this.keyboardHandlerMapForThumbnail=V);const H=V[l.key];H?H(l):N.includes(l.key)&&u.selectPagesService.keydownHandler(l)}}}class bre{constructor(l){S(this,"context",void 0),S(this,"isEditCropBox",!1),S(this,"isPerspectiveQuad",!1),S(this,"isTouchstart",!1),S(this,"isPointerdown",!1),S(this,"pointerNum",0),S(this,"keyboardHandlerMap",void 0),this.context=l}get isCropMode(){return"crop"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:u}=this;u.hasBoxRendererModule?u.isDefaultViewer?(this.isEditCropBox=u.cropBoxEditService.isEditCropBox(l),this.isEditCropBox?u.cropBoxEditService.startHandler(l):u.moveService.startHandler(l)):u.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,u.perspectiveQuadEditService.startHandler(l)):u.isDefaultViewer&&u.moveService.startHandler(l)}pointermoveHandler(l){if(this.pointerNum>1)return;const{context:u}=this;u.isDefaultViewer?(u.cropBoxEditService.moveHandler(l),!this.isEditCropBox&&this.isPointerdown&&u.moveService.moveHandler(l)):u.isPerspectiveViewer&&u.perspectiveQuadEditService.moveHandler(l)}pointerupHandler(l){if(!this.isPointerdown)return;const{context:u}=this;u.isDefaultViewer?this.isEditCropBox?u.cropBoxEditService.endHandler(l):u.moveService.endHandler(l):u.isPerspectiveViewer&&this.isPerspectiveQuad&&u.perspectiveQuadEditService.endHandler(l),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1}touchstartHandler(l){this.pointerNum=l.targetTouches.length;const{context:u,context:{viewerConfig:f}}=this;if(u.isDefaultViewer){if(!this.isCropMode||2!==l.targetTouches.length||this.isTouchstart||!f.enableZoom||!f.enableZoomWithTouch||!f.enableZoomInCropMode)return;this.isTouchstart=!0,u.zoomService.touchstartHandler(l)}}touchmoveHandler(l){this.pointerNum=l.targetTouches.length,2===l.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(l)}touchendHandler(l){this.pointerNum=l.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(l))}wheelHandler(l){if(this.pointerNum=0,!this.isCropMode)return;const{context:u,context:{viewerConfig:f}}=this;if(u.isDefaultViewer)if(l.ctrlKey){if(!f.enableZoom||!f.enableZoomInCropMode||!f.enableZoomWithCtrl)return;u.zoomService.wheelHandler(l)}else u.scrollService.wheelHandler(l)}scrollHandler(l){if(!this.isCropMode)return;const{context:u}=this;(u.isDefaultViewer||u.isThumbnailViewer)&&u.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isCropMode)return;const{keyboardService:u,isDefaultViewer:f,viewerConfig:{enableKeyboardInteraction:g,enableZoom:m,enableZoomInCropMode:v,enableZoomOutWidthKeyboard:y,enableZoomInWidthKeyboard:x,enableUndoWidthKeyboard:w,enableRedoWidthKeyboard:C}}=this.context;if(!f||!g||!l.ctrlKey)return;let _=this.keyboardHandlerMap;_||(_={y:M=>{C&&u.redoHandler(M)},z:M=>{w&&u.undoHandler(M)},"-":M=>{m&&v&&y&&u.zoomOutHandler(M)},"=":M=>{m&&v&&x&&u.zoomInHandler(M)},Escape:M=>{u.escapeHandler(M)},Enter:M=>{u.enterHandler(M)},PageUp:M=>{u.pageUpHandler(M)},PageDown:M=>{u.pageDownHandler(M)}},this.keyboardHandlerMap=_);const T=_[l.key];T?T(l):["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(l.key)&&u.scrollHandler(l)}}class _re{constructor(l){S(this,"context",void 0),S(this,"isPointerdown",!1),S(this,"pointerId",null),S(this,"keyboardHandlerMapForDefault",void 0),S(this,"canScroll",!0),this.context=l}get isAnnotationMode(){return"annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(l){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=l.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;if(f){let{x:g,y:m}=f.cropBox.getPosition(),{width:v,height:y}=f.cropBox;const x=360,w=(f.rotation%x+x)%x/90;if(1===w?g-=y:2===w?(g-=v,m-=y):3===w&&(m-=v),1===w||3===w){const C=v;v=y,y=C}this.context.annotationEditService.setAnnotationContainer(f),this.context.annotationEditService.setAnnotationInteractionArea({x:g,y:m,width:v,height:y})}this.isPointerdown=!0,this.context.annotationEditService.startHandler(l,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1)}}pointermoveHandler(l){if((this.pointerId===l.pointerId||"touch"!==l.pointerType)&&this.context.isDefaultViewer){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;this.context.annotationEditService.moveHandler(l,!f)}}cursorHandler(l){if("mouse"===(null==l?void 0:l.pointerType)&&this.context.isDefaultViewer){const[u]=this.context.formatTouches(l),{page:f}=this.context.getPointerOverPageInfo(u.pageX,u.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(l,!f,this.context.viewerConfig.canvasStyle.cursor)}}pointerupHandler(l){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(l),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null)}wheelHandler(l){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(l.ctrlKey){const{enableZoom:u,enableZoomInAnnotationMode:f,enableZoomWithCtrl:g}=this.context.viewerConfig;if(!(this.isAnnotationMode&&u&&f&&g))return;this.context.zoomService.wheelHandler(l)}else this.context.scrollService.wheelHandler(l)}else l.preventDefault()}scrollHandler(l){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(l)}keydownHandler(l){if(!this.isAnnotationMode)return;const{context:{keyboardService:f,annotationEditService:g,viewerConfig:{enableKeyboardInteraction:m,enableZoom:v,enableZoomInAnnotationMode:y,enableZoomOutWidthKeyboard:x,enableZoomInWidthKeyboard:w,enableCopyCutPasteWidthKeyboard:C,enableUndoWidthKeyboard:_,enableRedoWidthKeyboard:T},hasAnnotationModule:M}}=this;if(!m)return;const L=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(this.context.isDefaultViewer){let N=this.keyboardHandlerMapForDefault;N||(N={c:H=>{C&&g.copyAnnotations()},x:H=>{C&&g.cutAnnotations()},v:H=>{C&&g.pasteAnnotations()},y:H=>{T&&f.redoHandler(H)},z:H=>{_&&f.undoHandler(H)},"-":H=>{v&&y&&x&&f.zoomOutHandler(H)},"=":H=>{v&&y&&w&&f.zoomInHandler(H)},Escape:H=>{f.escapeHandler(H)},Enter:H=>{f.enterHandler(H)},PageUp:H=>{f.pageUpHandler(H)},PageDown:H=>{f.pageDownHandler(H)},Home:H=>{f.homeHandler(H)},End:H=>{f.endHandler(H)}},this.keyboardHandlerMapForDefault=N);const V=N[l.key];V&&l.ctrlKey?V(l):L.includes(l.key)&&(M&&g.hasActiveAnnotation()?g.moveAnnotationByKeyboard(l):f.scrollHandler(l))}}}class Sre{constructor(l){S(this,"context",void 0),S(this,"isPointerdown",!1),this.context=l}get isZoomInMode(){return"zoomIn"===this.context.viewerConfig.toolMode}startHandler(l){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(l),this.isPointerdown=!0)}endHandler(l){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(l){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:u}}=this;u.enableKeyboardInteraction&&u.enableZoom&&u.enableZoomInWidthKeyboard&&l.ctrlKey&&"="===l.key&&this.context.keyboardService.zoomInHandler(l)}}class Ere{constructor(l){S(this,"context",void 0),S(this,"isPointerdown",!1),this.context=l}get isZoomOutMode(){return"zoomOut"===this.context.viewerConfig.toolMode}startHandler(l){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(l),this.isPointerdown=!0)}endHandler(l){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(l){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:u}}=this;u.enableKeyboardInteraction&&u.enableZoom&&u.enableZoomOutWidthKeyboard&&l.ctrlKey&&"-"===l.key&&this.context.keyboardService.zoomInHandler(l)}}class Tre extends mi{constructor(l,u){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),S(this,"core",void 0),S(this,"viewer",void 0),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"hooks",void 0),S(this,"viewService",void 0),S(this,"rendererService",void 0),S(this,"tabService",void 0),S(this,"layoutService",void 0),S(this,"styleService",void 0),S(this,"configService",void 0),S(this,"visibilityService",void 0),S(this,"annotationEditService",void 0),S(this,"cropBoxEditService",void 0),S(this,"perspectiveQuadEditService",void 0),S(this,"eventsService",void 0),S(this,"dragService",void 0),S(this,"moveService",void 0),S(this,"scrollService",void 0),S(this,"zoomService",void 0),S(this,"slideService",void 0),S(this,"optimizationService",void 0),S(this,"interactionService",void 0),S(this,"selectPagesService",void 0),S(this,"keyboardService",void 0),S(this,"viewerConfig",qe(Lse)),S(this,"postfix",void 0),S(this,"isDestroyed",!1),S(this,"viewportWidth",0),S(this,"viewportHeight",0),S(this,"scrollByCurrentChanged",!1),S(this,"isInitialized",!1),S(this,"addPagesTimer",null),S(this,"isPanning",void 0),S(this,"isZooming",void 0),S(this,"isSliding",void 0),S(this,"isLoadSource",!1),S(this,"isFocused",!1),S(this,"hasBoxRendererModule",!1),S(this,"hasAnnotationModule",!1),this.core=l,this.viewer=u,this.postfix=u.postfix,this.hooks=u.hooks,this.uid=u.uid,this.groupUid=u.groupUid,gn(f,this.viewerConfig),this.styleService=new Hse(this),this.viewService=this.register(new Kse(this,this.hooks)),this.rendererService=this.register(new nre(this,this.hooks)),this.layoutService=new lre(this,this.hooks),this.configService=this.register(new hre(this)),this.tabService=this.register(new jse(this)),this.visibilityService=new $se(this),this.optimizationService=this.register(new vre(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new dre(this)),this.dragService=this.register(new ure(this)),this.moveService=this.register(new fre(this)),this.scrollService=this.register(new pre(this)),this.zoomService=this.register(new gre(this)),this.slideService=this.register(new mre(this)),this.interactionService=this.register(new yre(this,new Cre(this),new bre(this),new _re(this),new Sre(this),new Ere(this))),this.selectPagesService=this.register(new xre(this)),this.keyboardService=this.register(new wre(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents()}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var l;return"visible"===(null===(l=this.viewerConfig)||void 0===l?void 0:l.visibility)}syncViewer(l){const u=l.getActiveTab();if(!u)return;const f=this.tabService.createTab(u.doc);if(f.isDocType){const{width:g,height:m}=this.viewService.getViewportSize();f.updateViewportSize(g,m)}f.currentUid=u.currentUid,f.selectPages([...u.selected]),this.tabService.activateTab(f.uid),this.hooks.syncDocument.emit(f.doc),this.emitPageChangedEvent(f),this.showTab(f),this.emitPageChangedAfterRenderEvent(f)}formatTouches(l){const u=[];let f=null;f=l instanceof MouseEvent||l instanceof PointerEvent?[l]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?l.changedTouches:l.touches;const{x:g,y:m}=this.rendererService.getCanvasPosition();for(let v=0;v<f.length;v++){const y=f[v];u.push({pageX:y.pageX-g,pageY:y.pageY-m})}return u}getPointerOverPageInfo(l,u){return function(g,m,v){const y={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(g)for(let x=0;x<g.pages.length;x++){const w=g.pages[x],C=xF(w,m,v,w.isVisible);if(C.isOver){y.index=x,Object.assign(y.pageInfo,C);const _=xF(w.image,m,v,!0);return _.isOver&&Object.assign(y.imageInfo,_),y}}return y}(this.getActiveTab(),l,u)}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const l=this.getActiveTab();l&&this.showTab(l,!0)}updateViewportSize(){const{width:l,height:u}=this.viewService.getViewportSize();this.viewportWidth=l,this.viewportHeight=u,this.tabService.updateViewportSize(l,u)}handleViewerModeChanged(){const{postfix:l,viewService:u,isDefaultViewer:f,isPerspectiveViewer:g,isThumbnailViewer:m}=this;if(f||g||m){u.createMainAndThbContainer(l),u.createMainContainer(l),m||u.createThumbnailContainer(l),f&&(u.createVideoContainer(l),u.createAudioContainer(l)),lT(u.mainAndThbContainer,"flex");const{width:v,height:y}=u.getViewportSize();this.rendererService.initRenderer(u.canvasContainer,v,y),this.rendererService.updateCanvasSize()}}loadSource(l){const u=this.getActiveTab();let f=null==u?void 0:u.uid;if(!u){const g=this.core.createDocument({name:sF(),type:"document"});this.viewer.openDocument(g),f=g.uid}return this.core.loadSource(l,f,{exception:"ignore"})}openDocument(l){const{tabService:u}=this;let f=u.getTab(l.uid);if(!f){const g=u.getActiveTab();if(g&&this.hooks.closeDocument.emit(g.doc),f=u.createTab(l),f.isDocType){const{width:m,height:v}=this.viewService.getViewportSize();f.updateViewportSize(m,v)}}f.isActive||(this.tabService.activateTab(f.uid),this.emitPageChangedEvent(f),this.showTab(f),this.hooks.openDocument.emit(l),this.emitPageChangedAfterRenderEvent(f))}closeTabs(l){const u=l.filter(m=>this.tabService.hasTab(m));if(!u.length)return;u.reduce((m,v,y)=>{const x=this.tabService.getTab(v);return x&&m.push(x),m},[]).forEach(m=>{m.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(m.uid),this.hooks.closeDocument.emit(m.doc)});const g=this.tabService.getActiveTab();g?this.showTab(g):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(M0.create(-1,0)))}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas())}render(){if("hidden"===this.viewerConfig.visibility||this.isDestroyed)return;const l=this.getActiveTab();l&&this.rendererService.render(l)}showCurrentTab(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.getActiveTab();null!=u&&u.total&&this.showTab(u,l)}showTab(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||l.isDestroyed||(this.tabService.activateTab(l.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(l,u):this.isThumbnailViewer?this.showTabThumbnail(l,u):this.isPerspectiveViewer&&this.showTabPerspective(l)))}showTabDefault(l){const u=l;if(!u.isDocType)return;u.style.visibility="visible";const f=u.context.zoom;this.layoutService.layout(u),this.viewerConfig.zoom=u.context.zoom;const g=u.context.zoom!==f;if(this.viewService.updateScrollerContentSize(u),this.rendererService.updateCanvasSize(),!u.total)return void this.rendererService.render(u);const{scrollLeft:m,scrollTop:v}=u.context.parseReferenceDefault();u.context.setTabScrollValue(m,v),this.viewService.scrollTo(m,v),this.visibilityService.handleVisibility(u),this.loadVisiblePages(u),g&&this.clearCurrentTabOptimization(),this.rendererService.render(u),this.emitZoomChangedEvent(u)}showTabPerspective(l){const u=l;if(!u.isDocType)return;if(u.style.visibility="visible",this.layoutService.layout(u),this.viewService.updateScrollerContentSize(u),this.rendererService.updateCanvasSize(),!u.total)return void this.rendererService.render(u);const{scrollLeft:f,scrollTop:g}=u.context.parseReferenceDefault();u.context.setTabScrollValue(f,g),this.viewService.scrollTo(f,g),this.visibilityService.handleVisibility(u),this.loadVisiblePages(u),this.rendererService.render(u)}showTabThumbnail(l){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!l.isDocType)return;if(l.style.visibility="visible",this.layoutService.layout(l),this.viewService.updateScrollerContentSize(l),this.rendererService.updateCanvasSize(),!l.total)return void this.rendererService.render(l);if(l.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:m,scrollTop:v}=l.context.getScrollValuesByCurrentChanged();l.context.setTabScrollValue(m,v)}const{scrollLeft:f,scrollTop:g}=l.context;this.viewService.scrollTo(f,g),this.visibilityService.handleVisibility(l),this.loadVisiblePages(l),u&&this.clearCurrentTabOptimization(),this.rendererService.render(l)}loadPageImage(l){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(l):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(l):null}loadVisiblePages(l){if(l.isDestroyed||null==l||!l.total)return;const u=[],f=[],g=l.getCurrentPage();let m=!1;l.pages.forEach(y=>{!y.isPreload||y.isLoaded||y.isLoading||(y.uid===(null==g?void 0:g.uid)?m=!0:y.isVisible?f.push(y):y.isPreload&&u.push(y))});const v=[];m&&v.push(g),v.push(...u.reverse(),...f.reverse()),v.forEach(y=>{!y.isPreload||y.isLoaded||y.isLoading||(y.isLoading=!0,this.loadPageImage(y.uid).then(x=>{y.isLoading=!1,x&&this.renderPage(l,y,x)}).catch(x=>{y.isLoading=!1}))})}renderPage(l,u,f){if(!this.isDestroyed&&this.isVisible&&l.isActive&&l.pages.includes(u)&&!l.isDestroyed&&u.isPreload&&(u.isLoaded=!0,u.setImgDom(f),u.isVisible)){if(this.isDefaultViewer&&l.context.isSingleDisplay){const g=l.getCurrentPage();if(g&&!g.isLoaded)return}this.rendererService.render(l)}}emitPageChangedEvent(l){this.hooks.pageChanged.emit(M0.create(l.current,l.total))}emitPageChangedAfterRenderEvent(l){this.hooks.pageChangedAfterRender.emit(M0.create(l.current,l.total))}emitZoomChangedEvent(l){const{oldZoom:u,zoom:f}=l.context;this.hooks.zoomChanged.emit(DE.create(Cp(u),Cp(f)))}beforeLoadSource(l){this.isLoadSource=!0;const{tabService:u}=this,f=u.getDocTab(l);f&&f.updateOldInfo()}afterLoadSource(l){this.isLoadSource=!1;const{tabService:u}=this,f=u.getDocTab(l);f&&(this.emitPageChangedEvent(f),this.emitPageChangedAfterRenderEvent(f),f.updateOldInfo())}addPages(l,u,f,g){const{tabService:m}=this,v=m.getDocTab(l);v&&(v.appendPages(u,f,g),this.emitPageChangedEvent(v),v.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout(()=>{v.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(v)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null},200)))}deletePages(l,u){const{tabService:f}=this,g=f.getDocTab(l);g&&(this.clearOptimization(u),g.deletePages(u),this.hooks.deletePages.emit(k0.create(u)),this.emitEventsForTab(g))}deleteAllPages(l){const{tabService:u}=this,f=u.getDocTab(l);if(!f)return;const g=f.pages.map(m=>m.uid);this.clearOptimization(g),f.deleteAllPages(),this.hooks.deletePages.emit(k0.create(g)),this.emitEventsForTab(f)}setCurrentPage(l,u){const{tabService:f}=this,g=f.getDocTab(l);g&&g.current!==u&&(g.gotoPage(u),this.emitEventsForTab(g))}selectPages(l,u){const{tabService:f}=this,g=f.getDocTab(l);if(!g)return;const m=g.getSelected(),v=g.getSelectedIndices();let y=!1;if(v.length!==u.length)y=!0;else for(let w=0;w<u.length;w++)if(v[w]!==u[w]){y=!0;break}if(!y)return;const x=g.indicesToUids(u);if(g.selectPages(x),g.isActive){this.showTab(g);const w=SE.create(v,[...u],[...m],x);this.hooks.selectedPageChanged.emit(w),this.viewer.emit("selectedPagesChanged",w)}}movePages(l,u,f){const g=this.tabService.getDocTab(l);g&&(g.movePages(u,f),this.emitEventsForTab(g,this.isDefaultViewer))}switchPage(l,u,f){const g=this.tabService.getDocTab(l);g&&(g.switchPage(u,f),this.emitEventsForTab(g,this.isDefaultViewer))}reorderPages(l,u){const f=this.tabService.getDocTab(l);f&&(f.reorderPages(u),this.emitEventsForTab(f,this.isDefaultViewer))}emitEventsForTab(l,u){l.isActive&&(this.emitPageChangedEvent(l),this.scrollByCurrentChanged=!0,this.showTab(l,u),this.emitPageChangedAfterRenderEvent(l))}updatePage(l,u,f){const g=this.tabService.getTab(l);if(g&&g.isActive){const m=g.getPageByUid(u);m.isLoaded=!1,m.isLoading=!1,this.clearOptimization([u]),this.showTab(g)}}renameDoc(l,u){const{tabService:f}=this,g=f.getTab(l);g&&(g.rename(u),this.hooks.tabChanged.emit())}filter(l,u,f){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const g=this.getActiveTab();g&&g.uid===l&&(u.forEach(m=>{const v=g.getPageByUid(m);v&&(v.isLoaded=!1)}),this.hooks.filterChanged.emit(Sx.create(l,u,f)),this.loadVisiblePages(g),this.clearOptimization(u),this.rendererService.render(g))}activateTab(l){const u=this.tabService.getTab(l);return!!u&&(this.showTab(u),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach(l=>{const u=[];if(l.pages.forEach((f,g)=>{f.isPreload&&u.push({from:!0,to:!1,pageUid:f.uid,index:g})}),u.length){const f=Ax.create(l.uid,this.uid,this.viewerConfig.viewerMode,u);this.core.viewerService.onPagePreloadChanged.emit(f)}}),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose()}get isDefaultViewer(){return this.viewerConfig.viewerMode===Rn.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===Rn.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===Rn.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===Rn.CAPTURE}zoomTo(l,u,f){this.zoomService.zoomTo(l,u,f)}getPageRenderSize(l){const u=this.core.pageService.getPage(l);return this.isPerspectiveViewer?u.raw.getPageSize():u.mediaBox}emit(l,u){this.viewer.emit(l,u)}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const l=this.getActiveTab();if(l){const u=l.pages.map(f=>f.uid);this.clearOptimization(u)}}clearOptimization(l){const u=[],f=this.getActiveTab();f&&l.forEach(g=>{const m=f.getPageByUid(g);m&&(u.push(m.optimizationUid),m.clearOptimization())}),u.forEach(g=>{this.optimizationService.cancelOptimization(g)})}}class Dre extends mi{constructor(l){super(),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"group",void 0),S(this,"postfix",void 0),S(this,"context",void 0),S(this,"emitter",void 0),S(this,"hooks",void 0),S(this,"core",void 0),S(this,"isDisposed",!1),this.emitter=new cl,l.core&&(this.core=l.core),this.uid=qt(),this.groupUid=l.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new Xne),this.context=new Tre(this.core,this,l.viewerConfig),l.container&&!l.uiConfig&&this.context.viewService.bindContainer(l.container),this.listenGlobalEvents()}listenGlobalEvents(){const{documentService:l,viewerService:u}=this.core,{context:f}=this;this.core.onBeforeLoadSource.on(g=>{let{docUid:m}=g;f.beforeLoadSource(m)},this),this.core.pageService.onUpdatePage.on(g=>{f.updatePage(g.docUid,g.pageUid,g.data),f.hooks.updatePage.emit(g)},this),l.onPagesAdded.on(g=>{f.afterLoadSource(g.docUid),f.hooks.addPagesToDoc.emit(g)},this),l.onAddPagesToDoc.on(g=>{const{group:m}=this;let{scrollToLatest:v}=m.config;Se(v)&&({scrollToLatest:v}=f.viewerConfig),f.addPages(g.docUid,g.pageUids,v,g.index)},this),l.onDeletePagesFromDoc.on(g=>{f.deletePages(g.docUid,g.pageUids)},this),l.onDeleteAllPagesFromDoc.on(g=>{f.deleteAllPages(g.docUid)},this),l.onMovePages.on(g=>{f.movePages(g.docUid,g.indices,g.insertBeforeIndex)},this),l.onSwitchPage.on(g=>{f.switchPage(g.docUid,g.one,g.another)},this),l.onReorderPages.on(g=>{f.reorderPages(g.docUid,g.indices)},this),l.onBeforeDeleteDocs.on(g=>{f.closeTabs(g.docUids)},this),l.onDocumentRenamed.on(g=>{f.renameDoc(g.docUid,g.newName)},this),l.onDocumentDeleted.on(g=>{f.closeTabs([g.docUid])},this),l.onOpenDocument.on(g=>{f.groupUid===g.groupUid&&f.openDocument(g.doc)},this),l.onCloseDocument.on(g=>{f.groupUid===g.groupUid&&f.closeTabs([g.doc.uid])},this),u.onGotoPage.on(g=>{f.groupUid===g.groupUid&&f.setCurrentPage(g.docUid,g.index)},this),u.onSelectPages.on(g=>{f.groupUid===g.groupUid&&f.selectPages(g.docUid,g.indices)},this),u.onResize.on(()=>{f.resize()},this),u.onCurrentChangedByScroll.on(g=>{f.groupUid===g.groupUid&&f.uid!==g.viewerUid&&f.setCurrentPage(g.docUid,g.current)},this),this.core.onFilterChanged.on(g=>{const m=f.getActiveTab();(null==m?void 0:m.uid)===g.docUid&&f.filter(g.docUid,g.pageUids,g.filterType)},this),this.core.commandService.onOperationsChanged.on(g=>{const m=f.getActiveTab();m?m.uid===g.docUid&&f.hooks.operationsChanged.emit(g):this.hooks.operationsChanged.emit({docUid:g.docUid,undo:0,redo:0})},this)}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose())}undo(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.undo(l.uid)}redo(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.redo(l.uid)}getOperationState(){const l=this.context.getActiveTab();return l?this.core.commandService.getOperationState(l.uid):{undo:0,redo:0}}saveOperations(){const l=this.context.getActiveTab();return!!l&&this.core.commandService.saveOperations(l.uid)}setRowAndColumn(l,u){return this.context.configService.updateConfig({rows:l,columns:u}),!0}getRowAndColumn(){const l=this.context.getActiveTab();if(l)return{rows:l.context.rows,columns:l.context.columns};const{viewerConfig:u}=this.context;return{rows:u.rows||1,columns:u.columns||1}}on(l,u){this.emitter.on(l,u)}emit(l,u){this.emitter.emit(l,u)}off(l,u){this.emitter.off(l,u)}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(l){this.context.configService.updateConfig(l)}bindContainer(l){return this.context.viewService.bindContainer(l)}unbindContainer(){this.context.viewService.unbindContainer()}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab()}hide(){this.updateViewerConfig({visibility:"hidden"})}render(){}resize(){this.context.resize()}indexToUid(l){const u=this.context.getActiveTab();return null==u?void 0:u.indexToUid(l)}uidToIndex(l){const u=this.context.getActiveTab();return u?u.uidToIndex(l):-1}getCurrentPageIndex(){const l=this.context.getActiveTab();return l?l.current:-1}getPageCounts(){const l=this.context.getActiveTab();return l?l.total:0}getCurrentPageUid(){var l;const u=this.context.getActiveTab();return null==u||null===(l=u.getCurrentPage())||void 0===l?void 0:l.uid}selectAllPages(){const l=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(l).keys()))}selectPagesByIndices(l){const u=this.context.getActiveTab();if(!u)return[];const f=u.indicesToUids(l);return this.core.viewerService.onSelectPages.emit(YE.create(u.uid,this.groupUid,this.uid,l)),[...f]}getSelectedPageIndices(){const l=this.context.getActiveTab();return l?l.getSelectedIndices():[]}gotoPage(l){const u=this.context.getActiveTab();return u?(l=Pi(l,0,u.total-1),u.current===l||this.core.viewerService.onGotoPage.emit($E.create(u.uid,this.groupUid,this.uid,l)),l):-1}movePages(l,u){const f=this.context.getActiveTab();return!!f&&this.core.movePages(f.uid,l,u)}swapPages(l,u){const f=this.context.getActiveTab();return!!f&&this.core.swapPages(f.uid,l,u)}reorderPages(l){const u=this.context.getActiveTab();return!!u&&this.core.reorderPages(u.uid,l)}deletePages(l){const u=this.context.getActiveTab();if(!u||!l.every(g=>g>=0&&g<u.total))return!1;const f=u.indicesToUids(l);return this.core.deletePages(u.uid,f)}deleteAllPages(){const l=this.context.getActiveTab();return!!l&&this.core.deleteAllPages(l.uid)}openDocument(l){this.core.openDocument(l.uid,this.uid)}closeDocument(l){if(!l){const u=this.context.getActiveTab();if(!u)return;l=u.uid}this.core.closeDocument(l,this.uid)}printDocument(){}activateTab(l){var u;return(null===(u=this.context)||void 0===u?void 0:u.activateTab(l))||!1}getActiveTab(){var l;return(null===(l=this.context)||void 0===l?void 0:l.getActiveTab())||null}getAllTabs(){var l;return(null===(l=this.context)||void 0===l?void 0:l.tabService.getAllTabs())||[]}getRealPageSize(l){const u=this.context.getActiveTab();if(!u)return{width:0,height:0};Se(l)&&(l=u.current);const f=u.getPageByIndex(l);return{width:f.rWidth,height:f.rHeight}}getRealPixelSize(l){const u=this.context.getActiveTab();if(!u)return{width:0,height:0};Se(l)&&(l=u.current);const f=u.getPageByIndex(l),g=this.core.pageService.getPage(f.uid),{rWidth:m,rHeight:v}=g.getEditResultForPerspective();return{width:bt(m,yt.displayResolution,g.resource.resolutionX),height:bt(v,yt.displayResolution,g.resource.resolutionY)}}zoomIn(){const l=this.getActiveTab();if(!l||!l.isDocType)return;const{maxZoom:u}=this.getViewerConfig(),{zoom:f}=l.context;let g=EF(f,"in");(null===g||g>u)&&(g=u),this.updateViewerConfig({zoom:g})}zoomOut(){const l=this.getActiveTab();if(!l||!l.isDocType)return;const{minZoom:u}=this.getViewerConfig(),{zoom:f}=l.context;let g=EF(f,"out");(null===g||g<u)&&(g=u),this.updateViewerConfig({zoom:g})}filter(l,u){const f=this.context.getActiveTab();if(!f)return!1;const g=f.indicesToUids(l);return this.core.filterPages(f.uid,g,u),!1}perspectivePage(l,u){var f=this;return Q(function*(){const g=f.context.getActiveTab();if(!g)return null;let m=g.currentUid;return Se(u)||(m=g.indexToUid(u)),l=bt(l,f.context.core.pageService.getPage(m).resource.resolutionX,yt.displayResolution),(yield f.core.perspectivePage(g.uid,m,l)).data})()}perspectiveAllPage(){const l=this.context.getActiveTab();if(!l)return;const u=[],f=[],g=[];l.pages.forEach((y,x)=>{y.isVisible?u.push(x):y.isPreload?f.push(x):g.push(x)});const m=[...u,...f,...g],{displayResolution:v}=yt;for(let y=0;y<m.length;y++){const x=this.indexToUid(m[y]),w=this.context.core.pageService.getPage(x);if(w.isFull){let{width:C,height:_}=w.raw.getImageDetail();const T=Math.abs((w.rotation%360+360)%360);if(90===T||270===T){const L=C;C=_,_=L}this.context.core.perspectivePage(l.uid,x,bt([[0,0],[C,0],[C,_],[0,_]],w.resolutionX,v))}else if(w.activeQuad&&w.activeQuad!==w.quad){const{width:C,height:_}=w.raw.getPageSize(),T=tT(w.activeQuad.flat(),w.rotation,C,_),M=Ix(T);this.context.core.perspectivePage(l.uid,x,M)}}}getPerspectivePreviewImage(l,u,f,g){const m=this.context.getActiveTab();if(!m)return null;const v=m.getPageByIndex(l);if(!v)return null;const y=v.uid,{quadSelectionStyle:x}=this.getViewerConfig(),{borderColor:w}=n0(x.border),C=function(_){const T=M=>{const L=M.toString(16);return 1===L.length?`0${L}`:L};if(_.startsWith("rgb")){const M=_.match(/(\d+)/g);if(3===M.length){const L=parseInt(M[0],10),N=parseInt(M[1],10),V=parseInt(M[2],10);return`#${T(L)}${T(N)}${T(V)}`}}return!_.startsWith("#")||7!==_.length&&4!==_.length?"#FE8E14":_}(w);return this.context.core.getPerspectivePreviewData(y,{width:u||200,height:f||200},{strokeColor:C.substring(1),lineWidth:g})}}function EF(p,l){const u=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===l){for(let f=0;f<u.length;f++)if(u[f]>p)return u[f]}else for(let f=u.length-1;f>=0;f--)if(u[f]<p)return u[f];return null}class Are extends mi{constructor(l){super(),S(this,"isDestroyed",!1),S(this,"viewers",new Map),S(this,"groups",new Map),S(this,"onGotoPage",void 0),S(this,"onSelectPages",void 0),S(this,"onCurrentChangedByScroll",void 0),S(this,"onResize",void 0),S(this,"onPagePreloadChanged",void 0),S(this,"onViewerCreated",void 0),S(this,"core",void 0),this.core=l,this.initEventEmitter()}initEventEmitter(){this.onGotoPage=Re(this),this.onSelectPages=Re(this),this.onCurrentChangedByScroll=Re(this),this.onResize=Re(this),this.onPagePreloadChanged=Re(this),this.onViewerCreated=Re(this)}reset(){for(const l of this.viewers.values())l.dispose();this.viewers.clear(),this.groups.clear()}destroy(){if(!this.isDestroyed){for(const l of this.viewers.values())l.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0}}createViewer(l,u){var f;const{groupUid:g}=u,m=this.groups.get(g)||new Yne(g);var v;Se(null===(f=u.viewerConfig)||void 0===f?void 0:f.scrollToLatest)||m.isSetScrollToLatest||(m.updateConfig({scrollToLatest:null===(v=u.viewerConfig)||void 0===v?void 0:v.scrollToLatest}),m.isSetScrollToLatest=!0),u.groupConfig&&m.updateConfig(u.groupConfig);const y=new l(u);y.group=m,m.viewerUids.add(y.uid),this.groups.set(g,m),this.viewers.set(y.uid,y);const x=this.getViewersByGroupUid(g);if(x.length>0){y.context.syncViewer(x[0]);const w=x[0].getActiveTab();w&&this.core.commandService.emitOperationsChanged(w.uid)}return this.onViewerCreated.emit(QE.create(y)),y}removeViewer(l){let u;if(u=nt(l)?this.getViewer(l):l,!u)return!1;const{uid:f,groupUid:g}=u,m=this.groups.get(g);return m&&(m.viewerUids.delete(f),m.viewerUids.size||this.groups.delete(g)),this.viewers.delete(u.uid),u.dispose(),!0}hasViewer(l){return this.viewers.has(l)}getViewer(l){return this.viewers.get(l)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(l){const u=this.viewers.get(l);return this.getViewersByGroupUid(u.groupUid)}getViewersByGroupUid(l){return this.groups.has(l)?this.groups.get(l).getViewerUids().map(u=>this.viewers.get(u)):[]}hasGroup(l){return this.groups.has(l)}}const Ire={apply(p){p.viewerService=new Are(p)},install(p){p.setClass("Viewer",Dre)}},Pre=/^<\/([^>]*)>/,Rre=/^<([^\s>]+)[^>]*>/,Mre=/^<slot>.*<\/slot>/,kre=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function dT(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:u,data:f,components:g,injection:m}=p,v=TF(u,f,g,m,l),y=v.length;return y&&(v[0].cpInstance=p,v[y-1].cpInstance=p),v}function TF(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],m=p.trim();const v=[];function y(_){m=m.substring(_)}function x(_){let[T,M]=_;if(M){const L=function(H){const G={},z=y9(H,kre);return z&&z.forEach(q=>{let[,te,se]=q;G[te]=se}),G}(T),N=l[":for"];N&&(delete l[":for"],L[":for"]=N);const V={type:"start",name:M,data:l,attrs:L};v.push(V),(u[M]||f.components&&f.components[M])&&(V.cpOption={Component:u[M]||f.components[M],injection:f}),("input"===M||/\/>/.test(T))&&v.push({type:"end",name:M,data:l,attrs:{}})}}function w(_){let[,T]=_;T&&v.push({type:"end",name:T,attrs:{}})}function C(_){(_=_.trim())&&v.push({type:"text",name:_,attrs:{},data:l})}for(;m;){const _=m.indexOf("<");let T;if(0===_){const M=m.match(Pre);if(M){y(M[0].length),w(M);continue}const L=m.match(Mre);if(L){y(L[0].length),v.push(...g);continue}const N=m.match(Rre);if(N&&N[0]!==N.input){y(N[0].length),x(N);continue}T=m}else T=_>0?m.substring(0,_):m;T&&(y(T.length),C(T))}return v}function Mx(p){const{cpInstance:l,children:u}=p;l&&!l.isInserted&&(l.isInserted=!0,l.hooks.inserted.emit()),u.forEach(f=>{Mx(f)})}function uT(p){const{cpInstance:l,children:u}=p;l&&l.hooks.destroyed.emit(p),u.forEach(f=>{uT(f)})}function fT(p){if(p){const{el:l,children:u}=p;if(function(f){const{cpInstance:g}=f;g&&(g.dispose(),g.hooks.beforeDestroyed.emit(f))}(p),l){const f=l.parentElement;f&&f.removeChild(l),l.vNode=null,p.el=null}return uT(p),p.text=null,p.parent=null,u.length&&u.forEach(f=>{fT(f)}),!0}return!1}class kx{constructor(l){S(this,"el",void 0),S(this,"tagName",void 0),S(this,"sel",""),S(this,"data",void 0),S(this,"children",void 0),S(this,"text",void 0),S(this,"key",void 0),S(this,"cpInstance",void 0),S(this,"cpOptions",void 0),S(this,"parent",void 0),this.createVNode(l)}renderDom(){if(this.el)return this.el;let l;if("FRAGMENT"===this.tagName)l=document.createDocumentFragment();else if("TEXT"===this.tagName){const u=function(f){let g="";return 0===(f=String(f)).length?"":(g=f.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"'),g)}(this.text);l=document.createTextNode(u)}else{l=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[u,f]of Object.entries(this.data))l.setAttribute(u,f)}return this.children.forEach(u=>{const f=u.renderDom();l.appendChild(f)}),l.vNode=this,this.el=l,function(u){const{cpInstance:f,el:g}=u;f&&(f.vNode=u,f.hooks.created.emit(g))}(this),l}patch(l){return function Ore(p,l){const u=p.el,f=u.parentNode;null!==f&&(l.el=l.renderDom(),f9(l.el,u,f),function(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;y<=x;)fT(v[y]),y+=1}([p]));let g=-1;const m=p.parent;return null==m||m.children.forEach((v,y)=>{v===p&&(g=y)}),g>-1&&(m.children[g]=l,l.parent=m,p.el=null),l}(this,l)}destroy(){return fT(this)}createVNode(l){const{tagName:u,data:f={},children:g=[],el:m=null,key:v,text:y="",cpOptions:x,cpInstance:w}=l;let C=u;f.id&&(C+=`#${f.id}`),f.class&&(C+=`.${f.class}`),this.sel=C,this.data=f,this.tagName=u,this.children=g,this.el=m,this.key=v,this.text=y,this.cpInstance=w,this.cpOptions=x}}function Ox(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=[],f=[];let g=[];return p.forEach(m=>{if("start"===m.type)u.push(m),f.push(g),g=[];else if("text"===m.type)g.push({type:"text",value:m.name,data:m.data});else if(m instanceof kx)g.push(m);else{let v=u.pop();for(;v.name!==m.name;)v=u.pop();if(v){const{name:y,cpInstance:x,attrs:w,cpOption:C,data:_}=v,T={type:"token",tagName:y,cpInstance:x,cpOption:C,attrs:w,data:_,children:g};g.forEach(M=>{M.parent=T}),g=f.pop(),g.push(T)}}}),l?g[0]:g}const Lre=/'.+'|\\".+\\"|[\w$.]+/g,Fre=/{{([^\s@}]+)}}/;function Qd(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Xt(p)){const f=[];return p.forEach(g=>{f.push(...Lx(Qd(g)))}),f}if(p instanceof kx)return p;if("token"===p.type){var u;const{tagName:f,attrs:g,cpInstance:m,children:v,data:y,cpOption:x}=p;if(g[":for"])return function(T){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:L,data:N}=T,V=JSON.parse(JSON.stringify(L)),H={":for":L[":for"]};delete L[":for"],DF(H,ne(ne({},N),M));const G=[];return H[":for"].forEach(z=>{const q=Qd(T,z);G.push(...Lx(q))}),T.attrs=V,G}(p,l);const w=ne(ne({},y),l),C=ne({},g);let _;if(DF(g,w),Object.prototype.hasOwnProperty.call(g,"if")&&!g.if)_=null;else if(delete g.if,x)_=function(T){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:L,attrs:N,cpOption:V}=T,H=AF(L,M),{Component:G,injection:z}=V,q=new G({data:N,injection:z}),te=Ox(dT(q,H));return te?Lx(Qd(te))[0]:null}(p,l);else{const{key:T}=g;void 0!==T&&delete g.key;const M=AF(v,l);_=new kx({tagName:f.toUpperCase(),data:g,cpInstance:m,key:T,children:M})}return p.attrs=C,null===(u=_)||void 0===u||u.children.forEach(T=>{T.parent=_}),_}return function(f){var g;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:v}=f;const y=null===(g=f.parent)||void 0===g||null===(g=g.attrs)||void 0===g?void 0:g.html;return v=function(x,w){const C=y9(x,Fre);return C.length&&C.forEach(_=>{const T=_[1].split(".").reduce((L,N)=>L[N],w);x=x.replace(_[0],T)}),x}(v.trim(),ne(ne({},f.data),m)),y?Qd(Ox(TF(v),!1)):new kx({tagName:"TEXT",text:v})}(p,l)}function DF(p,l){for(const g of Object.keys(p)){const[,m,v]=g.match(/^(:|@)(.+)/)||[];if(!v)continue;let y=p[g];if(delete p[g],"for"===v){var u,f;let[x,w]=y.split(" in "),[C,_]=x.split(",");C=C.trim(),_=null===(u=_)||void 0===u?void 0:u.trim(),w=null===(f=w)||void 0===f?void 0:f.trim();const T=[],M=w.split(".").reduce((L,N)=>L[N],l);if(Xt(M))M.forEach((L,N)=>{const V={};V[C]=L,_&&(V[_]=N),T.push(V)});else if(vt(M))for(const[L,N]of Object.entries(M)){const V={};V[C]=N,_&&(V[_]=L),T.push(V)}p[":for"]=T}else{const x="this"===y?l:y.split(".").reduce((w,C)=>null==w?void 0:w[C],l);if(void 0!==x)p[v]="class"===v&&p[v]?`${p[v]} ${x}`:x;else{y=y.replace(Lre,w=>w.includes('"')||w.includes("'")||/^(true|false|\d+|undefined|null)$/.test(w)?w:w.split("."));try{const w=Nre(y,l);tr(w)&&(p[v]=void 0),p[v]="class"===v&&p[v]?`${p[v]} ${w}`:w}catch(w){p[v]=void 0}}"@"===m&&(p.events||(p.events={}),p.events[v]=p[v],delete p[`@${v}`])}}}function Lx(p){return p?(Xt(p)||(p=[p]),p):[]}function AF(p){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=[];return p.forEach(f=>{const g=Qd(f,l)||[];u.push(...Lx(g))}),u}function Nre(p,l){let u=null;try{const f=p.split(",");for(let g=0;g<f.length;g++){const y=f[g].match(/(\w+)(\[(\d+)\])?/);if(!y){l=null;break}{const x=y[1],w=y[3];if(!Object.prototype.hasOwnProperty.call(l,x)){l=null;break}l=l[x],void 0!==w&&Array.isArray(l)&&(l=l[w])}}u=l}catch(f){u=null}return u}class Mn extends mi{constructor(l){let{data:u={},template:f="",components:g={},injection:m={}}=l;super(),S(this,"el",void 0),S(this,"vNode",null),S(this,"template",""),S(this,"data",{}),S(this,"injection",{}),S(this,"components",{}),S(this,"emitter",void 0),S(this,"uiEmitter",void 0),S(this,"isInserted",!1),S(this,"hooks",{created:Sn.create(),inserted:Sn.create(),updated:Sn.create(),beforeDestroyed:Sn.create(),destroyed:Sn.create()}),S(this,"selfEvents",[]),S(this,"globalEvents",[]),S(this,"nativeEvents",[]),this.template=f,this.emitter=cl.create(),this.setData(u),this.setComponents(g),this.setInjects(m),this.uiEmitter=this.injection.emitter,this.hooks.created.on(v=>{this.el=v}),this.hooks.destroyed.on(()=>{this.dispose()}),this.initEvents()}setInjects(l){Object.assign(this.injection,l)}initEvents(){var l=this;const u=(m,v)=>{this.on(m,function(){for(var y=arguments.length,x=new Array(y),w=0;w<y;w++)x[w]=arguments[w];nt(v)?l.$emit(v,x):Zf(v)&&v(...x)})};for(const[m,v]of Object.entries((null===(f=this.data)||void 0===f?void 0:f.events)||{})){var f;u(m,v)}for(const[m,v]of Object.entries((null===(g=this.data)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.events)||{})){var g;u(m,v)}}setData(l){Object.assign(this.data,l)}setComponents(l){Object.assign(this.components,l)}on(l,u){this.emitter.on(l,u),this.selfEvents.push([l,u])}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];this.emitter.emit(l,...f)}unbindSelfEvents(){this.selfEvents.forEach(l=>{let[u,f]=l;this.emitter.off(u,f)}),this.selfEvents=[]}$on(l,u){var f;this.uiEmitter&&(null===(f=this.uiEmitter)||void 0===f||f.on(l,u),this.globalEvents.push([l,u]))}$emit(l){for(var u,f=arguments.length,g=new Array(f>1?f-1:0),m=1;m<f;m++)g[m-1]=arguments[m];null===(u=this.uiEmitter)||void 0===u||u.emit(l,...g)}unbindGlobalEvents(){this.globalEvents.forEach(l=>{let[u,f]=l;this.uiEmitter.off(u,f)}),this.globalEvents=[]}nativeOn(l,u,f){if(Xt(l))l.forEach(g=>{this.nativeOn(g,u,f)});else{const g=(v=u,y=f,(m=l)?(m.addEventListener(v,y,void 0),()=>{m.removeEventListener(v,y)}):null);g&&this.nativeEvents.push(g)}var m,v,y}unbindNativeEvents(){this.nativeEvents.forEach(l=>{l()}),this.nativeEvents=[]}query(l){var u;return null===(u=this.el)||void 0===u?void 0:u.querySelector(l)}queryAll(l){var u;return null===(u=this.el)||void 0===u?void 0:u.querySelectorAll(l)}parseHTML(){return Qd(Ox(dT(this,[])))}reRenderVNode(){const l=Qd(Ox(dT(this)));this.vNode.patch(l)}bindEventsEmitter(){var l=this;const{options:u}=this.data;if(null!=u&&u.events)for(const[f,g]of Object.entries(u.events))this.nativeOn(this.el,f,function(){for(var m=arguments.length,v=new Array(m),y=0;y<m;y++)v[y]=arguments[y];l.emit(f,...v)})}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose()}}const Li=(p,l,u,f)=>{const{id:g,tooltip:m,dataId:v,style:y,className:x}=p||{},w=(C=>{let _="";if(C)for(const[T,M]of Object.entries(C))_+=`${Hee(T)}:${M};`;return _})(y);return(Se(g)?"":` id="${g}"`)+` class="${l}${null!=u?u:""} ${x||""}"`+(Se(f)?"":` :class="${f}"`)+(w?` style="${w}"`:"")+(Se(m)?"":` title="${m}"`)+(Se(v)?"":` data-id="${v}"`)};function IF(p){if(0===Object.keys(p).length||!p)return'<MainView :options="this"></MainView>';const l=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==p?void 0:p.type);return nt(p.type)&&!l?`<${p.type} :options="this"></${p.type}>`:'<Root :options="this"></Root>'}function pT(){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const l=qe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=l&&l.children&&(l.children=l.children.map(u=>nt(u)?{type:u}:vt(u)?pT(u):u)),l.children||Xt(l.children)||(l.children=[]),p.length&&l.children.push(...p),l}class Fr{constructor(l){S(this,"options",void 0),S(this,"postfix",void 0),S(this,"uiEvents",[]),S(this,"parsedUiConfig",void 0),S(this,"injection",void 0),S(this,"rootComponent",void 0),S(this,"emitter",null),S(this,"rootDom",null),S(this,"rootVNode",void 0),S(this,"container",void 0),S(this,"uiConfig",{}),S(this,"popupUiConfig",[]);const{container:u,injection:f,postfix:g,uiConfig:m,emitter:v,popupUiConfig:y}=l;this.options=l,this.injection=f,this.uiConfig=m,this.popupUiConfig=y,this.parsedUiConfig=pT(m,y),this.emitter=v||cl.create(),this.postfix=g||`-${qt()}`,nt(u)?this.container=document.getElementById(u):u instanceof HTMLElement&&(this.container=u),this.init()}static registerComponent(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[u,f]of Object.entries(l))Fr.isAlreadyRegistered(u)||(this.components[`DDV${u}`]=f,this.components[u]=f)}static isAlreadyRegistered(l){return!!this.components[l]}static getComponents(){return this.components}init(){const l=new Mn({data:this.parsedUiConfig,template:IF(this.parsedUiConfig),components:Fr.getComponents(),injection:Fe(ne({},this.injection),{components:Fr.getComponents(),postfix:this.postfix,emitter:this.emitter})}),u=l.parseHTML();if(!u)return;const f=u.renderDom();this.rootComponent=l,this.rootVNode=u,this.rootDom=f,this.container&&(this.container.appendChild(f),Mx(this.rootVNode))}updateUiConfig(l){const u=pT(l,this.popupUiConfig),f=new Mn({data:u,template:IF(this.parsedUiConfig),components:Fr.getComponents(),injection:Fe(ne({},this.injection),{components:Fr.getComponents(),postfix:this.postfix,emitter:this.emitter})}).parseHTML(),g=this.rootVNode.patch(f);return this.rootDom=g.el,this.rootVNode=g,this.uiConfig=l,Mx(this.rootVNode),!0}bindContainer(l){let u;if(Jf(l)&&(u=l),nt(l)){const f=document.getElementById(l);Jf(f)&&(u=f)}return!!u&&(this.container=u,u.appendChild(this.rootDom),Mx(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let l=0;l<this.container.children.length;l++)if(this.container.children[l]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null}}queryByDataId(l){var u;return null===(u=this.rootDom)||void 0===u?void 0:u.querySelector(`[data-id=${l}]`)}queryAllByDataId(l){var u;return null===(u=this.rootDom)||void 0===u?void 0:u.querySelectorAll(`[data-id=${l}]`)}getElementsByType(l,u){var f;const g=[];return(null===(f=l.cpInstance)||void 0===f||null===(f=f.constructor)||void 0===f?void 0:f.cpName)===u&&l.el&&g.push(l.el),l.children.length>0&&l.children.forEach(m=>{g.push(...this.getElementsByType(m,u))}),g}on(l,u){const f=this.emitter.on(l,u);this.uiEvents.push(f)}emit(l){for(var u=arguments.length,f=new Array(u>1?u-1:0),g=1;g<u;g++)f[g-1]=arguments[g];this.emitter.emit(l,...f)}off(l,u){this.emitter.off(l,u)}offAllEvents(){this.uiEvents.forEach(l=>{let{name:u,fn:f,context:g,once:m}=l;this.emitter.off(u,f,g,m)})}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},uT(this.rootVNode)}}S(Fr,"components",{});class gT extends Mn{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(l),S(this,"defaultClass","ddv-button"),this.initTemplate(u),this.bindBaseHooks()}bindBaseHooks(){this.hooks.inserted.on(l=>{this.bindEventsEmitter()})}initTemplate(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:u}=this.data,g=`<div ${Li(u,""===l?this.defaultClass:`${this.defaultClass} ${l}`)} >`+(Se(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+"<slot></slot></div>";this.template=g}}class PF extends Mn{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(l),S(this,"defaultClass","ddv-layout"),S(this,"enableScroll",!1),S(this,"showScrollArrow",!0),S(this,"scrollLeftOrTopBtn",void 0),S(this,"scrollRightOrBottomBtn",void 0);const{options:f}=this.data;this.enableScroll=(null==f?void 0:f.enableScroll)||!1,this.showScrollArrow=(null==f?void 0:f.showScrollArrow)||!0,this.initTemplate((null==f?void 0:f.flexDirection)||u),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{mT(this),this.bindCustomScroll()}),this.hooks.updated.on(()=>{mT(this)})}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const l=new ResizeObserver(()=>{this.showScrollArrow&&this.updateCustomScrollButton()});l.observe(this.el),this.hooks.destroyed.on(()=>{l.disconnect()})}initCustomScrollButton(){const l=document.createElement("div"),u=document.createElement("div"),f=150;l.addEventListener("click",()=>{const{scrollLeft:g,scrollTop:m}=this.el;l.classList.contains("ddv-scroll-top")?this.el.scroll(0,m-f):this.el.scroll(g-f,0)}),u.addEventListener("click",()=>{const{scrollLeft:g,scrollTop:m}=this.el;u.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,m+f):this.el.scroll(g+f,0)}),this.el.addEventListener("scroll",g=>{this.showScrollArrow&&this.updateCustomScrollButton()}),this.el.appendChild(l),this.el.appendChild(u),this.scrollLeftOrTopBtn=l,this.scrollRightOrBottomBtn=u,this.updateCustomScrollButton()}updateCustomScrollButton(){const{vertical:l,horizontal:u}=RF(this.el),{scrollLeft:f,scrollTop:g}=this.el,{scrollRightOrBottomBtn:m,scrollLeftOrTopBtn:v}=this;if(!v||!m)return;if(!l&&!u)return v.style.display="none",void(m.style.display="none");v.className="ddv-scroll-button "+(u?"ddv-scroll-left":"ddv-scroll-top"),m.className="ddv-scroll-button "+(u?"ddv-scroll-right":"ddv-scroll-bottom");const y=function(x){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:C,horizontal:_}=RF(x);if(!C&&!_)return[!1,!1];const{scrollLeft:T,scrollTop:M,scrollHeight:L,scrollWidth:N,clientWidth:V,clientHeight:H}=x;return _?[T<=w,T+V-w>=N]:[M<=w,M+H-w>=L]}(this.el,0);u?(v.style.left=`${f}px`,m.style.right=-f+"px"):(v.style.top=`${g}px`,m.style.bottom=-g+"px"),v.style.display=y[0]?"none":"",m.style.display=y[1]?"none":""}initTemplate(l){const{options:u}=this.data,f=(null==u?void 0:u.children)||[];let m=`${this.defaultClass}${"row"===l?"":"-col"}`;this.enableScroll&&(m+=" ddv-custom-scroll-hidden");let v=`<div ${Li(u,m)}>`;f&&f.length&&f.forEach((y,x)=>{if(vt(y)){const{type:w}=y;w.trim(),w.length>0&&(v+=`<${w} :options="options.children[${x}]"></${w}>`)}}),v+="</div>",this.template=v}}function mT(p){const{options:l}=p.data,u=p.el.children;((null==l?void 0:l.children)||[]).forEach((f,g)=>{if(Jf(f)){const m=f;0===g?(p.el.append(m),p.el.insertBefore(m,u[0])):((v,y)=>{const x=y.parentNode;x.lastChild===y?x.appendChild(v):f9(v,y.nextSibling,x)})(m,u[g-1])}})}function RF(p){let l=p.scrollHeight>p.clientHeight,u=p.scrollWidth>p.clientWidth;return l&&u&&(p.scrollHeight-p.clientHeight>p.scrollWidth-p.clientWidth?u=!1:l=!1),{vertical:l,horizontal:u}}class MF extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks()}initTemplate(){const{options:l}=this.data,{children:u}=l;let g=`<div ${Li(l,"column"===l.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass,"")} >`;u&&u.length&&u.forEach((m,v)=>{if(vt(m)){const{type:y}=m;y.trim(),y.length>0&&(g+=`<${y} :options="options.children[${v}]"></${y}>`)}}),g+="</div>",this.template=g}bindHooks(){this.hooks.inserted.on(()=>{mT(this)})}}class kF extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.updateClassName()}),this.hooks.updated.on(()=>{this.isInserted&&this.updateClassName()})}updateClassName(){const u=window.getComputedStyle(this.el.parentNode),{flexDirection:f}=u;"column"===f&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"))}initTemplate(){const{options:l}=this.data,u=Li(l,this.defaultClass);this.template=`<div ${u}></div>`}}const Kd={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"};function OF(p,l,u){const f=g=>{const m=(parseFloat(g.value)-l)/(u-l)*100;p.style.backgroundSize=`${m}% 100%`};f(p),p.oninput=g=>{f(p)},p.onchange=g=>{f(p)}}function vT(p,l){const{bottom:u,height:f}=p.parentNode.getBoundingClientRect(),{height:g}=p.getBoundingClientRect(),{bottom:m}=l.getBoundingClientRect();let v=f;return m-u<g&&(v=-g),v}function Fx(p){p.$on("ui_hidePopup",l=>{l!==p&&Zf(null==p?void 0:p.togglePopup)&&(null==p||p.togglePopup(!1))})}function N0(p){p.$on("ui_cropClick",l=>{const{viewer:u}=p.injection,f=u.getPageCounts()||0;(l||f)&&bl(p.el,l)})}function Nr(p){p.$on("ui_toolModeRefactor",()=>{const{viewer:l}=p.injection,u=l.getPageCounts()||0,{toolMode:f}=l.context.viewerConfig;u&&bl(p.el,"annotation"===f||"crop"===f)})}function bl(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!p)return;const{classList:u}=p,f=u.contains("ddv-button-disabled");l?f||p.classList.add("ddv-button-disabled"):f&&!l&&p.classList.remove("ddv-button-disabled")}function Qo(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!p)return;const{classList:f}=p;let g="ddv-button-activated";"deep"===u?g="ddv-button-activated-deep":"light"===u&&(g="ddv-button-activated-light");const m=f.contains(g);l?m||p.classList.add(g):p.classList.remove(g)}function Oh(p,l,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:m,right:v,bottom:y}=function(ae,j){const le=(j||ae.parentElement).getBoundingClientRect(),ue=ae.getBoundingClientRect();return{top:ue.top-le.top,bottom:le.bottom-ue.bottom,left:ue.left-le.left,right:le.right-ue.right}}(l,p),{x,y:w,width:C}=p.getBoundingClientRect(),{height:_,width:T}=u.getBoundingClientRect(),{x:M,y:L,width:N,height:V}=l.getBoundingClientRect(),H=Dt(getComputedStyle(p).borderWidth);let G=Math.floor(M)-Math.floor(x)-H.value;G<5&&(G=0);const z=C-T,q=G-(Math.floor(T)-Math.floor(N))/2,te=q<5?"0px":`${q}px`;let se=Math.floor(L)-Math.floor(w)-H.value;u.style.left=g&&v>T/2&&m>T/2?te:C<T+5?"0px":v>T?`${G}px`:m>T?G-(Math.floor(T)-Math.floor(N))+"px":v>T/2&&m>T/2?te:z<5?"0px":`${z}px`,y>_?(f&&(se+=2),u.style.top=se+Math.floor(V)-1+"px"):(f&&(se-=4),u.style.top=se-Math.floor(_)+"px")}function Aa(p,l,u){const f=sr.getTooltip(),g=sr.getDisplayTextConfig();null!=u&&u.id||!(p in Kd)||(u.id=Kd[p]+l.postfix),null!=u&&u.tooltip||!(p in f)||(u.tooltip=f[p]),null!=u&&u.displayText&&(u.label=null==u?void 0:u.displayText),null!=u&&u.label||!(p in g)||(u.label=g[p])}function Ia(p){return(null==p?void 0:p.constructor.cpName)||""}function LF(p){const{value:l}=p,{fontSize:u}=getComputedStyle(p),f=document.createElement("div");f.style.position="absolute",f.style.left="-9999px",f.style.top="-9999px",f.style.visibility="hidden",f.style.fontSize=u,f.style.fontFamily="Arial, Helvetica, sans-serif",document.body.appendChild(f),f.textContent=l;const g=f.clientWidth+1;return f.remove(),g}function Nx(p,l){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];p.uiState!==l&&p.el&&(bl(p.el,"disabled"===l),function(g){let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!g)return;const{classList:v}=g,y=v.contains("ddv-button-focused");m?y||g.classList.add("ddv-button-focused"):g.classList.remove("ddv-button-focused")}(p.el,"focused"===l),u&&Qo(p.el,"focused"===l,f?"deep":"base"),p.uiState=l)}class Ti extends gT{constructor(l,u){super(l,u.class),S(this,"callback",void 0),S(this,"uiState","normal"),S(this,"isFocused",!1),S(this,"isMenuButton",!1),this.callback=u.callback,this.bindHooks(),this.isMenuButton=l.data.menu||!1,"false"!==l.data.default&&this.bindDefaultUi()}bindEvent(){this.nativeOn(this.el,"click",this.callback)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup")})}setUiState(l){Nx(this,l,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton)}bindDefaultUi(){const{viewer:l}=this.injection,u=f=>{let g=this.isFocused?"focused":"normal";(Se(null==f?void 0:f.pageCount)?this.injection.viewer.getPageCounts():f.pageCount)||(g="disabled"),this.setUiState(g,!gi())};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindHooks(){this.hooks.created.on(()=>{this.bindEvent(),this.bindHidePopup()}),this.hooks.updated.on(()=>{this.uiState="normal"})}initTemplate(l){const u=this.data;u.options||(u.options={});const{options:f,id:g}=this.data;g&&(f.id=g),Aa(Ia(this),this.injection.viewer,f),"false"===u.default&&(f.label=void 0),super.initTemplate(l)}}class Bx extends Mn{constructor(l){super(l),S(this,"uiState","normal"),S(this,"defaultClass",void 0),S(this,"pullDownBox",void 0),S(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks()}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{pullDownBox:u}=this;if(!u)return;const g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Oh(g,this.el,this.pullDownBox)},this)}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",()=>{this.togglePopup(),this.isFirstClick&&(Oh(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1)})}bindPopupSwitchEvent(){Fx(this)}bindDefaultUi(){const l=u=>{const f=(Se(null==u?void 0:u.pageCount)?this.injection.viewer.getPageCounts():u.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(f)};this.injection.viewer.hooks.pageExistenceChanged.on(l,this),this.hooks.inserted.on(l),this.hooks.updated.on(l)}initPullDownBox(){this.hooks.created.on(()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents()}),this.hooks.updated.on(()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0})}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on(l=>{"hidden"===l.newVisibility&&this.togglePopup(!1)},this)}setUiState(l){Nx(this,l)}togglePopup(l){const{pullDownBox:u}=this,{viewer:f}=this.injection;let g="none"===u.style.display;g=Se(l)?!g:!l,g?u.remove():(this.$emit("ui_hidePopup",this),f.rootDom.appendChild(u)),Qo(this.el,!g),u.style.display=g?"none":""}}class Ux extends Bx{constructor(l){super(l),S(this,"lastSelectedIndex",0),S(this,"defaultClass","ddv-pdl"),S(this,"pullDownBoxClass","ddv-pull-down"),S(this,"children",[]),S(this,"hasCheckIcon",!1);const{defaultClassName:u,children:f,showCheckIcon:g}=l.data.options;u&&(this.defaultClass=u),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=f,this.hasCheckIcon=g,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let l="";return this.children.forEach((u,f)=>{const{id:g,label:m}=u;u.id=void 0,u.label=void 0,l+=`<${u.type} :options="options.children[${f}]" default="false"id="${g?g+this.injection.viewer.postfix:""}" ><span>${m}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${u.type}>`}),l}selectChildren(l){if(!this.hasCheckIcon)return;const{pullDownBox:u}=this;if(-1!==l&&!u.childNodes[l])return;if(-1!==this.lastSelectedIndex){const m=u.children[this.lastSelectedIndex],v=m.getElementsByTagName("i")[0];m.classList.remove("ddv-pull-down-selected"),v.style.visibility="hidden"}if(-1===l)return void(this.lastSelectedIndex=-1);const f=u.children[l],g=f.getElementsByTagName("i")[0];f.classList.add("ddv-pull-down-selected"),g.style.visibility="visible",this.lastSelectedIndex=l}initTemplate(){const l=this.data;l.options||(l.options={});const{options:u}=this.data,{pullDownBox:f}=u;Aa(Ia(this),this.injection.viewer,u);const g=`<div ${Li(u,`ddv-button ${this.defaultClass}`)}>`+(Se(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Li(f,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=g}}class FF extends Bx{constructor(l){super(l),S(this,"defaultClass","ddv-pdm"),S(this,"pullDownBoxClass","ddv-pull-down"),S(this,"children",[]);const{defaultClassName:u,children:f,enableScroll:g}=l.data.options;u&&(this.defaultClass=u),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,g&&(this.pullDownBoxClass+=gi()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=f,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let l="";return this.children.forEach((u,f)=>{l+=`<${u.type} :options="options.children[${f}]" menu="true"></${u.type}>`}),l}initTemplate(){const l=this.data;l.options||(l.options={});const{options:u}=this.data,{pullDownBox:f}=u;Aa(Ia(this),this.injection.viewer,u);const g=`<div ${Li(u,`ddv-button ${this.defaultClass}`)}>`+(Se(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Li(f,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=g}}class Pa extends Ti{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection;gi()&&this.el.classList.contains("ddv-button-focused")?f.updateViewerConfig({toolMode:"pan"}):(f.updateViewerConfig({toolMode:"annotation",annotationMode:u.annotationMode}),"stamp"===u.annotationMode&&f.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null}}}))}}),S(this,"annotationMode",void 0),this.annotationMode=u.annotationMode}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!Wt.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig();l.getPageCounts()?this.setUiState("annotation"!==f?"normal":g===this.annotationMode?"focused":"normal"):this.setUiState("disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class NF extends Pa{constructor(l){super(l,{class:"ddv-ellipse",annotationMode:"ellipse"})}}S(NF,"cpName","EllipseAnnotation");class BF extends Pa{constructor(l){super(l,{class:"ddv-annot-eraser",annotationMode:"erase"})}}S(BF,"cpName","EraseAnnotation");class UF extends Pa{constructor(l){super(l,{class:"ddv-ink",annotationMode:"ink"})}}S(UF,"cpName","InkAnnotation");class VF extends Pa{constructor(l){super(l,{class:"ddv-line",annotationMode:"line"})}}S(VF,"cpName","LineAnnotation");class jF extends Pa{constructor(l){super(l,{class:"ddv-polygon",annotationMode:"polygon"})}}S(jF,"cpName","PolygonAnnotation");class HF extends Pa{constructor(l){super(l,{class:"ddv-polyline",annotationMode:"polyline"})}}S(HF,"cpName","PolylineAnnotation");class WF extends Pa{constructor(l){super(l,{class:"ddv-rect",annotationMode:"rectangle"})}}S(WF,"cpName","RectAnnotation");class GF extends Pa{constructor(l){super(l,{class:"ddv-annot-select",annotationMode:"select"})}}S(GF,"cpName","SelectAnnotation");class zF extends Pa{constructor(l){super(l,{class:"ddv-stamp-icon",annotationMode:"stamp"})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!Wt.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig(),m=l.getPageCounts(),{defaultStyleConfig:v}=l.getAnnotationConfig(),{stamp:y}=v;this.setUiState(m?"annotation"!==f||"stamp"!==g||(null==y?void 0:y.imageData)?"normal":"focused":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),l.hooks.annotationDefaultStyleChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S(zF,"cpName","StampIconAnnotation");class $F extends Ti{constructor(l){super(l,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,gi()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click())}}),S(this,"annotationImageLoader",void 0)}createAnnotationImageLoaderInput(){const l=document.createElement("input");return l.accept="image/png,image/jpeg,image/bmp",l.type="file",l.addEventListener("change",u=>{const{files:f}=l,g=new Blob([f[0]],{type:f[0].type});["image/png","image/jpeg","image/bmp"].includes(f[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:g}}}),l.value=null,l.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}))},!0),l}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const l=this.createAnnotationImageLoaderInput();l.style.display="none",this.el.appendChild(l),this.annotationImageLoader=l,this.annotationImageLoader.addEventListener("click",u=>{u.stopPropagation()})})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{if(!Wt.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:f,annotationMode:g}=l.getViewerConfig(),m=l.getPageCounts(),{defaultStyleConfig:v}=l.getAnnotationConfig(),{stamp:y}=v;this.setUiState(m?"annotation"!==f?"normal":"stamp"===g&&(null==y?void 0:y.imageData)?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this),l.hooks.annotationDefaultStyleChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S($F,"cpName","StampImageAnnotation");class YF extends Pa{constructor(l){super(l,{class:"ddv-text-box",annotationMode:"textBox"})}}S(YF,"cpName","TextBoxAnnotation");class XF extends Pa{constructor(l){super(l,{class:"ddv-typewriter",annotationMode:"textTypewriter"})}}S(XF,"cpName","TextTypewriterAnnotation");class Vx extends FF{constructor(l){const{AnnotationSet:u}=sr.getDisplayTextConfig(),f=l.data;f.options=Fe(ne({},f.options),{children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:u,enableScroll:!0}),super(l),N0(this)}bindDefaultUi(){Wt.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on(l=>{const{toolMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getPageCounts();"annotation"===u&&f>0&&this.setUiState("focused")})):this.hooks.inserted.on(l=>{this.setUiState("disabled")})}togglePopup(l){if((!0!==l||""!==this.pullDownBox.style.display)&&(!1!==l||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(l),""===this.pullDownBox.style.display&&qF(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let u=0;for(let f=0;f<this.pullDownBox.children.length;f++){const g=this.pullDownBox.children[f];g.classList.contains("ddv-button-focused")&&(u=g.offsetLeft+g.clientWidth/2-this.pullDownBox.clientWidth/2)}this.pullDownBox.scroll(u,0)}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",l=>{if(l===this||"viewer"===l||l===Vx.cpName)return;const{toolMode:u}=this.injection.viewer.getViewerConfig();"annotation"!==u&&this.togglePopup(!1)})}bindViewerHooks(){if(!Wt.annotationLicenseModuleIsExist())return;const l=this.injection.viewer;l.hooks.resize.on(()=>{this.pullDownBox.style.justifyContent=qF(this.pullDownBox).horizontal?"start":""},this),l.hooks.pageExistenceChanged.on(()=>{const{toolMode:u}=l.getViewerConfig();let f="disabled";l.getPageCounts()>0?(f="normal","annotation"===u&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),f="focused")):this.togglePopup(!1),this.setUiState(f)},this),l.hooks.toolModeChanged.on(u=>{if("crop"===u.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const f="annotation"===u.newToolMode;l.getPageCounts()>0&&(this.setUiState(f?"focused":"normal"),this.$emit("ui_annotationModeClick",f),this.$emit("ui_toolModeRefactor",f),f&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)))},this)}setUiState(l){super.setUiState(l)}}function qF(p){return{vertical:p.scrollHeight>p.clientHeight,horizontal:p.scrollWidth>p.clientWidth}}S(Vx,"cpName","AnnotationSet");class jx extends Ti{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection,g=f.getSelectedAnnotations();if(1!==g.length)return;const m=g[0].uid;switch(this.layerType){case"bringForward":f.bringForward(m);break;case"bringToFront":f.bringToFront(m);break;case"sendBackward":f.sendBackward(m);break;case"sendToBack":f.sendToBack(m)}}}),S(this,"layerType",void 0),this.layerType=u.layerType}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const l=this.injection.viewer,u=Wt.annotationLicenseModuleIsExist(),f=()=>{if(!u)return void this.setUiState("disabled");const{viewer:g}=this.injection,m=g.getSelectedAnnotations();l.getPageCounts()&&1===m.length?this.setUiState("normal"):this.setUiState("disabled")};l.hooks.annotationLayerStateChanged.on(g=>{let{state:m}=g;if(!u)return void this.setUiState("disabled");const v=l.getSelectedAnnotations();if(!v.length||v.length>1)return void this.setUiState("disabled");const y=l.getAnnotationObject(v[0].uid);if(y&&!y.context.isActive)return void this.setUiState("disabled");let x=!1;switch(this.layerType){case"bringForward":x=m.forward;break;case"bringToFront":x=m.front;break;case"sendBackward":x=m.backward;break;case"sendToBack":x=m.back}this.setUiState(x?"normal":"disabled")},this),l.hooks.pageExistenceChanged.on(f,this),this.hooks.inserted.on(f),this.hooks.updated.on(f)}}class ZF extends jx{constructor(l){super(l,{class:"ddv-bring-forward",layerType:"bringForward"})}}S(ZF,"cpName","BringForward");class JF extends jx{constructor(l){super(l,{class:"ddv-bring-to-front",layerType:"bringToFront"})}}S(JF,"cpName","BringToFront");class QF extends jx{constructor(l){super(l,{class:"ddv-send-backward",layerType:"sendBackward"})}}S(QF,"cpName","SendBackward");class KF extends jx{constructor(l){super(l,{class:"ddv-send-to-back",layerType:"sendToBack"})}}S(KF,"cpName","SendToBack");class eN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-annotation-toolbar"),S(this,"lastSelected",void 0),S(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks()}bindHooks(){const l=u=>{this.el.style.display="none"};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{viewer:l}=this.injection,u=()=>{if(!this.lastSelected)return;const f=l.getActiveTab();if("single"===f.context.displayMode&&this.lastSelected.pageUid!==f.getCurrentPage().uid)return;const{show:g,x:m,y:v}=yT(l.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(g,m,v)};if(l.hooks.visibleChanged.on(()=>{this.togglePopup(!1)},this),l.hooks.pageExistenceChanged.on(f=>{0===f.pageCount&&(this.togglePopup(!1),this.lastSelected=null)},this),l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const m=l.getAnnotationObject(f.newAnnotationUids[0]);if(!m)return;const{show:v,x:y,y:x}=yT(l.context.viewService.mainContainer,m,this.el,this.toolbarOffset);this.lastSelected=m,this.togglePopup(v,y,x)},this),l.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),l.hooks.afterAnnotationEdit.on(f=>{if(f instanceof xc)return;const{show:g,x:m,y:v}=yT(l.context.viewService.mainContainer,f,this.el,this.toolbarOffset);this.lastSelected=f,this.togglePopup(g,m,v)},this),l.hooks.pageChanged.on(()=>{const f=l.getActiveTab();if(!f||"single"!==f.context.displayMode)return;const g=l.getSelectedAnnotations();if(1!==g.length)return;const m=g[0].pageUid===f.getCurrentPage().uid;this.togglePopup(m)},this),l.hooks.resize.on(u,this),l.hooks.scroll.on(u,this),l.hooks.fitModeChanged.on(u,this),l.hooks.displayModeChanged.on(u,this),l.hooks.zoomChanged.on(u,this),l.hooks.annotationsUpdated.on(u,this),null!=l&&l.annotationViewerContext){const{annotationViewerContext:f}=l,{hooks:g}=f.annotationController;g.enableAnnotationTextEditMode.on(u,this),g.disableAnnotationTextEditMode.on(u,this)}}togglePopup(l,u,f){const{viewer:g}=this.injection;l?(g.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${u||0}px`,this.el.style.top=`${f||0}px`):this.el.style.display="none"}initTemplate(){const{options:l}=this.data;Aa(Ia(this),this.injection.viewer,l);const u=`<div ${Li(l,this.defaultClass,"")}><AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton><AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>`;this.template=u}}function yT(p,l,u,f){const{width:g,height:m}=p.getBoundingClientRect(),v=l.context.getRealTimeBoundingBox(),y=getComputedStyle(u),x=Dt(y.width).value,w=Dt(y.height).value;if(v.right<0||v.left>g||v.top>m||v.bottom<0)return{show:!1,x:0,y:0};let _=v.bottom+f;return _+w>m&&(_=v.top-w-f),_<0&&(_=0),{show:!0,x:v.left+v.width/2-x/2,y:_}}S(eN,"cpName","AnnotationToolBar");class tN extends Ti{constructor(l){super(l,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible")}}),N0(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture()})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof vi&&u.isEditMode&&u.focusTexture()}}}S(tN,"cpName","AnnotationPaletteButton");class iN extends Ti{constructor(l){super(l,{class:"ddv-delete-annot",callback:()=>{const{viewer:u}=this.injection,f=u.getSelectedAnnotations(),g=[];f.forEach(m=>{g.push(m.uid)}),u.deleteAnnotations(g)}}),N0(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{viewer:f}=this.injection,g=f.getSelectedAnnotations();l.getPageCounts()&&g.length?this.setUiState("normal"):this.setUiState("disabled")};l.hooks.selectedAnnotationsChanged.on(u,this),l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S(iN,"cpName","AnnotationDeleteButton");class Bre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-color-panel"),S(this,"colorList",void 0),S(this,"enableChangeColor",void 0),S(this,"paletteType",void 0),S(this,"colorInput",void 0),S(this,"selectedColorButton",void 0),S(this,"lastUpdatedAnnotation",void 0),S(this,"lastInputColor",void 0),S(this,"lastTextContents",void 0),S(this,"lastPaletteType",void 0),S(this,"dblClickButtons",[]),this.colorList=l.data.colorList,this.enableChangeColor=l.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",u=>{this.el.style.display="stamp"===u?"none":"",this.paletteType=u,this.showNoFill("fill"===u),this.updateButtonSelected()})}bindHooks(){this.hooks.inserted.on(()=>{const l=document.createElement("input");l.type="color",this.colorInput=l,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents()})}bindEvents(){const l=this.el.querySelector(".ddv-palette-color-grid");l.addEventListener("click",u=>{const f=u.target;if(!(f instanceof HTMLButtonElement)||(this.dblClickButtons.push(f),this.dblClickButtons.length>2&&this.dblClickButtons.shift(),f.classList.contains("ddv-color-selected")))return;const g=f.value,{viewer:m}=this.injection;if(""===g)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=f;else{const v=m.getSelectedAnnotations();1===v.length&&this.updateColorByData(v[0],g),this.updateDefaultColor(g)}}),l.addEventListener("dblclick",u=>{if(!this.enableChangeColor)return;const f=u.target;if(!(f instanceof HTMLButtonElement)||2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const g=f.value;"transparent"!==g&&""!==g&&(this.colorInput.value=g,gi()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=f)})}bindColorInputEvents(){this.colorInput.addEventListener("input",l=>{const{viewer:u}=this.injection,f=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor(),this.selectedColorButton.children[0].style.background=f,this.selectedColorButton.value=f,1===u.getSelectedAnnotations().length&&this.updateColorByShape(f),this.updateDefaultColor(f),this.selectedColor(f)}),this.colorInput.addEventListener("change",l=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null)})}bindViewerHooks(){const l=this.injection.viewer;l.hooks.selectedAnnotationsChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationsUpdated.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationModeChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationDefaultStyleChanged.on(()=>{this.updateButtonSelected()},this),l.hooks.annotationTextCharsSelected.on(u=>{const f=u.freeTextContentStyle,{color:g}=f;this.selectedColor(g)},this)}updateColorByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if("fill"===this.paletteType)f.style.background=l;else if("stroke"===this.paletteType)f.style.borderColor=l;else if("text"===this.paletteType&&f instanceof vi){if(f.hasSelectedChars){const g=V6(f,{color:l});f.style.textContents=g,f.textEditEventHandler.updateTextSelection()}else{if(f.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[u[0].type]:{textContent:{color:l}}}});{const g=U6(f,{color:l});g.length&&(f.style.textContents=g)}}this.lastTextContents=f.style.textContents}this.lastUpdatedAnnotation=u[0],this.lastInputColor=l,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render()}updateColorByData(l,u,f){const{viewer:g}=this.injection,{uid:m}=l,v={},y=this.injection.viewer.getAnnotationObject(m),x=f||this.paletteType;if("text"===x&&y instanceof vi){if(y.hasSelectedChars){const w=V6(y,{color:u});v.textContents=w}else{if(y.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[l.type]:{textContent:{color:u}}}});{const w=U6(y,{color:u});w.length&&(v.textContents=w)}}return this.lastTextContents&&(v.textContents=this.lastTextContents,this.lastTextContents=null),g.updateAnnotation(m,{style:v},["appearanceChanged"]),void(y.hasSelectedChars&&y.textEditEventHandler.updateTextSelection())}"fill"===x?v.background="transparent"===u?"":u:"stroke"===x&&(v.borderColor=u),g.updateAnnotation(m,{style:v},["appearanceChanged"])}updateDefaultColor(l,u){const{annotationMode:f}=this.injection.viewer.getViewerConfig(),g=this.injection.viewer.getSelectedAnnotations();let m=f;g.length&&g[0]&&(m=g[0].type);const v={};switch(u||this.paletteType){case"fill":v.background=l;break;case"stroke":v.borderColor=l;break;case"text":v.textContent={},v.textContent.color=l}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[m]:v}})}selectedColor(l){const u=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let f=0;f<u.length;f++){const g=u[f];if(!g.value)continue;const m=Sa(g.value),v=Sa(l);m.formatted===v.formatted?g.classList.add("ddv-color-selected"):g.classList.contains("ddv-color-selected")&&g.classList.remove("ddv-color-selected")}}updateButtonSelected(){const{viewer:l}=this.injection,u=l.getSelectedAnnotations();if(1===u.length){let w=null;if("fill"===this.paletteType)w=u[0].style.background||"transparent";else if("stroke"===this.paletteType)w=u[0].style.borderColor||"transparent";else if("text"===this.paletteType){const C=l.getAnnotationObject(u[0].uid);var f;C instanceof vi&&(w=(null===(f=u[0].style)||void 0===f||null===(f=f.textContents[0])||void 0===f?void 0:f.color)||"transparent"),C instanceof vi&&(C.isEditMode||!C.style.textContents.length)&&(w=C.freeTextContentStyle.color)}return void(w&&this.selectedColor(w))}const{toolMode:g,annotationMode:m}=l.getViewerConfig();if("annotation"===g&&"select"!==m&&"erase"!==m){const{defaultStyleConfig:w}=l.getAnnotationConfig(),{background:C,borderColor:_,textContent:T}=ci;let M=null;var v;if("fill"===this.paletteType)M=(null===(v=w[m])||void 0===v?void 0:v.background)||C||"transparent";else if("stroke"===this.paletteType){var y;M=(null===(y=w[m])||void 0===y?void 0:y.borderColor)||_||"transparent"}else if("text"===this.paletteType){var x;M=(null===(x=w[m])||void 0===x||null===(x=x.textContent)||void 0===x?void 0:x.color)||(null==T?void 0:T.color)||"transparent"}M&&this.selectedColor(M)}}getColorTemplate(){const l=document.createElement("div");let u="<div>",f=0;for(let m=0;m<this.colorList.length;m++){const v=this.colorList[m];if(l.style.background=v,""!==l.style.background){if(f>26)break;f+=1,u+=`<button value="${v}"><div style="background:${v}"></div></button>`,0!==f&&f%7==0&&(u+="</div><div>"),l.style.background=""}}const g=f>26?0:27-f;for(let m=0;m<g;m++)u+=0===m?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(f+m+1)%7==0&&(u+="</div><div>");return u+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',u+="</div>",l.remove(),u}showNoFill(l){this.el.querySelectorAll(".ddv-color-transparent").forEach(u=>{u.style.visibility=l?"":"hidden",u.style.pointerEvents=l?"":"none"})}addColor(){const l=this.el.querySelector(".ddv-palette-color-grid"),u=l.querySelector(".ddv-add-color"),f=l.querySelector(".ddv-color-placeholder");u&&u.classList.remove("ddv-add-color"),f&&(f.classList.remove("ddv-color-placeholder"),f.classList.add("ddv-add-color"))}initTemplate(){const l=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=l}}const xT=["Arial","Courier","Helvetica","Times New Roman"],Lh=yt.displayResolution/yt.dataResolution;class Ure extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-font-panel"),S(this,"fontFamilyEl",void 0),S(this,"fontSizeEl",void 0),S(this,"fontList",[...xT]),S(this,"inputIsBlur",!0),S(this,"currentFontSizeValue",void 0),S(this,"isArrowKeyPressed",!1),S(this,"maxFontSize",72),this.maxFontSize=l.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",u=>{"fontFamily"!==u&&this.toggleSelect("fontFamily",!1),"fontSize"!==u&&this.toggleSelect("fontSize",!1)}),this.$on("ui_changePalette_type",u=>{this.el.style.display="text"===u?"":"none"}),this.$on("ui_addFont",u=>{this.addFont(u)})}updateTextStyle(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();if(1!==m.length||"textTypewriter"!==m[0].type&&"textBox"!==m[0].type)"annotation"!==f||"textBox"!==g&&"textTypewriter"!==g||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{textContent:l}}});else{const{uid:v,type:y}=m[0],x=this.injection.viewer.getAnnotationObject(v);if(x.isEditMode)x.hasSelectedChars&&(this.injection.viewer.updateAnnotation(v,{style:{textContents:V6(x,l)}},["appearanceChanged"]),x.textEditEventHandler.updateTextSelection());else{const w=U6(x,l);w.length&&this.injection.viewer.updateAnnotation(v,{style:{textContents:w}},["appearanceChanged"])}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[y]:{textContent:l}}})}u&&this.focusTexture()}bindHooks(){this.hooks.created.on(()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size")}),this.hooks.inserted.on(()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents()})}bindToggleEvent(){const l=this.fontSizeEl.querySelector(".ddv-down-arrow");In(this.fontFamilyEl,"click",this).on(u=>{u.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily")},this),In(l,"click",this).on(u=>{u.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize")},this)}bindSelectEvent(){const l=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),u=this.fontSizeEl.querySelector(".ddv-palette-font-size-select");l.addEventListener("click",f=>{f.stopPropagation(),this.toggleSelect("fontFamily",!1);const g=f.target.value;g&&this.updateTextStyle({fontFamily:g})}),u.addEventListener("click",f=>{f.stopPropagation(),this.toggleSelect("fontSize",!1);const g=f.target.value;g&&this.updateTextStyle({fontSize:Dt(g).value*Lh})})}bindFontSizeInputEvent(){const l=this.fontSizeEl.getElementsByTagName("input")[0];l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){let g=Math.round(Dt(l.value).value);g>this.maxFontSize&&(g=this.maxFontSize,l.value=`${this.maxFontSize}`),g<1&&(g=1,l.value="1"),this.updateTextStyle({fontSize:g*Lh},!1),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=Dt(l.value).value;l.value=g,l.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=g,this.$emit("ui_shrinkSelectionBox")}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,"text"!==l.type&&(this.currentFontSizeValue=l.value,l.type="text",l.value+="pt",f.relatedTarget instanceof HTMLInputElement||this.focusTexture())});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="pt",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);let f=Math.round(Dt(l.value).value);f>this.maxFontSize&&(f=this.maxFontSize),f<1&&(f=1),this.updateTextStyle({fontSize:f*Lh})};l.addEventListener("change",u)}bindTextAlignEvents(){const l=this.el.querySelector(".ddv-align-left"),u=this.el.querySelector(".ddv-align-center"),f=this.el.querySelector(".ddv-align-right"),g=this.el.querySelector(".ddv-justify-center"),m=v=>{const{toolMode:y,annotationMode:x}=this.injection.viewer.getViewerConfig(),w=this.injection.viewer.getSelectedAnnotations();1!==w.length||"textTypewriter"!==w[0].type&&"textBox"!==w[0].type?"annotation"!==y||"textBox"!==x&&"textTypewriter"!==x||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[x]:{textAlign:v}}}):this.injection.viewer.updateAnnotation(w[0].uid,{style:{textAlign:v}},["appearanceChanged"])};l.addEventListener("click",()=>{m("left")}),u.addEventListener("click",()=>{m("center")}),f.addEventListener("click",()=>{m("right")}),g.addEventListener("click",()=>{m("justify")})}bineFontStyleEvents(){const l=this.el.querySelector(".ddv-bold"),u=this.el.querySelector(".ddv-italic"),f=this.el.querySelector(".ddv-underline"),g=this.el.querySelector(".ddv-line-through");l.addEventListener("click",()=>{this.updateTextStyle({fontWeight:l.classList.contains("ddv-button-activated-light")?"normal":"bold"})}),u.addEventListener("click",()=>{this.updateTextStyle({fontStyle:u.classList.contains("ddv-button-activated-light")?"normal":"italic"})}),f.addEventListener("click",()=>{this.updateTextStyle({underline:!f.classList.contains("ddv-button-activated-light")})}),g.addEventListener("click",()=>{this.updateTextStyle({lineThrough:!g.classList.contains("ddv-button-activated-light")})})}bindViewerHooks(){const{viewer:l}=this.injection;l.hooks.selectedAnnotationsChanged.on(u=>{if(1!==u.newAnnotationUids.length)return;const f=l.getSelectedAnnotations()[0];if("textTypewriter"!==f.type&&"textBox"!==f.type)return;this.showTextAlignList("textBox"===f.type),this.selectTextAlign(f.style.textAlign||"left");const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),{textContent:m}=g[f.type],v=f.style.textContents.length?f.style.textContents[0]:m,{fontFamily:y,fontSize:x,fontWeight:w,fontStyle:C,underline:_,lineThrough:T}=v;this.selectFontStyle(y,Math.round(Dt(x).value/Lh),"bold"===w,"italic"===C,_,T)},this),l.hooks.annotationDefaultStyleChanged.on(u=>{const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();let v,y,x=!1;if("annotation"!==f||"textBox"!==g&&"textTypewriter"!==g||(x=!0,v=g),1===m.length){const H=this.injection.viewer.getAnnotationObject(m[0].uid);H instanceof vi&&(v=m[0].type,y=m[0].style.textAlign,H.isEditMode&&!H.hasSelectedChars?x=!0:H.isEditMode||H.style.textContents.length?(this.selectTextAlign(y),x=!1):x=!0)}if(!x)return;const{textAlign:w}=u[v],{fontFamily:C,fontSize:_,fontWeight:T,fontStyle:M,underline:L,lineThrough:N}=u[v].textContent||{},{textContent:V}=ci;this.selectTextAlign(y||w||ci.textAlign),this.selectFontStyle(C||V.fontFamily,Math.round(Dt(_||V.fontSize).value/Lh),"bold"===(T||V.fontWeight),"italic"===(M||V.fontStyle),L||V.underline,N||V.lineThrough)},this),l.hooks.annotationTextCharsSelected.on(u=>{const f=u.freeTextContentStyle,{fontFamily:g,fontSize:m,fontStyle:v,fontWeight:y,underline:x,lineThrough:w}=f;this.selectFontStyle(g,Math.round(Dt(m).value/Lh),"bold"===y,"italic"===v,x,w)},this),l.hooks.annotationsUpdated.on(u=>{const{actions:f,uids:g}=u,m=this.injection.viewer.getSelectedAnnotations();if(f.includes("appearanceChanged")&&1===m.length&&g.includes(m[0].uid)&&("textTypewriter"===m[0].type||"textBox"===m[0].type)&&(this.selectTextAlign(m[0].style.textAlign||"left"),!this.injection.viewer.getAnnotationObject(m[0].uid).isEditMode&&m[0].style.textContents.length)){const{fontFamily:v,fontSize:y,fontWeight:x,fontStyle:w,underline:C,lineThrough:_}=m[0].style.textContents[0];this.selectFontStyle(v,Math.round(Dt(y).value/Lh),"bold"===x,"italic"===w,C,_)}},this),l.hooks.annotationModeChanged.on(u=>{if(!l.getSelectedAnnotations().length&&["textBox","textTypewriter"].includes(u.newAnnotationMode)){this.showTextAlignList("textBox"===u.newAnnotationMode);const{defaultStyleConfig:f}=this.injection.viewer.getAnnotationConfig(),{textContent:g,textAlign:m}=f[u.newAnnotationMode],{fontFamily:v,fontSize:y,fontWeight:x,fontStyle:w,underline:C,lineThrough:_}=g;this.selectTextAlign(m),this.selectFontStyle(v,Math.round(Dt(y).value/Lh),"bold"===x,"italic"===w,C,_)}},this),l.hooks.toolModeChanged.on(u=>{if("annotation"!==u.newToolMode)return;const{annotationMode:f}=l.getViewerConfig();["textBox","textTypewriter"].includes(f)&&this.showTextAlignList("textBox"===f)},this)}toggleSelect(l,u){const g="fontFamily"===l?this.fontFamilyEl:this.fontSizeEl,m=g.querySelector("."+("fontFamily"===l?"ddv-palette-font-family-select":"ddv-palette-font-size-select")),v=g.querySelector(".ddv-down-arrow"),y="none"!==m.style.display,x=Se(u)?!y:u,w=this.injection.viewer.context.viewService.mainContainer;y!==x&&(x?(m.style.display="block",m.style.top=`${vT(m,w)}px`,v.style.transform="rotate(180deg)","fontSize"===l&&this.scrollFontSizeSelect()):(m.style.display="none",v.style.transform=""))}getFontFamilySelectTemplate(){let l="";for(let u=0;u<xT.length;u++){const f=xT[u];l+=`<button style="font-family:${f}" value="${f}">${f}</button>`}return`<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${l}</div></div>`}getFontSizeTemplate(){let l="";for(let u=1;u<=12;u++)l+=`<button value="${u}">${u}pt</button>`;for(let u=14;u<=36;u+=2)l+=`<button value="${u}">${u}pt</button>`;for(let u=40;u<=72;u+=4)l+=`<button value="${u}">${u}pt</button>`;if(this.maxFontSize>72){let u=72;for(;u+8<this.maxFontSize;)u+=8,l+=`<button value="${u}">${u}pt</button>`;l+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`}return`<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${l}</div></div>`}selectTextAlign(l){const u=this.el.querySelector(".ddv-align-left"),f=this.el.querySelector(".ddv-align-center"),g=this.el.querySelector(".ddv-align-right"),m=this.el.querySelector(".ddv-justify-center");Qo(u,"left"===l,"light"),Qo(f,"center"===l,"light"),Qo(g,"right"===l,"light"),Qo(m,"justify"===l,"light")}selectFontStyle(l,u,f,g,m,v){const y=this.fontFamilyEl.getElementsByTagName("span")[0],x=this.fontSizeEl.getElementsByTagName("input")[0],w=this.el.querySelector(".ddv-bold"),C=this.el.querySelector(".ddv-italic"),_=this.el.querySelector(".ddv-underline"),T=this.el.querySelector(".ddv-line-through");y.innerText=l,this.isArrowKeyPressed||("number"===x.type&&(x.type="text"),this.currentFontSizeValue=u,x.value=`${u}pt`),Qo(w,f,"light"),Qo(C,g,"light"),Qo(_,m,"light"),Qo(T,v,"light")}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof vi&&u.isEditMode&&u.focusTexture()}}addFont(l){if(this.fontList.includes(l))return;this.fontList.push(l);const u=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),f=document.createElement("button");f.style.fontFamily=l,f.value=l,f.innerText=l,u.appendChild(f)}showTextAlignList(l){const u=this.el.querySelector(".ddv-text-align-list");u&&(u.style.display=l?"":"none")}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const l=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:u}=this;let f=0;for(let g=0;g<l.children.length;g++){const m=l.children[g];if(!(u>=m.value))break;f=m.offsetTop}l.scrollTo(0,f)}initTemplate(){const l=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=l}}const nN=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],Vre=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],sN={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},jre={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class Hre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-line-panel"),S(this,"commonClass","ddv-palette-line-panel-common"),S(this,"LineStyleClass","ddv-palette-border-style"),S(this,"lineStyleClassSmall","ddv-palette-border-style-small"),S(this,"startLineEndingClass","ddv-palette-line-start"),S(this,"endLineEndingClass","ddv-palette-line-end"),S(this,"selectionClass","ddv-palette-line-panel-selection"),S(this,"startLineEndingSelect",void 0),S(this,"borderStyleSelect",void 0),S(this,"endLineEndingSelect",void 0),S(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",u=>{"lineEndingStart"!==u&&this.toggleSelect(0,!1),"borderStyle"!==u&&this.toggleSelect(1,!1),"lineEndingEnd"!==u&&this.toggleSelect(2,!1)}),this.$on("ui_changePalette_type",u=>{this.el.style.display="stroke"===u?"":"none",this.isStrokePalette="stroke"===u;const{toolMode:f,annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations();("annotation"===f&&"ink"===g||1===m.length&&"ink"===m[0].type)&&(this.el.style.display="none")})}bindHooks(){this.hooks.inserted.on(()=>{const l=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=l[0],this.borderStyleSelect=l[1],this.endLineEndingSelect=l[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent()})}bindSelectEvent(){const l=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),u=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),f=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),g=(m,v)=>{const y=v.target,x="BUTTON"===y.tagName?y:y.parentNode;return Array.from(m.childNodes).indexOf(x)||0};l.addEventListener("click",m=>{const v=g(l,m),y=nN[v]||"None";this.updateLineEndingByData(!0,y),this.updateDefaultLineEnding(!0,y)}),u.addEventListener("click",m=>{const v=g(u,m),y=Vre[v]||[0,0];this.updateLineDashByData(y),this.updateDefaultLineDash(y)}),f.addEventListener("click",m=>{const v=g(f,m),y=nN[v]||"None";this.updateLineEndingByData(!1,y),this.updateDefaultLineEnding(!1,y)})}bindToggleEvent(){this.startLineEndingSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0)}),this.borderStyleSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1)}),this.endLineEndingSelect.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2)})}bindViewerHooks(){const l=this.injection.viewer,u=(f,g,m,v)=>{if(this.startLineEndingSelect.style.display=f?"":"none",this.endLineEndingSelect.style.display=f?"":"none",this.borderStyleSelect.classList.remove(f?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(f?this.lineStyleClassSmall:this.LineStyleClass),f){const[y,x]=m;this.updateLineEndingSelect(!0,sN[y]||"ddv-solid"),this.updateLineEndingSelect(!1,sN[x]||"ddv-solid")}this.el.style.display=v||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(g||[0,0])};l.hooks.selectedAnnotationsChanged.on(f=>{var g,m;if(1!==f.newAnnotationUids.length)return;const v=l.getSelectedAnnotations()[0];v&&u("line"===v.type||"polyline"===v.type,null===(g=v.style)||void 0===g?void 0:g.lineDash,null===(m=v.style)||void 0===m?void 0:m.lineEnding,"ink"===v.type||"stamp"===v.type)},this),l.hooks.annotationModeChanged.on(f=>{const g=f.newAnnotationMode,m="polyline"===g||"line"===g,v="ink"===g;if("select"!==g&&"erase"!==g&&"stamp"!==g){var y,x;const{defaultStyleConfig:w}=this.injection.viewer.getAnnotationConfig(),C=(null===(y=w[g])||void 0===y?void 0:y.lineEnding)||(null==ci?void 0:ci.lineEnding),_=(null===(x=w[g])||void 0===x?void 0:x.lineDash)||(null==ci?void 0:ci.lineDash);u(m,_,C,v)}},this),l.hooks.annotationDefaultStyleChanged.on(f=>{var g;const{toolMode:m,annotationMode:v}=this.injection.viewer.getViewerConfig();if("annotation"!==m||"select"===v||"erase"===v||"stamp"===v||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:y}=this.injection.viewer.getAnnotationConfig(),C=(null===(g=y[v])||void 0===g?void 0:g.lineEnding)||ci.lineEnding;u("line"===v||"polyline"===v,y[v].lineDash||ci.lineDash,C,"ink"===v)},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&"ink"!==v[0].type&&"stamp"!==v[0].type&&u("line"===v[0].type||"polyline"===v[0].type,v[0].style.lineDash||[0,0],v[0].style.lineEnding||["None","None"],!1)},this)}toggleSelect(l,u){let f=this.borderStyleSelect;0===l?f=this.startLineEndingSelect:2===l&&(f=this.endLineEndingSelect);const g=f.querySelector(`.${this.selectionClass}`),m=f.querySelector(".ddv-down-arrow"),v="none"!==g.style.display,y=Se(u)?!v:u,x=this.injection.viewer.context.viewService.mainContainer;v!==y&&(y?(g.style.display="block",g.style.top=`${vT(g,x)}px`,m.style.transform="rotate(180deg)"):(g.style.display="none",m.style.transform=""))}updateLineEndingSelect(l,u){(l?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${u}`}updateBorderStyleSelect(l){const u=this.borderStyleSelect,f=l.join("")||"0",g=u.querySelector("div");let m="ddv-solid";(function(v){if(0===v.length)return!0;if(1===v.length)return 0===v[0];v.length%2!=0&&(v=v.concat(v));for(let y=1;y<v.length;y+=2)if(0!==v[y])return!1;return!0})(l)||(m=jre[f]||"ddv-dashed-33"),g.className=`ddv-button ${m}`}updateLineDashByData(l){const u=this.injection.viewer.getSelectedAnnotations();1===u.length&&(u[0].style.lineDash||[0,0]).toString()!==l.toString()&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{lineDash:l}},["appearanceChanged"])}updateLineEndingByData(l,u){const f=this.injection.viewer.getSelectedAnnotations();if(1!==f.length)return;const g=f[0].style.lineEnding||["None","None"];l&&u===g[0]||!l&&u===g[1]||this.injection.viewer.updateAnnotation(f[0].uid,{style:{lineEnding:l?[u,g[1]]:[g[0],u]}},["appearanceChanged"])}updateDefaultLineEnding(l,u){var f;const{annotationMode:g}=this.injection.viewer.getViewerConfig(),m=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig();let y=(null===(f=v[g])||void 0===f?void 0:f.lineEnding)||ci.lineEnding,x=g;m.length&&m[0]&&(y=m[0].style.lineEnding,x=m[0].type);const w=[...y];l?w[0]=u:w[1]=u,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[x]:{lineEnding:w}}})}updateDefaultLineDash(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{lineDash:l}}})}getBaseLineDashTemplate(){const l=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let u="";for(let f=0;f<l.length;f++)u+=`<button><i class="ddv-button ${l[f]}"></i></button>`;return`<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${u}</div></div>`}getLineEndingTemplate(l){const u=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let f="";for(let m=0;m<u.length;m++)f+=`<button><i class="ddv-button ${u[m]}"></i></button>`;return`<div class="${this.commonClass} ${l?this.startLineEndingClass:this.endLineEndingClass}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${f}</div></div>`}initTemplate(){const{label:l}=this.data,u=`<div class="${this.defaultClass}"><span>${l}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=u}}class Wre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-opacity-panel"),S(this,"isPointerDown",!1),S(this,"lastPointerValue",void 0),S(this,"range",void 0),S(this,"input",void 0),S(this,"inputIsBlur",!0),S(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),OF(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:l}=this;l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){const g=Ld(l.value).value;g>100&&(l.value=100),g<0&&(l.value=0);let m=parseInt(l.value,10);Ve(m)||(m=100,this.updateInput(100)),this.updateDefaultOpacity(m),this.updateOpacityByData(m),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=Ld(l.value).value;l.value=g,l.type="number",this.inputIsBlur=!1}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,f.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==l.type&&(l.type="text",l.value+="%")});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="%",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);const f=Ld(l.value).value;f>100&&(l.value=100),f<0&&(l.value=0);let g=parseInt(l.value,10);Ve(g)||(g=100,this.updateInput(100)),this.updateDefaultOpacity(g),this.updateOpacityByData(g)};l.addEventListener("change",u)}bindRangeEvent(){const{range:l}=this,u=()=>{const f=parseInt(l.value,10);this.updateOpacityByShape(f),this.input.value=`${f}%`;const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();"annotation"===g&&"select"!==m&&"erase"!==m&&this.updateInput(f)};l.addEventListener("click",()=>{const f=parseInt(l.value,10);f!==this.lastPointerValue&&(this.updateOpacityByData(f),this.updateDefaultOpacity(f))}),l.addEventListener("pointerdown",f=>{f.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),u()}),l.addEventListener("pointermove",()=>{this.isPointerDown&&u()}),l.addEventListener("pointerup",()=>{if(this.isPointerDown){const f=parseInt(l.value,10);this.lastPointerValue=f,this.updateOpacityByData(f),this.updateDefaultOpacity(f)}this.isPointerDown=!1}),l.addEventListener("keydown",f=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)&&u()}),l.addEventListener("keyup",f=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)){const g=parseInt(l.value,10);this.updateOpacityByData(g),this.updateDefaultOpacity(g)}})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{annotationMode:f}=this.injection.viewer.getViewerConfig();if("select"===f||"erase"===f)return;const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),m=Ve(g[f].opacity)?g[f].opacity:ci.opacity;this.updateInput(Math.round(100*m))};l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return;const g=l.getSelectedAnnotations()[0];g&&this.updateInput(Math.round(100*g.style.opacity))},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&this.updateInput(Math.round(100*v[0].style.opacity))},this),l.hooks.annotationModeChanged.on(f=>{u()},this),l.hooks.toolModeChanged.on(f=>{"annotation"===f.newToolMode&&u()},this),l.hooks.annotationDefaultStyleChanged.on(f=>{const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();if("annotation"!==g||"select"===m||"erase"===m||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),y=Ve(v[m].opacity)?v[m].opacity:ci.opacity;this.updateInput(100*y)},this)}updateInput(l){let u=l;l>100&&(u=100),l<0&&(u=0),u=Math.round(u),this.range.value=`${u}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?u:`${u}%`}updateOpacityByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if(!f)return;const g=100*f.style.opacity;(l=Math.round(l))!==g&&(f.style.opacity=l/100,this.injection.viewer.context.render())}updateOpacityByData(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=100*u[0].style.opacity;(l=Math.round(l))!==f&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{opacity:l/100}},["appearanceChanged"])}updateDefaultOpacity(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),l=Math.round(l),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{opacity:l/100}}})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof vi&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{label:l}=this.data;this.template=`<div class="${this.defaultClass}"><span>${l}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`}}const rN=[Zt.DRAFT,Zt.FINAL,Zt.VOID,Zt.REJECTED,Zt.ACCEPTED,Zt.APPROVED,Zt.NOT_APPROVED,Zt.COMPLETED,Zt.CONFIDENTIAL,Zt.INITIAL_HERE,Zt.SIGN_HERE,Zt.WITNESS];class Gre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-stamp-panel"),S(this,"select",void 0),S(this,"selectBox",void 0),S(this,"iconName",Zt.DRAFT),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",u=>{"stampIcon"!==u&&this.toggleSelect(!1)})}bindHooks(){this.hooks.inserted.on(()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.bindToggleEvent(),this.bindSelectEvent()})}bindToggleEvent(){this.select.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect()})}bindSelectEvent(){this.selectBox.addEventListener("click",l=>{this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:l.target.value}}})})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{var f;const{toolMode:g,annotationMode:m}=l.getViewerConfig(),v=l.getAnnotationConfig();this.el.style.display="annotation"!==g||"stamp"!==m||null!==(f=v.defaultStyleConfig)&&void 0!==f&&null!==(f=f.stamp)&&void 0!==f&&f.imageData?"none":""};this.hooks.inserted.on(()=>{u();const{defaultStyleConfig:f}=l.getAnnotationConfig(),{stamp:g}=f;this.updateStampSpan((null==g?void 0:g.stampIcon)||(null==ci?void 0:ci.stampIcon))}),l.hooks.annotationDefaultStyleChanged.on(f=>{u();const{stamp:g}=f,m=(null==g?void 0:g.stampIcon)||(null==ci?void 0:ci.stampIcon);m!==this.iconName&&this.updateStampSpan(m)},this),l.hooks.toolModeChanged.on(u,this),l.hooks.annotationModeChanged.on(u,this)}toggleSelect(l){const u=this.select.querySelector(".ddv-down-arrow"),f="none"!==this.selectBox.style.display,g=Se(l)?!f:l,m=this.injection.viewer.context.viewService.mainContainer;f!==g&&(g?(this.selectBox.style.display="block",this.selectBox.style.top=`${vT(this.selectBox,m)}px`,u.style.transform="rotate(180deg)"):(this.selectBox.style.display="none",u.style.transform=""))}updateStampSpan(l){this.el.getElementsByTagName("span")[1].innerText=l.slice(2),this.iconName=l}getStampIconSelectTemplate(){let l="";for(let u=0;u<rN.length;u++){const f=rN[u];l+=`<button value="${f}">${f.slice(2)}</button>`}return`<div class="ddv-palette-stamp-icon"><span>${Zt.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${l}</div></div>`}initTemplate(){const{label:l}=this.data,u=`<div class="${this.defaultClass}"><span>${l}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=u}}const eu=yt.displayResolution/yt.dataResolution;class zre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-stroke-panel"),S(this,"isPointerDown",!1),S(this,"lastPointerValue",void 0),S(this,"range",void 0),S(this,"input",void 0),S(this,"inputIsBlur",!0),S(this,"isArrowKeyPressed",!1),S(this,"maxBorderWidth",20),this.maxBorderWidth=l.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",u=>{this.el.style.display="stroke"===u?"":"none"})}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),OF(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:l}=this;l.addEventListener("keydown",f=>{f.stopPropagation(),"ArrowUp"!==f.key&&"ArrowDown"!==f.key||(this.isArrowKeyPressed=!0)}),l.addEventListener("keyup",f=>{if(f.stopPropagation(),this.isArrowKeyPressed){const g=Dt(l.value).value;g>this.maxBorderWidth&&(l.value=this.maxBorderWidth),g<0&&(l.value=0);let m=parseInt(l.value,10);Ve(m)||(m=1,this.updateInput(1*eu)),this.updateDefaultBorderWidth(m),this.updateBorderWidthByData(m),this.isArrowKeyPressed=!1}}),l.addEventListener("focus",()=>{const g=parseFloat(l.value);l.value=g,l.type="number",this.inputIsBlur=!1}),l.addEventListener("blur",f=>{this.inputIsBlur=!0,f.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==l.type&&(l.type="text",l.value+="pt")});const u=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;l.type="text",l.value+="pt",l.removeEventListener("change",u),l.blur(),l.addEventListener("change",u);const f=Dt(l.value).value;f>this.maxBorderWidth&&(l.value=this.maxBorderWidth),f<0&&(l.value=0);let g=parseInt(l.value,10);Ve(g)||(g=1,this.updateInput(1*eu)),this.updateDefaultBorderWidth(g),this.updateBorderWidthByData(g)};l.addEventListener("change",u)}bindRangeEvent(){const{range:l}=this,u=()=>{const f=Dt(l.value).value;this.updateBorderWidthByShape(f),this.input.value=`${f}pt`;const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();"annotation"===g&&"select"!==m&&"erase"!==m&&this.updateInput(f*eu)};l.addEventListener("click",()=>{const f=Dt(l.value).value;f!==this.lastPointerValue&&(this.updateBorderWidthByData(f),this.updateDefaultBorderWidth(f))}),l.addEventListener("pointerdown",f=>{f.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),u()}),l.addEventListener("pointermove",()=>{this.isPointerDown&&u()}),l.addEventListener("pointerup",()=>{if(this.isPointerDown){const f=Dt(l.value).value;this.lastPointerValue=f,this.updateBorderWidthByData(f),this.updateDefaultBorderWidth(f)}this.isPointerDown=!1}),l.addEventListener("keydown",f=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)&&u()}),l.addEventListener("keyup",f=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(f.key)){const g=Dt(l.value).value;this.updateBorderWidthByData(g),this.updateDefaultBorderWidth(g)}})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{annotationMode:f}=this.injection.viewer.getViewerConfig();if("select"===f||"erase"===f)return;const{defaultStyleConfig:g}=this.injection.viewer.getAnnotationConfig(),m=Ve(g[f].borderWidth)?g[f].borderWidth:ci.borderWidth;this.updateInput(m)};l.hooks.selectedAnnotationsChanged.on(f=>{if(1!==f.newAnnotationUids.length)return;const g=l.getSelectedAnnotations()[0];g&&this.updateInput(Dt(g.style.borderWidth).value,!0)},this),l.hooks.annotationsUpdated.on(f=>{const{actions:g,uids:m}=f,v=l.getSelectedAnnotations();g.includes("appearanceChanged")&&1===v.length&&m.includes(v[0].uid)&&this.updateInput(Dt(v[0].style.borderWidth).value)},this),l.hooks.annotationModeChanged.on(f=>{u()},this),l.hooks.toolModeChanged.on(f=>{"annotation"===f.newToolMode&&u()},this),l.hooks.annotationDefaultStyleChanged.on(f=>{const{toolMode:g,annotationMode:m}=this.injection.viewer.getViewerConfig();if("annotation"!==g||"select"===m||"erase"===m||"stamp"===m||l.getSelectedAnnotations().length)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),y=Ve(v[m].borderWidth)?v[m].borderWidth:ci.borderWidth;this.updateInput(y)},this)}updateInput(l,u){let f=l/eu;this.isPointerDown||u?f=Math.round(f):(f=f.toFixed(1),f.endsWith(".0")&&(f=parseInt(f,10))),this.range.value=f,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(f):`${f}pt`}updateBorderWidthByShape(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=this.injection.viewer.getAnnotationObject(u[0].uid);if(!f)return;const g=l*eu,{borderWidth:m}=f.style;m!==g&&(f.style.borderWidth=g,this.injection.viewer.context.render())}updateBorderWidthByData(l){const u=this.injection.viewer.getSelectedAnnotations();if(1!==u.length)return;const f=l*eu,{borderWidth:g}=u[0].style;g!==f&&this.injection.viewer.updateAnnotation(u[0].uid,{style:{borderWidth:f}},["appearanceChanged"])}updateDefaultBorderWidth(l){const{annotationMode:u}=this.injection.viewer.getViewerConfig(),f=this.injection.viewer.getSelectedAnnotations();let g=u;f.length&&f[0]&&(g=f[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[g]:{borderWidth:l*eu}}})}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof vi&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{label:l}=this.data;this.template=`<div class="${this.defaultClass}"><span>${l}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`}}class oN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-palette-box"),S(this,"header",void 0),S(this,"fillSpan",void 0),S(this,"textSpan",void 0),S(this,"strokeSpan",void 0),S(this,"thumbnail",void 0),Fr.registerComponent({ColorPanel:Bre,FontPanel:Ure,LinePanel:Hre,StampPanel:Gre,OpacityPanel:Wre,StrokePanel:zre}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",u=>{this.togglePopup(u)})}bindHooks(){const l=u=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const f=this.header.getElementsByTagName("span");this.textSpan=f[0],this.strokeSpan=f[1],this.fillSpan=f[2],this.bindEvents(),this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:g}=this.data.options;this.el.dataset.enableDrag=`${g}`,function(m){let v,y,x=!1;function w(_){if(!x)return;const M=_.clientY-y;m.style.left=`${m.offsetLeft+(_.clientX-v)}px`,m.style.top=`${m.offsetTop+M}px`,v=_.clientX,y=_.clientY}function C(){x=!1,document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",C)}m.addEventListener("pointerdown",function(_){const T=_.target;T.classList.contains("ddv-button")||"false"===m.dataset.enableDrag||T instanceof HTMLInputElement||T instanceof HTMLButtonElement||(x=!0,v=_.clientX,y=_.clientY,document.addEventListener("pointermove",w),document.addEventListener("pointerup",C))})}(this.el)};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindEvents(){this.el.addEventListener("click",l=>{l.stopPropagation(),this.$emit("ui_shrinkSelectionBox",l)}),this.el.addEventListener("pointerup",l=>{l.target instanceof HTMLInputElement&&!(l.target instanceof HTMLInputElement&&"range"===l.target.type)||this.focusTexture()}),this.textSpan.addEventListener("click",l=>{this.setPaletteType("text")}),this.fillSpan.addEventListener("click",l=>{this.setPaletteType("fill")}),this.strokeSpan.addEventListener("click",l=>{this.setPaletteType("stroke")})}bindViewerHooks(){const l=this.injection.viewer,u=()=>{const{toolMode:g,annotationMode:m}=l.getViewerConfig(),v=l.getSelectedAnnotations();return!l.getPageCounts()||"annotation"!==g&&!v.length||"annotation"===g&&("select"===m||"erase"===m)},f=g=>{"stamp"===g?this.setPaletteType("stamp"):"text"===g?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"))};this.hooks.inserted.on(()=>{u()&&this.togglePopup(!1)}),l.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),l.hooks.beforeAnnotationDraw.on(()=>{this.togglePopup(!1)},this),l.hooks.pageChanged.on(g=>{g.total||this.togglePopup(!1);const m=l.getActiveTab();!m||"single"!==m.context.displayMode||1===l.getSelectedAnnotations().length&&this.togglePopup(!1)},this),l.hooks.toolModeChanged.on(g=>{if(u())return void this.togglePopup(!1);const{annotationMode:m}=l.getViewerConfig();if("annotation"===g.newToolMode&&"select"!==m&&"erase"!==m&&!gi()){const v=["textBox","textTypewriter"].includes(m);f("stamp"===m?"stamp":v?"text":"common"),this.togglePopup(!0)}},this),l.hooks.selectedAnnotationsChanged.on(g=>{u()&&this.togglePopup(!1);const m=l.getSelectedAnnotations();if(1!==m.length)return;const v=m[0],y=["textBox","textTypewriter"].includes(v.type),x="stamp"===v.type?"stamp":y?"text":"common";f(x),("text"===x&&"textTypewriter"===v.type||"ink"===v.type)&&(this.header.style.display="none")},this),l.hooks.annotationModeChanged.on(g=>{if(l.getSelectedAnnotations().length)return;const m=g.newAnnotationMode;if(["erase","select"].includes(m))return void this.togglePopup(!1);const v=["textBox","textTypewriter"].includes(m),y="stamp"===m?"stamp":v?"text":"common";f(y),("text"===y&&"textTypewriter"===m||"ink"===m)&&(this.header.style.display="none");const{toolMode:x}=this.injection.viewer.getViewerConfig(),w=this.injection.viewer.getPageCounts();gi()&&"stamp"!==y?this.togglePopup(!1):this.togglePopup(w>0&&"annotation"===x)},this)}setPaletteType(l){const{header:u,textSpan:f,strokeSpan:g,fillSpan:m}=this;if(this.$emit("ui_changePalette_type",l),"stamp"===l)return void(u.style.display="none");const{backgroundColor:v}=getComputedStyle(this.el);u.style.display="";const y=(x,w,C)=>{x.style.background=l===w?C:"",x.style.borderBottom=l===w?"none":""};y(f,"text",v),y(g,"stroke",v),y(m,"fill",v)}togglePopup(l,u,f){const g="none"!==this.el.style.display,m=Se(l)?!g:l;if(g===m)return;const{options:v}=this.data;m?(this.el.style.display="",null!=v&&v.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),Se(u)||(this.el.style.right=`${u||0}px`),Se(f)||(this.el.style.top=`${f||0}px`),this.injection.viewer.emit("annotationPaletteToggle",m),function(y){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if("none"===y.style.display||!y.parentElement)return!1;const w=y.getBoundingClientRect(),C=y.parentElement.getBoundingClientRect(),_=w.right-x<C.left||w.left+x>C.right,T=w.bottom-x<C.top||w.top+x>C.bottom;return _||T}(this.el)&&(this.el.style.left="",this.el.style.top="")}focusTexture(){const l=this.injection.viewer.getSelectedAnnotations();if(1===l.length){const u=this.injection.viewer.getAnnotationObject(l[0].uid);u instanceof vi&&u.isEditMode&&u.focusTexture()}}initTemplate(){const{options:l}=this.data;Aa(Ia(this),this.injection.viewer,l),null!=l&&l.labels||(l.labels={}),l.labels=ne({text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business"},l.labels),l.style=Fe(ne({},l.style),{display:"none"});const u=`<div ${Li(l,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${l.labels.text}</span><span>${l.labels.stroke}</span><span>${l.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel label="${l.labels.standardBusiness}"></StampPanel><OpacityPanel label="${l.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${l.labels.stroke}"></StrokePanel><LinePanel label="${l.labels.style}"></LinePanel></div>`;this.template=u}}S(oN,"cpName","AnnotationPalette");class aN extends Ti{constructor(l){super(l,{class:"ddv-auto-capture",callback:()=>{const{viewer:u}=this.injection,{viewerMode:f}=u.getViewerConfig(),{enableAutoCapture:g}=u.getCameraConfig();f===Rn.CAPTURE&&u.updateCameraConfig({enableAutoCapture:!g})}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()?u.getCameraConfig().enableAutoCapture?this.setUiState("focused",!gi()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.autoCaptureChanged.on(u=>{this.setUiState(u.enableAutoCapture?"focused":"normal",!gi())},this),l.cameraPlayed.on(()=>{const{enableAutoCapture:u}=this.injection.viewer.getCameraConfig();this.setUiState(u?"focused":"normal",!gi())},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}S(aN,"cpName","AutoCapture");class lN extends Ti{constructor(l){super(l,{class:"ddv-auto-detect",callback:()=>{const{viewer:u}=this.injection,{viewerMode:f}=u.getViewerConfig(),{enableAutoDetect:g}=u.getCameraConfig();f===Rn.CAPTURE&&u.updateCameraConfig({enableAutoDetect:!g})}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()&&u.context.core.detectorService.enableDetect?u.getCameraConfig().enableAutoDetect?this.setUiState("focused",!gi()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.autoDetectChanged.on(u=>{this.setUiState(u.enableAutoDetect?"focused":"normal",!gi())},this),l.cameraPlayed.on(()=>{const{core:u}=this.injection.viewer.context;if(!u.detectorService.enableDetect)return;const{enableAutoDetect:f}=this.injection.viewer.getCameraConfig();this.setUiState(f?"focused":"normal",!gi())},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}S(lN,"cpName","AutoDetect");class cN extends Ti{constructor(l){super(l,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const u=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),u.capture().finally(()=>{this.isCapturing=!1,this.setUiState("normal")})}}),S(this,"isCapturing",!1),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.cameraPlayed.on(()=>{this.setUiState("normal")},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}S(cN,"cpName","Capture");class hN extends Ti{constructor(l){super(l,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:u}=this.injection;u.cameraContext.turnOnTheTorch?u.turnOffTorch():u.turnOnTorch()}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const{viewer:u}=this.injection;u.isVideoPlaying()&&u.cameraContext.torchSupported?this.setUiState(u.cameraContext.turnOnTheTorch?"focused":"normal"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on(l=>{switch(l.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!gi());break;default:this.setUiState("disabled")}},this)}}S(hN,"cpName","Flashlight");class dN extends Ti{constructor(l){super(l,{class:"ddv-camera-convert",callback:()=>{const{viewer:u}=this.injection;u.cameraContext.convertCamera()}}),this.bindViewerHooks()}bindDefaultUi(){const l=()=>{const u=this.injection.viewer;u.isVideoPlaying()?this.setUiState(u.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled")};this.hooks.inserted.on(l),this.hooks.updated.on(l)}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.cameraPlayed.on(()=>{this.setUiState(this.injection.viewer.cameraContext.canFrontCamera?"normal":"disabled")},this),l.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}S(dN,"cpName","CameraConvert");const $re=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class uN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-resolution"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),S(this,"resolutionOptions",[]),S(this,"isFirstClick",!0),S(this,"fakeResolution",!1),S(this,"lastCheckIndex",0),S(this,"box",void 0),this.bindHooks(),this.initTemplate(),Fx(this)}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),bl(this.el,!0)}),this.hooks.updated.on(()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||bl(this.el,!0)})}bindEvents(){const l=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",()=>{const u=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Oh(u,this.el,this.box),this.isFirstClick=!1)}),this.ulEvent(l)}ulEvent(l){l&&this.nativeOn(l,"click",u=>{const f=this.injection.viewer,g=u.target,m=g.parentNode;if("LI"===g.tagName||"LI"===m.tagName){const v="LI"===g.tagName?g.value:m.value;if(v===this.lastCheckIndex)return;const{width:y,height:x}=this.resolutionOptions[v].value;this.fakeResolution=!0,f.setResolution(y,x),this.updateChecked(y,x)}this.togglePopup(!1)})}bindViewerHooks(){const{viewer:l}=this.injection,{hooks:u}=l;u.cameraPlayed.on(f=>{if(bl(this.el,!1),this.fakeResolution)return;const{width:g,height:m}=f.resolution;this.updateChecked(g,m),this.fakeResolution=!1},this),u.cameraClosed.on(()=>{bl(this.el,!0)},this),u.visibleChanged.on(f=>{"hidden"===f.newVisibility&&this.togglePopup(!1)},this)}updateChecked(l,u){const f=function(x,w){let C=-1;const _=w.width*w.height;for(let T=0;T<x.length;T++){const{value:M}=x[T],L=M.width*M.height;if(0===T&&_<=L)return 0;if(T===x.length&&_>=L)return x.length-1;_>L&&(C=T+1)}return C}(this.resolutionOptions,{width:l,height:u}),{box:g,checkedClassName:m}=this,v=g.getElementsByClassName(`${this.cssPrefix}checkbox`)[f],y=g.getElementsByClassName(m)[0];v!==y&&(this.lastCheckIndex=f,null==v||v.classList.add(m),null==y||y.classList.remove(m))}initTemplate(){const{options:l}=this.data,{popupBox:u}=l;Aa(Ia(this),this.injection.viewer,l);const f=`<div ${Li(l,`${this.defaultClass} ddv-button`)}>`+(Se(null==l?void 0:l.label)?"":`<span>${l.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Li(u,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=f}getOptionTemplate(){const{options:l}=this.data;let u=$re;if(Xt(null==l?void 0:l.valueList))u=l.valueList;else{const{CameraResolution_720P:g,CameraResolution_1080P:m,CameraResolution_1440P:v,CameraResolution_2160P:y}=sr.getDisplayTextConfig(),x=[g,m,v,y];u.forEach((w,C)=>{x[C]&&(w.label=x[C])})}let f="";return u.forEach((g,m)=>{const{width:v,height:y}=g.value;Ve(v)&&Ve(y)&&(f+=[`<li value="${m}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==g?void 0:g.label)||""}</span>`,"</li>"].join(""))}),this.resolutionOptions=u,f}updateResolution(){const l=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=l}togglePopup(l){const{box:u}=this,{viewer:f}=this.injection;let g="none"!==u.style.display;g=Se(l)?!g:l,g?(this.$emit("ui_hidePopup",this),f.rootDom.appendChild(u)):u.remove(),Qo(this.el,g),u.style.display=g?"":"none"}}S(uN,"cpName","CameraResolution");class fN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-image-preview"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"uiState",void 0),S(this,"image",void 0),S(this,"counter",void 0),S(this,"imagePageUid",void 0),S(this,"hasTask",!1),S(this,"isUpdateTask",!1),S(this,"lastPageUid",void 0),S(this,"pageTaskUids",[]),S(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(l=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter()}),this.hooks.inserted.on(l=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`)}),this.hooks.destroyed.on(()=>{clearTimeout(this.currentTimer),this.image.src&&URL.revokeObjectURL(this.image.src)})}bindViewerHooks(){var l=this;const u=this.injection.viewer,f=gi()?10:4;u.hooks.updatePage.on(function(){var g=Q(function*(m){if(m.pageUid!==l.lastPageUid)return;if(l.hasTask)return l.pageTaskUids.push(m.pageUid),void(l.isUpdateTask=!0);l.hasTask=!0;const v=u.getPageCounts(),y=yield u.getPerspectivePreviewImage(v-1,400,400,f);y&&(l.image.src&&URL.revokeObjectURL(l.image.src),l.image.src=_3(y.data).data),l.hasTask=!1,l.pageTaskUids.length>0&&l.createTask()});return function(m){return g.apply(this,arguments)}}(),this),u.hooks.pageChanged.on(function(){var g=Q(function*(m){if(0===m.total)return l.image.src="",l.setState("disabled"),l.imagePageUid=void 0,void(l.lastPageUid=void 0);if(null==l||!l.counter)return;l.counter.innerText=`${m.total}`;const v=u.getActiveTab();if(!v)return;const y=v.pages[m.total-1].uid;l.pageTaskUids.push(y),l.hasTask||y!==l.lastPageUid&&l.createTask()});return function(m){return g.apply(this,arguments)}}(),this)}createTask(){var l=this;return Q(function*(){l.hasTask||(l.hasTask=!0,yield l.updateImage(),l.currentTimer=setTimeout(()=>{l.hasTask=!1,0!==l.pageTaskUids.length&&l.createTask()},300))})()}updateImage(){var l=this;return Q(function*(){const u=l.injection.viewer;if(!u||!u.context)return;const f=u.getActiveTab(),g=gi()?10:4;if(!f)return;const m=f.pages.length;if(!m)return;const v=l.pageTaskUids[l.pageTaskUids.length-1],y=f.pages[m-1].uid;if(l.pageTaskUids.length=0,l.lastPageUid=f.pages[m-1].uid,l.lastPageUid===v&&l.imagePageUid===v&&!l.isUpdateTask)return;let x;l.isUpdateTask&&(l.isUpdateTask=!1);try{x=yield u.getPerspectivePreviewImage(m-1,400,400,g)}catch(w){}x&&!u.isDestroy&&u.getActiveTab()&&(l.image.src&&URL.revokeObjectURL(l.image.src),l.image.src=_3(x.data).data,l.imagePageUid=y,l.setState(m>0?"normal":"disabled"))})()}setState(l){this.uiState!==l&&this.el&&("normal"===l?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=l)}initTemplate(){const{options:l}=this.data,{imageCounter:u}=l,f=this.injection.viewer.getPageCounts();Aa(Ia(this),this.injection.viewer,l);const g=`<div ${Li(l,this.defaultClass)}> <img src=""></img><div ${Li(u,this.cssPrefix,"counter")}>${f}</div></div>`;this.template=g}}S(fN,"cpName","ImagePreview");class pN extends Ti{constructor(l){super(l,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click()}}),S(this,"fileLoader",void 0),this.$on("ui_cropClick",u=>{const{viewer:f}=this.injection;0!==(f.getPageCounts()||0)&&this.setUiState(u?"disabled":"normal")})}createFileInput(){const l=document.createElement("input");return l.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",l.type="file",l.multiple=!0,l.addEventListener("change",u=>{const{files:f}=l,g=f.length,m=[];for(let v=0;v<g;v++){const y=new Blob([f[v]],{type:f[v].type});if("application/pdf"===f[v].type){const x=Wt.annotationLicenseModuleIsExist();m.push({fileData:y,convertMode:ir.CM_AUTO,renderOptions:{renderAnnotations:x?pl.LOAD_ANNOTATIONS:pl.NO_ANNOTATIONS}})}else m.push({fileData:y})}this.injection.viewer.context.loadSource(m),l.value=null,l.files=null},!0),l}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const l=this.createFileInput();l.style.display="none",this.el.appendChild(l),this.fileLoader=l,this.fileLoader.addEventListener("click",u=>{u.stopPropagation()})})}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on(l=>{null!=l&&l.pageCount||this.setUiState("normal")},this)}}S(pN,"cpName","Load");class gN extends Ti{constructor(l){super(l,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages()}}),Nr(this)}}S(gN,"cpName","DeleteAll");class mN extends Ti{constructor(l){super(l,{class:"ddv-delete-current",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.deletePages([f])}}),Nr(this)}}function wT(p){try{p.dispatchEvent(new MouseEvent("click"))}catch(l){const u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(u)}}function vN(p,l,u){if("download"in HTMLAnchorElement.prototype){const f=document.createElementNS("http://www.w3.org/1999/xhtml","a");f.download=l=l||p.name||"download",f.rel="noopener","string"==typeof p?(f.href=p,f.origin!==location.origin?function(g){const m=new XMLHttpRequest;m.open("HEAD",g,!1);try{m.send()}catch(v){}return m.status>=200&&m.status<=299}(f.href)?function(g,m){const v=new XMLHttpRequest;v.open("GET",g),v.responseType="blob",v.onload=function(){vN(v.response,m)},v.onerror=function(){},v.send()}(p,l):wT(f,f.target="_blank"):wT(f)):(f.href=URL.createObjectURL(p),setTimeout(()=>{URL.revokeObjectURL(f.href)},4e4),setTimeout(()=>{wT(f)},0))}}S(mN,"cpName","DeleteCurrent");class yN extends Ti{constructor(l){super(l,{class:"ddv-button-download",callback:()=>{const u=this.injection.viewer,f=u.getActiveTab();u.context.core.fileSaveService.saveToPdf(f.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:Wt.annotationLicenseModuleIsExist()?"annotation":"none"}).then(g=>{vN(g,`${f.docName}.pdf`)})}}),N0(this)}}S(yN,"cpName","Download");class xN extends Ux{constructor(l){const{Delete_DeleteCurrent:u,Delete_DeleteAll:f}=sr.getDisplayTextConfig(),{Delete_DeleteCurrent:g,Delete_DeleteAll:m}=Kd;l.data.options=Fe(ne({},l.data.options),{children:[{type:"DeleteCurrent",label:u,id:g},{type:"DeleteAll",label:f,id:m}],defaultClassName:"ddv-delete-btn",showCheckIcon:!1}),super(l),Nr(this)}}S(xN,"cpName","Delete");class wN extends Ti{constructor(l){super(l,{class:"ddv-print-page",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex(),g=u.getActiveTab(),{displayMode:m}=g.context;"single"===m?u.context.core.printPages(g.uid,[f]):u.context.core.printPages(g.uid)}}),N0(this)}}S(wN,"cpName","Print");class CN extends Ti{constructor(l){super(l,{class:"ddv-crop-current",callback:()=>{this.cropEvent()}})}bindDefaultUi(){bN(this)}cropEvent(){const l=this.injection.viewer,u=l.getRectBox(),f=l.getCurrentPageIndex();u&&l.cropPages(u,[f])}}function bN(p){const l=p.injection.viewer,u=f=>{const g=Se(null==f?void 0:f.pageCount)?l.getPageCounts():f.pageCount,m=l.getRectBox();p.setUiState(g&&m?"normal":"disabled")};p.hooks.inserted.on(u),p.hooks.updated.on(u),l.hooks.pageExistenceChanged.on(u,p),l.hooks.cropRectDrawn.on(f=>{p.setUiState("normal")},p),l.hooks.cropRectDeleted.on(f=>{p.setUiState("disabled")},p)}S(CN,"cpName","CropCurrent");class _N extends Ti{constructor(l){super(l,{class:"ddv-crop-all",callback:()=>{this.cropEvent()}})}bindDefaultUi(){bN(this)}cropEvent(){const{viewer:l}=this.injection,u=l.getRectBox(),f=l.getCropIndices();u&&l.cropPages(u,f)}}S(_N,"cpName","CropAll");class SN extends Ti{constructor(l){super(l,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent()}})}perspectiveEvent(){const{viewer:l}=this.injection;l.perspectiveAllPage()}}S(SN,"cpName","PerspectiveAll");class EN extends Ti{constructor(l){super(l,{class:"ddv-full-quad",callback:()=>{this.toggleFull()}}),this.bindViewerHooks()}toggleFull(){const{viewer:l}=this.injection;l.toggleFullPerspective()}bindViewerHooks(){const{hooks:l}=this.injection.viewer;l.perspectiveQuadChanged.on(u=>{this.isFocused=u.isFull||!1,this.setUiState(u.isFull?"focused":"normal",!gi())},this)}}S(EN,"cpName","FullQuad");class TN extends Ti{constructor(l){super(l,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo()}}),this.$on("ui_cropClick",()=>{const u=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(u)})}bindDefaultUi(){DN("redo",this)}}function DN(p,l){const{viewer:u}=l.injection,f=()=>{const g=u.getOperationState();l.setUiState(("redo"===p?g.redo:g.undo)>0?"normal":"disabled")};l.hooks.inserted.on(f),l.hooks.updated.on(f),u.hooks.operationsChanged.on(g=>{let m="disabled";m="redo"===p?g.redo>0?"normal":"disabled":g.undo>0?"normal":"disabled",l.setUiState(m)},l)}S(TN,"cpName","Redo");class AN extends Ti{constructor(l){super(l,{class:"ddv-restore-page",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.reset(f)}}),Nr(this)}}S(AN,"cpName","Restore");class IN extends Ti{constructor(l){super(l,{class:"ddv-rotate-left",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.rotatePages(-90,[f])}}),Nr(this)}}S(IN,"cpName","RotateLeft");class PN extends Ti{constructor(l){super(l,{class:"ddv-rotate-right",callback:()=>{const{viewer:u}=this.injection,f=u.getCurrentPageIndex();u.rotatePages(90,[f])}}),Nr(this)}}S(PN,"cpName","RotateRight");class RN extends Ti{constructor(l){super(l,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo()}}),this.$on("ui_cropClick",()=>{const u=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(u)})}bindDefaultUi(){DN("undo",this)}}S(RN,"cpName","Undo");class MN extends Bx{constructor(l){super(l),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks()}initHooks(){const l=this.injection.viewer;l.hooks.toolModeChanged.on(u=>{const f="crop"===u.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(f?"focused":"normal"),this.togglePopup(f),this.isFirstClick&&f&&this.el.click()),this.$emit("ui_cropClick",f),this.$emit("ui_toolModeRefactor")},this),l.hooks.cropRectDrawn.on(()=>{bl(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1)},this),l.hooks.pageChanged.on(()=>{bl(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount())},this)}bindPullDownBoxEvents(){const{viewer:l}=this.injection,u=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),f=this.pullDownBox.getElementsByTagName("input")[1],g=this.pullDownBox.getElementsByTagName("input")[0],m=u.children[0],y=()=>{this.togglePopup(!1),l.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}})};this.nativeOn(u.children[1],"click",()=>{const x=l.getRectBox(),w=l.getCropIndices();x&&(l.cropPages(x,w),y())}),this.nativeOn(m,"click",y),this.nativeOn(this.el,"click",()=>{const x=l.rootDom,w=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];l.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor"),bl(w,!l.getRectBox()),this.isFirstClick&&(Oh(x,this.el,this.pullDownBox),this.isFirstClick=!1)}),this.nativeOn(f,"change",()=>{l.cropMode="all"}),this.nativeOn(g,"change",()=>{l.cropMode="current"})}bindPopupSwitchEvent(){}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{toolMode:f}=l.getViewerConfig();let g="disabled";l.getPageCounts()>0?("crop"===f&&this.el.click(),g=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(g)};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){}initTemplate(){const{defaultClass:l}=this,{options:u}=this.data,{popupBox:f}=u,{postfix:g,cropMode:m}=this.injection.viewer,{Crop_CropCurrent:v,Crop_CropAll:y,Crop_CropApply:x,Crop_CropCancel:w}=sr.getDisplayTextConfig(),{Crop_CropCurrent:C,Crop_CropAll:_,Crop_CropApply:T,Crop_CropCancel:M}=Kd,L="current"===m?'checked="checked"':"",N="all"===m?'checked="checked"':"";Aa(Ia(this),this.injection.viewer,u);const V=`<div ${Li(u,`ddv-button ${l}`)}>`+(Se(null==u?void 0:u.label)?"":`<span>${u.label}</span>`)+`<div ${Li(f,`${l}-box`)}><div><input ${L} type="radio" id="${C+g}" name="cropType" value="cropCurrent" /><label for="${C+g}">${v}</label><input ${N} type="radio" id="${_+g}" name="cropType" value="cropAll" /><label for="${_+g}">${y}</label></div><div class= "${l}-buttonGroup"><div id="${M+g}"><span>${w}</span></div><div id="${T+g}"><span>${x}</span></div></div></div></div>`;this.template=V}}S(MN,"cpName","Crop");class Yre extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-filter-item"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(l=>{this.bindEvents()}),this.hooks.inserted.on(()=>{this.bindFilterEvents()})}bindEvents(){const{el:l}=this;this.nativeOn(l,"click",()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:u}=this.data;this.$emit("ui_filterClick",u.type)})}bindFilterEvents(){this.$on("ui_filterReset",l=>{this.resetSelect(l.currentFilter);const{filterList:u}=l,{itemValue:f}=this.data,g=this.el.getElementsByTagName("img")[0];u.forEach(m=>{if(m.type===f.type){let v="";m.imageData&&(v=_3(m.imageData).data),g.src=v}})}),this.$on("ui_filterLoading",l=>{const u=this.el.getElementsByTagName("img")[0],f=this.el.getElementsByTagName("div")[0];u.style.display=l?"none":"",f.style.display=l?"":"none",this.el.style.pointerEvents=l?"none":""}),this.injection.viewer.hooks.filterChanged.on(l=>{this.resetSelect(l.filterType)},this)}resetSelect(l){const{itemValue:u}=this.data;l===u.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass)}initTemplate(){const{options:l,itemValue:u}=this.data,f=`<div ${Li(l,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${u.label}</span></div>`;this.template=f}}const Xre=[{type:"none",label:"Original"}];class kN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-filter"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"isFirstClick",!0),S(this,"box",void 0),S(this,"applyAll",!1),S(this,"filterList",void 0),S(this,"filterUpdateStatus",!1),S(this,"enableFilter",!1),S(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),Fx(this);const{filterService:u}=this.injection.viewer.context.core;u.enableFilter&&(this.enableFilter=!0,Nr(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),Fr.registerComponent({FilterItem:Yre})}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.bindNativeEvents()}),this.hooks.updated.on(()=>{this.uiState="normal"})}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{box:u}=this,g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Oh(g,this.el,this.box)},this)}bindViewerHooks(){var l=this;const u=this.injection.viewer;u.hooks.pageChanged.on(function(){var f=Q(function*(g){if(0===g.total)return l.filterUpdateStatus=!0,void l.togglePopup(!1);const m=u.context.getActiveTab();if(!m||!l.box)return;const{currentUid:v,oldCurrentUid:y}=m;y!==v&&(l.filterUpdateStatus=!0,l.togglePopup(!1))});return function(g){return f.apply(this,arguments)}}(),this),u.hooks.updatePage.on(f=>{var g;const m=u.context.getActiveTab();m&&this.box&&(null===(g=m.getCurrentPage())||void 0===g?void 0:g.uid)===f.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1))},this),u.hooks.visibleChanged.on(f=>{"hidden"===f.newVisibility&&this.togglePopup(!1)},this)}bindNativeEvents(){var l=this;const{el:u,box:f}=this,g=f.querySelector(`.${this.cssPrefix}list-header`),m=g.getElementsByTagName("span")[0],v=g.getElementsByTagName("div")[0];this.nativeOn(u,"click",function(){var y=Q(function*(x){l.togglePopup(),l.isFirstClick&&(Oh(l.injection.viewer.rootDom,l.el,l.box),l.isFirstClick=!1)});return function(x){return y.apply(this,arguments)}}()),this.nativeOn(f,"click",y=>{y.stopPropagation()}),this.nativeOn([m,v],"click",()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:y}=this.injection,x=y.getPageCounts(),w=y.getCurrentPageUid(),C=y.context.core.pageService.getPage(w);y.filter(Array.from(Array(x).keys()),C.filter)}})}bindFilterEvents(){this.$on("ui_filterClick",l=>{const{viewer:u}=this.injection,f=u.getPageCounts();if(f<1)return;let g=Array.from(Array(f).keys());if(!this.applyAll){const m=u.getCurrentPageUid();if(u.context.core.pageService.getPage(m).fileIndex===l)return;g=[u.getCurrentPageIndex()]}u.filter(g,l)})}clickApplyToAll(l){const g=document.getElementById(Kd.Filter_FilterAll+this.injection.viewer.postfix);if(Se(l))return this.applyAll?g.classList.remove(`${this.cssPrefix}checked`):g.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);l?g.classList.add(`${this.cssPrefix}checked`):g.classList.remove(`${this.cssPrefix}checked`),this.applyAll=l}updateFilterPreview(){var l=this;return Q(function*(){const u=l.injection.viewer,f=u.getCurrentPageUid(),g=yield u.context.core.imageDataService.getOriginal(f);if(!g)return;l.$emit("ui_filterLoading",!0);const m=[],v=u.context.core.pageService.getPage(f);let y;try{y=yield u.context.core.processService.resize(g.data,3,g.width,g.height,200)}catch(w){}for(let w=0;w<l.filterList.length;w++){const C=l.filterList[w];if("none"===C.type)m.push({type:"none",imageData:g.data});else{let _;try{var x;y&&null!==(x=y)&&void 0!==x&&x.data&&(_=yield u.context.core.filterService.applyFilter({data:y.data,type:Ri.JPEG,width:y.width,height:y.height},C.type))}catch(T){_=null}m.push({type:C.type,imageData:_})}}l.$emit("ui_filterLoading",!1),l.$emit("ui_filterReset",{currentFilter:v.filter||"none",filterList:m}),l.filterUpdateStatus=!1})()}initTemplate(){var l;const u=this.data,{options:f}=u,{popupBox:g,filterHeader:m,filterContent:v,valueList:y}=f,{filterService:x}=this.injection.viewer.context.core,w=Kd.Filter_FilterAll+this.injection.viewer.postfix;Aa(Ia(this),this.injection.viewer,f);const C=(null===(l=sr.getDisplayTextConfig())||void 0===l?void 0:l.Filter_FilterAll)||"Apply to All";u.valueList=y||Xre,x.enableFilter&&(u.valueList=x.getSupportedFilters()),this.filterList=u.valueList;const _=`<div ${Li(f,`ddv-button ${this.defaultClass}`)}>`+(Se(null==f?void 0:f.label)?"":`<span>${f.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Li(g,this.cssPrefix,"list")}><div id="${w}"${Li(m,this.cssPrefix,"list-header")}><div></div><span>${C}</span></div><div ${Li(v,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=_}togglePopup(l){var u=this;return Q(function*(){const{box:f}=u,{viewer:g}=u.injection;let m="none"===f.style.display;m=Se(l)?!m:!l,m?f.remove():(u.$emit("ui_hidePopup",u),g.rootDom.appendChild(f),u.filterUpdateStatus&&u.updateFilterPreview()),Qo(u.el,!m),f.style.display=m?"none":""})()}bindDefaultUi(){const l=this.injection.viewer,u=()=>{let f="normal";0!==l.getPageCounts()&&this.enableFilter||(f="disabled"),Nx(this,f)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S(kN,"cpName","Filter");class ON extends Ti{constructor(l){super(l,{class:"ddv-button-blank",callback:()=>{}})}bindDefaultUi(){}}class CT extends Ti{constructor(l){super(l,{class:"ddv-button-close",callback:()=>{}})}bindDefaultUi(){}}S(CT,"cpName","Close");class bT extends Ti{constructor(l){super(l,{class:"ddv-button-back",callback:()=>{}})}bindDefaultUi(){}}S(bT,"cpName","Back");class _T extends Ti{constructor(l){super(l,{class:"ddv-button-done",callback:()=>{}})}bindDefaultUi(){}}S(_T,"cpName","Done");const qre=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class LN extends Ux{constructor(l){const{DisplayMode_ContinuousPage:u,DisplayMode_SinglePage:f}=sr.getDisplayTextConfig(),{DisplayMode_ContinuousPage:g,DisplayMode_SinglePage:m}=Kd;l.data.options=Fe(ne({},l.data.options),{children:[{type:"ContinuousPage",label:u,id:g},{type:"SinglePage",label:f,id:m}],defaultClassName:"ddv-display-mode",showCheckIcon:!0}),super(l),Nr(this)}updateUiState(l){const{el:u}=this;qre.forEach((f,g)=>{l===f.displayName?(u.classList.add(f.className),this.selectChildren(g)):u.classList.remove(f.className)})}bindDefaultUi(){super.bindDefaultUi();const l=this.injection.viewer,u=()=>{const{displayMode:f}=l.getViewerConfig();this.updateUiState(f)};l.hooks.displayModeChanged.on(f=>{this.updateUiState(f.newDisplayMode)},this),l.hooks.openDocument.on(()=>{const f=l.context.getActiveTab();f&&this.updateUiState(f.context.displayMode)},this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S(LN,"cpName","DisplayMode");class ST extends Ti{constructor(l,u){super(l,{class:u.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:u.displayMode})}}),S(this,"displayMode",void 0),this.displayMode=u.displayMode,Nr(this)}bindDefaultUi(){const l=this.injection.viewer,u=f=>{var g;const m=l.getActiveTab(),v=(null==f?void 0:f.pageCount)||l.getPageCounts(),y=(null==m||null===(g=m.context)||void 0===g?void 0:g.displayMode)||l.getViewerConfig().displayMode;this.setUiState(v?y===this.displayMode?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.displayModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class FN extends ST{constructor(l){super(l,{class:"ddv-continuous-mode",displayMode:"continuous"})}}S(FN,"cpName","ContinuousPage");class NN extends ST{constructor(l){super(l,{class:"ddv-multiple-mode",displayMode:"multiple"})}}S(NN,"cpName","MultiPage");class BN extends ST{constructor(l){super(l,{class:"ddv-single-mode",displayMode:"single"})}}S(BN,"cpName","SinglePage");const Zre=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class UN extends Ux{constructor(l){const{FitMode_FitWindow:u,FitMode_FitWidth:f,FitMode_FitHeight:g,FitMode_ActualSize:m}=sr.getDisplayTextConfig(),{FitMode_FitWindow:v,FitMode_FitWidth:y,FitMode_FitHeight:x,FitMode_ActualSize:w}=Kd;l.data.options=Fe(ne({},l.data.options),{children:[{type:"FitWindow",label:u,id:v},{type:"FitWidth",label:f,id:y},{type:"FitHeight",label:g,id:x},{type:"ActualSize",label:m,id:w}],defaultClassName:"ddv-fit-type",showCheckIcon:!0}),super(l),Nr(this)}updateUiState(l){const{el:u}=this;"none"!==l?Zre.forEach((f,g)=>{l===f.displayName?(u.classList.add(f.className),this.selectChildren(g)):u.classList.remove(f.className)}):this.selectChildren(-1)}bindDefaultUi(){super.bindDefaultUi();const l=this.injection.viewer,u=()=>{const{fitMode:f}=l.getViewerConfig();this.updateUiState(f)};l.hooks.fitModeChanged.on(f=>{this.updateUiState(f.newFitMode)},this),l.hooks.openDocument.on(()=>{const f=l.context.getActiveTab();f&&this.updateUiState(f.context.fitMode)},this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}S(UN,"cpName","FitMode");class Hx extends Ti{constructor(l,u){super(l,{class:u.class,callback:()=>{const{viewer:f}=this.injection;f.updateViewerConfig({fitMode:u.fitMode})}}),S(this,"fitMode",void 0),this.fitMode=u.fitMode,Nr(this)}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const f=l.getPageCounts(),g=l.getActiveTab();let{fitMode:m}=l.getViewerConfig();g&&(m=g.context.fitMode),this.setUiState(f>0?f>0&&m===this.fitMode?"focused":"normal":"disabled")};l.hooks.pageExistenceChanged.on(u,this),l.hooks.fitModeChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}}class VN extends Hx{constructor(l){super(l,{class:"ddv-fit-height",fitMode:"height"})}}S(VN,"cpName","FitHeight");class jN extends Hx{constructor(l){super(l,{class:"ddv-fit-width",fitMode:"width"})}}S(jN,"cpName","FitWidth");class HN extends Hx{constructor(l){super(l,{class:"ddv-fit-window",fitMode:"window"})}}S(HN,"cpName","FitWindow");class WN extends Hx{constructor(l){super(l,{class:"ddv-fit-actual",fitMode:"actualSize"})}}S(WN,"cpName","ActualSize");class GN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks()}bindHooks(){const{inserted:l}=this.hooks;l.on(()=>{var u;null===(u=this.injection.viewer)||void 0===u||u.context.viewService.bindContainer(this.el)})}initTemplate(){const{options:l}=this.data;l.id=l.id||`ddvMainView${this.injection.viewer.postfix}`;const u=`<div ${Li(l,this.defaultClass,"")} ><slot></slot></div>`;this.template=u}}S(GN,"cpName","MainView");class zN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-pagination"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"uiState","normal"),S(this,"input",void 0),S(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi()}bindHooks(){this.hooks.created.on(l=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`)})}bindEvents(){const l=this.injection.viewer,u=this.query(`.${this.cssPrefix}goto`);this.nativeOn(u,"input",f=>{ET(u,this.totalSpan.clientWidth)}),this.nativeOn(u,"blur",()=>{const f=l.getPageCounts(),g=l.getCurrentPageIndex();let m=parseInt(u.value,10);Ve(m)?m<1?m=1:m>f&&(m=f):m=g+1,u.value=`${m}`,ET(u),l.gotoPage(m-1)}),this.nativeOn(u,"keydown",f=>{f.stopPropagation(),"Enter"===f.key&&u.blur()})}setState(l){this.uiState!==l&&this.el&&("normal"===l?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=l)}bindDefaultUi(){const l=this.injection.viewer,u=f=>{const g=Se(null==f?void 0:f.total)?l.getPageCounts():null==f?void 0:f.total,m=Se(null==f?void 0:f.current)?l.getCurrentPageIndex():null==f?void 0:f.current;this.setState(g>0?"normal":"disabled"),this.input.value=`${m+1}`,this.totalSpan.innerText=`${g}`,ET(this.input,this.totalSpan.clientWidth)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(()=>{this.uiState="normal",u(null)})}initTemplate(){const{options:l}=this.data,{gotoPage:u,total:f,separator:g}=l,{cssPrefix:m,injection:v,defaultClass:y}=this,{viewer:x}=v,w=x.getCurrentPageIndex()+1,C=x.getPageCounts(),_=`<div ${Li(l,y,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${Li(u,m,"goto")} value="${w}" type="number" ><div ${Li(g,m,"separator")}></div><span ${Li(f,m,"total")} >${C}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=_}}function ET(p,l){const{fontSize:u,width:f}=getComputedStyle(p);let g=function(v,y){const x=document.createElement("span");x.innerText=v,x.style.fontSize=y,x.style.position="absolute",x.style.top="0px",x.style.visibility="hidden",document.body.appendChild(x);const w=x.offsetWidth;return x.remove(),w}(p.value,u);Se(l)||0===l||(g=Math.min(l+10,g));const m=`${g+3}px`;f!==m&&(p.style.width=m)}S(zN,"cpName","Pagination");class Wx extends Ti{constructor(l,u){super(l,{class:u.class,callback:u.callback}),S(this,"type",void 0),this.type=u.type}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const f=l.getPageCounts(),g=l.getCurrentPageIndex();let m=!1;switch(this.type){case"previous":case"first":m=f>0&&0!==g;break;case"last":case"next":m=g<f-1}0===f&&(m=!1),this.setUiState(m?"normal":"disabled")};this.hooks.inserted.on(u),this.hooks.updated.on(u),l.hooks.pageChanged.on(u,this)}}class $N extends Wx{constructor(l){super(l,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0)}})}}S($N,"cpName","FirstPage");class YN extends Wx{constructor(l){super(l,{class:"ddv-last-page",type:"last",callback:()=>{const u=this.injection.viewer,f=u.getPageCounts();u.gotoPage(f-1)}})}}S(YN,"cpName","LastPage");class XN extends Wx{constructor(l){super(l,{class:"ddv-next-page",type:"next",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.gotoPage(f+1)}})}}S(XN,"cpName","NextPage");class qN extends Wx{constructor(l){super(l,{class:"ddv-prev-page",type:"previous",callback:()=>{const u=this.injection.viewer,f=u.getCurrentPageIndex();u.gotoPage(f-1)}})}}S(qN,"cpName","PrevPage");class ZN extends Ti{constructor(l){super(l,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:u}=this;if(!u)return;const{visibility:f}=u.getViewerConfig();u.updateViewerConfig({visibility:"visible"===f?"hidden":"visible"})}}),S(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",u=>{if(this.thumbnail)return;const f=this.injection.viewer.context.core.getViewer(u);f&&(this.thumbnail=f,this.bindThumbnailHooks(f));const{visibility:g}=f.getViewerConfig();this.setUiState("visible"===g?"focused":"normal",!gi())}),this.injection.viewer.hooks.destroy.on(()=>{this.thumbnail=null},this)}bindThumbnailHooks(l){l.hooks.visibleChanged.on(u=>{this.setUiState("visible"===u.newVisibility?"focused":"normal",!gi())},this)}bindDefaultUi(){const l=()=>{if(!this.thumbnail)return;const{visibility:u}=this.thumbnail.getViewerConfig();this.setUiState("visible"===u?"focused":"normal",!gi())};this.injection.viewer.hooks.pageExistenceChanged.on(l,this),this.hooks.updated.on(l)}}S(ZN,"cpName","ThumbnailSwitch");class TT extends Ti{constructor(l,u){super(l,{class:u.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:u.toolMode,canvasStyle:{cursor:u.cursor}})}}),S(this,"toolMode",void 0),this.toolMode=u.toolMode,this.bindViewerHooks()}bindDefaultUi(){const l=this.injection.viewer,u=()=>{const{toolMode:f}=l.getViewerConfig();l.getPageCounts()>0?this.setUiState(f===this.toolMode?"focused":"normal"):this.setUiState("disabled")};l.hooks.pageExistenceChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.toolModeChanged.on(u=>{const f=u.newToolMode===this.toolMode;l.getPageCounts()>0?this.setUiState(f?"focused":"normal"):this.setUiState("disabled")},this)}}class JN extends TT{constructor(l){super(l,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"})}}S(JN,"cpName","Pan"),S(class extends TT{constructor(p){super(p,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"})}},"cpName","ZoomMode");class QN extends TT{constructor(l){super(l,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"})}}S(QN,"cpName","CropMode");class DT extends Ti{constructor(l){super(l,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn()}}),this.bindViewerHooks(),Nr(this)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.zoomChanged.on(u=>{const{maxZoom:f}=l.getViewerConfig();l.getPageCounts()<1||u.newZoomRatio>=f?this.setUiState("disabled"):this.setUiState("normal")},this)}}S(DT,"cpName","ZoomIn");class AT extends Ti{constructor(l){super(l,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut()}}),this.bindViewerHooks(),Nr(this)}bindViewerHooks(){const l=this.injection.viewer;l.hooks.zoomChanged.on(u=>{const{minZoom:f}=l.getViewerConfig();l.getPageCounts()<1||u.newZoomRatio<=f?this.setUiState("disabled"):this.setUiState("normal")},this)}}S(AT,"cpName","ZoomOut");class KN extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-zoom-controller"),Fr.registerComponent({ZoomIn:DT,ZoomOut:AT}),this.initTemplate()}initTemplate(){const{options:l}=this.data;Aa(Ia(this),this.injection.viewer,l);const u=`<div ${Li(l,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=u}}S(KN,"cpName","Zoom");const Jre=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class eB extends Mn{constructor(l){super(l),S(this,"defaultClass","ddv-zoom-percentage"),S(this,"cssPrefix",`${this.defaultClass}-`),S(this,"isFirstClick",!0),S(this,"box",void 0),S(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),Nr(this),Fx(this),this.hooks.destroyed.on(()=>{this.dispose()})}bindHooks(){this.hooks.created.on(l=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents()}),this.hooks.inserted.on(()=>{const l=this.injection.viewer,{zoom:u}=l.getViewerConfig();this.updateZoom(u),this.updateZoomOption()}),this.hooks.updated.on(()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0})}bindDefaultUi(){const l=this.injection.viewer,u=()=>{Nx(this,0===l.getPageCounts()?"disabled":"normal"),this.updateZoom(l.getViewerConfig().zoom)};l.hooks.pageChanged.on(u,this),this.hooks.inserted.on(u),this.hooks.updated.on(u)}bindViewerHooks(){const{viewer:l}=this.injection,{hooks:u}=l;u.zoomChanged.on(f=>{this.updateZoom(f.newZoomRatio)},this),u.visibleChanged.on(f=>{if("hidden"===f.newVisibility)return void this.togglePopup(!1);const{zoom:g}=l.getViewerConfig();this.updateZoom(g)},this)}bindEvents(){const{el:l,box:u}=this,f=l.querySelector(`.${this.cssPrefix}selector`),g=l.getElementsByTagName("input")[0],m=u.getElementsByTagName("ul")[0];this.nativeOn(f,"click",()=>{const v=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Oh(v,this.el,this.box,!0,!0),this.isFirstClick=!1)}),this.inputEvent(g),this.ulEvent(m)}bindViewerResized(){const{viewer:l}=this.injection;l.hooks.resize.on(()=>{const{box:u}=this,g=this.injection.viewer.rootDom;"none"===u.style.display?this.isFirstClick=!0:Oh(g,this.el,this.box,!0,!0)},this)}inputEvent(l){const u=this.injection.viewer,{maxZoom:f,minZoom:g}=u.getViewerConfig();l.value=`${f}`;const m=LF(l);function v(){const x=Pi(l.value/100,g,f);u.updateViewerConfig({zoom:x})}this.nativeOn(l,"input",()=>{this.adaptInputWidth(m)}),this.nativeOn(l,"blur",v),this.nativeOn(l,"keydown",y=>{y.stopPropagation(),"Enter"===y.key&&v()})}ulEvent(l){this.nativeOn(l,"click",u=>{u.stopPropagation();const{viewer:f}=this.injection,{maxZoom:g,minZoom:m}=f.getViewerConfig(),v=u.target;if("LI"===v.tagName){const y=Pi(v.value,100*m,100*g);f.updateViewerConfig({zoom:y/100})}this.togglePopup(!1)})}getZoomOptionTemplate(){var l;const u=(null===(l=this.data.options)||void 0===l?void 0:l.valueList)||null,f=this.injection.viewer,{maxZoom:g,minZoom:m}=f.getViewerConfig(),v=Xt(u)?u:Jre,y=m<1e-4?.01:parseFloat((100*m).toFixed(2)),x=Math.floor(100*g);v.push(y,x);const w=Array.from(new Set(v)).sort((_,T)=>_-T);let C="";return w.forEach(_=>{Ve(_)&&_<=100*g&&_>=100*m&&(C+=`<li value="${_}">${_}%</li>`)}),C}updateZoomOption(){const l=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=l}updateZoom(l){const u=this.el.getElementsByTagName("input")[0],f=100*l;if(Number.isInteger(f))u.value=`${f}`;else{let g=f;g=g>=1e3?+g.toFixed(0).toString():g>=100?+g.toFixed(1).toString():g>=10?+g.toFixed(2).toString():+g.toFixed(3).toString(),u.value=`${g}`}this.adaptInputWidth()}initTemplate(){const{options:l={}}=this.data,{input:u,selector:f,popupBox:g}=l,{cssPrefix:m}=this,{viewer:v}=this.injection;Aa(Ia(this),v,l);const y=`<div ${Li(l,this.defaultClass)}><div style="display: flex"><div ${Li(u,m,"input")}><input type="number"><span>%</span></div><div ${Li(f,m,"selector")}><i></i></div></div><div ${Li(ne({id:`ddvZoomByPercentageSelectBox${v.postfix}`},g),m,"selectbox")}><ul></ul></div></div>`;this.template=y}adaptInputWidth(l){const u=this.el.getElementsByTagName("input")[0];let f=LF(u);l&&f>l&&(f=l),u.style.width=`${f}px`}togglePopup(l){const{viewer:u}=this.injection,{box:f}=this;let g="none"!==f.style.display;g=Se(l)?!g:l,g?(this.$emit("ui_hidePopup",this),u.rootDom.appendChild(f)):f.remove(),f.style.display=g?"":"none"}}S(eB,"cpName","ZoomByPercentage");class sr{static getTooltip(){return this.tooltip}static setTooltip(l){this.tooltip=ne(ne({},this.tooltip),l)}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(l){this.displayTextConfig=ne(ne({},this.displayTextConfig),l)}static registerAll(){Fr.registerComponent({Capture:cN,Flashlight:hN,CameraConvert:dN,CameraResolution:uN,AutoDetect:lN,AutoCapture:aN,ImagePreview:fN,RotateLeft:IN,RotateRight:PN,Delete:xN,DeleteAll:gN,DeleteCurrent:mN,Zoom:KN,ZoomIn:DT,ZoomOut:AT,ZoomByPercentage:eB,PerspectiveAll:SN,FullQuad:EN,Restore:AN,Undo:RN,Redo:TN,FitMode:UN,FitWidth:jN,FitHeight:VN,FitWindow:HN,ActualSize:WN,DisplayMode:LN,SinglePage:BN,MultiPage:NN,ContinuousPage:FN,Pan:JN,Print:wN,Filter:kN,ThumbnailSwitch:ZN,Back:bT,Done:_T,Pagination:zN,FirstPage:$N,LastPage:YN,NextPage:XN,PrevPage:qN,Root:MF,Layout:PF,Button:gT,MainView:GN,Load:pN,Download:yN,Close:CT,Blank:ON,SeparatorLine:kF,CropCurrent:CN,CropAll:_N,CropMode:QN,Crop:MN,AnnotationSet:Vx,EllipseAnnotation:NF,EraseAnnotation:BF,InkAnnotation:UF,LineAnnotation:VF,PolygonAnnotation:jF,PolylineAnnotation:HF,RectAnnotation:WF,SelectAnnotation:GF,StampIconAnnotation:zF,StampImageAnnotation:$F,TextBoxAnnotation:YF,TextTypewriterAnnotation:XF,BasePullDownButton:Bx,PullDownListButton:Ux,PullDownMenuButton:FF,BringForward:ZF,BringToFront:JF,SendBackward:QF,SendToBack:KF,AnnotationToolBar:eN,AnnotationDeleteButton:iN,AnnotationPaletteButton:tN,AnnotationPalette:oN})}}S(sr,"tooltip",{}),S(sr,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const Qre={install(p){const l=function(u){var f,g,m,v;return f=new WeakMap,g=new WeakMap,m=new WeakMap,v=new WeakSet,class extends u{constructor(x){super(x),Js(this,v),S(this,"ui",void 0),S(this,"rootDom",void 0),Ht(this,f,!1),Ht(this,g,0),Ht(this,m,0),sr.registerAll();const w=x.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==x?void 0:x.annotationToolBarConfig)||{},annotationPaletteConfig:(null==x?void 0:x.annotationPaletteConfig)||{}}):[];this.ui=new Fr({container:x.container,emitter:this.emitter,postfix:this.uid,uiConfig:x.uiConfig,popupUiConfig:w,injection:{viewer:this}}),x.container&&(x.uiConfig?(this.bindContainer(x.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi()}listenNativeEventsForUi(){this.on("click",()=>{this.emit("ui_hidePopup","viewer")})}getPopupUiConfig(x){return[Fe(ne({},x.annotationToolBarConfig),{type:"AnnotationToolBar"}),Fe(ne({colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0},x.annotationPaletteConfig),{type:"AnnotationPalette"})]}addFontToUi(x){this.emit("ui_addFont",x)}getUiConfig(){return qe(this.ui.uiConfig)}updateUiConfig(x){const{resizeService:w}=this.context.core;w&&(w.unobserve(this.ui.rootDom),gt(f,this,!1));const C=this.ui.updateUiConfig(x);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,ye(v,this,y).call(this,this.ui.rootDom),C}getElementsByType(x){return nt(x)?this.ui.getElementsByType(this.ui.rootVNode,x):""}bindContainer(x){let w=x;return nt(x)&&(w=document.querySelector(`#${x}`)),w instanceof HTMLElement&&(ye(v,this,y).call(this,this.ui.rootDom),this.ui.bindContainer(w),this.context.viewService.container=w,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1)}dispose(){var x;super.dispose(),null===(x=this.ui)||void 0===x||x.dispose()}};function y(x){if(ee(f,this))return;const{resizeService:w}=this.context.core;w.observe(x),this.register(w.onResizeObserver.on(C=>{if(C.target===x){var _;let T=0,M=0;if((null===(_=C.borderBoxSize)||void 0===_?void 0:_.length)>0){const N=C.borderBoxSize[0];T=N.inlineSize,M=N.blockSize}else T=x.offsetWidth,M=x.offsetHeight;const L=_E.create(ee(g,this),ee(m,this),T,M);gt(g,this,T),gt(m,this,M),this.hooks.resize.emit(L),this.emit("resized",{oldWidth:L.oldWidth,oldHeight:L.oldHeight,newWidth:L.newWidth,newHeight:L.newHeight})}})),this.hooks.destroy.on(()=>{w.unobserve(x)}),gt(f,this,!0)}}(p.getClass("Viewer"));p.setClass("Viewer",l)}};function pe(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function hi(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"function"==typeof SuppressedError&&SuppressedError;const tB="undefined"==typeof self;let B0,U0,Gx,IT,kn;function br(p,l,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?p!==l||!f:!l.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(p):f?f.value:l.get(p)}function Ra(p,l,u,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?p!==l||!g:!l.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(p,u):g?g.value=u:l.set(p,u),u}"undefined"!=typeof navigator&&(B0=navigator,U0=B0.userAgent,Gx=B0.platform,IT=B0.mediaDevices),function(){if(!tB){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:B0.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Gx,search:"Win"},Mac:{str:Gx},Linux:{str:Gx}};let u="unknownBrowser",f=0,g="unknownOS";for(let m in p){const v=p[m]||{};let w=v.verStr||U0,C=v.verSearch||m;if(C instanceof Array||(C=[C]),-1!=(v.str||U0).indexOf(v.search||m)){u=m;for(let _ of C){let T=w.indexOf(_);if(-1!=T){f=parseFloat(w.substring(T+_.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||U0).indexOf(v.search||m)){g=m;break}}"Linux"==g&&-1!=U0.indexOf("Windows NT")&&(g="HarmonyOS"),kn={browser:u,version:f,OS:g}}tB&&(kn={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;class wo{static multiply(l,u){const f=[];for(let g=0;g<3;g++){const m=u.slice(3*g,3*g+3);for(let v=0;v<3;v++){const y=[l[v],l[v+3],l[v+6]].reduce((x,w,C)=>x+w*m[C],0);f.push(y)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,f){return wo.multiply(l,[1,0,0,0,1,0,u,f,1])}static rotate(l,u){var f=Math.cos(u),g=Math.sin(u);return wo.multiply(l,[f,-g,0,g,f,0,0,0,1])}static scale(l,u,f){return wo.multiply(l,[u,0,0,0,f,0,0,0,1])}}var Hi,Sc,Ec,zx,Sp,V0,j0,Ep,$x,tu,Yx,PT,ft,Gt,yi,Xx,qx,Xi,Ko,Tc,H0,Zx,_l,Dc,Co,Tp,Dp,W0,Jx,Ap,iu,Ac,Ic,RT,ds,MT,nu,Ip,Qx,Kx,iB,Ma,kT,OT,Pp,G0,ew,bo,Rp,LT,FT,nB;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(Hi||(Hi={}));class Ot{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Ra(Ot,Sc,!1,"f",Ec),!1):(Ra(Ot,Sc,!0,"f",Ec),!0)}get disposed(){return br(this,$x,"f")}constructor(){zx.set(this,Hi.RGBA),Sp.set(this,null),V0.set(this,null),j0.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ep.set(this,null),$x.set(this,!1)}drawImage(l,u,f,g,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==br(Ot,Sc,"f",Ec)&&Ot.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!br(Ot,Sc,"f",Ec))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let y;Ot._onLog&&(y=Date.now(),Ot._onLog("drawImage(), START: "+y));let x=0,w=0,C=f,_=g,T=0,M=0,L=f,N=g;m&&(m.sx&&(x=Math.round(m.sx)),m.sy&&(w=Math.round(m.sy)),m.sWidth&&(C=Math.round(m.sWidth)),m.sHeight&&(_=Math.round(m.sHeight)),m.dx&&(T=Math.round(m.dx)),m.dy&&(M=Math.round(m.dy)),m.dWidth&&(L=Math.round(m.dWidth)),m.dHeight&&(N=Math.round(m.dHeight)));let V,H=Hi.RGBA;if((null==v?void 0:v.pixelFormat)&&(H=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&(V=v.bufferContainer,V.length<4*L*N))throw new Error("Unexpected size of the 'bufferContainer'.");const G=l;if(!br(Ot,Sc,"f",Ec)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){Ot._onLog&&Ot._onLog("drawImage() in context2d."),G.ctx2d||(G.ctx2d=G.getContext("2d",{willReadFrequently:!0}));const z=G.ctx2d;if(!z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N),z.drawImage(u,x,w,C,_,T,M,L,N),Ot._onLog&&Ot._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:Hi.RGBA,bUseWebGL:!1}}Ot._onLog&&Ot._onLog("drawImage() in WebGL.");try{(G.width<T+L||G.height<M+N)&&(G.width=T+L,G.height=M+N,G.ctxWebGL&&G.ctxWebGL.viewport(0,0,T+L,M+N));const z=G.ctxWebGL||G.getContext("webgl",{antialias:!1})||G.getContext("experimental-webgl",{antialias:!1});if(!z){Ot._onLog&&Ot._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const j=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw j.name="WebGLError",j}if(!G.ctxWebGL||H!==br(this,zx,"f")){G.ctxWebGL=z;const j=b=>{const D=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,D),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW);const k=b.createBuffer();return b.bindBuffer(b.ARRAY_BUFFER,k),b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),b.STATIC_DRAW),{positions:D,texCoords:k}},le=b=>{const D=b.createTexture();return b.bindTexture(b.TEXTURE_2D,D),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),D},ue=(b,D)=>{const k=b.createProgram();if(D.forEach(U=>b.attachShader(k,U)),b.linkProgram(k),!b.getProgramParameter(k,b.LINK_STATUS)){const U=new Error(`An error occured linking the program: ${b.getProgramInfoLog(k)}.`);throw U.name="WebGLError",U}return b.useProgram(k),k},xe=(b,D,k)=>{const U=b.createShader(D);if(b.shaderSource(U,k),b.compileShader(U),!b.getShaderParameter(U,b.COMPILE_STATUS)){const F=new Error(`An error occured compiling the shader: ${b.getShaderInfoLog(U)}.`);throw F.name="WebGLError",F}return U},I="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let A="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(A=H.slice(0,3));const P=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${A} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,O=ue(z,[xe(z,z.VERTEX_SHADER,I),xe(z,z.FRAGMENT_SHADER,P)]);Ra(this,V0,{program:O,attribLocations:{vertexPosition:z.getAttribLocation(O,"a_position"),texPosition:z.getAttribLocation(O,"a_texCoord")},uniformLocations:{uSampler:z.getUniformLocation(O,"u_image"),uColorFactor:z.getUniformLocation(O,"uColorFactor"),uMatrix:z.getUniformLocation(O,"u_matrix"),uTextureMatrix:z.getUniformLocation(O,"u_textureMatrix")}},"f"),Ra(this,j0,j(z),"f"),Ra(this,Sp,le(z),"f"),Ra(this,zx,H,"f")}const q=(j,le,ue)=>{j.bindBuffer(j.ARRAY_BUFFER,le),j.enableVertexAttribArray(ue),j.vertexAttribPointer(ue,2,j.FLOAT,!1,0,0)},se=(j,le,ue,xe)=>{j.clearColor(0,0,0,1),j.clearDepth(1),j.enable(j.DEPTH_TEST),j.depthFunc(j.LEQUAL),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT),q(j,ue.positions,le.attribLocations.vertexPosition),q(j,ue.texCoords,le.attribLocations.texPosition),j.activeTexture(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,xe),j.uniform1i(le.uniformLocations.uSampler,0),j.uniform1f(le.uniformLocations.uColorFactor,[Hi.GREY,Hi.GREY32].includes(H)?1:0);let I,A,P=wo.translate(wo.identity(),-1,-1);P=wo.scale(P,2,2),P=wo.scale(P,1/j.canvas.width,1/j.canvas.height),I=wo.translate(P,T,M),I=wo.scale(I,L,N),j.uniformMatrix3fv(le.uniformLocations.uMatrix,!1,I),A=wo.translate(wo.identity(),x/f,w/g),A=wo.scale(A,C/f,_/g),j.uniformMatrix3fv(le.uniformLocations.uTextureMatrix,!1,A),j.drawArrays(j.TRIANGLES,0,6)};((j,le,ue)=>{const xe=j.RGBA,I=j.RGBA,A=j.UNSIGNED_BYTE;j.bindTexture(j.TEXTURE_2D,le),j.texImage2D(j.TEXTURE_2D,0,xe,I,A,ue)})(z,br(this,Sp,"f"),u),se(z,br(this,V0,"f"),br(this,j0,"f"),br(this,Sp,"f"));const ae=V||new Uint8Array(4*L*N);if(z.readPixels(T,M,L,N,z.RGBA,z.UNSIGNED_BYTE,ae),255!==ae[3]){Ot._onLog&&Ot._onLog("Incorrect WebGL drawing .");const j=new Error("WebGL error: incorrect drawing.");throw j.name="WebGLError",j}return Ot._onLog&&Ot._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:z,pixelFormat:H===Hi.GREY?Hi.GREY32:H,bUseWebGL:!0}}catch(z){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return Ot._onLog&&Ot._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,f,g,m,Object.assign({},v,{bUseWebGL:!1}));throw z.name="WebGLError",z}}readCvsData(l,u,f){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,m=0,v=0,y=l.canvas.width,x=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(y=u.width),u.height&&(x=u.height)),(null==f?void 0:f.length)<4*y*x)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const w=l;f?(w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*y*x)):(g=new Uint8Array(4*y*x),w.readPixels(m,v,y,x,w.RGBA,w.UNSIGNED_BYTE,g))}else if(l instanceof CanvasRenderingContext2D){let w;w=l.getImageData(m,v,y,x),g=new Uint8Array(w.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(l,u,f,g){let m,v;if(Ot._onLog&&(m=Date.now(),Ot._onLog("transformPixelFormat(), START: "+m)),u===f)return Ot._onLog&&Ot._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),g?new Uint8Array(l):l;const y=[Hi.RGBA,Hi.RBGA,Hi.GRBA,Hi.GBRA,Hi.BRGA,Hi.BGRA];if(y.includes(u))if(f===Hi.GREY){v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=.21*l[x]+.71*l[x+1]+.07*l[x+2]}else if(f===Hi.GREY32){v=g?new Uint8Array(l):l;for(let x=0;x<l.length;x+=4){const w=.21*l[x]+.71*l[x+1]+.07*l[x+2];v[x]=w,v[x+1]=w,v[x+2]=w}}else{if(!y.includes(f))throw new Error("Unable to transform.");if(g){v=new Uint8Array(l);const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4)v[L+_]=l[L+x],v[L+T]=l[L+w],v[L+M]=l[L+C]}else{v=l;const x=u.indexOf("r"),w=u.indexOf("g"),C=u.indexOf("b"),_=f.indexOf("r"),T=f.indexOf("g"),M=f.indexOf("b");for(let L=0;L<l.length;L+=4){let N=[l[L],l[L+1],l[L+2]];v[L+_]=N[x],v[L+T]=N[w],v[L+M]=N[C]}}}else if(u===Hi.GREY){if(f!==Hi.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let x=0;x<l.length;x++)v[4*x]=l[x],v[4*x+1]=l[x],v[4*x+2]=l[x],v[4*x+3]=255}else{if(u!==Hi.GREY32)throw new Error("Unable to transform.");if(f!==Hi.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let x=0;x<l.length;x+=4)v[x/4]=l[x]}return Ot._onLog&&Ot._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,f,g,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==br(Ot,Sc,"f",Ec)&&Ot.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!br(Ot,Sc,"f",Ec))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>u||g.sy>f||g.sx+g.sWidth>u||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;Ot._onLog&&(v=Date.now(),Ot._onLog("getImageData(), START: "+v));const y=Math.round(g.sx),x=Math.round(g.sy),w=Math.round(g.sWidth),C=Math.round(g.sHeight),_=Math.round(g.dWidth),T=Math.round(g.dHeight);let M=Hi.RGBA;(null==m?void 0:m.pixelFormat)&&(M=m.pixelFormat);let L,N,V,H=null;if((null==m?void 0:m.bufferContainer)&&(H=m.bufferContainer),br(Ot,Sc,"f",Ec)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){Ot._onLog&&Ot._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),L=this._reusedWebGLCvs;try{if(H)if(M===Hi.GREY){if(V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}}else N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:H}),V=new Uint8Array(H.buffer,0,4*_*T),V=this.transformPixelFormat(V,N.pixelFormat,M);else M===Hi.GREY?((!br(this,Ep,"f")||br(this,Ep,"f").length<4*_*T)&&Ra(this,Ep,new Uint8Array(4*_*T),"f"),V=new Uint8Array(br(this,Ep,"f").buffer,0,4*_*T)):V=new Uint8Array(4*_*T),N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:M,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,N.pixelFormat,M)}catch(G){if("WebGLError"===G.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return Ot._onLog&&Ot._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},Object.assign({},m,{bUseWebGL:!1}));throw G}}else if(Ot._onLog&&Ot._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),L=this._reusedCvs,N=this.drawImage(L,l,u,f,{sx:y,sy:x,sWidth:w,sHeight:C,dWidth:_,dHeight:T},{pixelFormat:Hi.RGBA,bUseWebGL:!1}),V=this.readCvsData(N.context,{width:_,height:T},null),V=this.transformPixelFormat(V,N.pixelFormat,M),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}return Ot._onLog&&Ot._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:V,pixelFormat:M,width:_,height:T,bUseWebGL:N.bUseWebGL}}convertDataToCvs(l,u,f,g){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=f,g===Hi.GREY){v=new Uint8ClampedArray(4*u*f);for(let x=0;x<v.length;x+=4)v[x]=l[x/4],v[x+1]=l[x/4],v[x+2]=l[x/4],v[x+3]=255}else v=new Uint8ClampedArray(l.buffer);const y=new ImageData(v,u,f);return m.getContext("2d").putImageData(y,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),Ra(this,Sp,null,"f"),Ra(this,V0,null,"f"),Ra(this,j0,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Ra(this,$x,!0,"f")}}Sc=Ot,zx=new WeakMap,Sp=new WeakMap,V0=new WeakMap,j0=new WeakMap,Ep=new WeakMap,$x=new WeakMap,Ec={value:void 0};class Kre{constructor(){tu.set(this,new Map),Yx.set(this,!1)}get disposed(){return pe(this,Yx,"f")}on(l,u){l=l.toLowerCase();const f=pe(this,tu,"f").get(l);if(f){if(f.includes(u))return;f.push(u)}else pe(this,tu,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const f=pe(this,tu,"f").get(l);if(!f)return;const g=f.indexOf(u);-1!==g&&f.splice(g,1)}offAll(l){l=l.toLowerCase();const u=pe(this,tu,"f").get(l);u&&(u.length=0)}fire(l){var u=arguments,f=this;return Q(function*(){let g=u.length>1&&void 0!==u[1]?u[1]:[],m=u.length>2&&void 0!==u[2]?u[2]:{async:!1,copy:!0};g||(g=[]),l=l.toLowerCase();const v=pe(f,tu,"f").get(l);if(v&&v.length){m=Object.assign({async:!1,copy:!0},m);for(let y of v){if(!y)continue;let x=[];if(m.copy)for(let C of g){try{C=JSON.parse(JSON.stringify(C))}catch(_){}x.push(C)}else x=g;let w=!1;if(m.async)setTimeout(()=>{f.disposed||y.apply(m.target,x)},0);else try{w=yield y.apply(m.target,x)}catch(C){}if(!0===w)break}}})()}dispose(){hi(this,Yx,!0,"f")}}tu=new WeakMap,Yx=new WeakMap;const Br=(p,l,u,f)=>{if(!u)return p;let g=l+Math.round((p-l)/u)*u;return f&&(g=Math.min(g,f)),g};class Vt{static get version(){return"2.0.0-16"}static isStorageAvailable(l){let u;try{u=window[l];const f="__storage_test__";return u.setItem(f,f),u.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let f=!1;if((null==u?void 0:u.getMainCamera)&&(f=!0),f){const g=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>g.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const g=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],y=l.filter(C=>{const _=C.label.toLowerCase();return g.some(T=>_.includes(T))});if(!y.length)return null;const x=y.find(C=>{const _=C.label.toLowerCase();return m.some(T=>_.includes(T))});if(x)return x.deviceId;const w=y.find(C=>{const _=C.label.toLowerCase();return v.some(T=>_.includes(T))});return w?w.deviceId:y[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(kn.OS))return Vt.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let g of l){const m=g.label.toLowerCase();if(m&&f.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return g.deviceId}return["Android","HarmonyOS"].includes(kn.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,f){return l&&l.length?"environment"===u?this.findBestRearCamera(l,f):"user"===u?null:u?void 0:null:null}static playVideo(l,u,f){return Q(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,new Promise((g,m)=>{let v;const y=()=>{l.removeEventListener("loadstart",C),l.removeEventListener("abort",_),l.removeEventListener("play",T),l.removeEventListener("error",M)},x=()=>{v&&clearTimeout(v),y(),g(l)},w=L=>{v&&clearTimeout(v),y(),m(L)},C=()=>{l.addEventListener("abort",_,{once:!0})},_=()=>{const L=new Error("Video playing was interrupted.");L.name="AbortError",w(L)},T=()=>{x()},M=()=>{w(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};l.addEventListener("loadstart",C,{once:!0}),l.autoplay&&["iPhone","iPad","Mac"].includes(kn.OS)&&kn.version>=17?(l.addEventListener("play",T,{once:!0}),l.addEventListener("error",M,{once:!0})):(l.load(),l.play().then(()=>{x()}).catch(L=>{w(L)})),f&&(v=setTimeout(()=>{y(),m(new Error("Failed to play video. Timeout."))},f))})})()}static testCameraAccess(l){return Q(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==g||g.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!pe(this,Co,"f"))return"closed";if("pending"===pe(this,Co,"f"))return"opening";if("fulfilled"===pe(this,Co,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l&&Vt.isStorageAvailable("localStorage")?hi(this,H0,!0,"f"):hi(this,H0,!1,"f")}get ifSaveLastUsedCamera(){return pe(this,H0,"f")}get isVideoPlaying(){return!(!pe(this,Gt,"f")||pe(this,Gt,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,f,g;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=pe(this,iu,"f"))||void 0===u||u.removeEventListener("click",pe(this,Ap,"f")),null===(f=pe(this,iu,"f"))||void 0===f||f.removeEventListener("touchend",pe(this,Ap,"f")),null===(g=pe(this,iu,"f"))||void 0===g||g.removeEventListener("touchmove",pe(this,Jx,"f")),hi(this,iu,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(kn.OS)?(l.addEventListener("touchend",pe(this,Ap,"f")),l.addEventListener("touchmove",pe(this,Jx,"f"))):l.addEventListener("click",pe(this,Ap,"f")))}get tapFocusEventBoundEl(){return pe(this,iu,"f")}get disposed(){return pe(this,Kx,"f")}constructor(l){var f,g,u=this;ft.add(this),Gt.set(this,null),yi.set(this,void 0),Xx.set(this,()=>{"opened"===this.state&&pe(this,ds,"f").fire("resumed",null,{target:this,async:!0})}),qx.set(this,()=>{pe(this,ds,"f").fire("paused",null,{target:this,async:!1})}),Xi.set(this,void 0),Ko.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],Tc.set(this,void 0),H0.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Zx.set(this,void 0),_l.set(this,!0),Dc.set(this,void 0),Co.set(this,void 0),Tp.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Dp.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let y,x;const w=window.getComputedStyle(pe(this,Gt,"f")).objectFit,C=this.getResolution(),_=pe(this,Gt,"f").getBoundingClientRect(),T=_.left,M=_.top,{width:L,height:N}=pe(this,Gt,"f").getBoundingClientRect();if(L<=0||N<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const V=L/N,H=C.width/C.height;let G=1;if("contain"===w)H>V?(G=L/C.width,y=(m-T)/G,x=(v-M-(N-L/H)/2)/G):(G=N/C.height,x=(v-M)/G,y=(m-T-(L-N*H)/2)/G);else{if("cover"!==w)throw new Error("Unsupported object-fit.");H>V?(G=N/C.height,x=(v-M)/G,y=(m-T+(N*H-L)/2)/G):(G=L/C.width,y=(m-T)/G,x=(v-M+(L/H-N)/2)/G)}return{x:y,y:x}},W0.set(this,!1),Jx.set(this,()=>{hi(this,W0,!0,"f")}),Ap.set(this,function(){var m=Q(function*(v){var y;if(pe(u,W0,"f"))return void hi(u,W0,!1,"f");if(!(pe(u,Dp,"f")&&u.isVideoPlaying&&pe(u,yi,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(y=u.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let x,w;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)x=v.clientX,w=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;x=v.changedTouches[0].clientX,w=v.changedTouches[0].clientY}const C=u.getResolution(),_=2*Math.round(Math.min(C.width,C.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let T;try{T=u.calculateCoordInVideo(x,w)}catch(H){}if(T.x<0||T.x>C.width||T.y<0||T.y>C.height)return;const M={x:T.x+"px",y:T.y+"px"},L=_+"px",N=L;let V;Vt._onLog&&(V=Date.now());try{yield pe(u,ft,"m",LT).call(u,M,L,N,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(H){if(Vt._onLog)throw Vt._onLog(H),H}Vt._onLog&&Vt._onLog(`Tap focus costs: ${Date.now()-V} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var H;Vt._onLog&&Vt._onLog("Back to continuous focus."),null===(H=pe(u,yi,"f"))||void 0===H||H.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),pe(u,ds,"f").fire("tapfocus",null,{target:u,async:!0})});return function(v){return m.apply(this,arguments)}}()),iu.set(this,null),Ac.set(this,1),Ic.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!pe(this,Gt,"f"))return;const m=pe(this,Ac,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)pe(this,Gt,"f").style.transform="";else{const v=window.getComputedStyle(pe(this,Gt,"f")).objectFit,y=pe(this,Gt,"f").videoWidth,x=pe(this,Gt,"f").videoHeight,{width:w,height:C}=pe(this,Gt,"f").getBoundingClientRect();if(w<=0||C<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const _=w/C,T=y/x;let M=1;"contain"===v?M=_<T?w/(y/m):C/(x/m):"cover"===v&&(M=T>_?C/(y/m):w/(x/m));const L=M*(1-1/m)*(y/2-pe(this,Ic,"f").x),N=M*(1-1/m)*(x/2-pe(this,Ic,"f").y);pe(this,Gt,"f").style.transform=`translate(${L}px, ${N}px) scale(${m})`}},RT.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===Hi.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<v.length;x+=4)v[x]=this.data[x/4],v[x+1]=this.data[x/4],v[x+2]=this.data[x/4],v[x+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const y=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(y,0,0),m}),ds.set(this,void 0),MT.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],nu.set(this,new Map),Ip.set(this,!1),Qx.set(this,Q(function*(){var m,v;if("visible"===document.visibilityState){if(Vt._onLog&&Vt._onLog("document visible. video paused: "+(null===(m=pe(u,Gt,"f"))||void 0===m?void 0:m.paused)),pe(u,Ip,"f")&&pe(u,Gt,"f")&&u.videoSrc&&"opened"===u.state)return void u.resume().catch(()=>{});if(!u._mediaStream)return;if(u._mediaStream.active&&pe(u,yi,"f"))if(pe(u,yi,"f").muted&&["iPhone","iPad","Mac"].includes(kn.OS)){if(kn.version>=17)return;yield pe(u,ft,"m",Pp).call(u)}else pe(u,Ip,"f")&&u.resume().catch(()=>{});else yield pe(u,ft,"m",Pp).call(u)}else if("hidden"===document.visibilityState&&(Vt._onLog&&Vt._onLog("document hidden. video paused: "+(null===(v=pe(u,Gt,"f"))||void 0===v?void 0:v.paused)),["iPhone","iPad","Mac"].includes(kn.OS)?hi(u,Ip,!0,"f"):hi(u,Ip,u.isVideoPlaying,"f"),u.isVideoLoaded()&&"opened"==u.state)){if(["iPhone","iPad","Mac"].includes(kn.OS)&&kn.version>=17)return;u.pause()}})),Kx.set(this,!1),(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia)||setTimeout(()=>{Vt.onWarning&&Vt.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),hi(this,ds,new Kre,"f"),this.imageDataGetter=new Ot,document.addEventListener("visibilitychange",pe(this,Qx,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",pe(this,Xx,"f")),l.addEventListener("pause",pe(this,qx,"f")),hi(this,Gt,l,"f")}getVideoEl(){return pe(this,Gt,"f")}releaseVideoEl(){var l,u;null===(l=pe(this,Gt,"f"))||void 0===l||l.removeEventListener("play",pe(this,Xx,"f")),null===(u=pe(this,Gt,"f"))||void 0===u||u.removeEventListener("pause",pe(this,qx,"f")),hi(this,Gt,null,"f")}isVideoLoaded(){return!!pe(this,Gt,"f")&&4==pe(this,Gt,"f").readyState}open(){var l=this;return Q(function*(){if(pe(l,Dc,"f")&&!pe(l,_l,"f")){if("pending"===pe(l,Co,"f"))return pe(l,Dc,"f");if("fulfilled"===pe(l,Co,"f"))return}pe(l,ds,"f").fire("before:open",null,{target:l}),yield pe(l,ft,"m",Pp).call(l),pe(l,ds,"f").fire("opened",null,{target:l,async:!0}),pe(l,ds,"f").fire("played",null,{target:l,async:!0})})()}close(){var l=this;return Q(function*(){if("closed"===l.state)return;pe(l,ds,"f").fire("before:close",null,{target:l});const u=pe(l,Dc,"f");if(pe(l,ft,"m",ew).call(l),u&&"pending"===pe(l,Co,"f")){try{yield u}catch(f){}if(!1===pe(l,_l,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}hi(l,Dc,null,"f"),hi(l,Co,null,"f"),pe(l,ds,"f").fire("closed",null,{target:l,async:!0})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");pe(this,Gt,"f").pause()}resume(){var l=this;return Q(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield pe(l,Gt,"f").play()})()}setCamera(l){var u=this;return Q(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof pe(u,Xi,"f").video&&(pe(u,Xi,"f").video={}),delete pe(u,Xi,"f").video.facingMode,pe(u,Xi,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&pe(u,_l,"f"))){pe(u,ds,"f").fire("before:camera:change",[],{target:u,async:!1}),yield pe(u,ft,"m",G0).call(u);try{u.resetSoftwareScale()}catch(f){}return pe(u,Ko,"f")}})()}switchToFrontCamera(l){var u=this;return Q(function*(){if("object"!=typeof pe(u,Xi,"f").video&&(pe(u,Xi,"f").video={}),(null==l?void 0:l.resolution)&&(pe(u,Xi,"f").video.width={ideal:l.resolution.width},pe(u,Xi,"f").video.height={ideal:l.resolution.height}),delete pe(u,Xi,"f").video.deviceId,pe(u,Xi,"f").video.facingMode={exact:"user"},hi(u,Tc,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&pe(u,_l,"f"))){pe(u,ds,"f").fire("before:camera:change",[],{target:u,async:!1}),pe(u,ft,"m",G0).call(u);try{u.resetSoftwareScale()}catch(f){}return pe(u,Ko,"f")}})()}getCamera(){var l;if(pe(this,Ko,"f"))return pe(this,Ko,"f");{let u=(null===(l=pe(this,Xi,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let f of this._arrCameras)if(f.deviceId===u)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return Q(function*(){var f,g;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let x=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(w=>"videoinput"===w.kind),x.getTracks().forEach(w=>{w.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(x=>"videoinput"===x.kind);const v=[],y=[];if(u._arrCameras)for(let x of u._arrCameras)x._checked&&y.push(x);for(let x=0;x<m.length;x++){let w,C=m[x];for(let _ of y)if(C.deviceId==_.deviceId){w=_;break}w||(w={deviceId:C.deviceId,label:C.label?C.label:"camera "+x,_checked:!1}),w.deviceId&&v.push(w)}return u._arrCameras=v,Vt._onLog&&Vt._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return Q(function*(){var u,f;if(!(null===(f=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===f?void 0:f.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const g=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!g||!g.length||g[0].deviceId))})()}getAllCameras(){var l=this;return Q(function*(){return l.getCameras()})()}setResolution(l,u,f){var g=this;return Q(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof pe(g,Xi,"f").video&&(pe(g,Xi,"f").video={}),f?(pe(g,Xi,"f").video.width={exact:l},pe(g,Xi,"f").video.height={exact:u}):(pe(g,Xi,"f").video.width={ideal:l},pe(g,Xi,"f").video.height={ideal:u}),"closed"===g.state||g.videoSrc||"opening"===g.state&&pe(g,_l,"f"))return null;pe(g,ds,"f").fire("before:resolution:change",[],{target:g,async:!1}),yield pe(g,ft,"m",G0).call(g);try{g.resetSoftwareScale()}catch(v){}const m=g.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&pe(this,Gt,"f"))return{width:pe(this,Gt,"f").videoWidth,height:pe(this,Gt,"f").videoHeight};if(pe(this,yi,"f")){const l=pe(this,yi,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:pe(this,Gt,"f").videoWidth,height:pe(this,Gt,"f").videoHeight};{const l={width:0,height:0};let u=pe(this,Xi,"f").video.width||0,f=pe(this,Xi,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),f&&(l.height=f.exact||f.ideal||f),l}}getResolutions(l){var u=this;return Q(function*(){var f,g,m,v,y,x,w,C,_,T,M;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let L="";const N=(V,H)=>{const G=pe(u,nu,"f").get(V);if(!G||!G.length)return!1;for(let z of G)if(z.width===H.width&&z.height===H.height)return!0;return!1};if(u._mediaStream){L=null===(M=pe(u,Ko,"f"))||void 0===M?void 0:M.deviceId;let V=pe(u,nu,"f").get(L);if(V&&!l)return JSON.parse(JSON.stringify(V));V=[],pe(u,nu,"f").set(L,V),hi(u,Tp,!0,"f");try{for(let H of u.detectedResolutions){yield pe(u,yi,"f").applyConstraints({width:{ideal:H.width},height:{ideal:H.height}}),pe(u,ft,"m",Ma).call(u);const G=pe(u,yi,"f").getSettings(),z={width:G.width,height:G.height};N(L,z)||V.push({width:z.width,height:z.height})}}catch(H){throw pe(u,ft,"m",ew).call(u),hi(u,Tp,!1,"f"),H}try{yield pe(u,ft,"m",Pp).call(u)}catch(H){if("AbortError"===H.name)return V;throw H}finally{hi(u,Tp,!1,"f")}return V}{const V=function(){var z=Q(function*(q,te,se){const ae={video:{deviceId:{exact:q},width:{ideal:te},height:{ideal:se}}};let j=null;try{j=yield navigator.mediaDevices.getUserMedia(ae)}catch(xe){return null}if(!j)return null;const le=j.getVideoTracks();let ue=null;try{const xe=le[0].getSettings();ue={width:xe.width,height:xe.height}}catch(xe){const I=document.createElement("video");I.srcObject=j,ue={width:I.videoWidth,height:I.videoHeight},I.srcObject=null}return le.forEach(xe=>{xe.stop()}),ue});return function(te,se,ae){return z.apply(this,arguments)}}();let H=(null===(y=null===(v=null===(m=pe(u,Xi,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===y?void 0:y.exact)||(null===(C=null===(w=null===(x=pe(u,Xi,"f"))||void 0===x?void 0:x.video)||void 0===w?void 0:w.deviceId)||void 0===C?void 0:C.ideal)||(null===(T=null===(_=pe(u,Xi,"f"))||void 0===_?void 0:_.video)||void 0===T?void 0:T.deviceId);if(!H)return[];let G=pe(u,nu,"f").get(H);if(G&&!l)return JSON.parse(JSON.stringify(G));G=[],pe(u,nu,"f").set(H,G);for(let z of u.detectedResolutions){const q=yield V(H,z.width,z.height);q&&!N(H,q)&&G.push({width:q.width,height:q.height})}return G}})()}setMediaStreamConstraints(l,u){var f=this;return Q(function*(){if(null===(g=l)||"[object Object]"!==Object.prototype.toString.call(g))throw new TypeError("Invalid 'mediaStreamConstraints'.");var g;hi(f,Xi,JSON.parse(JSON.stringify(l)),"f"),hi(f,Tc,null,"f"),u&&pe(f,ft,"m",G0).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(pe(this,Xi,"f")))}resetMediaStreamConstraints(){hi(this,Xi,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!pe(this,yi,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return pe(this,yi,"f").getCapabilities?pe(this,yi,"f").getCapabilities():{}}getCameraSettings(){if(!pe(this,yi,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return pe(this,yi,"f").getSettings()}turnOnTorch(){var l=this;return Q(function*(){if(!pe(l,yi,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield pe(l,yi,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return Q(function*(){if(!pe(l,yi,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield pe(l,yi,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!pe(f,yi,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Br(l,m.min,m.step,m.max)),yield pe(f,yi,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!pe(f,yi,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Br(l,m.min,m.step,m.max)),yield pe(f,yi,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!pe(f,yi,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=f.getResolution();return yield pe(f,yi,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var f=this;return Q(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!pe(f,yi,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const g=f.getCameraCapabilities(),m=null==g?void 0:g.focusMode,v=null==g?void 0:g.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const y=l.mode.toLowerCase();if(!m.includes(y))throw Error("Unsupported focus mode.");if("manual"===y){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let x=l.distance;u&&(x<v.min?x=v.min:x>v.max&&(x=v.max),x=Br(x,v.min,v.step,v.max)),f._focusParameters.focusArea=null,yield pe(f,yi,"f").applyConstraints({advanced:[{focusMode:y,focusDistance:x}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const x=l.area.centerPoint;let w=l.area.width,C=l.area.height;if(!w||!C){const _=f.getResolution();w||(w=2*Math.round(Math.min(_.width,_.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),C||(C=2*Math.round(Math.min(_.width,_.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:x.x,y:x.y},width:w,height:C},yield pe(f,ft,"m",LT).call(f,x,w,C)}}}else f._focusParameters.focusArea=null,yield pe(f,yi,"f").applyConstraints({advanced:[{focusMode:y}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return Q(function*(){hi(l,Dp,!0,"f")})()}disableTapToFocus(){hi(this,Dp,!1,"f")}isTapToFocusEnabled(){return pe(this,Dp,"f")}setZoom(l){var u=this;return Q(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?pe(u,ft,"m",FT).call(u,l.centerPoint):u.resetScaleCenter();try{if(pe(u,ft,"m",nB).call(u,pe(u,Ic,"f"))){const f=yield u.setHardwareScale(l.factor,!0);let g=u.getHardwareScale();1==g&&1!=f&&(g=f),u.setSoftwareScale(l.factor>g?l.factor/g:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(f){const g=f.message||f;if("Not supported."!==g&&"Camera is not open."!==g)throw f;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*pe(this,Ac,"f")}}resetZoom(){var l=this;return Q(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var f=this;return Q(function*(){var g;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!pe(f,yi,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const m=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=Br(l,m.min,m.step,m.max)),yield pe(f,yi,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&pe(this,ft,"m",FT).call(this,u),hi(this,Ac,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return pe(this,Ac,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();hi(this,Ic,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||pe(this,Tp,"f"))return null;const u=Date.now();Vt._onLog&&Vt._onLog("getFrameData() START: "+u);const f=pe(this,Gt,"f").videoWidth,g=pe(this,Gt,"f").videoHeight;let m={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=Hi.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let y=pe(this,Ac,"f");(null==l?void 0:l.scale)&&(y=l.scale);let x=pe(this,Ic,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let T=0,M=0;if(l.scaleCenter.x.endsWith("px"))T=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");T=parseFloat(l.scaleCenter.x)/100*f}if(l.scaleCenter.y.endsWith("px"))M=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");M=parseFloat(l.scaleCenter.y)/100*g}if(isNaN(T)||isNaN(M))throw new Error("Invalid scale center.");x.x=Math.round(T),x.y=Math.round(M)}let w=null;if((null==l?void 0:l.bufferContainer)&&(w=l.bufferContainer),0==f||0==g)return null;1!==y&&(m.sWidth=Math.round(m.sWidth/y),m.sHeight=Math.round(m.sHeight/y),m.sx=Math.round((1-1/y)*x.x+m.sx/y),m.sy=Math.round((1-1/y)*x.y+m.sy/y));const C=this.imageDataGetter.getImageData(pe(this,Gt,"f"),f,g,m,{pixelFormat:v,bufferContainer:w});if(!C)return null;const _=Date.now();return Vt._onLog&&Vt._onLog("getFrameData() END: "+_),{data:C.data,width:C.width,height:C.height,pixelFormat:C.pixelFormat,timeSpent:_-u,timeStamp:_,toCanvas:pe(this,RT,"f")}}on(l,u){if(!pe(this,MT,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);pe(this,ds,"f").on(l,u)}off(l,u){pe(this,ds,"f").off(l,u)}dispose(){var l=this;return Q(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),pe(l,ds,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",pe(l,Qx,"f")),hi(l,Kx,!0,"f")})()}}function eoe(p,l){Ve(l)&&(p.config.maxFrameNumber=l)}function toe(p,l){Ve(l)&&(p.config.autoCaptureDelay=l)}function ioe(p,l){if(!Jn(l))return;const{context:u}=p.viewer;u.core.detectorService.enableDetect&&(p.config.enableAutoDetect=l,p.isVideoPlaying&&(p.viewer.hooks.autoDetectChanged.emit(VE.create(l)),l?p.loop.startLoop():p.config.enableAutoCapture?p.loop.cancelAnimation():p.loop.closeLoop()))}function noe(p,l){Jn(l)&&(p.config.enableAutoCapture=l,p.isVideoPlaying&&(p.viewer.hooks.autoCaptureChanged.emit(UE.create(l)),l?p.loop.startLoop():p.config.enableAutoDetect||p.loop.closeLoop()))}function soe(p,l){Ve(l)&&(p.config.acceptedPolygonConfidence=l)}function roe(p,l){return!!p.videoEl&&(p.config.fullscreen=l,p.videoEl.style.objectFit=l?"cover":"contain",p.loop.updateVideoLayout(),!0)}Gt=new WeakMap,yi=new WeakMap,Xx=new WeakMap,qx=new WeakMap,Xi=new WeakMap,Ko=new WeakMap,Tc=new WeakMap,H0=new WeakMap,Zx=new WeakMap,_l=new WeakMap,Dc=new WeakMap,Co=new WeakMap,Tp=new WeakMap,Dp=new WeakMap,W0=new WeakMap,Jx=new WeakMap,Ap=new WeakMap,iu=new WeakMap,Ac=new WeakMap,Ic=new WeakMap,RT=new WeakMap,ds=new WeakMap,MT=new WeakMap,nu=new WeakMap,Ip=new WeakMap,Qx=new WeakMap,Kx=new WeakMap,ft=new WeakSet,iB=function(){var p=Q(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(pe(this,Tc,"f"))delete u.video.facingMode,u.video.deviceId={exact:pe(this,Tc,"f")};else if(this.ifSaveLastUsedCamera&&Vt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),g=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&g&&(u.video.width=f,u.video.height=g)}else if(!this.ifSkipCameraInspection){const f=function(){var v=Q(function*(y){let x=null;return"environment"===y&&["Android","HarmonyOS","iPhone","iPad"].includes(kn.OS)?(yield l._getCameras(!1),pe(l,ft,"m",Ma).call(l),x=Vt.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):y||["Android","HarmonyOS","iPhone","iPad"].includes(kn.OS)||(yield l._getCameras(!1),pe(l,ft,"m",Ma).call(l),x=Vt.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),x});return function(x){return v.apply(this,arguments)}}();let g=u.video.facingMode;g instanceof Array&&g.length&&(g=g[0]),"object"==typeof g&&(g=g.exact||g.ideal);const m=yield f(g);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return p.apply(this,arguments)}}(),Ma=function(){if(pe(this,_l,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},kT=function(){var p=Q(function*(l){var f,g,u=this;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{Vt._onLog&&Vt._onLog("======try getUserMedia========");let v=[0,500],y=null;const x=function(){var w=Q(function*(C){for(let _ of v){_&&(yield new Promise(T=>setTimeout(T,_)),pe(u,ft,"m",Ma).call(u));try{Vt._onLog&&Vt._onLog("ask "+JSON.stringify(C)),m=yield navigator.mediaDevices.getUserMedia(C),pe(u,ft,"m",Ma).call(u);break}catch(T){if("NotFoundError"===T.name||"NotAllowedError"===T.name||"AbortError"===T.name||"OverconstrainedError"===T.name)throw T;y=T,Vt._onLog&&Vt._onLog(T.message||T)}}});return function(_){return w.apply(this,arguments)}}();if(yield x(l),m||(Vt._onLog&&Vt._onLog("======try getUserMedia again========"),Vt._onLog&&Vt._onLog(l),yield x(l)),m||(v=[1e3,2e3],yield x(l)),m||(yield x(l)),!m)throw y;return m}catch(v){throw null==m||m.getTracks().forEach(y=>{y.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return p.apply(this,arguments)}}(),OT=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),hi(this,yi,null,"f")},Pp=function(){var p=Q(function*(){var l=this;hi(this,_l,!1,"f");const u=hi(this,Zx,Symbol(),"f");if(pe(this,Dc,"f")&&"pending"===pe(this,Co,"f")){try{yield pe(this,Dc,"f")}catch(g){}pe(this,ft,"m",Ma).call(this)}return u!==pe(this,Zx,"f")?void 0:hi(this,Dc,Q(function*(){hi(l,Co,"pending","f");try{if(l.videoSrc){if(!pe(l,Gt,"f"))throw new Error("'videoEl' should be set.");yield Vt.playVideo(pe(l,Gt,"f"),l.videoSrc,l.cameraOpenTimeout),pe(l,ft,"m",Ma).call(l)}else{let g=yield pe(l,ft,"m",iB).call(l);pe(l,ft,"m",OT).call(l);let m=yield pe(l,ft,"m",kT).call(l,g);yield l._getCameras(!1),pe(l,ft,"m",Ma).call(l);const v=()=>{const C=m.getVideoTracks();let _,T;if(C.length&&(_=C[0]),_){const M=_.getSettings();if(M)for(let L of l._arrCameras)if(M.deviceId===L.deviceId){L._checked=!0,L.label=_.label,T=L;break}}return T},y=pe(l,Xi,"f");if("object"==typeof y.video){let C=y.video.facingMode;if(C instanceof Array&&C.length&&(C=C[0]),"object"==typeof C&&(C=C.exact||C.ideal),!(pe(l,Tc,"f")||l.ifSaveLastUsedCamera&&Vt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||y.video.deviceId)){const _=v(),T=Vt.findBestCamera(l._arrCameras,C,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});T&&T!=(null==_?void 0:_.deviceId)&&(m.getTracks().forEach(M=>{M.stop()}),g.video.deviceId={exact:T},m=yield pe(l,ft,"m",kT).call(l,g),pe(l,ft,"m",Ma).call(l))}}const x=v();(null==x?void 0:x.deviceId)&&(hi(l,Tc,x&&x.deviceId,"f"),l.ifSaveLastUsedCamera&&Vt.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",pe(l,Tc,"f")),"object"==typeof g.video&&g.video.width&&g.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(g.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(g.video.height))))),pe(l,Gt,"f")&&(yield Vt.playVideo(pe(l,Gt,"f"),m,l.cameraOpenTimeout),pe(l,ft,"m",Ma).call(l)),l._mediaStream=m;const w=m.getVideoTracks();(null==w?void 0:w.length)&&hi(l,yi,w[0],"f"),hi(l,Ko,x,"f")}}catch(g){throw pe(l,ft,"m",ew).call(l),hi(l,Co,null,"f"),g}hi(l,Co,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),G0=function(){var p=Q(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=pe(this,Ko,"f"))||void 0===l?void 0:l.deviceId,f=this.getResolution();yield pe(this,ft,"m",Pp).call(this);const g=this.getResolution();u&&u!==pe(this,Ko,"f").deviceId&&pe(this,ds,"f").fire("camera:changed",[pe(this,Ko,"f").deviceId,u],{target:this,async:!0}),f.width==g.width&&f.height==g.height||pe(this,ds,"f").fire("resolution:changed",[{width:g.width,height:g.height},{width:f.width,height:f.height}],{target:this,async:!0}),pe(this,ds,"f").fire("played",null,{target:this,async:!0})});return function(){return p.apply(this,arguments)}}(),ew=function(){pe(this,ft,"m",OT).call(this),hi(this,Ko,null,"f"),pe(this,Gt,"f")&&(pe(this,Gt,"f").srcObject=null,this.videoSrc&&(pe(this,Gt,"f").pause(),pe(this,Gt,"f").currentTime=0)),hi(this,_l,!0,"f");try{this.resetSoftwareScale()}catch(p){}},bo=function(){var p=Q(function*(u,f){const g=V=>{if(!pe(this,yi,"f")||!this.isVideoPlaying||V.focusTaskId!=this._focusParameters.curFocusTaskId){pe(this,yi,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const H=new Error(`Focus task ${V.focusTaskId} canceled.`);throw H.name="DeprecatedTaskError",H}1===this._focusParameters.isDoingFocus&&Date.now()-V.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;f=Br(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield pe(this,yi,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),g(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(V=>{setTimeout(V,m)}),g(u);let v=u.focusL-u.focusW/2,y=u.focusT-u.focusH/2,x=u.focusW,w=u.focusH;const C=this.getResolution();if(v>=C.width||y>=C.height)throw new Error("Invalid area.");v+x>C.width&&(x=C.width-v),y+w>C.height&&(w=C.height-y),v=Math.round(v),y=Math.round(y),x=Math.round(x),w=Math.round(w);const _=4*C.width*C.height*this._focusParameters.defaultTempBufferContainerLenRatio,T=4*x*w;let M=this._focusParameters.tempBufferContainer;if(M){const V=M.length;_>V&&_>=T?M=new Uint8Array(_):T>V&&T>=_&&(M=new Uint8Array(T))}else M=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(_,T));if(!this.imageDataGetter.getImageData(pe(this,Gt,"f"),C.width,C.height,{sx:v,sy:y,sWidth:x,sHeight:w,dWidth:x,dHeight:w},{pixelFormat:Hi.RGBA,bufferContainer:M}))return pe(this,ft,"m",l).call(this,u,f);const L=M;let N=0;for(let V=0,H=T-8;V<H;++V){let G=L[V]-L[V+8];++V;let z=L[V]-L[V+8];++V;let q=L[V]-L[V+8];++V,N+=G*G+z*z+q*q}return-N});function l(u,f){return p.apply(this,arguments)}return l}(),Rp=function(){var p=Q(function*(u,f,g,m,v,y,x){let w;if(f=Br(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=Br(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y?y=Br(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(y=Br(Math.sqrt((f||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),x=yield pe(this,ft,"m",bo).call(this,u,y)),x<=g&&x<=v?w=3:g<v&&g<x?w=1:v<g&&v<x&&(w=2),(m-f)/2<=this._focusParameters.fds.step)return 3===w||(1===w?yield pe(this,yi,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===w&&(yield pe(this,yi,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===w)return yield pe(this,ft,"m",l).call(this,u,f,g,y,x);if(2===w)return yield pe(this,ft,"m",l).call(this,u,y,x,m,v);if(3!==w)return g=yield pe(this,ft,"m",bo).call(this,u,f),v=yield pe(this,ft,"m",bo).call(this,u,m),yield pe(this,ft,"m",l).call(this,u,f,g,m,v);let C=Br(Math.sqrt((f||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_=Br(Math.sqrt((m||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/C)<=Math.abs(1/this._focusParameters.oldDistance-1/_)){let T=yield pe(this,ft,"m",bo).call(this,u,C);if(T<x)return yield pe(this,ft,"m",l).call(this,u,f,g,y,x,C,T);if(T==x)return yield pe(this,ft,"m",l).call(this,u,C,T,y,x);let M=yield pe(this,ft,"m",bo).call(this,u,_);if(T>x&&x<M)return yield pe(this,ft,"m",l).call(this,u,C,T,_,M,y,x);if(x==M)return yield pe(this,ft,"m",l).call(this,u,y,x,_,M);if(x>M)return yield pe(this,ft,"m",l).call(this,u,y,x,m,v,_,M)}else{let T=yield pe(this,ft,"m",bo).call(this,u,_);if(x>T)return yield pe(this,ft,"m",l).call(this,u,y,x,m,v,_,T);if(x==T)return yield pe(this,ft,"m",l).call(this,u,y,x,_,T);let M=yield pe(this,ft,"m",bo).call(this,u,C);if(M>x&&x<T)return yield pe(this,ft,"m",l).call(this,u,C,M,_,T,y,x);if(M==x)return yield pe(this,ft,"m",l).call(this,u,C,M,y,x);if(M<x)return yield pe(this,ft,"m",l).call(this,u,f,g,y,x,C,M)}return!1});function l(u,f,g,m,v,y,x){return p.apply(this,arguments)}return l}(),LT=function(){var p=Q(function*(l,u,f,g,m){var y,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const x=this.getResolution();let w=0,C=0;if(l.x.endsWith("px"))w=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");w=parseFloat(l.x)/100*x.width}if(l.y.endsWith("px"))C=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(l.y)/100*x.height}if(isNaN(w)||isNaN(C)||w<0||w>x.width||C<0||C>x.height)throw new Error("Invalid 'centerPoint'.");let _=0;if(u.endsWith("px"))_=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");_=parseFloat(u)/100*x.width}if(isNaN(_)||_<0)throw new Error("Invalid 'width'.");let T=0;if(f.endsWith("px"))T=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");T=parseFloat(f)/100*x.height}if(isNaN(T)||T<0)throw new Error("Invalid 'height'.");if(1!==pe(this,Ac,"f")){const N=pe(this,Ac,"f"),V=pe(this,Ic,"f");_/=N,T/=N,w=(1-1/N)*V.x+w/N,C=(1-1/N)*V.y+C/N}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(y=this.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const M={focusL:w,focusT:C,focusW:_,focusH:T,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},L=function(){var N=Q(function*(V,H,G){try{(null==H||H<v._focusParameters.fds.min)&&(H=v._focusParameters.fds.min),(null==G||G>v._focusParameters.fds.max)&&(G=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let z=Br(Math.sqrt(G*(H||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),q=Br(Math.sqrt((H||v._focusParameters.fds.step)*z),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),te=Br(Math.sqrt(z*G),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),se=yield pe(v,ft,"m",bo).call(v,V,te),ae=yield pe(v,ft,"m",bo).call(v,V,q),j=yield pe(v,ft,"m",bo).call(v,V,z);if(ae>j&&j<se){const le=yield pe(v,ft,"m",Rp).call(v,V,q,ae,te,se,z,j);return v._focusParameters.isDoingFocus=0,le}if(ae<j&&ae<se){let le=yield pe(v,ft,"m",bo).call(v,V,H);const ue=yield pe(v,ft,"m",Rp).call(v,V,H,le,z,j,q,ae);return v._focusParameters.isDoingFocus=0,ue}if(j>se&&ae>se){let le=yield pe(v,ft,"m",bo).call(v,V,G);const ue=yield pe(v,ft,"m",Rp).call(v,V,z,j,G,le,te,se);return v._focusParameters.isDoingFocus=0,ue}if(ae==j&&j<se){const le=yield pe(v,ft,"m",Rp).call(v,V,q,ae,z,j);return v._focusParameters.isDoingFocus=0,le}if(j==se&&ae>j){const le=yield pe(v,ft,"m",Rp).call(v,V,z,j,te,se);return v._focusParameters.isDoingFocus=0,le}return L(V,H,G)}catch(z){if("DeprecatedTaskError"!==z.name)throw z}});return function(H,G,z){return N.apply(this,arguments)}}();return L(M,g,m)});return function(u,f,g,m,v){return p.apply(this,arguments)}}(),FT=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,f=0;if(p.x.endsWith("px"))u=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(p.x)/100*l.width}if(p.y.endsWith("px"))f=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(p.y)/100*l.height}if(isNaN(u)||isNaN(f))throw new Error("Invalid scale center.");hi(this,Ic,{x:u,y:f},"f")},nB=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return p&&p.x==l.width/2&&p.y==l.height/2},Vt.browserInfo=kn,Vt.onWarning=null===(PT=null==window?void 0:window.console)||void 0===PT?void 0:PT.warn;class ooe{constructor(l){S(this,"isLooping",!1),S(this,"lastDetectTime",(new Date).getTime()),S(this,"loopTimer",void 0),S(this,"autoCaptureStartTime",0),S(this,"lastRenderedQuad",void 0),S(this,"animation",void 0),S(this,"cameraContext",void 0),S(this,"videoLayout",void 0),this.cameraContext=l}getLoopState(){const{enableAutoCapture:l,enableAutoDetect:u}=this.cameraContext.config;return l||u}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime()}loopTimeout(){var l=this;if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const u=this.getDetectRemainTime();this.loopTimer=setTimeout(Q(function*(){if(!l.getLoopState()||l.isLooping)return;l.isLooping=!0;const f=yield l.loopTaskDetail();l.isLooping=!1,f&&l.getLoopState()&&setTimeout(()=>{l.getLoopState()&&l.loopTimeout()},10)}),u)}loopTaskDetail(){var l=this;return Q(function*(){if(!(l.cameraContext&&l.cameraContext.isVideoPlaying&&l.cameraContext.videoEl&&l.cameraContext.canvasEl&&l.getLoopState()))return!1;const{viewer:u}=l.cameraContext;if(l.lastDetectTime=(new Date).getTime(),!u.context.viewService.isBindContainer)return!0;if("hidden"===u.getViewerConfig().visibility)return!1;const{config:f}=l.cameraContext,{enableDetect:g}=u.context.core.detectorService,m=l.cameraContext.getFrameData();if(!m)return!1;const v={type:1,data:m.data.buffer,height:m.height,width:m.width};let y={success:!1};var x;g&&(y=yield l.getDetectResult(v),0===m.data.length&&(m.data=new Uint8Array(v.data)),f.enableAutoDetect&&l.cameraContext.isVideoPlaying&&y.success&&null!==(x=y)&&void 0!==x&&x.location?(l.lastRenderedQuad?l.createDetectAnimation(l.lastRenderedQuad,y.location):l.drawQuadrilateral(y.location),l.lastRenderedQuad=y.location):(l.clearCanvas(),l.lastRenderedQuad=null));let w=!1;var C;if(f.enableAutoCapture?((null===(C=y)||void 0===C?void 0:C.status)===Ns.AUTO_CAPTURE&&(w=!0),!g&&(l.autoCaptureStartTime<=0?l.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-l.autoCaptureStartTime>f.autoCaptureDelay&&(l.autoCaptureStartTime=0,w=!0))):l.autoCaptureStartTime=0,w){var _,T,M;if(null===(_=l.cameraContext.viewer)||void 0===_||!_.context)return!1;const L=yield l.cameraContext.viewer.context.core.processService.resize(m.data.buffer,1,m.width,m.height,-1);if(l.cameraContext.isCapturedPages=!0,null===(T=l.cameraContext.viewer)||void 0===T||!T.context)return!1;yield l.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(M=y)||void 0===M?void 0:M.location}],fileData:L.data}),l.startCaptureAnimation(),yield sB(),l.closeCaptureAnimation()}return!0})()}getDetectRemainTime(){const l=(new Date).getTime(),{maxFrameNumber:u}=this.cameraContext.config;return Math.max(0,1e3/u-(l-this.lastDetectTime))}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()))}closeLoop(){if(!this.loopTimer)return;const{context:l}=this.cameraContext.viewer,{detectorService:u}=l.core;u.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation)}updateVideoLayout(){const{videoEl:l,config:u}=this.cameraContext,{fullscreen:f}=u,{videoWidth:g,videoHeight:m}=l,{width:v,height:y}=l.getBoundingClientRect(),x={zoom:1,left:0,top:0};if(f){const w=Math.max(v/g,y/m);x.zoom=w}else{const w=Math.min(v/g,y/m),C=(v-g*w)/2,_=(y-m*w)/2;x.zoom=w,x.left=C,x.top=_}this.videoLayout=x}getDetectResult(l){var u=this;return Q(function*(){const{cameraContext:f}=u,{context:g}=f.viewer,{detectorService:m}=g.core;if(!m.enableDetect)return Promise.resolve({success:!1});let v=l;if(!l){const T=f.getFrameData();v={type:1,data:T.data.buffer,height:T.height,width:T.width}}const{acceptedPolygonConfidence:y,enableAutoCapture:x,autoCaptureDelay:w}=f.config,C={acceptedPolygonConfidence:y,enableAutoCapture:x,autoCaptureDelay:w};return(yield m.detect(v,C))||Promise.resolve({success:!1})})()}drawQuadrilateral(l){if(!this.loopTimer)return;const{canvasEl:u,viewer:f}=this.cameraContext,{zoom:g,left:m,top:v}=this.videoLayout,y=u.getContext("2d");y.save(),y.clearRect(0,0,u.width,u.height),y.translate(m,v),y.scale(g,g),y.beginPath(),y.moveTo(l[0][0],l[0][1]);for(let V=1;V<l.length;V++)y.lineTo(l[V][0],l[V][1]);y.closePath();const{quadSelectionStyle:x}=f.getViewerConfig(),{border:w,background:C}=x,{borderWidth:_,borderColor:T,borderStyle:M}=n0(w);let L=Dt(_).value/g;0===L&&(L=1);const N="solid"===M?[0,0]:[5*L,2*L];y.strokeStyle=T,y.fillStyle=C,y.lineCap="round",y.lineWidth=L,y.setLineDash(N),y.fill(),y.stroke(),y.restore()}clearCanvas(){const{canvasEl:l}=this.cameraContext;!l||l.getContext("2d").clearRect(0,0,l.width,l.height)}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation)}createDetectAnimation(l,u){let f=0;const g=()=>{this.clearCanvas();const m=l.map((v,y)=>{const x=u[y];return[v[0]+(x[0]-v[0])*f,v[1]+(x[1]-v[1])*f]});this.drawQuadrilateral(m),f<1&&(f+=.2,this.animation=requestAnimationFrame(g))};g()}startCaptureAnimation(){var l,u;this.cameraContext&&null!==(l=this.cameraContext)&&void 0!==l&&l.videoEl&&null!==(u=this.cameraContext)&&void 0!==u&&u.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden")}closeCaptureAnimation(){var l,u;this.cameraContext&&null!==(l=this.cameraContext)&&void 0!==l&&l.videoEl&&null!==(u=this.cameraContext)&&void 0!==u&&u.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="")}}function sB(){return new Promise(p=>{setTimeout(()=>{p("")},50)})}const aoe={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},tw={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class loe{constructor(l){var u;if(S(this,"camera",void 0),S(this,"configHandler",{}),S(this,"isHttps",!0),S(this,"lastDeviceId",void 0),S(this,"userDeviceId",void 0),S(this,"isFirstPlayed",!0),S(this,"isTurningTorch",!1),S(this,"initializing",!1),S(this,"cameraContainer",void 0),S(this,"viewer",void 0),S(this,"loop",void 0),S(this,"videoEl",void 0),S(this,"canvasEl",void 0),S(this,"config",qe(tw)),S(this,"bUser",!1),S(this,"canFrontCamera",!1),S(this,"isCapturedPages",!1),S(this,"lastEnvironmentCameraId",void 0),S(this,"cameraList",[]),S(this,"turnOnTheTorch",!1),S(this,"torchSupported",!1),this.viewer=l,this.camera=new Vt,this.loop=new ooe(this),this.initConfigHandler(),null!==(u=navigator)&&void 0!==u&&null!==(u=u.mediaDevices)&&void 0!==u&&u.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const f=this.getCameras().then(m=>{this.cameraList=m}),g=this.getFrontCamera().then(m=>{this.canFrontCamera=m,this.viewer.hooks.cameraInit.emit(_x.create(m))}).catch(m=>{});Promise.all([f,g]).finally(()=>{this.initializing=!1})}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents()}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks()}handleViewerModeChanged(){const{defaultDom:l,mainAndThbContainer:u}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const f=Mh(aoe,this.viewer.postfix);this.cameraContainer=f,Object.assign(f.style,this.viewer.context.viewerConfig.canvasStyle),l.appendChild(f);const g=f.getElementsByTagName("video")[0],m=f.getElementsByTagName("canvas")[0];g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),g.setAttribute("disablePictureInPicture","true"),g.setAttribute("autoplay","autoplay"),g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),g.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(g),this.bindCameraCanvas(m),this.updateCameraConfig(tw)}lT(this.cameraContainer,"flex"),yF(u)}else yF(this.cameraContainer),lT(u,"flex")}initConfigHandler(){this.configHandler={maxFrameNumber:eoe,enableAutoCapture:noe,enableAutoDetect:ioe,acceptedPolygonConfidence:soe,fullscreen:roe,autoCaptureDelay:toe}}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on(()=>{this.isCaptureViewer&&this.getFrontCamera().then(l=>{this.canFrontCamera=l,this.viewer.hooks.cameraInit.emit(_x.create(l))}),this.handleViewerModeChanged()}),this.viewer.hooks.visibleChanged.on(l=>{this.loop.closeLoop(),"visible"===l.newVisibility&&this.loop.startLoop()})}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on(l=>{if(!this.isCapturedPages)return;const u=fE.create(l.pageUids[0]);this.viewer.emit("captured",u),this.isCapturedPages=!1},this.viewer)}bindCameraEvents(){const{camera:l}=this;l.on("paused",()=>{this.loop.closeLoop()}),l.on("resumed",()=>{this.loop.closeLoop(),this.loop.startLoop()}),l.on("before:open",()=>{this.videoEl&&(this.videoEl.style.opacity="0")}),l.on("before:resolution:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop()}),l.on("before:camera:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId}),l.on("camera:changed",()=>{const u=uE.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",u)}),l.on("played",()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:u}=this.config,f=this.camera.getResolution();let g="unsupported";try{const m=this.camera.getCameraCapabilities();g=null!=m&&m.torch?"supported":"unsupported"}catch(m){}this.torchSupported="supported"===g,this.emitTorchChanged(g),"supported"===g&&u&&this.turnOnTorch().catch(()=>{this.config.enableTorch=!0}),this.viewer.hooks.cameraPlayed.emit(HE.create(f)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop()}),l.on("closed",()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"))})}emitTorchChanged(l){this.viewer.hooks.torchChanged.emit(jE.create(l))}getVPointerEvent(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=0,m=0,v=0,y=0;if(u){const{left:x,top:w}=u.getBoundingClientRect();v=x,y=w}return l instanceof PointerEvent||l instanceof MouseEvent?(g=l.offsetX,m=l.offsetY):f?(g=l.changedTouches[0].clientX-v,m=l.changedTouches[0].clientY-y):(g=l.touches[0].clientX-v,m=l.touches[0].clientY-y),bx.create(-1,"",-1,-1,Math.floor(g),Math.floor(m),l)}triggerPlayed(l){const u=bE.create(this.camera.getCamera().deviceId,l);this.viewer.emit("played",u)}bindNativeEvents(){const l=this.canvasEl;if(!l)return;const u=y=>{const x=this.getVPointerEvent(y);this.viewer.emit("click",x)},f=y=>{this.viewer.emit("dblclick",this.getVPointerEvent(y))},g=y=>{y.preventDefault();const x=this.getVPointerEvent(y);this.viewer.emit("rightclick",x)},m=()=>{setTimeout(()=>{this.resize()},500)},v=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop())};l.addEventListener("click",u),l.addEventListener("dblclick",f),l.addEventListener("contextmenu",g),document.addEventListener("visibilitychange",v),window.addEventListener("orientationchange",m),this.viewer.hooks.destroy.on(()=>{l.removeEventListener("click",u),l.removeEventListener("dblclick",f),l.removeEventListener("contextmenu",g),document.removeEventListener("visibilitychange",v),window.removeEventListener("orientationchange",m)})}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===Rn.CAPTURE}get isVideoPlaying(){return!!this.camera&&this.camera.isVideoPlaying}getFrontCamera(){var l=this;return Q(function*(){if(!l.isHttps)return fe.reject(fe.CAMERA_NEED_HTTPS);const u=yield Vt.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(u.ok)})()}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const l=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then(()=>(this.bUser=!0,this.lastEnvironmentCameraId=l,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve()))}return this.setCamera(this.lastEnvironmentCameraId).then(()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve()))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:l,height:u}=this.videoEl.getBoundingClientRect(),f=this.videoEl.videoWidth,g=this.videoEl.videoHeight,m=Math.max(l/f,u/g),v=l/(f*m),y=u/(g*m),x=Math.floor((1-v)/2*f),w=Math.floor((1-y)/2*g),C=Math.floor(f*v),_=Math.floor(g*y);return this.camera.getFrameData({position:{sx:x,sy:w,sWidth:C,sHeight:_,dWidth:C,dHeight:_}})}updateCameraConfig(l){for(const[u,f]of Object.entries(l)){const g=this.configHandler[u];g&&!Se(f)&&g(this,f)}}bindCameraVideo(l){l instanceof HTMLVideoElement&&(this.camera.setVideoEl(l),this.videoEl=l)}bindCameraCanvas(l){l instanceof HTMLCanvasElement&&(this.canvasEl=l)}capture(){var l=this;return Q(function*(){l.loop.startCaptureAnimation(),yield sB(),l.loop.closeCaptureAnimation(),fe.verbose(`[${Date.now()}][cv] start capture`);const u=l.getFrameData();if(fe.verbose(`[${Date.now()}][cv] get frame done`),!u)return null;const f={type:1,data:u.data.buffer,width:u.width,height:u.height},g=yield l.loop.getDetectResult(f);fe.verbose(`[${Date.now()}][cv] get detect result done`),0===u.data.length&&(u.data=new Uint8Array(f.data));const m=yield l.viewer.context.core.processService.resize(u.data.buffer,1,u.width,u.height,-1);return fe.verbose(`[${Date.now()}][cv] create image done`),l.isCapturedPages=!0,yield l.viewer.context.loadSource({fileData:m.data,extraPageData:[{index:0,perspectiveQuad:g.success?g.location:void 0}]}),fe.verbose(`[${Date.now()}][cv] capture done`),m.data})()}play(l){var u=this;return Q(function*(){if(!u.isHttps)return Promise.reject(fe.CAMERA_NEED_HTTPS);if(!l&&u.isVideoPlaying)return Promise.resolve();const{fill:f,resolution:g}=l||{},m=u.camera.getResolution();if(Jn(f)&&u.updateCameraConfig({fullscreen:f}),u.isVideoPlaying&&rB(g)&&g[0]===m.width&&g[1]===m.height)return Promise.resolve();let v=[m.width,m.height];if(rB(g)){if(u.isVideoPlaying)return u.camera.setResolution(g[0],g[1]).then(y=>(u.resize(),u.triggerPlayed(g),Promise.resolve())).catch();u.camera.setResolution(g[0],g[1]),v=g}return!u.isFirstPlayed||u.isVideoPlaying||g||"opening"===u.camera.state||(u.camera.setResolution(1280,720),v=[1280,720]),u.initializing&&(yield new Promise(y=>{const x=setInterval(()=>{u.initializing||(clearInterval(x),y(""))},100)})),u.isFirstPlayed&&(u.isFirstPlayed=!1),u.camera.open().then(Q(function*(){return u.resize(),u.triggerPlayed(v),Promise.resolve()})).catch(y=>{let x=fe.CAMERA_OCCUPIED;return"Permission denied"===y.message&&(x=fe.CAMERA_DENIED),8===y.code&&(x=fe.CAMERA_NO_CAMERA),Promise.reject(x)})})()}stop(){var l;this.loop.closeLoop(),this.viewer.emit("stopped",EE.create(this.getCamera().deviceId)),null===(l=this.camera)||void 0===l||l.close()}setCamera(l){var u=this;return Q(function*(){let f="";vt(l)?f=l.deviceId||"":nt(l)&&(f=l);let g=!1;for(let y=0;y<u.cameraList.length;y++)u.cameraList[y].deviceId===f&&(g=!0);if(!g)return Promise.reject(fe.CAMERA_NOT_EXIST);yield u.camera.setCamera(f).catch(y=>{let x=fe.CAMERA_OCCUPIED;"Permission denied"===y.message&&(x=fe.CAMERA_DENIED),8===y.code&&(x=fe.CAMERA_NO_CAMERA),Promise.reject(x)});const m=u.camera.getResolution(),v={deviceId:f,width:m.width,height:m.height};return u.isVideoPlaying&&u.triggerPlayed([m.width,m.height]),Promise.resolve(v)})()}getCamera(){const l=this.camera.getCamera();return{deviceId:l.deviceId,label:l.label}}getCameras(){var l=this;return Q(function*(){const u=(yield l.camera.getAllCameras()).map(f=>({deviceId:f.deviceId,label:f.label}));return Promise.resolve(u)})()}setResolution(l,u){var f=this;return Q(function*(){const g=f.camera.getCamera();if(!g||""===g.deviceId)return Promise.reject(fe.CAMERA_NOT_EXIST);let m;if(Ve(l))m=l;else if(Xt(l)){const[y,x]=l;m=y,u=x}let v=f.camera.getResolution();return Ve(m)&&Ve(u)&&(f.loop.closeLoop(),v=yield f.camera.setResolution(m,u).catch(y=>{})),f.camera&&f.isVideoPlaying&&f.triggerPlayed([v.width,v.height]),Promise.resolve(ne({deviceId:g.deviceId},v))})()}getResolution(){const l=this.camera.getCamera();if(!l||""===l.deviceId)return[0,0];const u=this.camera.getResolution();return[u.width,u.height]}getResolutions(){var l=this;return Q(function*(){const u=(yield l.camera.getResolutions()).map(f=>[f.width,f.height]);return Promise.resolve(u)})()}turnOnTorch(){const l=this.camera.getCamera();return l&&""!==l.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then(()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve())).catch(u=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),fe.reject(fe.CAMERA_NOT_SUPPORT_TORCH)))):Promise.reject(fe.CAMERA_NO_VIDEO)}turnOffTorch(){const l=this.camera.getCamera();return l&&""!==l.deviceId?this.camera.turnOffTorch().then(()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve())).catch(u=>fe.reject(fe.CAMERA_NOT_SUPPORT_TORCH)):Promise.reject(fe.CAMERA_NO_VIDEO)}resize(){const{canvasEl:l}=this,{width:u,height:f}=l.getBoundingClientRect();l.width=Math.floor(u),l.height=Math.floor(f),this.loop.updateVideoLayout()}dispose(){var l,u;this.stop(),null===(l=this.loop)||void 0===l||l.closeLoop(),null===(u=this.camera)||void 0===u||u.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null}}function rB(p){return!!(Xt(p)&&Ve(p[0])&&Ve(p[1]))}const coe={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){if(super(g),S(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===Rn.CAPTURE){this.cameraContext=new loe(this);const m=tw;vt(g.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach(v=>{v in g.viewerConfig&&(m[v]=g.viewerConfig[v])}),this.cameraContext.config=Fe(ne({},m),{defaultCameraConfig:tw}),this.on("resized",()=>{this.cameraContext.resize()})}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return qe(this.cameraContext.config)}updateCameraConfig(g){vt(g)&&this.cameraContext.updateCameraConfig(g)}capture(){return this.cameraContext.capture()}play(g){return this.cameraContext.play(g)}stop(){this.isVideoPlaying()?this.cameraContext.stop():fe.warning(fe.CAMERA_NO_VIDEO)}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(g){return this.cameraContext.setCamera(g)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(g,m){return this.cameraContext.setResolution(g,m)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var g;this.cameraContext&&(null===(g=this.cameraContext)||void 0===g||g.dispose()),this.cameraContext=null,super.dispose()}});var f;p.setClass("Viewer",u)}};class hoe{constructor(l){S(this,"uid",void 0),S(this,"areaUid",void 0),S(this,"isRect",!0),S(this,"vertexes",[]),S(this,"midpoints",[]),S(this,"points",[]),S(this,"keepAspectRatio",!1),S(this,"isConvex",!0),S(this,"renderer",void 0),S(this,"area",void 0),S(this,"slopeRatio",[]),S(this,"selectedPart",-1),S(this,"startX",null),S(this,"startY",null),S(this,"lastX",null),S(this,"lastY",null),S(this,"lastAspectRatio",1),S(this,"b1",void 0),S(this,"b2",void 0),S(this,"k1",void 0),S(this,"k2",void 0),this.uid=qt(),Object.assign(this,l),this.initBox(l.vertexes)}initBox(l){this.vertexes=l,this.midpoints=NT(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=T3(this.vertexes)}getRect(){if(!this.isRect)return null;const{minX:l,maxX:u,minY:f,maxY:g}=this.getBounds();return{left:l,top:f,width:u-l||1,height:g-f||1}}getQuad(){if(this.isRect)return null;const{points:l}=this,u=[];for(let f=0;f<4;f++)u.push([l[2*f],l[2*f+1]]);return u}getActivePartNum(l,u,f){const g=this.getSelectedCtrlPointNum(l,u,f);return g>-1?g:this.isPointOnBox(l,u)?8:-1}getSelectedCtrlPointNum(l,u,f){const{points:g}=this,{width:m,height:v,zoom:y}=this.area,{ctrlWidth:x,ctrlHeight:w,ctrlRadiusMultipleMobile:C}=this.renderer.config.boxStyle;let _=w/2/y,T=x/2/y;f&&(T*=C,_*=C);const M=Pi(T,0,3*T),L=Pi(_,0,3*_);for(let N=0;N<8;N++){const V=g[2*N],H=g[2*N+1];if(l<=V+M&&l>=V-M&&u<=H+L&&u>=H-L&&l>=0-M&&l<=m+M&&u>=0-L&&u<=v+L&&(N<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return N}return-1}checkOrientation(l){if(l<0||l>7)return null;const{minX:u,maxX:f,minY:g,maxY:m}=this.getBounds(),{points:v}=this,y=v[2*l],x=v[2*l+1];let w="",C="";return y===f?w="e":y===u&&(w="w"),x===m?C="s":x===g&&(C="n"),l<4?C+w:C||w}onStartHandler(l,u,f,g){var m;if(null!==(m=f)&&void 0!==m||(f=this.getActivePartNum(l,u,g)),!(f<0)&&(this.startX=l,this.startY=u,this.lastX=l,this.lastY=u,this.selectedPart=f,!this.isRect&&f>3&&f<8)){const{points:v,slopeRatio:y}=this,x=f-4;this.k1=y[(x+1)%4],this.b1=v[(2*x+3)%8]-this.k1*v[(2*x+2)%8],this.k2=y[(x+3)%4],this.b2=v[(2*x+1)%8]-this.k2*v[(2*x+0)%8]}}onMoveHandler(l,u,f){const{selectedPart:g}=this;if(g<0)return;const m=l-this.lastX,v=u-this.lastY;if(0===m&&0===v)return;const{points:y}=this;let x=y.slice();var w;g<8?(null!==(w=f)&&void 0!==w||(f=g),this.isRect?x=this.moveRectPoint(x,f,l,u):(x=this.moveQuadPoint(x,f,l,u),this.slopeRatio=T3(y).slice(0,4),this.isConvex=D3(x))):8===g&&(x=this.moveBox(x,m,v));const C=NT(x);this.points=x.slice(0,8).concat(C),this.midpoints=C,this.lastX=l,this.lastY=u}onEndHandler(){const{startX:l,startY:u,vertexes:f,midpoints:g,lastX:m,lastY:v,selectedPart:y}=this;if(y<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let x=this.points.slice();const w=D3(x);(l===m&&u===v||!w)&&(x=f.slice().concat(g)),this.isConvex=!0,this.vertexes=x.slice(0,8),this.midpoints=NT(x),this.points=x.slice(0,8).concat(this.midpoints),this.slopeRatio=T3(x).slice(0,4)}getBounds(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return{minX:Math.min(l[0],l[2],l[4],l[6]),maxX:Math.max(l[0],l[2],l[4],l[6]),minY:Math.min(l[1],l[3],l[5],l[7]),maxY:Math.max(l[1],l[3],l[5],l[7])}}moveRectPoint(l,u,f,g){let m=0,v=0;const{enableEditCropBoxMidpoints:y,enableEditCropBoxVertices:x}=this.renderer.config;if(this.keepAspectRatio){const{minX:w,maxX:C,minY:_,maxY:T}=this.getBounds(),M=this.checkOrientation(u);let L=(C-w)/(T-_);0===L||L===1/0||L===-1/0||Number.isNaN(L)?L=this.lastAspectRatio:this.lastAspectRatio=L,m=0,v=0;let N="w",V=!1;if(u<4){if(x){if(V=!0,m=f-l[2*u],v=g-l[2*u+1],0===m||0===v)return l;N="w"}}else{const H=u-4;if(y){V=!0;const G={e:[(H+1)%4,"w"],s:[H,"h"],w:[H,"w"],n:[(H+1)%4,"h"]};if(["e","s","w","n"].includes(M)&&([u,N]=G[M]),m=f-l[2*H],v=g-l[2*H+1],0===m||0===v)return l}}if(V){const H=["ne","sw","n","w"];"h"===N?(m=v*L,H.includes(M)&&(m=-m)):(v=m/L,H.includes(M)&&(v=-v));const G=l[2*u]+m,z=l[2*u+1]+v,{width:q,height:te}=this.area;G<0?(m=0-l[2*u],v=0):G>q?(m=q-l[2*u],v=0):z<0?(v=0-l[2*u+1],m=0):z>te&&(v=te-l[2*u+1],m=0),l[2*u]+=m,l[2*u+1]+=v;const se=(u+1)%4,ae=(u+3)%4;u%2?(l[2*se]+=m,l[2*ae+1]+=v):(l[2*se+1]+=v,l[2*ae]+=m)}}else if(u<4){if(x){if(m=f-l[2*u],v=g-l[2*u+1],0===m&&0===v)return l;l[2*u]=f,l[2*u+1]=g;const w=(u+1)%4,C=(u+3)%4;u%2?(l[2*w]=f,l[2*C+1]=g):(l[2*w+1]=g,l[2*C]=f)}}else{const w=u-4;if(y){const C=this.slopeRatio[w%4];0===C?(l[(2*w+3)%8]=g,l[(2*w+1)%8]=g):C!==1/0&&C!==-1/0||(l[(2*w+2)%8]=f,l[(2*w+0)%8]=f)}}return l}moveQuadPoint(l,u,f,g){const m=l.slice();if(u<4){const y=g-l[2*u+1];if(0==f-l[2*u]&&0===y)return l;l[2*u]=f,l[2*u+1]=g}else{const v=u-4,y=this.slopeRatio[v%4],x=g-y*f,w=-x/y,C=x,_=l[(2*v+9)%8]-y*l[(2*v+8)%8],T=-_/y,{k1:M,b1:L,k2:N,b2:V}=this;0===y?(l[(2*v+3)%8]=g,M!==1/0&&M!==-1/0&&(l[(2*v+2)%8]=(g-L)/M),l[(2*v+1)%8]=g,N!==1/0&&N!==-1/0&&(l[(2*v+0)%8]=(g-V)/N)):y===1/0||y===-1/0?(l[(2*v+2)%8]=f,l[(2*v+3)%8]=M*f+L,l[(2*v+0)%8]=f,l[(2*v+1)%8]=N*f+V):(0===M?l[(2*v+2)%8]+=w-T:M===1/0||M===-1/0?l[(2*v+3)%8]+=C-_:(l[(2*v+2)%8]=(L-x)/(y-M),l[(2*v+3)%8]=(y*L-M*x)/(y-M)),0===N?l[(2*v+0)%8]+=w-T:N===1/0||N===-1/0?l[(2*v+1)%8]+=C-_:(l[(2*v+0)%8]=(V-x)/(y-N),l[(2*v+1)%8]=(y*V-N*x)/(y-N)));for(let H=0;H<4;H++){const G=l[2*H],z=l[2*H+1];if(G<0||G>this.area.width||z<0||z>this.area.height)return m}}return l}moveBox(l,u,f){const{minX:g,maxX:m,minY:v,maxY:y}=this.getBounds(l);u=Pi(u,-g,this.area.width-m),f=Pi(f,-v,this.area.height-y);for(let x=0;x<4;x++)l[2*x]+=u,l[2*x+1]+=f;return l}isPointOnBox(l,u){if(this.isRect){const{minX:v,maxX:y,minY:x,maxY:w}=this.getBounds();return l>=v&&l<=y&&u>=x&&u<=w}const f=[...this.vertexes],g=[...this.midpoints],m=[];for(let v=0;v<4;v++)m.push([f[2*v],f[2*v+1]]),m.push([g[2*v],g[2*v+1]]);return function(v,y){let x,w,C,_,T=0;const M=y.length;for([C]=y,x=1;x<=M;x++)_=y[x%M],v[0]>Math.min(C[0],_[0])&&v[0]<=Math.max(C[0],_[0])&&v[1]<=Math.max(C[1],_[1])&&C[0]!==_[0]&&(w=(v[0]-C[0])*(_[1]-C[1])/(_[0]-C[0])+C[1],(C[1]===_[1]||v[1]<=w)&&(T+=1)),C=_;return T%2!=0}([l,u],m)}}function NT(p){const l=p.slice(0,8).concat(p[0],p[1]),u=[];for(let f=0;f<4;f++)u.push((l[2*f]+l[2*(f+1)])/2,(l[2*f+1]+l[2*(f+1)+1])/2);return u}class doe{constructor(l,u,f){S(this,"areaUid",void 0),S(this,"left",void 0),S(this,"top",void 0),S(this,"width",void 0),S(this,"height",void 0),S(this,"boxes",void 0),S(this,"isVisible",!0),S(this,"zoom",1),S(this,"oldRect",void 0),S(this,"oldQuad",void 0),S(this,"isModified",!1),S(this,"isDrawNewBox",!1),S(this,"activeBoxUid",void 0),S(this,"activePartNum",-1),S(this,"startX",void 0),S(this,"startY",void 0),S(this,"isMouseDown",!1),S(this,"isDrawing",!1),S(this,"renderer",void 0),this.renderer=l,this.areaUid=u,this.boxes=[],this.updateAreaRect(f)}hasActiveBox(){return!!this.activeBoxUid}getFullVertexes(){return[0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(l){return l.left>=0&&l.left<=this.width&&l.left+l.width<=this.width&&l.top>=0&&l.top<=this.height&&l.top+l.height<=this.height}isContainBox(l){const u=l.getRect();return this.isContainRect(u)}isFullBox(l){const{vertexes:u}=l;return 0===u[0]&&0===u[1]&&u[2].toFixed(2)===this.width.toFixed(2)&&0===u[3]&&u[4].toFixed(2)===this.width.toFixed(2)&&u[5].toFixed(2)===this.height.toFixed(2)&&0===u[6]&&u[7].toFixed(2)===this.height.toFixed(2)}addRectBox(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return l=this.handleBoundary(l),this.addBox(l,!0,u)}updateRectBox(l,u){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=l.getRect(),m=l.getQuad();if(u=this.handleBoundary(u),l.initBox(u),f){const v={box:l};l.isRect?(v.oldRect=g,v.newRect=l.getRect()):(v.oldQuad=m,v.newQuad=l.getQuad()),this.renderer.hooks.boxModified.emit(v)}}handleBoundary(l){l=[...l];for(let u=0;u<4;u++){const f=[l[2*u],l[2*u+1]];f[0]=Pi(f[0],0,this.width),f[1]=Pi(f[1],0,this.height),[l[2*u],l[2*u+1]]=f}return l}addQuadBox(l){return this.addBox(l,!1)}addBox(l){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=new hoe({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...l],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(f),u&&this.renderer.hooks.boxCreated.emit(f),f}getBoxRects(){return this.boxes.map((l,u)=>ne({index:u},l.getRect()))}getBoxByUid(l){return this.boxes.find(u=>u.uid===l)}deleteBoxByUid(l){const u=this.boxes.findIndex(f=>f.uid===l);u>-1&&this.boxes.splice(u,1)}clearBoxes(){this.boxes.length=0}updateAreaRect(l){this.left=l.left,this.top=l.top,this.width=l.width,this.height=l.height}setKeepAspectRatio(l){this.isDrawing||this.boxes.forEach(u=>{u.keepAspectRatio=l})}isTouchedPoint(l,u,f){return l=Pi(l,0,this.width),u=Pi(u,0,this.height),this.boxes.some(g=>{const m=g.getActivePartNum(l,u,f);return m>-1&&m<8})}isTouchedBox(l,u,f){return l=Pi(l,0,this.width),u=Pi(u,0,this.height),this.boxes.some(g=>g.getActivePartNum(l,u,f)>-1)}onStartHandler(l,u,f){this.isMouseDown=!0,l=Pi(l,0,this.width),u=Pi(u,0,this.height),this.startX=l,this.startY=u;const g=this.boxes.find(m=>{const v=m.getActivePartNum(l,u,f);return v>-1&&(this.activePartNum=v),v>-1});g&&(this.oldRect=g.getRect(),this.oldQuad=g.getQuad(),this.activeBoxUid=g.uid,g.keepAspectRatio=this.renderer.config.keepAspectRatio,g.onStartHandler(l,u,void 0,f))}onMoveHandler(l,u,f,g){if(!this.isMouseDown)return;let m;if(l=Pi(l,0,this.width),u=Pi(u,0,this.height),this.activeBoxUid){m=this.getBoxByUid(this.activeBoxUid);const{keepAspectRatioWithShift:x,keepAspectRatio:w,enableMoveQuad:C}=this.renderer.config;if(m.isRect)m.keepAspectRatio=!(!f||!x)||w;else if(!C&&8===this.activePartNum)return;return m.onMoveHandler(l,u),void(this.isModified=!0)}const{enableCreateBoxByPointer:v,enableMultiple:y}=this.renderer.config;if((y||!this.boxes.length)&&v){const{startX:x,startY:w}=this;let C=u-w;const _=l-x;let T=-1;const M=2/this.zoom;if(_<-M&&C<-M?T=0:_>M&&C<-M?T=1:_>M&&C>M?T=2:_<-M&&C>M&&(T=3),T>-1){const{aspectRatio:L}=this.renderer.config;L>0&&(C=_/L,T%2&&(C=-_/L));const N=[],V=T%2?[x,w,x,w+C,l,w+C,l,w]:[l,w+C,x,w+C,x,w,l,w];for(let H=0;H<4;H++)N.push(V[2*(T+H)%8]),N.push(V[(2*(T+H)+1)%8]);m=this.addRectBox(N,!1),this.isDrawNewBox=!0,m.keepAspectRatio=L>0,this.isDrawing=!0,this.activeBoxUid=m.uid,m.onStartHandler(this.startX,this.startY,T,g),m.onMoveHandler(l,u,T)}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const l=this.getBoxByUid(this.activeBoxUid);if(l.keepAspectRatio=this.renderer.config.keepAspectRatio,l.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(l);else if(this.isModified){const u={box:l};l.isRect?(u.oldRect=this.oldRect,u.newRect=l.getRect()):(u.oldQuad=this.oldQuad,u.newQuad=l.getQuad()),this.renderer.hooks.boxModified.emit(u)}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1}isPointHover(l){let[u,f]=l;return u>=0&&u<=this.width&&f>=0&&f<=this.height}getCursorInfo(l,u,f){for(let g=this.boxes.length-1;g>=0;g--){const m=this.boxes[g],v=m.getActivePartNum(l,u,f);if(v>-1){let y="move";return v<8&&(y=m.checkOrientation(v)),{part:v,position:y,isRect:m.isRect}}}return null}}const uoe={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class foe{constructor(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S(this,"areas",void 0),S(this,"scrollTop",0),S(this,"scrollLeft",0),S(this,"zoom",1),S(this,"config",void 0),S(this,"canvasDom",void 0),S(this,"isMousedown",!1),S(this,"isEditing",!1),S(this,"editingCursor","crosshair"),S(this,"hoveredArea",void 0),S(this,"hooks",{boxCreated:gc(),boxModified:gc(),boxDeleted:gc()}),this.areas=new Map,this.zoom=1,this.config=qe(uoe),gn(l,this.config),this.setCanvasDom(l.canvas)}setCanvasDom(l){l&&(this.canvasDom=l)}updateConfig(l){gn(l,this.config)}addArea(l,u){if(this.areas.has(l)){const g=this.areas.get(l);return g.updateAreaRect(u),g}const f=new doe(this,l,u);return this.areas.set(l,f),f}deleteArea(l){this.areas.has(l)&&(this.areas.get(l).boxes.forEach(u=>{this.hooks.boxDeleted.emit(u)}),this.areas.delete(l))}clearArea(){this.areas.forEach(l=>{l.boxes.forEach(u=>{this.hooks.boxDeleted.emit(u)})}),this.areas.clear()}clearAreaBoxes(l){if(this.areas.has(l)){const u=this.areas.get(l);u.boxes.forEach(f=>{this.hooks.boxDeleted.emit(f)}),u.clearBoxes()}}addRectBox(l,u){return this.areas.get(u).addRectBox(l)}addQuadBox(l,u){return this.areas.get(u).addQuadBox(l)}updateOptions(l){Object.assign(this,l),Ve(l.zoom)&&this.areas.forEach(u=>{u.zoom=l.zoom})}getAreaByUid(l){return this.areas.get(l)}deleteAreaByUid(l){this.areas.delete(l)}getHoveredArea(l){const u=this.nativeToCanvas(l);for(const f of this.areas.values()){const g=this.canvasToArea(u,f);if(f.isPointHover(g)&&f.isVisible)return f}return null}getHoveredAreaForCursor(l){const u=Qf(l),f=this.nativeToCanvas(l);for(const g of this.areas.values()){const m=this.canvasToArea(f,g),[v,y]=m,x=g.isVisible&&g.boxes.find(w=>w.getActivePartNum(v,y,u)>-1);if(g.isPointHover(m)||x)return g}return null}isControlPointTouched(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return!1;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=Qf(l);return u.isTouchedPoint(g,m,v)}isBoxTouched(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return!1;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=Qf(l);return u.isTouchedBox(g,m,v)}onStartHandler(l){const u=this.getHoveredArea(l);if(!u||!u.isVisible)return;this.hoveredArea=u,this.isMousedown=!0;const f=this.nativeToCanvas(l),[g,m]=this.canvasToArea(f,u),v=Qf(l);u.onStartHandler(g,m,v)}onMoveHandler(l){if(!this.canvasDom)return;const{defaultCursor:u}=this.config,f=this.getHoveredArea(l);if(f){if(!f.isVisible)return}else this.canvasDom.style.cursor=u;const g=Qf(l),m=this.nativeToCanvas(l);if(this.isMousedown){const[v,y]=this.canvasToArea(m,this.hoveredArea);this.hoveredArea.onMoveHandler(v,y,l.shiftKey,g)}if(this.config.enableCursor&&f){const v="crosshair",y="move",{canvasDom:x}=this;if(this.hasBox()){const[w,C]=this.canvasToArea(m,f),_=f.getCursorInfo(w,C,g);let T;if(null===_)T=this.config.enableMultiple?v:u;else if(_.isRect){const M=_.position===y;this.isMousedown?this.isEditing||(this.editingCursor=M?y:v,this.isEditing=!0):T=M?y:`${_.position}-resize`}else _.part>-1&&_.part<8?this.isMousedown?this.isEditing||(this.editingCursor=v,this.isEditing=!0):T=v:T=u;this.isEditing&&(T=this.editingCursor),x.style.cursor=T}else x.style.cursor!==v&&(x.style.cursor=v)}}hasBox(){for(const l of this.areas.values())if(l.isVisible&&l.boxes.length)return!0;return!1}onEndHandler(l){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null)}render(){if(!this.canvasDom||!this.areas.size)return;const l=this.canvasDom.getContext("2d");l.setTransform(1,0,0,1,0,0),this.areas.forEach(u=>{u.isVisible&&u.boxes.length&&this.renderArea(l,u)})}renderArea(l,u){const{borderStyle:f,borderColor:g,borderWidth:m,ctrlBorderColor:v,ctrlBackground:y,ctrlBorderWidth:x,ctrlBorderStyle:w,background:C,maskColor:_,invalidBorderColor:T,invalidCtrlBorderColor:M,ctrlBorderRadius:L,ctrlWidth:N,ctrlHeight:V}=this.config.boxStyle,H=devicePixelRatio,G=N*H,z=V*H,q=Math.min(L*H,G/2,z/2),te=[f[0]*H,f[1]*H],se=m*H,ae=x*H,j=[w[0]*H,w[1]*H];l.save(),l.beginPath(),l.rect(u.left*H,u.top*H,u.width*u.zoom*H,u.height*u.zoom*H),l.closePath(),l.clip(),this.config.enableMask&&_&&(l.save(),l.beginPath(),l.rect(u.left*H,u.top*H,u.width*u.zoom*H,u.height*u.zoom*H),u.boxes.forEach(le=>{let ue=this.areaPointsToCanvas(le.points.slice(0,8),u),xe=this.areaPointsToCanvas(le.midpoints.slice(0,8),u);1!==H&&(ue=ue.map(I=>I*H),xe=xe.map(I=>I*H)),l.moveTo(ue[0],ue[1]);for(let I=1;I<4;I++)l.lineTo(ue[2*I],ue[2*I+1])}),l.closePath(),l.clip("evenodd"),l.fillStyle=_,l.fill(),l.restore()),u.boxes.forEach(le=>{let ue=this.areaPointsToCanvas(le.points.slice(0,8),u),xe=this.areaPointsToCanvas(le.midpoints.slice(0,8),u);1!==H&&(ue=ue.map(I=>I*H),xe=xe.map(I=>I*H)),l.save(),l.setLineDash(te),l.strokeStyle=le.isConvex?g:T,l.fillStyle=""===C?"transparent":C,l.lineWidth=se,l.beginPath(),l.moveTo(ue[0],ue[1]);for(let I=1;I<4;I++)l.lineTo(ue[2*I],ue[2*I+1]);l.closePath(),l.fill(),l.stroke(),l.setLineDash(j),l.strokeStyle=le.isConvex?v:M,l.fillStyle=""===y?"transparent":y,l.lineWidth=ae,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(l,ue,G,z,q,this.config.enableHideEditingCropBoxVertex?le.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(l,xe,G,z,q,this.config.enableHideEditingCropBoxMidpoint?le.selectedPart-4:-1),l.restore()}),l.restore()}drawCtrlPoints(l,u,f,g,m,v){const y=f/2,x=g/2;for(let w=0;w<4;w++){if(w===v)continue;l.beginPath();const C=u[2*w],_=u[2*w+1];if(0===m)l.rect(C-y,_-x,f,g);else{const{PI:T}=Math;l.arc(C-y+m,_-x+m,m,T,3*T/2),l.arc(C+y-m,_-x+m,m,3*T/2,2*T),l.arc(C+y-m,_+x-m,m,0,T/2),l.arc(C-y+m,_+x-m,m,T/2,T)}l.closePath(),l.fill(),l.stroke()}}areaPointsToCanvas(l,u){const f=[];for(let g=0;g<4;g++){const[m,v]=this.areaToCanvas([l[2*g],l[2*g+1]],u);f.push(m,v)}return f}canvasToArea(l,u){let[f,g]=l;const{scrollLeft:m,scrollTop:v,zoom:y}=this;return f=(f-u.left+m)/y,g=(g-u.top+v)/y,[f,g]}areaToCanvas(l,u){let[f,g]=l;const{scrollLeft:m,scrollTop:v,zoom:y}=this;return f=f*y+u.left-m,g=g*y+u.top-v,[f,g]}nativeToCanvas(l){const u=["touchstart","touchend","touchmove"].includes(l.type)?l.targetTouches[0]:l,f=this.canvasDom.getBoundingClientRect(),{scrollX:g,scrollY:m}=window;return[u.pageX-g-f.left,u.pageY-m-f.top]}}class poe{constructor(l,u){S(this,"context",void 0),S(this,"core",void 0),S(this,"boxRenderer",void 0),S(this,"viewer",void 0),S(this,"isMousedown",!1),this.viewer=l,this.context=l.context,this.core=l.context.core,this.boxRenderer=u}isEditCropBox(l){const u=this.boxRenderer.getHoveredArea(l);return!(!u||!u.isVisible||u.boxes.length&&!this.boxRenderer.isBoxTouched(l))}mousedown(l){const{context:u}=this,f=this.context.getActiveTab();if(null==f||!f.total||"crop"!==this.context.viewerConfig.toolMode)return;const[g]=this.context.formatTouches(l),{page:m}=this.context.getPointerOverPageInfo(g.pageX,g.pageY).pageInfo;if(f&&m&&m.uid!==f.currentUid){const v=f.getPageIndex(m);f.gotoPage(v),this.context.emitPageChangedEvent(f),this.context.core.viewerService.onCurrentChangedByScroll.emit(Ex.create(f.uid,u.groupUid,u.uid,v)),this.context.emitPageChangedAfterRenderEvent(f)}this.isMousedown=!0,this.boxRenderer.onStartHandler(l)}mousemove(l){const u=this.context.getActiveTab();null!=u&&u.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&l instanceof TouchEvent&&l.cancelable&&l.preventDefault(),this.boxRenderer.onMoveHandler(l),this.isMousedown&&this.context.render())}mouseup(l){this.isMousedown&&(this.boxRenderer.onEndHandler(l),this.isMousedown=!1,this.context.render())}afterPerspective(l){let{pageUid:u,docUid:f,width:g,height:m}=l;const{context:v}=this,y=v.tabService.getTab(f);if(!y)return;const x=y.getPageByUid(u);if(x&&(x.rWidth=g,x.rHeight=m,v.clearOptimization([x.uid])),y.isActive){if("crop"===v.viewerConfig.toolMode){this.boxRenderer.areas.forEach(T=>{T.clearBoxes()});const C=this.boxRenderer.getAreaByUid(u),_=y.getPageByUid(u).getRect();null==C||C.updateAreaRect(_)}x&&(x.isLoaded=!1),v.scrollByCurrentChanged=!0;let w=!0;this.context.isDefaultViewer?"none"===y.context.fitMode&&(w=!1):this.context.isThumbnailViewer&&(w=!1),this.context.showTab(y,w)}}afterRotatePages(l){const{context:u}=this;if("crop"!==u.viewerConfig.toolMode)return;const f=this.context.getActiveTab();null!=f&&f.total&&f.uid===l.docUid&&(this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),l.pageUids.forEach(g=>{const m=this.boxRenderer.getAreaByUid(g),v=f.getPageByUid(g).getRect();null==m||m.updateAreaRect(v)}),this.context.render())}afterRender(l){const{context:u}=this;"crop"===u.viewerConfig.toolMode&&(l.pages.forEach(f=>{const g=this.boxRenderer.getAreaByUid(f.uid);if(g){if(f.isVisible){const m=f.getRect();g.updateAreaRect(m)}g.isVisible="current"===this.viewer.cropMode?f.uid===l.currentUid:f.isVisible}}),this.boxRenderer.updateOptions({zoom:l.context.zoom}),this.boxRenderer.render())}toolModeChanged(l){if("crop"!==l.oldToolMode&&"crop"===l.newToolMode){const u=this.context.getActiveTab();if(!u)return;u.pages.forEach(f=>{const g=f.getRect();this.boxRenderer.addArea(f.uid,g).isVisible="current"===this.viewer.cropMode?f.uid===u.currentUid:f.isVisible}),this.boxRenderer.updateOptions({zoom:u.context.zoom})}else"crop"!==l.newToolMode&&"crop"===l.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render())}pageChanged(l){if("crop"===this.context.viewerConfig.toolMode)return this.context.getActiveTab()?0===l.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(l){l.pageUids.forEach(u=>{this.boxRenderer.deleteArea(u)})}updatePage(l){const{context:u}=this;if("crop"!==u.viewerConfig.toolMode)return;const f=u.getActiveTab();if(f&&f.uid===l.docUid&&("current"===this.viewer.cropMode&&l.pageUid===f.currentUid&&this.resetPageCropArea(),"all"===this.viewer.cropMode)){const g=this.boxRenderer.getAreaByUid(l.pageUid),m=f.getPageByUid(l.pageUid).getRect();g.updateAreaRect(m),this.boxRenderer.areas.forEach(v=>{v.clearBoxes()}),u.render()}}addPages(l){const u=this.context.getActiveTab();null!=u&&u.total&&u.uid===l.docUid&&(l.pageUids.forEach(f=>{const g=u.getPageByUid(f),m=g.getRect();this.boxRenderer.addArea(g.uid,m),this.boxRenderer.updateOptions({zoom:u.context.zoom})}),this.boxRenderer.areas.forEach(f=>{f.clearBoxes()}))}resetPageCropArea(){const l=this.context.getActiveTab();this.clearRedundantBoxes();const u=l.getCurrentPage(),f=u.getRect();this.boxRenderer.addArea(u.uid,f),this.boxRenderer.updateOptions({zoom:l.context.zoom}),this.context.render()}clearRedundantBoxes(){const l=this.context.getActiveTab();l&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach(u=>{u.areaUid!==l.currentUid&&this.boxRenderer.clearAreaBoxes(u.areaUid)})}}class goe{constructor(l,u){S(this,"context",void 0),S(this,"core",void 0),S(this,"boxRenderer",void 0),S(this,"viewer",void 0),S(this,"isMousedown",!1),S(this,"canSlide",!1),S(this,"isStart",!1),S(this,"startX",void 0),S(this,"isSliding",void 0),S(this,"slideDistance",void 0),S(this,"slideDirection",void 0),S(this,"slideRAF",void 0),S(this,"tabX",void 0),S(this,"tabY",void 0),this.viewer=l,this.context=l.context,this.core=l.context.core,this.boxRenderer=u}mousedown(l){const u=this.context.getActiveTab();null==u||!u.total||(this.isMousedown=!0,!this.boxRenderer.isControlPointTouched(l)&&this.context.viewerConfig.enableSlide?(this.canSlide=!0,this.slideStart(l)):this.boxRenderer.onStartHandler(l))}mousemove(l){const u=this.context.getActiveTab();null==u||!u.total||(Qf(l)&&l.cancelable&&l.preventDefault(),this.canSlide?this.slideMove(l):(this.boxRenderer.onMoveHandler(l),this.isMousedown&&this.context.render()))}mouseup(l){this.isMousedown&&(this.canSlide?this.slideEnd(l):this.boxRenderer.onEndHandler(l),this.canSlide=!1,this.isMousedown=!1,this.context.render())}reRender(){const{context:l}=this,u=l.getActiveTab();null!=u&&u.total&&"visible"===l.viewerConfig.visibility&&(this.updatePageQuad(u),l.render())}updatePage(l){const{context:u}=this,f=u.getActiveTab();null!=f&&f.total&&"visible"===u.viewerConfig.visibility&&f.currentUid===l.pageUid&&(this.updatePageQuad(f),u.render())}afterRender(l){if(null==l||!l.total)return;const{boxRenderer:u}=this;l.pages.forEach(f=>{const g=u.getAreaByUid(f.uid);if(g&&f.isVisible){const m=f.getRect();g.updateAreaRect(m)}}),u.updateOptions({zoom:l.context.zoom}),u.render()}pageChanged(l){if(-1===l.current&&0===l.total)return void this.boxRenderer.clearArea();const u=this.context.getActiveTab();u&&this.updatePageQuad(u)}updatePageQuad(l){const{context:u}=this,f=l.getCurrentPage();if(!f)return!1;let g=null;const m=this.boxRenderer.getAreaByUid(f.uid);m&&m.boxes[0]&&(g=m.boxes[0].getQuad());const v=u.core.pageService.getPage(l.currentUid);this.boxRenderer.clearArea();const y=f.getRect(),x=this.boxRenderer.addArea(f.uid,y);this.boxRenderer.updateOptions({zoom:l.context.zoom});const w=v.getQuadVertices(),C=x.addQuadBox(w);let _=C.getQuad();u.hooks.perspectiveQuadChanged.emit(wp.create(C.getQuad(),v.isFull)),g&&(g=v.quadToPixelPPI(g)),_&&(_=v.quadToPixelPPI(_)),Rh(g),Rh(_);let T=!1;return g&&_&&(T=u6(g,_)),T||u.viewer.emit("quadModified",Cx.create(g,_)),C}afterRotatePages(l){const u=this.context.getActiveTab();null!=u&&u.total&&l.pageUids.includes(u.currentUid)&&(this.updatePageQuad(u),this.context.render())}afterPerspective(l){let{pageUid:u,docUid:f}=l;const{context:g}=this,m=this.context.getActiveTab();if(null==m||!m.total||m.uid!==f||m.currentUid!==u)return;const v=m.getCurrentPage();v&&(v.isLoaded=!1),this.updatePageQuad(m),g.scrollByCurrentChanged=!0,g.showTab(m,!0)}slideStart(l){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const u=this.context.getActiveTab();if(null==u||!u.total)return;const{scrollLeft:f,scrollTop:g}=this.context.viewService.getMaxScrollValue();if(f||g)return;const m=this.context.formatTouches(l);if(m.length>1)return;const v=u.getPosition();this.tabX=v.x,this.tabY=v.y,this.startX=m[0].pageX,this.isStart=!0}slideMove(l){if(!this.isStart)return;const{context:u}=this,{viewerConfig:f}=u,g=u.getActiveTab(),m=u.formatTouches(l)[0].pageX-this.startX;if(m>0?this.slideDirection="right":m<0&&(this.slideDirection="left"),this.slideDistance=Math.min(g.context.viewportWidth,Math.abs(m)),this.isSliding)"right"===this.slideDirection?g.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&g.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),u.render();else if("single"===g.context.displayMode&&"crop"===f.toolMode&&f.enableSlide){const{scrollLeft:v,scrollTop:y}=this.context.viewService.getMaxScrollValue();Math.abs(m)>f.startSlideThresholdForPerspective&&!v&&!y&&(this.isSliding=!0,u.configService.updateConfig({displayMode:"slide"}))}}slideEnd(l){if(!this.isStart)return;const{context:u}=this,f=u.getActiveTab(),{displayMode:g}=f.context;"slide"===g&&this.slide(f),this.isStart=!1}slide(l){let u,f=0,g=0,m=0,v=!1;const{viewerConfig:y}=this.context;this.slideDistance>=Math.max(l.context.viewportWidth*y.slideThresholdForPerspective,y.startSlideThresholdForPerspective)?(g=l.context.viewportWidth,u=g-this.slideDistance,"left"===this.slideDirection?l.current!==l.total-1?(m=-this.slideDistance,f=-u/6):(g=0,u=this.slideDistance,v=!0,m=-this.slideDistance,f=u/6):0!==l.current?(m=this.slideDistance,f=u/6):(g=0,u=this.slideDistance,v=!0,m=this.slideDistance,f=-u/6)):(v=!0,g=0,u=this.slideDistance,"left"===this.slideDirection?(m=-this.slideDistance,f=u/6):(m=this.slideDistance,f=-u/6));const w=()=>{m+=f;const C=m>=0;if(Math.abs(m)>=g&&(m=g,C||(m*=-1)),l.setPosition({x:m+this.tabX,y:this.tabY,z:0}),Math.abs(m)===g)return v||(this.context.viewer.gotoPage("right"===this.slideDirection?l.current-1:l.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(w),this.context.render()};this.slideRAF=requestAnimationFrame(w)}}class moe{constructor(l){S(this,"service",void 0),this.service=l}startHandler(l){this.service.mousedown(l)}moveHandler(l){this.service.mousemove(l)}endHandler(l){this.service.mouseup(l)}isEditCropBox(l){return this.service.isEditCropBox(l)}}class voe{constructor(l){S(this,"service",void 0),this.service=l}startHandler(l){this.service.mousedown(l)}moveHandler(l){this.service.mousemove(l)}endHandler(l){this.service.mouseup(l)}}function z0(p,l){return{left:hl(p.left,l),top:hl(p.top,l),width:hl(p.width,l),height:hl(p.height,l)}}const yoe={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),S(this,"boxRenderer",void 0),S(this,"iCropMode","current"),S(this,"cropRectService",void 0),S(this,"perspectiveQuadService",void 0);const{isDefaultViewer:m,isPerspectiveViewer:v}=this.context;(m||v)&&this.initBoxRenderer(),this.cropRectService=new poe(this,this.boxRenderer),this.perspectiveQuadService=new goe(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new moe(this.cropRectService),this.context.perspectiveQuadEditService=new voe(this.perspectiveQuadService)}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:g},enableEditCropBoxMidpoints:m,enableEditCropBoxVertices:v,enableHideEditingCropBoxMidpoint:y,enableHideEditingCropBoxVertex:x}=this.context.viewerConfig;this.boxRenderer=new foe({defaultCursor:g,enableEditCropBoxMidpoints:m,enableEditCropBoxVertices:v,enableHideEditingCropBoxMidpoint:y,enableHideEditingCropBoxVertex:x}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on(()=>{this.updateQuadStyle()},this),this.context.hooks.canvasCursorStyleChanged.on(()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor})},this),this.hooks.resize.on(()=>{this.context.render()});const{hooks:w}=this.boxRenderer;w.boxCreated.on(C=>{const _=this.context.getActiveTab();if(null!=_&&_.total&&(this.context.isDefaultViewer&&C.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach(T=>{T.boxes.length?T.boxes.forEach(M=>{T.isContainBox(C)?T.updateRectBox(M,[...C.vertexes]):T.clearBoxes()}):T.isContainBox(C)&&T.addRectBox([...C.vertexes])}),C.isRect)){let T=C.getRect();T=bt(T,yt.displayResolution,72),T=z0(T,2);const M=gE.create(T);this.hooks.cropRectDrawn.emit(M),this.emit("cropRectDrawn",M)}}),w.boxDeleted.on(C=>{const _=this.context.getActiveTab();if(null!=_&&_.total&&C.isRect){let T=C.getRect();T=bt(T,yt.displayResolution,72),T=z0(T,2);const M=pE.create(T);this.hooks.cropRectDeleted.emit(M),this.emit("cropRectDeleted",M)}}),w.boxModified.on(C=>{const _=this.context.getActiveTab();if(null==_||!_.total)return;const{box:T}=C;if(this.context.isDefaultViewer&&T.isRect){let{oldRect:M,newRect:L}=C,N=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach(V=>{V.boxes.length?V.boxes.forEach(H=>{V.isContainBox(T)?(N+=1,V.updateRectBox(H,[...T.vertexes])):V.clearBoxes()}):V.isContainBox(T)&&V.addRectBox([...T.vertexes])}),M&&(M=bt(M,yt.displayResolution,72),M=z0(M,2)),L&&(L=bt(L,yt.displayResolution,72),L=z0(L,2)),!M||!L||M.left!==L.left||M.top!==L.top||M.width!==L.width||M.height!==L.height){N=Math.max(1,N);for(let V=0;V<N;V++){const H=mE.create(M,L);this.emit("cropRectModified",H)}}}if(this.context.isPerspectiveViewer&&!T.isRect){const M=this.context.core.pageService.getPage(T.area.areaUid),L=this.boxRenderer.getAreaByUid(T.area.areaUid).isFullBox(T);M.isFull=L,M.setActiveQuad(T.getQuad());let{oldQuad:N,newQuad:V}=C;N&&(N=M.quadToPixelPPI(N)),V&&(V=M.quadToPixelPPI(V)),Rh(N),Rh(V),this.hooks.perspectiveQuadChanged.emit(wp.create(V,M.isFull));let H=!1;N&&V&&(H=u6(V,N)),H||this.emit("quadModified",Cx.create(N,V))}})}updateQuadStyle(){const g=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:g})}get cropMode(){return this.iCropMode}set cropMode(g){if(this.iCropMode===g)return;const m=this.iCropMode;this.iCropMode=g;const v=this.context.getActiveTab();if(null!=v&&v.total){if("current"===m&&"all"===g){const y=this.boxRenderer.getAreaByUid(v.currentUid).boxes[0];y&&this.boxRenderer.areas.forEach(x=>{x.isContainBox(y)?x.boxes.length?x.updateRectBox(x.boxes[0],[...y.vertexes]):x.addRectBox([...y.vertexes]):x.clearBoxes()})}this.cropRectService.clearRedundantBoxes(),this.context.render()}}toggleFullPerspective(){const{context:g}=this;if(!g.isPerspectiveViewer)return;const m=g.getActiveTab();null!=m&&m.total&&g.core.pageService.getPage(m.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(m),g.render())}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on(g=>{this.cropRectService.afterRotatePages(g)},this),this.context.core.onAfterPerspective.on(g=>{this.cropRectService.afterPerspective(g)},this))}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on(g=>{this.perspectiveQuadService.afterRotatePages(g)},this),this.context.core.onAfterPerspective.on(g=>{this.perspectiveQuadService.afterPerspective(g)},this))}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:g}=this;this.hooks.resize.on(()=>{g.reRender()}),this.hooks.visibleChanged.on(()=>{g.reRender()}),this.hooks.updatePage.on(m=>{g.updatePage(m)}),this.hooks.afterRender.on(m=>{g.afterRender(m)}),this.hooks.pageChanged.on(m=>{g.pageChanged(m)})}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:g}=this;this.hooks.updatePage.on(m=>{g.updatePage(m)}),this.hooks.addPagesToDoc.on(m=>{g.addPages(m)}),this.hooks.afterRender.on(m=>{g.afterRender(m)}),this.hooks.toolModeChanged.on(m=>{g.toolModeChanged(m)}),this.hooks.pageChanged.on(m=>{g.pageChanged(m)}),this.hooks.deletePages.on(m=>{g.deletePages(m)}),this.hooks.beforeCropPages.on(()=>{this.clearRectBox()})}setRectBox(g,m){const v=this.context.getActiveTab();return!(!v||!v.total||(Se(m)&&(m=[v.current]),v.indicesToUids(m).forEach(y=>{let x=g;x=bt(g,yt.dataResolution,yt.displayResolution);const w=(_=>{const{left:T,top:M,width:L,height:N}=_;return[T,M,T+L,M,T+L,M+N,T,M+N]})(x),C=this.boxRenderer.areas.get(y);C.boxes.length?C.updateRectBox(C.boxes[0],w,!0):C.addRectBox(w)}),this.context.render(),0))}getRectBox(){const g=this.context.getActiveTab();if(g&&g.total){let m=null;if(g.pages.find(v=>{const y=this.boxRenderer.getAreaByUid(v.uid);return!(null==y||!y.boxes.length||(m=y,0))}),m){const v=m.boxes[0];if(null!=v&&v.isRect){let y=v.getRect();return y=bt(y,yt.displayResolution,yt.dataResolution),y=z0(y,2),y.width=y.width||1,y.height=y.height||1,y}}}return null}getRenderedRectBoxCount(){const g=this.context.getActiveTab();let m=0;return g&&g.total&&this.boxRenderer.areas.forEach(v=>{m+=v.boxes.length}),m}getCropIndices(){const g=this.context.getActiveTab();let m=[];if(g&&g.total)if("all"===this.iCropMode){const v=[];this.boxRenderer.areas.forEach(y=>{y.boxes.length&&v.push(y.areaUid)}),m=g.uidsToIndices(v)}else m=[g.current];return m}clearRectBox(){return this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),!0}setQuadBox(g){const m=this.context.getActiveTab();if(!m||!m.total)return!1;const v=this.context.core.pageService.getPage(m.currentUid);let y=g;y=g.map(T=>bt(T,v.resource.resolutionX,yt.displayResolution));const x=this.boxRenderer.getAreaByUid(m.currentUid),{width:w,height:C}=x,_=lF(y,w,C);return v.isFull=_,v.setActiveQuad(y),this.perspectiveQuadService.updatePageQuad(m),this.hooks.perspectiveQuadChanged.emit(wp.create(y,v.isFull)),this.context.render(),!0}getQuadBox(){const g=this.context.getActiveTab();if(g&&g.total){const m=this.boxRenderer.getAreaByUid(g.currentUid).boxes[0];if(!m.isRect){let v=m.getQuad();const y=this.context.core.pageService.getPage(g.currentUid);return v=v.map(x=>bt(x,yt.displayResolution,y.resource.resolutionX)),Rh(v),v}}return null}resetQuadBox(g){const m=this.context.getActiveTab();if(null==m||!m.total)return!1;let v=[];return v=Se(g)?[m.currentUid]:m.indicesToUids(g),v.forEach(y=>{const x=this.context.core.pageService.getPage(y),{quad:w}=x;w?(x.isFull&&(x.isFull=!1),x.setActiveQuad(w),this.perspectiveQuadService.updatePageQuad(m)):x.isFull||(x.isFull=!0,this.perspectiveQuadService.updatePageQuad(m)),x.uid===m.currentUid&&this.hooks.perspectiveQuadChanged.emit(wp.create(w,x.isFull))}),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach(g=>{g.clearBoxes()}),!0}isConvexQuad(g){return D3(g.flat())}});var f;p.setClass("Viewer",u)}};class xoe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(f=>{const{pageUids:g}=this.action;g.slice().forEach(m=>{if(f.pageUids.includes(m)){const v=g.indexOf(m);g.splice(v,1)}}),this.isValid=g.length>0},this)}execute(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).addAction(u)});const f=Tx.create(u.docUid,u.angle,u.pageUids);return l.editService.onRotatePages.emit(f),l.editService.onAfterRotatePages.emit(f),!0}undo(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).deleteAction(u.actionUid)});const f=Tx.create(u.docUid,u.angle,u.pageUids);l.editService.onRotatePages.emit(f),l.editService.onAfterRotatePages.emit(f)}}class woe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(f=>{const{pageUids:g}=this.action;g.slice().forEach(m=>{if(f.pageUids.includes(m)){const v=g.indexOf(m);g.splice(v,1)}}),this.isValid=g.length>0},this)}execute(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).addAction(this.action)});const f=Dx.create(u.docUid,u.rect,u.pageUids);return l.editService.onCropPages.emit(f),!0}undo(){const{core:l,action:u}=this;u.pageUids.forEach(g=>{l.pageService.getPage(g).deleteAction(u.actionUid)});const f=Dx.create(u.docUid,u.rect,u.pageUids);l.editService.onCropPages.emit(f)}}class Coe extends mi{constructor(l){super(),S(this,"core",void 0),S(this,"onRotatePages",void 0),S(this,"onAfterRotatePages",void 0),S(this,"onCropPages",void 0),S(this,"onAfterCropPages",void 0),this.core=l,this.initEventEmitter()}initEventEmitter(){this.onRotatePages=Re(this),this.onAfterRotatePages=Re(this),this.onCropPages=Re(this),this.onAfterCropPages=Re(this)}rotatePages(l,u,f,g){const m={actionUid:qt(),type:"rotate",docUid:l,pageUids:[...u],angle:f,rotationType:g},{core:v}=this,y=new xoe(m,v);return v.commandService.execute(y,l),!0}cropPages(l,u,f){const g={actionUid:qt(),type:"crop",docUid:l,pageUids:[...u],rect:ne({},f)},{core:m}=this,v=new woe(g,m);return m.commandService.execute(v,l),!0}}const boe={apply(p){p.editService=new Coe(p)},install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit()}listenGlobalEventsForEdit(){const{context:g}=this,m=v=>{let{docUid:y,pageUids:x}=v;const w=g.tabService.getTab(y);if(null!=w&&w.isActive){g.scrollByCurrentChanged=!0,g.clearOptimization(x);let C=!0;g.isDefaultViewer?"none"===w.context.fitMode&&(C=!1):g.isThumbnailViewer&&(C=!1),g.showTab(w,C)}};g.core.editService.onRotatePages.on(m,this),g.core.editService.onCropPages.on(m,this)}listenViewerEventsForEdit(){this.hooks.beforeLayout.on(g=>{const{core:{pageService:m},isDefaultViewer:v,isThumbnailViewer:y,isPerspectiveViewer:x}=this.context;(v||y||x)&&g.pages.forEach(w=>{let C=null;const _=m.getPage(w.uid);C=v||y?_.getEditResult():_.getEditResultForPerspective(),C&&(w.rWidth=C.rWidth,w.rHeight=C.rHeight,w.cropLeft=C.cropLeft,w.cropTop=C.cropTop,w.cropWidth=C.cropWidth,w.cropHeight=C.cropHeight,w.rotation=C.rotation,w.mediaBoxRect=C.mediaBox,w.cropBoxRect=C.cropBox)})})}rotatePages(g,m){var v;if(g%360==0)return!0;const y=this.context.getActiveTab();if(!y)return!1;null!==(v=m)&&void 0!==v||(m=[y.current]);const x=y.indicesToUids(m);return this.context.core.editService.rotatePages(y.uid,x,g,"contain")}cropPages(g,m){var v;const y=this.context.getActiveTab();if(!y)return!1;null!==(v=m)&&void 0!==v||(m=[y.current]);const x=y.indicesToUids(m);return g=bt(g,yt.dataResolution,yt.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(y.uid,x,g)}});var f;p.setClass("Viewer",u)}};class iw extends ite{static create(l){return new iw(l,l.uid)}constructor(l,u){super(u),S(this,"type",void 0),S(this,"docUid",void 0),S(this,"pageUid",void 0),S(this,"style",void 0),S(this,"transform",void 0),S(this,"flags",void 0),S(this,"comment",void 0),S(this,"layer",void 0),S(this,"creationDate",void 0),S(this,"modified",!1),S(this,"oriIndex",void 0),this.type=l.type,this.docUid=l.docUid,this.pageUid=l.pageUid,this.style=l.style,this.flags=l.flags||["print"],this.transform=l.transform,this.oriIndex=l.oriIndex,Se(null==l?void 0:l.modified)||(this.modified=l.modified)}getConfig(){return{uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:qe(this.style),transform:qe(this.transform),flags:qe(this.flags),comment:qe(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(l,u){const f=iw.create({docUid:this.docUid,pageUid:l,type:this.type,style:qe(this.style),transform:qe(this.transform),flags:this.flags.slice(),comment:this.comment}),g=this.comment.clone(f.uid,u);return f.comment=g,f.layer=this.layer,f}updateStyle(l){Object.assign(this.style,l)}updateComment(l){this.comment.updateComment(l)}addReplies(l){this.comment.replies.push(...l)}deleteReplies(l){const u=this.comment.replies;l.forEach(f=>{if(u.includes(f)){const g=u.findIndex(m=>m.uid===f.uid);u.splice(g,1)}})}updateReply(l){const u=this.comment.replies.findIndex(f=>f.uid===l.uid);this.comment.replies[u]=l}getAllReplies(){return[...this.comment.replies]}deleteReplyReviewSate(l){const u=this.comment.getReply(l);u&&u.deleteReviewState()}setReplyReviewState(l,u){const f=this.comment.getReply(l);f&&f.setReviewState(u)}deleteReplyMarkedSate(l){const u=this.comment.getReply(l);u&&u.deleteMarkedState()}setReplyMarkedState(l,u){const f=this.comment.getReply(l);f&&f.setMarkedState(u)}}class $0{static create(l){return new $0(l)}constructor(l){S(this,"uid",void 0),S(this,"author",void 0),S(this,"contents",void 0),S(this,"creationDate",void 0),S(this,"state",void 0),this.uid=l.uid,this.author=l.author,this.contents=l.contents,this.creationDate=l.creationDate,this.state=l.state}}class Y0{static create(l){return new Y0(l)}constructor(l){S(this,"uid",void 0),S(this,"author",void 0),S(this,"contents",void 0),S(this,"creationDate",void 0),S(this,"state",void 0),this.uid=l.uid,this.author=l.author,this.contents=l.contents,this.creationDate=l.creationDate,this.state=l.state}}class Mp extends tp{static create(l,u){return new Mp(l,u)}constructor(l,u){var f,g;super(u),S(this,"annotationUid",void 0),S(this,"author",void 0),S(this,"subject",void 0),S(this,"contents",void 0),S(this,"creationDate",void 0),S(this,"modificationDate",void 0),S(this,"markedStates",void 0),S(this,"reviewStates",void 0),this.annotationUid=l.annotationUid,this.author=l.author,this.subject=l.subject,this.contents=l.contents,this.creationDate=l.creationDate,this.modificationDate=l.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(f=l.markedStates)&&void 0!==f&&f.length&&l.markedStates.forEach(m=>{const v=Y0.create(m);this.markedStates.push(v)}),null!==(g=l.reviewStates)&&void 0!==g&&g.length&&l.reviewStates.forEach(m=>{const v=$0.create(m);this.reviewStates.push(v)})}updateReply(){Object.assign(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setMarkedState(l){const f=this.markedStates[this.markedStates.length-1];if((null==f?void 0:f.state)!==l.state||!f&&"marked"===l.state){const g=Y0.create(l);return this.markedStates.push(g),!0}return!1}deleteMarkedState(){this.markedStates.pop()}setReviewState(l){const u=$0.create(l);this.reviewStates.push(u)}deleteReviewState(){this.reviewStates.pop()}clone(l,u){const f=Mp.create({annotationUid:l,author:this.author,subject:this.subject,contents:this.contents,creationDate:u,modificationDate:u});return this.cloneStates(f),f}cloneStates(l){this.markedStates.forEach(u=>{const f=Y0.create(Fe(ne({},u),{uid:qt()}));l.markedStates.push(f)}),this.reviewStates.forEach(u=>{const f=$0.create(Fe(ne({},u),{uid:qt()}));l.reviewStates.push(f)})}}class nw extends Mp{static create(l,u){return new nw(l,u)}constructor(l,u){super(l,u),S(this,"replies",void 0),this.replies=[]}updateComment(l){Object.assign(this,l)}getReply(l){return this.replies.find(u=>u.uid===l.uid)}clone(l,u){const f=nw.create({annotationUid:l,author:this.author,subject:this.subject,contents:this.contents,creationDate:u,modificationDate:u});return this.cloneStates(f),this.replies.forEach(g=>{f.replies.push(g.clone(l,u))}),f}}class sw extends tp{static create(l){return new sw(l)}constructor(l){super(l),S(this,"bottom",void 0),S(this,"top",void 0),S(this,"annotations",void 0),S(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[]}clone(l){const u=sw.create(l);return u.top=this.top,u.bottom=this.bottom,u.annotations=this.annotations.slice(),u.layers=qe(this.layers),u}createTop(){const{top:l}=this;return this.top+=1,l}addAnnotation(l,u){if(!this.annotations.includes(l)){this.annotations.push(l);const f={annotationUid:l,layer:u};return this.layers.push(f),Se(u)?(f.layer=this.top,this.top+=1):this.sortLayers(),f}return null}sortLayers(){this.layers.sort((l,u)=>l.layer-u.layer)}deleteAnnotations(l){l.forEach(u=>{const f=this.annotations.indexOf(u);f>-1&&this.annotations.splice(f,1);const g=this.layers.findIndex(m=>m.annotationUid===u);g>-1&&this.layers.splice(g,1)})}moveAnnotation(l){const u=this.annotations.indexOf(l);if(u<0)return null;const f=this.layers.findIndex(m=>m.annotationUid===l);if(f<0)return null;const g={annotationUid:l,index:u,layerIndex:f,layer:this.layers[f].layer};return this.deleteAnnotations([l]),g}undoMoveAnnotation(l){const{annotationUid:u}=l;this.annotations.includes(u)||this.layers.find(f=>f.annotationUid===u)||(this.annotations.splice(l.index,0,u),this.layers.splice(l.layerIndex,0,{annotationUid:u,layer:l.layer}))}bringForward(l){const u=this.layers.findIndex(m=>m.annotationUid===l);if(u<0)return null;const f=this.layers[u],g=this.layers[u+1];return g&&(this.switchLayer(f,g),this.sortLayers()),{curLayer:f,forward:g}}switchLayer(l,u){const f=l.layer;l.layer=u.layer,u.layer=f}sendBackward(l){const u=this.layers.findIndex(m=>m.annotationUid===l);if(u<0)return null;const f=this.layers[u],g=this.layers[u-1];return g&&(this.switchLayer(f,g),this.sortLayers()),{curLayer:f,backward:g}}bringToFront(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return null;const f=this.layers[u];return u<this.layers.length-1&&(f.layer=this.top,this.top+=1,this.sortLayers()),f}sendToBack(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return null;const f=this.layers[u];return u>0&&(f.layer=this.bottom,this.bottom-=1,this.sortLayers()),f}restoreLayer(l,u){const f=this.layers.findIndex(g=>g.annotationUid===l);return f<0?null:(this.layers[f].layer=u,this.sortLayers(),!0)}getLayerState(l){const u=this.layers.findIndex(g=>g.annotationUid===l);if(u<0)return{back:!1,front:!1,forward:!1,backward:!1};const f={back:!0,front:!0,forward:!0,backward:!0};return 0===u&&(f.back=!1,f.backward=!1),u===this.layers.length-1&&(f.front=!1,f.forward=!1),1===this.layers.length&&(f.front=!1,f.forward=!1,f.back=!1,f.backward=!1),f}getAnnotationUidListByLayer(){return this.layers.slice().sort((l,u)=>l.layer-u.layer).map(l=>l.annotationUid)}}const Qn=new class{constructor(){S(this,"db",void 0),this.db=new Map}findAnnotationByUid(p){return this.db.get(p)}deleteAnnotation(p){return!!this.db.has(p.uid)&&(this.db.delete(p.uid),!0)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Sl=new class{constructor(){S(this,"db",void 0),this.db=new Map}findCommentByUid(p){return this.db.get(p)}deleteComment(p){this.db.has(p.uid)&&this.db.delete(p.uid)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Ur=new class{constructor(){S(this,"db",void 0),this.db=new Map}findPageByUid(p){return this.db.get(p)}deletePagesByUids(p){p.forEach(l=>{this.db.delete(l)})}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Vs=new class extends mi{constructor(){super(...arguments),S(this,"annotationCreated",Re(this)),S(this,"annotationDeleted",Re(this)),S(this,"annotationUpdated",Re(this)),S(this,"commentDeleted",Re(this)),S(this,"commentUpdated",Re(this)),S(this,"replyToAnnotation",Re(this)),S(this,"replyDeleted",Re(this)),S(this,"replyUpdated",Re(this)),S(this,"setReplyReviewState",Re(this)),S(this,"deleteReplyReviewState",Re(this)),S(this,"bringFroward",Re(this)),S(this,"sendBackward",Re(this)),S(this,"bringToFront",Re(this)),S(this,"sendToBack",Re(this)),S(this,"restoreLayer",Re(this)),S(this,"annotationPageSwitched",Re(this))}};class BT extends xr{static create(l){return new BT(l)}constructor(l){super("annotationCreatedDomainEvent"),S(this,"annotations",void 0),this.annotations=l}}const _oe=new class{constructor(p,l,u,f){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"annotationPageRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.annotationPageRepo=u,this.eventHooks=f}execute(p){const l=p.map(f=>{const g=iw.create(ne({},f)),m=this.annotationPageRepo.findPageByUid(g.pageUid).addAnnotation(g.uid,f.layer);if(m&&(g.layer=m.layer),this.annotationRepo.save(g),f.comment){var v;const y=nw.create(f.comment);g.comment=y,null!==(v=f.comment.replies)&&void 0!==v&&v.length&&f.comment.replies.forEach(x=>{const w=Mp.create(x);y.replies.push(w),this.replyRepo.save(w)})}return g}),u=BT.create(l);return this.eventHooks.annotationCreated.emit(u),l}}(Qn,Sl,Ur,Vs);class UT extends xr{static create(l,u){return new UT(l,u)}constructor(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),S(this,"annotations",void 0),S(this,"emitEvent",void 0),this.annotations=l,this.emitEvent=u}}const Soe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"annotationPageRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHooks=u}execute(p){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const f of p)if(!this.annotationRepo.has(f))return!1;p.forEach(f=>{this.annotationRepo.deleteAnnotation(f),this.annotationPageRepo.findPageByUid(f.pageUid).deleteAnnotations([f.uid])});const u=UT.create(p,l);return this.eventHooks.annotationDeleted.emit(u),!0}}(Qn,Ur,Vs),Eoe=new class{constructor(p){S(this,"annotationRepo",void 0),this.annotationRepo=p}execute(p){return this.annotationRepo.findAnnotationByUid(p)}}(Qn);class VT extends xr{static create(l){return new VT(l)}constructor(l){super("replyToAnnotationDomainEvent"),S(this,"reply",void 0),this.reply=l}}const Toe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid),u=Mp.create({annotationUid:p.annotationUid,author:p.author,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,subject:""});l.addReplies([u]),this.replyRepo.save(u);const f=VT.create(u);return this.eventHooks.replyToAnnotation.emit(f),!0}}(Qn,Sl,Vs);class jT extends xr{static create(l,u,f){return new jT(l,u,f)}constructor(l,u,f){super("annotationUpdatedDomainEvent"),S(this,"updateDetails",void 0),S(this,"updatedBy",void 0),S(this,"updateActions",void 0),this.updateDetails=l,this.updatedBy=u,this.updateActions=f}}const Doe=new class{constructor(p,l){S(this,"annotationRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=l}execute(p){const l=[],u=p.updateDetails.map(g=>{const m=this.annotationRepo.findAnnotationByUid(g.uid);if(!m)return null;const v=m.getConfig();g.style&&m.updateStyle(g.style),g.transform&&gn(g.transform,m.transform),g.flags&&(m.flags=[...g.flags]),m.modified=g.modified,g.comment&&Object.assign(m.comment,g.comment),this.annotationRepo.save(m);const y=m.getConfig();return l.push({annotationUid:m.uid,from:v,to:y}),m}),f=jT.create(l,p.updatedBy,p.updateActions);return this.eventHooks.annotationUpdated.emit(f),u}}(Qn,Vs);class HT extends xr{static create(l){return new HT(l)}constructor(l){super("replyUpdatedDomainEvent"),S(this,"reply",void 0),this.reply=l}}const Aoe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;const u=this.replyRepo.findCommentByUid(p.replyUid);if(!u)return!1;u.updateReply({author:p.author,contents:p.contents,modifiedDate:p.modifiedDate}),l.updateReply(u),this.annotationRepo.save(l),this.replyRepo.save(u);const f=HT.create(u);return this.eventHooks.replyUpdated.emit(f),!0}}(Qn,Sl,Vs);class WT extends xr{static create(l){return new WT(l)}constructor(l){super("replyDeletedDomainEvent"),S(this,"reply",void 0),this.reply=l}}const Ioe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){if(!this.replyRepo.has(p))return!1;const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;l.deleteReplies([p]),this.replyRepo.deleteComment(p);const u=WT.create(p);return this.eventHooks.replyDeleted.emit(u),!0}}(Qn,Sl,Vs);class GT extends xr{static create(l,u,f){return new GT(l,u,f)}constructor(l,u,f){super("bringToFrontDomainEvent"),S(this,"annotationUid",void 0),S(this,"from",void 0),S(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const Poe=new class{constructor(p,l,u){S(this,"annotRepo",void 0),S(this,"annotPageRepo",void 0),S(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.bringToFront(p);if(!g)return!1;l.layer=g.layer;const m=u.getAnnotationUidListByLayer(),v=GT.create(p,f,m);return this.eventHooks.bringToFront.emit(v),!0}}(Qn,Ur,Vs);class zT extends xr{static create(l,u,f){return new zT(l,u,f)}constructor(l,u,f){super("sendToBackDomainEvent"),S(this,"annotationUid",void 0),S(this,"from",void 0),S(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const Roe=new class{constructor(p,l,u){S(this,"annotRepo",void 0),S(this,"annotPageRepo",void 0),S(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.sendToBack(p);if(!g)return!1;l.layer=g.layer;const m=u.getAnnotationUidListByLayer(),v=zT.create(p,f,m);return this.eventHooks.sendToBack.emit(v),!0}}(Qn,Ur,Vs);class $T extends xr{static create(l,u,f,g){return new $T(l,u,f,g)}constructor(l,u,f,g){super("bringForwardDomainEvent"),S(this,"annotationUid",void 0),S(this,"forwardUid",void 0),S(this,"from",void 0),S(this,"to",void 0),this.annotationUid=l,this.forwardUid=u,this.from=f,this.to=g}}const Moe=new class{constructor(p,l,u){S(this,"annotRepo",void 0),S(this,"annotPageRepo",void 0),S(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.bringForward(p);if(!g)return!1;const{curLayer:m,forward:v}=g;l.layer=m.layer,v&&(this.annotRepo.findAnnotationByUid(v.annotationUid).layer=v.layer);const y=u.getAnnotationUidListByLayer(),x=$T.create(p,null==v?void 0:v.annotationUid,f,y);return this.eventHooks.bringFroward.emit(x),!0}}(Qn,Ur,Vs);class YT extends xr{static create(l,u,f,g){return new YT(l,u,f,g)}constructor(l,u,f,g){super("sendBackwardDomainEvent"),S(this,"annotationUid",void 0),S(this,"backwardUid",void 0),S(this,"from",void 0),S(this,"to",void 0),this.annotationUid=l,this.backwardUid=u,this.from=f,this.to=g}}const koe=new class{constructor(p,l,u){S(this,"annotRepo",void 0),S(this,"annotPageRepo",void 0),S(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=l,this.eventHooks=u}execute(p){const l=this.annotRepo.findAnnotationByUid(p);if(!l)return!1;const u=this.annotPageRepo.findPageByUid(l.pageUid),f=u.getAnnotationUidListByLayer(),g=u.sendBackward(p);if(!g)return!1;const{curLayer:m,backward:v}=g;l.layer=m.layer,v&&(this.annotRepo.findAnnotationByUid(v.annotationUid).layer=v.layer);const y=u.getAnnotationUidListByLayer(),x=YT.create(p,null==v?void 0:v.annotationUid,f,y);return this.eventHooks.sendBackward.emit(x),!0}}(Qn,Ur,Vs);class XT extends xr{static create(l){return new XT(l)}constructor(l){super("commentUpdatedDomainEvent"),S(this,"comment",void 0),this.comment=l}}const Ooe=new class{constructor(p,l){S(this,"annotationRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=l}execute(p){const l=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!l)return!1;l.updateComment(p);const u=XT.create(l.comment);return this.eventHooks.commentUpdated.emit(u),!0}}(Qn,Vs);class qT extends xr{static create(l){return new qT(l)}constructor(l){super("deleteReplyReviewStateDomainEvent"),S(this,"replyUid",void 0),this.replyUid=l}}const Loe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.replyRepo.findCommentByUid(p);if(!l)return!1;const u=this.annotationRepo.findAnnotationByUid(l.annotationUid);if(!u)return!1;u.deleteReplyReviewSate(l),this.annotationRepo.save(u);const f=qT.create(p);return this.eventHooks.deleteReplyReviewState.emit(f),!0}}(Qn,Sl,Vs);class ZT extends xr{static create(l){return new ZT(l)}constructor(l){super("setReplyReviewStateDomainEvent"),S(this,"author",void 0),S(this,"creationDate",void 0),S(this,"contents",void 0),S(this,"state",void 0),S(this,"replyUid",void 0),this.author=l.author,this.creationDate=l.creationDate,this.contents=l.contents,this.state=l.state,this.replyUid=l.replyUid}}const Foe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=l,this.eventHooks=u}execute(p){const l=this.replyRepo.findCommentByUid(p.replyUid);if(!l)return!1;const u=this.annotationRepo.findAnnotationByUid(l.annotationUid);if(!u)return!1;u.setReplyReviewState(l,p),this.annotationRepo.save(u);const f=ZT.create(p);return this.eventHooks.setReplyReviewState.emit(f),!0}}(Qn,Sl,Vs),Noe=new class{constructor(p){S(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){let l=this.annotationPageRepo.findPageByUid(p);return l||(l=sw.create(p),this.annotationPageRepo.save(l)),l}}(Ur),Boe=new class{constructor(p,l,u){S(this,"annotationPageRepo",void 0),S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l,this.replyRepo=u}execute(p){const l=this.annotationPageRepo.findPageByUid(p.pageUid);if(!l)return null;const u=l.clone(p.newPageUid),f=new Map;return l.annotations.forEach((g,m)=>{const v=this.annotationRepo.findAnnotationByUid(g).clone(p.newPageUid,"");v.comment.replies.forEach(y=>{this.replyRepo.save(y)}),this.annotationRepo.save(v),u.annotations[m]=v.uid,f.set(g,v.uid)}),u.layers.forEach(g=>{g.annotationUid=f.get(g.annotationUid)}),this.annotationPageRepo.save(u),u}}(Ur,Qn,Sl),Uoe=new class{constructor(p){S(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){this.annotationPageRepo.deletePagesByUids(p)}}(Ur),Voe=new class{constructor(p,l,u){S(this,"annotationPageRepo",void 0),S(this,"annotationRepo",void 0),S(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l,this.replyRepo=u}execute(p){const l=this.annotationPageRepo.findPageByUid(p.pageUid);if(!l)return null;const u=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!u)return null;const f=u.clone(p.pageUid," ");return f.comment.replies.forEach(g=>{this.replyRepo.save(g)}),l.addAnnotation(f.uid),this.annotationRepo.save(f),f}}(Ur,Qn,Sl);class JT extends xr{static create(l,u,f){return new JT(l,qe(u),qe(f))}constructor(l,u,f){super("annotationPageSwitchedDomainEvent"),S(this,"annotationUid",void 0),S(this,"from",void 0),S(this,"to",void 0),this.annotationUid=l,this.from=u,this.to=f}}const joe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"annotationPageRepo",void 0),S(this,"eventHook",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHook=u}execute(p){const{annotationUid:l,pageUid:u,x:f,y:g,layer:m}=p,v=this.annotationRepo.findAnnotationByUid(l);if(!v)return!1;const y=this.annotationPageRepo.findPageByUid(v.pageUid);if(!y)return!1;const x=this.annotationPageRepo.findPageByUid(u);if(!x)return!1;const w={pageUid:v.pageUid,x:v.style.x,y:v.style.y,layer:v.layer};y.deleteAnnotations([l]),x.addAnnotation(l,m),v.updateStyle({x:f,y:g}),v.layer=m,v.pageUid=u;const C=JT.create(v.uid,w,{pageUid:u,x:f,y:g,layer:m});return this.eventHook.annotationPageSwitched.emit(C),!0}}(Qn,Ur,Vs);class QT extends xr{static create(l,u){return new QT(l,u)}constructor(l,u){super("restoreLayerDomainEvent"),S(this,"annotationUid",void 0),S(this,"layer",void 0),this.annotationUid=l,this.layer=u}}const Hoe=new class{constructor(p,l,u){S(this,"annotationRepo",void 0),S(this,"annotationPageRepo",void 0),S(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=l,this.eventHooks=u}execute(p){let{annotationUid:l,layer:u}=p;const f=this.annotationRepo.findAnnotationByUid(l);if(!f)return!1;this.annotationPageRepo.findPageByUid(f.pageUid).restoreLayer(l,u),f.layer=u;const g=QT.create(l,u);return this.eventHooks.restoreLayer.emit(g),!0}}(Qn,Ur,Vs),Woe=new class{constructor(p,l){S(this,"annotationPageRepo",void 0),S(this,"annotationRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=l}execute(p){let l={back:!1,front:!1,forward:!1,backward:!1};const u=this.annotationRepo.findAnnotationByUid(p);if(!u)return l;const f=this.annotationPageRepo.findPageByUid(u.pageUid);return f&&(l=f.getLayerState(p)),l}}(Ur,Qn);class Goe extends mi{constructor(){super(),S(this,"annotationRepo",Qn),S(this,"annotationReplyRepo",Sl),S(this,"annotationPageRepo",Ur),S(this,"hooks",Vs),this.register(Vs)}dispose(){this.reset(),this.hooks.dispose(),super.dispose()}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear()}createAnnotationPage(l){return Noe.execute(l)}copyAnnotationPage(l,u){return Boe.execute({pageUid:l,newPageUid:u})}deleteAnnotationPage(l){return Uoe.execute(l)}createAnnotations(l){return _oe.execute(l)}copyAnnotation(l,u){return Voe.execute({annotationUid:l,pageUid:u})}deleteAnnotations(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=l.map(g=>(nt(g)&&(g=Qn.findAnnotationByUid(g)),g));return Soe.execute(f,u)}updateAnnotation(l){return Doe.execute(l)}switchAnnotationPage(l,u){return joe.execute(ne({annotationUid:vt(l)?l.uid:l},u))}getAnnotationByUid(l){return Eoe.execute(l)}getAnnotationLayerState(l){return Woe.execute(l)}replyToAnnotation(l){return Toe.execute(l)}deleteReply(l){return nt(l)&&(l=Sl.findCommentByUid(l)),Ioe.execute(l)}updateReply(l){return Aoe.execute(l)}updateComment(l){return Ooe.execute(l)}deleteReplyReviewState(l){return Loe.execute(l)}setReplyReviewState(l){return Foe.execute(l)}bringToFront(l){return Poe.execute(l)}sendToBack(l){return Roe.execute(l)}bringForward(l){return Moe.execute(l)}sendBackward(l){return koe.execute(l)}restoreLayer(l,u){return Hoe.execute({annotationUid:l,layer:u})}}const zoe=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle"];class $oe extends mi{constructor(l){super(),S(this,"context",void 0),this.context=l}updateConfig(l){for(const[u,f]of Object.entries(l))zoe.includes(u)&&this[u](f)}defaultStyleConfig(l){if(!vt(l))return;const{annotationController:u}=this.context,{viewer:f}=this.context;u.setAnnotationInteractiveConfig({defaultStyleConfig:l}),u.updateFreeTextDefaultConfig(),f.hooks.annotationDefaultStyleChanged.emit(f.getAnnotationConfig().defaultStyleConfig),f.emit("annotationDefaultStyleChanged",f.getAnnotationConfig().defaultStyleConfig)}enableContinuousDrawing(l){const{annotationController:u}=this.context;u.interactiveConfig.enableContinuousDrawing=l}controlsStyle(l){if(!vt(l))return;const{annotationController:u}=this.context;u.setAnnotationInteractiveConfig({controlsStyle:l})}inkCreateDelay(l){const{annotationController:u}=this.context;u.interactiveConfig.inkCreateDelay=l}showOnTopWhenSelected(l){const{annotationController:u}=this.context;u.interactiveConfig.showOnTopWhenSelected=l}}const oB={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},Yoe={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class Xoe extends mi{constructor(l){super(),S(this,"viewer",void 0),S(this,"annotationConfigService",void 0),S(this,"annotationController",void 0),S(this,"context",void 0),this.viewer=l,this.context=l.context,this.annotationConfigService=new $oe(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation()}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new DL).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new bie(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on(l=>{const u=new Set(l.shapes.map(f=>f.uid));this.context.core.annotationService.deleteAnnotations([...u])},this),this.annotationController.hooks.selectAnnotation.on(l=>{const u=IE.create(l.oldAnnotationsUids,l.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(u),l.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...l.newAnnotationUids],oldAnnotationUids:[...l.oldAnnotationsUids]})},this),this.annotationController.hooks.modifyAnnotation.on(l=>{const u=l.shapes.map(f=>{const g=f.shape.getAnnotationConfig();return{annotationUid:f.uid,options:{transform:qe(g.transform),style:g.style}}});this.context.core.annotationService.updateAnnotations(u,this.context.uid,l.actions)},this),this.annotationController.hooks.addAnnotation.on(l=>{const u=this.context.getActiveTab();if(!u)return;const{annotationService:f}=this.context.core;l.shapes.forEach(g=>{const m=g.shape.getAnnotationConfig(),v=Lr(),y=f.createAnnotation(u.uid,{uid:g.uid,docUid:u.uid,pageUid:g.shape.pageUid,type:Yoe[m.type],transform:qe(m.transform),style:qe(m.style),flags:["print"],comment:{annotationUid:g.uid,author:"",subject:"",contents:"",creationDate:v,modificationDate:v,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(g.uid,y.layer)})},this),this.annotationController.hooks.annotationModeChanged.on(l=>{"none"===l&&"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"})}),this.annotationController.hooks.beforeAnnotationEdit.on(l=>{this.viewer.hooks.beforeAnnotationEdit.emit(l)}),this.annotationController.hooks.afterAnnotationEdit.on(l=>{this.viewer.hooks.afterAnnotationEdit.emit(l)}),this.annotationController.hooks.beforeAnnotationDraw.on(l=>{this.viewer.hooks.beforeAnnotationDraw.emit(l)}),this.annotationController.hooks.afterAnnotationDraw.on(l=>{this.viewer.hooks.afterAnnotationDraw.emit(l)}),this.annotationController.hooks.renderAnnotation.on(()=>{this.context.render()}),this.annotationController.hooks.selectAnnotationTextChars.on(l=>{this.viewer.hooks.annotationTextCharsSelected.emit(l)}))}listenViewerNativeEventsForAnnotation(){const l=this.context.rendererService.getCanvasDom();In(l,gi()?"click":"pointerup",this).on(u=>{u.preventDefault(),this.annotationController.clickHandler(u)}),In(document,"keydown",this).on(u=>{this.annotationController.keyDownHandler(u)}),In(l,"dblclick",this).on(u=>{this.annotationController.dblClickHandler(u)})}listenViewerEventsForAnnotation(){const{context:l,context:{hooks:u,tabService:f}}=this;(l.isDefaultViewer||l.isThumbnailViewer)&&(u.pageExistenceChanged.on(g=>{0===g.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null)}),u.toolModeChanged.on(g=>{const{annotationMode:m}=l.viewerConfig;if("annotation"!==g.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===g.newToolMode&&this.selectAnnotations([]);else{let v="draw";"select"===m?v="select":"erase"===m&&(v="erase"),this.annotationController.setAnnotationMode(v)}},this),u.annotationModeChanged.on(g=>{const{toolMode:m}=l.viewerConfig;if("select"===g.newAnnotationMode||"erase"===g.newAnnotationMode){const v=g.newAnnotationMode;"annotation"===m&&this.annotationController.setAnnotationMode(v)}else this.annotationController.drawType=oB[g.newAnnotationMode],"annotation"===m&&this.annotationController.setAnnotationMode("draw")},this),u.addPagesToDoc.on(g=>{f.getTab(g.docUid)&&this.addAnnotationByPageUids(g.pageUids)},this),u.openDocument.on(g=>{f.getTab(g.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(g.pages))},this),u.closeDocument.on(g=>{g.pages.forEach(m=>{const v=this.context.core.pageService.getPage(m);this.annotationController.deleteShape(v.annotations,!1,!1)})},this),u.deletePages.on(g=>{g.pageUids.forEach(m=>{const v=this.context.core.pageService.getPage(m);this.annotationController.deleteShape(v.annotations,!1,!1)})},this),u.syncDocument.on(g=>{f.getTab(g.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(g.pages))},this),u.afterRender.on(g=>{if(null==g||!g.total)return;const m=l.annotationEditService.containerPage;if(!m||!g.getPageByUid(m.uid))return;let{x:v,y}=m.cropBox.getPosition(),{width:x,height:w}=m.cropBox;const C=(m.rotation%360+360)%360/90;if(1===C?v-=w:2===C?(v-=x,y-=w):3===C&&(y-=x),1===C||3===C){const _=x;x=w,w=_}this.annotationController.eventService.setEventArea({x:v,y,width:x,height:w})},this))}disableTextEditMode(){const{eventService:l}=this.annotationController;null!=l&&l.activatedShape&&(null==l?void 0:l.activatedShape)instanceof vi&&null!=l&&l.activatedShape.isEditMode&&(null==l||l.activatedShape.textEditEventHandler.disableEditMode(),this.context.render())}addAnnotationByPageUids(l){l.forEach(u=>{const f=this.context.core.pageService.getPage(u);if(f.annotations.forEach(g=>{const m=this.context.core.annotationService.annotationApp.getAnnotationByUid(g);this.addAnnotationByAnnotationData(m)}),0===f.annotations.length){const g=this.context.tabService.getTab(f.doc.uid);if(!g)return;const m=g.getPageByUid(f.uid);if(!m)return;this.annotationController.setAnnotationContainer(f.uid,m.mediaBox)}})}addAnnotationByAnnotationData(l){if("unknown"===l.type)return!0;const u=this.context.core.pageService.getPage(l.pageUid);if(!u)return!1;const f=this.context.tabService.getTab(u.doc.uid);if(!f)return!1;const g=f.getPageByUid(l.pageUid);if(!g)return!1;const m=l.getConfig();this.annotationController.setAnnotationContainer(l.pageUid,g.mediaBox);const v=this.annotationController.addShape(oB[l.type],{id:l.uid,style:Fe(ne({},m.style),{zIndex:l.layer}),transform:m.transform},!1);if(this.annotationController.setAnnotationFlags(l.uid,{enableControl:!m.flags.includes("readOnly"),isVisible:!m.flags.includes("noView")},!1),v instanceof yo&&"base"===v.stampType){const y=v.getAnnotationConfig();l.transform.position=y.transform.position,l.transform.scale=y.transform.scale,l.style=y.style}if(v instanceof vi&&"freeTextWriter"===v.textType){const y=v.getAnnotationConfig();l.style.width=y.style.width}return this.syncAnnotationLayerState(),!0}updateAnnotations(l,u){if(u===this.context.uid)return!0;const f=l.reduce((g,m)=>{const v=this.context.core.annotationService.annotationApp.getAnnotationByUid(m);if(v){const y=this.context.core.pageService.getPage(v.pageUid);if(y&&this.context.tabService.getTab(y.doc.uid)){const x=v.getConfig();g.push({annotationUid:m,config:x})}}return g},[]);return f.length===l.length&&(f.forEach(g=>{var m,v;let{annotationUid:y,config:x}=g;this.annotationController.updateShape(y,{id:y,style:x.style,transform:x.transform},!1);const w=this.annotationController.getShape(y),C=this.context.core.annotationService.annotationApp.getAnnotationByUid(y),_=w.getAnnotationConfig();null!=_&&null!==(m=_.transform)&&void 0!==m&&m.position&&(C.transform.position=_.transform.position),null!=_&&null!==(v=_.transform)&&void 0!==v&&v.scale&&(C.transform.scale=_.transform.scale),w instanceof yo&&"stamp"===w.renderType&&(C.style.stampConfig=_.style.stampConfig),this.annotationController.setAnnotationFlags(y,{enableControl:!x.flags.includes("readOnly"),isVisible:!x.flags.includes("noView")})}),!0)}updateAnnotationPage(l,u){const f=this.context.core.annotationService.getAnnotationByUid(l);if(!f)return;const g=this.context.core.pageService.getPage(f.pageUid);if(!g)return;const m=this.context.tabService.getTab(g.doc.uid);if(!m)return;const v=m.getPageByUid(u);v&&(this.annotationController.moveShape([l],u,v.mediaBox),this.syncAnnotationLayerState())}updateLayer(l){const u=l.reduce((f,g)=>{const m=this.context.core.annotationService.annotationApp.getAnnotationByUid(g);if(m){const v=this.context.core.pageService.getPage(m.pageUid);v&&this.context.tabService.getTab(v.doc.uid)&&f.push(m)}return f},[]);return u.length===l.length&&(u.forEach(f=>{this.annotationController.updateLayer(f.uid,f.layer)}),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let l={back:!1,front:!1,forward:!1,backward:!1};const u=this.annotationController.getSelectedShapeUids();return 1===u.length&&(l=this.context.core.annotationService.getAnnotationLayerState(u[0])),this.viewer.hooks.annotationLayerStateChanged.emit(RE.create(l)),l}deleteAnnotations(l){this.annotationController.deleteShape(l,!1,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.syncAnnotationLayerState()}selectAnnotations(l){return this.annotationController.selectShape(l)}getSelectedAnnotations(){const l=this.annotationController.getSelectedShapeUids();if(!l.length)return[];const u=[];return l.forEach(f=>{const g=this.context.core.annotationService.annotationApp.getAnnotationByUid(f);g&&u.push(g)}),u}duplicateAnnotation(l,u){throw new Error("Method not implemented.")}}class qoe extends mi{constructor(l){super(),S(this,"context",void 0),S(this,"containerPage",void 0),this.context=l}isHitAnnotation(l){return this.context.annotationController.isHitShape(l)}startHandler(l,u){this.context.annotationController.startHandler(l,u)}cursorHandler(l,u,f){this.context.annotationController.cursorHandler(l,u,f)}moveHandler(l,u){this.context.annotationController.moveHandler(l,u)}endHandler(l){this.context.annotationController.endHandler(l)}activateAnnotation(l,u){this.context.annotationController.eventService.activateShape(l,u)}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear()}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}moveAnnotationByKeyboard(l){}setAnnotationContainer(l){this.containerPage=l,this.context.annotationController.setAnnotationContainer(l.uid,l.mediaBox)}setAnnotationInteractionArea(l){this.context.annotationController.eventService.setEventArea(l)}copyAnnotations(){const l=this.context.annotationController.getSelectedShapeUids();0===l.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(l)}cutAnnotations(){const l=this.context.annotationController.getSelectedShapeUids();0===l.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(l)}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations()}dispose(){super.dispose(),this.containerPage=null}}class Zoe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{action:l}=this,{annotationApp:u}=this.core.annotationService,{annotationConfig:f}=this.action;return!!u.createAnnotations([{docUid:l.docUid,uid:f.uid,pageUid:l.pageUid,type:f.type,style:f.style,transform:f.transform,flags:f.flags,comment:f.comment,layer:f.layer}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid])}}class Joe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="deleteAnnotation",u.commandService.onBeforeRefreshCommands.on(f=>{l.docUid===f.docUid&&(l.deleteConfigs.slice().forEach(g=>{if(f.pageUids.includes(g.pageUid)){const m=l.deleteConfigs.findIndex(v=>v.pageUid===g.pageUid);l.deleteConfigs.splice(m,1)}}),this.isValid=l.deleteConfigs.length>0)},this)}execute(){const{action:l}=this,u=l.deleteConfigs.map(f=>f.uid);return this.core.annotationService.annotationApp.deleteAnnotations(u),!0}undo(){const{annotationApp:l}=this.core.annotationService,u=this.action.deleteConfigs.map(f=>({docUid:this.action.docUid,uid:f.uid,type:f.type,pageUid:f.pageUid,style:f.style,transform:f.transform,flags:f.flags,comment:f.comment,layer:f.layer,oriIndex:f.oriIndex,modified:f.modified}));l.createAnnotations(u)}}class Qoe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),S(this,"oldLayer",void 0),S(this,"newLayer",void 0),this.action=l,this.core=u,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:l}=this.core.annotationService,{annotationUid:u}=this.action,f=l.getAnnotationByUid(u);return this.oldLayer||(this.oldLayer=f.layer),this.newLayer?l.restoreLayer(u,this.newLayer):(l.bringToFront(u),this.newLayer=f.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class Koe extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}}class eae extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}}class tae extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),S(this,"oldLayer",void 0),S(this,"newLayer",void 0),this.action=l,this.core=u,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on(f=>{f.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:l}=this.core.annotationService,{annotationUid:u}=this.action,f=l.getAnnotationByUid(u);return this.oldLayer||(this.oldLayer=f.layer),this.newLayer?l.restoreLayer(u,this.newLayer):(l.sendToBack(u),this.newLayer=f.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class iae extends wl{constructor(l,u,f){super(),S(this,"action",void 0),S(this,"core",void 0),S(this,"updatedBy",void 0),this.action=l,this.core=u,this.updatedBy=f,this.type="updateAnnotation",u.commandService.onBeforeRefreshCommands.on(g=>{if(l.docUid!==g.docUid)return;const{pageUid:m}=l;g.pageUids.includes(m)&&(this.isValid=!1)},this)}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1)}update(l){const{annotationApp:u}=this.core.annotationService,f=this.action.updateDetails.map(g=>{const m=qe(l?g.to:g.from);return ne({uid:g.annotationUid},m)});u.updateAnnotation({updateDetails:f,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]})}}class nae extends wl{constructor(l,u){super(),S(this,"action",void 0),S(this,"core",void 0),this.action=l,this.core=u,this.type="switchAnnotationPage",u.commandService.onBeforeRefreshCommands.on(f=>{l.docUid===f.docUid&&l.moveConfigs.slice().every(g=>((f.pageUids.includes(g.from.pageUid)||f.pageUids.includes(g.to.pageUid))&&(this.isValid=!1),this.isValid))},this)}execute(){const{annotationApp:l}=this.core.annotationService;return this.action.moveConfigs.forEach(u=>{if(Se(u.to.layer)){const f=l.annotationPageRepo.findPageByUid(u.to.pageUid).createTop();u.to.layer=f}l.switchAnnotationPage(u.annotationUid,ne({},u.to))}),!0}undo(){const{annotationApp:l}=this.core.annotationService;this.action.moveConfigs.forEach(u=>{l.switchAnnotationPage(u.annotationUid,ne({},u.from))})}}class sae extends mi{constructor(l){super(),S(this,"core",void 0),S(this,"annotationApp",void 0),S(this,"hooks",void 0),S(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),S(this,"clipboard",[]),this.core=l,this.annotationApp=new Goe,this.hooks=this.annotationApp.hooks}reset(){this.annotationApp.reset()}getAnnotationByUid(l){return this.annotationApp.getAnnotationByUid(l)}deleteAnnotationPages(l){const u=l.reduce((f,g)=>{const m=this.core.pageService.getPage(g);return m&&f.push(...m.annotations),f},[]);this.deleteAnnotations(u,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(l)}createAnnotationsByParsedPages(l,u){const f=Lr();return u.reduce((g,m)=>{var v;this.annotationApp.createAnnotationPage(m.pageUid);const y=null===(v=m.annotations)||void 0===v?void 0:v.reduce((x,w)=>{var C,_,T,M,L;lB(w);const N={uid:w.uid,docUid:l,pageUid:m.pageUid,type:w.type,style:w.style,transform:w.transform,flags:w.flags,comment:rae(w.comment),creationDate:null!==(C=null===(_=w.comment)||void 0===_?void 0:_.creationDate)&&void 0!==C?C:f,modificationDate:null!==(T=null===(M=w.comment)||void 0===M?void 0:M.modifiedDate)&&void 0!==T?T:f,oriIndex:null===(L=w.raw)||void 0===L?void 0:L.oriIndex};return x.push(N),x},[]);return null!=y&&y.length?(this.annotationApp.createAnnotations(y),g.push(y.map(x=>x.uid))):g.push([]),g},[])}createAnnotation(l,u){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(lB(u),f){const g=new Zoe({actionUid:qt(),type:"createAnnotation",docUid:l,pageUid:u.pageUid,annotationConfig:{uid:u.uid,type:u.type,style:u.style,transform:u.transform,flags:u.flags,comment:u.comment,layer:u.layer,modified:u.modified,oriIndex:u.oriIndex}},this.core);this.core.commandService.execute(g,l)}else this.annotationApp.createAnnotations([u]);return this.annotationApp.getAnnotationByUid(u.uid)}deleteAnnotations(l){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:f,commandService:g}=this.core,m=l.reduce((v,y)=>{const x=this.annotationApp.getAnnotationByUid(y);if(x){const w=f.getPage(x.pageUid),C=v.get(w.doc.uid)||{uid:w.doc.uid,annotationConfigs:[]};v.set(C.uid,C);const _=x.getConfig();_.layer=x.layer,C.annotationConfigs.push(_)}return v},new Map);if(u)for(const[v,y]of m){const x=y.annotationConfigs.map(C=>({uid:C.uid,type:C.type,pageUid:C.pageUid,style:C.style,transform:C.transform,flags:C.flags,comment:C.comment,layer:C.layer,oriIndex:C.oriIndex,modified:C.modified})),w=new Joe({actionUid:qt(),type:"createAnnotation",docUid:v,deleteConfigs:x},this.core);g.execute(w,y.uid)}else this.annotationApp.deleteAnnotations(l,!1)}updateAnnotations(l,u,f){let g,m;const v=l.reduce((C,_)=>{const{annotationUid:T}=_,M=this.annotationApp.getAnnotationByUid(T);if(M){const L=this.core.pageService.getPage(M.pageUid);L&&(g=L.uid,m=L.doc.uid,C.push({annotation:M,page:L,options:_.options}))}return C},[]);if(null==v||!v.length||v.length!==l.length)return;const y=Lr(),x=v.map(C=>{let{annotation:_,options:M}=C;return M.comment||(M.comment={}),M.comment.modificationDate=y,{annotationUid:_.uid,from:Fe(ne({},_.getConfig()),{modified:_.modified}),to:Fe(ne({},M),{modified:!0})}}),w=new iae({actionUid:qt(),type:"updateAnnotation",docUid:m,pageUid:g,updateDetails:x,updateActions:f||[]},this.core,u);this.core.commandService.execute(w,m)}switchAnnotationPage(l){const u=l.map(v=>ne({annotation:this.annotationApp.getAnnotationByUid(v.annotationUid)},v)),f=this.core.pageService.getPage(u[0].annotation.pageUid);if(!f)return;const g=u.map(v=>{let{annotationUid:y,annotation:x,pageUid:w,x:C,y:_}=v;return{annotationUid:y,from:{pageUid:x.pageUid,x:x.style.x,y:x.style.y,layer:x.layer},to:{pageUid:w,x:Se(C)?x.style.x:C,y:Se(_)?x.style.y:_,layer:void 0}}}),m=new nae({actionUid:qt(),type:"switchAnnotationPage",docUid:f.doc.uid,moveConfigs:g},this.core);this.core.commandService.execute(m,f.doc.uid)}duplicateAnnotation(l,u){const f=this.annotationApp.getAnnotationByUid(l);if(!f)return null;const g=f.getConfig();return g.uid=qt(),u&&(g.pageUid=u),g.comment.creationDate=Lr(),g.comment.modificationDate=g.comment.creationDate,this.createAnnotation(g.docUid,g)}copyAnnotations(l){l.length&&(this.clipboard=[]),l.forEach(u=>{const f=this.annotationApp.getAnnotationByUid(u);if(f){const g=f.getConfig();this.clipboard.push(g)}})}cutAnnotations(l){this.copyAnnotations(l),this.deleteAnnotations(l)}pasteAnnotations(l,u){this.clipboard.length&&this.clipboard.forEach(f=>{const g=Lr(),m=qe(f),v=qt();Object.assign(m,{uid:v,docUid:l,pageUid:u,creationDate:g,modificationDate:g});const y={annotationUid:v,creationDate:g,modificationDate:g,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(m.comment,y):Object.assign(m.comment,y,{contents:""}),this.createAnnotation(f.docUid,m)})}clearAnnotationClipboard(){this.clipboard=[]}bringToFront(l){return this.handleLayer(l,"f")}bringForward(l){return this.handleLayer(l,"fw")}sendToBack(l){return this.handleLayer(l,"b")}sendBackward(l){return this.handleLayer(l,"bw")}handleLayer(l,u){const f=this.annotationApp.getAnnotationByUid(l);if(!f)return!1;const g=this.core.pageService.getPage(f.pageUid);if(!g)return!1;const m={actionUid:qt(),type:u,annotationUid:l,docUid:g.doc.uid,pageUid:g.uid},v=this.annotationApp.getAnnotationLayerState(l);let y;return"f"===u&&v.front?y=new Qoe(m,this.core):"fw"===u&&v.forward?y=new Koe(m,this.core):"bw"===u&&v.backward?y=new eae(m,this.core):"b"===u&&v.back&&(y=new tae(m,this.core)),y&&this.core.commandService.execute(y,g.doc.uid),!0}getAnnotationLayerState(l){return this.annotationApp.getAnnotationLayerState(l)}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(l,u){var f,g;const{type:m,transform:v,style:y}=l.getConfig();let x=y,w=v;if("textTypewriter"===m&&(null===(f=l.transform)||void 0===f||!f.position)){const T=new vi({style:y,transform:v},"freeTextWriter",{}).getAnnotationConfig();x=T.style,w=T.transform}u&&function(T,M){const L=["rx","x","width","borderWidth","fontSize"],N=["ry","y","height"],V=["startPoint","endPoint"];Object.keys(T).forEach(H=>{const G=T[H];if(L.includes(H)||N.includes(H)){const z=Dt(G);T[H]=M.toPixelPPI(z.value,N.includes(H))}else V.includes(H)?T[H]={x:M.toPixelPPI(G.x,!1),y:M.toPixelPPI(G.y,!0)}:"lineDash"===H?T[H]=G.map(z=>M.toPixelPPI(z,!1)):"points"===H?T[H]=G.map(z=>({x:M.toPixelPPI(z.x,!1),y:M.toPixelPPI(z.y,!0)})):"segments"===H?T[H]=G.map(z=>z.map(q=>({x:M.toPixelPPI(q.x,!1),y:M.toPixelPPI(q.y,!0)}))):"textContents"===H&&(T[H]=G.map(z=>Fe(ne({},z),{fontSize:M.toPixelPPI(Dt(z.fontSize).value,!1)})))})}(x,u),"ellipse"===m&&(x.x+=x.width/2||0,x.y+=x.height/2||0,x.rx=x.width/2||x.rx,x.ry=x.height/2||x.ry),w&&null!==(g=w)&&void 0!==g&&g.position&&(w.position={x:u.toPixelPPI(w.position.x,!1),y:u.toPixelPPI(w.position.y,!0)});const C={id:l.uid,style:x,transform:w};let _;switch(m){case"rectangle":_=new q3(C);break;case"ellipse":_=new Vd(C);break;case"line":_=new w0(C);break;case"ink":_=new Ta(C);break;case"polygon":_=new y0(C);break;case"polyline":_=new x0(C);break;case"textTypewriter":_=new vi(C,"freeTextWriter",{},!1);break;case"textBox":_=new vi(C,"textBox");break;case"stamp":_=new yo(C);break;case"highlight":_=new fl(C,Da.HIGHLIGHT);break;case"underline":_=new fl(C,Da.UNDERLINE);break;case"strikeout":_=new fl(C,Da.STRIKEOUT);break;case"incomplete":_=new H6(C)}if(_ instanceof yo&&!_.style.imageData&&_.updateStampStyle({x:x.x,y:x.y,width:x.width,height:x.height}),["highlight","underline","strikeout","incomplete"].includes(m)){const{resolutionX:T,resolutionY:M}=u,{displayResolution:L}=yt,N=T/L,V=M/L;_.setOrigin(0,0),_.scaleLocal(N,V)}return _}getAnnotationUidsByLayer(l){const u=this.annotationApp.annotationPageRepo.findPageByUid(l);return null==u?void 0:u.getAnnotationUidListByLayer()}}function rae(p){return{annotationUid:p.uid,author:p.author,subject:p.subject,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,markedStates:aB(p.markedStates||[]),reviewStates:aB(p.reviewStates||[])}}function aB(p){return p.map(l=>({uid:l.uid,author:l.author,contents:l.contents,creationDate:l.creationDate,state:l.state}))}function lB(p){if("stamp"===p.type){const l=new yo({style:p.style,transform:p.transform}).getAnnotationConfig();p.style=l.style,p.transform=Fe(ne({},p.transform),{position:l.transform.position,scale:l.transform.scale})}}const oae={install(p){const l=p.getClass("Viewer"),u=(f=l,class extends f{constructor(g){super(g),S(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new Xoe(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new qoe(this.annotationViewerContext))}listenHooksForAnnotation(){const g=()=>{const m=this.getSelectedAnnotations();if(1!==m.length||!m[0])return;const v=this.getAnnotationObject(m[0].uid);v instanceof vi&&v.isEditMode&&v.updateCursor()};this.hooks.scroll.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.resize.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.zoomChanged.on(m=>{this.context.isDefaultViewer&&g()}),this.hooks.pageChanged.on(m=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const v=this.getActiveTab();if(null!=v&&v.total){const y=v.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(y)}v&&"single"===v.context.displayMode&&this.annotationViewerContext.disableTextEditMode()}},this),this.hooks.currentPageChanged.on(m=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const v=this.getActiveTab();if(null!=v&&v.total){const y=v.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(y)}}},this)}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const g=this.context.core.annotationService.annotationApp.hooks;g.annotationCreated.on(v=>{v.annotations.forEach(y=>{this.annotationViewerContext.addAnnotationByAnnotationData(y)}),this.context.render()},this),g.annotationDeleted.on(v=>{this.annotationViewerContext.deleteAnnotations(v.annotations.map(y=>y.uid),v.emitEvent),this.context.render()},this);let m=null;g.annotationUpdated.on(v=>{const y=v.updateDetails.map(x=>x.annotationUid);this.annotationViewerContext.updateAnnotations(y,v.updatedBy),this.hooks.annotationsUpdated.emit(new KE(y,v.updateActions)),m||(m=setTimeout(()=>{var x;null===(x=this.context)||void 0===x||x.render(),m=null},17))},this),g.bringFroward.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid,v.forwardUid]),this.context.render()},this),g.bringToFront.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.sendBackward.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid,v.backwardUid]),this.context.render()},this),g.sendToBack.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.restoreLayer.on(v=>{this.annotationViewerContext.updateLayer([v.annotationUid]),this.context.render()},this),g.annotationPageSwitched.on(v=>{this.annotationViewerContext.updateAnnotationPage(v.annotationUid,v.to.pageUid),this.context.render()},this)}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&In(document,"click",this).on(g=>{this.getActiveTab()&&"visible"===this.context.viewerConfig.visibility&&(this.context.viewService.mainContainer.contains(null==g?void 0:g.target)||this.annotationViewerContext.disableTextEditMode())})}getAnnotationConfig(){return qe(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(g){this.annotationViewerContext.annotationConfigService.updateConfig(g)}selectAnnotations(g){return this.annotationViewerContext.selectAnnotations(g)}deleteAnnotations(g){this.context.core.annotationService.deleteAnnotations(g),this.context.render()}updateAnnotation(g,m,v){this.context.core.annotationService.updateAnnotations([{annotationUid:g,options:m}],void 0,v)}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(g){return this.context.core.annotationService.bringForward(g)}bringToFront(g){return this.context.core.annotationService.bringToFront(g)}sendBackward(g){return this.context.core.annotationService.sendBackward(g)}sendToBack(g){return this.context.core.annotationService.sendToBack(g)}getAnnotationObject(g){return this.annotationViewerContext.annotationController.getShape(g)}copyAnnotations(g){g||(g=this.getSelectedAnnotations().map(m=>m.uid)),g.length&&this.context.core.annotationService.copyAnnotations(g)}cutAnnotations(g){g||(g=this.getSelectedAnnotations().map(m=>m.uid)),g.length&&this.context.core.annotationService.cutAnnotations(g)}pasteAnnotations(g,m){const v=this.context.getActiveTab();if(null==v||!v.total)return;const y=v.getCurrentPage();y&&this.context.core.annotationService.pasteAnnotations(g||v.uid,m||y.uid)}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard()}});var f;p.setClass("Viewer",u)},apply(p){const l=new sae(p);p.annotationService=l;const{pageService:f}=p;l.hooks.annotationCreated.on(g=>{g.annotations.forEach(m=>{const v=f.getPage(m.pageUid);v&&v.annotations.push(m.uid)})},f),l.hooks.annotationDeleted.on(g=>{g.annotations.forEach(m=>{const v=f.getPage(m.pageUid);if(v){const y=v.annotations.indexOf(m.uid);v.annotations.splice(y,1)}})},f),l.hooks.annotationPageSwitched.on(g=>{const m=f.getPage(g.from.pageUid),v=f.getPage(g.to.pageUid);if(m){const y=m.annotations.indexOf(g.annotationUid);m.annotations.splice(y,1)}v&&v.annotations.push(g.annotationUid)},f)}};class aae{perspective(l,u,f,g){return Q(function*(){var m;const v=new Ch,y=yield v.initImage({source:l.data,isRGBA:l.type===Ri.RGBA,width:l.width,height:l.height,isBGRA:l.type===Ri.BGRA});y.srcBuffer&&(l.data=y.srcBuffer),null!=f&&f.angle&&(yield v.rotate({angle:f.angle})),yield v.perspective(u);const x=yield v.getImage({jpegQuality:null==g?void 0:g.jpegQuality,ifDeleteObject:!0,isRGBA:l.type===Ri.RGBA,bitDepth:null==g?void 0:g.bitDepth,xDpi:null==g?void 0:g.xdpi,yDpi:null==g?void 0:g.ydpi,returnBlob:!1,returnType:o0[null!==(m=null==g?void 0:g.outputType)&&void 0!==m?m:l.type]});yield v.freeReservedData();const w={data:new Blob([x.imageData],{type:x.blobType}),width:x.imageWidth,height:x.imageHeight,resolutionX:x.imageXResolution,resolutionY:x.imageYResolution};return v.terminate(),w})()}}var su=new WeakMap,rw=new WeakMap,ow=new WeakSet;function lae(p,l,u,f){return(new aae).perspective(p,l,u,f)}function cae(p){return ee(su,this).push(p),ee(rw,this)||(gt(rw,this,!0),ye(ow,this,hae).call(this)),p.promise}function hae(){return KT.apply(this,arguments)}function KT(){return KT=Q(function*(){do{if(ee(su,this).isEmpty())break;const p=ee(su,this).pop();try{let l;"perspective"===(null==p?void 0:p.api)&&(l=yield ye(ow,this,lae).apply(this,p.params)),null==p||p.resolve(l)}catch(l){p.retry<1?(p.retry+=1,ee(su,this).push(p)):null==p||p.reject(l)}}while(!ee(su,this).isEmpty());gt(rw,this,!1)}),KT.apply(this,arguments)}Zd.registerPlugin(Ire),Zd.registerPlugin(coe),Zd.registerPlugin(yoe),Zd.registerPlugin(boe),Zd.registerPlugin(oae),Zd.registerPlugin(Qre);const Ni=new Zd(new class{constructor(){this.registerParser("image/jpeg",J3),this.registerParser("image/bmp",J3),this.registerParser("image/png",J3),this.registerParser("image/tiff",Bie),this.registerParser("image/jp2",J3),this.registerParser("application/pdf",Xie),this.registerParser("image/rgba",qie),this.registerParser("application/ddv-blank-image",lne)}dispose(){this.reset()}reset(){pp.getAllParsers().forEach(p=>p.destroy()),pp.clear(),_0.clear()}freeParserByFileUid(p){Jie.execute(p)}registerParser(p,l){ene.execute({mime:p,parser:l})}unregisterParser(p){tne.execute(p)}registerCustomParser(p,l){ine.execute({mime:p,parser:l})}unregisterCustomParser(p){nne.execute(p)}getDefaultParserOptions(p){return sne.execute(p)}setDefaultParserOptions(p,l){return rne.execute({mime:p,options:l})}getCustomParserClasses(p){return one.execute(p)}parse(p,l,u,f,g){return Q(function*(){return Kie.execute({fileData:p,mime:l,fileUid:u,indices:f,parseOptions:g})})()}getPage(p,l,u,f){return Q(function*(){return Qie.execute({fileData:p,mime:l,fileUid:u,fileIndex:f})})()}cancelGetPage(p,l){Zie.execute({fileUid:p,fileIndex:l})}getParseInfo(p,l,u,f){return Q(function*(){return ane.execute({fileData:p,mime:l,fileUid:u,options:f})})()}},new class{constructor(){this.registerSaver("application/pdf",ete),this.registerSaver("image/png",D9),this.registerSaver("image/jpeg",D9),this.registerSaver("image/tiff",tte)}registerSaver(p,l){Qee.execute({mime:p,saverConstructor:l})}unregisterSaver(p){Kee.execute(p)}getSaver(p){return Jee.execute(p)}},new class{constructor(){Js(this,ow),Ht(this,su,new E9),Ht(this,rw,!1)}dispose(){throw new Error("Method not implemented.")}perspective(p,l,u,f){return this.createTask("perspective",[p,l,u,f])}createTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);return u.promise=new Promise((f,g)=>{u.resolve=f,u.reject=g}),ye(ow,this,cae).call(this,u)}cancelTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);ee(su,this).remove(u)}},new class{constructor(){Js(this,ax),S(this,"filter",void 0),Ht(this,Yd,new E9),Ht(this,ox,!1)}get enableFilter(){return!!this.filter}applyFilter(p,l,u,f){var g=this;return Q(function*(){return g.createTask("filter",[p,l,u,f])})()}cancelFilter(p,l){}setImageFilter(p){p?this.filter=p:this.filter&&(this.filter.destroy(),this.filter=null)}getDefaultFilterType(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.defaultFilterType)||hs.NONE}getSupportedFilters(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.querySupported())||[]}createTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);return u.promise=new Promise((f,g)=>{u.resolve=f,u.reject=g}),ye(ax,this,mne).call(this,u)}cancelTask(p,l){const u={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const f of l)u.params.push(f);ee(Yd,this).remove(u)}},new class{constructor(){S(this,"detector",void 0)}get enableDetect(){return this.detector&&this.detector instanceof VL}detect(p,l){var u;return null===(u=this.detector)||void 0===u?void 0:u.detect(p,l)}setDetector(p){p?this.detector=p:this.detector&&(this.detector.destroy(),this.detector=null)}resetDetector(){this.detector&&this.detector.reset()}reset(){var p;null===(p=this.detector)||void 0===p||p.destroy(),this.detector=null}});function it(p,l,u,f){return!!Se(p)&&Te.output(l,u,f,void 0,fe.PARAM_MISS,!0)}function kp(p,l,u,f){return!!vt(p)||Te.output(l,u,f,void 0,fe.PARAM_INVALID)}class rt{static getTooltip(){return sr.getTooltip()}static setTooltip(l){const u="Elements.setTooltip",f="tooltip";return!(it(l,1,u,f)||!kp(l,1,u,f)||(sr.setTooltip(l),0))}static getDisplayTextConfig(){return sr.getDisplayTextConfig()}static setDisplayTextConfig(l){const u="Elements.displayTextConfig",f="displayTextConfig";return!(it(l,1,u,f)||!kp(l,1,u,f)||(sr.setDisplayTextConfig(l),0))}static get Layout(){return"Layout"}static get Button(){return"Button"}static get Capture(){return"Capture"}static get Flashlight(){return"Flashlight"}static get CameraConvert(){return"CameraConvert"}static get CameraResolution(){return"CameraResolution"}static get AutoDetect(){return"AutoDetect"}static get AutoCapture(){return"AutoCapture"}static get ImagePreview(){return"ImagePreview"}static get Rotate(){return"Rotate"}static get RotateLeft(){return"RotateLeft"}static get RotateRight(){return"RotateRight"}static get Delete(){return"Delete"}static get DeleteCurrent(){return"DeleteCurrent"}static get DeleteAll(){return"DeleteAll"}static get Zoom(){return"Zoom"}static get ZoomIn(){return"ZoomIn"}static get ZoomOut(){return"ZoomOut"}static get ZoomByPercentage(){return"ZoomByPercentage"}static get Crop(){return"Crop"}static get CropCurrent(){return"CropCurrent"}static get CropAll(){return"CropAll"}static get FullQuad(){return"FullQuad"}static get PerspectiveAll(){return"PerspectiveAll"}static get Undo(){return"Undo"}static get Redo(){return"Redo"}static get Pan(){return"Pan"}static get CropMode(){return"CropMode"}static get Load(){return"Load"}static get Download(){return"Download"}static get Print(){return"Print"}static get Filter(){return"Filter"}static get Restore(){return"Restore"}static get ThumbnailSwitch(){return"ThumbnailSwitch"}static get Pagination(){return"Pagination"}static get FitMode(){return"FitMode"}static get FitWindow(){return"FitWindow"}static get FitHeight(){return"FitHeight"}static get FitWidth(){return"FitWidth"}static get ActualSize(){return"ActualSize"}static get DisplayMode(){return"DisplayMode"}static get SinglePage(){return"SinglePage"}static get ContinuousPage(){return"ContinuousPage"}static get MainView(){return"MainView"}static get SeparatorLine(){return"SeparatorLine"}static get Done(){return"Done"}static get Back(){return"Back"}static get Blank(){return"Blank"}static get Close(){return"Close"}static get AnnotationSet(){return"AnnotationSet"}static get EllipseAnnotation(){return"EllipseAnnotation"}static get EraseAnnotation(){return"EraseAnnotation"}static get InkAnnotation(){return"InkAnnotation"}static get LineAnnotation(){return"LineAnnotation"}static get PolygonAnnotation(){return"PolygonAnnotation"}static get PolylineAnnotation(){return"PolylineAnnotation"}static get RectAnnotation(){return"RectAnnotation"}static get SelectAnnotation(){return"SelectAnnotation"}static get StampIconAnnotation(){return"StampIconAnnotation"}static get StampImageAnnotation(){return"StampImageAnnotation"}static get TextBoxAnnotation(){return"TextBoxAnnotation"}static get TextTypewriterAnnotation(){return"TextTypewriterAnnotation"}static get BringForward(){return"BringForward"}static get BringToFront(){return"BringToFront"}static get SendBackward(){return"SendBackward"}static get SendToBack(){return"SendToBack"}}const cB={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},rt.Flashlight]},rt.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[rt.AutoDetect,rt.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},rt.ImagePreview,rt.CameraConvert]}]},eD={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[rt.Blank,rt.Pagination,rt.Download]},rt.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[rt.DisplayMode,rt.RotateLeft,rt.Crop,rt.Filter,rt.Undo,rt.Delete,rt.Load]}]},hB={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[rt.Blank,rt.Pagination,rt.PerspectiveAll]},rt.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[rt.FullQuad,rt.RotateLeft,rt.RotateRight,rt.DeleteCurrent,rt.DeleteAll]}]},dB={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:rt.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},rt.AutoDetect,{type:rt.Capture,className:"ddv-capture-viewer-capture-desktop"},rt.AutoCapture]},rt.MainView,{type:rt.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},uB={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[rt.FullQuad,rt.RotateLeft,rt.RotateRight,rt.DeleteCurrent,rt.DeleteAll,{type:rt.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:rt.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},rt.MainView]},tD={type:rt.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:rt.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:rt.Layout,children:[rt.ThumbnailSwitch,rt.Zoom,rt.FitMode,rt.DisplayMode,rt.RotateLeft,rt.RotateRight,rt.Crop,rt.Filter,rt.Undo,rt.Redo,rt.DeleteCurrent,rt.DeleteAll,rt.Pan]},{type:rt.Layout,children:[{type:rt.Pagination,className:"ddv-edit-viewer-pagination-desktop"},rt.Load,rt.Download,rt.Print]}]},rt.MainView]},aw={type:rt.Layout,children:[rt.MainView]},fB=qe(eD);fB.children[0].children=[rt.Blank,rt.Blank,rt.Pagination,rt.AnnotationSet,rt.Download];const iD=qe(tD);var Jt,xs;iD.children[0].children[0].enableScroll=!0,iD.children[0].children[0].children.push(rt.SeparatorLine,rt.AnnotationSet),function(p){p.REJECTED="rejected",p.ACCEPTED="accepted",p.INITIAL_HERE="initialHere",p.SIGN_HERE="signHere",p.WITNESS="witness",p.APPROVED="approved",p.NOT_APPROVED="notApproved",p.DRAFT="draft",p.FINAL="final",p.COMPLETED="completed",p.CONFIDENTIAL="confidential",p.VOID="void"}(Jt||(Jt={})),function(p){p.NONE="none",p.OPEN="open",p.OPEN_REVERSE="openReverse",p.CLOSED="closed",p.CLOSED_REVERSE="closedReverse",p.BUTT="butt",p.SLASH="slash",p.SQUARE="square",p.DIAMOND="diamond",p.CIRCLE="circle"}(xs||(xs={}));const lw={background:"#e2e1de"},pB={border:"1px solid #707070",background:"#fff"},nD={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},Op={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},sD={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},gB={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};gi()&&(Op.borderWidth=3,sD.fontSize=72);const mB=Fe(ne({},Op),{lineEnding:{start:xs.NONE,end:xs.NONE}}),Lp={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:ne({},Op),ellipse:ne({},Op),polygon:ne({},Op),polyline:ne({},mB),line:ne({},mB),ink:{opacity:1,borderWidth:gi()?3:1,borderColor:"rgb(0,0,0)"},textBox:Fe(ne({},Op),{textAlign:"left",textContent:ne({},sD)}),textTypewriter:{opacity:1,textContent:ne({},sD)},stamp:{opacity:1,stamp:Jt.DRAFT}}},_le={canvasStyle:ne({},lw),quadSelectionStyle:ne({},nD),enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function On(p,l){return!!p.getActiveTab()||Te.output(l,void 0,void 0,void 0,fe.DOC_NOT_OPEN)}function Vr(p,l,u,f){return!u.getActiveTab().doc.pages.length&&Te.output(f,p,l,void 0,fe.DOC_NO_IMAGE,!0)}function Fp(p,l,u,f){return!(!Ve(g=p)||Ve(g)&&!Number.isInteger(g))||Te.output(f,l,u,void 0,fe.PARAM_INVALID);var g}function vB(p,l,u,f,g){const m=mn.isUiConfigValid(p,f);if(m.length>0)return Te.output(g,u,f,m);const v=$B(p,l);return!v||Te.output(g,l.charAt(0).toUpperCase()+l.slice(1),v,void 0,fe.ELEMENT_UNSUPPORTED)}function Np(p,l,u,f,g,m){return(p<l||p>u)&&Te.output(f,g,m,void 0,fe.PARAM_OUT_OF_RANGE,!0)}function cw(p,l,u,f){return!!p.includes(l)||Te.output(u,f,void 0,void 0,fe.PAGE_NOT_EXIST)}function El(p,l,u,f){return!!Zf(p)||Te.output(f,l,u,void 0,fe.PARAM_INVALID)}function xi(p,l,u,f,g){const m=Te.formatError(Te.isStringAndNotEmpty(p,g));return!m||Te.output(l,u,f,void 0,m)}function Pc(p,l,u,f,g,m,v){const y=mn.isNumberArrayValid(p,g,m,v);return!y.length||Te.output(l,u,f,y,fe.PARAM_INVALID)}class hw{getIsBoundContainer(l){return l.context.viewService.isBindContainer}bindContainer(l,u,f){it(u,0,f,"container");const g=mn.isContainerParamValid(u);g&&Te.error(f,"container",void 0,g),l.bindContainer(u)}unbindContainer(l){l.unbindContainer()}getIsVisible(l){return"visible"===l.getViewerConfig().visibility}show(l){l.show()}hide(l){l.hide()}getCurrentDocument(l){var u;const f=null===(u=l.getActiveTab())||void 0===u?void 0:u.uid;return f?iU.getDocument(f):null}openDocument(l,u,f){const g="docUid or doc";var v;it(l,0,f,g),nt(v=l)&&0!==v.trim().length||vt(l)||Te.error(f,g,void 0,fe.PARAM_INVALID);const m=vt(l)?l.uid:l;(function(v,y,x,w,C){v.getDocument(y)||Te.output(0,w,"docUid or doc",void 0,fe.DOC_NOT_EXIST)})(Ni.documentService,m,0,f),Ni.getViewer(u)||Te.error(f,"viewerUid",void 0,fe.PARAM_INVALID),Ni.openDocument(m,u)}closeDocument(l,u){return!!On(l,1)&&(l.closeDocument(),!0)}getStyle(l,u,f,g,m){const v="styleName";if(it(f,1,m,v)||!xi(f,1,m,v))return null;if(!g.includes(f))return Te.warning(m,v,void 0,fe.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===f)return l.getAnnotationConfig().controlsStyle;const y=l.getViewerConfig();if(f in y){const x=function(w,C){const _=["border","background"],T=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],M={pageStyle:_,selectedPageStyle:_,hoveredPageStyle:_,canvasStyle:[..._,"cursor"],checkboxStyle:[...T,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...T,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(w in M){const L=M[w];return Object.fromEntries(Object.entries(C).filter(N=>{let[V,H]=N;return L.includes(V)}))}return qe(C)}(f,y[f]);return"capture"===u&&"quadSelectionStyle"===f?{border:x.border,background:x.background}:x}return null}updateStyle(l,u,f,g,m){return!(it(u,1,m,"styleName")||it(f,1,m,"style")||!xi(u,1,m,"styleName")||!kp(f,1,m,"style")||!function(v,y,x,w,C,_){if(!xi(v,1,w,C))return!1;if(!x.includes(v))return Te.output(1,w,C,void 0,fe.PARAM_NOT_SUPPORT);const T=XB(v,y);return!T.length||Te.output(1,w,"style",T)}(u,f,g,m,"styleName")||("annotationSelectionStyle"===u?(l.updateAnnotationConfig({controlsStyle:f}),0):(l.updateViewerConfig({[u]:f}),0)))}getUiConfig(l){return l.getUiConfig()}updateUiConfig(l,u,f,g){const m="uiConfig";return!(it(u,1,g,m)||!vB(u,f,g,m,1))&&l.updateUiConfig(u)}indexToUid(l,u,f){const g="index";return it(u,1,f,g)||!Fp(u,f,g,1)||!On(l,1)||Vr(void 0,void 0,l,1)||Np(u,0,l.getPageCounts()-1,1,f,g)?"":l.indexToUid(u)}uidToIndex(l,u,f){return it(u,1,f,"uid")||!xi(u,1,f,"uid",!1)||!On(l,1)||Vr(void 0,void 0,l,1)?-1:cw(this.getCurrentDocument(l).pages,u,1,f)?l.uidToIndex(u):-1}getCurrentPageUid(l){return On(l,1)?Vr(void 0,void 0,l,1)?"":l.getCurrentPageUid():""}getCurrentPageIndex(l){return On(l,1)?Vr(void 0,void 0,l,1)?-1:l.getCurrentPageIndex():-1}getPageCount(l){return On(l,1)?l.getPageCounts():-1}gotoPage(l,u,f){const g="index";return it(u,1,f,g)||!Fp(u,f,g,1)||!On(l,1)||Vr(void 0,void 0,l,1)||Np(u,0,l.getPageCounts()-1,1,f,g)?-1:l.gotoPage(u)}rotate(l,u,f,g){return!(it(u,1,g,"angle")||!Fp(u,g,"angle",1)||(m=u,v=g,m%90!=0&&!Te.output(1,v,"angle",void 0,fe.PARAM_NOT_SUPPORT))||!On(l,1)||Vr(void 0,void 0,l,1)||!Se(f)&&!Pc(f,1,g,"indices",0,this.getPageCount(l)-1))&&l.rotatePages(u,f);var m,v}saveOperation(l){return!!On(l,1)&&l.saveOperations()}on(l,u,f,g){!it(f,1,u,"eventName")&&!it(g,1,u,"listener")&&xi(f,1,u,"eventName",!1)&&El(g,u,"listener",1)&&l.on(f,g)}off(l,u,f,g){!it(f,1,u,"eventName")&&xi(f,1,u,"eventName",!1)&&(Se(g)||El(g,u,"listener",1))&&l.off(f,g)}destroy(l){l&&l.dispose()}}function rD(p,l,u,f){return!!Jn(p)||Te.output(f,l,u,void 0,fe.PARAM_INVALID)}function ka(p,l,u,f,g,m){const v=Te.formatError(Te.isNumberAndIsInRange(p,g,m));return!v||Te.output(l,u,f,void 0,v)}function X0(p,l,u,f,g){if(!vt(p))return Te.output(u,f,g,void 0,fe.PARAM_INVALID);const m=[],v=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(p).forEach(y=>{const x=p[y];if("container"===y)m.push(...mn.isContainerKeyValid(x,g));else if("uiConfig"===y){const w=mn.isUiConfigValid(x,"option.uiConfig");if(w.length>0)m.push(...w);else{const C=$B(x,l);if(C){const _=fe.buildError(fe.ELEMENT_UNSUPPORTED,l.charAt(0).toUpperCase()+l.slice(1),C);m.push(`option.uiConfig: ${_.message}`)}}}else"viewerConfig"!==y&&"thumbnailConfig"!==y||Object.keys(x).forEach(w=>{const C=x[w];if(v.includes(w)){const _=XB(w,C);m.push(..._.map(T=>`${y}.${T}`))}})}),!(m.length>0)||Te.output(u,f,g,m)}const yB=["canvasStyle","quadSelectionStyle"],_r="CaptureViewer";var zt=new WeakMap,js=new WeakMap,xB=new WeakSet;function Ele(){ee(zt,this).hooks.destroy.on(()=>{gt(zt,this,null),Object.setPrototypeOf(this,null)})}const wB={canvasStyle:ne({},lw),currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},Tle=Fe(ne({},wB),{visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}}),Dle={canvasStyle:ne({},lw),pageStyle:ne({},pB),quadSelectionStyle:ne({},nD),currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1},CB=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var bB=new WeakSet;class _B{constructor(l){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";Js(this,bB),S(this,"v",void 0),S(this,"vCommon",new hw),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"postfix",void 0),S(this,"errorPrefix",void 0),this.errorPrefix=u;const f=`new ${this.errorPrefix}`;Wt.makeSureCoreLicenseExist(),Se(l)||X0(l,"browseViewer",0,f,"option");const g=gn((null==l?void 0:l.viewerConfig)||{},qe(Fe(ne({},wB),{viewerMode:Rn.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0})));this.v=Ni.createViewer(Fe(ne({uiConfig:qe(aw)},l),{viewerConfig:g})),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,ye(bB,this,Ale).call(this)}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(l){const u="multiselectMode";rD(l,`${this.errorPrefix}.${u}`,u,1)&&this.v.updateViewerConfig({multiselectMode:l})}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v)}hide(){this.vCommon.hide(this.v)}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(l){return this.vCommon.updateUiConfig(this.v,l,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(l){return this.vCommon.getStyle(this.v,"browse",l,CB,`${this.errorPrefix}.getStyle`)}updateStyle(l,u){return this.vCommon.updateStyle(this.v,l,u,CB,`${this.errorPrefix}.updateStyle`)}getSelectedPageIndices(){return On(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){return On(this.v,1)?0===this.v.getPageCounts()?(Te.output(1,`${this.errorPrefix}.selectAllPages`,void 0,void 0,fe.DOC_NO_IMAGE),[]):this.v.selectAllPages():[]}selectPages(l){const u=`${this.errorPrefix}.selectPages`,f="indices";return it(l,1,u,f)||!On(this.v,1)?[]:Pc(l,1,u,f,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(l):[]}setRowAndColumn(l,u){const f=`${this.errorPrefix}.setRowAndColumn`,g="row",m="column",{maxColumns:v,maxRows:y}=this.v.getViewerConfig();return!(it(l,1,f,g)||it(u,1,f,m)||!Fp(l,f,g,1)||!Fp(u,f,m,1)||Np(l,1,y,1,f,g)||Np(u,1,v,1,f,m))&&this.v.setRowAndColumn(l,u)}on(l,u){this.vCommon.on(this.v,`${this.errorPrefix}.on`,l,u)}off(l,u){this.vCommon.off(this.v,`${this.errorPrefix}.off`,l,u)}}function Ale(){this.v.hooks.destroy.on(()=>{this.v=null,Object.setPrototypeOf(this,null)})}function oD(p,l,u,f,g){const m=mn.isAnnotationOptionsValid(p,f,g);return!m.length||Te.output(l,u,f,m)}const ru={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var Bp=new WeakMap;class Fh{constructor(l){S(this,"uid",null),S(this,"creationDate",""),S(this,"modificationDate",""),Ht(this,Bp,void 0),gt(Bp,this,l),this.uid=qt(),this.creationDate=Lr(),this.modificationDate=this.creationDate}get type(){return null}get pageUid(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}getOptions(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);if(l){const u=l.getConfig(),f=q0(u,this.type);gt(Bp,this,ne({},f)),this.modificationDate=u.comment.modificationDate}return uw(this.type,ee(Bp,this))}updateOptions(l){const u="Annotation.updateOptions";if(it(l,1,u,"options")||!kp(l,1,u,"options")||!oD(l,1,u,"options",this.type))return!1;const f=this.getOptions(),g=SB(this.type,l,f);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&g.has("rotated")&&g.delete("rotated"),!g.size)return!0;this.getOptions(),gn(l,ee(Bp,this));const m=aD(ne({},ee(Bp,this)),this.type);return Ni.annotationService.updateAnnotations([{annotationUid:this.uid,options:m}],void 0,[...g]),!0}}function SB(p,l,u){const f="moved",g="resized",m="startPoint",v="endPoint",y=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),x=qe(l);x.flags=ne(ne({},u.flags),(null==x?void 0:x.flags)||{}),["line","polyline"].includes(p)&&l.lineEnding&&(x.lineEnding=ne(ne({},u.lineEnding),(null==x?void 0:x.lineEnding)||{}));const w=new Set,C=Object.keys(x);return C.forEach(_=>{if(!fD(u[_],x[_]))if("points"!==_||"ink"!==p&&"polygon"!==p&&"polyline"!==p)if(_!==m&&_!==v||"line"!==p)for(const[T,M]of y)T.includes(_)&&!w.has(M)&&w.add(M);else C.includes(m)&&C.includes(v)&&ZB([u[m],u[v]],[x[m],x[v]])?w.add(f):w.add(g);else ZB(u[_],x[_])?w.add(f):w.add(g)}),w}function aD(p,l){const u=qe(p),f={style:u,flags:[],transform:{angle:0}},{lineEnding:g,points:m,textContents:v,stamp:y,borderWidth:x,x:w,y:C,width:_,height:T,startPoint:M,endPoint:L,lineDash:N}=u||{},V=yt.dataResolution,H=yt.displayResolution;if(m&&("ink"===l?f.style.segments=DB(m,V,H):f.style.points=TB(m,V,H)),g&&(f.style.lineEnding=lD(g,"date")),y&&(f.style.imageData=null,y instanceof Blob||nt(y)&&WB(y)?f.style.imageData=y:nt(y)&&(f.style.iconName=dw(y,"date"))),Se(x)||(f.style.borderWidth=bt(x,V,H)),Se(w)||(f.style.x=bt(w,V,H)),Se(C)||(f.style.y=bt(C,V,H)),Se(_)||(f.style.width=bt(_,V,H)),Se(T)||(f.style.height=bt(T,V,H)),Se(N)||(f.style.lineDash=bt(N,V,H)),Se(M)||(f.style.startPoint=bt(M,V,H)),Se(L)||(f.style.endPoint=bt(L,V,H)),v){const G=[];v.forEach(z=>{null!=z&&z.fontSize&&(z.fontSize=bt(z.fontSize,V,H)),nt(z.fontFamily)&&""===(null==z?void 0:z.fontFamily.trim())&&(z.fontFamily="Helvetica"),G.push(ne(ne({},gB),z))}),f.style.textContents=G}return Ve(p.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(l)&&(f.transform.angle=p.rotation),p.flags&&(p.flags.print&&f.flags.push("print"),p.flags.noView&&f.flags.push("noView"),p.flags.readOnly&&f.flags.push("readOnly")),f}function q0(p,l){var u,f,g,m,v,y,x;const{lineEnding:w,iconName:C,imageData:_,segments:T,textContents:M,borderWidth:L,x:N,y:V,width:H,height:G,startPoint:z,endPoint:q,lineDash:te,points:se}=(null==p?void 0:p.style)||{},ae=yt.displayResolution,j=yt.dataResolution;if(se&&(p.style.points=TB(se,ae,j)),T&&"ink"===l&&(p.style.points=DB(T,ae,j),delete p.style.segments),w&&(p.style.lineEnding=lD(w,"user")),(_||C)&&(p.style.stamp=_||dw(C,"user"),delete p.style.iconName,delete p.style.imageData),Se(L)||(p.style.borderWidth=bt(L,ae,j)),Se(N)||(p.style.x=bt(N,ae,j)),Se(V)||(p.style.y=bt(V,ae,j)),Se(H)||(p.style.width=bt(H,ae,j)),Se(G)||(p.style.height=bt(G,ae,j)),Se(z)||(p.style.startPoint=bt(z,ae,j)),Se(q)||(p.style.endPoint=bt(q,ae,j)),Se(te)||(p.style.lineDash=bt(te,ae,j)),M){const le=[];M.forEach(ue=>{null!=ue&&ue.fontSize&&(ue.fontSize=bt(ue.fontSize,ae,j)),nt(ue.fontFamily)&&""===(null==ue?void 0:ue.fontFamily.trim())&&(ue.fontFamily="Helvetica"),le.push(ne(ne({},gB),ue))}),p.style.textContents=le}return null===(u=p.style)||void 0===u||delete u.lineJoin,null===(f=p.style)||void 0===f||delete f.lineCap,null===(g=p.style)||void 0===g||delete g.miterLimit,Fe(ne({},p.style),{rotation:(null===(m=p.transform)||void 0===m?void 0:m.angle)||0,flags:{print:!(null===(v=p.flags)||void 0===v||!v.includes("print")),noView:!(null===(y=p.flags)||void 0===y||!y.includes("noView")),readOnly:!(null===(x=p.flags)||void 0===x||!x.includes("readOnly"))}})}function lD(p,l){const u={None:xs.NONE,OpenArrow:xs.OPEN,ROpenArrow:xs.OPEN_REVERSE,ClosedArrow:xs.CLOSED,RClosedArrow:xs.CLOSED_REVERSE,Butt:xs.BUTT,Slash:xs.SLASH,Square:xs.SQUARE,Diamond:xs.DIAMOND,Circle:xs.CIRCLE};if("user"===l){const[f,g]=p;return{start:u[f],end:u[g]}}return[uD(u,p.start)[0]||"None",uD(u,p.end)[0]||"None"]}function dw(p,l){const u={[Jt.REJECTED]:Zt.REJECTED,[Jt.ACCEPTED]:Zt.ACCEPTED,[Jt.INITIAL_HERE]:Zt.INITIAL_HERE,[Jt.SIGN_HERE]:Zt.SIGN_HERE,[Jt.WITNESS]:Zt.WITNESS,[Jt.APPROVED]:Zt.APPROVED,[Jt.NOT_APPROVED]:Zt.NOT_APPROVED,[Jt.DRAFT]:Zt.DRAFT,[Jt.FINAL]:Zt.FINAL,[Jt.COMPLETED]:Zt.COMPLETED,[Jt.CONFIDENTIAL]:Zt.CONFIDENTIAL,[Jt.VOID]:Zt.VOID};return"user"===l?uD(u,p)[0]||p:u[p]||Zt.DRAFT}function uw(p,l){const u=["opacity","flags"],f=["x","y","width","height"],g=["borderColor","borderWidth","lineDash"],m=[...u,...g,...f,"background","rotation"],v=["points","background",...g,...u],y={rectangle:m,ellipse:m,polygon:v,polyline:["lineEnding",...v],stamp:["stamp",...f,...u,"rotation"],ink:["points","borderWidth","borderColor","rotation",...u],line:["startPoint","endPoint","lineEnding","background",...g,...u],textBox:["textContents","textAlign","background","rotation",...u,...g,...f],textTypewriter:["x","y","textContents",...u]}[p];if(!y)return l;const x={};for(const w in l)if(y.includes(w)){let C=l[w];"points"!==w||"ink"!==p&&"polygon"!==p&&"polyline"!==p?"startPoint"!==w&&"endPoint"!==w||"line"!==p?"borderColor"===w||"background"===w?x[w]=EB(C,2):"opacity"===w?(C>1&&(C=1),C<0&&(C=0),x[w]=Tl(C,2)):x[w]="textContents"===w?C.map(_=>(void 0!==_.color&&(_.color=EB(_.color,2)),void 0!==_.fontSize&&(_.fontSize=Tl(_.fontSize,2)),_)):"lineDash"===w?C.map(_=>Tl(_,2)):Ve(l[w])?Tl(C,2):C:x[w]={x:Tl(C.x,2),y:Tl(C.y,2)}:x[w]=Xt(C[0])?C.map(_=>_.map(T=>({x:Tl(T.x,2),y:Tl(T.y,2)}))):C.map(_=>({x:Tl(_.x,2),y:Tl(_.y,2)}))}return x}function Tl(p,l){return Number.parseFloat(p.toFixed(l))}function EB(p,l){if(p&&p.startsWith("rgb")){const f=p.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/);if(f){const g=parseInt(f[1],10),m=parseInt(f[2],10),v=parseInt(f[3],10);let y=void 0!==f[4]?parseFloat(f[4]):void 0;return void 0!==y?(y<0&&(y=0),y>1&&(y=1),`rgba(${g},${m},${v},${function(w,C){const _=w.toString();return/^\d+\.\d{3,}$/.test(_)?parseFloat(w.toFixed(C)):w}(y,l)})`):`rgb(${g},${m},${v})`}}return p}function TB(p,l,u){return p.map(f=>({x:bt(f.x,l,u),y:bt(f.y,l,u)}))}function DB(p,l,u){return p.map(f=>f.map(g=>({x:bt(g.x,l,u),y:bt(g.y,l,u)})))}const Ile=Fe(ne({},ru),{x:10,y:10,width:100,height:100});class Ple extends Fh{constructor(l){super(l=gn(l||{},qe(Ile)))}get type(){return"rectangle"}}const Rle=Fe(ne({},ru),{x:10,y:10,width:100,height:80});class Mle extends Fh{constructor(l){super(l=gn(l||{},qe(Rle)))}get type(){return"ellipse"}}const kle=Fe(ne({},ru),{points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]});class Ole extends Fh{constructor(l){super(l=gn(l||{},qe(kle)))}get type(){return"ink"}}const Lle=Fe(ne({},ru),{startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:xs.NONE,end:xs.NONE}});class Fle extends Fh{constructor(l){super(l=gn(l||{},qe(Lle)))}get type(){return"line"}}const Nle=Fe(ne({},ru),{points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]});class Ble extends Fh{constructor(l){super(l=gn(l||{},qe(Nle)))}get type(){return"polygon"}}const Ule=Fe(ne({},ru),{points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:xs.NONE,end:xs.NONE}});class Vle extends Fh{constructor(l){super(l=gn(l||{},qe(Ule)))}get type(){return"polyline"}}function AB(p,l,u,f,g){return cD.apply(this,arguments)}function cD(){return cD=Q(function*(p,l,u,f,g){const m=[`${g}.${f} is invalid`];let v=!1;if(er(p)){const y=yield I3(p);["image/bmp","image/jpeg","image/png"].includes(y)||(v=!0)}else v=!0;return!v||Te.output(l,u,g,m)}),cD.apply(this,arguments)}const jle={x:10,y:10,stamp:Jt.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},hD={[Jt.REJECTED]:[23.58,23.54],[Jt.ACCEPTED]:[28.39,24.6],[Jt.INITIAL_HERE]:[126.26,33.78],[Jt.SIGN_HERE]:[126.26,33.78],[Jt.WITNESS]:[126.26,33.78],[Jt.APPROVED]:[211.33,59.33],[Jt.NOT_APPROVED]:[284.83,59.33],[Jt.DRAFT]:[144.19,59.66],[Jt.FINAL]:[123.73,59.66],[Jt.COMPLETED]:[227.83,59.33],[Jt.CONFIDENTIAL]:[272.83,59.33],[Jt.VOID]:[114.71,59.66]};var ou=new WeakMap;class Hle{constructor(l){S(this,"uid",null),S(this,"creationDate",""),S(this,"modificationDate",""),Ht(this,ou,void 0),l=gn(l||{},qe(jle)),!nt(l.stamp)||!hD[l.stamp]||Ve(l.width)&&Ve(l.height)||(l.width=l.width||hD[l.stamp][0],l.height=l.height||hD[l.stamp][1]),gt(ou,this,l),this.uid=qt(),this.creationDate=Lr(),this.modificationDate=this.creationDate}get type(){return"stamp"}get pageUid(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}getOptions(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);if(l){const u=l.getConfig(),f=q0(u,this.type);gt(ou,this,ne({},f)),this.modificationDate=u.comment.modificationDate}return uw(this.type,ee(ou,this))}updateOptions(l){var u=this;return Q(function*(){const f="Annotation.updateOptions";if(it(l,0,f,"options")||!kp(l,0,f,"options")||!oD(l,0,f,"options",u.type)||er(l.stamp)&&!(yield AB(l.stamp,0,f,"stamp","options")))return;const g=u.getOptions(),m=SB(u.type,l,g);if(!m.size)return;u.getOptions(),gn(l,ee(ou,u));let v=ee(ou,u);null!=l&&l.stamp||(v=Fe(ne({},ee(ou,u)),{stamp:null}));const y=aD(v,u.type);Ni.annotationService.updateAnnotations([{annotationUid:u.uid,options:y}],void 0,[...m])})()}}const Wle=Fe(ne({},ru),{x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]});class Gle extends Fh{constructor(l){super(l=gn(l||{},qe(Wle)))}get type(){return"textBox"}}const zle={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class $le extends Fh{constructor(l){super(l=gn(l||{},qe(zle)))}get type(){return"textTypewriter"}}function Z0(p,l,u,f,g,m){const v=Te.formatError({isValid:Xt(p)});if(v)return Te.output(l,u,f,void 0,v);const y=[];return p.forEach((x,w)=>{const C=Te.formatDetails(tt("Array",g,`[${w}]`,!0),Te.isStringAndNotEmpty(x,m));y.push(...C)}),!y.length||Te.output(l,u,f,y)}function IB(p,l,u,f,g){const m=[];return l.forEach((v,y)=>{p.has(v)||m.push(`annotationUids[${y}]: The specified annotation(s) do not exist.`)}),!m.length||Te.output(u,f,g,m,fe.ANNOTATION_NOT_EXIST)}function fw(p,l,u,f,g){return!!p.has(l)||Te.output(u,f,g,void 0,fe.ANNOTATION_NOT_EXIST)}class Yle{constructor(){S(this,"uid",null),S(this,"creationDate",""),S(this,"modificationDate",""),this.uid=qt(),this.creationDate=Lr(),this.modificationDate=Lr()}get type(){return"unknown"}get pageUid(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}}var dD=new WeakMap;class Xle{constructor(l){Ht(this,dD,void 0),S(this,"uid",null),S(this,"creationDate",""),S(this,"modificationDate",""),this.uid=qt(),this.creationDate=Lr(),this.modificationDate=Lr(),gt(dD,this,l)}get type(){return"incomplete"}get pageUid(){const l=Ni.annotationService.annotationApp.getAnnotationByUid(this.uid);return l?l.pageUid:""}get raw(){return ee(dD,this)}}const PB=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],Nh="AnnotationManager",RB=new Map;var Sr=new WeakMap,rr=new WeakMap,J0=new WeakMap,au=new WeakSet;function MB(p,l){switch(p){case"rectangle":return new Ple(l);case"ellipse":return new Mle(l);case"polygon":return new Ble(l);case"polyline":return new Vle(l);case"line":return new Fle(l);case"stamp":return new Hle(l);case"ink":return new Ole(l);case"textBox":return new Gle(l);case"textTypewriter":return new $le(l);case"unknown":return new Yle;case"highlight":case"underline":case"strikeout":case"incomplete":return new Xle((null==l?void 0:l.annotationRaw)||{});default:return null}}function pw(p,l){ee(J0,this).emit(p,l)}const kB=new class{constructor(){Js(this,au),Ht(this,Sr,void 0),Ht(this,rr,void 0),Ht(this,J0,void 0),gt(Sr,this,Ni),gt(rr,this,RB),gt(J0,this,new cl);const p=ee(Sr,this).annotationService.annotationApp.hooks;p.annotationCreated.on(u=>{const f=u.annotations.reduce((g,m)=>{if(!ee(rr,this).has(m.uid)){const v=m.getConfig(),y=q0(v),x=ye(au,this,MB).call(this,v.type,y);x&&(x.uid=v.uid,x.creationDate=v.comment.creationDate,x.modificationDate=v.comment.modificationDate,ee(rr,this).set(v.uid,x))}return g.push(m.uid),g},[]);ye(au,this,pw).call(this,"annotationsAdded",{annotationUids:f})}),p.annotationDeleted.on(u=>{u.annotations.forEach(g=>{ee(rr,this).has(g.uid)&&(this.getAnnotationsByUids([g.uid])[0].modificationDate="",ee(rr,this).delete(g.uid))});const f=u.annotations.map(g=>g.uid);u.emitEvent&&ye(au,this,pw).call(this,"annotationsDeleted",{annotationUids:f})}),p.annotationUpdated.on(u=>{const f={modifiedAnnotations:u.updateDetails.map(g=>{const m=this.getAnnotationsByUids([g.annotationUid])[0],v=m.type,y=Ni.annotationService.annotationApp.getAnnotationByUid(m.uid);return m.modificationDate=y.comment.modificationDate,{uid:g.annotationUid,oldOptions:uw(v,q0(qe(g.from),v)),newOptions:uw(v,q0(qe(g.to),v))}}),actions:[...u.updateActions]};ye(au,this,pw).call(this,"annotationsModified",f)});const l=(u,f)=>{ye(au,this,pw).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...u.from],newAnnotationUidList:[...u.to]})};p.bringFroward.on(u=>{l(u)}),p.bringToFront.on(u=>{l(u)}),p.sendBackward.on(u=>{l(u)}),p.sendToBack.on(u=>{l(u)})}createAnnotation(p,l,u){const f="AnnotationManager.createAnnotation",g="pageUid",m="type",v="annotationOptions";let y=null;try{Wt.makeSureCoreLicenseExist(),Wt.makeSureAnnotationLicenseExist(),it(p,0,f,g),it(l,0,f,m),xi(p,0,f,g,!1),T=f,M=m,nt(C=l)?["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(C)||Te.output(0,T,M,void 0,fe.PARAM_NOT_SUPPORT):Te.output(0,T,M,void 0,fe.PARAM_INVALID),y=ee(Sr,this).pageService.getPage(p),y||Te.error(f,g,void 0,fe.PAGE_NOT_EXIST),Se(u)||(kp(u,0,f,v),oD(u,0,f,v,l))}catch(C){if("stamp"===l)return Promise.reject(C);throw C}var C,T,M;const x=qe(u||{}),w=()=>{var C,_,T;const M=ye(au,this,MB).call(this,l,x);ee(rr,this).set(M.uid,M);const L=ee(Sr,this).pageService.getPage(p).doc.uid,N=aD(M.getOptions(),l);if("textTypewriter"===l){const H=y.mediaBox.width,G=y.mediaBox.width-N.style.x;N.style.width=G<0?H:G}const V={uid:M.uid,docUid:L,pageUid:p,type:l,style:N.style,transform:N.transform,flags:N.flags,comment:{annotationUid:M.uid,author:(null===(C=N.comment)||void 0===C?void 0:C.author)||"",subject:(null===(_=N.comment)||void 0===_?void 0:_.subject)||"",contents:(null===(T=N.comment)||void 0===T?void 0:T.contents)||"",creationDate:M.creationDate,modificationDate:M.creationDate,markedStates:[],reviewStates:[],replies:[]}};return ee(Sr,this).annotationService.createAnnotation(L,V),M};if("stamp"===l&&er(null==x?void 0:x.stamp)){const C=x;return new Promise(function(){var _=Q(function*(T,M){try{yield AB(C.stamp,0,f,"stamp",v)}catch(L){return void M(L)}if(!Ve(C.width)||!Ve(C.height)){const L=new Od,N=yield L.readImageInfo({fileSource:C.stamp}).catch(G=>{M(G)});let V=N.imageWidth,H=N.imageHeight;if(V>400||H>400){const G=Math.max(V/400,H/400);V/=G,H/=G}C.width=V,C.height=H}T(w())});return function(T,M){return _.apply(this,arguments)}}())}return w()}deleteAnnotations(p){const l=`${Nh}.deleteAnnotations`,u="annotationUids";return!(it(p,1,l,u)||!Z0(p,1,l,u,void 0,!1)||!IB(ee(rr,this),p,1,l,u)||(ee(Sr,this).annotationService.deleteAnnotations(p),0))}getAnnotationsByUids(p){const l=`${Nh}.getAnnotationsByUids`,u="annotationUids";return!it(p,1,l,u)&&Z0(p,1,l,u,void 0,!1)&&IB(ee(rr,this),p,1,l,u)?p.map(f=>ee(rr,this).get(f)):[]}getAnnotationsByPage(p){const l=`${Nh}.getAnnotationsByPage`,u="pageUid";if(it(p,1,l,u)||!xi(p,1,l,u,!1))return[];if(!ee(Sr,this).pageService.getPage(p))return Te.warning(l,u,void 0,fe.PAGE_NOT_EXIST),[];const f=ee(Sr,this).annotationService.getAnnotationUidsByLayer(p),g=[];return f.forEach(m=>{const v=ee(rr,this).get(m);v&&g.push(v)}),g}getAnnotationsByDoc(p){const l=`${Nh}.getAnnotationsByDoc`,u="docUid";if(it(p,1,l,u)||!xi(p,1,l,u,!1))return[];const f=ee(Sr,this).documentService.getDocument(p);return f?f.pages.reduce((g,m)=>(ee(Sr,this).annotationService.getAnnotationUidsByLayer(m).forEach(v=>{const y=ee(rr,this).get(v);y&&g.push(y)}),g),[]):(Te.warning(l,u,void 0,fe.DOC_NOT_EXIST),[])}bringAnnotationForward(p){const l=`${Nh}.bringAnnotationForward`,u="annotationUid";return!(it(p,1,l,u)||!xi(p,1,l,u,!1)||!fw(ee(rr,this),p,1,l,u))&&ee(Sr,this).annotationService.bringForward(p)}sendAnnotationBackward(p){const l=`${Nh}.sendAnnotationBackward`,u="annotationUid";return!(it(p,1,l,u)||!xi(p,1,l,u,!1)||!fw(ee(rr,this),p,1,l,u))&&ee(Sr,this).annotationService.sendBackward(p)}bringAnnotationToFront(p){const l=`${Nh}.bringAnnotationToFront`,u="annotationUid";return!(it(p,1,l,u)||!xi(p,1,l,u,!1)||!fw(ee(rr,this),p,1,l,u))&&ee(Sr,this).annotationService.bringToFront(p)}sendAnnotationToBack(p){const l=`${Nh}.sendAnnotationToBack`,u="annotationUid";return!(it(p,1,l,u)||!xi(p,1,l,u,!1)||!fw(ee(rr,this),p,1,l,u))&&ee(Sr,this).annotationService.sendToBack(p)}on(p,l){const u="AnnotationManager.on",f="eventName",g="listener";!it(p,1,u,f)&&!it(l,1,u,g)&&xi(p,1,u,f,!1)&&El(l,u,g,1)&&(PB.includes(p)?ee(J0,this).on(p,l):fe.warning(fe.PARAM_NOT_SUPPORT,u,f))}off(p,l){const u="AnnotationManager.off",f="eventName";!it(p,1,u,f)&&xi(p,1,u,f,!1)&&(Se(l)||El(l,u,"listener",1))&&(PB.includes(p)?ee(J0,this).off(p,l):fe.warning(fe.PARAM_NOT_SUPPORT,u,f))}};function OB(p,l,u,f,g,m){const v=[];let y=!1;if(g)g.forEach((x,w)=>{const{width:C,height:_}=u.getRealPageSize(x);YB(f,C,_)||v.push(`indices[${x}]: ${fe.RECT_EXCEED_PAGE_BOUND.message}`)}),v.length>0&&(y=!0);else{const{width:x,height:w}=u.getRealPageSize();YB(f,x,w)||(y=!0)}return!!y&&Te.output(m,p,l,v.length?v:void 0,fe.RECT_EXCEED_PAGE_BOUND,!0)}function LB(p,l,u,f){const g=mn.isRectValid(p);return!!g.length&&Te.output(f,l,u,g,void 0,!0)}const FB=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],Ln="EditViewer";var Ye=new WeakMap,Up=new WeakMap,yn=new WeakMap,gw=new WeakSet;class NB{constructor(l){var u,f;Js(this,gw),Ht(this,Ye,void 0),Ht(this,Up,!0),Ht(this,yn,new hw),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"postfix",void 0),S(this,"thumbnail",void 0),Wt.makeSureCoreLicenseExist(),Se(l)||X0(l,"editViewer",0,"new EditViewer","option");const g=gn((null==l?void 0:l.viewerConfig)||{},qe(Fe(ne({},Dle),{viewerMode:Rn.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0})));if(g.minZoom>g.maxZoom){fe.warning(fe.MIN_ZOOM_INVALID);const x=g.maxZoom;g.maxZoom=g.minZoom,g.minZoom=x}const{maxZoom:m,minZoom:v}=g;g.maxZoom=m>64||m<.01?64:m,g.minZoom=v>64||v<.01?.01:v,gi()&&(Lp.toolbarConfig.style={scale:"0.9"}),gt(Ye,this,Ni.createViewer(Fe(ne({uiConfig:qe(gi()?eD:tD)},l),{viewerConfig:g,annotationToolBarConfig:ne(ne({},null==Lp?void 0:Lp.toolbarConfig),null==l||null===(u=l.annotationConfig)||void 0===u?void 0:u.toolbarConfig),annotationPaletteConfig:ne(ne({},Lp.paletteConfig),null==l||null===(f=l.annotationConfig)||void 0===f?void 0:f.paletteConfig)}))),this.uid=ee(Ye,this).uid,this.groupUid=ee(Ye,this).groupUid,this.postfix=ee(Ye,this).postfix;const y=gn(qe(null==l?void 0:l.annotationConfig)||{},qe(Lp));ee(Ye,this).updateAnnotationConfig(function(x){const{defaultStyleConfig:N}=x;return Object.keys(N).forEach(V=>{const H=N[V];"object"==typeof H&&null!==H&&((V=>{if("lineEnding"in V&&"object"==typeof V.lineEnding&&null!==V.lineEnding){const H=lD(V.lineEnding,"date");delete V.lineEnding,V.lineEnding=H}})(H),(V=>{V.borderWidth="borderWidth"in V&&Ve(null==V?void 0:V.borderWidth)?bt(V.borderWidth,yt.dataResolution,yt.displayResolution):1})(H),(V=>{var H,G,z,q,te;"textContent"in V&&vt(V.textContent)&&(V.textContent.fontSize=Ve(null==V||null===(H=V.textContent)||void 0===H?void 0:H.fontSize)?bt(null==V||null===(te=V.textContent)||void 0===te?void 0:te.fontSize,yt.dataResolution,yt.displayResolution):Lp.defaultStyleConfig.textBox.textContent.fontSize,["normal","italic"].includes(null==V||null===(G=V.textContent)||void 0===G?void 0:G.fontStyle)||(V.textContent.fontStyle="normal"),["normal","bold"].includes(null==V||null===(z=V.textContent)||void 0===z?void 0:z.fontWeight)||(V.textContent.fontWeight="normal"),""===(null==V||null===(q=V.textContent)||void 0===q?void 0:q.fontFamily)&&(V.textContent.fontFamily="Helvetica"))})(H),(V=>{"lineDash"in V&&V.lineDash.length&&(V.lineDash=bt(V.lineDash,yt.dataResolution,yt.displayResolution))})(H),(V=>{"textAlign"in V&&!["left","right","center","justify"].includes(null==V?void 0:V.textAlign)&&(V.textAlign="left")})(H),"stamp"===V&&(V=>{V.stamp instanceof Blob&&(V.imageData=V.stamp),nt(V.stamp)&&(WB(V.stamp)?V.imageData=V.stamp:V.stampIcon=["rejected","accepted","initialHere","signHere","witness","approved","notApproved","draft","final","completed","confidential","void"].includes(V.stamp)?dw(V.stamp,"date"):dw(Jt.DRAFT,"date")),delete V.stamp})(H))}),Fe(ne({},x),{controlsStyle:x.annotationSelectionStyle})}(y)),zB(ee(Ye,this).getUiConfig()).includes(rt.Filter)&&!ee(Ye,this).context.core.filterService.enableFilter&&fe.warning(fe.IMG_FILTER_MISS),l&&!1===l.createThumbnail||ye(gw,this,Zle).call(this,null==l?void 0:l.thumbnailConfig),l&&!Se(null==l?void 0:l.adaptiveIconSize)&&gt(Up,this,l.adaptiveIconSize),ee(Ye,this).rootDom&&(ee(Ye,this).rootDom.style.fontSize="20px",vw(this,ee(Ye,this).rootDom,ee(Up,this))),mD.forEach(x=>{ee(Ye,this).addFontToUi(x)}),ye(gw,this,Jle).call(this),ye(gw,this,qle).call(this)}get isVisible(){return ee(yn,this).getIsVisible(ee(Ye,this))}get isBoundContainer(){return ee(yn,this).getIsBoundContainer(ee(Ye,this))}get currentDocument(){return ee(yn,this).getCurrentDocument(ee(Ye,this))}get zoom(){return parseFloat(ee(Ye,this).getViewerConfig().zoom.toFixed(4))}set zoom(l){const{maxZoom:u,minZoom:f}=ee(Ye,this).getViewerConfig();(function(g,m,v,y,x,w){const C=Te.formatError(Te.isNumberAndIsInRange(g));return C?Te.output(1,v,y,void 0,C):(g<x&&Te.output(1,v,y,void 0,fe.ZOOM_TOO_SMALL),g>w&&Te.output(1,v,y,void 0,fe.ZOOM_TOO_LARGE),!0)})(l,0,`${Ln}.zoom`,"zoom",f,u)&&ee(Ye,this).updateViewerConfig({zoom:l})}get zoomOrigin(){return ee(Ye,this).getViewerConfig().zoomOrigin}set zoomOrigin(l){(function(u,f,g,m){const v=mn.isZoomOriginValid(u);return!v.length||Te.output(1,f,"zoomOrigin",v)})(l,`${Ln}.zoomOrigin`)&&ee(Ye,this).updateViewerConfig({zoomOrigin:{x:l.x,y:l.y}})}get displayMode(){const{displayMode:l}=ee(Ye,this).getViewerConfig(),u=ee(Ye,this).getActiveTab();return u?u.context.displayMode:l}set displayMode(l){const u="displayMode",f=`${Ln}.${u}`;xi(l,1,f,u)&&(["single","continuous"].includes(l)?ee(Ye,this).updateViewerConfig({displayMode:l}):fe.warning(fe.PARAM_NOT_SUPPORT,f,u))}get toolMode(){const{toolMode:l}=ee(Ye,this).getViewerConfig();return l}set toolMode(l){const u="toolMode",f=`${Ln}.${u}`;var v;xi(l,1,f,u)&&(v=f,["crop","pan","annotation"].includes(l)||Te.output(1,v,"toolMode",void 0,fe.PARAM_NOT_SUPPORT))&&ee(Ye,this).updateViewerConfig({toolMode:l})}get annotationMode(){const{annotationMode:l}=ee(Ye,this).getViewerConfig();return l}set annotationMode(l){const u="annotationMode",f=`${Ln}.${u}`;var v;xi(l,1,f,u)&&(v=f,["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(l)||Te.output(1,v,"annotationMode",void 0,fe.PARAM_NOT_SUPPORT))&&ee(Ye,this).updateViewerConfig({annotationMode:l})}get fitMode(){const{fitMode:l}=ee(Ye,this).getViewerConfig(),u=ee(Ye,this).getActiveTab();return u?u.context.fitMode:l}set fitMode(l){const u=`${Ln}.fitMode`;var v;xi(l,1,u,"fitMode")&&(v=u,["width","height","window","actualSize"].includes(l)||Te.output(1,v,"fitMode",void 0,fe.PARAM_NOT_SUPPORT))&&ee(Ye,this).updateViewerConfig({fitMode:l})}bindContainer(l){ee(yn,this).bindContainer(ee(Ye,this),l,`${Ln}.bindContainer`)}unbindContainer(){ee(yn,this).unbindContainer(ee(Ye,this))}show(){ee(yn,this).show(ee(Ye,this)),vw(this,ee(Ye,this).rootDom,ee(Up,this))}hide(){ee(yn,this).hide(ee(Ye,this))}getUiConfig(){return ee(yn,this).getUiConfig(ee(Ye,this))}updateUiConfig(l){return ee(Ye,this).selectAnnotations([]),!!ee(yn,this).updateUiConfig(ee(Ye,this),l,"editViewer",`${Ln}.updateUiConfig`)&&(ee(Ye,this).emit("thumbnailBind",this.thumbnail.uid),vw(this,ee(Ye,this).rootDom,ee(Up,this)),!0)}openDocument(l){ee(yn,this).openDocument(l,this.uid,`${Ln}.openDocument`)}closeDocument(){return ee(yn,this).closeDocument(ee(Ye,this),`${Ln}.closeDocument`)}getStyle(l){return ee(yn,this).getStyle(ee(Ye,this),"edit",l,FB,`${Ln}.getStyle`)}updateStyle(l,u){const f=`${Ln}.updateStyle`;return ee(yn,this).updateStyle(ee(Ye,this),l,u,FB,f)}setParallelScrollCount(l){const u=`${Ln}.setParallelScrollCount`,f="count",{maxColumns:g,maxRows:m}=ee(Ye,this).getViewerConfig();return!(it(l,1,u,f)||!Fp(l,u,f,1)||Np(l,1,m,1,u,f)||Np(l,1,g,1,u,f))&&("continuous"!==this.displayMode?(fe.warning(fe.ROW_COLUMN_CAN_NOT_CHANGE,u),!1):ee(Ye,this).setRowAndColumn(l,l))}setCropRect(l){const u=`${Ln}.setCropRect`,f="rect";return!(it(l,1,u,f)||LB(l,u,f,1)||!On(ee(Ye,this),1)||Vr(void 0,void 0,ee(Ye,this),1)||OB(u,f,ee(Ye,this),l,void 0,1))&&("crop"!==this.toolMode?(fe.warning(fe.TOOL_MODE_NOT_AVAILABLE,u),!1):ee(Ye,this).setRectBox(l))}getCropRect(){return On(ee(Ye,this),1)?ee(Ye,this).getRectBox():null}crop(l,u){const f=`${Ln}.crop`,g=ee(Ye,this).getPageCounts(),m="rect";if(it(l,1,f,m)||LB(l,f,m,1)||!On(ee(Ye,this),1)||Vr(void 0,void 0,ee(Ye,this),1)||u&&!Pc(u,1,f,"indices",0,g-1)||OB(f,m,ee(Ye,this),l,u,1))return!1;const v=ee(Ye,this).getCurrentPageIndex();return ee(Ye,this).cropPages(l,u||[v])}rotate(l,u){const f=`${Ln}.rotate`;return ee(yn,this).rotate(ee(Ye,this),l,u,f)}undo(){if(!On(ee(Ye,this),1))return!1;const l=ee(Ye,this).undo();return l||fe.warning(fe.UNDO_NOOP),l}redo(){if(!On(ee(Ye,this),1))return!1;const l=ee(Ye,this).redo();return l||fe.warning(fe.REDO_NOOP),l}saveOperations(){return ee(yn,this).saveOperation(ee(Ye,this))}indexToUid(l){const u=`${Ln}.indexToUid`;return ee(yn,this).indexToUid(ee(Ye,this),l,u)}uidToIndex(l){const u=`${Ln}.uidToIndex`;return ee(yn,this).uidToIndex(ee(Ye,this),l,u)}getCurrentPageUid(){return ee(yn,this).getCurrentPageUid(ee(Ye,this))}getCurrentPageIndex(){return ee(yn,this).getCurrentPageIndex(ee(Ye,this))}getPageCount(){return ee(yn,this).getPageCount(ee(Ye,this))}goToPage(l){const u=`${Ln}.goToPage`;return ee(yn,this).gotoPage(ee(Ye,this),l,u)}selectAnnotations(l){const u=`${Ln}.selectAnnotations`,f="annotationUids";if(!On(ee(Ye,this),1)||Vr(void 0,void 0,ee(Ye,this),1)||it(l,1,u,f)||!Z0(l,1,u,f,void 0,!1))return!1;if("crop"===this.toolMode)return fe.warning(fe.TOOL_MODE_NOT_AVAILABLE,u),!1;l=[...new Set(l)];const g=[],m=[],v=[],y=this.getCurrentPageUid(),x=l.reduce((C,_,T)=>{const M=Ni.annotationService.getAnnotationByUid(_);return M?M.pageUid!==y?g.push(`${f}[${T}]: The specified annotation is not on the current page.`):"incomplete"===M.type||"unknown"===M.type?m.push(`${f}[${T}]: ${fe.UNSELECTED_UNKNOWN.message}`):M.flags.includes("readOnly")||M.flags.includes("noView")?v.push(`${f}[${T}]: ${fe.UNSELECTED_READONLY.message}`):C.push(_):g.push(`${f}[${T}]: The specified annotation does not exist.`),C},[]);if(g.length){const C=fe.ANNOTATION_SELECT;return C.details=g,fe.warning(C,u,f),!1}if(m.length){const C=fe.UNSELECTED_UNKNOWN;return C.details=m,fe.warning(C,u,f),!1}if(v.length){const C=fe.UNSELECTED_READONLY;return C.details=v,fe.warning(C,u,f),!1}const w=ee(Ye,this).getSelectedAnnotations().map(C=>C.uid);return w.length===x.length&&function(C,_){if(C.length!==_.length)return!1;const T=C.slice().sort(),M=_.slice().sort();for(let L=0;L<T.length;L++)if(T[L]!==M[L])return!1;return!0}(w,x)||ee(Ye,this).selectAnnotations(x),!0}getSelectedAnnotations(){return!On(ee(Ye,this),1)||Vr(void 0,void 0,ee(Ye,this),1)?[]:ee(Ye,this).getSelectedAnnotations().length?kB.getAnnotationsByUids(ee(Ye,this).getSelectedAnnotations().map(l=>l.uid)):[]}on(l,u){ee(yn,this).on(ee(Ye,this),`${Ln}.on`,l,u)}off(l,u){ee(yn,this).off(ee(Ye,this),`${Ln}.off`,l,u)}destroy(){ee(yn,this).destroy(ee(Ye,this))}}function qle(){ee(Ye,this).hooks.destroy.on(()=>{var p;null===(p=this.thumbnail)||void 0===p||p.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,gt(Ye,this,null),Object.setPrototypeOf(this,null)})}function Zle(p){const l=p||{},u=qe(Tle);gi()&&(u.size="100%",u.rows=3,u.columns=2,u.canvasStyle.background="#4B4B4B",u.pageNumberStyle.color="white",u.enableOptimizePage=!0),gn(l,u);const{mainAndThbContainer:f,mainContainer:g,thumbnailContainer:m}=ee(Ye,this).context.viewService,{size:v,position:y,visibility:x}=u,w=qe(aw);let C="row",_=v,T="100%",M="left"===y?"-1":"1";"top"!==y&&"bottom"!==y||(C="column",_="100%",T=v,M="top"===y?"-1":"1"),w.className=`ddv-edit-viewer-thumb-${y}`,Object.assign(m.style,{width:_,height:T,order:M,display:"visible"===x?"block":"none"}),f.style.flexDirection=C,f.insertBefore(m,g),ee(Ye,this).context.resize();const N=new _B({container:m,viewerConfig:u,groupUid:this.groupUid,uiConfig:w},`${Ln}.thumbnail`);this.thumbnail=N,ee(Ye,this).emit("thumbnailBind",N.uid),N.on("click",()=>{ee(Ye,this).emit("ui_hidePopup",null)})}function Jle(){this.on("resized",p=>{p.newWidth<1200&&p.newWidth>800&&vw(this,ee(Ye,this).rootDom,ee(Up,this))})}const Qle={canvasStyle:ne({},lw),pageStyle:ne({},pB),quadSelectionStyle:ne({},nD),enableSlide:!0};function BB(p,l,u,f){const g=mn.isQuadValid(p);return g.length?Te.output(l,u,f,g):!!D3(p.flat())||Te.output(l,u,f,void 0,fe.PARAM_INVALID)}function UB(p,l,u,f){return!!function(g,m,v){for(let y=0;y<g.length;y++)if(g[y][0]>m||g[y][1]>v)return!0;return!1}(p,u,f)&&(Te.output(l,void 0,void 0,void 0,fe.QUAD_EXCEED_PAGE_BOUND),!0)}const VB=["canvasStyle","pageStyle","quadSelectionStyle"],Hs="PerspectiveViewer";var Lt=new WeakMap,xn=new WeakMap,jB=new WeakSet;function ece(){ee(Lt,this).hooks.destroy.on(()=>{gt(Lt,this,null),Object.setPrototypeOf(this,null)})}var ea=new WeakMap,lu=new WeakMap,mw=new WeakMap,HB=new WeakSet;function nce(){Fr.registerComponent({Root:MF,Layout:PF,Button:gT,Blank:ON,SeparatorLine:kF,Close:CT,Done:_T,Back:bT})}function vw(p,l,u){if(!u||gi()||!p.isVisible)return;const f=l,g=f.clientWidth;if(p instanceof NB){let m=20;g<1280&&(m=Math.max(13.5,g/1280*20)),f.style.fontSize=`${m}px`}}function WB(p){if(p instanceof Blob)return!0;if(nt(p)){const l=u=>{try{return new URL(u),!0}catch(f){return!1}};return!(!/^data:image\/([a-zA-Z]*);base64,/.test(p)&&!l(p))}return!1}function GB(p,l){const u=["Load","Download","Print"],f=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],g=[...f,"MainView"],m=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],v=[...g,...m,...u,"PerspectiveAll","FullQuad"],y=[...g,...m,...u],x=[...g,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],w=[...g,...m,...u,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let C;switch(l){case"captureViewer":C=x;break;case"editViewer":C=w;break;case"perspectiveViewer":C=v;break;case"customViewer":C=f;break;case"browseViewer":C=y}const _=[];return null!=p&&p.type&&!C.includes(null==p?void 0:p.type)&&_.push(p.type),null!=p&&p.children&&p.children.forEach(T=>{nt(T)&&!C.includes(T)&&_.push(T),vt(T)&&_.push(...GB(T,l))}),_}function zB(p){const l=[];return null!=p&&p.type&&l.push(p.type),null!=p&&p.children&&p.children.forEach(u=>{nt(u)&&l.push(u),vt(u)&&l.push(...zB(u))}),[...new Set(l)]}function $B(p,l){const u=GB(p,l);if(u.length>0){let f="";return u.forEach((g,m)=>{f+=m===u.length-1?`${g}`:`${g} `}),f}return!1}function Q0(p){if(""===p)return!0;const l=document.createElement("div");l.style.border=p;const u=v=>""===v||"initial"===v,{borderWidth:f,borderColor:g,borderStyle:m}=l.style;return!(u(f)||u(g)||u(m))}function YB(p,l,u){const{left:f,top:g,width:m,height:v}=p;return!(f>l||f+m>l||g>u||g+v>u)}function uD(p,l){return Object.keys(p).filter(u=>p[u]===l)}function fD(p,l){if(p===l)return!0;if(vt(p)&&vt(l)&&Object.keys(p).length===Object.keys(l).length){for(const u in p)if(!Object.prototype.hasOwnProperty.call(l,u)||!fD(p[u],l[u]))return!1}else{if(!Xt(p)||!Xt(l)||p.length!==l.length)return!1;for(let u=0;u<p.length;u++)if(!fD(p[u],l[u]))return!1}return!0}function XB(p,l){let u;switch(p){case"canvasStyle":u=function(f,g){const m=[];return m.push(...qB(f,{border:(null==g?void 0:g.border)||"",background:(null==g?void 0:g.background)||""})),Se(null==g?void 0:g.cursor)||nt(g.cursor)||m.push(`${f}.cursor is invalid`),m}(p,l);break;case"pageNumberStyle":u=function(f,g){const m=[],v=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(g).forEach(y=>{-1!==v.indexOf(y)&&(nt(g[y])||m.push(`${f}.${y} is invalid.`)),"border"===y&&nt(g[y])&&!Q0(g[y])&&m.push(`${f}.border is invalid.`),("onPage"===y&&!Jn(g[y])||"opacity"===y&&!Ve(g[y])||"visibility"===y&&-1===["visible","hidden"].indexOf(g[y]))&&m.push(`${f}.${y} is invalid.`)}),m}(p,l);break;case"checkBoxStyle":u=function(f,g){const m=[],v=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(g).forEach(y=>{-1!==v.indexOf(y)&&(nt(g[y])||m.push(`${f}.${y} is invalid.`)),"border"===y&&nt(g[y])&&!Q0(g[y])&&m.push(`${f}.border is invalid.`),("opacity"===y&&!Ve(g[y])||"visibility"===y&&-1===["visible","hidden"].indexOf(g[y]))&&m.push(`${f}.${y} is invalid.`)}),m}(p,l);break;case"quadSelectionStyle":u=function(f,g){const m=[],v=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(g).forEach(y=>{-1!==v.indexOf(y)&&(nt(g[y])||m.push(`${f}.${y} is invalid`)),"border"!==y&&"ctrlBorder"!==y||!nt(g[y])||Q0(g[y])||m.push(`${f}.${y} is invalid`)}),m}(p,l);break;case"annotationSelectionStyle":u=function(f,g){const m=[],v=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(g).forEach(y=>{-1!==v.indexOf(y)&&(nt(g[y])||m.push(`${f}.${y} is invalid.`)),"border"!==y&&"ctrlBorder"!==y||!nt(g[y])||Q0(g[y])||m.push(`${f}.${y} is invalid.`)}),m}(p,l);break;default:u=qB(p,l)}return u}function pD(p){return!!Ve(p)&&p>=0}function qB(p,l){const u=[];return Object.keys(l).forEach(f=>{-1!==["background","border"].indexOf(f)&&(nt(l[f])||u.push(`${p}.${f} is invalid.`),"border"===f&&l[f]&&nt(l[f])&&!Q0(l[f])&&u.push(`${p}.border is invalid.`))}),u}function ZB(p,l){const u=p.flat(2),f=l.flat(2);if(u.length!==f.length)return!1;const g=f[0].x-u[0].x,m=f[1].y-u[1].y;for(let v=1;v<u.length;v++)if(f[v].x-u[v].x!==g||f[v].y-u[v].y!==m)return!1;return!0}class mn{static isLicenseValid(l){if(nt(l)){const u=l.trim();return 0===u.length||u.startsWith("DLS")||(u.startsWith("f")||u.startsWith("t"))&&u.length>50}return!1}static isQuadValid(l,u){const f=[],g=tt("Quad",u);if(Se(l))return f.push(`${g} is missing.`),f;const m=Te.isArrayAndMeetMinLength(l,4),v=Te.formatDetails(g,m);return v.length?(f.push(...v),f):(l.forEach((y,x)=>{const w=tt("Quad",u,`[${x}]`,!0),C=Te.isArrayAndMeetMinLength(y,2),_=Te.formatDetails(tt("Array",w),C);_.length?f.push(..._):y.forEach((T,M)=>{const L=Te.isNumberAndIsInRange(T),N=Te.formatDetails(tt("Array",w,`[${M}]`,!0),L);N.length&&f.push(...N)})}),f)}static isRectValid(l,u){const f=[],g=tt("Rect",u);if(Se(l))return f.push(`${g} is missing.`),f;const m=Te.formatDetails(g,vt(l));return m.length?(f.push(...m),f):(["left","top","width","height"].forEach(v=>{const y=Te.formatDetails(tt("Rect",u,v),Te.isNumberAndIsInRange(l[v]));y.length&&f.push(...y)}),f)}static isSourceValid(l,u,f){const g=[],m="Source",v=Te.formatDetails(tt(m,u),vt(l));if(v.length)return g.push(...v),g;const y=Te.formatDetails(tt(m,u,"fileData"),er(l.fileData));if(y.length)return g.push(...y),g;if(!Se(l.extraPageData)){const x=Te.formatDetails(tt(m,u,"extraPageData"),Te.isArrayAndMeetMinLength(l.extraPageData));if(x.length)return g.push(...x),g;l.extraPageData.forEach((w,C)=>{const _=this.isExtraPageDataValid(w,tt(m,u,`extraPageData[${C}]`,!0),f);_.length&&g.push(..._)})}return g}static isExtraPageDataValid(l,u,f){const g=[],m="ExtraPageData",v=Te.formatDetails(tt(m,u),vt(l));if(v.length)return g.push(...v),g;const y=Te.formatDetails(tt(m,u,"index"),Te.isNumberAndIsInRange(l.index));if(g.push(...y),!Se(l.rotation)){const x=this.isRotationValid(l.rotation,tt(m,u));g.push(...x)}if(!Se(l.filter)){const x=this.isFilterTypeValid(l.filter,f,tt(m,u));g.push(...x)}return Se(l.perspectiveQuad)||g.push(...this.isQuadValid(l.perspectiveQuad,tt(m,u,"perspectiveQuad"))),g}static isSourcesValid(l,u,f){const g=[],m="Source[]",v=Te.formatDetails(tt(m,u),Te.isArrayAndMeetMinLength(l));return v.length?(g.push(...v),g):(l.forEach((y,x)=>{g.push(...this.isSourceValid(y,tt(m,u,`[${x}]`,!0),f))}),g)}static isLoadSourceOptionsValid(l,u){const f=[],g="LoadSourceOptions",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.insertBeforeIndex)){const v=Te.formatDetails(tt(g,u,"insertBeforeIndex"),Te.isNumberAndIsInRange(l.insertBeforeIndex));f.push(...v)}if(!Se(l.exception)){const v=Te.formatDetails(tt(g,u,"exception"),Te.isStringAndNotEmpty(l.exception,!1));f.push(...v)}return f}static isHandlerTypeValid(l){return{isValid:nt(l)&&["documentBoundariesDetect","imageFilter"].includes(l)}}static isContainerKeyValid(l,u){const f="container";let g;if(Jf(l)&&(g=l),nt(l)){const v=document.getElementById(l);Jf(v)&&(g=v)}const m=[];return g||m.push(`${tt(f,u,f)}: ${fe.CONTAINER_NOT_EXIST.message}`),m}static isContainerParamValid(l){return nt(l)||Jf(l)?this.isContainerKeyValid(l).length>0?fe.CONTAINER_NOT_EXIST:null:fe.PARAM_INVALID}static isUiConfigValid(l,u){const f="UiConfig",g=[],m=Te.formatDetails(tt(f,u),vt(l));if(m.length)return g.push(...m),g;const v=Te.formatDetails(tt(f,u,"type"),Te.isStringAndNotEmpty(l.type,!1));if(g.push(...v),["id","name","flexDirection","tooltip","className","label"].forEach(y=>{if(!Se(l[y])){const x=Te.formatDetails(tt(f,u,y),Te.isStringAndNotEmpty(l[y]));g.push(...x)}}),["style","events"].forEach(y=>{if(!Se(l[y])){const x=Te.formatDetails(tt(f,u,y),vt(l[y]));g.push(...x)}}),!Se(l.children)){const y=Te.formatDetails(tt(f,u,"children"),Te.isArrayAndMeetMinLength(l.children));if(y.length)return g.push(...y),g;l.children.forEach((x,w)=>{if(nt(x)||vt(x)||g.push(`${f}.children[${w}] is invalid.`),vt(x)){const C=this.isUiConfigValid(x,tt(f,u,`children[${w}]`));g.push(...C)}})}return g}static isDocOptionsValid(l,u){const f=[],g=u||"CreateDocumentOptions",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.name)){const v=Te.formatDetails(tt(g,u,"name"),Te.isStringAndNotEmpty(l.name,!1));f.push(...v)}if(!Se(l.author)){const v=Te.formatDetails(tt(g,u,"author"),Te.isStringAndNotEmpty(l.author,!1));f.push(...v)}if(!Se(l.creationDate)){const v=Te.formatDetails(tt(g,u,"creationDate"),Te.isPdfDate(l.creationDate));f.push(...v)}if(!Se(l.deleteOriginal)){const v=Te.formatDetails(tt(g,u,"deleteOriginal"),Jn(l.deleteOriginal));f.push(...v)}return f}static isTransferOptionsValid(l,u,f,g){const m=[],v="TransferOptions",y=Te.formatDetails(tt(v,g),vt(l));if(y.length)return m.push(...y),m;if(!Se(l.sourceIndices)){const x=this.isNumberArrayValid(l.sourceIndices,u,f,tt(v,g,"sourceIndices"));m.push(...x)}if(!Se(l.insertBeforeIndex)){const x=Te.formatDetails(tt(v,g,"insertBeforeIndex"),Te.isNumberAndIsInRange(l.insertBeforeIndex,0));m.push(...x)}return m}static isNumberArrayValid(l,u,f,g){return this.isTypeArrayValid("number",l,u,f,g)}static isStringArrayValid(l,u){return this.isTypeArrayValid("string",l,void 0,void 0,u)}static isBlobArrayValid(l,u){return this.isTypeArrayValid("blob",l,void 0,void 0,u)}static isTypeArrayValid(l,u,f,g,m){const v=[],y=Te.formatDetails(tt("Array",m),Te.isArrayAndMeetMinLength(u));return y.length?(v.push(...y),v):(u.forEach((x,w)=>{let C=null;"blob"===l?C=er(x):"number"===l?C=Te.isNumberAndIsInRange(x,f,g):"string"===l&&(C=Te.isStringAndNotEmpty(x));const _=Te.formatDetails(tt("Array",m,`[${w}]`,!0),C);v.push(..._)}),v)}static isUpdatePageOptionsValid(l,u,f){const g=[],m="UpdatePageOptions",v=Te.formatDetails(tt(m,f),vt(l));if(v.length)return g.push(...v),g;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach(y=>{const x=l[y];if(!Se(x)){const w=Te.formatDetails(tt(m,f,y),Te.isNumberAndIsInRange(x,0));g.push(...w)}}),!Se(l.rotation)){const y=this.isRotationValid(l.rotation,tt(m,f));g.push(...y)}if(!Se(l.filter)){const y=this.isFilterTypeValid(l.filter,u,tt(m,f));g.push(...y)}return g}static isRotationValid(l,u){const f=[],g=tt("",u,"rotation"),m=Te.formatDetails(g,Te.isNumberAndIsInRange(l));return m.length?(f.push(...m),f):(f.length||l%90==0||f.push(`'${g}' is not supported.`),f)}static isFilterTypeValid(l,u,f){const g=[],m=tt("",f,"filter"),v=Te.formatDetails(m,Te.isStringAndNotEmpty(l,!1));return v.length?(g.push(...v),g):(!g.length&&"none"!==l&&Xt(u)&&u.length>0&&!u.includes(l)&&g.push(`'${m}' is not supported.`),g)}static isSaveJpegSettingsValid(l,u){const f=[],g="SaveJpegSettings",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.quality)){const v=Te.formatDetails(tt(g,u,"quality"),Te.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}if(!Se(l.saveAnnotation)){const v=Te.formatDetails(tt(g,u,"saveAnnotation"),Jn(l.saveAnnotation));f.push(...v)}return f}static isSavePngSettingsValid(l,u){const f=[],g="SavePngSettings",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.saveAnnotation)){const v=Te.formatDetails(tt(g,u,"saveAnnotation"),Jn(l.saveAnnotation));f.push(...v)}return f}static isSavePdfSettingsValid(l,u){const f=[],g="SavePdfSettings",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(["author","creator","keyWords","producer","subject","title"].forEach(v=>{const y=l[v];if(!Se(y)){const x=Te.formatDetails(tt(g,u,v),Te.isStringAndNotEmpty(y,!1));f.push(...x)}}),!Se(l.compression)){const v=Te.formatDetails(tt(g,u,"compression"),v6.has(l.compression));f.push(...v)}if(!Se(l.creationDate)){const v=Te.formatDetails(tt(g,u,"creationDate"),Te.isPdfDate(l.creationDate));f.push(...v)}if(!Se(l.modifiedDate)){const v=Te.formatDetails(tt(g,u,"modifiedDate"),Te.isPdfDate(l.modifiedDate));f.push(...v)}if(!Se(l.pageType)){const v=Te.formatDetails(tt(g,u,"pageType"),m6.has(l.pageType));f.push(...v)}if(!Se(l.version)){const v=Te.formatDetails(tt(g,u,"version"),this.isPdfVersionValid(l.version));f.push(...v)}if(!Se(l.mimeType)){const v=Te.formatDetails(tt(g,u,"mimeType"),Te.isStringAndNotEmpty(l.mimeType));f.push(...v)}if(!Se(l.quality)){const v=Te.formatDetails(tt(g,u,"quality"),Te.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}if(!Se(l.password)){const v=Te.formatDetails(tt(g,u,"password"),Te.isStringAndNotEmpty(l.password));f.push(...v),!v.length&&l.password.length>32&&f.push("The specified password exceeds 32 characters.")}if(!Se(l.saveAnnotation)){const v=Te.formatDetails(tt(g,u,"saveAnnotation"),["none","image","annotation","flatten"].includes(l.saveAnnotation));f.push(...v)}if(!Se(l.imageScaleFactor)){const v=Te.formatDetails(tt(g,u,"imageScaleFactor"),Te.isNumberAndIsInRange(l.imageScaleFactor,Number.MIN_VALUE,1));f.push(...v)}return f}static isPdfVersionValid(l){return!!nt(l)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(l.trim())}static isSaveTiffSettingsValid(l,u){const f=[],g="SaveTiffSettings",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.compression)){const v=Te.formatDetails(tt(g,u,"compression"),O3.has(l.compression));f.push(...v)}if(!Se(l.customTag)){const v=Te.formatDetails(tt(g,u,"customTag"),Te.isArrayAndMeetMinLength(l.customTag));f.push(...v),v.length||l.customTag.forEach((y,x)=>{const w=this.isTiffCustomTagValid(y,tt(g,u,`customTag[${x}]`));f.push(...w)})}if(!Se(l.quality)){const v=Te.formatDetails(tt(g,u,"quality"),Te.isNumberAndIsInRange(l.quality,0,100));f.push(...v)}return f}static isTiffCustomTagValid(l,u){const f=[],g="CustomTag",m=Te.formatDetails(tt(g,u),vt(l));if(m.length)return f.push(...m),f;if(!Se(l.content)){const v=Te.formatDetails(tt(g,u,"content"),Te.isStringAndNotEmpty(l.content,!1));f.push(...v)}if(!Se(l.contentIsBase64)){const v=Te.formatDetails(tt(g,u,"contentIsBase64"),Jn(l.contentIsBase64));f.push(...v)}if(!Se(l.id)){const v=Te.formatDetails(tt(g,u,"id"),Te.isNumberAndIsInRange(l.id));f.push(...v)}return f}static isVideoDeviceInfo(l,u){const f=[],g=Te.formatDetails(u,vt(l));f.push(...g);const m=Te.formatDetails(tt(u,void 0,"deviceId"),Te.isStringAndNotEmpty(l.deviceId,!1));f.push(...m);const v=Te.formatDetails(tt(u,void 0,"label"),Te.isStringAndNotEmpty(l.label,!1));return f.push(...v),f}static isVideoConfig(l,u){const f=[],g=Te.formatDetails(u,vt(l));if(g.length)return f.push(...g),f;if(!Se(l.fill)){const m=Te.formatDetails(tt(u,void 0,"fill"),Jn(l.fill));f.push(...m)}if(!Se(l.resolution)){const m=mn.isNumberArrayValid(l.resolution,0,void 0,tt(u,void 0,"resolution"));f.push(...m)}return f}static isZoomOriginValid(l){const u=[],f=Te.formatDetails("zoomOrigin",vt(l));return f.length?(u.push(...f),u):(["x","y"].forEach(g=>{const m=l[g];Se(m)?u.push(`ZoomOrigin.${g} is missing.`):["start","center","end"].includes(m)||u.push(`ZoomOrigin.${g} is valid.`)}),u)}static isAnnotationOptionsValid(l,u,f){const g=[],m=["x","y","rotation"],v=["width","height","borderWidth","opacity","miterLimit","fontSize"],y=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],x=["fontWeight"],w=["fontStyle"],C=["points"],_=["textContents"],T=["startPoint","endPoint"],M=["flags"],L=["underline","lineThrough"],N=["stamp"],V=["lineDash"];if("textTypewriter"===f){const{textContents:z}=l;if(z&&(!Xt(z)||!z.length||z.find(q=>!vt(q))||z.every(q=>""===q.content||null==q.content)))return g.push(`${u}.textContents is invalid`),g}const H=z=>!!vt(z)&&!!Ve(null==z?void 0:z.x)&&!!Ve(null==z?void 0:z.y),G=z=>{if(!Xt(z)||z.length<2)return!1;for(let q=0;q<z.length;q++)if(!H(z[q]))return!1;return!0};return Object.keys(l).forEach(z=>{const q=l[z];let te=!0;var se;(m.includes(z)&&!Ve(q)||v.includes(z)&&!pD(q)||y.includes(z)&&!nt(q)||_.includes(z)&&!(ae=>{if(!Xt(ae))return!1;for(let j=0;j<ae.length;j++){const le=ae[j];if(!vt(le))return!1;const ue=Object.keys(le);for(let xe=0;xe<ue.length;xe++){const I=ue[xe],A=le[I];if(m.includes(I)&&!Ve(A)||v.includes(I)&&!pD(A)||y.includes(I)&&!nt(A)||L.includes(I)&&!Jn(A)||x.includes(I)&&!["normal","bold"].includes(A)||w.includes(I)&&!["normal","italic"].includes(A))return!1}}return!0})(q)||T.includes(z)&&!H(q)||M.includes(z)&&!vt(q)||N.includes(z)&&![Jt.REJECTED,Jt.ACCEPTED,Jt.INITIAL_HERE,Jt.SIGN_HERE,Jt.WITNESS,Jt.APPROVED,Jt.NOT_APPROVED,Jt.DRAFT,Jt.FINAL,Jt.COMPLETED,Jt.CONFIDENTIAL,Jt.VOID].includes(se=q)&&!er(se)||V.includes(z)&&!(ae=>{if(!Xt(ae))return!1;for(let j=0;j<ae.length;j++)if(!pD(ae[j]))return!1;return!0})(q))&&(te=!1),C.includes(z)&&("ink"===f?(ae=>{if(!Xt(ae)||!ae.length)return!1;for(let j=0;j<ae.length;j++)if(!G(ae[j]))return!1;return!0})(l[z])||(te=!1):G(l[z])||(te=!1)),te||g.push(`${u}.${z} is invalid`)}),g}}var us=new WeakMap,Dl=new WeakMap,Oa=new WeakSet;class sce{constructor(l,u){Js(this,Oa),Ht(this,us,void 0),Ht(this,Dl,void 0),gt(us,this,l),gt(Dl,this,u)}get name(){return ee(Dl,this).name}get uid(){return ee(Dl,this).uid}get pages(){return ee(Dl,this).pages.slice()}get creationDate(){return ee(Dl,this).creationDate}get author(){return ee(Dl,this).author}loadSource(l,u){var f=this;return Q(function*(){const g="IDocument.loadSource",m="sources";return Wt.makeSureLoadLicenseExist(),it(l,0,g,m),function(v,y,x,w,C){let _=[];Xt(v)?_=er(v[0])?v.reduce((T,M,L)=>{if(!er(M)){const N=Te.formatDetails(tt("Array",C,`[${L}]`,!0),!1);T.push(...N)}return T},[]):mn.isSourcesValid(v,void 0,y):er(v)||(_=mn.isSourceValid(v,void 0,y)),!_.length||Te.output(0,"IDocument.loadSource",C,_)}(l,ee(us,f).filterService.getSupportedFilters().map(v=>v.type),0,0,m),vt(u)?function(v,y,x,w){const C=mn.isLoadSourceOptionsValid(v,void 0);!C.length||Te.output(0,"IDocument.loadSource","loadSourceOptions",C)}(u):Se(u)||ka(u,0,g,"index",0),Xt(l)||(l=[l]),er(l[0])&&(l=l.map(v=>({fileData:v}))),ee(us,f).loadSource(l,f.uid,u).catch(v=>fe.reject(v,g))})()}getPageData(l){var u=this;return Q(function*(){const f="IDocument.getPageData",g="pageUid";it(l,0,f,g),xi(l,0,f,g,!1),u.pages.includes(l)||Te.error(f,g,void 0,fe.PAGE_NOT_EXIST);const m=yield ee(us,u).getPageData(l);m.raw&&(m.raw={data:m.raw.data,width:m.raw.width,height:m.raw.height}),m.display&&(m.display={data:m.display.data,width:m.display.width,height:m.display.height}),m.thumbnail&&(m.thumbnail={data:m.thumbnail.data,width:m.thumbnail.width,height:m.thumbnail.height}),m.rotation&&(m.rotation%=360);const{displayResolution:v,dataResolution:y}=yt;return m.mediaBox=JB(bt(m.mediaBox,v,y),2),m.cropBox=JB(bt(m.cropBox,v,y),2),m})()}updatePage(l,u,f){var g=this;return Q(function*(){const m="IDocument.updatePage",v="pageUid";return it(l,0,m,v),it(u,0,m,"data"),xi(l,0,m,v,!1),cw(g.pages,l,0,m),er(u)||Te.output(0,"IDocument.updatePage","data",void 0,fe.PARAM_INVALID),!Se(f)&&function(x,w,C,_){const T=mn.isUpdatePageOptionsValid(x,w,"updatePageOptions");!T.length||Te.output(0,"IDocument.updatePage","options",T)}(f,ee(us,g).filterService.getSupportedFilters().map(x=>x.type)),ee(us,g).updatePage(l,u,f)})()}deletePages(l){const u="IDocument.deletePages",f="indices";if(it(l,1,u,f)||!Pc(l,1,u,f,0,ol(Oa,this,Al)-1))return!1;const g=l.map(m=>ee(Dl,this).pages[m]);return ee(us,this).deletePages(this.uid,g)}deleteAllPages(){return ee(Dl,this).pages.slice(),ee(us,this).deleteAllPages(this.uid)}movePages(l,u){const f="IDocument.movePages",g="indices";it(l,0,f,g),Pc(l,0,f,g,0,ol(Oa,this,Al)-1),Se(u)||ka(u,0,f,"insertBeforeIndex",0),u=u>ol(Oa,this,Al)-1?void 0:u,ee(us,this).movePages(this.uid,l,u)}switchPage(l,u){const f="IDocument.switchPage",g="oneIndex",m="anotherIndex";it(l,0,f,g),it(u,0,f,m),ka(l,0,f,g,0,ol(Oa,this,Al)-1),ka(u,0,f,m,0,ol(Oa,this,Al)-1),ee(us,this).documentService.swapPages(this.uid,l,u)}rename(l){const u="IDocument.rename",f="name";return!it(l,1,u,f)&&!!xi(l,1,u,f)&&ee(us,this).documentService.renameDocument(this.uid,l)}setPageCustomData(l,u){const f="IDocument.setPageCustomData",g="pageUid";return it(l,0,f,g),it(u,0,f,"data"),xi(l,0,f,g,!1),cw(this.pages,l,0,f),ee(us,this).setCustomData(l,u)}getPageCustomData(l){const u="IDocument.getPageCustomData",f="pageUid";return it(l,0,u,f),xi(l,0,u,f,!1),cw(this.pages,l,0,u),ee(us,this).getCustomData(l)}saveToJpeg(l,u){var f=this;return Q(function*(){const g="IDocument.saveToJpeg",m="index";it(l,0,g,m),ka(l,0,g,m,0,ol(Oa,f,Al)-1),Se(u)||function(y,x,w){const C=mn.isSaveJpegSettingsValid(y);!C.length||Te.output(0,"IDocument.saveToJpeg","saveJpegSettings",C)}(u);const v=f.pages[l];return ee(us,f).fileSaveService.saveToJpeg(v,u).catch(y=>fe.reject(y,g))})()}saveToPng(l,u){const f="IDocument.saveToPng",g="index";it(l,0,f,g),ka(l,0,f,g,0,ol(Oa,this,Al)-1),Se(u)||function(v,y,x){const w=mn.isSavePngSettingsValid(v);w.length&&Te.output(0,"IDocument.saveToPng","savePngSettings",w)}(u);const m=this.pages[l];return ee(us,this).fileSaveService.saveToPng(m,u).catch(v=>fe.reject(v,f))}saveToPdf(l,u){const f="IDocument.saveToPdf";0===this.pages.length&&fe.throw(fe.DOC_NO_IMAGE),Xt(l)?Pc(l,0,f,"indices",0,ol(Oa,this,Al)-1):(u=l,l=Array.from(Array(this.pages.length).keys())),Se(u)||function(m,v,y){const x=mn.isSavePdfSettingsValid(m);!x.length||Te.output(0,"IDocument.saveToPdf","savePdfSettings",x)}(u);const g=[];l.forEach(m=>{g.push(this.pages[m])});try{!u||"annotation"!==u.saveAnnotation&&"flatten"!==u.saveAnnotation||Wt.makeSureAnnotationLicenseExist()}catch(m){return Promise.reject(m)}return ee(us,this).fileSaveService.saveToPdf(g,u).catch(m=>fe.reject(m,f))}saveToTiff(l,u){const f="IDocument.saveToTiff";0===this.pages.length&&fe.throw(fe.DOC_NO_IMAGE),Xt(l)?Pc(l,0,f,"indices",0,ol(Oa,this,Al)-1):(u=l,l=Array.from(Array(this.pages.length).keys())),Se(u)||function(m,v,y){const x=mn.isSaveTiffSettingsValid(m);!x.length||Te.output(0,"IDocument.saveToTiff","saveTiffSettings",x)}(u);const g=[];return l.forEach(m=>{g.push(this.pages[m])}),ee(us,this).fileSaveService.saveToTiff(g,u).catch(m=>fe.reject(m,f))}print(l,u){const f="IDocument.print";let g,m=u;var v;Xt(l)?(Pc(l,0,f,"indices",0,ol(Oa,this,Al)-1),g=l):m=l,Se(m)||Se(null===(v=m)||void 0===v?void 0:v.printAnnotation)||Jn(m.printAnnotation)||Te.error(f,"setting.printAnnotation",void 0,fe.PARAM_INVALID),0===this.pages.length&&fe.throw(fe.DOC_NO_IMAGE),ee(us,this).printPages(this.uid,g,m)}insertBlankPage(l,u,f){const g="IDocument.insertBlankPage",m="pageWidth",v="pageHeight";return Wt.makeSureLoadLicenseExist(),it(l,0,g,m),it(u,0,g,v),ka(l,0,g,m,.72,7200),ka(u,0,g,v,.72,7200),Se(f)||ka(f,0,g,"insertBeforeIndex",0),ee(us,this).insertBlankPage(this.uid,Math.floor(bt(l,yt.dataResolution,72))||1,Math.floor(bt(u,yt.dataResolution,72))||1,72,72,f)}}function Al(p){return ee(Dl,p).pages.length}function JB(p,l){let u=!0;const f=hl(p.left,l),g=hl(p.top,l),m=hl(p.width,l),v=hl(p.height,l),y=1e-7;return(Math.abs(f-p.left)>y||Math.abs(g-p.top)>y||Math.abs(m-p.width)>y||Math.abs(v-p.height)>y)&&(u=!1),u?{left:f,top:g,width:m,height:v}:p}function QB(p,l,u,f,g){if(!Se(p)){const m="transferOptions",v=mn.isTransferOptionsValid(p,l,u,m);if(v.length)return Te.output(f,g,m,v)}return!0}function KB(p,l,u,f){if(!Se(p)){const g=mn.isDocOptionsValid(p);if(g.length)return Te.output(l,u,f,g)}return!0}function eU(p,l,u,f,g){const m=l.reduce((v,y,x)=>(p.has(y)||v.push(`${g}[${x}]:The specified document(s) do not exist.`),v),[]);return!m.length||Te.output(u,f,g,m,fe.DOC_NOT_EXIST,!0)}const tU=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var La=new WeakMap,or=new WeakMap,Il=new WeakMap;const iU=new class extends mi{constructor(){super(),Ht(this,La,void 0),Ht(this,or,void 0),Ht(this,Il,void 0),gt(Il,this,new cl),gt(La,this,Ni),gt(or,this,new Map),Ni.onUnload.on(()=>{ee(or,this).clear(),ee(Il,this).removeAllEventListeners()},this);const{documentService:p}=Ni;p.onDocumentCreated.on(l=>{const u=ee(La,this).getDocument(l.docUid),f=new sce(ee(La,this),u);ee(or,this).set(f.uid,f),ee(Il,this).emit("documentCreated",l)},this),p.onDocumentDeleted.on(l=>{ee(or,this).has(l.docUid)&&ee(or,this).delete(l.docUid),ee(Il,this).emit("documentDeleted",l)},this),p.onPagesAdded.on(l=>{l.indices.length&&l.pageUids.length&&ee(Il,this).emit("pagesAdded",l)},this),p.onDeletePagesFromDoc.on(l=>{ee(Il,this).emit("pagesDeleted",l)},this),p.onDeleteAllPagesFromDoc.on(l=>{ee(Il,this).emit("pagesDeleted",l)},this)}createDocument(p){KB(p,0,"DocumentManager.createDocument","createDocumentOptions");const l=ee(La,this).createDocument(p);return ee(or,this).get(l.uid)}getDocument(p){const l="DocumentManager.getDocument",u="docUid";it(p,0,l,u),xi(p,0,l,u);const f=ee(or,this).get(p);return f||Te.error(l,u,void 0,fe.DOC_NOT_EXIST),f}getAllDocuments(){return Array.from(ee(or,this).values())}deleteDocuments(p){const l="DocumentManager.deleteDocuments",u="docUids";return!(it(p,1,l,u)||!Z0(p,1,l,u,void 0,!1)||!eU(ee(or,this),p,1,l,u))&&ee(La,this).deleteDocuments([...new Set(p)])}deleteAllDocuments(){const p=ee(La,this).documentService.getAllDocuments();return ee(La,this).deleteDocuments(p.map(l=>l.uid))}copyPagesToDocument(p,l,u){const f="DocumentManager.copyPagesToDocument",g="sourceDocUid",m="targetDocUid";it(p,0,f,g),it(l,0,f,m),xi(p,0,f,g),xi(l,0,f,m);const v=ee(or,this).get(p),y=ee(or,this).get(l);return v&&y||fe.throw(fe.DOC_NOT_EXIST,f),QB(u,0,v.pages.length-1,0,f),ee(La,this).transferDocument(p,l,Fe(ne({},u),{copy:!0}))}movePagesToDocument(p,l,u){const f="DocumentManager.movePagesToDocument",g="sourceDocUid",m="targetDocUid";it(p,0,f,g),it(l,0,f,m),xi(p,0,f,g),xi(l,0,f,m);const v=ee(or,this).get(p),y=ee(or,this).get(l);return v&&y||fe.throw(fe.DOC_NOT_EXIST,f),QB(u,0,v.pages.length-1,0,f),ee(La,this).transferDocument(p,l,u)}mergeDocuments(p,l){const u="DocumentManager.mergeDocuments",f="docUids";var m;it(p,0,u,f),Z0(p,0,u,f,void 0,!1),m=p,new Set(m).size!==m.length&&Te.error(void 0,void 0,void 0,fe.DOC_UID_DUPLICATE),eU(ee(or,this),p,0,u,f),KB(l,0,u,"mergeDocumentOptions");const g=ee(La,this).mergeDocuments(p,l);return ee(or,this).get(g.uid)}on(p,l){const u="DocumentManager.on";!it(p,1,u,"eventName")&&!it(l,1,u,"listener")&&xi(p,1,u,"eventName",!1)&&El(l,u,"listener",1)&&(tU.includes(p)?ee(Il,this).on(p,l):fe.warning(fe.PARAM_NOT_SUPPORT,u,"eventName"))}off(p,l){const u="DocumentManager.off";!it(p,1,u,"eventName")&&xi(p,1,u,"eventName",!1)&&(Se(l)||El(l,u,"listener",1))&&(tU.includes(p)?ee(Il,this).off(p,l):fe.warning(fe.PARAM_NOT_SUPPORT,u,"eventName"))}},nU=`${(()=>{if(!Rd&&document.currentScript){let{src:p}=document.currentScript;const l=p.indexOf("?");if(-1!==l)p=p.substring(0,l);else{const u=p.indexOf("#");-1!==u&&(p=p.substring(0,u))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})()}engine`;var yw=new WeakMap,xw=new WeakMap,K0=new WeakMap;const rce=new class{constructor(){Ht(this,yw,""),Ht(this,xw,""),Ht(this,K0,nU)}get versionInfo(){return{viewer:QL,engine:Ke.version}}set engineResourcePath(p){nt(p)?gt(K0,this,p):fe.throw(fe.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath")}get engineResourcePath(){return ee(K0,this)}set license(p){(function(l,u,f,g){const m=Te.formatError({isValid:mn.isLicenseValid(l)});!m||Te.output(0,"Core.license","license",void 0,m)})(p),gt(xw,this,p)}get license(){return ee(xw,this)}set deviceFriendlyName(p){nt(p)?gt(yw,this,p):fe.throw(fe.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName")}get deviceFriendlyName(){return ee(yw,this)}loadWasm(){return function(){var p=Q(function*(l){let u=l.trim();if(u.endsWith("/")||(u=`${u}/`),Ke.resourceDir=u,!(yield Ke.isResourceDirValid()))return fe.reject(fe.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");yield Ke.preloadModule("core");const f=Ke.preloadModule("proc"),g=Ke.preloadModule("pdf");yield Promise.all([f,g])});return function(l){return p.apply(this,arguments)}}()(ee(K0,this))}init(){return function zne(p){return cE.apply(this,arguments)}({license:ee(xw,this),engineResourcePath:ee(K0,this),deviceFriendlyName:ee(yw,this)})}};var gD;!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert"}(gD||(gD={}));const mD=[],Rc={documentManager:iU,Core:rce,Elements:rt,DocumentDetect:VL,ImageFilter:class{constructor(){Js(this,q6)}get defaultFilterType(){return hs.NONE}applyFilter(p,l,u,f){var g=this;return Q(function*(){const m=new Ch,v=ye(q6,g,yne).call(g,l,u),y=ye(q6,g,xne).call(g,ne({outputType:p.type},f||{}));let x;try{const w=yield m.initImage({source:p.data,isRGBA:p.type===Ri.RGBA,width:p.width,height:p.height,isBGRA:p.type===Ri.BGRA});let C;w.srcBuffer&&(p.data=w.srcBuffer),l===hs.NONE?(C=yield m.getImage({jpegQuality:y.jpegQuality,ifDeleteObject:!0,isRGBA:p.type===Ri.RGBA,bitDepth:y.bitDepth,xDpi:y.xdpi,yDpi:y.ydpi,returnBlob:!1,returnType:o0[y.outputType]}),m.freeReservedData()):C=yield m.filter(HL.get(l),v,y),x=new Blob([C.imageData],{type:C.blobType})}finally{m.terminate()}return x})()}querySupported(){return[{type:hs.NONE,label:"Original"},{type:hs.BLACK_AND_WHITE,label:"B&W"},{type:hs.GRAY,label:"Grayscale"},{type:hs.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:class tce extends _B{constructor(l){super(l,"BrowseViewer")}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(l){this.vCommon.bindContainer(this.v,l,`${this.errorPrefix}.bindContainer`)}unbindContainer(){this.vCommon.unbindContainer(this.v)}openDocument(l){this.vCommon.openDocument(l,this.uid,`${this.errorPrefix}.openDocument`)}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(l,u){return this.vCommon.rotate(this.v,l,u,`${this.errorPrefix}.rotate`)}indexToUid(l){return this.vCommon.indexToUid(this.v,l,`${this.errorPrefix}.indexToUid`)}uidToIndex(l){return this.vCommon.uidToIndex(this.v,l,`${this.errorPrefix}.uidToIndex`)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(l){return this.vCommon.gotoPage(this.v,l,`${this.errorPrefix}.goToPage`)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v)}},CaptureViewer:class Sle{constructor(l){var u;Js(this,xB),Ht(this,zt,void 0),Ht(this,js,new hw),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"postfix",void 0);const f=`new ${_r}`;Wt.makeSureCoreLicenseExist(),Wt.makeSureCameraLicenseExist(),Se(l)||X0(l,"captureViewer",0,f,"option");const g=gn((null==l?void 0:l.viewerConfig)||{},qe(Fe(ne({},_le),{viewerMode:Rn.CAPTURE}))),m=gi()?cB:dB;gt(zt,this,Ni.createViewer(Fe(ne({uiConfig:qe(m)},l),{viewerConfig:g}))),null!=l&&null!==(u=l.viewerConfig)&&void 0!==u&&u.enableAutoDetect&&!ee(zt,this).context.core.detectorService.enableDetect&&fe.warning(fe.DOC_DETECT_MISS),this.uid=ee(zt,this).uid,this.groupUid=ee(zt,this).groupUid,this.postfix=ee(zt,this).postfix,ye(xB,this,Ele).call(this)}get isVisible(){return ee(js,this).getIsVisible(ee(zt,this))}get isBoundContainer(){return ee(js,this).getIsBoundContainer(ee(zt,this))}get currentDocument(){return ee(js,this).getCurrentDocument(ee(zt,this))}get acceptedPolygonConfidence(){return ee(zt,this).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(l){const u="acceptedPolygonConfidence";ka(l,1,`${_r}.${u}`,u,0,100)&&ee(zt,this).updateCameraConfig({acceptedPolygonConfidence:l})}get maxFrameNumber(){return ee(zt,this).getCameraConfig().maxFrameNumber}set maxFrameNumber(l){const u="maxFrameNumber";ka(l,1,`${_r}.${u}`,u,1e-6,60)&&ee(zt,this).updateCameraConfig({maxFrameNumber:l})}get enableAutoDetect(){return ee(zt,this).getCameraConfig().enableAutoDetect}set enableAutoDetect(l){const u="enableAutoDetect",f=`${_r}.${u}`;rD(l,f,u,1)&&(l&&!ee(zt,this).context.core.detectorService.enableDetect&&Te.warning(f,void 0,void 0,fe.DOC_DETECT_MISS),ee(zt,this).updateCameraConfig({enableAutoDetect:l}))}get enableAutoCapture(){return ee(zt,this).getCameraConfig().enableAutoCapture}set enableAutoCapture(l){const u="enableAutoCapture";rD(l,`${_r}.${u}`,u,1)&&ee(zt,this).updateCameraConfig({enableAutoCapture:l})}bindContainer(l){ee(js,this).bindContainer(ee(zt,this),l,`${_r}.bindContainer`)}unbindContainer(){ee(js,this).unbindContainer(ee(zt,this))}show(){ee(js,this).show(ee(zt,this))}hide(){ee(js,this).hide(ee(zt,this))}getUiConfig(){return ee(js,this).getUiConfig(ee(zt,this))}updateUiConfig(l){return ee(js,this).updateUiConfig(ee(zt,this),l,"captureViewer",`${_r}.updateUiConfig`)}openDocument(l){ee(js,this).openDocument(l,this.uid,`${_r}.openDocument`)}closeDocument(){return ee(js,this).closeDocument(ee(zt,this),`${_r}.closeDocument`)}getStyle(l){return ee(js,this).getStyle(ee(zt,this),"capture",l,yB,`${_r}.getStyle`)}updateStyle(l,u){return ee(js,this).updateStyle(ee(zt,this),l,u,yB,`${_r}.updateStyle`)}capture(){return ee(zt,this).isVideoPlaying()?ee(zt,this).context.viewService.isBindContainer?ee(zt,this).capture():fe.reject(fe.CONTAINER_NO_BOUND):fe.reject(fe.CAMERA_NO_VIDEO)}play(l){const u=`${_r}.play`;if(!Se(l)){const f=function(g,m,v,y){const x=mn.isVideoConfig(g,y);return!x.length||Te.output(2,v,y,x)}(l,0,u,"config");if(!0!==f)return f}return ee(zt,this).play(l).catch(f=>fe.reject(f,u))}stop(){ee(zt,this).stop()}getCurrentCamera(){return ee(zt,this).getCurrentCamera()}getAllCameras(){return ee(zt,this).getAllCameras()}selectCamera(l){const u=`${_r}.selectCamera`,f="cameraObjectOrDeviceID",g=it(l,2,u,f);if(g)return g;if(nt(l)){const m=xi(l,2,u,f,!1);if(!0!==m)return m}else{const m=function(v,y,x,w){const C=mn.isVideoDeviceInfo(v,w);return!C.length||Te.output(2,x,w,C)}(l,0,u,f);if(!0!==m)return m}return ee(zt,this).selectCamera(l).catch(m=>fe.reject(m,u,f))}getCurrentResolution(){return ee(zt,this).getCurrentResolution()}turnOnTorch(){return ee(zt,this).turnOnTorch().catch(l=>fe.reject(l))}turnOffTorch(){return ee(zt,this).turnOffTorch().catch(l=>fe.reject(l))}on(l,u){ee(js,this).on(ee(zt,this),`${_r}.on`,l,u)}off(l,u){ee(js,this).off(ee(zt,this),`${_r}.off`,l,u)}destroy(){ee(js,this).destroy(ee(zt,this))}},CustomViewer:class ice{constructor(l){Js(this,HB),Ht(this,ea,void 0),Ht(this,lu,void 0),Ht(this,mw,!1),S(this,"uid",void 0),S(this,"isDestroyed",!1),S(this,"postfix",void 0),this.uid=qt(),this.postfix=`-${this.uid}`,gt(lu,this,new cl),Se(l)||X0(l,"customViewer",0,"new CustomViewer","option");let u=null==l?void 0:l.uiConfig;(!u||vt(u)&&0===Object.keys(u).length)&&(u={type:"Layout"}),ye(HB,this,nce).call(this),gt(ea,this,new Fr({container:null==l?void 0:l.container,emitter:ee(lu,this),postfix:this.uid,uiConfig:u,injection:{viewer:{postfix:this.postfix}}})),null!=l&&l.container&&u&&ee(ea,this).bindContainer(l.container)}get isBoundContainer(){return ee(mw,this)}get isVisible(){return"none"!==ee(ea,this).rootDom.style.display}bindContainer(l){const u="CustomViewer.bindContainer";it(l,0,u,"container");const f=mn.isContainerParamValid(l);f&&Te.error(u,"container",void 0,f),ee(ea,this).bindContainer(l)&&gt(mw,this,!0)}unbindContainer(){ee(ea,this).unbindContainer(),gt(mw,this,!1)}hide(){ee(ea,this).rootDom.style.display="none"}show(){ee(ea,this).rootDom.style.display="flex"}getUiConfig(){return ee(ea,this).uiConfig}updateUiConfig(l){const u="CustomViewer.updateUiConfig",f="uiConfig";return!(it(l,1,u,f)||!vB(l,"customViewer",u,f,1))&&ee(ea,this).updateUiConfig(l)}on(l,u){const f="CustomViewer.on";!it(l,1,f,"eventName")&&!it(u,1,f,"listener")&&xi(l,1,f,"eventName",!1)&&El(u,f,"listener",1)&&ee(lu,this).on(l,u)}off(l,u){const f="CustomViewer.off";!it(l,1,f,"eventName")&&xi(l,1,f,"eventName",!1)&&(Se(u)||El(u,f,"listener",1))&&ee(lu,this).off(l,u)}destroy(){this.isDestroyed||(ee(ea,this).dispose(),ee(lu,this).destroy(),gt(ea,this,null),gt(lu,this,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null)}},EditViewer:NB,PerspectiveViewer:class Kle{constructor(l){Js(this,jB),Ht(this,Lt,void 0),Ht(this,xn,new hw),S(this,"uid",void 0),S(this,"groupUid",void 0),S(this,"postfix",void 0),Wt.makeSureCoreLicenseExist(),Se(l)||X0(l,"perspectiveViewer",0,`new ${Hs}`,"option");const u=gn((null==l?void 0:l.viewerConfig)||{},qe(Fe(ne({},Qle),{viewerMode:Rn.PERSPECTIVE,toolMode:"crop"}))),f=gi()?hB:uB;gt(Lt,this,Ni.createViewer(Fe(ne({uiConfig:qe(f)},l),{viewerConfig:u}))),this.uid=ee(Lt,this).uid,this.groupUid=ee(Lt,this).groupUid,this.postfix=ee(Lt,this).postfix,ye(jB,this,ece).call(this)}get isVisible(){return ee(xn,this).getIsVisible(ee(Lt,this))}get isBoundContainer(){return ee(xn,this).getIsBoundContainer(ee(Lt,this))}get currentDocument(){return ee(xn,this).getCurrentDocument(ee(Lt,this))}bindContainer(l){ee(xn,this).bindContainer(ee(Lt,this),l,`${Hs}.bindContainer`)}unbindContainer(){ee(xn,this).unbindContainer(ee(Lt,this))}show(){ee(xn,this).show(ee(Lt,this))}hide(){ee(xn,this).hide(ee(Lt,this))}getUiConfig(){return ee(xn,this).getUiConfig(ee(Lt,this))}updateUiConfig(l){return ee(xn,this).updateUiConfig(ee(Lt,this),l,"perspectiveViewer",`${Hs}.updateUiConfig`)}openDocument(l){ee(xn,this).openDocument(l,this.uid,`${Hs}.openDocument`)}closeDocument(){return ee(xn,this).closeDocument(ee(Lt,this),`${Hs}.closeDocument`)}getStyle(l){return ee(xn,this).getStyle(ee(Lt,this),"perspective",l,VB,`${Hs}.getStyle`)}updateStyle(l,u){const f=`${Hs}.updateStyle`;return ee(xn,this).updateStyle(ee(Lt,this),l,u,VB,f)}setQuadSelection(l){const u=`${Hs}.setQuadSelection`,f="quad";if(it(l,1,u,f)||!BB(l,1,u,f)||!On(ee(Lt,this),1)||Vr(u,void 0,ee(Lt,this),1))return!1;const{width:g,height:m}=ee(Lt,this).getRealPixelSize();return!UB(l,1,g,m)&&ee(Lt,this).setQuadBox(l)}getQuadSelection(){const l=`${Hs}.getQuadSelection`;return!On(ee(Lt,this),1)||Vr(l,void 0,ee(Lt,this),1)?null:ee(Lt,this).getQuadBox()}resetQuadSelection(l){const u=`${Hs}.resetQuadSelection`;return!(!On(ee(Lt,this),1)||Vr(u,void 0,ee(Lt,this),1)||!Se(l)&&!Pc(l,1,u,"indices",0,ee(Lt,this).getPageCounts()-1))&&ee(Lt,this).resetQuadBox(l)}applyPerspective(l){const u=`${Hs}.applyPerspective`,f="quad";it(l,0,u,f),BB(l,0,u,f),On(ee(Lt,this),0),Vr(u,void 0,ee(Lt,this),0);const{width:g,height:m}=ee(Lt,this).getRealPixelSize();return UB(l,0,g,m),ee(Lt,this).perspectivePage(l)}rotate(l,u){const f=`${Hs}.rotate`;return ee(xn,this).rotate(ee(Lt,this),l,u,f)}saveOperations(){return ee(xn,this).saveOperation(ee(Lt,this))}goToPage(l){const u=`${Hs}.goToPage`;return ee(xn,this).gotoPage(ee(Lt,this),l,u)}indexToUid(l){const u=`${Hs}.indexToUid`;return ee(xn,this).indexToUid(ee(Lt,this),l,u)}uidToIndex(l){const u=`${Hs}.uidToIndex`;return ee(xn,this).uidToIndex(ee(Lt,this),l,u)}getCurrentPageUid(){return ee(xn,this).getCurrentPageUid(ee(Lt,this))}getCurrentPageIndex(){return ee(xn,this).getCurrentPageIndex(ee(Lt,this))}getPageCount(){return ee(xn,this).getPageCount(ee(Lt,this))}on(l,u){ee(xn,this).on(ee(Lt,this),`${Hs}.on`,l,u)}off(l,u){ee(xn,this).off(ee(Lt,this),`${Hs}.off`,l,u)}destroy(){ee(xn,this).destroy(ee(Lt,this))}},get lastError(){return fe.getLastError()},clearLastError(){fe.lastError=void 0},Experiments:{get(p,l){switch(p){case"WasmEnv":return Ke;case"ImageProcess":return new wne;case"FileParser.Options":return Ni.getFileParserDefaultOptions(l);default:return}},set(p,l){switch(p){case"FileParser.Options":return Ni.setFileParserDefaultOptions(l.type,l.options);case"ClearExternalHandler":return Ni.clearExternalHandler(l.type);default:return}}},addFonts:p=>Q(function*(){const l="DDV.addFonts";if(!it(p,2,l,"fonts")&&!function(u,f,g,m,v){const y=Te.formatError({isValid:Xt(u)});if(y)return Te.output(2,g,m,void 0,y);const x=[];return u.forEach((w,C)=>{const _=Te.formatDetails(tt("Array","font",`[${C}]`,!0),er(w));x.push(..._)}),!!x.length&&Te.output(2,g,m,x)}(p,0,l,"fonts"))try{for(let u=0;u<p.length;u++){const f=p[u],g=new S9,m=yield g.getFontInfo(f).catch(v=>{throw g.terminate(),v});g.terminate();for(let v=0;v<m.fontInfo.length;v++){const y=m.fontInfo[v];mD.includes(y.family)||new FontFace(y.family,m.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then(w=>{document.fonts.add(w),mD.push(y.family),Ni.getViewers().forEach(C=>{C.addFontToUi(y.family),C.context.render()})}),k3.addPdfFont(`${y.family}${y.isBold?"Blob":""}${y.isItalic?"Italic":""}`,m.srcBuffer)}}}catch(u){return fe.reject(fe.PARAM_INVALID,l,"fonts")}})(),getDefaultUiConfig(p,l){const u="DDV.getDefaultUiConfig",f="viewerType";if(it(p,1,f,u)||!xi(p,1,u,f)||!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(p)&&!Te.output(1,"DDV.getDefaultUiConfig","viewerType",void 0,fe.PARAM_NOT_SUPPORT))return null;let g=null;return gi()?(g={editViewer:eD,perspectiveViewer:hB,captureViewer:cB,browseViewer:aw}[p],"editViewer"===p&&null!=l&&l.includeAnnotationSet&&(g=fB)):(g={editViewer:tD,perspectiveViewer:uB,captureViewer:dB,browseViewer:aw}[p],"editViewer"===p&&null!=l&&l.includeAnnotationSet&&(g=iD)),qe(g)},setProcessingHandler(p,l){const u="DDV.setProcessingHandler",g="handler";switch(it(p,0,u,"type"),it(l,0,u,g),function(v,y,x,w){const C=Te.formatError(mn.isHandlerTypeValid(v));C&&Te.output(0,"DDV.setProcessingHandler","type",void 0,C)}(p),p){case"documentBoundariesDetect":("function"!=typeof(m=l).detect||"function"!=typeof m.destroy)&&Te.error(u,g);break;case"imageFilter":"function"==typeof(v=l).querySupported&&"defaultFilterType"in v&&"function"==typeof v.applyFilter&&"function"==typeof v.destroy||Te.error(u,g)}var v,m;try{switch(p){case"documentBoundariesDetect":Ni.setDetectHandler(p,l);break;case"imageFilter":Ni.setImageFilterHandler(l)}}catch(v){fe.throw(v,u)}},setFileParser(p,l){Ni.setFileParser(p,l)},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=nU,this.Core.license="",Ni.unload(),Ni.onUnload.emit(),RB.clear()},on(p,l){const u="DDV.on";if(it(p,1,u,"eventName")||it(l,1,u,"listener")||!xi(p,1,u,"eventName",!1)||!El(l,u,"listener",1))return;const f={error:"error",warning:"warning",verbose:"verbose"}[p];f?fe.on(f,l):fe.throw(fe.PARAM_NOT_SUPPORT,u,"eventName")},off(p,l){const u="DDV.off";if(it(p,1,u,"eventName")||!xi(p,1,u,"eventName",!1)||!Se(l)&&!El(l,u,"listener",1))return;const f={error:"error",warning:"warning",verbose:"verbose"}[p];f?fe.off(f,l):fe.throw(fe.PARAM_NOT_SUPPORT,u,"eventName")},EnumImageDataType:Ri,EnumConvertMode:ir,EnumDocumentDetectionStatus:Ns,EnumImageFilterType:gD,EnumPDFCompressionType:vc,EnumPDFPageType:En,EnumTIFFCompressionType:mc,EnumStampIcon:Jt,EnumLineEnding:xs,EnumAnnotationRenderMode:pl,annotationManager:kB};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=Rc;let oce=(()=>{class p{constructor(){this.showDiv=!1}getShowDiv(){return this.showDiv}setShowDiv(u){this.showDiv=u}toggleShowDiv(){this.showDiv=!this.showDiv}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=wi({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const ace=function(){return["/barcode-reader"]};function lce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,ace)),Tn(1),da("> ",u.name," ")}}const cce=function(){return["/barcode-scanner"]};function hce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,cce)),Tn(1),da("> ",u.name," ")}}const dce=function(){return["/file-detection"]};function uce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,dce)),Tn(1),da("> ",u.name," ")}}const fce=function(){return["/camera-detection"]};function pce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,fce)),Tn(1),da("> ",u.name," ")}}const gce=function(){return["/mrz-reader"]};function mce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,gce)),Tn(1),da("> ",u.name," ")}}const vce=function(){return["/mrz-scanner"]};function yce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,vce)),Tn(1),da("> ",u.name," ")}}const xce=function(){return["/document-viewer"]};function wce(p,l){if(1&p&&(xt(0,"a",6),Vi(1),ht()),2&p){const u=Xa().$implicit;Qi("title",u.name+" details")("routerLink",jl(3,xce)),Tn(1),da("> ",u.name," ")}}function Cce(p,l){if(1&p&&(xt(0,"p"),Vi(1),ht()),2&p){const u=Xa().$implicit;Tn(1),da("Description: ",u.description,"")}}function bce(p,l){if(1&p&&(xt(0,"div")(1,"h3")(2,"div"),Zr(3,lce,2,4,"ng-template",5),ht(),xt(4,"div"),Zr(5,hce,2,4,"ng-template",5),ht(),xt(6,"div"),Zr(7,uce,2,4,"ng-template",5),ht(),xt(8,"div"),Zr(9,pce,2,4,"ng-template",5),ht(),xt(10,"div"),Zr(11,mce,2,4,"ng-template",5),ht(),xt(12,"div"),Zr(13,yce,2,4,"ng-template",5),ht(),xt(14,"div"),Zr(15,wce,2,4,"ng-template",5),ht()(),Zr(16,Cce,2,1,"p",3),ht()),2&p){const u=l.$implicit;Tn(3),Qi("ngIf","reader"===u.id),Tn(2),Qi("ngIf","scanner"===u.id),Tn(2),Qi("ngIf","file-detection"===u.id),Tn(2),Qi("ngIf","camera-detection"===u.id),Tn(2),Qi("ngIf","mrz-reader"===u.id),Tn(2),Qi("ngIf","mrz-scanner"===u.id),Tn(2),Qi("ngIf","document-viewer"===u.id),Tn(1),Qi("ngIf",u.description)}}function _ce(p,l){if(1&p&&(xt(0,"div")(1,"h2"),Vi(2,"Examples"),ht(),Zr(3,bce,17,8,"div",4),ht()),2&p){const u=Xa();Tn(3),Qi("ngForOf",u.products)}}let Sce=(()=>{class p{constructor(u){this.sharedService=u,this.products=ZK,this.inputText="",this.processedText="",this.placeholderText="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ=="}activate(){var u=this;return Q(function*(){u.processedText=u.inputText.toUpperCase(),Gi.engineResourcePaths={std:co("assets/dynamsoft-capture-vision-std/"),dip:co("assets/dynamsoft-image-processing/"),core:co("assets/dynamsoft-core/"),license:co("assets/dynamsoft-license/"),cvr:co("assets/dynamsoft-capture-vision-router/"),dbr:co("assets/dynamsoft-barcode-reader/"),dce:co("assets/dynamsoft-camera-enhancer/"),ddn:co("assets/dynamsoft-document-normalizer/"),dlr:co("assets/dynamsoft-label-recognizer/"),dcp:co("assets/dynamsoft-code-parser/"),dnn:co("assets/dynamsoft-capture-vision-dnn/"),dlrData:co("assets/dynamsoft-label-recognizer-data/")};try{let f=""===u.inputText?u.placeholderText:u.inputText;yield tn.initLicense(f,!0),Rc.Core.engineResourcePath=co("assets/dynamsoft-document-viewer/engine/"),yield Rc.Core.init(),Rc.setProcessingHandler("imageFilter",new Rc.ImageFilter),u.toggleDivVisibility()}catch(f){alert(f)}})()}toggleDivVisibility(){this.sharedService.toggleShowDiv()}get showDiv(){return this.sharedService.getShowDiv()}}return p.\u0275fac=function(u){return new(u||p)(je(oce))},p.\u0275cmp=Gr({type:p,selectors:[["app-product-list"]],decls:9,vars:3,consts:[["href","https://www.dynamsoft.com/customer/license/trialLicense","target","_blank"],["type","text",3,"ngModel","placeholder","ngModelChange"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngIf"],[3,"title","routerLink"]],template:function(u,f){1&u&&(xt(0,"div")(1,"div"),Vi(2," Get a License key from "),xt(3,"a",0),Vi(4,"here"),ht()(),xt(5,"input",1),ki("ngModelChange",function(m){return f.inputText=m}),ht(),xt(6,"button",2),ki("click",function(){return f.activate()}),Vi(7,"Activate SDK"),ht()(),Zr(8,_ce,4,1,"div",3)),2&u&&(Tn(5),Qi("ngModel",f.inputText)("placeholder",f.placeholderText),Tn(3),Qi("ngIf",f.showDiv))},directives:[Ey,kR,Z2,wy,V8,em],styles:[""]}),p})();class Vp{initOverlay(l){this.overlay=l,this.context=this.overlay.getContext("2d")}updateOverlay(l,u){this.overlay&&(this.overlay.width=l,this.overlay.height=u,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(l,u){if(this.context){let f=l.points;this.globalPoints=f,this.context.beginPath(),this.context.moveTo(f[0].x,f[0].y),this.context.lineTo(f[1].x,f[1].y),this.context.lineTo(f[2].x,f[2].y),this.context.lineTo(f[3].x,f[3].y),this.context.lineTo(f[0].x,f[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let g=[f[0].x,f[1].x,f[2].x,f[3].x],m=[f[0].y,f[1].y,f[2].y,f[3].y];g.sort(function(x,w){return x-w}),m.sort(function(x,w){return w-x}),this.context.fillText(u,g[0],m[0]+50)}}setPoints(l){this.globalPoints=l,this.overlay.addEventListener("mousedown",u=>this.updatePoint(u,this.context,this.overlay)),this.overlay.addEventListener("touchstart",u=>this.updatePoint(u,this.context,this.overlay)),this.drawQuad(this.context,this.overlay)}updatePoint(l,u,f){if(!this.globalPoints)return;let g=this.globalPoints;function m(w){let C=f.getBoundingClientRect(),_=f.clientWidth/f.width,T=f.clientHeight/f.height,M=w instanceof MouseEvent?w.clientX:w.touches[0].clientX,L=w instanceof MouseEvent?w.clientY:w.touches[0].clientY;return _<T?(M-=C.left,L=L-C.top-(f.clientHeight-f.height*_)/2,M/=_,L/=_):(M=M-C.left-(f.clientWidth-f.width*T)/2,L-=C.top,M/=T,L/=T),{x:Math.round(M),y:Math.round(L)}}let y=m(l),x=this;for(let w=0;w<g.length;w++)if(Math.abs(g[w].x-y.x)<10&&Math.abs(g[w].y-y.y)<10){let C=function(T){y=m(T),g[w].x=y.x,g[w].y=y.y,x.drawQuad(u,f)},_=function(){f.removeEventListener("mousemove",C),f.removeEventListener("mouseup",_),f.removeEventListener("touchmove",C),f.removeEventListener("touchend",_)};f.addEventListener("mousemove",C),f.addEventListener("mouseup",_),f.addEventListener("touchmove",C),f.addEventListener("touchend",_);break}}drawQuad(l,u){let f=this.globalPoints;if(f&&!(f.length<4)){l.clearRect(0,0,u.width,u.height),l.strokeStyle="#00ff00",l.lineWidth=2;for(let g=0;g<f.length;g++)l.beginPath(),l.arc(f[g].x,f[g].y,5,0,2*Math.PI),l.stroke();l.beginPath(),l.moveTo(f[0].x,f[0].y),l.lineTo(f[1].x,f[1].y),l.lineTo(f[2].x,f[2].y),l.lineTo(f[3].x,f[3].y),l.lineTo(f[0].x,f[0].y),l.stroke()}}}let Ece=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new Vp}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){u.cvr=yield _i.createInstance(),u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}onChange(u){let g=u.currentTarget.files;if(g){let m=g.item(0);if(m){let v=new FileReader;v.onload=y=>{let x=document.getElementById("image");if(x){x.src=y.target.result;const w=new Image;w.onload=C=>{this.overlayManager.updateOverlay(w.width,w.height),this.cvr&&this.cvr.capture(m,"ReadBarcodes_Balance").then(_=>{console.log(_);let T=[],M=document.getElementById("result");try{let N,V=_.items;if(V.length>0){for(var L=0;L<V.length;++L){if(V[L].type!==en.CRIT_BARCODE)continue;let H=V[L];T.push(H.text),N=H.location,console.log(N),this.overlayManager.drawOverlay(N,H.text)}M&&(M.innerHTML=T.join(", "))}else M&&(M.innerHTML=T.join(", "))}catch(N){alert(N)}})},w.src=y.target.result}},v.readAsDataURL(m)}}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-barcode-reader"]],decls:6,vars:0,consts:[["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(u,f){1&u&&(xt(0,"input",0),ki("change",function(m){return f.onChange(m)}),ht(),xt(1,"div"),Bn(2,"a",1),ht(),xt(3,"div",2),Bn(4,"img",3)(5,"canvas",4),ht())},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),p})(),Tce=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new Vp}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return Q(function*(){var f,g,m,v;const y=yield An.createInstance();u.cameraEnhancer=yield jt.createInstance(y),u.isLoaded=!0;let x=document.getElementById("videoContainer");if(x){x.append(y.getUIElement()),null===(g=null===(f=y.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=y.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let w=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(w),u.cvr=yield _i.createInstance(),u.isDestroyed||(u.cvr.setInput(u.cameraEnhancer),u.cvr.addResultReceiver({onCapturedResultReceived:C=>{u.overlayManager.clearOverlay();let _=[],T=document.getElementById("result");try{let L,N=C.items;if(N.length>0){for(var M=0;M<N.length;++M){if(N[M].type!==en.CRIT_BARCODE)continue;let V=N[M];_.push(V.text),L=V.location,console.log(L),u.overlayManager.drawOverlay(L,V.text)}T&&(T.innerHTML=_.join(", "))}}catch(L){alert(L)}}}),u.cvr.addResultReceiver({onDecodedBarcodesReceived:C=>{!C.barcodeResultItems.length||console.log(C)}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield u.cvr.startCapturing("ReadSingleBarcode"),u.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var u=this;return Q(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(f),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-barcode-scanner"]],decls:8,vars:0,consts:[[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"]],template:function(u,f){1&u&&(xt(0,"div",0)(1,"label",1),Vi(2,"Video source: "),ht(),xt(3,"select",2),ki("change",function(){return f.openCamera()}),ht()(),xt(4,"div",3),Bn(5,"div",4)(6,"canvas",5),ht(),Bn(7,"div",6))},styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),p})(),Dce=(()=>{class p{constructor(){this.isLoaded=!1,this.points=[],this.overlayManager=new Vp}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){u.cvr=yield _i.createInstance(),u.isLoaded=!0})()}onRadioChange(u){var f=this;if(!this.cvr)return;let g=u.target,m=rl.ICM_COLOUR;"binary"===g.value?m=rl.ICM_BINARY:"grayscale"===g.value?m=rl.ICM_GRAYSCALE:"color"===g.value&&(m=rl.ICM_COLOUR);let v=this.cvr;Q(function*(){let y=yield v.getSimplifiedSettings("NormalizeDocument_Default");y.documentSettings.colourMode=m,yield f.cvr.updateSettings("NormalizeDocument_Default",y),f.normalize(f.currentFile,f.points)})()}normalize(u,f){var g=this;return Q(function*(){if(g.cvr){let m=yield g.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=f,m.roiMeasuredInPercentage=!1,yield g.cvr.updateSettings("NormalizeDocument_Default",m),g.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let y=v.items[0];document.getElementById("normalizedImage").src=y.toImage("image/jpeg").src})}})()}onChange(u){var f=this;let m=u.currentTarget.files;if(m){let v=m.item(0);if(v){this.currentFile=v;let y=new FileReader;y.onload=x=>{let w=document.getElementById("image");if(w){w.src=x.target.result;const C=new Image;C.onload=function(){var _=Q(function*(T){if(f.overlayManager.updateOverlay(C.width,C.height),f.cvr){let M=yield f.cvr.capture(v,"DetectDocumentBoundaries_Default");M.items.length>0&&(f.points=M.items[0].location.points,f.overlayManager.setPoints(f.points))}});return function(T){return _.apply(this,arguments)}}(),C.src=x.target.result}},y.readAsDataURL(v)}}}rectify(){var u=this;return Q(function*(){yield u.normalize(u.currentFile,u.points)})()}save(){return Q(function*(){let f=document.getElementById("normalizedImage").src;const g=document.createElement("a");g.href=f,g.download=Date.now()+"",document.body.appendChild(g),g.click(),document.body.removeChild(g)})()}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-file-detection"]],decls:24,vars:2,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["type","file","title","file","id","file","accept","image/*",3,"change"],[3,"click"],[1,"container"],["id","imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","resultview",1,"imageview"],["id","normalizedImage","alt",""]],template:function(u,f){1&u&&(xt(0,"span",0),Vi(1,"Loading Library..."),ht(),Bn(2,"br"),xt(3,"div",1)(4,"label",2)(5,"input",3),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(6,"Black & White "),ht(),xt(7,"label",4)(8,"input",5),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(9," Grayscale "),ht(),xt(10,"label",6)(11,"input",7),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(12," Color "),ht()(),xt(13,"input",8),ki("change",function(m){return f.onChange(m)}),ht(),xt(14,"button",9),ki("click",function(){return f.rectify()}),Vi(15,"Rectify"),ht(),xt(16,"button",9),ki("click",function(){return f.save()}),Vi(17,"Save"),ht(),xt(18,"div",10)(19,"div",11),Bn(20,"img",12)(21,"canvas",13),ht(),xt(22,"div",14),Bn(23,"img",15),ht()()),2&u&&(Qi("hidden",f.isLoaded),Tn(11),Qi("checked",!0))},styles:["#imageview[_ngcontent-%COMP%]{position:relative;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}.container[_ngcontent-%COMP%]{align-items:center;border:3px solid rgb(255,255,255)}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();const yD="VideoCapture Component Destroyed";let Ace=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isNormalized=!0,this.captured=[],this.isDestroyed=!1,this.points=[],this.isDetecting=!1,this.overlayManager=new Vp}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){var f,g,m,v;u.cameraView=yield An.createInstance(),u.cameraEnhancer=yield jt.createInstance(u.cameraView),u.isLoaded=!0;let y=document.getElementById("videoContainer");if(y){y.append(u.cameraView.getUIElement()),null===(g=null===(f=u.cameraView.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=u.cameraView.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let x=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(x),u.cvr=yield _i.createInstance(),u.isDestroyed)throw Error(yD);u.cvr.setInput(u.cameraEnhancer);let w=yield u.cvr.getSimplifiedSettings("DetectDocumentBoundaries_Default");if(w.capturedResultItemTypes|=en.CRIT_ORIGINAL_IMAGE,yield u.cvr.updateSettings("DetectDocumentBoundaries_Default",w),u.cvr.addResultReceiver({onCapturedResultReceived:C=>{u.overlayManager.clearOverlay();try{let M=C.items;if(M.length>0)for(var T=0;T<M.length;++T)if(M[T].type===en.CRIT_DETECTED_QUAD)u.detectedResult=M[T],u.points=u.detectedResult.location.points,u.overlayManager.drawOverlay(u.detectedResult.location,"");else if(M[T].type===en.CRIT_ORIGINAL_IMAGE&&!u.isNormalized){u.isNormalized=!0;let L=M[T];u.currentData=L.imageData,u.normalize(L.imageData,u.points),u.toggleDetection();break}}catch(M){throw M}}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed||u.isDestroyed)throw Error(yD)}})()}openCamera(){var u=this;return Q(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(u.cameraInfo[f]),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}onRadioChange(u){var f=this;if(!this.cvr)return;let g=u.target,m=rl.ICM_COLOUR;"binary"===g.value?m=rl.ICM_BINARY:"grayscale"===g.value?m=rl.ICM_GRAYSCALE:"color"===g.value&&(m=rl.ICM_COLOUR);let v=this.cvr;Q(function*(){let y=yield v.getSimplifiedSettings("NormalizeDocument_Default");y.documentSettings.colourMode=m,yield f.cvr.updateSettings("NormalizeDocument_Default",y),f.normalize(f.currentData,f.points)})()}normalize(u,f){var g=this;return Q(function*(){if(g.cvr){let m=yield g.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=f,m.roiMeasuredInPercentage=!1,yield g.cvr.updateSettings("NormalizeDocument_Default",m),g.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let y=v.items[0],x=document.getElementById("normalizedImage");x.width=y.imageData.width,x.height=y.imageData.height;const w=x.getContext("2d");null==w||w.drawImage(y.toCanvas(),0,0)})}})()}captureDocument(){this.isNormalized=!1}toggleDetection(){var u,f,g;this.isDetecting?(this.isDetecting=!1,null===(u=this.cvr)||void 0===u||u.stopCapturing(),null===(f=this.cameraView)||void 0===f||f.clearAllInnerDrawingItems(),this.overlayManager.clearOverlay(),document.getElementById("detectButton").textContent="Start Detection"):(this.isDetecting=!0,document.getElementById("detectButton").textContent="Stop Detection",null===(g=this.cvr)||void 0===g||g.startCapturing("DetectDocumentBoundaries_Default"))}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-camera-detection"]],decls:28,vars:2,consts:[["id","document-scanner"],["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["for","videoSource"],["id","videoSource",3,"change"],["id","detectButton",3,"click"],["id","captureButton",3,"click"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],[1,"container"],["id","resultview"],["id","normalizedImage"]],template:function(u,f){1&u&&(xt(0,"div",0)(1,"span",1),Vi(2,"Loading Library..."),ht(),Bn(3,"br"),xt(4,"div",2)(5,"label",3)(6,"input",4),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(7,"Black & White "),ht(),xt(8,"label",5)(9,"input",6),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(10," Grayscale "),ht(),xt(11,"label",7)(12,"input",8),ki("change",function(m){return f.onRadioChange(m)}),ht(),Vi(13," Color "),ht()(),xt(14,"div")(15,"label",9),Vi(16,"Video Source: "),xt(17,"select",10),ki("change",function(){return f.openCamera()}),ht()(),xt(18,"button",11),ki("click",function(){return f.toggleDetection()}),Vi(19,"Start Detection"),ht(),xt(20,"button",12),ki("click",function(){return f.captureDocument()}),Vi(21,"Capture Document"),ht()(),xt(22,"div",13),Bn(23,"div",14)(24,"canvas",15),ht(),xt(25,"div",16)(26,"div",17),Bn(27,"canvas",18),ht()()()),2&u&&(Tn(1),Qi("hidden",f.isLoaded),Tn(11),Qi("checked",!0))},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}#normalizedImage[_ngcontent-%COMP%]{width:20vw;top:60%;position:absolute;z-index:2}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();function Ice(p,l){1&p&&(xt(0,"div",8),Bn(1,"div",9),ht())}let Pce=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new Vp}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){try{yield jo.loadSpec("MRTD_TD1_ID"),yield jo.loadSpec("MRTD_TD2_FRENCH_ID"),yield jo.loadSpec("MRTD_TD2_ID"),yield jo.loadSpec("MRTD_TD2_VISA"),yield jo.loadSpec("MRTD_TD3_PASSPORT"),yield jo.loadSpec("MRTD_TD3_VISA"),yield Fm.loadRecognitionData("MRZ"),u.cvr=yield _i.createInstance(),u.parser=yield $1.createInstance();let f=yield u.cvr.initSettings("assets/template.json");console.log(f)}catch(f){alert(f)}u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(f){}}onChange(u){var f=this;let g=this.parser;const m=u.currentTarget;let v=document.getElementById("detection_result"),y=m.files;if(y){let x=y.item(0);if(x){let w=new FileReader;w.onload=C=>{let _=document.getElementById("image");if(_){_.src=C.target.result;const T=new Image;v.value="",T.onload=M=>{this.overlayManager.updateOverlay(T.width,T.height),this.cvr&&this.cvr.capture(x,"ReadMRZ").then(function(){var L=Q(function*(N){let V=[];try{let G=N.items;if(G.length>0)for(var H=0;H<G.length;++H){if(G[H].type!==en.CRIT_TEXT_LINE)continue;let z=G[H];f.overlayManager.drawOverlay(z.location,""),V.push(z.text),v.value=V.join("")+"\n";let te=yield null==g?void 0:g.parse(z.text);v.value+=JSON.stringify(Zk(te))+"\n";break}}catch(G){alert(G)}0===V.length&&(v.value="No MRZ detected.")});return function(N){return L.apply(this,arguments)}}())},T.src=C.target.result}},w.readAsDataURL(x)}}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-mrz-reader"]],decls:10,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["type","file","title","file","id","file","accept","image/*",3,"change"],["id","file_container",1,"container"],[1,"row"],["id","imageview",1,"imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","detection_result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(u,f){1&u&&(Zr(0,Ice,2,0,"div",0),xt(1,"div")(2,"input",1),ki("change",function(m){return f.onChange(m)}),ht()(),xt(3,"div",2)(4,"div",3)(5,"div",4),Bn(6,"img",5)(7,"canvas",6),ht()()(),xt(8,"div"),Bn(9,"textarea",7),ht()),2&u&&Qi("ngIf",!f.isLoaded)},directives:[wy],styles:[".imageview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}.imageview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%;height:100%;object-fit:contain}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loading-indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #fff;border-radius:50%;animation:spin 1s linear infinite;background:linear-gradient(to right,#FF0000 0%,#FF8000 17%,#FFFF00 33%,#00FF00 50%,#00FFFF 67%,#0080FF 83%,#0000FF 100%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),p})();function Rce(p,l){1&p&&(xt(0,"div",9),Bn(1,"div",10),ht())}const Mce=[{path:"",component:Sce},{path:"barcode-reader",component:Ece},{path:"barcode-scanner",component:Tce},{path:"file-detection",component:Dce},{path:"camera-detection",component:Ace},{path:"mrz-reader",component:Pce},{path:"mrz-scanner",component:(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new Vp}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Q(function*(){yield jo.loadSpec("MRTD_TD1_ID"),yield jo.loadSpec("MRTD_TD2_FRENCH_ID"),yield jo.loadSpec("MRTD_TD2_ID"),yield jo.loadSpec("MRTD_TD2_VISA"),yield jo.loadSpec("MRTD_TD3_PASSPORT"),yield jo.loadSpec("MRTD_TD3_VISA"),yield Fm.loadRecognitionData("MRZ"),u.cvr=yield _i.createInstance(),u.parser=yield $1.createInstance();let f=yield u.cvr.initSettings("assets/template.json");console.log(f),yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,f;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return Q(function*(){var f,g,m,v,y,x,w;const C=yield An.createInstance();u.cameraEnhancer=yield jt.createInstance(C);let _=document.getElementById("videoContainer");if(_){_.append(C.getUIElement()),null===(g=null===(f=C.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(v=null===(m=C.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let T=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(T),u.isDestroyed||(null===(y=u.cvr)||void 0===y||y.setInput(u.cameraEnhancer),null===(x=u.cvr)||void 0===x||x.addResultReceiver({onCapturedResultReceived:(M=Q(function*(L){var N;u.overlayManager.clearOverlay();let V=[],H=document.getElementById("result");try{let z,q=L.items;if(q.length>0)for(var G=0;G<q.length;++G){if(q[G].type!==en.CRIT_TEXT_LINE)continue;let te=q[G];V.push(te.text),z=te.location,u.overlayManager.drawOverlay(z,"");let se=yield null===(N=u.parser)||void 0===N?void 0:N.parse(te.text);H&&(H.innerHTML=JSON.stringify(Zk(se))+"\n");break}}catch(z){alert(z)}}),function(N){return M.apply(this,arguments)})}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield null===(w=u.cvr)||void 0===w?void 0:w.startCapturing("ReadMRZ"),u.isDestroyed))throw Error("VideoCapture Component Destroyed");u.isLoaded=!0}var M})()}openCamera(){var u=this;return Q(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let f=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(f),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var f=0;f<u.length;++f){var g=u[f],m=document.createElement("option");m.value=g.deviceId,m.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(m)}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-mrz-scanner"]],decls:11,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],[1,"container"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(u,f){1&u&&(Zr(0,Rce,2,0,"div",0),xt(1,"div",1)(2,"label",2),Vi(3,"Video source: "),ht(),xt(4,"select",3),ki("change",function(){return f.openCamera()}),ht()(),xt(5,"div",4)(6,"div",5),Bn(7,"div",6)(8,"canvas",7),ht()(),xt(9,"div"),Bn(10,"textarea",8),ht()),2&u&&Qi("ngIf",!f.isLoaded)},directives:[wy],styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loading-indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #fff;border-radius:50%;animation:spin 1s linear infinite;background:linear-gradient(to right,#FF0000 0%,#FF8000 17%,#FFFF00 33%,#00FF00 50%,#00FFFF 67%,#0080FF 83%,#0000FF 100%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),p})()},{path:"document-viewer",component:(()=>{class p{constructor(){}ngOnInit(){const u=Rc.Elements.getTooltip();u.DisplayMode="Display Mode",u.AnnotationSet="Add Annotation",Rc.Elements.setTooltip(u);let f=Rc.getDefaultUiConfig("editViewer",{includeAnnotationSet:!0});this.editViewer=new Rc.EditViewer({container:"document_container",uiConfig:f})}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-document-viewer"]],decls:1,vars:0,consts:[["id","document_container"]],template:function(u,f){1&u&&Bn(0,"div",0)},styles:["#document_container[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;left:0}"]}),p})()}];let kce=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p}),p.\u0275inj=ta({imports:[[y7.forRoot(Mce)],y7]}),p})();const Oce=function(){return["/"]};let Lce=(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(u,f){1&u&&(xt(0,"a",0)(1,"h1"),Vi(2,"Dynamsoft Capture Vision SDK"),ht()()),2&u&&Qi("routerLink",jl(1,Oce))},directives:[em],styles:[""]}),p})(),Fce=(()=>{class p{constructor(){this.title="angular-barcode-mrz-document-scanner"}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=Gr({type:p,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(u,f){1&u&&(Bn(0,"app-top-bar"),xt(1,"div",0),Bn(2,"router-outlet"),ht())},directives:[Lce,v_],styles:[""]}),p})(),Nce=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=Ua({type:p,bootstrap:[Fce]}),p.\u0275inj=ta({providers:[],imports:[[xZ,kce,FJ]]}),p})();(function tX(){m8=!1})(),vZ().bootstrapModule(Nce).catch(p=>console.error(p))}},Ft=>{Ft(Ft.s=58)}]);