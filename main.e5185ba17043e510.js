"use strict";(self.webpackChunkangular_barcode_qr_code_scanner=self.webpackChunkangular_barcode_qr_code_scanner||[]).push([[179],{727:()=>{function Bt(f){return"function"==typeof f}function Za(f){const u=f(g=>{Error.call(g),g.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}const $c=Za(f=>function(u){f(this),this.message=u?`${u.length} errors occurred during unsubscription:\n${u.map((g,p)=>`${p+1}) ${g.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=u});function Ka(f,l){if(f){const u=f.indexOf(l);0<=u&&f.splice(u,1)}}class Ci{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:u}=this;if(u)if(this._parentage=null,Array.isArray(u))for(const m of u)m.remove(this);else u.remove(this);const{initialTeardown:g}=this;if(Bt(g))try{g()}catch(m){l=m instanceof $c?m.errors:[m]}const{_finalizers:p}=this;if(p){this._finalizers=null;for(const m of p)try{Z_(m)}catch(v){l=null!=l?l:[],v instanceof $c?l=[...l,...v.errors]:l.push(v)}}if(l)throw new $c(l)}}add(l){var u;if(l&&l!==this)if(this.closed)Z_(l);else{if(l instanceof Ci){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=null!==(u=this._finalizers)&&void 0!==u?u:[]).push(l)}}_hasParent(l){const{_parentage:u}=this;return u===l||Array.isArray(u)&&u.includes(l)}_addParent(l){const{_parentage:u}=this;this._parentage=Array.isArray(u)?(u.push(l),u):u?[u,l]:l}_removeParent(l){const{_parentage:u}=this;u===l?this._parentage=null:Array.isArray(u)&&Ka(u,l)}remove(l){const{_finalizers:u}=this;u&&Ka(u,l),l instanceof Ci&&l._removeParent(this)}}Ci.EMPTY=(()=>{const f=new Ci;return f.closed=!0,f})();const X_=Ci.EMPTY;function q_(f){return f instanceof Ci||f&&"closed"in f&&Bt(f.remove)&&Bt(f.add)&&Bt(f.unsubscribe)}function Z_(f){Bt(f)?f():f.unsubscribe()}const js={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Xc={setTimeout(f,l,...u){const{delegate:g}=Xc;return(null==g?void 0:g.setTimeout)?g.setTimeout(f,l,...u):setTimeout(f,l,...u)},clearTimeout(f){const{delegate:l}=Xc;return((null==l?void 0:l.clearTimeout)||clearTimeout)(f)},delegate:void 0};function K_(f){Xc.setTimeout(()=>{const{onUnhandledError:l}=js;if(!l)throw f;l(f)})}function Q_(){}const _T=Nd("C",void 0,void 0);function Nd(f,l,u){return{kind:f,value:l,error:u}}let Us=null;function qc(f){if(js.useDeprecatedSynchronousErrorHandling){const l=!Us;if(l&&(Us={errorThrown:!1,error:null}),f(),l){const{errorThrown:u,error:g}=Us;if(Us=null,u)throw g}}else f()}class kd extends Ci{constructor(l){super(),this.isStopped=!1,l?(this.destination=l,q_(l)&&l.add(this)):this.destination=DT}static create(l,u,g){return new Zc(l,u,g)}next(l){this.isStopped?Vd(function yT(f){return Nd("N",f,void 0)}(l),this):this._next(l)}error(l){this.isStopped?Vd(function vT(f){return Nd("E",void 0,f)}(l),this):(this.isStopped=!0,this._error(l))}complete(){this.isStopped?Vd(_T,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(l){this.destination.next(l)}_error(l){try{this.destination.error(l)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const wT=Function.prototype.bind;function Bd(f,l){return wT.call(f,l)}class ET{constructor(l){this.partialObserver=l}next(l){const{partialObserver:u}=this;if(u.next)try{u.next(l)}catch(g){Kc(g)}}error(l){const{partialObserver:u}=this;if(u.error)try{u.error(l)}catch(g){Kc(g)}else Kc(l)}complete(){const{partialObserver:l}=this;if(l.complete)try{l.complete()}catch(u){Kc(u)}}}class Zc extends kd{constructor(l,u,g){let p;if(super(),Bt(l)||!l)p={next:null!=l?l:void 0,error:null!=u?u:void 0,complete:null!=g?g:void 0};else{let m;this&&js.useDeprecatedNextContext?(m=Object.create(l),m.unsubscribe=()=>this.unsubscribe(),p={next:l.next&&Bd(l.next,m),error:l.error&&Bd(l.error,m),complete:l.complete&&Bd(l.complete,m)}):p=l}this.destination=new ET(p)}}function Kc(f){js.useDeprecatedSynchronousErrorHandling?function CT(f){js.useDeprecatedSynchronousErrorHandling&&Us&&(Us.errorThrown=!0,Us.error=f)}(f):K_(f)}function Vd(f,l){const{onStoppedNotification:u}=js;u&&Xc.setTimeout(()=>u(f,l))}const DT={closed:!0,next:Q_,error:function bT(f){throw f},complete:Q_},jd="function"==typeof Symbol&&Symbol.observable||"@@observable";function Gs(f){return f}let ln=(()=>{class f{constructor(u){u&&(this._subscribe=u)}lift(u){const g=new f;return g.source=this,g.operator=u,g}subscribe(u,g,p){const m=function IT(f){return f&&f instanceof kd||function ST(f){return f&&Bt(f.next)&&Bt(f.error)&&Bt(f.complete)}(f)&&q_(f)}(u)?u:new Zc(u,g,p);return qc(()=>{const{operator:v,source:C}=this;m.add(v?v.call(m,C):C?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(u){try{return this._subscribe(u)}catch(g){u.error(g)}}forEach(u,g){return new(g=ev(g))((p,m)=>{const v=new Zc({next:C=>{try{u(C)}catch(D){m(D),v.unsubscribe()}},error:m,complete:p});this.subscribe(v)})}_subscribe(u){var g;return null===(g=this.source)||void 0===g?void 0:g.subscribe(u)}[jd](){return this}pipe(...u){return function J_(f){return 0===f.length?Gs:1===f.length?f[0]:function(u){return f.reduce((g,p)=>p(g),u)}}(u)(this)}toPromise(u){return new(u=ev(u))((g,p)=>{let m;this.subscribe(v=>m=v,v=>p(v),()=>g(m))})}}return f.create=l=>new f(l),f})();function ev(f){var l;return null!==(l=null!=f?f:js.Promise)&&void 0!==l?l:Promise}const TT=Za(f=>function(){f(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let xr=(()=>{class f extends ln{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(u){const g=new tv(this,this);return g.operator=u,g}_throwIfClosed(){if(this.closed)throw new TT}next(u){qc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const g of this.currentObservers)g.next(u)}})}error(u){qc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=u;const{observers:g}=this;for(;g.length;)g.shift().error(u)}})}complete(){qc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:u}=this;for(;u.length;)u.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var u;return(null===(u=this.observers)||void 0===u?void 0:u.length)>0}_trySubscribe(u){return this._throwIfClosed(),super._trySubscribe(u)}_subscribe(u){return this._throwIfClosed(),this._checkFinalizedStatuses(u),this._innerSubscribe(u)}_innerSubscribe(u){const{hasError:g,isStopped:p,observers:m}=this;return g||p?X_:(this.currentObservers=null,m.push(u),new Ci(()=>{this.currentObservers=null,Ka(m,u)}))}_checkFinalizedStatuses(u){const{hasError:g,thrownError:p,isStopped:m}=this;g?u.error(p):m&&u.complete()}asObservable(){const u=new ln;return u.source=this,u}}return f.create=(l,u)=>new tv(l,u),f})();class tv extends xr{constructor(l,u){super(),this.destination=l,this.source=u}next(l){var u,g;null===(g=null===(u=this.destination)||void 0===u?void 0:u.next)||void 0===g||g.call(u,l)}error(l){var u,g;null===(g=null===(u=this.destination)||void 0===u?void 0:u.error)||void 0===g||g.call(u,l)}complete(){var l,u;null===(u=null===(l=this.destination)||void 0===l?void 0:l.complete)||void 0===u||u.call(l)}_subscribe(l){var u,g;return null!==(g=null===(u=this.source)||void 0===u?void 0:u.subscribe(l))&&void 0!==g?g:X_}}function nv(f){return Bt(null==f?void 0:f.lift)}function In(f){return l=>{if(nv(l))return l.lift(function(u){try{return f(u,this)}catch(g){this.error(g)}});throw new TypeError("Unable to lift unknown Observable type")}}function En(f,l,u,g,p){return new xT(f,l,u,g,p)}class xT extends kd{constructor(l,u,g,p,m,v){super(l),this.onFinalize=m,this.shouldUnsubscribe=v,this._next=u?function(C){try{u(C)}catch(D){l.error(D)}}:super._next,this._error=p?function(C){try{p(C)}catch(D){l.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=g?function(){try{g()}catch(C){l.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var l;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:u}=this;super.unsubscribe(),!u&&(null===(l=this.onFinalize)||void 0===l||l.call(this))}}}function Vt(f,l){return In((u,g)=>{let p=0;u.subscribe(En(g,m=>{g.next(f.call(l,m,p++))}))})}function Hs(f){return this instanceof Hs?(this.v=f,this):new Hs(f)}function OT(f,l,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p,g=u.apply(f,l||[]),m=[];return p={},v("next"),v("throw"),v("return"),p[Symbol.asyncIterator]=function(){return this},p;function v(B){g[B]&&(p[B]=function(j){return new Promise(function(W,Y){m.push([B,j,W,Y])>1||C(B,j)})})}function C(B,j){try{!function D(B){B.value instanceof Hs?Promise.resolve(B.value.v).then(O,L):N(m[0][2],B)}(g[B](j))}catch(W){N(m[0][3],W)}}function O(B){C("next",B)}function L(B){C("throw",B)}function N(B,j){B(j),m.shift(),m.length&&C(m[0][0],m[0][1])}}function MT(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,l=f[Symbol.asyncIterator];return l?l.call(f):(f=function sv(f){var l="function"==typeof Symbol&&Symbol.iterator,u=l&&f[l],g=0;if(u)return u.call(f);if(f&&"number"==typeof f.length)return{next:function(){return f&&g>=f.length&&(f=void 0),{value:f&&f[g++],done:!f}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}(f),u={},g("next"),g("throw"),g("return"),u[Symbol.asyncIterator]=function(){return this},u);function g(m){u[m]=f[m]&&function(v){return new Promise(function(C,D){!function p(m,v,C,D){Promise.resolve(D).then(function(O){m({value:O,done:C})},v)}(C,D,(v=f[m](v)).done,v.value)})}}}const ov=f=>f&&"number"==typeof f.length&&"function"!=typeof f;function av(f){return Bt(null==f?void 0:f.then)}function lv(f){return Bt(f[jd])}function cv(f){return Symbol.asyncIterator&&Bt(null==f?void 0:f[Symbol.asyncIterator])}function uv(f){return new TypeError(`You provided ${null!==f&&"object"==typeof f?"an invalid object":`'${f}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const hv=function FT(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function dv(f){return Bt(null==f?void 0:f[hv])}function fv(f){return OT(this,arguments,function*(){const u=f.getReader();try{for(;;){const{value:g,done:p}=yield Hs(u.read());if(p)return yield Hs(void 0);yield yield Hs(g)}}finally{u.releaseLock()}})}function gv(f){return Bt(null==f?void 0:f.getReader)}function sr(f){if(f instanceof ln)return f;if(null!=f){if(lv(f))return function PT(f){return new ln(l=>{const u=f[jd]();if(Bt(u.subscribe))return u.subscribe(l);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(f);if(ov(f))return function NT(f){return new ln(l=>{for(let u=0;u<f.length&&!l.closed;u++)l.next(f[u]);l.complete()})}(f);if(av(f))return function kT(f){return new ln(l=>{f.then(u=>{l.closed||(l.next(u),l.complete())},u=>l.error(u)).then(null,K_)})}(f);if(cv(f))return pv(f);if(dv(f))return function BT(f){return new ln(l=>{for(const u of f)if(l.next(u),l.closed)return;l.complete()})}(f);if(gv(f))return function VT(f){return pv(fv(f))}(f)}throw uv(f)}function pv(f){return new ln(l=>{(function jT(f,l){var u,g,p,m;return function AT(f,l,u,g){return new(u||(u=Promise))(function(m,v){function C(L){try{O(g.next(L))}catch(N){v(N)}}function D(L){try{O(g.throw(L))}catch(N){v(N)}}function O(L){L.done?m(L.value):function p(m){return m instanceof u?m:new u(function(v){v(m)})}(L.value).then(C,D)}O((g=g.apply(f,l||[])).next())})}(this,void 0,void 0,function*(){try{for(u=MT(f);!(g=yield u.next()).done;)if(l.next(g.value),l.closed)return}catch(v){p={error:v}}finally{try{g&&!g.done&&(m=u.return)&&(yield m.call(u))}finally{if(p)throw p.error}}l.complete()})})(f,l).catch(u=>l.error(u))})}function Ar(f,l,u,g=0,p=!1){const m=l.schedule(function(){u(),p?f.add(this.schedule(null,g)):this.unsubscribe()},g);if(f.add(m),!p)return m}function bn(f,l,u=1/0){return Bt(l)?bn((g,p)=>Vt((m,v)=>l(g,m,p,v))(sr(f(g,p))),u):("number"==typeof l&&(u=l),In((g,p)=>function UT(f,l,u,g,p,m,v,C){const D=[];let O=0,L=0,N=!1;const B=()=>{N&&!D.length&&!O&&l.complete()},j=Y=>O<g?W(Y):D.push(Y),W=Y=>{m&&l.next(Y),O++;let $=!1;sr(u(Y,L++)).subscribe(En(l,q=>{null==p||p(q),m?j(q):l.next(q)},()=>{$=!0},void 0,()=>{if($)try{for(O--;D.length&&O<g;){const q=D.shift();v?Ar(l,v,()=>W(q)):W(q)}B()}catch(q){l.error(q)}}))};return f.subscribe(En(l,j,()=>{N=!0,B()})),()=>{null==C||C()}}(g,p,f,u)))}function Qa(f=1/0){return bn(Gs,f)}const Rr=new ln(f=>f.complete());function Gd(f){return f[f.length-1]}function mv(f){return Bt(Gd(f))?f.pop():void 0}function Ja(f){return function HT(f){return f&&Bt(f.schedule)}(Gd(f))?f.pop():void 0}function _v(f,l=0){return In((u,g)=>{u.subscribe(En(g,p=>Ar(g,f,()=>g.next(p),l),()=>Ar(g,f,()=>g.complete(),l),p=>Ar(g,f,()=>g.error(p),l)))})}function vv(f,l=0){return In((u,g)=>{g.add(f.schedule(()=>u.subscribe(g),l))})}function yv(f,l){if(!f)throw new Error("Iterable cannot be null");return new ln(u=>{Ar(u,l,()=>{const g=f[Symbol.asyncIterator]();Ar(u,l,()=>{g.next().then(p=>{p.done?u.complete():u.next(p.value)})},0,!0)})})}function Dn(f,l){return l?function ZT(f,l){if(null!=f){if(lv(f))return function zT(f,l){return sr(f).pipe(vv(l),_v(l))}(f,l);if(ov(f))return function $T(f,l){return new ln(u=>{let g=0;return l.schedule(function(){g===f.length?u.complete():(u.next(f[g++]),u.closed||this.schedule())})})}(f,l);if(av(f))return function YT(f,l){return sr(f).pipe(vv(l),_v(l))}(f,l);if(cv(f))return yv(f,l);if(dv(f))return function XT(f,l){return new ln(u=>{let g;return Ar(u,l,()=>{g=f[hv](),Ar(u,l,()=>{let p,m;try{({value:p,done:m}=g.next())}catch(v){return void u.error(v)}m?u.complete():u.next(p)},0,!0)}),()=>Bt(null==g?void 0:g.return)&&g.return()})}(f,l);if(gv(f))return function qT(f,l){return yv(fv(f),l)}(f,l)}throw uv(f)}(f,l):sr(f)}function Qc(f){return f<=0?()=>Rr:In((l,u)=>{let g=0;l.subscribe(En(u,p=>{++g<=f&&(u.next(p),f<=g&&u.complete())}))})}function Hd(f,l,...u){return!0===l?(f(),null):!1===l?null:l(...u).pipe(Qc(1)).subscribe(()=>f())}function Ft(f){for(let l in f)if(f[l]===Ft)return l;throw Error("Could not find renamed property on target object.")}function Wd(f,l){for(const u in l)l.hasOwnProperty(u)&&!f.hasOwnProperty(u)&&(f[u]=l[u])}function Tt(f){if("string"==typeof f)return f;if(Array.isArray(f))return"["+f.map(Tt).join(", ")+"]";if(null==f)return""+f;if(f.overriddenName)return`${f.overriddenName}`;if(f.name)return`${f.name}`;const l=f.toString();if(null==l)return""+l;const u=l.indexOf("\n");return-1===u?l:l.substring(0,u)}function zd(f,l){return null==f||""===f?null===l?"":l:null==l||""===l?f:f+" "+l}const JT=Ft({__forward_ref__:Ft});function jt(f){return f.__forward_ref__=jt,f.toString=function(){return Tt(this())},f}function tt(f){return Cv(f)?f():f}function Cv(f){return"function"==typeof f&&f.hasOwnProperty(JT)&&f.__forward_ref__===jt}class wt extends Error{constructor(l,u){super(function Yd(f,l){return`NG0${Math.abs(f)}${l?": "+l:""}`}(l,u)),this.code=l}}function Ze(f){return"string"==typeof f?f:null==f?"":String(f)}function Tn(f){return"function"==typeof f?f.name||f.toString():"object"==typeof f&&null!=f&&"function"==typeof f.type?f.type.name||f.type.toString():Ze(f)}function Jc(f,l){const u=l?` in ${l}`:"";throw new wt(-201,`No provider for ${Tn(f)} found${u}`)}function ri(f,l){null==f&&function Pt(f,l,u,g){throw new Error(`ASSERTION ERROR: ${f}`+(null==g?"":` [Expected=> ${u} ${g} ${l} <=Actual]`))}(l,f,null,"!=")}function vt(f){return{token:f.token,providedIn:f.providedIn||null,factory:f.factory,value:void 0}}function Vi(f){return{providers:f.providers||[],imports:f.imports||[]}}function $d(f){return wv(f,eu)||wv(f,bv)}function wv(f,l){return f.hasOwnProperty(l)?f[l]:null}function Ev(f){return f&&(f.hasOwnProperty(Xd)||f.hasOwnProperty(ox))?f[Xd]:null}const eu=Ft({\u0275prov:Ft}),Xd=Ft({\u0275inj:Ft}),bv=Ft({ngInjectableDef:Ft}),ox=Ft({ngInjectorDef:Ft});var $e=(()=>(($e=$e||{})[$e.Default=0]="Default",$e[$e.Host=1]="Host",$e[$e.Self=2]="Self",$e[$e.SkipSelf=4]="SkipSelf",$e[$e.Optional=8]="Optional",$e))();let qd;function cs(f){const l=qd;return qd=f,l}function Dv(f,l,u){const g=$d(f);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:u&$e.Optional?null:void 0!==l?l:void Jc(Tt(f),"Injector")}function us(f){return{toString:f}.toString()}var ji=(()=>((ji=ji||{})[ji.OnPush=0]="OnPush",ji[ji.Default=1]="Default",ji))(),or=(()=>{return(f=or||(or={}))[f.Emulated=0]="Emulated",f[f.None=2]="None",f[f.ShadowDom=3]="ShadowDom",or;var f})();const lx="undefined"!=typeof globalThis&&globalThis,cx="undefined"!=typeof window&&window,ux="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ot=lx||"undefined"!=typeof global&&global||cx||ux,So={},Nt=[],tu=Ft({\u0275cmp:Ft}),Zd=Ft({\u0275dir:Ft}),Kd=Ft({\u0275pipe:Ft}),Sv=Ft({\u0275mod:Ft}),Mr=Ft({\u0275fac:Ft}),el=Ft({__NG_ELEMENT_ID__:Ft});let hx=0;function ar(f){return us(()=>{const u={},g={type:f.type,providersResolver:null,decls:f.decls,vars:f.vars,factory:null,template:f.template||null,consts:f.consts||null,ngContentSelectors:f.ngContentSelectors,hostBindings:f.hostBindings||null,hostVars:f.hostVars||0,hostAttrs:f.hostAttrs||null,contentQueries:f.contentQueries||null,declaredInputs:u,inputs:null,outputs:null,exportAs:f.exportAs||null,onPush:f.changeDetection===ji.OnPush,directiveDefs:null,pipeDefs:null,selectors:f.selectors||Nt,viewQuery:f.viewQuery||null,features:f.features||null,data:f.data||{},encapsulation:f.encapsulation||or.Emulated,id:"c",styles:f.styles||Nt,_:null,setInput:null,schemas:f.schemas||null,tView:null},p=f.directives,m=f.features,v=f.pipes;return g.id+=hx++,g.inputs=Av(f.inputs,u),g.outputs=Av(f.outputs),m&&m.forEach(C=>C(g)),g.directiveDefs=p?()=>("function"==typeof p?p():p).map(Iv):null,g.pipeDefs=v?()=>("function"==typeof v?v():v).map(Tv):null,g})}function Iv(f){return Fn(f)||function hs(f){return f[Zd]||null}(f)}function Tv(f){return function Ws(f){return f[Kd]||null}(f)}const xv={};function lr(f){return us(()=>{const l={type:f.type,bootstrap:f.bootstrap||Nt,declarations:f.declarations||Nt,imports:f.imports||Nt,exports:f.exports||Nt,transitiveCompileScopes:null,schemas:f.schemas||null,id:f.id||null};return null!=f.id&&(xv[f.id]=f.type),l})}function Av(f,l){if(null==f)return So;const u={};for(const g in f)if(f.hasOwnProperty(g)){let p=f[g],m=p;Array.isArray(p)&&(m=p[1],p=p[0]),u[p]=g,l&&(l[p]=m)}return u}const ze=ar;function Fn(f){return f[tu]||null}function wi(f,l){const u=f[Sv]||null;if(!u&&!0===l)throw new Error(`Type ${Tt(f)} does not have '\u0275mod' property.`);return u}function cr(f){return Array.isArray(f)&&"object"==typeof f[1]}function Gi(f){return Array.isArray(f)&&!0===f[1]}function ef(f){return 0!=(8&f.flags)}function su(f){return 2==(2&f.flags)}function ou(f){return 1==(1&f.flags)}function Hi(f){return null!==f.template}function _x(f){return 0!=(512&f[2])}function Xs(f,l){return f.hasOwnProperty(Mr)?f[Mr]:null}class Cx{constructor(l,u,g){this.previousValue=l,this.currentValue=u,this.firstChange=g}isFirstChange(){return this.firstChange}}function bi(){return Ov}function Ov(f){return f.type.prototype.ngOnChanges&&(f.setInput=Ex),wx}function wx(){const f=Lv(this),l=null==f?void 0:f.current;if(l){const u=f.previous;if(u===So)f.previous=l;else for(let g in l)u[g]=l[g];f.current=null,this.ngOnChanges(l)}}function Ex(f,l,u,g){const p=Lv(f)||function bx(f,l){return f[Mv]=l}(f,{previous:So,current:null}),m=p.current||(p.current={}),v=p.previous,C=this.declaredInputs[u],D=v[C];m[C]=new Cx(D&&D.currentValue,l,v===So),f[g]=l}bi.ngInherit=!0;const Mv="__ngSimpleChanges__";function Lv(f){return f[Mv]||null}let of;function Zt(f){return!!f.listen}const Fv={createRenderer:(f,l)=>function af(){return void 0!==of?of:"undefined"!=typeof document?document:void 0}()};function cn(f){for(;Array.isArray(f);)f=f[0];return f}function au(f,l){return cn(l[f])}function Si(f,l){return cn(l[f.index])}function lf(f,l){return f.data[l]}function oi(f,l){const u=l[f];return cr(u)?u:u[0]}function cf(f){return 128==(128&f[2])}function ds(f,l){return null==l?null:f[l]}function Nv(f){f[18]=0}function uf(f,l){f[5]+=l;let u=f,g=f[3];for(;null!==g&&(1===l&&1===u[5]||-1===l&&0===u[5]);)g[5]+=l,u=g,g=g[3]}const Ke={lFrame:zv(null),bindingsEnabled:!0};function Bv(){return Ke.bindingsEnabled}function _e(){return Ke.lFrame.lView}function Et(){return Ke.lFrame.tView}function vn(){let f=Vv();for(;null!==f&&64===f.type;)f=f.parent;return f}function Vv(){return Ke.lFrame.currentTNode}function ur(f,l){const u=Ke.lFrame;u.currentTNode=f,u.isParent=l}function hf(){return Ke.lFrame.isParent}function Oo(){return Ke.lFrame.bindingIndex++}function Ux(f,l){const u=Ke.lFrame;u.bindingIndex=u.bindingRootIndex=f,ff(l)}function ff(f){Ke.lFrame.currentDirectiveIndex=f}function pf(f){Ke.lFrame.currentQueryIndex=f}function Hx(f){const l=f[1];return 2===l.type?l.declTNode:1===l.type?f[6]:null}function Hv(f,l,u){if(u&$e.SkipSelf){let p=l,m=f;for(;!(p=p.parent,null!==p||u&$e.Host||(p=Hx(m),null===p||(m=m[15],10&p.type))););if(null===p)return!1;l=p,f=m}const g=Ke.lFrame=Wv();return g.currentTNode=l,g.lView=f,!0}function cu(f){const l=Wv(),u=f[1];Ke.lFrame=l,l.currentTNode=u.firstChild,l.lView=f,l.tView=u,l.contextLView=f,l.bindingIndex=u.bindingStartIndex,l.inI18n=!1}function Wv(){const f=Ke.lFrame,l=null===f?null:f.child;return null===l?zv(f):l}function zv(f){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:f,child:null,inI18n:!1};return null!==f&&(f.child=l),l}function Yv(){const f=Ke.lFrame;return Ke.lFrame=f.parent,f.currentTNode=null,f.lView=null,f}const $v=Yv;function uu(){const f=Yv();f.isParent=!0,f.tView=null,f.selectedIndex=-1,f.contextLView=null,f.elementDepthCount=0,f.currentDirectiveIndex=-1,f.currentNamespace=null,f.bindingRootIndex=-1,f.bindingIndex=-1,f.currentQueryIndex=0}function Gn(){return Ke.lFrame.selectedIndex}function fs(f){Ke.lFrame.selectedIndex=f}function Kt(){const f=Ke.lFrame;return lf(f.tView,f.selectedIndex)}function hu(f,l){for(let u=l.directiveStart,g=l.directiveEnd;u<g;u++){const m=f.data[u].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:C,ngAfterViewInit:D,ngAfterViewChecked:O,ngOnDestroy:L}=m;v&&(f.contentHooks||(f.contentHooks=[])).push(-u,v),C&&((f.contentHooks||(f.contentHooks=[])).push(u,C),(f.contentCheckHooks||(f.contentCheckHooks=[])).push(u,C)),D&&(f.viewHooks||(f.viewHooks=[])).push(-u,D),O&&((f.viewHooks||(f.viewHooks=[])).push(u,O),(f.viewCheckHooks||(f.viewCheckHooks=[])).push(u,O)),null!=L&&(f.destroyHooks||(f.destroyHooks=[])).push(u,L)}}function du(f,l,u){Xv(f,l,3,u)}function fu(f,l,u,g){(3&f[2])===u&&Xv(f,l,u,g)}function mf(f,l){let u=f[2];(3&u)===l&&(u&=2047,u+=1,f[2]=u)}function Xv(f,l,u,g){const m=null!=g?g:-1,v=l.length-1;let C=0;for(let D=void 0!==g?65535&f[18]:0;D<v;D++)if("number"==typeof l[D+1]){if(C=l[D],null!=g&&C>=g)break}else l[D]<0&&(f[18]+=65536),(C<m||-1==m)&&(Qx(f,u,l,D),f[18]=(4294901760&f[18])+D+2),D++}function Qx(f,l,u,g){const p=u[g]<0,m=u[g+1],C=f[p?-u[g]:u[g]];if(p){if(f[2]>>11<f[18]>>16&&(3&f[2])===l){f[2]+=2048;try{m.call(C)}finally{}}}else try{m.call(C)}finally{}}class sl{constructor(l,u,g){this.factory=l,this.resolving=!1,this.canSeeViewProviders=u,this.injectImpl=g}}function gu(f,l,u){const g=Zt(f);let p=0;for(;p<u.length;){const m=u[p];if("number"==typeof m){if(0!==m)break;p++;const v=u[p++],C=u[p++],D=u[p++];g?f.setAttribute(l,C,D,v):l.setAttributeNS(v,C,D)}else{const v=m,C=u[++p];vf(v)?g&&f.setProperty(l,v,C):g?f.setAttribute(l,v,C):l.setAttribute(v,C),p++}}return p}function qv(f){return 3===f||4===f||6===f}function vf(f){return 64===f.charCodeAt(0)}function pu(f,l){if(null!==l&&0!==l.length)if(null===f||0===f.length)f=l.slice();else{let u=-1;for(let g=0;g<l.length;g++){const p=l[g];"number"==typeof p?u=p:0===u||Zv(f,u,p,null,-1===u||2===u?l[++g]:null)}}return f}function Zv(f,l,u,g,p){let m=0,v=f.length;if(-1===l)v=-1;else for(;m<f.length;){const C=f[m++];if("number"==typeof C){if(C===l){v=-1;break}if(C>l){v=m-1;break}}}for(;m<f.length;){const C=f[m];if("number"==typeof C)break;if(C===u){if(null===g)return void(null!==p&&(f[m+1]=p));if(g===f[m+1])return void(f[m+2]=p)}m++,null!==g&&m++,null!==p&&m++}-1!==v&&(f.splice(v,0,l),m=v+1),f.splice(m++,0,u),null!==g&&f.splice(m++,0,g),null!==p&&f.splice(m++,0,p)}function Kv(f){return-1!==f}function Mo(f){return 32767&f}function Lo(f,l){let u=function iA(f){return f>>16}(f),g=l;for(;u>0;)g=g[15],u--;return g}let yf=!0;function mu(f){const l=yf;return yf=f,l}let rA=0;function al(f,l){const u=wf(f,l);if(-1!==u)return u;const g=l[1];g.firstCreatePass&&(f.injectorIndex=l.length,Cf(g.data,f),Cf(l,null),Cf(g.blueprint,null));const p=_u(f,l),m=f.injectorIndex;if(Kv(p)){const v=Mo(p),C=Lo(p,l),D=C[1].data;for(let O=0;O<8;O++)l[m+O]=C[v+O]|D[v+O]}return l[m+8]=p,m}function Cf(f,l){f.push(0,0,0,0,0,0,0,0,l)}function wf(f,l){return-1===f.injectorIndex||f.parent&&f.parent.injectorIndex===f.injectorIndex||null===l[f.injectorIndex+8]?-1:f.injectorIndex}function _u(f,l){if(f.parent&&-1!==f.parent.injectorIndex)return f.parent.injectorIndex;let u=0,g=null,p=l;for(;null!==p;){const m=p[1],v=m.type;if(g=2===v?m.declTNode:1===v?p[6]:null,null===g)return-1;if(u++,p=p[15],-1!==g.injectorIndex)return g.injectorIndex|u<<16}return-1}function vu(f,l,u){!function sA(f,l,u){let g;"string"==typeof u?g=u.charCodeAt(0)||0:u.hasOwnProperty(el)&&(g=u[el]),null==g&&(g=u[el]=rA++);const p=255&g;l.data[f+(p>>5)]|=1<<p}(f,l,u)}function ey(f,l,u){if(u&$e.Optional)return f;Jc(l,"NodeInjector")}function ty(f,l,u,g){if(u&$e.Optional&&void 0===g&&(g=null),0==(u&($e.Self|$e.Host))){const p=f[9],m=cs(void 0);try{return p?p.get(l,g,u&$e.Optional):Dv(l,g,u&$e.Optional)}finally{cs(m)}}return ey(g,l,u)}function ny(f,l,u,g=$e.Default,p){if(null!==f){const m=function cA(f){if("string"==typeof f)return f.charCodeAt(0)||0;const l=f.hasOwnProperty(el)?f[el]:void 0;return"number"==typeof l?l>=0?255&l:aA:l}(u);if("function"==typeof m){if(!Hv(l,f,g))return g&$e.Host?ey(p,u,g):ty(l,u,g,p);try{const v=m(g);if(null!=v||g&$e.Optional)return v;Jc(u)}finally{$v()}}else if("number"==typeof m){let v=null,C=wf(f,l),D=-1,O=g&$e.Host?l[16][6]:null;for((-1===C||g&$e.SkipSelf)&&(D=-1===C?_u(f,l):l[C+8],-1!==D&&sy(g,!1)?(v=l[1],C=Mo(D),l=Lo(D,l)):C=-1);-1!==C;){const L=l[1];if(ry(m,C,L.data)){const N=lA(C,l,u,v,g,O);if(N!==iy)return N}D=l[C+8],-1!==D&&sy(g,l[1].data[C+8]===O)&&ry(m,C,l)?(v=L,C=Mo(D),l=Lo(D,l)):C=-1}}}return ty(l,u,g,p)}const iy={};function aA(){return new Fo(vn(),_e())}function lA(f,l,u,g,p,m){const v=l[1],C=v.data[f+8],L=function yu(f,l,u,g,p){const m=f.providerIndexes,v=l.data,C=1048575&m,D=f.directiveStart,L=m>>20,B=p?C+L:f.directiveEnd;for(let j=g?C:C+L;j<B;j++){const W=v[j];if(j<D&&u===W||j>=D&&W.type===u)return j}if(p){const j=v[D];if(j&&Hi(j)&&j.type===u)return D}return null}(C,v,u,null==g?su(C)&&yf:g!=v&&0!=(3&C.type),p&$e.Host&&m===C);return null!==L?ll(l,v,L,C):iy}function ll(f,l,u,g){let p=f[u];const m=l.data;if(function Jx(f){return f instanceof sl}(p)){const v=p;v.resolving&&function ex(f,l){const u=l?`. Dependency path: ${l.join(" > ")} > ${f}`:"";throw new wt(-200,`Circular dependency in DI detected for ${f}${u}`)}(Tn(m[u]));const C=mu(v.canSeeViewProviders);v.resolving=!0;const D=v.injectImpl?cs(v.injectImpl):null;Hv(f,g,$e.Default);try{p=f[u]=v.factory(void 0,m,f,g),l.firstCreatePass&&u>=g.directiveStart&&function Kx(f,l,u){const{ngOnChanges:g,ngOnInit:p,ngDoCheck:m}=l.type.prototype;if(g){const v=Ov(l);(u.preOrderHooks||(u.preOrderHooks=[])).push(f,v),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(f,v)}p&&(u.preOrderHooks||(u.preOrderHooks=[])).push(0-f,p),m&&((u.preOrderHooks||(u.preOrderHooks=[])).push(f,m),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(f,m))}(u,m[u],l)}finally{null!==D&&cs(D),mu(C),v.resolving=!1,$v()}}return p}function ry(f,l,u){return!!(u[l+(f>>5)]&1<<f)}function sy(f,l){return!(f&$e.Self||f&$e.Host&&l)}class Fo{constructor(l,u){this._tNode=l,this._lView=u}get(l,u,g){return ny(this._tNode,this._lView,l,g,u)}}function Ef(f){return Cv(f)?()=>{const l=Ef(tt(f));return l&&l()}:Xs(f)}const No="__parameters__";function Bo(f,l,u){return us(()=>{const g=function bf(f){return function(...u){if(f){const g=f(...u);for(const p in g)this[p]=g[p]}}}(l);function p(...m){if(this instanceof p)return g.apply(this,m),this;const v=new p(...m);return C.annotation=v,C;function C(D,O,L){const N=D.hasOwnProperty(No)?D[No]:Object.defineProperty(D,No,{value:[]})[No];for(;N.length<=L;)N.push(null);return(N[L]=N[L]||[]).push(v),D}}return u&&(p.prototype=Object.create(u.prototype)),p.prototype.ngMetadataName=f,p.annotationCls=p,p})}class ut{constructor(l,u){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof u?this.__NG_ELEMENT_ID__=u:void 0!==u&&(this.\u0275prov=vt({token:this,providedIn:u.providedIn||"root",factory:u.factory}))}toString(){return`InjectionToken ${this._desc}`}}const hA=new ut("AnalyzeForEntryComponents");function hr(f,l){f.forEach(u=>Array.isArray(u)?hr(u,l):l(u))}function ay(f,l,u){l>=f.length?f.push(u):f.splice(l,0,u)}function Cu(f,l){return l>=f.length-1?f.pop():f.splice(l,1)[0]}function ai(f,l,u){let g=Vo(f,l);return g>=0?f[1|g]=u:(g=~g,function gA(f,l,u,g){let p=f.length;if(p==l)f.push(u,g);else if(1===p)f.push(g,f[0]),f[0]=u;else{for(p--,f.push(f[p-1],f[p]);p>l;)f[p]=f[p-2],p--;f[l]=u,f[l+1]=g}}(f,g,l,u)),g}function Sf(f,l){const u=Vo(f,l);if(u>=0)return f[1|u]}function Vo(f,l){return function uy(f,l,u){let g=0,p=f.length>>u;for(;p!==g;){const m=g+(p-g>>1),v=f[m<<u];if(l===v)return m<<u;v>l?p=m:g=m+1}return~(p<<u)}(f,l,1)}const fl={},Tf="__NG_DI_FLAG__",Eu="ngTempTokenPath",wA=/\n/gm,dy="__source",bA=Ft({provide:String,useValue:Ft});let gl;function fy(f){const l=gl;return gl=f,l}function DA(f,l=$e.Default){if(void 0===gl)throw new wt(203,"");return null===gl?Dv(f,void 0,l):gl.get(f,l&$e.Optional?null:void 0,l)}function Ye(f,l=$e.Default){return(function ax(){return qd}()||DA)(tt(f),l)}const SA=Ye;function xf(f){const l=[];for(let u=0;u<f.length;u++){const g=tt(f[u]);if(Array.isArray(g)){if(0===g.length)throw new wt(900,"");let p,m=$e.Default;for(let v=0;v<g.length;v++){const C=g[v],D=IA(C);"number"==typeof D?-1===D?p=C.token:m|=D:p=C}l.push(Ye(p,m))}else l.push(Ye(g))}return l}function pl(f,l){return f[Tf]=l,f.prototype[Tf]=l,f}function IA(f){return f[Tf]}const bu=pl(Bo("Inject",f=>({token:f})),-1),ps=pl(Bo("Optional"),8),ml=pl(Bo("SkipSelf"),4);class Ey{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ms(f){return f instanceof Ey?f.changingThisBreaksApplicationSecurity:f}const XA=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,qA=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var un=(()=>((un=un||{})[un.NONE=0]="NONE",un[un.HTML=1]="HTML",un[un.STYLE=2]="STYLE",un[un.SCRIPT=3]="SCRIPT",un[un.URL=4]="URL",un[un.RESOURCE_URL=5]="RESOURCE_URL",un))();function Nf(f){const l=function Cl(){const f=_e();return f&&f[12]}();return l?l.sanitize(un.URL,f)||"":function vl(f,l){const u=function WA(f){return f instanceof Ey&&f.getTypeName()||null}(f);if(null!=u&&u!==l){if("ResourceURL"===u&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${u} (see https://g.co/ng/security#xss)`)}return u===l}(f,"URL")?ms(f):function Tu(f){return(f=String(f)).match(XA)||f.match(qA)?f:"unsafe:"+f}(Ze(f))}const My="__ngContext__";function kn(f,l){f[My]=l}function Bf(f){const l=function wl(f){return f[My]||null}(f);return l?Array.isArray(l)?l:l.lView:null}function jf(f){return f.ngOriginalError}function vR(f,...l){f.error(...l)}class El{constructor(){this._console=console}handleError(l){const u=this._findOriginalError(l),g=function _R(f){return f&&f.ngErrorLogger||vR}(l);g(this._console,"ERROR",l),u&&g(this._console,"ORIGINAL ERROR",u)}_findOriginalError(l){let u=l&&jf(l);for(;u&&jf(u);)u=jf(u);return u||null}}const xR=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ot))();function fr(f){return f instanceof Function?f():f}var li=(()=>((li=li||{})[li.Important=1]="Important",li[li.DashCase=2]="DashCase",li))();function Gf(f,l){return undefined(f,l)}function bl(f){const l=f[3];return Gi(l)?l[3]:l}function Hf(f){return Uy(f[13])}function Wf(f){return Uy(f[4])}function Uy(f){for(;null!==f&&!Gi(f);)f=f[4];return f}function Ho(f,l,u,g,p){if(null!=g){let m,v=!1;Gi(g)?m=g:cr(g)&&(v=!0,g=g[0]);const C=cn(g);0===f&&null!==u?null==p?$y(l,u,C):qs(l,u,C,p||null,!0):1===f&&null!==u?qs(l,u,C,p||null,!0):2===f?function e0(f,l,u){const g=Au(f,l);g&&function GR(f,l,u,g){Zt(f)?f.removeChild(l,u,g):l.removeChild(u)}(f,g,l,u)}(l,C,v):3===f&&l.destroyNode(C),null!=m&&function zR(f,l,u,g,p){const m=u[7];m!==cn(u)&&Ho(l,f,g,m,p);for(let C=10;C<u.length;C++){const D=u[C];Dl(D[1],D,f,l,g,m)}}(l,f,m,u,p)}}function Yf(f,l,u){if(Zt(f))return f.createElement(l,u);{const g=null!==u?function Tx(f){const l=f.toLowerCase();return"svg"===l?"http://www.w3.org/2000/svg":"math"===l?"http://www.w3.org/1998/MathML/":null}(u):null;return null===g?f.createElement(l):f.createElementNS(g,l)}}function Hy(f,l){const u=f[9],g=u.indexOf(l),p=l[3];1024&l[2]&&(l[2]&=-1025,uf(p,-1)),u.splice(g,1)}function $f(f,l){if(f.length<=10)return;const u=10+l,g=f[u];if(g){const p=g[17];null!==p&&p!==f&&Hy(p,g),l>0&&(f[u-1][4]=g[4]);const m=Cu(f,10+l);!function FR(f,l){Dl(f,l,l[11],2,null,null),l[0]=null,l[6]=null}(g[1],g);const v=m[19];null!==v&&v.detachView(m[1]),g[3]=null,g[4]=null,g[2]&=-129}return g}function Wy(f,l){if(!(256&l[2])){const u=l[11];Zt(u)&&u.destroyNode&&Dl(f,l,u,3,null,null),function kR(f){let l=f[13];if(!l)return Xf(f[1],f);for(;l;){let u=null;if(cr(l))u=l[13];else{const g=l[10];g&&(u=g)}if(!u){for(;l&&!l[4]&&l!==f;)cr(l)&&Xf(l[1],l),l=l[3];null===l&&(l=f),cr(l)&&Xf(l[1],l),u=l&&l[4]}l=u}}(l)}}function Xf(f,l){if(!(256&l[2])){l[2]&=-129,l[2]|=256,function UR(f,l){let u;if(null!=f&&null!=(u=f.destroyHooks))for(let g=0;g<u.length;g+=2){const p=l[u[g]];if(!(p instanceof sl)){const m=u[g+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const C=p[m[v]],D=m[v+1];try{D.call(C)}finally{}}else try{m.call(p)}finally{}}}}(f,l),function jR(f,l){const u=f.cleanup,g=l[7];let p=-1;if(null!==u)for(let m=0;m<u.length-1;m+=2)if("string"==typeof u[m]){const v=u[m+1],C="function"==typeof v?v(l):cn(l[v]),D=g[p=u[m+2]],O=u[m+3];"boolean"==typeof O?C.removeEventListener(u[m],D,O):O>=0?g[p=O]():g[p=-O].unsubscribe(),m+=2}else{const v=g[p=u[m+1]];u[m].call(v)}if(null!==g){for(let m=p+1;m<g.length;m++)g[m]();l[7]=null}}(f,l),1===l[1].type&&Zt(l[11])&&l[11].destroy();const u=l[17];if(null!==u&&Gi(l[3])){u!==l[3]&&Hy(u,l);const g=l[19];null!==g&&g.detachView(f)}}}function zy(f,l,u){return function Yy(f,l,u){let g=l;for(;null!==g&&40&g.type;)g=(l=g).parent;if(null===g)return u[0];if(2&g.flags){const p=f.data[g.directiveStart].encapsulation;if(p===or.None||p===or.Emulated)return null}return Si(g,u)}(f,l.parent,u)}function qs(f,l,u,g,p){Zt(f)?f.insertBefore(l,u,g,p):l.insertBefore(u,g,p)}function $y(f,l,u){Zt(f)?f.appendChild(l,u):l.appendChild(u)}function Xy(f,l,u,g,p){null!==g?qs(f,l,u,g,p):$y(f,l,u)}function Au(f,l){return Zt(f)?f.parentNode(l):l.parentNode}let Ky=function Zy(f,l,u){return 40&f.type?Si(f,u):null};function Ru(f,l,u,g){const p=zy(f,g,l),m=l[11],C=function qy(f,l,u){return Ky(f,l,u)}(g.parent||l[6],g,l);if(null!=p)if(Array.isArray(u))for(let D=0;D<u.length;D++)Xy(m,p,u[D],C,!1);else Xy(m,p,u,C,!1)}function Ou(f,l){if(null!==l){const u=l.type;if(3&u)return Si(l,f);if(4&u)return Zf(-1,f[l.index]);if(8&u){const g=l.child;if(null!==g)return Ou(f,g);{const p=f[l.index];return Gi(p)?Zf(-1,p):cn(p)}}if(32&u)return Gf(l,f)()||cn(f[l.index]);{const g=Jy(f,l);return null!==g?Array.isArray(g)?g[0]:Ou(bl(f[16]),g):Ou(f,l.next)}}return null}function Jy(f,l){return null!==l?f[16][6].projection[l.projection]:null}function Zf(f,l){const u=10+f+1;if(u<l.length){const g=l[u],p=g[1].firstChild;if(null!==p)return Ou(g,p)}return l[7]}function Kf(f,l,u,g,p,m,v){for(;null!=u;){const C=g[u.index],D=u.type;if(v&&0===l&&(C&&kn(cn(C),g),u.flags|=4),64!=(64&u.flags))if(8&D)Kf(f,l,u.child,g,p,m,!1),Ho(l,f,p,C,m);else if(32&D){const O=Gf(u,g);let L;for(;L=O();)Ho(l,f,p,L,m);Ho(l,f,p,C,m)}else 16&D?t0(f,l,g,u,p,m):Ho(l,f,p,C,m);u=v?u.projectionNext:u.next}}function Dl(f,l,u,g,p,m){Kf(u,g,f.firstChild,l,p,m,!1)}function t0(f,l,u,g,p,m){const v=u[16],D=v[6].projection[g.projection];if(Array.isArray(D))for(let O=0;O<D.length;O++)Ho(l,f,p,D[O],m);else Kf(f,l,D,v[3],p,m,!0)}function n0(f,l,u){Zt(f)?f.setAttribute(l,"style",u):l.style.cssText=u}function Qf(f,l,u){Zt(f)?""===u?f.removeAttribute(l,"class"):f.setAttribute(l,"class",u):l.className=u}function r0(f,l,u){let g=f.length;for(;;){const p=f.indexOf(l,u);if(-1===p)return p;if(0===p||f.charCodeAt(p-1)<=32){const m=l.length;if(p+m===g||f.charCodeAt(p+m)<=32)return p}u=p+1}}const s0="ng-template";function $R(f,l,u){let g=0;for(;g<f.length;){let p=f[g++];if(u&&"class"===p){if(p=f[g],-1!==r0(p.toLowerCase(),l,0))return!0}else if(1===p){for(;g<f.length&&"string"==typeof(p=f[g++]);)if(p.toLowerCase()===l)return!0;return!1}}return!1}function o0(f){return 4===f.type&&f.value!==s0}function XR(f,l,u){return l===(4!==f.type||u?f.value:s0)}function qR(f,l,u){let g=4;const p=f.attrs||[],m=function QR(f){for(let l=0;l<f.length;l++)if(qv(f[l]))return l;return f.length}(p);let v=!1;for(let C=0;C<l.length;C++){const D=l[C];if("number"!=typeof D){if(!v)if(4&g){if(g=2|1&g,""!==D&&!XR(f,D,u)||""===D&&1===l.length){if(Wi(g))return!1;v=!0}}else{const O=8&g?D:l[++C];if(8&g&&null!==f.attrs){if(!$R(f.attrs,O,u)){if(Wi(g))return!1;v=!0}continue}const N=ZR(8&g?"class":D,p,o0(f),u);if(-1===N){if(Wi(g))return!1;v=!0;continue}if(""!==O){let B;B=N>m?"":p[N+1].toLowerCase();const j=8&g?B:null;if(j&&-1!==r0(j,O,0)||2&g&&O!==B){if(Wi(g))return!1;v=!0}}}}else{if(!v&&!Wi(g)&&!Wi(D))return!1;if(v&&Wi(D))continue;v=!1,g=D|1&g}}return Wi(g)||v}function Wi(f){return 0==(1&f)}function ZR(f,l,u,g){if(null===l)return-1;let p=0;if(g||!u){let m=!1;for(;p<l.length;){const v=l[p];if(v===f)return p;if(3===v||6===v)m=!0;else{if(1===v||2===v){let C=l[++p];for(;"string"==typeof C;)C=l[++p];continue}if(4===v)break;if(0===v){p+=4;continue}}p+=m?1:2}return-1}return function JR(f,l){let u=f.indexOf(4);if(u>-1)for(u++;u<f.length;){const g=f[u];if("number"==typeof g)return-1;if(g===l)return u;u++}return-1}(l,f)}function a0(f,l,u=!1){for(let g=0;g<l.length;g++)if(qR(f,l[g],u))return!0;return!1}function l0(f,l){return f?":not("+l.trim()+")":l}function t1(f){let l=f[0],u=1,g=2,p="",m=!1;for(;u<f.length;){let v=f[u];if("string"==typeof v)if(2&g){const C=f[++u];p+="["+v+(C.length>0?'="'+C+'"':"")+"]"}else 8&g?p+="."+v:4&g&&(p+=" "+v);else""!==p&&!Wi(v)&&(l+=l0(m,p),p=""),g=v,m=m||!Wi(g);u++}return""!==p&&(l+=l0(m,p)),l}const Qe={};function Wn(f){c0(Et(),_e(),Gn()+f,!1)}function c0(f,l,u,g){if(!g)if(3==(3&l[2])){const m=f.preOrderCheckHooks;null!==m&&du(l,m,u)}else{const m=f.preOrderHooks;null!==m&&fu(l,m,0,u)}fs(u)}function Mu(f,l){return f<<17|l<<2}function zi(f){return f>>17&32767}function Jf(f){return 2|f}function Pr(f){return(131068&f)>>2}function eg(f,l){return-131069&f|l<<2}function tg(f){return 1|f}function C0(f,l){const u=f.contentQueries;if(null!==u)for(let g=0;g<u.length;g+=2){const p=u[g],m=u[g+1];if(-1!==m){const v=f.data[m];pf(p),v.contentQueries(2,l[m],m)}}}function Sl(f,l,u,g,p,m,v,C,D,O){const L=l.blueprint.slice();return L[0]=p,L[2]=140|g,Nv(L),L[3]=L[15]=f,L[8]=u,L[10]=v||f&&f[10],L[11]=C||f&&f[11],L[12]=D||f&&f[12]||null,L[9]=O||f&&f[9]||null,L[6]=m,L[16]=2==l.type?f[16]:L,L}function Wo(f,l,u,g,p){let m=f.data[l];if(null===m)m=function ug(f,l,u,g,p){const m=Vv(),v=hf(),D=f.data[l]=function y1(f,l,u,g,p,m){return{type:u,index:g,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:p,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,u,l,g,p);return null===f.firstChild&&(f.firstChild=D),null!==m&&(v?null==m.child&&null!==D.parent&&(m.child=D):null===m.next&&(m.next=D)),D}(f,l,u,g,p),function jx(){return Ke.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=u,m.value=g,m.attrs=p;const v=function rl(){const f=Ke.lFrame,l=f.currentTNode;return f.isParent?l:l.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return ur(m,!0),m}function zo(f,l,u,g){if(0===u)return-1;const p=l.length;for(let m=0;m<u;m++)l.push(g),f.blueprint.push(g),f.data.push(null);return p}function Il(f,l,u){cu(l);try{const g=f.viewQuery;null!==g&&yg(1,g,u);const p=f.template;null!==p&&w0(f,l,p,1,u),f.firstCreatePass&&(f.firstCreatePass=!1),f.staticContentQueries&&C0(f,l),f.staticViewQueries&&yg(2,f.viewQuery,u);const m=f.components;null!==m&&function m1(f,l){for(let u=0;u<l.length;u++)k1(f,l[u])}(l,m)}catch(g){throw f.firstCreatePass&&(f.incompleteFirstPass=!0,f.firstCreatePass=!1),g}finally{l[2]&=-5,uu()}}function Yo(f,l,u,g){const p=l[2];if(256!=(256&p)){cu(l);try{Nv(l),function jv(f){return Ke.lFrame.bindingIndex=f}(f.bindingStartIndex),null!==u&&w0(f,l,u,2,g);const v=3==(3&p);if(v){const O=f.preOrderCheckHooks;null!==O&&du(l,O,null)}else{const O=f.preOrderHooks;null!==O&&fu(l,O,0,null),mf(l,0)}if(function P1(f){for(let l=Hf(f);null!==l;l=Wf(l)){if(!l[2])continue;const u=l[9];for(let g=0;g<u.length;g++){const p=u[g],m=p[3];0==(1024&p[2])&&uf(m,1),p[2]|=1024}}}(l),function F1(f){for(let l=Hf(f);null!==l;l=Wf(l))for(let u=10;u<l.length;u++){const g=l[u],p=g[1];cf(g)&&Yo(p,g,p.template,g[8])}}(l),null!==f.contentQueries&&C0(f,l),v){const O=f.contentCheckHooks;null!==O&&du(l,O)}else{const O=f.contentHooks;null!==O&&fu(l,O,1),mf(l,1)}!function g1(f,l){const u=f.hostBindingOpCodes;if(null!==u)try{for(let g=0;g<u.length;g++){const p=u[g];if(p<0)fs(~p);else{const m=p,v=u[++g],C=u[++g];Ux(v,m),C(2,l[m])}}}finally{fs(-1)}}(f,l);const C=f.components;null!==C&&function p1(f,l){for(let u=0;u<l.length;u++)N1(f,l[u])}(l,C);const D=f.viewQuery;if(null!==D&&yg(2,D,g),v){const O=f.viewCheckHooks;null!==O&&du(l,O)}else{const O=f.viewHooks;null!==O&&fu(l,O,2),mf(l,2)}!0===f.firstUpdatePass&&(f.firstUpdatePass=!1),l[2]&=-73,1024&l[2]&&(l[2]&=-1025,uf(l[3],-1))}finally{uu()}}}function _1(f,l,u,g){const p=l[10],v=function Pv(f){return 4==(4&f[2])}(l);try{!v&&p.begin&&p.begin(),v&&Il(f,l,g),Yo(f,l,u,g)}finally{!v&&p.end&&p.end()}}function w0(f,l,u,g,p){const m=Gn(),v=2&g;try{fs(-1),v&&l.length>20&&c0(f,l,20,!1),u(g,p)}finally{fs(m)}}function hg(f,l,u){!Bv()||(function I1(f,l,u,g){const p=u.directiveStart,m=u.directiveEnd;f.firstCreatePass||al(u,l),kn(g,l);const v=u.initialInputs;for(let C=p;C<m;C++){const D=f.data[C],O=Hi(D);O&&O1(l,u,D);const L=ll(l,f,C,u);kn(L,l),null!==v&&M1(0,C-p,L,D,0,v),O&&(oi(u.index,l)[8]=L)}}(f,l,u,Si(u,l)),128==(128&u.flags)&&function T1(f,l,u){const g=u.directiveStart,p=u.directiveEnd,v=u.index,C=function Gx(){return Ke.lFrame.currentDirectiveIndex}();try{fs(v);for(let D=g;D<p;D++){const O=f.data[D],L=l[D];ff(D),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&R0(O,L)}}finally{fs(-1),ff(C)}}(f,l,u))}function dg(f,l,u=Si){const g=l.localNames;if(null!==g){let p=l.index+1;for(let m=0;m<g.length;m+=2){const v=g[m+1],C=-1===v?u(l,f):f[v];f[p++]=C}}}function b0(f){const l=f.tView;return null===l||l.incompleteFirstPass?f.tView=Pu(1,null,f.template,f.decls,f.vars,f.directiveDefs,f.pipeDefs,f.viewQuery,f.schemas,f.consts):l}function Pu(f,l,u,g,p,m,v,C,D,O){const L=20+g,N=L+p,B=function v1(f,l){const u=[];for(let g=0;g<l;g++)u.push(g<f?null:Qe);return u}(L,N),j="function"==typeof O?O():O;return B[1]={type:f,blueprint:B,template:u,queries:null,viewQuery:C,declTNode:l,data:B.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:N,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:D,consts:j,incompleteFirstPass:!1}}function T0(f,l,u){for(let g in f)if(f.hasOwnProperty(g)){const p=f[g];(u=null===u?{}:u).hasOwnProperty(g)?u[g].push(l,p):u[g]=[l,p]}return u}function fg(f,l,u,g){let p=!1;if(Bv()){const m=function x1(f,l,u){const g=f.directiveRegistry;let p=null;if(g)for(let m=0;m<g.length;m++){const v=g[m];a0(u,v.selectors,!1)&&(p||(p=[]),vu(al(u,l),f,v.type),Hi(v)?(O0(f,u),p.unshift(v)):p.push(v))}return p}(f,l,u),v=null===g?null:{"":-1};if(null!==m){p=!0,M0(u,f.data.length,m.length);for(let L=0;L<m.length;L++){const N=m[L];N.providersResolver&&N.providersResolver(N)}let C=!1,D=!1,O=zo(f,l,m.length,null);for(let L=0;L<m.length;L++){const N=m[L];u.mergedAttrs=pu(u.mergedAttrs,N.hostAttrs),L0(f,u,l,O,N),R1(O,N,v),null!==N.contentQueries&&(u.flags|=8),(null!==N.hostBindings||null!==N.hostAttrs||0!==N.hostVars)&&(u.flags|=128);const B=N.type.prototype;!C&&(B.ngOnChanges||B.ngOnInit||B.ngDoCheck)&&((f.preOrderHooks||(f.preOrderHooks=[])).push(u.index),C=!0),!D&&(B.ngOnChanges||B.ngDoCheck)&&((f.preOrderCheckHooks||(f.preOrderCheckHooks=[])).push(u.index),D=!0),O++}!function C1(f,l){const g=l.directiveEnd,p=f.data,m=l.attrs,v=[];let C=null,D=null;for(let O=l.directiveStart;O<g;O++){const L=p[O],N=L.inputs,B=null===m||o0(l)?null:L1(N,m);v.push(B),C=T0(N,O,C),D=T0(L.outputs,O,D)}null!==C&&(C.hasOwnProperty("class")&&(l.flags|=16),C.hasOwnProperty("style")&&(l.flags|=32)),l.initialInputs=v,l.inputs=C,l.outputs=D}(f,u)}v&&function A1(f,l,u){if(l){const g=f.localNames=[];for(let p=0;p<l.length;p+=2){const m=u[l[p+1]];if(null==m)throw new wt(-301,!1);g.push(l[p],m)}}}(u,g,v)}return u.mergedAttrs=pu(u.mergedAttrs,u.attrs),p}function A0(f,l,u,g,p,m){const v=m.hostBindings;if(v){let C=f.hostBindingOpCodes;null===C&&(C=f.hostBindingOpCodes=[]);const D=~l.index;(function S1(f){let l=f.length;for(;l>0;){const u=f[--l];if("number"==typeof u&&u<0)return u}return 0})(C)!=D&&C.push(D),C.push(g,p,v)}}function R0(f,l){null!==f.hostBindings&&f.hostBindings(1,l)}function O0(f,l){l.flags|=2,(f.components||(f.components=[])).push(l.index)}function R1(f,l,u){if(u){if(l.exportAs)for(let g=0;g<l.exportAs.length;g++)u[l.exportAs[g]]=f;Hi(l)&&(u[""]=f)}}function M0(f,l,u){f.flags|=1,f.directiveStart=l,f.directiveEnd=l+u,f.providerIndexes=l}function L0(f,l,u,g,p){f.data[g]=p;const m=p.factory||(p.factory=Xs(p.type)),v=new sl(m,Hi(p),null);f.blueprint[g]=v,u[g]=v,A0(f,l,0,g,zo(f,u,p.hostVars,Qe),p)}function O1(f,l,u){const g=Si(l,f),p=b0(u),m=f[10],v=Nu(f,Sl(f,p,null,u.onPush?64:16,g,l,m,m.createRenderer(g,u),null,null));f[l.index]=v}function gr(f,l,u,g,p,m){const v=Si(f,l);!function gg(f,l,u,g,p,m,v){if(null==m)Zt(f)?f.removeAttribute(l,p,u):l.removeAttribute(p);else{const C=null==v?Ze(m):v(m,g||"",p);Zt(f)?f.setAttribute(l,p,C,u):u?l.setAttributeNS(u,p,C):l.setAttribute(p,C)}}(l[11],v,m,f.value,u,g,p)}function M1(f,l,u,g,p,m){const v=m[l];if(null!==v){const C=g.setInput;for(let D=0;D<v.length;){const O=v[D++],L=v[D++],N=v[D++];null!==C?g.setInput(u,N,O,L):u[L]=N}}}function L1(f,l){let u=null,g=0;for(;g<l.length;){const p=l[g];if(0!==p)if(5!==p){if("number"==typeof p)break;f.hasOwnProperty(p)&&(null===u&&(u=[]),u.push(p,f[p],l[g+1])),g+=2}else g+=2;else g+=4}return u}function F0(f,l,u,g){return new Array(f,!0,!1,l,null,0,g,u,null,null)}function N1(f,l){const u=oi(l,f);if(cf(u)){const g=u[1];80&u[2]?Yo(g,u,g.template,u[8]):u[5]>0&&pg(u)}}function pg(f){for(let g=Hf(f);null!==g;g=Wf(g))for(let p=10;p<g.length;p++){const m=g[p];if(1024&m[2]){const v=m[1];Yo(v,m,v.template,m[8])}else m[5]>0&&pg(m)}const u=f[1].components;if(null!==u)for(let g=0;g<u.length;g++){const p=oi(u[g],f);cf(p)&&p[5]>0&&pg(p)}}function k1(f,l){const u=oi(l,f),g=u[1];(function B1(f,l){for(let u=l.length;u<f.blueprint.length;u++)l.push(f.blueprint[u])})(g,u),Il(g,u,u[8])}function Nu(f,l){return f[13]?f[14][4]=l:f[13]=l,f[14]=l,l}function mg(f){for(;f;){f[2]|=64;const l=bl(f);if(_x(f)&&!l)return f;f=l}return null}function P0(f){!function _g(f){for(let l=0;l<f.components.length;l++){const u=f.components[l],g=Bf(u),p=g[1];_1(p,g,p.template,u)}}(f[8])}function yg(f,l,u){pf(0),l(f,u)}const j1=(()=>Promise.resolve(null))();function N0(f){return f[7]||(f[7]=[])}function k0(f){return f.cleanup||(f.cleanup=[])}function V0(f,l){const u=f[9],g=u?u.get(El,null):null;g&&g.handleError(l)}function j0(f,l,u,g,p){for(let m=0;m<u.length;){const v=u[m++],C=u[m++],D=l[v],O=f.data[v];null!==O.setInput?O.setInput(D,p,g,C):D[C]=p}}function Nr(f,l,u){const g=au(l,f);!function Gy(f,l,u){Zt(f)?f.setValue(l,u):l.textContent=u}(f[11],g,u)}function ku(f,l,u){let g=u?f.styles:null,p=u?f.classes:null,m=0;if(null!==l)for(let v=0;v<l.length;v++){const C=l[v];"number"==typeof C?m=C:1==m?p=zd(p,C):2==m&&(g=zd(g,C+": "+l[++v]+";"))}u?f.styles=g:f.stylesWithoutHost=g,u?f.classes=p:f.classesWithoutHost=p}const Cg=new ut("INJECTOR",-1);class U0{get(l,u=fl){if(u===fl){const g=new Error(`NullInjectorError: No provider for ${Tt(l)}!`);throw g.name="NullInjectorError",g}return u}}const wg=new ut("Set Injector scope."),Tl={},H1={};let Eg;function G0(){return void 0===Eg&&(Eg=new U0),Eg}function H0(f,l=null,u=null,g){const p=W0(f,l,u,g);return p._resolveInjectorDefTypes(),p}function W0(f,l=null,u=null,g){return new W1(f,u,l||G0(),g)}class W1{constructor(l,u,g,p=null){this.parent=g,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];u&&hr(u,C=>this.processProvider(C,l,u)),hr([l],C=>this.processInjectorType(C,[],m)),this.records.set(Cg,$o(void 0,this));const v=this.records.get(wg);this.scope=null!=v?v.value:null,this.source=p||("object"==typeof l?null:Tt(l))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(l=>l.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(l,u=fl,g=$e.Default){this.assertNotDestroyed();const p=fy(this),m=cs(void 0);try{if(!(g&$e.SkipSelf)){let C=this.records.get(l);if(void 0===C){const D=function Q1(f){return"function"==typeof f||"object"==typeof f&&f instanceof ut}(l)&&$d(l);C=D&&this.injectableDefInScope(D)?$o(bg(l),Tl):null,this.records.set(l,C)}if(null!=C)return this.hydrate(l,C)}return(g&$e.Self?G0():this.parent).get(l,u=g&$e.Optional&&u===fl?null:u)}catch(v){if("NullInjectorError"===v.name){if((v[Eu]=v[Eu]||[]).unshift(Tt(l)),p)throw v;return function TA(f,l,u,g){const p=f[Eu];throw l[dy]&&p.unshift(l[dy]),f.message=function xA(f,l,u,g=null){f=f&&"\n"===f.charAt(0)&&"\u0275"==f.charAt(1)?f.substr(2):f;let p=Tt(l);if(Array.isArray(l))p=l.map(Tt).join(" -> ");else if("object"==typeof l){let m=[];for(let v in l)if(l.hasOwnProperty(v)){let C=l[v];m.push(v+":"+("string"==typeof C?JSON.stringify(C):Tt(C)))}p=`{${m.join(", ")}}`}return`${u}${g?"("+g+")":""}[${p}]: ${f.replace(wA,"\n  ")}`}("\n"+f.message,p,u,g),f.ngTokenPath=p,f[Eu]=null,f}(v,l,"R3InjectorError",this.source)}throw v}finally{cs(m),fy(p)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(l=>this.get(l))}toString(){const l=[];return this.records.forEach((g,p)=>l.push(Tt(p))),`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new wt(205,!1)}processInjectorType(l,u,g){if(!(l=tt(l)))return!1;let p=Ev(l);const m=null==p&&l.ngModule||void 0,v=void 0===m?l:m,C=-1!==g.indexOf(v);if(void 0!==m&&(p=Ev(m)),null==p)return!1;if(null!=p.imports&&!C){let L;g.push(v);try{hr(p.imports,N=>{this.processInjectorType(N,u,g)&&(void 0===L&&(L=[]),L.push(N))})}finally{}if(void 0!==L)for(let N=0;N<L.length;N++){const{ngModule:B,providers:j}=L[N];hr(j,W=>this.processProvider(W,B,j||Nt))}}this.injectorDefTypes.add(v);const D=Xs(v)||(()=>new v);this.records.set(v,$o(D,Tl));const O=p.providers;if(null!=O&&!C){const L=l;hr(O,N=>this.processProvider(N,L,O))}return void 0!==m&&void 0!==l.providers}processProvider(l,u,g){let p=Xo(l=tt(l))?l:tt(l&&l.provide);const m=function Y1(f,l,u){return Y0(f)?$o(void 0,f.useValue):$o(z0(f),Tl)}(l);if(Xo(l)||!0!==l.multi)this.records.get(p);else{let v=this.records.get(p);v||(v=$o(void 0,Tl,!0),v.factory=()=>xf(v.multi),this.records.set(p,v)),p=l,v.multi.push(l)}this.records.set(p,m)}hydrate(l,u){return u.value===Tl&&(u.value=H1,u.value=u.factory()),"object"==typeof u.value&&u.value&&function K1(f){return null!==f&&"object"==typeof f&&"function"==typeof f.ngOnDestroy}(u.value)&&this.onDestroy.add(u.value),u.value}injectableDefInScope(l){if(!l.providedIn)return!1;const u=tt(l.providedIn);return"string"==typeof u?"any"===u||u===this.scope:this.injectorDefTypes.has(u)}}function bg(f){const l=$d(f),u=null!==l?l.factory:Xs(f);if(null!==u)return u;if(f instanceof ut)throw new wt(204,!1);if(f instanceof Function)return function z1(f){const l=f.length;if(l>0)throw function dl(f,l){const u=[];for(let g=0;g<f;g++)u.push(l);return u}(l,"?"),new wt(204,!1);const u=function rx(f){const l=f&&(f[eu]||f[bv]);if(l){const u=function sx(f){if(f.hasOwnProperty("name"))return f.name;const l=(""+f).match(/^function\s*([^\s(]+)/);return null===l?"":l[1]}(f);return console.warn(`DEPRECATED: DI is instantiating a token "${u}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${u}" class.`),l}return null}(f);return null!==u?()=>u.factory(f):()=>new f}(f);throw new wt(204,!1)}function z0(f,l,u){let g;if(Xo(f)){const p=tt(f);return Xs(p)||bg(p)}if(Y0(f))g=()=>tt(f.useValue);else if(function X1(f){return!(!f||!f.useFactory)}(f))g=()=>f.useFactory(...xf(f.deps||[]));else if(function $1(f){return!(!f||!f.useExisting)}(f))g=()=>Ye(tt(f.useExisting));else{const p=tt(f&&(f.useClass||f.provide));if(!function Z1(f){return!!f.deps}(f))return Xs(p)||bg(p);g=()=>new p(...xf(f.deps))}return g}function $o(f,l,u=!1){return{factory:f,value:l,multi:u?[]:void 0}}function Y0(f){return null!==f&&"object"==typeof f&&bA in f}function Xo(f){return"function"==typeof f}let Qn=(()=>{class f{static create(u,g){var p;if(Array.isArray(u))return H0({name:""},g,u,"");{const m=null!==(p=u.name)&&void 0!==p?p:"";return H0({name:m},u.parent,u.providers,m)}}}return f.THROW_IF_NOT_FOUND=fl,f.NULL=new U0,f.\u0275prov=vt({token:f,providedIn:"any",factory:()=>Ye(Cg)}),f.__NG_ELEMENT_ID__=-1,f})();function oO(f,l){hu(Bf(f)[1],vn())}function xt(f){let l=function rC(f){return Object.getPrototypeOf(f.prototype).constructor}(f.type),u=!0;const g=[f];for(;l;){let p;if(Hi(f))p=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new wt(903,"");p=l.\u0275dir}if(p){if(u){g.push(p);const v=f;v.inputs=Ig(f.inputs),v.declaredInputs=Ig(f.declaredInputs),v.outputs=Ig(f.outputs);const C=p.hostBindings;C&&uO(f,C);const D=p.viewQuery,O=p.contentQueries;if(D&&lO(f,D),O&&cO(f,O),Wd(f.inputs,p.inputs),Wd(f.declaredInputs,p.declaredInputs),Wd(f.outputs,p.outputs),Hi(p)&&p.data.animation){const L=f.data;L.animation=(L.animation||[]).concat(p.data.animation)}}const m=p.features;if(m)for(let v=0;v<m.length;v++){const C=m[v];C&&C.ngInherit&&C(f),C===xt&&(u=!1)}}l=Object.getPrototypeOf(l)}!function aO(f){let l=0,u=null;for(let g=f.length-1;g>=0;g--){const p=f[g];p.hostVars=l+=p.hostVars,p.hostAttrs=pu(p.hostAttrs,u=pu(u,p.hostAttrs))}}(g)}function Ig(f){return f===So?{}:f===Nt?[]:f}function lO(f,l){const u=f.viewQuery;f.viewQuery=u?(g,p)=>{l(g,p),u(g,p)}:l}function cO(f,l){const u=f.contentQueries;f.contentQueries=u?(g,p,m)=>{l(g,p,m),u(g,p,m)}:l}function uO(f,l){const u=f.hostBindings;f.hostBindings=u?(g,p)=>{l(g,p),u(g,p)}:l}let Bu=null;function qo(){if(!Bu){const f=Ot.Symbol;if(f&&f.iterator)Bu=f.iterator;else{const l=Object.getOwnPropertyNames(Map.prototype);for(let u=0;u<l.length;++u){const g=l[u];"entries"!==g&&"size"!==g&&Map.prototype[g]===Map.prototype.entries&&(Bu=g)}}}return Bu}function xl(f){return!!function Tg(f){return null!==f&&("function"==typeof f||"object"==typeof f)}(f)&&(Array.isArray(f)||!(f instanceof Map)&&qo()in f)}function Bn(f,l,u){return!Object.is(f[l],u)&&(f[l]=u,!0)}function mr(f,l,u,g){const p=_e();return Bn(p,Oo(),l)&&(Et(),gr(Kt(),p,f,l,u,g)),mr}function ys(f,l,u,g,p,m,v,C){const D=_e(),O=Et(),L=f+20,N=O.firstCreatePass?function _O(f,l,u,g,p,m,v,C,D){const O=l.consts,L=Wo(l,f,4,v||null,ds(O,C));fg(l,u,L,ds(O,D)),hu(l,L);const N=L.tViews=Pu(2,L,g,p,m,l.directiveRegistry,l.pipeRegistry,null,l.schemas,O);return null!==l.queries&&(l.queries.template(l,L),N.queries=l.queries.embeddedTView(L)),L}(L,O,D,l,u,g,p,m,v):O.data[L];ur(N,!1);const B=D[11].createComment("");Ru(O,D,B,N),kn(B,D),Nu(D,D[L]=F0(B,D,B,N)),ou(N)&&hg(O,D,N),null!=v&&dg(D,N,C)}function ye(f,l=$e.Default){const u=_e();return null===u?Ye(f,l):ny(vn(),u,tt(f),l)}function Mg(){throw new Error("invalid")}function xn(f,l,u){const g=_e();return Bn(g,Oo(),l)&&function ci(f,l,u,g,p,m,v,C){const D=Si(l,u);let L,O=l.inputs;!C&&null!=O&&(L=O[g])?(j0(f,u,L,g,p),su(l)&&function E1(f,l){const u=oi(l,f);16&u[2]||(u[2]|=64)}(u,l.index)):3&l.type&&(g=function w1(f){return"class"===f?"className":"for"===f?"htmlFor":"formaction"===f?"formAction":"innerHtml"===f?"innerHTML":"readonly"===f?"readOnly":"tabindex"===f?"tabIndex":f}(g),p=null!=v?v(p,l.value||"",g):p,Zt(m)?m.setProperty(D,g,p):vf(g)||(D.setProperty?D.setProperty(g,p):D[g]=p))}(Et(),Kt(),g,f,l,g[11],u,!1),xn}function Lg(f,l,u,g,p){const v=p?"class":"style";j0(f,u,l.inputs[v],v,g)}function Dt(f,l,u,g){const p=_e(),m=Et(),v=20+f,C=p[11],D=p[v]=Yf(C,l,function Zx(){return Ke.lFrame.currentNamespace}()),O=m.firstCreatePass?function VO(f,l,u,g,p,m,v){const C=l.consts,O=Wo(l,f,2,p,ds(C,m));return fg(l,u,O,ds(C,v)),null!==O.attrs&&ku(O,O.attrs,!1),null!==O.mergedAttrs&&ku(O,O.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,O),O}(v,m,p,0,l,u,g):m.data[v];ur(O,!0);const L=O.mergedAttrs;null!==L&&gu(C,D,L);const N=O.classes;null!==N&&Qf(C,D,N);const B=O.styles;return null!==B&&n0(C,D,B),64!=(64&O.flags)&&Ru(m,p,D,O),0===function Lx(){return Ke.lFrame.elementDepthCount}()&&kn(D,p),function Fx(){Ke.lFrame.elementDepthCount++}(),ou(O)&&(hg(m,p,O),function E0(f,l,u){if(ef(l)){const p=l.directiveEnd;for(let m=l.directiveStart;m<p;m++){const v=f.data[m];v.contentQueries&&v.contentQueries(1,u[m],m)}}}(m,O,p)),null!==g&&dg(p,O),Dt}function ft(){let f=vn();hf()?function df(){Ke.lFrame.isParent=!1}():(f=f.parent,ur(f,!1));const l=f;!function Px(){Ke.lFrame.elementDepthCount--}();const u=Et();return u.firstCreatePass&&(hu(u,f),ef(f)&&u.queries.elementEnd(f)),null!=l.classesWithoutHost&&function tA(f){return 0!=(16&f.flags)}(l)&&Lg(u,l,_e(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function nA(f){return 0!=(32&f.flags)}(l)&&Lg(u,l,_e(),l.stylesWithoutHost,!1),ft}function $i(f,l,u,g){return Dt(f,l,u,g),ft(),$i}function Rl(f){return!!f&&"function"==typeof f.then}const Ng=function SC(f){return!!f&&"function"==typeof f.subscribe};function sn(f,l,u,g){const p=_e(),m=Et(),v=vn();return function TC(f,l,u,g,p,m,v,C){const D=ou(g),L=f.firstCreatePass&&k0(f),N=l[8],B=N0(l);let j=!0;if(3&g.type||C){const $=Si(g,l),q=C?C($):$,X=B.length,Q=C?pe=>C(cn(pe[g.index])):g.index;if(Zt(u)){let pe=null;if(!C&&D&&(pe=function GO(f,l,u,g){const p=f.cleanup;if(null!=p)for(let m=0;m<p.length-1;m+=2){const v=p[m];if(v===u&&p[m+1]===g){const C=l[7],D=p[m+2];return C.length>D?C[D]:null}"string"==typeof v&&(m+=2)}return null}(f,l,p,g.index)),null!==pe)(pe.__ngLastListenerFn__||pe).__ngNextListenerFn__=m,pe.__ngLastListenerFn__=m,j=!1;else{m=kg(g,l,N,m,!1);const ve=u.listen(q,p,m);B.push(m,ve),L&&L.push(p,Q,X,X+1)}}else m=kg(g,l,N,m,!0),q.addEventListener(p,m,v),B.push(m),L&&L.push(p,Q,X,v)}else m=kg(g,l,N,m,!1);const W=g.outputs;let Y;if(j&&null!==W&&(Y=W[p])){const $=Y.length;if($)for(let q=0;q<$;q+=2){const Te=l[Y[q]][Y[q+1]].subscribe(m),Ae=B.length;B.push(m,Te),L&&L.push(p,g.index,Ae,-(Ae+1))}}}(m,p,p[11],v,f,l,!!u,g),sn}function xC(f,l,u,g){try{return!1!==u(g)}catch(p){return V0(f,p),!1}}function kg(f,l,u,g,p){return function m(v){if(v===Function)return g;const C=2&f.flags?oi(f.index,l):l;0==(32&l[2])&&mg(C);let D=xC(l,0,g,v),O=m.__ngNextListenerFn__;for(;O;)D=xC(l,0,O,v)&&D,O=O.__ngNextListenerFn__;return p&&!1===D&&(v.preventDefault(),v.returnValue=!1),D}}function Ks(f=1){return function Wx(f){return(Ke.lFrame.contextLView=function zx(f,l){for(;f>0;)l=l[15],f--;return l}(f,Ke.lFrame.contextLView))[8]}(f)}function BC(f,l,u,g,p){const m=f[u+1],v=null===l;let C=g?zi(m):Pr(m),D=!1;for(;0!==C&&(!1===D||v);){const L=f[C+1];XO(f[C],l)&&(D=!0,f[C+1]=g?tg(L):Jf(L)),C=g?zi(L):Pr(L)}D&&(f[u+1]=g?Jf(m):tg(m))}function XO(f,l){return null===f||null==l||(Array.isArray(f)?f[1]:f)===l||!(!Array.isArray(f)||"string"!=typeof l)&&Vo(f,l)>=0}function Uu(f,l){return function Xi(f,l,u,g){const p=_e(),m=Et(),v=function Fr(f){const l=Ke.lFrame,u=l.bindingIndex;return l.bindingIndex=l.bindingIndex+f,u}(2);m.firstUpdatePass&&function $C(f,l,u,g){const p=f.data;if(null===p[u+1]){const m=p[Gn()],v=function YC(f,l){return l>=f.expandoStartIndex}(f,u);(function KC(f,l){return 0!=(f.flags&(l?16:32))})(m,g)&&null===l&&!v&&(l=!1),l=function iM(f,l,u,g){const p=function gf(f){const l=Ke.lFrame.currentDirectiveIndex;return-1===l?null:f[l]}(f);let m=g?l.residualClasses:l.residualStyles;if(null===p)0===(g?l.classBindings:l.styleBindings)&&(u=Ol(u=Vg(null,f,l,u,g),l.attrs,g),m=null);else{const v=l.directiveStylingLast;if(-1===v||f[v]!==p)if(u=Vg(p,f,l,u,g),null===m){let D=function rM(f,l,u){const g=u?l.classBindings:l.styleBindings;if(0!==Pr(g))return f[zi(g)]}(f,l,g);void 0!==D&&Array.isArray(D)&&(D=Vg(null,f,l,D[1],g),D=Ol(D,l.attrs,g),function sM(f,l,u,g){f[zi(u?l.classBindings:l.styleBindings)]=g}(f,l,g,D))}else m=function oM(f,l,u){let g;const p=l.directiveEnd;for(let m=1+l.directiveStylingLast;m<p;m++)g=Ol(g,f[m].hostAttrs,u);return Ol(g,l.attrs,u)}(f,l,g)}return void 0!==m&&(g?l.residualClasses=m:l.residualStyles=m),u}(p,m,l,g),function YO(f,l,u,g,p,m){let v=m?l.classBindings:l.styleBindings,C=zi(v),D=Pr(v);f[g]=u;let L,O=!1;if(Array.isArray(u)){const N=u;L=N[1],(null===L||Vo(N,L)>0)&&(O=!0)}else L=u;if(p)if(0!==D){const B=zi(f[C+1]);f[g+1]=Mu(B,C),0!==B&&(f[B+1]=eg(f[B+1],g)),f[C+1]=function r1(f,l){return 131071&f|l<<17}(f[C+1],g)}else f[g+1]=Mu(C,0),0!==C&&(f[C+1]=eg(f[C+1],g)),C=g;else f[g+1]=Mu(D,0),0===C?C=g:f[D+1]=eg(f[D+1],g),D=g;O&&(f[g+1]=Jf(f[g+1])),BC(f,L,g,!0),BC(f,L,g,!1),function $O(f,l,u,g,p){const m=p?f.residualClasses:f.residualStyles;null!=m&&"string"==typeof l&&Vo(m,l)>=0&&(u[g+1]=tg(u[g+1]))}(l,L,f,g,m),v=Mu(C,D),m?l.classBindings=v:l.styleBindings=v}(p,m,l,u,v,g)}}(m,f,v,g),l!==Qe&&Bn(p,v,l)&&function qC(f,l,u,g,p,m,v,C){if(!(3&l.type))return;const D=f.data,O=D[C+1];Gu(function d0(f){return 1==(1&f)}(O)?ZC(D,l,u,p,Pr(O),v):void 0)||(Gu(m)||function h0(f){return 2==(2&f)}(O)&&(m=ZC(D,null,u,p,C,v)),function YR(f,l,u,g,p){const m=Zt(f);if(l)p?m?f.addClass(u,g):u.classList.add(g):m?f.removeClass(u,g):u.classList.remove(g);else{let v=-1===g.indexOf("-")?void 0:li.DashCase;if(null==p)m?f.removeStyle(u,g,v):u.style.removeProperty(g);else{const C="string"==typeof p&&p.endsWith("!important");C&&(p=p.slice(0,-10),v|=li.Important),m?f.setStyle(u,g,p,v):u.style.setProperty(g,p,C?"important":"")}}}(g,v,au(Gn(),u),p,m))}(m,m.data[Gn()],p,p[11],f,p[v+1]=function cM(f,l){return null==f||("string"==typeof l?f+=l:"object"==typeof f&&(f=Tt(ms(f)))),f}(l,u),g,v)}(f,l,null,!0),Uu}function Vg(f,l,u,g,p){let m=null;const v=u.directiveEnd;let C=u.directiveStylingLast;for(-1===C?C=u.directiveStart:C++;C<v&&(m=l[C],g=Ol(g,m.hostAttrs,p),m!==f);)C++;return null!==f&&(u.directiveStylingLast=C),g}function Ol(f,l,u){const g=u?1:2;let p=-1;if(null!==l)for(let m=0;m<l.length;m++){const v=l[m];"number"==typeof v?p=v:p===g&&(Array.isArray(f)||(f=void 0===f?[]:["",f]),ai(f,v,!!u||l[++m]))}return void 0===f?null:f}function ZC(f,l,u,g,p,m){const v=null===l;let C;for(;p>0;){const D=f[p],O=Array.isArray(D),L=O?D[1]:D,N=null===L;let B=u[p+1];B===Qe&&(B=N?Nt:void 0);let j=N?Sf(B,g):L===g?B:void 0;if(O&&!Gu(j)&&(j=Sf(D,g)),Gu(j)&&(C=j,v))return C;const W=f[p+1];p=v?zi(W):Pr(W)}if(null!==l){let D=m?l.residualClasses:l.residualStyles;null!=D&&(C=Sf(D,g))}return C}function Gu(f){return void 0!==f}function An(f,l=""){const u=_e(),g=Et(),p=f+20,m=g.firstCreatePass?Wo(g,p,1,l,null):g.data[p],v=u[p]=function zf(f,l){return Zt(f)?f.createText(l):f.createTextNode(l)}(u[11],l);Ru(g,u,v,m),ur(m,!1)}function Cs(f,l,u){const g=_e(),p=function Ko(f,l,u,g){return Bn(f,Oo(),u)?l+Ze(u)+g:Qe}(g,f,l,u);return p!==Qe&&Nr(g,Gn(),p),Cs}const Hu="en-US";let Cw=Hu;function Gg(f,l,u,g,p){if(f=tt(f),Array.isArray(f))for(let m=0;m<f.length;m++)Gg(f[m],l,u,g,p);else{const m=Et(),v=_e();let C=Xo(f)?f:tt(f.provide),D=z0(f);const O=vn(),L=1048575&O.providerIndexes,N=O.directiveStart,B=O.providerIndexes>>20;if(Xo(f)||!f.multi){const j=new sl(D,p,ye),W=Wg(C,l,p?L:L+B,N);-1===W?(vu(al(O,v),m,C),Hg(m,f,l.length),l.push(C),O.directiveStart++,O.directiveEnd++,p&&(O.providerIndexes+=1048576),u.push(j),v.push(j)):(u[W]=j,v[W]=j)}else{const j=Wg(C,l,L+B,N),W=Wg(C,l,L,L+B),Y=j>=0&&u[j],$=W>=0&&u[W];if(p&&!$||!p&&!Y){vu(al(O,v),m,C);const q=function xL(f,l,u,g,p){const m=new sl(f,u,ye);return m.multi=[],m.index=l,m.componentProviders=0,Ww(m,p,g&&!u),m}(p?TL:IL,u.length,p,g,D);!p&&$&&(u[W].providerFactory=q),Hg(m,f,l.length,0),l.push(C),O.directiveStart++,O.directiveEnd++,p&&(O.providerIndexes+=1048576),u.push(q),v.push(q)}else Hg(m,f,j>-1?j:W,Ww(u[p?W:j],D,!p&&g));!p&&g&&$&&u[W].componentProviders++}}}function Hg(f,l,u,g){const p=Xo(l),m=function q1(f){return!!f.useClass}(l);if(p||m){const D=(m?tt(l.useClass):l).prototype.ngOnDestroy;if(D){const O=f.destroyHooks||(f.destroyHooks=[]);if(!p&&l.multi){const L=O.indexOf(u);-1===L?O.push(u,[g,D]):O[L+1].push(g,D)}else O.push(u,D)}}}function Ww(f,l,u){return u&&f.componentProviders++,f.multi.push(l)-1}function Wg(f,l,u,g){for(let p=u;p<g;p++)if(l[p]===f)return p;return-1}function IL(f,l,u,g){return zg(this.multi,[])}function TL(f,l,u,g){const p=this.multi;let m;if(this.providerFactory){const v=this.providerFactory.componentProviders,C=ll(u,u[1],this.providerFactory.index,g);m=C.slice(0,v),zg(p,m);for(let D=v;D<C.length;D++)m.push(C[D])}else m=[],zg(p,m);return m}function zg(f,l){for(let u=0;u<f.length;u++)l.push((0,f[u])());return l}function Yt(f,l=[]){return u=>{u.providersResolver=(g,p)=>function SL(f,l,u){const g=Et();if(g.firstCreatePass){const p=Hi(f);Gg(u,g.data,g.blueprint,p,!0),Gg(l,g.data,g.blueprint,p,!1)}}(g,p?p(f):f,l)}}class zw{}class OL{resolveComponentFactory(l){throw function RL(f){const l=Error(`No component factory found for ${Tt(f)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=f,l}(l)}}let Nl=(()=>{class f{}return f.NULL=new OL,f})();function ML(){return ca(vn(),_e())}function ca(f,l){return new ui(Si(f,l))}let ui=(()=>{class f{constructor(u){this.nativeElement=u}}return f.__NG_ELEMENT_ID__=ML,f})();class $w{}let kr=(()=>{class f{}return f.__NG_ELEMENT_ID__=()=>function PL(){const f=_e(),u=oi(vn().index,f);return function FL(f){return f[11]}(cr(u)?u:f)}(),f})(),NL=(()=>{class f{}return f.\u0275prov=vt({token:f,providedIn:"root",factory:()=>null}),f})();class kl{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const kL=new kl("13.3.10"),Yg={};function Xu(f,l,u,g,p=!1){for(;null!==u;){const m=l[u.index];if(null!==m&&g.push(cn(m)),Gi(m))for(let C=10;C<m.length;C++){const D=m[C],O=D[1].firstChild;null!==O&&Xu(D[1],D,O,g)}const v=u.type;if(8&v)Xu(f,l,u.child,g);else if(32&v){const C=Gf(u,l);let D;for(;D=C();)g.push(D)}else if(16&v){const C=Jy(l,u);if(Array.isArray(C))g.push(...C);else{const D=bl(l[16]);Xu(D[1],D,C,g,!0)}}u=p?u.projectionNext:u.next}return g}class Bl{constructor(l,u){this._lView=l,this._cdRefInjectingView=u,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const l=this._lView,u=l[1];return Xu(u,l,u.firstChild,[])}get context(){return this._lView[8]}set context(l){this._lView[8]=l}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[3];if(Gi(l)){const u=l[8],g=u?u.indexOf(this):-1;g>-1&&($f(l,g),Cu(u,g))}this._attachedToViewContainer=!1}Wy(this._lView[1],this._lView)}onDestroy(l){!function I0(f,l,u,g){const p=N0(l);null===u?p.push(g):(p.push(u),f.firstCreatePass&&k0(f).push(g,p.length-1))}(this._lView[1],this._lView,null,l)}markForCheck(){mg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function vg(f,l,u){const g=l[10];g.begin&&g.begin();try{Yo(f,l,f.template,u)}catch(p){throw V0(l,p),p}finally{g.end&&g.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new wt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function NR(f,l){Dl(f,l,l[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new wt(902,"");this._appRef=l}}class BL extends Bl{constructor(l){super(l),this._view=l}detectChanges(){P0(this._view)}checkNoChanges(){}get context(){return null}}class Xw extends Nl{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const u=Fn(l);return new $g(u,this.ngModule)}}function qw(f){const l=[];for(let u in f)f.hasOwnProperty(u)&&l.push({propName:f[u],templateName:u});return l}class $g extends zw{constructor(l,u){super(),this.componentDef=l,this.ngModule=u,this.componentType=l.type,this.selector=function n1(f){return f.map(t1).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!u}get inputs(){return qw(this.componentDef.inputs)}get outputs(){return qw(this.componentDef.outputs)}create(l,u,g,p){const m=(p=p||this.ngModule)?function jL(f,l){return{get:(u,g,p)=>{const m=f.get(u,Yg,p);return m!==Yg||g===Yg?m:l.get(u,g,p)}}}(l,p.injector):l,v=m.get($w,Fv),C=m.get(NL,null),D=v.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",L=g?function S0(f,l,u){if(Zt(f))return f.selectRootElement(l,u===or.ShadowDom);let g="string"==typeof l?f.querySelector(l):l;return g.textContent="",g}(D,g,this.componentDef.encapsulation):Yf(v.createRenderer(null,this.componentDef),O,function VL(f){const l=f.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(O)),N=this.componentDef.onPush?576:528,B=function iC(f,l){return{components:[],scheduler:f||xR,clean:j1,playerHandler:l||null,flags:0}}(),j=Pu(0,null,null,1,0,null,null,null,null,null),W=Sl(null,j,B,N,null,null,v,D,C,m);let Y,$;cu(W);try{const q=function tC(f,l,u,g,p,m){const v=u[1];u[20]=f;const D=Wo(v,20,2,"#host",null),O=D.mergedAttrs=l.hostAttrs;null!==O&&(ku(D,O,!0),null!==f&&(gu(p,f,O),null!==D.classes&&Qf(p,f,D.classes),null!==D.styles&&n0(p,f,D.styles)));const L=g.createRenderer(f,l),N=Sl(u,b0(l),null,l.onPush?64:16,u[20],D,g,L,m||null,null);return v.firstCreatePass&&(vu(al(D,u),v,l.type),O0(v,D),M0(D,u.length,1)),Nu(u,N),u[20]=N}(L,this.componentDef,W,v,D);if(L)if(g)gu(D,L,["ng-version",kL.full]);else{const{attrs:X,classes:Q}=function i1(f){const l=[],u=[];let g=1,p=2;for(;g<f.length;){let m=f[g];if("string"==typeof m)2===p?""!==m&&l.push(m,f[++g]):8===p&&u.push(m);else{if(!Wi(p))break;p=m}g++}return{attrs:l,classes:u}}(this.componentDef.selectors[0]);X&&gu(D,L,X),Q&&Q.length>0&&Qf(D,L,Q.join(" "))}if($=lf(j,20),void 0!==u){const X=$.projection=[];for(let Q=0;Q<this.ngContentSelectors.length;Q++){const pe=u[Q];X.push(null!=pe?Array.from(pe):null)}}Y=function nC(f,l,u,g,p){const m=u[1],v=function D1(f,l,u){const g=vn();f.firstCreatePass&&(u.providersResolver&&u.providersResolver(u),L0(f,g,l,zo(f,l,1,null),u));const p=ll(l,f,g.directiveStart,g);kn(p,l);const m=Si(g,l);return m&&kn(m,l),p}(m,u,l);if(g.components.push(v),f[8]=v,p&&p.forEach(D=>D(v,l)),l.contentQueries){const D=vn();l.contentQueries(1,v,D.directiveStart)}const C=vn();return!m.firstCreatePass||null===l.hostBindings&&null===l.hostAttrs||(fs(C.index),A0(u[1],C,0,C.directiveStart,C.directiveEnd,l),R0(l,v)),v}(q,this.componentDef,W,B,[oO]),Il(j,W,null)}finally{uu()}return new GL(this.componentType,Y,ca($,W),W,$)}}class GL extends class AL{}{constructor(l,u,g,p,m){super(),this.location=g,this._rootLView=p,this._tNode=m,this.instance=u,this.hostView=this.changeDetectorRef=new BL(p),this.componentType=l}get injector(){return new Fo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}class Br{}class Zw{}const ua=new Map;class Jw extends Br{constructor(l,u){super(),this._parent=u,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Xw(this);const g=wi(l);this._bootstrapComponents=fr(g.bootstrap),this._r3Injector=W0(l,u,[{provide:Br,useValue:this},{provide:Nl,useValue:this.componentFactoryResolver}],Tt(l)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(l)}get(l,u=Qn.THROW_IF_NOT_FOUND,g=$e.Default){return l===Qn||l===Br||l===Cg?this:this._r3Injector.get(l,u,g)}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(u=>u()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class Xg extends Zw{constructor(l){super(),this.moduleType=l,null!==wi(l)&&function WL(f){const l=new Set;!function u(g){const p=wi(g,!0),m=p.id;null!==m&&(function Kw(f,l,u){if(l&&l!==u)throw new Error(`Duplicate module registered for ${f} - ${Tt(l)} vs ${Tt(l.name)}`)}(m,ua.get(m),g),ua.set(m,g));const v=fr(p.imports);for(const C of v)l.has(C)||(l.add(C),u(C))}(f)}(l)}create(l){return new Jw(this.moduleType,l)}}function ha(f,l,u){const g=function Un(){const f=Ke.lFrame;let l=f.bindingRootIndex;return-1===l&&(l=f.bindingRootIndex=f.tView.bindingStartIndex),l}()+f,p=_e();return p[g]===Qe?function pr(f,l,u){return f[l]=u}(p,g,u?l.call(u):l()):function Al(f,l){return f[l]}(p,g)}function qg(f){return l=>{setTimeout(f,void 0,l)}}const Jt=class aF extends xr{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,u,g){var p,m,v;let C=l,D=u||(()=>null),O=g;if(l&&"object"==typeof l){const N=l;C=null===(p=N.next)||void 0===p?void 0:p.bind(N),D=null===(m=N.error)||void 0===m?void 0:m.bind(N),O=null===(v=N.complete)||void 0===v?void 0:v.bind(N)}this.__isAsync&&(D=qg(D),C&&(C=qg(C)),O&&(O=qg(O)));const L=super.subscribe({next:C,error:D,complete:O});return l instanceof Ci&&l.add(L),L}};Symbol;let Vr=(()=>{class f{}return f.__NG_ELEMENT_ID__=hF,f})();const cF=Vr,uF=class extends cF{constructor(l,u,g){super(),this._declarationLView=l,this._declarationTContainer=u,this.elementRef=g}createEmbeddedView(l){const u=this._declarationTContainer.tViews,g=Sl(this._declarationLView,u,l,16,null,u.declTNode,null,null,null,null);g[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(g[19]=m.createEmbeddedView(u)),Il(u,g,l),new Bl(g)}};function hF(){return function qu(f,l){return 4&f.type?new uF(l,f,ca(f,l)):null}(vn(),_e())}let Zi=(()=>{class f{}return f.__NG_ELEMENT_ID__=dF,f})();function dF(){return function aE(f,l){let u;const g=l[f.index];if(Gi(g))u=g;else{let p;if(8&f.type)p=cn(g);else{const m=l[11];p=m.createComment("");const v=Si(f,l);qs(m,Au(m,v),p,function HR(f,l){return Zt(f)?f.nextSibling(l):l.nextSibling}(m,v),!1)}l[f.index]=u=F0(g,l,p,f),Nu(l,u)}return new sE(u,f,l)}(vn(),_e())}const fF=Zi,sE=class extends fF{constructor(l,u,g){super(),this._lContainer=l,this._hostTNode=u,this._hostLView=g}get element(){return ca(this._hostTNode,this._hostLView)}get injector(){return new Fo(this._hostTNode,this._hostLView)}get parentInjector(){const l=_u(this._hostTNode,this._hostLView);if(Kv(l)){const u=Lo(l,this._hostLView),g=Mo(l);return new Fo(u[1].data[g+8],u)}return new Fo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const u=oE(this._lContainer);return null!==u&&u[l]||null}get length(){return this._lContainer.length-10}createEmbeddedView(l,u,g){const p=l.createEmbeddedView(u||{});return this.insert(p,g),p}createComponent(l,u,g,p,m){const v=l&&!function hl(f){return"function"==typeof f}(l);let C;if(v)C=u;else{const N=u||{};C=N.index,g=N.injector,p=N.projectableNodes,m=N.ngModuleRef}const D=v?l:new $g(Fn(l)),O=g||this.parentInjector;if(!m&&null==D.ngModule){const B=(v?O:this.parentInjector).get(Br,null);B&&(m=B)}const L=D.create(O,p,void 0,m);return this.insert(L.hostView,C),L}insert(l,u){const g=l._lView,p=g[1];if(function Mx(f){return Gi(f[3])}(g)){const L=this.indexOf(l);if(-1!==L)this.detach(L);else{const N=g[3],B=new sE(N,N[6],N[3]);B.detach(B.indexOf(l))}}const m=this._adjustIndex(u),v=this._lContainer;!function BR(f,l,u,g){const p=10+g,m=u.length;g>0&&(u[p-1][4]=l),g<m-10?(l[4]=u[p],ay(u,10+g,l)):(u.push(l),l[4]=null),l[3]=u;const v=l[17];null!==v&&u!==v&&function VR(f,l){const u=f[9];l[16]!==l[3][3][16]&&(f[2]=!0),null===u?f[9]=[l]:u.push(l)}(v,l);const C=l[19];null!==C&&C.insertView(f),l[2]|=128}(p,g,v,m);const C=Zf(m,v),D=g[11],O=Au(D,v[7]);return null!==O&&function PR(f,l,u,g,p,m){g[0]=p,g[6]=l,Dl(f,g,u,1,p,m)}(p,v[6],D,g,O,C),l.attachToViewContainerRef(),ay(Kg(v),m,l),l}move(l,u){return this.insert(l,u)}indexOf(l){const u=oE(this._lContainer);return null!==u?u.indexOf(l):-1}remove(l){const u=this._adjustIndex(l,-1),g=$f(this._lContainer,u);g&&(Cu(Kg(this._lContainer),u),Wy(g[1],g))}detach(l){const u=this._adjustIndex(l,-1),g=$f(this._lContainer,u);return g&&null!=Cu(Kg(this._lContainer),u)?new Bl(g):null}_adjustIndex(l,u=0){return null==l?this.length+u:l}};function oE(f){return f[8]}function Kg(f){return f[8]||(f[8]=[])}function Qu(...f){}const hp=new ut("Application Initializer");let dp=(()=>{class f{constructor(u){this.appInits=u,this.resolve=Qu,this.reject=Qu,this.initialized=!1,this.done=!1,this.donePromise=new Promise((g,p)=>{this.resolve=g,this.reject=p})}runInitializers(){if(this.initialized)return;const u=[],g=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let p=0;p<this.appInits.length;p++){const m=this.appInits[p]();if(Rl(m))u.push(m);else if(Ng(m)){const v=new Promise((C,D)=>{m.subscribe({complete:C,error:D})});u.push(v)}}Promise.all(u).then(()=>{g()}).catch(p=>{this.reject(p)}),0===u.length&&g(),this.initialized=!0}}return f.\u0275fac=function(u){return new(u||f)(Ye(hp,8))},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const Gl=new ut("AppId",{providedIn:"root",factory:function AE(){return`${fp()}${fp()}${fp()}`}});function fp(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const RE=new ut("Platform Initializer"),OE=new ut("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ME=new ut("appBootstrapListener");let jF=(()=>{class f{log(u){console.log(u)}warn(u){console.warn(u)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();const ws=new ut("LocaleId",{providedIn:"root",factory:()=>SA(ws,$e.Optional|$e.SkipSelf)||function UF(){return"undefined"!=typeof $localize&&$localize.locale||Hu}()});class HF{constructor(l,u){this.ngModuleFactory=l,this.componentFactories=u}}let LE=(()=>{class f{compileModuleSync(u){return new Xg(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){const g=this.compileModuleSync(u),m=fr(wi(u).declarations).reduce((v,C)=>{const D=Fn(C);return D&&v.push(new $g(D)),v},[]);return new HF(g,m)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const zF=(()=>Promise.resolve(0))();function gp(f){"undefined"==typeof Zone?zF.then(()=>{f&&f.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",f)}class Rn{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:u=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Jt(!1),this.onMicrotaskEmpty=new Jt(!1),this.onStable=new Jt(!1),this.onError=new Jt(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const p=this;p._nesting=0,p._outer=p._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(p._inner=p._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(p._inner=p._inner.fork(Zone.longStackTraceZoneSpec)),p.shouldCoalesceEventChangeDetection=!g&&u,p.shouldCoalesceRunChangeDetection=g,p.lastRequestAnimationFrameId=-1,p.nativeRequestAnimationFrame=function YF(){let f=Ot.requestAnimationFrame,l=Ot.cancelAnimationFrame;if("undefined"!=typeof Zone&&f&&l){const u=f[Zone.__symbol__("OriginalDelegate")];u&&(f=u);const g=l[Zone.__symbol__("OriginalDelegate")];g&&(l=g)}return{nativeRequestAnimationFrame:f,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function qF(f){const l=()=>{!function XF(f){f.isCheckStableRunning||-1!==f.lastRequestAnimationFrameId||(f.lastRequestAnimationFrameId=f.nativeRequestAnimationFrame.call(Ot,()=>{f.fakeTopEventTask||(f.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{f.lastRequestAnimationFrameId=-1,mp(f),f.isCheckStableRunning=!0,pp(f),f.isCheckStableRunning=!1},void 0,()=>{},()=>{})),f.fakeTopEventTask.invoke()}),mp(f))}(f)};f._inner=f._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(u,g,p,m,v,C)=>{try{return FE(f),u.invokeTask(p,m,v,C)}finally{(f.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||f.shouldCoalesceRunChangeDetection)&&l(),PE(f)}},onInvoke:(u,g,p,m,v,C,D)=>{try{return FE(f),u.invoke(p,m,v,C,D)}finally{f.shouldCoalesceRunChangeDetection&&l(),PE(f)}},onHasTask:(u,g,p,m)=>{u.hasTask(p,m),g===p&&("microTask"==m.change?(f._hasPendingMicrotasks=m.microTask,mp(f),pp(f)):"macroTask"==m.change&&(f.hasPendingMacrotasks=m.macroTask))},onHandleError:(u,g,p,m)=>(u.handleError(p,m),f.runOutsideAngular(()=>f.onError.emit(m)),!1)})}(p)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Rn.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Rn.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(l,u,g){return this._inner.run(l,u,g)}runTask(l,u,g,p){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+p,l,$F,Qu,Qu);try{return m.runTask(v,u,g)}finally{m.cancelTask(v)}}runGuarded(l,u,g){return this._inner.runGuarded(l,u,g)}runOutsideAngular(l){return this._outer.run(l)}}const $F={};function pp(f){if(0==f._nesting&&!f.hasPendingMicrotasks&&!f.isStable)try{f._nesting++,f.onMicrotaskEmpty.emit(null)}finally{if(f._nesting--,!f.hasPendingMicrotasks)try{f.runOutsideAngular(()=>f.onStable.emit(null))}finally{f.isStable=!0}}}function mp(f){f.hasPendingMicrotasks=!!(f._hasPendingMicrotasks||(f.shouldCoalesceEventChangeDetection||f.shouldCoalesceRunChangeDetection)&&-1!==f.lastRequestAnimationFrameId)}function FE(f){f._nesting++,f.isStable&&(f.isStable=!1,f.onUnstable.emit(null))}function PE(f){f._nesting--,pp(f)}class ZF{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Jt,this.onMicrotaskEmpty=new Jt,this.onStable=new Jt,this.onError=new Jt}run(l,u,g){return l.apply(u,g)}runGuarded(l,u,g){return l.apply(u,g)}runOutsideAngular(l){return l()}runTask(l,u,g,p){return l.apply(u,g)}}let _p=(()=>{class f{constructor(u){this._ngZone=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),u.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Rn.assertNotInAngularZone(),gp(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())gp(()=>{for(;0!==this._callbacks.length;){let u=this._callbacks.pop();clearTimeout(u.timeoutId),u.doneCb(this._didWork)}this._didWork=!1});else{let u=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>!g.updateCb||!g.updateCb(u)||(clearTimeout(g.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(u=>({source:u.source,creationLocation:u.creationLocation,data:u.data})):[]}addCallback(u,g,p){let m=-1;g&&g>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),u(this._didWork,this.getPendingTasks())},g)),this._callbacks.push({doneCb:u,timeoutId:m,updateCb:p})}whenStable(u,g,p){if(p&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(u,g,p),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(u,g,p){return[]}}return f.\u0275fac=function(u){return new(u||f)(Ye(Rn))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})(),KF=(()=>{class f{constructor(){this._applications=new Map,vp.addToWindow(this)}registerApplication(u,g){this._applications.set(u,g)}unregisterApplication(u){this._applications.delete(u)}unregisterAllApplications(){this._applications.clear()}getTestability(u){return this._applications.get(u)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(u,g=!0){return vp.findTestabilityInTree(this,u,g)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();class QF{addToWindow(l){}findTestabilityInTree(l,u,g){return null}}let vp=new QF,Js=null;const NE=new ut("AllowMultipleToken"),kE=new ut("PlatformOnDestroy");class BE{constructor(l,u){this.name=l,this.token=u}}function VE(f,l,u=[]){const g=`Platform: ${l}`,p=new ut(g);return(m=[])=>{let v=yp();if(!v||v.injector.get(NE,!1)){const C=[...u,...m,{provide:p,useValue:!0}];f?f(C):function nP(f){if(Js&&!Js.get(NE,!1))throw new wt(400,"");Js=f;const l=f.get(jE),u=f.get(RE,null);u&&u.forEach(g=>g())}(function rP(f=[],l){return Qn.create({name:l,providers:[{provide:wg,useValue:"platform"},{provide:kE,useValue:()=>Js=null},...f]})}(C,g))}return function iP(f){const l=yp();if(!l)throw new wt(401,"");return l}()}}function yp(){var f;return null!==(f=null==Js?void 0:Js.get(jE))&&void 0!==f?f:null}let jE=(()=>{class f{constructor(u){this._injector=u,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(u,g){const C=function sP(f,l){let u;return u="noop"===f?new ZF:("zone.js"===f?void 0:f)||new Rn({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==l?void 0:l.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==l?void 0:l.ngZoneRunCoalescing)}),u}(g?g.ngZone:void 0,{ngZoneEventCoalescing:g&&g.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:g&&g.ngZoneRunCoalescing||!1}),D=[{provide:Rn,useValue:C}];return C.run(()=>{const O=Qn.create({providers:D,parent:this.injector,name:u.moduleType.name}),L=u.create(O),N=L.injector.get(El,null);if(!N)throw new wt(402,"");return C.runOutsideAngular(()=>{const B=C.onError.subscribe({next:j=>{N.handleError(j)}});L.onDestroy(()=>{wp(this._modules,L),B.unsubscribe()})}),function oP(f,l,u){try{const g=u();return Rl(g)?g.catch(p=>{throw l.runOutsideAngular(()=>f.handleError(p)),p}):g}catch(g){throw l.runOutsideAngular(()=>f.handleError(g)),g}}(N,C,()=>{const B=L.injector.get(dp);return B.runInitializers(),B.donePromise.then(()=>(function FM(f){ri(f,"Expected localeId to be defined"),"string"==typeof f&&(Cw=f.toLowerCase().replace(/_/g,"-"))}(L.injector.get(ws,Hu)||Hu),this._moduleDoBootstrap(L),L))})})}bootstrapModule(u,g=[]){const p=UE({},g);return function eP(f,l,u){const g=new Xg(u);return Promise.resolve(g)}(0,0,u).then(m=>this.bootstrapModuleFactory(m,p))}_moduleDoBootstrap(u){const g=u.injector.get(Cp);if(u._bootstrapComponents.length>0)u._bootstrapComponents.forEach(p=>g.bootstrap(p));else{if(!u.instance.ngDoBootstrap)throw new wt(403,"");u.instance.ngDoBootstrap(g)}this._modules.push(u)}onDestroy(u){this._destroyListeners.push(u)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new wt(404,"");this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());const u=this._injector.get(kE,null);null==u||u(),this._destroyed=!0}get destroyed(){return this._destroyed}}return f.\u0275fac=function(u){return new(u||f)(Ye(Qn))},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();function UE(f,l){return Array.isArray(l)?l.reduce(UE,f):Object.assign(Object.assign({},f),l)}let Cp=(()=>{class f{constructor(u,g,p,m){this._zone=u,this._injector=g,this._exceptionHandler=p,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new ln(D=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{D.next(this._stable),D.complete()})}),C=new ln(D=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{Rn.assertNotInAngularZone(),gp(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,D.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{Rn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{D.next(!1)}))});return()=>{O.unsubscribe(),L.unsubscribe()}});this.isStable=function KT(...f){const l=Ja(f),u=function WT(f,l){return"number"==typeof Gd(f)?f.pop():l}(f,1/0),g=f;return g.length?1===g.length?sr(g[0]):Qa(u)(Dn(g,l)):Rr}(v,C.pipe(function QT(f={}){const{connector:l=(()=>new xr),resetOnError:u=!0,resetOnComplete:g=!0,resetOnRefCountZero:p=!0}=f;return m=>{let v=null,C=null,D=null,O=0,L=!1,N=!1;const B=()=>{null==C||C.unsubscribe(),C=null},j=()=>{B(),v=D=null,L=N=!1},W=()=>{const Y=v;j(),null==Y||Y.unsubscribe()};return In((Y,$)=>{O++,!N&&!L&&B();const q=D=null!=D?D:l();$.add(()=>{O--,0===O&&!N&&!L&&(C=Hd(W,p))}),q.subscribe($),v||(v=new Zc({next:X=>q.next(X),error:X=>{N=!0,B(),C=Hd(j,u,X),q.error(X)},complete:()=>{L=!0,B(),C=Hd(j,g),q.complete()}}),Dn(Y).subscribe(v))})(m)}}()))}bootstrap(u,g){if(!this._initStatus.done)throw new wt(405,"");let p;p=u instanceof zw?u:this._injector.get(Nl).resolveComponentFactory(u),this.componentTypes.push(p.componentType);const m=function tP(f){return f.isBoundToModule}(p)?void 0:this._injector.get(Br),C=p.create(Qn.NULL,[],g||p.selector,m),D=C.location.nativeElement,O=C.injector.get(_p,null),L=O&&C.injector.get(KF);return O&&L&&L.registerApplication(D,O),C.onDestroy(()=>{this.detachView(C.hostView),wp(this.components,C),L&&L.unregisterApplication(D)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new wt(101,"");try{this._runningTick=!0;for(let u of this._views)u.detectChanges()}catch(u){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(u))}finally{this._runningTick=!1}}attachView(u){const g=u;this._views.push(g),g.attachToAppRef(this)}detachView(u){const g=u;wp(this._views,g),g.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u),this._injector.get(ME,[]).concat(this._bootstrapListeners).forEach(p=>p(u))}ngOnDestroy(){this._views.slice().forEach(u=>u.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return f.\u0275fac=function(u){return new(u||f)(Ye(Rn),Ye(Qn),Ye(El),Ye(dp))},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();function wp(f,l){const u=f.indexOf(l);u>-1&&f.splice(u,1)}let HE=!0,Ju=(()=>{class f{}return f.__NG_ELEMENT_ID__=cP,f})();function cP(f){return function uP(f,l,u){if(su(f)&&!u){const g=oi(f.index,l);return new Bl(g,g)}return 47&f.type?new Bl(l[16],l):null}(vn(),_e(),16==(16&f))}class XE{constructor(){}supports(l){return xl(l)}create(l){return new mP(l)}}const pP=(f,l)=>l;class mP{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||pP}forEachItem(l){let u;for(u=this._itHead;null!==u;u=u._next)l(u)}forEachOperation(l){let u=this._itHead,g=this._removalsHead,p=0,m=null;for(;u||g;){const v=!g||u&&u.currentIndex<ZE(g,p,m)?u:g,C=ZE(v,p,m),D=v.currentIndex;if(v===g)p--,g=g._nextRemoved;else if(u=u._next,null==v.previousIndex)p++;else{m||(m=[]);const O=C-p,L=D-p;if(O!=L){for(let B=0;B<O;B++){const j=B<m.length?m[B]:m[B]=0,W=j+B;L<=W&&W<O&&(m[B]=j+1)}m[v.previousIndex]=L-O}}C!==D&&l(v,C,D)}}forEachPreviousItem(l){let u;for(u=this._previousItHead;null!==u;u=u._nextPrevious)l(u)}forEachAddedItem(l){let u;for(u=this._additionsHead;null!==u;u=u._nextAdded)l(u)}forEachMovedItem(l){let u;for(u=this._movesHead;null!==u;u=u._nextMoved)l(u)}forEachRemovedItem(l){let u;for(u=this._removalsHead;null!==u;u=u._nextRemoved)l(u)}forEachIdentityChange(l){let u;for(u=this._identityChangesHead;null!==u;u=u._nextIdentityChange)l(u)}diff(l){if(null==l&&(l=[]),!xl(l))throw new wt(900,"");return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let p,m,v,u=this._itHead,g=!1;if(Array.isArray(l)){this.length=l.length;for(let C=0;C<this.length;C++)m=l[C],v=this._trackByFn(C,m),null!==u&&Object.is(u.trackById,v)?(g&&(u=this._verifyReinsertion(u,m,v,C)),Object.is(u.item,m)||this._addIdentityChange(u,m)):(u=this._mismatch(u,m,v,C),g=!0),u=u._next}else p=0,function mO(f,l){if(Array.isArray(f))for(let u=0;u<f.length;u++)l(f[u]);else{const u=f[qo()]();let g;for(;!(g=u.next()).done;)l(g.value)}}(l,C=>{v=this._trackByFn(p,C),null!==u&&Object.is(u.trackById,v)?(g&&(u=this._verifyReinsertion(u,C,v,p)),Object.is(u.item,C)||this._addIdentityChange(u,C)):(u=this._mismatch(u,C,v,p),g=!0),u=u._next,p++}),this.length=p;return this._truncate(u),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,u,g,p){let m;return null===l?m=this._itTail:(m=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._reinsertAfter(l,m,p)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(g,p))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._moveAfter(l,m,p)):l=this._addAfter(new _P(u,g),m,p),l}_verifyReinsertion(l,u,g,p){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==m?l=this._reinsertAfter(m,l._prev,p):l.currentIndex!=p&&(l.currentIndex=p,this._addToMoves(l,p)),l}_truncate(l){for(;null!==l;){const u=l._next;this._addToRemovals(this._unlink(l)),l=u}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,u,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const p=l._prevRemoved,m=l._nextRemoved;return null===p?this._removalsHead=m:p._nextRemoved=m,null===m?this._removalsTail=p:m._prevRemoved=p,this._insertAfter(l,u,g),this._addToMoves(l,g),l}_moveAfter(l,u,g){return this._unlink(l),this._insertAfter(l,u,g),this._addToMoves(l,g),l}_addAfter(l,u,g){return this._insertAfter(l,u,g),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,u,g){const p=null===u?this._itHead:u._next;return l._next=p,l._prev=u,null===p?this._itTail=l:p._prev=l,null===u?this._itHead=l:u._next=l,null===this._linkedRecords&&(this._linkedRecords=new qE),this._linkedRecords.put(l),l.currentIndex=g,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const u=l._prev,g=l._next;return null===u?this._itHead=g:u._next=g,null===g?this._itTail=u:g._prev=u,l}_addToMoves(l,u){return l.previousIndex===u||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new qE),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,u){return l.item=u,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class _P{constructor(l,u){this.item=l,this.trackById=u,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class vP{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,u){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===u||u<=g.currentIndex)&&Object.is(g.trackById,l))return g;return null}remove(l){const u=l._prevDup,g=l._nextDup;return null===u?this._head=g:u._nextDup=g,null===g?this._tail=u:g._prevDup=u,null===this._head}}class qE{constructor(){this.map=new Map}put(l){const u=l.trackById;let g=this.map.get(u);g||(g=new vP,this.map.set(u,g)),g.add(l)}get(l,u){const p=this.map.get(l);return p?p.get(l,u):null}remove(l){const u=l.trackById;return this.map.get(u).remove(l)&&this.map.delete(u),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function ZE(f,l,u){const g=f.previousIndex;if(null===g)return g;let p=0;return u&&g<u.length&&(p=u[g]),g+l+p}function QE(){return new nh([new XE])}let nh=(()=>{class f{constructor(u){this.factories=u}static create(u,g){if(null!=g){const p=g.factories.slice();u=u.concat(p)}return new f(u)}static extend(u){return{provide:f,useFactory:g=>f.create(u,g||QE()),deps:[[f,new ml,new ps]]}}find(u){const g=this.factories.find(p=>p.supports(u));if(null!=g)return g;throw new wt(901,"")}}return f.\u0275prov=vt({token:f,providedIn:"root",factory:QE}),f})();const bP=VE(null,"core",[]);let DP=(()=>{class f{constructor(u){}}return f.\u0275fac=function(u){return new(u||f)(Ye(Cp))},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({}),f})(),ih=null;function yr(){return ih}const xi=new ut("DocumentToken");let to=(()=>{class f{historyGo(u){throw new Error("Not implemented")}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:function(){return function xP(){return Ye(eb)}()},providedIn:"platform"}),f})();const AP=new ut("Location Initialized");let eb=(()=>{class f extends to{constructor(u){super(),this._doc=u,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return yr().getBaseHref(this._doc)}onPopState(u){const g=yr().getGlobalEventTarget(this._doc,"window");return g.addEventListener("popstate",u,!1),()=>g.removeEventListener("popstate",u)}onHashChange(u){const g=yr().getGlobalEventTarget(this._doc,"window");return g.addEventListener("hashchange",u,!1),()=>g.removeEventListener("hashchange",u)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(u){this.location.pathname=u}pushState(u,g,p){tb()?this._history.pushState(u,g,p):this.location.hash=p}replaceState(u,g,p){tb()?this._history.replaceState(u,g,p):this.location.hash=p}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}}return f.\u0275fac=function(u){return new(u||f)(Ye(xi))},f.\u0275prov=vt({token:f,factory:function(){return function RP(){return new eb(Ye(xi))}()},providedIn:"platform"}),f})();function tb(){return!!window.history.pushState}function Ip(f,l){if(0==f.length)return l;if(0==l.length)return f;let u=0;return f.endsWith("/")&&u++,l.startsWith("/")&&u++,2==u?f+l.substring(1):1==u?f+l:f+"/"+l}function nb(f){const l=f.match(/#|\?|$/),u=l&&l.index||f.length;return f.slice(0,u-("/"===f[u-1]?1:0))+f.slice(u)}function jr(f){return f&&"?"!==f[0]?"?"+f:f}let fa=(()=>{class f{historyGo(u){throw new Error("Not implemented")}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:function(){return function OP(f){const l=Ye(xi).location;return new ib(Ye(to),l&&l.origin||"")}()},providedIn:"root"}),f})();const Tp=new ut("appBaseHref");let ib=(()=>{class f extends fa{constructor(u,g){if(super(),this._platformLocation=u,this._removeListenerFns=[],null==g&&(g=this._platformLocation.getBaseHrefFromDOM()),null==g)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=g}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return Ip(this._baseHref,u)}path(u=!1){const g=this._platformLocation.pathname+jr(this._platformLocation.search),p=this._platformLocation.hash;return p&&u?`${g}${p}`:g}pushState(u,g,p,m){const v=this.prepareExternalUrl(p+jr(m));this._platformLocation.pushState(u,g,v)}replaceState(u,g,p,m){const v=this.prepareExternalUrl(p+jr(m));this._platformLocation.replaceState(u,g,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformLocation).historyGo)||void 0===p||p.call(g,u)}}return f.\u0275fac=function(u){return new(u||f)(Ye(to),Ye(Tp,8))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})(),MP=(()=>{class f extends fa{constructor(u,g){super(),this._platformLocation=u,this._baseHref="",this._removeListenerFns=[],null!=g&&(this._baseHref=g)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}path(u=!1){let g=this._platformLocation.hash;return null==g&&(g="#"),g.length>0?g.substring(1):g}prepareExternalUrl(u){const g=Ip(this._baseHref,u);return g.length>0?"#"+g:g}pushState(u,g,p,m){let v=this.prepareExternalUrl(p+jr(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(u,g,v)}replaceState(u,g,p,m){let v=this.prepareExternalUrl(p+jr(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(u,g,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformLocation).historyGo)||void 0===p||p.call(g,u)}}return f.\u0275fac=function(u){return new(u||f)(Ye(to),Ye(Tp,8))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})(),xp=(()=>{class f{constructor(u,g){this._subject=new Jt,this._urlChangeListeners=[],this._platformStrategy=u;const p=this._platformStrategy.getBaseHref();this._platformLocation=g,this._baseHref=nb(rb(p)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(u=!1){return this.normalize(this._platformStrategy.path(u))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(u,g=""){return this.path()==this.normalize(u+jr(g))}normalize(u){return f.stripTrailingSlash(function FP(f,l){return f&&l.startsWith(f)?l.substring(f.length):l}(this._baseHref,rb(u)))}prepareExternalUrl(u){return u&&"/"!==u[0]&&(u="/"+u),this._platformStrategy.prepareExternalUrl(u)}go(u,g="",p=null){this._platformStrategy.pushState(p,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+jr(g)),p)}replaceState(u,g="",p=null){this._platformStrategy.replaceState(p,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+jr(g)),p)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformStrategy).historyGo)||void 0===p||p.call(g,u)}onUrlChange(u){this._urlChangeListeners.push(u),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(g=>{this._notifyUrlChangeListeners(g.url,g.state)}))}_notifyUrlChangeListeners(u="",g){this._urlChangeListeners.forEach(p=>p(u,g))}subscribe(u,g,p){return this._subject.subscribe({next:u,error:g,complete:p})}}return f.normalizeQueryParams=jr,f.joinWithSlash=Ip,f.stripTrailingSlash=nb,f.\u0275fac=function(u){return new(u||f)(Ye(fa),Ye(to))},f.\u0275prov=vt({token:f,factory:function(){return function LP(){return new xp(Ye(fa),Ye(to))}()},providedIn:"root"}),f})();function rb(f){return f.replace(/\/index.html$/,"")}class CN{constructor(l,u,g,p){this.$implicit=l,this.ngForOf=u,this.index=g,this.count=p}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let fb=(()=>{class f{constructor(u,g,p){this._viewContainer=u,this._template=g,this._differs=p,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(u){this._ngForOf=u,this._ngForOfDirty=!0}set ngForTrackBy(u){this._trackByFn=u}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(u){u&&(this._template=u)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const u=this._ngForOf;!this._differ&&u&&(this._differ=this._differs.find(u).create(this.ngForTrackBy))}if(this._differ){const u=this._differ.diff(this._ngForOf);u&&this._applyChanges(u)}}_applyChanges(u){const g=this._viewContainer;u.forEachOperation((p,m,v)=>{if(null==p.previousIndex)g.createEmbeddedView(this._template,new CN(p.item,this._ngForOf,-1,-1),null===v?void 0:v);else if(null==v)g.remove(null===m?void 0:m);else if(null!==m){const C=g.get(m);g.move(C,v),gb(C,p)}});for(let p=0,m=g.length;p<m;p++){const C=g.get(p).context;C.index=p,C.count=m,C.ngForOf=this._ngForOf}u.forEachIdentityChange(p=>{gb(g.get(p.currentIndex),p)})}static ngTemplateContextGuard(u,g){return!0}}return f.\u0275fac=function(u){return new(u||f)(ye(Zi),ye(Vr),ye(nh))},f.\u0275dir=ze({type:f,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),f})();function gb(f,l){f.context.$implicit=l.item}let pb=(()=>{class f{constructor(u,g){this._viewContainer=u,this._context=new wN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=g}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){mb("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){mb("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,g){return!0}}return f.\u0275fac=function(u){return new(u||f)(ye(Zi),ye(Vr))},f.\u0275dir=ze({type:f,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),f})();class wN{constructor(){this.$implicit=null,this.ngIf=null}}function mb(f,l){if(l&&!l.createEmbeddedView)throw new Error(`${f} must be a TemplateRef, but received '${Tt(l)}'.`)}let XN=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({}),f})();let QN=(()=>{class f{}return f.\u0275prov=vt({token:f,providedIn:"root",factory:()=>new JN(Ye(xi),window)}),f})();class JN{constructor(l,u){this.document=l,this.window=u,this.offset=()=>[0,0]}setOffset(l){this.offset=Array.isArray(l)?()=>l:l}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(l){this.supportsScrolling()&&this.window.scrollTo(l[0],l[1])}scrollToAnchor(l){if(!this.supportsScrolling())return;const u=function ek(f,l){const u=f.getElementById(l)||f.getElementsByName(l)[0];if(u)return u;if("function"==typeof f.createTreeWalker&&f.body&&(f.body.createShadowRoot||f.body.attachShadow)){const g=f.createTreeWalker(f.body,NodeFilter.SHOW_ELEMENT);let p=g.currentNode;for(;p;){const m=p.shadowRoot;if(m){const v=m.getElementById(l)||m.querySelector(`[name="${l}"]`);if(v)return v}p=g.nextNode()}}return null}(this.document,l);u&&(this.scrollToElement(u),u.focus())}setHistoryScrollRestoration(l){if(this.supportScrollRestoration()){const u=this.window.history;u&&u.scrollRestoration&&(u.scrollRestoration=l)}}scrollToElement(l){const u=l.getBoundingClientRect(),g=u.left+this.window.pageXOffset,p=u.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(g-m[0],p-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const l=Cb(this.window.history)||Cb(Object.getPrototypeOf(this.window.history));return!(!l||!l.writable&&!l.set)}catch(l){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(l){return!1}}}function Cb(f){return Object.getOwnPropertyDescriptor(f,"scrollRestoration")}class Gp extends class nk extends class TP{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function IP(f){ih||(ih=f)}(new Gp)}onAndCancel(l,u,g){return l.addEventListener(u,g,!1),()=>{l.removeEventListener(u,g,!1)}}dispatchEvent(l,u){l.dispatchEvent(u)}remove(l){l.parentNode&&l.parentNode.removeChild(l)}createElement(l,u){return(u=u||this.getDefaultDocument()).createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,u){return"window"===u?window:"document"===u?l:"body"===u?l.body:null}getBaseHref(l){const u=function ik(){return Yl=Yl||document.querySelector("base"),Yl?Yl.getAttribute("href"):null}();return null==u?null:function rk(f){fh=fh||document.createElement("a"),fh.setAttribute("href",f);const l=fh.pathname;return"/"===l.charAt(0)?l:`/${l}`}(u)}resetBaseElement(){Yl=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return function _N(f,l){l=encodeURIComponent(l);for(const u of f.split(";")){const g=u.indexOf("="),[p,m]=-1==g?[u,""]:[u.slice(0,g),u.slice(g+1)];if(p.trim()===l)return decodeURIComponent(m)}return null}(document.cookie,l)}}let fh,Yl=null;const wb=new ut("TRANSITION_ID"),ok=[{provide:hp,useFactory:function sk(f,l,u){return()=>{u.get(dp).donePromise.then(()=>{const g=yr(),p=l.querySelectorAll(`style[ng-transition="${f}"]`);for(let m=0;m<p.length;m++)g.remove(p[m])})}},deps:[wb,xi,Qn],multi:!0}];class Hp{static init(){!function JF(f){vp=f}(new Hp)}addToWindow(l){Ot.getAngularTestability=(g,p=!0)=>{const m=l.findTestabilityInTree(g,p);if(null==m)throw new Error("Could not find testability for element.");return m},Ot.getAllAngularTestabilities=()=>l.getAllTestabilities(),Ot.getAllAngularRootElements=()=>l.getAllRootElements(),Ot.frameworkStabilizers||(Ot.frameworkStabilizers=[]),Ot.frameworkStabilizers.push(g=>{const p=Ot.getAllAngularTestabilities();let m=p.length,v=!1;const C=function(D){v=v||D,m--,0==m&&g(v)};p.forEach(function(D){D.whenStable(C)})})}findTestabilityInTree(l,u,g){if(null==u)return null;const p=l.getTestability(u);return null!=p?p:g?yr().isShadowRoot(u)?this.findTestabilityInTree(l,u.host,!0):this.findTestabilityInTree(l,u.parentElement,!0):null}}let ak=(()=>{class f{build(){return new XMLHttpRequest}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();const gh=new ut("EventManagerPlugins");let ph=(()=>{class f{constructor(u,g){this._zone=g,this._eventNameToPlugin=new Map,u.forEach(p=>p.manager=this),this._plugins=u.slice().reverse()}addEventListener(u,g,p){return this._findPluginFor(g).addEventListener(u,g,p)}addGlobalEventListener(u,g,p){return this._findPluginFor(g).addGlobalEventListener(u,g,p)}getZone(){return this._zone}_findPluginFor(u){const g=this._eventNameToPlugin.get(u);if(g)return g;const p=this._plugins;for(let m=0;m<p.length;m++){const v=p[m];if(v.supports(u))return this._eventNameToPlugin.set(u,v),v}throw new Error(`No event manager plugin found for event ${u}`)}}return f.\u0275fac=function(u){return new(u||f)(Ye(gh),Ye(Rn))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();class Eb{constructor(l){this._doc=l}addGlobalEventListener(l,u,g){const p=yr().getGlobalEventTarget(this._doc,l);if(!p)throw new Error(`Unsupported event target ${p} for event ${u}`);return this.addEventListener(p,u,g)}}let bb=(()=>{class f{constructor(){this._stylesSet=new Set}addStyles(u){const g=new Set;u.forEach(p=>{this._stylesSet.has(p)||(this._stylesSet.add(p),g.add(p))}),this.onStylesAdded(g)}onStylesAdded(u){}getAllStyles(){return Array.from(this._stylesSet)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})(),$l=(()=>{class f extends bb{constructor(u){super(),this._doc=u,this._hostNodes=new Map,this._hostNodes.set(u.head,[])}_addStylesToHost(u,g,p){u.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,p.push(g.appendChild(v))})}addHost(u){const g=[];this._addStylesToHost(this._stylesSet,u,g),this._hostNodes.set(u,g)}removeHost(u){const g=this._hostNodes.get(u);g&&g.forEach(Db),this._hostNodes.delete(u)}onStylesAdded(u){this._hostNodes.forEach((g,p)=>{this._addStylesToHost(u,p,g)})}ngOnDestroy(){this._hostNodes.forEach(u=>u.forEach(Db))}}return f.\u0275fac=function(u){return new(u||f)(Ye(xi))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();function Db(f){yr().remove(f)}const Wp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},zp=/%COMP%/g;function mh(f,l,u){for(let g=0;g<l.length;g++){let p=l[g];Array.isArray(p)?mh(f,p,u):(p=p.replace(zp,f),u.push(p))}return u}function Tb(f){return l=>{if("__ngUnwrap__"===l)return f;!1===f(l)&&(l.preventDefault(),l.returnValue=!1)}}let Yp=(()=>{class f{constructor(u,g,p){this.eventManager=u,this.sharedStylesHost=g,this.appId=p,this.rendererByCompId=new Map,this.defaultRenderer=new $p(u)}createRenderer(u,g){if(!u||!g)return this.defaultRenderer;switch(g.encapsulation){case or.Emulated:{let p=this.rendererByCompId.get(g.id);return p||(p=new fk(this.eventManager,this.sharedStylesHost,g,this.appId),this.rendererByCompId.set(g.id,p)),p.applyToHost(u),p}case 1:case or.ShadowDom:return new gk(this.eventManager,this.sharedStylesHost,u,g);default:if(!this.rendererByCompId.has(g.id)){const p=mh(g.id,g.styles,[]);this.sharedStylesHost.addStyles(p),this.rendererByCompId.set(g.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return f.\u0275fac=function(u){return new(u||f)(Ye(ph),Ye($l),Ye(Gl))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();class $p{constructor(l){this.eventManager=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(l,u){return u?document.createElementNS(Wp[u]||u,l):document.createElement(l)}createComment(l){return document.createComment(l)}createText(l){return document.createTextNode(l)}appendChild(l,u){l.appendChild(u)}insertBefore(l,u,g){l&&l.insertBefore(u,g)}removeChild(l,u){l&&l.removeChild(u)}selectRootElement(l,u){let g="string"==typeof l?document.querySelector(l):l;if(!g)throw new Error(`The selector "${l}" did not match any elements`);return u||(g.textContent=""),g}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,u,g,p){if(p){u=p+":"+u;const m=Wp[p];m?l.setAttributeNS(m,u,g):l.setAttribute(u,g)}else l.setAttribute(u,g)}removeAttribute(l,u,g){if(g){const p=Wp[g];p?l.removeAttributeNS(p,u):l.removeAttribute(`${g}:${u}`)}else l.removeAttribute(u)}addClass(l,u){l.classList.add(u)}removeClass(l,u){l.classList.remove(u)}setStyle(l,u,g,p){p&(li.DashCase|li.Important)?l.style.setProperty(u,g,p&li.Important?"important":""):l.style[u]=g}removeStyle(l,u,g){g&li.DashCase?l.style.removeProperty(u):l.style[u]=""}setProperty(l,u,g){l[u]=g}setValue(l,u){l.nodeValue=u}listen(l,u,g){return"string"==typeof l?this.eventManager.addGlobalEventListener(l,u,Tb(g)):this.eventManager.addEventListener(l,u,Tb(g))}}class fk extends $p{constructor(l,u,g,p){super(l),this.component=g;const m=mh(p+"-"+g.id,g.styles,[]);u.addStyles(m),this.contentAttr=function uk(f){return"_ngcontent-%COMP%".replace(zp,f)}(p+"-"+g.id),this.hostAttr=function hk(f){return"_nghost-%COMP%".replace(zp,f)}(p+"-"+g.id)}applyToHost(l){super.setAttribute(l,this.hostAttr,"")}createElement(l,u){const g=super.createElement(l,u);return super.setAttribute(g,this.contentAttr,""),g}}class gk extends $p{constructor(l,u,g,p){super(l),this.sharedStylesHost=u,this.hostEl=g,this.shadowRoot=g.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=mh(p.id,p.styles,[]);for(let v=0;v<m.length;v++){const C=document.createElement("style");C.textContent=m[v],this.shadowRoot.appendChild(C)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(l,u){return super.appendChild(this.nodeOrShadowRoot(l),u)}insertBefore(l,u,g){return super.insertBefore(this.nodeOrShadowRoot(l),u,g)}removeChild(l,u){return super.removeChild(this.nodeOrShadowRoot(l),u)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}}let pk=(()=>{class f extends Eb{constructor(u){super(u)}supports(u){return!0}addEventListener(u,g,p){return u.addEventListener(g,p,!1),()=>this.removeEventListener(u,g,p)}removeEventListener(u,g,p){return u.removeEventListener(g,p)}}return f.\u0275fac=function(u){return new(u||f)(Ye(xi))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();const Ab=["alt","control","meta","shift"],_k={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Rb={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},vk={alt:f=>f.altKey,control:f=>f.ctrlKey,meta:f=>f.metaKey,shift:f=>f.shiftKey};let yk=(()=>{class f extends Eb{constructor(u){super(u)}supports(u){return null!=f.parseEventName(u)}addEventListener(u,g,p){const m=f.parseEventName(g),v=f.eventCallback(m.fullKey,p,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>yr().onAndCancel(u,m.domEventName,v))}static parseEventName(u){const g=u.toLowerCase().split("."),p=g.shift();if(0===g.length||"keydown"!==p&&"keyup"!==p)return null;const m=f._normalizeKey(g.pop());let v="";if(Ab.forEach(D=>{const O=g.indexOf(D);O>-1&&(g.splice(O,1),v+=D+".")}),v+=m,0!=g.length||0===m.length)return null;const C={};return C.domEventName=p,C.fullKey=v,C}static getEventFullKey(u){let g="",p=function Ck(f){let l=f.key;if(null==l){if(l=f.keyIdentifier,null==l)return"Unidentified";l.startsWith("U+")&&(l=String.fromCharCode(parseInt(l.substring(2),16)),3===f.location&&Rb.hasOwnProperty(l)&&(l=Rb[l]))}return _k[l]||l}(u);return p=p.toLowerCase()," "===p?p="space":"."===p&&(p="dot"),Ab.forEach(m=>{m!=p&&vk[m](u)&&(g+=m+".")}),g+=p,g}static eventCallback(u,g,p){return m=>{f.getEventFullKey(m)===u&&p.runGuarded(()=>g(m))}}static _normalizeKey(u){return"esc"===u?"escape":u}}return f.\u0275fac=function(u){return new(u||f)(Ye(xi))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();const Dk=VE(bP,"browser",[{provide:OE,useValue:"browser"},{provide:RE,useValue:function wk(){Gp.makeCurrent(),Hp.init()},multi:!0},{provide:xi,useFactory:function bk(){return function xx(f){of=f}(document),document},deps:[]}]),Sk=[{provide:wg,useValue:"root"},{provide:El,useFactory:function Ek(){return new El},deps:[]},{provide:gh,useClass:pk,multi:!0,deps:[xi,Rn,OE]},{provide:gh,useClass:yk,multi:!0,deps:[xi]},{provide:Yp,useClass:Yp,deps:[ph,$l,Gl]},{provide:$w,useExisting:Yp},{provide:bb,useExisting:$l},{provide:$l,useClass:$l,deps:[xi]},{provide:_p,useClass:_p,deps:[Rn]},{provide:ph,useClass:ph,deps:[gh,Rn]},{provide:class tk{},useClass:ak,deps:[]}];let Ik=(()=>{class f{constructor(u){if(u)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(u){return{ngModule:f,providers:[{provide:Gl,useValue:u.appId},{provide:wb,useExisting:Gl},ok]}}}return f.\u0275fac=function(u){return new(u||f)(Ye(f,12))},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({providers:Sk,imports:[XN,DP]}),f})();"undefined"!=typeof window&&window;const{isArray:kk}=Array,{getPrototypeOf:Bk,prototype:Vk,keys:jk}=Object;function Lb(f){if(1===f.length){const l=f[0];if(kk(l))return{args:l,keys:null};if(function Uk(f){return f&&"object"==typeof f&&Bk(f)===Vk}(l)){const u=jk(l);return{args:u.map(g=>l[g]),keys:u}}}return{args:f,keys:null}}const{isArray:Gk}=Array;function Fb(f){return Vt(l=>function Hk(f,l){return Gk(l)?f(...l):f(l)}(f,l))}function Pb(f,l){return f.reduce((u,g,p)=>(u[g]=l[p],u),{})}let Nb=(()=>{class f{constructor(u,g){this._renderer=u,this._elementRef=g,this.onChange=p=>{},this.onTouched=()=>{}}setProperty(u,g){this._renderer.setProperty(this._elementRef.nativeElement,u,g)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}}return f.\u0275fac=function(u){return new(u||f)(ye(kr),ye(ui))},f.\u0275dir=ze({type:f}),f})(),no=(()=>{class f extends Nb{}return f.\u0275fac=function(){let l;return function(g){return(l||(l=function Nn(f){return us(()=>{const l=f.prototype.constructor,u=l[Mr]||Ef(l),g=Object.prototype;let p=Object.getPrototypeOf(f.prototype).constructor;for(;p&&p!==g;){const m=p[Mr]||Ef(p);if(m&&m!==u)return m;p=Object.getPrototypeOf(p)}return m=>new m})}(f)))(g||f)}}(),f.\u0275dir=ze({type:f,features:[xt]}),f})();const Cr=new ut("NgValueAccessor"),Yk={provide:Cr,useExisting:jt(()=>_h),multi:!0},Xk=new ut("CompositionEventMode");let _h=(()=>{class f extends Nb{constructor(u,g,p){super(u,g),this._compositionMode=p,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function $k(){const f=yr()?yr().getUserAgent():"";return/android (\d+)/.test(f.toLowerCase())}())}writeValue(u){this.setProperty("value",null==u?"":u)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}}return f.\u0275fac=function(u){return new(u||f)(ye(kr),ye(ui),ye(Xk,8))},f.\u0275dir=ze({type:f,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,g){1&u&&sn("input",function(m){return g._handleInput(m.target.value)})("blur",function(){return g.onTouched()})("compositionstart",function(){return g._compositionStart()})("compositionend",function(m){return g._compositionEnd(m.target.value)})},features:[Yt([Yk]),xt]}),f})();const Vn=new ut("NgValidators"),Ds=new ut("NgAsyncValidators");function $b(f){return null!=f}function Xb(f){const l=Rl(f)?Dn(f):f;return Ng(l),l}function qb(f){let l={};return f.forEach(u=>{l=null!=u?Object.assign(Object.assign({},l),u):l}),0===Object.keys(l).length?null:l}function Zb(f,l){return l.map(u=>u(f))}function Kb(f){return f.map(l=>function Zk(f){return!f.validate}(l)?l:u=>l.validate(u))}function qp(f){return null!=f?function Qb(f){if(!f)return null;const l=f.filter($b);return 0==l.length?null:function(u){return qb(Zb(u,l))}}(Kb(f)):null}function Zp(f){return null!=f?function Jb(f){if(!f)return null;const l=f.filter($b);return 0==l.length?null:function(u){return function Wk(...f){const l=mv(f),{args:u,keys:g}=Lb(f),p=new ln(m=>{const{length:v}=u;if(!v)return void m.complete();const C=new Array(v);let D=v,O=v;for(let L=0;L<v;L++){let N=!1;sr(u[L]).subscribe(En(m,B=>{N||(N=!0,O--),C[L]=B},()=>D--,void 0,()=>{(!D||!N)&&(O||m.next(g?Pb(g,C):C),m.complete())}))}});return l?p.pipe(Fb(l)):p}(Zb(u,l).map(Xb)).pipe(Vt(qb))}}(Kb(f)):null}function eD(f,l){return null===f?[l]:Array.isArray(f)?[...f,l]:[f,l]}function Kp(f){return f?Array.isArray(f)?f:[f]:[]}function yh(f,l){return Array.isArray(f)?f.includes(l):f===l}function iD(f,l){const u=Kp(l);return Kp(f).forEach(p=>{yh(u,p)||u.push(p)}),u}function rD(f,l){return Kp(l).filter(u=>!yh(f,u))}class sD{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=qp(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=Zp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l){this.control&&this.control.reset(l)}hasError(l,u){return!!this.control&&this.control.hasError(l,u)}getError(l,u){return this.control?this.control.getError(l,u):null}}class Ss extends sD{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class $n extends sD{get formDirective(){return null}get path(){return null}}let aD=(()=>{class f extends class oD{constructor(l){this._cd=l}is(l){var u,g,p;return"submitted"===l?!!(null===(u=this._cd)||void 0===u?void 0:u.submitted):!!(null===(p=null===(g=this._cd)||void 0===g?void 0:g.control)||void 0===p?void 0:p[l])}}{constructor(u){super(u)}}return f.\u0275fac=function(u){return new(u||f)(ye(Ss,2))},f.\u0275dir=ze({type:f,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,g){2&u&&Uu("ng-untouched",g.is("untouched"))("ng-touched",g.is("touched"))("ng-pristine",g.is("pristine"))("ng-dirty",g.is("dirty"))("ng-valid",g.is("valid"))("ng-invalid",g.is("invalid"))("ng-pending",g.is("pending"))},features:[xt]}),f})();function Xl(f,l){(function em(f,l){const u=function tD(f){return f._rawValidators}(f);null!==l.validator?f.setValidators(eD(u,l.validator)):"function"==typeof u&&f.setValidators([u]);const g=function nD(f){return f._rawAsyncValidators}(f);null!==l.asyncValidator?f.setAsyncValidators(eD(g,l.asyncValidator)):"function"==typeof g&&f.setAsyncValidators([g]);const p=()=>f.updateValueAndValidity();bh(l._rawValidators,p),bh(l._rawAsyncValidators,p)})(f,l),l.valueAccessor.writeValue(f.value),function s2(f,l){l.valueAccessor.registerOnChange(u=>{f._pendingValue=u,f._pendingChange=!0,f._pendingDirty=!0,"change"===f.updateOn&&cD(f,l)})}(f,l),function a2(f,l){const u=(g,p)=>{l.valueAccessor.writeValue(g),p&&l.viewToModelUpdate(g)};f.registerOnChange(u),l._registerOnDestroy(()=>{f._unregisterOnChange(u)})}(f,l),function o2(f,l){l.valueAccessor.registerOnTouched(()=>{f._pendingTouched=!0,"blur"===f.updateOn&&f._pendingChange&&cD(f,l),"submit"!==f.updateOn&&f.markAsTouched()})}(f,l),function r2(f,l){if(l.valueAccessor.setDisabledState){const u=g=>{l.valueAccessor.setDisabledState(g)};f.registerOnDisabledChange(u),l._registerOnDestroy(()=>{f._unregisterOnDisabledChange(u)})}}(f,l)}function bh(f,l){f.forEach(u=>{u.registerOnValidatorChange&&u.registerOnValidatorChange(l)})}function cD(f,l){f._pendingDirty&&f.markAsDirty(),f.setValue(f._pendingValue,{emitModelToViewChange:!1}),l.viewToModelUpdate(f._pendingValue),f._pendingChange=!1}function im(f,l){const u=f.indexOf(l);u>-1&&f.splice(u,1)}const ql="VALID",Sh="INVALID",ga="PENDING",Zl="DISABLED";function sm(f){return(Ih(f)?f.validators:f)||null}function fD(f){return Array.isArray(f)?qp(f):f||null}function om(f,l){return(Ih(l)?l.asyncValidators:f)||null}function gD(f){return Array.isArray(f)?Zp(f):f||null}function Ih(f){return null!=f&&!Array.isArray(f)&&"object"==typeof f}const am=f=>f instanceof cm;function mD(f){return(f=>f instanceof yD)(f)?f.value:f.getRawValue()}function _D(f,l){const u=am(f),g=f.controls;if(!(u?Object.keys(g):g).length)throw new wt(1e3,"");if(!g[l])throw new wt(1001,"")}function vD(f,l){am(f),f._forEachChild((g,p)=>{if(void 0===l[p])throw new wt(1002,"")})}class lm{constructor(l,u){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=l,this._rawAsyncValidators=u,this._composedValidatorFn=fD(this._rawValidators),this._composedAsyncValidatorFn=gD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===ql}get invalid(){return this.status===Sh}get pending(){return this.status==ga}get disabled(){return this.status===Zl}get enabled(){return this.status!==Zl}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._rawValidators=l,this._composedValidatorFn=fD(l)}setAsyncValidators(l){this._rawAsyncValidators=l,this._composedAsyncValidatorFn=gD(l)}addValidators(l){this.setValidators(iD(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(iD(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(rD(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(rD(l,this._rawAsyncValidators))}hasValidator(l){return yh(this._rawValidators,l)}hasAsyncValidator(l){return yh(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(u=>{u.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(u=>{u.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=ga,!1!==l.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=Zl,this.errors=null,this._forEachChild(g=>{g.disable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this._updateValue(),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(g=>g(!0))}enable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=ql,this._forEachChild(g=>{g.enable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(g=>g(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ql||this.status===ga)&&this._runAsyncValidator(l.emitEvent)),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(u=>u._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Zl:ql}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=ga,this._hasOwnPendingAsyncValidator=!0;const u=Xb(this.asyncValidator(this));this._asyncValidationSubscription=u.subscribe(g=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(g,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,u={}){this.errors=l,this._updateControlsErrors(!1!==u.emitEvent)}get(l){return function h2(f,l,u){if(null==l||(Array.isArray(l)||(l=l.split(u)),Array.isArray(l)&&0===l.length))return null;let g=f;return l.forEach(p=>{g=am(g)?g.controls.hasOwnProperty(p)?g.controls[p]:null:(f=>f instanceof f2)(g)&&g.at(p)||null}),g}(this,l,".")}getError(l,u){const g=u?this.get(u):this;return g&&g.errors?g.errors[l]:null}hasError(l,u){return!!this.getError(l,u)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new Jt,this.statusChanges=new Jt}_calculateStatus(){return this._allControlsDisabled()?Zl:this.errors?Sh:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ga)?ga:this._anyControlsHaveStatus(Sh)?Sh:ql}_anyControlsHaveStatus(l){return this._anyControls(u=>u.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_isBoxedValue(l){return"object"==typeof l&&null!==l&&2===Object.keys(l).length&&"value"in l&&"disabled"in l}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){Ih(l)&&null!=l.updateOn&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){return!l&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class yD extends lm{constructor(l=null,u,g){super(sm(u),om(g,u)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(u),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ih(u)&&u.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(l)?l.value:l)}setValue(l,u={}){this.value=this._pendingValue=l,this._onChange.length&&!1!==u.emitModelToViewChange&&this._onChange.forEach(g=>g(this.value,!1!==u.emitViewToModelChange)),this.updateValueAndValidity(u)}patchValue(l,u={}){this.setValue(l,u)}reset(l=this.defaultValue,u={}){this._applyFormState(l),this.markAsPristine(u),this.markAsUntouched(u),this.setValue(this.value,u),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){im(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){im(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(l){this._isBoxedValue(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}}class cm extends lm{constructor(l,u,g){super(sm(u),om(g,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,u){return this.controls[l]?this.controls[l]:(this.controls[l]=u,u.setParent(this),u._registerOnCollectionChange(this._onCollectionChange),u)}addControl(l,u,g={}){this.registerControl(l,u),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}removeControl(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}setControl(l,u,g={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],u&&this.registerControl(l,u),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,u={}){vD(this,l),Object.keys(l).forEach(g=>{_D(this,g),this.controls[g].setValue(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(Object.keys(l).forEach(g=>{this.controls[g]&&this.controls[g].patchValue(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l={},u={}){this._forEachChild((g,p)=>{g.reset(l[p],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this._reduceChildren({},(l,u,g)=>(l[g]=mD(u),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(u,g)=>!!g._syncPendingControls()||u);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(u=>{const g=this.controls[u];g&&l(g,u)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(const u of Object.keys(this.controls)){const g=this.controls[u];if(this.contains(u)&&l(g))return!0}return!1}_reduceValue(){return this._reduceChildren({},(l,u,g)=>((u.enabled||this.disabled)&&(l[g]=u.value),l))}_reduceChildren(l,u){let g=l;return this._forEachChild((p,m)=>{g=u(g,p,m)}),g}_allControlsDisabled(){for(const l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class f2 extends lm{constructor(l,u,g){super(sm(u),om(g,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(l){return this.controls[l]}push(l,u={}){this.controls.push(l),this._registerControl(l),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}insert(l,u,g={}){this.controls.splice(l,0,u),this._registerControl(u),this.updateValueAndValidity({emitEvent:g.emitEvent})}removeAt(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:u.emitEvent})}setControl(l,u,g={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),u&&(this.controls.splice(l,0,u),this._registerControl(u)),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(l,u={}){vD(this,l),l.forEach((g,p)=>{_D(this,p),this.at(p).setValue(g,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(l.forEach((g,p)=>{this.at(p)&&this.at(p).patchValue(g,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l=[],u={}){this._forEachChild((g,p)=>{g.reset(l[p],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this.controls.map(l=>mD(l))}clear(l={}){this.controls.length<1||(this._forEachChild(u=>u._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:l.emitEvent}))}_syncPendingControls(){let l=this.controls.reduce((u,g)=>!!g._syncPendingControls()||u,!1);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){this.controls.forEach((u,g)=>{l(u,g)})}_updateValue(){this.value=this.controls.filter(l=>l.enabled||this.disabled).map(l=>l.value)}_anyControls(l){return this.controls.some(u=>u.enabled&&l(u))}_setUpControls(){this._forEachChild(l=>this._registerControl(l))}_allControlsDisabled(){for(const l of this.controls)if(l.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(l){l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)}}const m2={provide:Ss,useExisting:jt(()=>hm)},ED=(()=>Promise.resolve(null))();let hm=(()=>{class f extends Ss{constructor(u,g,p,m,v){super(),this._changeDetectorRef=v,this.control=new yD,this._registered=!1,this.update=new Jt,this._parent=u,this._setValidators(g),this._setAsyncValidators(p),this.valueAccessor=function nm(f,l){if(!l)return null;let u,g,p;return Array.isArray(l),l.forEach(m=>{m.constructor===_h?u=m:function u2(f){return Object.getPrototypeOf(f.constructor)===no}(m)?g=m:p=m}),p||g||u||null}(0,m)}ngOnChanges(u){if(this._checkForErrors(),!this._registered||"name"in u){if(this._registered&&(this._checkName(),this.formDirective)){const g=u.name.previousValue;this.formDirective.removeControl({name:g,path:this._getPath(g)})}this._setUpControl()}"isDisabled"in u&&this._updateDisabled(u),function tm(f,l){if(!f.hasOwnProperty("model"))return!1;const u=f.model;return!!u.isFirstChange()||!Object.is(l,u.currentValue)}(u,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Xl(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(u){ED.then(()=>{var g;this.control.setValue(u,{emitViewToModelChange:!1}),null===(g=this._changeDetectorRef)||void 0===g||g.markForCheck()})}_updateDisabled(u){const g=u.isDisabled.currentValue,p=""===g||g&&"false"!==g;ED.then(()=>{var m;p&&!this.control.disabled?this.control.disable():!p&&this.control.disabled&&this.control.enable(),null===(m=this._changeDetectorRef)||void 0===m||m.markForCheck()})}_getPath(u){return this._parent?function wh(f,l){return[...l.path,f]}(u,this._parent):[u]}}return f.\u0275fac=function(u){return new(u||f)(ye($n,9),ye(Vn,10),ye(Ds,10),ye(Cr,10),ye(Ju,8))},f.\u0275dir=ze({type:f,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Yt([m2]),xt,bi]}),f})(),DD=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({}),f})(),G2=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({imports:[[DD]]}),f})(),H2=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({imports:[G2]}),f})();function rt(...f){return Dn(f,Ja(f))}class Ji extends xr{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const u=super._subscribe(l);return!u.closed&&l.next(this._value),u}getValue(){const{hasError:l,thrownError:u,_value:g}=this;if(l)throw u;return this._throwIfClosed(),g}next(l){super.next(this._value=l)}}function GD(f,l,u){f?Ar(u,f,l):l()}function Th(f,l){const u=Bt(f)?f:()=>f,g=p=>p.error(u());return new ln(l?p=>l.schedule(g,0,p):g)}const xh=Za(f=>function(){f(this),this.name="EmptyError",this.message="no elements in sequence"});function vm(...f){return function Y2(){return Qa(1)}()(Dn(f,Ja(f)))}function HD(f){return new ln(l=>{sr(f()).subscribe(l)})}function WD(){return In((f,l)=>{let u=null;f._refCount++;const g=En(l,void 0,void 0,void 0,()=>{if(!f||f._refCount<=0||0<--f._refCount)return void(u=null);const p=f._connection,m=u;u=null,p&&(!m||p===m)&&p.unsubscribe(),l.unsubscribe()});f.subscribe(g),g.closed||(u=f.connect())})}class $2 extends ln{constructor(l,u){super(),this.source=l,this.subjectFactory=u,this._subject=null,this._refCount=0,this._connection=null,nv(l)&&(this.lift=l.lift)}_subscribe(l){return this.getSubject().subscribe(l)}getSubject(){const l=this._subject;return(!l||l.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:l}=this;this._subject=this._connection=null,null==l||l.unsubscribe()}connect(){let l=this._connection;if(!l){l=this._connection=new Ci;const u=this.getSubject();l.add(this.source.subscribe(En(u,void 0,()=>{this._teardown(),u.complete()},g=>{this._teardown(),u.error(g)},()=>this._teardown()))),l.closed&&(this._connection=null,l=Ci.EMPTY)}return l}refCount(){return WD()(this)}}function ro(f,l){return In((u,g)=>{let p=null,m=0,v=!1;const C=()=>v&&!p&&g.complete();u.subscribe(En(g,D=>{null==p||p.unsubscribe();let O=0;const L=m++;sr(f(D,L)).subscribe(p=En(g,N=>g.next(l?l(D,N,L,O++):N),()=>{p=null,C()}))},()=>{v=!0,C()}))})}function q2(f,l,u,g,p){return(m,v)=>{let C=u,D=l,O=0;m.subscribe(En(v,L=>{const N=O++;D=C?f(D,L,N):(C=!0,L),g&&v.next(D)},p&&(()=>{C&&v.next(D),v.complete()})))}}function zD(f,l){return In(q2(f,l,arguments.length>=2,!0))}function pa(f,l){return In((u,g)=>{let p=0;u.subscribe(En(g,m=>f.call(l,m,p++)&&g.next(m)))})}function Is(f){return In((l,u)=>{let m,g=null,p=!1;g=l.subscribe(En(u,void 0,void 0,v=>{m=sr(f(v,Is(f)(l))),g?(g.unsubscribe(),g=null,m.subscribe(u)):p=!0})),p&&(g.unsubscribe(),g=null,m.subscribe(u))})}function Ql(f,l){return Bt(l)?bn(f,l,1):bn(f,1)}function ym(f){return f<=0?()=>Rr:In((l,u)=>{let g=[];l.subscribe(En(u,p=>{g.push(p),f<g.length&&g.shift()},()=>{for(const p of g)u.next(p);u.complete()},void 0,()=>{g=null}))})}function YD(f=Z2){return In((l,u)=>{let g=!1;l.subscribe(En(u,p=>{g=!0,u.next(p)},()=>g?u.complete():u.error(f())))})}function Z2(){return new xh}function $D(f){return In((l,u)=>{let g=!1;l.subscribe(En(u,p=>{g=!0,u.next(p)},()=>{g||u.next(f),u.complete()}))})}function ma(f,l){const u=arguments.length>=2;return g=>g.pipe(f?pa((p,m)=>f(p,m,g)):Gs,Qc(1),u?$D(l):YD(()=>new xh))}function hi(f,l,u){const g=Bt(f)||l||u?{next:f,error:l,complete:u}:f;return g?In((p,m)=>{var v;null===(v=g.subscribe)||void 0===v||v.call(g);let C=!0;p.subscribe(En(m,D=>{var O;null===(O=g.next)||void 0===O||O.call(g,D),m.next(D)},()=>{var D;C=!1,null===(D=g.complete)||void 0===D||D.call(g),m.complete()},D=>{var O;C=!1,null===(O=g.error)||void 0===O||O.call(g,D),m.error(D)},()=>{var D,O;C&&(null===(D=g.unsubscribe)||void 0===D||D.call(g)),null===(O=g.finalize)||void 0===O||O.call(g)}))}):Gs}class Gr{constructor(l,u){this.id=l,this.url=u}}class Cm extends Gr{constructor(l,u,g="imperative",p=null){super(l,u),this.navigationTrigger=g,this.restoredState=p}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Jl extends Gr{constructor(l,u,g){super(l,u),this.urlAfterRedirects=g}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class XD extends Gr{constructor(l,u,g){super(l,u),this.reason=g}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class J2 extends Gr{constructor(l,u,g){super(l,u),this.error=g}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class eB extends Gr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tB extends Gr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class nB extends Gr{constructor(l,u,g,p,m){super(l,u),this.urlAfterRedirects=g,this.state=p,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class iB extends Gr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rB extends Gr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qD{constructor(l){this.route=l}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ZD{constructor(l){this.route=l}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class sB{constructor(l){this.snapshot=l}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class oB{constructor(l){this.snapshot=l}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class aB{constructor(l){this.snapshot=l}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lB{constructor(l){this.snapshot=l}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KD{constructor(l,u,g){this.routerEvent=l,this.position=u,this.anchor=g}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ht="primary";class cB{constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u[0]:u}return null}getAll(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u:[u]}return[]}get keys(){return Object.keys(this.params)}}function _a(f){return new cB(f)}const QD="ngNavigationCancelingError";function wm(f){const l=Error("NavigationCancelingError: "+f);return l[QD]=!0,l}function hB(f,l,u){const g=u.path.split("/");if(g.length>f.length||"full"===u.pathMatch&&(l.hasChildren()||g.length<f.length))return null;const p={};for(let m=0;m<g.length;m++){const v=g[m],C=f[m];if(v.startsWith(":"))p[v.substring(1)]=C;else if(v!==C.path)return null}return{consumed:f.slice(0,g.length),posParams:p}}function wr(f,l){const u=f?Object.keys(f):void 0,g=l?Object.keys(l):void 0;if(!u||!g||u.length!=g.length)return!1;let p;for(let m=0;m<u.length;m++)if(p=u[m],!JD(f[p],l[p]))return!1;return!0}function JD(f,l){if(Array.isArray(f)&&Array.isArray(l)){if(f.length!==l.length)return!1;const u=[...f].sort(),g=[...l].sort();return u.every((p,m)=>g[m]===p)}return f===l}function eS(f){return Array.prototype.concat.apply([],f)}function tS(f){return f.length>0?f[f.length-1]:null}function On(f,l){for(const u in f)f.hasOwnProperty(u)&&l(f[u],u)}function Er(f){return Ng(f)?f:Rl(f)?Dn(Promise.resolve(f)):rt(f)}const gB={exact:function rS(f,l,u){if(!oo(f.segments,l.segments)||!Ah(f.segments,l.segments,u)||f.numberOfChildren!==l.numberOfChildren)return!1;for(const g in l.children)if(!f.children[g]||!rS(f.children[g],l.children[g],u))return!1;return!0},subset:sS},nS={exact:function pB(f,l){return wr(f,l)},subset:function mB(f,l){return Object.keys(l).length<=Object.keys(f).length&&Object.keys(l).every(u=>JD(f[u],l[u]))},ignored:()=>!0};function iS(f,l,u){return gB[u.paths](f.root,l.root,u.matrixParams)&&nS[u.queryParams](f.queryParams,l.queryParams)&&!("exact"===u.fragment&&f.fragment!==l.fragment)}function sS(f,l,u){return oS(f,l,l.segments,u)}function oS(f,l,u,g){if(f.segments.length>u.length){const p=f.segments.slice(0,u.length);return!(!oo(p,u)||l.hasChildren()||!Ah(p,u,g))}if(f.segments.length===u.length){if(!oo(f.segments,u)||!Ah(f.segments,u,g))return!1;for(const p in l.children)if(!f.children[p]||!sS(f.children[p],l.children[p],g))return!1;return!0}{const p=u.slice(0,f.segments.length),m=u.slice(f.segments.length);return!!(oo(f.segments,p)&&Ah(f.segments,p,g)&&f.children[ht])&&oS(f.children[ht],l,m,g)}}function Ah(f,l,u){return l.every((g,p)=>nS[u](f[p].parameters,g.parameters))}class so{constructor(l,u,g){this.root=l,this.queryParams=u,this.fragment=g}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_a(this.queryParams)),this._queryParamMap}toString(){return yB.serialize(this)}}class yt{constructor(l,u){this.segments=l,this.children=u,this.parent=null,On(u,(g,p)=>g.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Rh(this)}}class ec{constructor(l,u){this.path=l,this.parameters=u}get parameterMap(){return this._parameterMap||(this._parameterMap=_a(this.parameters)),this._parameterMap}toString(){return hS(this)}}function oo(f,l){return f.length===l.length&&f.every((u,g)=>u.path===l[g].path)}class aS{}class lS{parse(l){const u=new xB(l);return new so(u.parseRootSegment(),u.parseQueryParams(),u.parseFragment())}serialize(l){const u=`/${tc(l.root,!0)}`,g=function EB(f){const l=Object.keys(f).map(u=>{const g=f[u];return Array.isArray(g)?g.map(p=>`${Oh(u)}=${Oh(p)}`).join("&"):`${Oh(u)}=${Oh(g)}`}).filter(u=>!!u);return l.length?`?${l.join("&")}`:""}(l.queryParams);return`${u}${g}${"string"==typeof l.fragment?`#${function CB(f){return encodeURI(f)}(l.fragment)}`:""}`}}const yB=new lS;function Rh(f){return f.segments.map(l=>hS(l)).join("/")}function tc(f,l){if(!f.hasChildren())return Rh(f);if(l){const u=f.children[ht]?tc(f.children[ht],!1):"",g=[];return On(f.children,(p,m)=>{m!==ht&&g.push(`${m}:${tc(p,!1)}`)}),g.length>0?`${u}(${g.join("//")})`:u}{const u=function vB(f,l){let u=[];return On(f.children,(g,p)=>{p===ht&&(u=u.concat(l(g,p)))}),On(f.children,(g,p)=>{p!==ht&&(u=u.concat(l(g,p)))}),u}(f,(g,p)=>p===ht?[tc(f.children[ht],!1)]:[`${p}:${tc(g,!1)}`]);return 1===Object.keys(f.children).length&&null!=f.children[ht]?`${Rh(f)}/${u[0]}`:`${Rh(f)}/(${u.join("//")})`}}function cS(f){return encodeURIComponent(f).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Oh(f){return cS(f).replace(/%3B/gi,";")}function Em(f){return cS(f).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Mh(f){return decodeURIComponent(f)}function uS(f){return Mh(f.replace(/\+/g,"%20"))}function hS(f){return`${Em(f.path)}${function wB(f){return Object.keys(f).map(l=>`;${Em(l)}=${Em(f[l])}`).join("")}(f.parameters)}`}const bB=/^[^\/()?;=#]+/;function Lh(f){const l=f.match(bB);return l?l[0]:""}const DB=/^[^=?&#]+/,IB=/^[^&#]+/;class xB{constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yt([],{}):new yt([],this.parseChildren())}parseQueryParams(){const l={};if(this.consumeOptional("?"))do{this.parseQueryParam(l)}while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let u={};this.peekStartsWith("/(")&&(this.capture("/"),u=this.parseParens(!0));let g={};return this.peekStartsWith("(")&&(g=this.parseParens(!1)),(l.length>0||Object.keys(u).length>0)&&(g[ht]=new yt(l,u)),g}parseSegment(){const l=Lh(this.remaining);if(""===l&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(l),new ec(Mh(l),this.parseMatrixParams())}parseMatrixParams(){const l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){const u=Lh(this.remaining);if(!u)return;this.capture(u);let g="";if(this.consumeOptional("=")){const p=Lh(this.remaining);p&&(g=p,this.capture(g))}l[Mh(u)]=Mh(g)}parseQueryParam(l){const u=function SB(f){const l=f.match(DB);return l?l[0]:""}(this.remaining);if(!u)return;this.capture(u);let g="";if(this.consumeOptional("=")){const v=function TB(f){const l=f.match(IB);return l?l[0]:""}(this.remaining);v&&(g=v,this.capture(g))}const p=uS(u),m=uS(g);if(l.hasOwnProperty(p)){let v=l[p];Array.isArray(v)||(v=[v],l[p]=v),v.push(m)}else l[p]=m}parseParens(l){const u={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const g=Lh(this.remaining),p=this.remaining[g.length];if("/"!==p&&")"!==p&&";"!==p)throw new Error(`Cannot parse url '${this.url}'`);let m;g.indexOf(":")>-1?(m=g.substr(0,g.indexOf(":")),this.capture(m),this.capture(":")):l&&(m=ht);const v=this.parseChildren();u[m]=1===Object.keys(v).length?v[ht]:new yt([],v),this.consumeOptional("//")}return u}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return!!this.peekStartsWith(l)&&(this.remaining=this.remaining.substring(l.length),!0)}capture(l){if(!this.consumeOptional(l))throw new Error(`Expected "${l}".`)}}class dS{constructor(l){this._root=l}get root(){return this._root.value}parent(l){const u=this.pathFromRoot(l);return u.length>1?u[u.length-2]:null}children(l){const u=bm(l,this._root);return u?u.children.map(g=>g.value):[]}firstChild(l){const u=bm(l,this._root);return u&&u.children.length>0?u.children[0].value:null}siblings(l){const u=Dm(l,this._root);return u.length<2?[]:u[u.length-2].children.map(p=>p.value).filter(p=>p!==l)}pathFromRoot(l){return Dm(l,this._root).map(u=>u.value)}}function bm(f,l){if(f===l.value)return l;for(const u of l.children){const g=bm(f,u);if(g)return g}return null}function Dm(f,l){if(f===l.value)return[l];for(const u of l.children){const g=Dm(f,u);if(g.length)return g.unshift(l),g}return[]}class Hr{constructor(l,u){this.value=l,this.children=u}toString(){return`TreeNode(${this.value})`}}function va(f){const l={};return f&&f.children.forEach(u=>l[u.value.outlet]=u),l}class fS extends dS{constructor(l,u){super(l),this.snapshot=u,Sm(this,l)}toString(){return this.snapshot.toString()}}function gS(f,l){const u=function AB(f,l){const v=new Fh([],{},{},"",{},ht,l,null,f.root,-1,{});return new mS("",new Hr(v,[]))}(f,l),g=new Ji([new ec("",{})]),p=new Ji({}),m=new Ji({}),v=new Ji({}),C=new Ji(""),D=new ya(g,p,v,C,m,ht,l,u.root);return D.snapshot=u.root,new fS(new Hr(D,[]),u)}class ya{constructor(l,u,g,p,m,v,C,D){this.url=l,this.params=u,this.queryParams=g,this.fragment=p,this.data=m,this.outlet=v,this.component=C,this._futureSnapshot=D}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Vt(l=>_a(l)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Vt(l=>_a(l)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function pS(f,l="emptyOnly"){const u=f.pathFromRoot;let g=0;if("always"!==l)for(g=u.length-1;g>=1;){const p=u[g],m=u[g-1];if(p.routeConfig&&""===p.routeConfig.path)g--;else{if(m.component)break;g--}}return function RB(f){return f.reduce((l,u)=>({params:Object.assign(Object.assign({},l.params),u.params),data:Object.assign(Object.assign({},l.data),u.data),resolve:Object.assign(Object.assign({},l.resolve),u._resolvedData)}),{params:{},data:{},resolve:{}})}(u.slice(g))}class Fh{constructor(l,u,g,p,m,v,C,D,O,L,N){this.url=l,this.params=u,this.queryParams=g,this.fragment=p,this.data=m,this.outlet=v,this.component=C,this.routeConfig=D,this._urlSegment=O,this._lastPathIndex=L,this._resolve=N}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=_a(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_a(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(g=>g.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mS extends dS{constructor(l,u){super(u),this.url=l,Sm(this,u)}toString(){return _S(this._root)}}function Sm(f,l){l.value._routerState=f,l.children.forEach(u=>Sm(f,u))}function _S(f){const l=f.children.length>0?` { ${f.children.map(_S).join(", ")} } `:"";return`${f.value}${l}`}function Im(f){if(f.snapshot){const l=f.snapshot,u=f._futureSnapshot;f.snapshot=u,wr(l.queryParams,u.queryParams)||f.queryParams.next(u.queryParams),l.fragment!==u.fragment&&f.fragment.next(u.fragment),wr(l.params,u.params)||f.params.next(u.params),function dB(f,l){if(f.length!==l.length)return!1;for(let u=0;u<f.length;++u)if(!wr(f[u],l[u]))return!1;return!0}(l.url,u.url)||f.url.next(u.url),wr(l.data,u.data)||f.data.next(u.data)}else f.snapshot=f._futureSnapshot,f.data.next(f._futureSnapshot.data)}function Tm(f,l){const u=wr(f.params,l.params)&&function _B(f,l){return oo(f,l)&&f.every((u,g)=>wr(u.parameters,l[g].parameters))}(f.url,l.url);return u&&!(!f.parent!=!l.parent)&&(!f.parent||Tm(f.parent,l.parent))}function nc(f,l,u){if(u&&f.shouldReuseRoute(l.value,u.value.snapshot)){const g=u.value;g._futureSnapshot=l.value;const p=function MB(f,l,u){return l.children.map(g=>{for(const p of u.children)if(f.shouldReuseRoute(g.value,p.value.snapshot))return nc(f,g,p);return nc(f,g)})}(f,l,u);return new Hr(g,p)}{if(f.shouldAttach(l.value)){const m=f.retrieve(l.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=l.value,v.children=l.children.map(C=>nc(f,C)),v}}const g=function LB(f){return new ya(new Ji(f.url),new Ji(f.params),new Ji(f.queryParams),new Ji(f.fragment),new Ji(f.data),f.outlet,f.component,f)}(l.value),p=l.children.map(m=>nc(f,m));return new Hr(g,p)}}function Ph(f){return"object"==typeof f&&null!=f&&!f.outlets&&!f.segmentPath}function ic(f){return"object"==typeof f&&null!=f&&f.outlets}function xm(f,l,u,g,p){let m={};if(g&&On(g,(C,D)=>{m[D]=Array.isArray(C)?C.map(O=>`${O}`):`${C}`}),f===l)return new so(u,m,p);const v=vS(f,l,u);return new so(v,m,p)}function vS(f,l,u){const g={};return On(f.children,(p,m)=>{g[m]=p===l?u:vS(p,l,u)}),new yt(f.segments,g)}class yS{constructor(l,u,g){if(this.isAbsolute=l,this.numberOfDoubleDots=u,this.commands=g,l&&g.length>0&&Ph(g[0]))throw new Error("Root segment cannot have matrix parameters");const p=g.find(ic);if(p&&p!==tS(g))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Am{constructor(l,u,g){this.segmentGroup=l,this.processChildren=u,this.index=g}}function CS(f,l,u){if(f||(f=new yt([],{})),0===f.segments.length&&f.hasChildren())return Nh(f,l,u);const g=function VB(f,l,u){let g=0,p=l;const m={match:!1,pathIndex:0,commandIndex:0};for(;p<f.segments.length;){if(g>=u.length)return m;const v=f.segments[p],C=u[g];if(ic(C))break;const D=`${C}`,O=g<u.length-1?u[g+1]:null;if(p>0&&void 0===D)break;if(D&&O&&"object"==typeof O&&void 0===O.outlets){if(!ES(D,O,v))return m;g+=2}else{if(!ES(D,{},v))return m;g++}p++}return{match:!0,pathIndex:p,commandIndex:g}}(f,l,u),p=u.slice(g.commandIndex);if(g.match&&g.pathIndex<f.segments.length){const m=new yt(f.segments.slice(0,g.pathIndex),{});return m.children[ht]=new yt(f.segments.slice(g.pathIndex),f.children),Nh(m,0,p)}return g.match&&0===p.length?new yt(f.segments,{}):g.match&&!f.hasChildren()?Rm(f,l,u):g.match?Nh(f,0,p):Rm(f,l,u)}function Nh(f,l,u){if(0===u.length)return new yt(f.segments,{});{const g=function BB(f){return ic(f[0])?f[0].outlets:{[ht]:f}}(u),p={};return On(g,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(p[v]=CS(f.children[v],l,m))}),On(f.children,(m,v)=>{void 0===g[v]&&(p[v]=m)}),new yt(f.segments,p)}}function Rm(f,l,u){const g=f.segments.slice(0,l);let p=0;for(;p<u.length;){const m=u[p];if(ic(m)){const D=jB(m.outlets);return new yt(g,D)}if(0===p&&Ph(u[0])){g.push(new ec(f.segments[l].path,wS(u[0]))),p++;continue}const v=ic(m)?m.outlets[ht]:`${m}`,C=p<u.length-1?u[p+1]:null;v&&C&&Ph(C)?(g.push(new ec(v,wS(C))),p+=2):(g.push(new ec(v,{})),p++)}return new yt(g,{})}function jB(f){const l={};return On(f,(u,g)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[g]=Rm(new yt([],{}),0,u))}),l}function wS(f){const l={};return On(f,(u,g)=>l[g]=`${u}`),l}function ES(f,l,u){return f==u.path&&wr(l,u.parameters)}class GB{constructor(l,u,g,p){this.routeReuseStrategy=l,this.futureState=u,this.currState=g,this.forwardEvent=p}activate(l){const u=this.futureState._root,g=this.currState?this.currState._root:null;this.deactivateChildRoutes(u,g,l),Im(this.futureState.root),this.activateChildRoutes(u,g,l)}deactivateChildRoutes(l,u,g){const p=va(u);l.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,p[v],g),delete p[v]}),On(p,(m,v)=>{this.deactivateRouteAndItsChildren(m,g)})}deactivateRoutes(l,u,g){const p=l.value,m=u?u.value:null;if(p===m)if(p.component){const v=g.getContext(p.outlet);v&&this.deactivateChildRoutes(l,u,v.children)}else this.deactivateChildRoutes(l,u,g);else m&&this.deactivateRouteAndItsChildren(u,g)}deactivateRouteAndItsChildren(l,u){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,u):this.deactivateRouteAndOutlet(l,u)}detachAndStoreRouteSubtree(l,u){const g=u.getContext(l.value.outlet),p=g&&l.value.component?g.children:u,m=va(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],p);if(g&&g.outlet){const v=g.outlet.detach(),C=g.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:v,route:l,contexts:C})}}deactivateRouteAndOutlet(l,u){const g=u.getContext(l.value.outlet),p=g&&l.value.component?g.children:u,m=va(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],p);g&&g.outlet&&(g.outlet.deactivate(),g.children.onOutletDeactivated(),g.attachRef=null,g.resolver=null,g.route=null)}activateChildRoutes(l,u,g){const p=va(u);l.children.forEach(m=>{this.activateRoutes(m,p[m.value.outlet],g),this.forwardEvent(new lB(m.value.snapshot))}),l.children.length&&this.forwardEvent(new oB(l.value.snapshot))}activateRoutes(l,u,g){const p=l.value,m=u?u.value:null;if(Im(p),p===m)if(p.component){const v=g.getOrCreateContext(p.outlet);this.activateChildRoutes(l,u,v.children)}else this.activateChildRoutes(l,u,g);else if(p.component){const v=g.getOrCreateContext(p.outlet);if(this.routeReuseStrategy.shouldAttach(p.snapshot)){const C=this.routeReuseStrategy.retrieve(p.snapshot);this.routeReuseStrategy.store(p.snapshot,null),v.children.onOutletReAttached(C.contexts),v.attachRef=C.componentRef,v.route=C.route.value,v.outlet&&v.outlet.attach(C.componentRef,C.route.value),Im(C.route.value),this.activateChildRoutes(l,null,v.children)}else{const C=function HB(f){for(let l=f.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig;if(u&&u.component)return null}return null}(p.snapshot),D=C?C.module.componentFactoryResolver:null;v.attachRef=null,v.route=p,v.resolver=D,v.outlet&&v.outlet.activateWith(p,D),this.activateChildRoutes(l,null,v.children)}}else this.activateChildRoutes(l,null,g)}}class Om{constructor(l,u){this.routes=l,this.module=u}}function Ts(f){return"function"==typeof f}function ao(f){return f instanceof so}const rc=Symbol("INITIAL_VALUE");function sc(){return ro(f=>function W2(...f){const l=Ja(f),u=mv(f),{args:g,keys:p}=Lb(f);if(0===g.length)return Dn([],l);const m=new ln(function z2(f,l,u=Gs){return g=>{GD(l,()=>{const{length:p}=f,m=new Array(p);let v=p,C=p;for(let D=0;D<p;D++)GD(l,()=>{const O=Dn(f[D],l);let L=!1;O.subscribe(En(g,N=>{m[D]=N,L||(L=!0,C--),C||g.next(u(m.slice()))},()=>{--v||g.complete()}))},g)},g)}}(g,l,p?v=>Pb(p,v):Gs));return u?m.pipe(Fb(u)):m}(f.map(l=>l.pipe(Qc(1),function X2(...f){const l=Ja(f);return In((u,g)=>{(l?vm(f,u,l):vm(f,u)).subscribe(g)})}(rc)))).pipe(zD((l,u)=>{let g=!1;return u.reduce((p,m,v)=>p!==rc?p:(m===rc&&(g=!0),g||!1!==m&&v!==u.length-1&&!ao(m)?p:m),l)},rc),pa(l=>l!==rc),Vt(l=>ao(l)?l:!0===l),Qc(1)))}class qB{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new oc,this.attachRef=null}}class oc{constructor(){this.contexts=new Map}onChildOutletCreated(l,u){const g=this.getOrCreateContext(l);g.outlet=u,this.contexts.set(l,g)}onChildOutletDestroyed(l){const u=this.getContext(l);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){const l=this.contexts;return this.contexts=new Map,l}onOutletReAttached(l){this.contexts=l}getOrCreateContext(l){let u=this.getContext(l);return u||(u=new qB,this.contexts.set(l,u)),u}getContext(l){return this.contexts.get(l)||null}}let Mm=(()=>{class f{constructor(u,g,p,m,v){this.parentContexts=u,this.location=g,this.resolver=p,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new Jt,this.deactivateEvents=new Jt,this.attachEvents=new Jt,this.detachEvents=new Jt,this.name=m||ht,u.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const u=this.parentContexts.getContext(this.name);u&&u.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,g){this.activated=u,this._activatedRoute=g,this.location.insert(u.hostView),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){const u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,g){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=u;const v=(g=g||this.resolver).resolveComponentFactory(u._futureSnapshot.routeConfig.component),C=this.parentContexts.getOrCreateContext(this.name).children,D=new ZB(u,C,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,D),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return f.\u0275fac=function(u){return new(u||f)(ye(oc),ye(Zi),ye(Nl),function cl(f){return function oA(f,l){if("class"===l)return f.classes;if("style"===l)return f.styles;const u=f.attrs;if(u){const g=u.length;let p=0;for(;p<g;){const m=u[p];if(qv(m))break;if(0===m)p+=2;else if("number"==typeof m)for(p++;p<g&&"string"==typeof u[p];)p++;else{if(m===l)return u[p+1];p+=2}}}return null}(vn(),f)}("name"),ye(Ju))},f.\u0275dir=ze({type:f,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),f})();class ZB{constructor(l,u,g){this.route=l,this.childContexts=u,this.parent=g}get(l,u){return l===ya?this.route:l===oc?this.childContexts:this.parent.get(l,u)}}let bS=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["ng-component"]],decls:1,vars:0,template:function(u,g){1&u&&$i(0,"router-outlet")},directives:[Mm],encapsulation:2}),f})();function DS(f,l=""){for(let u=0;u<f.length;u++){const g=f[u];KB(g,QB(l,g))}}function KB(f,l){f.children&&DS(f.children,l)}function QB(f,l){return l?f||l.path?f&&!l.path?`${f}/`:!f&&l.path?l.path:`${f}/${l.path}`:"":f}function Lm(f){const l=f.children&&f.children.map(Lm),u=l?Object.assign(Object.assign({},f),{children:l}):Object.assign({},f);return!u.component&&(l||u.loadChildren)&&u.outlet&&u.outlet!==ht&&(u.component=bS),u}function Oi(f){return f.outlet||ht}function SS(f,l){const u=f.filter(g=>Oi(g)===l);return u.push(...f.filter(g=>Oi(g)!==l)),u}const IS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function kh(f,l,u){var g;if(""===l.path)return"full"===l.pathMatch&&(f.hasChildren()||u.length>0)?Object.assign({},IS):{matched:!0,consumedSegments:[],remainingSegments:u,parameters:{},positionalParamSegments:{}};const m=(l.matcher||hB)(u,f,l);if(!m)return Object.assign({},IS);const v={};On(m.posParams,(D,O)=>{v[O]=D.path});const C=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:u.slice(m.consumed.length),parameters:C,positionalParamSegments:null!==(g=m.posParams)&&void 0!==g?g:{}}}function Bh(f,l,u,g,p="corrected"){if(u.length>0&&function tV(f,l,u){return u.some(g=>Vh(f,l,g)&&Oi(g)!==ht)}(f,u,g)){const v=new yt(l,function eV(f,l,u,g){const p={};p[ht]=g,g._sourceSegment=f,g._segmentIndexShift=l.length;for(const m of u)if(""===m.path&&Oi(m)!==ht){const v=new yt([],{});v._sourceSegment=f,v._segmentIndexShift=l.length,p[Oi(m)]=v}return p}(f,l,g,new yt(u,f.children)));return v._sourceSegment=f,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:[]}}if(0===u.length&&function nV(f,l,u){return u.some(g=>Vh(f,l,g))}(f,u,g)){const v=new yt(f.segments,function JB(f,l,u,g,p,m){const v={};for(const C of g)if(Vh(f,u,C)&&!p[Oi(C)]){const D=new yt([],{});D._sourceSegment=f,D._segmentIndexShift="legacy"===m?f.segments.length:l.length,v[Oi(C)]=D}return Object.assign(Object.assign({},p),v)}(f,l,u,g,f.children,p));return v._sourceSegment=f,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:u}}const m=new yt(f.segments,f.children);return m._sourceSegment=f,m._segmentIndexShift=l.length,{segmentGroup:m,slicedSegments:u}}function Vh(f,l,u){return(!(f.hasChildren()||l.length>0)||"full"!==u.pathMatch)&&""===u.path}function TS(f,l,u,g){return!!(Oi(f)===g||g!==ht&&Vh(l,u,f))&&("**"===f.path||kh(l,f,u).matched)}function xS(f,l,u){return 0===l.length&&!f.children[u]}class jh{constructor(l){this.segmentGroup=l||null}}class AS{constructor(l){this.urlTree=l}}function ac(f){return Th(new jh(f))}function RS(f){return Th(new AS(f))}class oV{constructor(l,u,g,p,m){this.configLoader=u,this.urlSerializer=g,this.urlTree=p,this.config=m,this.allowRedirects=!0,this.ngModule=l.get(Br)}apply(){const l=Bh(this.urlTree.root,[],[],this.config).segmentGroup,u=new yt(l.segments,l.children);return this.expandSegmentGroup(this.ngModule,this.config,u,ht).pipe(Vt(m=>this.createUrlTree(Fm(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Is(m=>{if(m instanceof AS)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof jh?this.noMatchError(m):m}))}match(l){return this.expandSegmentGroup(this.ngModule,this.config,l.root,ht).pipe(Vt(p=>this.createUrlTree(Fm(p),l.queryParams,l.fragment))).pipe(Is(p=>{throw p instanceof jh?this.noMatchError(p):p}))}noMatchError(l){return new Error(`Cannot match any routes. URL Segment: '${l.segmentGroup}'`)}createUrlTree(l,u,g){const p=l.segments.length>0?new yt([],{[ht]:l}):l;return new so(p,u,g)}expandSegmentGroup(l,u,g,p){return 0===g.segments.length&&g.hasChildren()?this.expandChildren(l,u,g).pipe(Vt(m=>new yt([],m))):this.expandSegment(l,g,u,g.segments,p,!0)}expandChildren(l,u,g){const p=[];for(const m of Object.keys(g.children))"primary"===m?p.unshift(m):p.push(m);return Dn(p).pipe(Ql(m=>{const v=g.children[m],C=SS(u,m);return this.expandSegmentGroup(l,C,v,m).pipe(Vt(D=>({segment:D,outlet:m})))}),zD((m,v)=>(m[v.outlet]=v.segment,m),{}),function K2(f,l){const u=arguments.length>=2;return g=>g.pipe(f?pa((p,m)=>f(p,m,g)):Gs,ym(1),u?$D(l):YD(()=>new xh))}())}expandSegment(l,u,g,p,m,v){return Dn(g).pipe(Ql(C=>this.expandSegmentAgainstRoute(l,u,g,C,p,m,v).pipe(Is(O=>{if(O instanceof jh)return rt(null);throw O}))),ma(C=>!!C),Is((C,D)=>{if(C instanceof xh||"EmptyError"===C.name)return xS(u,p,m)?rt(new yt([],{})):ac(u);throw C}))}expandSegmentAgainstRoute(l,u,g,p,m,v,C){return TS(p,u,m,v)?void 0===p.redirectTo?this.matchSegmentAgainstRoute(l,u,p,m,v):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v):ac(u):ac(u)}expandSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v){return"**"===p.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(l,g,p,v):this.expandRegularSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(l,u,g,p){const m=this.applyRedirectCommands([],g.redirectTo,{});return g.redirectTo.startsWith("/")?RS(m):this.lineralizeSegments(g,m).pipe(bn(v=>{const C=new yt(v,{});return this.expandSegment(l,C,u,v,p,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v){const{matched:C,consumedSegments:D,remainingSegments:O,positionalParamSegments:L}=kh(u,p,m);if(!C)return ac(u);const N=this.applyRedirectCommands(D,p.redirectTo,L);return p.redirectTo.startsWith("/")?RS(N):this.lineralizeSegments(p,N).pipe(bn(B=>this.expandSegment(l,u,g,B.concat(O),v,!1)))}matchSegmentAgainstRoute(l,u,g,p,m){if("**"===g.path)return g.loadChildren?(g._loadedConfig?rt(g._loadedConfig):this.configLoader.load(l.injector,g)).pipe(Vt(N=>(g._loadedConfig=N,new yt(p,{})))):rt(new yt(p,{}));const{matched:v,consumedSegments:C,remainingSegments:D}=kh(u,g,p);return v?this.getChildConfig(l,g,p).pipe(bn(L=>{const N=L.module,B=L.routes,{segmentGroup:j,slicedSegments:W}=Bh(u,C,D,B),Y=new yt(j.segments,j.children);if(0===W.length&&Y.hasChildren())return this.expandChildren(N,B,Y).pipe(Vt(Q=>new yt(C,Q)));if(0===B.length&&0===W.length)return rt(new yt(C,{}));const $=Oi(g)===m;return this.expandSegment(N,Y,B,W,$?ht:m,!0).pipe(Vt(X=>new yt(C.concat(X.segments),X.children)))})):ac(u)}getChildConfig(l,u,g){return u.children?rt(new Om(u.children,l)):u.loadChildren?void 0!==u._loadedConfig?rt(u._loadedConfig):this.runCanLoadGuards(l.injector,u,g).pipe(bn(p=>p?this.configLoader.load(l.injector,u).pipe(Vt(m=>(u._loadedConfig=m,m))):function rV(f){return Th(wm(`Cannot load children because the guard of the route "path: '${f.path}'" returned false`))}(u))):rt(new Om([],l))}runCanLoadGuards(l,u,g){const p=u.canLoad;return p&&0!==p.length?rt(p.map(v=>{const C=l.get(v);let D;if(function zB(f){return f&&Ts(f.canLoad)}(C))D=C.canLoad(u,g);else{if(!Ts(C))throw new Error("Invalid CanLoad guard");D=C(u,g)}return Er(D)})).pipe(sc(),hi(v=>{if(!ao(v))return;const C=wm(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw C.url=v,C}),Vt(v=>!0===v)):rt(!0)}lineralizeSegments(l,u){let g=[],p=u.root;for(;;){if(g=g.concat(p.segments),0===p.numberOfChildren)return rt(g);if(p.numberOfChildren>1||!p.children[ht])return Th(new Error(`Only absolute redirects can have named outlets. redirectTo: '${l.redirectTo}'`));p=p.children[ht]}}applyRedirectCommands(l,u,g){return this.applyRedirectCreatreUrlTree(u,this.urlSerializer.parse(u),l,g)}applyRedirectCreatreUrlTree(l,u,g,p){const m=this.createSegmentGroup(l,u.root,g,p);return new so(m,this.createQueryParams(u.queryParams,this.urlTree.queryParams),u.fragment)}createQueryParams(l,u){const g={};return On(l,(p,m)=>{if("string"==typeof p&&p.startsWith(":")){const C=p.substring(1);g[m]=u[C]}else g[m]=p}),g}createSegmentGroup(l,u,g,p){const m=this.createSegments(l,u.segments,g,p);let v={};return On(u.children,(C,D)=>{v[D]=this.createSegmentGroup(l,C,g,p)}),new yt(m,v)}createSegments(l,u,g,p){return u.map(m=>m.path.startsWith(":")?this.findPosParam(l,m,p):this.findOrReturn(m,g))}findPosParam(l,u,g){const p=g[u.path.substring(1)];if(!p)throw new Error(`Cannot redirect to '${l}'. Cannot find '${u.path}'.`);return p}findOrReturn(l,u){let g=0;for(const p of u){if(p.path===l.path)return u.splice(g),p;g++}return l}}function Fm(f){const l={};for(const g of Object.keys(f.children)){const m=Fm(f.children[g]);(m.segments.length>0||m.hasChildren())&&(l[g]=m)}return function aV(f){if(1===f.numberOfChildren&&f.children[ht]){const l=f.children[ht];return new yt(f.segments.concat(l.segments),l.children)}return f}(new yt(f.segments,l))}class OS{constructor(l){this.path=l,this.route=this.path[this.path.length-1]}}class Uh{constructor(l,u){this.component=l,this.route=u}}function cV(f,l,u){const g=f._root;return lc(g,l?l._root:null,u,[g.value])}function Gh(f,l,u){const g=function hV(f){if(!f)return null;for(let l=f.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig}return null}(l);return(g?g.module.injector:u).get(f)}function lc(f,l,u,g,p={canDeactivateChecks:[],canActivateChecks:[]}){const m=va(l);return f.children.forEach(v=>{(function dV(f,l,u,g,p={canDeactivateChecks:[],canActivateChecks:[]}){const m=f.value,v=l?l.value:null,C=u?u.getContext(f.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const D=function fV(f,l,u){if("function"==typeof u)return u(f,l);switch(u){case"pathParamsChange":return!oo(f.url,l.url);case"pathParamsOrQueryParamsChange":return!oo(f.url,l.url)||!wr(f.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Tm(f,l)||!wr(f.queryParams,l.queryParams);default:return!Tm(f,l)}}(v,m,m.routeConfig.runGuardsAndResolvers);D?p.canActivateChecks.push(new OS(g)):(m.data=v.data,m._resolvedData=v._resolvedData),lc(f,l,m.component?C?C.children:null:u,g,p),D&&C&&C.outlet&&C.outlet.isActivated&&p.canDeactivateChecks.push(new Uh(C.outlet.component,v))}else v&&cc(l,C,p),p.canActivateChecks.push(new OS(g)),lc(f,null,m.component?C?C.children:null:u,g,p)})(v,m[v.value.outlet],u,g.concat([v.value]),p),delete m[v.value.outlet]}),On(m,(v,C)=>cc(v,u.getContext(C),p)),p}function cc(f,l,u){const g=va(f),p=f.value;On(g,(m,v)=>{cc(m,p.component?l?l.children.getContext(v):null:l,u)}),u.canDeactivateChecks.push(new Uh(p.component&&l&&l.outlet&&l.outlet.isActivated?l.outlet.component:null,p))}class EV{}function MS(f){return new ln(l=>l.error(f))}class DV{constructor(l,u,g,p,m,v){this.rootComponentType=l,this.config=u,this.urlTree=g,this.url=p,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const l=Bh(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,u=this.processSegmentGroup(this.config,l,ht);if(null===u)return null;const g=new Fh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},ht,this.rootComponentType,null,this.urlTree.root,-1,{}),p=new Hr(g,u),m=new mS(this.url,p);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(l){const u=l.value,g=pS(u,this.paramsInheritanceStrategy);u.params=Object.freeze(g.params),u.data=Object.freeze(g.data),l.children.forEach(p=>this.inheritParamsAndData(p))}processSegmentGroup(l,u,g){return 0===u.segments.length&&u.hasChildren()?this.processChildren(l,u):this.processSegment(l,u,u.segments,g)}processChildren(l,u){const g=[];for(const m of Object.keys(u.children)){const v=u.children[m],C=SS(l,m),D=this.processSegmentGroup(C,v,m);if(null===D)return null;g.push(...D)}const p=LS(g);return function SV(f){f.sort((l,u)=>l.value.outlet===ht?-1:u.value.outlet===ht?1:l.value.outlet.localeCompare(u.value.outlet))}(p),p}processSegment(l,u,g,p){for(const m of l){const v=this.processSegmentAgainstRoute(m,u,g,p);if(null!==v)return v}return xS(u,g,p)?[]:null}processSegmentAgainstRoute(l,u,g,p){if(l.redirectTo||!TS(l,u,g,p))return null;let m,v=[],C=[];if("**"===l.path){const j=g.length>0?tS(g).parameters:{};m=new Fh(g,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,NS(l),Oi(l),l.component,l,FS(u),PS(u)+g.length,kS(l))}else{const j=kh(u,l,g);if(!j.matched)return null;v=j.consumedSegments,C=j.remainingSegments,m=new Fh(v,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,NS(l),Oi(l),l.component,l,FS(u),PS(u)+v.length,kS(l))}const D=function IV(f){return f.children?f.children:f.loadChildren?f._loadedConfig.routes:[]}(l),{segmentGroup:O,slicedSegments:L}=Bh(u,v,C,D.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===L.length&&O.hasChildren()){const j=this.processChildren(D,O);return null===j?null:[new Hr(m,j)]}if(0===D.length&&0===L.length)return[new Hr(m,[])];const N=Oi(l)===p,B=this.processSegment(D,O,L,N?ht:p);return null===B?null:[new Hr(m,B)]}}function TV(f){const l=f.value.routeConfig;return l&&""===l.path&&void 0===l.redirectTo}function LS(f){const l=[],u=new Set;for(const g of f){if(!TV(g)){l.push(g);continue}const p=l.find(m=>g.value.routeConfig===m.value.routeConfig);void 0!==p?(p.children.push(...g.children),u.add(p)):l.push(g)}for(const g of u){const p=LS(g.children);l.push(new Hr(g.value,p))}return l.filter(g=>!u.has(g))}function FS(f){let l=f;for(;l._sourceSegment;)l=l._sourceSegment;return l}function PS(f){let l=f,u=l._segmentIndexShift?l._segmentIndexShift:0;for(;l._sourceSegment;)l=l._sourceSegment,u+=l._segmentIndexShift?l._segmentIndexShift:0;return u-1}function NS(f){return f.data||{}}function kS(f){return f.resolve||{}}function BS(f){return[...Object.keys(f),...Object.getOwnPropertySymbols(f)]}function Pm(f){return ro(l=>{const u=f(l);return u?Dn(u).pipe(Vt(()=>l)):rt(l)})}class PV extends class FV{shouldDetach(l){return!1}store(l,u){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,u){return l.routeConfig===u.routeConfig}}{}const Nm=new ut("ROUTES");class VS{constructor(l,u,g,p){this.injector=l,this.compiler=u,this.onLoadStartListener=g,this.onLoadEndListener=p}load(l,u){if(u._loader$)return u._loader$;this.onLoadStartListener&&this.onLoadStartListener(u);const p=this.loadModuleFactory(u.loadChildren).pipe(Vt(m=>{this.onLoadEndListener&&this.onLoadEndListener(u);const v=m.create(l);return new Om(eS(v.injector.get(Nm,void 0,$e.Self|$e.Optional)).map(Lm),v)}),Is(m=>{throw u._loader$=void 0,m}));return u._loader$=new $2(p,()=>new xr).pipe(WD()),u._loader$}loadModuleFactory(l){return Er(l()).pipe(bn(u=>u instanceof Zw?rt(u):Dn(this.compiler.compileModuleAsync(u))))}}class kV{shouldProcessUrl(l){return!0}extract(l){return l}merge(l,u){return l}}function BV(f){throw f}function VV(f,l,u){return l.parse("/")}function jS(f,l){return rt(null)}const jV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},UV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let di=(()=>{class f{constructor(u,g,p,m,v,C,D){this.rootComponentType=u,this.urlSerializer=g,this.rootContexts=p,this.location=m,this.config=D,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new xr,this.errorHandler=BV,this.malformedUriErrorHandler=VV,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:jS,afterPreactivation:jS},this.urlHandlingStrategy=new kV,this.routeReuseStrategy=new PV,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Br),this.console=v.get(jF);const N=v.get(Rn);this.isNgZoneEnabled=N instanceof Rn&&Rn.isInAngularZone(),this.resetConfig(D),this.currentUrlTree=function fB(){return new so(new yt([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new VS(v,C,B=>this.triggerEvent(new qD(B)),B=>this.triggerEvent(new ZD(B))),this.routerState=gS(this.currentUrlTree,this.rootComponentType),this.transitions=new Ji({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var u;return null===(u=this.location.getState())||void 0===u?void 0:u.\u0275routerPageId}setupNavigations(u){const g=this.events;return u.pipe(pa(p=>0!==p.id),Vt(p=>Object.assign(Object.assign({},p),{extractedUrl:this.urlHandlingStrategy.extract(p.rawUrl)})),ro(p=>{let m=!1,v=!1;return rt(p).pipe(hi(C=>{this.currentNavigation={id:C.id,initialUrl:C.currentRawUrl,extractedUrl:C.extractedUrl,trigger:C.source,extras:C.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ro(C=>{const D=this.browserUrlTree.toString(),O=!this.navigated||C.extractedUrl.toString()!==D||D!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||O)&&this.urlHandlingStrategy.shouldProcessUrl(C.rawUrl))return US(C.source)&&(this.browserUrlTree=C.extractedUrl),rt(C).pipe(ro(N=>{const B=this.transitions.getValue();return g.next(new Cm(N.id,this.serializeUrl(N.extractedUrl),N.source,N.restoredState)),B!==this.transitions.getValue()?Rr:Promise.resolve(N)}),function lV(f,l,u,g){return ro(p=>function sV(f,l,u,g,p){return new oV(f,l,u,g,p).apply()}(f,l,u,p.extractedUrl,g).pipe(Vt(m=>Object.assign(Object.assign({},p),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),hi(N=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:N.urlAfterRedirects})}),function xV(f,l,u,g,p){return bn(m=>function bV(f,l,u,g,p="emptyOnly",m="legacy"){try{const v=new DV(f,l,u,g,p,m).recognize();return null===v?MS(new EV):rt(v)}catch(v){return MS(v)}}(f,l,m.urlAfterRedirects,u(m.urlAfterRedirects),g,p).pipe(Vt(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,N=>this.serializeUrl(N),this.paramsInheritanceStrategy,this.relativeLinkResolution),hi(N=>{if("eager"===this.urlUpdateStrategy){if(!N.extras.skipLocationChange){const j=this.urlHandlingStrategy.merge(N.urlAfterRedirects,N.rawUrl);this.setBrowserUrl(j,N)}this.browserUrlTree=N.urlAfterRedirects}const B=new eB(N.id,this.serializeUrl(N.extractedUrl),this.serializeUrl(N.urlAfterRedirects),N.targetSnapshot);g.next(B)}));if(O&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:B,extractedUrl:j,source:W,restoredState:Y,extras:$}=C,q=new Cm(B,this.serializeUrl(j),W,Y);g.next(q);const X=gS(j,this.rootComponentType).snapshot;return rt(Object.assign(Object.assign({},C),{targetSnapshot:X,urlAfterRedirects:j,extras:Object.assign(Object.assign({},$),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=C.rawUrl,C.resolve(null),Rr}),Pm(C=>{const{targetSnapshot:D,id:O,extractedUrl:L,rawUrl:N,extras:{skipLocationChange:B,replaceUrl:j}}=C;return this.hooks.beforePreactivation(D,{navigationId:O,appliedUrlTree:L,rawUrlTree:N,skipLocationChange:!!B,replaceUrl:!!j})}),hi(C=>{const D=new tB(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(D)}),Vt(C=>Object.assign(Object.assign({},C),{guards:cV(C.targetSnapshot,C.currentSnapshot,this.rootContexts)})),function gV(f,l){return bn(u=>{const{targetSnapshot:g,currentSnapshot:p,guards:{canActivateChecks:m,canDeactivateChecks:v}}=u;return 0===v.length&&0===m.length?rt(Object.assign(Object.assign({},u),{guardsResult:!0})):function pV(f,l,u,g){return Dn(f).pipe(bn(p=>function wV(f,l,u,g,p){const m=l&&l.routeConfig?l.routeConfig.canDeactivate:null;return m&&0!==m.length?rt(m.map(C=>{const D=Gh(C,l,p);let O;if(function XB(f){return f&&Ts(f.canDeactivate)}(D))O=Er(D.canDeactivate(f,l,u,g));else{if(!Ts(D))throw new Error("Invalid CanDeactivate guard");O=Er(D(f,l,u,g))}return O.pipe(ma())})).pipe(sc()):rt(!0)}(p.component,p.route,u,l,g)),ma(p=>!0!==p,!0))}(v,g,p,f).pipe(bn(C=>C&&function WB(f){return"boolean"==typeof f}(C)?function mV(f,l,u,g){return Dn(l).pipe(Ql(p=>vm(function vV(f,l){return null!==f&&l&&l(new sB(f)),rt(!0)}(p.route.parent,g),function _V(f,l){return null!==f&&l&&l(new aB(f)),rt(!0)}(p.route,g),function CV(f,l,u){const g=l[l.length-1],m=l.slice(0,l.length-1).reverse().map(v=>function uV(f){const l=f.routeConfig?f.routeConfig.canActivateChild:null;return l&&0!==l.length?{node:f,guards:l}:null}(v)).filter(v=>null!==v).map(v=>HD(()=>rt(v.guards.map(D=>{const O=Gh(D,v.node,u);let L;if(function $B(f){return f&&Ts(f.canActivateChild)}(O))L=Er(O.canActivateChild(g,f));else{if(!Ts(O))throw new Error("Invalid CanActivateChild guard");L=Er(O(g,f))}return L.pipe(ma())})).pipe(sc())));return rt(m).pipe(sc())}(f,p.path,u),function yV(f,l,u){const g=l.routeConfig?l.routeConfig.canActivate:null;if(!g||0===g.length)return rt(!0);const p=g.map(m=>HD(()=>{const v=Gh(m,l,u);let C;if(function YB(f){return f&&Ts(f.canActivate)}(v))C=Er(v.canActivate(l,f));else{if(!Ts(v))throw new Error("Invalid CanActivate guard");C=Er(v(l,f))}return C.pipe(ma())}));return rt(p).pipe(sc())}(f,p.route,u))),ma(p=>!0!==p,!0))}(g,m,f,l):rt(C)),Vt(C=>Object.assign(Object.assign({},u),{guardsResult:C})))})}(this.ngModule.injector,C=>this.triggerEvent(C)),hi(C=>{if(ao(C.guardsResult)){const O=wm(`Redirecting to "${this.serializeUrl(C.guardsResult)}"`);throw O.url=C.guardsResult,O}const D=new nB(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot,!!C.guardsResult);this.triggerEvent(D)}),pa(C=>!!C.guardsResult||(this.restoreHistory(C),this.cancelNavigationTransition(C,""),!1)),Pm(C=>{if(C.guards.canActivateChecks.length)return rt(C).pipe(hi(D=>{const O=new iB(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(O)}),ro(D=>{let O=!1;return rt(D).pipe(function AV(f,l){return bn(u=>{const{targetSnapshot:g,guards:{canActivateChecks:p}}=u;if(!p.length)return rt(u);let m=0;return Dn(p).pipe(Ql(v=>function RV(f,l,u,g){return function OV(f,l,u,g){const p=BS(f);if(0===p.length)return rt({});const m={};return Dn(p).pipe(bn(v=>function MV(f,l,u,g){const p=Gh(f,l,g);return Er(p.resolve?p.resolve(l,u):p(l,u))}(f[v],l,u,g).pipe(hi(C=>{m[v]=C}))),ym(1),bn(()=>BS(m).length===p.length?rt(m):Rr))}(f._resolve,f,l,g).pipe(Vt(m=>(f._resolvedData=m,f.data=Object.assign(Object.assign({},f.data),pS(f,u).resolve),null)))}(v.route,g,f,l)),hi(()=>m++),ym(1),bn(v=>m===p.length?rt(u):Rr))})}(this.paramsInheritanceStrategy,this.ngModule.injector),hi({next:()=>O=!0,complete:()=>{O||(this.restoreHistory(D),this.cancelNavigationTransition(D,"At least one route resolver didn't emit any value."))}}))}),hi(D=>{const O=new rB(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(O)}))}),Pm(C=>{const{targetSnapshot:D,id:O,extractedUrl:L,rawUrl:N,extras:{skipLocationChange:B,replaceUrl:j}}=C;return this.hooks.afterPreactivation(D,{navigationId:O,appliedUrlTree:L,rawUrlTree:N,skipLocationChange:!!B,replaceUrl:!!j})}),Vt(C=>{const D=function OB(f,l,u){const g=nc(f,l._root,u?u._root:void 0);return new fS(g,l)}(this.routeReuseStrategy,C.targetSnapshot,C.currentRouterState);return Object.assign(Object.assign({},C),{targetRouterState:D})}),hi(C=>{this.currentUrlTree=C.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl),this.routerState=C.targetRouterState,"deferred"===this.urlUpdateStrategy&&(C.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,C),this.browserUrlTree=C.urlAfterRedirects)}),((f,l,u)=>Vt(g=>(new GB(l,g.targetRouterState,g.currentRouterState,u).activate(f),g)))(this.rootContexts,this.routeReuseStrategy,C=>this.triggerEvent(C)),hi({next(){m=!0},complete(){m=!0}}),function Q2(f){return In((l,u)=>{try{l.subscribe(u)}finally{u.add(f)}})}(()=>{var C;m||v||this.cancelNavigationTransition(p,`Navigation ID ${p.id} is not equal to the current navigation id ${this.navigationId}`),(null===(C=this.currentNavigation)||void 0===C?void 0:C.id)===p.id&&(this.currentNavigation=null)}),Is(C=>{if(v=!0,function uB(f){return f&&f[QD]}(C)){const D=ao(C.url);D||(this.navigated=!0,this.restoreHistory(p,!0));const O=new XD(p.id,this.serializeUrl(p.extractedUrl),C.message);g.next(O),D?setTimeout(()=>{const L=this.urlHandlingStrategy.merge(C.url,this.rawUrlTree),N={skipLocationChange:p.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||US(p.source)};this.scheduleNavigation(L,"imperative",null,N,{resolve:p.resolve,reject:p.reject,promise:p.promise})},0):p.resolve(!1)}else{this.restoreHistory(p,!0);const D=new J2(p.id,this.serializeUrl(p.extractedUrl),C);g.next(D);try{p.resolve(this.errorHandler(C))}catch(O){p.reject(O)}}return Rr}))}))}resetRootComponentType(u){this.rootComponentType=u,this.routerState.root.component=this.rootComponentType}setTransition(u){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),u))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(u=>{const g="popstate"===u.type?"popstate":"hashchange";"popstate"===g&&setTimeout(()=>{var p;const m={replaceUrl:!0},v=(null===(p=u.state)||void 0===p?void 0:p.navigationId)?u.state:null;if(v){const D=Object.assign({},v);delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(m.state=D)}const C=this.parseUrl(u.url);this.scheduleNavigation(C,g,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(u){this.events.next(u)}resetConfig(u){DS(u),this.config=u.map(Lm),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(u,g={}){const{relativeTo:p,queryParams:m,fragment:v,queryParamsHandling:C,preserveFragment:D}=g,O=p||this.routerState.root,L=D?this.currentUrlTree.fragment:v;let N=null;switch(C){case"merge":N=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":N=this.currentUrlTree.queryParams;break;default:N=m||null}return null!==N&&(N=this.removeEmptyProps(N)),function FB(f,l,u,g,p){if(0===u.length)return xm(l.root,l.root,l.root,g,p);const m=function PB(f){if("string"==typeof f[0]&&1===f.length&&"/"===f[0])return new yS(!0,0,f);let l=0,u=!1;const g=f.reduce((p,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const C={};return On(m.outlets,(D,O)=>{C[O]="string"==typeof D?D.split("/"):D}),[...p,{outlets:C}]}if(m.segmentPath)return[...p,m.segmentPath]}return"string"!=typeof m?[...p,m]:0===v?(m.split("/").forEach((C,D)=>{0==D&&"."===C||(0==D&&""===C?u=!0:".."===C?l++:""!=C&&p.push(C))}),p):[...p,m]},[]);return new yS(u,l,g)}(u);if(m.toRoot())return xm(l.root,l.root,new yt([],{}),g,p);const v=function NB(f,l,u){if(f.isAbsolute)return new Am(l.root,!0,0);if(-1===u.snapshot._lastPathIndex){const m=u.snapshot._urlSegment;return new Am(m,m===l.root,0)}const g=Ph(f.commands[0])?0:1;return function kB(f,l,u){let g=f,p=l,m=u;for(;m>p;){if(m-=p,g=g.parent,!g)throw new Error("Invalid number of '../'");p=g.segments.length}return new Am(g,!1,p-m)}(u.snapshot._urlSegment,u.snapshot._lastPathIndex+g,f.numberOfDoubleDots)}(m,l,f),C=v.processChildren?Nh(v.segmentGroup,v.index,m.commands):CS(v.segmentGroup,v.index,m.commands);return xm(l.root,v.segmentGroup,C,g,p)}(O,this.currentUrlTree,u,N,null!=L?L:null)}navigateByUrl(u,g={skipLocationChange:!1}){const p=ao(u)?u:this.parseUrl(u),m=this.urlHandlingStrategy.merge(p,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,g)}navigate(u,g={skipLocationChange:!1}){return function GV(f){for(let l=0;l<f.length;l++){const u=f[l];if(null==u)throw new Error(`The requested path contains ${u} segment at index ${l}`)}}(u),this.navigateByUrl(this.createUrlTree(u,g),g)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){let g;try{g=this.urlSerializer.parse(u)}catch(p){g=this.malformedUriErrorHandler(p,this.urlSerializer,u)}return g}isActive(u,g){let p;if(p=!0===g?Object.assign({},jV):!1===g?Object.assign({},UV):g,ao(u))return iS(this.currentUrlTree,u,p);const m=this.parseUrl(u);return iS(this.currentUrlTree,m,p)}removeEmptyProps(u){return Object.keys(u).reduce((g,p)=>{const m=u[p];return null!=m&&(g[p]=m),g},{})}processNavigations(){this.navigations.subscribe(u=>{this.navigated=!0,this.lastSuccessfulId=u.id,this.currentPageId=u.targetPageId,this.events.next(new Jl(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,u.resolve(!0)},u=>{this.console.warn(`Unhandled Navigation Error: ${u}`)})}scheduleNavigation(u,g,p,m,v){var C,D;if(this.disposed)return Promise.resolve(!1);let O,L,N;v?(O=v.resolve,L=v.reject,N=v.promise):N=new Promise((W,Y)=>{O=W,L=Y});const B=++this.navigationId;let j;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(p=this.location.getState()),j=p&&p.\u0275routerPageId?p.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(C=this.browserPageId)&&void 0!==C?C:0:(null!==(D=this.browserPageId)&&void 0!==D?D:0)+1):j=0,this.setTransition({id:B,targetPageId:j,source:g,restoredState:p,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:u,extras:m,resolve:O,reject:L,promise:N,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),N.catch(W=>Promise.reject(W))}setBrowserUrl(u,g){const p=this.urlSerializer.serialize(u),m=Object.assign(Object.assign({},g.extras.state),this.generateNgRouterState(g.id,g.targetPageId));this.location.isCurrentPathEqualTo(p)||g.extras.replaceUrl?this.location.replaceState(p,"",m):this.location.go(p,"",m)}restoreHistory(u,g=!1){var p,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-u.targetPageId;"popstate"!==u.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(p=this.currentNavigation)||void 0===p?void 0:p.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(u),this.browserUrlTree=u.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(g&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=u.currentRouterState,this.currentUrlTree=u.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(u,g){const p=new XD(u.id,this.serializeUrl(u.extractedUrl),g);this.triggerEvent(p),u.resolve(!1)}generateNgRouterState(u,g){return"computed"===this.canceledNavigationResolution?{navigationId:u,\u0275routerPageId:g}:{navigationId:u}}}return f.\u0275fac=function(u){Mg()},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();function US(f){return"imperative"!==f}let uc=(()=>{class f{constructor(u,g,p){this.router=u,this.route=g,this.locationStrategy=p,this.commands=null,this.href=null,this.onChanges=new xr,this.subscription=u.events.subscribe(m=>{m instanceof Jl&&this.updateTargetUrlAndHref()})}set routerLink(u){this.commands=null!=u?Array.isArray(u)?u:[u]:null}ngOnChanges(u){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(u,g,p,m,v){if(0!==u||g||p||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const C={skipLocationChange:Ca(this.skipLocationChange),replaceUrl:Ca(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Ca(this.preserveFragment)})}}return f.\u0275fac=function(u){return new(u||f)(ye(di),ye(ya),ye(fa))},f.\u0275dir=ze({type:f,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(u,g){1&u&&sn("click",function(m){return g.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&u&&mr("target",g.target)("href",g.href,Nf)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[bi]}),f})();function Ca(f){return""===f||!!f}class GS{}class HS{preload(l,u){return rt(null)}}let WS=(()=>{class f{constructor(u,g,p,m){this.router=u,this.injector=p,this.preloadingStrategy=m,this.loader=new VS(p,g,D=>u.triggerEvent(new qD(D)),D=>u.triggerEvent(new ZD(D)))}setUpPreloading(){this.subscription=this.router.events.pipe(pa(u=>u instanceof Jl),Ql(()=>this.preload())).subscribe(()=>{})}preload(){const u=this.injector.get(Br);return this.processRoutes(u,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,g){const p=[];for(const m of g)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;p.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?p.push(this.preloadConfig(u,m)):m.children&&p.push(this.processRoutes(u,m.children));return Dn(p).pipe(Qa(),Vt(m=>{}))}preloadConfig(u,g){return this.preloadingStrategy.preload(g,()=>(g._loadedConfig?rt(g._loadedConfig):this.loader.load(u.injector,g)).pipe(bn(m=>(g._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return f.\u0275fac=function(u){return new(u||f)(Ye(di),Ye(LE),Ye(Qn),Ye(GS))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})(),Bm=(()=>{class f{constructor(u,g,p={}){this.router=u,this.viewportScroller=g,this.options=p,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},p.scrollPositionRestoration=p.scrollPositionRestoration||"disabled",p.anchorScrolling=p.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(u=>{u instanceof Cm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof Jl&&(this.lastId=u.id,this.scheduleScrollEvent(u,this.router.parseUrl(u.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(u=>{u instanceof KD&&(u.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(u.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,g){this.router.triggerEvent(new KD(u,"popstate"===this.lastSource?this.store[this.restoredId]:null,g))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return f.\u0275fac=function(u){Mg()},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();const lo=new ut("ROUTER_CONFIGURATION"),zS=new ut("ROUTER_FORROOT_GUARD"),YV=[xp,{provide:aS,useClass:lS},{provide:di,useFactory:function KV(f,l,u,g,p,m,v={},C,D){const O=new di(null,f,l,u,g,p,eS(m));return C&&(O.urlHandlingStrategy=C),D&&(O.routeReuseStrategy=D),function QV(f,l){f.errorHandler&&(l.errorHandler=f.errorHandler),f.malformedUriErrorHandler&&(l.malformedUriErrorHandler=f.malformedUriErrorHandler),f.onSameUrlNavigation&&(l.onSameUrlNavigation=f.onSameUrlNavigation),f.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=f.paramsInheritanceStrategy),f.relativeLinkResolution&&(l.relativeLinkResolution=f.relativeLinkResolution),f.urlUpdateStrategy&&(l.urlUpdateStrategy=f.urlUpdateStrategy),f.canceledNavigationResolution&&(l.canceledNavigationResolution=f.canceledNavigationResolution)}(v,O),v.enableTracing&&O.events.subscribe(L=>{var N,B;null===(N=console.group)||void 0===N||N.call(console,`Router Event: ${L.constructor.name}`),console.log(L.toString()),console.log(L),null===(B=console.groupEnd)||void 0===B||B.call(console)}),O},deps:[aS,oc,xp,Qn,LE,Nm,lo,[class NV{},new ps],[class LV{},new ps]]},oc,{provide:ya,useFactory:function JV(f){return f.routerState.root},deps:[di]},WS,HS,class zV{preload(l,u){return u().pipe(Is(()=>rt(null)))}},{provide:lo,useValue:{enableTracing:!1}}];function $V(){return new BE("Router",di)}let YS=(()=>{class f{constructor(u,g){}static forRoot(u,g){return{ngModule:f,providers:[YV,$S(u),{provide:zS,useFactory:ZV,deps:[[di,new ps,new ml]]},{provide:lo,useValue:g||{}},{provide:fa,useFactory:qV,deps:[to,[new bu(Tp),new ps],lo]},{provide:Bm,useFactory:XV,deps:[di,QN,lo]},{provide:GS,useExisting:g&&g.preloadingStrategy?g.preloadingStrategy:HS},{provide:BE,multi:!0,useFactory:$V},[Vm,{provide:hp,multi:!0,useFactory:ej,deps:[Vm]},{provide:XS,useFactory:tj,deps:[Vm]},{provide:ME,multi:!0,useExisting:XS}]]}}static forChild(u){return{ngModule:f,providers:[$S(u)]}}}return f.\u0275fac=function(u){return new(u||f)(Ye(zS,8),Ye(di,8))},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({}),f})();function XV(f,l,u){return u.scrollOffset&&l.setOffset(u.scrollOffset),new Bm(f,l,u)}function qV(f,l,u={}){return u.useHash?new MP(f,l):new ib(f,l)}function ZV(f){return"guarded"}function $S(f){return[{provide:hA,multi:!0,useValue:f},{provide:Nm,multi:!0,useValue:f}]}let Vm=(()=>{class f{constructor(u){this.injector=u,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new xr}appInitializer(){return this.injector.get(AP,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let g=null;const p=new Promise(C=>g=C),m=this.injector.get(di),v=this.injector.get(lo);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),g(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?rt(null):(this.initNavigation=!0,g(!0),this.resultOfPreactivationDone),m.initialNavigation()):g(!0),p})}bootstrapListener(u){const g=this.injector.get(lo),p=this.injector.get(WS),m=this.injector.get(Bm),v=this.injector.get(di),C=this.injector.get(Cp);u===C.components[0]&&(("enabledNonBlocking"===g.initialNavigation||void 0===g.initialNavigation)&&v.initialNavigation(),p.setUpPreloading(),m.init(),v.resetRootComponentType(C.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return f.\u0275fac=function(u){return new(u||f)(Ye(Qn))},f.\u0275prov=vt({token:f,factory:f.\u0275fac}),f})();function ej(f){return f.appInitializer.bind(f)}function tj(f){return f.bootstrapListener.bind(f)}const XS=new ut("Router Initializer");function qS(f,l,u,g,p,m,v){try{var C=f[m](v),D=C.value}catch(O){return void u(O)}C.done?l(D):Promise.resolve(D).then(g,p)}function oe(f){return function(){var l=this,u=arguments;return new Promise(function(g,p){var m=f.apply(l,u);function v(D){qS(m,g,p,v,C,"next",D)}function C(D){qS(m,g,p,v,C,"throw",D)}v(void 0)})}}const ij=[{id:"reader",name:"Barcode and QR Code Reader",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner",description:"Scan barcode and QR code from camera stream"},{id:"file-detection",name:"Document Detector (File)",description:"Detect document from image files"},{id:"camera-detection",name:"Document Scanner (Camera)",description:"Detect document from camera stream"}];function lt(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function co(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}var uo,br,je,f;"function"==typeof SuppressedError&&SuppressedError,(f=uo||(uo={}))[f.BOPM_BLOCK=0]="BOPM_BLOCK",f[f.BOPM_UPDATE=1]="BOPM_UPDATE",function(f){f[f.CCUT_AUTO=0]="CCUT_AUTO",f[f.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",f[f.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",f[f.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",f[f.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",f[f.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(br||(br={})),function(f){f[f.IPF_BINARY=0]="IPF_BINARY",f[f.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",f[f.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",f[f.IPF_NV21=3]="IPF_NV21",f[f.IPF_RGB_565=4]="IPF_RGB_565",f[f.IPF_RGB_555=5]="IPF_RGB_555",f[f.IPF_RGB_888=6]="IPF_RGB_888",f[f.IPF_ARGB_8888=7]="IPF_ARGB_8888",f[f.IPF_RGB_161616=8]="IPF_RGB_161616",f[f.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",f[f.IPF_ABGR_8888=10]="IPF_ABGR_8888",f[f.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",f[f.IPF_BGR_888=12]="IPF_BGR_888",f[f.IPF_BINARY_8=13]="IPF_BINARY_8",f[f.IPF_NV12=14]="IPF_NV12",f[f.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(je||(je={}));const ZS=f=>Object.prototype.toString.call(f),jm=f=>Array.isArray?Array.isArray(f):"[object Array]"===ZS(f),Um=f=>"[object Boolean]"===ZS(f),en=f=>"number"==typeof f&&!Number.isNaN(f),er=f=>null!==f&&"object"==typeof f&&!Array.isArray(f),KS=f=>!(!er(f)||!(f.bytes instanceof Uint8Array)||!en(f.width)||f.width<=0||!en(f.height)||f.height<=0||!en(f.stride)||f.stride<=0||!("format"in f)||"tag"in f&&!sj(f.tag)),sj=f=>!!er(f)&&!!en(f.imageId)&&"type"in f,wa=f=>!!er(f)&&!!en(f.x)&&!!en(f.y);function QS(f,l){return Gm.apply(this,arguments)}function Gm(){return Gm=oe(function*(f,l){return yield new Promise((u,g)=>{let p=new XMLHttpRequest;p.open("GET",f,!0),p.responseType=l,p.send(),p.onloadend=oe(function*(){p.status<200||p.status>=300?g(f+" "+p.status):u(p.response)}),p.onerror=()=>{g(new Error("Network Error: "+p.statusText))}})}),Gm.apply(this,arguments)}const Wr=(f,l)=>{let u=f.split("."),g=l.split(".");for(let p=0;p<u.length&&p<g.length;++p){let m=u[p],v=g[p];if(m===v)continue;let C=parseInt(u[p]),D=parseInt(g[p]);return C===D||Number.isNaN(C)&&Number.isNaN(D)?m<v?-1:1:C<D||Number.isNaN(C)&&Number.isInteger(D)?-1:1}return u.length===g.length?0:u.length<g.length?-1:1},cj="function"==typeof BigInt;var Hh,fn,ho,hc,dc,Mi,fo,Hm;class Li{get _isFetchingStarted(){return lt(this,dc,"f")}constructor(){Hh.add(this),fn.set(this,[]),ho.set(this,1),hc.set(this,uo.BOPM_BLOCK),dc.set(this,!1),Mi.set(this,void 0),fo.set(this,br.CCUT_AUTO)}setErrorListener(l){}addImageToBuffer(l){var u;if(!KS(l))throw new TypeError("Invalid 'image'.");if((null===(u=l.tag)||void 0===u?void 0:u.hasOwnProperty("imageId"))&&"number"==typeof l.tag.imageId&&this.hasImage(l.tag.imageId))throw new Error("Existed imageId.");if(lt(this,fn,"f").length>=lt(this,ho,"f"))switch(lt(this,hc,"f")){case uo.BOPM_BLOCK:break;case uo.BOPM_UPDATE:if(lt(this,fn,"f").push(l),er(lt(this,Mi,"f"))&&en(lt(this,Mi,"f").imageId)&&1==lt(this,Mi,"f").keepInBuffer)for(;lt(this,fn,"f").length>lt(this,ho,"f");){const g=lt(this,fn,"f").findIndex(p=>{var m;return(null===(m=p.tag)||void 0===m?void 0:m.imageId)!==lt(this,Mi,"f").imageId});lt(this,fn,"f").splice(g,1)}else lt(this,fn,"f").splice(0,lt(this,fn,"f").length-lt(this,ho,"f"))}else lt(this,fn,"f").push(l)}getImage(){if(0===lt(this,fn,"f").length)return null;let l;if(lt(this,Mi,"f")&&en(lt(this,Mi,"f").imageId)){const u=lt(this,Hh,"m",Hm).call(this,lt(this,Mi,"f").imageId);if(u<0)throw new Error(`Image with id ${lt(this,Mi,"f").imageId} doesn't exist.`);l=lt(this,fn,"f").slice(u,u+1)[0]}else l=lt(this,fn,"f").pop();if([je.IPF_RGB_565,je.IPF_RGB_555,je.IPF_RGB_888,je.IPF_ARGB_8888,je.IPF_RGB_161616,je.IPF_ARGB_16161616,je.IPF_ABGR_8888,je.IPF_ABGR_16161616,je.IPF_BGR_888].includes(l.format)){if(lt(this,fo,"f")===br.CCUT_RGB_R_CHANNEL_ONLY){Li._onLog&&Li._onLog("only get R channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:u[g]=l.bytes[3*g+2];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:u[g]=l.bytes[4*g+2];break;case je.IPF_BGR_888:u[g]=l.bytes[3*g];break;case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:u[g]=l.bytes[4*g]}l.bytes=u,l.stride=l.width,l.format=je.IPF_GRAYSCALED}else if(lt(this,fo,"f")===br.CCUT_RGB_G_CHANNEL_ONLY){Li._onLog&&Li._onLog("only get G channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:case je.IPF_BGR_888:u[g]=l.bytes[3*g+1];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:u[g]=l.bytes[4*g+1]}l.bytes=u,l.stride=l.width,l.format=je.IPF_GRAYSCALED}else if(lt(this,fo,"f")===br.CCUT_RGB_B_CHANNEL_ONLY){Li._onLog&&Li._onLog("only get B channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:u[g]=l.bytes[3*g];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:u[g]=l.bytes[4*g];break;case je.IPF_BGR_888:u[g]=l.bytes[3*g+2];break;case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:u[g]=l.bytes[4*g+2]}l.bytes=u,l.stride=l.width,l.format=je.IPF_GRAYSCALED}}else[je.IPF_NV21,je.IPF_NV12].includes(l.format)&&Li._onLog&&Li._onLog("NV21 or NV12 is not supported.");return l}setNextImageToReturn(l,u){if(!((...g)=>0!==g.length&&g.every(p=>en(p)))(l))throw new TypeError("Invalid 'imageId'.");if(void 0!==u&&!Um(u))throw new TypeError("Invalid 'keepInBuffer'.");co(this,Mi,{imageId:l,keepInBuffer:u},"f")}_resetNextReturnedImage(){co(this,Mi,null,"f")}hasImage(l){return lt(this,Hh,"m",Hm).call(this,l)>=0}startFetching(){co(this,dc,!0,"f")}stopFetching(){co(this,dc,!1,"f")}setMaxImageCount(l){if("number"!=typeof l)throw new TypeError("Invalid 'count'.");if(l<1||Math.round(l)!==l)throw new Error("Invalid 'count'.");for(co(this,ho,l,"f");lt(this,fn,"f")&&lt(this,fn,"f").length>l;)lt(this,fn,"f").shift()}getMaxImageCount(){return lt(this,ho,"f")}getImageCount(){return lt(this,fn,"f").length}clearBuffer(){lt(this,fn,"f").length=0}isBufferEmpty(){return 0===lt(this,fn,"f").length}setBufferOverflowProtectionMode(l){co(this,hc,l,"f")}getBufferOverflowProtectionMode(){return lt(this,hc,"f")}setColourChannelUsageType(l){co(this,fo,l,"f")}getColourChannelUsageType(){return lt(this,fo,"f")}}fn=new WeakMap,ho=new WeakMap,hc=new WeakMap,dc=new WeakMap,Mi=new WeakMap,fo=new WeakMap,Hh=new WeakSet,Hm=function(f){if("number"!=typeof f)throw new TypeError("Invalid 'imageId'.");return lt(this,fn,"f").findIndex(l=>{var u;return(null===(u=l.tag)||void 0===u?void 0:u.imageId)===f})};const Wh="undefined"==typeof self,JS=(()=>{if(!Wh&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),eI=f=>{if(null==f&&(f="./"),!Wh){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};let fc,zr,zh,Yh,ei;"undefined"!=typeof navigator&&(fc=navigator,zr=fc.userAgent,zh=fc.platform,Yh=fc.mediaDevices),function(){if(!Wh){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:fc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:zh,search:"Win"},Mac:{str:zh},Linux:{str:zh}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let O=v.verStr||zr,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||zr).indexOf(v.search||m)){u=m;for(let N of L){let B=O.indexOf(N);if(-1!=B){g=parseFloat(O.substring(B+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||zr).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=zr.indexOf("Windows NT")&&(p="HarmonyOS"),ei={browser:u,version:g,OS:p}}Wh&&(ei={browser:"ssr",version:0,OS:"ssr"})}();const uj="undefined"!=typeof WebAssembly&&zr&&!(/Safari/.test(zr)&&!/Chrome/.test(zr)&&/\(.+\s11_2_([2-6]).*\)/.test(zr)),hj="undefined"!=typeof Worker,tI=!(!Yh||!Yh.getUserMedia),dj=function(){var f=oe(function*(){let l=!1;if(tI)try{(yield Yh.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return f.apply(this,arguments)}}(),nI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class $h extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(nI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,nI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&oe(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}const Fi={},iI=function(){var f=oe(function*(l){let u="string"==typeof l?[l]:l,g=[];for(let p of u)g.push(Fi[p]=Fi[p]||new $h);yield Promise.all(g)});return function(u){return f.apply(this,arguments)}}(),Xh=function(){var f=oe(function*(l,u){let g,p="string"==typeof l?[l]:l,m=[];for(let v of p){let C;m.push(C=Fi[v]=Fi[v]||new $h(g=g||u())),C.isEmpty&&(C.task=g=g||u())}yield Promise.all(m)});return function(u,g){return f.apply(this,arguments)}}();let dt,rI=0;const At=()=>rI++,bt={};let xs,Wm=!1;const go={},gn={},Ue={std:{version:"1.2.10",path:eI(JS+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:JS}},gc=new Proxy(Ue,{get(f,l,u){let g=Reflect.get(f,l,u);return g&&g.path&&(g=g.path),g}}),Yr={dip:{wasm:!0}},Dr=function(){var f=oe(function*(l){let u;l instanceof Array||(l=l?[l]:[]);{let m=Fi.core;u=!m||m.isEmpty}let g=new Map;for(let m of l){if(m=m.toLowerCase(),"std"==m||"core"==m)continue;if(!Yr[m])throw Error("The '"+m+"' module cannot be found.");let v=Yr[m].deps;if(null==v?void 0:v.length)for(let D of v){let O=Fi[D];g.has(D)||g.set(D,!O||O.isEmpty)}let C=Fi[m];g.has(m)||g.set(m,!C||C.isEmpty)}let p=[];u&&p.push("core"),p.push(...g.keys()),yield Xh(p,oe(function*(){const m=[...g.entries()].filter(N=>N[1]).map(N=>N[0]),v={};for(let N in gc){if("rootDirectory"==N)continue;let B=gc[N];gc.rootDirectory&&(B.startsWith("http://")||B.startsWith("https://")||(B=gc.rootDirectory+"/"+B)),v[N]=eI(B)}const C={};for(let N of m)C[N]=Yr[N];const D={engineResourcePaths:v,autoResources:C,names:m};let O=new $h;if(u){D.needLoadCore=!0;let N=v.core+tn._workerName;v.rootDirectory&&(N=v.rootDirectory+N),N.startsWith(location.origin)||(N=yield fetch(N).then(B=>B.blob()).then(B=>URL.createObjectURL(B))),dt=new Worker(N),dt.onerror=B=>{let j=new Error(B.message);O.reject(j)},dt.addEventListener("message",B=>{let j=B.data?B.data:B,Y=j.id,$=j.body;switch(j.type){case"log":xs&&xs(j.message);break;case"task":try{bt[Y]($),delete bt[Y]}catch(q){throw delete bt[Y],q}break;case"event":try{bt[Y]($)}catch(q){throw q}break;default:console.log(B)}}),D.bLog=!!xs,D.bd=Wm,D.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield iI("worker");let L=rI++;bt[L]=N=>{if(N.success)Object.assign(go,N.versions),"{}"!==JSON.stringify(N.versions)&&(tn._versions=N.versions),O.resolve(void 0);else{const B=Error(N.message);N.stack&&(B.stack=N.stack),O.reject(B)}},dt.postMessage({type:"loadWasm",body:D,id:L}),u&&Xh("worker",()=>Promise.resolve()),yield O}))});return function(u){return f.apply(this,arguments)}}();class tn{static get engineResourcePaths(){return gc}static set engineResourcePaths(l){Object.assign(Ue,l)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return xs}static set _onLog(l){(f=>{xs=f,dt&&dt.postMessage({type:"setBLog",body:{value:!!f}})})(l)}static get _bDebug(){return Wm}static set _bDebug(l){(f=>{Wm=f,dt&&dt.postMessage({type:"setBDebug",body:{value:!!f}})})(l)}static isModuleLoaded(l){return l=(l=l||"core").toLowerCase(),!!Fi[l]&&Fi[l].isFulfilled}static loadWasm(l){return oe(function*(){return yield Dr(l)})()}static detectEnvironment(){return oe(function*(){return yield oe(function*(){return{wasm:uj,worker:hj,getUserMedia:tI,camera:yield dj(),browser:ei.browser,version:ei.version,OS:ei.OS}})()})()}static getModuleVersion(){return oe(function*(){return yield new Promise((l,u)=>{let g=At();bt[g]=function(){var p=oe(function*(m){if(m.success)return l(m.versions);{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,u(v)}});return function(m){return p.apply(this,arguments)}}(),dt.postMessage({type:"getModuleVersion",id:g})})})()}static getVersion(){return`3.2.30(Worker: ${go.core&&go.core.worker||"Not Loaded"}, Wasm: ${go.core&&go.core.wasm||"Not Loaded"})`}static enableLogging(){Li._onLog=console.log,tn._onLog=console.log}static disableLogging(){Li._onLog=null,tn._onLog=null}static cfd(l){return oe(function*(){return yield new Promise((u,g)=>{let p=At();bt[p]=function(){var m=oe(function*(v){if(v.success)return u();{let C=new Error(v.message);return C.stack=v.stack+"\n"+C.stack,g(C)}});return function(v){return m.apply(this,arguments)}}(),dt.postMessage({type:"cfd",id:p,body:{count:l}})})})()}}var nn,sI,zm,oI,aI,qh,lI,cI,Ea,uI,hI;tn._bSupportDce4Module=-1,tn._bSupportIRTModule=-1,tn._versions=null,tn._workerName="core.worker.js",tn.browserInfo=ei,function(f){f[f.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",f[f.CRIT_BARCODE=2]="CRIT_BARCODE",f[f.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",f[f.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",f[f.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",f[f.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(nn||(nn={})),function(f){f[f.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",f[f.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",f[f.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",f[f.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(sI||(sI={})),function(f){f[f.EC_OK=0]="EC_OK",f[f.EC_UNKNOWN=-1e4]="EC_UNKNOWN",f[f.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",f[f.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",f[f.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",f[f.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",f[f.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",f[f.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",f[f.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",f[f.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",f[f.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",f[f.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",f[f.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",f[f.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",f[f.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",f[f.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",f[f.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",f[f.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",f[f.EC_TIMEOUT=-10026]="EC_TIMEOUT",f[f.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",f[f.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",f[f.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",f[f.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",f[f.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",f[f.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",f[f.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",f[f.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",f[f.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",f[f.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",f[f.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",f[f.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",f[f.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",f[f.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",f[f.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",f[f.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",f[f.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",f[f.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",f[f.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",f[f.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",f[f.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",f[f.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",f[f.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",f[f.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",f[f.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",f[f.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",f[f.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",f[f.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",f[f.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",f[f.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",f[f.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",f[f.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",f[f.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",f[f.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",f[f.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",f[f.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",f[f.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",f[f.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",f[f.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",f[f.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",f[f.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",f[f.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",f[f.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",f[f.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",f[f.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",f[f.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",f[f.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",f[f.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",f[f.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",f[f.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",f[f.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",f[f.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",f[f.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",f[f.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",f[f.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",f[f.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",f[f.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",f[f.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",f[f.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",f[f.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",f[f.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",f[f.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",f[f.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",f[f.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",f[f.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",f[f.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",f[f.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",f[f.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",f[f.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",f[f.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",f[f.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",f[f.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",f[f.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",f[f.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",f[f.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",f[f.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",f[f.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",f[f.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",f[f.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",f[f.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",f[f.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",f[f.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(zm||(zm={})),function(f){f[f.GEM_SKIP=0]="GEM_SKIP",f[f.GEM_AUTO=1]="GEM_AUTO",f[f.GEM_GENERAL=2]="GEM_GENERAL",f[f.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",f[f.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",f[f.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",f[f.GEM_REV=-2147483648]="GEM_REV"}(oI||(oI={})),function(f){f[f.GTM_SKIP=0]="GTM_SKIP",f[f.GTM_INVERTED=1]="GTM_INVERTED",f[f.GTM_ORIGINAL=2]="GTM_ORIGINAL",f[f.GTM_AUTO=4]="GTM_AUTO",f[f.GTM_REV=-2147483648]="GTM_REV"}(aI||(aI={})),function(f){f[f.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",f[f.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(qh||(qh={})),function(f){f[f.PDFRM_VECTOR=1]="PDFRM_VECTOR",f[f.PDFRM_RASTER=2]="PDFRM_RASTER",f[f.PDFRM_REV=-2147483648]="PDFRM_REV"}(lI||(lI={})),function(f){f[f.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",f[f.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(cI||(cI={})),function(f){f[f.IRUT_NULL=0]="IRUT_NULL",f[f.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",f[f.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",f[f.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",f[f.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",f[f.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",f[f.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",f[f.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",f[f.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",f[f.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",f[f.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",f[f.IRUT_CONTOURS=1024]="IRUT_CONTOURS",f[f.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",f[f.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",f[f.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",f[f.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",f[f.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",f[f.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",f[f.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",f[f.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",f[f.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",f[f.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",f[f.IRUT_CORNERS=2097152]="IRUT_CORNERS",f[f.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",f[f.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",f[f.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",f[f.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",f[f.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",f[f.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",f[f.IRUT_ALL=268435455]="IRUT_ALL"}(Ea||(Ea={})),function(f){f[f.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",f[f.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",f[f.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",f[f.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",f[f.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",f[f.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",f[f.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",f[f.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",f[f.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(uI||(uI={})),function(f){f[f.ST_NULL=0]="ST_NULL",f[f.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",f[f.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",f[f.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",f[f.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",f[f.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",f[f.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",f[f.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(hI||(hI={}));const As="undefined"==typeof self,dI=As?{}:self,fI=(()=>{if(!As&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),gI=f=>{if(null==f&&(f="./"),!As){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f},pI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class Ym extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(pI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,pI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&oe(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}const Zh=" is not allowed to change after `createInstance` or `loadWasm` is called.",pj=!As&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",mI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`license`"+Zh);u._license=l};!As&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const _I=f=>{if(null==f)f=[];else{f=f instanceof Array?[...f]:[f];for(let l=0;l<f.length;++l){if(!As){let u=document.createElement("a");u.href=f[l],f[l]=u.href}f[l].endsWith("/")||(f[l]+="/")}}return f},vI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`licenseServer`"+Zh);u._licenseServer=_I(l)},yI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Zh);u._deviceFriendlyName=l||""};let pc,mc,Kh,$m,tr;"undefined"!=typeof navigator&&(pc=navigator,mc=pc.userAgent,Kh=pc.platform,$m=pc.mediaDevices),function(){if(!As){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:pc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Kh,search:"Win"},Mac:{str:Kh},Linux:{str:Kh}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let O=v.verStr||mc,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||mc).indexOf(v.search||m)){u=m;for(let N of L){let B=O.indexOf(N);if(-1!=B){g=parseFloat(O.substring(B+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||mc).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=mc.indexOf("Windows NT")&&(p="HarmonyOS"),tr={browser:u,version:g,OS:p}}As&&(tr={browser:"ssr",version:0,OS:"ssr"})}();const CI=function(){var f=oe(function*(){return Dr("license"),Xh("dynamsoft_inited",oe(function*(){let{lt:l,l:u,ls:g,sp:p,rmk:m,cv:v}=((O,L=!1)=>{const N=O;if(N._pLoad.isEmpty){let B,j,W,Y=N._license||"",$=JSON.parse(JSON.stringify(N._licenseServer)),q=N._sessionPassword,X=0;if(Y.startsWith("t")||Y.startsWith("f"))X=0;else if(0===Y.length||Y.startsWith("P")||Y.startsWith("L")||Y.startsWith("Y")||Y.startsWith("A"))X=1;else{X=2;const Q=Y.indexOf(":");-1!=Q&&(Y=Y.substring(Q+1));const pe=Y.indexOf("?");if(-1!=pe&&(j=Y.substring(pe+1),Y=Y.substring(0,pe)),Y.startsWith("DLC2"))X=0;else{if(Y.startsWith("DLS2")){let ve;try{let Te=Y.substring(4);Te=atob(Te),ve=JSON.parse(Te)}catch(Te){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(Y=ve.handshakeCode?ve.handshakeCode:ve.organizationID?ve.organizationID:"","number"==typeof Y&&(Y=JSON.stringify(Y)),0===$.length){let Te=[];ve.mainServerURL&&(Te[0]=ve.mainServerURL),ve.standbyServerURL&&(Te[1]=ve.standbyServerURL),$=_I(Te)}!q&&ve.sessionPassword&&(q=ve.sessionPassword),B=ve.remark}Y&&"200001"!==Y&&!Y.startsWith("200001-")||(X=1)}}if(X&&(L||(dI.crypto||(W="Please upgrade your browser to support online key."),dI.crypto.subtle||(W="Require https to use online key in this browser."))),W){if(1!==X)throw new Error(W);X=0,console.warn(W),N._lastErrorCode=-1,N._lastErrorString=W}return 1===X&&(Y="",console.warn("Applying for a public trial license ...")),{lt:X,l:Y,ls:$,sp:q,rmk:B,cv:j}}throw new Error("Can't preprocess license again"+Zh)})(kt),C=new Ym;kt._pLoad.task=C,oe(function*(){try{yield kt._pLoad}catch(O){}})();let D=At();bt[D]=O=>{if(O.message&&kt._onAuthMessage){let B=kt._onAuthMessage(O.message);null!=B&&(O.message=B)}let L,N=!1;if(1===l&&(N=!0),O.success?(xs&&xs("init license success"),O.message&&console.warn(O.message),tn._bSupportIRTModule=O.bSupportIRTModule,tn._bSupportDce4Module=O.bSupportDce4Module,kt.bPassValidation=!0):(L=Error(O.message),O.stack&&(L.stack=O.stack),O.ltsErrorCode&&(L.ltsErrorCode=O.ltsErrorCode),N||111==O.ltsErrorCode&&-1!=O.message.toLowerCase().indexOf("trial license")&&(N=!0)),N){let B=Ue.license;Ue.rootDirectory&&(B=Ue.rootDirectory+"/"+B),B=gI(B),(j=oe(function*(W,Y,$){if(!W._bNeverShowDialog)try{let q=yield fetch(W.engineResourcePath+"dls.license.dialog.html");if(!q.ok)throw Error("Get license dialog fail. Network Error: "+q.statusText);let X=yield q.text();if(!X.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let Q=document.createElement("div");Q.innerHTML=X;let pe=[];for(let w=0;w<Q.childElementCount;++w){let b=Q.children[w];b instanceof HTMLStyleElement&&(pe.push(b),document.head.append(b))}let ve=1==Q.childElementCount?Q.children[0]:Q;ve.remove();let Te,Ae,P,Ee,Be,Je=[ve],S=ve.children;for(let w of S)Je.push(w);for(let w=0;w<Je.length;++w)for(let b of Je[w].children)Je.push(b);for(let w of Je)if(!Te&&w.classList.contains("dls-license-mask"))Te=w,w.addEventListener("click",b=>{if(w==b.target){ve.remove();for(let T of pe)T.remove()}});else if(!Ae&&w.classList.contains("dls-license-icon-close"))Ae=w,w.addEventListener("click",()=>{ve.remove();for(let b of pe)b.remove()});else if(!P&&w.classList.contains("dls-license-icon-error"))P=w,"error"!=Y&&w.remove();else if(!Ee&&w.classList.contains("dls-license-icon-warn"))Ee=w,"warn"!=Y&&w.remove();else if(!Be&&w.classList.contains("dls-license-msg-content")){Be=w;let b=$;for(;b;){let T=b.indexOf("["),_=b.indexOf("]",T),y=b.indexOf("(",_),I=b.indexOf(")",y);if(-1==T||-1==_||-1==y||-1==I){w.appendChild(new Text(b));break}T>0&&w.appendChild(new Text(b.substring(0,T)));let M=document.createElement("a"),x=b.substring(T+1,_);M.innerText=x;let A=b.substring(y+1,I);M.setAttribute("href",A),M.setAttribute("target","_blank"),w.appendChild(M),b=b.substring(I+1)}}document.body.appendChild(ve)}catch(q){W._onLog&&W._onLog(q.message||q)}}),function(W,Y,$){return j.apply(this,arguments)})({_bNeverShowDialog:kt._bNeverShowDialog,engineResourcePath:B,_onLog:xs},O.success?"warn":"error",O.message)}var j;O.success?C.resolve(void 0):C.reject(L)},yield iI("worker"),dt.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!l,bptk:1===l,l:u,os:tr,fn:kt.deviceFriendlyName,ls:g,sp:p,rmk:m,cv:v},id:D}),kt.bCallInitLicense=!0,yield C}))});return function(){return f.apply(this,arguments)}}();let wI;gn.license={},gn.license.dynamsoft=CI,gn.license.getAR=oe(function*(){{let f=Fi.dynamsoft_inited;f&&f.isRejected&&(yield f)}return dt?new Promise((f,l)=>{let u=At();bt[u]=function(){var g=oe(function*(p){if(p.success){delete p.success;{let m=kt.license;m&&(m.startsWith("t")||m.startsWith("f"))&&(p.pk=m)}if(Object.keys(p).length){if(p.lem){let m=Error(p.lem);m.ltsErrorCode=p.lec,delete p.lem,delete p.lec,p.ae=m}f(p)}else f(null)}else{let m=Error(p.message);p.stack&&(m.stack=p.stack),l(m)}});return function(p){return g.apply(this,arguments)}}(),dt.postMessage({type:"getAR",id:u})}):null});class kt{static setLicenseServer(l){vI(kt,l)}static get license(){return this._license}static set license(l){mI(kt,l)}static get licenseServer(){return this._licenseServer}static set licenseServer(l){vI(kt,l)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(l){yI(kt,l)}static initLicense(l,u){if(mI(kt,l),kt.bCallInitLicense=!0,u)return CI()}static setDeviceFriendlyName(l){yI(kt,l)}static getDeviceFriendlyName(){return kt._deviceFriendlyName}static getDeviceUUID(){return oe(function*(){return yield Xh("dynamsoft_uuid",oe(function*(){yield Dr();let l=new Ym,u=At();bt[u]=g=>{if(g.success)l.resolve(g.uuid);else{const p=Error(g.message);g.stack&&(p.stack=g.stack),l.reject(p)}},dt.postMessage({type:"getDeviceUUID",id:u}),wI=yield l})),wI})()}}kt._pLoad=new Ym,kt.bPassValidation=!1,kt.bCallInitLicense=!1,kt._license=pj,kt._licenseServer=[],kt._deviceFriendlyName="",null==Ue.license&&(Ue.license=fI),Yr.license={wasm:!0},gn.license.LicenseManager=kt;const Xm="1.2.10";"string"!=typeof Ue.std&&Wr(Ue.std.version,Xm)<0&&(Ue.std={version:Xm,path:gI(fI+`../../dynamsoft-capture-vision-std@${Xm}/dist/`)});const EI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class ba extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(EI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,EI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&oe(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}class mj{constructor(l){this._cvr=l}getMaxBufferedItems(){var l=this;return oe(function*(){return yield new Promise((u,g)=>{let p=At();bt[p]=function(){var m=oe(function*(v){if(v.success)return u(v.count);{let C=new Error(v.message);return C.stack=v.stack+"\n"+C.stack,g(C)}});return function(v){return m.apply(this,arguments)}}(),dt.postMessage({type:"cvr_getMaxBufferedItems",id:p,instanceID:l._cvr._instanceID})})})()}setMaxBufferedItems(l){var u=this;return oe(function*(){return yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g();{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_setMaxBufferedItems",id:m,instanceID:u._cvr._instanceID,body:{count:l}})})})()}getBufferedCharacterItemSet(){var l=this;return oe(function*(){return yield new Promise((u,g)=>{let p=At();bt[p]=function(){var m=oe(function*(v){if(v.success)return u(v.itemSet);{let C=new Error(v.message);return C.stack=v.stack+"\n"+C.stack,g(C)}});return function(v){return m.apply(this,arguments)}}(),dt.postMessage({type:"cvr_getBufferedCharacterItemSet",id:p,instanceID:l._cvr._instanceID})})})()}}var _j={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const bI=(f,l)=>{for(let u in l._irrRegistryState)l._irrRegistryState[u]=!1;for(let u of f._intermediateResultReceiverSet)if(u.isDce)l._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let g in u)l._irrRegistryState[g]||(l._irrRegistryState[g]=!!u[g])};class vj{constructor(l){this._irrRegistryState=_j,this._cvr=l}addResultReceiver(l){var u=this;return oe(function*(){if("object"!=typeof l)throw new Error("Invalid receiver.");u._cvr._intermediateResultReceiverSet.add(l),bI(u._cvr,u);let g=-1,p={};if(!l.isDce){if(!l._observedResultUnitTypes||!l._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");g=l._observedResultUnitTypes,l._observedTaskMap.forEach((m,v)=>{p[v]=m}),l._observedTaskMap.clear()}return yield new Promise((m,v)=>{let C=At();bt[C]=function(){var D=oe(function*(O){if(O.success)return m();{let L=new Error(O.message);return L.stack=O.stack+"\n"+L.stack,v(L)}});return function(O){return D.apply(this,arguments)}}(),dt.postMessage({type:"cvr_setIrrRegistry",id:C,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState,observedResultUnitTypes:String(g),observedTaskMap:p}})})})()}removeResultReceiver(l){var u=this;return oe(function*(){return u._cvr._intermediateResultReceiverSet.delete(l),bI(u._cvr,u),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g();{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_setIrrRegistry",id:m,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const DI="undefined"==typeof self,qm=(()=>{if(!DI&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),SI=f=>{if(null==f&&(f="./"),!DI){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};var Zm;null==Ue.cvr&&(Ue.cvr=qm),Yr.cvr={js:!0,wasm:!0,deps:["license","dip"]},gn.cvr={};const Km="1.2.10";"string"!=typeof Ue.std&&Wr(Ue.std.version,Km)<0&&(Ue.std={version:Km,path:SI(qm+`../../dynamsoft-capture-vision-std@${Km}/dist/`)});const Qm="2.2.30";(!Ue.dip||"string"!=typeof Ue.dip&&Wr(Ue.dip.version,Qm)<0)&&(Ue.dip={version:Qm,path:SI(qm+`../../dynamsoft-image-processing@${Qm}/dist/`)});class II{static getVersion(){return this._version}}var Qh,TI;function xI(f,l){if(f&&f.location){const u=f.location.points;for(let g of u)g.x=g.x/l,g.y=g.y/l;xI(f.referencedItem,l)}}II._version=`2.2.30(Worker: ${null===(Zm=go.cvr)||void 0===Zm?void 0:Zm.worker}, Wasm: loading...`,function(f){f[f.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",f[f.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Qh||(Qh={})),function(f){f[f.IRUT_NULL=0]="IRUT_NULL",f[f.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",f[f.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",f[f.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",f[f.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",f[f.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",f[f.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",f[f.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",f[f.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",f[f.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",f[f.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",f[f.IRUT_CONTOURS=1024]="IRUT_CONTOURS",f[f.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",f[f.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",f[f.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",f[f.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",f[f.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",f[f.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",f[f.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",f[f.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",f[f.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",f[f.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",f[f.IRUT_CORNERS=2097152]="IRUT_CORNERS",f[f.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",f[f.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",f[f.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",f[f.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",f[f.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",f[f.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",f[f.IRUT_ALL=134217727]="IRUT_ALL"}(TI||(TI={}));class St{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(tn.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return oe(function*(){if(!gn.license)throw Error("Module `license` is not existed.");yield gn.license.dynamsoft(),yield Dr(["cvr"]);const l=new St,u=new ba;let g=At();return bt[g]=function(){var p=oe(function*(m){var v;if(m.success)l._instanceID=m.instanceID,l._currentSettings=JSON.parse(m.outputSettings),II._version=`2.2.30(Worker: ${null===(v=go.cvr)||void 0===v?void 0:v.worker}, Wasm: ${m.version})`,0===tn.bSupportDce4Module&&(l._intermediateResultManager=l.getIntermediateResultManager(!0)),u.resolve(l);else{const C=Error(m.message);m.stack&&(C.stack=m.stack),u.reject(C)}});return function(m){return p.apply(this,arguments)}}(),dt.postMessage({type:"cvr_createInstance",id:g}),u})()}_singleFrameModeCallback(l){var u=this;return oe(function*(){u._isa.getCameraView().setScanLaserVisible(!0);for(let v of u._resultReceiverSet)u._bNeedOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:l});const g={bytes:new Uint8Array(l.bytes),width:l.width,height:l.height,stride:l.stride,format:l.format,tag:l.tag};u._templateName||(u._templateName=u._currentSettings.CaptureVisionTemplates[0].Name);const p=yield u.capture(g,u._templateName);p.originalImageTag=l.tag;for(let v of u._resultReceiverSet)v.isDce&&v.onCapturedResultReceived(p,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const m={originalImageHashId:p.originalImageHashId,originalImageTag:p.originalImageTag,errorCode:p.errorCode,errorString:p.errorString};for(let v of u._resultReceiverSet)if(v.onDecodedBarcodesReceived&&p.barcodeResultItems&&v.onDecodedBarcodesReceived(Object.assign(Object.assign({},m),{barcodeResultItems:p.barcodeResultItems})),v.onRecognizedTextLinesReceived&&p.textLineResultItems&&v.onRecognizedTextLinesReceived(Object.assign(Object.assign({},m),{textLineResultItems:p.textLineResultItems})),v.onDetectedQuadsReceived&&p.detectedQuadResultItems&&v.onDetectedQuadsReceived(Object.assign(Object.assign({},m),{detectedQuadResultItems:p.detectedQuadResultItems})),v.onNormalizedImagesReceived&&p.normalizedImageResultItems&&v.onNormalizedImagesReceived(Object.assign(Object.assign({},m),{normalizedImageResultItems:p.normalizedImageResultItems})),v.onParsedResultsReceived&&p.parsedResultItems&&v.onParsedResultsReceived(Object.assign(Object.assign({},m),{parsedResultItems:p.parsedResultItems})),v.onCapturedResultReceived&&!v.isDce){if(u._bNeedOutputOriginalImage){const C=p.items.findIndex(D=>1===D.type);-1!==C&&(p.items[C].imageData=l)}v.onCapturedResultReceived(p)}})()}setInput(l){if(this._checkIsDisposed(),l){if(this._isa=l,l.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const u=this._isa.getCameraView();if(u){const g=u._capturedResultReceiver;g.isDce=!0,this._resultReceiverSet.add(g)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(l){if(this._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid ISA state listener.");l&&Object.keys(l)&&this._isaStateListenerSet.add(l)}removeImageSourceStateListener(l){return this._checkIsDisposed(),this._isaStateListenerSet.delete(l)}addResultReceiver(l){if(this._checkIsDisposed(),"object"!=typeof l)throw new Error("Invalid receiver.");l&&Object.keys(l).length&&(this._resultReceiverSet.add(l),this._setCrrRegistry())}removeResultReceiver(l){this._checkIsDisposed(),this._resultReceiverSet.delete(l),this._setCrrRegistry()}_setCrrRegistry(){var l=this;return oe(function*(){const u={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let m of l._resultReceiverSet)m.isDce||(u.onCapturedResultReceived=!!m.onCapturedResultReceived,u.onDecodedBarcodesReceived=!!m.onDecodedBarcodesReceived,u.onRecognizedTextLinesReceived=!!m.onRecognizedTextLinesReceived,u.onDetectedQuadsReceived=!!m.onDetectedQuadsReceived,u.onNormalizedImagesReceived=!!m.onNormalizedImagesReceived,u.onParsedResultsReceived=!!m.onParsedResultsReceived);const g=new ba;let p=At();return bt[p]=function(){var m=oe(function*(v){if(v.success)g.resolve();else{let C=new Error(v.message);C.stack=v.stack+"\n"+C.stack,g.reject()}});return function(v){return m.apply(this,arguments)}}(),dt.postMessage({type:"cvr_setCrrRegistry",id:p,instanceID:l._instanceID,body:{receiver:JSON.stringify(u)}}),g})()}addResultFilter(l){var u=this;return oe(function*(){if(u._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid filter.");if(l&&Object.keys(l)){u._resultFilterSet.add(l),u._handleFilterSwitch();for(let g of u._resultFilterSet)yield u._enableResultCrossVerification(g.verificationEnabled),yield u._enableResultDeduplication(g.duplicateFilterEnabled),yield u._setDuplicateForgetTime(g.duplicateForgetTime)}})()}removeResultFilter(l){var u=this;return oe(function*(){u._checkIsDisposed(),u._resultFilterSet.delete(l),u._handleFilterSwitch();for(let g of u._resultFilterSet)yield u._enableResultCrossVerification(g.verificationEnabled),yield u._enableResultDeduplication(g.duplicateFilterEnabled),yield u._setDuplicateForgetTime(g.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let l of this._resultFilterSet)l.isResultCrossVerificationEnabled(nn.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),l.isResultCrossVerificationEnabled(nn.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),l.isResultCrossVerificationEnabled(nn.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),l.isResultCrossVerificationEnabled(nn.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(l){var u=this;return oe(function*(){var g,p;if(u._checkIsDisposed(),!u._bPauseScan)return;if(!u._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const m=yield u.containsTask(l);return yield Dr(m),m.includes("dlr")&&!(null===(g=gn.dlr)||void 0===g?void 0:g.bLoadConfusableCharsData)&&(yield null===(p=gn.dlr)||void 0===p?void 0:p.loadRecognitionData("ConfusableChars",Ue.dlr)),u._isa.isCameraEnhancer&&(m.includes("ddn")?u._isa.setPixelFormat(je.IPF_ABGR_8888):u._isa.setPixelFormat(je.IPF_GRAYSCALED)),void 0!==u._isa.singleFrameMode&&"disabled"!==u._isa.singleFrameMode?(u._templateName=l,void u._isa.on("singleFrameAcquired",u._singleFrameModeCallbackBind)):(u._isa.getColourChannelUsageType()===br.CCUT_AUTO&&u._isa.setColourChannelUsageType(m.includes("ddn")?br.CCUT_FULL_CHANNEL:br.CCUT_Y_CHANNEL_ONLY),u._promiseStartScan&&u._promiseStartScan.isPending?u._promiseStartScan:(u._promiseStartScan=new ba((v,C)=>{if(u.disposed)return;let D=At();bt[D]=function(){var O=oe(function*(L){if(u._promiseStartScan&&!u._promiseStartScan.isFulfilled){if(!L.success){let N=new Error(L.message);return N.stack=L.stack+"\n"+N.stack,C(N)}for(let N of u._resultFilterSet)yield u.addResultFilter(N);u._bPauseScan=!1,u._bNeedOutputOriginalImage=L.bNeedOutputOriginalImage,u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(oe(function*(){-1!==u._minImageCaptureInterval&&u._isa.startFetching(),u._loopReadVideo(l),v()}),0),u._isa.isCameraEnhancer&&u._isa.getCameraView().setScanLaserVisible(!0)}});return function(L){return O.apply(this,arguments)}}(),dt.postMessage({type:"cvr_startCapturing",id:D,instanceID:u._instanceID,body:{templateName:l}})}),yield u._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(br.CCUT_AUTO)))}_clearVerifyList(){var l=this;return oe(function*(){let u=At();const g=new ba;return bt[u]=function(){var p=oe(function*(m){if(m.success)return g.resolve();{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,g.reject(v)}});return function(m){return p.apply(this,arguments)}}(),dt.postMessage({type:"cvr_clearVerifyList",id:u,instanceID:l._instanceID}),g})()}_getIntermediateResult(){var l=this;return oe(function*(){l._checkIsDisposed();let u=At();const g=new ba;return bt[u]=function(){var p=oe(function*(m){if(m.success)g.resolve(m.result);else{let v=new Error(m.message);v.stack=m.stack+"\n"+v.stack,g.reject(v)}});return function(m){return p.apply(this,arguments)}}(),dt.postMessage({type:"cvr_getIntermediateResult",id:u,instanceID:l._instanceID}),g})()}containsTask(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(JSON.parse(C.tasks));{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_containsTask",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}_loopReadVideo(l){var u=this;return oe(function*(){if(u._dynamsoft=!0,u.disposed||u._bPauseScan)return;if(u._isa.isBufferEmpty())if(u._isa.hasNextImageToFetch())for(let p of u._isaStateListenerSet)p.onImageSourceStateReceived&&p.onImageSourceStateReceived(Qh.ISS_BUFFER_EMPTY);else if(!u._isa.hasNextImageToFetch())for(let p of u._isaStateListenerSet)p.onImageSourceStateReceived&&p.onImageSourceStateReceived(Qh.ISS_EXHAUSTED);if(-1===u._minImageCaptureInterval||u._isa.isBufferEmpty())try{u._isa.isBufferEmpty()&&St._onLog&&St._onLog("buffer is empty so fetch image"),St._onLog&&St._onLog(`DCE: start fetching a frame: ${Date.now()}`),u._dsImage=u._isa.fetchImage(),St._onLog&&St._onLog(`DCE: finish fetching a frame: ${Date.now()}`),u._isa.setImageFetchInterval(u._averageTime)}catch(p){return void u._reRunCurrnetFunc(l)}else if(u._isa.setImageFetchInterval(u._averageTime-(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0)),u._dsImage=u._isa.getImage(),u._dsImage.tag&&Date.now()-u._dsImage.tag.timeStamp>200)return void u._reRunCurrnetFunc(l);if(!u._dsImage)return void u._reRunCurrnetFunc(l);for(let p of u._resultReceiverSet)u._bNeedOutputOriginalImage&&p.onOriginalImageResultReceived&&p.onOriginalImageResultReceived({imageData:u._dsImage});const g=Date.now();u._captureDsimage(u._dsImage,l).then(function(){var p=oe(function*(m){if(St._onLog&&St._onLog("no js handle time: "+(Date.now()-g)),u._bPauseScan)return void u._reRunCurrnetFunc(l);m.originalImageTag=u._dsImage.tag?u._dsImage.tag:null;for(let D of u._resultReceiverSet)if(D.isDce){const O=Date.now();if(D.onCapturedResultReceived(m,{isDetectVerifyOpen:u._bOpenDetectVerify,isNormalizeVerifyOpen:u._bOpenNormalizeVerify,isBarcodeVerifyOpen:u._bOpenBarcodeVerify,isLabelVerifyOpen:u._bOpenLabelVerify}),St._onLog){const L=Date.now()-O;L>10&&St._onLog(`draw result time: ${L}`)}}const v={originalImageHashId:m.originalImageHashId,originalImageTag:m.originalImageTag,errorCode:m.errorCode,errorString:m.errorString};for(let D of u._resultReceiverSet)D.onDecodedBarcodesReceived&&m.barcodeResultItems&&D.onDecodedBarcodesReceived(Object.assign(Object.assign({},v),{barcodeResultItems:m.barcodeResultItems.filter(O=>!O.isFilter)})),D.onRecognizedTextLinesReceived&&m.textLineResultItems&&D.onRecognizedTextLinesReceived(Object.assign(Object.assign({},v),{textLineResultItems:m.textLineResultItems.filter(O=>!O.isFilter)})),D.onDetectedQuadsReceived&&m.detectedQuadResultItems&&D.onDetectedQuadsReceived(Object.assign(Object.assign({},v),{detectedQuadResultItems:m.detectedQuadResultItems.filter(O=>!O.isFilter)})),D.onNormalizedImagesReceived&&m.normalizedImageResultItems&&D.onNormalizedImagesReceived(Object.assign(Object.assign({},v),{normalizedImageResultItems:m.normalizedImageResultItems.filter(O=>!O.isFilter)})),D.onParsedResultsReceived&&m.parsedResultItems&&D.onParsedResultsReceived(Object.assign(Object.assign({},v),{parsedResultItems:m.parsedResultItems.filter(O=>!O.isFilter)})),D.onCapturedResultReceived&&!D.isDce&&(m.items=m.items.filter(O=>!O.isFilter),m.barcodeResultItems&&(m.barcodeResultItems=m.barcodeResultItems.filter(O=>!O.isFilter)),m.textLineResultItems&&(m.textLineResultItems=m.textLineResultItems.filter(O=>!O.isFilter)),m.detectedQuadResultItems&&(m.detectedQuadResultItems=m.detectedQuadResultItems.filter(O=>!O.isFilter)),m.normalizedImageResultItems&&(m.normalizedImageResultItems=m.normalizedImageResultItems.filter(O=>!O.isFilter)),m.parsedResultItems&&(m.parsedResultItems=m.parsedResultItems.filter(O=>!O.isFilter)),D.onCapturedResultReceived(m));const C=Date.now();if(u._minImageCaptureInterval>-1&&(5===u._averageProcessintTimeArray.length&&u._averageProcessintTimeArray.shift(),5===u._averageFetchImageTimeArray.length&&u._averageFetchImageTimeArray.shift(),u._averageProcessintTimeArray.push(Date.now()-g),u._averageFetchImageTimeArray.push(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0),u._averageTime=Math.min(...u._averageProcessintTimeArray)-Math.max(...u._averageFetchImageTimeArray),u._averageTime=u._averageTime>0?u._averageTime:0,St._onLog&&(St._onLog(`minImageCaptureInterval: ${u._minImageCaptureInterval}`),St._onLog(`averageProcessintTimeArray: ${u._averageProcessintTimeArray}`),St._onLog(`averageFetchImageTimeArray: ${u._averageFetchImageTimeArray}`),St._onLog(`averageTime: ${u._averageTime}`))),St._onLog){const D=Date.now()-C;D>10&&St._onLog(`fetch image calculate time: ${D}`)}St._onLog&&St._onLog(`time finish decode: ${Date.now()}`),St._onLog&&St._onLog("main time: "+(Date.now()-g)),St._onLog&&St._onLog("===================================================="),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=u._minImageCaptureInterval>0&&u._minImageCaptureInterval>=u._averageTime?setTimeout(()=>{u._loopReadVideo(l)},u._minImageCaptureInterval-u._averageTime):setTimeout(()=>{u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,0))});return function(m){return p.apply(this,arguments)}}()).catch(p=>{u._isa.stopFetching(),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(()=>{u._isa.startFetching(),u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,1e3)),"platform error"!==p.message&&setTimeout(()=>{throw p},0)})})()}_reRunCurrnetFunc(l){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(l)},0)}capture(l,u){var g=this;return oe(function*(){var p,m;g._checkIsDisposed(),u||(u=g._currentSettings.CaptureVisionTemplates[0].Name);const v=yield g.containsTask(u);let C;if(yield Dr(v),v.includes("dlr")&&!(null===(p=gn.dlr)||void 0===p?void 0:p.bLoadConfusableCharsData)&&(yield null===(m=gn.dlr)||void 0===m?void 0:m.loadRecognitionData("ConfusableChars",Ue.dlr)),g._dynamsoft=!1,KS(l))C=yield g._captureDsimage(l,u);else if("string"==typeof l)C="data:image/"==l.substring(0,11)?yield g._captureBase64(l,u):yield g._captureUrl(l,u);else if(l instanceof Blob)C=yield g._captureBlob(l,u);else if(l instanceof HTMLImageElement)C=yield g._captureImage(l,u);else if(l instanceof HTMLCanvasElement)C=yield g._captureCanvas(l,u);else{if(!(l instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");C=yield g._captureVideo(l,u)}return C})()}_captureDsimage(l,u){var g=this;return oe(function*(){return yield g._captureInWorker(l,u)})()}_captureUrl(l,u){var g=this;return oe(function*(){let p=yield QS(l,"blob");return yield g._captureBlob(p,u)})()}_captureBase64(l,u){var g=this;return oe(function*(){l=l.substring(l.indexOf(",")+1);let p=atob(l),m=p.length,v=new Uint8Array(m);for(;m--;)v[m]=p.charCodeAt(m);return yield g._captureBlob(new Blob([v]),u)})()}_captureBlob(l,u){var g=this;return oe(function*(){let p=null,m=null;if("undefined"!=typeof createImageBitmap)try{p=yield createImageBitmap(l)}catch(C){}var C;p||(m=yield(C=oe(function*(D){return yield new Promise((O,L)=>{let N=URL.createObjectURL(D),B=new Image;B.src=N,B.onload=()=>{URL.revokeObjectURL(B.dbrObjUrl),O(B)},B.onerror=j=>{L(new Error("Can't convert blob to image : "+(j instanceof Event?j.type:j)))}})}),function(D){return C.apply(this,arguments)})(l));let v=yield g._captureImage(p||m,u);return p&&p.close(),v})()}_captureImage(l,u){var g=this;return oe(function*(){let p,m,v=l instanceof HTMLImageElement?l.naturalWidth:l.width,C=l instanceof HTMLImageElement?l.naturalHeight:l.height,D=Math.max(v,C);D>g.maxCvsSideLength?(g._compressRate=g.maxCvsSideLength/D,p=Math.round(v*g._compressRate),m=Math.round(C*g._compressRate)):(p=v,m=C),g._canvas||(g._canvas=document.createElement("canvas"));const O=g._canvas;return O.width===p&&O.height===m||(O.width=p,O.height=m),O.ctx2d||(O.ctx2d=O.getContext("2d",{willReadFrequently:!0})),O.ctx2d.drawImage(l,0,0,v,C,0,0,p,m),l.dbrObjUrl&&URL.revokeObjectURL(l.dbrObjUrl),yield g._captureCanvas(O,u)})()}_captureCanvas(l,u){var g=this;return oe(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";if([l.width,l.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const p=l.ctx2d||l.getContext("2d",{willReadFrequently:!0}),m={bytes:Uint8Array.from(p.getImageData(0,0,l.width,l.height).data),width:l.width,height:l.height,stride:4*l.width,format:10};return yield g._captureInWorker(m,u)})()}_captureVideo(l,u){var g=this;return oe(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";let p,m,v=l.videoWidth,C=l.videoHeight,D=Math.max(v,C);D>g.maxCvsSideLength?(g._compressRate=g.maxCvsSideLength/D,p=Math.round(v*g._compressRate),m=Math.round(C*g._compressRate)):(p=v,m=C),g._canvas||(g._canvas=document.createElement("canvas"));const O=g._canvas;return O.width===p&&O.height===m||(O.width=p,O.height=m),O.ctx2d||(O.ctx2d=O.getContext("2d",{willReadFrequently:!0})),O.ctx2d.drawImage(l,0,0,v,C,0,0,p,m),yield g._captureCanvas(O,u)})()}_captureInWorker(l,u){var g=this;return oe(function*(){const{bytes:p,width:m,height:v,stride:C,format:D}=l;let O=At();const L=new ba;return bt[O]=function(){var N=oe(function*(B){var j,W;if(!B.success){let Y=new Error(B.message);return Y.stack=B.stack+"\n"+Y.stack,L.reject(Y)}{const Y=Date.now();St._onLog&&(St._onLog(`get result time from worker: ${Y}`),St._onLog("worker to main time consume: "+(Y-B.workerReturnMsgTime)));try{const $=B.captureResult;l.bytes=B.bytes;for(let X of $.items)0!==g._compressRate&&xI(X,g._compressRate),X.type===nn.CRIT_ORIGINAL_IMAGE?X.imageData=l:X.type===nn.CRIT_NORMALIZED_IMAGE?null===(j=gn.ddn)||void 0===j||j.handleNormalizedImageResultItem(X):X.type===nn.CRIT_PARSED_RESULT&&(null===(W=gn.dcp)||void 0===W||W.handleParsedResultItem(X));if(g._dynamsoft)for(let X of g._resultFilterSet)X.onDecodedBarcodesReceived($.items),X.onRecognizedTextLinesReceived($.items),X.onDetectedQuadsReceived($.items),X.onNormalizedImagesReceived($.items);const q=function(X){const Q={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return X.items.forEach(pe=>{pe.type===nn.CRIT_BARCODE?Q.barcodeResultItems.push(pe):pe.type===nn.CRIT_TEXT_LINE?Q.textLineResultItems.push(pe):pe.type===nn.CRIT_DETECTED_QUAD?Q.detectedQuadResultItems.push(pe):pe.type===nn.CRIT_NORMALIZED_IMAGE?Q.normalizedImageResultItems.push(pe):pe.type===nn.CRIT_PARSED_RESULT&&Q.parsedResultItems.push(pe)}),Q}($);if(q.barcodeResultItems.length&&($.barcodeResultItems=q.barcodeResultItems),q.textLineResultItems.length&&($.textLineResultItems=q.textLineResultItems),q.detectedQuadResultItems.length&&($.detectedQuadResultItems=q.detectedQuadResultItems),q.normalizedImageResultItems.length&&($.normalizedImageResultItems=q.normalizedImageResultItems),q.parsedResultItems.length&&($.parsedResultItems=q.parsedResultItems),!g._bPauseScan||!g._dynamsoft){const X=$.intermediateResult;if(X){let Q=0;for(let pe of g._intermediateResultReceiverSet){Q++;for(let ve of X){if("onTaskResultsReceived"===ve.info.callbackName){for(let Te of ve.intermediateResultUnits)Te.originalImageTag=l.tag?l.tag:null;pe[ve.info.callbackName]&&pe[ve.info.callbackName]({intermediateResultUnits:ve.intermediateResultUnits},ve.info)}else pe[ve.info.callbackName]&&pe[ve.info.callbackName](ve.result,ve.info);Q===g._intermediateResultReceiverSet.size&&delete ve.info.callbackName}}}$&&$.intermediateResult&&delete $.intermediateResult}return g._compressRate=0,L.resolve($)}catch($){return L.reject($)}}});return function(B){return N.apply(this,arguments)}}(),St._onLog&&St._onLog(`send buffer to worker: ${Date.now()}`),dt.postMessage({type:"cvr_capture",id:O,instanceID:g._instanceID,body:{bytes:p,width:m,height:v,stride:C,format:D,templateName:u||"",dynamsoft:g._dynamsoft}},[p.buffer]),L})()}initSettings(l){var u=this;return oe(function*(){return u._checkIsDisposed(),l&&["string","object"].includes(typeof l)?("string"==typeof l?l.startsWith("{")?u._currentSettings=JSON.parse(l):l=yield QS(l,"text"):"object"==typeof l&&(u._currentSettings=l,l=JSON.stringify(l)),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success){const D=JSON.parse(C.response);if(0!==D.exception){let N=new Error(D.description?D.description:"Init Settings Failed.");return N.errorCode=D.exception,p(N)}let O=[],L=JSON.parse(l).CaptureVisionTemplates;for(let N=0;N<L.length;N++){let B=yield u.containsTask(L[N].Name);O=O.concat(B)}return yield Dr([...new Set(O)]),u._bNeedOutputOriginalImage=1===u._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,g(D)}{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid template.")})()}outputSettings(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success){const D=JSON.parse(C.settings);if(0!==D.errorCode){let O=new Error(D.errorString);return O.errorCode=D.errorCode,p(O)}return delete D.errorCode,delete D.errorString,g(D)}{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_outputSettings",id:m,instanceID:u._instanceID,body:{templateName:l||"*"}})})})()}outputSettingsToFile(l,u,g){var p=this;return oe(function*(){const m=yield p.outputSettings(l),v=new Blob([JSON.stringify(m,null,2,function(C,D){return D instanceof Array?JSON.stringify(D):D},2)],{type:"application/json"});if(g){const C=document.createElement("a");C.href=URL.createObjectURL(v),u.endsWith(".json")&&(u=u.replace(".json","")),C.download=`${u}.json`,C.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(C.href)},500)},C.click()}return v})()}getSimplifiedSettings(l){var u=this;return oe(function*(){u._checkIsDisposed(),l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const g=yield u.containsTask(l);return yield Dr(g),yield new Promise((p,m)=>{let v=At();bt[v]=function(){var C=oe(function*(D){if(D.success){const O=JSON.parse(D.settings,(L,N)=>cj&&"barcodeFormatIds"===L?BigInt(N):N);if(O.minImageCaptureInterval=u._minImageCaptureInterval,0!==O.code){let L=new Error(O.codeString);return L.errorCode=O.errorCode,m(L)}return delete O.code,delete O.codeString,p(O)}{let O=new Error(D.message);return O.stack=D.stack+"\n"+O.stack,m(O)}});return function(D){return C.apply(this,arguments)}}(),dt.postMessage({type:"cvr_getSimplifiedSettings",id:v,instanceID:u._instanceID,body:{templateName:l}})})})()}updateSettings(l,u){var g=this;return oe(function*(){g._checkIsDisposed();const p=yield g.containsTask(l);return yield Dr(p),yield new Promise((m,v)=>{let C=At();bt[C]=function(){var D=oe(function*(O){if(O.success){const L=JSON.parse(O.response);if(u.minImageCaptureInterval&&u.minImageCaptureInterval>=-1&&(g._minImageCaptureInterval=u.minImageCaptureInterval),g._bNeedOutputOriginalImage=O.bNeedOutputOriginalImage,0!==L.exception){let N=new Error(L.description?L.description:"Update Settings Failed.");return N.errorCode=L.exception,v(N)}return g._currentSettings=yield g.outputSettings("*"),m(L)}{let L=new Error(O.message);return L.stack=O.stack+"\n"+L.stack,v(L)}});return function(O){return D.apply(this,arguments)}}(),dt.postMessage({type:"cvr_updateSettings",id:C,instanceID:g._instanceID,body:{settings:u,templateName:l}})})})()}resetSettings(){var l=this;return oe(function*(){return l._checkIsDisposed(),yield new Promise((u,g)=>{let p=At();bt[p]=function(){var m=oe(function*(v){if(v.success){const C=JSON.parse(v.response);if(0!==C.exception){let D=new Error(C.description?C.description:"Reset Settings Failed.");return D.errorCode=C.exception,g(D)}return l._currentSettings=yield l.outputSettings("*"),u(C)}{let C=new Error(v.message);return C.stack=v.stack+"\n"+C.stack,g(C)}});return function(v){return m.apply(this,arguments)}}(),dt.postMessage({type:"cvr_resetSettings",id:p,instanceID:l._instanceID})})})()}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new mj(this)),this._bufferdItemsManager}getIntermediateResultManager(l){if(this._checkIsDisposed(),!l&&0!==tn.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new vj(this)),this._intermediateResultManager}contains(l,u){return function(g,p){let m=p.x,v=p.y,C=g[0].x,D=g[0].y,O=g[1].x,L=g[1].y,N=g[2].x,B=g[2].y,j=g[3].x,W=g[3].y,Y=Q(m,v,C,D,O,L),$=Q(m,v,O,L,N,B),q=Q(m,v,N,B,j,W),X=Q(m,v,j,W,C,D);function Q(pe,ve,Te,Ae,P,Ee){return(pe-Te)*(Ee-Ae)-(ve-Ae)*(P-Te)}return Y>=0&&$>=0&&q>=0&&X>=0||Y<=0&&$<=0&&q<=0&&X<=0}(l,u)}parseRequiredResources(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(JSON.parse(C.resources));{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_parseRequiredResources",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}dispose(){var l=this;return oe(function*(){l._checkIsDisposed(),l._promiseStartScan&&l.stopCapturing(),l._isa=null,l._resultReceiverSet.clear(),l._isaStateListenerSet.clear(),l._resultFilterSet.clear(),l.bDestroyed=!0;let u=At();bt[u]=g=>{if(!g.success){let p=new Error(g.message);throw p.stack=g.stack+"\n"+p.stack,p}},dt.postMessage({type:"cvr_dispose",id:u,instanceID:l._instanceID})})()}_enableResultCrossVerification(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(C.result);{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_enableResultCrossVerification",id:m,instanceID:u._instanceID,body:{verificationEnabled:l}})})})()}_enableResultDeduplication(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(C.result);{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_enableResultDeduplication",id:m,instanceID:u._instanceID,body:{duplicateFilterEnabled:l}})})})()}_setDuplicateForgetTime(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(C.result);{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_setDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{duplicateForgetTime:l}})})})()}_getDuplicateForgetTime(l){var u=this;return oe(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=At();bt[m]=function(){var v=oe(function*(C){if(C.success)return g(C.time);{let D=new Error(C.message);return D.stack=C.stack+"\n"+D.stack,p(D)}});return function(C){return v.apply(this,arguments)}}(),dt.postMessage({type:"cvr_getDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{type:l}})})})()}_setThresholdValue(l,u,g){var p=this;return oe(function*(){return yield Dr("ddn"),yield new Promise((m,v)=>{let C=At();bt[C]=function(){var D=oe(function*(O){if(O.success)return m();{let L=new Error(O.message);return L.stack=O.stack+"\n"+L.stack,v(L)}});return function(O){return D.apply(this,arguments)}}(),dt.postMessage({type:"ddn_setThresholdValue",id:C,instanceID:p._instanceID,body:{threshold:l,leftLimit:u,rightLimit:g}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}const Jm="undefined"==typeof self,yj=(()=>{if(!Jm&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})();function U(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function Le(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}let _c,$r,Jh,ed,Mn;null==Ue.dce&&(Ue.dce=yj),Yr.dce={wasm:!1,js:!1},gn.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(_c=navigator,$r=_c.userAgent,Jh=_c.platform,ed=_c.mediaDevices),function(){if(!Jm){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:_c.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Jh,search:"Win"},Mac:{str:Jh},Linux:{str:Jh}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let O=v.verStr||$r,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||$r).indexOf(v.search||m)){u=m;for(let N of L){let B=O.indexOf(N);if(-1!=B){g=parseFloat(O.substring(B+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||$r).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=$r.indexOf("Windows NT")&&(p="HarmonyOS"),Mn={browser:u,version:g,OS:p}}Jm&&(Mn={browser:"ssr",version:0,OS:"ssr"})}();const Cj="undefined"!=typeof WebAssembly&&$r&&!(/Safari/.test($r)&&!/Chrome/.test($r)&&/\(.+\s11_2_([2-6]).*\)/.test($r)),wj="undefined"!=typeof Worker,AI=!(!ed||!ed.getUserMedia),Ej=function(){var f=oe(function*(){let l=!1;if(AI)try{(yield ed.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return f.apply(this,arguments)}}();var bj={653:(f,l,u)=>{var g,p,m,v,C,D,O,L,N,B,W,Y,$,q,X,Q,pe,ve,Te,Ae,S,w,b,T,P=P||{version:"5.2.1"};if(l.fabric=P,"undefined"!=typeof document&&"undefined"!=typeof window)P.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),P.window=window;else{var Ee=new(u(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;P.document=Ee.document,P.jsdomImplForWrapper=u(898).implForWrapper,P.nodeCanvas=u(245).Canvas,P.window=Ee,DOMParser=P.window.DOMParser}function Be(S,w){var b=S.canvas,T=w.targetCanvas,_=T.getContext("2d");_.translate(0,T.height),_.scale(1,-1),_.drawImage(b,0,b.height-T.height,T.width,T.height,0,0,T.width,T.height)}function Je(S,w){var b=w.targetCanvas.getContext("2d"),T=w.destinationWidth,_=w.destinationHeight,y=T*_*4,I=new Uint8Array(this.imageBuffer,0,y),M=new Uint8ClampedArray(this.imageBuffer,0,y);S.readPixels(0,0,T,_,S.RGBA,S.UNSIGNED_BYTE,I);var x=new ImageData(M,T,_);b.putImageData(x,0,0)}P.isTouchSupported="ontouchstart"in P.window||"ontouchstart"in P.document||P.window&&P.window.navigator&&P.window.navigator.maxTouchPoints>0,P.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,P.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],P.DPI=96,P.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",P.commaWsp="(?:\\s+,?\\s*|,\\s*)",P.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,P.reNonWord=/[ \n\.,;!\?\-]/,P.fontPaths={},P.iMatrix=[1,0,0,1,0,0],P.svgNS="http://www.w3.org/2000/svg",P.perfLimitSizeTotal=2097152,P.maxCacheSideLimit=4096,P.minCacheSideLimit=256,P.charWidthsCache={},P.textureSize=2048,P.disableStyleCopyPaste=!1,P.enableGLFiltering=!0,P.devicePixelRatio=P.window.devicePixelRatio||P.window.webkitDevicePixelRatio||P.window.mozDevicePixelRatio||1,P.browserShadowBlurConstant=1,P.arcToSegmentsCache={},P.boundsOfCurveCache={},P.cachesBoundsOfCurve=!0,P.forceGLPutImageData=!1,P.initFilterBackend=function(){return P.enableGLFiltering&&P.isWebglSupported&&P.isWebglSupported(P.textureSize)?(console.log("max texture size: "+P.maxTextureSize),new P.WebglFilterBackend({tileSize:P.textureSize})):P.Canvas2dFilterBackend?new P.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=P),function(){function S(b,T){if(this.__eventListeners[b]){var _=this.__eventListeners[b];T?_[_.indexOf(T)]=!1:P.util.array.fill(_,!1)}}function w(b,T){var _=function(){T.apply(this,arguments),this.off(b,_)}.bind(this);this.on(b,_)}P.Observable={fire:function(b,T){if(!this.__eventListeners)return this;var _=this.__eventListeners[b];if(!_)return this;for(var y=0,I=_.length;y<I;y++)_[y]&&_[y].call(this,T||{});return this.__eventListeners[b]=_.filter(function(M){return!1!==M}),this},on:function(b,T){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var _ in b)this.on(_,b[_]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(T);return this},once:function(b,T){if(1===arguments.length)for(var _ in b)w.call(this,_,b[_]);else w.call(this,b,T);return this},off:function(b,T){if(!this.__eventListeners)return this;if(0===arguments.length)for(b in this.__eventListeners)S.call(this,b);else if(1===arguments.length&&"object"==typeof arguments[0])for(var _ in b)S.call(this,_,b[_]);else S.call(this,b,T);return this}}}(),P.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var S=0,w=arguments.length;S<w;S++)this._onObjectAdded(arguments[S]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(S,w,b){var T=this._objects;return b?T[w]=S:T.splice(w,0,S),this._onObjectAdded&&this._onObjectAdded(S),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var S,w=this._objects,b=!1,T=0,_=arguments.length;T<_;T++)-1!==(S=w.indexOf(arguments[T]))&&(b=!0,w.splice(S,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[T]));return this.renderOnAddRemove&&b&&this.requestRenderAll(),this},forEachObject:function(S,w){for(var b=this.getObjects(),T=0,_=b.length;T<_;T++)S.call(w,b[T],T,b);return this},getObjects:function(S){return void 0===S?this._objects.concat():this._objects.filter(function(w){return w.type===S})},item:function(S){return this._objects[S]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(S,w){return this._objects.indexOf(S)>-1||!!w&&this._objects.some(function(b){return"function"==typeof b.contains&&b.contains(S,!0)})},complexity:function(){return this._objects.reduce(function(S,w){return S+(w.complexity?w.complexity():0)},0)}},P.CommonMethods={_setOptions:function(S){for(var w in S)this.set(w,S[w])},_initGradient:function(S,w){!S||!S.colorStops||S instanceof P.Gradient||this.set(w,new P.Gradient(S))},_initPattern:function(S,w,b){!S||!S.source||S instanceof P.Pattern?b&&b():this.set(w,new P.Pattern(S,b))},_setObject:function(S){for(var w in S)this._set(w,S[w])},set:function(S,w){return"object"==typeof S?this._setObject(S):this._set(S,w),this},_set:function(S,w){this[S]=w},toggle:function(S){var w=this.get(S);return"boolean"==typeof w&&this.set(S,!w),this},get:function(S){return this[S]}},g=l,p=Math.sqrt,m=Math.atan2,v=Math.pow,C=Math.PI/180,D=Math.PI/2,P.util={cos:function(S){if(0===S)return 1;switch(S<0&&(S=-S),S/D){case 1:case 3:return 0;case 2:return-1}return Math.cos(S)},sin:function(S){if(0===S)return 0;var w=1;switch(S<0&&(w=-1),S/D){case 1:return w;case 2:return 0;case 3:return-w}return Math.sin(S)},removeFromArray:function(S,w){var b=S.indexOf(w);return-1!==b&&S.splice(b,1),S},getRandomInt:function(S,w){return Math.floor(Math.random()*(w-S+1))+S},degreesToRadians:function(S){return S*C},radiansToDegrees:function(S){return S/C},rotatePoint:function(S,w,b){var T=new P.Point(S.x-w.x,S.y-w.y),_=P.util.rotateVector(T,b);return new P.Point(_.x,_.y).addEquals(w)},rotateVector:function(S,w){var b=P.util.sin(w),T=P.util.cos(w);return{x:S.x*T-S.y*b,y:S.x*b+S.y*T}},createVector:function(S,w){return new P.Point(w.x-S.x,w.y-S.y)},calcAngleBetweenVectors:function(S,w){return Math.acos((S.x*w.x+S.y*w.y)/(Math.hypot(S.x,S.y)*Math.hypot(w.x,w.y)))},getHatVector:function(S){return new P.Point(S.x,S.y).multiply(1/Math.hypot(S.x,S.y))},getBisector:function(S,w,b){var T=P.util.createVector(S,w),_=P.util.createVector(S,b),y=P.util.calcAngleBetweenVectors(T,_),I=y*(0===P.util.calcAngleBetweenVectors(P.util.rotateVector(T,y),_)?1:-1)/2;return{vector:P.util.getHatVector(P.util.rotateVector(T,I)),angle:y}},projectStrokeOnPoints:function(S,w,b){var T=[],_=w.strokeWidth/2,y=w.strokeUniform?new P.Point(1/w.scaleX,1/w.scaleY):new P.Point(1,1),I=function(M){var x=_/Math.hypot(M.x,M.y);return new P.Point(M.x*x*y.x,M.y*x*y.y)};return S.length<=1||S.forEach(function(M,x){var A,F,k=new P.Point(M.x,M.y);0===x?(F=S[x+1],A=b?I(P.util.createVector(F,k)).addEquals(k):S[S.length-1]):x===S.length-1?(A=S[x-1],F=b?I(P.util.createVector(A,k)).addEquals(k):S[0]):(A=S[x-1],F=S[x+1]);var V,H,G=P.util.getBisector(k,A,F),z=G.vector;if("miter"===w.strokeLineJoin&&(V=-_/Math.sin(G.angle/2),H=new P.Point(z.x*V*y.x,z.y*V*y.y),Math.hypot(H.x,H.y)/_<=w.strokeMiterLimit))return T.push(k.add(H)),void T.push(k.subtract(H));V=-_*Math.SQRT2,H=new P.Point(z.x*V*y.x,z.y*V*y.y),T.push(k.add(H)),T.push(k.subtract(H))}),T},transformPoint:function(S,w,b){return b?new P.Point(w[0]*S.x+w[2]*S.y,w[1]*S.x+w[3]*S.y):new P.Point(w[0]*S.x+w[2]*S.y+w[4],w[1]*S.x+w[3]*S.y+w[5])},makeBoundingBoxFromPoints:function(S,w){if(w)for(var b=0;b<S.length;b++)S[b]=P.util.transformPoint(S[b],w);var T=[S[0].x,S[1].x,S[2].x,S[3].x],_=P.util.array.min(T),y=P.util.array.max(T)-_,I=[S[0].y,S[1].y,S[2].y,S[3].y],M=P.util.array.min(I);return{left:_,top:M,width:y,height:P.util.array.max(I)-M}},invertTransform:function(S){var w=1/(S[0]*S[3]-S[1]*S[2]),b=[w*S[3],-w*S[1],-w*S[2],w*S[0]],T=P.util.transformPoint({x:S[4],y:S[5]},b,!0);return b[4]=-T.x,b[5]=-T.y,b},toFixed:function(S,w){return parseFloat(Number(S).toFixed(w))},parseUnit:function(S,w){var b=/\D{0,2}$/.exec(S),T=parseFloat(S);switch(w||(w=P.Text.DEFAULT_SVG_FONT_SIZE),b[0]){case"mm":return T*P.DPI/25.4;case"cm":return T*P.DPI/2.54;case"in":return T*P.DPI;case"pt":return T*P.DPI/72;case"pc":return T*P.DPI/72*12;case"em":return T*w;default:return T}},falseFunction:function(){return!1},getKlass:function(S,w){return S=P.util.string.camelize(S.charAt(0).toUpperCase()+S.slice(1)),P.util.resolveNamespace(w)[S]},getSvgAttributes:function(S){var w=["instantiated_by_use","style","id","class"];switch(S){case"linearGradient":w=w.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":w=w.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":w=w.concat(["offset","stop-color","stop-opacity"])}return w},resolveNamespace:function(S){if(!S)return P;var w,b=S.split("."),T=b.length,_=g||P.window;for(w=0;w<T;++w)_=_[b[w]];return _},loadImage:function(S,w,b,T){if(S){var _=P.util.createImage(),y=function(){w&&w.call(b,_,!1),_=_.onload=_.onerror=null};_.onload=y,_.onerror=function(){P.log("Error loading "+_.src),w&&w.call(b,null,!0),_=_.onload=_.onerror=null},0!==S.indexOf("data")&&null!=T&&(_.crossOrigin=T),"data:image/svg"===S.substring(0,14)&&(_.onload=null,P.util.loadImageInDom(_,y)),_.src=S}else w&&w.call(b,S)},loadImageInDom:function(S,w){var b=P.document.createElement("div");b.style.width=b.style.height="1px",b.style.left=b.style.top="-100%",b.style.position="absolute",b.appendChild(S),P.document.querySelector("body").appendChild(b),S.onload=function(){w(),b.parentNode.removeChild(b),b=null}},enlivenObjects:function(S,w,b,T){var _=[],y=0,I=(S=S||[]).length;function M(){++y===I&&w&&w(_.filter(function(x){return x}))}I?S.forEach(function(x,A){x&&x.type?P.util.getKlass(x.type,b).fromObject(x,function(F,k){k||(_[A]=F),T&&T(x,F,k),M()}):M()}):w&&w(_)},enlivenObjectEnlivables:function(S,w,b){var T=P.Object.ENLIVEN_PROPS.filter(function(_){return!!S[_]});P.util.enlivenObjects(T.map(function(_){return S[_]}),function(_){var y={};T.forEach(function(I,M){y[I]=_[M],w&&(w[I]=_[M])}),b&&b(y)})},enlivenPatterns:function(S,w){function b(){++_===y&&w&&w(T)}var T=[],_=0,y=(S=S||[]).length;y?S.forEach(function(I,M){I&&I.source?new P.Pattern(I,function(x){T[M]=x,b()}):(T[M]=I,b())}):w&&w(T)},groupSVGElements:function(S,w,b){var T;return S&&1===S.length?S[0]:(w&&(w.width&&w.height?w.centerPoint={x:w.width/2,y:w.height/2}:(delete w.width,delete w.height)),T=new P.Group(S,w),void 0!==b&&(T.sourcePath=b),T)},populateWithProperties:function(S,w,b){if(b&&Array.isArray(b))for(var T=0,_=b.length;T<_;T++)b[T]in S&&(w[b[T]]=S[b[T]])},createCanvasElement:function(){return P.document.createElement("canvas")},copyCanvasElement:function(S){var w=P.util.createCanvasElement();return w.width=S.width,w.height=S.height,w.getContext("2d").drawImage(S,0,0),w},toDataURL:function(S,w,b){return S.toDataURL("image/"+w,b)},createImage:function(){return P.document.createElement("img")},multiplyTransformMatrices:function(S,w,b){return[S[0]*w[0]+S[2]*w[1],S[1]*w[0]+S[3]*w[1],S[0]*w[2]+S[2]*w[3],S[1]*w[2]+S[3]*w[3],b?0:S[0]*w[4]+S[2]*w[5]+S[4],b?0:S[1]*w[4]+S[3]*w[5]+S[5]]},qrDecompose:function(S){var w=m(S[1],S[0]),b=v(S[0],2)+v(S[1],2),T=p(b),_=(S[0]*S[3]-S[2]*S[1])/T,y=m(S[0]*S[2]+S[1]*S[3],b);return{angle:w/C,scaleX:T,scaleY:_,skewX:y/C,skewY:0,translateX:S[4],translateY:S[5]}},calcRotateMatrix:function(S){if(!S.angle)return P.iMatrix.concat();var w=P.util.degreesToRadians(S.angle),b=P.util.cos(w),T=P.util.sin(w);return[b,T,-T,b,0,0]},calcDimensionsMatrix:function(S){var w=void 0===S.scaleX?1:S.scaleX,b=void 0===S.scaleY?1:S.scaleY,T=[S.flipX?-w:w,0,0,S.flipY?-b:b,0,0],_=P.util.multiplyTransformMatrices,y=P.util.degreesToRadians;return S.skewX&&(T=_(T,[1,0,Math.tan(y(S.skewX)),1],!0)),S.skewY&&(T=_(T,[1,Math.tan(y(S.skewY)),0,1],!0)),T},composeMatrix:function(S){var w=[1,0,0,1,S.translateX||0,S.translateY||0],b=P.util.multiplyTransformMatrices;return S.angle&&(w=b(w,P.util.calcRotateMatrix(S))),(1!==S.scaleX||1!==S.scaleY||S.skewX||S.skewY||S.flipX||S.flipY)&&(w=b(w,P.util.calcDimensionsMatrix(S))),w},resetObjectTransform:function(S){S.scaleX=1,S.scaleY=1,S.skewX=0,S.skewY=0,S.flipX=!1,S.flipY=!1,S.rotate(0)},saveObjectTransform:function(S){return{scaleX:S.scaleX,scaleY:S.scaleY,skewX:S.skewX,skewY:S.skewY,angle:S.angle,left:S.left,flipX:S.flipX,flipY:S.flipY,top:S.top}},isTransparent:function(S,w,b,T){T>0&&(w>T?w-=T:w=0,b>T?b-=T:b=0);var _,y=!0,I=S.getImageData(w,b,2*T||1,2*T||1),M=I.data.length;for(_=3;_<M&&0!=(y=I.data[_]<=0);_+=4);return I=null,y},parsePreserveAspectRatioAttribute:function(S){var w,b="meet",T=S.split(" ");return T&&T.length&&("meet"!==(b=T.pop())&&"slice"!==b?(w=b,b="meet"):T.length&&(w=T.pop())),{meetOrSlice:b,alignX:"none"!==w?w.slice(1,4):"none",alignY:"none"!==w?w.slice(5,8):"none"}},clearFabricFontCache:function(S){(S=(S||"").toLowerCase())?P.charWidthsCache[S]&&delete P.charWidthsCache[S]:P.charWidthsCache={}},limitDimsByArea:function(S,w){var b=Math.sqrt(w*S),T=Math.floor(w/b);return{x:Math.floor(b),y:T}},capValue:function(S,w,b){return Math.max(S,Math.min(w,b))},findScaleToFit:function(S,w){return Math.min(w.width/S.width,w.height/S.height)},findScaleToCover:function(S,w){return Math.max(w.width/S.width,w.height/S.height)},matrixToSVG:function(S){return"matrix("+S.map(function(w){return P.util.toFixed(w,P.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(S,w){var b=P.util.invertTransform(w),T=P.util.multiplyTransformMatrices(b,S.calcOwnMatrix());P.util.applyTransformToObject(S,T)},addTransformToObject:function(S,w){P.util.applyTransformToObject(S,P.util.multiplyTransformMatrices(w,S.calcOwnMatrix()))},applyTransformToObject:function(S,w){var b=P.util.qrDecompose(w),T=new P.Point(b.translateX,b.translateY);S.flipX=!1,S.flipY=!1,S.set("scaleX",b.scaleX),S.set("scaleY",b.scaleY),S.skewX=b.skewX,S.skewY=b.skewY,S.angle=b.angle,S.setPositionByOrigin(T,"center","center")},sizeAfterTransform:function(S,w,b){var T=S/2,_=w/2,y=[{x:-T,y:-_},{x:T,y:-_},{x:-T,y:_},{x:T,y:_}],I=P.util.calcDimensionsMatrix(b),M=P.util.makeBoundingBoxFromPoints(y,I);return{x:M.width,y:M.height}},mergeClipPaths:function(S,w){var b=S,T=w;b.inverted&&!T.inverted&&(b=w,T=S),P.util.applyTransformToObject(T,P.util.multiplyTransformMatrices(P.util.invertTransform(b.calcTransformMatrix()),T.calcTransformMatrix()));var _=b.inverted&&T.inverted;return _&&(b.inverted=T.inverted=!1),new P.Group([b],{clipPath:T,inverted:_})}},function(){var S=Array.prototype.join,w={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},b={m:"l",M:"L"};function T(H,G,z,Z,ie,re,de,ce,le,ee,J){var se=P.util.cos(H),he=P.util.sin(H),fe=P.util.cos(G),ne=P.util.sin(G),te=z*ie*fe-Z*re*ne+de,ae=Z*ie*fe+z*re*ne+ce;return["C",ee+le*(-z*ie*he-Z*re*se),J+le*(-Z*ie*he+z*re*se),te+le*(z*ie*ne+Z*re*fe),ae+le*(Z*ie*ne-z*re*fe),te,ae]}function _(H,G,z,Z){var ie=Math.atan2(G,H),re=Math.atan2(Z,z);return re>=ie?re-ie:2*Math.PI-(ie-re)}function y(H,G,z){for(var le=function(se,he,fe,ne,te,ae,ge){var ue=Math.PI,me=ge*ue/180,Ie=P.util.sin(me),be=P.util.cos(me),Ce=0,Se=0,De=-be*se*.5-Ie*he*.5,xe=-be*he*.5+Ie*se*.5,Ve=(fe=Math.abs(fe))*fe,Me=(ne=Math.abs(ne))*ne,ot=xe*xe,It=De*De,ki=Ve*Me-Ve*ot-Me*It,ls=0;if(ki<0){var $a=Math.sqrt(1-ki/(Ve*Me));fe*=$a,ne*=$a}else ls=(te===ae?-1:1)*Math.sqrt(ki/(Ve*ot+Me*It));var Xt=ls*fe*xe/ne,Bi=-ls*ne*De/fe,Wc=be*Xt-Ie*Bi+.5*se,Xa=Ie*Xt+be*Bi+.5*he,Do=_(1,0,(De-Xt)/fe,(xe-Bi)/ne),qa=_((De-Xt)/fe,(xe-Bi)/ne,(-De-Xt)/fe,(-xe-Bi)/ne);0===ae&&qa>0?qa-=2*ue:1===ae&&qa<0&&(qa+=2*ue);for(var mT=Math.ceil(Math.abs(qa/ue*2)),Pd=[],zc=qa/mT,iU=8/3*Math.sin(zc/4)*Math.sin(zc/4)/Math.sin(zc/2),$_=Do+zc,Yc=0;Yc<mT;Yc++)Pd[Yc]=T(Do,$_,be,Ie,fe,ne,Wc,Xa,iU,Ce,Se),Ce=Pd[Yc][5],Se=Pd[Yc][6],Do=$_,$_+=zc;return Pd}(z[6]-H,z[7]-G,z[1],z[2],z[4],z[5],z[3]),ee=0,J=le.length;ee<J;ee++)le[ee][1]+=H,le[ee][2]+=G,le[ee][3]+=H,le[ee][4]+=G,le[ee][5]+=H,le[ee][6]+=G;return le}function I(H,G,z,Z){return Math.sqrt((z-H)*(z-H)+(Z-G)*(Z-G))}function M(H,G,z,Z,ie,re,de,ce){return function(le){var ee,ne,J=(ee=le)*ee*ee,se=3*(ne=le)*ne*(1-ne),he=function(ne){return 3*ne*(1-ne)*(1-ne)}(le),fe=function(ne){return(1-ne)*(1-ne)*(1-ne)}(le);return{x:de*J+ie*se+z*he+H*fe,y:ce*J+re*se+Z*he+G*fe}}}function x(H,G,z,Z,ie,re,de,ce){return function(le){var ee=1-le;return Math.atan2(3*ee*ee*(Z-G)+6*ee*le*(re-Z)+3*le*le*(ce-re),3*ee*ee*(z-H)+6*ee*le*(ie-z)+3*le*le*(de-ie))}}function A(H,G,z,Z,ie,re){return function(de){var ce,se,le=(ce=de)*ce,ee=2*(se=de)*(1-se),J=function(se){return(1-se)*(1-se)}(de);return{x:ie*le+z*ee+H*J,y:re*le+Z*ee+G*J}}}function F(H,G,z,Z,ie,re){return function(de){var ce=1-de;return Math.atan2(2*ce*(Z-G)+2*de*(re-Z),2*ce*(z-H)+2*de*(ie-z))}}function k(H,G,z){var Z,ie,re={x:G,y:z},de=0;for(ie=1;ie<=100;ie+=1)Z=H(ie/100),de+=I(re.x,re.y,Z.x,Z.y),re=Z;return de}function V(H){for(var G,z,Z,ie,re=0,de=H.length,ce=0,le=0,ee=0,J=0,se=[],he=0;he<de;he++){switch(Z={x:ce,y:le,command:(G=H[he])[0]},G[0]){case"M":Z.length=0,ee=ce=G[1],J=le=G[2];break;case"L":Z.length=I(ce,le,G[1],G[2]),ce=G[1],le=G[2];break;case"C":z=M(ce,le,G[1],G[2],G[3],G[4],G[5],G[6]),ie=x(ce,le,G[1],G[2],G[3],G[4],G[5],G[6]),Z.iterator=z,Z.angleFinder=ie,Z.length=k(z,ce,le),ce=G[5],le=G[6];break;case"Q":z=A(ce,le,G[1],G[2],G[3],G[4]),ie=F(ce,le,G[1],G[2],G[3],G[4]),Z.iterator=z,Z.angleFinder=ie,Z.length=k(z,ce,le),ce=G[3],le=G[4];break;case"Z":case"z":Z.destX=ee,Z.destY=J,Z.length=I(ce,le,ee,J),ce=ee,le=J}re+=Z.length,se.push(Z)}return se.push({length:re,x:ce,y:le}),se}P.util.joinPath=function(H){return H.map(function(G){return G.join(" ")}).join(" ")},P.util.parsePath=function(H){var G,z,Z,ie,re,de=[],ce=[],le=P.rePathCommand,ee="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",J="("+ee+")"+P.commaWsp,se="([01])"+P.commaWsp+"?",he=new RegExp(J+"?"+J+"?"+J+se+se+J+"?("+ee+")","g");if(!H||!H.match)return de;for(var fe,ne=0,te=(re=H.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;ne<te;ne++){ie=(G=re[ne]).slice(1).trim(),ce.length=0;var ae=G.charAt(0);if(fe=[ae],"a"===ae.toLowerCase())for(var ge;ge=he.exec(ie);)for(var ue=1;ue<ge.length;ue++)ce.push(ge[ue]);else for(;Z=le.exec(ie);)ce.push(Z[0]);ue=0;for(var me=ce.length;ue<me;ue++)z=parseFloat(ce[ue]),isNaN(z)||fe.push(z);var Ie=w[ae.toLowerCase()],be=b[ae]||ae;if(fe.length-1>Ie)for(var Ce=1,Se=fe.length;Ce<Se;Ce+=Ie)de.push([ae].concat(fe.slice(Ce,Ce+Ie))),ae=be;else de.push(fe)}return de},P.util.makePathSimpler=function(H){var G,z,Z,ie,re,de,ce=0,le=0,ee=H.length,J=0,se=0,he=[];for(z=0;z<ee;++z){switch(Z=!1,(G=H[z].slice(0))[0]){case"l":G[0]="L",G[1]+=ce,G[2]+=le;case"L":ce=G[1],le=G[2];break;case"h":G[1]+=ce;case"H":G[0]="L",G[2]=le,ce=G[1];break;case"v":G[1]+=le;case"V":G[0]="L",le=G[1],G[1]=ce,G[2]=le;break;case"m":G[0]="M",G[1]+=ce,G[2]+=le;case"M":ce=G[1],le=G[2],J=G[1],se=G[2];break;case"c":G[0]="C",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le,G[5]+=ce,G[6]+=le;case"C":re=G[3],de=G[4],ce=G[5],le=G[6];break;case"s":G[0]="S",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le;case"S":"C"===ie?(re=2*ce-re,de=2*le-de):(re=ce,de=le),ce=G[3],le=G[4],G[0]="C",G[5]=G[3],G[6]=G[4],G[3]=G[1],G[4]=G[2],G[1]=re,G[2]=de,re=G[3],de=G[4];break;case"q":G[0]="Q",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le;case"Q":re=G[1],de=G[2],ce=G[3],le=G[4];break;case"t":G[0]="T",G[1]+=ce,G[2]+=le;case"T":"Q"===ie?(re=2*ce-re,de=2*le-de):(re=ce,de=le),G[0]="Q",ce=G[1],le=G[2],G[1]=re,G[2]=de,G[3]=ce,G[4]=le;break;case"a":G[0]="A",G[6]+=ce,G[7]+=le;case"A":Z=!0,he=he.concat(y(ce,le,G)),ce=G[6],le=G[7];break;case"z":case"Z":ce=J,le=se}Z||he.push(G),ie=G[0]}return he},P.util.getSmoothPathFromPoints=function(H,G){var z,Z=[],ie=new P.Point(H[0].x,H[0].y),re=new P.Point(H[1].x,H[1].y),de=H.length,ce=1,le=0,ee=de>2;for(ee&&(ce=H[2].x<re.x?-1:H[2].x===re.x?0:1,le=H[2].y<re.y?-1:H[2].y===re.y?0:1),Z.push(["M",ie.x-ce*(G=G||0),ie.y-le*G]),z=1;z<de;z++){if(!ie.eq(re)){var J=ie.midPointFrom(re);Z.push(["Q",ie.x,ie.y,J.x,J.y])}ie=H[z],z+1<H.length&&(re=H[z+1])}return ee&&(ce=ie.x>H[z-2].x?1:ie.x===H[z-2].x?0:-1,le=ie.y>H[z-2].y?1:ie.y===H[z-2].y?0:-1),Z.push(["L",ie.x+ce*G,ie.y+le*G]),Z},P.util.getPathSegmentsInfo=V,P.util.getBoundsOfCurve=function(H,G,z,Z,ie,re,de,ce){var le;if(P.cachesBoundsOfCurve&&(le=S.call(arguments),P.boundsOfCurveCache[le]))return P.boundsOfCurveCache[le];var ee,J,se,he,fe,ne,te,ae,ge=Math.sqrt,ue=Math.min,me=Math.max,Ie=Math.abs,be=[],Ce=[[],[]];J=6*H-12*z+6*ie,ee=-3*H+9*z-9*ie+3*de,se=3*z-3*H;for(var Se=0;Se<2;++Se)if(Se>0&&(J=6*G-12*Z+6*re,ee=-3*G+9*Z-9*re+3*ce,se=3*Z-3*G),Ie(ee)<1e-12){if(Ie(J)<1e-12)continue;0<(he=-se/J)&&he<1&&be.push(he)}else(te=J*J-4*se*ee)<0||(0<(fe=(-J+(ae=ge(te)))/(2*ee))&&fe<1&&be.push(fe),0<(ne=(-J-ae)/(2*ee))&&ne<1&&be.push(ne));for(var De,Ve,Me=be.length,ot=Me;Me--;)De=(Ve=1-(he=be[Me]))*Ve*Ve*H+3*Ve*Ve*he*z+3*Ve*he*he*ie+he*he*he*de,Ce[0][Me]=De,Ce[1][Me]=Ve*Ve*Ve*G+3*Ve*Ve*he*Z+3*Ve*he*he*re+he*he*he*ce;Ce[0][ot]=H,Ce[1][ot]=G,Ce[0][ot+1]=de,Ce[1][ot+1]=ce;var It=[{x:ue.apply(null,Ce[0]),y:ue.apply(null,Ce[1])},{x:me.apply(null,Ce[0]),y:me.apply(null,Ce[1])}];return P.cachesBoundsOfCurve&&(P.boundsOfCurveCache[le]=It),It},P.util.getPointOnPath=function(H,G,z){z||(z=V(H));for(var Z=0;G-z[Z].length>0&&Z<z.length-2;)G-=z[Z].length,Z++;var ie,re=z[Z],de=G/re.length,le=H[Z];switch(re.command){case"M":return{x:re.x,y:re.y,angle:0};case"Z":case"z":return(ie=new P.Point(re.x,re.y).lerp(new P.Point(re.destX,re.destY),de)).angle=Math.atan2(re.destY-re.y,re.destX-re.x),ie;case"L":return(ie=new P.Point(re.x,re.y).lerp(new P.Point(le[1],le[2]),de)).angle=Math.atan2(le[2]-re.y,le[1]-re.x),ie;case"C":case"Q":return function(ee,J){for(var se,he,fe,ne=0,te=0,ae=ee.iterator,ge={x:ee.x,y:ee.y},ue=.01,me=ee.angleFinder;te<J&&ue>1e-4;)se=ae(ne),fe=ne,(he=I(ge.x,ge.y,se.x,se.y))+te>J?(ne-=ue,ue/=2):(ge=se,ne+=ue,te+=he);return se.angle=me(fe),se}(re,G)}},P.util.transformPath=function(H,G,z){return z&&(G=P.util.multiplyTransformMatrices(G,[1,0,0,1,-z.x,-z.y])),H.map(function(Z){for(var ie=Z.slice(0),re={},de=1;de<Z.length-1;de+=2)re.x=Z[de],re.y=Z[de+1],re=P.util.transformPoint(re,G),ie[de]=re.x,ie[de+1]=re.y;return ie})}}(),function(){var S=Array.prototype.slice;function w(b,T,_){if(b&&0!==b.length){var y=b.length-1,I=T?b[y][T]:b[y];if(T)for(;y--;)_(b[y][T],I)&&(I=b[y][T]);else for(;y--;)_(b[y],I)&&(I=b[y]);return I}}P.util.array={fill:function(b,T){for(var _=b.length;_--;)b[_]=T;return b},invoke:function(b,T){for(var _=S.call(arguments,2),y=[],I=0,M=b.length;I<M;I++)y[I]=_.length?b[I][T].apply(b[I],_):b[I][T].call(b[I]);return y},min:function(b,T){return w(b,T,function(_,y){return _<y})},max:function(b,T){return w(b,T,function(_,y){return _>=y})}}}(),function(){function S(w,b,T){if(T)if(!P.isLikelyNode&&b instanceof Element)w=b;else if(b instanceof Array){w=[];for(var _=0,y=b.length;_<y;_++)w[_]=S({},b[_],T)}else if(b&&"object"==typeof b)for(var I in b)"canvas"===I||"group"===I?w[I]=null:b.hasOwnProperty(I)&&(w[I]=S({},b[I],T));else w=b;else for(var I in b)w[I]=b[I];return w}P.util.object={extend:S,clone:function(w,b){return S({},w,b)}},P.util.object.extend(P.util,P.Observable)}(),function(){function S(w,b){var T=w.charCodeAt(b);if(isNaN(T))return"";if(T<55296||T>57343)return w.charAt(b);if(55296<=T&&T<=56319){if(w.length<=b+1)throw"High surrogate without following low surrogate";var _=w.charCodeAt(b+1);if(56320>_||_>57343)throw"High surrogate without following low surrogate";return w.charAt(b)+w.charAt(b+1)}if(0===b)throw"Low surrogate without preceding high surrogate";var y=w.charCodeAt(b-1);if(55296>y||y>56319)throw"Low surrogate without preceding high surrogate";return!1}P.util.string={camelize:function(w){return w.replace(/-+(.)?/g,function(b,T){return T?T.toUpperCase():""})},capitalize:function(w,b){return w.charAt(0).toUpperCase()+(b?w.slice(1):w.slice(1).toLowerCase())},escapeXml:function(w){return w.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(w){var b,T=0,_=[];for(T=0;T<w.length;T++)!1!==(b=S(w,T))&&_.push(b);return _}}}(),function(){var S=Array.prototype.slice,w=function(){},b=function(){for(var I in{toString:1})if("toString"===I)return!1;return!0}(),T=function(I,M,x){for(var A in M)I.prototype[A]=A in I.prototype&&"function"==typeof I.prototype[A]&&(M[A]+"").indexOf("callSuper")>-1?function(F){return function(){var k=this.constructor.superclass;this.constructor.superclass=x;var V=M[F].apply(this,arguments);if(this.constructor.superclass=k,"initialize"!==F)return V}}(A):M[A],b&&(M.toString!==Object.prototype.toString&&(I.prototype.toString=M.toString),M.valueOf!==Object.prototype.valueOf&&(I.prototype.valueOf=M.valueOf))};function _(){}function y(I){for(var M=null,x=this;x.constructor.superclass;){var A=x.constructor.superclass.prototype[I];if(x[I]!==A){M=A;break}x=x.constructor.superclass.prototype}return M?arguments.length>1?M.apply(this,S.call(arguments,1)):M.call(this):console.log("tried to callSuper "+I+", method not found in prototype chain",this)}P.util.createClass=function(){var I=null,M=S.call(arguments,0);function x(){this.initialize.apply(this,arguments)}"function"==typeof M[0]&&(I=M.shift()),x.superclass=I,x.subclasses=[],I&&(_.prototype=I.prototype,x.prototype=new _,I.subclasses.push(x));for(var A=0,F=M.length;A<F;A++)T(x,M[A],I);return x.prototype.initialize||(x.prototype.initialize=w),x.prototype.constructor=x,x.prototype.callSuper=y,x}}(),O=!!P.document.createElement("div").attachEvent,L=["touchstart","touchmove","touchend"],P.util.addListener=function(S,w,b,T){S&&S.addEventListener(w,b,!O&&T)},P.util.removeListener=function(S,w,b,T){S&&S.removeEventListener(w,b,!O&&T)},P.util.getPointer=function(S){var _,y,b=P.util.getScrollLeftTop(S.target),T=(y=(_=S).changedTouches)&&y[0]?y[0]:_;return{x:T.clientX+b.left,y:T.clientY+b.top}},P.util.isTouchEvent=function(S){return L.indexOf(S.type)>-1||"touch"===S.pointerType},B="string"==typeof(N=P.document.createElement("div")).style.opacity,W=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,Y=function(S){return S},B?Y=function(S,w){return S.style.opacity=w,S}:"string"==typeof N.style.filter&&(Y=function(S,w){var b=S.style;return S.currentStyle&&!S.currentStyle.hasLayout&&(b.zoom=1),W.test(b.filter)?b.filter=b.filter.replace(W,w=w>=.9999?"":"alpha(opacity="+100*w+")"):b.filter+=" alpha(opacity="+100*w+")",S}),P.util.setStyle=function(S,w){var b=S.style;if(!b)return S;if("string"==typeof w)return S.style.cssText+=";"+w,w.indexOf("opacity")>-1?Y(S,w.match(/opacity:\s*(\d?\.?\d*)/)[1]):S;for(var T in w)"opacity"===T?Y(S,w[T]):b["float"===T||"cssFloat"===T?void 0===b.styleFloat?"cssFloat":"styleFloat":T]=w[T];return S},function(){var S,w,b,T,_=Array.prototype.slice,y=function(x){return _.call(x,0)};try{S=y(P.document.childNodes)instanceof Array}catch(x){}function I(x,A){var F=P.document.createElement(x);for(var k in A)"class"===k?F.className=A[k]:"for"===k?F.htmlFor=A[k]:F.setAttribute(k,A[k]);return F}function M(x){for(var A=0,F=0,k=P.document.documentElement,V=P.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&((x=x.parentNode||x.host)===P.document?(A=V.scrollLeft||k.scrollLeft||0,F=V.scrollTop||k.scrollTop||0):(A+=x.scrollLeft||0,F+=x.scrollTop||0),1!==x.nodeType||"fixed"!==x.style.position););return{left:A,top:F}}S||(y=function(x){for(var A=new Array(x.length),F=x.length;F--;)A[F]=x[F];return A}),w=P.document.defaultView&&P.document.defaultView.getComputedStyle?function(x,A){var F=P.document.defaultView.getComputedStyle(x,null);return F?F[A]:void 0}:function(x,A){var F=x.style[A];return!F&&x.currentStyle&&(F=x.currentStyle[A]),F},T="userSelect"in(b=P.document.documentElement.style)?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"",P.util.makeElementUnselectable=function(x){return void 0!==x.onselectstart&&(x.onselectstart=P.util.falseFunction),T?x.style[T]="none":"string"==typeof x.unselectable&&(x.unselectable="on"),x},P.util.makeElementSelectable=function(x){return void 0!==x.onselectstart&&(x.onselectstart=null),T?x.style[T]="":"string"==typeof x.unselectable&&(x.unselectable=""),x},P.util.setImageSmoothing=function(x,A){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=A},P.util.getById=function(x){return"string"==typeof x?P.document.getElementById(x):x},P.util.toArray=y,P.util.addClass=function(x,A){x&&-1===(" "+x.className+" ").indexOf(" "+A+" ")&&(x.className+=(x.className?" ":"")+A)},P.util.makeElement=I,P.util.wrapElement=function(x,A,F){return"string"==typeof A&&(A=I(A,F)),x.parentNode&&x.parentNode.replaceChild(A,x),A.appendChild(x),A},P.util.getScrollLeftTop=M,P.util.getElementOffset=function(x){var A,F,k=x&&x.ownerDocument,V={left:0,top:0},H={left:0,top:0},G={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!k)return H;for(var z in G)H[G[z]]+=parseInt(w(x,z),10)||0;return A=k.documentElement,void 0!==x.getBoundingClientRect&&(V=x.getBoundingClientRect()),F=M(x),{left:V.left+F.left-(A.clientLeft||0)+H.left,top:V.top+F.top-(A.clientTop||0)+H.top}},P.util.getNodeCanvas=function(x){var A=P.jsdomImplForWrapper(x);return A._canvas||A._image},P.util.cleanUpJsdomNode=function(x){if(P.isLikelyNode){var A=P.jsdomImplForWrapper(x);A&&(A._image=null,A._canvas=null,A._currentSrc=null,A._attributes=null,A._classList=null)}}}(),function(){function S(){}P.util.request=function(w,b){b||(b={});var M,x,T=b.method?b.method.toUpperCase():"GET",_=b.onComplete||function(){},y=new P.window.XMLHttpRequest,I=b.body||b.parameters;return y.onreadystatechange=function(){4===y.readyState&&(_(y),y.onreadystatechange=S)},"GET"===T&&(I=null,"string"==typeof b.parameters&&(x=b.parameters,w=(M=w)+(/\?/.test(M)?"&":"?")+x)),y.open(T,w,!0),"POST"!==T&&"PUT"!==T||y.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),y.send(I),y}}(),P.log=console.log,P.warn=console.warn,function(){var S=P.util.object.extend,w=P.util.object.clone,b=[];function T(){return!1}function _(x,A,F,k){return-F*Math.cos(x/k*(Math.PI/2))+F+A}P.util.object.extend(b,{cancelAll:function(){var x=this.splice(0);return x.forEach(function(A){A.cancel()}),x},cancelByCanvas:function(x){if(!x)return[];var A=this.filter(function(F){return"object"==typeof F.target&&F.target.canvas===x});return A.forEach(function(F){F.cancel()}),A},cancelByTarget:function(x){var A=this.findAnimationsByTarget(x);return A.forEach(function(F){F.cancel()}),A},findAnimationIndex:function(x){return this.indexOf(this.findAnimation(x))},findAnimation:function(x){return this.find(function(A){return A.cancel===x})},findAnimationsByTarget:function(x){return x?this.filter(function(A){return A.target===x}):[]}});var y=P.window.requestAnimationFrame||P.window.webkitRequestAnimationFrame||P.window.mozRequestAnimationFrame||P.window.oRequestAnimationFrame||P.window.msRequestAnimationFrame||function(x){return P.window.setTimeout(x,1e3/60)},I=P.window.cancelAnimationFrame||P.window.clearTimeout;function M(){return y.apply(P.window,arguments)}P.util.animate=function(x){x||(x={});var A,F=!1,k=function(){var V=P.runningAnimations.indexOf(A);return V>-1&&P.runningAnimations.splice(V,1)[0]};return A=S(w(x),{cancel:function(){return F=!0,k()},currentValue:"startValue"in x?x.startValue:0,completionRate:0,durationRate:0}),P.runningAnimations.push(A),M(function(V){var H,G=V||+new Date,z=x.duration||500,Z=G+z,ie=x.onChange||T,re=x.abort||T,de=x.onComplete||T,ce=x.easing||_,le="startValue"in x&&x.startValue.length>0,ee="startValue"in x?x.startValue:0,J="endValue"in x?x.endValue:100,se=x.byValue||(le?ee.map(function(he,fe){return J[fe]-ee[fe]}):J-ee);x.onStart&&x.onStart(),function he(fe){var ne=(H=fe||+new Date)>Z?z:H-G,te=ne/z,ae=le?ee.map(function(ue,me){return ce(ne,ee[me],se[me],z)}):ce(ne,ee,se,z),ge=Math.abs(le?(ae[0]-ee[0])/se[0]:(ae-ee)/se);if(A.currentValue=le?ae.slice():ae,A.completionRate=ge,A.durationRate=te,!F){if(!re(ae,ge,te))return H>Z?(A.currentValue=le?J.slice():J,A.completionRate=1,A.durationRate=1,ie(le?J.slice():J,1,1),de(J,1,1),void k()):(ie(ae,ge,te),void M(he));k()}}(G)}),A.cancel},P.util.requestAnimFrame=M,P.util.cancelAnimFrame=function(){return I.apply(P.window,arguments)},P.runningAnimations=b}(),function(){function S(w,b,T){var _="rgba("+parseInt(w[0]+T*(b[0]-w[0]),10)+","+parseInt(w[1]+T*(b[1]-w[1]),10)+","+parseInt(w[2]+T*(b[2]-w[2]),10);return(_+=","+(w&&b?parseFloat(w[3]+T*(b[3]-w[3])):1))+")"}P.util.animateColor=function(w,b,T,_){var y=new P.Color(w).getSource(),I=new P.Color(b).getSource(),M=_.onComplete,x=_.onChange;return P.util.animate(P.util.object.extend(_=_||{},{duration:T||500,startValue:y,endValue:I,byValue:I,easing:function(A,F,k,V){return S(F,k,_.colorEasing?_.colorEasing(A,V):1-Math.cos(A/V*(Math.PI/2)))},onComplete:function(A,F,k){if(M)return M(S(I,I,0),F,k)},onChange:function(A,F,k){if(x){if(Array.isArray(A))return x(S(A,A,0),F,k);x(A,F,k)}}}))}}(),function(){function S(_,y,I,M){return _<Math.abs(y)?(_=y,M=I/4):M=0===y&&0===_?I/(2*Math.PI)*Math.asin(1):I/(2*Math.PI)*Math.asin(y/_),{a:_,c:y,p:I,s:M}}function w(_,y,I){return _.a*Math.pow(2,10*(y-=1))*Math.sin((y*I-_.s)*(2*Math.PI)/_.p)}function b(_,y,I,M){return I-T(M-_,0,I,M)+y}function T(_,y,I,M){return(_/=M)<1/2.75?I*(7.5625*_*_)+y:_<2/2.75?I*(7.5625*(_-=1.5/2.75)*_+.75)+y:_<2.5/2.75?I*(7.5625*(_-=2.25/2.75)*_+.9375)+y:I*(7.5625*(_-=2.625/2.75)*_+.984375)+y}P.util.ease={easeInQuad:function(_,y,I,M){return I*(_/=M)*_+y},easeOutQuad:function(_,y,I,M){return-I*(_/=M)*(_-2)+y},easeInOutQuad:function(_,y,I,M){return(_/=M/2)<1?I/2*_*_+y:-I/2*(--_*(_-2)-1)+y},easeInCubic:function(_,y,I,M){return I*(_/=M)*_*_+y},easeOutCubic:function(_,y,I,M){return I*((_=_/M-1)*_*_+1)+y},easeInOutCubic:function(_,y,I,M){return(_/=M/2)<1?I/2*_*_*_+y:I/2*((_-=2)*_*_+2)+y},easeInQuart:function(_,y,I,M){return I*(_/=M)*_*_*_+y},easeOutQuart:function(_,y,I,M){return-I*((_=_/M-1)*_*_*_-1)+y},easeInOutQuart:function(_,y,I,M){return(_/=M/2)<1?I/2*_*_*_*_+y:-I/2*((_-=2)*_*_*_-2)+y},easeInQuint:function(_,y,I,M){return I*(_/=M)*_*_*_*_+y},easeOutQuint:function(_,y,I,M){return I*((_=_/M-1)*_*_*_*_+1)+y},easeInOutQuint:function(_,y,I,M){return(_/=M/2)<1?I/2*_*_*_*_*_+y:I/2*((_-=2)*_*_*_*_+2)+y},easeInSine:function(_,y,I,M){return-I*Math.cos(_/M*(Math.PI/2))+I+y},easeOutSine:function(_,y,I,M){return I*Math.sin(_/M*(Math.PI/2))+y},easeInOutSine:function(_,y,I,M){return-I/2*(Math.cos(Math.PI*_/M)-1)+y},easeInExpo:function(_,y,I,M){return 0===_?y:I*Math.pow(2,10*(_/M-1))+y},easeOutExpo:function(_,y,I,M){return _===M?y+I:I*(1-Math.pow(2,-10*_/M))+y},easeInOutExpo:function(_,y,I,M){return 0===_?y:_===M?y+I:(_/=M/2)<1?I/2*Math.pow(2,10*(_-1))+y:I/2*(2-Math.pow(2,-10*--_))+y},easeInCirc:function(_,y,I,M){return-I*(Math.sqrt(1-(_/=M)*_)-1)+y},easeOutCirc:function(_,y,I,M){return I*Math.sqrt(1-(_=_/M-1)*_)+y},easeInOutCirc:function(_,y,I,M){return(_/=M/2)<1?-I/2*(Math.sqrt(1-_*_)-1)+y:I/2*(Math.sqrt(1-(_-=2)*_)+1)+y},easeInElastic:function(_,y,I,M){var x=0;return 0===_?y:1==(_/=M)?y+I:(x||(x=.3*M),-w(S(I,I,x,1.70158),_,M)+y)},easeOutElastic:function(_,y,I,M){var x=0;if(0===_)return y;if(1==(_/=M))return y+I;x||(x=.3*M);var A=S(I,I,x,1.70158);return A.a*Math.pow(2,-10*_)*Math.sin((_*M-A.s)*(2*Math.PI)/A.p)+A.c+y},easeInOutElastic:function(_,y,I,M){var x=0;if(0===_)return y;if(2==(_/=M/2))return y+I;x||(x=M*(.3*1.5));var A=S(I,I,x,1.70158);return _<1?-.5*w(A,_,M)+y:A.a*Math.pow(2,-10*(_-=1))*Math.sin((_*M-A.s)*(2*Math.PI)/A.p)*.5+A.c+y},easeInBack:function(_,y,I,M,x){return void 0===x&&(x=1.70158),I*(_/=M)*_*((x+1)*_-x)+y},easeOutBack:function(_,y,I,M,x){return void 0===x&&(x=1.70158),I*((_=_/M-1)*_*((x+1)*_+x)+1)+y},easeInOutBack:function(_,y,I,M,x){return void 0===x&&(x=1.70158),(_/=M/2)<1?I/2*(_*_*((1+(x*=1.525))*_-x))+y:I/2*((_-=2)*_*((1+(x*=1.525))*_+x)+2)+y},easeInBounce:b,easeOutBounce:T,easeInOutBounce:function(_,y,I,M){return _<M/2?.5*b(2*_,0,I,M)+y:.5*T(2*_-M,0,I,M)+.5*I+y}}}(),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.util.object.clone,_=w.util.toFixed,y=w.util.parseUnit,I=w.util.multiplyTransformMatrices,M={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},x={stroke:"strokeOpacity",fill:"fillOpacity"},A="font-size",F="clip-path";function k(ee){return ee in M?M[ee]:ee}function V(ee,J,se,he){var fe,ne=Array.isArray(J);if("fill"!==ee&&"stroke"!==ee||"none"!==J){if("strokeUniform"===ee)return"non-scaling-stroke"===J;if("strokeDashArray"===ee)J="none"===J?null:J.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===ee)J=se&&se.transformMatrix?I(se.transformMatrix,w.parseTransformAttribute(J)):w.parseTransformAttribute(J);else if("visible"===ee)J="none"!==J&&"hidden"!==J,se&&!1===se.visible&&(J=!1);else if("opacity"===ee)J=parseFloat(J),se&&void 0!==se.opacity&&(J*=se.opacity);else if("textAnchor"===ee)J="start"===J?"left":"end"===J?"right":"center";else if("charSpacing"===ee)fe=y(J,he)/he*1e3;else if("paintFirst"===ee){var te=J.indexOf("fill"),ae=J.indexOf("stroke");J="fill",(te>-1&&ae>-1&&ae<te||-1===te&&ae>-1)&&(J="stroke")}else{if("href"===ee||"xlink:href"===ee||"font"===ee)return J;if("imageSmoothing"===ee)return"optimizeQuality"===J;fe=ne?J.map(y):y(J,he)}}else J="";return!ne&&isNaN(fe)?J:fe}function H(ee){return new RegExp("^("+ee.join("|")+")\\b","i")}function G(ee,J){var he,fe,ne,te=[];for(fe=0,ne=J.length;fe<ne;fe++)he=ee.getElementsByTagName(J[fe]),te=te.concat(Array.prototype.slice.call(he));return te}function z(ee,J){var se,he=!0;return(se=Z(ee,J.pop()))&&J.length&&(he=function(fe,ne){for(var te,ae=!0;fe.parentNode&&1===fe.parentNode.nodeType&&ne.length;)ae&&(te=ne.pop()),ae=Z(fe=fe.parentNode,te);return 0===ne.length}(ee,J)),se&&he&&0===J.length}function Z(ee,J){var se,he,fe=ee.nodeName,ne=ee.getAttribute("class"),te=ee.getAttribute("id");if(se=new RegExp("^"+fe,"i"),J=J.replace(se,""),te&&J.length&&(se=new RegExp("#"+te+"(?![a-zA-Z\\-]+)","i"),J=J.replace(se,"")),ne&&J.length)for(he=(ne=ne.split(" ")).length;he--;)se=new RegExp("\\."+ne[he]+"(?![a-zA-Z\\-]+)","i"),J=J.replace(se,"");return 0===J.length}function ie(ee,J){var se;if(ee.getElementById&&(se=ee.getElementById(J)),se)return se;var he,fe,ne,te=ee.getElementsByTagName("*");for(fe=0,ne=te.length;fe<ne;fe++)if(J===(he=te[fe]).getAttribute("id"))return he}w.svgValidTagNamesRegEx=H(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),w.svgViewBoxElementsRegEx=H(["symbol","image","marker","pattern","view","svg"]),w.svgInvalidAncestorsRegEx=H(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),w.svgValidParentsRegEx=H(["symbol","g","a","svg","clipPath","defs"]),w.cssRules={},w.gradientDefs={},w.clipPaths={},w.parseTransformAttribute=function(){function ee(ae,ge,ue){ae[ue]=Math.tan(w.util.degreesToRadians(ge[0]))}var J=w.iMatrix,se=w.reNum,he=w.commaWsp,fe="(?:(?:(matrix)\\s*\\(\\s*("+se+")"+he+"("+se+")"+he+"("+se+")"+he+"("+se+")"+he+"("+se+")"+he+"("+se+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+se+")(?:"+he+"("+se+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+se+")(?:"+he+"("+se+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+se+")(?:"+he+"("+se+")"+he+"("+se+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+se+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+se+")\\s*\\)))",ne=new RegExp("^\\s*(?:(?:"+fe+"(?:"+he+"*"+fe+")*)?)\\s*$"),te=new RegExp(fe,"g");return function(ae){var ge=J.concat(),ue=[];if(!ae||ae&&!ne.test(ae))return ge;ae.replace(te,function(Ie){var De,xe,be=new RegExp(fe).exec(Ie).filter(function(De){return!!De}),Ce=be[1],Se=be.slice(2).map(parseFloat);switch(Ce){case"translate":(De=ge)[4]=(xe=Se)[0],2===xe.length&&(De[5]=xe[1]);break;case"rotate":Se[0]=w.util.degreesToRadians(Se[0]),function(De,xe){var Ve=w.util.cos(xe[0]),Me=w.util.sin(xe[0]),ot=0,It=0;3===xe.length&&(ot=xe[1],It=xe[2]),De[0]=Ve,De[1]=Me,De[2]=-Me,De[3]=Ve,De[4]=ot-(Ve*ot-Me*It),De[5]=It-(Me*ot+Ve*It)}(ge,Se);break;case"scale":!function(De,xe){var Me=2===xe.length?xe[1]:xe[0];De[0]=xe[0],De[3]=Me}(ge,Se);break;case"skewX":ee(ge,Se,2);break;case"skewY":ee(ge,Se,1);break;case"matrix":ge=Se}ue.push(ge.concat()),ge=J.concat()});for(var me=ue[0];ue.length>1;)ue.shift(),me=w.util.multiplyTransformMatrices(me,ue[0]);return me}}();var re=new RegExp("^\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*$");function de(ee){if(!w.svgViewBoxElementsRegEx.test(ee.nodeName))return{};var J,se,he,fe,ne,te,ae=ee.getAttribute("viewBox"),ge=1,ue=1,me=ee.getAttribute("width"),Ie=ee.getAttribute("height"),be=ee.getAttribute("x")||0,Ce=ee.getAttribute("y")||0,Se=ee.getAttribute("preserveAspectRatio")||"",De=!ae||!(ae=ae.match(re)),xe=!me||!Ie||"100%"===me||"100%"===Ie,Ve=De&&xe,Me={},ot="",It=0,ki=0;if(Me.width=0,Me.height=0,Me.toBeParsed=Ve,De&&(be||Ce)&&ee.parentNode&&"#document"!==ee.parentNode.nodeName&&(ot=" translate("+y(be)+" "+y(Ce)+") ",ne=(ee.getAttribute("transform")||"")+ot,ee.setAttribute("transform",ne),ee.removeAttribute("x"),ee.removeAttribute("y")),Ve)return Me;if(De)return Me.width=y(me),Me.height=y(Ie),Me;if(J=-parseFloat(ae[1]),se=-parseFloat(ae[2]),he=parseFloat(ae[3]),fe=parseFloat(ae[4]),Me.minX=J,Me.minY=se,Me.viewBoxWidth=he,Me.viewBoxHeight=fe,xe?(Me.width=he,Me.height=fe):(Me.width=y(me),Me.height=y(Ie),ge=Me.width/he,ue=Me.height/fe),"none"!==(Se=w.util.parsePreserveAspectRatioAttribute(Se)).alignX&&("meet"===Se.meetOrSlice&&(ue=ge=ge>ue?ue:ge),"slice"===Se.meetOrSlice&&(ue=ge=ge>ue?ge:ue),It=Me.width-he*ge,ki=Me.height-fe*ge,"Mid"===Se.alignX&&(It/=2),"Mid"===Se.alignY&&(ki/=2),"Min"===Se.alignX&&(It=0),"Min"===Se.alignY&&(ki=0)),1===ge&&1===ue&&0===J&&0===se&&0===be&&0===Ce)return Me;if((be||Ce)&&"#document"!==ee.parentNode.nodeName&&(ot=" translate("+y(be)+" "+y(Ce)+") "),ne=ot+" matrix("+ge+" 0 0 "+ue+" "+(J*ge+It)+" "+(se*ue+ki)+") ","svg"===ee.nodeName){for(te=ee.ownerDocument.createElementNS(w.svgNS,"g");ee.firstChild;)te.appendChild(ee.firstChild);ee.appendChild(te)}else(te=ee).removeAttribute("x"),te.removeAttribute("y"),ne=te.getAttribute("transform")+ne;return te.setAttribute("transform",ne),Me}function ce(ee,J){var se="xlink:href",he=ie(ee,J.getAttribute(se).slice(1));if(he&&he.getAttribute(se)&&ce(ee,he),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(ne){he&&!J.hasAttribute(ne)&&he.hasAttribute(ne)&&J.setAttribute(ne,he.getAttribute(ne))}),!J.children.length)for(var fe=he.cloneNode(!0);fe.firstChild;)J.appendChild(fe.firstChild);J.removeAttribute(se)}w.parseSVGDocument=function(ee,J,se,he){if(ee){!function(be){for(var Ce=G(be,["use","svg:use"]),Se=0;Ce.length&&Se<Ce.length;){var De=Ce[Se],xe=De.getAttribute("xlink:href")||De.getAttribute("href");if(null===xe)return;var Ve,Me,ot,It,ki=xe.slice(1),ls=De.getAttribute("x")||0,$a=De.getAttribute("y")||0,Xt=ie(be,ki).cloneNode(!0),Bi=(Xt.getAttribute("transform")||"")+" translate("+ls+", "+$a+")",Wc=Ce.length,Xa=w.svgNS;if(de(Xt),/^svg$/i.test(Xt.nodeName)){var Do=Xt.ownerDocument.createElementNS(Xa,"g");for(Me=0,It=(ot=Xt.attributes).length;Me<It;Me++)Ve=ot.item(Me),Do.setAttributeNS(Xa,Ve.nodeName,Ve.nodeValue);for(;Xt.firstChild;)Do.appendChild(Xt.firstChild);Xt=Do}for(Me=0,It=(ot=De.attributes).length;Me<It;Me++)"x"!==(Ve=ot.item(Me)).nodeName&&"y"!==Ve.nodeName&&"xlink:href"!==Ve.nodeName&&"href"!==Ve.nodeName&&("transform"===Ve.nodeName?Bi=Ve.nodeValue+" "+Bi:Xt.setAttribute(Ve.nodeName,Ve.nodeValue));Xt.setAttribute("transform",Bi),Xt.setAttribute("instantiated_by_use","1"),Xt.removeAttribute("id"),De.parentNode.replaceChild(Xt,De),Ce.length===Wc&&Se++}}(ee);var fe,ne,te=w.Object.__uid++,ae=de(ee),ge=w.util.toArray(ee.getElementsByTagName("*"));if(ae.crossOrigin=he&&he.crossOrigin,ae.svgUid=te,0===ge.length&&w.isLikelyNode){var ue=[];for(fe=0,ne=(ge=ee.selectNodes('//*[name(.)!="svg"]')).length;fe<ne;fe++)ue[fe]=ge[fe];ge=ue}var me=ge.filter(function(be){return de(be),w.svgValidTagNamesRegEx.test(be.nodeName.replace("svg:",""))&&!function(Ce,Se){for(;Ce&&(Ce=Ce.parentNode);)if(Ce.nodeName&&Se.test(Ce.nodeName.replace("svg:",""))&&!Ce.getAttribute("instantiated_by_use"))return!0;return!1}(be,w.svgInvalidAncestorsRegEx)});if(!me||me&&!me.length)J&&J([],{});else{var Ie={};ge.filter(function(be){return"clipPath"===be.nodeName.replace("svg:","")}).forEach(function(be){var Ce=be.getAttribute("id");Ie[Ce]=w.util.toArray(be.getElementsByTagName("*")).filter(function(Se){return w.svgValidTagNamesRegEx.test(Se.nodeName.replace("svg:",""))})}),w.gradientDefs[te]=w.getGradientDefs(ee),w.cssRules[te]=w.getCSSRules(ee),w.clipPaths[te]=Ie,w.parseElements(me,function(be,Ce){J&&(J(be,ae,Ce,ge),delete w.gradientDefs[te],delete w.cssRules[te],delete w.clipPaths[te])},T(ae),se,he)}}};var le=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+w.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+w.reNum+"))?\\s+(.*)");b(w,{parseFontDeclaration:function(ee,J){var se=ee.match(le);if(se){var he=se[1],fe=se[3],ne=se[4],te=se[5],ae=se[6];he&&(J.fontStyle=he),fe&&(J.fontWeight=isNaN(parseFloat(fe))?fe:parseFloat(fe)),ne&&(J.fontSize=y(ne)),ae&&(J.fontFamily=ae),te&&(J.lineHeight="normal"===te?1:te)}},getGradientDefs:function(ee){var J,se=G(ee,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),he=0,fe={};for(he=se.length;he--;)(J=se[he]).getAttribute("xlink:href")&&ce(ee,J),fe[J.getAttribute("id")]=J;return fe},parseAttributes:function(ee,J,se){if(ee){var he,fe,ne,te={};void 0===se&&(se=ee.getAttribute("svgUid")),ee.parentNode&&w.svgValidParentsRegEx.test(ee.parentNode.nodeName)&&(te=w.parseAttributes(ee.parentNode,J,se));var ae=J.reduce(function(Se,De){return(he=ee.getAttribute(De))&&(Se[De]=he),Se},{}),ge=b(function(Se,De){var xe={};for(var Ve in w.cssRules[De])if(z(Se,Ve.split(" ")))for(var Me in w.cssRules[De][Ve])xe[Me]=w.cssRules[De][Ve][Me];return xe}(ee,se),w.parseStyleAttribute(ee));ae=b(ae,ge),ge[F]&&ee.setAttribute(F,ge[F]),fe=ne=te.fontSize||w.Text.DEFAULT_SVG_FONT_SIZE,ae[A]&&(ae[A]=fe=y(ae[A],ne));var ue,me,Ie={};for(var be in ae)me=V(ue=k(be),ae[be],te,fe),Ie[ue]=me;Ie&&Ie.font&&w.parseFontDeclaration(Ie.font,Ie);var Ce=b(te,Ie);return w.svgValidParentsRegEx.test(ee.nodeName)?Ce:function(Se){for(var De in x)if(void 0!==Se[x[De]]&&""!==Se[De]){if(void 0===Se[De]){if(!w.Object.prototype[De])continue;Se[De]=w.Object.prototype[De]}if(0!==Se[De].indexOf("url(")){var xe=new w.Color(Se[De]);Se[De]=xe.setAlpha(_(xe.getAlpha()*Se[x[De]],2)).toRgba()}}return Se}(Ce)}},parseElements:function(ee,J,se,he,fe){new w.ElementsParser(ee,J,se,he,fe).parse()},parseStyleAttribute:function(ee){var fe,ne,te,J={},se=ee.getAttribute("style");return se&&("string"==typeof se?(fe=J,se.replace(/;\s*$/,"").split(";").forEach(function(ae){var ge=ae.split(":");ne=ge[0].trim().toLowerCase(),te=ge[1].trim(),fe[ne]=te})):function(he,fe){for(var ae in he)void 0!==he[ae]&&(fe[ae.toLowerCase()]=he[ae])}(se,J)),J},parsePointsAttribute:function(ee){if(!ee)return null;var J,se,he=[];for(J=0,se=(ee=(ee=ee.replace(/,/g," ").trim()).split(/\s+/)).length;J<se;J+=2)he.push({x:parseFloat(ee[J]),y:parseFloat(ee[J+1])});return he},getCSSRules:function(ee){var J,se,he=ee.getElementsByTagName("style"),fe={};for(J=0,se=he.length;J<se;J++){var ne=he[J].textContent;""!==(ne=ne.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&ne.split("}").filter(function(te){return te.trim()}).forEach(function(te){var ae=te.split("{"),ge={},ue=ae[1].trim().split(";").filter(function(Ce){return Ce.trim()});for(J=0,se=ue.length;J<se;J++){var me=ue[J].split(":"),Ie=me[0].trim(),be=me[1].trim();ge[Ie]=be}(te=ae[0].trim()).split(",").forEach(function(Ce){""!==(Ce=Ce.replace(/^svg/i,"").trim())&&(fe[Ce]?w.util.object.extend(fe[Ce],ge):fe[Ce]=w.util.object.clone(ge))})})}return fe},loadSVGFromURL:function(ee,J,se,he){ee=ee.replace(/^\n\s*/,"").trim(),new w.util.request(ee,{method:"get",onComplete:function(fe){var ne=fe.responseXML;if(!ne||!ne.documentElement)return J&&J(null),!1;w.parseSVGDocument(ne.documentElement,function(te,ae,ge,ue){J&&J(te,ae,ge,ue)},se,he)}})},loadSVGFromString:function(ee,J,se,he){var fe=(new w.window.DOMParser).parseFromString(ee.trim(),"text/xml");w.parseSVGDocument(fe.documentElement,function(ne,te,ae,ge){J(ne,te,ae,ge)},se,he)}})}(l),P.ElementsParser=function(S,w,b,T,_,y){this.elements=S,this.callback=w,this.options=b,this.reviver=T,this.svgUid=b&&b.svgUid||0,this.parsingOptions=_,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=y},($=P.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},$.createObjects=function(){var S=this;this.elements.forEach(function(w,b){w.setAttribute("svgUid",S.svgUid),S.createObject(w,b)})},$.findTag=function(S){return P[P.util.string.capitalize(S.tagName.replace("svg:",""))]},$.createObject=function(S,w){var b=this.findTag(S);if(b&&b.fromElement)try{b.fromElement(S,this.createCallback(w,S),this.options)}catch(T){P.log(T)}else this.checkIfDone()},$.createCallback=function(S,w){var b=this;return function(T){var _;b.resolveGradient(T,w,"fill"),b.resolveGradient(T,w,"stroke"),T instanceof P.Image&&T._originalElement&&(_=T.parsePreserveAspectRatioAttribute(w)),T._removeTransformMatrix(_),b.resolveClipPath(T,w),b.reviver&&b.reviver(w,T),b.instances[S]=T,b.checkIfDone()}},$.extractPropertyDefinition=function(S,w,b){var T=S[w],_=this.regexUrl;if(_.test(T)){_.lastIndex=0;var y=_.exec(T)[1];return _.lastIndex=0,P[b][this.svgUid][y]}},$.resolveGradient=function(S,w,b){var T=this.extractPropertyDefinition(S,b,"gradientDefs");if(T){var _=w.getAttribute(b+"-opacity"),y=P.Gradient.fromElement(T,S,_,this.options);S.set(b,y)}},$.createClipPathCallback=function(S,w){return function(b){b._removeTransformMatrix(),b.fillRule=b.clipRule,w.push(b)}},$.resolveClipPath=function(S,w){var b,T,_,y,I=this.extractPropertyDefinition(S,"clipPath","clipPaths");if(I){_=[],T=P.util.invertTransform(S.calcTransformMatrix());for(var M=I[0].parentNode,x=w;x.parentNode&&x.getAttribute("clip-path")!==S.clipPath;)x=x.parentNode;x.parentNode.appendChild(M);for(var A=0;A<I.length;A++)this.findTag(b=I[A]).fromElement(b,this.createClipPathCallback(S,_),this.options);I=1===_.length?_[0]:new P.Group(_),y=P.util.multiplyTransformMatrices(T,I.calcTransformMatrix()),I.clipPath&&this.resolveClipPath(I,x);var F=P.util.qrDecompose(y);I.flipX=!1,I.flipY=!1,I.set("scaleX",F.scaleX),I.set("scaleY",F.scaleY),I.angle=F.angle,I.skewX=F.skewX,I.skewY=0,I.setPositionByOrigin({x:F.translateX,y:F.translateY},"center","center"),S.clipPath=I}else delete S.clipPath},$.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(S){return null!=S}),this.callback(this.instances,this.elements))},function(S){var w=S.fabric||(S.fabric={});function b(T,_){this.x=T,this.y=_}w.Point?w.warn("fabric.Point is already defined"):(w.Point=b,b.prototype={type:"point",constructor:b,add:function(T){return new b(this.x+T.x,this.y+T.y)},addEquals:function(T){return this.x+=T.x,this.y+=T.y,this},scalarAdd:function(T){return new b(this.x+T,this.y+T)},scalarAddEquals:function(T){return this.x+=T,this.y+=T,this},subtract:function(T){return new b(this.x-T.x,this.y-T.y)},subtractEquals:function(T){return this.x-=T.x,this.y-=T.y,this},scalarSubtract:function(T){return new b(this.x-T,this.y-T)},scalarSubtractEquals:function(T){return this.x-=T,this.y-=T,this},multiply:function(T){return new b(this.x*T,this.y*T)},multiplyEquals:function(T){return this.x*=T,this.y*=T,this},divide:function(T){return new b(this.x/T,this.y/T)},divideEquals:function(T){return this.x/=T,this.y/=T,this},eq:function(T){return this.x===T.x&&this.y===T.y},lt:function(T){return this.x<T.x&&this.y<T.y},lte:function(T){return this.x<=T.x&&this.y<=T.y},gt:function(T){return this.x>T.x&&this.y>T.y},gte:function(T){return this.x>=T.x&&this.y>=T.y},lerp:function(T,_){return void 0===_&&(_=.5),_=Math.max(Math.min(1,_),0),new b(this.x+(T.x-this.x)*_,this.y+(T.y-this.y)*_)},distanceFrom:function(T){var _=this.x-T.x,y=this.y-T.y;return Math.sqrt(_*_+y*y)},midPointFrom:function(T){return this.lerp(T)},min:function(T){return new b(Math.min(this.x,T.x),Math.min(this.y,T.y))},max:function(T){return new b(Math.max(this.x,T.x),Math.max(this.y,T.y))},toString:function(){return this.x+","+this.y},setXY:function(T,_){return this.x=T,this.y=_,this},setX:function(T){return this.x=T,this},setY:function(T){return this.y=T,this},setFromPoint:function(T){return this.x=T.x,this.y=T.y,this},swap:function(T){var _=this.x,y=this.y;this.x=T.x,this.y=T.y,T.x=_,T.y=y},clone:function(){return new b(this.x,this.y)}})}(l),function(S){var w=S.fabric||(S.fabric={});function b(T){this.status=T,this.points=[]}w.Intersection?w.warn("fabric.Intersection is already defined"):(w.Intersection=b,w.Intersection.prototype={constructor:b,appendPoint:function(T){return this.points.push(T),this},appendPoints:function(T){return this.points=this.points.concat(T),this}},w.Intersection.intersectLineLine=function(T,_,y,I){var M,x=(I.x-y.x)*(T.y-y.y)-(I.y-y.y)*(T.x-y.x),A=(_.x-T.x)*(T.y-y.y)-(_.y-T.y)*(T.x-y.x),F=(I.y-y.y)*(_.x-T.x)-(I.x-y.x)*(_.y-T.y);if(0!==F){var k=x/F,V=A/F;0<=k&&k<=1&&0<=V&&V<=1?(M=new b("Intersection")).appendPoint(new w.Point(T.x+k*(_.x-T.x),T.y+k*(_.y-T.y))):M=new b}else M=new b(0===x||0===A?"Coincident":"Parallel");return M},w.Intersection.intersectLinePolygon=function(T,_,y){var x,A,F=new b,k=y.length;for(A=0;A<k;A++)x=b.intersectLineLine(T,_,y[A],y[(A+1)%k]),F.appendPoints(x.points);return F.points.length>0&&(F.status="Intersection"),F},w.Intersection.intersectPolygonPolygon=function(T,_){var y,I=new b,M=T.length;for(y=0;y<M;y++){var F=b.intersectLinePolygon(T[y],T[(y+1)%M],_);I.appendPoints(F.points)}return I.points.length>0&&(I.status="Intersection"),I},w.Intersection.intersectPolygonRectangle=function(T,_,y){var I=_.min(y),M=_.max(y),x=new w.Point(M.x,I.y),A=new w.Point(I.x,M.y),F=b.intersectLinePolygon(I,x,T),k=b.intersectLinePolygon(x,M,T),V=b.intersectLinePolygon(M,A,T),H=b.intersectLinePolygon(A,I,T),G=new b;return G.appendPoints(F.points),G.appendPoints(k.points),G.appendPoints(V.points),G.appendPoints(H.points),G.points.length>0&&(G.status="Intersection"),G})}(l),function(S){var w=S.fabric||(S.fabric={});function b(_){_?this._tryParsingColor(_):this.setSource([0,0,0,1])}function T(_,y,I){return I<0&&(I+=1),I>1&&(I-=1),I<1/6?_+6*(y-_)*I:I<.5?y:I<2/3?_+(y-_)*(2/3-I)*6:_}w.Color?w.warn("fabric.Color is already defined."):(w.Color=b,w.Color.prototype={_tryParsingColor:function(_){var y;_ in b.colorNameMap&&(_=b.colorNameMap[_]),"transparent"===_&&(y=[255,255,255,0]),y||(y=b.sourceFromHex(_)),y||(y=b.sourceFromRgb(_)),y||(y=b.sourceFromHsl(_)),y||(y=[0,0,0,1]),y&&this.setSource(y)},_rgbToHsl:function(_,y,I){var M,x,A,F=w.util.array.max([_/=255,y/=255,I/=255]),k=w.util.array.min([_,y,I]);if(A=(F+k)/2,F===k)M=x=0;else{var V=F-k;switch(x=A>.5?V/(2-F-k):V/(F+k),F){case _:M=(y-I)/V+(y<I?6:0);break;case y:M=(I-_)/V+2;break;case I:M=(_-y)/V+4}M/=6}return[Math.round(360*M),Math.round(100*x),Math.round(100*A)]},getSource:function(){return this._source},setSource:function(_){this._source=_},toRgb:function(){var _=this.getSource();return"rgb("+_[0]+","+_[1]+","+_[2]+")"},toRgba:function(){var _=this.getSource();return"rgba("+_[0]+","+_[1]+","+_[2]+","+_[3]+")"},toHsl:function(){var _=this.getSource(),y=this._rgbToHsl(_[0],_[1],_[2]);return"hsl("+y[0]+","+y[1]+"%,"+y[2]+"%)"},toHsla:function(){var _=this.getSource(),y=this._rgbToHsl(_[0],_[1],_[2]);return"hsla("+y[0]+","+y[1]+"%,"+y[2]+"%,"+_[3]+")"},toHex:function(){var _,y,I,M=this.getSource();return _=1===(_=M[0].toString(16)).length?"0"+_:_,y=1===(y=M[1].toString(16)).length?"0"+y:y,I=1===(I=M[2].toString(16)).length?"0"+I:I,_.toUpperCase()+y.toUpperCase()+I.toUpperCase()},toHexa:function(){var _,y=this.getSource();return _=1===(_=(_=Math.round(255*y[3])).toString(16)).length?"0"+_:_,this.toHex()+_.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(_){var y=this.getSource();return y[3]=_,this.setSource(y),this},toGrayscale:function(){var _=this.getSource(),y=parseInt((.3*_[0]+.59*_[1]+.11*_[2]).toFixed(0),10);return this.setSource([y,y,y,_[3]]),this},toBlackWhite:function(_){var y=this.getSource(),I=(.3*y[0]+.59*y[1]+.11*y[2]).toFixed(0),M=y[3];return _=_||127,I=Number(I)<Number(_)?0:255,this.setSource([I,I,I,M]),this},overlayWith:function(_){_ instanceof b||(_=new b(_));var y,I=[],M=this.getAlpha(),x=this.getSource(),A=_.getSource();for(y=0;y<3;y++)I.push(Math.round(.5*x[y]+.5*A[y]));return I[3]=M,this.setSource(I),this}},w.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,w.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,w.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,w.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},w.Color.fromRgb=function(_){return b.fromSource(b.sourceFromRgb(_))},w.Color.sourceFromRgb=function(_){var y=_.match(b.reRGBa);if(y){var I=parseInt(y[1],10)/(/%$/.test(y[1])?100:1)*(/%$/.test(y[1])?255:1),M=parseInt(y[2],10)/(/%$/.test(y[2])?100:1)*(/%$/.test(y[2])?255:1),x=parseInt(y[3],10)/(/%$/.test(y[3])?100:1)*(/%$/.test(y[3])?255:1);return[parseInt(I,10),parseInt(M,10),parseInt(x,10),y[4]?parseFloat(y[4]):1]}},w.Color.fromRgba=b.fromRgb,w.Color.fromHsl=function(_){return b.fromSource(b.sourceFromHsl(_))},w.Color.sourceFromHsl=function(_){var y=_.match(b.reHSLa);if(y){var I,M,x,A=(parseFloat(y[1])%360+360)%360/360,F=parseFloat(y[2])/(/%$/.test(y[2])?100:1),k=parseFloat(y[3])/(/%$/.test(y[3])?100:1);if(0===F)I=M=x=k;else{var V=k<=.5?k*(F+1):k+F-k*F,H=2*k-V;I=T(H,V,A+1/3),M=T(H,V,A),x=T(H,V,A-1/3)}return[Math.round(255*I),Math.round(255*M),Math.round(255*x),y[4]?parseFloat(y[4]):1]}},w.Color.fromHsla=b.fromHsl,w.Color.fromHex=function(_){return b.fromSource(b.sourceFromHex(_))},w.Color.sourceFromHex=function(_){if(_.match(b.reHex)){var y=_.slice(_.indexOf("#")+1),I=3===y.length||4===y.length,M=8===y.length||4===y.length,x=I?y.charAt(0)+y.charAt(0):y.substring(0,2),A=I?y.charAt(1)+y.charAt(1):y.substring(2,4),F=I?y.charAt(2)+y.charAt(2):y.substring(4,6),k=M?I?y.charAt(3)+y.charAt(3):y.substring(6,8):"FF";return[parseInt(x,16),parseInt(A,16),parseInt(F,16),parseFloat((parseInt(k,16)/255).toFixed(2))]}},w.Color.fromSource=function(_){var y=new b;return y.setSource(_),y})}(l),function(S){var w=S.fabric||(S.fabric={}),b=["e","se","s","sw","w","nw","n","ne","e"],T=["ns","nesw","ew","nwse"],_={},y="left",I="top",M="right",x="bottom",A="center",F={top:x,bottom:I,left:M,right:y,center:A},k=w.util.radiansToDegrees,V=Math.sign||function(ne){return(ne>0)-(ne<0)||+ne};function H(ne,te){var ae=ne.angle+k(Math.atan2(te.y,te.x))+360;return Math.round(ae%360/45)}function G(ne,te){var ae=te.transform.target,ge=ae.canvas,ue=w.util.object.clone(te);ue.target=ae,ge&&ge.fire("object:"+ne,ue),ae.fire(ne,te)}function z(ne,te){var ae=te.canvas,ge=ne[ae.uniScaleKey];return ae.uniformScaling&&!ge||!ae.uniformScaling&&ge}function Z(ne){return ne.originX===A&&ne.originY===A}function ie(ne,te,ae){var ge=ne.lockScalingX,ue=ne.lockScalingY;return!((!ge||!ue)&&(te||!ge&&!ue||!ae)&&(!ge||"x"!==te)&&(!ue||"y"!==te))}function re(ne,te,ae,ge){return{e:ne,transform:te,pointer:{x:ae,y:ge}}}function de(ne){return function(te,ae,ge,ue){var me=ae.target,Ie=me.getCenterPoint(),be=me.translateToOriginPoint(Ie,ae.originX,ae.originY),Ce=ne(te,ae,ge,ue);return me.setPositionByOrigin(be,ae.originX,ae.originY),Ce}}function ce(ne,te){return function(ae,ge,ue,me){var Ie=te(ae,ge,ue,me);return Ie&&G(ne,re(ae,ge,ue,me)),Ie}}function le(ne,te,ae,ge,ue){var me=ne.target,Ie=me.controls[ne.corner],be=me.canvas.getZoom(),Ce=me.padding/be,Se=me.toLocalPoint(new w.Point(ge,ue),te,ae);return Se.x>=Ce&&(Se.x-=Ce),Se.x<=-Ce&&(Se.x+=Ce),Se.y>=Ce&&(Se.y-=Ce),Se.y<=Ce&&(Se.y+=Ce),Se.x-=Ie.offsetX,Se.y-=Ie.offsetY,Se}function ee(ne){return ne.flipX!==ne.flipY}function J(ne,te,ae,ge,ue){if(0!==ne[te]){var me=ue/ne._getTransformedDimensions()[ge]*ne[ae];ne.set(ae,me)}}function se(ne,te,ae,ge){var ue,me=te.target,Ie=me._getTransformedDimensions(0,me.skewY),be=le(te,te.originX,te.originY,ae,ge),Ce=Math.abs(2*be.x)-Ie.x,Se=me.skewX;Ce<2?ue=0:(ue=k(Math.atan2(Ce/me.scaleX,Ie.y/me.scaleY)),te.originX===y&&te.originY===x&&(ue=-ue),te.originX===M&&te.originY===I&&(ue=-ue),ee(me)&&(ue=-ue));var De=Se!==ue;if(De){var xe=me._getTransformedDimensions().y;me.set("skewX",ue),J(me,"skewY","scaleY","y",xe)}return De}function he(ne,te,ae,ge){var ue,me=te.target,Ie=me._getTransformedDimensions(me.skewX,0),be=le(te,te.originX,te.originY,ae,ge),Ce=Math.abs(2*be.y)-Ie.y,Se=me.skewY;Ce<2?ue=0:(ue=k(Math.atan2(Ce/me.scaleY,Ie.x/me.scaleX)),te.originX===y&&te.originY===x&&(ue=-ue),te.originX===M&&te.originY===I&&(ue=-ue),ee(me)&&(ue=-ue));var De=Se!==ue;if(De){var xe=me._getTransformedDimensions().x;me.set("skewY",ue),J(me,"skewX","scaleX","x",xe)}return De}function fe(ne,te,ae,ge,ue){var me,Ie,be,Ce,Se,De,xe=te.target,Ve=xe.lockScalingX,Me=xe.lockScalingY,ot=(ue=ue||{}).by,It=z(ne,xe),ki=ie(xe,ot,It),ls=te.gestureScale;if(ki)return!1;if(ls)Ie=te.scaleX*ls,be=te.scaleY*ls;else{if(me=le(te,te.originX,te.originY,ae,ge),Se="y"!==ot?V(me.x):1,De="x"!==ot?V(me.y):1,te.signX||(te.signX=Se),te.signY||(te.signY=De),xe.lockScalingFlip&&(te.signX!==Se||te.signY!==De))return!1;if(Ce=xe._getTransformedDimensions(),It&&!ot){var $a=Math.abs(me.x)+Math.abs(me.y),Xt=te.original,Bi=$a/(Math.abs(Ce.x*Xt.scaleX/xe.scaleX)+Math.abs(Ce.y*Xt.scaleY/xe.scaleY));Ie=Xt.scaleX*Bi,be=Xt.scaleY*Bi}else Ie=Math.abs(me.x*xe.scaleX/Ce.x),be=Math.abs(me.y*xe.scaleY/Ce.y);Z(te)&&(Ie*=2,be*=2),te.signX!==Se&&"y"!==ot&&(te.originX=F[te.originX],Ie*=-1,te.signX=Se),te.signY!==De&&"x"!==ot&&(te.originY=F[te.originY],be*=-1,te.signY=De)}var Wc=xe.scaleX,Xa=xe.scaleY;return ot?("x"===ot&&xe.set("scaleX",Ie),"y"===ot&&xe.set("scaleY",be)):(!Ve&&xe.set("scaleX",Ie),!Me&&xe.set("scaleY",be)),Wc!==xe.scaleX||Xa!==xe.scaleY}_.scaleCursorStyleHandler=function(ne,te,ae){var ge=z(ne,ae),ue="";if(0!==te.x&&0===te.y?ue="x":0===te.x&&0!==te.y&&(ue="y"),ie(ae,ue,ge))return"not-allowed";var me=H(ae,te);return b[me]+"-resize"},_.skewCursorStyleHandler=function(ne,te,ae){if(0!==te.x&&ae.lockSkewingY||0!==te.y&&ae.lockSkewingX)return"not-allowed";var ue=H(ae,te)%4;return T[ue]+"-resize"},_.scaleSkewCursorStyleHandler=function(ne,te,ae){return ne[ae.canvas.altActionKey]?_.skewCursorStyleHandler(ne,te,ae):_.scaleCursorStyleHandler(ne,te,ae)},_.rotationWithSnapping=ce("rotating",de(function(ne,te,ae,ge){var ue=te,me=ue.target,Ie=me.translateToOriginPoint(me.getCenterPoint(),ue.originX,ue.originY);if(me.lockRotation)return!1;var be,Ce=Math.atan2(ue.ey-Ie.y,ue.ex-Ie.x),Se=Math.atan2(ge-Ie.y,ae-Ie.x),De=k(Se-Ce+ue.theta);if(me.snapAngle>0){var xe=me.snapAngle,Ve=me.snapThreshold||xe,Me=Math.ceil(De/xe)*xe,ot=Math.floor(De/xe)*xe;Math.abs(De-ot)<Ve?De=ot:Math.abs(De-Me)<Ve&&(De=Me)}return De<0&&(De=360+De),be=me.angle!==(De%=360),me.angle=De,be})),_.scalingEqually=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge)})),_.scalingX=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge,{by:"x"})})),_.scalingY=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge,{by:"y"})})),_.scalingYOrSkewingX=function(ne,te,ae,ge){return ne[te.target.canvas.altActionKey]?_.skewHandlerX(ne,te,ae,ge):_.scalingY(ne,te,ae,ge)},_.scalingXOrSkewingY=function(ne,te,ae,ge){return ne[te.target.canvas.altActionKey]?_.skewHandlerY(ne,te,ae,ge):_.scalingX(ne,te,ae,ge)},_.changeWidth=ce("resizing",de(function(ne,te,ae,ge){var ue=te.target,me=le(te,te.originX,te.originY,ae,ge),Ie=ue.strokeWidth/(ue.strokeUniform?ue.scaleX:1),be=Z(te)?2:1,Ce=ue.width,Se=Math.abs(me.x*be/ue.scaleX)-Ie;return ue.set("width",Math.max(Se,0)),Ce!==Se})),_.skewHandlerX=function(ne,te,ae,ge){var ue,me=te.target,Ie=me.skewX,be=te.originY;return!me.lockSkewingX&&(0===Ie?ue=le(te,A,A,ae,ge).x>0?y:M:(Ie>0&&(ue=be===I?y:M),Ie<0&&(ue=be===I?M:y),ee(me)&&(ue=ue===y?M:y)),te.originX=ue,ce("skewing",de(se))(ne,te,ae,ge))},_.skewHandlerY=function(ne,te,ae,ge){var ue,me=te.target,Ie=me.skewY,be=te.originX;return!me.lockSkewingY&&(0===Ie?ue=le(te,A,A,ae,ge).y>0?I:x:(Ie>0&&(ue=be===y?I:x),Ie<0&&(ue=be===y?x:I),ee(me)&&(ue=ue===I?x:I)),te.originY=ue,ce("skewing",de(he))(ne,te,ae,ge))},_.dragHandler=function(ne,te,ae,ge){var ue=te.target,me=ae-te.offsetX,Ie=ge-te.offsetY,be=!ue.get("lockMovementX")&&ue.left!==me,Ce=!ue.get("lockMovementY")&&ue.top!==Ie;return be&&ue.set("left",me),Ce&&ue.set("top",Ie),(be||Ce)&&G("moving",re(ne,te,ae,ge)),be||Ce},_.scaleOrSkewActionName=function(ne,te,ae){var ge=ne[ae.canvas.altActionKey];return 0===te.x?ge?"skewX":"scaleY":0===te.y?ge?"skewY":"scaleX":void 0},_.rotationStyleHandler=function(ne,te,ae){return ae.lockRotation?"not-allowed":te.cursorStyle},_.fireEvent=G,_.wrapWithFixedAnchor=de,_.wrapWithFireEvent=ce,_.getLocalPoint=le,w.controlsUtils=_}(l),w=(S=l).fabric||(S.fabric={}),b=w.util.degreesToRadians,(T=w.controlsUtils).renderCircleControl=function(_,y,I,M,x){M=M||{};var A,F=this.sizeX||M.cornerSize||x.cornerSize,k=this.sizeY||M.cornerSize||x.cornerSize,V=void 0!==M.transparentCorners?M.transparentCorners:x.transparentCorners,H=V?"stroke":"fill",G=!V&&(M.cornerStrokeColor||x.cornerStrokeColor),z=y,Z=I;_.save(),_.fillStyle=M.cornerColor||x.cornerColor,_.strokeStyle=M.cornerStrokeColor||x.cornerStrokeColor,F>k?(A=F,_.scale(1,k/F),Z=I*F/k):k>F?(A=k,_.scale(F/k,1),z=y*k/F):A=F,_.lineWidth=1,_.beginPath(),_.arc(z,Z,A/2,0,2*Math.PI,!1),_[H](),G&&_.stroke(),_.restore()},T.renderSquareControl=function(_,y,I,M,x){M=M||{};var A=this.sizeX||M.cornerSize||x.cornerSize,F=this.sizeY||M.cornerSize||x.cornerSize,k=void 0!==M.transparentCorners?M.transparentCorners:x.transparentCorners,V=k?"stroke":"fill",H=!k&&(M.cornerStrokeColor||x.cornerStrokeColor),G=A/2,z=F/2;_.save(),_.fillStyle=M.cornerColor||x.cornerColor,_.strokeStyle=M.cornerStrokeColor||x.cornerStrokeColor,_.lineWidth=1,_.translate(y,I),_.rotate(b(x.angle)),_[V+"Rect"](-G,-z,A,F),H&&_.strokeRect(-G,-z,A,F),_.restore()},function(S){var w=S.fabric||(S.fabric={});w.Control=function(b){for(var T in b)this[T]=b[T]},w.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(b,T){return T.cursorStyle},getActionName:function(b,T){return T.actionName},getVisibility:function(b,T){var _=b._controlsVisibility;return _&&void 0!==_[T]?_[T]:this.visible},setVisibility:function(b){this.visible=b},positionHandler:function(b,T){return w.util.transformPoint({x:this.x*b.x+this.offsetX,y:this.y*b.y+this.offsetY},T)},calcCornerCoords:function(b,T,_,y,I){var M,x,A,F,k=I?this.touchSizeX:this.sizeX,V=I?this.touchSizeY:this.sizeY;if(k&&V&&k!==V){var H=Math.atan2(V,k),G=Math.sqrt(k*k+V*V)/2,z=H-w.util.degreesToRadians(b),Z=Math.PI/2-H-w.util.degreesToRadians(b);M=G*w.util.cos(z),x=G*w.util.sin(z),A=G*w.util.cos(Z),F=G*w.util.sin(Z)}else G=.7071067812*(k&&V?k:T),z=w.util.degreesToRadians(45-b),M=A=G*w.util.cos(z),x=F=G*w.util.sin(z);return{tl:{x:_-F,y:y-A},tr:{x:_+M,y:y-x},bl:{x:_-M,y:y+x},br:{x:_+F,y:y+A}}},render:function(b,T,_,y,I){"circle"===((y=y||{}).cornerStyle||I.cornerStyle)?w.controlsUtils.renderCircleControl.call(this,b,T,_,y,I):w.controlsUtils.renderSquareControl.call(this,b,T,_,y,I)}}}(l),function(){function S(b,T){var _,y,I,M,x=b.getAttribute("style"),A=b.getAttribute("offset")||0;if(A=(A=parseFloat(A)/(/%$/.test(A)?100:1))<0?0:A>1?1:A,x){var F=x.split(/\s*;\s*/);for(""===F[F.length-1]&&F.pop(),M=F.length;M--;){var k=F[M].split(/\s*:\s*/),V=k[0].trim(),H=k[1].trim();"stop-color"===V?_=H:"stop-opacity"===V&&(I=H)}}return _||(_=b.getAttribute("stop-color")||"rgb(0,0,0)"),I||(I=b.getAttribute("stop-opacity")),y=(_=new P.Color(_)).getAlpha(),I=isNaN(parseFloat(I))?1:parseFloat(I),I*=y*T,{offset:A,color:_.toRgb(),opacity:I}}var w=P.util.object.clone;P.Gradient=P.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(b){b||(b={}),b.coords||(b.coords={});var T,_=this;Object.keys(b).forEach(function(y){_[y]=b[y]}),this.id?this.id+="_"+P.Object.__uid++:this.id=P.Object.__uid++,T={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0},"radial"===this.type&&(T.r1=b.coords.r1||0,T.r2=b.coords.r2||0),this.coords=T,this.colorStops=b.colorStops.slice()},addColorStop:function(b){for(var T in b){var _=new P.Color(b[T]);this.colorStops.push({offset:parseFloat(T),color:_.toRgb(),opacity:_.getAlpha()})}return this},toObject:function(b){var T={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return P.util.populateWithProperties(this,T,b),T},toSVG:function(b,T){var _,y,I,M,x=w(this.coords,!0),A=(T=T||{},w(this.colorStops,!0)),F=x.r1>x.r2,k=this.gradientTransform?this.gradientTransform.concat():P.iMatrix.concat(),V=-this.offsetX,H=-this.offsetY,G=!!T.additionalTransform,z="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(A.sort(function(de,ce){return de.offset-ce.offset}),"objectBoundingBox"===z?(V/=b.width,H/=b.height):(V+=b.width/2,H+=b.height/2),"path"===b.type&&"percentage"!==this.gradientUnits&&(V-=b.pathOffset.x,H-=b.pathOffset.y),k[4]-=V,k[5]-=H,M='id="SVGID_'+this.id+'" gradientUnits="'+z+'"',M+=' gradientTransform="'+(G?T.additionalTransform+" ":"")+P.util.matrixToSVG(k)+'" ',"linear"===this.type?I=["<linearGradient ",M,' x1="',x.x1,'" y1="',x.y1,'" x2="',x.x2,'" y2="',x.y2,'">\n']:"radial"===this.type&&(I=["<radialGradient ",M,' cx="',F?x.x1:x.x2,'" cy="',F?x.y1:x.y2,'" r="',F?x.r1:x.r2,'" fx="',F?x.x2:x.x1,'" fy="',F?x.y2:x.y1,'">\n']),"radial"===this.type){if(F)for((A=A.concat()).reverse(),_=0,y=A.length;_<y;_++)A[_].offset=1-A[_].offset;var Z=Math.min(x.r1,x.r2);if(Z>0){var ie=Z/Math.max(x.r1,x.r2);for(_=0,y=A.length;_<y;_++)A[_].offset+=ie*(1-A[_].offset)}}for(_=0,y=A.length;_<y;_++){var re=A[_];I.push("<stop ",'offset="',100*re.offset+"%",'" style="stop-color:',re.color,void 0!==re.opacity?";stop-opacity: "+re.opacity:";",'"/>\n')}return I.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),I.join("")},toLive:function(b){var T,_,y,I=P.util.object.clone(this.coords);if(this.type){for("linear"===this.type?T=b.createLinearGradient(I.x1,I.y1,I.x2,I.y2):"radial"===this.type&&(T=b.createRadialGradient(I.x1,I.y1,I.r1,I.x2,I.y2,I.r2)),_=0,y=this.colorStops.length;_<y;_++){var M=this.colorStops[_].color,x=this.colorStops[_].opacity,A=this.colorStops[_].offset;void 0!==x&&(M=new P.Color(M).setAlpha(x).toRgba()),T.addColorStop(A,M)}return T}}}),P.util.object.extend(P.Gradient,{fromElement:function(b,T,_,y){var I=parseFloat(_)/(/%$/.test(_)?100:1);I=I<0?0:I>1?1:I,isNaN(I)&&(I=1);var M,x,A,F,ie,re,de,ce,le,ee,k=b.getElementsByTagName("stop"),V="userSpaceOnUse"===b.getAttribute("gradientUnits")?"pixels":"percentage",H=b.getAttribute("gradientTransform")||"",G=[],z=0,Z=0;for("linearGradient"===b.nodeName||"LINEARGRADIENT"===b.nodeName?(M="linear",x={x1:(ie=b).getAttribute("x1")||0,y1:ie.getAttribute("y1")||0,x2:ie.getAttribute("x2")||"100%",y2:ie.getAttribute("y2")||0}):(M="radial",x=function(ie){return{x1:ie.getAttribute("fx")||ie.getAttribute("cx")||"50%",y1:ie.getAttribute("fy")||ie.getAttribute("cy")||"50%",r1:0,x2:ie.getAttribute("cx")||"50%",y2:ie.getAttribute("cy")||"50%",r2:ie.getAttribute("r")||"50%"}}(b)),A=k.length;A--;)G.push(S(k[A],I));return F=P.parseTransformAttribute(H),re=x,de=y,ce=V,Object.keys(re).forEach(function(J){"Infinity"===(le=re[J])?ee=1:"-Infinity"===le?ee=0:(ee=parseFloat(re[J],10),"string"==typeof le&&/^(\d+\.\d+)%|(\d+)%$/.test(le)&&(ee*=.01,"pixels"===ce&&("x1"!==J&&"x2"!==J&&"r2"!==J||(ee*=de.viewBoxWidth||de.width),"y1"!==J&&"y2"!==J||(ee*=de.viewBoxHeight||de.height)))),re[J]=ee}),"pixels"===V&&(z=-T.left,Z=-T.top),new P.Gradient({id:b.getAttribute("id"),type:M,coords:x,colorStops:G,gradientUnits:V,gradientTransform:F,offsetX:z,offsetY:Z})}})}(),q=P.util.toFixed,P.Pattern=P.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(S,w){if(S||(S={}),this.id=P.Object.__uid++,this.setOptions(S),!S.source||S.source&&"string"!=typeof S.source)w&&w(this);else{var b=this;this.source=P.util.createImage(),P.util.loadImage(S.source,function(T,_){b.source=T,w&&w(b,_)},null,this.crossOrigin)}},toObject:function(S){var w,b,T=P.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?w=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(w=this.source.toDataURL()),b={type:"pattern",source:w,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:q(this.offsetX,T),offsetY:q(this.offsetY,T),patternTransform:this.patternTransform?this.patternTransform.concat():null},P.util.populateWithProperties(this,b,S),b},toSVG:function(S){var w="function"==typeof this.source?this.source():this.source,b=w.width/S.width,T=w.height/S.height,_=this.offsetX/S.width,y=this.offsetY/S.height,I="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(T=1,y&&(T+=Math.abs(y))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(b=1,_&&(b+=Math.abs(_))),w.src?I=w.src:w.toDataURL&&(I=w.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+_+'" y="'+y+'" width="'+b+'" height="'+T+'">\n<image x="0" y="0" width="'+w.width+'" height="'+w.height+'" xlink:href="'+I+'"></image>\n</pattern>\n'},setOptions:function(S){for(var w in S)this[w]=S[w]},toLive:function(S){var w=this.source;return w&&(void 0===w.src||w.complete&&0!==w.naturalWidth&&0!==w.naturalHeight)?S.createPattern(w,this.repeat):""}}),function(S){var w=S.fabric||(S.fabric={}),b=w.util.toFixed;w.Shadow?w.warn("fabric.Shadow is already defined."):(w.Shadow=w.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(T){for(var _ in"string"==typeof T&&(T=this._parseShadow(T)),T)this[_]=T[_];this.id=w.Object.__uid++},_parseShadow:function(T){var _=T.trim(),y=w.Shadow.reOffsetsAndBlur.exec(_)||[];return{color:(_.replace(w.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(y[1],10)||0,offsetY:parseFloat(y[2],10)||0,blur:parseFloat(y[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(T){var _=40,y=40,I=w.Object.NUM_FRACTION_DIGITS,M=w.util.rotateVector({x:this.offsetX,y:this.offsetY},w.util.degreesToRadians(-T.angle)),x=new w.Color(this.color);return T.width&&T.height&&(_=100*b((Math.abs(M.x)+this.blur)/T.width,I)+20,y=100*b((Math.abs(M.y)+this.blur)/T.height,I)+20),T.flipX&&(M.x*=-1),T.flipY&&(M.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+y+'%" height="'+(100+2*y)+'%" x="-'+_+'%" width="'+(100+2*_)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+b(this.blur?this.blur/2:0,I)+'"></feGaussianBlur>\n\t<feOffset dx="'+b(M.x,I)+'" dy="'+b(M.y,I)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+x.toRgb()+'" flood-opacity="'+x.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var T={},_=w.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(y){this[y]!==_[y]&&(T[y]=this[y])},this),T}}),w.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(l),function(){if(P.StaticCanvas)P.warn("fabric.StaticCanvas is already defined.");else{var S=P.util.object.extend,w=P.util.getElementOffset,b=P.util.removeFromArray,T=P.util.toFixed,_=P.util.transformPoint,y=P.util.invertTransform,I=P.util.getNodeCanvas,M=P.util.createCanvasElement,x=new Error("Could not initialize `canvas` element");P.StaticCanvas=P.util.createClass(P.CommonMethods,{initialize:function(A,F){F||(F={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(A,F)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:P.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(A,F){var k=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(A),this._initOptions(F),this.interactive||this._initRetinaScaling(),F.overlayImage&&this.setOverlayImage(F.overlayImage,k),F.backgroundImage&&this.setBackgroundImage(F.backgroundImage,k),F.backgroundColor&&this.setBackgroundColor(F.backgroundColor,k),F.overlayColor&&this.setOverlayColor(F.overlayColor,k),this.calcOffset()},_isRetinaScaling:function(){return P.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,P.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var A=P.devicePixelRatio;this.__initRetinaScaling(A,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(A,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(A,F,k){F.setAttribute("width",this.width*A),F.setAttribute("height",this.height*A),k.scale(A,A)},calcOffset:function(){return this._offset=w(this.lowerCanvasEl),this},setOverlayImage:function(A,F,k){return this.__setBgOverlayImage("overlayImage",A,F,k)},setBackgroundImage:function(A,F,k){return this.__setBgOverlayImage("backgroundImage",A,F,k)},setOverlayColor:function(A,F){return this.__setBgOverlayColor("overlayColor",A,F)},setBackgroundColor:function(A,F){return this.__setBgOverlayColor("backgroundColor",A,F)},__setBgOverlayImage:function(A,F,k,V){return"string"==typeof F?P.util.loadImage(F,function(H,G){if(H){var z=new P.Image(H,V);this[A]=z,z.canvas=this}k&&k(H,G)},this,V&&V.crossOrigin):(V&&F.setOptions(V),this[A]=F,F&&(F.canvas=this),k&&k(F,!1)),this},__setBgOverlayColor:function(A,F,k){return this[A]=F,this._initGradient(F,A),this._initPattern(F,A,k),this},_createCanvasElement:function(){var A=M();if(!A||(A.style||(A.style={}),void 0===A.getContext))throw x;return A},_initOptions:function(A){var F=this.lowerCanvasEl;this._setOptions(A),this.width=this.width||parseInt(F.width,10)||0,this.height=this.height||parseInt(F.height,10)||0,this.lowerCanvasEl.style&&(F.width=this.width,F.height=this.height,F.style.width=this.width+"px",F.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(A){this.lowerCanvasEl=A&&A.getContext?A:P.util.getById(A)||this._createCanvasElement(),P.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(A,F){return this.setDimensions({width:A},F)},setHeight:function(A,F){return this.setDimensions({height:A},F)},setDimensions:function(A,F){var k;for(var V in F=F||{},A)k=A[V],F.cssOnly||(this._setBackstoreDimension(V,A[V]),k+="px",this.hasLostContext=!0),F.backstoreOnly||this._setCssDimension(V,k);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),F.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(A,F){return this.lowerCanvasEl[A]=F,this.upperCanvasEl&&(this.upperCanvasEl[A]=F),this.cacheCanvasEl&&(this.cacheCanvasEl[A]=F),this[A]=F,this},_setCssDimension:function(A,F){return this.lowerCanvasEl.style[A]=F,this.upperCanvasEl&&(this.upperCanvasEl.style[A]=F),this.wrapperEl&&(this.wrapperEl.style[A]=F),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(A){var F,k,V,H=this._activeObject,G=this.backgroundImage,z=this.overlayImage;for(this.viewportTransform=A,k=0,V=this._objects.length;k<V;k++)(F=this._objects[k]).group||F.setCoords(!0);return H&&H.setCoords(),G&&G.setCoords(!0),z&&z.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(A,F){var k=A,V=this.viewportTransform.slice(0);A=_(A,y(this.viewportTransform)),V[0]=F,V[3]=F;var H=_(A,V);return V[4]+=k.x-H.x,V[5]+=k.y-H.y,this.setViewportTransform(V)},setZoom:function(A){return this.zoomToPoint(new P.Point(0,0),A),this},absolutePan:function(A){var F=this.viewportTransform.slice(0);return F[4]=-A.x,F[5]=-A.y,this.setViewportTransform(F)},relativePan:function(A){return this.absolutePan(new P.Point(-A.x-this.viewportTransform[4],-A.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(A){this.stateful&&A.setupState(),A._set("canvas",this),A.setCoords(),this.fire("object:added",{target:A}),A.fire("added")},_onObjectRemoved:function(A){this.fire("object:removed",{target:A}),A.fire("removed"),delete A.canvas},clearContext:function(A){return A.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=P.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var A={},F=this.width,k=this.height,V=y(this.viewportTransform);return A.tl=_({x:0,y:0},V),A.br=_({x:F,y:k},V),A.tr=new P.Point(A.br.x,A.tl.y),A.bl=new P.Point(A.tl.x,A.br.y),this.vptCoords=A,A},cancelRequestedRender:function(){this.isRendering&&(P.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(A,F){var k=this.viewportTransform,V=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(A),P.util.setImageSmoothing(A,this.imageSmoothingEnabled),this.fire("before:render",{ctx:A}),this._renderBackground(A),A.save(),A.transform(k[0],k[1],k[2],k[3],k[4],k[5]),this._renderObjects(A,F),A.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(A),V&&(V.canvas=this,V.shouldCache(),V._transformDone=!0,V.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(A)),this._renderOverlay(A),this.controlsAboveOverlay&&this.interactive&&this.drawControls(A),this.fire("after:render",{ctx:A})},drawClipPathOnCanvas:function(A){var F=this.viewportTransform,k=this.clipPath;A.save(),A.transform(F[0],F[1],F[2],F[3],F[4],F[5]),A.globalCompositeOperation="destination-in",k.transform(A),A.scale(1/k.zoomX,1/k.zoomY),A.drawImage(k._cacheCanvas,-k.cacheTranslationX,-k.cacheTranslationY),A.restore()},_renderObjects:function(A,F){var k,V;for(k=0,V=F.length;k<V;++k)F[k]&&F[k].render(A)},_renderBackgroundOrOverlay:function(A,F){var k=this[F+"Color"],V=this[F+"Image"],H=this.viewportTransform,G=this[F+"Vpt"];if(k||V){if(k){A.save(),A.beginPath(),A.moveTo(0,0),A.lineTo(this.width,0),A.lineTo(this.width,this.height),A.lineTo(0,this.height),A.closePath(),A.fillStyle=k.toLive?k.toLive(A,this):k,G&&A.transform(H[0],H[1],H[2],H[3],H[4],H[5]),A.transform(1,0,0,1,k.offsetX||0,k.offsetY||0);var z=k.gradientTransform||k.patternTransform;z&&A.transform(z[0],z[1],z[2],z[3],z[4],z[5]),A.fill(),A.restore()}V&&(A.save(),G&&A.transform(H[0],H[1],H[2],H[3],H[4],H[5]),V.render(A),A.restore())}},_renderBackground:function(A){this._renderBackgroundOrOverlay(A,"background")},_renderOverlay:function(A){this._renderBackgroundOrOverlay(A,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new P.Point(this.width/2,this.height/2)},centerObjectH:function(A){return this._centerObject(A,new P.Point(this.getCenterPoint().x,A.getCenterPoint().y))},centerObjectV:function(A){return this._centerObject(A,new P.Point(A.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(A){var F=this.getCenterPoint();return this._centerObject(A,F)},viewportCenterObject:function(A){var F=this.getVpCenter();return this._centerObject(A,F)},viewportCenterObjectH:function(A){var F=this.getVpCenter();return this._centerObject(A,new P.Point(F.x,A.getCenterPoint().y)),this},viewportCenterObjectV:function(A){var F=this.getVpCenter();return this._centerObject(A,new P.Point(A.getCenterPoint().x,F.y))},getVpCenter:function(){var A=this.getCenterPoint(),F=y(this.viewportTransform);return _(A,F)},_centerObject:function(A,F){return A.setPositionByOrigin(F,"center","center"),A.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(A){return this.toDatalessObject(A)},toObject:function(A){return this._toObjectMethod("toObject",A)},toDatalessObject:function(A){return this._toObjectMethod("toDatalessObject",A)},_toObjectMethod:function(A,F){var k=this.clipPath,V={version:P.version,objects:this._toObjects(A,F)};return k&&!k.excludeFromExport&&(V.clipPath=this._toObject(this.clipPath,A,F)),S(V,this.__serializeBgOverlay(A,F)),P.util.populateWithProperties(this,V,F),V},_toObjects:function(A,F){return this._objects.filter(function(k){return!k.excludeFromExport}).map(function(k){return this._toObject(k,A,F)},this)},_toObject:function(A,F,k){var V;this.includeDefaultValues||(V=A.includeDefaultValues,A.includeDefaultValues=!1);var H=A[F](k);return this.includeDefaultValues||(A.includeDefaultValues=V),H},__serializeBgOverlay:function(A,F){var k={},V=this.backgroundImage,H=this.overlayImage,G=this.backgroundColor,z=this.overlayColor;return G&&G.toObject?G.excludeFromExport||(k.background=G.toObject(F)):G&&(k.background=G),z&&z.toObject?z.excludeFromExport||(k.overlay=z.toObject(F)):z&&(k.overlay=z),V&&!V.excludeFromExport&&(k.backgroundImage=this._toObject(V,A,F)),H&&!H.excludeFromExport&&(k.overlayImage=this._toObject(H,A,F)),k},svgViewportTransformation:!0,toSVG:function(A,F){A||(A={}),A.reviver=F;var k=[];return this._setSVGPreamble(k,A),this._setSVGHeader(k,A),this.clipPath&&k.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(k,"background"),this._setSVGBgOverlayImage(k,"backgroundImage",F),this._setSVGObjects(k,F),this.clipPath&&k.push("</g>\n"),this._setSVGBgOverlayColor(k,"overlay"),this._setSVGBgOverlayImage(k,"overlayImage",F),k.push("</svg>"),k.join("")},_setSVGPreamble:function(A,F){F.suppressPreamble||A.push('<?xml version="1.0" encoding="',F.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(A,F){var k,V=F.width||this.width,H=F.height||this.height,G='viewBox="0 0 '+this.width+" "+this.height+'" ',z=P.Object.NUM_FRACTION_DIGITS;F.viewBox?G='viewBox="'+F.viewBox.x+" "+F.viewBox.y+" "+F.viewBox.width+" "+F.viewBox.height+'" ':this.svgViewportTransformation&&(G='viewBox="'+T(-(k=this.viewportTransform)[4]/k[0],z)+" "+T(-k[5]/k[3],z)+" "+T(this.width/k[0],z)+" "+T(this.height/k[3],z)+'" '),A.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',V,'" ','height="',H,'" ',G,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",P.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(F),"</defs>\n")},createSVGClipPathMarkup:function(A){var F=this.clipPath;return F?(F.clipPathId="CLIPPATH_"+P.Object.__uid++,'<clipPath id="'+F.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(A.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var A=this;return["background","overlay"].map(function(F){var k=A[F+"Color"];if(k&&k.toLive){var V=A[F+"Vpt"],H=A.viewportTransform;return k.toSVG({width:A.width/(V?H[0]:1),height:A.height/(V?H[3]:1)},{additionalTransform:V?P.util.matrixToSVG(H):""})}}).join("")},createSVGFontFacesMarkup:function(){var A,F,k,V,H,G,z,Z,ie="",re={},de=P.fontPaths,ce=[];for(this._objects.forEach(function ee(J){ce.push(J),J._objects&&J._objects.forEach(ee)}),z=0,Z=ce.length;z<Z;z++)if(F=(A=ce[z]).fontFamily,-1!==A.type.indexOf("text")&&!re[F]&&de[F]&&(re[F]=!0,A.styles))for(H in k=A.styles)for(G in V=k[H])!re[F=V[G].fontFamily]&&de[F]&&(re[F]=!0);for(var le in re)ie+=["\t\t@font-face {\n","\t\t\tfont-family: '",le,"';\n","\t\t\tsrc: url('",de[le],"');\n","\t\t}\n"].join("");return ie&&(ie=['\t<style type="text/css">',"<![CDATA[\n",ie,"]]>","</style>\n"].join("")),ie},_setSVGObjects:function(A,F){var k,V,H,G=this._objects;for(V=0,H=G.length;V<H;V++)(k=G[V]).excludeFromExport||this._setSVGObject(A,k,F)},_setSVGObject:function(A,F,k){A.push(F.toSVG(k))},_setSVGBgOverlayImage:function(A,F,k){this[F]&&!this[F].excludeFromExport&&this[F].toSVG&&A.push(this[F].toSVG(k))},_setSVGBgOverlayColor:function(A,F){var k=this[F+"Color"],H=this.width,G=this.height;if(k)if(k.toLive){var z=k.repeat,Z=P.util.invertTransform(this.viewportTransform),ie=this[F+"Vpt"]?P.util.matrixToSVG(Z):"";A.push('<rect transform="'+ie+" translate(",H/2,",",G/2,')"',' x="',k.offsetX-H/2,'" y="',k.offsetY-G/2,'" ','width="',"repeat-y"===z||"no-repeat"===z?k.source.width:H,'" height="',"repeat-x"===z||"no-repeat"===z?k.source.height:G,'" fill="url(#SVGID_'+k.id+')"',"></rect>\n")}else A.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',k,'"',"></rect>\n")},sendToBack:function(A){if(!A)return this;var F,k,V,H=this._activeObject;if(A===H&&"activeSelection"===A.type)for(F=(V=H._objects).length;F--;)b(this._objects,k=V[F]),this._objects.unshift(k);else b(this._objects,A),this._objects.unshift(A);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(A){if(!A)return this;var F,k,V,H=this._activeObject;if(A===H&&"activeSelection"===A.type)for(V=H._objects,F=0;F<V.length;F++)b(this._objects,k=V[F]),this._objects.push(k);else b(this._objects,A),this._objects.push(A);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(A,F){if(!A)return this;var k,V,H,G,z,Z=this._activeObject,ie=0;if(A===Z&&"activeSelection"===A.type)for(z=Z._objects,k=0;k<z.length;k++)(H=this._objects.indexOf(V=z[k]))>0+ie&&(G=H-1,b(this._objects,V),this._objects.splice(G,0,V)),ie++;else 0!==(H=this._objects.indexOf(A))&&(G=this._findNewLowerIndex(A,H,F),b(this._objects,A),this._objects.splice(G,0,A));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(A,F,k){var V,H;if(k){for(V=F,H=F-1;H>=0;--H)if(A.intersectsWithObject(this._objects[H])||A.isContainedWithinObject(this._objects[H])||this._objects[H].isContainedWithinObject(A)){V=H;break}}else V=F-1;return V},bringForward:function(A,F){if(!A)return this;var k,V,H,G,z,Z=this._activeObject,ie=0;if(A===Z&&"activeSelection"===A.type)for(k=(z=Z._objects).length;k--;)(H=this._objects.indexOf(V=z[k]))<this._objects.length-1-ie&&(G=H+1,b(this._objects,V),this._objects.splice(G,0,V)),ie++;else(H=this._objects.indexOf(A))!==this._objects.length-1&&(G=this._findNewUpperIndex(A,H,F),b(this._objects,A),this._objects.splice(G,0,A));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(A,F,k){var V,H,G;if(k){for(V=F,H=F+1,G=this._objects.length;H<G;++H)if(A.intersectsWithObject(this._objects[H])||A.isContainedWithinObject(this._objects[H])||this._objects[H].isContainedWithinObject(A)){V=H;break}}else V=F+1;return V},moveTo:function(A,F){return b(this._objects,A),this._objects.splice(F,0,A),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(P.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(A){A.dispose&&A.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),P.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),P.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),S(P.StaticCanvas.prototype,P.Observable),S(P.StaticCanvas.prototype,P.Collection),S(P.StaticCanvas.prototype,P.DataURLExporter),S(P.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(A){var F=M();if(!F||!F.getContext)return null;var k=F.getContext("2d");return k&&"setLineDash"===A?void 0!==k.setLineDash:null}}),P.StaticCanvas.prototype.toJSON=P.StaticCanvas.prototype.toObject,P.isLikelyNode&&(P.StaticCanvas.prototype.createPNGStream=function(){var A=I(this.lowerCanvasEl);return A&&A.createPNGStream()},P.StaticCanvas.prototype.createJPEGStream=function(A){var F=I(this.lowerCanvasEl);return F&&F.createJPEGStream(A)})}}(),P.BaseBrush=P.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(S){S.strokeStyle=this.color,S.lineWidth=this.width,S.lineCap=this.strokeLineCap,S.miterLimit=this.strokeMiterLimit,S.lineJoin=this.strokeLineJoin,S.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(S){var w=this.canvas.viewportTransform;S.save(),S.transform(w[0],w[1],w[2],w[3],w[4],w[5])},_setShadow:function(){if(this.shadow){var S=this.canvas,w=this.shadow,b=S.contextTop,T=S.getZoom();S&&S._isRetinaScaling()&&(T*=P.devicePixelRatio),b.shadowColor=w.color,b.shadowBlur=w.blur*T,b.shadowOffsetX=w.offsetX*T,b.shadowOffsetY=w.offsetY*T}},needsFullRender:function(){return new P.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var S=this.canvas.contextTop;S.shadowColor="",S.shadowBlur=S.shadowOffsetX=S.shadowOffsetY=0},_isOutSideCanvas:function(S){return S.x<0||S.x>this.canvas.getWidth()||S.y<0||S.y>this.canvas.getHeight()}}),P.PencilBrush=P.util.createClass(P.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(S){this.canvas=S,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(S,w,b){var T=w.midPointFrom(b);return S.quadraticCurveTo(w.x,w.y,T.x,T.y),T},onMouseDown:function(S,w){this.canvas._isMainEvent(w.e)&&(this.drawStraightLine=w.e[this.straightLineKey],this._prepareForDrawing(S),this._captureDrawingPath(S),this._render())},onMouseMove:function(S,w){if(this.canvas._isMainEvent(w.e)&&(this.drawStraightLine=w.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(S))&&this._captureDrawingPath(S)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var b=this._points,T=b.length,_=this.canvas.contextTop;this._saveAndTransform(_),this.oldEnd&&(_.beginPath(),_.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(_,b[T-2],b[T-1],!0),_.stroke(),_.restore()}},onMouseUp:function(S){return!this.canvas._isMainEvent(S.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(S){var w=new P.Point(S.x,S.y);this._reset(),this._addPoint(w),this.canvas.contextTop.moveTo(w.x,w.y)},_addPoint:function(S){return!(this._points.length>1&&S.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(S),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(S){var w=new P.Point(S.x,S.y);return this._addPoint(w)},_render:function(S){var w,b,T=this._points[0],_=this._points[1];if(this._saveAndTransform(S=S||this.canvas.contextTop),S.beginPath(),2===this._points.length&&T.x===_.x&&T.y===_.y){var y=this.width/1e3;T=new P.Point(T.x,T.y),_=new P.Point(_.x,_.y),T.x-=y,_.x+=y}for(S.moveTo(T.x,T.y),w=1,b=this._points.length;w<b;w++)this._drawSegment(S,T,_),T=this._points[w],_=this._points[w+1];S.lineTo(T.x,T.y),S.stroke(),S.restore()},convertPointsToSVGPath:function(S){return P.util.getSmoothPathFromPoints(S,this.width/1e3)},_isEmptySVGPath:function(S){return"M 0 0 Q 0 0 0 0 L 0 0"===P.util.joinPath(S)},createPath:function(S){var w=new P.Path(S,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,w.shadow=new P.Shadow(this.shadow)),w},decimatePoints:function(S,w){if(S.length<=2)return S;var b,T=this.canvas.getZoom(),_=Math.pow(w/T,2),y=S.length-1,I=S[0],M=[I];for(b=1;b<y-1;b++)Math.pow(I.x-S[b].x,2)+Math.pow(I.y-S[b].y,2)>=_&&M.push(I=S[b]);return M.push(S[y]),M},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var S=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(S))this.canvas.requestRenderAll();else{var w=this.createPath(S);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:w}),this.canvas.add(w),this.canvas.requestRenderAll(),w.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:w})}}}),P.CircleBrush=P.util.createClass(P.BaseBrush,{width:10,initialize:function(S){this.canvas=S,this.points=[]},drawDot:function(S){var w=this.addPoint(S),b=this.canvas.contextTop;this._saveAndTransform(b),this.dot(b,w),b.restore()},dot:function(S,w){S.fillStyle=w.fill,S.beginPath(),S.arc(w.x,w.y,w.radius,0,2*Math.PI,!1),S.closePath(),S.fill()},onMouseDown:function(S){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(S)},_render:function(){var S,w,b=this.canvas.contextTop,T=this.points;for(this._saveAndTransform(b),S=0,w=T.length;S<w;S++)this.dot(b,T[S]);b.restore()},onMouseMove:function(S){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(S)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(S),this._render()):this.drawDot(S))},onMouseUp:function(){var S,w,b=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var T=[];for(S=0,w=this.points.length;S<w;S++){var _=this.points[S],y=new P.Circle({radius:_.radius,left:_.x,top:_.y,originX:"center",originY:"center",fill:_.fill});this.shadow&&(y.shadow=new P.Shadow(this.shadow)),T.push(y)}var I=new P.Group(T);I.canvas=this.canvas,this.canvas.fire("before:path:created",{path:I}),this.canvas.add(I),this.canvas.fire("path:created",{path:I}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=b,this.canvas.requestRenderAll()},addPoint:function(S){var w=new P.Point(S.x,S.y),b=P.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,T=new P.Color(this.color).setAlpha(P.util.getRandomInt(0,100)/100).toRgba();return w.radius=b,w.fill=T,this.points.push(w),w}}),P.SprayBrush=P.util.createClass(P.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(S){this.canvas=S,this.sprayChunks=[]},onMouseDown:function(S){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(S),this.render(this.sprayChunkPoints)},onMouseMove:function(S){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(S)||(this.addSprayChunk(S),this.render(this.sprayChunkPoints))},onMouseUp:function(){var S=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var w=[],b=0,T=this.sprayChunks.length;b<T;b++)for(var _=this.sprayChunks[b],y=0,I=_.length;y<I;y++){var M=new P.Rect({width:_[y].width,height:_[y].width,left:_[y].x+1,top:_[y].y+1,originX:"center",originY:"center",fill:this.color});w.push(M)}this.optimizeOverlapping&&(w=this._getOptimizedRects(w));var x=new P.Group(w);this.shadow&&x.set("shadow",new P.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:x}),this.canvas.add(x),this.canvas.fire("path:created",{path:x}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=S,this.canvas.requestRenderAll()},_getOptimizedRects:function(S){var w,b,T,_={};for(b=0,T=S.length;b<T;b++)_[w=S[b].left+""+S[b].top]||(_[w]=S[b]);var y=[];for(w in _)y.push(_[w]);return y},render:function(S){var w,b,T=this.canvas.contextTop;for(T.fillStyle=this.color,this._saveAndTransform(T),w=0,b=S.length;w<b;w++){var _=S[w];void 0!==_.opacity&&(T.globalAlpha=_.opacity),T.fillRect(_.x,_.y,_.width,_.width)}T.restore()},_render:function(){var S,w,b=this.canvas.contextTop;for(b.fillStyle=this.color,this._saveAndTransform(b),S=0,w=this.sprayChunks.length;S<w;S++)this.render(this.sprayChunks[S]);b.restore()},addSprayChunk:function(S){this.sprayChunkPoints=[];var w,b,T,_,y=this.width/2;for(_=0;_<this.density;_++){w=P.util.getRandomInt(S.x-y,S.x+y),b=P.util.getRandomInt(S.y-y,S.y+y),T=this.dotWidthVariance?P.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var I=new P.Point(w,b);I.width=T,this.randomOpacity&&(I.opacity=P.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(I)}this.sprayChunks.push(this.sprayChunkPoints)}}),P.PatternBrush=P.util.createClass(P.PencilBrush,{getPatternSrc:function(){var S=P.util.createCanvasElement(),w=S.getContext("2d");return S.width=S.height=25,w.fillStyle=this.color,w.beginPath(),w.arc(10,10,10,0,2*Math.PI,!1),w.closePath(),w.fill(),S},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(S){return S.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(S){this.callSuper("_setBrushStyles",S),S.strokeStyle=this.getPattern(S)},createPath:function(S){var w=this.callSuper("createPath",S),b=w._getLeftTopCoords().scalarAdd(w.strokeWidth/2);return w.stroke=new P.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-b.x,offsetY:-b.y}),w}}),function(){var S=P.util.getPointer,w=P.util.degreesToRadians,b=P.util.isTouchEvent;for(var T in P.Canvas=P.util.createClass(P.StaticCanvas,{initialize:function(_,y){y||(y={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(_,y),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=P.PencilBrush&&new P.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var _,y,I,M=this.getActiveObjects();if(M.length>0&&!this.preserveObjectStacking){y=[],I=[];for(var x=0,A=this._objects.length;x<A;x++)-1===M.indexOf(_=this._objects[x])?y.push(_):I.push(_);M.length>1&&(this._activeObject._objects=I),y.push.apply(y,I)}else y=this._objects;return y},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(_){_.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(_),this.contextTopDirty=!0),_.restore()},renderTop:function(){var _=this.contextTop;return this.clearContext(_),this.renderTopLayer(_),this.fire("after:render"),this},_normalizePointer:function(_,y){var I=_.calcTransformMatrix(),M=P.util.invertTransform(I),x=this.restorePointerVpt(y);return P.util.transformPoint(x,M)},isTargetTransparent:function(_,y,I){if(_.shouldCache()&&_._cacheCanvas&&_!==this._activeObject){var M=this._normalizePointer(_,{x:y,y:I}),x=Math.max(_.cacheTranslationX+M.x*_.zoomX,0),A=Math.max(_.cacheTranslationY+M.y*_.zoomY,0);return P.util.isTransparent(_._cacheContext,Math.round(x),Math.round(A),this.targetFindTolerance)}var F=this.contextCache,k=_.selectionBackgroundColor,V=this.viewportTransform;return _.selectionBackgroundColor="",this.clearContext(F),F.save(),F.transform(V[0],V[1],V[2],V[3],V[4],V[5]),_.render(F),F.restore(),_.selectionBackgroundColor=k,P.util.isTransparent(F,y,I,this.targetFindTolerance)},_isSelectionKeyPressed:function(_){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(y){return!0===_[y]}):_[this.selectionKey]},_shouldClearSelection:function(_,y){var I=this.getActiveObjects(),M=this._activeObject;return!y||y&&M&&I.length>1&&-1===I.indexOf(y)&&M!==y&&!this._isSelectionKeyPressed(_)||y&&!y.evented||y&&!y.selectable&&M&&M!==y},_shouldCenterTransform:function(_,y,I){var M;if(_)return"scale"===y||"scaleX"===y||"scaleY"===y||"resizing"===y?M=this.centeredScaling||_.centeredScaling:"rotate"===y&&(M=this.centeredRotation||_.centeredRotation),M?!I:I},_getOriginFromCorner:function(_,y){var I={x:_.originX,y:_.originY};return"ml"===y||"tl"===y||"bl"===y?I.x="right":"mr"!==y&&"tr"!==y&&"br"!==y||(I.x="left"),"tl"===y||"mt"===y||"tr"===y?I.y="bottom":"bl"!==y&&"mb"!==y&&"br"!==y||(I.y="top"),I},_getActionFromCorner:function(_,y,I,M){if(!y||!_)return"drag";var x=M.controls[y];return x.getActionName(I,x,M)},_setupCurrentTransform:function(_,y,I){if(y){var M=this.getPointer(_),x=y.__corner,A=y.controls[x],F=I&&x?A.getActionHandler(_,y,A):P.controlsUtils.dragHandler,k=this._getActionFromCorner(I,x,_,y),V=this._getOriginFromCorner(y,x),H=_[this.centeredKey],G={target:y,action:k,actionHandler:F,corner:x,scaleX:y.scaleX,scaleY:y.scaleY,skewX:y.skewX,skewY:y.skewY,offsetX:M.x-y.left,offsetY:M.y-y.top,originX:V.x,originY:V.y,ex:M.x,ey:M.y,lastX:M.x,lastY:M.y,theta:w(y.angle),width:y.width*y.scaleX,shiftKey:_.shiftKey,altKey:H,original:P.util.saveObjectTransform(y)};this._shouldCenterTransform(y,k,H)&&(G.originX="center",G.originY="center"),G.original.originX=V.x,G.original.originY=V.y,this._currentTransform=G,this._beforeTransform(_)}},setCursor:function(_){this.upperCanvasEl.style.cursor=_},_drawSelection:function(_){var y=this._groupSelector,I=new P.Point(y.ex,y.ey),M=P.util.transformPoint(I,this.viewportTransform),x=new P.Point(y.ex+y.left,y.ey+y.top),A=P.util.transformPoint(x,this.viewportTransform),F=Math.min(M.x,A.x),k=Math.min(M.y,A.y),V=Math.max(M.x,A.x),H=Math.max(M.y,A.y),G=this.selectionLineWidth/2;this.selectionColor&&(_.fillStyle=this.selectionColor,_.fillRect(F,k,V-F,H-k)),this.selectionLineWidth&&this.selectionBorderColor&&(_.lineWidth=this.selectionLineWidth,_.strokeStyle=this.selectionBorderColor,F+=G,k+=G,V-=G,H-=G,P.Object.prototype._setLineDash.call(this,_,this.selectionDashArray),_.strokeRect(F,k,V-F,H-k))},findTarget:function(_,y){if(!this.skipTargetFind){var I,M,x=this.getPointer(_,!0),A=this._activeObject,F=this.getActiveObjects(),k=b(_),V=F.length>1&&!y||1===F.length;if(this.targets=[],V&&A._findTargetCorner(x,k)||F.length>1&&!y&&A===this._searchPossibleTargets([A],x))return A;if(1===F.length&&A===this._searchPossibleTargets([A],x)){if(!this.preserveObjectStacking)return A;I=A,M=this.targets,this.targets=[]}var H=this._searchPossibleTargets(this._objects,x);return _[this.altSelectionKey]&&H&&I&&H!==I&&(H=I,this.targets=M),H}},_checkTarget:function(_,y,I){if(y&&y.visible&&y.evented&&y.containsPoint(_)&&(!this.perPixelTargetFind&&!y.perPixelTargetFind||y.isEditing||!this.isTargetTransparent(y,I.x,I.y)))return!0},_searchPossibleTargets:function(_,y){for(var I,M,x=_.length;x--;){var A=_[x],F=A.group?this._normalizePointer(A.group,y):y;if(this._checkTarget(F,A,y)){(I=_[x]).subTargetCheck&&I instanceof P.Group&&(M=this._searchPossibleTargets(I._objects,y))&&this.targets.push(M);break}}return I},restorePointerVpt:function(_){return P.util.transformPoint(_,P.util.invertTransform(this.viewportTransform))},getPointer:function(_,y){if(this._absolutePointer&&!y)return this._absolutePointer;if(this._pointer&&y)return this._pointer;var I,M=S(_),x=this.upperCanvasEl,A=x.getBoundingClientRect(),F=A.width||0,k=A.height||0;F&&k||("top"in A&&"bottom"in A&&(k=Math.abs(A.top-A.bottom)),"right"in A&&"left"in A&&(F=Math.abs(A.right-A.left))),this.calcOffset(),M.x=M.x-this._offset.left,M.y=M.y-this._offset.top,y||(M=this.restorePointerVpt(M));var V=this.getRetinaScaling();return 1!==V&&(M.x/=V,M.y/=V),{x:M.x*(I=0===F||0===k?{width:1,height:1}:{width:x.width/F,height:x.height/k}).width,y:M.y*I.height}},_createUpperCanvas:function(){var _=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),y=this.lowerCanvasEl,I=this.upperCanvasEl;I?I.className="":(I=this._createCanvasElement(),this.upperCanvasEl=I),P.util.addClass(I,"upper-canvas "+_),this.wrapperEl.appendChild(I),this._copyCanvasStyle(y,I),this._applyCanvasStyle(I),this.contextTop=I.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=P.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),P.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),P.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(_){var y=this.width||_.width,I=this.height||_.height;P.util.setStyle(_,{position:"absolute",width:y+"px",height:I+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),_.width=y,_.height=I,P.util.makeElementUnselectable(_)},_copyCanvasStyle:function(_,y){y.style.cssText=_.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var _=this._activeObject;return _?"activeSelection"===_.type&&_._objects?_._objects.slice(0):[_]:[]},_onObjectRemoved:function(_){_===this._activeObject&&(this.fire("before:selection:cleared",{target:_}),this._discardActiveObject(),this.fire("selection:cleared",{target:_}),_.fire("deselected")),_===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",_)},_fireSelectionEvents:function(_,y){var I=!1,M=this.getActiveObjects(),x=[],A=[];_.forEach(function(F){-1===M.indexOf(F)&&(I=!0,F.fire("deselected",{e:y,target:F}),A.push(F))}),M.forEach(function(F){-1===_.indexOf(F)&&(I=!0,F.fire("selected",{e:y,target:F}),x.push(F))}),_.length>0&&M.length>0?I&&this.fire("selection:updated",{e:y,selected:x,deselected:A}):M.length>0?this.fire("selection:created",{e:y,selected:x}):_.length>0&&this.fire("selection:cleared",{e:y,deselected:A})},setActiveObject:function(_,y){var I=this.getActiveObjects();return this._setActiveObject(_,y),this._fireSelectionEvents(I,y),this},_setActiveObject:function(_,y){return this._activeObject!==_&&!!this._discardActiveObject(y,_)&&!_.onSelect({e:y})&&(this._activeObject=_,!0)},_discardActiveObject:function(_,y){var I=this._activeObject;if(I){if(I.onDeselect({e:_,object:y}))return!1;this._activeObject=null}return!0},discardActiveObject:function(_){var y=this.getActiveObjects(),I=this.getActiveObject();return y.length&&this.fire("before:selection:cleared",{target:I,e:_}),this._discardActiveObject(_),this._fireSelectionEvents(y,_),this},dispose:function(){var _=this.wrapperEl;return this.removeListeners(),_.removeChild(this.upperCanvasEl),_.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(y){P.util.cleanUpJsdomNode(this[y]),this[y]=void 0}.bind(this)),_.parentNode&&_.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,P.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(_){var y=this._activeObject;y&&y._renderControls(_)},_toObject:function(_,y,I){var M=this._realizeGroupTransformOnObject(_),x=this.callSuper("_toObject",_,y,I);return this._unwindGroupTransformOnObject(_,M),x},_realizeGroupTransformOnObject:function(_){if(_.group&&"activeSelection"===_.group.type&&this._activeObject===_.group){var y={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(I){y[I]=_[I]}),P.util.addTransformToObject(_,this._activeObject.calcOwnMatrix()),y}return null},_unwindGroupTransformOnObject:function(_,y){y&&_.set(y)},_setSVGObject:function(_,y,I){var M=this._realizeGroupTransformOnObject(y);this.callSuper("_setSVGObject",_,y,I),this._unwindGroupTransformOnObject(y,M)},setViewportTransform:function(_){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),P.StaticCanvas.prototype.setViewportTransform.call(this,_)}}),P.StaticCanvas)"prototype"!==T&&(P.Canvas[T]=P.StaticCanvas[T])}(),function(){var S=P.util.addListener,w=P.util.removeListener,b={passive:!1};function T(_,y){return _.button&&_.button===y-1}P.util.object.extend(P.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(S,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(_,y){var I=this.upperCanvasEl,M=this._getEventPrefix();_(P.window,"resize",this._onResize),_(I,M+"down",this._onMouseDown),_(I,M+"move",this._onMouseMove,b),_(I,M+"out",this._onMouseOut),_(I,M+"enter",this._onMouseEnter),_(I,"wheel",this._onMouseWheel),_(I,"contextmenu",this._onContextMenu),_(I,"dblclick",this._onDoubleClick),_(I,"dragover",this._onDragOver),_(I,"dragenter",this._onDragEnter),_(I,"dragleave",this._onDragLeave),_(I,"drop",this._onDrop),this.enablePointerEvents||_(I,"touchstart",this._onTouchStart,b),"undefined"!=typeof eventjs&&y in eventjs&&(eventjs[y](I,"gesture",this._onGesture),eventjs[y](I,"drag",this._onDrag),eventjs[y](I,"orientation",this._onOrientationChange),eventjs[y](I,"shake",this._onShake),eventjs[y](I,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(w,"remove");var _=this._getEventPrefix();w(P.document,_+"up",this._onMouseUp),w(P.document,"touchend",this._onTouchEnd,b),w(P.document,_+"move",this._onMouseMove,b),w(P.document,"touchmove",this._onMouseMove,b)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(_,y){this.__onTransformGesture&&this.__onTransformGesture(_,y)},_onDrag:function(_,y){this.__onDrag&&this.__onDrag(_,y)},_onMouseWheel:function(_){this.__onMouseWheel(_)},_onMouseOut:function(_){var y=this._hoveredTarget;this.fire("mouse:out",{target:y,e:_}),this._hoveredTarget=null,y&&y.fire("mouseout",{e:_});var I=this;this._hoveredTargets.forEach(function(M){I.fire("mouse:out",{target:y,e:_}),M&&y.fire("mouseout",{e:_})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(M){M.isEditing&&M.hiddenTextarea.focus()})},_onMouseEnter:function(_){this._currentTransform||this.findTarget(_)||(this.fire("mouse:over",{target:null,e:_}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(_,y){this.__onOrientationChange&&this.__onOrientationChange(_,y)},_onShake:function(_,y){this.__onShake&&this.__onShake(_,y)},_onLongPress:function(_,y){this.__onLongPress&&this.__onLongPress(_,y)},_onDragOver:function(_){_.preventDefault();var y=this._simpleEventHandler("dragover",_);this._fireEnterLeaveEvents(y,_)},_onDrop:function(_){return this._simpleEventHandler("drop:before",_),this._simpleEventHandler("drop",_)},_onContextMenu:function(_){return this.stopContextMenu&&(_.stopPropagation(),_.preventDefault()),!1},_onDoubleClick:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"dblclick"),this._resetTransformEventData(_)},getPointerId:function(_){var y=_.changedTouches;return y?y[0]&&y[0].identifier:this.enablePointerEvents?_.pointerId:-1},_isMainEvent:function(_){return!0===_.isPrimary||!1!==_.isPrimary&&("touchend"===_.type&&0===_.touches.length||!_.changedTouches||_.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(_){_.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(_)),this.__onMouseDown(_),this._resetTransformEventData();var y=this.upperCanvasEl,I=this._getEventPrefix();S(P.document,"touchend",this._onTouchEnd,b),S(P.document,"touchmove",this._onMouseMove,b),w(y,I+"down",this._onMouseDown)},_onMouseDown:function(_){this.__onMouseDown(_),this._resetTransformEventData();var y=this.upperCanvasEl,I=this._getEventPrefix();w(y,I+"move",this._onMouseMove,b),S(P.document,I+"up",this._onMouseUp),S(P.document,I+"move",this._onMouseMove,b)},_onTouchEnd:function(_){if(!(_.touches.length>0)){this.__onMouseUp(_),this._resetTransformEventData(),this.mainTouchId=null;var y=this._getEventPrefix();w(P.document,"touchend",this._onTouchEnd,b),w(P.document,"touchmove",this._onMouseMove,b);var I=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){S(I.upperCanvasEl,y+"down",I._onMouseDown),I._willAddMouseDown=0},400)}},_onMouseUp:function(_){this.__onMouseUp(_),this._resetTransformEventData();var y=this.upperCanvasEl,I=this._getEventPrefix();this._isMainEvent(_)&&(w(P.document,I+"up",this._onMouseUp),w(P.document,I+"move",this._onMouseMove,b),S(y,I+"move",this._onMouseMove,b))},_onMouseMove:function(_){!this.allowTouchScrolling&&_.preventDefault&&_.preventDefault(),this.__onMouseMove(_)},_onResize:function(){this.calcOffset()},_shouldRender:function(_){var y=this._activeObject;return!!(!!y!=!!_||y&&_&&y!==_)||!1},__onMouseUp:function(_){var y,I=this._currentTransform,M=this._groupSelector,x=!1,A=!M||0===M.left&&0===M.top;if(this._cacheTransformEventData(_),y=this._target,this._handleEvent(_,"up:before"),T(_,3))this.fireRightClick&&this._handleEvent(_,"up",3,A);else{if(T(_,2))return this.fireMiddleClick&&this._handleEvent(_,"up",2,A),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(_);else if(this._isMainEvent(_)){if(I&&(this._finalizeCurrentTransform(_),x=I.actionPerformed),!A){var F=y===this._activeObject;this._maybeGroupObjects(_),x||(x=this._shouldRender(y)||!F&&y===this._activeObject)}var k,V;if(y){if(k=y._findTargetCorner(this.getPointer(_,!0),P.util.isTouchEvent(_)),y.selectable&&y!==this._activeObject&&"up"===y.activeOn)this.setActiveObject(y,_),x=!0;else{var H=y.controls[k],G=H&&H.getMouseUpHandler(_,y,H);G&&G(_,I,(V=this.getPointer(_)).x,V.y)}y.isMoving=!1}if(I&&(I.target!==y||I.corner!==k)){var z=I.target&&I.target.controls[I.corner],Z=z&&z.getMouseUpHandler(_,y,H);V=V||this.getPointer(_),Z&&Z(_,I,V.x,V.y)}this._setCursorFromEvent(_,y),this._handleEvent(_,"up",1,A),this._groupSelector=null,this._currentTransform=null,y&&(y.__corner=0),x?this.requestRenderAll():A||this.renderTop()}}},_simpleEventHandler:function(_,y){var I=this.findTarget(y),M=this.targets,x={e:y,target:I,subTargets:M};if(this.fire(_,x),I&&I.fire(_,x),!M)return I;for(var A=0;A<M.length;A++)M[A].fire(_,x);return I},_handleEvent:function(_,y,I,M){var x=this._target,A=this.targets||[],F={e:_,target:x,subTargets:A,button:I||1,isClick:M||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===y&&(F.currentTarget=this.findTarget(_),F.currentSubTargets=this.targets),this.fire("mouse:"+y,F),x&&x.fire("mouse"+y,F);for(var k=0;k<A.length;k++)A[k].fire("mouse"+y,F)},_finalizeCurrentTransform:function(_){var y=this._currentTransform,I=y.target,M={e:_,target:I,transform:y,action:y.action};I._scaling&&(I._scaling=!1),I.setCoords(),(y.actionPerformed||this.stateful&&I.hasStateChanged())&&this._fire("modified",M)},_onMouseDownInDrawingMode:function(_){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(_).requestRenderAll();var y=this.getPointer(_);this.freeDrawingBrush.onMouseDown(y,{e:_,pointer:y}),this._handleEvent(_,"down")},_onMouseMoveInDrawingMode:function(_){if(this._isCurrentlyDrawing){var y=this.getPointer(_);this.freeDrawingBrush.onMouseMove(y,{e:_,pointer:y})}this.setCursor(this.freeDrawingCursor),this._handleEvent(_,"move")},_onMouseUpInDrawingMode:function(_){var y=this.getPointer(_);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:_,pointer:y}),this._handleEvent(_,"up")},__onMouseDown:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"down:before");var y=this._target;if(T(_,3))this.fireRightClick&&this._handleEvent(_,"down",3);else if(T(_,2))this.fireMiddleClick&&this._handleEvent(_,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(_);else if(this._isMainEvent(_)&&!this._currentTransform){var I=this._pointer;this._previousPointer=I;var M=this._shouldRender(y),x=this._shouldGroup(_,y);if(this._shouldClearSelection(_,y)?this.discardActiveObject(_):x&&(this._handleGrouping(_,y),y=this._activeObject),!this.selection||y&&(y.selectable||y.isEditing||y===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),y){var A=y===this._activeObject;y.selectable&&"down"===y.activeOn&&this.setActiveObject(y,_);var F=y._findTargetCorner(this.getPointer(_,!0),P.util.isTouchEvent(_));if(y.__corner=F,y===this._activeObject&&(F||!x)){this._setupCurrentTransform(_,y,A);var k=y.controls[F],V=(I=this.getPointer(_),k&&k.getMouseDownHandler(_,y,k));V&&V(_,this._currentTransform,I.x,I.y)}}this._handleEvent(_,"down"),(M||x)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(_){this._resetTransformEventData(),this._pointer=this.getPointer(_,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(_)||null},_beforeTransform:function(_){var y=this._currentTransform;this.stateful&&y.target.saveState(),this.fire("before:transform",{e:_,transform:y})},__onMouseMove:function(_){var y,I;if(this._handleEvent(_,"move:before"),this._cacheTransformEventData(_),this.isDrawingMode)this._onMouseMoveInDrawingMode(_);else if(this._isMainEvent(_)){var M=this._groupSelector;M?(M.left=(I=this._absolutePointer).x-M.ex,M.top=I.y-M.ey,this.renderTop()):this._currentTransform?this._transformObject(_):(y=this.findTarget(_)||null,this._setCursorFromEvent(_,y),this._fireOverOutEvents(y,_)),this._handleEvent(_,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(_,y){var I=this._hoveredTarget,M=this._hoveredTargets,x=this.targets,A=Math.max(M.length,x.length);this.fireSyntheticInOutEvents(_,y,{oldTarget:I,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var F=0;F<A;F++)this.fireSyntheticInOutEvents(x[F],y,{oldTarget:M[F],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=_,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(_,y){var I=this._draggedoverTarget,M=this._hoveredTargets,x=this.targets,A=Math.max(M.length,x.length);this.fireSyntheticInOutEvents(_,y,{oldTarget:I,evtOut:"dragleave",evtIn:"dragenter"});for(var F=0;F<A;F++)this.fireSyntheticInOutEvents(x[F],y,{oldTarget:M[F],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=_},fireSyntheticInOutEvents:function(_,y,I){var M,x,A,F=I.oldTarget,k=F!==_,V=I.canvasEvtIn,H=I.canvasEvtOut;k&&(M={e:y,target:_,previousTarget:F},x={e:y,target:F,nextTarget:_}),A=_&&k,F&&k&&(H&&this.fire(H,x),F.fire(I.evtOut,x)),A&&(V&&this.fire(V,M),_.fire(I.evtIn,M))},__onMouseWheel:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"wheel"),this._resetTransformEventData()},_transformObject:function(_){var y=this.getPointer(_),I=this._currentTransform;I.reset=!1,I.shiftKey=_.shiftKey,I.altKey=_[this.centeredKey],this._performTransformAction(_,I,y),I.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(_,y,I){var A=y.action,F=!1,k=y.actionHandler;k&&(F=k(_,y,I.x,I.y)),"drag"===A&&F&&(y.target.isMoving=!0,this.setCursor(y.target.moveCursor||this.moveCursor)),y.actionPerformed=y.actionPerformed||F},_fire:P.controlsUtils.fireEvent,_setCursorFromEvent:function(_,y){if(!y)return this.setCursor(this.defaultCursor),!1;var I=y.hoverCursor||this.hoverCursor,M=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,x=(!M||!M.contains(y))&&y._findTargetCorner(this.getPointer(_,!0));x?this.setCursor(this.getCornerCursor(x,y,_)):(y.subTargetCheck&&this.targets.concat().reverse().map(function(A){I=A.hoverCursor||I}),this.setCursor(I))},getCornerCursor:function(_,y,I){var M=y.controls[_];return M.cursorStyleHandler(I,M,y)}})}(),X=Math.min,Q=Math.max,P.util.object.extend(P.Canvas.prototype,{_shouldGroup:function(S,w){var b=this._activeObject;return b&&this._isSelectionKeyPressed(S)&&w&&w.selectable&&this.selection&&(b!==w||"activeSelection"===b.type)&&!w.onSelect({e:S})},_handleGrouping:function(S,w){var b=this._activeObject;b.__corner||(w!==b||(w=this.findTarget(S,!0))&&w.selectable)&&(b&&"activeSelection"===b.type?this._updateActiveSelection(w,S):this._createActiveSelection(w,S))},_updateActiveSelection:function(S,w){var b=this._activeObject,T=b._objects.slice(0);b.contains(S)?(b.removeWithUpdate(S),this._hoveredTarget=S,this._hoveredTargets=this.targets.concat(),1===b.size()&&this._setActiveObject(b.item(0),w)):(b.addWithUpdate(S),this._hoveredTarget=b,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(T,w)},_createActiveSelection:function(S,w){var b=this.getActiveObjects(),T=this._createGroup(S);this._hoveredTarget=T,this._setActiveObject(T,w),this._fireSelectionEvents(b,w)},_createGroup:function(S){var w=this._objects,b=w.indexOf(this._activeObject)<w.indexOf(S)?[this._activeObject,S]:[S,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new P.ActiveSelection(b,{canvas:this})},_groupSelectedObjects:function(S){var w,b=this._collectObjects(S);1===b.length?this.setActiveObject(b[0],S):b.length>1&&(w=new P.ActiveSelection(b.reverse(),{canvas:this}),this.setActiveObject(w,S))},_collectObjects:function(S){for(var w,b=[],T=this._groupSelector.ex,_=this._groupSelector.ey,y=T+this._groupSelector.left,I=_+this._groupSelector.top,M=new P.Point(X(T,y),X(_,I)),x=new P.Point(Q(T,y),Q(_,I)),A=!this.selectionFullyContained,F=T===y&&_===I,k=this._objects.length;k--&&!((w=this._objects[k])&&w.selectable&&w.visible&&(A&&w.intersectsWithRect(M,x,!0)||w.isContainedWithinRect(M,x,!0)||A&&w.containsPoint(M,null,!0)||A&&w.containsPoint(x,null,!0))&&(b.push(w),F)););return b.length>1&&(b=b.filter(function(V){return!V.onSelect({e:S})})),b},_maybeGroupObjects:function(S){this.selection&&this._groupSelector&&this._groupSelectedObjects(S),this.setCursor(this.defaultCursor),this._groupSelector=null}}),P.util.object.extend(P.StaticCanvas.prototype,{toDataURL:function(S){S||(S={});var w=S.format||"png",b=S.quality||1,T=(S.multiplier||1)*(S.enableRetinaScaling?this.getRetinaScaling():1),_=this.toCanvasElement(T,S);return P.util.toDataURL(_,w,b)},toCanvasElement:function(S,w){var b=((w=w||{}).width||this.width)*(S=S||1),T=(w.height||this.height)*S,_=this.getZoom(),y=this.width,I=this.height,M=_*S,x=this.viewportTransform,k=this.interactive,V=[M,0,0,M,(x[4]-(w.left||0))*S,(x[5]-(w.top||0))*S],H=this.enableRetinaScaling,G=P.util.createCanvasElement(),z=this.contextTop;return G.width=b,G.height=T,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=V,this.width=b,this.height=T,this.calcViewportBoundaries(),this.renderCanvas(G.getContext("2d"),this._objects),this.viewportTransform=x,this.width=y,this.height=I,this.calcViewportBoundaries(),this.interactive=k,this.enableRetinaScaling=H,this.contextTop=z,G}}),P.util.object.extend(P.StaticCanvas.prototype,{loadFromJSON:function(S,w,b){if(S){var T="string"==typeof S?JSON.parse(S):P.util.object.clone(S),_=this,y=T.clipPath,I=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete T.clipPath,this._enlivenObjects(T.objects,function(M){_.clear(),_._setBgOverlay(T,function(){y?_._enlivenObjects([y],function(x){_.clipPath=x[0],_.__setupCanvas.call(_,T,M,I,w)}):_.__setupCanvas.call(_,T,M,I,w)})},b),this}},__setupCanvas:function(S,w,b,T){var _=this;w.forEach(function(y,I){_.insertAt(y,I)}),this.renderOnAddRemove=b,delete S.objects,delete S.backgroundImage,delete S.overlayImage,delete S.background,delete S.overlay,this._setOptions(S),this.renderAll(),T&&T()},_setBgOverlay:function(S,w){var b={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(S.backgroundImage||S.overlayImage||S.background||S.overlay){var T=function(){b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor&&w&&w()};this.__setBgOverlay("backgroundImage",S.backgroundImage,b,T),this.__setBgOverlay("overlayImage",S.overlayImage,b,T),this.__setBgOverlay("backgroundColor",S.background,b,T),this.__setBgOverlay("overlayColor",S.overlay,b,T)}else w&&w()},__setBgOverlay:function(S,w,b,T){var _=this;if(!w)return b[S]=!0,void(T&&T());"backgroundImage"===S||"overlayImage"===S?P.util.enlivenObjects([w],function(y){_[S]=y[0],b[S]=!0,T&&T()}):this["set"+P.util.string.capitalize(S,!0)](w,function(){b[S]=!0,T&&T()})},_enlivenObjects:function(S,w,b){S&&0!==S.length?P.util.enlivenObjects(S,function(T){w&&w(T)},null,b):w&&w([])},_toDataURL:function(S,w){this.clone(function(b){w(b.toDataURL(S))})},_toDataURLWithMultiplier:function(S,w,b){this.clone(function(T){b(T.toDataURLWithMultiplier(S,w))})},clone:function(S,w){var b=JSON.stringify(this.toJSON(w));this.cloneWithoutData(function(T){T.loadFromJSON(b,function(){S&&S(T)})})},cloneWithoutData:function(S){var w=P.util.createCanvasElement();w.width=this.width,w.height=this.height;var b=new P.Canvas(w);this.backgroundImage?(b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll(),S&&S(b)}),b.backgroundImageOpacity=this.backgroundImageOpacity,b.backgroundImageStretch=this.backgroundImageStretch):S&&S(b)}}),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.util.object.clone,_=w.util.toFixed,y=w.util.string.capitalize,I=w.util.degreesToRadians;w.Object||(w.Object=w.util.createClass(w.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!w.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(x){x&&this.setOptions(x)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=w.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(x){var A=w.perfLimitSizeTotal,F=x.width,k=x.height,V=w.maxCacheSideLimit,H=w.minCacheSideLimit;if(F<=V&&k<=V&&F*k<=A)return F<H&&(x.width=H),k<H&&(x.height=H),x;var z=w.util.limitDimsByArea(F/k,A),Z=w.util.capValue,ie=Z(H,z.x,V),re=Z(H,z.y,V);return F>ie&&(x.zoomX/=F/ie,x.width=ie,x.capped=!0),k>re&&(x.zoomY/=k/re,x.height=re,x.capped=!0),x},_getCacheCanvasDimensions:function(){var x=this.getTotalObjectScaling(),A=this._getTransformedDimensions(0,0),F=A.x*x.scaleX/this.scaleX,k=A.y*x.scaleY/this.scaleY;return{width:F+2,height:k+2,zoomX:x.scaleX,zoomY:x.scaleY,x:F,y:k}},_updateCacheCanvas:function(){var x=this.canvas;if(this.noScaleCache&&x&&x._currentTransform){var F=x._currentTransform.action;if(this===x._currentTransform.target&&F.slice&&"scale"===F.slice(0,5))return!1}var k,V,H=this._cacheCanvas,G=this._limitCacheSize(this._getCacheCanvasDimensions()),z=w.minCacheSideLimit,Z=G.width,ie=G.height,re=G.zoomX,de=G.zoomY,ce=Z!==this.cacheWidth||ie!==this.cacheHeight,ee=ce||this.zoomX!==re||this.zoomY!==de,J=0,se=0,he=!1;if(ce){var fe=this._cacheCanvas.width,ne=this._cacheCanvas.height,te=Z>fe||ie>ne;he=te||(Z<.9*fe||ie<.9*ne)&&fe>z&&ne>z,te&&!G.capped&&(Z>z||ie>z)&&(J=.1*Z,se=.1*ie)}return this instanceof w.Text&&this.path&&(ee=!0,he=!0,J+=this.getHeightOfLine(0)*this.zoomX,se+=this.getHeightOfLine(0)*this.zoomY),!!ee&&(he?(H.width=Math.ceil(Z+J),H.height=Math.ceil(ie+se)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,H.width,H.height)),k=G.x/2,V=G.y/2,this.cacheTranslationX=Math.round(H.width/2-k)+k,this.cacheTranslationY=Math.round(H.height/2-V)+V,this.cacheWidth=Z,this.cacheHeight=ie,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(re,de),this.zoomX=re,this.zoomY=de,!0)},setOptions:function(x){this._setOptions(x),this._initGradient(x.fill,"fill"),this._initGradient(x.stroke,"stroke"),this._initPattern(x.fill,"fill"),this._initPattern(x.stroke,"stroke")},transform:function(x){var F=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&x===this.canvas.contextTop));x.transform(F[0],F[1],F[2],F[3],F[4],F[5])},toObject:function(x){var A=w.Object.NUM_FRACTION_DIGITS,F={type:this.type,version:w.version,originX:this.originX,originY:this.originY,left:_(this.left,A),top:_(this.top,A),width:_(this.width,A),height:_(this.height,A),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:_(this.strokeWidth,A),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:_(this.strokeMiterLimit,A),scaleX:_(this.scaleX,A),scaleY:_(this.scaleY,A),angle:_(this.angle,A),flipX:this.flipX,flipY:this.flipY,opacity:_(this.opacity,A),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:_(this.skewX,A),skewY:_(this.skewY,A)};return this.clipPath&&!this.clipPath.excludeFromExport&&(F.clipPath=this.clipPath.toObject(x),F.clipPath.inverted=this.clipPath.inverted,F.clipPath.absolutePositioned=this.clipPath.absolutePositioned),w.util.populateWithProperties(this,F,x),this.includeDefaultValues||(F=this._removeDefaultValues(F)),F},toDatalessObject:function(x){return this.toObject(x)},_removeDefaultValues:function(x){var A=w.util.getKlass(x.type).prototype;return A.stateProperties.forEach(function(F){"left"!==F&&"top"!==F&&(x[F]===A[F]&&delete x[F],Array.isArray(x[F])&&Array.isArray(A[F])&&0===x[F].length&&0===A[F].length&&delete x[F])}),x},toString:function(){return"#<fabric."+y(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var x=w.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(x.scaleX),scaleY:Math.abs(x.scaleY)}},getTotalObjectScaling:function(){var x=this.getObjectScaling(),A=x.scaleX,F=x.scaleY;if(this.canvas){var k=this.canvas.getZoom(),V=this.canvas.getRetinaScaling();A*=k*V,F*=k*V}return{scaleX:A,scaleY:F}},getObjectOpacity:function(){var x=this.opacity;return this.group&&(x*=this.group.getObjectOpacity()),x},_set:function(x,A){var k=this[x]!==A,V=!1;return("scaleX"===x||"scaleY"===x)&&(A=this._constrainScale(A)),"scaleX"===x&&A<0?(this.flipX=!this.flipX,A*=-1):"scaleY"===x&&A<0?(this.flipY=!this.flipY,A*=-1):"shadow"!==x||!A||A instanceof w.Shadow?"dirty"===x&&this.group&&this.group.set("dirty",A):A=new w.Shadow(A),this[x]=A,k&&(V=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(x)>-1?(this.dirty=!0,V&&this.group.set("dirty",!0)):V&&this.stateProperties.indexOf(x)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:w.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(x){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(x.save(),this._setupCompositeOperation(x),this.drawSelectionBackground(x),this.transform(x),this._setOpacity(x),this._setShadow(x,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(x)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(x),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),x.restore())},renderCache:function(x){x=x||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,x.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(x,A){if(x.save(),x.globalCompositeOperation=A.inverted?"destination-out":"destination-in",A.absolutePositioned){var F=w.util.invertTransform(this.calcTransformMatrix());x.transform(F[0],F[1],F[2],F[3],F[4],F[5])}A.transform(x),x.scale(1/A.zoomX,1/A.zoomY),x.drawImage(A._cacheCanvas,-A.cacheTranslationX,-A.cacheTranslationY),x.restore()},drawObject:function(x,A){var F=this.fill,k=this.stroke;A?(this.fill="black",this.stroke="",this._setClippingProperties(x)):this._renderBackground(x),this._render(x),this._drawClipPath(x,this.clipPath),this.fill=F,this.stroke=k},_drawClipPath:function(x,A){A&&(A.canvas=this.canvas,A.shouldCache(),A._transformDone=!0,A.renderCache({forClipping:!0}),this.drawClipPathOnCache(x,A))},drawCacheOnCanvas:function(x){x.scale(1/this.zoomX,1/this.zoomY),x.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(x){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!x&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!x){var A=this.cacheWidth/this.zoomX,F=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-A/2,-F/2,A,F)}return!0}return!1},_renderBackground:function(x){if(this.backgroundColor){var A=this._getNonTransformedDimensions();x.fillStyle=this.backgroundColor,x.fillRect(-A.x/2,-A.y/2,A.x,A.y),this._removeShadow(x)}},_setOpacity:function(x){this.group&&!this.group._transformDone?x.globalAlpha=this.getObjectOpacity():x.globalAlpha*=this.opacity},_setStrokeStyles:function(x,A){var F=A.stroke;F&&(x.lineWidth=A.strokeWidth,x.lineCap=A.strokeLineCap,x.lineDashOffset=A.strokeDashOffset,x.lineJoin=A.strokeLineJoin,x.miterLimit=A.strokeMiterLimit,F.toLive?"percentage"===F.gradientUnits||F.gradientTransform||F.patternTransform?this._applyPatternForTransformedGradient(x,F):(x.strokeStyle=F.toLive(x,this),this._applyPatternGradientTransform(x,F)):x.strokeStyle=A.stroke)},_setFillStyles:function(x,A){var F=A.fill;F&&(F.toLive?(x.fillStyle=F.toLive(x,this),this._applyPatternGradientTransform(x,A.fill)):x.fillStyle=F)},_setClippingProperties:function(x){x.globalAlpha=1,x.strokeStyle="transparent",x.fillStyle="#000000"},_setLineDash:function(x,A){A&&0!==A.length&&(1&A.length&&A.push.apply(A,A),x.setLineDash(A))},_renderControls:function(x,A){var F,k,V,H=this.getViewportTransform(),G=this.calcTransformMatrix();k=void 0!==(A=A||{}).hasBorders?A.hasBorders:this.hasBorders,V=void 0!==A.hasControls?A.hasControls:this.hasControls,G=w.util.multiplyTransformMatrices(H,G),F=w.util.qrDecompose(G),x.save(),x.translate(F.translateX,F.translateY),x.lineWidth=1*this.borderScaleFactor,this.group||(x.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(F.angle-=180),x.rotate(I(this.group?F.angle:this.angle)),A.forActiveSelection||this.group?k&&this.drawBordersInGroup(x,F,A):k&&this.drawBorders(x,A),V&&this.drawControls(x,A),x.restore()},_setShadow:function(x){if(this.shadow){var A,F=this.shadow,k=this.canvas,V=k&&k.viewportTransform[0]||1,H=k&&k.viewportTransform[3]||1;A=F.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),k&&k._isRetinaScaling()&&(V*=w.devicePixelRatio,H*=w.devicePixelRatio),x.shadowColor=F.color,x.shadowBlur=F.blur*w.browserShadowBlurConstant*(V+H)*(A.scaleX+A.scaleY)/4,x.shadowOffsetX=F.offsetX*V*A.scaleX,x.shadowOffsetY=F.offsetY*H*A.scaleY}},_removeShadow:function(x){this.shadow&&(x.shadowColor="",x.shadowBlur=x.shadowOffsetX=x.shadowOffsetY=0)},_applyPatternGradientTransform:function(x,A){if(!A||!A.toLive)return{offsetX:0,offsetY:0};var F=A.gradientTransform||A.patternTransform,k=-this.width/2+A.offsetX||0,V=-this.height/2+A.offsetY||0;return"percentage"===A.gradientUnits?x.transform(this.width,0,0,this.height,k,V):x.transform(1,0,0,1,k,V),F&&x.transform(F[0],F[1],F[2],F[3],F[4],F[5]),{offsetX:k,offsetY:V}},_renderPaintInOrder:function(x){"stroke"===this.paintFirst?(this._renderStroke(x),this._renderFill(x)):(this._renderFill(x),this._renderStroke(x))},_render:function(){},_renderFill:function(x){this.fill&&(x.save(),this._setFillStyles(x,this),"evenodd"===this.fillRule?x.fill("evenodd"):x.fill(),x.restore())},_renderStroke:function(x){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(x),x.save(),this.strokeUniform&&this.group){var A=this.getObjectScaling();x.scale(1/A.scaleX,1/A.scaleY)}else this.strokeUniform&&x.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(x,this.strokeDashArray),this._setStrokeStyles(x,this),x.stroke(),x.restore()}},_applyPatternForTransformedGradient:function(x,A){var F,k=this._limitCacheSize(this._getCacheCanvasDimensions()),V=w.util.createCanvasElement(),H=this.canvas.getRetinaScaling(),G=k.x/this.scaleX/H,z=k.y/this.scaleY/H;V.width=G,V.height=z,(F=V.getContext("2d")).beginPath(),F.moveTo(0,0),F.lineTo(G,0),F.lineTo(G,z),F.lineTo(0,z),F.closePath(),F.translate(G/2,z/2),F.scale(k.zoomX/this.scaleX/H,k.zoomY/this.scaleY/H),this._applyPatternGradientTransform(F,A),F.fillStyle=A.toLive(x),F.fill(),x.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),x.scale(H*this.scaleX/k.zoomX,H*this.scaleY/k.zoomY),x.strokeStyle=F.createPattern(V,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var x=w.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",x.scaleX),this.set("scaleY",x.scaleY),this.angle=x.angle,this.skewX=x.skewX,this.skewY=0}},_removeTransformMatrix:function(x){var A=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),A=w.util.transformPoint(A,this.transformMatrix)),this.transformMatrix=null,x&&(this.scaleX*=x.scaleX,this.scaleY*=x.scaleY,this.cropX=x.cropX,this.cropY=x.cropY,A.x+=x.offsetLeft,A.y+=x.offsetTop,this.width=x.width,this.height=x.height),this.setPositionByOrigin(A,"center","center")},clone:function(x,A){var F=this.toObject(A);this.constructor.fromObject?this.constructor.fromObject(F,x):w.Object._fromObject("Object",F,x)},cloneAsImage:function(x,A){var F=this.toCanvasElement(A);return x&&x(new w.Image(F)),this},toCanvasElement:function(x){x||(x={});var A=w.util,F=A.saveObjectTransform(this),k=this.group,V=this.shadow,H=Math.abs,G=(x.multiplier||1)*(x.enableRetinaScaling?w.devicePixelRatio:1);delete this.group,x.withoutTransform&&A.resetObjectTransform(this),x.withoutShadow&&(this.shadow=null);var z,Z,re,de=w.util.createCanvasElement(),ce=this.getBoundingRect(!0,!0),le=this.shadow,ee={x:0,y:0};le&&(Z=le.blur,z=le.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),ee.x=2*Math.round(H(le.offsetX)+Z)*H(z.scaleX),ee.y=2*Math.round(H(le.offsetY)+Z)*H(z.scaleY)),re=ce.height+ee.y,de.width=Math.ceil(ce.width+ee.x),de.height=Math.ceil(re);var J=new w.StaticCanvas(de,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===x.format&&(J.backgroundColor="#fff"),this.setPositionByOrigin(new w.Point(J.width/2,J.height/2),"center","center");var se=this.canvas;J.add(this);var he=J.toCanvasElement(G||1,x);return this.shadow=V,this.set("canvas",se),k&&(this.group=k),this.set(F).setCoords(),J._objects=[],J.dispose(),J=null,he},toDataURL:function(x){return x||(x={}),w.util.toDataURL(this.toCanvasElement(x),x.format||"png",x.quality||1)},isType:function(x){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===x},complexity:function(){return 1},toJSON:function(x){return this.toObject(x)},rotate:function(x){var A=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return A&&this._setOriginToCenter(),this.set("angle",x),A&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(x,A){A=A||this.canvas.getPointer(x);var F=new w.Point(A.x,A.y),k=this._getLeftTopCoords();return this.angle&&(F=w.util.rotatePoint(F,k,I(-this.angle))),{x:F.x-k.x,y:F.y-k.y}},_setupCompositeOperation:function(x){this.globalCompositeOperation&&(x.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){w.runningAnimations&&w.runningAnimations.cancelByTarget(this)}}),w.util.createAccessors&&w.util.createAccessors(w.Object),b(w.Object.prototype,w.Observable),w.Object.NUM_FRACTION_DIGITS=2,w.Object.ENLIVEN_PROPS=["clipPath"],w.Object._fromObject=function(x,A,F,k){var V=w[x];A=T(A,!0),w.util.enlivenPatterns([A.fill,A.stroke],function(H){void 0!==H[0]&&(A.fill=H[0]),void 0!==H[1]&&(A.stroke=H[1]),w.util.enlivenObjectEnlivables(A,A,function(){var G=k?new V(A[k],A):new V(A);F&&F(G)})})},w.Object.__uid=0)}(l),pe=P.util.degreesToRadians,ve={left:-.5,center:0,right:.5},Te={top:-.5,center:0,bottom:.5},P.util.object.extend(P.Object.prototype,{translateToGivenOrigin:function(S,w,b,T,_){var y,I,M,x=S.x,A=S.y;return"string"==typeof w?w=ve[w]:w-=.5,"string"==typeof T?T=ve[T]:T-=.5,"string"==typeof b?b=Te[b]:b-=.5,"string"==typeof _?_=Te[_]:_-=.5,I=_-b,((y=T-w)||I)&&(M=this._getTransformedDimensions(),x=S.x+y*M.x,A=S.y+I*M.y),new P.Point(x,A)},translateToCenterPoint:function(S,w,b){var T=this.translateToGivenOrigin(S,w,b,"center","center");return this.angle?P.util.rotatePoint(T,S,pe(this.angle)):T},translateToOriginPoint:function(S,w,b){var T=this.translateToGivenOrigin(S,"center","center",w,b);return this.angle?P.util.rotatePoint(T,S,pe(this.angle)):T},getCenterPoint:function(){var S=new P.Point(this.left,this.top);return this.translateToCenterPoint(S,this.originX,this.originY)},getPointByOrigin:function(S,w){var b=this.getCenterPoint();return this.translateToOriginPoint(b,S,w)},toLocalPoint:function(S,w,b){var T,_,y=this.getCenterPoint();return T=void 0!==w&&void 0!==b?this.translateToGivenOrigin(y,"center","center",w,b):new P.Point(this.left,this.top),_=new P.Point(S.x,S.y),this.angle&&(_=P.util.rotatePoint(_,y,-pe(this.angle))),_.subtractEquals(T)},setPositionByOrigin:function(S,w,b){var T=this.translateToCenterPoint(S,w,b),_=this.translateToOriginPoint(T,this.originX,this.originY);this.set("left",_.x),this.set("top",_.y)},adjustPosition:function(S){var w,b,T=pe(this.angle),_=this.getScaledWidth(),y=P.util.cos(T)*_,I=P.util.sin(T)*_;this.left+=y*((b="string"==typeof S?ve[S]:S-.5)-(w="string"==typeof this.originX?ve[this.originX]:this.originX-.5)),this.top+=I*(b-w),this.setCoords(),this.originX=S},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var S=this.getCenterPoint();this.originX="center",this.originY="center",this.left=S.x,this.top=S.y},_resetOrigin:function(){var S=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=S.x,this.top=S.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var S=P.util,w=S.degreesToRadians,b=S.multiplyTransformMatrices,T=S.transformPoint;S.object.extend(P.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(_,y){return y?_?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),_?this.aCoords:this.lineCoords)},getCoords:function(_,y){return I=this._getCoords(_,y),[new P.Point(I.tl.x,I.tl.y),new P.Point(I.tr.x,I.tr.y),new P.Point(I.br.x,I.br.y),new P.Point(I.bl.x,I.bl.y)];var I},intersectsWithRect:function(_,y,I,M){var x=this.getCoords(I,M);return"Intersection"===P.Intersection.intersectPolygonRectangle(x,_,y).status},intersectsWithObject:function(_,y,I){return"Intersection"===P.Intersection.intersectPolygonPolygon(this.getCoords(y,I),_.getCoords(y,I)).status||_.isContainedWithinObject(this,y,I)||this.isContainedWithinObject(_,y,I)},isContainedWithinObject:function(_,y,I){for(var M=this.getCoords(y,I),A=0,F=_._getImageLines(y?_.aCoords:_.lineCoords);A<4;A++)if(!_.containsPoint(M[A],F))return!1;return!0},isContainedWithinRect:function(_,y,I,M){var x=this.getBoundingRect(I,M);return x.left>=_.x&&x.left+x.width<=y.x&&x.top>=_.y&&x.top+x.height<=y.y},containsPoint:function(_,y,I,M){var x=this._getCoords(I,M),A=(y=y||this._getImageLines(x),this._findCrossPoints(_,y));return 0!==A&&A%2==1},isOnScreen:function(_){if(!this.canvas)return!1;var y=this.canvas.vptCoords.tl,I=this.canvas.vptCoords.br;return!!this.getCoords(!0,_).some(function(M){return M.x<=I.x&&M.x>=y.x&&M.y<=I.y&&M.y>=y.y})||!!this.intersectsWithRect(y,I,!0,_)||this._containsCenterOfCanvas(y,I,_)},_containsCenterOfCanvas:function(_,y,I){return!!this.containsPoint({x:(_.x+y.x)/2,y:(_.y+y.y)/2},null,!0,I)},isPartiallyOnScreen:function(_){if(!this.canvas)return!1;var y=this.canvas.vptCoords.tl,I=this.canvas.vptCoords.br;return!!this.intersectsWithRect(y,I,!0,_)||this.getCoords(!0,_).every(function(M){return(M.x>=I.x||M.x<=y.x)&&(M.y>=I.y||M.y<=y.y)})&&this._containsCenterOfCanvas(y,I,_)},_getImageLines:function(_){return{topline:{o:_.tl,d:_.tr},rightline:{o:_.tr,d:_.br},bottomline:{o:_.br,d:_.bl},leftline:{o:_.bl,d:_.tl}}},_findCrossPoints:function(_,y){var I,M,x,A=0;for(var F in y)if(!((x=y[F]).o.y<_.y&&x.d.y<_.y||x.o.y>=_.y&&x.d.y>=_.y||(x.o.x===x.d.x&&x.o.x>=_.x?M=x.o.x:(I=(x.d.y-x.o.y)/(x.d.x-x.o.x),M=-(_.y-0*_.x-(x.o.y-I*x.o.x))/(0-I)),M>=_.x&&(A+=1),2!==A)))break;return A},getBoundingRect:function(_,y){var I=this.getCoords(_,y);return S.makeBoundingBoxFromPoints(I)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(_){return Math.abs(_)<this.minScaleLimit?_<0?-this.minScaleLimit:this.minScaleLimit:0===_?1e-4:_},scale:function(_){return this._set("scaleX",_),this._set("scaleY",_),this.setCoords()},scaleToWidth:function(_,y){var I=this.getBoundingRect(y).width/this.getScaledWidth();return this.scale(_/this.width/I)},scaleToHeight:function(_,y){var I=this.getBoundingRect(y).height/this.getScaledHeight();return this.scale(_/this.height/I)},calcLineCoords:function(){var _=this.getViewportTransform(),y=this.padding,I=w(this.angle),M=S.cos(I)*y,x=S.sin(I)*y,A=M+x,F=M-x,k=this.calcACoords(),V={tl:T(k.tl,_),tr:T(k.tr,_),bl:T(k.bl,_),br:T(k.br,_)};return y&&(V.tl.x-=F,V.tl.y-=A,V.tr.x+=A,V.tr.y-=F,V.bl.x-=A,V.bl.y+=F,V.br.x+=F,V.br.y+=A),V},calcOCoords:function(){var _=this._calcRotateMatrix(),y=this._calcTranslateMatrix(),I=this.getViewportTransform(),M=b(I,y),x=b(M,_),A=(x=b(x,[1/I[0],0,0,1/I[3],0,0]),this._calculateCurrentDimensions()),F={};return this.forEachControl(function(k,V,H){F[V]=k.positionHandler(A,x,H)}),F},calcACoords:function(){var _=this._calcRotateMatrix(),y=this._calcTranslateMatrix(),I=b(y,_),M=this._getTransformedDimensions(),x=M.x/2,A=M.y/2;return{tl:T({x:-x,y:-A},I),tr:T({x,y:-A},I),bl:T({x:-x,y:A},I),br:T({x,y:A},I)}},setCoords:function(_){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),_||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return S.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var _=this.getCenterPoint();return[1,0,0,1,_.x,_.y]},transformMatrixKey:function(_){var y="_",I="";return!_&&this.group&&(I=this.group.transformMatrixKey(_)+y),I+this.top+y+this.left+y+this.scaleX+y+this.scaleY+y+this.skewX+y+this.skewY+y+this.angle+y+this.originX+y+this.originY+y+this.width+y+this.height+y+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(_){var y=this.calcOwnMatrix();if(_||!this.group)return y;var I=this.transformMatrixKey(_),M=this.matrixCache||(this.matrixCache={});return M.key===I?M.value:(this.group&&(y=b(this.group.calcTransformMatrix(!1),y)),M.key=I,M.value=y,y)},calcOwnMatrix:function(){var _=this.transformMatrixKey(!0),y=this.ownMatrixCache||(this.ownMatrixCache={});if(y.key===_)return y.value;var I=this._calcTranslateMatrix(),M={angle:this.angle,translateX:I[4],translateY:I[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return y.key=_,y.value=S.composeMatrix(M),y.value},_getNonTransformedDimensions:function(){var _=this.strokeWidth;return{x:this.width+_,y:this.height+_}},_getTransformedDimensions:function(_,y){void 0===_&&(_=this.skewX),void 0===y&&(y=this.skewY);var I,M,x,A=0===_&&0===y;if(this.strokeUniform?(M=this.width,x=this.height):(M=(I=this._getNonTransformedDimensions()).x,x=I.y),A)return this._finalizeDimensions(M*this.scaleX,x*this.scaleY);var F=S.sizeAfterTransform(M,x,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:_,skewY:y});return this._finalizeDimensions(F.x,F.y)},_finalizeDimensions:function(_,y){return this.strokeUniform?{x:_+this.strokeWidth,y:y+this.strokeWidth}:{x:_,y}},_calculateCurrentDimensions:function(){var _=this.getViewportTransform(),y=this._getTransformedDimensions();return T(y,_,!0).scalarAdd(2*this.padding)}})}(),P.util.object.extend(P.Object.prototype,{sendToBack:function(){return this.group?P.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?P.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(S){return this.group?P.StaticCanvas.prototype.sendBackwards.call(this.group,this,S):this.canvas&&this.canvas.sendBackwards(this,S),this},bringForward:function(S){return this.group?P.StaticCanvas.prototype.bringForward.call(this.group,this,S):this.canvas&&this.canvas.bringForward(this,S),this},moveTo:function(S){return this.group&&"activeSelection"!==this.group.type?P.StaticCanvas.prototype.moveTo.call(this.group,this,S):this.canvas&&this.canvas.moveTo(this,S),this}}),function(){function S(b,T){if(T){if(T.toLive)return b+": url(#SVGID_"+T.id+"); ";var _=new P.Color(T),y=b+": "+_.toRgb()+"; ",I=_.getAlpha();return 1!==I&&(y+=b+"-opacity: "+I.toString()+"; "),y}return b+": none; "}var w=P.util.toFixed;P.util.object.extend(P.Object.prototype,{getSvgStyles:function(b){var T=this.fillRule?this.fillRule:"nonzero",_=this.strokeWidth?this.strokeWidth:"0",y=this.strokeDashArray?this.strokeDashArray.join(" "):"none",I=this.strokeDashOffset?this.strokeDashOffset:"0",M=this.strokeLineCap?this.strokeLineCap:"butt",x=this.strokeLineJoin?this.strokeLineJoin:"miter",A=this.strokeMiterLimit?this.strokeMiterLimit:"4",F=void 0!==this.opacity?this.opacity:"1",k=this.visible?"":" visibility: hidden;",V=b?"":this.getSvgFilter(),H=S("fill",this.fill);return[S("stroke",this.stroke),"stroke-width: ",_,"; ","stroke-dasharray: ",y,"; ","stroke-linecap: ",M,"; ","stroke-dashoffset: ",I,"; ","stroke-linejoin: ",x,"; ","stroke-miterlimit: ",A,"; ",H,"fill-rule: ",T,"; ","opacity: ",F,";",V,k].join("")},getSvgSpanStyles:function(b,T){var _="; ",y=b.fontFamily?"font-family: "+(-1===b.fontFamily.indexOf("'")&&-1===b.fontFamily.indexOf('"')?"'"+b.fontFamily+"'":b.fontFamily)+_:"",I=b.strokeWidth?"stroke-width: "+b.strokeWidth+_:"",M=b.fontSize?"font-size: "+b.fontSize+"px"+_:"",x=b.fontStyle?"font-style: "+b.fontStyle+_:"",A=b.fontWeight?"font-weight: "+b.fontWeight+_:"",F=b.fill?S("fill",b.fill):"",k=b.stroke?S("stroke",b.stroke):"",V=this.getSvgTextDecoration(b);return V&&(V="text-decoration: "+V+_),[k,I,y,M,x,A,V,F,b.deltaY?"baseline-shift: "+-b.deltaY+"; ":"",T?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(b){return["overline","underline","line-through"].filter(function(T){return b[T.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(b,T){var _=b?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+P.util.matrixToSVG(_)+(T||"")+'" '},_setSVGBg:function(b){if(this.backgroundColor){var T=P.Object.NUM_FRACTION_DIGITS;b.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',w(-this.width/2,T),'" y="',w(-this.height/2,T),'" width="',w(this.width,T),'" height="',w(this.height,T),'"></rect>\n')}},toSVG:function(b){return this._createBaseSVGMarkup(this._toSVG(b),{reviver:b})},toClipPathSVG:function(b){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(b),{reviver:b})},_createBaseClipPathSVGMarkup:function(b,T){var _=(T=T||{}).reviver,I=[this.getSvgTransform(!0,T.additionalTransform||""),this.getSvgCommons()].join(""),M=b.indexOf("COMMON_PARTS");return b[M]=I,_?_(b.join("")):b.join("")},_createBaseSVGMarkup:function(b,T){var _,y,I=(T=T||{}).noStyle,M=T.reviver,x=I?"":'style="'+this.getSvgStyles()+'" ',A=T.withShadow?'style="'+this.getSvgFilter()+'" ':"",F=this.clipPath,k=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",V=F&&F.absolutePositioned,H=this.stroke,G=this.fill,z=this.shadow,Z=[],ie=b.indexOf("COMMON_PARTS"),re=T.additionalTransform;return F&&(F.clipPathId="CLIPPATH_"+P.Object.__uid++,y='<clipPath id="'+F.clipPathId+'" >\n'+F.toClipPathSVG(M)+"</clipPath>\n"),V&&Z.push("<g ",A,this.getSvgCommons()," >\n"),Z.push("<g ",this.getSvgTransform(!1),V?"":A+this.getSvgCommons()," >\n"),_=[x,k,I?"":this.addPaintOrder()," ",re?'transform="'+re+'" ':""].join(""),b[ie]=_,G&&G.toLive&&Z.push(G.toSVG(this)),H&&H.toLive&&Z.push(H.toSVG(this)),z&&Z.push(z.toSVG(this)),F&&Z.push(y),Z.push(b.join("")),Z.push("</g>\n"),V&&Z.push("</g>\n"),M?M(Z.join("")):Z.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var S=P.util.object.extend,w="stateProperties";function b(_,y,I){var M={};I.forEach(function(x){M[x]=_[x]}),S(_[y],M,!0)}function T(_,y,I){if(_===y)return!0;if(Array.isArray(_)){if(!Array.isArray(y)||_.length!==y.length)return!1;for(var M=0,x=_.length;M<x;M++)if(!T(_[M],y[M]))return!1;return!0}if(_&&"object"==typeof _){var A,F=Object.keys(_);if(!y||"object"!=typeof y||!I&&F.length!==Object.keys(y).length)return!1;for(M=0,x=F.length;M<x;M++)if("canvas"!==(A=F[M])&&"group"!==A&&!T(_[A],y[A]))return!1;return!0}}P.util.object.extend(P.Object.prototype,{hasStateChanged:function(_){var y="_"+(_=_||w);return Object.keys(this[y]).length<this[_].length||!T(this[y],this,!0)},saveState:function(_){var y=_&&_.propertySet||w,I="_"+y;return this[I]?(b(this,I,this[y]),_&&_.stateProperties&&b(this,I,_.stateProperties),this):this.setupState(_)},setupState:function(_){var y=(_=_||{}).propertySet||w;return _.propertySet=y,this["_"+y]={},this.saveState(_),this}})}(),function(){var S=P.util.degreesToRadians;P.util.object.extend(P.Object.prototype,{_findTargetCorner:function(w,b){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var T,_,y,I=w.x,M=w.y,x=Object.keys(this.oCoords),A=x.length-1;for(this.__corner=0;A>=0;A--)if(this.isControlVisible(y=x[A])&&(_=this._getImageLines(b?this.oCoords[y].touchCorner:this.oCoords[y].corner),0!==(T=this._findCrossPoints({x:I,y:M},_))&&T%2==1))return this.__corner=y,y;return!1},forEachControl:function(w){for(var b in this.controls)w(this.controls[b],b,this)},_setCornerCoords:function(){var w=this.oCoords;for(var b in w){var T=this.controls[b];w[b].corner=T.calcCornerCoords(this.angle,this.cornerSize,w[b].x,w[b].y,!1),w[b].touchCorner=T.calcCornerCoords(this.angle,this.touchCornerSize,w[b].x,w[b].y,!0)}},drawSelectionBackground:function(w){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;w.save();var b=this.getCenterPoint(),T=this._calculateCurrentDimensions(),_=this.canvas.viewportTransform;return w.translate(b.x,b.y),w.scale(1/_[0],1/_[3]),w.rotate(S(this.angle)),w.fillStyle=this.selectionBackgroundColor,w.fillRect(-T.x/2,-T.y/2,T.x,T.y),w.restore(),this},drawBorders:function(w,b){b=b||{};var T=this._calculateCurrentDimensions(),_=this.borderScaleFactor,y=T.x+_,I=T.y+_,M=void 0!==b.hasControls?b.hasControls:this.hasControls,x=!1;return w.save(),w.strokeStyle=b.borderColor||this.borderColor,this._setLineDash(w,b.borderDashArray||this.borderDashArray),w.strokeRect(-y/2,-I/2,y,I),M&&(w.beginPath(),this.forEachControl(function(A,F,k){A.withConnection&&A.getVisibility(k,F)&&(x=!0,w.moveTo(A.x*y,A.y*I),w.lineTo(A.x*y+A.offsetX,A.y*I+A.offsetY))}),x&&w.stroke()),w.restore(),this},drawBordersInGroup:function(w,b,T){T=T||{};var _=P.util.sizeAfterTransform(this.width,this.height,b),y=this.strokeWidth,I=this.strokeUniform,M=this.borderScaleFactor,x=_.x+y*(I?this.canvas.getZoom():b.scaleX)+M,A=_.y+y*(I?this.canvas.getZoom():b.scaleY)+M;return w.save(),this._setLineDash(w,T.borderDashArray||this.borderDashArray),w.strokeStyle=T.borderColor||this.borderColor,w.strokeRect(-x/2,-A/2,x,A),w.restore(),this},drawControls:function(w,b){b=b||{},w.save();var T,_,y=this.canvas.getRetinaScaling();return w.setTransform(y,0,0,y,0,0),w.strokeStyle=w.fillStyle=b.cornerColor||this.cornerColor,this.transparentCorners||(w.strokeStyle=b.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(w,b.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(T=this.group.calcTransformMatrix()),this.forEachControl(function(I,M,x){_=x.oCoords[M],I.getVisibility(x,M)&&(T&&(_=P.util.transformPoint(_,T)),I.render(w,_.x,_.y,b,x))}),w.restore(),this},isControlVisible:function(w){return this.controls[w]&&this.controls[w].getVisibility(this,w)},setControlVisible:function(w,b){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[w]=b,this},setControlsVisibility:function(w){for(var b in w||(w={}),w)this.setControlVisible(b,w[b]);return this},onDeselect:function(){},onSelect:function(){}})}(),P.util.object.extend(P.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(S,w){var b=function(){},T=(w=w||{}).onComplete||b,_=w.onChange||b,y=this;return P.util.animate({target:this,startValue:S.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(I){S.set("left",I),y.requestRenderAll(),_()},onComplete:function(){S.setCoords(),T()}})},fxCenterObjectV:function(S,w){var b=function(){},T=(w=w||{}).onComplete||b,_=w.onChange||b,y=this;return P.util.animate({target:this,startValue:S.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(I){S.set("top",I),y.requestRenderAll(),_()},onComplete:function(){S.setCoords(),T()}})},fxRemove:function(S,w){var b=function(){},T=(w=w||{}).onComplete||b,_=w.onChange||b,y=this;return P.util.animate({target:this,startValue:S.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(I){S.set("opacity",I),y.requestRenderAll(),_()},onComplete:function(){y.remove(S),T()}})}}),P.util.object.extend(P.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var S,b=[],T=[];for(S in arguments[0])b.push(S);for(var _=0,y=b.length;_<y;_++)T.push(this._animate(S=b[_],arguments[0][S],arguments[1],_!==y-1));return T}return this._animate.apply(this,arguments)},_animate:function(S,w,b,T){var _,y=this;w=w.toString(),b=b?P.util.object.clone(b):{},~S.indexOf(".")&&(_=S.split("."));var I=y.colorProperties.indexOf(S)>-1||_&&y.colorProperties.indexOf(_[1])>-1,M=_?this.get(_[0])[_[1]]:this.get(S);"from"in b||(b.from=M),I||(w=~w.indexOf("=")?M+parseFloat(w.replace("=","")):parseFloat(w));var x={target:this,startValue:b.from,endValue:w,byValue:b.by,easing:b.easing,duration:b.duration,abort:b.abort&&function(A,F,k){return b.abort.call(y,A,F,k)},onChange:function(A,F,k){_?y[_[0]][_[1]]=A:y.set(S,A),T||b.onChange&&b.onChange(A,F,k)},onComplete:function(A,F,k){T||(y.setCoords(),b.onComplete&&b.onComplete(A,F,k))}};return I?P.util.animateColor(x.startValue,x.endValue,x.duration,x):P.util.animate(x)}}),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.util.object.clone,_={x1:1,x2:1,y1:1,y2:1};function y(I,M){var x=I.origin,A=I.axis1,F=I.axis2,k=I.dimension,V=M.nearest,H=M.center,G=M.farthest;return function(){switch(this.get(x)){case V:return Math.min(this.get(A),this.get(F));case H:return Math.min(this.get(A),this.get(F))+.5*this.get(k);case G:return Math.max(this.get(A),this.get(F))}}}w.Line?w.warn("fabric.Line is already defined"):(w.Line=w.util.createClass(w.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:w.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(I,M){I||(I=[0,0,0,0]),this.callSuper("initialize",M),this.set("x1",I[0]),this.set("y1",I[1]),this.set("x2",I[2]),this.set("y2",I[3]),this._setWidthHeight(M)},_setWidthHeight:function(I){I||(I={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in I?I.left:this._getLeftToOriginX(),this.top="top"in I?I.top:this._getTopToOriginY()},_set:function(I,M){return this.callSuper("_set",I,M),void 0!==_[I]&&this._setWidthHeight(),this},_getLeftToOriginX:y({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:y({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(I){I.beginPath();var M=this.calcLinePoints();I.moveTo(M.x1,M.y1),I.lineTo(M.x2,M.y2),I.lineWidth=this.strokeWidth;var x=I.strokeStyle;I.strokeStyle=this.stroke||I.fillStyle,this.stroke&&this._renderStroke(I),I.strokeStyle=x},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(I){return b(this.callSuper("toObject",I),this.calcLinePoints())},_getNonTransformedDimensions:function(){var I=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(I.y-=this.strokeWidth),0===this.height&&(I.x-=this.strokeWidth)),I},calcLinePoints:function(){var I=this.x1<=this.x2?-1:1,M=this.y1<=this.y2?-1:1;return{x1:I*this.width*.5,x2:I*this.width*-.5,y1:M*this.height*.5,y2:M*this.height*-.5}},_toSVG:function(){var I=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',I.x1,'" y1="',I.y1,'" x2="',I.x2,'" y2="',I.y2,'" />\n']}}),w.Line.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),w.Line.fromElement=function(I,M,x){x=x||{};var A=w.parseAttributes(I,w.Line.ATTRIBUTE_NAMES);M(new w.Line([A.x1||0,A.y1||0,A.x2||0,A.y2||0],b(A,x)))},w.Line.fromObject=function(I,M){var x=T(I,!0);x.points=[I.x1,I.y1,I.x2,I.y2],w.Object._fromObject("Line",x,function(A){delete A.points,M&&M(A)},"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.degreesToRadians;w.Circle?w.warn("fabric.Circle is already defined."):(w.Circle=w.util.createClass(w.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:w.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(T,_){return this.callSuper("_set",T,_),"radius"===T&&this.setRadius(_),this},toObject:function(T){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(T))},_toSVG:function(){var T,_=(this.endAngle-this.startAngle)%360;if(0===_)T=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var y=b(this.startAngle),I=b(this.endAngle),M=this.radius;T=['<path d="M '+w.util.cos(y)*M+" "+w.util.sin(y)*M," A "+M+" "+M," 0 ",+(_>180?"1":"0")+" 1"," "+w.util.cos(I)*M+" "+w.util.sin(I)*M,'" ',"COMMON_PARTS"," />\n"]}return T},_render:function(T){T.beginPath(),T.arc(0,0,this.radius,b(this.startAngle),b(this.endAngle),!1),this._renderPaintInOrder(T)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(T){return this.radius=T,this.set("width",2*T).set("height",2*T)}}),w.Circle.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),w.Circle.fromElement=function(T,_){var y,I=w.parseAttributes(T,w.Circle.ATTRIBUTE_NAMES);if(!("radius"in(y=I)&&y.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");I.left=(I.left||0)-I.radius,I.top=(I.top||0)-I.radius,_(new w.Circle(I))},w.Circle.fromObject=function(T,_){w.Object._fromObject("Circle",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={});w.Triangle?w.warn("fabric.Triangle is already defined"):(w.Triangle=w.util.createClass(w.Object,{type:"triangle",width:100,height:100,_render:function(b){var T=this.width/2,_=this.height/2;b.beginPath(),b.moveTo(-T,_),b.lineTo(0,-_),b.lineTo(T,_),b.closePath(),this._renderPaintInOrder(b)},_toSVG:function(){var b=this.width/2,T=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-b+" "+T,"0 "+-T,b+" "+T].join(","),'" />']}}),w.Triangle.fromObject=function(b,T){return w.Object._fromObject("Triangle",b,T)})}(l),function(S){var w=S.fabric||(S.fabric={}),b=2*Math.PI;w.Ellipse?w.warn("fabric.Ellipse is already defined."):(w.Ellipse=w.util.createClass(w.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:w.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(T){this.callSuper("initialize",T),this.set("rx",T&&T.rx||0),this.set("ry",T&&T.ry||0)},_set:function(T,_){switch(this.callSuper("_set",T,_),T){case"rx":this.rx=_,this.set("width",2*_);break;case"ry":this.ry=_,this.set("height",2*_)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(T){return this.callSuper("toObject",["rx","ry"].concat(T))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(T){T.beginPath(),T.save(),T.transform(1,0,0,this.ry/this.rx,0,0),T.arc(0,0,this.rx,0,b,!1),T.restore(),this._renderPaintInOrder(T)}}),w.Ellipse.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),w.Ellipse.fromElement=function(T,_){var y=w.parseAttributes(T,w.Ellipse.ATTRIBUTE_NAMES);y.left=(y.left||0)-y.rx,y.top=(y.top||0)-y.ry,_(new w.Ellipse(y))},w.Ellipse.fromObject=function(T,_){w.Object._fromObject("Ellipse",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend;w.Rect?w.warn("fabric.Rect is already defined"):(w.Rect=w.util.createClass(w.Object,{stateProperties:w.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:w.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(T){this.callSuper("initialize",T),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(T){var _=this.rx?Math.min(this.rx,this.width/2):0,y=this.ry?Math.min(this.ry,this.height/2):0,I=this.width,M=this.height,x=-this.width/2,A=-this.height/2,F=0!==_||0!==y,k=.4477152502;T.beginPath(),T.moveTo(x+_,A),T.lineTo(x+I-_,A),F&&T.bezierCurveTo(x+I-k*_,A,x+I,A+k*y,x+I,A+y),T.lineTo(x+I,A+M-y),F&&T.bezierCurveTo(x+I,A+M-k*y,x+I-k*_,A+M,x+I-_,A+M),T.lineTo(x+_,A+M),F&&T.bezierCurveTo(x+k*_,A+M,x,A+M-k*y,x,A+M-y),T.lineTo(x,A+y),F&&T.bezierCurveTo(x,A+k*y,x+k*_,A,x+_,A),T.closePath(),this._renderPaintInOrder(T)},toObject:function(T){return this.callSuper("toObject",["rx","ry"].concat(T))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),w.Rect.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),w.Rect.fromElement=function(T,_,y){if(!T)return _(null);y=y||{};var I=w.parseAttributes(T,w.Rect.ATTRIBUTE_NAMES);I.left=I.left||0,I.top=I.top||0,I.height=I.height||0,I.width=I.width||0;var M=new w.Rect(b(y?w.util.object.clone(y):{},I));M.visible=M.visible&&M.width>0&&M.height>0,_(M)},w.Rect.fromObject=function(T,_){return w.Object._fromObject("Rect",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.util.array.min,_=w.util.array.max,y=w.util.toFixed,I=w.util.projectStrokeOnPoints;w.Polyline?w.warn("fabric.Polyline is already defined"):(w.Polyline=w.util.createClass(w.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:w.Object.prototype.cacheProperties.concat("points"),initialize:function(M,x){x=x||{},this.points=M||[],this.callSuper("initialize",x),this._setPositionDimensions(x)},_projectStrokeOnPoints:function(){return I(this.points,this,!0)},_setPositionDimensions:function(M){var x,A=this._calcDimensions(M),F=this.exactBoundingBox?this.strokeWidth:0;this.width=A.width-F,this.height=A.height-F,M.fromSVG||(x=this.translateToGivenOrigin({x:A.left-this.strokeWidth/2+F/2,y:A.top-this.strokeWidth/2+F/2},"left","top",this.originX,this.originY)),void 0===M.left&&(this.left=M.fromSVG?A.left:x.x),void 0===M.top&&(this.top=M.fromSVG?A.top:x.y),this.pathOffset={x:A.left+this.width/2+F/2,y:A.top+this.height/2+F/2}},_calcDimensions:function(){var M=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,x=T(M,"x")||0,A=T(M,"y")||0;return{left:x,top:A,width:(_(M,"x")||0)-x,height:(_(M,"y")||0)-A}},toObject:function(M){return b(this.callSuper("toObject",M),{points:this.points.concat()})},_toSVG:function(){for(var M=[],x=this.pathOffset.x,A=this.pathOffset.y,F=w.Object.NUM_FRACTION_DIGITS,k=0,V=this.points.length;k<V;k++)M.push(y(this.points[k].x-x,F),",",y(this.points[k].y-A,F)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',M.join(""),'" />\n']},commonRender:function(M){var x,A=this.points.length,F=this.pathOffset.x,k=this.pathOffset.y;if(!A||isNaN(this.points[A-1].y))return!1;M.beginPath(),M.moveTo(this.points[0].x-F,this.points[0].y-k);for(var V=0;V<A;V++)M.lineTo((x=this.points[V]).x-F,x.y-k);return!0},_render:function(M){this.commonRender(M)&&this._renderPaintInOrder(M)},complexity:function(){return this.get("points").length}}),w.Polyline.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(),w.Polyline.fromElementGenerator=function(M){return function(x,A,F){if(!x)return A(null);F||(F={});var k=w.parsePointsAttribute(x.getAttribute("points")),V=w.parseAttributes(x,w[M].ATTRIBUTE_NAMES);V.fromSVG=!0,A(new w[M](k,b(V,F)))}},w.Polyline.fromElement=w.Polyline.fromElementGenerator("Polyline"),w.Polyline.fromObject=function(M,x){return w.Object._fromObject("Polyline",M,x,"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.projectStrokeOnPoints;w.Polygon?w.warn("fabric.Polygon is already defined"):(w.Polygon=w.util.createClass(w.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return b(this.points,this)},_render:function(T){this.commonRender(T)&&(T.closePath(),this._renderPaintInOrder(T))}}),w.Polygon.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(),w.Polygon.fromElement=w.Polyline.fromElementGenerator("Polygon"),w.Polygon.fromObject=function(T,_){w.Object._fromObject("Polygon",T,_,"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.array.min,T=w.util.array.max,_=w.util.object.extend,y=w.util.object.clone,I=w.util.toFixed;w.Path?w.warn("fabric.Path is already defined"):(w.Path=w.util.createClass(w.Object,{type:"path",path:null,cacheProperties:w.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:w.Object.prototype.stateProperties.concat("path"),initialize:function(M,x){delete(x=y(x||{})).path,this.callSuper("initialize",x),this._setPath(M||[],x)},_setPath:function(M,x){this.path=w.util.makePathSimpler(Array.isArray(M)?M:w.util.parsePath(M)),w.Polyline.prototype._setPositionDimensions.call(this,x||{})},_renderPathCommands:function(M){var x,A=0,F=0,k=0,V=0,z=-this.pathOffset.x,Z=-this.pathOffset.y;M.beginPath();for(var ie=0,re=this.path.length;ie<re;++ie)switch((x=this.path[ie])[0]){case"L":M.lineTo((k=x[1])+z,(V=x[2])+Z);break;case"M":A=k=x[1],F=V=x[2],M.moveTo(k+z,V+Z);break;case"C":M.bezierCurveTo(x[1]+z,x[2]+Z,x[3]+z,x[4]+Z,(k=x[5])+z,(V=x[6])+Z);break;case"Q":M.quadraticCurveTo(x[1]+z,x[2]+Z,x[3]+z,x[4]+Z),k=x[3],V=x[4];break;case"z":case"Z":k=A,V=F,M.closePath()}},_render:function(M){this._renderPathCommands(M),this._renderPaintInOrder(M)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(M){return _(this.callSuper("toObject",M),{path:this.path.map(function(x){return x.slice()})})},toDatalessObject:function(M){var x=this.toObject(["sourcePath"].concat(M));return x.sourcePath&&delete x.path,x},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',w.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var M=w.Object.NUM_FRACTION_DIGITS;return" translate("+I(-this.pathOffset.x,M)+", "+I(-this.pathOffset.y,M)+")"},toClipPathSVG:function(M){var x=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:M,additionalTransform:x})},toSVG:function(M){var x=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:M,additionalTransform:x})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var M,x,A=[],F=[],k=0,V=0,H=0,G=0,z=0,Z=this.path.length;z<Z;++z){switch((M=this.path[z])[0]){case"L":H=M[1],G=M[2],x=[];break;case"M":k=H=M[1],V=G=M[2],x=[];break;case"C":x=w.util.getBoundsOfCurve(H,G,M[1],M[2],M[3],M[4],M[5],M[6]),H=M[5],G=M[6];break;case"Q":x=w.util.getBoundsOfCurve(H,G,M[1],M[2],M[1],M[2],M[3],M[4]),H=M[3],G=M[4];break;case"z":case"Z":H=k,G=V}x.forEach(function(de){A.push(de.x),F.push(de.y)}),A.push(H),F.push(G)}var ie=b(A)||0,re=b(F)||0;return{left:ie,top:re,width:(T(A)||0)-ie,height:(T(F)||0)-re}}}),w.Path.fromObject=function(M,x){"string"==typeof M.sourcePath?w.loadSVGFromURL(M.sourcePath,function(F){var k=F[0];k.setOptions(M),x&&x(k)}):w.Object._fromObject("Path",M,x,"path")},w.Path.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(["d"]),w.Path.fromElement=function(M,x,A){var F=w.parseAttributes(M,w.Path.ATTRIBUTE_NAMES);F.fromSVG=!0,x(new w.Path(F.d,_(F,A)))})}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.array.min,T=w.util.array.max;w.Group||(w.Group=w.util.createClass(w.Object,w.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(_,y,I){y=y||{},this._objects=[],I&&this.callSuper("initialize",y),this._objects=_||[];for(var M=this._objects.length;M--;)this._objects[M].group=this;if(I)this._updateObjectsACoords();else{var x=y&&y.centerPoint;void 0!==y.originX&&(this.originX=y.originX),void 0!==y.originY&&(this.originY=y.originY),x||this._calcBounds(),this._updateObjectsCoords(x),delete y.centerPoint,this.callSuper("initialize",y)}this.setCoords()},_updateObjectsACoords:function(){for(var _=this._objects.length;_--;)this._objects[_].setCoords(!0)},_updateObjectsCoords:function(_){_=_||this.getCenterPoint();for(var y=this._objects.length;y--;)this._updateObjectCoords(this._objects[y],_)},_updateObjectCoords:function(_,y){_.set({left:_.left-y.x,top:_.top-y.y}),_.group=this,_.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(_){var y=!!this.group;return this._restoreObjectsState(),w.util.resetObjectTransform(this),_&&(y&&w.util.removeTransformFromObject(_,this.group.calcTransformMatrix()),this._objects.push(_),_.group=this,_._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,y?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(_){return this._restoreObjectsState(),w.util.resetObjectTransform(this),this.remove(_),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(_){this.dirty=!0,_.group=this,_._set("canvas",this.canvas)},_onObjectRemoved:function(_){this.dirty=!0,delete _.group},_set:function(_,y){var I=this._objects.length;if(this.useSetOnGroup)for(;I--;)this._objects[I].setOnGroup(_,y);if("canvas"===_)for(;I--;)this._objects[I]._set(_,y);w.Object.prototype._set.call(this,_,y)},toObject:function(_){var y=this.includeDefaultValues,I=this._objects.filter(function(x){return!x.excludeFromExport}).map(function(x){var A=x.includeDefaultValues;x.includeDefaultValues=y;var F=x.toObject(_);return x.includeDefaultValues=A,F}),M=w.Object.prototype.toObject.call(this,_);return M.objects=I,M},toDatalessObject:function(_){var y,I=this.sourcePath;if(I)y=I;else{var M=this.includeDefaultValues;y=this._objects.map(function(A){var F=A.includeDefaultValues;A.includeDefaultValues=M;var k=A.toDatalessObject(_);return A.includeDefaultValues=F,k})}var x=w.Object.prototype.toDatalessObject.call(this,_);return x.objects=y,x},render:function(_){this._transformDone=!0,this.callSuper("render",_),this._transformDone=!1},shouldCache:function(){var _=w.Object.prototype.shouldCache.call(this);if(_)for(var y=0,I=this._objects.length;y<I;y++)if(this._objects[y].willDrawShadow())return this.ownCaching=!1,!1;return _},willDrawShadow:function(){if(w.Object.prototype.willDrawShadow.call(this))return!0;for(var _=0,y=this._objects.length;_<y;_++)if(this._objects[_].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(_){for(var y=0,I=this._objects.length;y<I;y++)this._objects[y].render(_);this._drawClipPath(_,this.clipPath)},isCacheDirty:function(_){if(this.callSuper("isCacheDirty",_))return!0;if(!this.statefullCache)return!1;for(var y=0,I=this._objects.length;y<I;y++)if(this._objects[y].isCacheDirty(!0)){if(this._cacheCanvas){var M=this.cacheWidth/this.zoomX,x=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-M/2,-x/2,M,x)}return!0}return!1},_restoreObjectsState:function(){var _=this.calcOwnMatrix();return this._objects.forEach(function(y){w.util.addTransformToObject(y,_),delete y.group,y.setCoords()}),this},destroy:function(){return this._objects.forEach(function(_){_.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(_){_.dispose&&_.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var _=this._objects,y=this.canvas;this._objects=[];var I=this.toObject();delete I.objects;var M=new w.ActiveSelection([]);return M.set(I),M.type="activeSelection",y.remove(this),_.forEach(function(x){x.group=M,x.dirty=!0,y.add(x)}),M.canvas=y,M._objects=_,y._activeObject=M,M.setCoords(),M}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(_){_.setCoords(!0)}),this},_calcBounds:function(_){for(var y,I,M,x,A=[],F=[],k=["tr","br","bl","tl"],V=0,H=this._objects.length,G=k.length;V<H;++V){for(M=(y=this._objects[V]).calcACoords(),x=0;x<G;x++)A.push(M[I=k[x]].x),F.push(M[I].y);y.aCoords=M}this._getBounds(A,F,_)},_getBounds:function(_,y,I){var M=new w.Point(b(_),b(y)),x=new w.Point(T(_),T(y)),A=M.y||0,F=M.x||0,V=x.y-M.y||0;this.width=x.x-M.x||0,this.height=V,I||this.setPositionByOrigin({x:F,y:A},"left","top")},_toSVG:function(_){for(var y=["<g ","COMMON_PARTS"," >\n"],I=0,M=this._objects.length;I<M;I++)y.push("\t\t",this._objects[I].toSVG(_));return y.push("</g>\n"),y},getSvgStyles:function(){var y=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),y].join("")},toClipPathSVG:function(_){for(var y=[],I=0,M=this._objects.length;I<M;I++)y.push("\t",this._objects[I].toClipPathSVG(_));return this._createBaseClipPathSVGMarkup(y,{reviver:_})}}),w.Group.fromObject=function(_,y){var I=_.objects,M=w.util.object.clone(_,!0);delete M.objects,"string"!=typeof I?w.util.enlivenObjects(I,function(x){var A=w.util.object.clone(_,!0);delete A.objects,w.util.enlivenObjectEnlivables(_,A,function(){y&&y(new w.Group(x,A,!0))})}):w.loadSVGFromURL(I,function(x){var A=w.util.groupSVGElements(x,_,I);A.set(M),y&&y(A)})})}(l),function(S){var w=S.fabric||(S.fabric={});w.ActiveSelection||(w.ActiveSelection=w.util.createClass(w.Group,{type:"activeSelection",initialize:function(b,T){T=T||{},this._objects=b||[];for(var _=this._objects.length;_--;)this._objects[_].group=this;T.originX&&(this.originX=T.originX),T.originY&&(this.originY=T.originY),this._calcBounds(),this._updateObjectsCoords(),w.Object.prototype.initialize.call(this,T),this.setCoords()},toGroup:function(){var b=this._objects.concat();this._objects=[];var T=w.Object.prototype.toObject.call(this),_=new w.Group([]);if(delete T.type,_.set(T),b.forEach(function(I){I.canvas.remove(I),I.group=_}),_._objects=b,!this.canvas)return _;var y=this.canvas;return y.add(_),y._activeObject=_,_.setCoords(),_},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(b,T,_){b.save(),b.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",b,T),void 0===(_=_||{}).hasControls&&(_.hasControls=!1),_.forActiveSelection=!0;for(var y=0,I=this._objects.length;y<I;y++)this._objects[y]._renderControls(b,_);b.restore()}}),w.ActiveSelection.fromObject=function(b,T){w.util.enlivenObjects(b.objects,function(_){delete b.objects,T&&T(new w.ActiveSelection(_,b,!0))})})}(l),function(S){var w=P.util.object.extend;S.fabric||(S.fabric={}),S.fabric.Image?P.warn("fabric.Image is already defined."):(P.Image=P.util.createClass(P.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:P.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:P.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(b,T){T||(T={}),this.filters=[],this.cacheKey="texture"+P.Object.__uid++,this.callSuper("initialize",T),this._initElement(b,T)},getElement:function(){return this._element||{}},setElement:function(b,T){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=b,this._originalElement=b,this._initConfig(T),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(b){var T=P.filterBackend;T&&T.evictCachesForKey&&T.evictCachesForKey(b)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(b){P.util.cleanUpJsdomNode(this[b]),this[b]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var b=this.getElement();return{width:b.naturalWidth||b.width,height:b.naturalHeight||b.height}},_stroke:function(b){if(this.stroke&&0!==this.strokeWidth){var T=this.width/2,_=this.height/2;b.beginPath(),b.moveTo(-T,-_),b.lineTo(T,-_),b.lineTo(T,_),b.lineTo(-T,_),b.lineTo(-T,-_),b.closePath()}},toObject:function(b){var T=[];this.filters.forEach(function(y){y&&T.push(y.toObject())});var _=w(this.callSuper("toObject",["cropX","cropY"].concat(b)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:T});return this.resizeFilter&&(_.resizeFilter=this.resizeFilter.toObject()),_},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var b,T=[],_=[],y=this._element,I=-this.width/2,M=-this.height/2,x="",A="";if(!y)return[];if(this.hasCrop()){var F=P.Object.__uid++;T.push('<clipPath id="imageCrop_'+F+'">\n','\t<rect x="'+I+'" y="'+M+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),x=' clip-path="url(#imageCrop_'+F+')" '}if(this.imageSmoothing||(A='" image-rendering="optimizeSpeed'),_.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',I-this.cropX,'" y="',M-this.cropY,'" width="',y.width||y.naturalWidth,'" height="',y.height||y.height,A,'"',x,"></image>\n"),this.stroke||this.strokeDashArray){var k=this.fill;this.fill=null,b=["\t<rect ",'x="',I,'" y="',M,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=k}return"fill"!==this.paintFirst?T.concat(b,_):T.concat(_,b)},getSrc:function(b){var T=b?this._element:this._originalElement;return T?T.toDataURL?T.toDataURL():this.srcFromAttribute?T.getAttribute("src"):T.src:this.src||""},setSrc:function(b,T,_){return P.util.loadImage(b,function(y,I){this.setElement(y,_),this._setWidthHeight(),T&&T(this,I)},this,_&&_.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var b=this.resizeFilter,T=this.minimumScaleTrigger,_=this.getTotalObjectScaling(),y=_.scaleX,I=_.scaleY,M=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!b||y>T&&I>T)return this._element=M,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=y,void(this._lastScaleY=I);P.filterBackend||(P.filterBackend=P.initFilterBackend());var x=P.util.createCanvasElement(),A=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,F=M.width,k=M.height;x.width=F,x.height=k,this._element=x,this._lastScaleX=b.scaleX=y,this._lastScaleY=b.scaleY=I,P.filterBackend.applyFilters([b],M,F,k,this._element,A),this._filterScalingX=x.width/this._originalElement.width,this._filterScalingY=x.height/this._originalElement.height},applyFilters:function(b){if(b=(b=b||this.filters||[]).filter(function(M){return M&&!M.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===b.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var T=this._originalElement,_=T.naturalWidth||T.width,y=T.naturalHeight||T.height;if(this._element===this._originalElement){var I=P.util.createCanvasElement();I.width=_,I.height=y,this._element=I,this._filteredEl=I}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,_,y),this._lastScaleX=1,this._lastScaleY=1;return P.filterBackend||(P.filterBackend=P.initFilterBackend()),P.filterBackend.applyFilters(b,this._originalElement,_,y,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(b){P.util.setImageSmoothing(b,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(b),this._renderPaintInOrder(b)},drawCacheOnCanvas:function(b){P.util.setImageSmoothing(b,this.imageSmoothing),P.Object.prototype.drawCacheOnCanvas.call(this,b)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(b){var T=this._element;if(T){var _=this._filterScalingX,y=this._filterScalingY,I=this.width,M=this.height,x=Math.min,A=Math.max,F=A(this.cropX,0),k=A(this.cropY,0),V=T.naturalWidth||T.width,H=T.naturalHeight||T.height,G=F*_,z=k*y,Z=x(I*_,V-G),ie=x(M*y,H-z),re=-I/2,de=-M/2,ce=x(I,V/_-F),le=x(M,H/y-k);T&&b.drawImage(T,G,z,Z,ie,re,de,ce,le)}},_needsResize:function(){var b=this.getTotalObjectScaling();return b.scaleX!==this._lastScaleX||b.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(b,T){this.setElement(P.util.getById(b),T),P.util.addClass(this.getElement(),P.Image.CSS_CANVAS)},_initConfig:function(b){b||(b={}),this.setOptions(b),this._setWidthHeight(b)},_initFilters:function(b,T){b&&b.length?P.util.enlivenObjects(b,function(_){T&&T(_)},"fabric.Image.filters"):T&&T()},_setWidthHeight:function(b){b||(b={});var T=this.getElement();this.width=b.width||T.naturalWidth||T.width||0,this.height=b.height||T.naturalHeight||T.height||0},parsePreserveAspectRatioAttribute:function(){var b,T=P.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),_=this._element.width,y=this._element.height,I=1,M=1,x=0,A=0,F=0,k=0,V=this.width,H=this.height,G={width:V,height:H};return!T||"none"===T.alignX&&"none"===T.alignY?(I=V/_,M=H/y):("meet"===T.meetOrSlice&&(b=(V-_*(I=M=P.util.findScaleToFit(this._element,G)))/2,"Min"===T.alignX&&(x=-b),"Max"===T.alignX&&(x=b),b=(H-y*M)/2,"Min"===T.alignY&&(A=-b),"Max"===T.alignY&&(A=b)),"slice"===T.meetOrSlice&&(b=_-V/(I=M=P.util.findScaleToCover(this._element,G)),"Mid"===T.alignX&&(F=b/2),"Max"===T.alignX&&(F=b),b=y-H/M,"Mid"===T.alignY&&(k=b/2),"Max"===T.alignY&&(k=b),_=V/I,y=H/M)),{width:_,height:y,scaleX:I,scaleY:M,offsetLeft:x,offsetTop:A,cropX:F,cropY:k}}}),P.Image.CSS_CANVAS="canvas-img",P.Image.prototype.getSvgSrc=P.Image.prototype.getSrc,P.Image.fromObject=function(b,T){var _=P.util.object.clone(b);P.util.loadImage(_.src,function(y,I){I?T&&T(null,!0):P.Image.prototype._initFilters.call(_,_.filters,function(M){_.filters=M||[],P.Image.prototype._initFilters.call(_,[_.resizeFilter],function(x){_.resizeFilter=x[0],P.util.enlivenObjectEnlivables(_,_,function(){var A=new P.Image(y,_);T(A,!1)})})})},null,_.crossOrigin)},P.Image.fromURL=function(b,T,_){P.util.loadImage(b,function(y,I){T&&T(new P.Image(y,_),I)},null,_&&_.crossOrigin)},P.Image.ATTRIBUTE_NAMES=P.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),P.Image.fromElement=function(b,T,_){var y=P.parseAttributes(b,P.Image.ATTRIBUTE_NAMES);P.Image.fromURL(y["xlink:href"],T,w(_?P.util.object.clone(_):{},y))})}(l),P.util.object.extend(P.Object.prototype,{_getAngleValueForStraighten:function(){var S=this.angle%360;return S>0?90*Math.round((S-1)/90):90*Math.round(S/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(S){var w=function(){},b=(S=S||{}).onComplete||w,T=S.onChange||w,_=this;return P.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(y){_.rotate(y),T()},onComplete:function(){_.setCoords(),b()}})}}),P.util.object.extend(P.StaticCanvas.prototype,{straightenObject:function(S){return S.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(S){return S.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function S(b,T){var _="precision "+T+" float;\nvoid main(){}",y=b.createShader(b.FRAGMENT_SHADER);return b.shaderSource(y,_),b.compileShader(y),!!b.getShaderParameter(y,b.COMPILE_STATUS)}function w(b){b&&b.tileSize&&(this.tileSize=b.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}P.isWebglSupported=function(b){if(P.isLikelyNode)return!1;b=b||P.WebglFilterBackend.prototype.tileSize;var T=document.createElement("canvas"),_=T.getContext("webgl")||T.getContext("experimental-webgl"),y=!1;if(_){P.maxTextureSize=_.getParameter(_.MAX_TEXTURE_SIZE),y=P.maxTextureSize>=b;for(var I=["highp","mediump","lowp"],M=0;M<3;M++)if(S(_,I[M])){P.webGlPrecision=I[M];break}}return this.isSupported=y,y},P.WebglFilterBackend=w,w.prototype={tileSize:2048,resources:{},setupGLContext:function(b,T){this.dispose(),this.createWebGLCanvas(b,T),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(b,T)},chooseFastestCopyGLTo2DMethod:function(b,T){var _,y=void 0!==window.performance;try{new ImageData(1,1),_=!0}catch(H){_=!1}var I="undefined"!=typeof ArrayBuffer,M="undefined"!=typeof Uint8ClampedArray;if(y&&_&&I&&M){var x=P.util.createCanvasElement(),A=new ArrayBuffer(b*T*4);if(P.forceGLPutImageData)return this.imageBuffer=A,void(this.copyGLTo2D=Je);var F,k,V={imageBuffer:A,destinationWidth:b,destinationHeight:T,targetCanvas:x};x.width=b,x.height=T,F=window.performance.now(),Be.call(V,this.gl,V),k=window.performance.now()-F,F=window.performance.now(),Je.call(V,this.gl,V),k>window.performance.now()-F?(this.imageBuffer=A,this.copyGLTo2D=Je):this.copyGLTo2D=Be}},createWebGLCanvas:function(b,T){var _=P.util.createCanvasElement();_.width=b,_.height=T;var y={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},I=_.getContext("webgl",y);I||(I=_.getContext("experimental-webgl",y)),I&&(I.clearColor(0,0,0,0),this.canvas=_,this.gl=I)},applyFilters:function(b,T,_,y,I,M){var x,A=this.gl;M&&(x=this.getCachedTexture(M,T));var V,H,Z,ie,F={originalWidth:T.width||T.originalWidth,originalHeight:T.height||T.originalHeight,sourceWidth:_,sourceHeight:y,destinationWidth:_,destinationHeight:y,context:A,sourceTexture:this.createTexture(A,_,y,!x&&T),targetTexture:this.createTexture(A,_,y),originalTexture:x||this.createTexture(A,_,y,!x&&T),passes:b.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:I},k=A.createFramebuffer();return A.bindFramebuffer(A.FRAMEBUFFER,k),b.forEach(function(V){V&&V.applyTo(F)}),ie=(V=F).destinationHeight,(H=V.targetCanvas).width===(Z=V.destinationWidth)&&H.height===ie||(H.width=Z,H.height=ie),this.copyGLTo2D(A,F),A.bindTexture(A.TEXTURE_2D,null),A.deleteTexture(F.sourceTexture),A.deleteTexture(F.targetTexture),A.deleteFramebuffer(k),I.getContext("2d").setTransform(1,0,0,1,0,0),F},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(b,T,_,y){var I=b.createTexture();return b.bindTexture(b.TEXTURE_2D,I),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),y?b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,y):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,T,_,0,b.RGBA,b.UNSIGNED_BYTE,null),I},getCachedTexture:function(b,T){if(this.textureCache[b])return this.textureCache[b];var _=this.createTexture(this.gl,T.width,T.height,T);return this.textureCache[b]=_,_},evictCachesForKey:function(b){this.textureCache[b]&&(this.gl.deleteTexture(this.textureCache[b]),delete this.textureCache[b])},copyGLTo2D:Be,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var b=this.gl,T={renderer:"",vendor:""};if(!b)return T;var _=b.getExtension("WEBGL_debug_renderer_info");if(_){var y=b.getParameter(_.UNMASKED_RENDERER_WEBGL),I=b.getParameter(_.UNMASKED_VENDOR_WEBGL);y&&(T.renderer=y.toLowerCase()),I&&(T.vendor=I.toLowerCase())}return this.gpuInfo=T,T}}}(),function(){var S=function(){};function w(){}P.Canvas2dFilterBackend=w,w.prototype={evictCachesForKey:S,dispose:S,clearWebGLCaches:S,resources:{},applyFilters:function(b,T,_,y,I){var M=I.getContext("2d");M.drawImage(T,0,0,_,y);var x={sourceWidth:_,sourceHeight:y,imageData:M.getImageData(0,0,_,y),originalEl:T,originalImageData:M.getImageData(0,0,_,y),canvasEl:I,ctx:M,filterBackend:this};return b.forEach(function(A){A.applyTo(x)}),x.imageData.width===_&&x.imageData.height===y||(I.width=x.imageData.width,I.height=x.imageData.height),M.putImageData(x.imageData,0,0),x}}}(),P.Image=P.Image||{},P.Image.filters=P.Image.filters||{},P.Image.filters.BaseFilter=P.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(S){S&&this.setOptions(S)},setOptions:function(S){for(var w in S)this[w]=S[w]},createProgram:function(S,w,b){w=w||this.fragmentSource,b=b||this.vertexSource,"highp"!==P.webGlPrecision&&(w=w.replace(/precision highp float/g,"precision "+P.webGlPrecision+" float"));var T=S.createShader(S.VERTEX_SHADER);if(S.shaderSource(T,b),S.compileShader(T),!S.getShaderParameter(T,S.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+S.getShaderInfoLog(T));var _=S.createShader(S.FRAGMENT_SHADER);if(S.shaderSource(_,w),S.compileShader(_),!S.getShaderParameter(_,S.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+S.getShaderInfoLog(_));var y=S.createProgram();if(S.attachShader(y,T),S.attachShader(y,_),S.linkProgram(y),!S.getProgramParameter(y,S.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+S.getProgramInfoLog(y));var I=this.getAttributeLocations(S,y),M=this.getUniformLocations(S,y)||{};return M.uStepW=S.getUniformLocation(y,"uStepW"),M.uStepH=S.getUniformLocation(y,"uStepH"),{program:y,attributeLocations:I,uniformLocations:M}},getAttributeLocations:function(S,w){return{aPosition:S.getAttribLocation(w,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(S,w,b){var T=w.aPosition,_=S.createBuffer();S.bindBuffer(S.ARRAY_BUFFER,_),S.enableVertexAttribArray(T),S.vertexAttribPointer(T,2,S.FLOAT,!1,0,0),S.bufferData(S.ARRAY_BUFFER,b,S.STATIC_DRAW)},_setupFrameBuffer:function(S){var w,b,T=S.context;S.passes>1?(b=S.destinationHeight,S.sourceWidth===(w=S.destinationWidth)&&S.sourceHeight===b||(T.deleteTexture(S.targetTexture),S.targetTexture=S.filterBackend.createTexture(T,w,b)),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,S.targetTexture,0)):(T.bindFramebuffer(T.FRAMEBUFFER,null),T.finish())},_swapTextures:function(S){S.passes--,S.pass++;var w=S.targetTexture;S.targetTexture=S.sourceTexture,S.sourceTexture=w},isNeutralState:function(){var S=this.mainParameter,w=P.Image.filters[this.type].prototype;if(S){if(Array.isArray(w[S])){for(var b=w[S].length;b--;)if(this[S][b]!==w[S][b])return!1;return!0}return w[S]===this[S]}return!1},applyTo:function(S){S.webgl?(this._setupFrameBuffer(S),this.applyToWebGL(S),this._swapTextures(S)):this.applyTo2d(S)},retrieveShader:function(S){return S.programCache.hasOwnProperty(this.type)||(S.programCache[this.type]=this.createProgram(S.context)),S.programCache[this.type]},applyToWebGL:function(S){var w=S.context,b=this.retrieveShader(S);w.bindTexture(w.TEXTURE_2D,0===S.pass&&S.originalTexture?S.originalTexture:S.sourceTexture),w.useProgram(b.program),this.sendAttributeData(w,b.attributeLocations,S.aPosition),w.uniform1f(b.uniformLocations.uStepW,1/S.sourceWidth),w.uniform1f(b.uniformLocations.uStepH,1/S.sourceHeight),this.sendUniformData(w,b.uniformLocations),w.viewport(0,0,S.destinationWidth,S.destinationHeight),w.drawArrays(w.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(S,w,b){S.activeTexture(b),S.bindTexture(S.TEXTURE_2D,w),S.activeTexture(S.TEXTURE0)},unbindAdditionalTexture:function(S,w){S.activeTexture(w),S.bindTexture(S.TEXTURE_2D,null),S.activeTexture(S.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(S){this[this.mainParameter]=S},sendUniformData:function(){},createHelpLayer:function(S){if(!S.helpLayer){var w=document.createElement("canvas");w.width=S.sourceWidth,w.height=S.sourceHeight,S.helpLayer=w}},toObject:function(){var S={type:this.type},w=this.mainParameter;return w&&(S[w]=this[w]),S},toJSON:function(){return this.toObject()}}),P.Image.filters.BaseFilter.fromObject=function(S,w){var b=new P.Image.filters[S.type](S);return w&&w(b),b},function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.ColorMatrix=(0,w.util.createClass)(b.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(_){this.callSuper("initialize",_),this.matrix=this.matrix.slice(0)},applyTo2d:function(_){var y,I,M,x,A,F=_.imageData.data,k=F.length,V=this.matrix,H=this.colorsOnly;for(A=0;A<k;A+=4)y=F[A],I=F[A+1],M=F[A+2],H?(F[A]=y*V[0]+I*V[1]+M*V[2]+255*V[4],F[A+1]=y*V[5]+I*V[6]+M*V[7]+255*V[9],F[A+2]=y*V[10]+I*V[11]+M*V[12]+255*V[14]):(F[A]=y*V[0]+I*V[1]+M*V[2]+(x=F[A+3])*V[3]+255*V[4],F[A+1]=y*V[5]+I*V[6]+M*V[7]+x*V[8]+255*V[9],F[A+2]=y*V[10]+I*V[11]+M*V[12]+x*V[13]+255*V[14],F[A+3]=y*V[15]+I*V[16]+M*V[17]+x*V[18]+255*V[19])},getUniformLocations:function(_,y){return{uColorMatrix:_.getUniformLocation(y,"uColorMatrix"),uConstants:_.getUniformLocation(y,"uConstants")}},sendUniformData:function(_,y){var I=this.matrix,x=[I[4],I[9],I[14],I[19]];_.uniformMatrix4fv(y.uColorMatrix,!1,[I[0],I[1],I[2],I[3],I[5],I[6],I[7],I[8],I[10],I[11],I[12],I[13],I[15],I[16],I[17],I[18]]),_.uniform4fv(y.uConstants,x)}}),w.Image.filters.ColorMatrix.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Brightness=(0,w.util.createClass)(b.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(_){if(0!==this.brightness){var y,I=_.imageData.data,M=I.length,x=Math.round(255*this.brightness);for(y=0;y<M;y+=4)I[y]=I[y]+x,I[y+1]=I[y+1]+x,I[y+2]=I[y+2]+x}},getUniformLocations:function(_,y){return{uBrightness:_.getUniformLocation(y,"uBrightness")}},sendUniformData:function(_,y){_.uniform1f(y.uBrightness,this.brightness)}}),w.Image.filters.Brightness.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.Image.filters;T.Convolute=(0,w.util.createClass)(T.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(y){var I=Math.sqrt(this.matrix.length),M=this.type+"_"+I+"_"+(this.opaque?1:0),x=this.fragmentSource[M];return y.programCache.hasOwnProperty(M)||(y.programCache[M]=this.createProgram(y.context,x)),y.programCache[M]},applyTo2d:function(y){var I,M,x,A,F,k,V,H,G,z,Z,ie,re,de=y.imageData,ce=de.data,le=this.matrix,ee=Math.round(Math.sqrt(le.length)),J=Math.floor(ee/2),se=de.width,he=de.height,fe=y.ctx.createImageData(se,he),ne=fe.data,te=this.opaque?1:0;for(Z=0;Z<he;Z++)for(z=0;z<se;z++){for(F=4*(Z*se+z),I=0,M=0,x=0,A=0,re=0;re<ee;re++)for(ie=0;ie<ee;ie++)k=z+ie-J,(V=Z+re-J)<0||V>=he||k<0||k>=se||(I+=ce[H=4*(V*se+k)]*(G=le[re*ee+ie]),M+=ce[H+1]*G,x+=ce[H+2]*G,te||(A+=ce[H+3]*G));ne[F]=I,ne[F+1]=M,ne[F+2]=x,ne[F+3]=te?ce[F+3]:A}y.imageData=fe},getUniformLocations:function(y,I){return{uMatrix:y.getUniformLocation(I,"uMatrix"),uOpaque:y.getUniformLocation(I,"uOpaque"),uHalfSize:y.getUniformLocation(I,"uHalfSize"),uSize:y.getUniformLocation(I,"uSize")}},sendUniformData:function(y,I){y.uniform1fv(I.uMatrix,this.matrix)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),w.Image.filters.Convolute.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Grayscale=(0,w.util.createClass)(b.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(_){var y,I,M=_.imageData.data,x=M.length,A=this.mode;for(y=0;y<x;y+=4)"average"===A?I=(M[y]+M[y+1]+M[y+2])/3:"lightness"===A?I=(Math.min(M[y],M[y+1],M[y+2])+Math.max(M[y],M[y+1],M[y+2]))/2:"luminosity"===A&&(I=.21*M[y]+.72*M[y+1]+.07*M[y+2]),M[y]=I,M[y+1]=I,M[y+2]=I},retrieveShader:function(_){var y=this.type+"_"+this.mode;return _.programCache.hasOwnProperty(y)||(_.programCache[y]=this.createProgram(_.context,this.fragmentSource[this.mode])),_.programCache[y]},getUniformLocations:function(_,y){return{uMode:_.getUniformLocation(y,"uMode")}},sendUniformData:function(_,y){_.uniform1i(y.uMode,1)},isNeutralState:function(){return!1}}),w.Image.filters.Grayscale.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Invert=(0,w.util.createClass)(b.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(_){var y,I=_.imageData.data,M=I.length;for(y=0;y<M;y+=4)I[y]=255-I[y],I[y+1]=255-I[y+1],I[y+2]=255-I[y+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(_,y){return{uInvert:_.getUniformLocation(y,"uInvert")}},sendUniformData:function(_,y){_.uniform1i(y.uInvert,this.invert)}}),w.Image.filters.Invert.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.Image.filters;T.Noise=(0,w.util.createClass)(T.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(y){if(0!==this.noise){var I,M,A,x=y.imageData.data,F=this.noise;for(I=0,A=x.length;I<A;I+=4)M=(.5-Math.random())*F,x[I]+=M,x[I+1]+=M,x[I+2]+=M}},getUniformLocations:function(y,I){return{uNoise:y.getUniformLocation(I,"uNoise"),uSeed:y.getUniformLocation(I,"uSeed")}},sendUniformData:function(y,I){y.uniform1f(I.uNoise,this.noise/255),y.uniform1f(I.uSeed,Math.random())},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}}),w.Image.filters.Noise.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Pixelate=(0,w.util.createClass)(b.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(_){var y,I,M,x,A,F,k,V,H,G,z,Z=_.imageData,ie=Z.data,re=Z.height,de=Z.width;for(I=0;I<re;I+=this.blocksize)for(M=0;M<de;M+=this.blocksize)for(x=ie[y=4*I*de+4*M],A=ie[y+1],F=ie[y+2],k=ie[y+3],G=Math.min(I+this.blocksize,re),z=Math.min(M+this.blocksize,de),V=I;V<G;V++)for(H=M;H<z;H++)ie[y=4*V*de+4*H]=x,ie[y+1]=A,ie[y+2]=F,ie[y+3]=k},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(_,y){return{uBlocksize:_.getUniformLocation(y,"uBlocksize"),uStepW:_.getUniformLocation(y,"uStepW"),uStepH:_.getUniformLocation(y,"uStepH")}},sendUniformData:function(_,y){_.uniform1f(y.uBlocksize,this.blocksize)}}),w.Image.filters.Pixelate.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.extend,T=w.Image.filters;T.RemoveColor=(0,w.util.createClass)(T.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(y){var I,M,x,A,F=y.imageData.data,k=255*this.distance,V=new w.Color(this.color).getSource(),H=[V[0]-k,V[1]-k,V[2]-k],G=[V[0]+k,V[1]+k,V[2]+k];for(I=0;I<F.length;I+=4)x=F[I+1],A=F[I+2],(M=F[I])>H[0]&&x>H[1]&&A>H[2]&&M<G[0]&&x<G[1]&&A<G[2]&&(F[I+3]=0)},getUniformLocations:function(y,I){return{uLow:y.getUniformLocation(I,"uLow"),uHigh:y.getUniformLocation(I,"uHigh")}},sendUniformData:function(y,I){var M=new w.Color(this.color).getSource(),x=parseFloat(this.distance),F=[M[0]/255+x,M[1]/255+x,M[2]/255+x,1];y.uniform4fv(I.uLow,[0+M[0]/255-x,0+M[1]/255-x,0+M[2]/255-x,1]),y.uniform4fv(I.uHigh,F)},toObject:function(){return b(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),w.Image.filters.RemoveColor.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters,T=w.util.createClass,_={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var y in _)b[y]=T(b.ColorMatrix,{type:y,matrix:_[y],mainParameter:!1,colorsOnly:!0}),w.Image.filters[y].fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric,b=w.Image.filters;b.BlendColor=(0,w.util.createClass)(b.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(_){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[_]+"}\n}"},retrieveShader:function(_){var y,I=this.type+"_"+this.mode;return _.programCache.hasOwnProperty(I)||(y=this.buildSource(this.mode),_.programCache[I]=this.createProgram(_.context,y)),_.programCache[I]},applyTo2d:function(_){var y,I,M,x,A,F,k,V=_.imageData.data,H=V.length,G=1-this.alpha;y=(k=new w.Color(this.color).getSource())[0]*this.alpha,I=k[1]*this.alpha,M=k[2]*this.alpha;for(var z=0;z<H;z+=4)switch(x=V[z],A=V[z+1],F=V[z+2],this.mode){case"multiply":V[z]=x*y/255,V[z+1]=A*I/255,V[z+2]=F*M/255;break;case"screen":V[z]=255-(255-x)*(255-y)/255,V[z+1]=255-(255-A)*(255-I)/255,V[z+2]=255-(255-F)*(255-M)/255;break;case"add":V[z]=x+y,V[z+1]=A+I,V[z+2]=F+M;break;case"diff":case"difference":V[z]=Math.abs(x-y),V[z+1]=Math.abs(A-I),V[z+2]=Math.abs(F-M);break;case"subtract":V[z]=x-y,V[z+1]=A-I,V[z+2]=F-M;break;case"darken":V[z]=Math.min(x,y),V[z+1]=Math.min(A,I),V[z+2]=Math.min(F,M);break;case"lighten":V[z]=Math.max(x,y),V[z+1]=Math.max(A,I),V[z+2]=Math.max(F,M);break;case"overlay":V[z]=y<128?2*x*y/255:255-2*(255-x)*(255-y)/255,V[z+1]=I<128?2*A*I/255:255-2*(255-A)*(255-I)/255,V[z+2]=M<128?2*F*M/255:255-2*(255-F)*(255-M)/255;break;case"exclusion":V[z]=y+x-2*y*x/255,V[z+1]=I+A-2*I*A/255,V[z+2]=M+F-2*M*F/255;break;case"tint":V[z]=y+x*G,V[z+1]=I+A*G,V[z+2]=M+F*G}},getUniformLocations:function(_,y){return{uColor:_.getUniformLocation(y,"uColor")}},sendUniformData:function(_,y){var I=new w.Color(this.color).getSource();I[0]=this.alpha*I[0]/255,I[1]=this.alpha*I[1]/255,I[2]=this.alpha*I[2]/255,I[3]=this.alpha,_.uniform4fv(y.uColor,I)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),w.Image.filters.BlendColor.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric,b=w.Image.filters;b.BlendImage=(0,w.util.createClass)(b.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(_){var y=this.type+"_"+this.mode,I=this.fragmentSource[this.mode];return _.programCache.hasOwnProperty(y)||(_.programCache[y]=this.createProgram(_.context,I)),_.programCache[y]},applyToWebGL:function(_){var y=_.context,I=this.createTexture(_.filterBackend,this.image);this.bindAdditionalTexture(y,I,y.TEXTURE1),this.callSuper("applyToWebGL",_),this.unbindAdditionalTexture(y,y.TEXTURE1)},createTexture:function(_,y){return _.getCachedTexture(y.cacheKey,y._element)},calculateMatrix:function(){var _=this.image;return[1/_.scaleX,0,0,0,1/_.scaleY,0,-_.left/_._element.width,-_.top/_._element.height,1]},applyTo2d:function(_){var y,I,M,x,A,F,k,V,H,G,z,Z=_.imageData,ie=_.filterBackend.resources,re=Z.data,de=re.length,ce=Z.width,le=Z.height,ee=this.image;ie.blendImage||(ie.blendImage=w.util.createCanvasElement()),G=(H=ie.blendImage).getContext("2d"),H.width!==ce||H.height!==le?(H.width=ce,H.height=le):G.clearRect(0,0,ce,le),G.setTransform(ee.scaleX,0,0,ee.scaleY,ee.left,ee.top),G.drawImage(ee._element,0,0,ce,le),z=G.getImageData(0,0,ce,le).data;for(var J=0;J<de;J+=4)switch(A=re[J],F=re[J+1],k=re[J+2],V=re[J+3],y=z[J],I=z[J+1],M=z[J+2],x=z[J+3],this.mode){case"multiply":re[J]=A*y/255,re[J+1]=F*I/255,re[J+2]=k*M/255,re[J+3]=V*x/255;break;case"mask":re[J+3]=x}},getUniformLocations:function(_,y){return{uTransformMatrix:_.getUniformLocation(y,"uTransformMatrix"),uImage:_.getUniformLocation(y,"uImage")}},sendUniformData:function(_,y){var I=this.calculateMatrix();_.uniform1i(y.uImage,1),_.uniformMatrix3fv(y.uTransformMatrix,!1,I)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),w.Image.filters.BlendImage.fromObject=function(_,y){w.Image.fromObject(_.image,function(I){var M=w.util.object.clone(_);M.image=I,y(new w.Image.filters.BlendImage(M))})}}(l),function(S){var w=S.fabric||(S.fabric={}),b=Math.pow,T=Math.floor,_=Math.sqrt,y=Math.abs,I=Math.round,M=Math.sin,x=Math.ceil,A=w.Image.filters;A.Resize=(0,w.util.createClass)(A.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(k,V){return{uDelta:k.getUniformLocation(V,"uDelta"),uTaps:k.getUniformLocation(V,"uTaps")}},sendUniformData:function(k,V){k.uniform2fv(V.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),k.uniform1fv(V.uTaps,this.taps)},retrieveShader:function(k){var V=this.getFilterWindow(),H=this.type+"_"+V;if(!k.programCache.hasOwnProperty(H)){var G=this.generateShader(V);k.programCache[H]=this.createProgram(k.context,G)}return k.programCache[H]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var k=this.lanczosCreate(this.lanczosLobes),V=this.tempScale,H=this.getFilterWindow(),G=new Array(H),z=1;z<=H;z++)G[z-1]=k(z*V);return G},generateShader:function(k){for(var V=new Array(k),H=this.fragmentSourceTOP,G=1;G<=k;G++)V[G-1]=G+".0 * uDelta";return H+="uniform float uTaps["+k+"];\n",H+="void main() {\n",H+="  vec4 color = texture2D(uTexture, vTexCoord);\n",H+="  float sum = 1.0;\n",V.forEach(function(z,Z){H+="  color += texture2D(uTexture, vTexCoord + "+z+") * uTaps["+Z+"];\n",H+="  color += texture2D(uTexture, vTexCoord - "+z+") * uTaps["+Z+"];\n",H+="  sum += 2.0 * uTaps["+Z+"];\n"}),H+="  gl_FragColor = color / sum;\n",H+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(k){k.webgl?(k.passes++,this.width=k.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=k.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),k.destinationWidth=this.dW,this._setupFrameBuffer(k),this.applyToWebGL(k),this._swapTextures(k),k.sourceWidth=k.destinationWidth,this.height=k.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),k.destinationHeight=this.dH,this._setupFrameBuffer(k),this.applyToWebGL(k),this._swapTextures(k),k.sourceHeight=k.destinationHeight):this.applyTo2d(k)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(k){return function(V){if(V>=k||V<=-k)return 0;if(V<1.1920929e-7&&V>-1.1920929e-7)return 1;var H=(V*=Math.PI)/k;return M(V)/V*M(H)/H}},applyTo2d:function(k){var V=k.imageData,H=this.scaleX,G=this.scaleY;this.rcpScaleX=1/H,this.rcpScaleY=1/G;var z,Z=V.width,ie=V.height,re=I(Z*H),de=I(ie*G);"sliceHack"===this.resizeType?z=this.sliceByTwo(k,Z,ie,re,de):"hermite"===this.resizeType?z=this.hermiteFastResize(k,Z,ie,re,de):"bilinear"===this.resizeType?z=this.bilinearFiltering(k,Z,ie,re,de):"lanczos"===this.resizeType&&(z=this.lanczosResize(k,Z,ie,re,de)),k.imageData=z},sliceByTwo:function(k,V,H,G,z){var Z,ie,re=k.imageData,ce=!1,le=!1,ee=.5*V,J=.5*H,se=w.filterBackend.resources,he=0,fe=0,ne=V,te=0;for(se.sliceByTwo||(se.sliceByTwo=document.createElement("canvas")),((Z=se.sliceByTwo).width<1.5*V||Z.height<H)&&(Z.width=1.5*V,Z.height=H),(ie=Z.getContext("2d")).clearRect(0,0,1.5*V,H),ie.putImageData(re,0,0),G=T(G),z=T(z);!ce||!le;)V=ee,H=J,G<T(.5*ee)?ee=T(.5*ee):(ee=G,ce=!0),z<T(.5*J)?J=T(.5*J):(J=z,le=!0),ie.drawImage(Z,he,fe,V,H,ne,te,ee,J),he=ne,fe=te,te+=J;return ie.getImageData(he,fe,G,z)},lanczosResize:function(k,V,H,G,z){var Z=k.imageData.data,ie=k.ctx.createImageData(G,z),re=ie.data,de=this.lanczosCreate(this.lanczosLobes),ce=this.rcpScaleX,le=this.rcpScaleY,ee=2/this.rcpScaleX,J=2/this.rcpScaleY,se=x(ce*this.lanczosLobes/2),he=x(le*this.lanczosLobes/2),fe={},ne={},te={};return function ae(ge){var ue,me,Ie,be,Ce,Se,De,xe,Ve,Me,ot;for(ne.x=(ge+.5)*ce,te.x=T(ne.x),ue=0;ue<z;ue++){for(ne.y=(ue+.5)*le,te.y=T(ne.y),Ce=0,Se=0,De=0,xe=0,Ve=0,me=te.x-se;me<=te.x+se;me++)if(!(me<0||me>=V)){Me=T(1e3*y(me-ne.x)),fe[Me]||(fe[Me]={});for(var It=te.y-he;It<=te.y+he;It++)It<0||It>=H||(ot=T(1e3*y(It-ne.y)),fe[Me][ot]||(fe[Me][ot]=de(_(b(Me*ee,2)+b(ot*J,2))/1e3)),(Ie=fe[Me][ot])>0&&(Ce+=Ie,Se+=Ie*Z[be=4*(It*V+me)],De+=Ie*Z[be+1],xe+=Ie*Z[be+2],Ve+=Ie*Z[be+3]))}re[be=4*(ue*G+ge)]=Se/Ce,re[be+1]=De/Ce,re[be+2]=xe/Ce,re[be+3]=Ve/Ce}return++ge<G?ae(ge):ie}(0)},bilinearFiltering:function(k,V,H,G,z){var Z,ie,re,de,ce,le,ee,se,he=0,fe=this.rcpScaleX,ne=this.rcpScaleY,te=4*(V-1),ae=k.imageData.data,ge=k.ctx.createImageData(G,z),ue=ge.data;for(re=0;re<z;re++)for(de=0;de<G;de++)for(ce=fe*de-(Z=T(fe*de)),le=ne*re-(ie=T(ne*re)),se=4*(ie*V+Z),ee=0;ee<4;ee++)ue[he++]=ae[se+ee]*(1-ce)*(1-le)+ae[se+4+ee]*ce*(1-le)+ae[se+te+ee]*le*(1-ce)+ae[se+te+4+ee]*ce*le;return ge},hermiteFastResize:function(k,V,H,G,z){for(var Z=this.rcpScaleX,ie=this.rcpScaleY,re=x(Z/2),de=x(ie/2),ce=k.imageData.data,le=k.ctx.createImageData(G,z),ee=le.data,J=0;J<z;J++)for(var se=0;se<G;se++){for(var he=4*(se+J*G),fe=0,ne=0,te=0,ae=0,ge=0,ue=0,me=0,Ie=(J+.5)*ie,be=T(J*ie);be<(J+1)*ie;be++)for(var Ce=y(Ie-(be+.5))/de,Se=(se+.5)*Z,De=Ce*Ce,xe=T(se*Z);xe<(se+1)*Z;xe++){var Ve=y(Se-(xe+.5))/re,Me=_(De+Ve*Ve);Me>1&&Me<-1||(fe=2*Me*Me*Me-3*Me*Me+1)>0&&(me+=fe*ce[3+(Ve=4*(xe+be*V))],te+=fe,ce[Ve+3]<255&&(fe=fe*ce[Ve+3]/250),ae+=fe*ce[Ve],ge+=fe*ce[Ve+1],ue+=fe*ce[Ve+2],ne+=fe)}ee[he]=ae/ne,ee[he+1]=ge/ne,ee[he+2]=ue/ne,ee[he+3]=me/te}return le},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),w.Image.filters.Resize.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Contrast=(0,w.util.createClass)(b.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(_){if(0!==this.contrast){var y,I=_.imageData.data,M=I.length,x=Math.floor(255*this.contrast),A=259*(x+255)/(255*(259-x));for(y=0;y<M;y+=4)I[y]=A*(I[y]-128)+128,I[y+1]=A*(I[y+1]-128)+128,I[y+2]=A*(I[y+2]-128)+128}},getUniformLocations:function(_,y){return{uContrast:_.getUniformLocation(y,"uContrast")}},sendUniformData:function(_,y){_.uniform1f(y.uContrast,this.contrast)}}),w.Image.filters.Contrast.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Saturation=(0,w.util.createClass)(b.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(_){if(0!==this.saturation){var y,I,M=_.imageData.data,x=M.length,A=-this.saturation;for(y=0;y<x;y+=4)I=Math.max(M[y],M[y+1],M[y+2]),M[y]+=I!==M[y]?(I-M[y])*A:0,M[y+1]+=I!==M[y+1]?(I-M[y+1])*A:0,M[y+2]+=I!==M[y+2]?(I-M[y+2])*A:0}},getUniformLocations:function(_,y){return{uSaturation:_.getUniformLocation(y,"uSaturation")}},sendUniformData:function(_,y){_.uniform1f(y.uSaturation,-this.saturation)}}),w.Image.filters.Saturation.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Vibrance=(0,w.util.createClass)(b.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(_){if(0!==this.vibrance){var y,I,x,A=_.imageData.data,F=A.length,k=-this.vibrance;for(y=0;y<F;y+=4)I=Math.max(A[y],A[y+1],A[y+2]),x=2*Math.abs(I-(A[y]+A[y+1]+A[y+2])/3)/255*k,A[y]+=I!==A[y]?(I-A[y])*x:0,A[y+1]+=I!==A[y+1]?(I-A[y+1])*x:0,A[y+2]+=I!==A[y+2]?(I-A[y+2])*x:0}},getUniformLocations:function(_,y){return{uVibrance:_.getUniformLocation(y,"uVibrance")}},sendUniformData:function(_,y){_.uniform1f(y.uVibrance,-this.vibrance)}}),w.Image.filters.Vibrance.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Blur=(0,w.util.createClass)(b.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(_){_.webgl?(this.aspectRatio=_.sourceWidth/_.sourceHeight,_.passes++,this._setupFrameBuffer(_),this.horizontal=!0,this.applyToWebGL(_),this._swapTextures(_),this._setupFrameBuffer(_),this.horizontal=!1,this.applyToWebGL(_),this._swapTextures(_)):this.applyTo2d(_)},applyTo2d:function(_){_.imageData=this.simpleBlur(_)},simpleBlur:function(_){var y,I,M=_.filterBackend.resources,x=_.imageData.width,A=_.imageData.height;M.blurLayer1||(M.blurLayer1=w.util.createCanvasElement(),M.blurLayer2=w.util.createCanvasElement()),I=M.blurLayer2,(y=M.blurLayer1).width===x&&y.height===A||(I.width=y.width=x,I.height=y.height=A);var F,k,V,H,G=y.getContext("2d"),z=I.getContext("2d"),Z=.06*this.blur*.5;for(G.putImageData(_.imageData,0,0),z.clearRect(0,0,x,A),H=-15;H<=15;H++)V=Z*(k=H/15)*x+(F=(Math.random()-.5)/4),z.globalAlpha=1-Math.abs(k),z.drawImage(y,V,F),G.drawImage(I,0,0),z.globalAlpha=1,z.clearRect(0,0,I.width,I.height);for(H=-15;H<=15;H++)V=Z*(k=H/15)*A+(F=(Math.random()-.5)/4),z.globalAlpha=1-Math.abs(k),z.drawImage(y,F,V),G.drawImage(I,0,0),z.globalAlpha=1,z.clearRect(0,0,I.width,I.height);_.ctx.drawImage(y,0,0);var ie=_.ctx.getImageData(0,0,y.width,y.height);return G.globalAlpha=1,G.clearRect(0,0,y.width,y.height),ie},getUniformLocations:function(_,y){return{delta:_.getUniformLocation(y,"uDelta")}},sendUniformData:function(_,y){var I=this.chooseRightDelta();_.uniform2fv(y.delta,I)},chooseRightDelta:function(){var _,y=1,I=[0,0];return this.horizontal?this.aspectRatio>1&&(y=1/this.aspectRatio):this.aspectRatio<1&&(y=this.aspectRatio),_=y*this.blur*.12,this.horizontal?I[0]=_:I[1]=_,I}}),b.Blur.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Gamma=(0,w.util.createClass)(b.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(_){this.gamma=[1,1,1],b.BaseFilter.prototype.initialize.call(this,_)},applyTo2d:function(_){var y,I=_.imageData.data,M=this.gamma,x=I.length,A=1/M[0],F=1/M[1],k=1/M[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),y=0,x=256;y<x;y++)this.rVals[y]=255*Math.pow(y/255,A),this.gVals[y]=255*Math.pow(y/255,F),this.bVals[y]=255*Math.pow(y/255,k);for(y=0,x=I.length;y<x;y+=4)I[y]=this.rVals[I[y]],I[y+1]=this.gVals[I[y+1]],I[y+2]=this.bVals[I[y+2]]},getUniformLocations:function(_,y){return{uGamma:_.getUniformLocation(y,"uGamma")}},sendUniformData:function(_,y){_.uniform3fv(y.uGamma,this.gamma)}}),w.Image.filters.Gamma.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.Composed=(0,w.util.createClass)(b.BaseFilter,{type:"Composed",subFilters:[],initialize:function(_){this.callSuper("initialize",_),this.subFilters=this.subFilters.slice(0)},applyTo:function(_){_.passes+=this.subFilters.length-1,this.subFilters.forEach(function(y){y.applyTo(_)})},toObject:function(){return w.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(_){return _.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(_){return!_.isNeutralState()})}}),w.Image.filters.Composed.fromObject=function(_,y){var I=(_.subFilters||[]).map(function(x){return new w.Image.filters[x.type](x)}),M=new w.Image.filters.Composed({subFilters:I});return y&&y(M),M}}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.Image.filters;b.HueRotation=(0,w.util.createClass)(b.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var _=this.rotation*Math.PI,y=w.util.cos(_),I=w.util.sin(_),M=1/3,x=Math.sqrt(M)*I,A=1-y;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=y+A/3,this.matrix[1]=M*A-x,this.matrix[2]=M*A+x,this.matrix[5]=M*A+x,this.matrix[6]=y+M*A,this.matrix[7]=M*A-x,this.matrix[10]=M*A-x,this.matrix[11]=M*A+x,this.matrix[12]=y+M*A},isNeutralState:function(_){return this.calculateMatrix(),b.BaseFilter.prototype.isNeutralState.call(this,_)},applyTo:function(_){this.calculateMatrix(),b.BaseFilter.prototype.applyTo.call(this,_)}}),w.Image.filters.HueRotation.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),b=w.util.object.clone;if(w.Text)w.warn("fabric.Text is already defined");else{var T="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");w.Text=w.util.createClass(w.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:w.Object.prototype.stateProperties.concat(T),cacheProperties:w.Object.prototype.cacheProperties.concat(T),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(_,y){this.styles=y&&y.styles||{},this.text=_,this.__skipDimension=!0,this.callSuper("initialize",y),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var _=this.path;_&&(_.segmentsInfo=w.util.getPathSegmentsInfo(_.path))},getMeasuringContext:function(){return w._measuringContext||(w._measuringContext=this.canvas&&this.canvas.contextCache||w.util.createCanvasElement().getContext("2d")),w._measuringContext},_splitText:function(){var _=this._splitTextIntoLines(this.text);return this.textLines=_.lines,this._textLines=_.graphemeLines,this._unwrappedTextLines=_._unwrappedLines,this._text=_.graphemeText,_},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var _,y,M,x,A,F,k=0,V=this._textLines.length;k<V;k++)if(("justify"===this.textAlign||k!==V-1&&!this.isEndOfWrapping(k))&&(M=0,x=this._textLines[k],(y=this.getLineWidth(k))<this.width&&(F=this.textLines[k].match(this._reSpacesAndTabs)))){_=(this.width-y)/F.length;for(var H=0,G=x.length;H<=G;H++)A=this.__charBounds[k][H],this._reSpaceAndTab.test(x[H])?(A.width+=_,A.kernedWidth+=_,A.left+=M,M+=_):A.left+=M}},isEndOfWrapping:function(_){return _===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var _=this.callSuper("_getCacheCanvasDimensions"),y=this.fontSize;return _.width+=y*_.zoomX,_.height+=y*_.zoomY,_},_render:function(_){var y=this.path;y&&!y.isNotVisible()&&y._render(_),this._setTextStyles(_),this._renderTextLinesBackground(_),this._renderTextDecoration(_,"underline"),this._renderText(_),this._renderTextDecoration(_,"overline"),this._renderTextDecoration(_,"linethrough")},_renderText:function(_){"stroke"===this.paintFirst?(this._renderTextStroke(_),this._renderTextFill(_)):(this._renderTextFill(_),this._renderTextStroke(_))},_setTextStyles:function(_,y,I){if(_.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":_.textBaseline="middle";break;case"ascender":_.textBaseline="top";break;case"descender":_.textBaseline="bottom"}_.font=this._getFontDeclaration(y,I)},calcTextWidth:function(){for(var _=this.getLineWidth(0),y=1,I=this._textLines.length;y<I;y++){var M=this.getLineWidth(y);M>_&&(_=M)}return _},_renderTextLine:function(_,y,I,M,x,A){this._renderChars(_,y,I,M,x,A)},_renderTextLinesBackground:function(_){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var y,I,M,x,A,F,k,V=_.fillStyle,H=this._getLeftOffset(),G=this._getTopOffset(),z=0,Z=0,ie=this.path,re=0,de=this._textLines.length;re<de;re++)if(y=this.getHeightOfLine(re),this.textBackgroundColor||this.styleHas("textBackgroundColor",re)){M=this._textLines[re],I=this._getLineLeftOffset(re),Z=0,z=0,x=this.getValueOfPropertyAt(re,0,"textBackgroundColor");for(var ce=0,le=M.length;ce<le;ce++)A=this.__charBounds[re][ce],F=this.getValueOfPropertyAt(re,ce,"textBackgroundColor"),ie?(_.save(),_.translate(A.renderLeft,A.renderTop),_.rotate(A.angle),_.fillStyle=F,F&&_.fillRect(-A.width/2,-y/this.lineHeight*(1-this._fontSizeFraction),A.width,y/this.lineHeight),_.restore()):F!==x?(k=H+I+z,"rtl"===this.direction&&(k=this.width-k-Z),_.fillStyle=x,x&&_.fillRect(k,G,Z,y/this.lineHeight),z=A.left,Z=A.width,x=F):Z+=A.kernedWidth;F&&!ie&&(k=H+I+z,"rtl"===this.direction&&(k=this.width-k-Z),_.fillStyle=F,_.fillRect(k,G,Z,y/this.lineHeight)),G+=y}else G+=y;_.fillStyle=V,this._removeShadow(_)}},getFontCache:function(_){var y=_.fontFamily.toLowerCase();w.charWidthsCache[y]||(w.charWidthsCache[y]={});var I=w.charWidthsCache[y],M=_.fontStyle.toLowerCase()+"_"+(_.fontWeight+"").toLowerCase();return I[M]||(I[M]={}),I[M]},_measureChar:function(_,y,I,M){var x,A,F,k,V=this.getFontCache(y),H=I+_,G=this._getFontDeclaration(y)===this._getFontDeclaration(M),z=y.fontSize/this.CACHE_FONT_SIZE;if(I&&void 0!==V[I]&&(F=V[I]),void 0!==V[_]&&(k=x=V[_]),G&&void 0!==V[H]&&(k=(A=V[H])-F),void 0===x||void 0===F||void 0===A){var Z=this.getMeasuringContext();this._setTextStyles(Z,y,!0)}return void 0===x&&(k=x=Z.measureText(_).width,V[_]=x),void 0===F&&G&&I&&(F=Z.measureText(I).width,V[I]=F),G&&void 0===A&&(A=Z.measureText(H).width,V[H]=A,k=A-F),{width:x*z,kernedWidth:k*z}},getHeightOfChar:function(_,y){return this.getValueOfPropertyAt(_,y,"fontSize")},measureLine:function(_){var y=this._measureLine(_);return 0!==this.charSpacing&&(y.width-=this._getWidthOfCharSpacing()),y.width<0&&(y.width=0),y},_measureLine:function(_){var y,I,M,x,A,F,k=0,V=this._textLines[_],H=new Array(V.length),G=0,z=this.path,Z="right"===this.pathSide;for(this.__charBounds[_]=H,y=0;y<V.length;y++)x=this._getGraphemeBox(I=V[y],_,y,M),H[y]=x,k+=x.kernedWidth,M=I;if(H[y]={left:x?x.left+x.width:0,width:0,kernedWidth:0,height:this.fontSize},z){switch(F=z.segmentsInfo[z.segmentsInfo.length-1].length,(A=w.util.getPointOnPath(z.path,0,z.segmentsInfo)).x+=z.pathOffset.x,A.y+=z.pathOffset.y,this.textAlign){case"left":G=Z?F-k:0;break;case"center":G=(F-k)/2;break;case"right":G=Z?0:F-k}for(G+=this.pathStartOffset*(Z?-1:1),y=Z?V.length-1:0;Z?y>=0:y<V.length;Z?y--:y++)G>F?G%=F:G<0&&(G+=F),this._setGraphemeOnPath(G,x=H[y],A),G+=x.kernedWidth}return{width:k,numOfSpaces:0}},_setGraphemeOnPath:function(_,y,I){var x=this.path,A=w.util.getPointOnPath(x.path,_+y.kernedWidth/2,x.segmentsInfo);y.renderLeft=A.x-I.x,y.renderTop=A.y-I.y,y.angle=A.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(_,y,I,M,x){var A,F=this.getCompleteStyleDeclaration(y,I),k=M?this.getCompleteStyleDeclaration(y,I-1):{},V=this._measureChar(_,F,M,k),H=V.kernedWidth,G=V.width;0!==this.charSpacing&&(G+=A=this._getWidthOfCharSpacing(),H+=A);var z={width:G,left:0,height:F.fontSize,kernedWidth:H,deltaY:F.deltaY};if(I>0&&!x){var Z=this.__charBounds[y][I-1];z.left=Z.left+Z.width+V.kernedWidth-V.width}return z},getHeightOfLine:function(_){if(this.__lineHeights[_])return this.__lineHeights[_];for(var y=this._textLines[_],I=this.getHeightOfChar(_,0),M=1,x=y.length;M<x;M++)I=Math.max(this.getHeightOfChar(_,M),I);return this.__lineHeights[_]=I*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var _,y=0,I=0,M=this._textLines.length;I<M;I++)_=this.getHeightOfLine(I),y+=I===M-1?_/this.lineHeight:_;return y},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(_,y){_.save();for(var I=0,M=this._getLeftOffset(),x=this._getTopOffset(),A=0,F=this._textLines.length;A<F;A++){var k=this.getHeightOfLine(A),V=k/this.lineHeight,H=this._getLineLeftOffset(A);this._renderTextLine(y,_,this._textLines[A],M+H,x+I+V,A),I+=k}_.restore()},_renderTextFill:function(_){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(_,"fillText")},_renderTextStroke:function(_){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(_),_.save(),this._setLineDash(_,this.strokeDashArray),_.beginPath(),this._renderTextCommon(_,"strokeText"),_.closePath(),_.restore())},_renderChars:function(_,y,I,M,x,A){var F,k,V,H,z=this.getHeightOfLine(A),Z=-1!==this.textAlign.indexOf("justify"),ie="",re=0,de=this.path,ce=!Z&&0===this.charSpacing&&this.isEmptyStyles(A)&&!de,le="ltr"===this.direction,ee="ltr"===this.direction?1:-1,J=y.canvas.getAttribute("dir");if(y.save(),J!==this.direction&&(y.canvas.setAttribute("dir",le?"ltr":"rtl"),y.direction=le?"ltr":"rtl",y.textAlign=le?"left":"right"),x-=z*this._fontSizeFraction/this.lineHeight,ce)return this._renderChar(_,y,A,0,I.join(""),M,x,z),void y.restore();for(var se=0,he=I.length-1;se<=he;se++)H=se===he||this.charSpacing||de,ie+=I[se],V=this.__charBounds[A][se],0===re?(M+=ee*(V.kernedWidth-V.width),re+=V.width):re+=V.kernedWidth,Z&&!H&&this._reSpaceAndTab.test(I[se])&&(H=!0),H||(F=F||this.getCompleteStyleDeclaration(A,se),k=this.getCompleteStyleDeclaration(A,se+1),H=this._hasStyleChanged(F,k)),H&&(de?(y.save(),y.translate(V.renderLeft,V.renderTop),y.rotate(V.angle),this._renderChar(_,y,A,se,ie,-re/2,0,z),y.restore()):this._renderChar(_,y,A,se,ie,M,x,z),ie="",F=k,M+=ee*re,re=0);y.restore()},_applyPatternGradientTransformText:function(_){var y,I=w.util.createCanvasElement(),M=this.width+this.strokeWidth,x=this.height+this.strokeWidth;return I.width=M,I.height=x,(y=I.getContext("2d")).beginPath(),y.moveTo(0,0),y.lineTo(M,0),y.lineTo(M,x),y.lineTo(0,x),y.closePath(),y.translate(M/2,x/2),y.fillStyle=_.toLive(y),this._applyPatternGradientTransform(y,_),y.fill(),y.createPattern(I,"no-repeat")},handleFiller:function(_,y,I){var M,x;return I.toLive?"percentage"===I.gradientUnits||I.gradientTransform||I.patternTransform?(_.translate(M=-this.width/2,x=-this.height/2),_[y]=this._applyPatternGradientTransformText(I),{offsetX:M,offsetY:x}):(_[y]=I.toLive(_,this),this._applyPatternGradientTransform(_,I)):(_[y]=I,{offsetX:0,offsetY:0})},_setStrokeStyles:function(_,y){return _.lineWidth=y.strokeWidth,_.lineCap=this.strokeLineCap,_.lineDashOffset=this.strokeDashOffset,_.lineJoin=this.strokeLineJoin,_.miterLimit=this.strokeMiterLimit,this.handleFiller(_,"strokeStyle",y.stroke)},_setFillStyles:function(_,y){return this.handleFiller(_,"fillStyle",y.fill)},_renderChar:function(_,y,I,M,x,A,F){var k,V,H=this._getStyleDeclaration(I,M),G=this.getCompleteStyleDeclaration(I,M),z="fillText"===_&&G.fill,Z="strokeText"===_&&G.stroke&&G.strokeWidth;(Z||z)&&(y.save(),z&&(k=this._setFillStyles(y,G)),Z&&(V=this._setStrokeStyles(y,G)),y.font=this._getFontDeclaration(G),H&&H.textBackgroundColor&&this._removeShadow(y),H&&H.deltaY&&(F+=H.deltaY),z&&y.fillText(x,A-k.offsetX,F-k.offsetY),Z&&y.strokeText(x,A-V.offsetX,F-V.offsetY),y.restore())},setSuperscript:function(_,y){return this._setScript(_,y,this.superscript)},setSubscript:function(_,y){return this._setScript(_,y,this.subscript)},_setScript:function(_,y,I){var M=this.get2DCursorLocation(_,!0),x=this.getValueOfPropertyAt(M.lineIndex,M.charIndex,"fontSize"),A=this.getValueOfPropertyAt(M.lineIndex,M.charIndex,"deltaY");return this.setSelectionStyles({fontSize:x*I.size,deltaY:A+x*I.baseline},_,y),this},_hasStyleChanged:function(_,y){return _.fill!==y.fill||_.stroke!==y.stroke||_.strokeWidth!==y.strokeWidth||_.fontSize!==y.fontSize||_.fontFamily!==y.fontFamily||_.fontWeight!==y.fontWeight||_.fontStyle!==y.fontStyle||_.deltaY!==y.deltaY},_hasStyleChangedForSvg:function(_,y){return this._hasStyleChanged(_,y)||_.overline!==y.overline||_.underline!==y.underline||_.linethrough!==y.linethrough},_getLineLeftOffset:function(_){var y=this.getLineWidth(_),I=this.width-y,M=this.textAlign,x=this.direction,A=0,F=this.isEndOfWrapping(_);return"justify"===M||"justify-center"===M&&!F||"justify-right"===M&&!F||"justify-left"===M&&!F?0:("center"===M&&(A=I/2),"right"===M&&(A=I),"justify-center"===M&&(A=I/2),"justify-right"===M&&(A=I),"rtl"===x&&(A-=I),A)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var _=this._forceClearCache;return _||(_=this.hasStateChanged("_dimensionAffectingProps")),_&&(this.dirty=!0,this._forceClearCache=!1),_},getLineWidth:function(_){if(void 0!==this.__lineWidths[_])return this.__lineWidths[_];var y=this.measureLine(_).width;return this.__lineWidths[_]=y,y},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(_,y,I){var M=this._getStyleDeclaration(_,y);return M&&void 0!==M[I]?M[I]:this[I]},_renderTextDecoration:function(_,y){if(this[y]||this.styleHas(y)){for(var I,M,x,A,F,k,V,H,G,z,Z,ie,re,de,ce,le,ee=this._getLeftOffset(),J=this._getTopOffset(),se=this.path,he=this._getWidthOfCharSpacing(),fe=this.offsets[y],ne=0,te=this._textLines.length;ne<te;ne++)if(I=this.getHeightOfLine(ne),this[y]||this.styleHas(y,ne)){V=this._textLines[ne],de=I/this.lineHeight,A=this._getLineLeftOffset(ne),z=0,Z=0,H=this.getValueOfPropertyAt(ne,0,y),le=this.getValueOfPropertyAt(ne,0,"fill"),G=J+de*(1-this._fontSizeFraction),M=this.getHeightOfChar(ne,0),F=this.getValueOfPropertyAt(ne,0,"deltaY");for(var ae=0,ge=V.length;ae<ge;ae++)if(ie=this.__charBounds[ne][ae],re=this.getValueOfPropertyAt(ne,ae,y),ce=this.getValueOfPropertyAt(ne,ae,"fill"),x=this.getHeightOfChar(ne,ae),k=this.getValueOfPropertyAt(ne,ae,"deltaY"),se&&re&&ce)_.save(),_.fillStyle=le,_.translate(ie.renderLeft,ie.renderTop),_.rotate(ie.angle),_.fillRect(-ie.kernedWidth/2,fe*x+k,ie.kernedWidth,this.fontSize/15),_.restore();else if((re!==H||ce!==le||x!==M||k!==F)&&Z>0){var ue=ee+A+z;"rtl"===this.direction&&(ue=this.width-ue-Z),H&&le&&(_.fillStyle=le,_.fillRect(ue,G+fe*M+F,Z,this.fontSize/15)),z=ie.left,Z=ie.width,H=re,le=ce,M=x,F=k}else Z+=ie.kernedWidth;ue=ee+A+z,"rtl"===this.direction&&(ue=this.width-ue-Z),_.fillStyle=ce,re&&ce&&_.fillRect(ue,G+fe*M+F,Z-he,this.fontSize/15),J+=I}else J+=I;this._removeShadow(_)}},_getFontDeclaration:function(_,y){var I=_||this,M=this.fontFamily,x=w.Text.genericFonts.indexOf(M.toLowerCase())>-1,A=void 0===M||M.indexOf("'")>-1||M.indexOf(",")>-1||M.indexOf('"')>-1||x?I.fontFamily:'"'+I.fontFamily+'"';return[w.isLikelyNode?I.fontWeight:I.fontStyle,w.isLikelyNode?I.fontStyle:I.fontWeight,y?this.CACHE_FONT_SIZE+"px":I.fontSize+"px",A].join(" ")},render:function(_){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",_)))},_splitTextIntoLines:function(_){for(var y=_.split(this._reNewline),I=new Array(y.length),M=["\n"],x=[],A=0;A<y.length;A++)I[A]=w.util.string.graphemeSplit(y[A]),x=x.concat(I[A],M);return x.pop(),{_unwrappedLines:I,lines:y,graphemeText:x,graphemeLines:I}},toObject:function(_){var y=T.concat(_),I=this.callSuper("toObject",y);return I.styles=b(this.styles,!0),I.path&&(I.path=this.path.toObject()),I},set:function(_,y){this.callSuper("set",_,y);var I=!1,M=!1;if("object"==typeof _)for(var x in _)"path"===x&&this.setPathInfo(),I=I||-1!==this._dimensionAffectingProps.indexOf(x),M=M||"path"===x;else I=-1!==this._dimensionAffectingProps.indexOf(_),M="path"===_;return M&&this.setPathInfo(),I&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),w.Text.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),w.Text.DEFAULT_SVG_FONT_SIZE=16,w.Text.fromElement=function(_,y,I){if(!_)return y(null);var M=w.parseAttributes(_,w.Text.ATTRIBUTE_NAMES),x=M.textAnchor||"left";if((I=w.util.object.extend(I?b(I):{},M)).top=I.top||0,I.left=I.left||0,M.textDecoration){var A=M.textDecoration;-1!==A.indexOf("underline")&&(I.underline=!0),-1!==A.indexOf("overline")&&(I.overline=!0),-1!==A.indexOf("line-through")&&(I.linethrough=!0),delete I.textDecoration}"dx"in M&&(I.left+=M.dx),"dy"in M&&(I.top+=M.dy),"fontSize"in I||(I.fontSize=w.Text.DEFAULT_SVG_FONT_SIZE);var F="";"textContent"in _?F=_.textContent:"firstChild"in _&&null!==_.firstChild&&"data"in _.firstChild&&null!==_.firstChild.data&&(F=_.firstChild.data),F=F.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var k=I.strokeWidth;I.strokeWidth=0;var V=new w.Text(F,I),H=V.getScaledHeight()/V.height,G=((V.height+V.strokeWidth)*V.lineHeight-V.height)*H,z=V.getScaledHeight()+G,Z=0;"center"===x&&(Z=V.getScaledWidth()/2),"right"===x&&(Z=V.getScaledWidth()),V.set({left:V.left-Z,top:V.top-(z-V.fontSize*(.07+V._fontSizeFraction))/V.lineHeight,strokeWidth:void 0!==k?k:1}),y(V)},w.Text.fromObject=function(_,y){var I=b(_),M=_.path;return delete I.path,w.Object._fromObject("Text",I,function(x){M?w.Object._fromObject("Path",M,function(A){x.set("path",A),y(x)},"path"):y(x)},"text")},w.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],w.util.createAccessors&&w.util.createAccessors(w.Text)}}(l),P.util.object.extend(P.Text.prototype,{isEmptyStyles:function(S){if(!this.styles||void 0!==S&&!this.styles[S])return!0;var w=void 0===S?this.styles:{line:this.styles[S]};for(var b in w)for(var T in w[b])for(var _ in w[b][T])return!1;return!0},styleHas:function(S,w){if(!this.styles||!S||""===S||void 0!==w&&!this.styles[w])return!1;var b=void 0===w?this.styles:{0:this.styles[w]};for(var T in b)for(var _ in b[T])if(void 0!==b[T][_][S])return!0;return!1},cleanStyle:function(S){if(!this.styles||!S||""===S)return!1;var w,b,T=this.styles,_=0,y=!0,I=0;for(var M in T){for(var x in w=0,T[M]){var A;_++,(A=T[M][x]).hasOwnProperty(S)?(b?A[S]!==b&&(y=!1):b=A[S],A[S]===this[S]&&delete A[S]):y=!1,0!==Object.keys(A).length?w++:delete T[M][x]}0===w&&delete T[M]}for(var F=0;F<this._textLines.length;F++)I+=this._textLines[F].length;y&&_===I&&(this[S]=b,this.removeStyle(S))},removeStyle:function(S){if(this.styles&&S&&""!==S){var w,b,T,_=this.styles;for(b in _){for(T in w=_[b])delete w[T][S],0===Object.keys(w[T]).length&&delete w[T];0===Object.keys(w).length&&delete _[b]}}},_extendStyles:function(S,w){var b=this.get2DCursorLocation(S);this._getLineStyle(b.lineIndex)||this._setLineStyle(b.lineIndex),this._getStyleDeclaration(b.lineIndex,b.charIndex)||this._setStyleDeclaration(b.lineIndex,b.charIndex,{}),P.util.object.extend(this._getStyleDeclaration(b.lineIndex,b.charIndex),w)},get2DCursorLocation:function(S,w){void 0===S&&(S=this.selectionStart);for(var b=w?this._unwrappedTextLines:this._textLines,T=b.length,_=0;_<T;_++){if(S<=b[_].length)return{lineIndex:_,charIndex:S};S-=b[_].length+this.missingNewlineOffset(_)}return{lineIndex:_-1,charIndex:b[_-1].length<S?b[_-1].length:S}},getSelectionStyles:function(S,w,b){void 0===S&&(S=this.selectionStart||0),void 0===w&&(w=this.selectionEnd||S);for(var T=[],_=S;_<w;_++)T.push(this.getStyleAtPosition(_,b));return T},getStyleAtPosition:function(S,w){var b=this.get2DCursorLocation(S);return(w?this.getCompleteStyleDeclaration(b.lineIndex,b.charIndex):this._getStyleDeclaration(b.lineIndex,b.charIndex))||{}},setSelectionStyles:function(S,w,b){void 0===w&&(w=this.selectionStart||0),void 0===b&&(b=this.selectionEnd||w);for(var T=w;T<b;T++)this._extendStyles(T,S);return this._forceClearCache=!0,this},_getStyleDeclaration:function(S,w){var b=this.styles&&this.styles[S];return b?b[w]:null},getCompleteStyleDeclaration:function(S,w){for(var b,T=this._getStyleDeclaration(S,w)||{},_={},y=0;y<this._styleProperties.length;y++)_[b=this._styleProperties[y]]=void 0===T[b]?this[b]:T[b];return _},_setStyleDeclaration:function(S,w,b){this.styles[S][w]=b},_deleteStyleDeclaration:function(S,w){delete this.styles[S][w]},_getLineStyle:function(S){return!!this.styles[S]},_setLineStyle:function(S){this.styles[S]={}},_deleteLineStyle:function(S){delete this.styles[S]}}),function(){function S(w){w.textDecoration&&(w.textDecoration.indexOf("underline")>-1&&(w.underline=!0),w.textDecoration.indexOf("line-through")>-1&&(w.linethrough=!0),w.textDecoration.indexOf("overline")>-1&&(w.overline=!0),delete w.textDecoration)}P.IText=P.util.createClass(P.Text,P.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(w,b){this.callSuper("initialize",w,b),this.initBehavior()},setSelectionStart:function(w){w=Math.max(w,0),this._updateAndFire("selectionStart",w)},setSelectionEnd:function(w){w=Math.min(w,this.text.length),this._updateAndFire("selectionEnd",w)},_updateAndFire:function(w,b){this[w]!==b&&(this._fireSelectionChanged(),this[w]=b),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(w){this.clearContextTop(),this.callSuper("render",w),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(w){this.callSuper("_render",w)},clearContextTop:function(w){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var b=this.canvas.contextTop,T=this.canvas.viewportTransform;b.save(),b.transform(T[0],T[1],T[2],T[3],T[4],T[5]),this.transform(b),this._clearTextArea(b),w||b.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var w=this._getCursorBoundaries(),b=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(w,b):this.renderSelection(w,b),b.restore()}},_clearTextArea:function(w){var b=this.width+4,T=this.height+4;w.clearRect(-b/2,-T/2,b,T)},_getCursorBoundaries:function(w){void 0===w&&(w=this.selectionStart);var b=this._getLeftOffset(),T=this._getTopOffset(),_=this._getCursorBoundariesOffsets(w);return{left:b,top:T,leftOffset:_.left,topOffset:_.top}},_getCursorBoundariesOffsets:function(w){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var b,T,_,y,I=0,M=0,x=this.get2DCursorLocation(w);_=x.charIndex,T=x.lineIndex;for(var A=0;A<T;A++)I+=this.getHeightOfLine(A);b=this._getLineLeftOffset(T);var F=this.__charBounds[T][_];return F&&(M=F.left),0!==this.charSpacing&&_===this._textLines[T].length&&(M-=this._getWidthOfCharSpacing()),y={top:I,left:b+(M>0?M:0)},"rtl"===this.direction&&(y.left*=-1),this.cursorOffsetCache=y,this.cursorOffsetCache},renderCursor:function(w,b){var T=this.get2DCursorLocation(),_=T.lineIndex,y=T.charIndex>0?T.charIndex-1:0,I=this.getValueOfPropertyAt(_,y,"fontSize"),M=this.scaleX*this.canvas.getZoom(),x=this.cursorWidth/M,A=w.topOffset,F=this.getValueOfPropertyAt(_,y,"deltaY");A+=(1-this._fontSizeFraction)*this.getHeightOfLine(_)/this.lineHeight-I*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(w,b),b.fillStyle=this.cursorColor||this.getValueOfPropertyAt(_,y,"fill"),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(w.left+w.leftOffset-x/2,A+w.top+F,x,I)},renderSelection:function(w,b){for(var T=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,_=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,y=-1!==this.textAlign.indexOf("justify"),I=this.get2DCursorLocation(T),M=this.get2DCursorLocation(_),x=I.lineIndex,A=M.lineIndex,F=I.charIndex<0?0:I.charIndex,k=M.charIndex<0?0:M.charIndex,V=x;V<=A;V++){var H,G=this._getLineLeftOffset(V)||0,z=this.getHeightOfLine(V),Z=0,ie=0;if(V===x&&(Z=this.__charBounds[x][F].left),V>=x&&V<A)ie=y&&!this.isEndOfWrapping(V)?this.width:this.getLineWidth(V)||5;else if(V===A)if(0===k)ie=this.__charBounds[A][k].left;else{var re=this._getWidthOfCharSpacing();ie=this.__charBounds[A][k-1].left+this.__charBounds[A][k-1].width-re}H=z,(this.lineHeight<1||V===A&&this.lineHeight>1)&&(z/=this.lineHeight);var de=w.left+G+Z,ce=ie-Z,le=z,ee=0;this.inCompositionMode?(b.fillStyle=this.compositionColor||"black",le=1,ee=z):b.fillStyle=this.selectionColor,"rtl"===this.direction&&(de=this.width-de-ce),b.fillRect(de,w.top+w.topOffset+ee,ce,le),w.topOffset+=H}},getCurrentCharFontSize:function(){var w=this._getCurrentCharIndex();return this.getValueOfPropertyAt(w.l,w.c,"fontSize")},getCurrentCharColor:function(){var w=this._getCurrentCharIndex();return this.getValueOfPropertyAt(w.l,w.c,"fill")},_getCurrentCharIndex:function(){var w=this.get2DCursorLocation(this.selectionStart,!0);return{l:w.lineIndex,c:w.charIndex>0?w.charIndex-1:0}}}),P.IText.fromObject=function(w,b){if(S(w),w.styles)for(var T in w.styles)for(var _ in w.styles[T])S(w.styles[T][_]);P.Object._fromObject("IText",w,b,"text")}}(),Ae=P.util.object.clone,P.util.object.extend(P.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var S=this;this.on("added",function(){var w=S.canvas;w&&(w._hasITextHandlers||(w._hasITextHandlers=!0,S._initCanvasHandlers(w)),w._iTextInstances=w._iTextInstances||[],w._iTextInstances.push(S))})},initRemovedHandler:function(){var S=this;this.on("removed",function(){var w=S.canvas;w&&(w._iTextInstances=w._iTextInstances||[],P.util.removeFromArray(w._iTextInstances,S),0===w._iTextInstances.length&&(w._hasITextHandlers=!1,S._removeCanvasHandlers(w)))})},_initCanvasHandlers:function(S){S._mouseUpITextHandler=function(){S._iTextInstances&&S._iTextInstances.forEach(function(w){w.__isMousedown=!1})},S.on("mouse:up",S._mouseUpITextHandler)},_removeCanvasHandlers:function(S){S.off("mouse:up",S._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(S,w,b,T){var _;return _={isAborted:!1,abort:function(){this.isAborted=!0}},S.animate("_currentCursorOpacity",w,{duration:b,onComplete:function(){_.isAborted||S[T]()},onChange:function(){S.canvas&&S.selectionStart===S.selectionEnd&&S.renderCursorOrSelection()},abort:function(){return _.isAborted}}),_},_onTickComplete:function(){var S=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){S._currentTickCompleteState=S._animateCursor(S,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(S){var w=this,b=S?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){w._tick()},b)},abortCursorAnimation:function(){var S=this._currentTickState||this._currentTickCompleteState,w=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,S&&w&&w.clearContext(w.contextTop||w.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(S){var w=0,b=S-1;if(this._reSpace.test(this._text[b]))for(;this._reSpace.test(this._text[b]);)w++,b--;for(;/\S/.test(this._text[b])&&b>-1;)w++,b--;return S-w},findWordBoundaryRight:function(S){var w=0,b=S;if(this._reSpace.test(this._text[b]))for(;this._reSpace.test(this._text[b]);)w++,b++;for(;/\S/.test(this._text[b])&&b<this._text.length;)w++,b++;return S+w},findLineBoundaryLeft:function(S){for(var w=0,b=S-1;!/\n/.test(this._text[b])&&b>-1;)w++,b--;return S-w},findLineBoundaryRight:function(S){for(var w=0,b=S;!/\n/.test(this._text[b])&&b<this._text.length;)w++,b++;return S+w},searchWordBoundary:function(S,w){for(var b=this._text,T=this._reSpace.test(b[S])?S-1:S,_=b[T],y=P.reNonWord;!y.test(_)&&T>0&&T<b.length;)_=b[T+=w];return y.test(_)&&(T+=1===w?0:1),T},selectWord:function(S){var w=this.searchWordBoundary(S=S||this.selectionStart,-1),b=this.searchWordBoundary(S,1);this.selectionStart=w,this.selectionEnd=b,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(S){var w=this.findLineBoundaryLeft(S=S||this.selectionStart),b=this.findLineBoundaryRight(S);return this.selectionStart=w,this.selectionEnd=b,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(S){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(S),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(S){S._iTextInstances&&S._iTextInstances.forEach(function(w){w.selected=!1,w.isEditing&&w.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(S){if(this.__isMousedown&&this.isEditing){var w=this.getSelectionStartFromPointer(S.e),b=this.selectionStart,T=this.selectionEnd;(w===this.__selectionStartOnMouseDown&&b!==T||b!==w&&T!==w)&&(w>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=w):(this.selectionStart=w,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===b&&this.selectionEnd===T||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(S,w,b){var T=b.slice(0,S),_=P.util.string.graphemeSplit(T).length;if(S===w)return{selectionStart:_,selectionEnd:_};var y=b.slice(S,w);return{selectionStart:_,selectionEnd:_+P.util.string.graphemeSplit(y).length}},fromGraphemeToStringSelection:function(S,w,b){var T=b.slice(0,S).join("").length;return S===w?{selectionStart:T,selectionEnd:T}:{selectionStart:T,selectionEnd:T+b.slice(S,w).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var S=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=S.selectionStart,this.hiddenTextarea.selectionEnd=S.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=S.selectionEnd,this.inCompositionMode||(this.selectionStart=S.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var S=this._calcTextareaPosition();this.hiddenTextarea.style.left=S.left,this.hiddenTextarea.style.top=S.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var S=this.inCompositionMode?this.compositionStart:this.selectionStart,w=this._getCursorBoundaries(S),b=this.get2DCursorLocation(S),y=this.getValueOfPropertyAt(b.lineIndex,b.charIndex,"fontSize")*this.lineHeight,I=w.leftOffset,M=this.calcTransformMatrix(),x={x:w.left+I,y:w.top+w.topOffset+y},A=this.canvas.getRetinaScaling(),F=this.canvas.upperCanvasEl,k=F.width/A,V=F.height/A,H=k-y,G=V-y,z=F.clientWidth/k,Z=F.clientHeight/V;return x=P.util.transformPoint(x,M),(x=P.util.transformPoint(x,this.canvas.viewportTransform)).x*=z,x.y*=Z,x.x<0&&(x.x=0),x.x>H&&(x.x=H),x.y<0&&(x.y=0),x.y>G&&(x.y=G),x.x+=this.canvas._offset.left,x.y+=this.canvas._offset.top,{left:x.x+"px",top:x.y+"px",fontSize:y+"px",charHeight:y}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var S=this._textBeforeEdit!==this.text,w=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,w&&(w.blur&&w.blur(),w.parentNode&&w.parentNode.removeChild(w)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),S&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),S&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var S in this.styles)this._textLines[S]||delete this.styles[S]},removeStyleFromTo:function(S,w){var b,T,_=this.get2DCursorLocation(S,!0),y=this.get2DCursorLocation(w,!0),I=_.lineIndex,M=_.charIndex,x=y.lineIndex,A=y.charIndex;if(I!==x){if(this.styles[I])for(b=M;b<this._unwrappedTextLines[I].length;b++)delete this.styles[I][b];if(this.styles[x])for(b=A;b<this._unwrappedTextLines[x].length;b++)(T=this.styles[x][b])&&(this.styles[I]||(this.styles[I]={}),this.styles[I][M+b-A]=T);for(b=I+1;b<=x;b++)delete this.styles[b];this.shiftLineStyles(x,I-x)}else if(this.styles[I]){T=this.styles[I];var F,k,V=A-M;for(b=M;b<A;b++)delete T[b];for(k in this.styles[I])(F=parseInt(k,10))>=A&&(T[F-V]=T[k],delete T[k])}},shiftLineStyles:function(S,w){var b=Ae(this.styles);for(var T in this.styles){var _=parseInt(T,10);_>S&&(this.styles[_+w]=b[_],b[_-w]||delete this.styles[_])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(S,w,b,T){var _,y={},I=!1,M=this._unwrappedTextLines[S].length===w;for(var x in b||(b=1),this.shiftLineStyles(S,b),this.styles[S]&&(_=this.styles[S][0===w?w:w-1]),this.styles[S]){var A=parseInt(x,10);A>=w&&(I=!0,y[A-w]=this.styles[S][x],M&&0===w||delete this.styles[S][x])}var F=!1;for(I&&!M&&(this.styles[S+b]=y,F=!0),F&&b--;b>0;)T&&T[b-1]?this.styles[S+b]={0:Ae(T[b-1])}:_?this.styles[S+b]={0:Ae(_)}:delete this.styles[S+b],b--;this._forceClearCache=!0},insertCharStyleObject:function(S,w,b,T){this.styles||(this.styles={});var _=this.styles[S],y=_?Ae(_):{};for(var I in b||(b=1),y){var M=parseInt(I,10);M>=w&&(_[M+b]=y[M],y[M-b]||delete _[M])}if(this._forceClearCache=!0,T)for(;b--;)Object.keys(T[b]).length&&(this.styles[S]||(this.styles[S]={}),this.styles[S][w+b]=Ae(T[b]));else if(_)for(var x=_[w?w-1:1];x&&b--;)this.styles[S][w+b]=Ae(x)},insertNewStyleBlock:function(S,w,b){for(var T=this.get2DCursorLocation(w,!0),_=[0],y=0,I=0;I<S.length;I++)"\n"===S[I]?_[++y]=0:_[y]++;for(_[0]>0&&(this.insertCharStyleObject(T.lineIndex,T.charIndex,_[0],b),b=b&&b.slice(_[0]+1)),y&&this.insertNewlineStyleObject(T.lineIndex,T.charIndex+_[0],y),I=1;I<y;I++)_[I]>0?this.insertCharStyleObject(T.lineIndex+I,0,_[I],b):b&&this.styles[T.lineIndex+I]&&b[0]&&(this.styles[T.lineIndex+I][0]=b[0]),b=b&&b.slice(_[I]+1);_[I]>0&&this.insertCharStyleObject(T.lineIndex+I,0,_[I],b)},setSelectionStartEndWithShift:function(S,w,b){b<=S?(w===S?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=S),this.selectionStart=b):b>S&&b<w?"right"===this._selectionDirection?this.selectionEnd=b:this.selectionStart=b:(w===S?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=w),this.selectionEnd=b)},setSelectionInBoundaries:function(){var S=this.text.length;this.selectionStart>S?this.selectionStart=S:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>S?this.selectionEnd=S:this.selectionEnd<0&&(this.selectionEnd=0)}}),P.util.object.extend(P.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(S){if(this.canvas){this.__newClickTime=+new Date;var w=S.pointer;this.isTripleClick(w)&&(this.fire("tripleclick",S),this._stopEvent(S.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=w,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(S){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===S.x&&this.__lastPointer.y===S.y},_stopEvent:function(S){S.preventDefault&&S.preventDefault(),S.stopPropagation&&S.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(S){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(S.e))},tripleClickHandler:function(S){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(S.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(S){!this.canvas||!this.editable||S.e.button&&1!==S.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(S.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(S){!this.canvas||!this.editable||S.e.button&&1!==S.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(S){if(this.__isMousedown=!1,!(!this.editable||this.group||S.transform&&S.transform.actionPerformed||S.e.button&&1!==S.e.button)){if(this.canvas){var w=this.canvas._activeObject;if(w&&w!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(S.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(S){var w=this.getSelectionStartFromPointer(S);S.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,w):(this.selectionStart=w,this.selectionEnd=w),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(S){for(var w,b=this.getLocalPointer(S),T=0,_=0,y=0,I=0,M=0,x=0,A=this._textLines.length;x<A&&y<=b.y;x++)y+=this.getHeightOfLine(x)*this.scaleY,M=x,x>0&&(I+=this._textLines[x-1].length+this.missingNewlineOffset(x-1));_=this._getLineLeftOffset(M)*this.scaleX,w=this._textLines[M],"rtl"===this.direction&&(b.x=this.width*this.scaleX-b.x+_);for(var F=0,k=w.length;F<k&&(T=_,(_+=this.__charBounds[M][F].kernedWidth*this.scaleX)<=b.x);F++)I++;return this._getNewSelectionStartFromOffset(b,T,_,I,k)},_getNewSelectionStartFromOffset:function(S,w,b,T,_){var I=b-S.x,M=T+(I>S.x-w||I<0?0:1);return this.flipX&&(M=_-M),M>this._text.length&&(M=this._text.length),M}}),P.util.object.extend(P.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=P.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var S=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+S.top+"; left: "+S.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+S.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):P.document.body.appendChild(this.hiddenTextarea),P.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),P.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),P.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),P.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),P.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),P.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(P.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(S){if(this.isEditing){var w="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(S.keyCode in w)this[w[S.keyCode]](S);else{if(!(S.keyCode in this.ctrlKeysMapDown)||!S.ctrlKey&&!S.metaKey)return;this[this.ctrlKeysMapDown[S.keyCode]](S)}S.stopImmediatePropagation(),S.preventDefault(),S.keyCode>=33&&S.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(S){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:S.keyCode in this.ctrlKeysMapUp&&(S.ctrlKey||S.metaKey)&&(this[this.ctrlKeysMapUp[S.keyCode]](S),S.stopImmediatePropagation(),S.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(S){var w=this.fromPaste;if(this.fromPaste=!1,S&&S.stopPropagation(),this.isEditing){var b,T,_,y,I,M=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,x=this._text.length,A=M.length,F=A-x,k=this.selectionStart,V=this.selectionEnd,H=k!==V;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var G=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),z=k>G.selectionStart;H?(b=this._text.slice(k,V),F+=V-k):A<x&&(b=z?this._text.slice(V+F,V):this._text.slice(k,k-F)),T=M.slice(G.selectionEnd-F,G.selectionEnd),b&&b.length&&(T.length&&(_=this.getSelectionStyles(k,k+1,!1),_=T.map(function(){return _[0]})),H?(y=k,I=V):z?(y=V-b.length,I=V):(y=V,I=V+b.length),this.removeStyleFromTo(y,I)),T.length&&(w&&T.join("")===P.copiedText&&!P.disableStyleCopyPaste&&(_=P.copiedTextStyle),this.insertNewStyleBlock(T,k,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(S){this.compositionStart=S.target.selectionStart,this.compositionEnd=S.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(P.copiedText=this.getSelectedText(),P.copiedTextStyle=P.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(S){return S&&S.clipboardData||P.window.clipboardData},_getWidthBeforeCursor:function(S,w){var b,T=this._getLineLeftOffset(S);return w>0&&(T+=(b=this.__charBounds[S][w-1]).left+b.width),T},getDownCursorOffset:function(S,w){var b=this._getSelectionForOffset(S,w),T=this.get2DCursorLocation(b),_=T.lineIndex;if(_===this._textLines.length-1||S.metaKey||34===S.keyCode)return this._text.length-b;var y=T.charIndex,I=this._getWidthBeforeCursor(_,y),M=this._getIndexOnLine(_+1,I);return this._textLines[_].slice(y).length+M+1+this.missingNewlineOffset(_)},_getSelectionForOffset:function(S,w){return S.shiftKey&&this.selectionStart!==this.selectionEnd&&w?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(S,w){var b=this._getSelectionForOffset(S,w),T=this.get2DCursorLocation(b),_=T.lineIndex;if(0===_||S.metaKey||33===S.keyCode)return-b;var y=T.charIndex,I=this._getWidthBeforeCursor(_,y),M=this._getIndexOnLine(_-1,I),x=this._textLines[_].slice(0,y),A=this.missingNewlineOffset(_-1);return-this._textLines[_-1].length+M-x.length+(1-A)},_getIndexOnLine:function(S,w){for(var b,T,_=this._textLines[S],y=this._getLineLeftOffset(S),I=0,M=0,x=_.length;M<x;M++)if((y+=b=this.__charBounds[S][M].width)>w){T=!0;var F=y,k=Math.abs(y-b-w);I=Math.abs(F-w)<k?M:M-1;break}return T||(I=_.length-1),I},moveCursorDown:function(S){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",S)},moveCursorUp:function(S){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",S)},_moveCursorUpOrDown:function(S,w){var b=this["get"+S+"CursorOffset"](w,"right"===this._selectionDirection);w.shiftKey?this.moveCursorWithShift(b):this.moveCursorWithoutShift(b),0!==b&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(S){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+S:this.selectionEnd+S),0!==S},moveCursorWithoutShift:function(S){return S<0?(this.selectionStart+=S,this.selectionEnd=this.selectionStart):(this.selectionEnd+=S,this.selectionStart=this.selectionEnd),0!==S},moveCursorLeft:function(S){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",S)},_move:function(S,w,b){var T;if(S.altKey)T=this["findWordBoundary"+b](this[w]);else{if(!S.metaKey&&35!==S.keyCode&&36!==S.keyCode)return this[w]+="Left"===b?-1:1,!0;T=this["findLineBoundary"+b](this[w])}if(void 0!==typeof T&&this[w]!==T)return this[w]=T,!0},_moveLeft:function(S,w){return this._move(S,w,"Left")},_moveRight:function(S,w){return this._move(S,w,"Right")},moveCursorLeftWithoutShift:function(S){var w=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(w=this._moveLeft(S,"selectionStart")),this.selectionEnd=this.selectionStart,w},moveCursorLeftWithShift:function(S){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(S,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(S,"selectionStart")):void 0},moveCursorRight:function(S){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",S)},_moveCursorLeftOrRight:function(S,w){var b="moveCursor"+S+"With";this._currentCursorOpacity=1,this[b+=w.shiftKey?"Shift":"outShift"](w)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(S){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(S,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(S,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(S){var w=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(w=this._moveRight(S,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,w},removeChars:function(S,w){void 0===w&&(w=S+1),this.removeStyleFromTo(S,w),this._text.splice(S,w-S),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(S,w,b,T){void 0===T&&(T=b),T>b&&this.removeStyleFromTo(b,T);var _=P.util.string.graphemeSplit(S);this.insertNewStyleBlock(_,b,w),this._text=[].concat(this._text.slice(0,b),_,this._text.slice(T)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var S=P.util.toFixed,w=/  +/g;P.util.object.extend(P.Text.prototype,{_toSVG:function(){var b=this._getSVGLeftTopOffsets(),T=this._getSVGTextAndBg(b.textTop,b.textLeft);return this._wrapSVGTextAndBg(T)},toSVG:function(b){return this._createBaseSVGMarkup(this._toSVG(),{reviver:b,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(b){var T=this.getSvgTextDecoration(this);return[b.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",T?'text-decoration="'+T+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",b.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(b,T){var _,y=[],I=[],M=b;this._setSVGBg(I);for(var x=0,A=this._textLines.length;x<A;x++)_=this._getLineLeftOffset(x),(this.textBackgroundColor||this.styleHas("textBackgroundColor",x))&&this._setSVGTextLineBg(I,x,T+_,M),this._setSVGTextLineText(y,x,T+_,M),M+=this.getHeightOfLine(x);return{textSpans:y,textBgRects:I}},_createTextCharSpan:function(b,T,_,y){var I=b!==b.trim()||b.match(w),M=this.getSvgSpanStyles(T,I),x=M?'style="'+M+'"':"",A=T.deltaY,F="",k=P.Object.NUM_FRACTION_DIGITS;return A&&(F=' dy="'+S(A,k)+'" '),['<tspan x="',S(_,k),'" y="',S(y,k),'" ',F,x,">",P.util.string.escapeXml(b),"</tspan>"].join("")},_setSVGTextLineText:function(b,T,_,y){var I,M,x,A,F,k=this.getHeightOfLine(T),V=-1!==this.textAlign.indexOf("justify"),H="",G=0,z=this._textLines[T];y+=k*(1-this._fontSizeFraction)/this.lineHeight;for(var Z=0,ie=z.length-1;Z<=ie;Z++)F=Z===ie||this.charSpacing,H+=z[Z],x=this.__charBounds[T][Z],0===G?(_+=x.kernedWidth-x.width,G+=x.width):G+=x.kernedWidth,V&&!F&&this._reSpaceAndTab.test(z[Z])&&(F=!0),F||(I=I||this.getCompleteStyleDeclaration(T,Z),M=this.getCompleteStyleDeclaration(T,Z+1),F=this._hasStyleChangedForSvg(I,M)),F&&(A=this._getStyleDeclaration(T,Z)||{},b.push(this._createTextCharSpan(H,A,_,y)),H="",I=M,_+=G,G=0)},_pushTextBgRect:function(b,T,_,y,I,M){var x=P.Object.NUM_FRACTION_DIGITS;b.push("\t\t<rect ",this._getFillAttributes(T),' x="',S(_,x),'" y="',S(y,x),'" width="',S(I,x),'" height="',S(M,x),'"></rect>\n')},_setSVGTextLineBg:function(b,T,_,y){for(var I,M,x=this._textLines[T],A=this.getHeightOfLine(T)/this.lineHeight,F=0,k=0,V=this.getValueOfPropertyAt(T,0,"textBackgroundColor"),H=0,G=x.length;H<G;H++)I=this.__charBounds[T][H],(M=this.getValueOfPropertyAt(T,H,"textBackgroundColor"))!==V?(V&&this._pushTextBgRect(b,V,_+k,y,F,A),k=I.left,F=I.width,V=M):F+=I.kernedWidth;M&&this._pushTextBgRect(b,M,_+k,y,F,A)},_getFillAttributes:function(b){var T=b&&"string"==typeof b?new P.Color(b):"";return T&&T.getSource()&&1!==T.getAlpha()?'opacity="'+T.getAlpha()+'" fill="'+T.setAlpha(1).toRgb()+'"':'fill="'+b+'"'},_getSVGLineTopOffset:function(b){for(var T,_=0,y=0;y<b;y++)_+=this.getHeightOfLine(y);return T=this.getHeightOfLine(y),{lineTop:_,offset:(this._fontSizeMult-this._fontSizeFraction)*T/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(b){return P.Object.prototype.getSvgStyles.call(this,b)+" white-space: pre;"}})}(),function(S){var w=S.fabric||(S.fabric={});w.Textbox=w.util.createClass(w.IText,w.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:w.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(b){for(var T=0,_=0,y=0,I={},M=0;M<b.graphemeLines.length;M++)"\n"===b.graphemeText[y]&&M>0?(_=0,y++,T++):!this.splitByGrapheme&&this._reSpaceAndTab.test(b.graphemeText[y])&&M>0&&(_++,y++),I[M]={line:T,offset:_},y+=b.graphemeLines[M].length,_+=b.graphemeLines[M].length;return I},styleHas:function(b,T){if(this._styleMap&&!this.isWrapping){var _=this._styleMap[T];_&&(T=_.line)}return w.Text.prototype.styleHas.call(this,b,T)},isEmptyStyles:function(b){if(!this.styles)return!0;var T,_,y=0,I=!1,M=this._styleMap[b],x=this._styleMap[b+1];for(var A in M&&(b=M.line,y=M.offset),x&&(I=x.line===b,T=x.offset),_=void 0===b?this.styles:{line:this.styles[b]})for(var F in _[A])if(F>=y&&(!I||F<T))for(var k in _[A][F])return!1;return!0},_getStyleDeclaration:function(b,T){if(this._styleMap&&!this.isWrapping){var _=this._styleMap[b];if(!_)return null;b=_.line,T=_.offset+T}return this.callSuper("_getStyleDeclaration",b,T)},_setStyleDeclaration:function(b,T,_){var y=this._styleMap[b];this.styles[b=y.line][T=y.offset+T]=_},_deleteStyleDeclaration:function(b,T){var _=this._styleMap[b];delete this.styles[b=_.line][T=_.offset+T]},_getLineStyle:function(b){return!!this.styles[this._styleMap[b].line]},_setLineStyle:function(b){this.styles[this._styleMap[b].line]={}},_wrapText:function(b,T){var _,y=[];for(this.isWrapping=!0,_=0;_<b.length;_++)y=y.concat(this._wrapLine(b[_],_,T));return this.isWrapping=!1,y},_measureWord:function(b,T,_){var y,I=0;_=_||0;for(var M=0,x=b.length;M<x;M++)I+=this._getGraphemeBox(b[M],T,M+_,y,!0).kernedWidth,y=b[M];return I},_wrapLine:function(b,T,_,y){var I=0,M=this.splitByGrapheme,x=[],A=[],F=M?w.util.string.graphemeSplit(b):b.split(this._wordJoiners),k="",V=0,H=M?"":" ",G=0,z=0,Z=0,ie=!0,re=this._getWidthOfCharSpacing();y=y||0,0===F.length&&F.push([]),_-=y;for(var de=0;de<F.length;de++)k=M?F[de]:w.util.string.graphemeSplit(F[de]),G=this._measureWord(k,T,V),V+=k.length,(I+=z+G-re)>_&&!ie?(x.push(A),A=[],I=G,ie=!0):I+=re,ie||M||A.push(H),A=A.concat(k),z=M?0:this._measureWord([H],T,V),V++,ie=!1,G>Z&&(Z=G);return de&&x.push(A),Z+y>this.dynamicMinWidth&&(this.dynamicMinWidth=Z-re+y),x},isEndOfWrapping:function(b){return!this._styleMap[b+1]||this._styleMap[b+1].line!==this._styleMap[b].line},missingNewlineOffset:function(b){return this.splitByGrapheme?this.isEndOfWrapping(b)?1:0:1},_splitTextIntoLines:function(b){for(var T=w.Text.prototype._splitTextIntoLines.call(this,b),_=this._wrapText(T.lines,this.width),y=new Array(_.length),I=0;I<_.length;I++)y[I]=_[I].join("");return T.lines=y,T.graphemeLines=_,T},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var b={};for(var T in this._styleMap)this._textLines[T]&&(b[this._styleMap[T].line]=1);for(var T in this.styles)b[T]||delete this.styles[T]},toObject:function(b){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(b))}}),w.Textbox.fromObject=function(b,T){return w.Object._fromObject("Textbox",b,T,"text")}}(l),function(){var S=P.controlsUtils,w=S.scaleSkewCursorStyleHandler,b=S.scaleCursorStyleHandler,T=S.scalingEqually,_=S.scalingYOrSkewingX,y=S.scalingXOrSkewingY,I=S.scaleOrSkewActionName,M=P.Object.prototype.controls;if(M.ml=new P.Control({x:-.5,y:0,cursorStyleHandler:w,actionHandler:y,getActionName:I}),M.mr=new P.Control({x:.5,y:0,cursorStyleHandler:w,actionHandler:y,getActionName:I}),M.mb=new P.Control({x:0,y:.5,cursorStyleHandler:w,actionHandler:_,getActionName:I}),M.mt=new P.Control({x:0,y:-.5,cursorStyleHandler:w,actionHandler:_,getActionName:I}),M.tl=new P.Control({x:-.5,y:-.5,cursorStyleHandler:b,actionHandler:T}),M.tr=new P.Control({x:.5,y:-.5,cursorStyleHandler:b,actionHandler:T}),M.bl=new P.Control({x:-.5,y:.5,cursorStyleHandler:b,actionHandler:T}),M.br=new P.Control({x:.5,y:.5,cursorStyleHandler:b,actionHandler:T}),M.mtr=new P.Control({x:0,y:-.5,actionHandler:S.rotationWithSnapping,cursorStyleHandler:S.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),P.Textbox){var x=P.Textbox.prototype.controls={};x.mtr=M.mtr,x.tr=M.tr,x.br=M.br,x.tl=M.tl,x.bl=M.bl,x.mt=M.mt,x.mb=M.mb,x.mr=new P.Control({x:.5,y:0,actionHandler:S.changeWidth,cursorStyleHandler:w,actionName:"resizing"}),x.ml=new P.Control({x:-.5,y:0,actionHandler:S.changeWidth,cursorStyleHandler:w,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},RI={};function po(f){var l=RI[f];if(void 0!==l)return l.exports;var u=RI[f]={exports:{}};return bj[f](u,u.exports,po),u.exports}po.d=(f,l)=>{for(var u in l)po.o(l,u)&&!po.o(f,u)&&Object.defineProperty(f,u,{enumerable:!0,get:l[u]})},po.o=(f,l)=>Object.prototype.hasOwnProperty.call(f,l);var OI={};(()=>{let f;po.d(OI,{R:()=>f}),f="undefined"!=typeof document&&"undefined"!=typeof window?po(653).fabric:{version:"5.2.1"}})();var Ln,fi,Rs,MI,at=OI.R;(function(f){f[f.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",f[f.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",f[f.DIMT_TEXT=4]="DIMT_TEXT",f[f.DIMT_ARC=8]="DIMT_ARC",f[f.DIMT_IMAGE=16]="DIMT_IMAGE",f[f.DIMT_POLYGON=32]="DIMT_POLYGON",f[f.DIMT_LINE=64]="DIMT_LINE",f[f.DIMT_GROUP=128]="DIMT_GROUP"})(Ln||(Ln={})),function(f){f[f.DIS_DEFAULT=1]="DIS_DEFAULT",f[f.DIS_SELECTED=2]="DIS_SELECTED"}(fi||(fi={})),function(f){f[f.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",f[f.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",f[f.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Rs||(Rs={})),function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(MI||(MI={}));const Da=f=>"number"==typeof f&&!Number.isNaN(f),e_=f=>"string"==typeof f;var td,vc,Sa,t_,Sr,nd;(function(f){f[f.ARC=0]="ARC",f[f.IMAGE=1]="IMAGE",f[f.LINE=2]="LINE",f[f.POLYGON=3]="POLYGON",f[f.QUAD=4]="QUAD",f[f.RECT=5]="RECT",f[f.TEXT=6]="TEXT",f[f.GROUP=7]="GROUP"})(Sr||(Sr={})),function(f){f[f.DEFAULT=0]="DEFAULT",f[f.SELECTED=1]="SELECTED"}(nd||(nd={}));class ti{get mediaType(){return new Map([["rect",Ln.DIMT_RECTANGLE],["quad",Ln.DIMT_QUADRILATERAL],["text",Ln.DIMT_TEXT],["arc",Ln.DIMT_ARC],["image",Ln.DIMT_IMAGE],["polygon",Ln.DIMT_POLYGON],["line",Ln.DIMT_LINE],["group",Ln.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(U(this,vc,"f")){case fi.DIS_DEFAULT:return"default";case fi.DIS_SELECTED:return"selected"}}set drawingStyleId(l){this.styleId=l}get drawingStyleId(){return this.styleId}set coordinateBase(l){if(!["view","image"].includes(l))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===U(this,Sa,"f")&&"view"===l?this.updateCoordinateBaseFromImageToView():"view"===U(this,Sa,"f")&&"image"===l&&this.updateCoordinateBaseFromViewToImage()),Le(this,Sa,l,"f")}get coordinateBase(){return U(this,Sa,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(l,u){if(td.add(this),vc.set(this,void 0),Sa.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=u&&!Da(u))throw new TypeError("Invalid 'drawingStyleId'.");l&&this._setFabricObject(l),this.setState(fi.DIS_DEFAULT),this.styleId=u}_setFabricObject(l){this._fabricObject=l,this._fabricObject.on("selected",()=>{this.setState(fi.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(fi.DIS_SELECTED):this.setState(fi.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),l.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(l){Le(this,vc,l,"f")}getState(){return U(this,vc,"f")}_on(l,u){if(!u)return;const g=l.toLowerCase(),p=this.mapEvent_Callbacks.get(g);if(!p)throw new Error(`Event '${l}' does not exist.`);let m=p.get(u);m||(m=v=>{const C=v.e;if(!C)return void(u&&u.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const D={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let O,L,N,B;const j=C.target.getBoundingClientRect();O=j.left,L=j.top,N=O+window.scrollX,B=L+window.scrollY;const{width:W,height:Y}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),$=this._drawingLayer.width,q=this._drawingLayer.height,X=W/Y,Q=$/q,pe=this._drawingLayer._getObjectFit();let ve,Te,Ae,P,Ee=1;if("contain"===pe)X<Q?(Ee=W/$,ve=O+this.get("x")*Ee,Te=L+this.get("y")*Ee+(Y-q*Ee)/2,Ae=N+this.get("x")*Ee,P=B+this.get("y")*Ee+(Y-q*Ee)/2):(Ee=Y/q,ve=O+this.get("x")*Ee+(W-$*Ee)/2,Te=L+this.get("y")*Ee,Ae=N+this.get("x")*Ee+(W-$*Ee)/2,P=B+this.get("y")*Ee);else if("cover"===pe)if(X<Q){Ee=Y/q;let Be=this.get("x")*Ee-($*Ee-W)/2;Be=Math.max(Be,0),Be=Math.min(Be,W),ve=O+Be,Te=L+this.get("y")*Ee,Ae=N+Be,P=B+this.get("y")*Ee}else{Ee=W/$;let Be=this.get("y")*Ee-(q*Ee-Y)/2;Be=Math.max(Be,0),Be=Math.min(Be,Y),ve=O+this.get("x")*Ee,Te=L+Be,Ae=N+this.get("x")*Ee,P=B+Be}D.itemClientX=Math.round(ve),D.itemClientY=Math.round(Te),D.itemPageX=Math.round(Ae),D.itemPageY=Math.round(P)}for(let O of Object.getOwnPropertyNames(D))Object.defineProperty(C,O,{value:D[O],writable:!0});u&&u.apply(this,[C])},p.set(u,m),this._fabricObject.on("dblclick"===g?"mousedblclick":g,m))}on(l,u){this._on(l,u)}_off(l,u){const g=l.toLowerCase(),p=this.mapEvent_Callbacks.get(g);if(!p)throw new Error(`Event '${l}' does not exist.`);let m=p.get(u);m&&(p.delete(u),this._fabricObject.off("dblclick"===g?"mousedblclick":g,m))}off(l,u){this._off(l,u)}_setEditable(l){const u=this._fabricObject;l?(u.selectable=!0,u.hasControls=!0,u.hoverCursor=null):(u.selectable=!1,u.hasControls=!1,u.hoverCursor="default")}hasNote(l){return this.mapNoteName_Content.has(l)}addNote(l,u){if(this.hasNote(l.name)&&!u)throw new Error("A note with the same name already exists, please use a different name.");const g=l.content?JSON.parse(JSON.stringify(l.content)):l.content;this.mapNoteName_Content.set(l.name,[g])}getNote(l){const u=this.mapNoteName_Content.get(l);return u?1===u.length?{name:l,content:u[0]?JSON.parse(JSON.stringify(u[0])):u[0]}:{name:l,content:JSON.parse(JSON.stringify(u))}:null}getNotes(){const l=[];for(let u of this.mapNoteName_Content){let g=1===u[1].length?u[1][0]:u[1];g=g&&JSON.parse(JSON.stringify(g)),l.push({name:u[0],content:g})}return l}updateNote(l,u,g){const p=this.mapNoteName_Content.get(l);if(!p)throw new Error("The note name does not exist.");g||(p.length=0),u=u&&JSON.parse(JSON.stringify(u)),p.push(u)}deleteNote(l){this.mapNoteName_Content.delete(l)}clearNotes(){this.mapNoteName_Content.clear()}set(l,u){if(!this.extendSet(l,u))if("x"===l){const g=this._fabricObject.group;g?(this._fabricObject.set("left",u-g.left-g.width/2),g.addWithUpdate()):this._fabricObject.set("left",u)}else if("y"===l){const g=this._fabricObject.group;g?(this._fabricObject.set("top",u-g.top-g.height/2),g.addWithUpdate()):this._fabricObject.set("top",u)}else"styleId"===l?this.styleId=u:this._fabricObject.set(l,u);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(l)&&this._fabricObject.setCoords()}get(l){let u=this.extendGet(l);if(void 0===u)if("x"===l){const g=this._fabricObject.group;u=g?this._fabricObject.get("left")+g.left+g.width/2:this._fabricObject.get("left")}else if("y"===l){const g=this._fabricObject.group;u=g?this._fabricObject.get("top")+g.top+g.height/2:this._fabricObject.get("top")}else u="scaledWidth"===l?this._fabricObject.getScaledWidth():"scaledHeight"===l?this._fabricObject.getScaledHeight():["type","mediaType"].includes(l)?this.mediaType:"state"===l?this.getState():"styleId"===l?this.styleId:"drawingLayerId"===l?this.drawingLayerId:this._fabricObject.get(l);return u}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l*U(this,td,"m",t_).call(this)}convertPropFromViewToImage(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l/U(this,td,"m",t_).call(this)}_setLineWidth(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",l)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",l)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}vc=new WeakMap,Sa=new WeakMap,td=new WeakSet,t_=function(){const f=this._drawingLayer;if(!f)return 1;const l=f.width,u=f.height,{width:g,height:p}=f.fabricCanvas.wrapperEl.getBoundingClientRect();if(g<=0||p<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const m=g/l,v=p/u,C=f._getObjectFit();let D=1;return"contain"===C?D=m<v?g/l:p/u:"cover"===C&&(D=m<v?p/u:g/l),D},ti.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],ti.mapItemType=new Map([[Sr.ARC,"arc"],[Sr.IMAGE,"image"],[Sr.LINE,"line"],[Sr.POLYGON,"polygon"],[Sr.QUAD,"quad"],[Sr.RECT,"rect"],[Sr.TEXT,"text"],[Sr.GROUP,"group"]]),ti.arrStyleSelectors=["default","selected"],ti.mapItemState=new Map([[nd.DEFAULT,"default"],[nd.SELECTED,"selected"]]);const LI=f=>null!==f&&"object"==typeof f&&!Array.isArray(f),n_=f=>!!e_(f)&&""!==f,r_=f=>!(!er(f)||!en(f.left)||f.left<0||!en(f.top)||f.top<0||!en(f.right)||f.right<0||!en(f.bottom)||f.bottom<0||f.left>=f.right||f.top>=f.bottom||!Um(f.isMeasuredInPercentage)),PI=f=>!!er(f)&&!!jm(f.points)&&0!=f.points.length&&!f.points.some(l=>!wa(l)),Dj=wa,NI=f=>!!er(f)&&!!jm(f.points)&&0!=f.points.length&&4==f.points.length&&!f.points.some(l=>!wa(l)),Xr=f=>!(!er(f)||!en(f.x)||!en(f.y)||!en(f.width)||f.width<0||!en(f.height)||f.height<0||"isMeasuredInPercentage"in f&&!Um(f.isMeasuredInPercentage)),kI=f=>!(!LI(f)||"id"in f&&!Da(f.id)||"lineWidth"in f&&!Da(f.lineWidth)||"fillStyle"in f&&!n_(f.fillStyle)||"strokeStyle"in f&&!n_(f.strokeStyle)||"paintMode"in f&&!["fill","stroke","strokeAndFill"].includes(f.paintMode)||"fontFamily"in f&&!n_(f.fontFamily)||"fontSize"in f&&!Da(f.fontSize));class id{static convert(l,u,g){const p={x:0,y:0,width:u,height:g};if(!l)return p;if(Xr(l))l.isMeasuredInPercentage?(p.x=l.x/100*u,p.y=l.y/100*g,p.width=l.width/100*u,p.height=l.height/100*g):(p.x=l.x,p.y=l.y,p.width=l.width,p.height=l.height);else{if(!r_(l))throw TypeError("Invalid region.");l.isMeasuredInPercentage?(p.x=l.left/100*u,p.y=l.top/100*g,p.width=(l.right-l.left)/100*u,p.height=(l.bottom-l.top)/100*g):(p.x=l.left,p.y=l.top,p.width=l.right-l.left,p.height=l.bottom-l.top)}return p.x=Math.round(p.x),p.y=Math.round(p.y),p.width=Math.round(p.width),p.height=Math.round(p.height),p}}var mo,rd;class BI{constructor(){mo.set(this,new Map),rd.set(this,!1)}get disposed(){return U(this,rd,"f")}on(l,u){l=l.toLowerCase();const g=U(this,mo,"f").get(l);if(g){if(g.includes(u))return;g.push(u)}else U(this,mo,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const g=U(this,mo,"f").get(l);if(!g)return;const p=g.indexOf(u);-1!==p&&g.splice(p,1)}offAll(l){l=l.toLowerCase();const u=U(this,mo,"f").get(l);u&&(u.length=0)}fire(l,u=[],g={async:!1,copy:!0}){u||(u=[]),l=l.toLowerCase();const p=U(this,mo,"f").get(l);if(p&&p.length){g=Object.assign({async:!1,copy:!0},g);for(let m of p){if(!m)continue;let v=[];if(g.copy)for(let D of u){try{D=JSON.parse(JSON.stringify(D))}catch(O){}v.push(D)}else v=u;let C=!1;if(g.async)setTimeout(()=>{this.disposed||p.includes(m)&&m.apply(g.target,v)},0);else try{C=m.apply(g.target,v)}catch(D){}if(!0===C)break}}}dispose(){Le(this,rd,!0,"f")}}function Sj(f,l,u){return(u.x-f.x)*(l.y-f.y)==(l.x-f.x)*(u.y-f.y)&&Math.min(f.x,l.x)<=u.x&&u.x<=Math.max(f.x,l.x)&&Math.min(f.y,l.y)<=u.y&&u.y<=Math.max(f.y,l.y)}function s_(f){return Math.abs(f)<1e-6?0:f<0?-1:1}function sd(f,l,u,g){let p=f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1])+u[0]*(l[1]-f[1]),m=f[0]*(g[1]-l[1])+l[0]*(f[1]-g[1])+g[0]*(l[1]-f[1]);return!((p^m)>=0&&0!==p&&0!==m||(p=u[0]*(f[1]-g[1])+g[0]*(u[1]-f[1])+f[0]*(g[1]-u[1]),m=u[0]*(l[1]-g[1])+g[0]*(u[1]-l[1])+l[0]*(g[1]-u[1]),(p^m)>=0&&0!==p&&0!==m))}mo=new WeakMap,rd=new WeakMap;const o_=function(){var f=oe(function*(l){if("string"!=typeof l)throw new TypeError("Invalid url.");const u=yield fetch(l);if(!u.ok)throw Error("Network Error: "+u.statusText);const g=yield u.text();if(!g.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const p=document.createElement("div");p.insertAdjacentHTML("beforeend",g);for(let m=0;m<p.childElementCount;++m){let v=p.children[m];v instanceof HTMLStyleElement&&document.head.append(v)}return 1==p.childElementCount?p.children[0]:p});return function(u){return f.apply(this,arguments)}}();var Os,Ms,Fs;class Ia extends ti{constructor(l,u){if(super(null,u),Os.set(this,void 0),!Xr(l))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new at.Rect({left:l.x,top:l.y,width:l.width,height:l.height})),Le(this,Os,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="rect"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(l){this.setRect(l)}getPosition(){return this.getRect()}updatePosition(){U(this,Os,"f")&&this.setRect(U(this,Os,"f"))}setRect(l){if(!Xr(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width)),this.set("height",this.convertPropFromViewToImage(l.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width),this.set("height",l.height)}this._drawingLayer.renderAll()}else Le(this,Os,JSON.parse(JSON.stringify(l)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Os,"f")?JSON.parse(JSON.stringify(U(this,Os,"f"))):null}}function a_(f,l,u){return at.util.transformPoint({x:u.points[this.pointIndex].x-u.pathOffset.x,y:u.points[this.pointIndex].y-u.pathOffset.y},u.calcTransformMatrix())}function VI(f){let l=new at.Point(f.strokeUniform?1/f.scaleX:1,f.strokeUniform?1/f.scaleY:1).multiply(f.strokeWidth);return new at.Point(f.width+l.x,f.height+l.y)}function l_(f,l,u,g){let p=l.target,m=p.controls[p.__corner],v=p.toLocalPoint(new at.Point(u,g),"center","center"),C=VI(p),D=p._getTransformedDimensions(0,0);return p.points[m.pointIndex]={x:v.x*C.x/D.x+p.pathOffset.x,y:v.y*C.y/D.y+p.pathOffset.y},at.controlsUtils.fireEvent("scaling",{e:f,transform:l,pointer:{x:u,y:g}}),!0}function c_(f,l){return function(u,g,p,m){let v=g.target,C=at.util.transformPoint({x:v.points[f].x-v.pathOffset.x,y:v.points[f].y-v.pathOffset.y},v.calcTransformMatrix()),D=l(u,g,p,m);v._setPositionDimensions({});let O=VI(v);return v.setPositionByOrigin(C,(v.points[f].x-v.pathOffset.x)/O.x+.5,(v.points[f].y-v.pathOffset.y)/O.y+.5),D}}Os=new WeakMap;class u_ extends ti{constructor(l,u){if(super(null,u),Ms.set(this,void 0),!PI(l))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new at.Polygon(l.points,{objectCaching:!1}));const g=this._fabricObject;let p=g.points.length-1;g.controls=g.points.reduce(function(m,v,C){return m["p"+C]=new at.Control({positionHandler:a_,actionHandler:c_(C>0?C-1:p,l_),actionName:"modifyPolygon",pointIndex:C}),m},{}),Le(this,Ms,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="polygon"}extendSet(l,u){if("vertices"===l){const g=this._fabricObject;if(g.group){const m=g.group;g.points=u.map(v=>({x:v.x-m.left-m.width/2,y:v.y-m.top-m.height/2})),m.addWithUpdate()}else g.points=u;const p=g.points.length-1;return g.controls=g.points.reduce(function(m,v,C){return m["p"+C]=new at.Control({positionHandler:a_,actionHandler:c_(C>0?C-1:p,l_),actionName:"modifyPolygon",pointIndex:C}),m},{}),g._setPositionDimensions({}),!0}}extendGet(l){if("vertices"===l){const u=[],g=this._fabricObject;if(g.selectable&&!g.group)for(let p in g.oCoords)u.push({x:g.oCoords[p].x,y:g.oCoords[p].y});else for(let p of g.points){const C=at.util.transformPoint({x:p.x-g.pathOffset.x,y:p.y-g.pathOffset.y},g.calcTransformMatrix());u.push({x:C.x,y:C.y})}return u}}updateCoordinateBaseFromImageToView(){const l=this.get("vertices").map(u=>({x:this.convertPropFromViewToImage(u.x),y:this.convertPropFromViewToImage(u.y)}));this.set("vertices",l)}updateCoordinateBaseFromViewToImage(){const l=this.get("vertices").map(u=>({x:this.convertPropFromImageToView(u.x),y:this.convertPropFromImageToView(u.y)}));this.set("vertices",l)}setPosition(l){this.setPolygon(l)}getPosition(){return this.getPolygon()}updatePosition(){U(this,Ms,"f")&&this.setPolygon(U(this,Ms,"f"))}setPolygon(l){if(!PI(l))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(g=>({x:this.convertPropFromViewToImage(g.x),y:this.convertPropFromViewToImage(g.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Le(this,Ms,JSON.parse(JSON.stringify(l)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Ms,"f")?JSON.parse(JSON.stringify(U(this,Ms,"f"))):null}}Ms=new WeakMap;const jI=f=>{let l=f.split("\n").map(g=>g.split("\t"));return(u=>{for(let g=0;;g++){let p=-1;for(let m=0;m<u.length;m++){let v=u[m][g];void 0!==v&&v.length>p&&(p=v.length)}if(-1===p)break;for(let m=0;m<u.length;m++){if(g>=u[m].length-1)continue;let v=" ".repeat(p+2-u[m][g].length);u[m][g]=u[m][g].concat(v)}}})(l),(u=>{let g="";for(let p=0;p<u.length;p++)g=g.concat(...u[p],p===u.length-1?"":"\n");return g})(l)};class Ij extends ti{constructor(l,u,g){if(super(null,g),Fs.set(this,void 0),!e_(l))throw new TypeError("Invalid 'text'.");if(!Xr(u))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new at.Textbox(jI(l),{left:u.x,top:u.y,width:u.width})),this._text=l,Le(this,Fs,JSON.parse(JSON.stringify(u)),"f"),this._mediaType="text"}extendSet(l,u){if("text"===l)return this._text=u,this._fabricObject.set("text",jI(u)),!0}extendGet(l){if("text"===l)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(l){this.setTextRect(l)}getPosition(){return this.getTextRect()}updatePosition(){U(this,Fs,"f")&&this.setTextRect(U(this,Fs,"f"))}setText(l){if(!e_(l))throw new TypeError("Invalid 'text'.");this.set("text",l)}getText(){return this.get("text")}setTextRect(l){if(!Xr(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width)}this._drawingLayer.renderAll()}else Le(this,Fs,JSON.parse(JSON.stringify(l)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Fs,"f")?JSON.parse(JSON.stringify(U(this,Fs,"f"))):null}}var Ns,ks,Ta,h_,xa,yc,Aa,gi,Cc,wc,Ec,UI,GI,HI,WI,od,Rt,bc,Dc,Sc,pn,ad,ld,cd,Bs,Ic,Tc,d_,pi,ud,zI,f_,g_,xc,hd;Fs=new WeakMap;class Tj extends u_{constructor(l,u){if(super({points:null==l?void 0:l.points},u),Ns.set(this,void 0),!NI(l))throw new TypeError("Invalid 'quad'.");Le(this,Ns,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="quad"}setPosition(l){this.setQuad(l)}getPosition(){return this.getQuad()}updatePosition(){U(this,Ns,"f")&&this.setQuad(U(this,Ns,"f"))}setPolygon(){}getPolygon(){return null}setQuad(l){if(!NI(l))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(g=>({x:this.convertPropFromViewToImage(g.x),y:this.convertPropFromViewToImage(g.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Le(this,Ns,JSON.parse(JSON.stringify(l)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Ns,"f")?JSON.parse(JSON.stringify(U(this,Ns,"f"))):null}}Ns=new WeakMap;class xj extends ti{constructor(l){super(new at.Group(l.map(u=>u._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(fi.DIS_SELECTED);const u=this._fabricObject._objects;for(let g of u)setTimeout(()=>{g&&g.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(fi.DIS_DEFAULT);const u=this._fabricObject._objects;for(let g of u)setTimeout(()=>{g&&g.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(l=>l.getDrawingItem())}setChildDrawingItems(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"add"):this._fabricObject.addWithUpdate(l._getFabricObject())}removeChildItem(l){l&&l.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"remove"):this._fabricObject.removeWithUpdate(l._getFabricObject()))}}class we{static createDrawingStyle(l){if(!kI(l))throw new Error("Invalid style definition.");let u,g=we.USER_START_STYLE_ID;for(;U(we,ks,"f",Ta).has(g);)g++;u=g;const p=JSON.parse(JSON.stringify(l));p.id=u;for(let m in U(we,ks,"f",h_))p.hasOwnProperty(m)||(p[m]=U(we,ks,"f",h_)[m]);return U(we,ks,"f",Ta).set(u,p),p.id}static _getDrawingStyle(l,u){if("number"!=typeof l)throw new Error("Invalid style id.");const g=U(we,ks,"f",Ta).get(l);return g?u?JSON.parse(JSON.stringify(g)):g:null}static getDrawingStyle(l){return this._getDrawingStyle(l,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(U(we,ks,"f",Ta).values())))}static _updateDrawingStyle(l,u){if(!kI(u))throw new Error("Invalid style definition.");const g=U(we,ks,"f",Ta).get(l);if(g)for(let p in u)g.hasOwnProperty(p)&&(g[p]=u[p])}static updateDrawingStyle(l,u){this._updateDrawingStyle(l,u)}}ks=we,we.STYLE_BLUE_STROKE=1,we.STYLE_GREEN_STROKE=2,we.STYLE_ORANGE_STROKE=3,we.STYLE_YELLOW_STROKE=4,we.STYLE_BLUE_STROKE_FILL=5,we.STYLE_GREEN_STROKE_FILL=6,we.STYLE_ORANGE_STROKE_FILL=7,we.STYLE_YELLOW_STROKE_FILL=8,we.STYLE_BLUE_STROKE_TRANSPARENT=9,we.STYLE_GREEN_STROKE_TRANSPARENT=10,we.STYLE_ORANGE_STROKE_TRANSPARENT=11,we.USER_START_STYLE_ID=1024,Ta={value:new Map([[we.STYLE_BLUE_STROKE,{id:we.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE,{id:we.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE,{id:we.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_YELLOW_STROKE,{id:we.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[we.STYLE_BLUE_STROKE_FILL,{id:we.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE_FILL,{id:we.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE_FILL,{id:we.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_YELLOW_STROKE_FILL,{id:we.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_BLUE_STROKE_TRANSPARENT,{id:we.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE_TRANSPARENT,{id:we.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE_TRANSPARENT,{id:we.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},h_={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(at.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(at.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),at.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},at.Object.prototype.transparentCorners=!1,at.Object.prototype.cornerSize=20,at.Object.prototype.touchCornerSize=100,at.Object.prototype.cornerColor="rgb(254,142,20)",at.Object.prototype.cornerStyle="circle",at.Object.prototype.strokeUniform=!0,at.Object.prototype.hasBorders=!1,at.Canvas.prototype.containerClass="",at.Canvas.prototype.getPointer=function(f,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var u,g=this.upperCanvasEl,p=at.util.getPointer(f,g),m=g.getBoundingClientRect(),v=m.width||0,C=m.height||0;v&&C||("top"in m&&"bottom"in m&&(C=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(v=Math.abs(m.right-m.left))),this.calcOffset(),p.x=p.x-this._offset.left,p.y=p.y-this._offset.top,l||(p=this.restorePointerVpt(p));var D=this.getRetinaScaling();if(1!==D&&(p.x/=D,p.y/=D),0!==v&&0!==C){var O=window.getComputedStyle(g).objectFit,L=g.width,N=g.height;u={width:L/v,height:N/C};var $=L/N,q=v/C;return"contain"===O?$>q?{x:p.x*u.width,y:(p.y-(C-v/$)/2)*u.width}:{x:(p.x-(v-C*$)/2)*u.height,y:p.y*u.height}:"cover"===O?$>q?{x:(L-u.height*v)/2+p.x*u.height,y:p.y*u.height}:{x:p.x*u.width,y:(N-u.width*C)/2+p.y*u.width}:{x:p.x*u.width,y:p.y*u.height}}return{x:p.x*(u={width:1,height:1}).width,y:p.y*u.height}},at.Canvas.prototype._onTouchStart=function(f){var l=this.findTarget(f);!this.allowTouchScrolling&&f.cancelable&&f.preventDefault&&f.preventDefault(),l&&f.cancelable&&f.preventDefault&&f.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),this._resetTransformEventData();var u=this.upperCanvasEl,g=this._getEventPrefix();at.util.addListener(at.document,"touchend",this._onTouchEnd,{passive:!1}),at.util.addListener(at.document,"touchmove",this._onMouseMove,{passive:!1}),at.util.removeListener(u,g+"down",this._onMouseDown)},at.Textbox.prototype._wrapLine=function(f,l,u,g){const p=f.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var v=0,C=this.splitByGrapheme||!(!p||!p.length),D=[],O=[],L=C?at.util.string.graphemeSplit(f):f.split(this._wordJoiners),N="",B=0,j=C?"":" ",W=0,Y=0,$=0,q=!0,X=this._getWidthOfCharSpacing();g=g||0,0===L.length&&L.push([]),u-=g;for(var Q=0;Q<L.length;Q++)N=C?L[Q]:at.util.string.graphemeSplit(L[Q]),W=this._measureWord(N,l,B),B+=N.length,(v+=Y+W-X)>u&&!q?(D.push(O),O=[],v=W,q=!0):v+=X,q||C||O.push(j),O=O.concat(N),Y=C?0:this._measureWord([j],l,B),B++,q=!1,W>$&&($=W);return Q&&D.push(O),$+g>this.dynamicMinWidth&&(this.dynamicMinWidth=$-X+g),D});class Ht{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(l){this.fabricCanvas.selection=l,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(l,u,g){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,l.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=l.getFabricCanvas();else{let v=this.fabricCanvas=new at.Canvas(l,Object.assign(g,{allowTouchScrolling:!0,selection:!1}));v.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),v.lowerCanvasEl.className="",v.upperCanvasEl.className="",v.on("selection:created",function(C){const D=C.selected,O=[];for(let L of D){const N=L.getDrawingItem()._drawingLayer;N&&!O.includes(N)&&O.push(N)}for(let L of O){const N=[];for(let B of D){const j=B.getDrawingItem();j._drawingLayer===L&&N.push(j)}setTimeout(()=>{L.onSelectionChanged&&L.onSelectionChanged(N,[])},0)}}),v.on("before:selection:cleared",function(C){const D=this.getActiveObjects(),O=[];for(let L of D){const N=L.getDrawingItem()._drawingLayer;N&&!O.includes(N)&&O.push(N)}for(let L of O){const N=[];for(let B of D){const j=B.getDrawingItem();j._drawingLayer===L&&N.push(j)}setTimeout(()=>{const B=[];for(let j of N)L.hasDrawingItem(j)&&B.push(j);B.length>0&&L.onSelectionChanged&&L.onSelectionChanged([],B)},0)}}),v.on("selection:updated",function(C){const D=C.selected,O=C.deselected,L=[];for(let N of D){const B=N.getDrawingItem()._drawingLayer;B&&!L.includes(B)&&L.push(B)}for(let N of O){const B=N.getDrawingItem()._drawingLayer;B&&!L.includes(B)&&L.push(B)}for(let N of L){const B=[],j=[];for(let W of D){const Y=W.getDrawingItem();Y._drawingLayer===N&&B.push(Y)}for(let W of O){const Y=W.getDrawingItem();Y._drawingLayer===N&&j.push(Y)}setTimeout(()=>{N.onSelectionChanged&&N.onSelectionChanged(B,j)},0)}}),v.wrapperEl.style.position="absolute",l.getFabricCanvas=()=>this.fabricCanvas}let p,m;switch(this.id=u,u){case Ht.DDN_LAYER_ID:p=we.getDrawingStyle(we.STYLE_BLUE_STROKE),m=we.getDrawingStyle(we.STYLE_BLUE_STROKE_FILL);break;case Ht.DBR_LAYER_ID:p=we.getDrawingStyle(we.STYLE_ORANGE_STROKE),m=we.getDrawingStyle(we.STYLE_ORANGE_STROKE_FILL);break;case Ht.DLR_LAYER_ID:p=we.getDrawingStyle(we.STYLE_GREEN_STROKE),m=we.getDrawingStyle(we.STYLE_GREEN_STROKE_FILL);break;default:p=we.getDrawingStyle(we.STYLE_YELLOW_STROKE),m=we.getDrawingStyle(we.STYLE_YELLOW_STROKE_FILL)}for(let v of ti.arrMediaTypes)this.mapType_StateAndStyleId.set(v,{default:p.id,selected:m.id})}getId(){return this.id}setVisible(l){if(l){for(let u of this._arrFabricObject)u.visible=!0,u.hasControls=!0;this._visible=!0}else{for(let u of this._arrFabricObject)u.visible=!1,u.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(l){return l.styleId?we.getDrawingStyle(l.styleId):we.getDrawingStyle(l._mapState_StyleId.get(l.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(l,u,g,p){const m=this.getDrawingItems(v=>v._mediaType===l);for(let v of m)v.styleSelector===u&&this._changeItemStyle(v,g,!0);p||this.fabricCanvas.renderAll()}_changeItemStyle(l,u,g){if(!l||!u)return;const p=l._getFabricObject();"number"==typeof l.styleId&&(u=we.getDrawingStyle(l.styleId)),p.strokeWidth=u.lineWidth,"fill"===u.paintMode?(p.fill=u.fillStyle,p.stroke=u.fillStyle):"stroke"===u.paintMode?(p.fill="transparent",p.stroke=u.strokeStyle):"strokeAndFill"===u.paintMode&&(p.fill=u.fillStyle,p.stroke=u.strokeStyle),p.fontFamily&&(p.fontFamily=u.fontFamily),p.fontSize&&(p.fontSize=u.fontSize),p.group||(p.dirty=!0),g||this.fabricCanvas.renderAll()}_updateGroupItem(l,u,g){if(!l||!u)return;const p=l.getChildDrawingItems();if("add"===g){if(p.includes(u))return;const m=u._getFabricObject();if(this.fabricCanvas.getObjects().includes(m)){if(!this._arrFabricObject.includes(m))throw new Error("Existed in other drawing layers.");u._zIndex=null}else{let v;if(u.styleId)v=we.getDrawingStyle(u.styleId);else{const C=this.mapType_StateAndStyleId.get(u._mediaType);v=we.getDrawingStyle(C[l.styleSelector]);const D=()=>{this._changeItemStyle(u,we.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).selected),!0)},O=()=>{this._changeItemStyle(u,we.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).default),!0)};u._on("selected",D),u._on("deselected",O),u._funcChangeStyleToSelected=D,u._funcChangeStyleToDefault=O}u._drawingLayer=this,u._drawingLayerId=this.id,this._changeItemStyle(u,v,!0)}l._fabricObject.addWithUpdate(u._getFabricObject())}else{if("remove"!==g||!p.includes(u))return;u._zIndex=null,u._drawingLayer=null,u._drawingLayerId=null,u._off("selected",u._funcChangeStyleToSelected),u._off("deselected",u._funcChangeStyleToDefault),u._funcChangeStyleToSelected=null,u._funcChangeStyleToDefault=null,l._fabricObject.removeWithUpdate(u._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(l,u){if(!(l instanceof ti))throw new TypeError("Invalid 'drawingItem'.");if(l._drawingLayer){if(l._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let g=l._getFabricObject();const p=this.fabricCanvas.getObjects();let m,v;if(p.includes(g)){if(this._arrFabricObject.includes(g))return;throw new Error("Existed in other drawing layers.")}if("group"===l._mediaType){m=l.getChildDrawingItems();for(let O of m)if(O._drawingLayer&&O._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(u&&"object"==typeof u&&!Array.isArray(u))for(let O in u)g.set(O,u[O]);if(m){for(let O of m){const L=this.mapType_StateAndStyleId.get(O._mediaType);for(let N of ti.arrStyleSelectors)O._mapState_StyleId.set(N,L[N]);if(O.styleId)v=we.getDrawingStyle(O.styleId);else{v=we.getDrawingStyle(L.default);const N=()=>{this._changeItemStyle(O,we.getDrawingStyle(this.mapType_StateAndStyleId.get(O._mediaType).selected),!0)},B=()=>{this._changeItemStyle(O,we.getDrawingStyle(this.mapType_StateAndStyleId.get(O._mediaType).default),!0)};O._on("selected",N),O._on("deselected",B),O._funcChangeStyleToSelected=N,O._funcChangeStyleToDefault=B}O._drawingLayer=this,O._drawingLayerId=this.id,this._changeItemStyle(O,v,!0)}g.dirty=!0,this.fabricCanvas.renderAll()}else{const O=this.mapType_StateAndStyleId.get(l._mediaType);for(let L of ti.arrStyleSelectors)l._mapState_StyleId.set(L,O[L]);if(l.styleId)v=we.getDrawingStyle(l.styleId);else{v=we.getDrawingStyle(O.default);const L=()=>{this._changeItemStyle(l,we.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).selected))},N=()=>{this._changeItemStyle(l,we.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).default))};l._on("selected",L),l._on("deselected",N),l._funcChangeStyleToSelected=L,l._funcChangeStyleToDefault=N}this._changeItemStyle(l,v)}l._zIndex=this.id,l._drawingLayer=this,l._drawingLayerId=this.id;const C=this._arrFabricObject.length;let D=p.length;if(C)D=p.indexOf(this._arrFabricObject[C-1])+1;else for(let O=0;O<p.length;O++)if(l._zIndex<p[O].getDrawingItem()._zIndex){D=O;break}this._arrDrwaingItem.push(l),this._arrFabricObject.push(g),g.visible=!!this._visible,this.fabricCanvas.insertAt(g,D,!1)}addDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)l._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");l._setEditable(!0)}this._addDrawingItem(l),l.updatePosition()}addDrawingItems(l){for(let u of l)this.addDrawingItem(u)}removeDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(l))return;if(l._zIndex=null,l._drawingLayer=null,l._drawingLayerId=null,"group"===l._mediaType){const g=l.getChildDrawingItems();for(let p of g)p._zIndex=null,p._drawingLayer=null,p._drawingLayerId=null,p._off("selected",p._funcChangeStyleToSelected),p._off("deselected",p._funcChangeStyleToDefault),p._funcChangeStyleToSelected=null,p._funcChangeStyleToDefault=null,p._mapState_StyleId.clear()}else l._off("selected",l._funcChangeStyleToSelected),l._off("deselected",l._funcChangeStyleToDefault),l._funcChangeStyleToSelected=null,l._funcChangeStyleToDefault=null,l._mapState_StyleId.clear();const u=l._getFabricObject();"selected"===l.styleSelector&&(u.group?u.group.removeWithUpdate(u):this.fabricCanvas._activeObject=null,l.setState(fi.DIS_DEFAULT)),this.fabricCanvas.remove(u),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(l),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(u),1)}removeDrawingItems(l){for(let u of l)this.removeDrawingItem(u)}setDrawingItems(l){this.clearDrawingItems(),this.addDrawingItems(l)}getDrawingItems(l){return l&&"function"==typeof l?this._arrDrwaingItem.filter(l):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const l=this.fabricCanvas.getActiveObjects(),u=[];for(let g of l)this._arrFabricObject.includes(g)&&u.push(g.getDrawingItem());return u}hasDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(l)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(l,u,g){u?u.forEach(v=>v.toLowerCase()):u=ti.arrMediaTypes,g?g.forEach(v=>v.toLowerCase()):g=ti.arrStyleSelectors;const p=we.getDrawingStyle(l);if(!p)throw new Error(`The 'drawingStyle' with id '${l}' doesn't exist.`);let m;for(let v of u)if(m=this.mapType_StateAndStyleId.get(v),m)for(let C of g){this._changeMediaTypeCurStyleInStyleSelector(v,C,p,!0),m[C]=l;for(let D of this._arrDrwaingItem)D._mediaType===v&&D._mapState_StyleId.set(C,l)}this.fabricCanvas.renderAll()}setDefaultStyle(l,u,g){const p=[];g&Ln.DIMT_RECTANGLE&&p.push("rect"),g&Ln.DIMT_QUADRILATERAL&&p.push("quad"),g&Ln.DIMT_TEXT&&p.push("text"),g&Ln.DIMT_ARC&&p.push("arc"),g&Ln.DIMT_IMAGE&&p.push("image"),g&Ln.DIMT_POLYGON&&p.push("polygon"),g&Ln.DIMT_LINE&&p.push("line");const m=[];u&fi.DIS_DEFAULT&&m.push("default"),u&fi.DIS_SELECTED&&m.push("selected"),this._setDefaultStyle(l,p.length?p:null,m.length?m:null)}setMode(l){if("viewer"===(l=l.toLowerCase())){for(let u of this._arrDrwaingItem)u._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==l)throw new RangeError("Invalid value.");for(let u of this._arrDrwaingItem)u._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(l,u){this.fabricCanvas.setDimensions(l,u)}_setObjectFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=l,this.fabricCanvas.upperCanvasEl.style.objectFit=l}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let l of this._arrDrwaingItem){const u=this._getItemCurrentStyle(l);this._changeItemStyle(l,u,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Ht.DDN_LAYER_ID=1,Ht.DBR_LAYER_ID=2,Ht.DLR_LAYER_ID=3,Ht.USER_DEFINED_LAYER_BASE_ID=100,Ht.TIP_LAYER_ID=999;class Aj{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(l,u){if(this.getDrawingLayer(u))throw new Error("Existed drawing layer id.");const g=new Ht(l,u,{enableRetinaScaling:!1});return g._manager=this,this._arrDrawingLayer.push(g),this._switchPointerEvent(),g}deleteDrawingLayer(l){const u=this.getDrawingLayer(l);if(!u)return;const g=this._arrDrawingLayer;u.dispose(),g.splice(g.indexOf(u),1),this._switchPointerEvent()}clearDrawingLayers(){for(let l of this._arrDrawingLayer)l.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(l){for(let u of this._arrDrawingLayer)if(u.getId()===l)return u;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const l=this._getFabricCanvas().getActiveObjects(),u=[];for(let g of l)u.push(g.getDrawingItem());return u}setDimensions(l,u){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(l,u)}setObjectFit(l){for(let u of this._arrDrawingLayer)u&&u._setObjectFit(l)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(l){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=l?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let l of this._arrDrawingLayer)l.getMode()}}class Rj extends Ij{constructor(l,u,g,p,m){super(l,{x:u,y:g,width:p,height:0},m),xa.set(this,void 0),yc.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var v=0,C=0,D=this._textLines.length;C<D;C++)v+=this.getHeightOfLine(C);return v+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(l){Le(this,xa,l,"f"),U(this,yc,"f")&&clearTimeout(U(this,yc,"f")),U(this,xa,"f")>=0&&Le(this,yc,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},U(this,xa,"f")),"f")}getDuration(){return U(this,xa,"f")}}xa=new WeakMap,yc=new WeakMap,gi=new WeakMap,Cc=new WeakMap,wc=new WeakMap,Ec=new WeakMap,Aa=new WeakSet,UI=function(f,l,u,g,p,m){const v=new Rj(f,l,u,g,m);return v.coordinateBase=p,v},GI=function(f,l){l.hasDrawingItem(f)||l.addDrawingItems([f])},HI=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},WI=function(){if(!this._tip)return;const f=U(this,gi,"f");this._tip.coordinateBase=f.coordinateBase,this._tip.setTextRect({x:f.topLeftPoint.x,y:f.topLeftPoint.y,width:f.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class p_ extends HTMLElement{constructor(){super(),od.set(this,void 0);const l=document.createElement("template").content,u=document.createElement("div");u.setAttribute("class","wrapper"),l.appendChild(u),Le(this,od,u,"f");const g=document.createElement("slot");g.setAttribute("name","single-frame-input-container"),u.append(g);const p=document.createElement("slot");p.setAttribute("name","content"),u.append(p);const m=document.createElement("slot");m.setAttribute("name","drawing-layer"),u.append(m);const v=document.createElement("style");v.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',l.appendChild(v),this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}getWrapper(){return U(this,od,"f")}setElement(l,u){if(!(u instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");this.removeElement(l),u.setAttribute("slot",l),this.appendChild(u)}getElement(l){if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${l}"]`)}removeElement(l){var u;if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");null===(u=this.querySelectorAll(`[slot="${l}"]`))||void 0===u||u.forEach(g=>g.remove())}}od=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",p_);class Ra extends HTMLElement{constructor(){super();const l=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}showScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="")}hideScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="none")}getElement(l){return this.shadowRoot.querySelector(l)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class an extends class Oj{constructor(){Aa.add(this),gi.set(this,void 0),Cc.set(this,void 0),wc.set(this,void 0),Ec.set(this,!0),this._drawingLayerManager=new Aj}createDrawingLayerBaseCvs(l,u,g="contain"){if("number"!=typeof l||l<=1)throw new Error("Invalid 'width'.");if("number"!=typeof u||u<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");const p=document.createElement("canvas");return p.width==l&&p.height==u||(p.width=l,p.height=u),p.style.objectFit=g,p}_createDrawingLayer(l,u,g,p){if(!this._layerBaseCvs){let C;try{C=this.getContentDimensions()}catch(D){if("Invalid content dimensions."!==(D.message||D))throw D}u||(u=(null==C?void 0:C.width)||1280),g||(g=(null==C?void 0:C.height)||720),p||(p=(null==C?void 0:C.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(u,g,p)}const m=this._layerBaseCvs,v=this._drawingLayerManager.createDrawingLayer(m,l);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",m.parentElement),v}createDrawingLayer(){let l;for(let u=Ht.USER_DEFINED_LAYER_BASE_ID;;u++)if(!this._drawingLayerManager.getDrawingLayer(u)&&u!==Ht.TIP_LAYER_ID){l=u;break}return this._createDrawingLayer(l)}deleteDrawingLayer(l){var u;this._drawingLayerManager.deleteDrawingLayer(l),this._drawingLayerManager.getAllDrawingLayers().length||(null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(l){if("number"!=typeof l)throw new TypeError("Invalid id.");if(l<Ht.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${l} is not defined by users.`);this.deleteDrawingLayer(l)}_clearDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l)this.deleteDrawingLayer(u.getId())}clearUserDefinedDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l){const g=u.getId();g<Ht.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(g)}}getDrawingLayer(l){return l==Ht.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(l)||([Ht.DDN_LAYER_ID,Ht.DBR_LAYER_ID,Ht.DLR_LAYER_ID].includes(l)?this._createDrawingLayer(l):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(l=>l.getId()>=0&&l.getId()!==Ht.TIP_LAYER_ID)}updateDrawingLayers(l){((u,g,p)=>{if(!(u<=1||g<=1)){if(!["contain","cover"].includes(p))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:u,height:g},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(p)}})(l.width,l.height,l.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(l){if(!(LI(u=l)&&Dj(u.topLeftPoint)&&Da(u.width))||u.width<=0||!Da(u.duration)||"coordinateBase"in u&&!["view","image"].includes(u.coordinateBase))throw new Error("Invalid tip config.");var u;Le(this,gi,JSON.parse(JSON.stringify(l)),"f"),U(this,gi,"f").coordinateBase||(U(this,gi,"f").coordinateBase="view"),Le(this,wc,l.duration,"f"),U(this,Aa,"m",WI).call(this)}getTipConfig(){return U(this,gi,"f")?U(this,gi,"f"):null}setTipVisible(l){if("boolean"!=typeof l)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",l),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Le(this,Ec,l,"f")}isTipVisible(){return U(this,Ec,"f")}updateTipMessage(l){if(!U(this,gi,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=we.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Ht.TIP_LAYER_ID)||this._createDrawingLayer(Ht.TIP_LAYER_ID)),this._tip?this._tip.set("text",l):this._tip=U(this,Aa,"m",UI).call(this,l,U(this,gi,"f").topLeftPoint.x,U(this,gi,"f").topLeftPoint.y,U(this,gi,"f").width,U(this,gi,"f").coordinateBase,this._tipStyleId),U(this,Aa,"m",GI).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",U(this,Ec,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),U(this,Cc,"f")&&clearTimeout(U(this,Cc,"f")),U(this,wc,"f")>=0&&Le(this,Cc,setTimeout(()=>{U(this,Aa,"m",HI).call(this)},U(this,wc,"f")),"f")}}{static get engineResourcePath(){return tn.engineResourcePaths.dce}static set defaultUIElementURL(l){an._defaultUIElementURL=l}static get defaultUIElementURL(){var l;return null===(l=an._defaultUIElementURL)||void 0===l?void 0:l.replace("@engineResourcePath/",an.engineResourcePath)}static createInstance(l){return oe(function*(){customElements.get(an.uiComponentName)||customElements.define(an.uiComponentName,Ra);const u=new an;return yield u.setUIElement(l||an.defaultUIElementURL),u})()}static _transformCoordinates(l,u,g,p,m,v,C){const O=C/m;l.x=Math.round(l.x/(v/p)+u),l.y=Math.round(l.y/O+g)}set _singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(l!==U(this,Ic,"f")){if(Le(this,Ic,l,"f"),U(this,Rt,"m",pi).call(this))Le(this,pn,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!U(this,pn,"f")){const u=document.createElement("video");u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.objectFit=this.getVideoFit(),u.setAttribute("autoplay","true"),u.setAttribute("playsinline","true"),u.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Mn.OS)&&u.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Le(this,pn,u,"f");const g=document.createElement("div");g.append(u),g.style.overflow="hidden",this._videoContainer=g,this._innerComponent.setElement("content",g)}U(this,Rt,"m",pi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return U(this,Ic,"f")}get disposed(){return U(this,d_,"f")}constructor(){var l;super(),l=this,Rt.add(this),bc.set(this,void 0),Dc.set(this,void 0),Sc.set(this,void 0),this.containerClassName="dce-video-container",pn.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,ad.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,ld.set(this,!1),cd.set(this,!1),Bs.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{U(this,Rt,"m",xc).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&U(this,Rt,"m",g_).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{an._onLog&&an._onLog("window resize event triggered."),U(this,Bs,"f").width===document.documentElement.clientWidth&&U(this,Bs,"f").height===document.documentElement.clientHeight||(U(this,Bs,"f").width=document.documentElement.clientWidth,U(this,Bs,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Ic.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!U(this,Rt,"m",pi).call(this))return;let u;if(this._singleFrameInputContainer)u=this._singleFrameInputContainer.firstElementChild;else{u=document.createElement("input"),u.setAttribute("type","file"),"camera"===this._singleFrameMode?(u.setAttribute("capture",""),u.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(u.removeAttribute("capture"),u.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),u.addEventListener("change",oe(function*(){const p=u.files[0];u.value="";{const m=function(){var j=oe(function*(W){let Y=null,$=null;if("undefined"!=typeof createImageBitmap)try{if(Y=yield createImageBitmap(W),Y)return Y}catch(X){}var q;return Y||($=yield(q=W,new Promise((X,Q)=>{let pe=URL.createObjectURL(q),ve=new Image;ve.src=pe,ve.onload=()=>{URL.revokeObjectURL(ve.src),X(ve)},ve.onerror=Te=>{Q(new Error("Can't convert blob to image : "+(Te instanceof Event?Te.type:Te)))}}))),$});return function(Y){return j.apply(this,arguments)}}(),v=(j,W,Y,$)=>{j.width==Y&&j.height==$||(j.width=Y,j.height=$);const q=j.getContext("2d");q.clearRect(0,0,j.width,j.height),q.drawImage(W,0,0)},C=yield m(p),D=C instanceof HTMLImageElement?C.naturalWidth:C.width,O=C instanceof HTMLImageElement?C.naturalHeight:C.height;let L=l._cvsSingleFrameMode;const N=null==L?void 0:L.width,B=null==L?void 0:L.height;L||(L=document.createElement("canvas"),l._cvsSingleFrameMode=L),v(L,C,D,O),l._innerComponent.setElement("content",L),N===L.width&&B===L.height||l.eventHandler.fire("content:updated",null,{async:!1})}l._onSingleFrameAcquired&&setTimeout(()=>{l._onSingleFrameAcquired(l._cvsSingleFrameMode)},0)})),u.style.position="absolute",u.style.top="-9999px",u.style.backgroundColor="transparent",u.style.color="transparent";const g=document.createElement("div");g.append(u),this._innerComponent.setElement("single-frame-input-container",g),this._singleFrameInputContainer=g}null==u||u.click()},Tc.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(u,g)=>{var p,m,v,C;if(this.disposed||(this.clearAllInnerDrawingItems(),!u))return;const D=u.originalImageTag;if(!D)return;const O=u.items;if(!(null==O?void 0:O.length))return;const L=(null===(p=D.cropRegion)||void 0===p?void 0:p.left)||0,N=(null===(m=D.cropRegion)||void 0===m?void 0:m.top)||0,B=(null===(v=D.cropRegion)||void 0===v?void 0:v.right)?D.cropRegion.right-L:D.originalWidth,j=(null===(C=D.cropRegion)||void 0===C?void 0:C.bottom)?D.cropRegion.bottom-N:D.originalHeight,W=D.currentWidth,Y=D.currentHeight,$=(Q,pe,ve,Te,Ae,P,Ee,Be,Je=[],S)=>{pe.forEach(b=>an._transformCoordinates(b,ve,Te,Ae,P,Ee,Be));const w=new Tj({points:[{x:pe[0].x,y:pe[0].y},{x:pe[1].x,y:pe[1].y},{x:pe[2].x,y:pe[2].y},{x:pe[3].x,y:pe[3].y}]},S);for(let b of Je)w.addNote(b);Q.addDrawingItems([w]),U(this,Tc,"f").push(w)};let q,X;for(let Q of O)switch(Q.type){case nn.CRIT_ORIGINAL_IMAGE:break;case nn.CRIT_BARCODE:q=this.getDrawingLayer(Ht.DBR_LAYER_ID),X=[{name:"format",content:Q.formatString},{name:"text",content:Q.text}],(null==g?void 0:g.isBarcodeVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,B,j,W,Y,X):$(q,Q.location.points,L,N,B,j,W,Y,X,we.STYLE_ORANGE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,B,j,W,Y,X);break;case nn.CRIT_TEXT_LINE:q=this.getDrawingLayer(Ht.DLR_LAYER_ID),X=[{name:"text",content:Q.text}],g.isLabelVerifyOpen?Q.verified?$(q,Q.location.points,L,N,B,j,W,Y,X):$(q,Q.location.points,L,N,B,j,W,Y,X,we.STYLE_GREEN_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,B,j,W,Y,X);break;case nn.CRIT_DETECTED_QUAD:q=this.getDrawingLayer(Ht.DDN_LAYER_ID),(null==g?void 0:g.isDetectVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,B,j,W,Y,[]):$(q,Q.location.points,L,N,B,j,W,Y,[],we.STYLE_BLUE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,B,j,W,Y,[]);break;case nn.CRIT_NORMALIZED_IMAGE:q=this.getDrawingLayer(Ht.DDN_LAYER_ID),(null==g?void 0:g.isNormalizeVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,B,j,W,Y,[]):$(q,Q.location.points,L,N,B,j,W,Y,[],we.STYLE_BLUE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,B,j,W,Y,[]);break;case nn.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},d_.set(this,!1),this.eventHandler=new BI,this.eventHandler.on("content:updated",()=>{U(this,bc,"f")&&clearTimeout(U(this,bc,"f")),Le(this,bc,setTimeout(()=>{if(this.disposed)return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}this.updateDrawingLayers(u),this.updateConvertedRegion(u)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{U(this,Dc,"f")&&clearTimeout(U(this,Dc,"f")),Le(this,Dc,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(l){l instanceof HTMLTemplateElement?(window._dce_default_template=l,this.UIElement=new Ra):this.UIElement=l,this._unbindUI(),this._bindUI()}setUIElement(l){var u=this;return oe(function*(){let g;if(g="string"==typeof l?yield o_(l):l,g instanceof HTMLDivElement&&0==g.childElementCount){const p=yield o_(an.defaultUIElementURL);p instanceof HTMLTemplateElement?(window._dce_default_template=p,g.append(new Ra)):g.append(p),u._setUIElement(g)}else u._setUIElement(g)})()}getUIElement(){return this.UIElement}_bindUI(){var l;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let u,g=this.UIElement;if(g instanceof Ra?u=g.getElement(`.${this.containerClassName}`):g instanceof HTMLDivElement&&1===g.childElementCount&&g.firstElementChild instanceof Ra?(u=g.firstElementChild.getElement(`.${this.containerClassName}`),g=g.firstElementChild):u=g.classList.contains(this.containerClassName)?g:g.querySelector(`.${this.containerClassName}`),!u)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new p_,u.appendChild(this._innerComponent),!U(this,Rt,"m",pi).call(this)){const p=document.createElement("video");p.style.position="absolute",p.style.left="0",p.style.top="0",p.style.width="100%",p.style.height="100%",p.style.objectFit=this.getVideoFit(),p.setAttribute("autoplay","true"),p.setAttribute("playsinline","true"),p.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Mn.OS)&&p.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Le(this,pn,p,"f");const m=document.createElement("div");m.append(p),m.style.overflow="hidden",this._videoContainer=m,this._innerComponent.setElement("content",m)}if(g instanceof Ra?(this._selRsl=g.getElement(".dce-sel-resolution"),this._selMinLtr=g.getElement(".dlr-sel-minletter"),this._divScanArea=g.getElement(".dce-scanarea"),this._divScanLight=g.getElement(".dce-scanlight"),this._bgLoading=g.getElement(".dce-bg-loading"),this._bgCamera=g.getElement(".dce-bg-camera"),this._selCam=g.getElement(".dce-sel-camera"),this._optGotRsl=g.getElement(".dce-opt-gotResolution"),this._btnClose=g.getElement(".dce-btn-close"),this._optGotMinLtr=g.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=g.querySelector(".dce-sel-resolution"),this._selMinLtr=g.querySelector(".dlr-sel-minletter"),this._divScanArea=g.querySelector(".dce-scanarea"),this._divScanLight=g.querySelector(".dce-scanlight"),this._bgLoading=g.querySelector(".dce-bg-loading"),this._bgCamera=g.querySelector(".dce-bg-camera"),this._selCam=g.querySelector(".dce-sel-camera"),this._optGotRsl=g.querySelector(".dce-opt-gotResolution"),this._btnClose=g.querySelector(".dce-btn-close"),this._optGotMinLtr=g.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||U(this,Rt,"m",pi).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||U(this,Rt,"m",pi).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||U(this,Rt,"m",xc).call(this),U(this,Rt,"m",pi).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),U(this,Rt,"m",pi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(m=>{var v;an._onLog&&an._onLog("resize observer triggered.");for(let C of m)C.target===(null===(v=this._innerComponent)||void 0===v?void 0:v.getWrapper())&&this._videoResizeListener()}));const p=null===(l=this._innerComponent)||void 0===l?void 0:l.getWrapper();p&&this._resizeObserver.observe(p)}U(this,Bs,"f").width=document.documentElement.clientWidth,U(this,Bs,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var l,u,g,p;U(this,Rt,"m",pi).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),U(this,Rt,"m",xc).call(this),null===(l=this._drawingLayerManager)||void 0===l||l.clearDrawingLayers(),null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(g=this._innerComponent)||void 0===g||g.remove(),this._innerComponent=null,Le(this,pn,null,"f"),null===(p=this._videoContainer)||void 0===p||p.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(l,u){if(!this._selCam)return;let g;this._selCam.textContent="";for(let p of u){const m=document.createElement("option");m.value=p.deviceId,m.innerText=p.label,this._selCam.append(m),p.deviceId&&l&&l.deviceId==p.deviceId&&(g=m)}this._selCam.value=g?g.value:""}_renderResolutionInfo(l){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",l.width),this._optGotRsl.setAttribute("data-height",l.height),this._optGotRsl.innerText="got "+l.width+"x"+l.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return U(this,pn,"f")}isVideoLoaded(){return!!U(this,pn,"f")&&4==U(this,pn,"f").readyState}setVideoFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);if(this.videoFit=l,!U(this,pn,"f")||(U(this,pn,"f").style.objectFit=l,U(this,Rt,"m",pi).call(this)))return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}U(this,Rt,"m",hd).call(this,u,this.getConvertedRegion()),this.updateDrawingLayers(u)}getVideoFit(){return this.videoFit}getContentDimensions(){var l,u,g,p;let m,v,C;if(U(this,Rt,"m",pi).call(this)?(m=null===(g=this._cvsSingleFrameMode)||void 0===g?void 0:g.width,v=null===(p=this._cvsSingleFrameMode)||void 0===p?void 0:p.height,C="contain"):(m=null===(l=U(this,pn,"f"))||void 0===l?void 0:l.videoWidth,v=null===(u=U(this,pn,"f"))||void 0===u?void 0:u.videoHeight,C=this.getVideoFit()),!m||!v)throw new Error("Invalid content dimensions.");return{width:m,height:v,objectFit:C}}updateConvertedRegion(l){const u=id.convert(this.scanRegion,l.width,l.height);Le(this,ad,u,"f"),U(this,Sc,"f")&&clearTimeout(U(this,Sc,"f")),Le(this,Sc,setTimeout(()=>{let g;try{g=this.getContentDimensions()}catch(p){if("Invalid content dimensions."===(p.message||p))return;throw p}U(this,Rt,"m",ud).call(this,g,u),U(this,Rt,"m",hd).call(this,g,u)},0),"f")}getConvertedRegion(){return U(this,ad,"f")}setScanRegion(l){if(null!=l&&!r_(l)&&!Xr(l))throw TypeError("Invalid 'region'.");let u;this.scanRegion=l?JSON.parse(JSON.stringify(l)):null;try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}this.updateConvertedRegion(u)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(l){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const u=U(this,pn,"f").videoWidth,g=U(this,pn,"f").videoHeight,p=this.getVideoFit(),{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let C;const D={x:0,y:0,width:u,height:g,isMeasuredInPercentage:!1};if("cover"===p&&(m/v<u/g?(C=v/g,D.x=Math.floor((u-m/C)/2),D.y=0,D.width=Math.ceil(m/C),D.height=g):(C=m/u,D.x=0,D.y=Math.floor((g-v/C)/2),D.width=u,D.height=Math.ceil(v/C))),null==l?void 0:l.inPixels)return D;const O=D;return O.x=Math.ceil(O.x/g*100),O.y=Math.ceil(O.y/u*100),O.width=Math.floor(O.width/u*100),O.height=Math.floor(O.height/g*100),O.isMeasuredInPercentage=!0,D}setScanRegionMask(l,u,g,p){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||U(this,Rt,"m",f_).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=we.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=we.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const m=this._drawingLayerOfMask.width,v=this._drawingLayerOfMask.height,C=new Ia({x:0,y:0,width:m,height:v},this._maskBackRectStyleId),D=new Ia({x:-m/2,y:-v/2+u,width:l,height:p}),O=new Ia({x:-m/2+l+g,y:-v/2+u,width:m-l-g<0?0:m-l-g,height:p}),L=new Ia({x:-m/2,y:-v/2,width:m,height:u}),N=new Ia({x:-m/2,y:-v/2+u+p,width:m,height:v-u-p<0?0:v-u-p});D.set("strokeWidth",0),O.set("strokeWidth",0),L.set("strokeWidth",0),N.set("strokeWidth",0);const B=new xj([D,O,L,N])._getFabricObject();C.set("clipPath",B);const j=new Ia({x:l,y:u,width:g,height:p},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([C,j])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(l){Le(this,ld,l,"f"),l?U(this,Rt,"m",zI).call(this):U(this,Rt,"m",f_).call(this)}setScanRegionMaskVisible(l){this._setScanRegionMaskVisible(l),this._userSetMaskVisible=l}isScanRegionMaskVisible(){return U(this,ld,"f")}setScanRegionMaskStyle(l){if(!l)return;let u;l.fillStyle&&(this.regionMaskFillStyle=l.fillStyle),l.strokeStyle&&(this.regionMaskStrokeStyle=l.strokeStyle),l.lineWidth&&(this.regionMaskLineWidth=l.lineWidth),this._maskBackRectStyleId&&we.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&we.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}U(this,Rt,"m",ud).call(this,u,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(l){Le(this,cd,l,"f"),l?U(this,Rt,"m",g_).call(this):U(this,Rt,"m",xc).call(this)}setScanLaserVisible(l){this._setScanLaserVisible(l),this._userSetLaserVisible=l}isScanLaserVisible(){return U(this,cd,"f")}_updateVideoContainer(){if(!U(this,pn,"f")||U(this,Rt,"m",pi).call(this))return;let l=1;const u=U(this,pn,"f").style.transform.match(/scale\((.+)\)/);u&&(l=parseFloat(u[1]));const g=this._videoContainer;if("contain"===this.videoFit&&l>1){const p=U(this,pn,"f").videoWidth,m=U(this,pn,"f").videoHeight,{width:v,height:C}=this._innerComponent.getBoundingClientRect(),D=p/m;if(v/C<D){let O=v/D;g.style.left="0",g.style.top=(C-O)/2/C*100+"%",g.style.width="100%",g.style.height=O/C*100+"%"}else{let O=C*D;g.style.left=(v-O)/2/v*100+"%",g.style.top="0",g.style.width=O/v*100+"%",g.style.height="100%"}}else g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%"}updateLayers(){let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}const u=this.getConvertedRegion();U(this,Rt,"m",hd).call(this,l,u),this.updateDrawingLayers(l),U(this,Rt,"m",ud).call(this,l,u)}clearAllInnerDrawingItems(){U(this,Tc,"f").forEach(l=>l.remove()),U(this,Tc,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"disposed",{value:!0})}}function K(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function pt(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}bc=new WeakMap,Dc=new WeakMap,Sc=new WeakMap,pn=new WeakMap,ad=new WeakMap,ld=new WeakMap,cd=new WeakMap,Bs=new WeakMap,Ic=new WeakMap,Tc=new WeakMap,d_=new WeakMap,Rt=new WeakSet,pi=function(){return"disabled"!==this._singleFrameMode},ud=function(f,l){!l||0===l.x&&0===l.y&&l.width===f.width&&l.height===f.height?this.clearScanRegionMask():this.setScanRegionMask(l.x,l.y,l.width,l.height)},zI=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},f_=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},g_=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},xc=function(){this._divScanLight&&(this._divScanLight.style.display="none")},hd=function(f,l){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:u,height:g,objectFit:p}=f;l||(l={x:0,y:0,width:u,height:g});const{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)return;const C=m/v,D=u/g;let O,L,N,B,j=1;if("contain"===p)C<D?(j=m/u,O=0,L=(v-g*j)/2):(j=v/g,O=(m-u*j)/2,L=0),O+=l.x*j,L+=l.y*j,N=l.width*j,B=l.height*j;else if("cover"===p)if(C<D){j=v/g,O=l.x*j-(u*j-m)/2,O=Math.max(O,0),O=Math.min(O,m),L=l.y*j;let W=(l.x+l.width)*j-(u*j-m)/2;W=Math.max(W,0),W=Math.min(W,m),N=W-O,B=l.height*j}else{j=m/u,O=l.x*j,L=l.y*j-(g*j-v)/2,L=Math.max(L,0),L=Math.min(L,v);let W=(l.y+l.height)*j-(g*j-v)/2;W=Math.max(W,0),W=Math.min(W,v),N=l.width*j,B=W-L}else O=0,L=0,N=0,B=0;this._divScanArea.style.left=O+"px",this._divScanArea.style.top=L+"px",this._divScanArea.style.width=N+"px",this._divScanArea.style.height=B+"px"},an.uiComponentName="default-camera-view",an._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const YI="undefined"==typeof self;let Ac,Rc,dd,m_,jn;function Xn(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function nr(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}"undefined"!=typeof navigator&&(Ac=navigator,Rc=Ac.userAgent,dd=Ac.platform,m_=Ac.mediaDevices),function(){if(!YI){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ac.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:dd,search:"Win"},Mac:{str:dd},Linux:{str:dd}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let O=v.verStr||Rc,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||Rc).indexOf(v.search||m)){u=m;for(let N of L){let B=O.indexOf(N);if(-1!=B){g=parseFloat(O.substring(B+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Rc).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=Rc.indexOf("Windows NT")&&(p="HarmonyOS"),jn={browser:u,version:g,OS:p}}YI&&(jn={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let Zr=class{static multiply(l,u){const g=[];for(let p=0;p<3;p++){const m=u.slice(3*p,3*p+3);for(let v=0;v<3;v++){const C=[l[v],l[v+3],l[v+6]].reduce((D,O,L)=>D+O*m[L],0);g.push(C)}}return g}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,g){return Ue.multiply(l,[1,0,0,0,1,0,u,g,1])}static rotate(l,u){var g=Math.cos(u),p=Math.sin(u);return Ue.multiply(l,[g,-p,0,p,g,0,0,0,1])}static scale(l,u,g){return Ue.multiply(l,[u,0,0,0,g,0,0,0,1])}};var mt,Kr,Qr,fd,Oa,Oc,Mc,Ma,gd,_o,pd,__,Pe,et,Ct,md,_d,Mt,Pi,Jr,La,vd,Ir,es,mi,Fa,Pa,Lc,yd,Na,vo,ts,ns,v_,mn,y_,yo,$I,Cd,wd,XI,ir,C_,w_,ka,Fc,Ed,_i,Ba,E_,b_,qI;!function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(mt||(mt={}));class Xe{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(nr(Xe,Kr,!1,"f",Qr),!1):(nr(Xe,Kr,!0,"f",Qr),!0)}get disposed(){return Xn(this,gd,"f")}constructor(){fd.set(this,mt.RGBA),Oa.set(this,null),Oc.set(this,null),Mc.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ma.set(this,null),gd.set(this,!1)}drawImage(l,u,g,p,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!g||!p)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Xn(Xe,Kr,"f",Qr)&&Xe.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!Xn(Xe,Kr,"f",Qr))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let C;Xe._onLog&&(C=Date.now(),Xe._onLog("drawImage(), START: "+C));let D=0,O=0,L=g,N=p,B=0,j=0,W=g,Y=p;m&&(m.sx&&(D=Math.round(m.sx)),m.sy&&(O=Math.round(m.sy)),m.sWidth&&(L=Math.round(m.sWidth)),m.sHeight&&(N=Math.round(m.sHeight)),m.dx&&(B=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(W=Math.round(m.dWidth)),m.dHeight&&(Y=Math.round(m.dHeight)));let $,q=mt.RGBA;if((null==v?void 0:v.pixelFormat)&&(q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&($=v.bufferContainer,$.length<4*W*Y))throw new Error("Unexpected size of the 'bufferContainer'.");const X=l;if(!Xn(Xe,Kr,"f",Qr)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){Xe._onLog&&Xe._onLog("drawImage() in context2d."),X.ctx2d||(X.ctx2d=X.getContext("2d",{willReadFrequently:!0}));const Q=X.ctx2d;if(!Q)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(X.width<B+W||X.height<j+Y)&&(X.width=B+W,X.height=j+Y),Q.drawImage(u,D,O,L,N,B,j,W,Y),Xe._onLog&&Xe._onLog("drawImage() in context2d end. Costs: "+(Date.now()-C)),{context:Q,pixelFormat:mt.RGBA,bUseWebGL:!1}}Xe._onLog&&Xe._onLog("drawImage() in WebGL.");try{(X.width<B+W||X.height<j+Y)&&(X.width=B+W,X.height=j+Y,X.ctxWebGL&&X.ctxWebGL.viewport(0,0,B+W,j+Y));const Q=X.ctxWebGL||X.getContext("webgl",{antialias:!1})||X.getContext("experimental-webgl",{antialias:!1});if(!Q){Xe._onLog&&Xe._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const P=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw P.name="WebGLError",P}if(!X.ctxWebGL||q!==Xn(this,fd,"f")){X.ctxWebGL=Q;const P=_=>{const y=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,y),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW);const I=_.createBuffer();return _.bindBuffer(_.ARRAY_BUFFER,I),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW),{positions:y,texCoords:I}},Ee=_=>{const y=_.createTexture();return _.bindTexture(_.TEXTURE_2D,y),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),y},Be=(_,y)=>{const I=_.createProgram();if(y.forEach(M=>_.attachShader(I,M)),_.linkProgram(I),!_.getProgramParameter(I,_.LINK_STATUS)){const M=new Error(`An error occured linking the program: ${_.getProgramInfoLog(I)}.`);throw M.name="WebGLError",M}return _.useProgram(I),I},Je=(_,y,I)=>{const M=_.createShader(y);if(_.shaderSource(M,I),_.compileShader(M),!_.getShaderParameter(M,_.COMPILE_STATUS)){const x=new Error(`An error occured compiling the shader: ${_.getShaderInfoLog(M)}.`);throw x.name="WebGLError",x}return M},S="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let w="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(w=q.slice(0,3));const b=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${w} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,T=Be(Q,[Je(Q,Q.VERTEX_SHADER,S),Je(Q,Q.FRAGMENT_SHADER,b)]);nr(this,Oc,{program:T,attribLocations:{vertexPosition:Q.getAttribLocation(T,"a_position"),texPosition:Q.getAttribLocation(T,"a_texCoord")},uniformLocations:{uSampler:Q.getUniformLocation(T,"u_image"),uColorFactor:Q.getUniformLocation(T,"uColorFactor"),uMatrix:Q.getUniformLocation(T,"u_matrix"),uTextureMatrix:Q.getUniformLocation(T,"u_textureMatrix")}},"f"),nr(this,Mc,P(Q),"f"),nr(this,Oa,Ee(Q),"f"),nr(this,fd,q,"f")}const pe=(P,Ee,Be)=>{P.bindBuffer(P.ARRAY_BUFFER,Ee),P.enableVertexAttribArray(Be),P.vertexAttribPointer(Be,2,P.FLOAT,!1,0,0)},Te=(P,Ee,Be,Je)=>{P.clearColor(0,0,0,1),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT),pe(P,Be.positions,Ee.attribLocations.vertexPosition),pe(P,Be.texCoords,Ee.attribLocations.texPosition),P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,Je),P.uniform1i(Ee.uniformLocations.uSampler,0),P.uniform1f(Ee.uniformLocations.uColorFactor,[mt.GREY,mt.GREY32].includes(q)?1:0);let S,w,b=Zr.translate(Zr.identity(),-1,-1);b=Zr.scale(b,2,2),b=Zr.scale(b,1/P.canvas.width,1/P.canvas.height),S=Zr.translate(b,B,j),S=Zr.scale(S,W,Y),P.uniformMatrix3fv(Ee.uniformLocations.uMatrix,!1,S),w=Zr.translate(Zr.identity(),D/g,O/p),w=Zr.scale(w,L/g,N/p),P.uniformMatrix3fv(Ee.uniformLocations.uTextureMatrix,!1,w),P.drawArrays(P.TRIANGLES,0,6)};((P,Ee,Be)=>{const Je=P.RGBA,S=P.RGBA,w=P.UNSIGNED_BYTE;P.bindTexture(P.TEXTURE_2D,Ee),P.texImage2D(P.TEXTURE_2D,0,Je,S,w,Be)})(Q,Xn(this,Oa,"f"),u),Te(Q,Xn(this,Oc,"f"),Xn(this,Mc,"f"),Xn(this,Oa,"f"));const Ae=$||new Uint8Array(4*W*Y);if(Q.readPixels(B,j,W,Y,Q.RGBA,Q.UNSIGNED_BYTE,Ae),255!==Ae[3]){Xe._onLog&&Xe._onLog("Incorrect WebGL drawing .");const P=new Error("WebGL error: incorrect drawing.");throw P.name="WebGLError",P}return Xe._onLog&&Xe._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-C)),{context:Q,pixelFormat:q===mt.GREY?mt.GREY32:q,bUseWebGL:!0}}catch(Q){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return Xe._onLog&&Xe._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,g,p,m,Object.assign({},v,{bUseWebGL:!1}));throw Q.name="WebGLError",Q}}readCvsData(l,u,g){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let p,m=0,v=0,C=l.canvas.width,D=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(C=u.width),u.height&&(D=u.height)),(null==g?void 0:g.length)<4*C*D)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const O=l;g?(O.readPixels(m,v,C,D,O.RGBA,O.UNSIGNED_BYTE,g),p=new Uint8Array(g.buffer,0,4*C*D)):(p=new Uint8Array(4*C*D),O.readPixels(m,v,C,D,O.RGBA,O.UNSIGNED_BYTE,p))}else if(l instanceof CanvasRenderingContext2D){let O;O=l.getImageData(m,v,C,D),p=new Uint8Array(O.data.buffer),null==g||g.set(p)}return p}transformPixelFormat(l,u,g,p){let m,v;if(Xe._onLog&&(m=Date.now(),Xe._onLog("transformPixelFormat(), START: "+m)),u===g)return Xe._onLog&&Xe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),p?new Uint8Array(l):l;const C=[mt.RGBA,mt.RBGA,mt.GRBA,mt.GBRA,mt.BRGA,mt.BGRA];if(C.includes(u))if(g===mt.GREY){v=new Uint8Array(l.length/4);for(let D=0;D<l.length;D+=4)v[D/4]=.21*l[D]+.71*l[D+1]+.07*l[D+2]}else if(g===mt.GREY32){v=p?new Uint8Array(l):l;for(let D=0;D<l.length;D+=4){const O=.21*l[D]+.71*l[D+1]+.07*l[D+2];v[D]=O,v[D+1]=O,v[D+2]=O}}else{if(!C.includes(g))throw new Error("Unable to transform.");if(p){v=new Uint8Array(l);const D=u.indexOf("r"),O=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),B=g.indexOf("g"),j=g.indexOf("b");for(let W=0;W<l.length;W+=4)v[W+N]=l[W+D],v[W+B]=l[W+O],v[W+j]=l[W+L]}else{v=l;const D=u.indexOf("r"),O=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),B=g.indexOf("g"),j=g.indexOf("b");for(let W=0;W<l.length;W+=4){let Y=[l[W],l[W+1],l[W+2]];v[W+N]=Y[D],v[W+B]=Y[O],v[W+j]=Y[L]}}}else if(u===mt.GREY){if(g!==mt.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let D=0;D<l.length;D++)v[4*D]=l[D],v[4*D+1]=l[D],v[4*D+2]=l[D],v[4*D+3]=255}else{if(u!==mt.GREY32)throw new Error("Unable to transform.");if(g!==mt.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let D=0;D<l.length;D+=4)v[D/4]=l[D]}return Xe._onLog&&Xe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,g,p,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Xn(Xe,Kr,"f",Qr)&&Xe.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!Xn(Xe,Kr,"f",Qr))throw new Error("Your browser or machine may not support WebGL.");if(p.sx>u||p.sy>g||p.sx+p.sWidth>u||p.sy+p.sHeight>g)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;Xe._onLog&&(v=Date.now(),Xe._onLog("getImageData(), START: "+v));const C=Math.round(p.sx),D=Math.round(p.sy),O=Math.round(p.sWidth),L=Math.round(p.sHeight),N=Math.round(p.dWidth),B=Math.round(p.dHeight);let j=mt.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let W,Y,$,q=null;if((null==m?void 0:m.bufferContainer)&&(q=m.bufferContainer),Xn(Xe,Kr,"f",Qr)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){Xe._onLog&&Xe._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),W=this._reusedWebGLCvs;try{if(q)if(j===mt.GREY){if($=new Uint8Array(4*N*B),Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,Y.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}}else Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:q}),$=new Uint8Array(q.buffer,0,4*N*B),$=this.transformPixelFormat($,Y.pixelFormat,j);else j===mt.GREY?((!Xn(this,Ma,"f")||Xn(this,Ma,"f").length<4*N*B)&&nr(this,Ma,new Uint8Array(4*N*B),"f"),$=new Uint8Array(Xn(this,Ma,"f").buffer,0,4*N*B)):$=new Uint8Array(4*N*B),Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,Y.pixelFormat,j)}catch(X){if("WebGLError"===X.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return Xe._onLog&&Xe._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},Object.assign({},m,{bUseWebGL:!1}));throw X}}else if(Xe._onLog&&Xe._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),W=this._reusedCvs,Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:mt.RGBA,bUseWebGL:!1}),$=this.readCvsData(Y.context,{width:N,height:B},null),$=this.transformPixelFormat($,Y.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}return Xe._onLog&&Xe._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:$,pixelFormat:j,width:N,height:B,bUseWebGL:Y.bUseWebGL}}convertDataToCvs(l,u,g,p){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof g||g<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=g,p===mt.GREY){v=new Uint8ClampedArray(4*u*g);for(let D=0;D<v.length;D+=4)v[D]=l[D/4],v[D+1]=l[D/4],v[D+2]=l[D/4],v[D+3]=255}else v=new Uint8ClampedArray(l.buffer);const C=new ImageData(v,u,g);return m.getContext("2d").putImageData(C,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),nr(this,Oa,null,"f"),nr(this,Oc,null,"f"),nr(this,Mc,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),nr(this,gd,!0,"f")}}Kr=Xe,fd=new WeakMap,Oa=new WeakMap,Oc=new WeakMap,Mc=new WeakMap,Ma=new WeakMap,gd=new WeakMap,Qr={value:void 0};class Mj{constructor(){_o.set(this,new Map),pd.set(this,!1)}get disposed(){return K(this,pd,"f")}on(l,u){l=l.toLowerCase();const g=K(this,_o,"f").get(l);if(g){if(g.includes(u))return;g.push(u)}else K(this,_o,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const g=K(this,_o,"f").get(l);if(!g)return;const p=g.indexOf(u);-1!==p&&g.splice(p,1)}offAll(l){l=l.toLowerCase();const u=K(this,_o,"f").get(l);u&&(u.length=0)}fire(l,u=[],g={async:!1,copy:!0}){var p=this;return oe(function*(){u||(u=[]),l=l.toLowerCase();const m=K(p,_o,"f").get(l);if(m&&m.length){g=Object.assign({async:!1,copy:!0},g);for(let v of m){if(!v)continue;let C=[];if(g.copy)for(let O of u){try{O=JSON.parse(JSON.stringify(O))}catch(L){}C.push(O)}else C=u;let D=!1;if(g.async)setTimeout(()=>{p.disposed||v.apply(g.target,C)},0);else try{D=v.apply(g.target,C)}catch(O){}if(!0===D)break}}})()}dispose(){pt(this,pd,!0,"f")}}_o=new WeakMap,pd=new WeakMap;const ni=(f,l,u,g)=>{if(!u)return f;let p=l+Math.round((f-l)/u)*u;return g&&(p=Math.min(p,g)),p};class We{static get version(){return"2.0.7"}static isStorageAvailable(l){let u;try{u=window[l];const g="__storage_test__";return u.setItem(g,g),u.removeItem(g),!0}catch(g){return g instanceof DOMException&&(22===g.code||1014===g.code||"QuotaExceededError"===g.name||"NS_ERROR_DOM_QUOTA_REACHED"===g.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let g=!1;if((null==u?void 0:u.getMainCamera)&&(g=!0),g){const p=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>p.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const p=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],C=l.filter(L=>{const N=L.label.toLowerCase();return p.some(B=>N.includes(B))});if(!C.length)return null;const D=C.find(L=>{const N=L.label.toLowerCase();return m.some(B=>N.includes(B))});if(D)return D.deviceId;const O=C.find(L=>{const N=L.label.toLowerCase();return v.some(B=>N.includes(B))});return O?O.deviceId:C[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(jn.OS))return We.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const g=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let p of l){const m=p.label.toLowerCase();if(m&&g.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return p.deviceId}return["Android","HarmonyOS"].includes(jn.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,g){return l&&l.length?"environment"===u?this.findBestRearCamera(l,g):"user"===u?null:u?void 0:null:null}static playVideo(l,u,g){return oe(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return new Promise(function(){var p=oe(function*(m,v){let C;const D=()=>{l.removeEventListener("loadstart",B),l.removeEventListener("abort",j),l.removeEventListener("play",W),l.removeEventListener("error",Y),l.removeEventListener("loadedmetadata",X)};let O=!1;const L=()=>{O=!0,C&&clearTimeout(C),D(),m(l)},N=Q=>{C&&clearTimeout(C),D(),v(Q)},B=()=>{l.addEventListener("abort",j,{once:!0})},j=()=>{const Q=new Error("Video playing was interrupted.");Q.name="AbortError",N(Q)},W=()=>{L()},Y=()=>{N(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};let $;const q=new Promise(Q=>{$=Q}),X=()=>{$()};if(l.addEventListener("loadstart",B,{once:!0}),l.addEventListener("play",W,{once:!0}),l.addEventListener("error",Y,{once:!0}),l.addEventListener("loadedmetadata",X,{once:!0}),"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,l.autoplay&&(yield new Promise(Q=>{setTimeout(Q,1e3)})),!O){g&&(C=setTimeout(()=>{D(),v(new Error("Failed to play video. Timeout."))},g));try{l.src&&(yield l.load()),yield l.play(),L()}catch(Q){console.warn("1st play error: "+((null==Q?void 0:Q.message)||Q))}if(!O){yield q;try{yield l.play(),L()}catch(Q){console.warn("2rd play error: "+((null==Q?void 0:Q.message)||Q)),N(Q)}}}});return function(m,v){return p.apply(this,arguments)}}())})()}static testCameraAccess(l){return oe(function*(){var u,g;if(!(null===(g=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===g?void 0:g.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let p;try{p=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==p||p.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!K(this,mi,"f"))return"closed";if("pending"===K(this,mi,"f"))return"opening";if("fulfilled"===K(this,mi,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l?We.isStorageAvailable("localStorage")?pt(this,La,!0,"f"):(pt(this,La,!1,"f"),console.warn("Local storage is unavailable")):pt(this,La,!1,"f")}get ifSaveLastUsedCamera(){return K(this,La,"f")}get isVideoPlaying(){return!(!K(this,et,"f")||K(this,et,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,g,p;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=K(this,vo,"f"))||void 0===u||u.removeEventListener("click",K(this,Na,"f")),null===(g=K(this,vo,"f"))||void 0===g||g.removeEventListener("touchend",K(this,Na,"f")),null===(p=K(this,vo,"f"))||void 0===p||p.removeEventListener("touchmove",K(this,yd,"f")),pt(this,vo,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(jn.OS)?(l.addEventListener("touchend",K(this,Na,"f")),l.addEventListener("touchmove",K(this,yd,"f"))):l.addEventListener("click",K(this,Na,"f")))}get tapFocusEventBoundEl(){return K(this,vo,"f")}get disposed(){return K(this,wd,"f")}constructor(l){var g,p,u=this;Pe.add(this),et.set(this,null),Ct.set(this,void 0),md.set(this,()=>{"opened"===this.state&&K(this,mn,"f").fire("resumed",null,{target:this,async:!1})}),_d.set(this,()=>{K(this,mn,"f").fire("paused",null,{target:this,async:!1})}),Mt.set(this,void 0),Pi.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],Jr.set(this,void 0),La.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,vd.set(this,void 0),Ir.set(this,!0),es.set(this,void 0),mi.set(this,void 0),Fa.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Pa.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let C,D;const O=window.getComputedStyle(K(this,et,"f")).objectFit,L=this.getResolution(),N=K(this,et,"f").getBoundingClientRect(),B=N.left,j=N.top,{width:W,height:Y}=K(this,et,"f").getBoundingClientRect();if(W<=0||Y<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const $=W/Y,q=L.width/L.height;let X=1;if("contain"===O)q>$?(X=W/L.width,C=(m-B)/X,D=(v-j-(Y-W/q)/2)/X):(X=Y/L.height,D=(v-j)/X,C=(m-B-(W-Y*q)/2)/X);else{if("cover"!==O)throw new Error("Unsupported object-fit.");q>$?(X=Y/L.height,D=(v-j)/X,C=(m-B+(Y*q-W)/2)/X):(X=W/L.width,C=(m-B)/X,D=(v-j+(W/q-Y)/2)/X)}return{x:C,y:D}},Lc.set(this,!1),yd.set(this,()=>{pt(this,Lc,!0,"f")}),Na.set(this,function(){var m=oe(function*(v){var C;if(K(u,Lc,"f"))return void pt(u,Lc,!1,"f");if(!(K(u,Pa,"f")&&u.isVideoPlaying&&K(u,Ct,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(C=u.getCameraCapabilities())||void 0===C?void 0:C.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let D,O;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)D=v.clientX,O=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;D=v.changedTouches[0].clientX,O=v.changedTouches[0].clientY}const L=u.getResolution(),N=2*Math.round(Math.min(L.width,L.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let B;try{B=u.calculateCoordInVideo(D,O)}catch(q){}if(B.x<0||B.x>L.width||B.y<0||B.y>L.height)return;const j={x:B.x+"px",y:B.y+"px"},W=N+"px",Y=W;let $;We._onLog&&($=Date.now());try{yield K(u,Pe,"m",E_).call(u,j,W,Y,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(q){if(We._onLog)throw We._onLog(q),q}We._onLog&&We._onLog(`Tap focus costs: ${Date.now()-$} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var q;We._onLog&&We._onLog("Back to continuous focus."),null===(q=K(u,Ct,"f"))||void 0===q||q.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),K(u,mn,"f").fire("tapfocus",null,{target:u,async:!1})});return function(v){return m.apply(this,arguments)}}()),vo.set(this,null),ts.set(this,1),ns.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!K(this,et,"f"))return;const m=K(this,ts,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)K(this,et,"f").style.transform="";else{const v=window.getComputedStyle(K(this,et,"f")).objectFit,C=K(this,et,"f").videoWidth,D=K(this,et,"f").videoHeight,{width:O,height:L}=K(this,et,"f").getBoundingClientRect();if(O<=0||L<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const N=O/L,B=C/D;let j=1;"contain"===v?j=N<B?O/(C/m):L/(D/m):"cover"===v&&(j=B>N?L/(C/m):O/(D/m));const W=j*(1-1/m)*(C/2-K(this,ns,"f").x),Y=j*(1-1/m)*(D/2-K(this,ns,"f").y);K(this,et,"f").style.transform=`translate(${W}px, ${Y}px) scale(${m})`}},v_.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===mt.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let D=0;D<v.length;D+=4)v[D]=this.data[D/4],v[D+1]=this.data[D/4],v[D+2]=this.data[D/4],v[D+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const C=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(C,0,0),m}),mn.set(this,void 0),y_.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],yo.set(this,new Map),$I.set(this,!1),Cd.set(this,oe(function*(){var m,v;if("visible"===document.visibilityState){if(We._onLog&&We._onLog("document visible. video paused: "+(null===(m=K(u,et,"f"))||void 0===m?void 0:m.paused)),"opening"==u.state||"opened"==u.state){let C=!1;if(!u.isVideoPlaying){We._onLog&&We._onLog("document visible. Not auto resume. 1st resume start.");try{yield u.resume(),C=!0}catch(D){We._onLog&&We._onLog("document visible. 1st resume video failed, try open instead.")}C||(yield K(u,Pe,"m",ka).call(u))}if(yield new Promise(D=>setTimeout(D,300)),!u.isVideoPlaying){We._onLog&&We._onLog("document visible. 1st open failed. 2rd resume start."),C=!1;try{yield u.resume(),C=!0}catch(D){We._onLog&&We._onLog("document visible. 2rd resume video failed, try open instead.")}C||(yield K(u,Pe,"m",ka).call(u))}}}else"hidden"===document.visibilityState&&(We._onLog&&We._onLog("document hidden. video paused: "+(null===(v=K(u,et,"f"))||void 0===v?void 0:v.paused)),"opening"==u.state||"opened"==u.state&&u.isVideoPlaying&&u.pause())})),wd.set(this,!1),(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia)||setTimeout(()=>{We.onWarning&&We.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),pt(this,mn,new Mj,"f"),this.imageDataGetter=new Xe,document.addEventListener("visibilitychange",K(this,Cd,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",K(this,md,"f")),l.addEventListener("pause",K(this,_d,"f")),pt(this,et,l,"f")}getVideoEl(){return K(this,et,"f")}releaseVideoEl(){var l,u;null===(l=K(this,et,"f"))||void 0===l||l.removeEventListener("play",K(this,md,"f")),null===(u=K(this,et,"f"))||void 0===u||u.removeEventListener("pause",K(this,_d,"f")),pt(this,et,null,"f")}isVideoLoaded(){return!!K(this,et,"f")&&4==K(this,et,"f").readyState}open(){var l=this;return oe(function*(){if(K(l,es,"f")&&!K(l,Ir,"f")){if("pending"===K(l,mi,"f"))return K(l,es,"f");if("fulfilled"===K(l,mi,"f"))return}K(l,mn,"f").fire("before:open",null,{target:l}),yield K(l,Pe,"m",ka).call(l),K(l,mn,"f").fire("played",null,{target:l,async:!1}),K(l,mn,"f").fire("opened",null,{target:l,async:!1})})()}close(){var l=this;return oe(function*(){if("closed"===l.state)return;K(l,mn,"f").fire("before:close",null,{target:l});const u=K(l,es,"f");if(K(l,Pe,"m",Ed).call(l),u&&"pending"===K(l,mi,"f")){try{yield u}catch(g){}if(!1===K(l,Ir,"f")){const g=new Error("'close()' was interrupted.");throw g.name="AbortError",g}}pt(l,es,null,"f"),pt(l,mi,null,"f"),K(l,mn,"f").fire("closed",null,{target:l,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");K(this,et,"f").pause()}resume(){var l=this;return oe(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield K(l,et,"f").play()})()}setCamera(l){var u=this;return oe(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof K(u,Mt,"f").video&&(K(u,Mt,"f").video={}),delete K(u,Mt,"f").video.facingMode,K(u,Mt,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&K(u,Ir,"f"))){K(u,mn,"f").fire("before:camera:change",[],{target:u,async:!1}),yield K(u,Pe,"m",Fc).call(u);try{u.resetSoftwareScale()}catch(g){}return K(u,Pi,"f")}})()}switchToFrontCamera(l){var u=this;return oe(function*(){if("object"!=typeof K(u,Mt,"f").video&&(K(u,Mt,"f").video={}),(null==l?void 0:l.resolution)&&(K(u,Mt,"f").video.width={ideal:l.resolution.width},K(u,Mt,"f").video.height={ideal:l.resolution.height}),delete K(u,Mt,"f").video.deviceId,K(u,Mt,"f").video.facingMode={exact:"user"},pt(u,Jr,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&K(u,Ir,"f"))){K(u,mn,"f").fire("before:camera:change",[],{target:u,async:!1}),K(u,Pe,"m",Fc).call(u);try{u.resetSoftwareScale()}catch(g){}return K(u,Pi,"f")}})()}getCamera(){var l;if(K(this,Pi,"f"))return K(this,Pi,"f");{let u=(null===(l=K(this,Mt,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let g of this._arrCameras)if(g.deviceId===u)return JSON.parse(JSON.stringify(g))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return oe(function*(){var g,p;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let D=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(O=>"videoinput"===O.kind),D.getTracks().forEach(O=>{O.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(D=>"videoinput"===D.kind);const v=[],C=[];if(u._arrCameras)for(let D of u._arrCameras)D._checked&&C.push(D);for(let D=0;D<m.length;D++){let O,L=m[D];for(let N of C)if(L.deviceId==N.deviceId){O=N;break}O||(O={deviceId:L.deviceId,label:L.label?L.label:"camera "+D,_checked:!1}),O.deviceId&&v.push(O)}return u._arrCameras=v,We._onLog&&We._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return oe(function*(){var u,g;if(!(null===(g=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===g?void 0:g.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const p=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!p||!p.length||p[0].deviceId))})()}getAllCameras(){var l=this;return oe(function*(){return l.getCameras()})()}setResolution(l,u,g){var p=this;return oe(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof K(p,Mt,"f").video&&(K(p,Mt,"f").video={}),g?(K(p,Mt,"f").video.width={exact:l},K(p,Mt,"f").video.height={exact:u}):(K(p,Mt,"f").video.width={ideal:l},K(p,Mt,"f").video.height={ideal:u}),"closed"===p.state||p.videoSrc||"opening"===p.state&&K(p,Ir,"f"))return null;K(p,mn,"f").fire("before:resolution:change",[],{target:p,async:!1}),yield K(p,Pe,"m",Fc).call(p);try{p.resetSoftwareScale()}catch(v){}const m=p.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&K(this,et,"f"))return{width:K(this,et,"f").videoWidth,height:K(this,et,"f").videoHeight};if(K(this,Ct,"f")){const l=K(this,Ct,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:K(this,et,"f").videoWidth,height:K(this,et,"f").videoHeight};{const l={width:0,height:0};let u=K(this,Mt,"f").video.width||0,g=K(this,Mt,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),g&&(l.height=g.exact||g.ideal||g),l}}getResolutions(l){var u=this;return oe(function*(){var g,p,m,v,C,D,O,L,N,B,j;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let W="";const Y=($,q)=>{const X=K(u,yo,"f").get($);if(!X||!X.length)return!1;for(let Q of X)if(Q.width===q.width&&Q.height===q.height)return!0;return!1};if(u._mediaStream){W=null===(j=K(u,Pi,"f"))||void 0===j?void 0:j.deviceId;let $=K(u,yo,"f").get(W);if($&&!l)return JSON.parse(JSON.stringify($));$=[],K(u,yo,"f").set(W,$),pt(u,Fa,!0,"f");try{for(let q of u.detectedResolutions){yield K(u,Ct,"f").applyConstraints({width:{ideal:q.width},height:{ideal:q.height}}),K(u,Pe,"m",ir).call(u);const X=K(u,Ct,"f").getSettings(),Q={width:X.width,height:X.height};Y(W,Q)||$.push({width:Q.width,height:Q.height})}}catch(q){throw K(u,Pe,"m",Ed).call(u),pt(u,Fa,!1,"f"),q}try{yield K(u,Pe,"m",ka).call(u)}catch(q){if("AbortError"===q.name)return $;throw q}finally{pt(u,Fa,!1,"f")}return $}{const $=function(){var Q=oe(function*(pe,ve,Te){const Ae={video:{deviceId:{exact:pe},width:{ideal:ve},height:{ideal:Te}}};let P=null;try{P=yield navigator.mediaDevices.getUserMedia(Ae)}catch(Je){return null}if(!P)return null;const Ee=P.getVideoTracks();let Be=null;try{const Je=Ee[0].getSettings();Be={width:Je.width,height:Je.height}}catch(Je){const S=document.createElement("video");S.srcObject=P,Be={width:S.videoWidth,height:S.videoHeight},S.srcObject=null}return Ee.forEach(Je=>{Je.stop()}),Be});return function(ve,Te,Ae){return Q.apply(this,arguments)}}();let q=(null===(C=null===(v=null===(m=K(u,Mt,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===C?void 0:C.exact)||(null===(L=null===(O=null===(D=K(u,Mt,"f"))||void 0===D?void 0:D.video)||void 0===O?void 0:O.deviceId)||void 0===L?void 0:L.ideal)||(null===(B=null===(N=K(u,Mt,"f"))||void 0===N?void 0:N.video)||void 0===B?void 0:B.deviceId);if(!q)return[];let X=K(u,yo,"f").get(q);if(X&&!l)return JSON.parse(JSON.stringify(X));X=[],K(u,yo,"f").set(q,X);for(let Q of u.detectedResolutions){const pe=yield $(q,Q.width,Q.height);pe&&!Y(q,pe)&&X.push({width:pe.width,height:pe.height})}return X}})()}setMediaStreamConstraints(l,u){var g=this;return oe(function*(){if(null===(p=l)||"[object Object]"!==Object.prototype.toString.call(p))throw new TypeError("Invalid 'mediaStreamConstraints'.");var p;pt(g,Mt,JSON.parse(JSON.stringify(l)),"f"),pt(g,Jr,null,"f"),u&&K(g,Pe,"m",Fc).call(g)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(K(this,Mt,"f")))}resetMediaStreamConstraints(){pt(this,Mt,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!K(this,Ct,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return K(this,Ct,"f").getCapabilities?K(this,Ct,"f").getCapabilities():{}}getCameraSettings(){if(!K(this,Ct,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return K(this,Ct,"f").getSettings()}turnOnTorch(){var l=this;return oe(function*(){if(!K(l,Ct,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield K(l,Ct,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return oe(function*(){if(!K(l,Ct,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield K(l,Ct,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var g=this;return oe(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Ct,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ni(l,m.min,m.step,m.max)),yield K(g,Ct,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var g=this;return oe(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Ct,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ni(l,m.min,m.step,m.max)),yield K(g,Ct,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var g=this;return oe(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Ct,"f")||"opened"!==g.state)throw new Error("Camera is not open.");let m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=g.getResolution();return yield K(g,Ct,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var g=this;return oe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!K(g,Ct,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const p=g.getCameraCapabilities(),m=null==p?void 0:p.focusMode,v=null==p?void 0:p.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const C=l.mode.toLowerCase();if(!m.includes(C))throw Error("Unsupported focus mode.");if("manual"===C){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let D=l.distance;u&&(D<v.min?D=v.min:D>v.max&&(D=v.max),D=ni(D,v.min,v.step,v.max)),g._focusParameters.focusArea=null,yield K(g,Ct,"f").applyConstraints({advanced:[{focusMode:C,focusDistance:D}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const D=l.area.centerPoint;let O=l.area.width,L=l.area.height;if(!O||!L){const N=g.getResolution();O||(O=2*Math.round(Math.min(N.width,N.height)/g._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),L||(L=2*Math.round(Math.min(N.width,N.height)/g._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}g._focusParameters.focusArea={centerPoint:{x:D.x,y:D.y},width:O,height:L},yield K(g,Pe,"m",E_).call(g,D,O,L)}}}else g._focusParameters.focusArea=null,yield K(g,Ct,"f").applyConstraints({advanced:[{focusMode:C}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return oe(function*(){pt(l,Pa,!0,"f")})()}disableTapToFocus(){pt(this,Pa,!1,"f")}isTapToFocusEnabled(){return K(this,Pa,"f")}setZoom(l){var u=this;return oe(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?K(u,Pe,"m",b_).call(u,l.centerPoint):u.resetScaleCenter();try{if(K(u,Pe,"m",qI).call(u,K(u,ns,"f"))){const g=yield u.setHardwareScale(l.factor,!0);let p=u.getHardwareScale();1==p&&1!=g&&(p=g),u.setSoftwareScale(l.factor>p?l.factor/p:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(g){const p=g.message||g;if("Not supported."!==p&&"Camera is not open."!==p)throw g;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*K(this,ts,"f")}}resetZoom(){var l=this;return oe(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var g=this;return oe(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!K(g,Ct,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ni(l,m.min,m.step,m.max)),yield K(g,Ct,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&K(this,Pe,"m",b_).call(this,u),pt(this,ts,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return K(this,ts,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();pt(this,ns,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||K(this,Fa,"f"))return null;const u=Date.now();We._onLog&&We._onLog("getFrameData() START: "+u);const g=K(this,et,"f").videoWidth,p=K(this,et,"f").videoHeight;let m={sx:0,sy:0,sWidth:g,sHeight:p,dWidth:g,dHeight:p};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=mt.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let C=K(this,ts,"f");(null==l?void 0:l.scale)&&(C=l.scale);let D=K(this,ns,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let B=0,j=0;if(l.scaleCenter.x.endsWith("px"))B=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");B=parseFloat(l.scaleCenter.x)/100*g}if(l.scaleCenter.y.endsWith("px"))j=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");j=parseFloat(l.scaleCenter.y)/100*p}if(isNaN(B)||isNaN(j))throw new Error("Invalid scale center.");D.x=Math.round(B),D.y=Math.round(j)}let O=null;if((null==l?void 0:l.bufferContainer)&&(O=l.bufferContainer),0==g||0==p)return null;1!==C&&(m.sWidth=Math.round(m.sWidth/C),m.sHeight=Math.round(m.sHeight/C),m.sx=Math.round((1-1/C)*D.x+m.sx/C),m.sy=Math.round((1-1/C)*D.y+m.sy/C));const L=this.imageDataGetter.getImageData(K(this,et,"f"),g,p,m,{pixelFormat:v,bufferContainer:O});if(!L)return null;const N=Date.now();return We._onLog&&We._onLog("getFrameData() END: "+N),{data:L.data,width:L.width,height:L.height,pixelFormat:L.pixelFormat,timeSpent:N-u,timeStamp:N,toCanvas:K(this,v_,"f")}}on(l,u){if(!K(this,y_,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);K(this,mn,"f").on(l,u)}off(l,u){K(this,mn,"f").off(l,u)}dispose(){var l=this;return oe(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),K(l,mn,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",K(l,Cd,"f")),pt(l,wd,!0,"f")})()}}var Pc,bd,Va,Co,Dd,ja,ZI,KI,_t,D_,S_,Fe,ke,Nc,is,wo,Sd,Id,Td,kc,Eo,xd,rs,vi,$t,Ne,Tr,I_,Lt,QI,JI,T_,x_;et=new WeakMap,Ct=new WeakMap,md=new WeakMap,_d=new WeakMap,Mt=new WeakMap,Pi=new WeakMap,Jr=new WeakMap,La=new WeakMap,vd=new WeakMap,Ir=new WeakMap,es=new WeakMap,mi=new WeakMap,Fa=new WeakMap,Pa=new WeakMap,Lc=new WeakMap,yd=new WeakMap,Na=new WeakMap,vo=new WeakMap,ts=new WeakMap,ns=new WeakMap,v_=new WeakMap,mn=new WeakMap,y_=new WeakMap,yo=new WeakMap,$I=new WeakMap,Cd=new WeakMap,wd=new WeakMap,Pe=new WeakSet,XI=function(){var f=oe(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(K(this,Jr,"f"))delete u.video.facingMode,u.video.deviceId={exact:K(this,Jr,"f")};else if(this.ifSaveLastUsedCamera&&We.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const g=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),p=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));g&&p&&(u.video.width=g,u.video.height=p)}else if(!this.ifSkipCameraInspection){const g=function(){var v=oe(function*(C){let D=null;return"environment"===C&&["Android","HarmonyOS","iPhone","iPad"].includes(jn.OS)?(yield l._getCameras(!1),K(l,Pe,"m",ir).call(l),D=We.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):C||["Android","HarmonyOS","iPhone","iPad"].includes(jn.OS)||(yield l._getCameras(!1),K(l,Pe,"m",ir).call(l),D=We.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),D});return function(D){return v.apply(this,arguments)}}();let p=u.video.facingMode;p instanceof Array&&p.length&&(p=p[0]),"object"==typeof p&&(p=p.exact||p.ideal);const m=yield g(p);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return f.apply(this,arguments)}}(),ir=function(){if(K(this,Ir,"f")){const f=new Error("The operation was interrupted.");throw f.name="AbortError",f}},C_=function(){var f=oe(function*(l){var g,p,u=this;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{We._onLog&&We._onLog("======try getUserMedia========");let v=[0,500,1e3,2e3],C=null;const D=function(){var O=oe(function*(L){for(let N of v){N&&(yield new Promise(B=>setTimeout(B,N)),K(u,Pe,"m",ir).call(u));try{We._onLog&&We._onLog("ask "+JSON.stringify(L)),m=yield navigator.mediaDevices.getUserMedia(L),K(u,Pe,"m",ir).call(u);break}catch(B){if("NotFoundError"===B.name||"NotAllowedError"===B.name||"AbortError"===B.name||"OverconstrainedError"===B.name)throw B;C=B,We._onLog&&We._onLog(B.message||B)}}});return function(N){return O.apply(this,arguments)}}();if(yield D(l),m||"object"!=typeof l.video||(l.video.deviceId&&(delete l.video.deviceId,yield D(l)),!m&&l.video.facingMode&&(delete l.video.facingMode,yield D(l)),m||!l.video.width&&!l.video.height||(delete l.video.width,delete l.video.height,yield D(l))),!m)throw C;return m}catch(v){throw null==m||m.getTracks().forEach(C=>{C.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return f.apply(this,arguments)}}(),w_=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(f=>{f.stop()}),this._mediaStream=null),pt(this,Ct,null,"f")},ka=function(){var f=oe(function*(){var l=this;pt(this,Ir,!1,"f");const u=pt(this,vd,Symbol(),"f");if(K(this,es,"f")&&"pending"===K(this,mi,"f")){try{yield K(this,es,"f")}catch(p){}K(this,Pe,"m",ir).call(this)}return u!==K(this,vd,"f")?void 0:pt(this,es,oe(function*(){pt(l,mi,"pending","f");try{if(l.videoSrc){if(!K(l,et,"f"))throw new Error("'videoEl' should be set.");yield We.playVideo(K(l,et,"f"),l.videoSrc,l.cameraOpenTimeout),K(l,Pe,"m",ir).call(l)}else{let p=yield K(l,Pe,"m",XI).call(l);K(l,Pe,"m",w_).call(l);let m=yield K(l,Pe,"m",C_).call(l,p);yield l._getCameras(!1),K(l,Pe,"m",ir).call(l);const v=()=>{const L=m.getVideoTracks();let N,B;if(L.length&&(N=L[0]),N){const j=N.getSettings();if(j)for(let W of l._arrCameras)if(j.deviceId===W.deviceId){W._checked=!0,W.label=N.label,B=W;break}}return B},C=K(l,Mt,"f");if("object"==typeof C.video){let L=C.video.facingMode;if(L instanceof Array&&L.length&&(L=L[0]),"object"==typeof L&&(L=L.exact||L.ideal),!(K(l,Jr,"f")||l.ifSaveLastUsedCamera&&We.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||C.video.deviceId)){const N=v(),B=We.findBestCamera(l._arrCameras,L,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});B&&B!=(null==N?void 0:N.deviceId)&&(m.getTracks().forEach(j=>{j.stop()}),p.video.deviceId={exact:B},m=yield K(l,Pe,"m",C_).call(l,p),K(l,Pe,"m",ir).call(l))}}const D=v();(null==D?void 0:D.deviceId)&&(pt(l,Jr,D&&D.deviceId,"f"),l.ifSaveLastUsedCamera&&We.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",K(l,Jr,"f")),"object"==typeof p.video&&p.video.width&&p.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(p.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(p.video.height))))),K(l,et,"f")&&(yield We.playVideo(K(l,et,"f"),m,l.cameraOpenTimeout),K(l,Pe,"m",ir).call(l)),l._mediaStream=m;const O=m.getVideoTracks();(null==O?void 0:O.length)&&pt(l,Ct,O[0],"f"),pt(l,Pi,D,"f")}}catch(p){throw K(l,Pe,"m",Ed).call(l),pt(l,mi,null,"f"),p}pt(l,mi,"fulfilled","f")})(),"f")});return function(){return f.apply(this,arguments)}}(),Fc=function(){var f=oe(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=K(this,Pi,"f"))||void 0===l?void 0:l.deviceId,g=this.getResolution();yield K(this,Pe,"m",ka).call(this);const p=this.getResolution();u&&u!==K(this,Pi,"f").deviceId&&K(this,mn,"f").fire("camera:changed",[K(this,Pi,"f").deviceId,u],{target:this,async:!1}),g.width==p.width&&g.height==p.height||K(this,mn,"f").fire("resolution:changed",[{width:p.width,height:p.height},{width:g.width,height:g.height}],{target:this,async:!1}),K(this,mn,"f").fire("played",null,{target:this,async:!1})});return function(){return f.apply(this,arguments)}}(),Ed=function(){K(this,Pe,"m",w_).call(this),pt(this,Pi,null,"f"),K(this,et,"f")&&(K(this,et,"f").srcObject=null,this.videoSrc&&(K(this,et,"f").pause(),K(this,et,"f").currentTime=0)),pt(this,Ir,!0,"f");try{this.resetSoftwareScale()}catch(f){}},_i=function(){var f=oe(function*(u,g){const p=$=>{if(!K(this,Ct,"f")||!this.isVideoPlaying||$.focusTaskId!=this._focusParameters.curFocusTaskId){K(this,Ct,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const q=new Error(`Focus task ${$.focusTaskId} canceled.`);throw q.name="DeprecatedTaskError",q}1===this._focusParameters.isDoingFocus&&Date.now()-$.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;g=ni(g,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield K(this,Ct,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]}),p(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/g),Math.abs(1/this._focusParameters.fds.max-1/g))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/g)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=g,yield new Promise($=>{setTimeout($,m)}),p(u);let v=u.focusL-u.focusW/2,C=u.focusT-u.focusH/2,D=u.focusW,O=u.focusH;const L=this.getResolution();if(v>=L.width||C>=L.height)throw new Error("Invalid area.");v+D>L.width&&(D=L.width-v),C+O>L.height&&(O=L.height-C),v=Math.round(v),C=Math.round(C),D=Math.round(D),O=Math.round(O);const N=4*L.width*L.height*this._focusParameters.defaultTempBufferContainerLenRatio,B=4*D*O;let j=this._focusParameters.tempBufferContainer;if(j){const $=j.length;N>$&&N>=B?j=new Uint8Array(N):B>$&&B>=N&&(j=new Uint8Array(B))}else j=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(N,B));if(!this.imageDataGetter.getImageData(K(this,et,"f"),L.width,L.height,{sx:v,sy:C,sWidth:D,sHeight:O,dWidth:D,dHeight:O},{pixelFormat:mt.RGBA,bufferContainer:j}))return K(this,Pe,"m",l).call(this,u,g);const W=j;let Y=0;for(let $=0,q=B-8;$<q;++$){let X=W[$]-W[$+8];++$;let Q=W[$]-W[$+8];++$;let pe=W[$]-W[$+8];++$,Y+=X*X+Q*Q+pe*pe}return-Y});function l(u,g){return f.apply(this,arguments)}return l}(),Ba=function(){var f=oe(function*(u,g,p,m,v,C,D){let O;if(g=ni(g,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=ni(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),C?C=ni(C,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(C=ni(Math.sqrt((g||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),D=yield K(this,Pe,"m",_i).call(this,u,C)),D<=p&&D<=v?O=3:p<v&&p<D?O=1:v<p&&v<D&&(O=2),(m-g)/2<=this._focusParameters.fds.step)return 3===O||(1===O?yield K(this,Ct,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]}):2===O&&(yield K(this,Ct,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===O)return yield K(this,Pe,"m",l).call(this,u,g,p,C,D);if(2===O)return yield K(this,Pe,"m",l).call(this,u,C,D,m,v);if(3!==O)return p=yield K(this,Pe,"m",_i).call(this,u,g),v=yield K(this,Pe,"m",_i).call(this,u,m),yield K(this,Pe,"m",l).call(this,u,g,p,m,v);let L=ni(Math.sqrt((g||this._focusParameters.fds.step)*(C||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),N=ni(Math.sqrt((m||this._focusParameters.fds.step)*(C||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/L)<=Math.abs(1/this._focusParameters.oldDistance-1/N)){let B=yield K(this,Pe,"m",_i).call(this,u,L);if(B<D)return yield K(this,Pe,"m",l).call(this,u,g,p,C,D,L,B);if(B==D)return yield K(this,Pe,"m",l).call(this,u,L,B,C,D);let j=yield K(this,Pe,"m",_i).call(this,u,N);if(B>D&&D<j)return yield K(this,Pe,"m",l).call(this,u,L,B,N,j,C,D);if(D==j)return yield K(this,Pe,"m",l).call(this,u,C,D,N,j);if(D>j)return yield K(this,Pe,"m",l).call(this,u,C,D,m,v,N,j)}else{let B=yield K(this,Pe,"m",_i).call(this,u,N);if(D>B)return yield K(this,Pe,"m",l).call(this,u,C,D,m,v,N,B);if(D==B)return yield K(this,Pe,"m",l).call(this,u,C,D,N,B);let j=yield K(this,Pe,"m",_i).call(this,u,L);if(j>D&&D<B)return yield K(this,Pe,"m",l).call(this,u,L,j,N,B,C,D);if(j==D)return yield K(this,Pe,"m",l).call(this,u,L,j,C,D);if(j<D)return yield K(this,Pe,"m",l).call(this,u,g,p,C,D,L,j)}return!1});function l(u,g,p,m,v,C,D){return f.apply(this,arguments)}return l}(),E_=function(){var f=oe(function*(l,u,g,p,m){var C,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!g||"string"!=typeof g)throw new Error("Invalid 'height'.");const D=this.getResolution();let O=0,L=0;if(l.x.endsWith("px"))O=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");O=parseFloat(l.x)/100*D.width}if(l.y.endsWith("px"))L=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");L=parseFloat(l.y)/100*D.height}if(isNaN(O)||isNaN(L)||O<0||O>D.width||L<0||L>D.height)throw new Error("Invalid 'centerPoint'.");let N=0;if(u.endsWith("px"))N=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");N=parseFloat(u)/100*D.width}if(isNaN(N)||N<0)throw new Error("Invalid 'width'.");let B=0;if(g.endsWith("px"))B=parseFloat(g);else{if(!g.endsWith("%"))throw new Error("Invalid 'height'.");B=parseFloat(g)/100*D.height}if(isNaN(B)||B<0)throw new Error("Invalid 'height'.");if(1!==K(this,ts,"f")){const Y=K(this,ts,"f"),$=K(this,ns,"f");N/=Y,B/=Y,O=(1-1/Y)*$.x+O/Y,L=(1-1/Y)*$.y+L/Y}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(C=this.getCameraCapabilities())||void 0===C?void 0:C.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:O,focusT:L,focusW:N,focusH:B,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},W=function(){var Y=oe(function*($,q,X){try{(null==q||q<v._focusParameters.fds.min)&&(q=v._focusParameters.fds.min),(null==X||X>v._focusParameters.fds.max)&&(X=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let Q=ni(Math.sqrt(X*(q||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),pe=ni(Math.sqrt((q||v._focusParameters.fds.step)*Q),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),ve=ni(Math.sqrt(Q*X),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),Te=yield K(v,Pe,"m",_i).call(v,$,ve),Ae=yield K(v,Pe,"m",_i).call(v,$,pe),P=yield K(v,Pe,"m",_i).call(v,$,Q);if(Ae>P&&P<Te){const Ee=yield K(v,Pe,"m",Ba).call(v,$,pe,Ae,ve,Te,Q,P);return v._focusParameters.isDoingFocus=0,Ee}if(Ae<P&&Ae<Te){let Ee=yield K(v,Pe,"m",_i).call(v,$,q);const Be=yield K(v,Pe,"m",Ba).call(v,$,q,Ee,Q,P,pe,Ae);return v._focusParameters.isDoingFocus=0,Be}if(P>Te&&Ae>Te){let Ee=yield K(v,Pe,"m",_i).call(v,$,X);const Be=yield K(v,Pe,"m",Ba).call(v,$,Q,P,X,Ee,ve,Te);return v._focusParameters.isDoingFocus=0,Be}if(Ae==P&&P<Te){const Ee=yield K(v,Pe,"m",Ba).call(v,$,pe,Ae,Q,P);return v._focusParameters.isDoingFocus=0,Ee}if(P==Te&&Ae>P){const Ee=yield K(v,Pe,"m",Ba).call(v,$,Q,P,ve,Te);return v._focusParameters.isDoingFocus=0,Ee}return W($,q,X)}catch(Q){if("DeprecatedTaskError"!==Q.name)throw Q}});return function(q,X,Q){return Y.apply(this,arguments)}}();return W(j,p,m)});return function(u,g,p,m,v){return f.apply(this,arguments)}}(),b_=function(f){if("opened"!==this.state)throw new Error("Video is not playing.");if(!f||"string"!=typeof f.x||"string"!=typeof f.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,g=0;if(f.x.endsWith("px"))u=parseFloat(f.x);else{if(!f.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(f.x)/100*l.width}if(f.y.endsWith("px"))g=parseFloat(f.y);else{if(!f.y.endsWith("%"))throw new Error("Invalid scale center.");g=parseFloat(f.y)/100*l.height}if(isNaN(u)||isNaN(g))throw new Error("Invalid scale center.");pt(this,ns,{x:u,y:g},"f")},qI=function(f){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return f&&f.x==l.width/2&&f.y==l.height/2},We.browserInfo=jn,We.onWarning=null===(__=null==window?void 0:window.console)||void 0===__?void 0:__.warn;class ss{constructor(l){Pc.add(this),bd.set(this,void 0),Va.set(this,0),Co.set(this,void 0),Dd.set(this,0),ja.set(this,!1),Le(this,bd,l,"f")}startCharging(){U(this,ja,"f")||(ss._onLog&&ss._onLog("start charging."),U(this,Pc,"m",KI).call(this),Le(this,ja,!0,"f"))}stopCharging(){U(this,Co,"f")&&clearTimeout(U(this,Co,"f")),U(this,ja,"f")&&(ss._onLog&&ss._onLog("stop charging."),Le(this,Va,Date.now()-U(this,Dd,"f"),"f"),Le(this,ja,!1,"f"))}}bd=new WeakMap,Va=new WeakMap,Co=new WeakMap,Dd=new WeakMap,ja=new WeakMap,Pc=new WeakSet,ZI=function(){tn.cfd(1),ss._onLog&&ss._onLog("charge 1.")},KI=function f(){0==U(this,Va,"f")&&U(this,Pc,"m",ZI).call(this),Le(this,Dd,Date.now(),"f"),U(this,Co,"f")&&clearTimeout(U(this,Co,"f")),Le(this,Co,setTimeout(()=>{Le(this,Va,0,"f"),U(this,Pc,"m",f).call(this)},U(this,bd,"f")-U(this,Va,"f")),"f")};const eT=new Map([[je.IPF_GRAYSCALED,mt.GREY],[je.IPF_ABGR_8888,mt.RGBA],[je.IPF_ARGB_8888,mt.BGRA]]),tT=new Map([[mt.GREY,je.IPF_GRAYSCALED],[mt.RGBA,je.IPF_ABGR_8888],[mt.BGRA,je.IPF_ARGB_8888]]),A_="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class st extends Li{static set _onLog(l){Le(st,D_,l,"f",S_),We._onLog=l,ss._onLog=l}static get _onLog(){return U(st,D_,"f",S_)}static detectEnvironment(){return oe(function*(){return yield oe(function*(){return{wasm:Cj,worker:wj,getUserMedia:AI,camera:yield Ej(),browser:Mn.browser,version:Mn.version,OS:Mn.OS}})()})()}static testCameraAccess(){return oe(function*(){const l=yield We.testCameraAccess();return l.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===l.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===l.errorName||"NotFoundError"===l.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===l.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===l.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===l.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===l.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:l.errorMessage}})()}static createInstance(l){return oe(function*(){var u,g;if(l&&!(l instanceof an))throw new TypeError("Invalid view.");if(null===(u=gn.license)||void 0===u?void 0:u.LicenseManager){if(!(null===(g=gn.license)||void 0===g?void 0:g.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield tn.loadWasm(["license"]),yield gn.license.dynamsoft()}const p=new st(l);return st.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{st.onWarning&&st.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{st.onWarning&&st.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),p})()}get video(){return U(this,Fe,"f").getVideoEl()}set videoSrc(l){if(!U(this,Fe,"f"))throw new Error("Camera manager is null.");U(this,ke,"f")&&(U(this,ke,"f")._hideDefaultSelection=!0),U(this,Fe,"f").videoSrc=l}get videoSrc(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.videoSrc}set ifSaveLastUsedCamera(l){if(!U(this,Fe,"f"))throw new Error("Camera manager is null.");U(this,Fe,"f").ifSaveLastUsedCamera=l}get ifSaveLastUsedCamera(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.ifSaveLastUsedCamera}set ifSkipCameraInspection(l){if(!U(this,Fe,"f"))throw new Error("Camera manager is null.");U(this,Fe,"f").ifSkipCameraInspection=l}get ifSkipCameraInspection(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.ifSkipCameraInspection}set cameraOpenTimeout(l){if(!U(this,Fe,"f"))throw new Error("Camera manager is null.");U(this,Fe,"f").cameraOpenTimeout=l}get cameraOpenTimeout(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.cameraOpenTimeout}set singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Le(this,Sd,l,"f")}get singleFrameMode(){return U(this,Sd,"f")}get _isFetchingStarted(){return U(this,rs,"f")}get disposed(){return U(this,I_,"f")}constructor(l){var u;if(super(),u=this,_t.add(this),Fe.set(this,void 0),ke.set(this,void 0),Nc.set(this,"closed"),is.set(this,void 0),wo.set(this,!1),Sd.set(this,void 0),this._onCameraSelChange=oe(function*(){u.isOpen()&&U(u,ke,"f")&&!U(u,ke,"f").disposed&&(yield u.selectCamera(U(u,ke,"f")._selCam.value))}),this._onResolutionSelChange=oe(function*(){if(!u.isOpen()||!U(u,ke,"f")||U(u,ke,"f").disposed)return;let g,p;if(U(u,ke,"f")._selRsl&&-1!=U(u,ke,"f")._selRsl.selectedIndex){let m=U(u,ke,"f")._selRsl.options[U(u,ke,"f")._selRsl.selectedIndex];g=parseInt(m.getAttribute("data-width")),p=parseInt(m.getAttribute("data-height"))}yield u.setResolution({width:g,height:p})}),this._onCloseBtnClick=oe(function*(){u.isOpen()&&U(u,ke,"f")&&!U(u,ke,"f").disposed&&u.close()}),Id.set(this,(g,p,m,v)=>{const C=Date.now(),D={sx:v.x,sy:v.y,sWidth:v.width,sHeight:v.height,dWidth:v.width,dHeight:v.height},O=Math.max(D.dWidth,D.dHeight);if(this.canvasSizeLimit&&O>this.canvasSizeLimit){const B=this.canvasSizeLimit/O;D.dWidth>D.dHeight?(D.dWidth=this.canvasSizeLimit,D.dHeight=Math.round(D.dHeight*B)):(D.dWidth=Math.round(D.dWidth*B),D.dHeight=this.canvasSizeLimit)}const L=U(this,Fe,"f").imageDataGetter.getImageData(g,p,m,D,{pixelFormat:eT.get(this.getPixelFormat())});let N=null;if(L){const B=Date.now();let j;j=L.pixelFormat===mt.GREY?L.width:4*L.width;let W=!0;0===D.sx&&0===D.sy&&D.sWidth===p&&D.sHeight===m&&(W=!1),N={bytes:L.data,width:L.width,height:L.height,stride:j,format:tT.get(L.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:qh.ITT_FILE_IMAGE,isCropped:W,cropRegion:{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height,isMeasuredInPercentage:!1},originalWidth:p,originalHeight:m,currentWidth:L.width,currentHeight:L.height,timeSpent:B-C,timeStamp:B},toCanvas:U(this,Td,"f"),isDCEFrame:!0}}return N}),this._onSingleFrameAcquired=g=>{let p;p=U(this,ke,"f")?U(this,ke,"f").getConvertedRegion():id.convert(U(this,Eo,"f"),g.width,g.height),p||(p={x:0,y:0,width:g.width,height:g.height});const m=U(this,Id,"f").call(this,g,g.width,g.height,p);U(this,is,"f").fire("singleFrameAcquired",[m],{async:!1,copy:!1})},Td.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const g=document.createElement("canvas");let p;if(g.width=this.width,g.height=this.height,this.format===je.IPF_GRAYSCALED){p=new Uint8ClampedArray(this.width*this.height*4);for(let m=0;m<p.length;m+=4)p[m]=this.bytes[m/4],p[m+1]=this.bytes[m/4],p[m+2]=this.bytes[m/4],p[m+3]=255}else p=new Uint8ClampedArray(this.bytes.buffer);return g.getContext("2d").putImageData(new ImageData(p,this.width,this.height),0,0),g}),kc.set(this,void 0),Eo.set(this,void 0),xd.set(this,je.IPF_ABGR_8888),rs.set(this,!1),this._imageId=-1,vi.set(this,void 0),this.fetchInterval=0,$t.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Ne.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Tr.set(this,void 0),I_.set(this,!1),this.isCameraEnhancer=!0,l&&!(l instanceof an))throw new TypeError("Invalid view.");Le(this,is,new BI,"f"),Le(this,Fe,new We,"f"),this._imageDataGetter=U(this,Fe,"f").imageDataGetter,U(this,Fe,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const g=U(this,Fe,"f").getSoftwareScale();if(g<1)throw new RangeError("Invalid scale value.");U(this,ke,"f")&&!U(this,ke,"f").disposed?(this.video.style.transform=1===g?"":`scale(${g})`,U(this,ke,"f")._updateVideoContainer()):this.video.style.transform=1===g?"":`scale(${g})`},["iPhone","iPad","Android","HarmonyOS"].includes(Mn.OS)?U(this,Fe,"f").setResolution(1280,720):U(this,Fe,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",l&&this.setCameraView(l),this._on("before:camera:change",()=>{U(this,Tr,"f").stopCharging();const g=U(this,ke,"f");g&&!g.disposed&&(g._startLoading(),g.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const g=U(this,ke,"f");g&&!g.disposed&&(g._startLoading(),g.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),l.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{U(this,Tr,"f").stopCharging(),U(this,ke,"f")}),this._on("resumed",()=>{U(this,ke,"f")}),this._on("tapfocus",()=>{U(this,$t,"f").tapToFocus&&U(this,Tr,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var g=oe(function*(p,m){var v,C,D,O;if(U(u,_t,"m",Lt).call(u)||!u.isOpen()||u.isPaused())return;const L=p.intermediateResultUnits;st._onLog&&(st._onLog("intermediateResultUnits:"),st._onLog(L));let N=!1,B=!1;for(let j of L){if(j.unitType===Ea.IRUT_DECODED_BARCODES&&j.decodedBarcodes.length){N=!0;break}j.unitType===Ea.IRUT_LOCALIZED_BARCODES&&j.localizedBarcodes.length&&(B=!0)}if(st._onLog&&(st._onLog("hasLocalizedBarcodes:"),st._onLog(B)),U(u,$t,"f").autoZoom||U(u,$t,"f").enhancedFocus)if(N)U(u,Ne,"f").autoZoomInFrameArray.length=0,U(u,Ne,"f").autoZoomOutFrameCount=0,U(u,Ne,"f").frameArrayInIdealZoom.length=0,U(u,Ne,"f").autoFocusFrameArray.length=0;else{const j=function(){var Y=oe(function*($){yield u.setZoom($),U(u,$t,"f").autoZoom&&U(u,Tr,"f").startCharging()});return function(q){return Y.apply(this,arguments)}}(),W=function(){var Y=oe(function*($){yield u.setFocus($),U(u,$t,"f").enhancedFocus&&U(u,Tr,"f").startCharging()});return function(q){return Y.apply(this,arguments)}}();if(B){const Y=L[0].originalImageTag,$=(null===(v=Y.cropRegion)||void 0===v?void 0:v.left)||0,q=(null===(C=Y.cropRegion)||void 0===C?void 0:C.top)||0,X=(null===(D=Y.cropRegion)||void 0===D?void 0:D.right)?Y.cropRegion.right-$:Y.originalWidth,Q=(null===(O=Y.cropRegion)||void 0===O?void 0:O.bottom)?Y.cropRegion.bottom-q:Y.originalHeight,pe=Y.currentWidth,ve=Y.currentHeight;let Te;{let Ae,P,Ee,Be,Je;{const b=u.video.videoWidth*(1-U(u,Ne,"f").autoZoomDetectionArea)/2,T=u.video.videoWidth*(1+U(u,Ne,"f").autoZoomDetectionArea)/2,_=T,y=b,I=u.video.videoHeight*(1-U(u,Ne,"f").autoZoomDetectionArea)/2,M=I,x=u.video.videoHeight*(1+U(u,Ne,"f").autoZoomDetectionArea)/2;Je=[{x:b,y:I},{x:T,y:M},{x:_,y:x},{x:y,y:x}]}st._onLog&&(st._onLog("detectionArea:"),st._onLog(Je));const S=[];{const b=(T,_)=>{const y=(M,x)=>{if(!M&&!x)throw new Error("Invalid arguments.");return function(A,F,k){let V=!1;const H=A.length;if(H<=2)return!1;for(let G=0;G<H;G++){const z=A[G],Z=A[(G+1)%H];if(Sj(z,Z,{x:F,y:k}))return!0;s_(z.y-k)>0!=s_(Z.y-k)>0&&s_(F-(k-z.y)*(z.x-Z.x)/(z.y-Z.y)-z.x)<0&&(V=!V)}return V}(x,M.x,M.y)},I=(M,x)=>!!(sd([M[0],M[1]],[M[2],M[3]],[x[0].x,x[0].y],[x[1].x,x[1].y])||sd([M[0],M[1]],[M[2],M[3]],[x[1].x,x[1].y],[x[2].x,x[2].y])||sd([M[0],M[1]],[M[2],M[3]],[x[2].x,x[2].y],[x[3].x,x[3].y])||sd([M[0],M[1]],[M[2],M[3]],[x[3].x,x[3].y],[x[0].x,x[0].y]));return!!(y({x:T[0].x,y:T[0].y},_)||y({x:T[1].x,y:T[1].y},_)||y({x:T[2].x,y:T[2].y},_)||y({x:T[3].x,y:T[3].y},_))||!!(y({x:_[0].x,y:_[0].y},T)||y({x:_[1].x,y:_[1].y},T)||y({x:_[2].x,y:_[2].y},T)||y({x:_[3].x,y:_[3].y},T))||!!(I([_[0].x,_[0].y,_[1].x,_[1].y],T)||I([_[1].x,_[1].y,_[2].x,_[2].y],T)||I([_[2].x,_[2].y,_[3].x,_[3].y],T)||I([_[3].x,_[3].y,_[0].x,_[0].y],T))};for(let T of L)if(T.unitType===Ea.IRUT_LOCALIZED_BARCODES)for(let _ of T.localizedBarcodes){if(!_)continue;const y=_.location.points;y.forEach(I=>{an._transformCoordinates(I,$,q,X,Q,pe,ve)}),b(Je,y)&&S.push(_)}if(st._debug&&U(u,ke,"f")){const T=u.__layer||(u.__layer=U(u,ke,"f")._createDrawingLayer(99));T.clearDrawingItems();const _=u.__styleId2||(u.__styleId2=we.createDrawingStyle({strokeStyle:"red"}));for(let y of L)if(y.unitType===Ea.IRUT_LOCALIZED_BARCODES)for(let I of y.localizedBarcodes){if(!I)continue;const x=new u_({points:I.location.points},_);T.addDrawingItems([x])}}}if(st._onLog&&(st._onLog("intersectedResults:"),st._onLog(S)),!S.length)return;let w;if(S.length){let b=S.filter(T=>T.possibleFormats==A_.BF_QR_CODE||T.possibleFormats==A_.BF_DATAMATRIX);if(b.length||(b=S.filter(T=>T.possibleFormats==A_.BF_ONED),b.length||(b=S)),b.length){const T=y=>{const I=y.location.points,M=(I[0].x+I[1].x+I[2].x+I[3].x)/4,x=(I[0].y+I[1].y+I[2].y+I[3].y)/4;return(M-pe/2)*(M-pe/2)+(x-ve/2)*(x-ve/2)};w=b[0];let _=T(w);if(1!=b.length)for(let y=1;y<b.length;y++){const I=T(b[y]);(b[y].confidence>1.1*w.confidence||b[y].confidence>.9*w.confidence&&I<_)&&(w=b[y],_=I)}}}if(st._onLog&&(st._onLog("highPriorityResult:"),st._onLog(w)),w){const b=w.location.points;Ae=Math.min(b[0].x,b[1].x,b[2].x,b[3].x),P=Math.max(b[0].x,b[1].x,b[2].x,b[3].x),Ee=Math.min(b[0].y,b[1].y,b[2].y,b[3].y),Be=Math.max(b[0].y,b[1].y,b[2].y,b[3].y),Te={points:[{x:Ae,y:Ee},{x:P,y:Ee},{x:P,y:Be},{x:Ae,y:Be}],result:w}}}if(st._onLog&&(st._onLog("boundingRect:"),st._onLog(Te)),!Te)return;if(st._debug&&U(u,ke,"f")&&(null==Te?void 0:Te.points)){const Ae=u.__layer||(u.__layer=U(u,ke,"f")._createDrawingLayer(99)),P=u.__styleId1||(u.__styleId1=we.createDrawingStyle({strokeStyle:"blue"})),Ee=new u_({points:Te.points},P);Ae.addDrawingItems([Ee])}if(U(u,Ne,"f").autoZoomOutFrameCount=0,U(u,$t,"f").autoZoom){const Ae=U(u,Ne,"f").autoZoomIdealArea[1];let P=(1-U(u,Ne,"f").autoZoomTargetBorder)/2;const Ee=Te.points[0].x/X,Be=(X-Te.points[2].x)/X,Je=Te.points[0].y/Q,S=(Q-Te.points[2].y)/Q;if(Ee>Ae&&Be>Ae&&Je>Ae&&S>Ae&&Te.result.moduleSize<U(u,Ne,"f").autoZoomInIdealModuleSize){if(U(u,Ne,"f").autoZoomInFrameArray.push(!0),U(u,Ne,"f").autoZoomInFrameArray.splice(0,U(u,Ne,"f").autoZoomInFrameArray.length-U(u,Ne,"f").autoZoomInFrameLimit[0]),U(u,Ne,"f").frameArrayInIdealZoom.length=0,U(u,$t,"f").enhancedFocus&&W({mode:"continuous"}).catch(()=>{}),U(u,Ne,"f").autoZoomInFrameArray.filter(w=>!0===w).length>=U(u,Ne,"f").autoZoomInFrameLimit[1]){U(u,Ne,"f").autoZoomInFrameArray.length=0;const w=[(.5-P)/(.5-Ee),(.5-P)/(.5-Be),(.5-P)/(.5-Je),(.5-P)/(.5-S)].filter(I=>I>0),b=Math.min(...w,U(u,Ne,"f").autoZoomInIdealModuleSize/Te.result.moduleSize),T=u.getZoomSettings().factor;let _=Math.max(Math.pow(T*b,1/U(u,Ne,"f").autoZoomInMaxTimes),U(u,Ne,"f").autoZoomInMinStep);_=Math.min(_,b);let y=T*_;y=Math.max(U(u,Ne,"f").minValue,y),y=Math.min(U(u,Ne,"f").maxValue,y);try{yield j({factor:y})}catch(I){console.warn(I.message||I)}u.clearBuffer()}}else if(U(u,Ne,"f").autoZoomInFrameArray.length=0,U(u,Ne,"f").frameArrayInIdealZoom.push(!0),U(u,Ne,"f").frameArrayInIdealZoom.splice(0,U(u,Ne,"f").frameArrayInIdealZoom.length-U(u,Ne,"f").frameLimitInIdealZoom[0]),U(u,Ne,"f").frameArrayInIdealZoom.filter(w=>!0===w).length>=U(u,Ne,"f").frameLimitInIdealZoom[1]&&(U(u,Ne,"f").frameArrayInIdealZoom.length=0,U(u,$t,"f").enhancedFocus)){const w=Te.points;try{yield W({mode:"manual",area:{centerPoint:{x:(w[0].x+w[2].x)/2+"px",y:(w[0].y+w[2].y)/2+"px"},width:w[2].x-w[0].x+"px",height:w[2].y-w[0].y+"px"}})}catch(b){console.warn(b.message||b)}u.clearBuffer()}}if(!U(u,$t,"f").autoZoom&&U(u,$t,"f").enhancedFocus&&(U(u,Ne,"f").autoFocusFrameArray.push(!0),U(u,Ne,"f").autoFocusFrameArray.splice(0,U(u,Ne,"f").autoFocusFrameArray.length-U(u,Ne,"f").autoFocusFrameLimit[0]),U(u,Ne,"f").autoFocusFrameArray.filter(Ae=>!0===Ae).length>=U(u,Ne,"f").autoFocusFrameLimit[1])){U(u,Ne,"f").autoFocusFrameArray.length=0;try{const Ae=Te.points;yield W({mode:"manual",area:{centerPoint:{x:(Ae[0].x+Ae[2].x)/2+"px",y:(Ae[0].y+Ae[2].y)/2+"px"},width:Ae[2].x-Ae[0].x+"px",height:Ae[2].y-Ae[0].y+"px"}})}catch(Ae){console.warn(Ae.message||Ae)}u.clearBuffer()}}else{if(U(u,$t,"f").autoZoom){if(U(u,Ne,"f").autoZoomInFrameArray.push(!1),U(u,Ne,"f").autoZoomInFrameArray.splice(0,U(u,Ne,"f").autoZoomInFrameArray.length-U(u,Ne,"f").autoZoomInFrameLimit[0]),U(u,Ne,"f").autoZoomOutFrameCount++,U(u,Ne,"f").frameArrayInIdealZoom.push(!1),U(u,Ne,"f").frameArrayInIdealZoom.splice(0,U(u,Ne,"f").frameArrayInIdealZoom.length-U(u,Ne,"f").frameLimitInIdealZoom[0]),U(u,Ne,"f").autoZoomOutFrameCount>=U(u,Ne,"f").autoZoomOutFrameLimit){U(u,Ne,"f").autoZoomOutFrameCount=0;const Y=u.getZoomSettings().factor;let $=Y-Math.max((Y-1)*U(u,Ne,"f").autoZoomOutStepRate,U(u,Ne,"f").autoZoomOutMinStep);$=Math.max(U(u,Ne,"f").minValue,$),$=Math.min(U(u,Ne,"f").maxValue,$);try{yield j({factor:$})}catch(q){console.warn(q.message||q)}u.clearBuffer()}U(u,$t,"f").enhancedFocus&&W({mode:"continuous"}).catch(()=>{})}!U(u,$t,"f").autoZoom&&U(u,$t,"f").enhancedFocus&&(U(u,Ne,"f").autoFocusFrameArray.length=0,W({mode:"continuous"}).catch(()=>{}))}}});return function(p,m){return g.apply(this,arguments)}}(),Le(this,Tr,new ss(1e4),"f")}setCameraView(l){if(!(l instanceof an))throw new TypeError("Invalid view.");if(l.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),l._singleFrameMode=this.singleFrameMode,l._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(U(this,ke,"f")._hideDefaultSelection=!0),U(this,_t,"m",Lt).call(this)||U(this,Fe,"f").setVideoEl(l.getVideoElement()),Le(this,ke,l,"f"),this.addListenerToView()}getCameraView(){return U(this,ke,"f")}releaseCameraView(){U(this,ke,"f")&&(this.removeListenerFromView(),U(this,ke,"f").disposed||(U(this,ke,"f")._singleFrameMode="disabled",U(this,ke,"f")._onSingleFrameAcquired=null,U(this,ke,"f")._hideDefaultSelection=!1),U(this,Fe,"f").releaseVideoEl(),Le(this,ke,null,"f"))}addListenerToView(){if(!U(this,ke,"f"))return;if(U(this,ke,"f").disposed)throw new Error("'cameraView' has been disposed.");const l=U(this,ke,"f");U(this,_t,"m",Lt).call(this)||this.videoSrc||(l._innerComponent&&(U(this,Fe,"f").tapFocusEventBoundEl=l._innerComponent),l._selCam&&l._selCam.addEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.addEventListener("change",this._onResolutionSelChange)),l._btnClose&&l._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!U(this,ke,"f")||U(this,ke,"f").disposed)return;const l=U(this,ke,"f");U(this,Fe,"f").tapFocusEventBoundEl=null,l._selCam&&l._selCam.removeEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.removeEventListener("change",this._onResolutionSelChange),l._btnClose&&l._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return U(this,_t,"m",Lt).call(this)?U(this,Nc,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(U(this,Fe,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var l=this;return oe(function*(){const u=U(l,ke,"f");if(null==u?void 0:u.disposed)throw new Error("'cameraView' has been disposed.");u&&(u._singleFrameMode=l.singleFrameMode,U(l,_t,"m",Lt).call(l)?u._clickIptSingleFrameMode():(U(l,Fe,"f").setVideoEl(u.getVideoElement()),u._startLoading()));let g={width:0,height:0,deviceId:""};if(!U(l,_t,"m",Lt).call(l)){try{yield U(l,Fe,"f").open()}catch(m){throw u&&u._stopLoading(),m}U(l,wo,"f")&&l.turnOnTorch().catch(()=>{});const p=l.getResolution();g.width=p.width,g.height=p.height,g.deviceId=l.getSelectedCamera().deviceId}return Le(l,Nc,"open","f"),u&&(u._innerComponent.style.display="",U(l,_t,"m",Lt).call(l)||(u._stopLoading(),u._renderCamerasInfo(l.getSelectedCamera(),U(l,Fe,"f")._arrCameras),u._renderResolutionInfo({width:g.width,height:g.height}),u.eventHandler.fire("content:updated",null,{async:!1}),u.eventHandler.fire("videoEl:resized",null,{async:!1}))),U(l,is,"f").fire("opened",null,{target:l,async:!1}),g})()}close(){const l=U(this,ke,"f");if(null==l?void 0:l.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),U(this,_t,"m",Lt).call(this)||U(this,Fe,"f").close(),Le(this,Nc,"closed","f"),U(this,Tr,"f").stopCharging(),l&&(l._innerComponent.style.display="none",U(this,_t,"m",Lt).call(this)&&l._innerComponent.removeElement("content"),l._stopLoading()),U(this,is,"f").fire("closed",null,{target:this,async:!1})}pause(){if(U(this,_t,"m",Lt).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");U(this,Fe,"f").pause()}isPaused(){var l;return!U(this,_t,"m",Lt).call(this)&&!0===(null===(l=this.video)||void 0===l?void 0:l.paused)}resume(){var l=this;return oe(function*(){if(U(l,_t,"m",Lt).call(l))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield U(l,Fe,"f").resume()})()}selectCamera(l){var u=this;return oe(function*(){if(!l)throw new Error("Invalid value.");let g;g="string"==typeof l?l:l.deviceId,yield U(u,Fe,"f").setCamera(g),Le(u,wo,!1,"f");const p=u.getResolution(),m=U(u,ke,"f");return m&&!m.disposed&&(m._stopLoading(),m._renderCamerasInfo(u.getSelectedCamera(),U(u,Fe,"f")._arrCameras),m._renderResolutionInfo({width:p.width,height:p.height})),{width:p.width,height:p.height,deviceId:u.getSelectedCamera().deviceId}})()}getSelectedCamera(){return U(this,Fe,"f").getCamera()}getAllCameras(){var l=this;return oe(function*(){return U(l,Fe,"f").getCameras()})()}setResolution(l){var u=this;return oe(function*(){yield U(u,Fe,"f").setResolution(l.width,l.height),U(u,wo,"f")&&u.turnOnTorch().catch(()=>{});const g=u.getResolution(),p=U(u,ke,"f");return p&&!p.disposed&&(p._stopLoading(),p._renderResolutionInfo({width:g.width,height:g.height})),{width:g.width,height:g.height,deviceId:u.getSelectedCamera().deviceId}})()}getResolution(){return U(this,Fe,"f").getResolution()}getAvailableResolutions(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getResolutions()}_on(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?U(this,is,"f").on(l,u):U(this,Fe,"f").on(l,u)}_off(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?U(this,is,"f").off(l,u):U(this,Fe,"f").off(l,u)}on(l,u){const g=l.toLowerCase(),p=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(g);if(!p)throw new Error("Invalid event.");this._on(p,u)}off(l,u){const g=l.toLowerCase(),p=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(g);if(!p)throw new Error("Invalid event.");this._off(p,u)}getVideoSettings(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getMediaStreamConstraints()}updateVideoSettings(l){var u=this;return oe(function*(){var g;yield null===(g=U(u,Fe,"f"))||void 0===g?void 0:g.setMediaStreamConstraints(l,!0)})()}getCapabilities(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getCameraCapabilities()}getCameraSettings(){return U(this,Fe,"f").getCameraSettings()}turnOnTorch(){var l=this;return oe(function*(){var u;if(U(l,_t,"m",Lt).call(l))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Fe,"f"))||void 0===u?void 0:u.turnOnTorch(),Le(l,wo,!0,"f")})()}turnOffTorch(){var l=this;return oe(function*(){var u;if(U(l,_t,"m",Lt).call(l))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Fe,"f"))||void 0===u?void 0:u.turnOffTorch(),Le(l,wo,!1,"f")})()}setColorTemperature(l){var u=this;return oe(function*(){if(U(u,_t,"m",Lt).call(u))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield U(u,Fe,"f").setColorTemperature(l,!0)})()}getColorTemperature(){return U(this,Fe,"f").getColorTemperature()}setExposureCompensation(l){var u=this;return oe(function*(){var g;if(U(u,_t,"m",Lt).call(u))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Fe,"f"))||void 0===g?void 0:g.setExposureCompensation(l,!0)})()}getExposureCompensation(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getExposureCompensation()}_setZoom(l){var u=this;return oe(function*(){var g;if(U(u,_t,"m",Lt).call(u))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Fe,"f"))||void 0===g?void 0:g.setZoom(l)})()}setZoom(l){var u=this;return oe(function*(){yield u._setZoom(l)})()}getZoomSettings(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getZoom()}resetZoom(){var l=this;return oe(function*(){var u;if(U(l,_t,"m",Lt).call(l))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Fe,"f"))||void 0===u?void 0:u.resetZoom()})()}setFrameRate(l){var u=this;return oe(function*(){var g;if(U(u,_t,"m",Lt).call(u))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Fe,"f"))||void 0===g?void 0:g.setFrameRate(l,!0)})()}getFrameRate(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getFrameRate()}setFocus(l){var u=this;return oe(function*(){var g;if(U(u,_t,"m",Lt).call(u))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Fe,"f"))||void 0===g?void 0:g.setFocus(l,!0)})()}getFocusSettings(){var l;return null===(l=U(this,Fe,"f"))||void 0===l?void 0:l.getFocus()}setAutoZoomRange(l){U(this,Ne,"f").minValue=l.min,U(this,Ne,"f").maxValue=l.max}getAutoZoomRange(){return{min:U(this,Ne,"f").minValue,max:U(this,Ne,"f").maxValue}}enableEnhancedFeatures(l){var u=this;return oe(function*(){var g,p;if(!(null===(p=null===(g=gn.license)||void 0===g?void 0:g.LicenseManager)||void 0===p?void 0:p.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==tn.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");l&Rs.EF_ENHANCED_FOCUS&&(U(u,$t,"f").enhancedFocus=!0),l&Rs.EF_AUTO_ZOOM&&(U(u,$t,"f").autoZoom=!0),l&Rs.EF_TAP_TO_FOCUS&&(U(u,$t,"f").tapToFocus=!0,U(u,Fe,"f").enableTapToFocus())})()}disableEnhancedFeatures(l){l&Rs.EF_ENHANCED_FOCUS&&(U(this,$t,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),l&Rs.EF_AUTO_ZOOM&&(U(this,$t,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),l&Rs.EF_TAP_TO_FOCUS&&(U(this,$t,"f").tapToFocus=!1,U(this,Fe,"f").disableTapToFocus()),U(this,_t,"m",JI).call(this)&&U(this,_t,"m",QI).call(this)||U(this,Tr,"f").stopCharging()}_setScanRegion(l){if(null!=l&&!r_(l)&&!Xr(l))throw TypeError("Invalid 'region'.");Le(this,Eo,l?JSON.parse(JSON.stringify(l)):null,"f"),U(this,ke,"f")&&!U(this,ke,"f").disposed&&U(this,ke,"f").setScanRegion(l)}setScanRegion(l){this._setScanRegion(l),U(this,ke,"f")&&!U(this,ke,"f").disposed&&(null===l?U(this,ke,"f").setScanRegionMaskVisible(!1):U(this,ke,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(U(this,Eo,"f")))}setErrorListener(l){if(!l)throw new TypeError("Invalid 'listener'");Le(this,kc,l,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!U(this,Fe,"f").isVideoLoaded()||U(this,_t,"m",Lt).call(this))}startFetching(){if(U(this,_t,"m",Lt).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");U(this,rs,"f")||(Le(this,rs,!0,"f"),U(this,_t,"m",T_).call(this))}stopFetching(){U(this,rs,"f")&&(st._onLog&&st._onLog("DCE: stop fetching loop: "+Date.now()),U(this,vi,"f")&&clearTimeout(U(this,vi,"f")),Le(this,rs,!1,"f"))}fetchImage(){if(U(this,_t,"m",Lt).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const l=this.getResolution();if(!(null==l?void 0:l.width)||!(null==l?void 0:l.height))throw new Error("The video is not loaded.");let u;if(u=id.convert(U(this,Eo,"f"),l.width,l.height),u||(u={x:0,y:0,width:l.width,height:l.height}),u.x>l.width||u.y>l.height)throw new Error("Invalid scan region.");u.x+u.width>l.width&&(u.width=l.width-u.x),u.y+u.height>l.height&&(u.height=l.height-u.y);const g={sx:u.x,sy:u.y,sWidth:u.width,sHeight:u.height,dWidth:u.width,dHeight:u.height},p=Math.max(g.dWidth,g.dHeight);if(this.canvasSizeLimit&&p>this.canvasSizeLimit){const D=this.canvasSizeLimit/p;g.dWidth>g.dHeight?(g.dWidth=this.canvasSizeLimit,g.dHeight=Math.round(g.dHeight*D)):(g.dWidth=Math.round(g.dWidth*D),g.dHeight=this.canvasSizeLimit)}const m=U(this,Fe,"f").getFrameData({position:g,pixelFormat:eT.get(this.getPixelFormat())});if(!m)return null;let v;v=m.pixelFormat===mt.GREY?m.width:4*m.width;let C=!0;return 0===g.sx&&0===g.sy&&g.sWidth===l.width&&g.sHeight===l.height&&(C=!1),{bytes:m.data,width:m.width,height:m.height,stride:v,format:tT.get(m.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:qh.ITT_VIDEO_FRAME,isCropped:C,cropRegion:{left:u.x,top:u.y,right:u.x+u.width,bottom:u.y+u.height,isMeasuredInPercentage:!1},originalWidth:l.width,originalHeight:l.height,currentWidth:m.width,currentHeight:m.height,timeSpent:m.timeSpent,timeStamp:m.timeStamp},toCanvas:U(this,Td,"f"),isDCEFrame:!0}}setImageFetchInterval(l){this.fetchInterval=l,U(this,rs,"f")&&(U(this,vi,"f")&&clearTimeout(U(this,vi,"f")),Le(this,vi,setTimeout(()=>{this.disposed||U(this,_t,"m",T_).call(this)},l),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(l){Le(this,xd,l,"f")}getPixelFormat(){return U(this,xd,"f")}takePhoto(l){var u=this;if(!this.isOpen())throw new Error("Not open.");if(U(this,_t,"m",Lt).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),g.setAttribute("capture",""),g.style.position="absolute",g.style.top="-9999px",g.style.backgroundColor="transparent",g.style.color="transparent",g.addEventListener("click",()=>{const p=this.isOpen();this.close(),window.addEventListener("focus",()=>{p&&this.open(),g.remove()},{once:!0})}),g.addEventListener("change",oe(function*(){const p=g.files[0],m=yield(L=oe(function*(N){let B=null,j=null;if("undefined"!=typeof createImageBitmap)try{if(B=yield createImageBitmap(N),B)return B}catch(Y){}var W;return B||(j=yield(W=N,new Promise((Y,$)=>{let q=URL.createObjectURL(W),X=new Image;X.src=q,X.onload=()=>{URL.revokeObjectURL(X.src),Y(X)},X.onerror=Q=>{$(new Error("Can't convert blob to image : "+(Q instanceof Event?Q.type:Q)))}}))),j}),function(N){return L.apply(this,arguments)})(p),v=m instanceof HTMLImageElement?m.naturalWidth:m.width,C=m instanceof HTMLImageElement?m.naturalHeight:m.height;var L;let D=id.convert(U(u,Eo,"f"),v,C);D||(D={x:0,y:0,width:v,height:C});const O=U(u,Id,"f").call(u,m,v,C,D);l&&l(O)})),document.body.appendChild(g),g.click()}convertToPageCoordinates(l){const u=U(this,_t,"m",x_).call(this,l);return{x:u.pageX,y:u.pageY}}convertToClientCoordinates(l){const u=U(this,_t,"m",x_).call(this,l);return{x:u.clientX,y:u.clientY}}dispose(){this.close(),U(this,Fe,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function qn(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function rr(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}D_=st,Fe=new WeakMap,ke=new WeakMap,Nc=new WeakMap,is=new WeakMap,wo=new WeakMap,Sd=new WeakMap,Id=new WeakMap,Td=new WeakMap,kc=new WeakMap,Eo=new WeakMap,xd=new WeakMap,rs=new WeakMap,vi=new WeakMap,$t=new WeakMap,Ne=new WeakMap,Tr=new WeakMap,I_=new WeakMap,_t=new WeakSet,Lt=function(){return"disabled"!==this.singleFrameMode},QI=function(){return!this.videoSrc&&"opened"===U(this,Fe,"f").state},JI=function(){for(let f in U(this,$t,"f"))if(1==U(this,$t,"f")[f])return!0;return!1},T_=function f(){if(this.disposed)return;if("open"!==this.getCameraState()||!U(this,rs,"f"))return U(this,vi,"f")&&clearTimeout(U(this,vi,"f")),void Le(this,vi,setTimeout(()=>{this.disposed||U(this,_t,"m",f).call(this)},this.fetchInterval),"f");const l=()=>{var u;let g;st._onLog&&st._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{g=this.fetchImage()}catch(p){const m=p.message||p;if("The video is not loaded."===m)return;if(null===(u=U(this,kc,"f"))||void 0===u?void 0:u.onErrorReceived)return void setTimeout(()=>{var v;null===(v=U(this,kc,"f"))||void 0===v||v.onErrorReceived(zm.EC_IMAGE_READ_FAILED,m)},0);console.warn(p)}g?(this.addImageToBuffer(g),st._onLog&&st._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),U(this,is,"f").fire("frameAddedToBuffer",null,{async:!1})):st._onLog&&st._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case uo.BOPM_BLOCK:break;case uo.BOPM_UPDATE:l()}else l();U(this,vi,"f")&&clearTimeout(U(this,vi,"f")),Le(this,vi,setTimeout(()=>{this.disposed||U(this,_t,"m",f).call(this)},this.fetchInterval),"f")},x_=function(f){if(!U(this,ke,"f"))throw new Error("Camera view is not set.");if(U(this,ke,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!U(this,_t,"m",Lt).call(this)&&!U(this,Fe,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(U(this,_t,"m",Lt).call(this)&&!U(this,ke,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const l=U(this,ke,"f")._innerComponent.getBoundingClientRect(),u=l.left,g=l.top,p=u+window.scrollX,m=g+window.scrollY,{width:v,height:C}=U(this,ke,"f")._innerComponent.getBoundingClientRect();if(v<=0||C<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let D,O,L;if(U(this,_t,"m",Lt).call(this)){const X=U(this,ke,"f")._innerComponent.getElement("content");D=X.width,O=X.height,L="contain"}else{const X=this.getVideoEl();D=X.videoWidth,O=X.videoHeight,L=U(this,ke,"f").getVideoFit()}const N=v/C,B=D/O;let j,W,Y,$,q=1;if("contain"===L)N<B?(q=v/D,j=u+f.x*q,W=g+f.y*q+(C-O*q)/2,Y=p+f.x*q,$=m+f.y*q+(C-O*q)/2):(q=C/O,j=u+f.x*q+(v-D*q)/2,W=g+f.y*q,Y=p+f.x*q+(v-D*q)/2,$=m+f.y*q);else if("cover"===L)if(N<B){q=C/O;let X=f.x*q-(D*q-v)/2;X=Math.max(X,0),X=Math.min(X,v),j=u+X,W=g+f.y*q,Y=p+X,$=m+f.y*q}else{q=v/D;let X=f.y*q-(O*q-C)/2;X=Math.max(X,0),X=Math.min(X,C),j=u+f.x*q,W=g+X,Y=p+f.x*q,$=m+X}return{clientX:j,clientY:W,pageX:Y,pageY:$}},st._debug=!1,S_={value:void 0},st.browserInfo=Mn,"function"==typeof SuppressedError&&SuppressedError;class yi{static multiply(l,u){const g=[];for(let p=0;p<3;p++){const m=u.slice(3*p,3*p+3);for(let v=0;v<3;v++){const C=[l[v],l[v+3],l[v+6]].reduce((D,O,L)=>D+O*m[L],0);g.push(C)}}return g}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,g){return yi.multiply(l,[1,0,0,0,1,0,u,g,1])}static rotate(l,u){var g=Math.cos(u),p=Math.sin(u);return yi.multiply(l,[g,-p,0,p,g,0,0,0,1])}static scale(l,u,g){return yi.multiply(l,[u,0,0,0,g,0,0,0,1])}}var Wt,os,as,Ad,Ua,Bc,Vc,Ga,Rd,Ni,nT,M_,Gc,Hc;!function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(Wt||(Wt={}));class qe{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(rr(qe,os,!1,"f",as),!1):(rr(qe,os,!0,"f",as),!0)}get disposed(){return qn(this,Rd,"f")}constructor(){Ad.set(this,Wt.RGBA),Ua.set(this,null),Bc.set(this,null),Vc.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ga.set(this,null),Rd.set(this,!1)}drawImage(l,u,g,p,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!g||!p)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==qn(qe,os,"f",as)&&qe.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!qn(qe,os,"f",as))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let C;qe._onLog&&(C=Date.now(),qe._onLog("drawImage(), START: "+C));let D=0,O=0,L=g,N=p,B=0,j=0,W=g,Y=p;m&&(m.sx&&(D=Math.round(m.sx)),m.sy&&(O=Math.round(m.sy)),m.sWidth&&(L=Math.round(m.sWidth)),m.sHeight&&(N=Math.round(m.sHeight)),m.dx&&(B=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(W=Math.round(m.dWidth)),m.dHeight&&(Y=Math.round(m.dHeight)));let $,q=Wt.RGBA;if((null==v?void 0:v.pixelFormat)&&(q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&($=v.bufferContainer,$.length<4*W*Y))throw new Error("Unexpected size of the 'bufferContainer'.");const X=l;if(!qn(qe,os,"f",as)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){qe._onLog&&qe._onLog("drawImage() in context2d."),X.ctx2d||(X.ctx2d=X.getContext("2d",{willReadFrequently:!0}));const Q=X.ctx2d;if(!Q)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(X.width<B+W||X.height<j+Y)&&(X.width=B+W,X.height=j+Y),Q.drawImage(u,D,O,L,N,B,j,W,Y),qe._onLog&&qe._onLog("drawImage() in context2d end. Costs: "+(Date.now()-C)),{context:Q,pixelFormat:Wt.RGBA,bUseWebGL:!1}}qe._onLog&&qe._onLog("drawImage() in WebGL.");try{(X.width<B+W||X.height<j+Y)&&(X.width=B+W,X.height=j+Y,X.ctxWebGL&&X.ctxWebGL.viewport(0,0,B+W,j+Y));const Q=X.ctxWebGL||X.getContext("webgl",{antialias:!1})||X.getContext("experimental-webgl",{antialias:!1});if(!Q){qe._onLog&&qe._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const P=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw P.name="WebGLError",P}if(!X.ctxWebGL||q!==qn(this,Ad,"f")){X.ctxWebGL=Q;const P=_=>{const y=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,y),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW);const I=_.createBuffer();return _.bindBuffer(_.ARRAY_BUFFER,I),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW),{positions:y,texCoords:I}},Ee=_=>{const y=_.createTexture();return _.bindTexture(_.TEXTURE_2D,y),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),y},Be=(_,y)=>{const I=_.createProgram();if(y.forEach(M=>_.attachShader(I,M)),_.linkProgram(I),!_.getProgramParameter(I,_.LINK_STATUS)){const M=new Error(`An error occured linking the program: ${_.getProgramInfoLog(I)}.`);throw M.name="WebGLError",M}return _.useProgram(I),I},Je=(_,y,I)=>{const M=_.createShader(y);if(_.shaderSource(M,I),_.compileShader(M),!_.getShaderParameter(M,_.COMPILE_STATUS)){const x=new Error(`An error occured compiling the shader: ${_.getShaderInfoLog(M)}.`);throw x.name="WebGLError",x}return M},S="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let w="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(w=q.slice(0,3));const b=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${w} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,T=Be(Q,[Je(Q,Q.VERTEX_SHADER,S),Je(Q,Q.FRAGMENT_SHADER,b)]);rr(this,Bc,{program:T,attribLocations:{vertexPosition:Q.getAttribLocation(T,"a_position"),texPosition:Q.getAttribLocation(T,"a_texCoord")},uniformLocations:{uSampler:Q.getUniformLocation(T,"u_image"),uColorFactor:Q.getUniformLocation(T,"uColorFactor"),uMatrix:Q.getUniformLocation(T,"u_matrix"),uTextureMatrix:Q.getUniformLocation(T,"u_textureMatrix")}},"f"),rr(this,Vc,P(Q),"f"),rr(this,Ua,Ee(Q),"f"),rr(this,Ad,q,"f")}const pe=(P,Ee,Be)=>{P.bindBuffer(P.ARRAY_BUFFER,Ee),P.enableVertexAttribArray(Be),P.vertexAttribPointer(Be,2,P.FLOAT,!1,0,0)},Te=(P,Ee,Be,Je)=>{P.clearColor(0,0,0,1),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT),pe(P,Be.positions,Ee.attribLocations.vertexPosition),pe(P,Be.texCoords,Ee.attribLocations.texPosition),P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,Je),P.uniform1i(Ee.uniformLocations.uSampler,0),P.uniform1f(Ee.uniformLocations.uColorFactor,[Wt.GREY,Wt.GREY32].includes(q)?1:0);let S,w,b=yi.translate(yi.identity(),-1,-1);b=yi.scale(b,2,2),b=yi.scale(b,1/P.canvas.width,1/P.canvas.height),S=yi.translate(b,B,j),S=yi.scale(S,W,Y),P.uniformMatrix3fv(Ee.uniformLocations.uMatrix,!1,S),w=yi.translate(yi.identity(),D/g,O/p),w=yi.scale(w,L/g,N/p),P.uniformMatrix3fv(Ee.uniformLocations.uTextureMatrix,!1,w),P.drawArrays(P.TRIANGLES,0,6)};((P,Ee,Be)=>{const Je=P.RGBA,S=P.RGBA,w=P.UNSIGNED_BYTE;P.bindTexture(P.TEXTURE_2D,Ee),P.texImage2D(P.TEXTURE_2D,0,Je,S,w,Be)})(Q,qn(this,Ua,"f"),u),Te(Q,qn(this,Bc,"f"),qn(this,Vc,"f"),qn(this,Ua,"f"));const Ae=$||new Uint8Array(4*W*Y);if(Q.readPixels(B,j,W,Y,Q.RGBA,Q.UNSIGNED_BYTE,Ae),255!==Ae[3]){qe._onLog&&qe._onLog("Incorrect WebGL drawing .");const P=new Error("WebGL error: incorrect drawing.");throw P.name="WebGLError",P}return qe._onLog&&qe._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-C)),{context:Q,pixelFormat:q===Wt.GREY?Wt.GREY32:q,bUseWebGL:!0}}catch(Q){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return qe._onLog&&qe._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,g,p,m,Object.assign({},v,{bUseWebGL:!1}));throw Q.name="WebGLError",Q}}readCvsData(l,u,g){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let p,m=0,v=0,C=l.canvas.width,D=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(C=u.width),u.height&&(D=u.height)),(null==g?void 0:g.length)<4*C*D)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const O=l;g?(O.readPixels(m,v,C,D,O.RGBA,O.UNSIGNED_BYTE,g),p=new Uint8Array(g.buffer,0,4*C*D)):(p=new Uint8Array(4*C*D),O.readPixels(m,v,C,D,O.RGBA,O.UNSIGNED_BYTE,p))}else if(l instanceof CanvasRenderingContext2D){let O;O=l.getImageData(m,v,C,D),p=new Uint8Array(O.data.buffer),null==g||g.set(p)}return p}transformPixelFormat(l,u,g,p){let m,v;if(qe._onLog&&(m=Date.now(),qe._onLog("transformPixelFormat(), START: "+m)),u===g)return qe._onLog&&qe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),p?new Uint8Array(l):l;const C=[Wt.RGBA,Wt.RBGA,Wt.GRBA,Wt.GBRA,Wt.BRGA,Wt.BGRA];if(C.includes(u))if(g===Wt.GREY){v=new Uint8Array(l.length/4);for(let D=0;D<l.length;D+=4)v[D/4]=.21*l[D]+.71*l[D+1]+.07*l[D+2]}else if(g===Wt.GREY32){v=p?new Uint8Array(l):l;for(let D=0;D<l.length;D+=4){const O=.21*l[D]+.71*l[D+1]+.07*l[D+2];v[D]=O,v[D+1]=O,v[D+2]=O}}else{if(!C.includes(g))throw new Error("Unable to transform.");if(p){v=new Uint8Array(l);const D=u.indexOf("r"),O=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),B=g.indexOf("g"),j=g.indexOf("b");for(let W=0;W<l.length;W+=4)v[W+N]=l[W+D],v[W+B]=l[W+O],v[W+j]=l[W+L]}else{v=l;const D=u.indexOf("r"),O=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),B=g.indexOf("g"),j=g.indexOf("b");for(let W=0;W<l.length;W+=4){let Y=[l[W],l[W+1],l[W+2]];v[W+N]=Y[D],v[W+B]=Y[O],v[W+j]=Y[L]}}}else if(u===Wt.GREY){if(g!==Wt.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let D=0;D<l.length;D++)v[4*D]=l[D],v[4*D+1]=l[D],v[4*D+2]=l[D],v[4*D+3]=255}else{if(u!==Wt.GREY32)throw new Error("Unable to transform.");if(g!==Wt.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let D=0;D<l.length;D+=4)v[D/4]=l[D]}return qe._onLog&&qe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,g,p,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==qn(qe,os,"f",as)&&qe.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!qn(qe,os,"f",as))throw new Error("Your browser or machine may not support WebGL.");if(p.sx>u||p.sy>g||p.sx+p.sWidth>u||p.sy+p.sHeight>g)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;qe._onLog&&(v=Date.now(),qe._onLog("getImageData(), START: "+v));const C=Math.round(p.sx),D=Math.round(p.sy),O=Math.round(p.sWidth),L=Math.round(p.sHeight),N=Math.round(p.dWidth),B=Math.round(p.dHeight);let j=Wt.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let W,Y,$,q=null;if((null==m?void 0:m.bufferContainer)&&(q=m.bufferContainer),qn(qe,os,"f",as)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){qe._onLog&&qe._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),W=this._reusedWebGLCvs;try{if(q)if(j===Wt.GREY){if($=new Uint8Array(4*N*B),Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,Y.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}}else Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:q}),$=new Uint8Array(q.buffer,0,4*N*B),$=this.transformPixelFormat($,Y.pixelFormat,j);else j===Wt.GREY?((!qn(this,Ga,"f")||qn(this,Ga,"f").length<4*N*B)&&rr(this,Ga,new Uint8Array(4*N*B),"f"),$=new Uint8Array(qn(this,Ga,"f").buffer,0,4*N*B)):$=new Uint8Array(4*N*B),Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,Y.pixelFormat,j)}catch(X){if("WebGLError"===X.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return qe._onLog&&qe._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},Object.assign({},m,{bUseWebGL:!1}));throw X}}else if(qe._onLog&&qe._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),W=this._reusedCvs,Y=this.drawImage(W,l,u,g,{sx:C,sy:D,sWidth:O,sHeight:L,dWidth:N,dHeight:B},{pixelFormat:Wt.RGBA,bUseWebGL:!1}),$=this.readCvsData(Y.context,{width:N,height:B},null),$=this.transformPixelFormat($,Y.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}return qe._onLog&&qe._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:$,pixelFormat:j,width:N,height:B,bUseWebGL:Y.bUseWebGL}}convertDataToCvs(l,u,g,p){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof g||g<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=g,p===Wt.GREY){v=new Uint8ClampedArray(4*u*g);for(let D=0;D<v.length;D+=4)v[D]=l[D/4],v[D+1]=l[D/4],v[D+2]=l[D/4],v[D+3]=255}else v=new Uint8ClampedArray(l.buffer);const C=new ImageData(v,u,g);return m.getContext("2d").putImageData(C,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),rr(this,Ua,null,"f"),rr(this,Bc,null,"f"),rr(this,Vc,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),rr(this,Rd,!0,"f")}}os=qe,Ad=new WeakMap,Ua=new WeakMap,Bc=new WeakMap,Vc=new WeakMap,Ga=new WeakMap,Rd=new WeakMap,as={value:void 0};class Wa{static beep(){if(!this.beepSoundSource)return;let l;if(U(this,Ni,"f",Gc).size&&(l=U(this,Ni,"f",Gc).values().next().value,this.beepSoundSource==l.src?(U(this,Ni,"f",Gc).delete(l),l.play()):l=null),!l)if(U(this,Ni,"f",Hc).size<64){l=new Audio(this.beepSoundSource);let u=null,g=()=>{l.removeEventListener("loadedmetadata",g),l.play(),u=setTimeout(()=>{U(this,Ni,"f",Hc).delete(l)},2e3*l.duration)};l.addEventListener("loadedmetadata",g),l.addEventListener("ended",()=>{null!=u&&(clearTimeout(u),u=null),l.pause(),l.currentTime=0,U(this,Ni,"f",Hc).delete(l),U(this,Ni,"f",Gc).add(l)})}else U(this,Ni,"f",M_)||(Le(this,Ni,!0,"f",M_),console.warn("The requested audio tracks exceed 64 and will not be played."));l&&U(this,Ni,"f",Hc).add(l)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Wa.vibrateDuration)}}Ni=Wa,nT={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},M_={value:!1},Gc={value:new Set},Hc={value:new Set},Wa.beepSoundSource=U(Wa,Ni,"f",nT),Wa.vibrateDuration=300;const rT="undefined"==typeof self,L_=(()=>{if(!rT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),sT=f=>{if(null==f&&(f="./"),!rT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};null==Ue.dbr&&(Ue.dbr=L_),Yr.dbr={js:!1,wasm:!0,deps:["license","dip"]},gn.dbr={};"string"!=typeof Ue.std&&Wr(Ue.std.version,"1.2.0")<0&&(Ue.std={version:"1.2.0",path:sT(L_+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const P_="2.2.10";var oT,aT,lT,cT;(!Ue.dip||"string"!=typeof Ue.dip&&Wr(Ue.dip.version,P_)<0)&&(Ue.dip={version:P_,path:sT(L_+`../../dynamsoft-image-processing@${P_}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(f){f[f.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",f[f.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",f[f.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(oT||(oT={})),function(f){f[f.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",f[f.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",f[f.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",f[f.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(aT||(aT={})),function(f){f[f.LM_AUTO=1]="LM_AUTO",f[f.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",f[f.LM_STATISTICS=4]="LM_STATISTICS",f[f.LM_LINES=8]="LM_LINES",f[f.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",f[f.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",f[f.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",f[f.LM_CENTRE=128]="LM_CENTRE",f[f.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",f[f.LM_REV=-2147483648]="LM_REV",f[f.LM_SKIP=0]="LM_SKIP"}(lT||(lT={})),function(f){f[f.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",f[f.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",f[f.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",f[f.DM_SMOOTHING=8]="DM_SMOOTHING",f[f.DM_MORPHING=16]="DM_MORPHING",f[f.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",f[f.DM_SHARPENING=64]="DM_SHARPENING",f[f.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",f[f.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",f[f.DM_REV=-2147483648]="DM_REV",f[f.DM_SKIP=0]="DM_SKIP"}(cT||(cT={}));const hT="undefined"==typeof self,N_=(()=>{if(!hT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),dT=f=>{if(null==f&&(f="./"),!hT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};null==Ue.utility&&(Ue.utility=N_),Yr.utility={js:!0,wasm:!0};const k_="1.2.10";"string"!=typeof Ue.std&&Wr(Ue.std.version,k_)<0&&(Ue.std={version:k_,path:dT(N_+`../../dynamsoft-capture-vision-std@${k_}/dist/`)});const B_="2.2.30";(!Ue.dip||"string"!=typeof Ue.dip&&Wr(Ue.dip.version,B_)<0)&&(Ue.dip={version:B_,path:dT(N_+`../../dynamsoft-image-processing@${B_}/dist/`)});let Vs="./";if(document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}Vs=f.substring(0,f.lastIndexOf("/")+1)}const bo=f=>{null==f&&(f="./");let l=document.createElement("a");return l.href=f,(f=l.href).endsWith("/")||(f+="/"),f};tn.engineResourcePaths={std:bo(Vs+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:bo(Vs+"../../dynamsoft-image-processing@2.2.30/dist/"),core:bo(Vs+"../../dynamsoft-core@3.2.30/dist/"),license:bo(Vs+"../../dynamsoft-license@3.2.21/dist/"),cvr:bo(Vs+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:bo(Vs+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:bo(Vs+"../../dynamsoft-barcode-reader@10.2.10/dist/")};const fT="undefined"==typeof self,U_=(()=>{if(!fT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),gT=f=>{if(null==f&&(f="./"),!fT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f},G_=f=>{const l=document.createElement("canvas");return l.width=f.width,l.height=f.height,l.getContext("2d",{willReadFrequently:!0}).putImageData(f,0,0),l},pT=function(){var f=oe(function*(l,u){const g=G_(u);return new Promise((p,m)=>{g.toBlob(v=>p(v),l)})});return function(u,g){return f.apply(this,arguments)}}();null==Ue.ddn&&(Ue.ddn=U_),Yr.ddn={js:!0,wasm:!0,deps:["license","dip"]},gn.ddn={handleNormalizedImageResultItem:function(f){let l=f,u=(g=>{let p,m=g.bytes;if(!(m&&m instanceof Uint8Array))throw Error("Parameter type error");if(Number(g.format)===je.IPF_BGR_888){const v=m.length/3;p=new Uint8ClampedArray(4*v);for(let C=0;C<v;++C)p[4*C]=m[3*C],p[4*C+1]=m[3*C+1],p[4*C+2]=m[3*C+2],p[4*C+3]=255}else if(Number(g.format)===je.IPF_RGB_888){const v=m.length/3;p=new Uint8ClampedArray(4*v);for(let C=0;C<v;++C)p[4*C]=m[3*C+2],p[4*C+1]=m[3*C+1],p[4*C+2]=m[3*C],p[4*C+3]=255}else if(Number(g.format)===je.IPF_GRAYSCALED){const v=m.length;p=new Uint8ClampedArray(4*v);for(let C=0;C<v;C++)p[4*C]=p[4*C+1]=p[4*C+2]=m[C],p[4*C+3]=255}else if(Number(g.format)===je.IPF_BINARY_8){const v=m.length,C=g.width,O=g.stride;p=new Uint8ClampedArray(C*g.height*4);for(let L=0;L<v;L++){let N=m[L],B=L%O,j=Math.floor(L/O);for(let W=0;W<8;W++){let Y=B+W,$=4*(j*C+Y);if(Y>=C)break;p[$]=p[$+1]=p[$+2]=(128&N)/128*255,p[$+3]=255,N<<=1}}}else if(Number(g.format)===je.IPF_ABGR_8888){const v=m.length/4;p=new Uint8ClampedArray(m.length);for(let C=0;C<v;++C)p[4*C]=m[4*C],p[4*C+1]=m[4*C+1],p[4*C+2]=m[4*C+2],p[4*C+3]=m[4*C+3]}else if(Number(g.format)===je.IPF_ARGB_8888){const v=m.length/4;p=new Uint8ClampedArray(m.length);for(let C=0;C<v;++C)p[4*C]=m[4*C],p[4*C+1]=m[4*C+1],p[4*C+2]=m[4*C+2],p[4*C+3]=m[4*C+3]}return new ImageData(p,g.width,g.height)})(l.imageData);l.toCanvas=()=>G_(u),l.toImage=g=>((p,m)=>{const v=G_(m);let C=new Image,D=v.toDataURL(p);return C.src=D,C})(g,u),l.toBlob=g=>pT(g,u),l.saveToFile=function(){var g=oe(function*(p,m){if(!p)return null;if("string"!=typeof p)throw new TypeError("FileName must be of type string.");return(v=oe(function*(C,D,O){return yield new Promise(function(){var L=oe(function*(N,B){try{const j=D.split(".");let W=j[j.length-1];const Y=yield pT(`image/${W}`,C);j.length<=1&&(W="png");const $=new File([Y],D,{type:`image/${W}`});if(O){const q=URL.createObjectURL($),X=document.createElement("a");X.href=q,X.download=D,X.click()}return N($)}catch(j){return B()}});return function(N,B){return L.apply(this,arguments)}}())}),function(C,D,O){return v.apply(this,arguments)})(u,p,m);var v});return function(p,m){return g.apply(this,arguments)}}()}};"string"!=typeof Ue.std&&Wr(Ue.std.version,"1.2.0")<0&&(Ue.std={version:"1.2.0",path:gT(U_+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const W_="2.2.10";var Ya;(!Ue.dip||"string"!=typeof Ue.dip&&Wr(Ue.dip.version,W_)<0)&&(Ue.dip={version:W_,path:gT(U_+`../../dynamsoft-image-processing@${W_}/dist/`)}),function(f){f[f.ICM_COLOUR=0]="ICM_COLOUR",f[f.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",f[f.ICM_BINARY=2]="ICM_BINARY"}(Ya||(Ya={}));let kj=(()=>{class f{constructor(){this.showDiv=!1}getShowDiv(){return this.showDiv}setShowDiv(u){this.showDiv=u}toggleShowDiv(){this.showDiv=!this.showDiv}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=vt({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const Bj=function(){return["/barcode-reader"]};function Vj(f,l){if(1&f&&(Dt(0,"a",6),An(1),ft()),2&f){const u=Ks().$implicit;xn("title",u.name+" details")("routerLink",ha(3,Bj)),Wn(1),Cs("> ",u.name," ")}}const jj=function(){return["/barcode-scanner"]};function Uj(f,l){if(1&f&&(Dt(0,"a",6),An(1),ft()),2&f){const u=Ks().$implicit;xn("title",u.name+" details")("routerLink",ha(3,jj)),Wn(1),Cs("> ",u.name," ")}}const Gj=function(){return["/file-detection"]};function Hj(f,l){if(1&f&&(Dt(0,"a",6),An(1),ft()),2&f){const u=Ks().$implicit;xn("title",u.name+" details")("routerLink",ha(3,Gj)),Wn(1),Cs("> ",u.name," ")}}const Wj=function(){return["/camera-detection"]};function zj(f,l){if(1&f&&(Dt(0,"a",6),An(1),ft()),2&f){const u=Ks().$implicit;xn("title",u.name+" details")("routerLink",ha(3,Wj)),Wn(1),Cs("> ",u.name," ")}}function Yj(f,l){if(1&f&&(Dt(0,"p"),An(1),ft()),2&f){const u=Ks().$implicit;Wn(1),Cs("Description: ",u.description,"")}}function $j(f,l){if(1&f&&(Dt(0,"div")(1,"h3")(2,"div"),ys(3,Vj,2,4,"ng-template",5),ft(),Dt(4,"div"),ys(5,Uj,2,4,"ng-template",5),ft(),Dt(6,"div"),ys(7,Hj,2,4,"ng-template",5),ft(),Dt(8,"div"),ys(9,zj,2,4,"ng-template",5),ft()(),ys(10,Yj,2,1,"p",3),ft()),2&f){const u=l.$implicit;Wn(3),xn("ngIf","reader"===u.id),Wn(2),xn("ngIf","scanner"===u.id),Wn(2),xn("ngIf","file-detection"===u.id),Wn(2),xn("ngIf","camera-detection"===u.id),Wn(1),xn("ngIf",u.description)}}function Xj(f,l){if(1&f&&(Dt(0,"div")(1,"h2"),An(2,"Examples"),ft(),ys(3,$j,11,5,"div",4),ft()),2&f){const u=Ks();Wn(3),xn("ngForOf",u.products)}}let qj=(()=>{class f{constructor(u){this.sharedService=u,this.products=ij,this.inputText="",this.processedText="",this.placeholderText="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ=="}activate(){var u=this;return oe(function*(){u.processedText=u.inputText.toUpperCase(),tn.engineResourcePaths={std:"assets/dynamsoft-capture-vision-std/",dip:"assets/dynamsoft-image-processing/",core:"assets/dynamsoft-core/",license:"assets/dynamsoft-license/",cvr:"assets/dynamsoft-capture-vision-router/",dbr:"assets/dynamsoft-barcode-reader/",dce:"assets/dynamsoft-camera-enhancer/",ddn:"assets/dynamsoft-document-normalizer/"};try{let g=""===u.inputText?u.placeholderText:u.inputText;yield kt.initLicense(g,!0),yield tn.loadWasm(["DBR","DDN"]),u.toggleDivVisibility()}catch(g){alert(g)}})()}toggleDivVisibility(){this.sharedService.toggleShowDiv()}get showDiv(){return this.sharedService.getShowDiv()}}return f.\u0275fac=function(u){return new(u||f)(ye(kj))},f.\u0275cmp=ar({type:f,selectors:[["app-product-list"]],decls:9,vars:3,consts:[["href","https://www.dynamsoft.com/customer/license/trialLicense","target","_blank"],["type","text",3,"ngModel","placeholder","ngModelChange"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngIf"],[3,"title","routerLink"]],template:function(u,g){1&u&&(Dt(0,"div")(1,"div"),An(2," Get a License key from "),Dt(3,"a",0),An(4,"here"),ft()(),Dt(5,"input",1),sn("ngModelChange",function(m){return g.inputText=m}),ft(),Dt(6,"button",2),sn("click",function(){return g.activate()}),An(7,"Activate SDK"),ft()(),ys(8,Xj,4,1,"div",3)),2&u&&(Wn(5),xn("ngModel",g.inputText)("placeholder",g.placeholderText),Wn(3),xn("ngIf",g.showDiv))},directives:[_h,aD,hm,pb,fb,uc],styles:[""]}),f})();class z_{initOverlay(l){this.overlay=l,this.context=this.overlay.getContext("2d")}updateOverlay(l,u){this.overlay&&(this.overlay.width=l,this.overlay.height=u,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(l,u){if(this.context){let g=l.points;this.context.beginPath(),this.context.moveTo(g[0].x,g[0].y),this.context.lineTo(g[1].x,g[1].y),this.context.lineTo(g[2].x,g[2].y),this.context.lineTo(g[3].x,g[3].y),this.context.lineTo(g[0].x,g[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let p=[g[0].x,g[1].x,g[2].x,g[3].x],m=[g[0].y,g[1].y,g[2].y,g[3].y];p.sort(function(D,O){return D-O}),m.sort(function(D,O){return O-D}),this.context.fillText(u,p[0],m[0]+50)}}}let Zj=(()=>{class f{constructor(){this.isLoaded=!1,this.overlayManager=new z_}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),oe(function*(){u.cvr=yield St.createInstance(),u.isLoaded=!0})()}onChange(u){let p=u.currentTarget.files;if(p){let m=p.item(0);if(m){let v=new FileReader;v.onload=C=>{let D=document.getElementById("image");if(D){D.src=C.target.result;const O=new Image;O.onload=L=>{this.overlayManager.updateOverlay(O.width,O.height),this.cvr&&this.cvr.capture(m,"ReadBarcodes_Balance").then(N=>{console.log(N);let B=[],j=document.getElementById("result");try{let Y,$=N.items;if($.length>0){for(var W=0;W<$.length;++W){if($[W].type!==nn.CRIT_BARCODE)continue;let q=$[W];B.push(q.text),Y=q.location,console.log(Y),this.overlayManager.drawOverlay(Y,q.text)}j&&(j.innerHTML=B.join(", "))}else j&&(j.innerHTML=B.join(", "))}catch(Y){alert(Y)}})},O.src=C.target.result}},v.readAsDataURL(m)}}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-barcode-reader"]],decls:6,vars:0,consts:[["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(u,g){1&u&&(Dt(0,"input",0),sn("change",function(m){return g.onChange(m)}),ft(),Dt(1,"div"),$i(2,"a",1),ft(),Dt(3,"div",2),$i(4,"img",3)(5,"canvas",4),ft())},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),f})();const Kj=[{path:"",component:qj},{path:"barcode-reader",component:Zj},{path:"barcode-scanner",component:(()=>{class f{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new z_}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),oe(function*(){yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,g;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(g=this.cameraEnhancer)||void 0===g||g.dispose()}catch(p){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return oe(function*(){var g,p,m,v;const C=yield an.createInstance();u.cameraEnhancer=yield st.createInstance(C),u.isLoaded=!0;let D=document.getElementById("videoContainer");if(D){D.append(C.getUIElement()),null===(p=null===(g=C.getUIElement().shadowRoot)||void 0===g?void 0:g.querySelector(".dce-sel-camera"))||void 0===p||p.setAttribute("style","display: none"),null===(v=null===(m=C.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let O=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(O),u.cvr=yield St.createInstance(),u.isDestroyed||(u.cvr.setInput(u.cameraEnhancer),u.cvr.addResultReceiver({onCapturedResultReceived:L=>{u.overlayManager.clearOverlay();let N=[],B=document.getElementById("result");try{let W,Y=L.items;if(Y.length>0){for(var j=0;j<Y.length;++j){if(Y[j].type!==nn.CRIT_BARCODE)continue;let $=Y[j];N.push($.text),W=$.location,console.log(W),u.overlayManager.drawOverlay(W,$.text)}B&&(B.innerHTML=N.join(", "))}else B&&(B.innerHTML=N.join(", "))}catch(W){alert(W)}}}),u.cvr.addResultReceiver({onDecodedBarcodesReceived:L=>{!L.barcodeResultItems.length||console.log(L)}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield u.cvr.startCapturing("ReadSingleBarcode"),u.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var u=this;return oe(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let g=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(g),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var g=0;g<u.length;++g){var p=u[g],m=document.createElement("option");m.value=p.deviceId,m.text=p.label,this.cameraInfo[p.deviceId]=p,this.videoSelect&&this.videoSelect.appendChild(m)}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-barcode-scanner"]],decls:7,vars:0,consts:[[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"]],template:function(u,g){1&u&&(Dt(0,"div",0)(1,"label",1),An(2,"Video source: "),ft(),Dt(3,"select",2),sn("change",function(){return g.openCamera()}),ft()(),Dt(4,"div",3),$i(5,"div",4)(6,"canvas",5),ft())},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),f})()},{path:"file-detection",component:(()=>{class f{constructor(){this.isLoaded=!1,this.points=[],this.NormalizeDocument_Color="NormalizeDocument_Color",this.NormalizeDocument_Binary="NormalizeDocument_Binary",this.NormalizeDocument_Gray="NormalizeDocument_Gray",this.overlayManager=new z_}ngOnDestroy(){}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),oe(function*(){u.cvr=yield St.createInstance(),u.isLoaded=!0})()}onRadioChange(u){var g=this;if(!this.cvr)return;let p=u.target,m=Ya.ICM_COLOUR;"binary"===p.value?m=Ya.ICM_BINARY:"grayscale"===p.value?m=Ya.ICM_GRAYSCALE:"color"===p.value&&(m=Ya.ICM_COLOUR);let v=this.cvr;oe(function*(){let C=yield v.getSimplifiedSettings("NormalizeDocument_Default");C.documentSettings.colourMode=m,yield g.cvr.updateSettings("NormalizeDocument_Default",C),g.normalize(g.currentFile,g.points)})()}normalize(u,g){var p=this;return oe(function*(){if(p.cvr){let m=yield p.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=g,m.roiMeasuredInPercentage=!1,yield p.cvr.updateSettings("NormalizeDocument_Default",m),p.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let C=v.items[0],D=document.getElementById("normalizedImage");D.width=C.imageData.width,D.height=C.imageData.height;const O=D.getContext("2d");null==O||O.drawImage(C.toCanvas(),0,0)})}})()}onChange(u){var g=this;let m=u.currentTarget.files;if(m){let v=m.item(0);if(v){this.currentFile=v;let C=new FileReader;C.onload=D=>{let O=document.getElementById("image");if(O){O.src=D.target.result;const L=new Image;L.onload=function(){var N=oe(function*(B){if(g.overlayManager.updateOverlay(L.width,L.height),g.cvr){let j=yield g.cvr.capture(v,"DetectDocumentBoundaries_Default");if(j.items.length>0){let W=j.items[0];g.points=W.location.points,g.overlayManager.drawOverlay(W.location,""),g.normalize(v,g.points)}}});return function(B){return N.apply(this,arguments)}}(),L.src=D.target.result}},C.readAsDataURL(v)}}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-file-detection"]],decls:20,vars:2,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["type","file","title","file","id","file","accept","image/*",3,"change"],[1,"container"],["id","imageview"],["id","image","alt",""],["id","overlay"],["id","resultview"],["id","normalizedImage"]],template:function(u,g){1&u&&(Dt(0,"span",0),An(1,"Loading Library..."),ft(),$i(2,"br"),Dt(3,"div",1)(4,"label",2)(5,"input",3),sn("change",function(m){return g.onRadioChange(m)}),ft(),An(6,"Black & White "),ft(),Dt(7,"label",4)(8,"input",5),sn("change",function(m){return g.onRadioChange(m)}),ft(),An(9," Grayscale "),ft(),Dt(10,"label",6)(11,"input",7),sn("change",function(m){return g.onRadioChange(m)}),ft(),An(12," Color "),ft()(),Dt(13,"input",8),sn("change",function(m){return g.onChange(m)}),ft(),Dt(14,"div",9)(15,"div",10),$i(16,"img",11)(17,"canvas",12),ft(),Dt(18,"div",13),$i(19,"canvas",14),ft()()),2&u&&(xn("hidden",g.isLoaded),Wn(11),xn("checked",!0))},styles:["#imageview[_ngcontent-%COMP%]{position:relative;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}.container[_ngcontent-%COMP%]{align-items:center;border:3px solid orange}"]}),f})()},{path:"camera-detection",component:(()=>{class f{constructor(){}ngOnInit(){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-camera-detection"]],decls:2,vars:0,template:function(u,g){1&u&&(Dt(0,"p"),An(1,"camera-detection works!"),ft())},styles:[""]}),f})()}];let Qj=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f}),f.\u0275inj=Vi({imports:[[YS.forRoot(Kj)],YS]}),f})();const Jj=function(){return["/"]};let eU=(()=>{class f{constructor(){}ngOnInit(){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(u,g){1&u&&(Dt(0,"a",0)(1,"h1"),An(2,"Dynamsoft Capture Vision SDK"),ft()()),2&u&&xn("routerLink",ha(1,Jj))},directives:[uc],styles:[""]}),f})(),tU=(()=>{class f{constructor(){this.title="angular-barcode-qr-code-scanner"}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=ar({type:f,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(u,g){1&u&&($i(0,"app-top-bar"),Dt(1,"div",0),$i(2,"router-outlet"),ft())},directives:[eU,Mm],styles:[""]}),f})(),nU=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=lr({type:f,bootstrap:[tU]}),f.\u0275inj=Vi({providers:[],imports:[[Ik,Qj,H2]]}),f})();(function lP(){HE=!1})(),Dk().bootstrapModule(nU).catch(f=>console.error(f))}},Bt=>{Bt(Bt.s=727)}]);