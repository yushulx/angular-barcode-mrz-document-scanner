"use strict";var mKe=Object.defineProperty,vKe=Object.defineProperties,yKe=Object.getOwnPropertyDescriptors,t6=Object.getOwnPropertySymbols,kpe=Object.prototype.hasOwnProperty,Mpe=Object.prototype.propertyIsEnumerable,Rpe=(hi,Is,ia)=>Is in hi?mKe(hi,Is,{enumerable:!0,configurable:!0,writable:!0,value:ia}):hi[Is]=ia,Ke=(hi,Is)=>{for(var ia in Is||(Is={}))kpe.call(Is,ia)&&Rpe(hi,ia,Is[ia]);if(t6)for(var ia of t6(Is))Mpe.call(Is,ia)&&Rpe(hi,ia,Is[ia]);return hi},zt=(hi,Is)=>vKe(hi,yKe(Is)),ic=(hi,Is)=>{var ia={};for(var El in hi)kpe.call(hi,El)&&Is.indexOf(El)<0&&(ia[El]=hi[El]);if(null!=hi&&t6)for(var El of t6(hi))Is.indexOf(El)<0&&Mpe.call(hi,El)&&(ia[El]=hi[El]);return ia};(self.webpackChunkangular_barcode_mrz_document_scanner=self.webpackChunkangular_barcode_mrz_document_scanner||[]).push([[179],{269:()=>{function hi(p){return"function"==typeof p}function Is(p){const o=p(h=>{Error.call(h),h.stack=(new Error).stack});return o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o}const ia=Is(p=>function(o){p(this),this.message=o?`${o.length} errors occurred during unsubscription:\n${o.map((h,v)=>`${v+1}) ${h.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=o});function El(p,n){if(p){const o=p.indexOf(n);0<=o&&p.splice(o,1)}}class Su{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:o}=this;if(o)if(this._parentage=null,Array.isArray(o))for(const y of o)y.remove(this);else o.remove(this);const{initialTeardown:h}=this;if(hi(h))try{h()}catch(y){n=y instanceof ia?y.errors:[y]}const{_finalizers:v}=this;if(v){this._finalizers=null;for(const y of v)try{AU(y)}catch(_){n=null!=n?n:[],_ instanceof ia?n=[...n,..._.errors]:n.push(_)}}if(n)throw new ia(n)}}add(n){var o;if(n&&n!==this)if(this.closed)AU(n);else{if(n instanceof Su){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(o=this._finalizers)&&void 0!==o?o:[]).push(n)}}_hasParent(n){const{_parentage:o}=this;return o===n||Array.isArray(o)&&o.includes(n)}_addParent(n){const{_parentage:o}=this;this._parentage=Array.isArray(o)?(o.push(n),o):o?[o,n]:n}_removeParent(n){const{_parentage:o}=this;o===n?this._parentage=null:Array.isArray(o)&&El(o,n)}remove(n){const{_finalizers:o}=this;o&&El(o,n),n instanceof Su&&n._removeParent(this)}}Su.EMPTY=(()=>{const p=new Su;return p.closed=!0,p})();const EU=Su.EMPTY;function DU(p){return p instanceof Su||p&&"closed"in p&&hi(p.remove)&&hi(p.add)&&hi(p.unsubscribe)}function AU(p){hi(p)?p():p.unsubscribe()}const Gm={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},x3={setTimeout(p,n,...o){const{delegate:h}=x3;return(null==h?void 0:h.setTimeout)?h.setTimeout(p,n,...o):setTimeout(p,n,...o)},clearTimeout(p){const{delegate:n}=x3;return((null==n?void 0:n.clearTimeout)||clearTimeout)(p)},delegate:void 0};function PU(p){x3.setTimeout(()=>{const{onUnhandledError:n}=Gm;if(!n)throw p;n(p)})}function RU(){}const Npe=n6("C",void 0,void 0);function n6(p,n,o){return{kind:p,value:n,error:o}}let zm=null;function w3(p){if(Gm.useDeprecatedSynchronousErrorHandling){const n=!zm;if(n&&(zm={errorThrown:!1,error:null}),p(),n){const{errorThrown:o,error:h}=zm;if(zm=null,o)throw h}}else p()}class i6 extends Su{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,DU(n)&&n.add(this)):this.destination=Gpe}static create(n,o,h){return new PC(n,o,h)}next(n){this.isStopped?o6(function Wpe(p){return n6("N",p,void 0)}(n),this):this._next(n)}error(n){this.isStopped?o6(function Bpe(p){return n6("E",void 0,p)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?o6(Npe,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Vpe=Function.prototype.bind;function r6(p,n){return Vpe.call(p,n)}class jpe{constructor(n){this.partialObserver=n}next(n){const{partialObserver:o}=this;if(o.next)try{o.next(n)}catch(h){S3(h)}}error(n){const{partialObserver:o}=this;if(o.error)try{o.error(n)}catch(h){S3(h)}else S3(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(o){S3(o)}}}class PC extends i6{constructor(n,o,h){let v;if(super(),hi(n)||!n)v={next:null!=n?n:void 0,error:null!=o?o:void 0,complete:null!=h?h:void 0};else{let y;this&&Gm.useDeprecatedNextContext?(y=Object.create(n),y.unsubscribe=()=>this.unsubscribe(),v={next:n.next&&r6(n.next,y),error:n.error&&r6(n.error,y),complete:n.complete&&r6(n.complete,y)}):v=n}this.destination=new jpe(v)}}function S3(p){Gm.useDeprecatedSynchronousErrorHandling?function Upe(p){Gm.useDeprecatedSynchronousErrorHandling&&zm&&(zm.errorThrown=!0,zm.error=p)}(p):PU(p)}function o6(p,n){const{onStoppedNotification:o}=Gm;o&&x3.setTimeout(()=>o(p,n))}const Gpe={closed:!0,next:RU,error:function Hpe(p){throw p},complete:RU},s6="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ym(p){return p}let Ls=(()=>{class p{constructor(o){o&&(this._subscribe=o)}lift(o){const h=new p;return h.source=this,h.operator=o,h}subscribe(o,h,v){const y=function Ype(p){return p&&p instanceof i6||function zpe(p){return p&&hi(p.next)&&hi(p.error)&&hi(p.complete)}(p)&&DU(p)}(o)?o:new PC(o,h,v);return w3(()=>{const{operator:_,source:b}=this;y.add(_?_.call(y,b):b?this._subscribe(y):this._trySubscribe(y))}),y}_trySubscribe(o){try{return this._subscribe(o)}catch(h){o.error(h)}}forEach(o,h){return new(h=MU(h))((v,y)=>{const _=new PC({next:b=>{try{o(b)}catch(w){y(w),_.unsubscribe()}},error:y,complete:v});this.subscribe(_)})}_subscribe(o){var h;return null===(h=this.source)||void 0===h?void 0:h.subscribe(o)}[s6](){return this}pipe(...o){return function kU(p){return 0===p.length?Ym:1===p.length?p[0]:function(o){return p.reduce((h,v)=>v(h),o)}}(o)(this)}toPromise(o){return new(o=MU(o))((h,v)=>{let y;this.subscribe(_=>y=_,_=>v(_),()=>h(y))})}}return p.create=n=>new p(n),p})();function MU(p){var n;return null!==(n=null!=p?p:Gm.Promise)&&void 0!==n?n:Promise}const Xpe=Is(p=>function(){p(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Of=(()=>{class p extends Ls{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(o){const h=new OU(this,this);return h.operator=o,h}_throwIfClosed(){if(this.closed)throw new Xpe}next(o){w3(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const h of this.currentObservers)h.next(o)}})}error(o){w3(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=o;const{observers:h}=this;for(;h.length;)h.shift().error(o)}})}complete(){w3(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:o}=this;for(;o.length;)o.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var o;return(null===(o=this.observers)||void 0===o?void 0:o.length)>0}_trySubscribe(o){return this._throwIfClosed(),super._trySubscribe(o)}_subscribe(o){return this._throwIfClosed(),this._checkFinalizedStatuses(o),this._innerSubscribe(o)}_innerSubscribe(o){const{hasError:h,isStopped:v,observers:y}=this;return h||v?EU:(this.currentObservers=null,y.push(o),new Su(()=>{this.currentObservers=null,El(y,o)}))}_checkFinalizedStatuses(o){const{hasError:h,thrownError:v,isStopped:y}=this;h?o.error(v):y&&o.complete()}asObservable(){const o=new Ls;return o.source=this,o}}return p.create=(n,o)=>new OU(n,o),p})();class OU extends Of{constructor(n,o){super(),this.destination=n,this.source=o}next(n){var o,h;null===(h=null===(o=this.destination)||void 0===o?void 0:o.next)||void 0===h||h.call(o,n)}error(n){var o,h;null===(h=null===(o=this.destination)||void 0===o?void 0:o.error)||void 0===h||h.call(o,n)}complete(){var n,o;null===(o=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===o||o.call(n)}_subscribe(n){var o,h;return null!==(h=null===(o=this.source)||void 0===o?void 0:o.subscribe(n))&&void 0!==h?h:EU}}function FU(p){return hi(null==p?void 0:p.lift)}function Ra(p){return n=>{if(FU(n))return n.lift(function(o){try{return p(o,this)}catch(h){this.error(h)}});throw new TypeError("Unable to lift unknown Observable type")}}function _a(p,n,o,h,v){return new $pe(p,n,o,h,v)}class $pe extends i6{constructor(n,o,h,v,y,_){super(n),this.onFinalize=y,this.shouldUnsubscribe=_,this._next=o?function(b){try{o(b)}catch(w){n.error(w)}}:super._next,this._error=v?function(b){try{v(b)}catch(w){n.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=h?function(){try{h()}catch(b){n.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:o}=this;super.unsubscribe(),!o&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function co(p,n){return Ra((o,h)=>{let v=0;o.subscribe(_a(h,y=>{h.next(p.call(n,y,v++))}))})}function sg(p){return this instanceof sg?(this.v=p,this):new sg(p)}function BU(p,n,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var v,h=o.apply(p,n||[]),y=[];return v=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),b("next"),b("throw"),b("return",function _(V){return function(B){return Promise.resolve(B).then(V,M)}}),v[Symbol.asyncIterator]=function(){return this},v;function b(V,B){h[V]&&(v[V]=function(Q){return new Promise(function(J,Z){y.push([V,Q,J,Z])>1||w(V,Q)})},B&&(v[V]=B(v[V])))}function w(V,B){try{!function I(V){V.value instanceof sg?Promise.resolve(V.value.v).then(A,M):F(y[0][2],V)}(h[V](B))}catch(Q){F(y[0][3],Q)}}function A(V){w("next",V)}function M(V){w("throw",V)}function F(V,B){V(B),y.shift(),y.length&&w(y[0][0],y[0][1])}}function WU(p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=p[Symbol.asyncIterator];return n?n.call(p):(p=function u6(p){var n="function"==typeof Symbol&&Symbol.iterator,o=n&&p[n],h=0;if(o)return o.call(p);if(p&&"number"==typeof p.length)return{next:function(){return p&&h>=p.length&&(p=void 0),{value:p&&p[h++],done:!p}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(p),o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o);function h(y){o[y]=p[y]&&function(_){return new Promise(function(b,w){!function v(y,_,b,w){Promise.resolve(w).then(function(I){y({value:I,done:b})},_)}(b,w,(_=p[y](_)).done,_.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const UU=p=>p&&"number"==typeof p.length&&"function"!=typeof p;function VU(p){return hi(null==p?void 0:p.then)}function jU(p){return hi(p[s6])}function HU(p){return Symbol.asyncIterator&&hi(null==p?void 0:p[Symbol.asyncIterator])}function GU(p){return new TypeError(`You provided ${null!==p&&"object"==typeof p?"an invalid object":`'${p}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const zU=function mge(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function YU(p){return hi(null==p?void 0:p[zU])}function XU(p){return BU(this,arguments,function*(){const o=p.getReader();try{for(;;){const{value:h,done:v}=yield sg(o.read());if(v)return yield sg(void 0);yield yield sg(h)}}finally{o.releaseLock()}})}function $U(p){return hi(null==p?void 0:p.getReader)}function Id(p){if(p instanceof Ls)return p;if(null!=p){if(jU(p))return function vge(p){return new Ls(n=>{const o=p[s6]();if(hi(o.subscribe))return o.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(p);if(UU(p))return function yge(p){return new Ls(n=>{for(let o=0;o<p.length&&!n.closed;o++)n.next(p[o]);n.complete()})}(p);if(VU(p))return function _ge(p){return new Ls(n=>{p.then(o=>{n.closed||(n.next(o),n.complete())},o=>n.error(o)).then(null,PU)})}(p);if(HU(p))return qU(p);if(YU(p))return function Cge(p){return new Ls(n=>{for(const o of p)if(n.next(o),n.closed)return;n.complete()})}(p);if($U(p))return function bge(p){return qU(XU(p))}(p)}throw GU(p)}function qU(p){return new Ls(n=>{(function xge(p,n){var o,h,v,y;return function LU(p,n,o,h){return new(o||(o=Promise))(function(y,_){function b(A){try{I(h.next(A))}catch(M){_(M)}}function w(A){try{I(h.throw(A))}catch(M){_(M)}}function I(A){A.done?y(A.value):function v(y){return y instanceof o?y:new o(function(_){_(y)})}(A.value).then(b,w)}I((h=h.apply(p,n||[])).next())})}(this,void 0,void 0,function*(){try{for(o=WU(p);!(h=yield o.next()).done;)if(n.next(h.value),n.closed)return}catch(_){v={error:_}}finally{try{h&&!h.done&&(y=o.return)&&(yield y.call(o))}finally{if(v)throw v.error}}n.complete()})})(p,n).catch(o=>n.error(o))})}function Ff(p,n,o,h=0,v=!1){const y=n.schedule(function(){o(),v?p.add(this.schedule(null,h)):this.unsubscribe()},h);if(p.add(y),!v)return y}function Ca(p,n,o=1/0){return hi(n)?Ca((h,v)=>co((y,_)=>n(h,y,v,_))(Id(p(h,v))),o):("number"==typeof n&&(o=n),Ra((h,v)=>function wge(p,n,o,h,v,y,_,b){const w=[];let I=0,A=0,M=!1;const F=()=>{M&&!w.length&&!I&&n.complete()},V=Q=>I<h?B(Q):w.push(Q),B=Q=>{y&&n.next(Q),I++;let J=!1;Id(o(Q,A++)).subscribe(_a(n,Z=>{null==v||v(Z),y?V(Z):n.next(Z)},()=>{J=!0},void 0,()=>{if(J)try{for(I--;w.length&&I<h;){const Z=w.shift();_?Ff(n,_,()=>B(Z)):B(Z)}F()}catch(Z){n.error(Z)}}))};return p.subscribe(_a(n,V,()=>{M=!0,F()})),()=>{null==b||b()}}(h,v,p,o)))}function RC(p=1/0){return Ca(Ym,p)}const Lf=new Ls(p=>p.complete());function d6(p){return p[p.length-1]}function KU(p){return hi(d6(p))?p.pop():void 0}function kC(p){return function Tge(p){return p&&hi(p.schedule)}(d6(p))?p.pop():void 0}function JU(p,n=0){return Ra((o,h)=>{o.subscribe(_a(h,v=>Ff(h,p,()=>h.next(v),n),()=>Ff(h,p,()=>h.complete(),n),v=>Ff(h,p,()=>h.error(v),n)))})}function QU(p,n=0){return Ra((o,h)=>{h.add(p.schedule(()=>o.subscribe(h),n))})}function ZU(p,n){if(!p)throw new Error("Iterable cannot be null");return new Ls(o=>{Ff(o,n,()=>{const h=p[Symbol.asyncIterator]();Ff(o,n,()=>{h.next().then(v=>{v.done?o.complete():o.next(v.value)})},0,!0)})})}function ka(p,n){return n?function kge(p,n){if(null!=p){if(jU(p))return function Ege(p,n){return Id(p).pipe(QU(n),JU(n))}(p,n);if(UU(p))return function Age(p,n){return new Ls(o=>{let h=0;return n.schedule(function(){h===p.length?o.complete():(o.next(p[h++]),o.closed||this.schedule())})})}(p,n);if(VU(p))return function Dge(p,n){return Id(p).pipe(QU(n),JU(n))}(p,n);if(HU(p))return ZU(p,n);if(YU(p))return function Pge(p,n){return new Ls(o=>{let h;return Ff(o,n,()=>{h=p[zU](),Ff(o,n,()=>{let v,y;try{({value:v,done:y}=h.next())}catch(_){return void o.error(_)}y?o.complete():o.next(v)},0,!0)}),()=>hi(null==h?void 0:h.return)&&h.return()})}(p,n);if($U(p))return function Rge(p,n){return ZU(XU(p),n)}(p,n)}throw GU(p)}(p,n):Id(p)}function h6(p,n,...o){if(!0===n)return void p();if(!1===n)return;const h=new PC({next:()=>{h.unsubscribe(),p()}});return n(...o).subscribe(h)}function eo(p){for(let n in p)if(p[n]===eo)return n;throw Error("Could not find renamed property on target object.")}function f6(p,n){for(const o in n)n.hasOwnProperty(o)&&!p.hasOwnProperty(o)&&(p[o]=n[o])}function Vr(p){if("string"==typeof p)return p;if(Array.isArray(p))return"["+p.map(Vr).join(", ")+"]";if(null==p)return""+p;if(p.overriddenName)return`${p.overriddenName}`;if(p.name)return`${p.name}`;const n=p.toString();if(null==n)return""+n;const o=n.indexOf("\n");return-1===o?n:n.substring(0,o)}function p6(p,n){return null==p||""===p?null===n?"":n:null==n||""===n?p:p+" "+n}const Fge=eo({__forward_ref__:eo});function uo(p){return p.__forward_ref__=uo,p.toString=function(){return Vr(this())},p}function Fi(p){return eV(p)?p():p}function eV(p){return"function"==typeof p&&p.hasOwnProperty(Fge)&&p.__forward_ref__===uo}class yr extends Error{constructor(n,o){super(function g6(p,n){return`NG0${Math.abs(p)}${n?": "+n:""}`}(n,o)),this.code=n}}function fi(p){return"string"==typeof p?p:null==p?"":String(p)}function Ma(p){return"function"==typeof p?p.name||p.toString():"object"==typeof p&&null!=p&&"function"==typeof p.type?p.type.name||p.type.toString():fi(p)}function T3(p,n){const o=n?` in ${n}`:"";throw new yr(-201,`No provider for ${Ma(p)} found${o}`)}function Dc(p,n){null==p&&function jr(p,n,o,h){throw new Error(`ASSERTION ERROR: ${p}`+(null==h?"":` [Expected=> ${o} ${h} ${n} <=Actual]`))}(n,p,null,"!=")}function dr(p){return{token:p.token,providedIn:p.providedIn||null,factory:p.factory,value:void 0}}function Ed(p){return{providers:p.providers||[],imports:p.imports||[]}}function m6(p){return tV(p,I3)||tV(p,iV)}function tV(p,n){return p.hasOwnProperty(n)?p[n]:null}function nV(p){return p&&(p.hasOwnProperty(v6)||p.hasOwnProperty(jge))?p[v6]:null}const I3=eo({\u0275prov:eo}),v6=eo({\u0275inj:eo}),iV=eo({ngInjectableDef:eo}),jge=eo({ngInjectorDef:eo});var si=(()=>((si=si||{})[si.Default=0]="Default",si[si.Host=1]="Host",si[si.Self=2]="Self",si[si.SkipSelf=4]="SkipSelf",si[si.Optional=8]="Optional",si))();let y6;function ag(p){const n=y6;return y6=p,n}function rV(p,n,o){const h=m6(p);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:o&si.Optional?null:void 0!==n?n:void T3(Vr(p),"Injector")}function lg(p){return{toString:p}.toString()}var Dd=(()=>((Dd=Dd||{})[Dd.OnPush=0]="OnPush",Dd[Dd.Default=1]="Default",Dd))(),bh=(()=>{return(p=bh||(bh={}))[p.Emulated=0]="Emulated",p[p.None=2]="None",p[p.ShadowDom=3]="ShadowDom",bh;var p})();const Gge="undefined"!=typeof globalThis&&globalThis,zge="undefined"!=typeof window&&window,Yge="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,$r=Gge||"undefined"!=typeof global&&global||zge||Yge,Y0={},to=[],E3=eo({\u0275cmp:eo}),_6=eo({\u0275dir:eo}),C6=eo({\u0275pipe:eo}),oV=eo({\u0275mod:eo}),Bf=eo({\u0275fac:eo}),MC=eo({__NG_ELEMENT_ID__:eo});let Xge=0;function Dl(p){return lg(()=>{const o={},h={type:p.type,providersResolver:null,decls:p.decls,vars:p.vars,factory:null,template:p.template||null,consts:p.consts||null,ngContentSelectors:p.ngContentSelectors,hostBindings:p.hostBindings||null,hostVars:p.hostVars||0,hostAttrs:p.hostAttrs||null,contentQueries:p.contentQueries||null,declaredInputs:o,inputs:null,outputs:null,exportAs:p.exportAs||null,onPush:p.changeDetection===Dd.OnPush,directiveDefs:null,pipeDefs:null,selectors:p.selectors||to,viewQuery:p.viewQuery||null,features:p.features||null,data:p.data||{},encapsulation:p.encapsulation||bh.Emulated,id:"c",styles:p.styles||to,_:null,setInput:null,schemas:p.schemas||null,tView:null},v=p.directives,y=p.features,_=p.pipes;return h.id+=Xge++,h.inputs=cV(p.inputs,o),h.outputs=cV(p.outputs),y&&y.forEach(b=>b(h)),h.directiveDefs=v?()=>("function"==typeof v?v():v).map(sV):null,h.pipeDefs=_?()=>("function"==typeof _?_():_).map(aV):null,h})}function sV(p){return Oa(p)||function cg(p){return p[_6]||null}(p)}function aV(p){return function Xm(p){return p[C6]||null}(p)}const lV={};function xh(p){return lg(()=>{const n={type:p.type,bootstrap:p.bootstrap||to,declarations:p.declarations||to,imports:p.imports||to,exports:p.exports||to,transitiveCompileScopes:null,schemas:p.schemas||null,id:p.id||null};return null!=p.id&&(lV[p.id]=p.type),n})}function cV(p,n){if(null==p)return Y0;const o={};for(const h in p)if(p.hasOwnProperty(h)){let v=p[h],y=v;Array.isArray(v)&&(y=v[1],v=v[0]),o[v]=h,n&&(n[v]=y)}return o}const ii=Dl;function Oa(p){return p[E3]||null}function Tu(p,n){const o=p[oV]||null;if(!o&&!0===n)throw new Error(`Type ${Vr(p)} does not have '\u0275mod' property.`);return o}function wh(p){return Array.isArray(p)&&"object"==typeof p[1]}function Pd(p){return Array.isArray(p)&&!0===p[1]}function w6(p){return 0!=(8&p.flags)}function R3(p){return 2==(2&p.flags)}function k3(p){return 1==(1&p.flags)}function Rd(p){return null!==p.template}function Zge(p){return 0!=(512&p[2])}function Jm(p,n){return p.hasOwnProperty(Bf)?p[Bf]:null}class nme{constructor(n,o,h){this.previousValue=n,this.currentValue=o,this.firstChange=h}isFirstChange(){return this.firstChange}}function Eu(){return dV}function dV(p){return p.type.prototype.ngOnChanges&&(p.setInput=rme),ime}function ime(){const p=fV(this),n=null==p?void 0:p.current;if(n){const o=p.previous;if(o===Y0)p.previous=n;else for(let h in n)o[h]=n[h];p.current=null,this.ngOnChanges(n)}}function rme(p,n,o,h){const v=fV(p)||function ome(p,n){return p[hV]=n}(p,{previous:Y0,current:null}),y=v.current||(v.current={}),_=v.previous,b=this.declaredInputs[o],w=_[b];y[b]=new nme(w&&w.currentValue,n,_===Y0),p[h]=n}Eu.ngInherit=!0;const hV="__ngSimpleChanges__";function fV(p){return p[hV]||null}let D6;function cs(p){return!!p.listen}const pV={createRenderer:(p,n)=>function A6(){return void 0!==D6?D6:"undefined"!=typeof document?document:void 0}()};function Ns(p){for(;Array.isArray(p);)p=p[0];return p}function M3(p,n){return Ns(n[p])}function Pc(p,n){return Ns(n[p.index])}function P6(p,n){return p.data[n]}function Rc(p,n){const o=n[p];return wh(o)?o:o[0]}function R6(p){return 128==(128&p[2])}function ug(p,n){return null==n?null:p[n]}function mV(p){p[18]=0}function k6(p,n){p[5]+=n;let o=p,h=p[3];for(;null!==h&&(1===n&&1===o[5]||-1===n&&0===o[5]);)h[5]+=n,o=h,h=h[3]}const pi={lFrame:TV(null),bindingsEnabled:!0};function yV(){return pi.bindingsEnabled}function jt(){return pi.lFrame.lView}function wr(){return pi.lFrame.tView}function ra(){let p=_V();for(;null!==p&&64===p.type;)p=p.parent;return p}function _V(){return pi.lFrame.currentTNode}function Sh(p,n){const o=pi.lFrame;o.currentTNode=p,o.isParent=n}function M6(){return pi.lFrame.isParent}function Q0(){return pi.lFrame.bindingIndex++}function wme(p,n){const o=pi.lFrame;o.bindingIndex=o.bindingRootIndex=p,F6(n)}function F6(p){pi.lFrame.currentDirectiveIndex=p}function N6(p){pi.lFrame.currentQueryIndex=p}function Tme(p){const n=p[1];return 2===n.type?n.declTNode:1===n.type?p[6]:null}function wV(p,n,o){if(o&si.SkipSelf){let v=n,y=p;for(;!(v=v.parent,null!==v||o&si.Host||(v=Tme(y),null===v||(y=y[15],10&v.type))););if(null===v)return!1;n=v,p=y}const h=pi.lFrame=SV();return h.currentTNode=n,h.lView=p,!0}function F3(p){const n=SV(),o=p[1];pi.lFrame=n,n.currentTNode=o.firstChild,n.lView=p,n.tView=o,n.contextLView=p,n.bindingIndex=o.bindingStartIndex,n.inI18n=!1}function SV(){const p=pi.lFrame,n=null===p?null:p.child;return null===n?TV(p):n}function TV(p){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:p,child:null,inI18n:!1};return null!==p&&(p.child=n),n}function IV(){const p=pi.lFrame;return pi.lFrame=p.parent,p.currentTNode=null,p.lView=null,p}const EV=IV;function L3(){const p=IV();p.isParent=!0,p.tView=null,p.selectedIndex=-1,p.contextLView=null,p.elementDepthCount=0,p.currentDirectiveIndex=-1,p.currentNamespace=null,p.bindingRootIndex=-1,p.bindingIndex=-1,p.currentQueryIndex=0}function Rl(){return pi.lFrame.selectedIndex}function dg(p){pi.lFrame.selectedIndex=p}function Yo(){const p=pi.lFrame;return P6(p.tView,p.selectedIndex)}function N3(p,n){for(let o=n.directiveStart,h=n.directiveEnd;o<h;o++){const y=p.data[o].type.prototype,{ngAfterContentInit:_,ngAfterContentChecked:b,ngAfterViewInit:w,ngAfterViewChecked:I,ngOnDestroy:A}=y;_&&(p.contentHooks||(p.contentHooks=[])).push(-o,_),b&&((p.contentHooks||(p.contentHooks=[])).push(o,b),(p.contentCheckHooks||(p.contentCheckHooks=[])).push(o,b)),w&&(p.viewHooks||(p.viewHooks=[])).push(-o,w),I&&((p.viewHooks||(p.viewHooks=[])).push(o,I),(p.viewCheckHooks||(p.viewCheckHooks=[])).push(o,I)),null!=A&&(p.destroyHooks||(p.destroyHooks=[])).push(o,A)}}function B3(p,n,o){DV(p,n,3,o)}function W3(p,n,o,h){(3&p[2])===o&&DV(p,n,o,h)}function B6(p,n){let o=p[2];(3&o)===n&&(o&=2047,o+=1,p[2]=o)}function DV(p,n,o,h){const y=null!=h?h:-1,_=n.length-1;let b=0;for(let w=void 0!==h?65535&p[18]:0;w<_;w++)if("number"==typeof n[w+1]){if(b=n[w],null!=h&&b>=h)break}else n[w]<0&&(p[18]+=65536),(b<y||-1==y)&&(Ome(p,o,n,w),p[18]=(4294901760&p[18])+w+2),w++}function Ome(p,n,o,h){const v=o[h]<0,y=o[h+1],b=p[v?-o[h]:o[h]];if(v){if(p[2]>>11<p[18]>>16&&(3&p[2])===n){p[2]+=2048;try{y.call(b)}finally{}}}else try{y.call(b)}finally{}}class BC{constructor(n,o,h){this.factory=n,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=h}}function U3(p,n,o){const h=cs(p);let v=0;for(;v<o.length;){const y=o[v];if("number"==typeof y){if(0!==y)break;v++;const _=o[v++],b=o[v++],w=o[v++];h?p.setAttribute(n,b,w,_):n.setAttributeNS(_,b,w)}else{const _=y,b=o[++v];U6(_)?h&&p.setProperty(n,_,b):h?p.setAttribute(n,_,b):n.setAttribute(_,b),v++}}return v}function AV(p){return 3===p||4===p||6===p}function U6(p){return 64===p.charCodeAt(0)}function V3(p,n){if(null!==n&&0!==n.length)if(null===p||0===p.length)p=n.slice();else{let o=-1;for(let h=0;h<n.length;h++){const v=n[h];"number"==typeof v?o=v:0===o||PV(p,o,v,null,-1===o||2===o?n[++h]:null)}}return p}function PV(p,n,o,h,v){let y=0,_=p.length;if(-1===n)_=-1;else for(;y<p.length;){const b=p[y++];if("number"==typeof b){if(b===n){_=-1;break}if(b>n){_=y-1;break}}}for(;y<p.length;){const b=p[y];if("number"==typeof b)break;if(b===o){if(null===h)return void(null!==v&&(p[y+1]=v));if(h===p[y+1])return void(p[y+2]=v)}y++,null!==h&&y++,null!==v&&y++}-1!==_&&(p.splice(_,0,n),y=_+1),p.splice(y++,0,o),null!==h&&p.splice(y++,0,h),null!==v&&p.splice(y++,0,v)}function RV(p){return-1!==p}function Z0(p){return 32767&p}function ey(p,n){let o=function Wme(p){return p>>16}(p),h=n;for(;o>0;)h=h[15],o--;return h}let V6=!0;function j3(p){const n=V6;return V6=p,n}let Ume=0;function UC(p,n){const o=H6(p,n);if(-1!==o)return o;const h=n[1];h.firstCreatePass&&(p.injectorIndex=n.length,j6(h.data,p),j6(n,null),j6(h.blueprint,null));const v=H3(p,n),y=p.injectorIndex;if(RV(v)){const _=Z0(v),b=ey(v,n),w=b[1].data;for(let I=0;I<8;I++)n[y+I]=b[_+I]|w[_+I]}return n[y+8]=v,y}function j6(p,n){p.push(0,0,0,0,0,0,0,0,n)}function H6(p,n){return-1===p.injectorIndex||p.parent&&p.parent.injectorIndex===p.injectorIndex||null===n[p.injectorIndex+8]?-1:p.injectorIndex}function H3(p,n){if(p.parent&&-1!==p.parent.injectorIndex)return p.parent.injectorIndex;let o=0,h=null,v=n;for(;null!==v;){const y=v[1],_=y.type;if(h=2===_?y.declTNode:1===_?v[6]:null,null===h)return-1;if(o++,v=v[15],-1!==h.injectorIndex)return h.injectorIndex|o<<16}return-1}function G3(p,n,o){!function Vme(p,n,o){let h;"string"==typeof o?h=o.charCodeAt(0)||0:o.hasOwnProperty(MC)&&(h=o[MC]),null==h&&(h=o[MC]=Ume++);const v=255&h;n.data[p+(v>>5)]|=1<<v}(p,n,o)}function OV(p,n,o){if(o&si.Optional)return p;T3(n,"NodeInjector")}function FV(p,n,o,h){if(o&si.Optional&&void 0===h&&(h=null),0==(o&(si.Self|si.Host))){const v=p[9],y=ag(void 0);try{return v?v.get(n,h,o&si.Optional):rV(n,h,o&si.Optional)}finally{ag(y)}}return OV(h,n,o)}function LV(p,n,o,h=si.Default,v){if(null!==p){const y=function zme(p){if("string"==typeof p)return p.charCodeAt(0)||0;const n=p.hasOwnProperty(MC)?p[MC]:void 0;return"number"==typeof n?n>=0?255&n:Hme:n}(o);if("function"==typeof y){if(!wV(n,p,h))return h&si.Host?OV(v,o,h):FV(n,o,h,v);try{const _=y(h);if(null!=_||h&si.Optional)return _;T3(o)}finally{EV()}}else if("number"==typeof y){let _=null,b=H6(p,n),w=-1,I=h&si.Host?n[16][6]:null;for((-1===b||h&si.SkipSelf)&&(w=-1===b?H3(p,n):n[b+8],-1!==w&&WV(h,!1)?(_=n[1],b=Z0(w),n=ey(w,n)):b=-1);-1!==b;){const A=n[1];if(BV(y,b,A.data)){const M=Gme(b,n,o,_,h,I);if(M!==NV)return M}w=n[b+8],-1!==w&&WV(h,n[1].data[b+8]===I)&&BV(y,b,n)?(_=A,b=Z0(w),n=ey(w,n)):b=-1}}}return FV(n,o,h,v)}const NV={};function Hme(){return new ty(ra(),jt())}function Gme(p,n,o,h,v,y){const _=n[1],b=_.data[p+8],A=function z3(p,n,o,h,v){const y=p.providerIndexes,_=n.data,b=1048575&y,w=p.directiveStart,A=y>>20,F=v?b+A:p.directiveEnd;for(let V=h?b:b+A;V<F;V++){const B=_[V];if(V<w&&o===B||V>=w&&B.type===o)return V}if(v){const V=_[w];if(V&&Rd(V)&&V.type===o)return w}return null}(b,_,o,null==h?R3(b)&&V6:h!=_&&0!=(3&b.type),v&si.Host&&y===b);return null!==A?VC(n,_,A,b):NV}function VC(p,n,o,h){let v=p[o];const y=n.data;if(function Fme(p){return p instanceof BC}(v)){const _=v;_.resolving&&function Lge(p,n){const o=n?`. Dependency path: ${n.join(" > ")} > ${p}`:"";throw new yr(-200,`Circular dependency in DI detected for ${p}${o}`)}(Ma(y[o]));const b=j3(_.canSeeViewProviders);_.resolving=!0;const w=_.injectImpl?ag(_.injectImpl):null;wV(p,h,si.Default);try{v=p[o]=_.factory(void 0,y,p,h),n.firstCreatePass&&o>=h.directiveStart&&function Mme(p,n,o){const{ngOnChanges:h,ngOnInit:v,ngDoCheck:y}=n.type.prototype;if(h){const _=dV(n);(o.preOrderHooks||(o.preOrderHooks=[])).push(p,_),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(p,_)}v&&(o.preOrderHooks||(o.preOrderHooks=[])).push(0-p,v),y&&((o.preOrderHooks||(o.preOrderHooks=[])).push(p,y),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(p,y))}(o,y[o],n)}finally{null!==w&&ag(w),j3(b),_.resolving=!1,EV()}}return v}function BV(p,n,o){return!!(o[n+(p>>5)]&1<<p)}function WV(p,n){return!(p&si.Self||p&si.Host&&n)}class ty{constructor(n,o){this._tNode=n,this._lView=o}get(n,o,h){return LV(this._tNode,this._lView,n,h,o)}}function ol(p){return lg(()=>{const n=p.prototype.constructor,o=n[Bf]||G6(n),h=Object.prototype;let v=Object.getPrototypeOf(p.prototype).constructor;for(;v&&v!==h;){const y=v[Bf]||G6(v);if(y&&y!==o)return y;v=Object.getPrototypeOf(v)}return y=>new y})}function G6(p){return eV(p)?()=>{const n=G6(Fi(p));return n&&n()}:Jm(p)}const iy="__parameters__";function oy(p,n,o){return lg(()=>{const h=function z6(p){return function(...o){if(p){const h=p(...o);for(const v in h)this[v]=h[v]}}}(n);function v(...y){if(this instanceof v)return h.apply(this,y),this;const _=new v(...y);return b.annotation=_,b;function b(w,I,A){const M=w.hasOwnProperty(iy)?w[iy]:Object.defineProperty(w,iy,{value:[]})[iy];for(;M.length<=A;)M.push(null);return(M[A]=M[A]||[]).push(_),w}}return o&&(v.prototype=Object.create(o.prototype)),v.prototype.ngMetadataName=p,v.annotationCls=v,v})}class Yi{constructor(n,o){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof o?this.__NG_ELEMENT_ID__=o:void 0!==o&&(this.\u0275prov=dr({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Xme=new Yi("AnalyzeForEntryComponents");function Th(p,n){p.forEach(o=>Array.isArray(o)?Th(o,n):n(o))}function VV(p,n,o){n>=p.length?p.push(o):p.splice(n,0,o)}function Y3(p,n){return n>=p.length-1?p.pop():p.splice(n,1)[0]}function kc(p,n,o){let h=sy(p,n);return h>=0?p[1|h]=o:(h=~h,function Kme(p,n,o,h){let v=p.length;if(v==n)p.push(o,h);else if(1===v)p.push(h,p[0]),p[0]=o;else{for(v--,p.push(p[v-1],p[v]);v>n;)p[v]=p[v-2],v--;p[n]=o,p[n+1]=h}}(p,h,n,o)),h}function X6(p,n){const o=sy(p,n);if(o>=0)return p[1|o]}function sy(p,n){return function GV(p,n,o){let h=0,v=p.length>>o;for(;v!==h;){const y=h+(v-h>>1),_=p[y<<o];if(n===_)return y<<o;_>n?v=y:h=y+1}return~(v<<o)}(p,n,1)}const YC={},q6="__NG_DI_FLAG__",$3="ngTempTokenPath",ive=/\n/gm,YV="__source",ove=eo({provide:String,useValue:eo});let XC;function XV(p){const n=XC;return XC=p,n}function sve(p,n=si.Default){if(void 0===XC)throw new yr(203,"");return null===XC?rV(p,void 0,n):XC.get(p,n&si.Optional?null:void 0,n)}function ri(p,n=si.Default){return(function Hge(){return y6}()||sve)(Fi(p),n)}const ave=ri;function K6(p){const n=[];for(let o=0;o<p.length;o++){const h=Fi(p[o]);if(Array.isArray(h)){if(0===h.length)throw new yr(900,"");let v,y=si.Default;for(let _=0;_<h.length;_++){const b=h[_],w=lve(b);"number"==typeof w?-1===w?v=b.token:y|=w:v=b}n.push(ri(v,y))}else n.push(ri(h))}return n}function $C(p,n){return p[q6]=n,p.prototype[q6]=n,p}function lve(p){return p[q6]}const q3=$C(oy("Inject",p=>({token:p})),-1),fg=$C(oy("Optional"),8),qC=$C(oy("SkipSelf"),4);var Mc=(()=>((Mc=Mc||{})[Mc.Important=1]="Important",Mc[Mc.DashCase=2]="DashCase",Mc))();const tj="__ngContext__";function sl(p,n){p[tj]=n}function Z6(p){const n=function JC(p){return p[tj]||null}(p);return n?Array.isArray(n)?n:n.lView:null}function tR(p,n){return undefined(p,n)}function QC(p){const n=p[3];return Pd(n)?n[3]:n}function nR(p){return lj(p[13])}function iR(p){return lj(p[4])}function lj(p){for(;null!==p&&!Pd(p);)p=p[4];return p}function ly(p,n,o,h,v){if(null!=h){let y,_=!1;Pd(h)?y=h:wh(h)&&(_=!0,h=h[0]);const b=Ns(h);0===p&&null!==o?null==v?pj(n,o,b):Qm(n,o,b,v||null,!0):1===p&&null!==o?Qm(n,o,b,v||null,!0):2===p?function uR(p,n,o){const h=J3(p,n);h&&function Wve(p,n,o,h){cs(p)?p.removeChild(n,o,h):n.removeChild(o)}(p,h,n,o)}(n,b,_):3===p&&n.destroyNode(b),null!=y&&function jve(p,n,o,h,v){const y=o[7];y!==Ns(o)&&ly(n,p,h,y,v);for(let b=10;b<o.length;b++){const w=o[b];ZC(w[1],w,p,n,h,y)}}(n,p,y,o,v)}}function oR(p,n,o){if(cs(p))return p.createElement(n,o);{const h=null!==o?function cme(p){const n=p.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(o):null;return null===h?p.createElement(n):p.createElementNS(h,n)}}function uj(p,n){const o=p[9],h=o.indexOf(n),v=n[3];1024&n[2]&&(n[2]&=-1025,k6(v,-1)),o.splice(h,1)}function sR(p,n){if(p.length<=10)return;const o=10+n,h=p[o];if(h){const v=h[17];null!==v&&v!==p&&uj(v,h),n>0&&(p[o-1][4]=h[4]);const y=Y3(p,10+n);!function Rve(p,n){ZC(p,n,n[11],2,null,null),n[0]=null,n[6]=null}(h[1],h);const _=y[19];null!==_&&_.detachView(y[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function dj(p,n){if(!(256&n[2])){const o=n[11];cs(o)&&o.destroyNode&&ZC(p,n,o,3,null,null),function Ove(p){let n=p[13];if(!n)return aR(p[1],p);for(;n;){let o=null;if(wh(n))o=n[13];else{const h=n[10];h&&(o=h)}if(!o){for(;n&&!n[4]&&n!==p;)wh(n)&&aR(n[1],n),n=n[3];null===n&&(n=p),wh(n)&&aR(n[1],n),o=n&&n[4]}n=o}}(n)}}function aR(p,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function Bve(p,n){let o;if(null!=p&&null!=(o=p.destroyHooks))for(let h=0;h<o.length;h+=2){const v=n[o[h]];if(!(v instanceof BC)){const y=o[h+1];if(Array.isArray(y))for(let _=0;_<y.length;_+=2){const b=v[y[_]],w=y[_+1];try{w.call(b)}finally{}}else try{y.call(v)}finally{}}}}(p,n),function Nve(p,n){const o=p.cleanup,h=n[7];let v=-1;if(null!==o)for(let y=0;y<o.length-1;y+=2)if("string"==typeof o[y]){const _=o[y+1],b="function"==typeof _?_(n):Ns(n[_]),w=h[v=o[y+2]],I=o[y+3];"boolean"==typeof I?b.removeEventListener(o[y],w,I):I>=0?h[v=I]():h[v=-I].unsubscribe(),y+=2}else{const _=h[v=o[y+1]];o[y].call(_)}if(null!==h){for(let y=v+1;y<h.length;y++)h[y]();n[7]=null}}(p,n),1===n[1].type&&cs(n[11])&&n[11].destroy();const o=n[17];if(null!==o&&Pd(n[3])){o!==n[3]&&uj(o,n);const h=n[19];null!==h&&h.detachView(p)}}}function hj(p,n,o){return function fj(p,n,o){let h=n;for(;null!==h&&40&h.type;)h=(n=h).parent;if(null===h)return o[0];if(2&h.flags){const v=p.data[h.directiveStart].encapsulation;if(v===bh.None||v===bh.Emulated)return null}return Pc(h,o)}(p,n.parent,o)}function Qm(p,n,o,h,v){cs(p)?p.insertBefore(n,o,h,v):n.insertBefore(o,h,v)}function pj(p,n,o){cs(p)?p.appendChild(n,o):n.appendChild(o)}function gj(p,n,o,h,v){null!==h?Qm(p,n,o,h,v):pj(p,n,o)}function J3(p,n){return cs(p)?p.parentNode(n):n.parentNode}let yj=function vj(p,n,o){return 40&p.type?Pc(p,o):null};function Q3(p,n,o,h){const v=hj(p,h,n),y=n[11],b=function mj(p,n,o){return yj(p,n,o)}(h.parent||n[6],h,n);if(null!=v)if(Array.isArray(o))for(let w=0;w<o.length;w++)gj(y,v,o[w],b,!1);else gj(y,v,o,b,!1)}function Z3(p,n){if(null!==n){const o=n.type;if(3&o)return Pc(n,p);if(4&o)return cR(-1,p[n.index]);if(8&o){const h=n.child;if(null!==h)return Z3(p,h);{const v=p[n.index];return Pd(v)?cR(-1,v):Ns(v)}}if(32&o)return tR(n,p)()||Ns(p[n.index]);{const h=Cj(p,n);return null!==h?Array.isArray(h)?h[0]:Z3(QC(p[16]),h):Z3(p,n.next)}}return null}function Cj(p,n){return null!==n?p[16][6].projection[n.projection]:null}function cR(p,n){const o=10+p+1;if(o<n.length){const h=n[o],v=h[1].firstChild;if(null!==v)return Z3(h,v)}return n[7]}function dR(p,n,o,h,v,y,_){for(;null!=o;){const b=h[o.index],w=o.type;if(_&&0===n&&(b&&sl(Ns(b),h),o.flags|=4),64!=(64&o.flags))if(8&w)dR(p,n,o.child,h,v,y,!1),ly(n,p,v,b,y);else if(32&w){const I=tR(o,h);let A;for(;A=I();)ly(n,p,v,A,y);ly(n,p,v,b,y)}else 16&w?bj(p,n,h,o,v,y):ly(n,p,v,b,y);o=_?o.projectionNext:o.next}}function ZC(p,n,o,h,v,y){dR(o,h,p.firstChild,n,v,y,!1)}function bj(p,n,o,h,v,y){const _=o[16],w=_[6].projection[h.projection];if(Array.isArray(w))for(let I=0;I<w.length;I++)ly(n,p,v,w[I],y);else dR(p,n,w,_[3],v,y,!0)}function xj(p,n,o){cs(p)?p.setAttribute(n,"style",o):n.style.cssText=o}function hR(p,n,o){cs(p)?""===o?p.removeAttribute(n,"class"):p.setAttribute(n,"class",o):n.className=o}class Ij{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function pg(p){return p instanceof Ij?p.changingThisBreaksApplicationSecurity:p}const n0e=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,i0e=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Bs=(()=>((Bs=Bs||{})[Bs.NONE=0]="NONE",Bs[Bs.HTML=1]="HTML",Bs[Bs.STYLE=2]="STYLE",Bs[Bs.SCRIPT=3]="SCRIPT",Bs[Bs.URL=4]="URL",Bs[Bs.RESOURCE_URL=5]="RESOURCE_URL",Bs))();function _R(p){const n=function nb(){const p=jt();return p&&p[12]}();return n?n.sanitize(Bs.URL,p)||"":function eb(p,n){const o=function Qve(p){return p instanceof Ij&&p.getTypeName()||null}(p);if(null!=o&&o!==n){if("ResourceURL"===o&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${o} (see https://g.co/ng/security#xss)`)}return o===n}(p,"URL")?pg(p):function nT(p){return(p=String(p)).match(n0e)||p.match(i0e)?p:"unsafe:"+p}(fi(p))}function bR(p){return p.ngOriginalError}function C0e(p,...n){p.error(...n)}class ib{constructor(){this._console=console}handleError(n){const o=this._findOriginalError(n),h=function _0e(p){return p&&p.ngErrorLogger||C0e}(n);h(this._console,"ERROR",n),o&&h(this._console,"ORIGINAL ERROR",o)}_findOriginalError(n){let o=n&&bR(n);for(;o&&bR(o);)o=bR(o);return o||null}}const E0e=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind($r))();function Eh(p){return p instanceof Function?p():p}function Lj(p,n,o){let h=p.length;for(;;){const v=p.indexOf(n,o);if(-1===v)return v;if(0===v||p.charCodeAt(v-1)<=32){const y=n.length;if(v+y===h||p.charCodeAt(v+y)<=32)return v}o=v+1}}const Nj="ng-template";function R0e(p,n,o){let h=0;for(;h<p.length;){let v=p[h++];if(o&&"class"===v){if(v=p[h],-1!==Lj(v.toLowerCase(),n,0))return!0}else if(1===v){for(;h<p.length&&"string"==typeof(v=p[h++]);)if(v.toLowerCase()===n)return!0;return!1}}return!1}function Bj(p){return 4===p.type&&p.value!==Nj}function k0e(p,n,o){return n===(4!==p.type||o?p.value:Nj)}function M0e(p,n,o){let h=4;const v=p.attrs||[],y=function L0e(p){for(let n=0;n<p.length;n++)if(AV(p[n]))return n;return p.length}(v);let _=!1;for(let b=0;b<n.length;b++){const w=n[b];if("number"!=typeof w){if(!_)if(4&h){if(h=2|1&h,""!==w&&!k0e(p,w,o)||""===w&&1===n.length){if(kd(h))return!1;_=!0}}else{const I=8&h?w:n[++b];if(8&h&&null!==p.attrs){if(!R0e(p.attrs,I,o)){if(kd(h))return!1;_=!0}continue}const M=O0e(8&h?"class":w,v,Bj(p),o);if(-1===M){if(kd(h))return!1;_=!0;continue}if(""!==I){let F;F=M>y?"":v[M+1].toLowerCase();const V=8&h?F:null;if(V&&-1!==Lj(V,I,0)||2&h&&I!==F){if(kd(h))return!1;_=!0}}}}else{if(!_&&!kd(h)&&!kd(w))return!1;if(_&&kd(w))continue;_=!1,h=w|1&h}}return kd(h)||_}function kd(p){return 0==(1&p)}function O0e(p,n,o,h){if(null===n)return-1;let v=0;if(h||!o){let y=!1;for(;v<n.length;){const _=n[v];if(_===p)return v;if(3===_||6===_)y=!0;else{if(1===_||2===_){let b=n[++v];for(;"string"==typeof b;)b=n[++v];continue}if(4===_)break;if(0===_){v+=4;continue}}v+=y?1:2}return-1}return function N0e(p,n){let o=p.indexOf(4);if(o>-1)for(o++;o<p.length;){const h=p[o];if("number"==typeof h)return-1;if(h===n)return o;o++}return-1}(n,p)}function Wj(p,n,o=!1){for(let h=0;h<n.length;h++)if(M0e(p,n[h],o))return!0;return!1}function Uj(p,n){return p?":not("+n.trim()+")":n}function W0e(p){let n=p[0],o=1,h=2,v="",y=!1;for(;o<p.length;){let _=p[o];if("string"==typeof _)if(2&h){const b=p[++o];v+="["+_+(b.length>0?'="'+b+'"':"")+"]"}else 8&h?v+="."+_:4&h&&(v+=" "+_);else""!==v&&!kd(_)&&(n+=Uj(y,v),v=""),h=_,y=y||!kd(h);o++}return""!==v&&(n+=Uj(y,v)),n}const gi={};function no(p){Vj(wr(),jt(),Rl()+p,!1)}function Vj(p,n,o,h){if(!h)if(3==(3&n[2])){const y=p.preOrderCheckHooks;null!==y&&B3(n,y,o)}else{const y=p.preOrderHooks;null!==y&&W3(n,y,0,o)}dg(o)}function rT(p,n){return p<<17|n<<2}function Md(p){return p>>17&32767}function xR(p){return 2|p}function Vf(p){return(131068&p)>>2}function wR(p,n){return-131069&p|n<<2}function SR(p){return 1|p}function Qj(p,n){const o=p.contentQueries;if(null!==o)for(let h=0;h<o.length;h+=2){const v=o[h],y=o[h+1];if(-1!==y){const _=p.data[y];N6(v),_.contentQueries(2,n[y],y)}}}function rb(p,n,o,h,v,y,_,b,w,I){const A=n.blueprint.slice();return A[0]=v,A[2]=140|h,mV(A),A[3]=A[15]=p,A[8]=o,A[10]=_||p&&p[10],A[11]=b||p&&p[11],A[12]=w||p&&p[12]||null,A[9]=I||p&&p[9]||null,A[6]=y,A[16]=2==n.type?p[16]:A,A}function uy(p,n,o,h,v){let y=p.data[n];if(null===y)y=function MR(p,n,o,h,v){const y=_V(),_=M6(),w=p.data[n]=function iye(p,n,o,h,v,y){return{type:o,index:h,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:y,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,_?y:y&&y.parent,o,n,h,v);return null===p.firstChild&&(p.firstChild=w),null!==y&&(_?null==y.child&&null!==w.parent&&(y.child=w):null===y.next&&(y.next=w)),w}(p,n,o,h,v),function xme(){return pi.lFrame.inI18n}()&&(y.flags|=64);else if(64&y.type){y.type=o,y.value=h,y.attrs=v;const _=function NC(){const p=pi.lFrame,n=p.currentTNode;return p.isParent?n:n.parent}();y.injectorIndex=null===_?-1:_.injectorIndex}return Sh(y,!0),y}function dy(p,n,o,h){if(0===o)return-1;const v=n.length;for(let y=0;y<o;y++)n.push(h),p.blueprint.push(h),p.data.push(null);return v}function ob(p,n,o){F3(n);try{const h=p.viewQuery;null!==h&&jR(1,h,o);const v=p.template;null!==v&&Zj(p,n,v,1,o),p.firstCreatePass&&(p.firstCreatePass=!1),p.staticContentQueries&&Qj(p,n),p.staticViewQueries&&jR(2,p.viewQuery,o);const y=p.components;null!==y&&function eye(p,n){for(let o=0;o<n.length;o++)bye(p,n[o])}(n,y)}catch(h){throw p.firstCreatePass&&(p.incompleteFirstPass=!0,p.firstCreatePass=!1),h}finally{n[2]&=-5,L3()}}function hy(p,n,o,h){const v=n[2];if(256!=(256&v)){F3(n);try{mV(n),function CV(p){return pi.lFrame.bindingIndex=p}(p.bindingStartIndex),null!==o&&Zj(p,n,o,2,h);const _=3==(3&v);if(_){const I=p.preOrderCheckHooks;null!==I&&B3(n,I,null)}else{const I=p.preOrderHooks;null!==I&&W3(n,I,0,null),B6(n,0)}if(function _ye(p){for(let n=nR(p);null!==n;n=iR(n)){if(!n[2])continue;const o=n[9];for(let h=0;h<o.length;h++){const v=o[h],y=v[3];0==(1024&v[2])&&k6(y,1),v[2]|=1024}}}(n),function yye(p){for(let n=nR(p);null!==n;n=iR(n))for(let o=10;o<n.length;o++){const h=n[o],v=h[1];R6(h)&&hy(v,h,v.template,h[8])}}(n),null!==p.contentQueries&&Qj(p,n),_){const I=p.contentCheckHooks;null!==I&&B3(n,I)}else{const I=p.contentHooks;null!==I&&W3(n,I,1),B6(n,1)}!function Q0e(p,n){const o=p.hostBindingOpCodes;if(null!==o)try{for(let h=0;h<o.length;h++){const v=o[h];if(v<0)dg(~v);else{const y=v,_=o[++h],b=o[++h];wme(_,y),b(2,n[y])}}}finally{dg(-1)}}(p,n);const b=p.components;null!==b&&function Z0e(p,n){for(let o=0;o<n.length;o++)Cye(p,n[o])}(n,b);const w=p.viewQuery;if(null!==w&&jR(2,w,h),_){const I=p.viewCheckHooks;null!==I&&B3(n,I)}else{const I=p.viewHooks;null!==I&&W3(n,I,2),B6(n,2)}!0===p.firstUpdatePass&&(p.firstUpdatePass=!1),n[2]&=-73,1024&n[2]&&(n[2]&=-1025,k6(n[3],-1))}finally{L3()}}}function tye(p,n,o,h){const v=n[10],_=function gV(p){return 4==(4&p[2])}(n);try{!_&&v.begin&&v.begin(),_&&ob(p,n,h),hy(p,n,o,h)}finally{!_&&v.end&&v.end()}}function Zj(p,n,o,h,v){const y=Rl(),_=2&h;try{dg(-1),_&&n.length>20&&Vj(p,n,20,!1),o(h,v)}finally{dg(y)}}function OR(p,n,o){!yV()||(function uye(p,n,o,h){const v=o.directiveStart,y=o.directiveEnd;p.firstCreatePass||UC(o,n),sl(h,n);const _=o.initialInputs;for(let b=v;b<y;b++){const w=p.data[b],I=Rd(w);I&&gye(n,o,w);const A=VC(n,p,b,o);sl(A,n),null!==_&&mye(0,b-v,A,w,0,_),I&&(Rc(o.index,n)[8]=A)}}(p,n,o,Pc(o,n)),128==(128&o.flags)&&function dye(p,n,o){const h=o.directiveStart,v=o.directiveEnd,_=o.index,b=function Sme(){return pi.lFrame.currentDirectiveIndex}();try{dg(_);for(let w=h;w<v;w++){const I=p.data[w],A=n[w];F6(w),(null!==I.hostBindings||0!==I.hostVars||null!==I.hostAttrs)&&lH(I,A)}}finally{dg(-1),F6(b)}}(p,n,o))}function FR(p,n,o=Pc){const h=n.localNames;if(null!==h){let v=n.index+1;for(let y=0;y<h.length;y+=2){const _=h[y+1],b=-1===_?o(n,p):p[_];p[v++]=b}}}function tH(p){const n=p.tView;return null===n||n.incompleteFirstPass?p.tView=aT(1,null,p.template,p.decls,p.vars,p.directiveDefs,p.pipeDefs,p.viewQuery,p.schemas,p.consts):n}function aT(p,n,o,h,v,y,_,b,w,I){const A=20+h,M=A+v,F=function nye(p,n){const o=[];for(let h=0;h<n;h++)o.push(h<p?null:gi);return o}(A,M),V="function"==typeof I?I():I;return F[1]={type:p,blueprint:F,template:o,queries:null,viewQuery:b,declTNode:n,data:F.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:M,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof y?y():y,pipeRegistry:"function"==typeof _?_():_,firstChild:null,schemas:w,consts:V,incompleteFirstPass:!1}}function oH(p,n,o){for(let h in p)if(p.hasOwnProperty(h)){const v=p[h];(o=null===o?{}:o).hasOwnProperty(h)?o[h].push(n,v):o[h]=[n,v]}return o}function LR(p,n,o,h){let v=!1;if(yV()){const y=function hye(p,n,o){const h=p.directiveRegistry;let v=null;if(h)for(let y=0;y<h.length;y++){const _=h[y];Wj(o,_.selectors,!1)&&(v||(v=[]),G3(UC(o,n),p,_.type),Rd(_)?(cH(p,o),v.unshift(_)):v.push(_))}return v}(p,n,o),_=null===h?null:{"":-1};if(null!==y){v=!0,uH(o,p.data.length,y.length);for(let A=0;A<y.length;A++){const M=y[A];M.providersResolver&&M.providersResolver(M)}let b=!1,w=!1,I=dy(p,n,y.length,null);for(let A=0;A<y.length;A++){const M=y[A];o.mergedAttrs=V3(o.mergedAttrs,M.hostAttrs),dH(p,o,n,I,M),pye(I,M,_),null!==M.contentQueries&&(o.flags|=8),(null!==M.hostBindings||null!==M.hostAttrs||0!==M.hostVars)&&(o.flags|=128);const F=M.type.prototype;!b&&(F.ngOnChanges||F.ngOnInit||F.ngDoCheck)&&((p.preOrderHooks||(p.preOrderHooks=[])).push(o.index),b=!0),!w&&(F.ngOnChanges||F.ngDoCheck)&&((p.preOrderCheckHooks||(p.preOrderCheckHooks=[])).push(o.index),w=!0),I++}!function rye(p,n){const h=n.directiveEnd,v=p.data,y=n.attrs,_=[];let b=null,w=null;for(let I=n.directiveStart;I<h;I++){const A=v[I],M=A.inputs,F=null===y||Bj(n)?null:vye(M,y);_.push(F),b=oH(M,I,b),w=oH(A.outputs,I,w)}null!==b&&(b.hasOwnProperty("class")&&(n.flags|=16),b.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=_,n.inputs=b,n.outputs=w}(p,o)}_&&function fye(p,n,o){if(n){const h=p.localNames=[];for(let v=0;v<n.length;v+=2){const y=o[n[v+1]];if(null==y)throw new yr(-301,!1);h.push(n[v],y)}}}(o,h,_)}return o.mergedAttrs=V3(o.mergedAttrs,o.attrs),v}function aH(p,n,o,h,v,y){const _=y.hostBindings;if(_){let b=p.hostBindingOpCodes;null===b&&(b=p.hostBindingOpCodes=[]);const w=~n.index;(function cye(p){let n=p.length;for(;n>0;){const o=p[--n];if("number"==typeof o&&o<0)return o}return 0})(b)!=w&&b.push(w),b.push(h,v,_)}}function lH(p,n){null!==p.hostBindings&&p.hostBindings(1,n)}function cH(p,n){n.flags|=2,(p.components||(p.components=[])).push(n.index)}function pye(p,n,o){if(o){if(n.exportAs)for(let h=0;h<n.exportAs.length;h++)o[n.exportAs[h]]=p;Rd(n)&&(o[""]=p)}}function uH(p,n,o){p.flags|=1,p.directiveStart=n,p.directiveEnd=n+o,p.providerIndexes=n}function dH(p,n,o,h,v){p.data[h]=v;const y=v.factory||(v.factory=Jm(v.type)),_=new BC(y,Rd(v),null);p.blueprint[h]=_,o[h]=_,aH(p,n,0,h,dy(p,o,v.hostVars,gi),v)}function gye(p,n,o){const h=Pc(n,p),v=tH(o),y=p[10],_=lT(p,rb(p,v,null,o.onPush?64:16,h,n,y,y.createRenderer(h,o),null,null));p[n.index]=_}function Dh(p,n,o,h,v,y){const _=Pc(p,n);!function NR(p,n,o,h,v,y,_){if(null==y)cs(p)?p.removeAttribute(n,v,o):n.removeAttribute(v);else{const b=null==_?fi(y):_(y,h||"",v);cs(p)?p.setAttribute(n,v,b,o):o?n.setAttributeNS(o,v,b):n.setAttribute(v,b)}}(n[11],_,y,p.value,o,h,v)}function mye(p,n,o,h,v,y){const _=y[n];if(null!==_){const b=h.setInput;for(let w=0;w<_.length;){const I=_[w++],A=_[w++],M=_[w++];null!==b?h.setInput(o,M,I,A):o[A]=M}}}function vye(p,n){let o=null,h=0;for(;h<n.length;){const v=n[h];if(0!==v)if(5!==v){if("number"==typeof v)break;p.hasOwnProperty(v)&&(null===o&&(o=[]),o.push(v,p[v],n[h+1])),h+=2}else h+=2;else h+=4}return o}function hH(p,n,o,h){return new Array(p,!0,!1,n,null,0,h,o,null,null)}function Cye(p,n){const o=Rc(n,p);if(R6(o)){const h=o[1];80&o[2]?hy(h,o,h.template,o[8]):o[5]>0&&BR(o)}}function BR(p){for(let h=nR(p);null!==h;h=iR(h))for(let v=10;v<h.length;v++){const y=h[v];if(1024&y[2]){const _=y[1];hy(_,y,_.template,y[8])}else y[5]>0&&BR(y)}const o=p[1].components;if(null!==o)for(let h=0;h<o.length;h++){const v=Rc(o[h],p);R6(v)&&v[5]>0&&BR(v)}}function bye(p,n){const o=Rc(n,p),h=o[1];(function xye(p,n){for(let o=n.length;o<p.blueprint.length;o++)n.push(p.blueprint[o])})(h,o),ob(h,o,o[8])}function lT(p,n){return p[13]?p[14][4]=n:p[13]=n,p[14]=n,n}function WR(p){for(;p;){p[2]|=64;const n=QC(p);if(Zge(p)&&!n)return p;p=n}return null}function fH(p){!function UR(p){for(let n=0;n<p.components.length;n++){const o=p.components[n],h=Z6(o),v=h[1];tye(v,h,v.template,o)}}(p[8])}function jR(p,n,o){N6(0),n(p,o)}const Sye=(()=>Promise.resolve(null))();function pH(p){return p[7]||(p[7]=[])}function gH(p){return p.cleanup||(p.cleanup=[])}function vH(p,n){const o=p[9],h=o?o.get(ib,null):null;h&&h.handleError(n)}function yH(p,n,o,h,v){for(let y=0;y<o.length;){const _=o[y++],b=o[y++],w=n[_],I=p.data[_];null!==I.setInput?I.setInput(w,v,h,b):w[b]=v}}function jf(p,n,o){const h=M3(n,p);!function cj(p,n,o){cs(p)?p.setValue(n,o):n.textContent=o}(p[11],h,o)}function cT(p,n,o){let h=o?p.styles:null,v=o?p.classes:null,y=0;if(null!==n)for(let _=0;_<n.length;_++){const b=n[_];"number"==typeof b?y=b:1==y?v=p6(v,b):2==y&&(h=p6(h,b+": "+n[++_]+";"))}o?p.styles=h:p.stylesWithoutHost=h,o?p.classes=v:p.classesWithoutHost=v}const HR=new Yi("INJECTOR",-1);class _H{get(n,o=YC){if(o===YC){const h=new Error(`NullInjectorError: No provider for ${Vr(n)}!`);throw h.name="NullInjectorError",h}return o}}const GR=new Yi("Set Injector scope."),sb={},Eye={};let zR;function CH(){return void 0===zR&&(zR=new _H),zR}function bH(p,n=null,o=null,h){const v=xH(p,n,o,h);return v._resolveInjectorDefTypes(),v}function xH(p,n=null,o=null,h){return new Dye(p,o,n||CH(),h)}class Dye{constructor(n,o,h,v=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const y=[];o&&Th(o,b=>this.processProvider(b,n,o)),Th([n],b=>this.processInjectorType(b,[],y)),this.records.set(HR,fy(void 0,this));const _=this.records.get(GR);this.scope=null!=_?_.value:null,this.source=v||("object"==typeof n?null:Vr(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,o=YC,h=si.Default){this.assertNotDestroyed();const v=XV(this),y=ag(void 0);try{if(!(h&si.SkipSelf)){let b=this.records.get(n);if(void 0===b){const w=function Lye(p){return"function"==typeof p||"object"==typeof p&&p instanceof Yi}(n)&&m6(n);b=w&&this.injectableDefInScope(w)?fy(YR(n),sb):null,this.records.set(n,b)}if(null!=b)return this.hydrate(n,b)}return(h&si.Self?CH():this.parent).get(n,o=h&si.Optional&&o===YC?null:o)}catch(_){if("NullInjectorError"===_.name){if((_[$3]=_[$3]||[]).unshift(Vr(n)),v)throw _;return function cve(p,n,o,h){const v=p[$3];throw n[YV]&&v.unshift(n[YV]),p.message=function uve(p,n,o,h=null){p=p&&"\n"===p.charAt(0)&&"\u0275"==p.charAt(1)?p.substr(2):p;let v=Vr(n);if(Array.isArray(n))v=n.map(Vr).join(" -> ");else if("object"==typeof n){let y=[];for(let _ in n)if(n.hasOwnProperty(_)){let b=n[_];y.push(_+":"+("string"==typeof b?JSON.stringify(b):Vr(b)))}v=`{${y.join(", ")}}`}return`${o}${h?"("+h+")":""}[${v}]: ${p.replace(ive,"\n  ")}`}("\n"+p.message,v,o,h),p.ngTokenPath=v,p[$3]=null,p}(_,n,"R3InjectorError",this.source)}throw _}finally{ag(y),XV(v)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((h,v)=>n.push(Vr(v))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new yr(205,!1)}processInjectorType(n,o,h){if(!(n=Fi(n)))return!1;let v=nV(n);const y=null==v&&n.ngModule||void 0,_=void 0===y?n:y,b=-1!==h.indexOf(_);if(void 0!==y&&(v=nV(y)),null==v)return!1;if(null!=v.imports&&!b){let A;h.push(_);try{Th(v.imports,M=>{this.processInjectorType(M,o,h)&&(void 0===A&&(A=[]),A.push(M))})}finally{}if(void 0!==A)for(let M=0;M<A.length;M++){const{ngModule:F,providers:V}=A[M];Th(V,B=>this.processProvider(B,F,V||to))}}this.injectorDefTypes.add(_);const w=Jm(_)||(()=>new _);this.records.set(_,fy(w,sb));const I=v.providers;if(null!=I&&!b){const A=n;Th(I,M=>this.processProvider(M,A,I))}return void 0!==y&&void 0!==n.providers}processProvider(n,o,h){let v=py(n=Fi(n))?n:Fi(n&&n.provide);const y=function Pye(p,n,o){return SH(p)?fy(void 0,p.useValue):fy(wH(p),sb)}(n);if(py(n)||!0!==n.multi)this.records.get(v);else{let _=this.records.get(v);_||(_=fy(void 0,sb,!0),_.factory=()=>K6(_.multi),this.records.set(v,_)),v=n,_.multi.push(n)}this.records.set(v,y)}hydrate(n,o){return o.value===sb&&(o.value=Eye,o.value=o.factory()),"object"==typeof o.value&&o.value&&function Fye(p){return null!==p&&"object"==typeof p&&"function"==typeof p.ngOnDestroy}(o.value)&&this.onDestroy.add(o.value),o.value}injectableDefInScope(n){if(!n.providedIn)return!1;const o=Fi(n.providedIn);return"string"==typeof o?"any"===o||o===this.scope:this.injectorDefTypes.has(o)}}function YR(p){const n=m6(p),o=null!==n?n.factory:Jm(p);if(null!==o)return o;if(p instanceof Yi)throw new yr(204,!1);if(p instanceof Function)return function Aye(p){const n=p.length;if(n>0)throw function zC(p,n){const o=[];for(let h=0;h<p;h++)o.push(n);return o}(n,"?"),new yr(204,!1);const o=function Uge(p){const n=p&&(p[I3]||p[iV]);if(n){const o=function Vge(p){if(p.hasOwnProperty("name"))return p.name;const n=(""+p).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(p);return console.warn(`DEPRECATED: DI is instantiating a token "${o}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${o}" class.`),n}return null}(p);return null!==o?()=>o.factory(p):()=>new p}(p);throw new yr(204,!1)}function wH(p,n,o){let h;if(py(p)){const v=Fi(p);return Jm(v)||YR(v)}if(SH(p))h=()=>Fi(p.useValue);else if(function kye(p){return!(!p||!p.useFactory)}(p))h=()=>p.useFactory(...K6(p.deps||[]));else if(function Rye(p){return!(!p||!p.useExisting)}(p))h=()=>ri(Fi(p.useExisting));else{const v=Fi(p&&(p.useClass||p.provide));if(!function Oye(p){return!!p.deps}(p))return Jm(v)||YR(v);h=()=>new v(...K6(p.deps))}return h}function fy(p,n,o=!1){return{factory:p,value:n,multi:o?[]:void 0}}function SH(p){return null!==p&&"object"==typeof p&&ove in p}function py(p){return"function"==typeof p}let oc=(()=>{class p{static create(o,h){var v;if(Array.isArray(o))return bH({name:""},h,o,"");{const y=null!==(v=o.name)&&void 0!==v?v:"";return bH({name:y},o.parent,o.providers,y)}}}return p.THROW_IF_NOT_FOUND=YC,p.NULL=new _H,p.\u0275prov=dr({token:p,providedIn:"any",factory:()=>ri(HR)}),p.__NG_ELEMENT_ID__=-1,p})();function Gye(p,n){N3(Z6(p)[1],ra())}function Hr(p){let n=function LH(p){return Object.getPrototypeOf(p.prototype).constructor}(p.type),o=!0;const h=[p];for(;n;){let v;if(Rd(p))v=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new yr(903,"");v=n.\u0275dir}if(v){if(o){h.push(v);const _=p;_.inputs=qR(p.inputs),_.declaredInputs=qR(p.declaredInputs),_.outputs=qR(p.outputs);const b=v.hostBindings;b&&$ye(p,b);const w=v.viewQuery,I=v.contentQueries;if(w&&Yye(p,w),I&&Xye(p,I),f6(p.inputs,v.inputs),f6(p.declaredInputs,v.declaredInputs),f6(p.outputs,v.outputs),Rd(v)&&v.data.animation){const A=p.data;A.animation=(A.animation||[]).concat(v.data.animation)}}const y=v.features;if(y)for(let _=0;_<y.length;_++){const b=y[_];b&&b.ngInherit&&b(p),b===Hr&&(o=!1)}}n=Object.getPrototypeOf(n)}!function zye(p){let n=0,o=null;for(let h=p.length-1;h>=0;h--){const v=p[h];v.hostVars=n+=v.hostVars,v.hostAttrs=V3(v.hostAttrs,o=V3(o,v.hostAttrs))}}(h)}function qR(p){return p===Y0?{}:p===to?[]:p}function Yye(p,n){const o=p.viewQuery;p.viewQuery=o?(h,v)=>{n(h,v),o(h,v)}:n}function Xye(p,n){const o=p.contentQueries;p.contentQueries=o?(h,v,y)=>{n(h,v,y),o(h,v,y)}:n}function $ye(p,n){const o=p.hostBindings;p.hostBindings=o?(h,v)=>{n(h,v),o(h,v)}:n}let uT=null;function gy(){if(!uT){const p=$r.Symbol;if(p&&p.iterator)uT=p.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let o=0;o<n.length;++o){const h=n[o];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(uT=h)}}}return uT}function ab(p){return!!function KR(p){return null!==p&&("function"==typeof p||"object"==typeof p)}(p)&&(Array.isArray(p)||!(p instanceof Map)&&gy()in p)}function al(p,n,o){return!Object.is(p[n],o)&&(p[n]=o,!0)}function Ph(p,n,o,h){const v=jt();return al(v,Q0(),n)&&(wr(),Dh(Yo(),v,p,n,o,h)),Ph}function ll(p,n,o,h,v,y,_,b){const w=jt(),I=wr(),A=p+20,M=I.firstCreatePass?function t_e(p,n,o,h,v,y,_,b,w){const I=n.consts,A=uy(n,p,4,_||null,ug(I,b));LR(n,o,A,ug(I,w)),N3(n,A);const M=A.tViews=aT(2,A,h,v,y,n.directiveRegistry,n.pipeRegistry,null,n.schemas,I);return null!==n.queries&&(n.queries.template(n,A),M.queries=n.queries.embeddedTView(A)),A}(A,I,w,n,o,h,v,y,_):I.data[A];Sh(M,!1);const F=w[11].createComment("");Q3(I,w,F,M),sl(F,w),lT(w,w[A]=hH(F,w,F,M)),k3(M)&&OR(I,w,M),null!=_&&FR(w,M,b)}function Jt(p,n=si.Default){const o=jt();return null===o?ri(p,n):LV(ra(),o,Fi(p),n)}function tk(){throw new Error("invalid")}function Pr(p,n,o){const h=jt();return al(h,Q0(),n)&&function Oc(p,n,o,h,v,y,_,b){const w=Pc(n,o);let A,I=n.inputs;!b&&null!=I&&(A=I[h])?(yH(p,o,A,h,v),R3(n)&&function sye(p,n){const o=Rc(n,p);16&o[2]||(o[2]|=64)}(o,n.index)):3&n.type&&(h=function oye(p){return"class"===p?"className":"for"===p?"htmlFor":"formaction"===p?"formAction":"innerHtml"===p?"innerHTML":"readonly"===p?"readOnly":"tabindex"===p?"tabIndex":p}(h),v=null!=_?_(v,n.value||"",h):v,cs(y)?y.setProperty(w,h,v):U6(h)||(w.setProperty?w.setProperty(h,v):w[h]=v))}(wr(),Yo(),h,p,n,h[11],o,!1),Pr}function nk(p,n,o,h,v){const _=v?"class":"style";yH(p,o,n.inputs[_],_,h)}function Qt(p,n,o,h){const v=jt(),y=wr(),_=20+p,b=v[11],w=v[_]=oR(b,n,function kme(){return pi.lFrame.currentNamespace}()),I=y.firstCreatePass?function w_e(p,n,o,h,v,y,_){const b=n.consts,I=uy(n,p,2,v,ug(b,y));return LR(n,o,I,ug(b,_)),null!==I.attrs&&cT(I,I.attrs,!1),null!==I.mergedAttrs&&cT(I,I.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,I),I}(_,y,v,0,n,o,h):y.data[_];Sh(I,!0);const A=I.mergedAttrs;null!==A&&U3(b,w,A);const M=I.classes;null!==M&&hR(b,w,M);const F=I.styles;return null!==F&&xj(b,w,F),64!=(64&I.flags)&&Q3(y,v,w,I),0===function gme(){return pi.lFrame.elementDepthCount}()&&sl(w,v),function mme(){pi.lFrame.elementDepthCount++}(),k3(I)&&(OR(y,v,I),function eH(p,n,o){if(w6(n)){const v=n.directiveEnd;for(let y=n.directiveStart;y<v;y++){const _=p.data[y];_.contentQueries&&_.contentQueries(1,o[y],y)}}}(y,I,v)),null!==h&&FR(v,I),Qt}function Yt(){let p=ra();M6()?function O6(){pi.lFrame.isParent=!1}():(p=p.parent,Sh(p,!1));const n=p;!function vme(){pi.lFrame.elementDepthCount--}();const o=wr();return o.firstCreatePass&&(N3(o,p),w6(p)&&o.queries.elementEnd(p)),null!=n.classesWithoutHost&&function Nme(p){return 0!=(16&p.flags)}(n)&&nk(o,n,jt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Bme(p){return 0!=(32&p.flags)}(n)&&nk(o,n,jt(),n.stylesWithoutHost,!1),Yt}function hr(p,n,o,h){return Qt(p,n,o,h),Yt(),hr}function cb(p){return!!p&&"function"==typeof p.then}const ok=function iG(p){return!!p&&"function"==typeof p.subscribe};function oi(p,n,o,h){const v=jt(),y=wr(),_=ra();return function oG(p,n,o,h,v,y,_,b){const w=k3(h),A=p.firstCreatePass&&gH(p),M=n[8],F=pH(n);let V=!0;if(3&h.type||b){const J=Pc(h,n),Z=b?b(J):J,re=F.length,se=b?ce=>b(Ns(ce[h.index])):h.index;if(cs(o)){let ce=null;if(!b&&w&&(ce=function I_e(p,n,o,h){const v=p.cleanup;if(null!=v)for(let y=0;y<v.length-1;y+=2){const _=v[y];if(_===o&&v[y+1]===h){const b=n[7],w=v[y+2];return b.length>w?b[w]:null}"string"==typeof _&&(y+=2)}return null}(p,n,v,h.index)),null!==ce)(ce.__ngLastListenerFn__||ce).__ngNextListenerFn__=y,ce.__ngLastListenerFn__=y,V=!1;else{y=sk(h,n,M,y,!1);const pe=o.listen(Z,v,y);F.push(y,pe),A&&A.push(v,se,re,re+1)}}else y=sk(h,n,M,y,!0),Z.addEventListener(v,y,_),F.push(y),A&&A.push(v,se,re,_)}else y=sk(h,n,M,y,!1);const B=h.outputs;let Q;if(V&&null!==B&&(Q=B[v])){const J=Q.length;if(J)for(let Z=0;Z<J;Z+=2){const Ce=n[Q[Z]][Q[Z+1]].subscribe(y),Ve=F.length;F.push(y,Ce),A&&A.push(v,h.index,Ve,-(Ve+1))}}}(y,v,v[11],_,p,n,!!o,h),oi}function sG(p,n,o,h){try{return!1!==o(h)}catch(v){return vH(p,v),!1}}function sk(p,n,o,h,v){return function y(_){if(_===Function)return h;const b=2&p.flags?Rc(p.index,n):n;0==(32&n[2])&&WR(b);let w=sG(n,0,h,_),I=y.__ngNextListenerFn__;for(;I;)w=sG(n,0,I,_)&&w,I=I.__ngNextListenerFn__;return v&&!1===w&&(_.preventDefault(),_.returnValue=!1),w}}function Ru(p=1){return function Ime(p){return(pi.lFrame.contextLView=function Eme(p,n){for(;p>0;)n=n[15],p--;return n}(p,pi.lFrame.contextLView))[8]}(p)}function mG(p,n,o,h,v){const y=p[o+1],_=null===n;let b=h?Md(y):Vf(y),w=!1;for(;0!==b&&(!1===w||_);){const A=p[b+1];k_e(p[b],n)&&(w=!0,p[b+1]=h?SR(A):xR(A)),b=h?Md(A):Vf(A)}w&&(p[o+1]=h?xR(y):SR(y))}function k_e(p,n){return null===p||null==n||(Array.isArray(p)?p[1]:p)===n||!(!Array.isArray(p)||"string"!=typeof n)&&sy(p,n)>=0}function fT(p,n){return function Fd(p,n,o,h){const v=jt(),y=wr(),_=function Uf(p){const n=pi.lFrame,o=n.bindingIndex;return n.bindingIndex=n.bindingIndex+p,o}(2);y.firstUpdatePass&&function TG(p,n,o,h){const v=p.data;if(null===v[o+1]){const y=v[Rl()],_=function SG(p,n){return n>=p.expandoStartIndex}(p,o);(function AG(p,n){return 0!=(p.flags&(n?16:32))})(y,h)&&null===n&&!_&&(n=!1),n=function V_e(p,n,o,h){const v=function L6(p){const n=pi.lFrame.currentDirectiveIndex;return-1===n?null:p[n]}(p);let y=h?n.residualClasses:n.residualStyles;if(null===v)0===(h?n.classBindings:n.styleBindings)&&(o=ub(o=lk(null,p,n,o,h),n.attrs,h),y=null);else{const _=n.directiveStylingLast;if(-1===_||p[_]!==v)if(o=lk(v,p,n,o,h),null===y){let w=function j_e(p,n,o){const h=o?n.classBindings:n.styleBindings;if(0!==Vf(h))return p[Md(h)]}(p,n,h);void 0!==w&&Array.isArray(w)&&(w=lk(null,p,n,w[1],h),w=ub(w,n.attrs,h),function H_e(p,n,o,h){p[Md(o?n.classBindings:n.styleBindings)]=h}(p,n,h,w))}else y=function G_e(p,n,o){let h;const v=n.directiveEnd;for(let y=1+n.directiveStylingLast;y<v;y++)h=ub(h,p[y].hostAttrs,o);return ub(h,n.attrs,o)}(p,n,h)}return void 0!==y&&(h?n.residualClasses=y:n.residualStyles=y),o}(v,y,n,h),function P_e(p,n,o,h,v,y){let _=y?n.classBindings:n.styleBindings,b=Md(_),w=Vf(_);p[h]=o;let A,I=!1;if(Array.isArray(o)){const M=o;A=M[1],(null===A||sy(M,A)>0)&&(I=!0)}else A=o;if(v)if(0!==w){const F=Md(p[b+1]);p[h+1]=rT(F,b),0!==F&&(p[F+1]=wR(p[F+1],h)),p[b+1]=function j0e(p,n){return 131071&p|n<<17}(p[b+1],h)}else p[h+1]=rT(b,0),0!==b&&(p[b+1]=wR(p[b+1],h)),b=h;else p[h+1]=rT(w,0),0===b?b=h:p[w+1]=wR(p[w+1],h),w=h;I&&(p[h+1]=xR(p[h+1])),mG(p,A,h,!0),mG(p,A,h,!1),function R_e(p,n,o,h,v){const y=v?p.residualClasses:p.residualStyles;null!=y&&"string"==typeof n&&sy(y,n)>=0&&(o[h+1]=SR(o[h+1]))}(n,A,p,h,y),_=rT(b,w),y?n.classBindings=_:n.styleBindings=_}(v,y,n,o,_,h)}}(y,p,_,h),n!==gi&&al(v,_,n)&&function EG(p,n,o,h,v,y,_,b){if(!(3&n.type))return;const w=p.data,I=w[b+1];pT(function Gj(p){return 1==(1&p)}(I)?DG(w,n,o,v,Vf(I),_):void 0)||(pT(y)||function Hj(p){return 2==(2&p)}(I)&&(y=DG(w,null,o,v,b,_)),function Hve(p,n,o,h,v){const y=cs(p);if(n)v?y?p.addClass(o,h):o.classList.add(h):y?p.removeClass(o,h):o.classList.remove(h);else{let _=-1===h.indexOf("-")?void 0:Mc.DashCase;if(null==v)y?p.removeStyle(o,h,_):o.style.removeProperty(h);else{const b="string"==typeof v&&v.endsWith("!important");b&&(v=v.slice(0,-10),_|=Mc.Important),y?p.setStyle(o,h,v,_):o.style.setProperty(h,v,b?"important":"")}}}(h,_,M3(Rl(),o),v,y))}(y,y.data[Rl()],v,v[11],p,v[_+1]=function X_e(p,n){return null==p||("string"==typeof n?p+=n:"object"==typeof p&&(p=Vr(pg(p)))),p}(n,o),h,_)}(p,n,null,!0),fT}function lk(p,n,o,h,v){let y=null;const _=o.directiveEnd;let b=o.directiveStylingLast;for(-1===b?b=o.directiveStart:b++;b<_&&(y=n[b],h=ub(h,y.hostAttrs,v),y!==p);)b++;return null!==p&&(o.directiveStylingLast=b),h}function ub(p,n,o){const h=o?1:2;let v=-1;if(null!==n)for(let y=0;y<n.length;y++){const _=n[y];"number"==typeof _?v=_:v===h&&(Array.isArray(p)||(p=void 0===p?[]:["",p]),kc(p,_,!!o||n[++y]))}return void 0===p?null:p}function DG(p,n,o,h,v,y){const _=null===n;let b;for(;v>0;){const w=p[v],I=Array.isArray(w),A=I?w[1]:w,M=null===A;let F=o[v+1];F===gi&&(F=M?to:void 0);let V=M?X6(F,h):A===h?F:void 0;if(I&&!pT(V)&&(V=X6(w,h)),pT(V)&&(b=V,_))return b;const B=p[v+1];v=_?Md(B):Vf(B)}if(null!==n){let w=y?n.residualClasses:n.residualStyles;null!=w&&(b=X6(w,h))}return b}function pT(p){return void 0!==p}function Bn(p,n=""){const o=jt(),h=wr(),v=p+20,y=h.firstCreatePass?uy(h,v,1,n,null):h.data[v],_=o[v]=function rR(p,n){return cs(p)?p.createText(n):p.createTextNode(n)}(o[11],n);Q3(h,o,_,y),Sh(y,!1)}function Fc(p,n,o){const h=jt(),v=function vy(p,n,o,h){return al(p,Q0(),o)?n+fi(o)+h:gi}(h,p,n,o);return v!==gi&&jf(h,Rl(),v),Fc}const gT="en-US";let QG=gT;function dk(p,n,o,h,v){if(p=Fi(p),Array.isArray(p))for(let y=0;y<p.length;y++)dk(p[y],n,o,h,v);else{const y=wr(),_=jt();let b=py(p)?p:Fi(p.provide),w=wH(p);const I=ra(),A=1048575&I.providerIndexes,M=I.directiveStart,F=I.providerIndexes>>20;if(py(p)||!p.multi){const V=new BC(w,v,Jt),B=fk(b,n,v?A:A+F,M);-1===B?(G3(UC(I,_),y,b),hk(y,p,n.length),n.push(b),I.directiveStart++,I.directiveEnd++,v&&(I.providerIndexes+=1048576),o.push(V),_.push(V)):(o[B]=V,_[B]=V)}else{const V=fk(b,n,A+F,M),B=fk(b,n,A,A+F),Q=V>=0&&o[V],J=B>=0&&o[B];if(v&&!J||!v&&!Q){G3(UC(I,_),y,b);const Z=function hCe(p,n,o,h,v){const y=new BC(p,o,Jt);return y.multi=[],y.index=n,y.componentProviders=0,xz(y,v,h&&!o),y}(v?dCe:uCe,o.length,v,h,w);!v&&J&&(o[B].providerFactory=Z),hk(y,p,n.length,0),n.push(b),I.directiveStart++,I.directiveEnd++,v&&(I.providerIndexes+=1048576),o.push(Z),_.push(Z)}else hk(y,p,V>-1?V:B,xz(o[v?B:V],w,!v&&h));!v&&h&&J&&o[B].componentProviders++}}}function hk(p,n,o,h){const v=py(n),y=function Mye(p){return!!p.useClass}(n);if(v||y){const w=(y?Fi(n.useClass):n).prototype.ngOnDestroy;if(w){const I=p.destroyHooks||(p.destroyHooks=[]);if(!v&&n.multi){const A=I.indexOf(o);-1===A?I.push(o,[h,w]):I[A+1].push(h,w)}else I.push(o,w)}}}function xz(p,n,o){return o&&p.componentProviders++,p.multi.push(n)-1}function fk(p,n,o,h){for(let v=o;v<h;v++)if(n[v]===p)return v;return-1}function uCe(p,n,o,h){return pk(this.multi,[])}function dCe(p,n,o,h){const v=this.multi;let y;if(this.providerFactory){const _=this.providerFactory.componentProviders,b=VC(o,o[1],this.providerFactory.index,h);y=b.slice(0,_),pk(v,y);for(let w=_;w<b.length;w++)y.push(b[w])}else y=[],pk(v,y);return y}function pk(p,n){for(let o=0;o<p.length;o++)n.push((0,p[o])());return n}function ko(p,n=[]){return o=>{o.providersResolver=(h,v)=>function cCe(p,n,o){const h=wr();if(h.firstCreatePass){const v=Rd(p);dk(o,h.data,h.blueprint,v,!0),dk(n,h.data,h.blueprint,v,!1)}}(h,v?v(p):p,n)}}class wz{}class gCe{resolveComponentFactory(n){throw function pCe(p){const n=Error(`No component factory found for ${Vr(p)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=p,n}(n)}}let gb=(()=>{class p{}return p.NULL=new gCe,p})();function mCe(){return Ay(ra(),jt())}function Ay(p,n){return new Lc(Pc(p,n))}let Lc=(()=>{class p{constructor(o){this.nativeElement=o}}return p.__NG_ELEMENT_ID__=mCe,p})();class Tz{}let Hf=(()=>{class p{}return p.__NG_ELEMENT_ID__=()=>function _Ce(){const p=jt(),o=Rc(ra().index,p);return function yCe(p){return p[11]}(wh(o)?o:p)}(),p})(),CCe=(()=>{class p{}return p.\u0275prov=dr({token:p,providedIn:"root",factory:()=>null}),p})();class mb{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const bCe=new mb("13.3.12"),gk={};function CT(p,n,o,h,v=!1){for(;null!==o;){const y=n[o.index];if(null!==y&&h.push(Ns(y)),Pd(y))for(let b=10;b<y.length;b++){const w=y[b],I=w[1].firstChild;null!==I&&CT(w[1],w,I,h)}const _=o.type;if(8&_)CT(p,n,o.child,h);else if(32&_){const b=tR(o,n);let w;for(;w=b();)h.push(w)}else if(16&_){const b=Cj(n,o);if(Array.isArray(b))h.push(...b);else{const w=QC(n[16]);CT(w[1],w,b,h,!0)}}o=v?o.projectionNext:o.next}return h}class vb{constructor(n,o){this._lView=n,this._cdRefInjectingView=o,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,o=n[1];return CT(o,n,o.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(Pd(n)){const o=n[8],h=o?o.indexOf(this):-1;h>-1&&(sR(n,h),Y3(o,h))}this._attachedToViewContainer=!1}dj(this._lView[1],this._lView)}onDestroy(n){!function rH(p,n,o,h){const v=pH(n);null===o?v.push(h):(v.push(o),p.firstCreatePass&&gH(p).push(h,v.length-1))}(this._lView[1],this._lView,null,n)}markForCheck(){WR(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function VR(p,n,o){const h=n[10];h.begin&&h.begin();try{hy(p,n,p.template,o)}catch(v){throw vH(n,v),v}finally{h.end&&h.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new yr(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Mve(p,n){ZC(p,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new yr(902,"");this._appRef=n}}class xCe extends vb{constructor(n){super(n),this._view=n}detectChanges(){fH(this._view)}checkNoChanges(){}get context(){return null}}class Iz extends gb{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const o=Oa(n);return new mk(o,this.ngModule)}}function Ez(p){const n=[];for(let o in p)p.hasOwnProperty(o)&&n.push({propName:p[o],templateName:o});return n}class mk extends wz{constructor(n,o){super(),this.componentDef=n,this.ngModule=o,this.componentType=n.type,this.selector=function U0e(p){return p.map(W0e).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!o}get inputs(){return Ez(this.componentDef.inputs)}get outputs(){return Ez(this.componentDef.outputs)}create(n,o,h,v){const y=(v=v||this.ngModule)?function SCe(p,n){return{get:(o,h,v)=>{const y=p.get(o,gk,v);return y!==gk||h===gk?y:n.get(o,h,v)}}}(n,v.injector):n,_=y.get(Tz,pV),b=y.get(CCe,null),w=_.createRenderer(null,this.componentDef),I=this.componentDef.selectors[0][0]||"div",A=h?function iH(p,n,o){if(cs(p))return p.selectRootElement(n,o===bh.ShadowDom);let h="string"==typeof n?p.querySelector(n):n;return h.textContent="",h}(w,h,this.componentDef.encapsulation):oR(_.createRenderer(null,this.componentDef),I,function wCe(p){const n=p.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(I)),M=this.componentDef.onPush?576:528,F=function FH(p,n){return{components:[],scheduler:p||E0e,clean:Sye,playerHandler:n||null,flags:0}}(),V=aT(0,null,null,1,0,null,null,null,null,null),B=rb(null,V,F,M,null,null,_,w,b,y);let Q,J;F3(B);try{const Z=function MH(p,n,o,h,v,y){const _=o[1];o[20]=p;const w=uy(_,20,2,"#host",null),I=w.mergedAttrs=n.hostAttrs;null!==I&&(cT(w,I,!0),null!==p&&(U3(v,p,I),null!==w.classes&&hR(v,p,w.classes),null!==w.styles&&xj(v,p,w.styles)));const A=h.createRenderer(p,n),M=rb(o,tH(n),null,n.onPush?64:16,o[20],w,h,A,y||null,null);return _.firstCreatePass&&(G3(UC(w,o),_,n.type),cH(_,w),uH(w,o.length,1)),lT(o,M),o[20]=M}(A,this.componentDef,B,_,w);if(A)if(h)U3(w,A,["ng-version",bCe.full]);else{const{attrs:re,classes:se}=function V0e(p){const n=[],o=[];let h=1,v=2;for(;h<p.length;){let y=p[h];if("string"==typeof y)2===v?""!==y&&n.push(y,p[++h]):8===v&&o.push(y);else{if(!kd(v))break;v=y}h++}return{attrs:n,classes:o}}(this.componentDef.selectors[0]);re&&U3(w,A,re),se&&se.length>0&&hR(w,A,se.join(" "))}if(J=P6(V,20),void 0!==o){const re=J.projection=[];for(let se=0;se<this.ngContentSelectors.length;se++){const ce=o[se];re.push(null!=ce?Array.from(ce):null)}}Q=function OH(p,n,o,h,v){const y=o[1],_=function lye(p,n,o){const h=ra();p.firstCreatePass&&(o.providersResolver&&o.providersResolver(o),dH(p,h,n,dy(p,n,1,null),o));const v=VC(n,p,h.directiveStart,h);sl(v,n);const y=Pc(h,n);return y&&sl(y,n),v}(y,o,n);if(h.components.push(_),p[8]=_,v&&v.forEach(w=>w(_,n)),n.contentQueries){const w=ra();n.contentQueries(1,_,w.directiveStart)}const b=ra();return!y.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(dg(b.index),aH(o[1],b,0,b.directiveStart,b.directiveEnd,n),lH(n,_)),_}(Z,this.componentDef,B,F,[Gye]),ob(V,B,null)}finally{L3()}return new ICe(this.componentType,Q,Ay(J,B),B,J)}}class ICe extends class fCe{}{constructor(n,o,h,v,y){super(),this.location=h,this._rootLView=v,this._tNode=y,this.instance=o,this.hostView=this.changeDetectorRef=new xCe(v),this.componentType=n}get injector(){return new ty(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}class Gf{}class Dz{}const Py=new Map;class Rz extends Gf{constructor(n,o){super(),this._parent=o,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Iz(this);const h=Tu(n);this._bootstrapComponents=Eh(h.bootstrap),this._r3Injector=xH(n,o,[{provide:Gf,useValue:this},{provide:gb,useValue:this.componentFactoryResolver}],Vr(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,o=oc.THROW_IF_NOT_FOUND,h=si.Default){return n===oc||n===Gf||n===HR?this:this._r3Injector.get(n,o,h)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class vk extends Dz{constructor(n){super(),this.moduleType=n,null!==Tu(n)&&function DCe(p){const n=new Set;!function o(h){const v=Tu(h,!0),y=v.id;null!==y&&(function Az(p,n,o){if(n&&n!==o)throw new Error(`Duplicate module registered for ${p} - ${Vr(n)} vs ${Vr(n.name)}`)}(y,Py.get(y),h),Py.set(y,h));const _=Eh(v.imports);for(const b of _)n.has(b)||(n.add(b),o(b))}(p)}(n)}create(n){return new Rz(this.moduleType,n)}}function Nd(p,n,o){const h=function Pl(){const p=pi.lFrame;let n=p.bindingRootIndex;return-1===n&&(n=p.bindingRootIndex=p.tView.bindingStartIndex),n}()+p,v=jt();return v[h]===gi?function Ah(p,n,o){return p[n]=o}(v,h,o?n.call(o):n()):function lb(p,n){return p[n]}(v,h)}function yk(p){return n=>{setTimeout(p,void 0,n)}}const ds=class zCe extends Of{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,o,h){var v,y,_;let b=n,w=o||(()=>null),I=h;if(n&&"object"==typeof n){const M=n;b=null===(v=M.next)||void 0===v?void 0:v.bind(M),w=null===(y=M.error)||void 0===y?void 0:y.bind(M),I=null===(_=M.complete)||void 0===_?void 0:_.bind(M)}this.__isAsync&&(w=yk(w),b&&(b=yk(b)),I&&(I=yk(I)));const A=super.subscribe({next:b,error:w,complete:I});return n instanceof Su&&n.add(A),A}};Symbol;let zf=(()=>{class p{}return p.__NG_ELEMENT_ID__=qCe,p})();const XCe=zf,$Ce=class extends XCe{constructor(n,o,h){super(),this._declarationLView=n,this._declarationTContainer=o,this.elementRef=h}createEmbeddedView(n){const o=this._declarationTContainer.tViews,h=rb(this._declarationLView,o,n,16,null,o.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const y=this._declarationLView[19];return null!==y&&(h[19]=y.createEmbeddedView(o)),ob(o,h,n),new vb(h)}};function qCe(){return function bT(p,n){return 4&p.type?new $Ce(n,p,Ay(p,n)):null}(ra(),jt())}let Bd=(()=>{class p{}return p.__NG_ELEMENT_ID__=KCe,p})();function KCe(){return function Wz(p,n){let o;const h=n[p.index];if(Pd(h))o=h;else{let v;if(8&p.type)v=Ns(h);else{const y=n[11];v=y.createComment("");const _=Pc(p,n);Qm(y,J3(y,_),v,function Uve(p,n){return cs(p)?p.nextSibling(n):n.nextSibling}(y,_),!1)}n[p.index]=o=hH(h,n,v,p),lT(n,o)}return new Nz(o,p,n)}(ra(),jt())}const JCe=Bd,Nz=class extends JCe{constructor(n,o,h){super(),this._lContainer=n,this._hostTNode=o,this._hostLView=h}get element(){return Ay(this._hostTNode,this._hostLView)}get injector(){return new ty(this._hostTNode,this._hostLView)}get parentInjector(){const n=H3(this._hostTNode,this._hostLView);if(RV(n)){const o=ey(n,this._hostLView),h=Z0(n);return new ty(o[1].data[h+8],o)}return new ty(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const o=Bz(this._lContainer);return null!==o&&o[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,o,h){const v=n.createEmbeddedView(o||{});return this.insert(v,h),v}createComponent(n,o,h,v,y){const _=n&&!function GC(p){return"function"==typeof p}(n);let b;if(_)b=o;else{const M=o||{};b=M.index,h=M.injector,v=M.projectableNodes,y=M.ngModuleRef}const w=_?n:new mk(Oa(n)),I=h||this.parentInjector;if(!y&&null==w.ngModule){const F=(_?I:this.parentInjector).get(Gf,null);F&&(y=F)}const A=w.create(I,v,void 0,y);return this.insert(A.hostView,b),A}insert(n,o){const h=n._lView,v=h[1];if(function pme(p){return Pd(p[3])}(h)){const A=this.indexOf(n);if(-1!==A)this.detach(A);else{const M=h[3],F=new Nz(M,M[6],M[3]);F.detach(F.indexOf(n))}}const y=this._adjustIndex(o),_=this._lContainer;!function Fve(p,n,o,h){const v=10+h,y=o.length;h>0&&(o[v-1][4]=n),h<y-10?(n[4]=o[v],VV(o,10+h,n)):(o.push(n),n[4]=null),n[3]=o;const _=n[17];null!==_&&o!==_&&function Lve(p,n){const o=p[9];n[16]!==n[3][3][16]&&(p[2]=!0),null===o?p[9]=[n]:o.push(n)}(_,n);const b=n[19];null!==b&&b.insertView(p),n[2]|=128}(v,h,_,y);const b=cR(y,_),w=h[11],I=J3(w,_[7]);return null!==I&&function kve(p,n,o,h,v,y){h[0]=v,h[6]=n,ZC(p,h,o,1,v,y)}(v,_[6],w,h,I,b),n.attachToViewContainerRef(),VV(Ck(_),y,n),n}move(n,o){return this.insert(n,o)}indexOf(n){const o=Bz(this._lContainer);return null!==o?o.indexOf(n):-1}remove(n){const o=this._adjustIndex(n,-1),h=sR(this._lContainer,o);h&&(Y3(Ck(this._lContainer),o),dj(h[1],h))}detach(n){const o=this._adjustIndex(n,-1),h=sR(this._lContainer,o);return h&&null!=Y3(Ck(this._lContainer),o)?new vb(h):null}_adjustIndex(n,o=0){return null==n?this.length+o:n}};function Bz(p){return p[8]}function Ck(p){return p[8]||(p[8]=[])}function ST(...p){}const Ok=new Yi("Application Initializer");let Fk=(()=>{class p{constructor(o){this.appInits=o,this.resolve=ST,this.reject=ST,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,v)=>{this.resolve=h,this.reject=v})}runInitializers(){if(this.initialized)return;const o=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const y=this.appInits[v]();if(cb(y))o.push(y);else if(ok(y)){const _=new Promise((b,w)=>{y.subscribe({complete:b,error:w})});o.push(_)}}Promise.all(o).then(()=>{h()}).catch(v=>{this.reject(v)}),0===o.length&&h(),this.initialized=!0}}return p.\u0275fac=function(o){return new(o||p)(ri(Ok,8))},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const bb=new Yi("AppId",{providedIn:"root",factory:function aY(){return`${Lk()}${Lk()}${Lk()}`}});function Lk(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const lY=new Yi("Platform Initializer"),cY=new Yi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),uY=new Yi("appBootstrapListener");let Sbe=(()=>{class p{log(o){console.log(o)}warn(o){console.warn(o)}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();const vg=new Yi("LocaleId",{providedIn:"root",factory:()=>ave(vg,si.Optional|si.SkipSelf)||function Tbe(){return"undefined"!=typeof $localize&&$localize.locale||gT}()});class Ebe{constructor(n,o){this.ngModuleFactory=n,this.componentFactories=o}}let dY=(()=>{class p{compileModuleSync(o){return new vk(o)}compileModuleAsync(o){return Promise.resolve(this.compileModuleSync(o))}compileModuleAndAllComponentsSync(o){const h=this.compileModuleSync(o),y=Eh(Tu(o).declarations).reduce((_,b)=>{const w=Oa(b);return w&&_.push(new mk(w)),_},[]);return new Ebe(h,y)}compileModuleAndAllComponentsAsync(o){return Promise.resolve(this.compileModuleAndAllComponentsSync(o))}clearCache(){}clearCacheFor(o){}getModuleId(o){}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const Abe=(()=>Promise.resolve(0))();function Nk(p){"undefined"==typeof Zone?Abe.then(()=>{p&&p.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",p)}class Fa{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ds(!1),this.onMicrotaskEmpty=new ds(!1),this.onStable=new ds(!1),this.onError=new ds(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!h&&o,v.shouldCoalesceRunChangeDetection=h,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Pbe(){let p=$r.requestAnimationFrame,n=$r.cancelAnimationFrame;if("undefined"!=typeof Zone&&p&&n){const o=p[Zone.__symbol__("OriginalDelegate")];o&&(p=o);const h=n[Zone.__symbol__("OriginalDelegate")];h&&(n=h)}return{nativeRequestAnimationFrame:p,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function Mbe(p){const n=()=>{!function kbe(p){p.isCheckStableRunning||-1!==p.lastRequestAnimationFrameId||(p.lastRequestAnimationFrameId=p.nativeRequestAnimationFrame.call($r,()=>{p.fakeTopEventTask||(p.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{p.lastRequestAnimationFrameId=-1,Wk(p),p.isCheckStableRunning=!0,Bk(p),p.isCheckStableRunning=!1},void 0,()=>{},()=>{})),p.fakeTopEventTask.invoke()}),Wk(p))}(p)};p._inner=p._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,h,v,y,_,b)=>{try{return hY(p),o.invokeTask(v,y,_,b)}finally{(p.shouldCoalesceEventChangeDetection&&"eventTask"===y.type||p.shouldCoalesceRunChangeDetection)&&n(),fY(p)}},onInvoke:(o,h,v,y,_,b,w)=>{try{return hY(p),o.invoke(v,y,_,b,w)}finally{p.shouldCoalesceRunChangeDetection&&n(),fY(p)}},onHasTask:(o,h,v,y)=>{o.hasTask(v,y),h===v&&("microTask"==y.change?(p._hasPendingMicrotasks=y.microTask,Wk(p),Bk(p)):"macroTask"==y.change&&(p.hasPendingMacrotasks=y.macroTask))},onHandleError:(o,h,v,y)=>(o.handleError(v,y),p.runOutsideAngular(()=>p.onError.emit(y)),!1)})}(v)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Fa.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Fa.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,o,h){return this._inner.run(n,o,h)}runTask(n,o,h,v){const y=this._inner,_=y.scheduleEventTask("NgZoneEvent: "+v,n,Rbe,ST,ST);try{return y.runTask(_,o,h)}finally{y.cancelTask(_)}}runGuarded(n,o,h){return this._inner.runGuarded(n,o,h)}runOutsideAngular(n){return this._outer.run(n)}}const Rbe={};function Bk(p){if(0==p._nesting&&!p.hasPendingMicrotasks&&!p.isStable)try{p._nesting++,p.onMicrotaskEmpty.emit(null)}finally{if(p._nesting--,!p.hasPendingMicrotasks)try{p.runOutsideAngular(()=>p.onStable.emit(null))}finally{p.isStable=!0}}}function Wk(p){p.hasPendingMicrotasks=!!(p._hasPendingMicrotasks||(p.shouldCoalesceEventChangeDetection||p.shouldCoalesceRunChangeDetection)&&-1!==p.lastRequestAnimationFrameId)}function hY(p){p._nesting++,p.isStable&&(p.isStable=!1,p.onUnstable.emit(null))}function fY(p){p._nesting--,Bk(p)}class Obe{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ds,this.onMicrotaskEmpty=new ds,this.onStable=new ds,this.onError=new ds}run(n,o,h){return n.apply(o,h)}runGuarded(n,o,h){return n.apply(o,h)}runOutsideAngular(n){return n()}runTask(n,o,h,v){return n.apply(o,h)}}let Uk=(()=>{class p{constructor(o){this._ngZone=o,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),o.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Fa.assertNotInAngularZone(),Nk(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Nk(()=>{for(;0!==this._callbacks.length;){let o=this._callbacks.pop();clearTimeout(o.timeoutId),o.doneCb(this._didWork)}this._didWork=!1});else{let o=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(o)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(o=>({source:o.source,creationLocation:o.creationLocation,data:o.data})):[]}addCallback(o,h,v){let y=-1;h&&h>0&&(y=setTimeout(()=>{this._callbacks=this._callbacks.filter(_=>_.timeoutId!==y),o(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:o,timeoutId:y,updateCb:v})}whenStable(o,h,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(o,h,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(o,h,v){return[]}}return p.\u0275fac=function(o){return new(o||p)(ri(Fa))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})(),Fbe=(()=>{class p{constructor(){this._applications=new Map,Vk.addToWindow(this)}registerApplication(o,h){this._applications.set(o,h)}unregisterApplication(o){this._applications.delete(o)}unregisterAllApplications(){this._applications.clear()}getTestability(o){return this._applications.get(o)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(o,h=!0){return Vk.findTestabilityInTree(this,o,h)}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();class Lbe{addToWindow(n){}findTestabilityInTree(n,o,h){return null}}let Vk=new Lbe,nv=null;const pY=new Yi("AllowMultipleToken"),gY=new Yi("PlatformOnDestroy");class mY{constructor(n,o){this.name=n,this.token=o}}function vY(p,n,o=[]){const h=`Platform: ${n}`,v=new Yi(h);return(y=[])=>{let _=jk();if(!_||_.injector.get(pY,!1)){const b=[...o,...y,{provide:v,useValue:!0}];p?p(b):function Ube(p){if(nv&&!nv.get(pY,!1))throw new yr(400,"");nv=p;const n=p.get(yY),o=p.get(lY,null);o&&o.forEach(h=>h())}(function jbe(p=[],n){return oc.create({name:n,providers:[{provide:GR,useValue:"platform"},{provide:gY,useValue:()=>nv=null},...p]})}(b,h))}return function Vbe(p){const n=jk();if(!n)throw new yr(401,"");return n}()}}function jk(){var p;return null!==(p=null==nv?void 0:nv.get(yY))&&void 0!==p?p:null}let yY=(()=>{class p{constructor(o){this._injector=o,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(o,h){const b=function Hbe(p,n){let o;return o="noop"===p?new Obe:("zone.js"===p?void 0:p)||new Fa({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),o}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),w=[{provide:Fa,useValue:b}];return b.run(()=>{const I=oc.create({providers:w,parent:this.injector,name:o.moduleType.name}),A=o.create(I),M=A.injector.get(ib,null);if(!M)throw new yr(402,"");return b.runOutsideAngular(()=>{const F=b.onError.subscribe({next:V=>{M.handleError(V)}});A.onDestroy(()=>{Gk(this._modules,A),F.unsubscribe()})}),function Gbe(p,n,o){try{const h=o();return cb(h)?h.catch(v=>{throw n.runOutsideAngular(()=>p.handleError(v)),v}):h}catch(h){throw n.runOutsideAngular(()=>p.handleError(h)),h}}(M,b,()=>{const F=A.injector.get(Fk);return F.runInitializers(),F.donePromise.then(()=>(function y1e(p){Dc(p,"Expected localeId to be defined"),"string"==typeof p&&(QG=p.toLowerCase().replace(/_/g,"-"))}(A.injector.get(vg,gT)||gT),this._moduleDoBootstrap(A),A))})})}bootstrapModule(o,h=[]){const v=_Y({},h);return function Bbe(p,n,o){const h=new vk(o);return Promise.resolve(h)}(0,0,o).then(y=>this.bootstrapModuleFactory(y,v))}_moduleDoBootstrap(o){const h=o.injector.get(Hk);if(o._bootstrapComponents.length>0)o._bootstrapComponents.forEach(v=>h.bootstrap(v));else{if(!o.instance.ngDoBootstrap)throw new yr(403,"");o.instance.ngDoBootstrap(h)}this._modules.push(o)}onDestroy(o){this._destroyListeners.push(o)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new yr(404,"");this._modules.slice().forEach(h=>h.destroy()),this._destroyListeners.forEach(h=>h());const o=this._injector.get(gY,null);null==o||o(),this._destroyed=!0}get destroyed(){return this._destroyed}}return p.\u0275fac=function(o){return new(o||p)(ri(oc))},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"platform"}),p})();function _Y(p,n){return Array.isArray(n)?n.reduce(_Y,p):Object.assign(Object.assign({},p),n)}let Hk=(()=>{class p{constructor(o,h,v,y){this._zone=o,this._injector=h,this._exceptionHandler=v,this._initStatus=y,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const _=new Ls(w=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{w.next(this._stable),w.complete()})}),b=new Ls(w=>{let I;this._zone.runOutsideAngular(()=>{I=this._zone.onStable.subscribe(()=>{Fa.assertNotInAngularZone(),Nk(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,w.next(!0))})})});const A=this._zone.onUnstable.subscribe(()=>{Fa.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{w.next(!1)}))});return()=>{I.unsubscribe(),A.unsubscribe()}});this.isStable=function Mge(...p){const n=kC(p),o=function Ige(p,n){return"number"==typeof d6(p)?p.pop():n}(p,1/0),h=p;return h.length?1===h.length?Id(h[0]):RC(o)(ka(h,n)):Lf}(_,b.pipe(function Oge(p={}){const{connector:n=(()=>new Of),resetOnError:o=!0,resetOnComplete:h=!0,resetOnRefCountZero:v=!0}=p;return y=>{let _,b,w,I=0,A=!1,M=!1;const F=()=>{null==b||b.unsubscribe(),b=void 0},V=()=>{F(),_=w=void 0,A=M=!1},B=()=>{const Q=_;V(),null==Q||Q.unsubscribe()};return Ra((Q,J)=>{I++,!M&&!A&&F();const Z=w=null!=w?w:n();J.add(()=>{I--,0===I&&!M&&!A&&(b=h6(B,v))}),Z.subscribe(J),!_&&I>0&&(_=new PC({next:re=>Z.next(re),error:re=>{M=!0,F(),b=h6(V,o,re),Z.error(re)},complete:()=>{A=!0,F(),b=h6(V,h),Z.complete()}}),Id(Q).subscribe(_))})(y)}}()))}bootstrap(o,h){if(!this._initStatus.done)throw new yr(405,"");let v;v=o instanceof wz?o:this._injector.get(gb).resolveComponentFactory(o),this.componentTypes.push(v.componentType);const y=function Wbe(p){return p.isBoundToModule}(v)?void 0:this._injector.get(Gf),b=v.create(oc.NULL,[],h||v.selector,y),w=b.location.nativeElement,I=b.injector.get(Uk,null),A=I&&b.injector.get(Fbe);return I&&A&&A.registerApplication(w,I),b.onDestroy(()=>{this.detachView(b.hostView),Gk(this.components,b),A&&A.unregisterApplication(w)}),this._loadComponent(b),b}tick(){if(this._runningTick)throw new yr(101,"");try{this._runningTick=!0;for(let o of this._views)o.detectChanges()}catch(o){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(o))}finally{this._runningTick=!1}}attachView(o){const h=o;this._views.push(h),h.attachToAppRef(this)}detachView(o){const h=o;Gk(this._views,h),h.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o),this._injector.get(uY,[]).concat(this._bootstrapListeners).forEach(v=>v(o))}ngOnDestroy(){this._views.slice().forEach(o=>o.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return p.\u0275fac=function(o){return new(o||p)(ri(Fa),ri(oc),ri(ib),ri(Fk))},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function Gk(p,n){const o=p.indexOf(n);o>-1&&p.splice(o,1)}let bY=!0,TT=(()=>{class p{}return p.__NG_ELEMENT_ID__=Xbe,p})();function Xbe(p){return function $be(p,n,o){if(R3(p)&&!o){const h=Rc(p.index,n);return new vb(h,h)}return 47&p.type?new vb(n[16],n):null}(ra(),jt(),16==(16&p))}class IY{constructor(){}supports(n){return ab(n)}create(n){return new exe(n)}}const Zbe=(p,n)=>n;class exe{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||Zbe}forEachItem(n){let o;for(o=this._itHead;null!==o;o=o._next)n(o)}forEachOperation(n){let o=this._itHead,h=this._removalsHead,v=0,y=null;for(;o||h;){const _=!h||o&&o.currentIndex<DY(h,v,y)?o:h,b=DY(_,v,y),w=_.currentIndex;if(_===h)v--,h=h._nextRemoved;else if(o=o._next,null==_.previousIndex)v++;else{y||(y=[]);const I=b-v,A=w-v;if(I!=A){for(let F=0;F<I;F++){const V=F<y.length?y[F]:y[F]=0,B=V+F;A<=B&&B<I&&(y[F]=V+1)}y[_.previousIndex]=A-I}}b!==w&&n(_,b,w)}}forEachPreviousItem(n){let o;for(o=this._previousItHead;null!==o;o=o._nextPrevious)n(o)}forEachAddedItem(n){let o;for(o=this._additionsHead;null!==o;o=o._nextAdded)n(o)}forEachMovedItem(n){let o;for(o=this._movesHead;null!==o;o=o._nextMoved)n(o)}forEachRemovedItem(n){let o;for(o=this._removalsHead;null!==o;o=o._nextRemoved)n(o)}forEachIdentityChange(n){let o;for(o=this._identityChangesHead;null!==o;o=o._nextIdentityChange)n(o)}diff(n){if(null==n&&(n=[]),!ab(n))throw new yr(900,"");return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let v,y,_,o=this._itHead,h=!1;if(Array.isArray(n)){this.length=n.length;for(let b=0;b<this.length;b++)y=n[b],_=this._trackByFn(b,y),null!==o&&Object.is(o.trackById,_)?(h&&(o=this._verifyReinsertion(o,y,_,b)),Object.is(o.item,y)||this._addIdentityChange(o,y)):(o=this._mismatch(o,y,_,b),h=!0),o=o._next}else v=0,function e_e(p,n){if(Array.isArray(p))for(let o=0;o<p.length;o++)n(p[o]);else{const o=p[gy()]();let h;for(;!(h=o.next()).done;)n(h.value)}}(n,b=>{_=this._trackByFn(v,b),null!==o&&Object.is(o.trackById,_)?(h&&(o=this._verifyReinsertion(o,b,_,v)),Object.is(o.item,b)||this._addIdentityChange(o,b)):(o=this._mismatch(o,b,_,v),h=!0),o=o._next,v++}),this.length=v;return this._truncate(o),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,o,h,v){let y;return null===n?y=this._itTail:(y=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._reinsertAfter(n,y,v)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(h,v))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._moveAfter(n,y,v)):n=this._addAfter(new txe(o,h),y,v),n}_verifyReinsertion(n,o,h,v){let y=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==y?n=this._reinsertAfter(y,n._prev,v):n.currentIndex!=v&&(n.currentIndex=v,this._addToMoves(n,v)),n}_truncate(n){for(;null!==n;){const o=n._next;this._addToRemovals(this._unlink(n)),n=o}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,o,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const v=n._prevRemoved,y=n._nextRemoved;return null===v?this._removalsHead=y:v._nextRemoved=y,null===y?this._removalsTail=v:y._prevRemoved=v,this._insertAfter(n,o,h),this._addToMoves(n,h),n}_moveAfter(n,o,h){return this._unlink(n),this._insertAfter(n,o,h),this._addToMoves(n,h),n}_addAfter(n,o,h){return this._insertAfter(n,o,h),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,o,h){const v=null===o?this._itHead:o._next;return n._next=v,n._prev=o,null===v?this._itTail=n:v._prev=n,null===o?this._itHead=n:o._next=n,null===this._linkedRecords&&(this._linkedRecords=new EY),this._linkedRecords.put(n),n.currentIndex=h,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const o=n._prev,h=n._next;return null===o?this._itHead=h:o._next=h,null===h?this._itTail=o:h._prev=o,n}_addToMoves(n,o){return n.previousIndex===o||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new EY),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,o){return n.item=o,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class txe{constructor(n,o){this.item=n,this.trackById=o,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class nxe{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,o){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===o||o<=h.currentIndex)&&Object.is(h.trackById,n))return h;return null}remove(n){const o=n._prevDup,h=n._nextDup;return null===o?this._head=h:o._nextDup=h,null===h?this._tail=o:h._prevDup=o,null===this._head}}class EY{constructor(){this.map=new Map}put(n){const o=n.trackById;let h=this.map.get(o);h||(h=new nxe,this.map.set(o,h)),h.add(n)}get(n,o){const v=this.map.get(n);return v?v.get(n,o):null}remove(n){const o=n.trackById;return this.map.get(o).remove(n)&&this.map.delete(o),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function DY(p,n,o){const h=p.previousIndex;if(null===h)return h;let v=0;return o&&h<o.length&&(v=o[h]),h+n+v}function PY(){return new DT([new IY])}let DT=(()=>{class p{constructor(o){this.factories=o}static create(o,h){if(null!=h){const v=h.factories.slice();o=o.concat(v)}return new p(o)}static extend(o){return{provide:p,useFactory:h=>p.create(o,h||PY()),deps:[[p,new qC,new fg]]}}find(o){const h=this.factories.find(v=>v.supports(o));if(null!=h)return h;throw new yr(901,"")}}return p.\u0275prov=dr({token:p,providedIn:"root",factory:PY}),p})();const axe=vY(null,"core",[]);let lxe=(()=>{class p{constructor(o){}}return p.\u0275fac=function(o){return new(o||p)(ri(Hk))},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({}),p})(),AT=null;function Mh(){return AT}const ku=new Yi("DocumentToken");let rv=(()=>{class p{historyGo(o){throw new Error("Not implemented")}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:function(){return function hxe(){return ri(kY)}()},providedIn:"platform"}),p})();const fxe=new Yi("Location Initialized");let kY=(()=>{class p extends rv{constructor(o){super(),this._doc=o,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Mh().getBaseHref(this._doc)}onPopState(o){const h=Mh().getGlobalEventTarget(this._doc,"window");return h.addEventListener("popstate",o,!1),()=>h.removeEventListener("popstate",o)}onHashChange(o){const h=Mh().getGlobalEventTarget(this._doc,"window");return h.addEventListener("hashchange",o,!1),()=>h.removeEventListener("hashchange",o)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(o){this.location.pathname=o}pushState(o,h,v){MY()?this._history.pushState(o,h,v):this.location.hash=v}replaceState(o,h,v){MY()?this._history.replaceState(o,h,v):this.location.hash=v}forward(){this._history.forward()}back(){this._history.back()}historyGo(o=0){this._history.go(o)}getState(){return this._history.state}}return p.\u0275fac=function(o){return new(o||p)(ri(ku))},p.\u0275prov=dr({token:p,factory:function(){return function pxe(){return new kY(ri(ku))}()},providedIn:"platform"}),p})();function MY(){return!!window.history.pushState}function qk(p,n){if(0==p.length)return n;if(0==n.length)return p;let o=0;return p.endsWith("/")&&o++,n.startsWith("/")&&o++,2==o?p+n.substring(1):1==o?p+n:p+"/"+n}function OY(p){const n=p.match(/#|\?|$/),o=n&&n.index||p.length;return p.slice(0,o-("/"===p[o-1]?1:0))+p.slice(o)}function Yf(p){return p&&"?"!==p[0]?"?"+p:p}let ky=(()=>{class p{historyGo(o){throw new Error("Not implemented")}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:function(){return function gxe(p){const n=ri(ku).location;return new FY(ri(rv),n&&n.origin||"")}()},providedIn:"root"}),p})();const Kk=new Yi("appBaseHref");let FY=(()=>{class p extends ky{constructor(o,h){if(super(),this._platformLocation=o,this._removeListenerFns=[],null==h&&(h=this._platformLocation.getBaseHrefFromDOM()),null==h)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=h}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}prepareExternalUrl(o){return qk(this._baseHref,o)}path(o=!1){const h=this._platformLocation.pathname+Yf(this._platformLocation.search),v=this._platformLocation.hash;return v&&o?`${h}${v}`:h}pushState(o,h,v,y){const _=this.prepareExternalUrl(v+Yf(y));this._platformLocation.pushState(o,h,_)}replaceState(o,h,v,y){const _=this.prepareExternalUrl(v+Yf(y));this._platformLocation.replaceState(o,h,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(o=0){var h,v;null===(v=(h=this._platformLocation).historyGo)||void 0===v||v.call(h,o)}}return p.\u0275fac=function(o){return new(o||p)(ri(rv),ri(Kk,8))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})(),mxe=(()=>{class p extends ky{constructor(o,h){super(),this._platformLocation=o,this._baseHref="",this._removeListenerFns=[],null!=h&&(this._baseHref=h)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(o){this._removeListenerFns.push(this._platformLocation.onPopState(o),this._platformLocation.onHashChange(o))}getBaseHref(){return this._baseHref}path(o=!1){let h=this._platformLocation.hash;return null==h&&(h="#"),h.length>0?h.substring(1):h}prepareExternalUrl(o){const h=qk(this._baseHref,o);return h.length>0?"#"+h:h}pushState(o,h,v,y){let _=this.prepareExternalUrl(v+Yf(y));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.pushState(o,h,_)}replaceState(o,h,v,y){let _=this.prepareExternalUrl(v+Yf(y));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.replaceState(o,h,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(o=0){var h,v;null===(v=(h=this._platformLocation).historyGo)||void 0===v||v.call(h,o)}}return p.\u0275fac=function(o){return new(o||p)(ri(rv),ri(Kk,8))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})(),Jk=(()=>{class p{constructor(o,h){this._subject=new ds,this._urlChangeListeners=[],this._platformStrategy=o;const v=this._platformStrategy.getBaseHref();this._platformLocation=h,this._baseHref=OY(LY(v)),this._platformStrategy.onPopState(y=>{this._subject.emit({url:this.path(!0),pop:!0,state:y.state,type:y.type})})}path(o=!1){return this.normalize(this._platformStrategy.path(o))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(o,h=""){return this.path()==this.normalize(o+Yf(h))}normalize(o){return p.stripTrailingSlash(function yxe(p,n){return p&&n.startsWith(p)?n.substring(p.length):n}(this._baseHref,LY(o)))}prepareExternalUrl(o){return o&&"/"!==o[0]&&(o="/"+o),this._platformStrategy.prepareExternalUrl(o)}go(o,h="",v=null){this._platformStrategy.pushState(v,"",o,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+Yf(h)),v)}replaceState(o,h="",v=null){this._platformStrategy.replaceState(v,"",o,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(o+Yf(h)),v)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(o=0){var h,v;null===(v=(h=this._platformStrategy).historyGo)||void 0===v||v.call(h,o)}onUrlChange(o){this._urlChangeListeners.push(o),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(h=>{this._notifyUrlChangeListeners(h.url,h.state)}))}_notifyUrlChangeListeners(o="",h){this._urlChangeListeners.forEach(v=>v(o,h))}subscribe(o,h,v){return this._subject.subscribe({next:o,error:h,complete:v})}}return p.normalizeQueryParams=Yf,p.joinWithSlash=qk,p.stripTrailingSlash=OY,p.\u0275fac=function(o){return new(o||p)(ri(ky),ri(rv))},p.\u0275prov=dr({token:p,factory:function(){return function vxe(){return new Jk(ri(ky),ri(rv))}()},providedIn:"root"}),p})();function LY(p){return p.replace(/\/index.html$/,"")}class rwe{constructor(n,o,h,v){this.$implicit=n,this.ngForOf=o,this.index=h,this.count=v}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let zY=(()=>{class p{constructor(o,h,v){this._viewContainer=o,this._template=h,this._differs=v,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(o){this._ngForOf=o,this._ngForOfDirty=!0}set ngForTrackBy(o){this._trackByFn=o}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(o){o&&(this._template=o)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const o=this._ngForOf;!this._differ&&o&&(this._differ=this._differs.find(o).create(this.ngForTrackBy))}if(this._differ){const o=this._differ.diff(this._ngForOf);o&&this._applyChanges(o)}}_applyChanges(o){const h=this._viewContainer;o.forEachOperation((v,y,_)=>{if(null==v.previousIndex)h.createEmbeddedView(this._template,new rwe(v.item,this._ngForOf,-1,-1),null===_?void 0:_);else if(null==_)h.remove(null===y?void 0:y);else if(null!==y){const b=h.get(y);h.move(b,_),YY(b,v)}});for(let v=0,y=h.length;v<y;v++){const b=h.get(v).context;b.index=v,b.count=y,b.ngForOf=this._ngForOf}o.forEachIdentityChange(v=>{YY(h.get(v.currentIndex),v)})}static ngTemplateContextGuard(o,h){return!0}}return p.\u0275fac=function(o){return new(o||p)(Jt(Bd),Jt(zf),Jt(DT))},p.\u0275dir=ii({type:p,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),p})();function YY(p,n){p.context.$implicit=n.item}let WT=(()=>{class p{constructor(o,h){this._viewContainer=o,this._context=new owe,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=h}set ngIf(o){this._context.$implicit=this._context.ngIf=o,this._updateView()}set ngIfThen(o){XY("ngIfThen",o),this._thenTemplateRef=o,this._thenViewRef=null,this._updateView()}set ngIfElse(o){XY("ngIfElse",o),this._elseTemplateRef=o,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(o,h){return!0}}return p.\u0275fac=function(o){return new(o||p)(Jt(Bd),Jt(zf))},p.\u0275dir=ii({type:p,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),p})();class owe{constructor(){this.$implicit=null,this.ngIf=null}}function XY(p,n){if(n&&!n.createEmbeddedView)throw new Error(`${p} must be a TemplateRef, but received '${Vr(n)}'.`)}let kwe=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({}),p})();let Lwe=(()=>{class p{}return p.\u0275prov=dr({token:p,providedIn:"root",factory:()=>new Nwe(ri(ku),window)}),p})();class Nwe{constructor(n,o){this.document=n,this.window=o,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const o=function Bwe(p,n){const o=p.getElementById(n)||p.getElementsByName(n)[0];if(o)return o;if("function"==typeof p.createTreeWalker&&p.body&&(p.body.createShadowRoot||p.body.attachShadow)){const h=p.createTreeWalker(p.body,NodeFilter.SHOW_ELEMENT);let v=h.currentNode;for(;v;){const y=v.shadowRoot;if(y){const _=y.getElementById(n)||y.querySelector(`[name="${n}"]`);if(_)return _}v=h.nextNode()}}return null}(this.document,n);o&&(this.scrollToElement(o),o.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const o=this.window.history;o&&o.scrollRestoration&&(o.scrollRestoration=n)}}scrollToElement(n){const o=n.getBoundingClientRect(),h=o.left+this.window.pageXOffset,v=o.top+this.window.pageYOffset,y=this.offset();this.window.scrollTo(h-y[0],v-y[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=JY(this.window.history)||JY(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch(n){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(n){return!1}}}function JY(p){return Object.getOwnPropertyDescriptor(p,"scrollRestoration")}class dM extends class Uwe extends class dxe{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function uxe(p){AT||(AT=p)}(new dM)}onAndCancel(n,o,h){return n.addEventListener(o,h,!1),()=>{n.removeEventListener(o,h,!1)}}dispatchEvent(n,o){n.dispatchEvent(o)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,o){return(o=o||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,o){return"window"===o?window:"document"===o?n:"body"===o?n.body:null}getBaseHref(n){const o=function Vwe(){return Tb=Tb||document.querySelector("base"),Tb?Tb.getAttribute("href"):null}();return null==o?null:function jwe(p){UT=UT||document.createElement("a"),UT.setAttribute("href",p);const n=UT.pathname;return"/"===n.charAt(0)?n:`/${n}`}(o)}resetBaseElement(){Tb=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function twe(p,n){n=encodeURIComponent(n);for(const o of p.split(";")){const h=o.indexOf("="),[v,y]=-1==h?[o,""]:[o.slice(0,h),o.slice(h+1)];if(v.trim()===n)return decodeURIComponent(y)}return null}(document.cookie,n)}}let UT,Tb=null;const QY=new Yi("TRANSITION_ID"),Gwe=[{provide:Ok,useFactory:function Hwe(p,n,o){return()=>{o.get(Fk).donePromise.then(()=>{const h=Mh(),v=n.querySelectorAll(`style[ng-transition="${p}"]`);for(let y=0;y<v.length;y++)h.remove(v[y])})}},deps:[QY,ku,oc],multi:!0}];class hM{static init(){!function Nbe(p){Vk=p}(new hM)}addToWindow(n){$r.getAngularTestability=(h,v=!0)=>{const y=n.findTestabilityInTree(h,v);if(null==y)throw new Error("Could not find testability for element.");return y},$r.getAllAngularTestabilities=()=>n.getAllTestabilities(),$r.getAllAngularRootElements=()=>n.getAllRootElements(),$r.frameworkStabilizers||($r.frameworkStabilizers=[]),$r.frameworkStabilizers.push(h=>{const v=$r.getAllAngularTestabilities();let y=v.length,_=!1;const b=function(w){_=_||w,y--,0==y&&h(_)};v.forEach(function(w){w.whenStable(b)})})}findTestabilityInTree(n,o,h){if(null==o)return null;const v=n.getTestability(o);return null!=v?v:h?Mh().isShadowRoot(o)?this.findTestabilityInTree(n,o.host,!0):this.findTestabilityInTree(n,o.parentElement,!0):null}}let zwe=(()=>{class p{build(){return new XMLHttpRequest}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();const VT=new Yi("EventManagerPlugins");let jT=(()=>{class p{constructor(o,h){this._zone=h,this._eventNameToPlugin=new Map,o.forEach(v=>v.manager=this),this._plugins=o.slice().reverse()}addEventListener(o,h,v){return this._findPluginFor(h).addEventListener(o,h,v)}addGlobalEventListener(o,h,v){return this._findPluginFor(h).addGlobalEventListener(o,h,v)}getZone(){return this._zone}_findPluginFor(o){const h=this._eventNameToPlugin.get(o);if(h)return h;const v=this._plugins;for(let y=0;y<v.length;y++){const _=v[y];if(_.supports(o))return this._eventNameToPlugin.set(o,_),_}throw new Error(`No event manager plugin found for event ${o}`)}}return p.\u0275fac=function(o){return new(o||p)(ri(VT),ri(Fa))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();class ZY{constructor(n){this._doc=n}addGlobalEventListener(n,o,h){const v=Mh().getGlobalEventTarget(this._doc,n);if(!v)throw new Error(`Unsupported event target ${v} for event ${o}`);return this.addEventListener(v,o,h)}}let eX=(()=>{class p{constructor(){this._stylesSet=new Set}addStyles(o){const h=new Set;o.forEach(v=>{this._stylesSet.has(v)||(this._stylesSet.add(v),h.add(v))}),this.onStylesAdded(h)}onStylesAdded(o){}getAllStyles(){return Array.from(this._stylesSet)}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})(),Ib=(()=>{class p extends eX{constructor(o){super(),this._doc=o,this._hostNodes=new Map,this._hostNodes.set(o.head,[])}_addStylesToHost(o,h,v){o.forEach(y=>{const _=this._doc.createElement("style");_.textContent=y,v.push(h.appendChild(_))})}addHost(o){const h=[];this._addStylesToHost(this._stylesSet,o,h),this._hostNodes.set(o,h)}removeHost(o){const h=this._hostNodes.get(o);h&&h.forEach(tX),this._hostNodes.delete(o)}onStylesAdded(o){this._hostNodes.forEach((h,v)=>{this._addStylesToHost(o,v,h)})}ngOnDestroy(){this._hostNodes.forEach(o=>o.forEach(tX))}}return p.\u0275fac=function(o){return new(o||p)(ri(ku))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();function tX(p){Mh().remove(p)}const fM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},pM=/%COMP%/g;function HT(p,n,o){for(let h=0;h<n.length;h++){let v=n[h];Array.isArray(v)?HT(p,v,o):(v=v.replace(pM,p),o.push(v))}return o}function rX(p){return n=>{if("__ngUnwrap__"===n)return p;!1===p(n)&&(n.preventDefault(),n.returnValue=!1)}}let gM=(()=>{class p{constructor(o,h,v){this.eventManager=o,this.sharedStylesHost=h,this.appId=v,this.rendererByCompId=new Map,this.defaultRenderer=new mM(o)}createRenderer(o,h){if(!o||!h)return this.defaultRenderer;switch(h.encapsulation){case bh.Emulated:{let v=this.rendererByCompId.get(h.id);return v||(v=new Jwe(this.eventManager,this.sharedStylesHost,h,this.appId),this.rendererByCompId.set(h.id,v)),v.applyToHost(o),v}case 1:case bh.ShadowDom:return new Qwe(this.eventManager,this.sharedStylesHost,o,h);default:if(!this.rendererByCompId.has(h.id)){const v=HT(h.id,h.styles,[]);this.sharedStylesHost.addStyles(v),this.rendererByCompId.set(h.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return p.\u0275fac=function(o){return new(o||p)(ri(jT),ri(Ib),ri(bb))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();class mM{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,o){return o?document.createElementNS(fM[o]||o,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,o){n.appendChild(o)}insertBefore(n,o,h){n&&n.insertBefore(o,h)}removeChild(n,o){n&&n.removeChild(o)}selectRootElement(n,o){let h="string"==typeof n?document.querySelector(n):n;if(!h)throw new Error(`The selector "${n}" did not match any elements`);return o||(h.textContent=""),h}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,o,h,v){if(v){o=v+":"+o;const y=fM[v];y?n.setAttributeNS(y,o,h):n.setAttribute(o,h)}else n.setAttribute(o,h)}removeAttribute(n,o,h){if(h){const v=fM[h];v?n.removeAttributeNS(v,o):n.removeAttribute(`${h}:${o}`)}else n.removeAttribute(o)}addClass(n,o){n.classList.add(o)}removeClass(n,o){n.classList.remove(o)}setStyle(n,o,h,v){v&(Mc.DashCase|Mc.Important)?n.style.setProperty(o,h,v&Mc.Important?"important":""):n.style[o]=h}removeStyle(n,o,h){h&Mc.DashCase?n.style.removeProperty(o):n.style[o]=""}setProperty(n,o,h){n[o]=h}setValue(n,o){n.nodeValue=o}listen(n,o,h){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,o,rX(h)):this.eventManager.addEventListener(n,o,rX(h))}}class Jwe extends mM{constructor(n,o,h,v){super(n),this.component=h;const y=HT(v+"-"+h.id,h.styles,[]);o.addStyles(y),this.contentAttr=function $we(p){return"_ngcontent-%COMP%".replace(pM,p)}(v+"-"+h.id),this.hostAttr=function qwe(p){return"_nghost-%COMP%".replace(pM,p)}(v+"-"+h.id)}applyToHost(n){super.setAttribute(n,this.hostAttr,"")}createElement(n,o){const h=super.createElement(n,o);return super.setAttribute(h,this.contentAttr,""),h}}class Qwe extends mM{constructor(n,o,h,v){super(n),this.sharedStylesHost=o,this.hostEl=h,this.shadowRoot=h.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const y=HT(v.id,v.styles,[]);for(let _=0;_<y.length;_++){const b=document.createElement("style");b.textContent=y[_],this.shadowRoot.appendChild(b)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(n,o){return super.appendChild(this.nodeOrShadowRoot(n),o)}insertBefore(n,o,h){return super.insertBefore(this.nodeOrShadowRoot(n),o,h)}removeChild(n,o){return super.removeChild(this.nodeOrShadowRoot(n),o)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}}let Zwe=(()=>{class p extends ZY{constructor(o){super(o)}supports(o){return!0}addEventListener(o,h,v){return o.addEventListener(h,v,!1),()=>this.removeEventListener(o,h,v)}removeEventListener(o,h,v){return o.removeEventListener(h,v)}}return p.\u0275fac=function(o){return new(o||p)(ri(ku))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();const sX=["alt","control","meta","shift"],tSe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aX={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},nSe={alt:p=>p.altKey,control:p=>p.ctrlKey,meta:p=>p.metaKey,shift:p=>p.shiftKey};let iSe=(()=>{class p extends ZY{constructor(o){super(o)}supports(o){return null!=p.parseEventName(o)}addEventListener(o,h,v){const y=p.parseEventName(h),_=p.eventCallback(y.fullKey,v,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Mh().onAndCancel(o,y.domEventName,_))}static parseEventName(o){const h=o.toLowerCase().split("."),v=h.shift();if(0===h.length||"keydown"!==v&&"keyup"!==v)return null;const y=p._normalizeKey(h.pop());let _="";if(sX.forEach(w=>{const I=h.indexOf(w);I>-1&&(h.splice(I,1),_+=w+".")}),_+=y,0!=h.length||0===y.length)return null;const b={};return b.domEventName=v,b.fullKey=_,b}static getEventFullKey(o){let h="",v=function rSe(p){let n=p.key;if(null==n){if(n=p.keyIdentifier,null==n)return"Unidentified";n.startsWith("U+")&&(n=String.fromCharCode(parseInt(n.substring(2),16)),3===p.location&&aX.hasOwnProperty(n)&&(n=aX[n]))}return tSe[n]||n}(o);return v=v.toLowerCase()," "===v?v="space":"."===v&&(v="dot"),sX.forEach(y=>{y!=v&&nSe[y](o)&&(h+=y+".")}),h+=v,h}static eventCallback(o,h,v){return y=>{p.getEventFullKey(y)===o&&v.runGuarded(()=>h(y))}}static _normalizeKey(o){return"esc"===o?"escape":o}}return p.\u0275fac=function(o){return new(o||p)(ri(ku))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();const lSe=vY(axe,"browser",[{provide:cY,useValue:"browser"},{provide:lY,useValue:function oSe(){dM.makeCurrent(),hM.init()},multi:!0},{provide:ku,useFactory:function aSe(){return function ume(p){D6=p}(document),document},deps:[]}]),cSe=[{provide:GR,useValue:"root"},{provide:ib,useFactory:function sSe(){return new ib},deps:[]},{provide:VT,useClass:Zwe,multi:!0,deps:[ku,Fa,cY]},{provide:VT,useClass:iSe,multi:!0,deps:[ku]},{provide:gM,useClass:gM,deps:[jT,Ib,bb]},{provide:Tz,useExisting:gM},{provide:eX,useExisting:Ib},{provide:Ib,useClass:Ib,deps:[ku]},{provide:Uk,useClass:Uk,deps:[Fa]},{provide:jT,useClass:jT,deps:[VT,Fa]},{provide:class Wwe{},useClass:zwe,deps:[]}];let uSe=(()=>{class p{constructor(o){if(o)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(o){return{ngModule:p,providers:[{provide:bb,useValue:o.appId},{provide:QY,useExisting:bb},Gwe]}}}return p.\u0275fac=function(o){return new(o||p)(ri(p,12))},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({providers:cSe,imports:[kwe,lxe]}),p})();"undefined"!=typeof window&&window;const{isArray:bSe}=Array,{getPrototypeOf:xSe,prototype:wSe,keys:SSe}=Object;function uX(p){if(1===p.length){const n=p[0];if(bSe(n))return{args:n,keys:null};if(function TSe(p){return p&&"object"==typeof p&&xSe(p)===wSe}(n)){const o=SSe(n);return{args:o.map(h=>n[h]),keys:o}}}return{args:p,keys:null}}const{isArray:ISe}=Array;function dX(p){return co(n=>function ESe(p,n){return ISe(n)?p(...n):p(n)}(p,n))}function hX(p,n){return p.reduce((o,h,v)=>(o[h]=n[v],o),{})}let fX=(()=>{class p{constructor(o,h){this._renderer=o,this._elementRef=h,this.onChange=v=>{},this.onTouched=()=>{}}setProperty(o,h){this._renderer.setProperty(this._elementRef.nativeElement,o,h)}registerOnTouched(o){this.onTouched=o}registerOnChange(o){this.onChange=o}setDisabledState(o){this.setProperty("disabled",o)}}return p.\u0275fac=function(o){return new(o||p)(Jt(Hf),Jt(Lc))},p.\u0275dir=ii({type:p}),p})(),ov=(()=>{class p extends fX{}return p.\u0275fac=function(){let n;return function(h){return(n||(n=ol(p)))(h||p)}}(),p.\u0275dir=ii({type:p,features:[Hr]}),p})();const Oh=new Yi("NgValueAccessor"),PSe={provide:Oh,useExisting:uo(()=>GT),multi:!0},kSe=new Yi("CompositionEventMode");let GT=(()=>{class p extends fX{constructor(o,h,v){super(o,h),this._compositionMode=v,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function RSe(){const p=Mh()?Mh().getUserAgent():"";return/android (\d+)/.test(p.toLowerCase())}())}writeValue(o){this.setProperty("value",null==o?"":o)}_handleInput(o){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(o)}_compositionStart(){this._composing=!0}_compositionEnd(o){this._composing=!1,this._compositionMode&&this.onChange(o)}}return p.\u0275fac=function(o){return new(o||p)(Jt(Hf),Jt(Lc),Jt(kSe,8))},p.\u0275dir=ii({type:p,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,h){1&o&&oi("input",function(y){return h._handleInput(y.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(y){return h._compositionEnd(y.target.value)})},features:[ko([PSe]),Hr]}),p})();const cl=new Yi("NgValidators"),Cg=new Yi("NgAsyncValidators");function SX(p){return null!=p}function TX(p){const n=cb(p)?ka(p):p;return ok(n),n}function IX(p){let n={};return p.forEach(o=>{n=null!=o?Object.assign(Object.assign({},n),o):n}),0===Object.keys(n).length?null:n}function EX(p,n){return n.map(o=>o(p))}function DX(p){return p.map(n=>function OSe(p){return!p.validate}(n)?n:o=>n.validate(o))}function yM(p){return null!=p?function AX(p){if(!p)return null;const n=p.filter(SX);return 0==n.length?null:function(o){return IX(EX(o,n))}}(DX(p)):null}function _M(p){return null!=p?function PX(p){if(!p)return null;const n=p.filter(SX);return 0==n.length?null:function(o){return function DSe(...p){const n=KU(p),{args:o,keys:h}=uX(p),v=new Ls(y=>{const{length:_}=o;if(!_)return void y.complete();const b=new Array(_);let w=_,I=_;for(let A=0;A<_;A++){let M=!1;Id(o[A]).subscribe(_a(y,F=>{M||(M=!0,I--),b[A]=F},()=>w--,void 0,()=>{(!w||!M)&&(I||y.next(h?hX(h,b):b),y.complete())}))}});return n?v.pipe(dX(n)):v}(EX(o,n).map(TX)).pipe(co(IX))}}(DX(p)):null}function RX(p,n){return null===p?[n]:Array.isArray(p)?[...p,n]:[p,n]}function CM(p){return p?Array.isArray(p)?p:[p]:[]}function YT(p,n){return Array.isArray(p)?p.includes(n):p===n}function OX(p,n){const o=CM(n);return CM(p).forEach(v=>{YT(o,v)||o.push(v)}),o}function FX(p,n){return CM(n).filter(o=>!YT(p,o))}class LX{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=yM(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=_M(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n){this.control&&this.control.reset(n)}hasError(n,o){return!!this.control&&this.control.hasError(n,o)}getError(n,o){return this.control?this.control.getError(n,o):null}}class bg extends LX{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Fl extends LX{get formDirective(){return null}get path(){return null}}let BX=(()=>{class p extends class NX{constructor(n){this._cd=n}is(n){var o,h,v;return"submitted"===n?!!(null===(o=this._cd)||void 0===o?void 0:o.submitted):!!(null===(v=null===(h=this._cd)||void 0===h?void 0:h.control)||void 0===v?void 0:v[n])}}{constructor(o){super(o)}}return p.\u0275fac=function(o){return new(o||p)(Jt(bg,2))},p.\u0275dir=ii({type:p,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,h){2&o&&fT("ng-untouched",h.is("untouched"))("ng-touched",h.is("touched"))("ng-pristine",h.is("pristine"))("ng-dirty",h.is("dirty"))("ng-valid",h.is("valid"))("ng-invalid",h.is("invalid"))("ng-pending",h.is("pending"))},features:[Hr]}),p})();function Eb(p,n){(function wM(p,n){const o=function kX(p){return p._rawValidators}(p);null!==n.validator?p.setValidators(RX(o,n.validator)):"function"==typeof o&&p.setValidators([o]);const h=function MX(p){return p._rawAsyncValidators}(p);null!==n.asyncValidator?p.setAsyncValidators(RX(h,n.asyncValidator)):"function"==typeof h&&p.setAsyncValidators([h]);const v=()=>p.updateValueAndValidity();KT(n._rawValidators,v),KT(n._rawAsyncValidators,v)})(p,n),n.valueAccessor.writeValue(p.value),function HSe(p,n){n.valueAccessor.registerOnChange(o=>{p._pendingValue=o,p._pendingChange=!0,p._pendingDirty=!0,"change"===p.updateOn&&UX(p,n)})}(p,n),function zSe(p,n){const o=(h,v)=>{n.valueAccessor.writeValue(h),v&&n.viewToModelUpdate(h)};p.registerOnChange(o),n._registerOnDestroy(()=>{p._unregisterOnChange(o)})}(p,n),function GSe(p,n){n.valueAccessor.registerOnTouched(()=>{p._pendingTouched=!0,"blur"===p.updateOn&&p._pendingChange&&UX(p,n),"submit"!==p.updateOn&&p.markAsTouched()})}(p,n),function jSe(p,n){if(n.valueAccessor.setDisabledState){const o=h=>{n.valueAccessor.setDisabledState(h)};p.registerOnDisabledChange(o),n._registerOnDestroy(()=>{p._unregisterOnDisabledChange(o)})}}(p,n)}function KT(p,n){p.forEach(o=>{o.registerOnValidatorChange&&o.registerOnValidatorChange(n)})}function UX(p,n){p._pendingDirty&&p.markAsDirty(),p.setValue(p._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(p._pendingValue),p._pendingChange=!1}function IM(p,n){const o=p.indexOf(n);o>-1&&p.splice(o,1)}const Db="VALID",QT="INVALID",My="PENDING",Ab="DISABLED";function DM(p){return(ZT(p)?p.validators:p)||null}function GX(p){return Array.isArray(p)?yM(p):p||null}function AM(p,n){return(ZT(n)?n.asyncValidators:p)||null}function zX(p){return Array.isArray(p)?_M(p):p||null}function ZT(p){return null!=p&&!Array.isArray(p)&&"object"==typeof p}const PM=p=>p instanceof kM;function XX(p){return(p=>p instanceof KX)(p)?p.value:p.getRawValue()}function $X(p,n){const o=PM(p),h=p.controls;if(!(o?Object.keys(h):h).length)throw new yr(1e3,"");if(!h[n])throw new yr(1001,"")}function qX(p,n){PM(p),p._forEachChild((h,v)=>{if(void 0===n[v])throw new yr(1002,"")})}class RM{constructor(n,o){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=n,this._rawAsyncValidators=o,this._composedValidatorFn=GX(this._rawValidators),this._composedAsyncValidatorFn=zX(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Db}get invalid(){return this.status===QT}get pending(){return this.status==My}get disabled(){return this.status===Ab}get enabled(){return this.status!==Ab}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._rawValidators=n,this._composedValidatorFn=GX(n)}setAsyncValidators(n){this._rawAsyncValidators=n,this._composedAsyncValidatorFn=zX(n)}addValidators(n){this.setValidators(OX(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(OX(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(FX(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(FX(n,this._rawAsyncValidators))}hasValidator(n){return YT(this._rawValidators,n)}hasAsyncValidator(n){return YT(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(o=>{o.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=My,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const o=this._parentMarkedDirty(n.onlySelf);this.status=Ab,this.errors=null,this._forEachChild(h=>{h.disable(Object.assign(Object.assign({},n),{onlySelf:!0}))}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},n),{skipPristineCheck:o})),this._onDisabledChange.forEach(h=>h(!0))}enable(n={}){const o=this._parentMarkedDirty(n.onlySelf);this.status=Db,this._forEachChild(h=>{h.enable(Object.assign(Object.assign({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},n),{skipPristineCheck:o})),this._onDisabledChange.forEach(h=>h(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Db||this.status===My)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(o=>o._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ab:Db}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=My,this._hasOwnPendingAsyncValidator=!0;const o=TX(this.asyncValidator(this));this._asyncValidationSubscription=o.subscribe(h=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(h,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,o={}){this.errors=n,this._updateControlsErrors(!1!==o.emitEvent)}get(n){return function qSe(p,n,o){if(null==n||(Array.isArray(n)||(n=n.split(o)),Array.isArray(n)&&0===n.length))return null;let h=p;return n.forEach(v=>{h=PM(h)?h.controls.hasOwnProperty(v)?h.controls[v]:null:(p=>p instanceof JSe)(h)&&h.at(v)||null}),h}(this,n,".")}getError(n,o){const h=o?this.get(o):this;return h&&h.errors?h.errors[n]:null}hasError(n,o){return!!this.getError(n,o)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new ds,this.statusChanges=new ds}_calculateStatus(){return this._allControlsDisabled()?Ab:this.errors?QT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(My)?My:this._anyControlsHaveStatus(QT)?QT:Db}_anyControlsHaveStatus(n){return this._anyControls(o=>o.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_isBoxedValue(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){ZT(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class KX extends RM{constructor(n=null,o,h){super(DM(o),AM(h,o)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(o),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ZT(o)&&o.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(n)?n.value:n)}setValue(n,o={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==o.emitModelToViewChange&&this._onChange.forEach(h=>h(this.value,!1!==o.emitViewToModelChange)),this.updateValueAndValidity(o)}patchValue(n,o={}){this.setValue(n,o)}reset(n=this.defaultValue,o={}){this._applyFormState(n),this.markAsPristine(o),this.markAsUntouched(o),this.setValue(this.value,o),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){IM(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){IM(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){this._isBoxedValue(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}}class kM extends RM{constructor(n,o,h){super(DM(o),AM(h,o)),this.controls=n,this._initObservables(),this._setUpdateStrategy(o),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,o){return this.controls[n]?this.controls[n]:(this.controls[n]=o,o.setParent(this),o._registerOnCollectionChange(this._onCollectionChange),o)}addControl(n,o,h={}){this.registerControl(n,o),this.updateValueAndValidity({emitEvent:h.emitEvent}),this._onCollectionChange()}removeControl(n,o={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}setControl(n,o,h={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],o&&this.registerControl(n,o),this.updateValueAndValidity({emitEvent:h.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,o={}){qX(this,n),Object.keys(n).forEach(h=>{$X(this,h),this.controls[h].setValue(n[h],{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o)}patchValue(n,o={}){null!=n&&(Object.keys(n).forEach(h=>{this.controls[h]&&this.controls[h].patchValue(n[h],{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o))}reset(n={},o={}){this._forEachChild((h,v)=>{h.reset(n[v],{onlySelf:!0,emitEvent:o.emitEvent})}),this._updatePristine(o),this._updateTouched(o),this.updateValueAndValidity(o)}getRawValue(){return this._reduceChildren({},(n,o,h)=>(n[h]=XX(o),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(o,h)=>!!h._syncPendingControls()||o);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(o=>{const h=this.controls[o];h&&n(h,o)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const o of Object.keys(this.controls)){const h=this.controls[o];if(this.contains(o)&&n(h))return!0}return!1}_reduceValue(){return this._reduceChildren({},(n,o,h)=>((o.enabled||this.disabled)&&(n[h]=o.value),n))}_reduceChildren(n,o){let h=n;return this._forEachChild((v,y)=>{h=o(h,v,y)}),h}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class JSe extends RM{constructor(n,o,h){super(DM(o),AM(h,o)),this.controls=n,this._initObservables(),this._setUpdateStrategy(o),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[n]}push(n,o={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}insert(n,o,h={}){this.controls.splice(n,0,o),this._registerControl(o),this.updateValueAndValidity({emitEvent:h.emitEvent})}removeAt(n,o={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:o.emitEvent})}setControl(n,o,h={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),o&&(this.controls.splice(n,0,o),this._registerControl(o)),this.updateValueAndValidity({emitEvent:h.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,o={}){qX(this,n),n.forEach((h,v)=>{$X(this,v),this.at(v).setValue(h,{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o)}patchValue(n,o={}){null!=n&&(n.forEach((h,v)=>{this.at(v)&&this.at(v).patchValue(h,{onlySelf:!0,emitEvent:o.emitEvent})}),this.updateValueAndValidity(o))}reset(n=[],o={}){this._forEachChild((h,v)=>{h.reset(n[v],{onlySelf:!0,emitEvent:o.emitEvent})}),this._updatePristine(o),this._updateTouched(o),this.updateValueAndValidity(o)}getRawValue(){return this.controls.map(n=>XX(n))}clear(n={}){this.controls.length<1||(this._forEachChild(o=>o._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_syncPendingControls(){let n=this.controls.reduce((o,h)=>!!h._syncPendingControls()||o,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((o,h)=>{n(o,h)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(o=>o.enabled&&n(o))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}}const e3e={provide:bg,useExisting:uo(()=>OM)},ZX=(()=>Promise.resolve(null))();let OM=(()=>{class p extends bg{constructor(o,h,v,y,_){super(),this._changeDetectorRef=_,this.control=new KX,this._registered=!1,this.update=new ds,this._parent=o,this._setValidators(h),this._setAsyncValidators(v),this.valueAccessor=function TM(p,n){if(!n)return null;let o,h,v;return Array.isArray(n),n.forEach(y=>{y.constructor===GT?o=y:function $Se(p){return Object.getPrototypeOf(p.constructor)===ov}(y)?h=y:v=y}),v||h||o||null}(0,y)}ngOnChanges(o){if(this._checkForErrors(),!this._registered||"name"in o){if(this._registered&&(this._checkName(),this.formDirective)){const h=o.name.previousValue;this.formDirective.removeControl({name:h,path:this._getPath(h)})}this._setUpControl()}"isDisabled"in o&&this._updateDisabled(o),function SM(p,n){if(!p.hasOwnProperty("model"))return!1;const o=p.model;return!!o.isFirstChange()||!Object.is(n,o.currentValue)}(o,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(o){this.viewModel=o,this.update.emit(o)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Eb(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(o){ZX.then(()=>{var h;this.control.setValue(o,{emitViewToModelChange:!1}),null===(h=this._changeDetectorRef)||void 0===h||h.markForCheck()})}_updateDisabled(o){const h=o.isDisabled.currentValue,v=""===h||h&&"false"!==h;ZX.then(()=>{var y;v&&!this.control.disabled?this.control.disable():!v&&this.control.disabled&&this.control.enable(),null===(y=this._changeDetectorRef)||void 0===y||y.markForCheck()})}_getPath(o){return this._parent?function $T(p,n){return[...n.path,p]}(o,this._parent):[o]}}return p.\u0275fac=function(o){return new(o||p)(Jt(Fl,9),Jt(cl,10),Jt(Cg,10),Jt(Oh,10),Jt(TT,8))},p.\u0275dir=ii({type:p,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ko([e3e]),Hr,Eu]}),p})(),t$=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({}),p})();const d3e={provide:Oh,useExisting:uo(()=>BM),multi:!0};function l$(p,n){return null==p?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${p}: ${n}`.slice(0,50))}let BM=(()=>{class p extends ov{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(o){this._compareWith=o}writeValue(o){this.value=o;const v=l$(this._getOptionId(o),o);this.setProperty("value",v)}registerOnChange(o){this.onChange=h=>{this.value=this._getOptionValue(h),o(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(o){for(const h of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(h),o))return h;return null}_getOptionValue(o){const h=function h3e(p){return p.split(":")[0]}(o);return this._optionMap.has(h)?this._optionMap.get(h):o}}return p.\u0275fac=function(){let n;return function(h){return(n||(n=ol(p)))(h||p)}}(),p.\u0275dir=ii({type:p,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(o,h){1&o&&oi("change",function(y){return h.onChange(y.target.value)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[ko([d3e]),Hr]}),p})(),WM=(()=>{class p{constructor(o,h,v){this._element=o,this._renderer=h,this._select=v,this._select&&(this.id=this._select._registerOption())}set ngValue(o){null!=this._select&&(this._select._optionMap.set(this.id,o),this._setElementValue(l$(this.id,o)),this._select.writeValue(this._select.value))}set value(o){this._setElementValue(o),this._select&&this._select.writeValue(this._select.value)}_setElementValue(o){this._renderer.setProperty(this._element.nativeElement,"value",o)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return p.\u0275fac=function(o){return new(o||p)(Jt(Lc),Jt(Hf),Jt(BM,9))},p.\u0275dir=ii({type:p,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),p})();const f3e={provide:Oh,useExisting:uo(()=>UM),multi:!0};function c$(p,n){return null==p?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${p}: ${n}`.slice(0,50))}let UM=(()=>{class p extends ov{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(o){this._compareWith=o}writeValue(o){let h;if(this.value=o,Array.isArray(o)){const v=o.map(y=>this._getOptionId(y));h=(y,_)=>{y._setSelected(v.indexOf(_.toString())>-1)}}else h=(v,y)=>{v._setSelected(!1)};this._optionMap.forEach(h)}registerOnChange(o){this.onChange=h=>{const v=[],y=h.selectedOptions;if(void 0!==y){const _=y;for(let b=0;b<_.length;b++){const I=this._getOptionValue(_[b].value);v.push(I)}}else{const _=h.options;for(let b=0;b<_.length;b++){const w=_[b];if(w.selected){const I=this._getOptionValue(w.value);v.push(I)}}}this.value=v,o(v)}}_registerOption(o){const h=(this._idCounter++).toString();return this._optionMap.set(h,o),h}_getOptionId(o){for(const h of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(h)._value,o))return h;return null}_getOptionValue(o){const h=function p3e(p){return p.split(":")[0]}(o);return this._optionMap.has(h)?this._optionMap.get(h)._value:o}}return p.\u0275fac=function(){let n;return function(h){return(n||(n=ol(p)))(h||p)}}(),p.\u0275dir=ii({type:p,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(o,h){1&o&&oi("change",function(y){return h.onChange(y.target)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[ko([f3e]),Hr]}),p})(),VM=(()=>{class p{constructor(o,h,v){this._element=o,this._renderer=h,this._select=v,this._select&&(this.id=this._select._registerOption(this))}set ngValue(o){null!=this._select&&(this._value=o,this._setElementValue(c$(this.id,o)),this._select.writeValue(this._select.value))}set value(o){this._select?(this._value=o,this._setElementValue(c$(this.id,o)),this._select.writeValue(this._select.value)):this._setElementValue(o)}_setElementValue(o){this._renderer.setProperty(this._element.nativeElement,"value",o)}_setSelected(o){this._renderer.setProperty(this._element.nativeElement,"selected",o)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return p.\u0275fac=function(o){return new(o||p)(Jt(Lc),Jt(Hf),Jt(UM,9))},p.\u0275dir=ii({type:p,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),p})(),S3e=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({imports:[[t$]]}),p})(),T3e=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({imports:[S3e]}),p})();function Ni(...p){return ka(p,kC(p))}class Vd extends Of{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const o=super._subscribe(n);return!o.closed&&n.next(this._value),o}getValue(){const{hasError:n,thrownError:o,_value:h}=this;if(n)throw o;return this._throwIfClosed(),h}next(n){super.next(this._value=n)}}function _$(p,n,o){p?Ff(o,p,n):n()}function eI(p,n){const o=hi(p)?p:()=>p,h=v=>v.error(o());return new Ls(n?v=>n.schedule(h,0,v):h)}const tI=Is(p=>function(){p(this),this.name="EmptyError",this.message="no elements in sequence"});function HM(...p){return function D3e(){return RC(1)}()(ka(p,kC(p)))}function C$(p){return new Ls(n=>{Id(p()).subscribe(n)})}function b$(){return Ra((p,n)=>{let o=null;p._refCount++;const h=_a(n,void 0,void 0,void 0,()=>{if(!p||p._refCount<=0||0<--p._refCount)return void(o=null);const v=p._connection,y=o;o=null,v&&(!y||v===y)&&v.unsubscribe(),n.unsubscribe()});p.subscribe(h),h.closed||(o=p.connect())})}class A3e extends Ls{constructor(n,o){super(),this.source=n,this.subjectFactory=o,this._subject=null,this._refCount=0,this._connection=null,FU(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,null==n||n.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Su;const o=this.getSubject();n.add(this.source.subscribe(_a(o,void 0,()=>{this._teardown(),o.complete()},h=>{this._teardown(),o.error(h)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Su.EMPTY)}return n}refCount(){return b$()(this)}}function av(p,n){return Ra((o,h)=>{let v=null,y=0,_=!1;const b=()=>_&&!v&&h.complete();o.subscribe(_a(h,w=>{null==v||v.unsubscribe();let I=0;const A=y++;Id(p(w,A)).subscribe(v=_a(h,M=>h.next(n?n(w,M,A,I++):M),()=>{v=null,b()}))},()=>{_=!0,b()}))})}function GM(p){return p<=0?()=>Lf:Ra((n,o)=>{let h=0;n.subscribe(_a(o,v=>{++h<=p&&(o.next(v),p<=h&&o.complete())}))})}function R3e(p,n,o,h,v){return(y,_)=>{let b=o,w=n,I=0;y.subscribe(_a(_,A=>{const M=I++;w=b?p(w,A,M):(b=!0,A),h&&_.next(w)},v&&(()=>{b&&_.next(w),_.complete()})))}}function x$(p,n){return Ra(R3e(p,n,arguments.length>=2,!0))}function Oy(p,n){return Ra((o,h)=>{let v=0;o.subscribe(_a(h,y=>p.call(n,y,v++)&&h.next(y)))})}function xg(p){return Ra((n,o)=>{let y,h=null,v=!1;h=n.subscribe(_a(o,void 0,void 0,_=>{y=Id(p(_,xg(p)(n))),h?(h.unsubscribe(),h=null,y.subscribe(o)):v=!0})),v&&(h.unsubscribe(),h=null,y.subscribe(o))})}function Rb(p,n){return hi(n)?Ca(p,n,1):Ca(p,1)}function zM(p){return p<=0?()=>Lf:Ra((n,o)=>{let h=[];n.subscribe(_a(o,v=>{h.push(v),p<h.length&&h.shift()},()=>{for(const v of h)o.next(v);o.complete()},void 0,()=>{h=null}))})}function w$(p=k3e){return Ra((n,o)=>{let h=!1;n.subscribe(_a(o,v=>{h=!0,o.next(v)},()=>h?o.complete():o.error(p())))})}function k3e(){return new tI}function S$(p){return Ra((n,o)=>{let h=!1;n.subscribe(_a(o,v=>{h=!0,o.next(v)},()=>{h||o.next(p),o.complete()}))})}function Fy(p,n){const o=arguments.length>=2;return h=>h.pipe(p?Oy((v,y)=>p(v,y,h)):Ym,GM(1),o?S$(n):w$(()=>new tI))}function Nc(p,n,o){const h=hi(p)||n||o?{next:p,error:n,complete:o}:p;return h?Ra((v,y)=>{var _;null===(_=h.subscribe)||void 0===_||_.call(h);let b=!0;v.subscribe(_a(y,w=>{var I;null===(I=h.next)||void 0===I||I.call(h,w),y.next(w)},()=>{var w;b=!1,null===(w=h.complete)||void 0===w||w.call(h),y.complete()},w=>{var I;b=!1,null===(I=h.error)||void 0===I||I.call(h,w),y.error(w)},()=>{var w,I;b&&(null===(w=h.unsubscribe)||void 0===w||w.call(h)),null===(I=h.finalize)||void 0===I||I.call(h)}))}):Ym}class $f{constructor(n,o){this.id=n,this.url=o}}class YM extends $f{constructor(n,o,h="imperative",v=null){super(n,o),this.navigationTrigger=h,this.restoredState=v}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class kb extends $f{constructor(n,o,h){super(n,o),this.urlAfterRedirects=h}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class T$ extends $f{constructor(n,o,h){super(n,o),this.reason=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class F3e extends $f{constructor(n,o,h){super(n,o),this.error=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class L3e extends $f{constructor(n,o,h,v){super(n,o),this.urlAfterRedirects=h,this.state=v}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class N3e extends $f{constructor(n,o,h,v){super(n,o),this.urlAfterRedirects=h,this.state=v}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class B3e extends $f{constructor(n,o,h,v,y){super(n,o),this.urlAfterRedirects=h,this.state=v,this.shouldActivate=y}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class W3e extends $f{constructor(n,o,h,v){super(n,o),this.urlAfterRedirects=h,this.state=v}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class U3e extends $f{constructor(n,o,h,v){super(n,o),this.urlAfterRedirects=h,this.state=v}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class I${constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class E${constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class V3e{constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j3e{constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class H3e{constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class G3e{constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class D${constructor(n,o,h){this.routerEvent=n,this.position=o,this.anchor=h}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Xi="primary";class z3e{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const o=this.params[n];return Array.isArray(o)?o[0]:o}return null}getAll(n){if(this.has(n)){const o=this.params[n];return Array.isArray(o)?o:[o]}return[]}get keys(){return Object.keys(this.params)}}function Ly(p){return new z3e(p)}const A$="ngNavigationCancelingError";function XM(p){const n=Error("NavigationCancelingError: "+p);return n[A$]=!0,n}function X3e(p,n,o){const h=o.path.split("/");if(h.length>p.length||"full"===o.pathMatch&&(n.hasChildren()||h.length<p.length))return null;const v={};for(let y=0;y<h.length;y++){const _=h[y],b=p[y];if(_.startsWith(":"))v[_.substring(1)]=b;else if(_!==b.path)return null}return{consumed:p.slice(0,h.length),posParams:v}}function Fh(p,n){const o=p?Object.keys(p):void 0,h=n?Object.keys(n):void 0;if(!o||!h||o.length!=h.length)return!1;let v;for(let y=0;y<o.length;y++)if(v=o[y],!P$(p[v],n[v]))return!1;return!0}function P$(p,n){if(Array.isArray(p)&&Array.isArray(n)){if(p.length!==n.length)return!1;const o=[...p].sort(),h=[...n].sort();return o.every((v,y)=>h[y]===v)}return p===n}function R$(p){return Array.prototype.concat.apply([],p)}function k$(p){return p.length>0?p[p.length-1]:null}function La(p,n){for(const o in p)p.hasOwnProperty(o)&&n(p[o],o)}function Lh(p){return ok(p)?p:cb(p)?ka(Promise.resolve(p)):Ni(p)}const K3e={exact:function F$(p,n,o){if(!cv(p.segments,n.segments)||!nI(p.segments,n.segments,o)||p.numberOfChildren!==n.numberOfChildren)return!1;for(const h in n.children)if(!p.children[h]||!F$(p.children[h],n.children[h],o))return!1;return!0},subset:L$},M$={exact:function J3e(p,n){return Fh(p,n)},subset:function Q3e(p,n){return Object.keys(n).length<=Object.keys(p).length&&Object.keys(n).every(o=>P$(p[o],n[o]))},ignored:()=>!0};function O$(p,n,o){return K3e[o.paths](p.root,n.root,o.matrixParams)&&M$[o.queryParams](p.queryParams,n.queryParams)&&!("exact"===o.fragment&&p.fragment!==n.fragment)}function L$(p,n,o){return N$(p,n,n.segments,o)}function N$(p,n,o,h){if(p.segments.length>o.length){const v=p.segments.slice(0,o.length);return!(!cv(v,o)||n.hasChildren()||!nI(v,o,h))}if(p.segments.length===o.length){if(!cv(p.segments,o)||!nI(p.segments,o,h))return!1;for(const v in n.children)if(!p.children[v]||!L$(p.children[v],n.children[v],h))return!1;return!0}{const v=o.slice(0,p.segments.length),y=o.slice(p.segments.length);return!!(cv(p.segments,v)&&nI(p.segments,v,h)&&p.children[Xi])&&N$(p.children[Xi],n,y,h)}}function nI(p,n,o){return n.every((h,v)=>M$[o](p[v].parameters,h.parameters))}class lv{constructor(n,o,h){this.root=n,this.queryParams=o,this.fragment=h}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ly(this.queryParams)),this._queryParamMap}toString(){return tTe.serialize(this)}}class fr{constructor(n,o){this.segments=n,this.children=o,this.parent=null,La(o,(h,v)=>h.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iI(this)}}class Mb{constructor(n,o){this.path=n,this.parameters=o}get parameterMap(){return this._parameterMap||(this._parameterMap=Ly(this.parameters)),this._parameterMap}toString(){return j$(this)}}function cv(p,n){return p.length===n.length&&p.every((o,h)=>o.path===n[h].path)}class B${}class W${parse(n){const o=new uTe(n);return new lv(o.parseRootSegment(),o.parseQueryParams(),o.parseFragment())}serialize(n){const o=`/${Ob(n.root,!0)}`,h=function rTe(p){const n=Object.keys(p).map(o=>{const h=p[o];return Array.isArray(h)?h.map(v=>`${rI(o)}=${rI(v)}`).join("&"):`${rI(o)}=${rI(h)}`}).filter(o=>!!o);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${o}${h}${"string"==typeof n.fragment?`#${function nTe(p){return encodeURI(p)}(n.fragment)}`:""}`}}const tTe=new W$;function iI(p){return p.segments.map(n=>j$(n)).join("/")}function Ob(p,n){if(!p.hasChildren())return iI(p);if(n){const o=p.children[Xi]?Ob(p.children[Xi],!1):"",h=[];return La(p.children,(v,y)=>{y!==Xi&&h.push(`${y}:${Ob(v,!1)}`)}),h.length>0?`${o}(${h.join("//")})`:o}{const o=function eTe(p,n){let o=[];return La(p.children,(h,v)=>{v===Xi&&(o=o.concat(n(h,v)))}),La(p.children,(h,v)=>{v!==Xi&&(o=o.concat(n(h,v)))}),o}(p,(h,v)=>v===Xi?[Ob(p.children[Xi],!1)]:[`${v}:${Ob(h,!1)}`]);return 1===Object.keys(p.children).length&&null!=p.children[Xi]?`${iI(p)}/${o[0]}`:`${iI(p)}/(${o.join("//")})`}}function U$(p){return encodeURIComponent(p).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function rI(p){return U$(p).replace(/%3B/gi,";")}function $M(p){return U$(p).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function oI(p){return decodeURIComponent(p)}function V$(p){return oI(p.replace(/\+/g,"%20"))}function j$(p){return`${$M(p.path)}${function iTe(p){return Object.keys(p).map(n=>`;${$M(n)}=${$M(p[n])}`).join("")}(p.parameters)}`}const oTe=/^[^\/()?;=#]+/;function sI(p){const n=p.match(oTe);return n?n[0]:""}const sTe=/^[^=?&#]+/,lTe=/^[^&#]+/;class uTe{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fr([],{}):new fr([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let o={};this.peekStartsWith("/(")&&(this.capture("/"),o=this.parseParens(!0));let h={};return this.peekStartsWith("(")&&(h=this.parseParens(!1)),(n.length>0||Object.keys(o).length>0)&&(h[Xi]=new fr(n,o)),h}parseSegment(){const n=sI(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(n),new Mb(oI(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const o=sI(this.remaining);if(!o)return;this.capture(o);let h="";if(this.consumeOptional("=")){const v=sI(this.remaining);v&&(h=v,this.capture(h))}n[oI(o)]=oI(h)}parseQueryParam(n){const o=function aTe(p){const n=p.match(sTe);return n?n[0]:""}(this.remaining);if(!o)return;this.capture(o);let h="";if(this.consumeOptional("=")){const _=function cTe(p){const n=p.match(lTe);return n?n[0]:""}(this.remaining);_&&(h=_,this.capture(h))}const v=V$(o),y=V$(h);if(n.hasOwnProperty(v)){let _=n[v];Array.isArray(_)||(_=[_],n[v]=_),_.push(y)}else n[v]=y}parseParens(n){const o={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const h=sI(this.remaining),v=this.remaining[h.length];if("/"!==v&&")"!==v&&";"!==v)throw new Error(`Cannot parse url '${this.url}'`);let y;h.indexOf(":")>-1?(y=h.substr(0,h.indexOf(":")),this.capture(y),this.capture(":")):n&&(y=Xi);const _=this.parseChildren();o[y]=1===Object.keys(_).length?_[Xi]:new fr([],_),this.consumeOptional("//")}return o}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Error(`Expected "${n}".`)}}class H${constructor(n){this._root=n}get root(){return this._root.value}parent(n){const o=this.pathFromRoot(n);return o.length>1?o[o.length-2]:null}children(n){const o=qM(n,this._root);return o?o.children.map(h=>h.value):[]}firstChild(n){const o=qM(n,this._root);return o&&o.children.length>0?o.children[0].value:null}siblings(n){const o=KM(n,this._root);return o.length<2?[]:o[o.length-2].children.map(v=>v.value).filter(v=>v!==n)}pathFromRoot(n){return KM(n,this._root).map(o=>o.value)}}function qM(p,n){if(p===n.value)return n;for(const o of n.children){const h=qM(p,o);if(h)return h}return null}function KM(p,n){if(p===n.value)return[n];for(const o of n.children){const h=KM(p,o);if(h.length)return h.unshift(n),h}return[]}class qf{constructor(n,o){this.value=n,this.children=o}toString(){return`TreeNode(${this.value})`}}function Ny(p){const n={};return p&&p.children.forEach(o=>n[o.value.outlet]=o),n}class G$ extends H${constructor(n,o){super(n),this.snapshot=o,JM(this,n)}toString(){return this.snapshot.toString()}}function z$(p,n){const o=function dTe(p,n){const _=new aI([],{},{},"",{},Xi,n,null,p.root,-1,{});return new X$("",new qf(_,[]))}(p,n),h=new Vd([new Mb("",{})]),v=new Vd({}),y=new Vd({}),_=new Vd({}),b=new Vd(""),w=new By(h,v,_,b,y,Xi,n,o.root);return w.snapshot=o.root,new G$(new qf(w,[]),o)}class By{constructor(n,o,h,v,y,_,b,w){this.url=n,this.params=o,this.queryParams=h,this.fragment=v,this.data=y,this.outlet=_,this.component=b,this._futureSnapshot=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(co(n=>Ly(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(co(n=>Ly(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Y$(p,n="emptyOnly"){const o=p.pathFromRoot;let h=0;if("always"!==n)for(h=o.length-1;h>=1;){const v=o[h],y=o[h-1];if(v.routeConfig&&""===v.routeConfig.path)h--;else{if(y.component)break;h--}}return function hTe(p){return p.reduce((n,o)=>({params:Object.assign(Object.assign({},n.params),o.params),data:Object.assign(Object.assign({},n.data),o.data),resolve:Object.assign(Object.assign({},n.resolve),o._resolvedData)}),{params:{},data:{},resolve:{}})}(o.slice(h))}class aI{constructor(n,o,h,v,y,_,b,w,I,A,M){this.url=n,this.params=o,this.queryParams=h,this.fragment=v,this.data=y,this.outlet=_,this.component=b,this.routeConfig=w,this._urlSegment=I,this._lastPathIndex=A,this._resolve=M}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ly(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ly(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(h=>h.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class X$ extends H${constructor(n,o){super(o),this.url=n,JM(this,o)}toString(){return $$(this._root)}}function JM(p,n){n.value._routerState=p,n.children.forEach(o=>JM(p,o))}function $$(p){const n=p.children.length>0?` { ${p.children.map($$).join(", ")} } `:"";return`${p.value}${n}`}function QM(p){if(p.snapshot){const n=p.snapshot,o=p._futureSnapshot;p.snapshot=o,Fh(n.queryParams,o.queryParams)||p.queryParams.next(o.queryParams),n.fragment!==o.fragment&&p.fragment.next(o.fragment),Fh(n.params,o.params)||p.params.next(o.params),function $3e(p,n){if(p.length!==n.length)return!1;for(let o=0;o<p.length;++o)if(!Fh(p[o],n[o]))return!1;return!0}(n.url,o.url)||p.url.next(o.url),Fh(n.data,o.data)||p.data.next(o.data)}else p.snapshot=p._futureSnapshot,p.data.next(p._futureSnapshot.data)}function ZM(p,n){const o=Fh(p.params,n.params)&&function Z3e(p,n){return cv(p,n)&&p.every((o,h)=>Fh(o.parameters,n[h].parameters))}(p.url,n.url);return o&&!(!p.parent!=!n.parent)&&(!p.parent||ZM(p.parent,n.parent))}function Fb(p,n,o){if(o&&p.shouldReuseRoute(n.value,o.value.snapshot)){const h=o.value;h._futureSnapshot=n.value;const v=function pTe(p,n,o){return n.children.map(h=>{for(const v of o.children)if(p.shouldReuseRoute(h.value,v.value.snapshot))return Fb(p,h,v);return Fb(p,h)})}(p,n,o);return new qf(h,v)}{if(p.shouldAttach(n.value)){const y=p.retrieve(n.value);if(null!==y){const _=y.route;return _.value._futureSnapshot=n.value,_.children=n.children.map(b=>Fb(p,b)),_}}const h=function gTe(p){return new By(new Vd(p.url),new Vd(p.params),new Vd(p.queryParams),new Vd(p.fragment),new Vd(p.data),p.outlet,p.component,p)}(n.value),v=n.children.map(y=>Fb(p,y));return new qf(h,v)}}function lI(p){return"object"==typeof p&&null!=p&&!p.outlets&&!p.segmentPath}function Lb(p){return"object"==typeof p&&null!=p&&p.outlets}function e4(p,n,o,h,v){let y={};if(h&&La(h,(b,w)=>{y[w]=Array.isArray(b)?b.map(I=>`${I}`):`${b}`}),p===n)return new lv(o,y,v);const _=q$(p,n,o);return new lv(_,y,v)}function q$(p,n,o){const h={};return La(p.children,(v,y)=>{h[y]=v===n?o:q$(v,n,o)}),new fr(p.segments,h)}class K${constructor(n,o,h){if(this.isAbsolute=n,this.numberOfDoubleDots=o,this.commands=h,n&&h.length>0&&lI(h[0]))throw new Error("Root segment cannot have matrix parameters");const v=h.find(Lb);if(v&&v!==k$(h))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class t4{constructor(n,o,h){this.segmentGroup=n,this.processChildren=o,this.index=h}}function J$(p,n,o){if(p||(p=new fr([],{})),0===p.segments.length&&p.hasChildren())return cI(p,n,o);const h=function bTe(p,n,o){let h=0,v=n;const y={match:!1,pathIndex:0,commandIndex:0};for(;v<p.segments.length;){if(h>=o.length)return y;const _=p.segments[v],b=o[h];if(Lb(b))break;const w=`${b}`,I=h<o.length-1?o[h+1]:null;if(v>0&&void 0===w)break;if(w&&I&&"object"==typeof I&&void 0===I.outlets){if(!Z$(w,I,_))return y;h+=2}else{if(!Z$(w,{},_))return y;h++}v++}return{match:!0,pathIndex:v,commandIndex:h}}(p,n,o),v=o.slice(h.commandIndex);if(h.match&&h.pathIndex<p.segments.length){const y=new fr(p.segments.slice(0,h.pathIndex),{});return y.children[Xi]=new fr(p.segments.slice(h.pathIndex),p.children),cI(y,0,v)}return h.match&&0===v.length?new fr(p.segments,{}):h.match&&!p.hasChildren()?n4(p,n,o):h.match?cI(p,0,v):n4(p,n,o)}function cI(p,n,o){if(0===o.length)return new fr(p.segments,{});{const h=function CTe(p){return Lb(p[0])?p[0].outlets:{[Xi]:p}}(o),v={};return La(h,(y,_)=>{"string"==typeof y&&(y=[y]),null!==y&&(v[_]=J$(p.children[_],n,y))}),La(p.children,(y,_)=>{void 0===h[_]&&(v[_]=y)}),new fr(p.segments,v)}}function n4(p,n,o){const h=p.segments.slice(0,n);let v=0;for(;v<o.length;){const y=o[v];if(Lb(y)){const w=xTe(y.outlets);return new fr(h,w)}if(0===v&&lI(o[0])){h.push(new Mb(p.segments[n].path,Q$(o[0]))),v++;continue}const _=Lb(y)?y.outlets[Xi]:`${y}`,b=v<o.length-1?o[v+1]:null;_&&b&&lI(b)?(h.push(new Mb(_,Q$(b))),v+=2):(h.push(new Mb(_,{})),v++)}return new fr(h,{})}function xTe(p){const n={};return La(p,(o,h)=>{"string"==typeof o&&(o=[o]),null!==o&&(n[h]=n4(new fr([],{}),0,o))}),n}function Q$(p){const n={};return La(p,(o,h)=>n[h]=`${o}`),n}function Z$(p,n,o){return p==o.path&&Fh(n,o.parameters)}class STe{constructor(n,o,h,v){this.routeReuseStrategy=n,this.futureState=o,this.currState=h,this.forwardEvent=v}activate(n){const o=this.futureState._root,h=this.currState?this.currState._root:null;this.deactivateChildRoutes(o,h,n),QM(this.futureState.root),this.activateChildRoutes(o,h,n)}deactivateChildRoutes(n,o,h){const v=Ny(o);n.children.forEach(y=>{const _=y.value.outlet;this.deactivateRoutes(y,v[_],h),delete v[_]}),La(v,(y,_)=>{this.deactivateRouteAndItsChildren(y,h)})}deactivateRoutes(n,o,h){const v=n.value,y=o?o.value:null;if(v===y)if(v.component){const _=h.getContext(v.outlet);_&&this.deactivateChildRoutes(n,o,_.children)}else this.deactivateChildRoutes(n,o,h);else y&&this.deactivateRouteAndItsChildren(o,h)}deactivateRouteAndItsChildren(n,o){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,o):this.deactivateRouteAndOutlet(n,o)}detachAndStoreRouteSubtree(n,o){const h=o.getContext(n.value.outlet),v=h&&n.value.component?h.children:o,y=Ny(n);for(const _ of Object.keys(y))this.deactivateRouteAndItsChildren(y[_],v);if(h&&h.outlet){const _=h.outlet.detach(),b=h.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:_,route:n,contexts:b})}}deactivateRouteAndOutlet(n,o){const h=o.getContext(n.value.outlet),v=h&&n.value.component?h.children:o,y=Ny(n);for(const _ of Object.keys(y))this.deactivateRouteAndItsChildren(y[_],v);h&&h.outlet&&(h.outlet.deactivate(),h.children.onOutletDeactivated(),h.attachRef=null,h.resolver=null,h.route=null)}activateChildRoutes(n,o,h){const v=Ny(o);n.children.forEach(y=>{this.activateRoutes(y,v[y.value.outlet],h),this.forwardEvent(new G3e(y.value.snapshot))}),n.children.length&&this.forwardEvent(new j3e(n.value.snapshot))}activateRoutes(n,o,h){const v=n.value,y=o?o.value:null;if(QM(v),v===y)if(v.component){const _=h.getOrCreateContext(v.outlet);this.activateChildRoutes(n,o,_.children)}else this.activateChildRoutes(n,o,h);else if(v.component){const _=h.getOrCreateContext(v.outlet);if(this.routeReuseStrategy.shouldAttach(v.snapshot)){const b=this.routeReuseStrategy.retrieve(v.snapshot);this.routeReuseStrategy.store(v.snapshot,null),_.children.onOutletReAttached(b.contexts),_.attachRef=b.componentRef,_.route=b.route.value,_.outlet&&_.outlet.attach(b.componentRef,b.route.value),QM(b.route.value),this.activateChildRoutes(n,null,_.children)}else{const b=function TTe(p){for(let n=p.parent;n;n=n.parent){const o=n.routeConfig;if(o&&o._loadedConfig)return o._loadedConfig;if(o&&o.component)return null}return null}(v.snapshot),w=b?b.module.componentFactoryResolver:null;_.attachRef=null,_.route=v,_.resolver=w,_.outlet&&_.outlet.activateWith(v,w),this.activateChildRoutes(n,null,_.children)}}else this.activateChildRoutes(n,null,h)}}class i4{constructor(n,o){this.routes=n,this.module=o}}function wg(p){return"function"==typeof p}function uv(p){return p instanceof lv}const Nb=Symbol("INITIAL_VALUE");function Bb(){return av(p=>function I3e(...p){const n=kC(p),o=KU(p),{args:h,keys:v}=uX(p);if(0===h.length)return ka([],n);const y=new Ls(function E3e(p,n,o=Ym){return h=>{_$(n,()=>{const{length:v}=p,y=new Array(v);let _=v,b=v;for(let w=0;w<v;w++)_$(n,()=>{const I=ka(p[w],n);let A=!1;I.subscribe(_a(h,M=>{y[w]=M,A||(A=!0,b--),b||h.next(o(y.slice()))},()=>{--_||h.complete()}))},h)},h)}}(h,n,v?_=>hX(v,_):Ym));return o?y.pipe(dX(o)):y}(p.map(n=>n.pipe(GM(1),function P3e(...p){const n=kC(p);return Ra((o,h)=>{(n?HM(p,o,n):HM(p,o)).subscribe(h)})}(Nb)))).pipe(x$((n,o)=>{let h=!1;return o.reduce((v,y,_)=>v!==Nb?v:(y===Nb&&(h=!0),h||!1!==y&&_!==o.length-1&&!uv(y)?v:y),n)},Nb),Oy(n=>n!==Nb),co(n=>uv(n)?n:!0===n),GM(1)))}class RTe{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Wb,this.attachRef=null}}class Wb{constructor(){this.contexts=new Map}onChildOutletCreated(n,o){const h=this.getOrCreateContext(n);h.outlet=o,this.contexts.set(n,h)}onChildOutletDestroyed(n){const o=this.getContext(n);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let o=this.getContext(n);return o||(o=new RTe,this.contexts.set(n,o)),o}getContext(n){return this.contexts.get(n)||null}}let r4=(()=>{class p{constructor(o,h,v,y,_){this.parentContexts=o,this.location=h,this.resolver=v,this.changeDetector=_,this.activated=null,this._activatedRoute=null,this.activateEvents=new ds,this.deactivateEvents=new ds,this.attachEvents=new ds,this.detachEvents=new ds,this.name=y||Xi,o.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const o=this.parentContexts.getContext(this.name);o&&o.route&&(o.attachRef?this.attach(o.attachRef,o.route):this.activateWith(o.route,o.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const o=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(o.instance),o}attach(o,h){this.activated=o,this._activatedRoute=h,this.location.insert(o.hostView),this.attachEvents.emit(o.instance)}deactivate(){if(this.activated){const o=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(o)}}activateWith(o,h){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=o;const _=(h=h||this.resolver).resolveComponentFactory(o._futureSnapshot.routeConfig.component),b=this.parentContexts.getOrCreateContext(this.name).children,w=new kTe(o,b,this.location.injector);this.activated=this.location.createComponent(_,this.location.length,w),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return p.\u0275fac=function(o){return new(o||p)(Jt(Wb),Jt(Bd),Jt(gb),function jC(p){return function jme(p,n){if("class"===n)return p.classes;if("style"===n)return p.styles;const o=p.attrs;if(o){const h=o.length;let v=0;for(;v<h;){const y=o[v];if(AV(y))break;if(0===y)v+=2;else if("number"==typeof y)for(v++;v<h&&"string"==typeof o[v];)v++;else{if(y===n)return o[v+1];v+=2}}}return null}(ra(),p)}("name"),Jt(TT))},p.\u0275dir=ii({type:p,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),p})();class kTe{constructor(n,o,h){this.route=n,this.childContexts=o,this.parent=h}get(n,o){return n===By?this.route:n===Wb?this.childContexts:this.parent.get(n,o)}}let eq=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["ng-component"]],decls:1,vars:0,template:function(o,h){1&o&&hr(0,"router-outlet")},directives:[r4],encapsulation:2}),p})();function tq(p,n=""){for(let o=0;o<p.length;o++){const h=p[o];MTe(h,OTe(n,h))}}function MTe(p,n){p.children&&tq(p.children,n)}function OTe(p,n){return n?p||n.path?p&&!n.path?`${p}/`:!p&&n.path?n.path:`${p}/${n.path}`:"":p}function o4(p){const n=p.children&&p.children.map(o4),o=n?Object.assign(Object.assign({},p),{children:n}):Object.assign({},p);return!o.component&&(n||o.loadChildren)&&o.outlet&&o.outlet!==Xi&&(o.component=eq),o}function Fu(p){return p.outlet||Xi}function nq(p,n){const o=p.filter(h=>Fu(h)===n);return o.push(...p.filter(h=>Fu(h)!==n)),o}const iq={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function uI(p,n,o){var h;if(""===n.path)return"full"===n.pathMatch&&(p.hasChildren()||o.length>0)?Object.assign({},iq):{matched:!0,consumedSegments:[],remainingSegments:o,parameters:{},positionalParamSegments:{}};const y=(n.matcher||X3e)(o,p,n);if(!y)return Object.assign({},iq);const _={};La(y.posParams,(w,I)=>{_[I]=w.path});const b=y.consumed.length>0?Object.assign(Object.assign({},_),y.consumed[y.consumed.length-1].parameters):_;return{matched:!0,consumedSegments:y.consumed,remainingSegments:o.slice(y.consumed.length),parameters:b,positionalParamSegments:null!==(h=y.posParams)&&void 0!==h?h:{}}}function dI(p,n,o,h,v="corrected"){if(o.length>0&&function NTe(p,n,o){return o.some(h=>hI(p,n,h)&&Fu(h)!==Xi)}(p,o,h)){const _=new fr(n,function LTe(p,n,o,h){const v={};v[Xi]=h,h._sourceSegment=p,h._segmentIndexShift=n.length;for(const y of o)if(""===y.path&&Fu(y)!==Xi){const _=new fr([],{});_._sourceSegment=p,_._segmentIndexShift=n.length,v[Fu(y)]=_}return v}(p,n,h,new fr(o,p.children)));return _._sourceSegment=p,_._segmentIndexShift=n.length,{segmentGroup:_,slicedSegments:[]}}if(0===o.length&&function BTe(p,n,o){return o.some(h=>hI(p,n,h))}(p,o,h)){const _=new fr(p.segments,function FTe(p,n,o,h,v,y){const _={};for(const b of h)if(hI(p,o,b)&&!v[Fu(b)]){const w=new fr([],{});w._sourceSegment=p,w._segmentIndexShift="legacy"===y?p.segments.length:n.length,_[Fu(b)]=w}return Object.assign(Object.assign({},v),_)}(p,n,o,h,p.children,v));return _._sourceSegment=p,_._segmentIndexShift=n.length,{segmentGroup:_,slicedSegments:o}}const y=new fr(p.segments,p.children);return y._sourceSegment=p,y._segmentIndexShift=n.length,{segmentGroup:y,slicedSegments:o}}function hI(p,n,o){return(!(p.hasChildren()||n.length>0)||"full"!==o.pathMatch)&&""===o.path}function rq(p,n,o,h){return!!(Fu(p)===h||h!==Xi&&hI(n,o,p))&&("**"===p.path||uI(n,p,o).matched)}function oq(p,n,o){return 0===n.length&&!p.children[o]}class fI{constructor(n){this.segmentGroup=n||null}}class sq{constructor(n){this.urlTree=n}}function Ub(p){return eI(new fI(p))}function aq(p){return eI(new sq(p))}class jTe{constructor(n,o,h,v,y){this.configLoader=o,this.urlSerializer=h,this.urlTree=v,this.config=y,this.allowRedirects=!0,this.ngModule=n.get(Gf)}apply(){const n=dI(this.urlTree.root,[],[],this.config).segmentGroup,o=new fr(n.segments,n.children);return this.expandSegmentGroup(this.ngModule,this.config,o,Xi).pipe(co(y=>this.createUrlTree(s4(y),this.urlTree.queryParams,this.urlTree.fragment))).pipe(xg(y=>{if(y instanceof sq)return this.allowRedirects=!1,this.match(y.urlTree);throw y instanceof fI?this.noMatchError(y):y}))}match(n){return this.expandSegmentGroup(this.ngModule,this.config,n.root,Xi).pipe(co(v=>this.createUrlTree(s4(v),n.queryParams,n.fragment))).pipe(xg(v=>{throw v instanceof fI?this.noMatchError(v):v}))}noMatchError(n){return new Error(`Cannot match any routes. URL Segment: '${n.segmentGroup}'`)}createUrlTree(n,o,h){const v=n.segments.length>0?new fr([],{[Xi]:n}):n;return new lv(v,o,h)}expandSegmentGroup(n,o,h,v){return 0===h.segments.length&&h.hasChildren()?this.expandChildren(n,o,h).pipe(co(y=>new fr([],y))):this.expandSegment(n,h,o,h.segments,v,!0)}expandChildren(n,o,h){const v=[];for(const y of Object.keys(h.children))"primary"===y?v.unshift(y):v.push(y);return ka(v).pipe(Rb(y=>{const _=h.children[y],b=nq(o,y);return this.expandSegmentGroup(n,b,_,y).pipe(co(w=>({segment:w,outlet:y})))}),x$((y,_)=>(y[_.outlet]=_.segment,y),{}),function M3e(p,n){const o=arguments.length>=2;return h=>h.pipe(p?Oy((v,y)=>p(v,y,h)):Ym,zM(1),o?S$(n):w$(()=>new tI))}())}expandSegment(n,o,h,v,y,_){return ka(h).pipe(Rb(b=>this.expandSegmentAgainstRoute(n,o,h,b,v,y,_).pipe(xg(I=>{if(I instanceof fI)return Ni(null);throw I}))),Fy(b=>!!b),xg((b,w)=>{if(b instanceof tI||"EmptyError"===b.name)return oq(o,v,y)?Ni(new fr([],{})):Ub(o);throw b}))}expandSegmentAgainstRoute(n,o,h,v,y,_,b){return rq(v,o,y,_)?void 0===v.redirectTo?this.matchSegmentAgainstRoute(n,o,v,y,_):b&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,o,h,v,y,_):Ub(o):Ub(o)}expandSegmentAgainstRouteUsingRedirect(n,o,h,v,y,_){return"**"===v.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,h,v,_):this.expandRegularSegmentAgainstRouteUsingRedirect(n,o,h,v,y,_)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,o,h,v){const y=this.applyRedirectCommands([],h.redirectTo,{});return h.redirectTo.startsWith("/")?aq(y):this.lineralizeSegments(h,y).pipe(Ca(_=>{const b=new fr(_,{});return this.expandSegment(n,b,o,_,v,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,o,h,v,y,_){const{matched:b,consumedSegments:w,remainingSegments:I,positionalParamSegments:A}=uI(o,v,y);if(!b)return Ub(o);const M=this.applyRedirectCommands(w,v.redirectTo,A);return v.redirectTo.startsWith("/")?aq(M):this.lineralizeSegments(v,M).pipe(Ca(F=>this.expandSegment(n,o,h,F.concat(I),_,!1)))}matchSegmentAgainstRoute(n,o,h,v,y){if("**"===h.path)return h.loadChildren?(h._loadedConfig?Ni(h._loadedConfig):this.configLoader.load(n.injector,h)).pipe(co(M=>(h._loadedConfig=M,new fr(v,{})))):Ni(new fr(v,{}));const{matched:_,consumedSegments:b,remainingSegments:w}=uI(o,h,v);return _?this.getChildConfig(n,h,v).pipe(Ca(A=>{const M=A.module,F=A.routes,{segmentGroup:V,slicedSegments:B}=dI(o,b,w,F),Q=new fr(V.segments,V.children);if(0===B.length&&Q.hasChildren())return this.expandChildren(M,F,Q).pipe(co(se=>new fr(b,se)));if(0===F.length&&0===B.length)return Ni(new fr(b,{}));const J=Fu(h)===y;return this.expandSegment(M,Q,F,B,J?Xi:y,!0).pipe(co(re=>new fr(b.concat(re.segments),re.children)))})):Ub(o)}getChildConfig(n,o,h){return o.children?Ni(new i4(o.children,n)):o.loadChildren?void 0!==o._loadedConfig?Ni(o._loadedConfig):this.runCanLoadGuards(n.injector,o,h).pipe(Ca(v=>v?this.configLoader.load(n.injector,o).pipe(co(y=>(o._loadedConfig=y,y))):function UTe(p){return eI(XM(`Cannot load children because the guard of the route "path: '${p.path}'" returned false`))}(o))):Ni(new i4([],n))}runCanLoadGuards(n,o,h){const v=o.canLoad;return v&&0!==v.length?Ni(v.map(_=>{const b=n.get(_);let w;if(function ETe(p){return p&&wg(p.canLoad)}(b))w=b.canLoad(o,h);else{if(!wg(b))throw new Error("Invalid CanLoad guard");w=b(o,h)}return Lh(w)})).pipe(Bb(),Nc(_=>{if(!uv(_))return;const b=XM(`Redirecting to "${this.urlSerializer.serialize(_)}"`);throw b.url=_,b}),co(_=>!0===_)):Ni(!0)}lineralizeSegments(n,o){let h=[],v=o.root;for(;;){if(h=h.concat(v.segments),0===v.numberOfChildren)return Ni(h);if(v.numberOfChildren>1||!v.children[Xi])return eI(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n.redirectTo}'`));v=v.children[Xi]}}applyRedirectCommands(n,o,h){return this.applyRedirectCreatreUrlTree(o,this.urlSerializer.parse(o),n,h)}applyRedirectCreatreUrlTree(n,o,h,v){const y=this.createSegmentGroup(n,o.root,h,v);return new lv(y,this.createQueryParams(o.queryParams,this.urlTree.queryParams),o.fragment)}createQueryParams(n,o){const h={};return La(n,(v,y)=>{if("string"==typeof v&&v.startsWith(":")){const b=v.substring(1);h[y]=o[b]}else h[y]=v}),h}createSegmentGroup(n,o,h,v){const y=this.createSegments(n,o.segments,h,v);let _={};return La(o.children,(b,w)=>{_[w]=this.createSegmentGroup(n,b,h,v)}),new fr(y,_)}createSegments(n,o,h,v){return o.map(y=>y.path.startsWith(":")?this.findPosParam(n,y,v):this.findOrReturn(y,h))}findPosParam(n,o,h){const v=h[o.path.substring(1)];if(!v)throw new Error(`Cannot redirect to '${n}'. Cannot find '${o.path}'.`);return v}findOrReturn(n,o){let h=0;for(const v of o){if(v.path===n.path)return o.splice(h),v;h++}return n}}function s4(p){const n={};for(const h of Object.keys(p.children)){const y=s4(p.children[h]);(y.segments.length>0||y.hasChildren())&&(n[h]=y)}return function HTe(p){if(1===p.numberOfChildren&&p.children[Xi]){const n=p.children[Xi];return new fr(p.segments.concat(n.segments),n.children)}return p}(new fr(p.segments,n))}class lq{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class pI{constructor(n,o){this.component=n,this.route=o}}function zTe(p,n,o){const h=p._root;return Vb(h,n?n._root:null,o,[h.value])}function gI(p,n,o){const h=function XTe(p){if(!p)return null;for(let n=p.parent;n;n=n.parent){const o=n.routeConfig;if(o&&o._loadedConfig)return o._loadedConfig}return null}(n);return(h?h.module.injector:o).get(p)}function Vb(p,n,o,h,v={canDeactivateChecks:[],canActivateChecks:[]}){const y=Ny(n);return p.children.forEach(_=>{(function $Te(p,n,o,h,v={canDeactivateChecks:[],canActivateChecks:[]}){const y=p.value,_=n?n.value:null,b=o?o.getContext(p.value.outlet):null;if(_&&y.routeConfig===_.routeConfig){const w=function qTe(p,n,o){if("function"==typeof o)return o(p,n);switch(o){case"pathParamsChange":return!cv(p.url,n.url);case"pathParamsOrQueryParamsChange":return!cv(p.url,n.url)||!Fh(p.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ZM(p,n)||!Fh(p.queryParams,n.queryParams);default:return!ZM(p,n)}}(_,y,y.routeConfig.runGuardsAndResolvers);w?v.canActivateChecks.push(new lq(h)):(y.data=_.data,y._resolvedData=_._resolvedData),Vb(p,n,y.component?b?b.children:null:o,h,v),w&&b&&b.outlet&&b.outlet.isActivated&&v.canDeactivateChecks.push(new pI(b.outlet.component,_))}else _&&jb(n,b,v),v.canActivateChecks.push(new lq(h)),Vb(p,null,y.component?b?b.children:null:o,h,v)})(_,y[_.value.outlet],o,h.concat([_.value]),v),delete y[_.value.outlet]}),La(y,(_,b)=>jb(_,o.getContext(b),v)),v}function jb(p,n,o){const h=Ny(p),v=p.value;La(h,(y,_)=>{jb(y,v.component?n?n.children.getContext(_):null:n,o)}),o.canDeactivateChecks.push(new pI(v.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,v))}class rIe{}function cq(p){return new Ls(n=>n.error(p))}class sIe{constructor(n,o,h,v,y,_){this.rootComponentType=n,this.config=o,this.urlTree=h,this.url=v,this.paramsInheritanceStrategy=y,this.relativeLinkResolution=_}recognize(){const n=dI(this.urlTree.root,[],[],this.config.filter(_=>void 0===_.redirectTo),this.relativeLinkResolution).segmentGroup,o=this.processSegmentGroup(this.config,n,Xi);if(null===o)return null;const h=new aI([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Xi,this.rootComponentType,null,this.urlTree.root,-1,{}),v=new qf(h,o),y=new X$(this.url,v);return this.inheritParamsAndData(y._root),y}inheritParamsAndData(n){const o=n.value,h=Y$(o,this.paramsInheritanceStrategy);o.params=Object.freeze(h.params),o.data=Object.freeze(h.data),n.children.forEach(v=>this.inheritParamsAndData(v))}processSegmentGroup(n,o,h){return 0===o.segments.length&&o.hasChildren()?this.processChildren(n,o):this.processSegment(n,o,o.segments,h)}processChildren(n,o){const h=[];for(const y of Object.keys(o.children)){const _=o.children[y],b=nq(n,y),w=this.processSegmentGroup(b,_,y);if(null===w)return null;h.push(...w)}const v=uq(h);return function aIe(p){p.sort((n,o)=>n.value.outlet===Xi?-1:o.value.outlet===Xi?1:n.value.outlet.localeCompare(o.value.outlet))}(v),v}processSegment(n,o,h,v){for(const y of n){const _=this.processSegmentAgainstRoute(y,o,h,v);if(null!==_)return _}return oq(o,h,v)?[]:null}processSegmentAgainstRoute(n,o,h,v){if(n.redirectTo||!rq(n,o,h,v))return null;let y,_=[],b=[];if("**"===n.path){const V=h.length>0?k$(h).parameters:{};y=new aI(h,V,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,fq(n),Fu(n),n.component,n,dq(o),hq(o)+h.length,pq(n))}else{const V=uI(o,n,h);if(!V.matched)return null;_=V.consumedSegments,b=V.remainingSegments,y=new aI(_,V.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,fq(n),Fu(n),n.component,n,dq(o),hq(o)+_.length,pq(n))}const w=function lIe(p){return p.children?p.children:p.loadChildren?p._loadedConfig.routes:[]}(n),{segmentGroup:I,slicedSegments:A}=dI(o,_,b,w.filter(V=>void 0===V.redirectTo),this.relativeLinkResolution);if(0===A.length&&I.hasChildren()){const V=this.processChildren(w,I);return null===V?null:[new qf(y,V)]}if(0===w.length&&0===A.length)return[new qf(y,[])];const M=Fu(n)===v,F=this.processSegment(w,I,A,M?Xi:v);return null===F?null:[new qf(y,F)]}}function cIe(p){const n=p.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function uq(p){const n=[],o=new Set;for(const h of p){if(!cIe(h)){n.push(h);continue}const v=n.find(y=>h.value.routeConfig===y.value.routeConfig);void 0!==v?(v.children.push(...h.children),o.add(v)):n.push(h)}for(const h of o){const v=uq(h.children);n.push(new qf(h.value,v))}return n.filter(h=>!o.has(h))}function dq(p){let n=p;for(;n._sourceSegment;)n=n._sourceSegment;return n}function hq(p){let n=p,o=n._segmentIndexShift?n._segmentIndexShift:0;for(;n._sourceSegment;)n=n._sourceSegment,o+=n._segmentIndexShift?n._segmentIndexShift:0;return o-1}function fq(p){return p.data||{}}function pq(p){return p.resolve||{}}function gq(p){return[...Object.keys(p),...Object.getOwnPropertySymbols(p)]}function a4(p){return av(n=>{const o=p(n);return o?ka(o).pipe(co(()=>n)):Ni(n)})}class vIe extends class mIe{shouldDetach(n){return!1}store(n,o){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,o){return n.routeConfig===o.routeConfig}}{}const l4=new Yi("ROUTES");class mq{constructor(n,o,h,v){this.injector=n,this.compiler=o,this.onLoadStartListener=h,this.onLoadEndListener=v}load(n,o){if(o._loader$)return o._loader$;this.onLoadStartListener&&this.onLoadStartListener(o);const v=this.loadModuleFactory(o.loadChildren).pipe(co(y=>{this.onLoadEndListener&&this.onLoadEndListener(o);const _=y.create(n);return new i4(R$(_.injector.get(l4,void 0,si.Self|si.Optional)).map(o4),_)}),xg(y=>{throw o._loader$=void 0,y}));return o._loader$=new A3e(v,()=>new Of).pipe(b$()),o._loader$}loadModuleFactory(n){return Lh(n()).pipe(Ca(o=>o instanceof Dz?Ni(o):ka(this.compiler.compileModuleAsync(o))))}}class _Ie{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,o){return n}}function CIe(p){throw p}function bIe(p,n,o){return n.parse("/")}function vq(p,n){return Ni(null)}const xIe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},wIe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Bc=(()=>{class p{constructor(o,h,v,y,_,b,w){this.rootComponentType=o,this.urlSerializer=h,this.rootContexts=v,this.location=y,this.config=w,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Of,this.errorHandler=CIe,this.malformedUriErrorHandler=bIe,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:vq,afterPreactivation:vq},this.urlHandlingStrategy=new _Ie,this.routeReuseStrategy=new vIe,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=_.get(Gf),this.console=_.get(Sbe);const M=_.get(Fa);this.isNgZoneEnabled=M instanceof Fa&&Fa.isInAngularZone(),this.resetConfig(w),this.currentUrlTree=function q3e(){return new lv(new fr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new mq(_,b,F=>this.triggerEvent(new I$(F)),F=>this.triggerEvent(new E$(F))),this.routerState=z$(this.currentUrlTree,this.rootComponentType),this.transitions=new Vd({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var o;return null===(o=this.location.getState())||void 0===o?void 0:o.\u0275routerPageId}setupNavigations(o){const h=this.events;return o.pipe(Oy(v=>0!==v.id),co(v=>Object.assign(Object.assign({},v),{extractedUrl:this.urlHandlingStrategy.extract(v.rawUrl)})),av(v=>{let y=!1,_=!1;return Ni(v).pipe(Nc(b=>{this.currentNavigation={id:b.id,initialUrl:b.currentRawUrl,extractedUrl:b.extractedUrl,trigger:b.source,extras:b.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),av(b=>{const w=this.browserUrlTree.toString(),I=!this.navigated||b.extractedUrl.toString()!==w||w!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||I)&&this.urlHandlingStrategy.shouldProcessUrl(b.rawUrl))return yq(b.source)&&(this.browserUrlTree=b.extractedUrl),Ni(b).pipe(av(M=>{const F=this.transitions.getValue();return h.next(new YM(M.id,this.serializeUrl(M.extractedUrl),M.source,M.restoredState)),F!==this.transitions.getValue()?Lf:Promise.resolve(M)}),function GTe(p,n,o,h){return av(v=>function VTe(p,n,o,h,v){return new jTe(p,n,o,h,v).apply()}(p,n,o,v.extractedUrl,h).pipe(co(y=>Object.assign(Object.assign({},v),{urlAfterRedirects:y}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Nc(M=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:M.urlAfterRedirects})}),function uIe(p,n,o,h,v){return Ca(y=>function oIe(p,n,o,h,v="emptyOnly",y="legacy"){try{const _=new sIe(p,n,o,h,v,y).recognize();return null===_?cq(new rIe):Ni(_)}catch(_){return cq(_)}}(p,n,y.urlAfterRedirects,o(y.urlAfterRedirects),h,v).pipe(co(_=>Object.assign(Object.assign({},y),{targetSnapshot:_}))))}(this.rootComponentType,this.config,M=>this.serializeUrl(M),this.paramsInheritanceStrategy,this.relativeLinkResolution),Nc(M=>{if("eager"===this.urlUpdateStrategy){if(!M.extras.skipLocationChange){const V=this.urlHandlingStrategy.merge(M.urlAfterRedirects,M.rawUrl);this.setBrowserUrl(V,M)}this.browserUrlTree=M.urlAfterRedirects}const F=new L3e(M.id,this.serializeUrl(M.extractedUrl),this.serializeUrl(M.urlAfterRedirects),M.targetSnapshot);h.next(F)}));if(I&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:F,extractedUrl:V,source:B,restoredState:Q,extras:J}=b,Z=new YM(F,this.serializeUrl(V),B,Q);h.next(Z);const re=z$(V,this.rootComponentType).snapshot;return Ni(Object.assign(Object.assign({},b),{targetSnapshot:re,urlAfterRedirects:V,extras:Object.assign(Object.assign({},J),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=b.rawUrl,b.resolve(null),Lf}),a4(b=>{const{targetSnapshot:w,id:I,extractedUrl:A,rawUrl:M,extras:{skipLocationChange:F,replaceUrl:V}}=b;return this.hooks.beforePreactivation(w,{navigationId:I,appliedUrlTree:A,rawUrlTree:M,skipLocationChange:!!F,replaceUrl:!!V})}),Nc(b=>{const w=new N3e(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(w)}),co(b=>Object.assign(Object.assign({},b),{guards:zTe(b.targetSnapshot,b.currentSnapshot,this.rootContexts)})),function KTe(p,n){return Ca(o=>{const{targetSnapshot:h,currentSnapshot:v,guards:{canActivateChecks:y,canDeactivateChecks:_}}=o;return 0===_.length&&0===y.length?Ni(Object.assign(Object.assign({},o),{guardsResult:!0})):function JTe(p,n,o,h){return ka(p).pipe(Ca(v=>function iIe(p,n,o,h,v){const y=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return y&&0!==y.length?Ni(y.map(b=>{const w=gI(b,n,v);let I;if(function PTe(p){return p&&wg(p.canDeactivate)}(w))I=Lh(w.canDeactivate(p,n,o,h));else{if(!wg(w))throw new Error("Invalid CanDeactivate guard");I=Lh(w(p,n,o,h))}return I.pipe(Fy())})).pipe(Bb()):Ni(!0)}(v.component,v.route,o,n,h)),Fy(v=>!0!==v,!0))}(_,h,v,p).pipe(Ca(b=>b&&function ITe(p){return"boolean"==typeof p}(b)?function QTe(p,n,o,h){return ka(n).pipe(Rb(v=>HM(function eIe(p,n){return null!==p&&n&&n(new V3e(p)),Ni(!0)}(v.route.parent,h),function ZTe(p,n){return null!==p&&n&&n(new H3e(p)),Ni(!0)}(v.route,h),function nIe(p,n,o){const h=n[n.length-1],y=n.slice(0,n.length-1).reverse().map(_=>function YTe(p){const n=p.routeConfig?p.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:p,guards:n}:null}(_)).filter(_=>null!==_).map(_=>C$(()=>Ni(_.guards.map(w=>{const I=gI(w,_.node,o);let A;if(function ATe(p){return p&&wg(p.canActivateChild)}(I))A=Lh(I.canActivateChild(h,p));else{if(!wg(I))throw new Error("Invalid CanActivateChild guard");A=Lh(I(h,p))}return A.pipe(Fy())})).pipe(Bb())));return Ni(y).pipe(Bb())}(p,v.path,o),function tIe(p,n,o){const h=n.routeConfig?n.routeConfig.canActivate:null;if(!h||0===h.length)return Ni(!0);const v=h.map(y=>C$(()=>{const _=gI(y,n,o);let b;if(function DTe(p){return p&&wg(p.canActivate)}(_))b=Lh(_.canActivate(n,p));else{if(!wg(_))throw new Error("Invalid CanActivate guard");b=Lh(_(n,p))}return b.pipe(Fy())}));return Ni(v).pipe(Bb())}(p,v.route,o))),Fy(v=>!0!==v,!0))}(h,y,p,n):Ni(b)),co(b=>Object.assign(Object.assign({},o),{guardsResult:b})))})}(this.ngModule.injector,b=>this.triggerEvent(b)),Nc(b=>{if(uv(b.guardsResult)){const I=XM(`Redirecting to "${this.serializeUrl(b.guardsResult)}"`);throw I.url=b.guardsResult,I}const w=new B3e(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot,!!b.guardsResult);this.triggerEvent(w)}),Oy(b=>!!b.guardsResult||(this.restoreHistory(b),this.cancelNavigationTransition(b,""),!1)),a4(b=>{if(b.guards.canActivateChecks.length)return Ni(b).pipe(Nc(w=>{const I=new W3e(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}),av(w=>{let I=!1;return Ni(w).pipe(function dIe(p,n){return Ca(o=>{const{targetSnapshot:h,guards:{canActivateChecks:v}}=o;if(!v.length)return Ni(o);let y=0;return ka(v).pipe(Rb(_=>function hIe(p,n,o,h){return function fIe(p,n,o,h){const v=gq(p);if(0===v.length)return Ni({});const y={};return ka(v).pipe(Ca(_=>function pIe(p,n,o,h){const v=gI(p,n,h);return Lh(v.resolve?v.resolve(n,o):v(n,o))}(p[_],n,o,h).pipe(Nc(b=>{y[_]=b}))),zM(1),Ca(()=>gq(y).length===v.length?Ni(y):Lf))}(p._resolve,p,n,h).pipe(co(y=>(p._resolvedData=y,p.data=Object.assign(Object.assign({},p.data),Y$(p,o).resolve),null)))}(_.route,h,p,n)),Nc(()=>y++),zM(1),Ca(_=>y===v.length?Ni(o):Lf))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Nc({next:()=>I=!0,complete:()=>{I||(this.restoreHistory(w),this.cancelNavigationTransition(w,"At least one route resolver didn't emit any value."))}}))}),Nc(w=>{const I=new U3e(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}))}),a4(b=>{const{targetSnapshot:w,id:I,extractedUrl:A,rawUrl:M,extras:{skipLocationChange:F,replaceUrl:V}}=b;return this.hooks.afterPreactivation(w,{navigationId:I,appliedUrlTree:A,rawUrlTree:M,skipLocationChange:!!F,replaceUrl:!!V})}),co(b=>{const w=function fTe(p,n,o){const h=Fb(p,n._root,o?o._root:void 0);return new G$(h,n)}(this.routeReuseStrategy,b.targetSnapshot,b.currentRouterState);return Object.assign(Object.assign({},b),{targetRouterState:w})}),Nc(b=>{this.currentUrlTree=b.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(b.urlAfterRedirects,b.rawUrl),this.routerState=b.targetRouterState,"deferred"===this.urlUpdateStrategy&&(b.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,b),this.browserUrlTree=b.urlAfterRedirects)}),((p,n,o)=>co(h=>(new STe(n,h.targetRouterState,h.currentRouterState,o).activate(p),h)))(this.rootContexts,this.routeReuseStrategy,b=>this.triggerEvent(b)),Nc({next(){y=!0},complete(){y=!0}}),function O3e(p){return Ra((n,o)=>{try{n.subscribe(o)}finally{o.add(p)}})}(()=>{var b;y||_||this.cancelNavigationTransition(v,`Navigation ID ${v.id} is not equal to the current navigation id ${this.navigationId}`),(null===(b=this.currentNavigation)||void 0===b?void 0:b.id)===v.id&&(this.currentNavigation=null)}),xg(b=>{if(_=!0,function Y3e(p){return p&&p[A$]}(b)){const w=uv(b.url);w||(this.navigated=!0,this.restoreHistory(v,!0));const I=new T$(v.id,this.serializeUrl(v.extractedUrl),b.message);h.next(I),w?setTimeout(()=>{const A=this.urlHandlingStrategy.merge(b.url,this.rawUrlTree),M={skipLocationChange:v.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||yq(v.source)};this.scheduleNavigation(A,"imperative",null,M,{resolve:v.resolve,reject:v.reject,promise:v.promise})},0):v.resolve(!1)}else{this.restoreHistory(v,!0);const w=new F3e(v.id,this.serializeUrl(v.extractedUrl),b);h.next(w);try{v.resolve(this.errorHandler(b))}catch(I){v.reject(I)}}return Lf}))}))}resetRootComponentType(o){this.rootComponentType=o,this.routerState.root.component=this.rootComponentType}setTransition(o){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),o))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(o=>{const h="popstate"===o.type?"popstate":"hashchange";"popstate"===h&&setTimeout(()=>{var v;const y={replaceUrl:!0},_=(null===(v=o.state)||void 0===v?void 0:v.navigationId)?o.state:null;if(_){const w=Object.assign({},_);delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(y.state=w)}const b=this.parseUrl(o.url);this.scheduleNavigation(b,h,_,y)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(o){this.events.next(o)}resetConfig(o){tq(o),this.config=o.map(o4),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(o,h={}){const{relativeTo:v,queryParams:y,fragment:_,queryParamsHandling:b,preserveFragment:w}=h,I=v||this.routerState.root,A=w?this.currentUrlTree.fragment:_;let M=null;switch(b){case"merge":M=Object.assign(Object.assign({},this.currentUrlTree.queryParams),y);break;case"preserve":M=this.currentUrlTree.queryParams;break;default:M=y||null}return null!==M&&(M=this.removeEmptyProps(M)),function mTe(p,n,o,h,v){if(0===o.length)return e4(n.root,n.root,n.root,h,v);const y=function vTe(p){if("string"==typeof p[0]&&1===p.length&&"/"===p[0])return new K$(!0,0,p);let n=0,o=!1;const h=p.reduce((v,y,_)=>{if("object"==typeof y&&null!=y){if(y.outlets){const b={};return La(y.outlets,(w,I)=>{b[I]="string"==typeof w?w.split("/"):w}),[...v,{outlets:b}]}if(y.segmentPath)return[...v,y.segmentPath]}return"string"!=typeof y?[...v,y]:0===_?(y.split("/").forEach((b,w)=>{0==w&&"."===b||(0==w&&""===b?o=!0:".."===b?n++:""!=b&&v.push(b))}),v):[...v,y]},[]);return new K$(o,n,h)}(o);if(y.toRoot())return e4(n.root,n.root,new fr([],{}),h,v);const _=function yTe(p,n,o){if(p.isAbsolute)return new t4(n.root,!0,0);if(-1===o.snapshot._lastPathIndex){const y=o.snapshot._urlSegment;return new t4(y,y===n.root,0)}const h=lI(p.commands[0])?0:1;return function _Te(p,n,o){let h=p,v=n,y=o;for(;y>v;){if(y-=v,h=h.parent,!h)throw new Error("Invalid number of '../'");v=h.segments.length}return new t4(h,!1,v-y)}(o.snapshot._urlSegment,o.snapshot._lastPathIndex+h,p.numberOfDoubleDots)}(y,n,p),b=_.processChildren?cI(_.segmentGroup,_.index,y.commands):J$(_.segmentGroup,_.index,y.commands);return e4(n.root,_.segmentGroup,b,h,v)}(I,this.currentUrlTree,o,M,null!=A?A:null)}navigateByUrl(o,h={skipLocationChange:!1}){const v=uv(o)?o:this.parseUrl(o),y=this.urlHandlingStrategy.merge(v,this.rawUrlTree);return this.scheduleNavigation(y,"imperative",null,h)}navigate(o,h={skipLocationChange:!1}){return function SIe(p){for(let n=0;n<p.length;n++){const o=p[n];if(null==o)throw new Error(`The requested path contains ${o} segment at index ${n}`)}}(o),this.navigateByUrl(this.createUrlTree(o,h),h)}serializeUrl(o){return this.urlSerializer.serialize(o)}parseUrl(o){let h;try{h=this.urlSerializer.parse(o)}catch(v){h=this.malformedUriErrorHandler(v,this.urlSerializer,o)}return h}isActive(o,h){let v;if(v=!0===h?Object.assign({},xIe):!1===h?Object.assign({},wIe):h,uv(o))return O$(this.currentUrlTree,o,v);const y=this.parseUrl(o);return O$(this.currentUrlTree,y,v)}removeEmptyProps(o){return Object.keys(o).reduce((h,v)=>{const y=o[v];return null!=y&&(h[v]=y),h},{})}processNavigations(){this.navigations.subscribe(o=>{this.navigated=!0,this.lastSuccessfulId=o.id,this.currentPageId=o.targetPageId,this.events.next(new kb(o.id,this.serializeUrl(o.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,o.resolve(!0)},o=>{this.console.warn(`Unhandled Navigation Error: ${o}`)})}scheduleNavigation(o,h,v,y,_){var b,w;if(this.disposed)return Promise.resolve(!1);let I,A,M;_?(I=_.resolve,A=_.reject,M=_.promise):M=new Promise((B,Q)=>{I=B,A=Q});const F=++this.navigationId;let V;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(v=this.location.getState()),V=v&&v.\u0275routerPageId?v.\u0275routerPageId:y.replaceUrl||y.skipLocationChange?null!==(b=this.browserPageId)&&void 0!==b?b:0:(null!==(w=this.browserPageId)&&void 0!==w?w:0)+1):V=0,this.setTransition({id:F,targetPageId:V,source:h,restoredState:v,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:o,extras:y,resolve:I,reject:A,promise:M,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),M.catch(B=>Promise.reject(B))}setBrowserUrl(o,h){const v=this.urlSerializer.serialize(o),y=Object.assign(Object.assign({},h.extras.state),this.generateNgRouterState(h.id,h.targetPageId));this.location.isCurrentPathEqualTo(v)||h.extras.replaceUrl?this.location.replaceState(v,"",y):this.location.go(v,"",y)}restoreHistory(o,h=!1){var v,y;if("computed"===this.canceledNavigationResolution){const _=this.currentPageId-o.targetPageId;"popstate"!==o.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(v=this.currentNavigation)||void 0===v?void 0:v.finalUrl)||0===_?this.currentUrlTree===(null===(y=this.currentNavigation)||void 0===y?void 0:y.finalUrl)&&0===_&&(this.resetState(o),this.browserUrlTree=o.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(_)}else"replace"===this.canceledNavigationResolution&&(h&&this.resetState(o),this.resetUrlToCurrentUrlTree())}resetState(o){this.routerState=o.currentRouterState,this.currentUrlTree=o.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,o.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(o,h){const v=new T$(o.id,this.serializeUrl(o.extractedUrl),h);this.triggerEvent(v),o.resolve(!1)}generateNgRouterState(o,h){return"computed"===this.canceledNavigationResolution?{navigationId:o,\u0275routerPageId:h}:{navigationId:o}}}return p.\u0275fac=function(o){tk()},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();function yq(p){return"imperative"!==p}let Hb=(()=>{class p{constructor(o,h,v){this.router=o,this.route=h,this.locationStrategy=v,this.commands=null,this.href=null,this.onChanges=new Of,this.subscription=o.events.subscribe(y=>{y instanceof kb&&this.updateTargetUrlAndHref()})}set routerLink(o){this.commands=null!=o?Array.isArray(o)?o:[o]:null}ngOnChanges(o){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(o,h,v,y,_){if(0!==o||h||v||y||_||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const b={skipLocationChange:Wy(this.skipLocationChange),replaceUrl:Wy(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,b),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Wy(this.preserveFragment)})}}return p.\u0275fac=function(o){return new(o||p)(Jt(Bc),Jt(By),Jt(ky))},p.\u0275dir=ii({type:p,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(o,h){1&o&&oi("click",function(y){return h.onClick(y.button,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey)}),2&o&&Ph("target",h.target)("href",h.href,_R)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Eu]}),p})();function Wy(p){return""===p||!!p}class _q{}class Cq{preload(n,o){return Ni(null)}}let bq=(()=>{class p{constructor(o,h,v,y){this.router=o,this.injector=v,this.preloadingStrategy=y,this.loader=new mq(v,h,w=>o.triggerEvent(new I$(w)),w=>o.triggerEvent(new E$(w)))}setUpPreloading(){this.subscription=this.router.events.pipe(Oy(o=>o instanceof kb),Rb(()=>this.preload())).subscribe(()=>{})}preload(){const o=this.injector.get(Gf);return this.processRoutes(o,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(o,h){const v=[];for(const y of h)if(y.loadChildren&&!y.canLoad&&y._loadedConfig){const _=y._loadedConfig;v.push(this.processRoutes(_.module,_.routes))}else y.loadChildren&&!y.canLoad?v.push(this.preloadConfig(o,y)):y.children&&v.push(this.processRoutes(o,y.children));return ka(v).pipe(RC(),co(y=>{}))}preloadConfig(o,h){return this.preloadingStrategy.preload(h,()=>(h._loadedConfig?Ni(h._loadedConfig):this.loader.load(o.injector,h)).pipe(Ca(y=>(h._loadedConfig=y,this.processRoutes(y.module,y.routes)))))}}return p.\u0275fac=function(o){return new(o||p)(ri(Bc),ri(dY),ri(oc),ri(_q))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})(),u4=(()=>{class p{constructor(o,h,v={}){this.router=o,this.viewportScroller=h,this.options=v,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},v.scrollPositionRestoration=v.scrollPositionRestoration||"disabled",v.anchorScrolling=v.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(o=>{o instanceof YM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=o.navigationTrigger,this.restoredId=o.restoredState?o.restoredState.navigationId:0):o instanceof kb&&(this.lastId=o.id,this.scheduleScrollEvent(o,this.router.parseUrl(o.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(o=>{o instanceof D$&&(o.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(o.position):o.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(o.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(o,h){this.router.triggerEvent(new D$(o,"popstate"===this.lastSource?this.store[this.restoredId]:null,h))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return p.\u0275fac=function(o){tk()},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();const dv=new Yi("ROUTER_CONFIGURATION"),xq=new Yi("ROUTER_FORROOT_GUARD"),DIe=[Jk,{provide:B$,useClass:W$},{provide:Bc,useFactory:function MIe(p,n,o,h,v,y,_={},b,w){const I=new Bc(null,p,n,o,h,v,R$(y));return b&&(I.urlHandlingStrategy=b),w&&(I.routeReuseStrategy=w),function OIe(p,n){p.errorHandler&&(n.errorHandler=p.errorHandler),p.malformedUriErrorHandler&&(n.malformedUriErrorHandler=p.malformedUriErrorHandler),p.onSameUrlNavigation&&(n.onSameUrlNavigation=p.onSameUrlNavigation),p.paramsInheritanceStrategy&&(n.paramsInheritanceStrategy=p.paramsInheritanceStrategy),p.relativeLinkResolution&&(n.relativeLinkResolution=p.relativeLinkResolution),p.urlUpdateStrategy&&(n.urlUpdateStrategy=p.urlUpdateStrategy),p.canceledNavigationResolution&&(n.canceledNavigationResolution=p.canceledNavigationResolution)}(_,I),_.enableTracing&&I.events.subscribe(A=>{var M,F;null===(M=console.group)||void 0===M||M.call(console,`Router Event: ${A.constructor.name}`),console.log(A.toString()),console.log(A),null===(F=console.groupEnd)||void 0===F||F.call(console)}),I},deps:[B$,Wb,Jk,oc,dY,l4,dv,[class yIe{},new fg],[class gIe{},new fg]]},Wb,{provide:By,useFactory:function FIe(p){return p.routerState.root},deps:[Bc]},bq,Cq,class EIe{preload(n,o){return o().pipe(xg(()=>Ni(null)))}},{provide:dv,useValue:{enableTracing:!1}}];function AIe(){return new mY("Router",Bc)}let wq=(()=>{class p{constructor(o,h){}static forRoot(o,h){return{ngModule:p,providers:[DIe,Sq(o),{provide:xq,useFactory:kIe,deps:[[Bc,new fg,new qC]]},{provide:dv,useValue:h||{}},{provide:ky,useFactory:RIe,deps:[rv,[new q3(Kk),new fg],dv]},{provide:u4,useFactory:PIe,deps:[Bc,Lwe,dv]},{provide:_q,useExisting:h&&h.preloadingStrategy?h.preloadingStrategy:Cq},{provide:mY,multi:!0,useFactory:AIe},[d4,{provide:Ok,multi:!0,useFactory:LIe,deps:[d4]},{provide:Tq,useFactory:NIe,deps:[d4]},{provide:uY,multi:!0,useExisting:Tq}]]}}static forChild(o){return{ngModule:p,providers:[Sq(o)]}}}return p.\u0275fac=function(o){return new(o||p)(ri(xq,8),ri(Bc,8))},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({}),p})();function PIe(p,n,o){return o.scrollOffset&&n.setOffset(o.scrollOffset),new u4(p,n,o)}function RIe(p,n,o={}){return o.useHash?new mxe(p,n):new FY(p,n)}function kIe(p){return"guarded"}function Sq(p){return[{provide:Xme,multi:!0,useValue:p},{provide:l4,multi:!0,useValue:p}]}let d4=(()=>{class p{constructor(o){this.injector=o,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Of}appInitializer(){return this.injector.get(fxe,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let h=null;const v=new Promise(b=>h=b),y=this.injector.get(Bc),_=this.injector.get(dv);return"disabled"===_.initialNavigation?(y.setUpLocationChangeListener(),h(!0)):"enabled"===_.initialNavigation||"enabledBlocking"===_.initialNavigation?(y.hooks.afterPreactivation=()=>this.initNavigation?Ni(null):(this.initNavigation=!0,h(!0),this.resultOfPreactivationDone),y.initialNavigation()):h(!0),v})}bootstrapListener(o){const h=this.injector.get(dv),v=this.injector.get(bq),y=this.injector.get(u4),_=this.injector.get(Bc),b=this.injector.get(Hk);o===b.components[0]&&(("enabledNonBlocking"===h.initialNavigation||void 0===h.initialNavigation)&&_.initialNavigation(),v.setUpPreloading(),y.init(),_.resetRootComponentType(b.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return p.\u0275fac=function(o){return new(o||p)(ri(oc))},p.\u0275prov=dr({token:p,factory:p.\u0275fac}),p})();function LIe(p){return p.appInitializer.bind(p)}function NIe(p){return p.bootstrapListener.bind(p)}const Tq=new Yi("Router Initializer");function Iq(p,n,o,h,v,y,_){try{var b=p[y](_),w=b.value}catch(I){return void o(I)}b.done?n(w):Promise.resolve(w).then(h,v)}function Fe(p){return function(){var n=this,o=arguments;return new Promise(function(h,v){var y=p.apply(n,o);function _(w){Iq(y,h,v,_,b,"next",w)}function b(w){Iq(y,h,v,_,b,"throw",w)}_(void 0)})}}const WIe=[{id:"reader",name:"Barcode and QR Code Reader (File)",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner (Camera)",description:"Scan barcode and QR code from camera stream"},{id:"file-detection",name:"Document Detector (File)",description:"Detect document from image files"},{id:"camera-detection",name:"Document Scanner (Camera)",description:"Detect document from camera stream"},{id:"mrz-reader",name:"MRZ Reader (File)",description:"Scan MRZ from image files"},{id:"mrz-scanner",name:"MRZ Scanner (Camera)",description:"Scan MRZ from camera stream"},{id:"document-viewer",name:"Document Viewer (File)",description:"View, edit and save documents"},{id:"acquire-image",name:"Acquire Image (TWAIN/SANE/ICA Scanner)",description:"The basic document scanning functionality"},{id:"image-editor",name:"Image Editor (TWAIN/SANE/ICA Scanner)",description:"Image editing: rotate, mirror, flip and more"}];function ji(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function hv(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}var fv,Nh,Un,p;"function"==typeof SuppressedError&&SuppressedError,(p=fv||(fv={}))[p.BOPM_BLOCK=0]="BOPM_BLOCK",p[p.BOPM_UPDATE=1]="BOPM_UPDATE",function(p){p[p.CCUT_AUTO=0]="CCUT_AUTO",p[p.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",p[p.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",p[p.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",p[p.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",p[p.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Nh||(Nh={})),function(p){p[p.IPF_BINARY=0]="IPF_BINARY",p[p.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",p[p.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",p[p.IPF_NV21=3]="IPF_NV21",p[p.IPF_RGB_565=4]="IPF_RGB_565",p[p.IPF_RGB_555=5]="IPF_RGB_555",p[p.IPF_RGB_888=6]="IPF_RGB_888",p[p.IPF_ARGB_8888=7]="IPF_ARGB_8888",p[p.IPF_RGB_161616=8]="IPF_RGB_161616",p[p.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",p[p.IPF_ABGR_8888=10]="IPF_ABGR_8888",p[p.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",p[p.IPF_BGR_888=12]="IPF_BGR_888",p[p.IPF_BINARY_8=13]="IPF_BINARY_8",p[p.IPF_NV12=14]="IPF_NV12",p[p.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Un||(Un={}));const mI="undefined"==typeof self,Eq=(()=>{if(!mI&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Dq=p=>{if(null==p&&(p="./"),!mI){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p},Aq=p=>Object.prototype.toString.call(p),h4=p=>Array.isArray?Array.isArray(p):"[object Array]"===Aq(p),f4=p=>"[object Boolean]"===Aq(p),hs=p=>"number"==typeof p&&!Number.isNaN(p),jd=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),Gb=p=>!(!jd(p)||!(p.bytes instanceof Uint8Array)||!hs(p.width)||p.width<=0||!hs(p.height)||p.height<=0||!hs(p.stride)||p.stride<=0||!("format"in p)||"tag"in p&&!VIe(p.tag)),VIe=p=>!!jd(p)&&!!hs(p.imageId)&&"type"in p,Uy=p=>!!jd(p)&&!!hs(p.x)&&!!hs(p.y);function p4(p,n){return g4.apply(this,arguments)}function g4(){return g4=Fe(function*(p,n){return yield new Promise((o,h)=>{let v=new XMLHttpRequest;v.open("GET",p,!0),v.responseType=n,v.send(),v.onloadend=Fe(function*(){v.status<200||v.status>=300?h(p+" "+v.status):o(v.response)}),v.onerror=()=>{h(new Error("Network Error: "+v.statusText))}})}),g4.apply(this,arguments)}const Wc=(p,n)=>{let o=p.split("."),h=n.split(".");for(let v=0;v<o.length&&v<h.length;++v){let y=o[v],_=h[v];if(y===_)continue;let b=parseInt(o[v]),w=parseInt(h[v]);return b===w||Number.isNaN(b)&&Number.isNaN(w)?y<_?-1:1:b<w||Number.isNaN(b)&&Number.isInteger(w)?-1:1}return o.length===h.length?0:o.length<h.length?-1:1},pv=(p,n)=>{const o={};for(let h in n){const v=h;let y=p[v];y&&"string"!=typeof y&&y.path&&(y=y.path),p.rootDirectory&&!p.rootDirectory.endsWith("/")&&(p.rootDirectory=p.rootDirectory+"/"),void 0===y?p.rootDirectory?y=`${p.rootDirectory}${YIe[v]}@${n[v].version}/dist/`:(y=n[v].path,y||(y=n[v])):y.startsWith("@engineRootDirectory/")&&(y=y.replace("@engineRootDirectory/",p.rootDirectory)),o[v]=Dq(y)}return o},YIe={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer"},XIe=function(){var p=Fe(function*(n,o,h){return yield new Promise(function(){var v=Fe(function*(y,_){try{const b=o.split(".");let w=b[b.length-1];const I=yield Pq(`image/${w}`,n);b.length<=1&&(w="png");const A=new File([I],o,{type:`image/${w}`});if(h){const M=URL.createObjectURL(A),F=document.createElement("a");F.href=M,F.download=o,F.click()}return y(A)}catch(b){return _()}});return function(y,_){return v.apply(this,arguments)}}())});return function(o,h,v){return p.apply(this,arguments)}}(),m4=p=>{Gb(p)&&(p=vI(p));const n=document.createElement("canvas");return n.width=p.width,n.height=p.height,n.getContext("2d",{willReadFrequently:!0}).putImageData(p,0,0),n},Pq=function(){var p=Fe(function*(n,o){Gb(o)&&(o=vI(o));const h=m4(o);return new Promise((v,y)=>{h.toBlob(_=>v(_),n)})});return function(o,h){return p.apply(this,arguments)}}(),vI=p=>{let n,o=p.bytes;if(!(o&&o instanceof Uint8Array))throw Error("Parameter type error");if(Number(p.format)===Un.IPF_BGR_888){const h=o.length/3;n=new Uint8ClampedArray(4*h);for(let v=0;v<h;++v)n[4*v]=o[3*v],n[4*v+1]=o[3*v+1],n[4*v+2]=o[3*v+2],n[4*v+3]=255}else if(Number(p.format)===Un.IPF_RGB_888){const h=o.length/3;n=new Uint8ClampedArray(4*h);for(let v=0;v<h;++v)n[4*v]=o[3*v+2],n[4*v+1]=o[3*v+1],n[4*v+2]=o[3*v],n[4*v+3]=255}else if(Number(p.format)===Un.IPF_GRAYSCALED){const h=o.length;n=new Uint8ClampedArray(4*h);for(let v=0;v<h;v++)n[4*v]=n[4*v+1]=n[4*v+2]=o[v],n[4*v+3]=255}else if(Number(p.format)===Un.IPF_BINARY_8){const h=o.length,v=p.width,_=p.stride;n=new Uint8ClampedArray(v*p.height*4);for(let b=0;b<h;b++){let w=o[b],I=b%_,A=Math.floor(b/_);for(let M=0;M<8;M++){let F=I+M,V=4*(A*v+F);if(F>=v)break;n[V]=n[V+1]=n[V+2]=(128&w)/128*255,n[V+3]=255,w<<=1}}}else if(Number(p.format)===Un.IPF_ABGR_8888){const h=o.length/4;n=new Uint8ClampedArray(o.length);for(let v=0;v<h;++v)n[4*v]=o[4*v],n[4*v+1]=o[4*v+1],n[4*v+2]=o[4*v+2],n[4*v+3]=o[4*v+3]}else if(Number(p.format)===Un.IPF_ARGB_8888){const h=o.length/4;n=new Uint8ClampedArray(o.length);for(let v=0;v<h;++v)n[4*v]=o[4*v+2],n[4*v+1]=o[4*v+1],n[4*v+2]=o[4*v],n[4*v+3]=o[4*v+3]}return new ImageData(n,p.width,p.height)};var yI,Vs,gv,zb,Yb,Lu,mv,v4;class Nu{get _isFetchingStarted(){return ji(this,Yb,"f")}constructor(){yI.add(this),Vs.set(this,[]),gv.set(this,1),zb.set(this,fv.BOPM_BLOCK),Yb.set(this,!1),Lu.set(this,void 0),mv.set(this,Nh.CCUT_AUTO)}setErrorListener(n){}addImageToBuffer(n){var o;if(!Gb(n))throw new TypeError("Invalid 'image'.");if((null===(o=n.tag)||void 0===o?void 0:o.hasOwnProperty("imageId"))&&"number"==typeof n.tag.imageId&&this.hasImage(n.tag.imageId))throw new Error("Existed imageId.");if(ji(this,Vs,"f").length>=ji(this,gv,"f"))switch(ji(this,zb,"f")){case fv.BOPM_BLOCK:break;case fv.BOPM_UPDATE:if(ji(this,Vs,"f").push(n),jd(ji(this,Lu,"f"))&&hs(ji(this,Lu,"f").imageId)&&1==ji(this,Lu,"f").keepInBuffer)for(;ji(this,Vs,"f").length>ji(this,gv,"f");){const h=ji(this,Vs,"f").findIndex(v=>{var y;return(null===(y=v.tag)||void 0===y?void 0:y.imageId)!==ji(this,Lu,"f").imageId});ji(this,Vs,"f").splice(h,1)}else ji(this,Vs,"f").splice(0,ji(this,Vs,"f").length-ji(this,gv,"f"))}else ji(this,Vs,"f").push(n)}getImage(){if(0===ji(this,Vs,"f").length)return null;let n;if(ji(this,Lu,"f")&&hs(ji(this,Lu,"f").imageId)){const o=ji(this,yI,"m",v4).call(this,ji(this,Lu,"f").imageId);if(o<0)throw new Error(`Image with id ${ji(this,Lu,"f").imageId} doesn't exist.`);n=ji(this,Vs,"f").slice(o,o+1)[0]}else n=ji(this,Vs,"f").pop();if([Un.IPF_RGB_565,Un.IPF_RGB_555,Un.IPF_RGB_888,Un.IPF_ARGB_8888,Un.IPF_RGB_161616,Un.IPF_ARGB_16161616,Un.IPF_ABGR_8888,Un.IPF_ABGR_16161616,Un.IPF_BGR_888].includes(n.format)){if(ji(this,mv,"f")===Nh.CCUT_RGB_R_CHANNEL_ONLY){Nu._onLog&&Nu._onLog("only get R channel data.");const o=new Uint8Array(n.width*n.height);for(let h=0;h<o.length;h++)switch(n.format){case Un.IPF_RGB_565:case Un.IPF_RGB_555:case Un.IPF_RGB_888:case Un.IPF_RGB_161616:o[h]=n.bytes[3*h+2];break;case Un.IPF_ARGB_8888:case Un.IPF_ARGB_16161616:o[h]=n.bytes[4*h+2];break;case Un.IPF_BGR_888:o[h]=n.bytes[3*h];break;case Un.IPF_ABGR_8888:case Un.IPF_ABGR_16161616:o[h]=n.bytes[4*h]}n.bytes=o,n.stride=n.width,n.format=Un.IPF_GRAYSCALED}else if(ji(this,mv,"f")===Nh.CCUT_RGB_G_CHANNEL_ONLY){Nu._onLog&&Nu._onLog("only get G channel data.");const o=new Uint8Array(n.width*n.height);for(let h=0;h<o.length;h++)switch(n.format){case Un.IPF_RGB_565:case Un.IPF_RGB_555:case Un.IPF_RGB_888:case Un.IPF_RGB_161616:case Un.IPF_BGR_888:o[h]=n.bytes[3*h+1];break;case Un.IPF_ARGB_8888:case Un.IPF_ARGB_16161616:case Un.IPF_ABGR_8888:case Un.IPF_ABGR_16161616:o[h]=n.bytes[4*h+1]}n.bytes=o,n.stride=n.width,n.format=Un.IPF_GRAYSCALED}else if(ji(this,mv,"f")===Nh.CCUT_RGB_B_CHANNEL_ONLY){Nu._onLog&&Nu._onLog("only get B channel data.");const o=new Uint8Array(n.width*n.height);for(let h=0;h<o.length;h++)switch(n.format){case Un.IPF_RGB_565:case Un.IPF_RGB_555:case Un.IPF_RGB_888:case Un.IPF_RGB_161616:o[h]=n.bytes[3*h];break;case Un.IPF_ARGB_8888:case Un.IPF_ARGB_16161616:o[h]=n.bytes[4*h];break;case Un.IPF_BGR_888:o[h]=n.bytes[3*h+2];break;case Un.IPF_ABGR_8888:case Un.IPF_ABGR_16161616:o[h]=n.bytes[4*h+2]}n.bytes=o,n.stride=n.width,n.format=Un.IPF_GRAYSCALED}}else[Un.IPF_NV21,Un.IPF_NV12].includes(n.format)&&Nu._onLog&&Nu._onLog("NV21 or NV12 is not supported.");return n}setNextImageToReturn(n,o){if(!((...h)=>0!==h.length&&h.every(v=>hs(v)))(n))throw new TypeError("Invalid 'imageId'.");if(void 0!==o&&!f4(o))throw new TypeError("Invalid 'keepInBuffer'.");hv(this,Lu,{imageId:n,keepInBuffer:o},"f")}_resetNextReturnedImage(){hv(this,Lu,null,"f")}hasImage(n){return ji(this,yI,"m",v4).call(this,n)>=0}startFetching(){hv(this,Yb,!0,"f")}stopFetching(){hv(this,Yb,!1,"f")}setMaxImageCount(n){if("number"!=typeof n)throw new TypeError("Invalid 'count'.");if(n<1||Math.round(n)!==n)throw new Error("Invalid 'count'.");for(hv(this,gv,n,"f");ji(this,Vs,"f")&&ji(this,Vs,"f").length>n;)ji(this,Vs,"f").shift()}getMaxImageCount(){return ji(this,gv,"f")}getImageCount(){return ji(this,Vs,"f").length}clearBuffer(){ji(this,Vs,"f").length=0}isBufferEmpty(){return 0===ji(this,Vs,"f").length}setBufferOverflowProtectionMode(n){hv(this,zb,n,"f")}getBufferOverflowProtectionMode(){return ji(this,zb,"f")}setColourChannelUsageType(n){hv(this,mv,n,"f")}getColourChannelUsageType(){return ji(this,mv,"f")}}Vs=new WeakMap,gv=new WeakMap,zb=new WeakMap,Yb=new WeakMap,Lu=new WeakMap,mv=new WeakMap,yI=new WeakSet,v4=function(p){if("number"!=typeof p)throw new TypeError("Invalid 'imageId'.");return ji(this,Vs,"f").findIndex(n=>{var o;return(null===(o=n.tag)||void 0===o?void 0:o.imageId)===p})};const Rq=p=>p&&"object"==typeof p&&"function"==typeof p.then;class y4 extends Promise{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var o=this;let h;this._task=n,Rq(n)?h=n:"function"==typeof n&&(h=new Promise(n)),h&&Fe(function*(){try{const v=yield h;n===o._task&&o.resolve(v)}catch(v){n===o._task&&o.reject(v)}})()}get isEmpty(){return null==this._task}constructor(n){let o,h;super((v,y)=>{o=v,h=y}),this._s="pending",this.resolve=v=>{this.isPending&&(Rq(v)?this.task=v:(this._s="fulfilled",o(v)))},this.reject=v=>{this.isPending&&(this._s="rejected",h(v))},this.task=n}}let Xb,Kf,_I,CI,ac;"undefined"!=typeof navigator&&(Xb=navigator,Kf=Xb.userAgent,_I=Xb.platform,CI=Xb.mediaDevices),function(){if(!mI){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Xb.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:_I,search:"Win"},Mac:{str:_I},Linux:{str:_I}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||Kf,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||Kf).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||Kf).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=Kf.indexOf("Windows NT")&&(v="HarmonyOS"),ac={browser:o,version:h,OS:v}}mI&&(ac={browser:"ssr",version:0,OS:"ssr"})}();const qIe="undefined"!=typeof WebAssembly&&Kf&&!(/Safari/.test(Kf)&&!/Chrome/.test(Kf)&&/\(.+\s11_2_([2-6]).*\)/.test(Kf)),KIe="undefined"!=typeof Worker,kq=!(!CI||!CI.getUserMedia),JIe=function(){var p=Fe(function*(){let n=!1;if(kq)try{(yield CI.getUserMedia({video:!0})).getTracks().forEach(o=>{o.stop()}),n=!0}catch(o){}return n});return function(){return p.apply(this,arguments)}}(),Jf={},_4=function(){var p=Fe(function*(n){let o="string"==typeof n?[n]:n,h=[];for(let v of o)h.push(Jf[v]=Jf[v]||new y4);yield Promise.all(h)});return function(o){return p.apply(this,arguments)}}(),C4=function(){var p=Fe(function*(n,o){let h,v="string"==typeof n?[n]:n,y=[];for(let _ of v){let b;y.push(b=Jf[_]=Jf[_]||new y4(h=h||o())),b.isEmpty&&(b.task=h=h||o())}yield Promise.all(y)});return function(o,h){return p.apply(this,arguments)}}();let _i,Mq=0;const Sr=()=>Mq++,Ui={};let Sg,b4=!1;const Ll={},io={},kn={std:{version:"1.4.10",path:Dq(Eq+"../../dynamsoft-capture-vision-std@1.4.10/dist/")},core:{version:"3.4.20",path:Eq}},Bu={dip:{wasm:!0}},x4={},Wu=function(){var p=Fe(function*(n){let o;n instanceof Array||(n=n?[n]:[]);let h=Jf.core;o=!h||h.isEmpty;let v=new Map;const y=w=>{if("std"==(w=w.toLowerCase())||"core"==w)return;if(!Bu[w])throw Error("The '"+w+"' module cannot be found.");let I=Bu[w].deps;if(null==I?void 0:I.length)for(let M of I)y(M);let A=Jf[w];v.has(w)||v.set(w,!A||A.isEmpty)};for(let w of n)y(w);let _=[];o&&_.push("core"),_.push(...v.keys());const b=[...v.entries()].filter(w=>!w[1]).map(w=>w[0]);yield C4(_,Fe(function*(){const w=[...v.entries()].filter(B=>B[1]).map(B=>B[0]);yield _4(b);const I=pv(x4,kn),A={};for(let B of w)A[B]=Bu[B];const M={engineResourcePaths:I,autoResources:A,names:w};let F=new y4;if(o){M.needLoadCore=!0;let B=I.core+Mo._workerName;B.startsWith(location.origin)||(B=yield fetch(B).then(Q=>Q.blob()).then(Q=>URL.createObjectURL(Q))),_i=new Worker(B),_i.onerror=Q=>{let J=new Error(Q.message);F.reject(J)},_i.addEventListener("message",Q=>{let J=Q.data?Q.data:Q,re=J.id,se=J.body;switch(J.type){case"log":Sg&&Sg(J.message);break;case"task":try{Ui[re](se),delete Ui[re]}catch(ce){throw delete Ui[re],ce}break;case"event":try{Ui[re](se)}catch(ce){throw ce}break;default:console.log(Q)}}),M.bLog=!!Sg,M.bd=b4,M.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield _4("core");let V=Mq++;Ui[V]=B=>{if(B.success)Object.assign(Ll,B.versions),"{}"!==JSON.stringify(B.versions)&&(Mo._versions=B.versions),F.resolve(void 0);else{const Q=Error(B.message);B.stack&&(Q.stack=B.stack),F.reject(Q)}},_i.postMessage({type:"loadWasm",body:M,id:V}),yield F}))});return function(o){return p.apply(this,arguments)}}();class Mo{static get engineResourcePaths(){return x4}static set engineResourcePaths(n){Object.assign(x4,n)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Sg}static set _onLog(n){(p=>{Sg=p,_i&&_i.postMessage({type:"setBLog",body:{value:!!p}})})(n)}static get _bDebug(){return b4}static set _bDebug(n){(p=>{b4=p,_i&&_i.postMessage({type:"setBDebug",body:{value:!!p}})})(n)}static isModuleLoaded(n){return n=(n=n||"core").toLowerCase(),!!Jf[n]&&Jf[n].isFulfilled}static loadWasm(n){return Fe(function*(){return yield Wu(n)})()}static detectEnvironment(){return Fe(function*(){return yield Fe(function*(){return{wasm:qIe,worker:KIe,getUserMedia:kq,camera:yield JIe(),browser:ac.browser,version:ac.version,OS:ac.OS}})()})()}static getModuleVersion(){return Fe(function*(){return yield new Promise((n,o)=>{let h=Sr();Ui[h]=function(){var v=Fe(function*(y){if(y.success)return n(y.versions);{let _=new Error(y.message);return _.stack=y.stack+"\n"+_.stack,o(_)}});return function(y){return v.apply(this,arguments)}}(),_i.postMessage({type:"getModuleVersion",id:h})})})()}static getVersion(){return`3.4.20(Worker: ${Ll.core&&Ll.core.worker||"Not Loaded"}, Wasm: ${Ll.core&&Ll.core.wasm||"Not Loaded"})`}static enableLogging(){Nu._onLog=console.log,Mo._onLog=console.log}static disableLogging(){Nu._onLog=null,Mo._onLog=null}static cfd(n){return Fe(function*(){return yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o();{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cfd",id:v,body:{count:n}})})})()}}var pr,Oq,w4,Fq,Lq,bI,Nq,Bq;Mo._bSupportDce4Module=-1,Mo._bSupportIRTModule=-1,Mo._versions=null,Mo._workerName="core.worker.js",Mo.browserInfo=ac,function(p){p[p.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",p[p.CRIT_BARCODE=2]="CRIT_BARCODE",p[p.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",p[p.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",p[p.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",p[p.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(pr||(pr={})),function(p){p[p.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",p[p.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",p[p.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",p[p.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(Oq||(Oq={})),function(p){p[p.EC_OK=0]="EC_OK",p[p.EC_UNKNOWN=-1e4]="EC_UNKNOWN",p[p.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",p[p.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",p[p.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",p[p.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",p[p.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",p[p.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",p[p.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",p[p.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",p[p.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",p[p.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",p[p.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",p[p.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",p[p.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",p[p.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",p[p.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",p[p.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",p[p.EC_TIMEOUT=-10026]="EC_TIMEOUT",p[p.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",p[p.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",p[p.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",p[p.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",p[p.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",p[p.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",p[p.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",p[p.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",p[p.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",p[p.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",p[p.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",p[p.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",p[p.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",p[p.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",p[p.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",p[p.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",p[p.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",p[p.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",p[p.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",p[p.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",p[p.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",p[p.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",p[p.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",p[p.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",p[p.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",p[p.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",p[p.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",p[p.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",p[p.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",p[p.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",p[p.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",p[p.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",p[p.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",p[p.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",p[p.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",p[p.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",p[p.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",p[p.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",p[p.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",p[p.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",p[p.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",p[p.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",p[p.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",p[p.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",p[p.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",p[p.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",p[p.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",p[p.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",p[p.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",p[p.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",p[p.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",p[p.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",p[p.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",p[p.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",p[p.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",p[p.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",p[p.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",p[p.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",p[p.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",p[p.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",p[p.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",p[p.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",p[p.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",p[p.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",p[p.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",p[p.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",p[p.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",p[p.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",p[p.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",p[p.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",p[p.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",p[p.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",p[p.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",p[p.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",p[p.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",p[p.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",p[p.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",p[p.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",p[p.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",p[p.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",p[p.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",p[p.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",p[p.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",p[p.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",p[p.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",p[p.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",p[p.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(w4||(w4={})),function(p){p[p.GEM_SKIP=0]="GEM_SKIP",p[p.GEM_AUTO=1]="GEM_AUTO",p[p.GEM_GENERAL=2]="GEM_GENERAL",p[p.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",p[p.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",p[p.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",p[p.GEM_REV=-2147483648]="GEM_REV"}(Fq||(Fq={})),function(p){p[p.GTM_SKIP=0]="GTM_SKIP",p[p.GTM_INVERTED=1]="GTM_INVERTED",p[p.GTM_ORIGINAL=2]="GTM_ORIGINAL",p[p.GTM_AUTO=4]="GTM_AUTO",p[p.GTM_REV=-2147483648]="GTM_REV"}(Lq||(Lq={})),function(p){p[p.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",p[p.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(bI||(bI={})),function(p){p[p.PDFRM_VECTOR=1]="PDFRM_VECTOR",p[p.PDFRM_RASTER=2]="PDFRM_RASTER",p[p.PDFRM_REV=-2147483648]="PDFRM_REV"}(Nq||(Nq={})),function(p){p[p.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",p[p.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Bq||(Bq={})),BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384);const xI_IRUT_LOCALIZED_BARCODES=BigInt(32768),xI_IRUT_DECODED_BARCODES=(BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19));var Wq,Uq;BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt("0xFFFFFFFFFFFFFFFF"),function(p){p[p.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",p[p.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",p[p.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",p[p.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",p[p.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",p[p.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",p[p.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",p[p.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",p[p.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(Wq||(Wq={})),function(p){p[p.ST_NULL=0]="ST_NULL",p[p.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",p[p.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",p[p.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",p[p.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",p[p.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",p[p.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",p[p.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Uq||(Uq={}));const Tg="undefined"==typeof self,Vq=Tg?{}:self,jq=(()=>{if(!Tg&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Hq=p=>p&&"object"==typeof p&&"function"==typeof p.then;class S4 extends Promise{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var o=this;let h;this._task=n,Hq(n)?h=n:"function"==typeof n&&(h=new Promise(n)),h&&Fe(function*(){try{const v=yield h;n===o._task&&o.resolve(v)}catch(v){n===o._task&&o.reject(v)}})()}get isEmpty(){return null==this._task}constructor(n){let o,h;super((v,y)=>{o=v,h=y}),this._s="pending",this.resolve=v=>{this.isPending&&(Hq(v)?this.task=v:(this._s="fulfilled",o(v)))},this.reject=v=>{this.isPending&&(this._s="rejected",h(v))},this.task=n}}const wI=" is not allowed to change after `createInstance` or `loadWasm` is called.",tEe=!Tg&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Gq=(p,n)=>{const o=p;if(o._license!==n){if(!o._pLoad.isEmpty)throw new Error("`license`"+wI);o._license=n}};!Tg&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const zq=p=>{if(null==p)p=[];else{p=p instanceof Array?[...p]:[p];for(let n=0;n<p.length;++n){if(!Tg){let o=document.createElement("a");o.href=p[n],p[n]=o.href}p[n].endsWith("/")||(p[n]+="/")}}return p},Yq=(p,n)=>{n=zq(n);const o=p;if(o._licenseServer!==n){if(!o._pLoad.isEmpty)throw new Error("`licenseServer`"+wI);o._licenseServer=n}},Xq=(p,n)=>{const o=p;if(o._deviceFriendlyName!==(n=n||"")){if(!o._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+wI);o._deviceFriendlyName=n}};let $b,qb,SI,T4,Hd;"undefined"!=typeof navigator&&($b=navigator,qb=$b.userAgent,SI=$b.platform,T4=$b.mediaDevices),function(){if(!Tg){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:$b.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:SI,search:"Win"},Mac:{str:SI},Linux:{str:SI}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||qb,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||qb).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||qb).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=qb.indexOf("Windows NT")&&(v="HarmonyOS"),Hd={browser:o,version:h,OS:v}}Tg&&(Hd={browser:"ssr",version:0,OS:"ssr"})}();const $q=()=>(Wu("license"),C4("dynamsoft_inited",Fe(function*(){let{lt:p,l:n,ls:o,sp:h,rmk:v,cv:y}=((w,I=!1)=>{const A=w;if(A._pLoad.isEmpty){let M,F,V,B=A._license||"",Q=JSON.parse(JSON.stringify(A._licenseServer)),J=A._sessionPassword,Z=0;if(B.startsWith("t")||B.startsWith("f"))Z=0;else if(0===B.length||B.startsWith("P")||B.startsWith("L")||B.startsWith("Y")||B.startsWith("A"))Z=1;else{Z=2;const re=B.indexOf(":");-1!=re&&(B=B.substring(re+1));const se=B.indexOf("?");if(-1!=se&&(F=B.substring(se+1),B=B.substring(0,se)),B.startsWith("DLC2"))Z=0;else{if(B.startsWith("DLS2")){let ce;try{let pe=B.substring(4);pe=atob(pe),ce=JSON.parse(pe)}catch(pe){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(B=ce.handshakeCode?ce.handshakeCode:ce.organizationID?ce.organizationID:"","number"==typeof B&&(B=JSON.stringify(B)),0===Q.length){let pe=[];ce.mainServerURL&&(pe[0]=ce.mainServerURL),ce.standbyServerURL&&(pe[1]=ce.standbyServerURL),Q=zq(pe)}!J&&ce.sessionPassword&&(J=ce.sessionPassword),M=ce.remark}B&&"200001"!==B&&!B.startsWith("200001-")||(Z=1)}}if(Z&&(I||(Vq.crypto||(V="Please upgrade your browser to support online key."),Vq.crypto.subtle||(V="Require https to use online key in this browser."))),V){if(1!==Z)throw new Error(V);Z=0,console.warn(V),A._lastErrorCode=-1,A._lastErrorString=V}return 1===Z&&(B="",console.warn("Applying for a public trial license ...")),{lt:Z,l:B,ls:Q,sp:J,rmk:M,cv:F}}throw new Error("Can't preprocess license again"+wI)})(ro),_=new S4;ro._pLoad.task=_,Fe(function*(){try{yield ro._pLoad}catch(w){}})();let b=Sr();Ui[b]=w=>{if(w.message&&ro._onAuthMessage){let M=ro._onAuthMessage(w.message);null!=M&&(w.message=M)}let I,A=!1;if(1===p&&(A=!0),w.success?(Sg&&Sg("init license success"),w.message&&console.warn(w.message),Mo._bSupportIRTModule=w.bSupportIRTModule,Mo._bSupportDce4Module=w.bSupportDce4Module,ro.bPassValidation=!0,[0,-10076].includes(w.initLicenseInfo.errorCode)?[-10076].includes(w.initLicenseInfo.errorCode)&&console.warn(w.initLicenseInfo.errorString):_.reject(new Error(w.initLicenseInfo.errorString))):(I=Error(w.message),w.stack&&(I.stack=w.stack),w.ltsErrorCode&&(I.ltsErrorCode=w.ltsErrorCode),A||111==w.ltsErrorCode&&-1!=w.message.toLowerCase().indexOf("trial license")&&(A=!0)),A){const M=pv(Mo.engineResourcePaths,kn);(F=Fe(function*(V,B,Q){if(!V._bNeverShowDialog)try{let J=yield fetch(V.engineResourcePath+"dls.license.dialog.html");if(!J.ok)throw Error("Get license dialog fail. Network Error: "+J.statusText);let Z=yield J.text();if(!Z.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let re=document.createElement("div");re.innerHTML=Z;let se=[];for(let j=0;j<re.childElementCount;++j){let L=re.children[j];L instanceof HTMLStyleElement&&(se.push(L),document.head.append(L))}let ce=1==re.childElementCount?re.children[0]:re;ce.remove();let pe,Ce,Ve,te,Me,we=[ce],Le=ce.children;for(let j of Le)we.push(j);for(let j=0;j<we.length;++j)for(let L of we[j].children)we.push(L);for(let j of we)if(!pe&&j.classList.contains("dls-license-mask"))pe=j,j.addEventListener("click",L=>{if(j==L.target){ce.remove();for(let Y of se)Y.remove()}});else if(!Ce&&j.classList.contains("dls-license-icon-close"))Ce=j,j.addEventListener("click",()=>{ce.remove();for(let L of se)L.remove()});else if(!Ve&&j.classList.contains("dls-license-icon-error"))Ve=j,"error"!=B&&j.remove();else if(!te&&j.classList.contains("dls-license-icon-warn"))te=j,"warn"!=B&&j.remove();else if(!Me&&j.classList.contains("dls-license-msg-content")){Me=j;let L=Q;for(;L;){let Y=L.indexOf("["),q=L.indexOf("]",Y),k=L.indexOf("(",q),N=L.indexOf(")",k);if(-1==Y||-1==q||-1==k||-1==N){j.appendChild(new Text(L));break}Y>0&&j.appendChild(new Text(L.substring(0,Y)));let $=document.createElement("a"),ie=L.substring(Y+1,q);$.innerText=ie;let ee=L.substring(k+1,N);$.setAttribute("href",ee),$.setAttribute("target","_blank"),j.appendChild($),L=L.substring(N+1)}}document.body.appendChild(ce)}catch(J){V._onLog&&V._onLog(J.message||J)}}),function(V,B,Q){return F.apply(this,arguments)})({_bNeverShowDialog:ro._bNeverShowDialog,engineResourcePath:M.license,_onLog:Sg},w.success?"warn":"error",w.message)}var F;w.success?_.resolve(void 0):_.reject(I)},yield _4("core"),_i.postMessage({type:"license_dynamsoft",body:{v:"3.4.20",brtk:!!p,bptk:1===p,l:n,os:Hd,fn:ro.deviceFriendlyName,ls:o,sp:h,rmk:v,cv:y},id:b}),ro.bCallInitLicense=!0,yield _})));let qq;io.license={},io.license.dynamsoft=$q,io.license.getAR=Fe(function*(){{let p=Jf.dynamsoft_inited;p&&p.isRejected&&(yield p)}return _i?new Promise((p,n)=>{let o=Sr();Ui[o]=function(){var h=Fe(function*(v){if(v.success){delete v.success;{let y=ro.license;y&&(y.startsWith("t")||y.startsWith("f"))&&(v.pk=y)}if(Object.keys(v).length){if(v.lem){let y=Error(v.lem);y.ltsErrorCode=v.lec,delete v.lem,delete v.lec,v.ae=y}p(v)}else p(null)}else{let y=Error(v.message);v.stack&&(y.stack=v.stack),n(y)}});return function(v){return h.apply(this,arguments)}}(),_i.postMessage({type:"license_getAR",id:o})}):null});class ro{static setLicenseServer(n){Yq(ro,n)}static get license(){return this._license}static set license(n){Gq(ro,n)}static get licenseServer(){return this._licenseServer}static set licenseServer(n){Yq(ro,n)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(n){Xq(ro,n)}static initLicense(n,o){if(Gq(ro,n),ro.bCallInitLicense=!0,o&&o.executeNow)return $q()}static setDeviceFriendlyName(n){Xq(ro,n)}static getDeviceFriendlyName(){return ro._deviceFriendlyName}static getDeviceUUID(){return Fe(function*(){return yield C4("dynamsoft_uuid",Fe(function*(){yield Wu();let n=new S4,o=Sr();Ui[o]=h=>{if(h.success)n.resolve(h.uuid);else{const v=Error(h.message);h.stack&&(v.stack=h.stack),n.reject(v)}},_i.postMessage({type:"license_getDeviceUUID",id:o}),qq=yield n})),qq})()}}ro._pLoad=new S4,ro.bPassValidation=!1,ro.bCallInitLicense=!1,ro._license=tEe,ro._licenseServer=[],ro._deviceFriendlyName="",kn.license={version:"3.4.20",path:jq},Bu.license={wasm:!0,js:!0},io.license.LicenseManager=ro;const I4="1.4.10";function qt(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function xa(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}"string"!=typeof kn.std&&Wc(kn.std.version,I4)<0&&(kn.std={version:I4,path:(p=>{if(null==p&&(p="./"),!Tg){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p})(jq+`../../dynamsoft-capture-vision-std@${I4}/dist/`)}),"function"==typeof SuppressedError&&SuppressedError;const Kq=p=>p&&"object"==typeof p&&"function"==typeof p.then;class Kb extends Promise{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var o=this;let h;this._task=n,Kq(n)?h=n:"function"==typeof n&&(h=new Promise(n)),h&&Fe(function*(){try{const v=yield h;n===o._task&&o.resolve(v)}catch(v){n===o._task&&o.reject(v)}})()}get isEmpty(){return null==this._task}constructor(n){let o,h;super((y,_)=>{o=y,h=_}),this._s="pending",this.resolve=y=>{this.isPending&&(Kq(y)?this.task=y:(this._s="fulfilled",o(y)))},this.reject=y=>{this.isPending&&(this._s="rejected",h(y))},this.task=n}}class nEe{constructor(n){this._cvr=n}getMaxBufferedItems(){var n=this;return Fe(function*(){return yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o(_.count);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_getMaxBufferedItems",id:v,instanceID:n._cvr._instanceID})})})()}setMaxBufferedItems(n){var o=this;return Fe(function*(){return yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success)return h();{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_setMaxBufferedItems",id:y,instanceID:o._cvr._instanceID,body:{count:n}})})})()}getBufferedCharacterItemSet(){var n=this;return Fe(function*(){return yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o(_.itemSet);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_getBufferedCharacterItemSet",id:v,instanceID:n._cvr._instanceID})})})()}}var iEe={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const Jq=p=>{for(let n in p._irrRegistryState)p._irrRegistryState[n]=!1;for(let n of p._intermediateResultReceiverSet)if(n.isDce||n.isFilter)p._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let o in n)p._irrRegistryState[o]||(p._irrRegistryState[o]=!!n[o])};class rEe{constructor(n){this._irrRegistryState=iEe,this._intermediateResultReceiverSet=new Set,this._cvr=n}addResultReceiver(n){var o=this;return Fe(function*(){if("object"!=typeof n)throw new Error("Invalid receiver.");o._intermediateResultReceiverSet.add(n),Jq(o);let h=-1,v={};if(!n.isDce&&!n.isFilter){if(!n._observedResultUnitTypes||!n._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");h=n._observedResultUnitTypes,n._observedTaskMap.forEach((y,_)=>{v[_]=y}),n._observedTaskMap.clear()}return yield new Promise((y,_)=>{let b=Sr();Ui[b]=function(){var w=Fe(function*(I){if(I.success)return y();{let A=new Error(I.message);return A.stack=I.stack+"\n"+A.stack,_(A)}});return function(I){return w.apply(this,arguments)}}(),_i.postMessage({type:"cvr_setIrrRegistry",id:b,instanceID:o._cvr._instanceID,body:{receiverObj:o._irrRegistryState,observedResultUnitTypes:h.toString(),observedTaskMap:v}})})})()}removeResultReceiver(n){var o=this;return Fe(function*(){return o._intermediateResultReceiverSet.delete(n),Jq(o),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success)return h();{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_setIrrRegistry",id:y,instanceID:o._cvr._instanceID,body:{receiverObj:o._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const Qq="undefined"==typeof self,E4=(()=>{if(!Qq&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),Zq=p=>{if(null==p&&(p="./"),!Qq){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p};var D4;kn.cvr={version:"2.4.20",path:E4},Bu.cvr={js:!0,wasm:!0,deps:["license","dip"]},io.cvr={};const A4="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,A4)<0&&(kn.std={version:A4,path:Zq(E4+`../../dynamsoft-capture-vision-std@${A4}/dist/`)});const P4="2.4.20";(!kn.dip||"string"!=typeof kn.dip&&Wc(kn.dip.version,P4)<0)&&(kn.dip={version:P4,path:Zq(E4+`../../dynamsoft-image-processing@${P4}/dist/`)});class eK{static getVersion(){return this._version}}eK._version=`2.4.20(Worker: ${null===(D4=Ll.cvr)||void 0===D4?void 0:D4.worker}, Wasm: loading...`;var $i,Qf,Uu,Nl,Vy,Uc,Ig,Bh,Vu,Eg,jy,Qb,Jb=(()=>(function(p){p[p.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",p[p.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Jb||(Jb={})),Jb))();function tK(p,n){if(p&&p.location){const o=p.location.points;for(let h of o)h.x=h.x/n,h.y=h.y/n;tK(p.referencedItem,n)}}function fs(p){if(p.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19),BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt("0xFFFFFFFFFFFFFFFF");const nK={onTaskResultsReceived:()=>{},isFilter:!0};class gr{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Mo.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,$i.set(this,null),Qf.set(this,null),Uu.set(this,null),Nl.set(this,null),Vy.set(this,null),Uc.set(this,new Set),Ig.set(this,new Set),Bh.set(this,new Set),Vu.set(this,0),Eg.set(this,!1),jy.set(this,!1),Qb.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return qt(this,Qb,"f")}static createInstance(){return Fe(function*(){if(!io.license)throw Error("Module `license` is not existed.");yield io.license.dynamsoft(),yield Wu(["cvr"]);const n=new gr,o=new Kb;let h=Sr();return Ui[h]=function(){var v=Fe(function*(y){var _;if(y.success)n._instanceID=y.instanceID,n._currentSettings=JSON.parse(y.outputSettings),eK._version=`2.4.20(Worker: ${null===(_=Ll.cvr)||void 0===_?void 0:_.worker}, Wasm: ${y.version})`,xa(n,jy,!0,"f"),xa(n,Nl,n.getIntermediateResultManager(),"f"),xa(n,jy,!1,"f"),o.resolve(n);else{const b=Error(y.message);y.stack&&(b.stack=y.stack),o.reject(b)}});return function(y){return v.apply(this,arguments)}}(),_i.postMessage({type:"cvr_createInstance",id:h}),o})()}_singleFrameModeCallback(n){var o=this;return Fe(function*(){for(let _ of qt(o,Uc,"f"))o._isOutputOriginalImage&&_.onOriginalImageResultReceived&&_.onOriginalImageResultReceived({imageData:n});const h={bytes:new Uint8Array(n.bytes),width:n.width,height:n.height,stride:n.stride,format:n.format,tag:n.tag};o._templateName||(o._templateName=o._currentSettings.CaptureVisionTemplates[0].Name);const v=yield o.capture(h,o._templateName);v.originalImageTag=n.tag;for(let _ of qt(o,Uc,"f"))_.isDce&&_.onCapturedResultReceived(v,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const y={originalImageHashId:v.originalImageHashId,originalImageTag:v.originalImageTag,errorCode:v.errorCode,errorString:v.errorString};for(let _ of qt(o,Uc,"f"))if(_.onDecodedBarcodesReceived&&v.barcodeResultItems&&_.onDecodedBarcodesReceived(Object.assign(Object.assign({},y),{barcodeResultItems:v.barcodeResultItems})),_.onRecognizedTextLinesReceived&&v.textLineResultItems&&_.onRecognizedTextLinesReceived(Object.assign(Object.assign({},y),{textLineResultItems:v.textLineResultItems})),_.onDetectedQuadsReceived&&v.detectedQuadResultItems&&_.onDetectedQuadsReceived(Object.assign(Object.assign({},y),{detectedQuadResultItems:v.detectedQuadResultItems})),_.onNormalizedImagesReceived&&v.normalizedImageResultItems&&_.onNormalizedImagesReceived(Object.assign(Object.assign({},y),{normalizedImageResultItems:v.normalizedImageResultItems})),_.onParsedResultsReceived&&v.parsedResultItems&&_.onParsedResultsReceived(Object.assign(Object.assign({},y),{parsedResultItems:v.parsedResultItems})),_.onCapturedResultReceived&&!_.isDce){if(o._isOutputOriginalImage){const b=v.items.findIndex(w=>1===w.type);-1!==b&&(v.items[b].imageData=n)}_.onCapturedResultReceived(v)}})()}setInput(n){if(fs(this),n){if(xa(this,$i,n,"f"),n.isCameraEnhancer){qt(this,Nl,"f")&&(qt(this,$i,"f")._intermediateResultReceiver.isDce=!0,qt(this,Nl,"f").addResultReceiver(qt(this,$i,"f")._intermediateResultReceiver));const o=qt(this,$i,"f").getCameraView();if(o){const h=o._capturedResultReceiver;h.isDce=!0,qt(this,Uc,"f").add(h)}}}else xa(this,$i,null,"f")}getInput(){return qt(this,$i,"f")}addImageSourceStateListener(n){if(fs(this),"object"!=typeof n)return console.warn("Invalid ISA state listener.");!n||!Object.keys(n)||qt(this,Ig,"f").add(n)}removeImageSourceStateListener(n){return fs(this),qt(this,Ig,"f").delete(n)}addResultReceiver(n){if(fs(this),"object"!=typeof n)throw new Error("Invalid receiver.");!n||!Object.keys(n).length||(qt(this,Uc,"f").add(n),this._setCrrRegistry())}removeResultReceiver(n){fs(this),qt(this,Uc,"f").delete(n),this._setCrrRegistry()}_setCrrRegistry(){var n=this;return Fe(function*(){const o={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let y of qt(n,Uc,"f"))y.isDce||(o.onCapturedResultReceived=!!y.onCapturedResultReceived,o.onDecodedBarcodesReceived=!!y.onDecodedBarcodesReceived,o.onRecognizedTextLinesReceived=!!y.onRecognizedTextLinesReceived,o.onDetectedQuadsReceived=!!y.onDetectedQuadsReceived,o.onNormalizedImagesReceived=!!y.onNormalizedImagesReceived,o.onParsedResultsReceived=!!y.onParsedResultsReceived);const h=new Kb;let v=Sr();return Ui[v]=function(){var y=Fe(function*(_){if(_.success)h.resolve();else{let b=new Error(_.message);b.stack=_.stack+"\n"+b.stack,h.reject()}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_setCrrRegistry",id:v,instanceID:n._instanceID,body:{receiver:JSON.stringify(o)}}),h})()}addResultFilter(n){var o=this;return Fe(function*(){if(fs(o),!n||"object"!=typeof n||!Object.keys(n).length)return console.warn("Invalid filter.");qt(o,Bh,"f").add(n),n._dynamsoft(),yield o._handleFilterUpdate()})()}removeResultFilter(n){var o=this;return Fe(function*(){fs(o),qt(o,Bh,"f").delete(n),yield o._handleFilterUpdate()})()}_handleFilterUpdate(){var n=this;return Fe(function*(){if(qt(n,Nl,"f").removeResultReceiver(nK),0===qt(n,Bh,"f").size){n._isOpenBarcodeVerify=!1,n._isOpenLabelVerify=!1,n._isOpenDetectVerify=!1,n._isOpenNormalizeVerify=!1;const o={[pr.CRIT_BARCODE]:!1,[pr.CRIT_TEXT_LINE]:!1,[pr.CRIT_DETECTED_QUAD]:!1,[pr.CRIT_NORMALIZED_IMAGE]:!1},h={[pr.CRIT_BARCODE]:!1,[pr.CRIT_TEXT_LINE]:!1,[pr.CRIT_DETECTED_QUAD]:!1,[pr.CRIT_NORMALIZED_IMAGE]:!1};return yield iK(n,o),void(yield rK(n,h))}for(let o of qt(n,Bh,"f"))n._isOpenBarcodeVerify=o.isResultCrossVerificationEnabled(pr.CRIT_BARCODE),n._isOpenLabelVerify=o.isResultCrossVerificationEnabled(pr.CRIT_TEXT_LINE),n._isOpenDetectVerify=o.isResultCrossVerificationEnabled(pr.CRIT_DETECTED_QUAD),n._isOpenNormalizeVerify=o.isResultCrossVerificationEnabled(pr.CRIT_NORMALIZED_IMAGE),o.isLatestOverlappingEnabled(pr.CRIT_BARCODE)&&([...qt(n,Nl,"f")._intermediateResultReceiverSet.values()].find(v=>v.isFilter)||qt(n,Nl,"f").addResultReceiver(nK)),yield iK(n,o.verificationEnabled),yield rK(n,o.duplicateFilterEnabled),yield sEe(n,o.duplicateForgetTime)})()}startCapturing(n){var o=this;return Fe(function*(){var h,v;if(fs(o),!o._isPauseScan)return;if(!qt(o,$i,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");n||(n=o._currentSettings.CaptureVisionTemplates[0].Name);const y=yield o.containsTask(n);yield Wu(y);for(let b of qt(o,Bh,"f"))yield o.addResultFilter(b);if(y.includes("dlr")&&!(null===(h=io.dlr)||void 0===h?void 0:h.bLoadConfusableCharsData)){const b=pv(Mo.engineResourcePaths,kn);yield null===(v=io.dlr)||void 0===v?void 0:v.loadRecognitionData("ConfusableChars",b.dlr)}return qt(o,$i,"f").isCameraEnhancer&&(y.includes("ddn")?qt(o,$i,"f").setPixelFormat(Un.IPF_ABGR_8888):qt(o,$i,"f").setPixelFormat(Un.IPF_GRAYSCALED)),void 0!==qt(o,$i,"f").singleFrameMode&&"disabled"!==qt(o,$i,"f").singleFrameMode?(o._templateName=n,void qt(o,$i,"f").on("singleFrameAcquired",o._singleFrameModeCallbackBind)):(qt(o,$i,"f").getColourChannelUsageType()===Nh.CCUT_AUTO&&qt(o,$i,"f").setColourChannelUsageType(y.includes("ddn")?Nh.CCUT_FULL_CHANNEL:Nh.CCUT_Y_CHANNEL_ONLY),qt(o,Uu,"f")&&qt(o,Uu,"f").isPending?qt(o,Uu,"f"):(xa(o,Uu,new Kb((b,w)=>{if(o.disposed)return;let I=Sr();Ui[I]=function(){var A=Fe(function*(M){if(qt(o,Uu,"f")&&!qt(o,Uu,"f").isFulfilled){if(!M.success){let F=new Error(M.message);return F.stack=M.stack+"\n"+F.stack,w(F)}o._isPauseScan=!1,o._isOutputOriginalImage=M.isOutputOriginalImage,o._loopReadVideoTimeoutId&&clearTimeout(o._loopReadVideoTimeoutId),o._loopReadVideoTimeoutId=setTimeout(Fe(function*(){-1!==o._minImageCaptureInterval&&qt(o,$i,"f").startFetching(),o._loopReadVideo(n),b()}),0)}});return function(M){return A.apply(this,arguments)}}(),_i.postMessage({type:"cvr_startCapturing",id:I,instanceID:o._instanceID,body:{templateName:n}})}),"f"),yield qt(o,Uu,"f")))})()}stopCapturing(){if(fs(this),qt(this,$i,"f")){if(qt(this,$i,"f").isCameraEnhancer&&void 0!==qt(this,$i,"f").singleFrameMode&&"disabled"!==qt(this,$i,"f").singleFrameMode)return void qt(this,$i,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind);(function aEe(p){O4.apply(this,arguments)})(this),qt(this,$i,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,xa(this,Uu,null,"f"),qt(this,$i,"f").setColourChannelUsageType(Nh.CCUT_AUTO)}}containsTask(n){var o=this;return Fe(function*(){return fs(o),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success)return h(JSON.parse(b.tasks));{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_containsTask",id:y,instanceID:o._instanceID,body:{templateName:n}})})})()}_loopReadVideo(n){var o=this;return Fe(function*(){if(o.disposed||o._isPauseScan)return;if(xa(o,Eg,!0,"f"),qt(o,$i,"f").isBufferEmpty())if(qt(o,$i,"f").hasNextImageToFetch())for(let v of qt(o,Ig,"f"))v.onImageSourceStateReceived&&v.onImageSourceStateReceived(Jb.ISS_BUFFER_EMPTY);else if(!qt(o,$i,"f").hasNextImageToFetch())for(let v of qt(o,Ig,"f"))v.onImageSourceStateReceived&&v.onImageSourceStateReceived(Jb.ISS_EXHAUSTED);if(-1===o._minImageCaptureInterval||qt(o,$i,"f").isBufferEmpty())try{qt(o,$i,"f").isBufferEmpty()&&gr._onLog&&gr._onLog("buffer is empty so fetch image"),gr._onLog&&gr._onLog(`DCE: start fetching a frame: ${Date.now()}`),o._dsImage=qt(o,$i,"f").fetchImage(),gr._onLog&&gr._onLog(`DCE: finish fetching a frame: ${Date.now()}`),qt(o,$i,"f").setImageFetchInterval(o._averageTime)}catch(v){return void o._reRunCurrnetFunc(n)}else if(qt(o,$i,"f").setImageFetchInterval(o._averageTime-(o._dsImage&&o._dsImage.tag?o._dsImage.tag.timeSpent:0)),o._dsImage=qt(o,$i,"f").getImage(),o._dsImage.tag&&Date.now()-o._dsImage.tag.timeStamp>200)return void o._reRunCurrnetFunc(n);if(!o._dsImage)return void o._reRunCurrnetFunc(n);for(let v of qt(o,Uc,"f"))o._isOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:o._dsImage});const h=Date.now();o._captureDsimage(o._dsImage,n).then(function(){var v=Fe(function*(y){if(gr._onLog&&gr._onLog("no js handle time: "+(Date.now()-h)),o._isPauseScan)return void o._reRunCurrnetFunc(n);y.originalImageTag=o._dsImage.tag?o._dsImage.tag:null;const _={originalImageHashId:y.originalImageHashId,originalImageTag:y.originalImageTag,errorCode:y.errorCode,errorString:y.errorString};for(let w of qt(o,Uc,"f")){if(w.isDce){const I=Date.now();if(w.onCapturedResultReceived(y,{isDetectVerifyOpen:o._isOpenDetectVerify,isNormalizeVerifyOpen:o._isOpenNormalizeVerify,isBarcodeVerifyOpen:o._isOpenBarcodeVerify,isLabelVerifyOpen:o._isOpenLabelVerify}),gr._onLog){const A=Date.now()-I;A>10&&gr._onLog(`draw result time: ${A}`)}}w.onDecodedBarcodesReceived&&y.barcodeResultItems&&w.onDecodedBarcodesReceived(Object.assign(Object.assign({},_),{barcodeResultItems:y.barcodeResultItems.filter(I=>!I.isFilter)})),w.onRecognizedTextLinesReceived&&y.textLineResultItems&&w.onRecognizedTextLinesReceived(Object.assign(Object.assign({},_),{textLineResultItems:y.textLineResultItems.filter(I=>!I.isFilter)})),w.onDetectedQuadsReceived&&y.detectedQuadResultItems&&w.onDetectedQuadsReceived(Object.assign(Object.assign({},_),{detectedQuadResultItems:y.detectedQuadResultItems.filter(I=>!I.isFilter)})),w.onNormalizedImagesReceived&&y.normalizedImageResultItems&&w.onNormalizedImagesReceived(Object.assign(Object.assign({},_),{normalizedImageResultItems:y.normalizedImageResultItems.filter(I=>!I.isFilter)})),w.onParsedResultsReceived&&y.parsedResultItems&&w.onParsedResultsReceived(Object.assign(Object.assign({},_),{parsedResultItems:y.parsedResultItems.filter(I=>!I.isFilter)})),w.onCapturedResultReceived&&!w.isDce&&(y.items=y.items.filter(I=>!I.isFilter),y.barcodeResultItems&&(y.barcodeResultItems=y.barcodeResultItems.filter(I=>!I.isFilter)),y.textLineResultItems&&(y.textLineResultItems=y.textLineResultItems.filter(I=>!I.isFilter)),y.detectedQuadResultItems&&(y.detectedQuadResultItems=y.detectedQuadResultItems.filter(I=>!I.isFilter)),y.normalizedImageResultItems&&(y.normalizedImageResultItems=y.normalizedImageResultItems.filter(I=>!I.isFilter)),y.parsedResultItems&&(y.parsedResultItems=y.parsedResultItems.filter(I=>!I.isFilter)),w.onCapturedResultReceived(y))}const b=Date.now();if(o._minImageCaptureInterval>-1&&(5===o._averageProcessintTimeArray.length&&o._averageProcessintTimeArray.shift(),5===o._averageFetchImageTimeArray.length&&o._averageFetchImageTimeArray.shift(),o._averageProcessintTimeArray.push(Date.now()-h),o._averageFetchImageTimeArray.push(o._dsImage&&o._dsImage.tag?o._dsImage.tag.timeSpent:0),o._averageTime=Math.min(...o._averageProcessintTimeArray)-Math.max(...o._averageFetchImageTimeArray),o._averageTime=o._averageTime>0?o._averageTime:0,gr._onLog&&(gr._onLog(`minImageCaptureInterval: ${o._minImageCaptureInterval}`),gr._onLog(`averageProcessintTimeArray: ${o._averageProcessintTimeArray}`),gr._onLog(`averageFetchImageTimeArray: ${o._averageFetchImageTimeArray}`),gr._onLog(`averageTime: ${o._averageTime}`))),gr._onLog){const w=Date.now()-b;w>10&&gr._onLog(`fetch image calculate time: ${w}`)}gr._onLog&&gr._onLog(`time finish decode: ${Date.now()}`),gr._onLog&&gr._onLog("main time: "+(Date.now()-h)),gr._onLog&&gr._onLog("===================================================="),o._loopReadVideoTimeoutId&&clearTimeout(o._loopReadVideoTimeoutId),o._loopReadVideoTimeoutId=o._minImageCaptureInterval>0&&o._minImageCaptureInterval>=o._averageTime?setTimeout(()=>{o._loopReadVideo(n)},o._minImageCaptureInterval-o._averageTime):setTimeout(()=>{o._loopReadVideo(n)},Math.max(o._minImageCaptureInterval,0))});return function(y){return v.apply(this,arguments)}}()).catch(v=>{qt(o,$i,"f").stopFetching(),v.errorCode&&0===v.errorCode&&(o._loopReadVideoTimeoutId&&clearTimeout(o._loopReadVideoTimeoutId),o._loopReadVideoTimeoutId=setTimeout(()=>{qt(o,$i,"f").startFetching(),o._loopReadVideo(n)},Math.max(o._minImageCaptureInterval,1e3))),"platform error"!==v.message&&setTimeout(()=>{throw v},0)})})()}_reRunCurrnetFunc(n){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(n)},0)}capture(n,o){var h=this;return Fe(function*(){var v,y;fs(h),o||(o=h._currentSettings.CaptureVisionTemplates[0].Name);const _=yield h.containsTask(o);if(yield Wu(_),_.includes("dlr")&&!(null===(v=io.dlr)||void 0===v?void 0:v.bLoadConfusableCharsData)){const w=pv(Mo.engineResourcePaths,kn);yield null===(y=io.dlr)||void 0===y?void 0:y.loadRecognitionData("ConfusableChars",w.dlr)}let b;if(xa(h,Eg,!1,"f"),Gb(n))b=yield h._captureDsimage(n,o);else if("string"==typeof n)b="data:image/"==n.substring(0,11)?yield h._captureBase64(n,o):yield h._captureUrl(n,o);else if(n instanceof Blob)b=yield h._captureBlob(n,o);else if(n instanceof HTMLImageElement)b=yield h._captureImage(n,o);else if(n instanceof HTMLCanvasElement)b=yield h._captureCanvas(n,o);else{if(!(n instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");b=yield h._captureVideo(n,o)}return b})()}_captureDsimage(n,o){var h=this;return Fe(function*(){return yield h._captureInWorker(n,o)})()}_captureUrl(n,o){var h=this;return Fe(function*(){let v=yield p4(n,"blob");return yield h._captureBlob(v,o)})()}_captureBase64(n,o){var h=this;return Fe(function*(){n=n.substring(n.indexOf(",")+1);let v=atob(n),y=v.length,_=new Uint8Array(y);for(;y--;)_[y]=v.charCodeAt(y);return yield h._captureBlob(new Blob([_]),o)})()}_captureBlob(n,o){var h=this;return Fe(function*(){const v=function(){var w=Fe(function*(I){return yield new Promise((A,M)=>{let F=URL.createObjectURL(I),V=new Image;V.src=F,V.onload=()=>{URL.revokeObjectURL(V.dbrObjUrl),A(V)},V.onerror=B=>{M(new Error("Can't convert blob to image : "+(B instanceof Event?B.type:B)))}})});return function(A){return w.apply(this,arguments)}}();let y=null,_=null;if("undefined"!=typeof createImageBitmap)try{y=yield createImageBitmap(n)}catch(w){}y||(_=yield v(n));let b=yield h._captureImage(y||_,o);return y&&y.close(),b})()}_captureImage(n,o){var h=this;return Fe(function*(){let b,w,v=n instanceof HTMLImageElement?n.naturalWidth:n.width,y=n instanceof HTMLImageElement?n.naturalHeight:n.height,_=Math.max(v,y);_>h.maxCvsSideLength?(xa(h,Vu,h.maxCvsSideLength/_,"f"),b=Math.round(v*qt(h,Vu,"f")),w=Math.round(y*qt(h,Vu,"f"))):(b=v,w=y),qt(h,Qf,"f")||xa(h,Qf,document.createElement("canvas"),"f");const I=qt(h,Qf,"f");return(I.width!==b||I.height!==w)&&(I.width=b,I.height=w),I.ctx2d||(I.ctx2d=I.getContext("2d",{willReadFrequently:!0})),I.ctx2d.drawImage(n,0,0,v,y,0,0,b,w),n.dbrObjUrl&&URL.revokeObjectURL(n.dbrObjUrl),yield h._captureCanvas(I,o)})()}_captureCanvas(n,o){var h=this;return Fe(function*(){if(n.crossOrigin&&"anonymous"!=n.crossOrigin)throw"cors";if([n.width,n.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const v=n.ctx2d||n.getContext("2d",{willReadFrequently:!0}),_={bytes:Uint8Array.from(v.getImageData(0,0,n.width,n.height).data),width:n.width,height:n.height,stride:4*n.width,format:10};return yield h._captureInWorker(_,o)})()}_captureVideo(n,o){var h=this;return Fe(function*(){if(n.crossOrigin&&"anonymous"!=n.crossOrigin)throw"cors";let b,w,v=n.videoWidth,y=n.videoHeight,_=Math.max(v,y);_>h.maxCvsSideLength?(xa(h,Vu,h.maxCvsSideLength/_,"f"),b=Math.round(v*qt(h,Vu,"f")),w=Math.round(y*qt(h,Vu,"f"))):(b=v,w=y),qt(h,Qf,"f")||xa(h,Qf,document.createElement("canvas"),"f");const I=qt(h,Qf,"f");return(I.width!==b||I.height!==w)&&(I.width=b,I.height=w),I.ctx2d||(I.ctx2d=I.getContext("2d",{willReadFrequently:!0})),I.ctx2d.drawImage(n,0,0,v,y,0,0,b,w),yield h._captureCanvas(I,o)})()}_captureInWorker(n,o){var h=this;return Fe(function*(){const{bytes:v,width:y,height:_,stride:b,format:w}=n;let I=Sr();const A=new Kb;return Ui[I]=function(){var M=Fe(function*(F){var V,B;if(!F.success){let Q=new Error(F.message);return Q.stack=F.stack+"\n"+Q.stack,A.reject(Q)}{const Q=Date.now();gr._onLog&&(gr._onLog(`get result time from worker: ${Q}`),gr._onLog("worker to main time consume: "+(Q-F.workerReturnMsgTime)));try{const J=F.captureResult;if(0!==J.errorCode){let re=new Error(J.errorString);return re.errorCode=J.errorCode,A.reject(re)}n.bytes=F.bytes;for(let re of J.items)0!==qt(h,Vu,"f")&&tK(re,qt(h,Vu,"f")),re.type===pr.CRIT_ORIGINAL_IMAGE?re.imageData=n:re.type===pr.CRIT_NORMALIZED_IMAGE?null===(V=io.ddn)||void 0===V||V.handleNormalizedImageResultItem(re):re.type===pr.CRIT_PARSED_RESULT&&(null===(B=io.dcp)||void 0===B||B.handleParsedResultItem(re));if(qt(h,Eg,"f"))for(let re of qt(h,Bh,"f"))re.onDecodedBarcodesReceived(J),re.onRecognizedTextLinesReceived(J),re.onDetectedQuadsReceived(J),re.onNormalizedImagesReceived(J);const Z=function oEe(p){const n={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return p.items.forEach(o=>{o.type===pr.CRIT_BARCODE?n.barcodeResultItems.push(o):o.type===pr.CRIT_TEXT_LINE?n.textLineResultItems.push(o):o.type===pr.CRIT_DETECTED_QUAD?n.detectedQuadResultItems.push(o):o.type===pr.CRIT_NORMALIZED_IMAGE?n.normalizedImageResultItems.push(o):o.type===pr.CRIT_PARSED_RESULT&&n.parsedResultItems.push(o)}),n}(J);if(Z.barcodeResultItems.length&&(J.barcodeResultItems=Z.barcodeResultItems),Z.textLineResultItems.length&&(J.textLineResultItems=Z.textLineResultItems),Z.detectedQuadResultItems.length&&(J.detectedQuadResultItems=Z.detectedQuadResultItems),Z.normalizedImageResultItems.length&&(J.normalizedImageResultItems=Z.normalizedImageResultItems),Z.parsedResultItems.length&&(J.parsedResultItems=Z.parsedResultItems),!h._isPauseScan||!qt(h,Eg,"f")){const re=J.intermediateResult;if(re){let se=0;for(let ce of qt(h,Nl,"f")._intermediateResultReceiverSet){se++;for(let pe of re){if("onTaskResultsReceived"===pe.info.callbackName){for(let Ce of pe.intermediateResultUnits)Ce.originalImageTag=n.tag?n.tag:null;ce[pe.info.callbackName]&&ce[pe.info.callbackName]({intermediateResultUnits:pe.intermediateResultUnits},pe.info)}else ce[pe.info.callbackName]&&ce[pe.info.callbackName](pe.result,pe.info);se===qt(h,Nl,"f")._intermediateResultReceiverSet.size&&delete pe.info.callbackName}}}}return J&&J.hasOwnProperty("intermediateResult")&&delete J.intermediateResult,xa(h,Vu,0,"f"),A.resolve(J)}catch(J){return A.reject(J)}}});return function(F){return M.apply(this,arguments)}}(),gr._onLog&&gr._onLog(`send buffer to worker: ${Date.now()}`),_i.postMessage({type:"cvr_capture",id:I,instanceID:h._instanceID,body:{bytes:v,width:y,height:_,stride:b,format:w,templateName:o||"",isScanner:qt(h,Eg,"f")}},[v.buffer]),A})()}initSettings(n){var o=this;return Fe(function*(){return fs(o),n&&["string","object"].includes(typeof n)?("string"==typeof n?(n.startsWith("{")||(n=yield p4(n,"text")),o._currentSettings=JSON.parse(n)):"object"==typeof n&&(o._currentSettings=n,n=JSON.stringify(n)),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success){const w=JSON.parse(b.response);if(0!==w.exception){let M=new Error(w.description?w.description:"Init Settings Failed.");return M.errorCode=w.exception,v(M)}let I=[],A=JSON.parse(n).CaptureVisionTemplates;for(let M=0;M<A.length;M++){let F=yield o.containsTask(A[M].Name);I=I.concat(F)}return yield Wu([...new Set(I)]),o._isOutputOriginalImage=1===o._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,h(w)}{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_initSettings",id:y,instanceID:o._instanceID,body:{settings:n}})})):console.error("Invalid template.")})()}outputSettings(n){var o=this;return Fe(function*(){return fs(o),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success){const w=JSON.parse(b.settings);if(0!==w.errorCode){let I=new Error(w.errorString);return I.errorCode=w.errorCode,v(I)}return delete w.errorCode,delete w.errorString,h(w)}{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_outputSettings",id:y,instanceID:o._instanceID,body:{templateName:n||"*"}})})})()}outputSettingsToFile(n,o,h){var v=this;return Fe(function*(){const y=yield v.outputSettings(n),_=new Blob([JSON.stringify(y,null,2,function(b,w){return w instanceof Array?JSON.stringify(w):w},2)],{type:"application/json"});if(h){const b=document.createElement("a");b.href=URL.createObjectURL(_),o.endsWith(".json")&&(o=o.replace(".json","")),b.download=`${o}.json`,b.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(b.href)},500)},b.click()}return _})()}getSimplifiedSettings(n){var o=this;return Fe(function*(){fs(o),n||(n=o._currentSettings.CaptureVisionTemplates[0].Name);const h=yield o.containsTask(n);return yield Wu(h),yield new Promise((v,y)=>{let _=Sr();Ui[_]=function(){var b=Fe(function*(w){if(w.success){const I=JSON.parse(w.settings,(A,M)=>"barcodeFormatIds"===A?BigInt(M):M);if(I.minImageCaptureInterval=o._minImageCaptureInterval,0!==I.code){let A=new Error(I.codeString);return A.errorCode=I.errorCode,y(A)}return delete I.code,delete I.codeString,v(I)}{let I=new Error(w.message);return I.stack=w.stack+"\n"+I.stack,y(I)}});return function(w){return b.apply(this,arguments)}}(),_i.postMessage({type:"cvr_getSimplifiedSettings",id:_,instanceID:o._instanceID,body:{templateName:n}})})})()}updateSettings(n,o){var h=this;return Fe(function*(){fs(h);const v=yield h.containsTask(n);return yield Wu(v),yield new Promise((y,_)=>{let b=Sr();Ui[b]=function(){var w=Fe(function*(I){if(I.success){const A=JSON.parse(I.response);if(o.minImageCaptureInterval&&o.minImageCaptureInterval>=-1&&(h._minImageCaptureInterval=o.minImageCaptureInterval),h._isOutputOriginalImage=I.isOutputOriginalImage,0!==A.exception){let M=new Error(A.description?A.description:"Update Settings Failed.");return M.errorCode=A.exception,_(M)}return h._currentSettings=yield h.outputSettings("*"),y(A)}{let A=new Error(I.message);return A.stack=I.stack+"\n"+A.stack,_(A)}});return function(I){return w.apply(this,arguments)}}(),_i.postMessage({type:"cvr_updateSettings",id:b,instanceID:h._instanceID,body:{settings:o,templateName:n}})})})()}resetSettings(){var n=this;return Fe(function*(){return fs(n),yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success){const b=JSON.parse(_.response);if(0!==b.exception){let w=new Error(b.description?b.description:"Reset Settings Failed.");return w.errorCode=b.exception,h(w)}return n._currentSettings=yield n.outputSettings("*"),o(b)}{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_resetSettings",id:v,instanceID:n._instanceID})})})()}getBufferedItemsManager(){return qt(this,Vy,"f")||xa(this,Vy,new nEe(this),"f"),qt(this,Vy,"f")}getIntermediateResultManager(){if(fs(this),!qt(this,jy,"f")&&0!==Mo.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return qt(this,Nl,"f")||xa(this,Nl,new rEe(this),"f"),qt(this,Nl,"f")}parseRequiredResources(n){var o=this;return Fe(function*(){return fs(o),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success)return h(JSON.parse(b.resources));{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"cvr_parseRequiredResources",id:y,instanceID:o._instanceID,body:{templateName:n}})})})()}dispose(){var n=this;return Fe(function*(){fs(n),qt(n,Uu,"f")&&n.stopCapturing(),xa(n,$i,null,"f"),qt(n,Uc,"f").clear(),qt(n,Ig,"f").clear(),qt(n,Bh,"f").clear(),qt(n,Nl,"f")._intermediateResultReceiverSet.clear(),xa(n,Qb,!0,"f");let o=Sr();Ui[o]=h=>{if(!h.success){let v=new Error(h.message);throw v.stack=h.stack+"\n"+v.stack,v}},_i.postMessage({type:"cvr_dispose",id:o,instanceID:n._instanceID})})()}_getInternalData(){return{isa:qt(this,$i,"f"),promiseStartScan:qt(this,Uu,"f"),intermediateResultManager:qt(this,Nl,"f"),bufferdItemsManager:qt(this,Vy,"f"),resultReceiverSet:qt(this,Uc,"f"),isaStateListenerSet:qt(this,Ig,"f"),resultFilterSet:qt(this,Bh,"f"),compressRate:qt(this,Vu,"f"),canvas:qt(this,Qf,"f"),isScanner:qt(this,Eg,"f"),innerUseTag:qt(this,jy,"f"),isDestroyed:qt(this,Qb,"f")}}_getWasmFilterState(){var n=this;return Fe(function*(){return yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success){const b=JSON.parse(_.response);return o(b)}{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_getWasmFilterState",id:v,instanceID:n._instanceID})})})()}}function iK(p,n){return R4.apply(this,arguments)}function R4(){return R4=Fe(function*(p,n){return fs(p),yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_enableResultCrossVerification",id:v,instanceID:p._instanceID,body:{verificationEnabled:n}})})}),R4.apply(this,arguments)}function rK(p,n){return k4.apply(this,arguments)}function k4(){return k4=Fe(function*(p,n){return fs(p),yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_enableResultDeduplication",id:v,instanceID:p._instanceID,body:{duplicateFilterEnabled:n}})})}),k4.apply(this,arguments)}function sEe(p,n){return M4.apply(this,arguments)}function M4(){return M4=Fe(function*(p,n){return fs(p),yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o(_.result);{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"cvr_setDuplicateForgetTime",id:v,instanceID:p._instanceID,body:{duplicateForgetTime:n}})})}),M4.apply(this,arguments)}function O4(){return O4=Fe(function*(p){let n=Sr();const o=new Kb;return Ui[n]=function(){var h=Fe(function*(v){if(v.success)return o.resolve();{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,o.reject(y)}});return function(v){return h.apply(this,arguments)}}(),_i.postMessage({type:"cvr_clearVerifyList",id:n,instanceID:p._instanceID}),o}),O4.apply(this,arguments)}$i=new WeakMap,Qf=new WeakMap,Uu=new WeakMap,Nl=new WeakMap,Vy=new WeakMap,Uc=new WeakMap,Ig=new WeakMap,Bh=new WeakMap,Vu=new WeakMap,Eg=new WeakMap,jy=new WeakMap,Qb=new WeakMap;const F4="undefined"==typeof self,lEe=(()=>{if(!F4&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();function qe(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function Ln(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}let Zb,Zf,TI,II,la;kn.dce={version:"4.1.0",path:lEe},Bu.dce={wasm:!1,js:!1},io.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(Zb=navigator,Zf=Zb.userAgent,TI=Zb.platform,II=Zb.mediaDevices),function(){if(!F4){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Zb.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:TI,search:"Win"},Mac:{str:TI},Linux:{str:TI}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||Zf,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||Zf).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||Zf).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=Zf.indexOf("Windows NT")&&(v="HarmonyOS"),la={browser:o,version:h,OS:v}}F4&&(la={browser:"ssr",version:0,OS:"ssr"})}();const cEe="undefined"!=typeof WebAssembly&&Zf&&!(/Safari/.test(Zf)&&!/Chrome/.test(Zf)&&/\(.+\s11_2_([2-6]).*\)/.test(Zf)),uEe="undefined"!=typeof Worker,oK=!(!II||!II.getUserMedia),dEe=function(){var p=Fe(function*(){let n=!1;if(oK)try{(yield II.getUserMedia({video:!0})).getTracks().forEach(o=>{o.stop()}),n=!0}catch(o){}return n});return function(){return p.apply(this,arguments)}}();var hEe={653:(p,n,o)=>{var h,v,y,_,b,w,I,A,M,F,B,Q,J,Z,re,se,ce,pe,Ce,Ve,j,L,Y,q,te=te||{version:"5.2.1"};if(n.fabric=te,"undefined"!=typeof document&&"undefined"!=typeof window)te.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),te.window=window;else{var Me=new(o(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;te.document=Me.document,te.jsdomImplForWrapper=o(898).implForWrapper,te.nodeCanvas=o(245).Canvas,te.window=Me,DOMParser=te.window.DOMParser}function we(j,L){var Y=j.canvas,q=L.targetCanvas,k=q.getContext("2d");k.translate(0,q.height),k.scale(1,-1),k.drawImage(Y,0,Y.height-q.height,q.width,q.height,0,0,q.width,q.height)}function Le(j,L){var Y=L.targetCanvas.getContext("2d"),q=L.destinationWidth,k=L.destinationHeight,N=q*k*4,$=new Uint8Array(this.imageBuffer,0,N),ie=new Uint8ClampedArray(this.imageBuffer,0,N);j.readPixels(0,0,q,k,j.RGBA,j.UNSIGNED_BYTE,$);var ee=new ImageData(ie,q,k);Y.putImageData(ee,0,0)}te.isTouchSupported="ontouchstart"in te.window||"ontouchstart"in te.document||te.window&&te.window.navigator&&te.window.navigator.maxTouchPoints>0,te.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,te.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],te.DPI=96,te.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",te.commaWsp="(?:\\s+,?\\s*|,\\s*)",te.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,te.reNonWord=/[ \n\.,;!\?\-]/,te.fontPaths={},te.iMatrix=[1,0,0,1,0,0],te.svgNS="http://www.w3.org/2000/svg",te.perfLimitSizeTotal=2097152,te.maxCacheSideLimit=4096,te.minCacheSideLimit=256,te.charWidthsCache={},te.textureSize=2048,te.disableStyleCopyPaste=!1,te.enableGLFiltering=!0,te.devicePixelRatio=te.window.devicePixelRatio||te.window.webkitDevicePixelRatio||te.window.mozDevicePixelRatio||1,te.browserShadowBlurConstant=1,te.arcToSegmentsCache={},te.boundsOfCurveCache={},te.cachesBoundsOfCurve=!0,te.forceGLPutImageData=!1,te.initFilterBackend=function(){return te.enableGLFiltering&&te.isWebglSupported&&te.isWebglSupported(te.textureSize)?(console.log("max texture size: "+te.maxTextureSize),new te.WebglFilterBackend({tileSize:te.textureSize})):te.Canvas2dFilterBackend?new te.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=te),function(){function j(Y,q){if(this.__eventListeners[Y]){var k=this.__eventListeners[Y];q?k[k.indexOf(q)]=!1:te.util.array.fill(k,!1)}}function L(Y,q){var k=function(){q.apply(this,arguments),this.off(Y,k)}.bind(this);this.on(Y,k)}te.Observable={fire:function(Y,q){if(!this.__eventListeners)return this;var k=this.__eventListeners[Y];if(!k)return this;for(var N=0,$=k.length;N<$;N++)k[N]&&k[N].call(this,q||{});return this.__eventListeners[Y]=k.filter(function(ie){return!1!==ie}),this},on:function(Y,q){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var k in Y)this.on(k,Y[k]);else this.__eventListeners[Y]||(this.__eventListeners[Y]=[]),this.__eventListeners[Y].push(q);return this},once:function(Y,q){if(1===arguments.length)for(var k in Y)L.call(this,k,Y[k]);else L.call(this,Y,q);return this},off:function(Y,q){if(!this.__eventListeners)return this;if(0===arguments.length)for(Y in this.__eventListeners)j.call(this,Y);else if(1===arguments.length&&"object"==typeof arguments[0])for(var k in Y)j.call(this,k,Y[k]);else j.call(this,Y,q);return this}}}(),te.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var j=0,L=arguments.length;j<L;j++)this._onObjectAdded(arguments[j]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(j,L,Y){var q=this._objects;return Y?q[L]=j:q.splice(L,0,j),this._onObjectAdded&&this._onObjectAdded(j),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var j,L=this._objects,Y=!1,q=0,k=arguments.length;q<k;q++)-1!==(j=L.indexOf(arguments[q]))&&(Y=!0,L.splice(j,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[q]));return this.renderOnAddRemove&&Y&&this.requestRenderAll(),this},forEachObject:function(j,L){for(var Y=this.getObjects(),q=0,k=Y.length;q<k;q++)j.call(L,Y[q],q,Y);return this},getObjects:function(j){return void 0===j?this._objects.concat():this._objects.filter(function(L){return L.type===j})},item:function(j){return this._objects[j]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(j,L){return this._objects.indexOf(j)>-1||!!L&&this._objects.some(function(Y){return"function"==typeof Y.contains&&Y.contains(j,!0)})},complexity:function(){return this._objects.reduce(function(j,L){return j+(L.complexity?L.complexity():0)},0)}},te.CommonMethods={_setOptions:function(j){for(var L in j)this.set(L,j[L])},_initGradient:function(j,L){!j||!j.colorStops||j instanceof te.Gradient||this.set(L,new te.Gradient(j))},_initPattern:function(j,L,Y){!j||!j.source||j instanceof te.Pattern?Y&&Y():this.set(L,new te.Pattern(j,Y))},_setObject:function(j){for(var L in j)this._set(L,j[L])},set:function(j,L){return"object"==typeof j?this._setObject(j):this._set(j,L),this},_set:function(j,L){this[j]=L},toggle:function(j){var L=this.get(j);return"boolean"==typeof L&&this.set(j,!L),this},get:function(j){return this[j]}},h=n,v=Math.sqrt,y=Math.atan2,_=Math.pow,b=Math.PI/180,w=Math.PI/2,te.util={cos:function(j){if(0===j)return 1;switch(j<0&&(j=-j),j/w){case 1:case 3:return 0;case 2:return-1}return Math.cos(j)},sin:function(j){if(0===j)return 0;var L=1;switch(j<0&&(L=-1),j/w){case 1:return L;case 2:return 0;case 3:return-L}return Math.sin(j)},removeFromArray:function(j,L){var Y=j.indexOf(L);return-1!==Y&&j.splice(Y,1),j},getRandomInt:function(j,L){return Math.floor(Math.random()*(L-j+1))+j},degreesToRadians:function(j){return j*b},radiansToDegrees:function(j){return j/b},rotatePoint:function(j,L,Y){var q=new te.Point(j.x-L.x,j.y-L.y),k=te.util.rotateVector(q,Y);return new te.Point(k.x,k.y).addEquals(L)},rotateVector:function(j,L){var Y=te.util.sin(L),q=te.util.cos(L);return{x:j.x*q-j.y*Y,y:j.x*Y+j.y*q}},createVector:function(j,L){return new te.Point(L.x-j.x,L.y-j.y)},calcAngleBetweenVectors:function(j,L){return Math.acos((j.x*L.x+j.y*L.y)/(Math.hypot(j.x,j.y)*Math.hypot(L.x,L.y)))},getHatVector:function(j){return new te.Point(j.x,j.y).multiply(1/Math.hypot(j.x,j.y))},getBisector:function(j,L,Y){var q=te.util.createVector(j,L),k=te.util.createVector(j,Y),N=te.util.calcAngleBetweenVectors(q,k),$=N*(0===te.util.calcAngleBetweenVectors(te.util.rotateVector(q,N),k)?1:-1)/2;return{vector:te.util.getHatVector(te.util.rotateVector(q,$)),angle:N}},projectStrokeOnPoints:function(j,L,Y){var q=[],k=L.strokeWidth/2,N=L.strokeUniform?new te.Point(1/L.scaleX,1/L.scaleY):new te.Point(1,1),$=function(ie){var ee=k/Math.hypot(ie.x,ie.y);return new te.Point(ie.x*ee*N.x,ie.y*ee*N.y)};return j.length<=1||j.forEach(function(ie,ee){var ne,le,fe=new te.Point(ie.x,ie.y);0===ee?(le=j[ee+1],ne=Y?$(te.util.createVector(le,fe)).addEquals(fe):j[j.length-1]):ee===j.length-1?(ne=j[ee-1],le=Y?$(te.util.createVector(ne,fe)).addEquals(fe):j[0]):(ne=j[ee-1],le=j[ee+1]);var xe,Pe,De=te.util.getBisector(fe,ne,le),je=De.vector;if("miter"===L.strokeLineJoin&&(xe=-k/Math.sin(De.angle/2),Pe=new te.Point(je.x*xe*N.x,je.y*xe*N.y),Math.hypot(Pe.x,Pe.y)/k<=L.strokeMiterLimit))return q.push(fe.add(Pe)),void q.push(fe.subtract(Pe));xe=-k*Math.SQRT2,Pe=new te.Point(je.x*xe*N.x,je.y*xe*N.y),q.push(fe.add(Pe)),q.push(fe.subtract(Pe))}),q},transformPoint:function(j,L,Y){return Y?new te.Point(L[0]*j.x+L[2]*j.y,L[1]*j.x+L[3]*j.y):new te.Point(L[0]*j.x+L[2]*j.y+L[4],L[1]*j.x+L[3]*j.y+L[5])},makeBoundingBoxFromPoints:function(j,L){if(L)for(var Y=0;Y<j.length;Y++)j[Y]=te.util.transformPoint(j[Y],L);var q=[j[0].x,j[1].x,j[2].x,j[3].x],k=te.util.array.min(q),N=te.util.array.max(q)-k,$=[j[0].y,j[1].y,j[2].y,j[3].y],ie=te.util.array.min($);return{left:k,top:ie,width:N,height:te.util.array.max($)-ie}},invertTransform:function(j){var L=1/(j[0]*j[3]-j[1]*j[2]),Y=[L*j[3],-L*j[1],-L*j[2],L*j[0]],q=te.util.transformPoint({x:j[4],y:j[5]},Y,!0);return Y[4]=-q.x,Y[5]=-q.y,Y},toFixed:function(j,L){return parseFloat(Number(j).toFixed(L))},parseUnit:function(j,L){var Y=/\D{0,2}$/.exec(j),q=parseFloat(j);switch(L||(L=te.Text.DEFAULT_SVG_FONT_SIZE),Y[0]){case"mm":return q*te.DPI/25.4;case"cm":return q*te.DPI/2.54;case"in":return q*te.DPI;case"pt":return q*te.DPI/72;case"pc":return q*te.DPI/72*12;case"em":return q*L;default:return q}},falseFunction:function(){return!1},getKlass:function(j,L){return j=te.util.string.camelize(j.charAt(0).toUpperCase()+j.slice(1)),te.util.resolveNamespace(L)[j]},getSvgAttributes:function(j){var L=["instantiated_by_use","style","id","class"];switch(j){case"linearGradient":L=L.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":L=L.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":L=L.concat(["offset","stop-color","stop-opacity"])}return L},resolveNamespace:function(j){if(!j)return te;var L,Y=j.split("."),q=Y.length,k=h||te.window;for(L=0;L<q;++L)k=k[Y[L]];return k},loadImage:function(j,L,Y,q){if(j){var k=te.util.createImage(),N=function(){L&&L.call(Y,k,!1),k=k.onload=k.onerror=null};k.onload=N,k.onerror=function(){te.log("Error loading "+k.src),L&&L.call(Y,null,!0),k=k.onload=k.onerror=null},0!==j.indexOf("data")&&null!=q&&(k.crossOrigin=q),"data:image/svg"===j.substring(0,14)&&(k.onload=null,te.util.loadImageInDom(k,N)),k.src=j}else L&&L.call(Y,j)},loadImageInDom:function(j,L){var Y=te.document.createElement("div");Y.style.width=Y.style.height="1px",Y.style.left=Y.style.top="-100%",Y.style.position="absolute",Y.appendChild(j),te.document.querySelector("body").appendChild(Y),j.onload=function(){L(),Y.parentNode.removeChild(Y),Y=null}},enlivenObjects:function(j,L,Y,q){var k=[],N=0,$=(j=j||[]).length;function ie(){++N===$&&L&&L(k.filter(function(ee){return ee}))}$?j.forEach(function(ee,ne){ee&&ee.type?te.util.getKlass(ee.type,Y).fromObject(ee,function(le,fe){fe||(k[ne]=le),q&&q(ee,le,fe),ie()}):ie()}):L&&L(k)},enlivenObjectEnlivables:function(j,L,Y){var q=te.Object.ENLIVEN_PROPS.filter(function(k){return!!j[k]});te.util.enlivenObjects(q.map(function(k){return j[k]}),function(k){var N={};q.forEach(function($,ie){N[$]=k[ie],L&&(L[$]=k[ie])}),Y&&Y(N)})},enlivenPatterns:function(j,L){function Y(){++k===N&&L&&L(q)}var q=[],k=0,N=(j=j||[]).length;N?j.forEach(function($,ie){$&&$.source?new te.Pattern($,function(ee){q[ie]=ee,Y()}):(q[ie]=$,Y())}):L&&L(q)},groupSVGElements:function(j,L,Y){var q;return j&&1===j.length?j[0]:(L&&(L.width&&L.height?L.centerPoint={x:L.width/2,y:L.height/2}:(delete L.width,delete L.height)),q=new te.Group(j,L),void 0!==Y&&(q.sourcePath=Y),q)},populateWithProperties:function(j,L,Y){if(Y&&Array.isArray(Y))for(var q=0,k=Y.length;q<k;q++)Y[q]in j&&(L[Y[q]]=j[Y[q]])},createCanvasElement:function(){return te.document.createElement("canvas")},copyCanvasElement:function(j){var L=te.util.createCanvasElement();return L.width=j.width,L.height=j.height,L.getContext("2d").drawImage(j,0,0),L},toDataURL:function(j,L,Y){return j.toDataURL("image/"+L,Y)},createImage:function(){return te.document.createElement("img")},multiplyTransformMatrices:function(j,L,Y){return[j[0]*L[0]+j[2]*L[1],j[1]*L[0]+j[3]*L[1],j[0]*L[2]+j[2]*L[3],j[1]*L[2]+j[3]*L[3],Y?0:j[0]*L[4]+j[2]*L[5]+j[4],Y?0:j[1]*L[4]+j[3]*L[5]+j[5]]},qrDecompose:function(j){var L=y(j[1],j[0]),Y=_(j[0],2)+_(j[1],2),q=v(Y),k=(j[0]*j[3]-j[2]*j[1])/q,N=y(j[0]*j[2]+j[1]*j[3],Y);return{angle:L/b,scaleX:q,scaleY:k,skewX:N/b,skewY:0,translateX:j[4],translateY:j[5]}},calcRotateMatrix:function(j){if(!j.angle)return te.iMatrix.concat();var L=te.util.degreesToRadians(j.angle),Y=te.util.cos(L),q=te.util.sin(L);return[Y,q,-q,Y,0,0]},calcDimensionsMatrix:function(j){var L=void 0===j.scaleX?1:j.scaleX,Y=void 0===j.scaleY?1:j.scaleY,q=[j.flipX?-L:L,0,0,j.flipY?-Y:Y,0,0],k=te.util.multiplyTransformMatrices,N=te.util.degreesToRadians;return j.skewX&&(q=k(q,[1,0,Math.tan(N(j.skewX)),1],!0)),j.skewY&&(q=k(q,[1,Math.tan(N(j.skewY)),0,1],!0)),q},composeMatrix:function(j){var L=[1,0,0,1,j.translateX||0,j.translateY||0],Y=te.util.multiplyTransformMatrices;return j.angle&&(L=Y(L,te.util.calcRotateMatrix(j))),(1!==j.scaleX||1!==j.scaleY||j.skewX||j.skewY||j.flipX||j.flipY)&&(L=Y(L,te.util.calcDimensionsMatrix(j))),L},resetObjectTransform:function(j){j.scaleX=1,j.scaleY=1,j.skewX=0,j.skewY=0,j.flipX=!1,j.flipY=!1,j.rotate(0)},saveObjectTransform:function(j){return{scaleX:j.scaleX,scaleY:j.scaleY,skewX:j.skewX,skewY:j.skewY,angle:j.angle,left:j.left,flipX:j.flipX,flipY:j.flipY,top:j.top}},isTransparent:function(j,L,Y,q){q>0&&(L>q?L-=q:L=0,Y>q?Y-=q:Y=0);var k,N=!0,$=j.getImageData(L,Y,2*q||1,2*q||1),ie=$.data.length;for(k=3;k<ie&&0!=(N=$.data[k]<=0);k+=4);return $=null,N},parsePreserveAspectRatioAttribute:function(j){var L,Y="meet",q=j.split(" ");return q&&q.length&&("meet"!==(Y=q.pop())&&"slice"!==Y?(L=Y,Y="meet"):q.length&&(L=q.pop())),{meetOrSlice:Y,alignX:"none"!==L?L.slice(1,4):"none",alignY:"none"!==L?L.slice(5,8):"none"}},clearFabricFontCache:function(j){(j=(j||"").toLowerCase())?te.charWidthsCache[j]&&delete te.charWidthsCache[j]:te.charWidthsCache={}},limitDimsByArea:function(j,L){var Y=Math.sqrt(L*j),q=Math.floor(L/Y);return{x:Math.floor(Y),y:q}},capValue:function(j,L,Y){return Math.max(j,Math.min(L,Y))},findScaleToFit:function(j,L){return Math.min(L.width/j.width,L.height/j.height)},findScaleToCover:function(j,L){return Math.max(L.width/j.width,L.height/j.height)},matrixToSVG:function(j){return"matrix("+j.map(function(L){return te.util.toFixed(L,te.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(j,L){var Y=te.util.invertTransform(L),q=te.util.multiplyTransformMatrices(Y,j.calcOwnMatrix());te.util.applyTransformToObject(j,q)},addTransformToObject:function(j,L){te.util.applyTransformToObject(j,te.util.multiplyTransformMatrices(L,j.calcOwnMatrix()))},applyTransformToObject:function(j,L){var Y=te.util.qrDecompose(L),q=new te.Point(Y.translateX,Y.translateY);j.flipX=!1,j.flipY=!1,j.set("scaleX",Y.scaleX),j.set("scaleY",Y.scaleY),j.skewX=Y.skewX,j.skewY=Y.skewY,j.angle=Y.angle,j.setPositionByOrigin(q,"center","center")},sizeAfterTransform:function(j,L,Y){var q=j/2,k=L/2,N=[{x:-q,y:-k},{x:q,y:-k},{x:-q,y:k},{x:q,y:k}],$=te.util.calcDimensionsMatrix(Y),ie=te.util.makeBoundingBoxFromPoints(N,$);return{x:ie.width,y:ie.height}},mergeClipPaths:function(j,L){var Y=j,q=L;Y.inverted&&!q.inverted&&(Y=L,q=j),te.util.applyTransformToObject(q,te.util.multiplyTransformMatrices(te.util.invertTransform(Y.calcTransformMatrix()),q.calcTransformMatrix()));var k=Y.inverted&&q.inverted;return k&&(Y.inverted=q.inverted=!1),new te.Group([Y],{clipPath:q,inverted:k})}},function(){var j=Array.prototype.join,L={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Y={m:"l",M:"L"};function q(Pe,De,je,ke,Ae,he,tt,Ze,nt,et,Qe){var at=te.util.cos(Pe),vt=te.util.sin(Pe),dt=te.util.cos(De),Je=te.util.sin(De),it=je*Ae*dt-ke*he*Je+tt,ct=ke*Ae*dt+je*he*Je+Ze;return["C",et+nt*(-je*Ae*vt-ke*he*at),Qe+nt*(-ke*Ae*vt+je*he*at),it+nt*(je*Ae*Je+ke*he*dt),ct+nt*(ke*Ae*Je-je*he*dt),it,ct]}function k(Pe,De,je,ke){var Ae=Math.atan2(De,Pe),he=Math.atan2(ke,je);return he>=Ae?he-Ae:2*Math.PI-(Ae-he)}function N(Pe,De,je){for(var nt=function(at,vt,dt,Je,it,ct,wt){var ht=Math.PI,At=wt*ht/180,kt=te.util.sin(At),Bt=te.util.cos(At),Ft=0,Ht=0,Kt=-Bt*at*.5-kt*vt*.5,an=-Bt*vt*.5+kt*at*.5,fn=(dt=Math.abs(dt))*dt,ln=(Je=Math.abs(Je))*Je,wn=an*an,ut=Kt*Kt,ft=fn*ln-fn*wn-ln*ut,Lt=0;if(ft<0){var Ut=Math.sqrt(1-ft/(fn*ln));dt*=Ut,Je*=Ut}else Lt=(it===ct?-1:1)*Math.sqrt(ft/(fn*wn+ln*ut));var sn=Lt*dt*an/Je,Yn=-Lt*Je*Kt/dt,ki=Bt*sn-kt*Yn+.5*at,Hi=kt*sn+Bt*Yn+.5*vt,Qi=k(1,0,(Kt-sn)/dt,(an-Yn)/Je),Lr=k((Kt-sn)/dt,(an-Yn)/Je,(-Kt-sn)/dt,(-an-Yn)/Je);0===ct&&Lr>0?Lr-=2*ht:1===ct&&Lr<0&&(Lr+=2*ht);for(var qa=Math.ceil(Math.abs(Lr/ht*2)),fa=[],rd=Lr/qa,lh=8/3*Math.sin(rd/4)*Math.sin(rd/4)/Math.sin(rd/2),Gw=Qi+rd,fm=0;fm<qa;fm++)fa[fm]=q(Qi,Gw,Bt,kt,dt,Je,ki,Hi,lh,Ft,Ht),Ft=fa[fm][5],Ht=fa[fm][6],Qi=Gw,Gw+=rd;return fa}(je[6]-Pe,je[7]-De,je[1],je[2],je[4],je[5],je[3]),et=0,Qe=nt.length;et<Qe;et++)nt[et][1]+=Pe,nt[et][2]+=De,nt[et][3]+=Pe,nt[et][4]+=De,nt[et][5]+=Pe,nt[et][6]+=De;return nt}function $(Pe,De,je,ke){return Math.sqrt((je-Pe)*(je-Pe)+(ke-De)*(ke-De))}function ie(Pe,De,je,ke,Ae,he,tt,Ze){return function(nt){var et,Je,Qe=(et=nt)*et*et,at=3*(Je=nt)*Je*(1-Je),vt=function(Je){return 3*Je*(1-Je)*(1-Je)}(nt),dt=function(Je){return(1-Je)*(1-Je)*(1-Je)}(nt);return{x:tt*Qe+Ae*at+je*vt+Pe*dt,y:Ze*Qe+he*at+ke*vt+De*dt}}}function ee(Pe,De,je,ke,Ae,he,tt,Ze){return function(nt){var et=1-nt;return Math.atan2(3*et*et*(ke-De)+6*et*nt*(he-ke)+3*nt*nt*(Ze-he),3*et*et*(je-Pe)+6*et*nt*(Ae-je)+3*nt*nt*(tt-Ae))}}function ne(Pe,De,je,ke,Ae,he){return function(tt){var Ze,at,nt=(Ze=tt)*Ze,et=2*(at=tt)*(1-at),Qe=function(at){return(1-at)*(1-at)}(tt);return{x:Ae*nt+je*et+Pe*Qe,y:he*nt+ke*et+De*Qe}}}function le(Pe,De,je,ke,Ae,he){return function(tt){var Ze=1-tt;return Math.atan2(2*Ze*(ke-De)+2*tt*(he-ke),2*Ze*(je-Pe)+2*tt*(Ae-je))}}function fe(Pe,De,je){var ke,Ae,he={x:De,y:je},tt=0;for(Ae=1;Ae<=100;Ae+=1)ke=Pe(Ae/100),tt+=$(he.x,he.y,ke.x,ke.y),he=ke;return tt}function xe(Pe){for(var De,je,ke,Ae,he=0,tt=Pe.length,Ze=0,nt=0,et=0,Qe=0,at=[],vt=0;vt<tt;vt++){switch(ke={x:Ze,y:nt,command:(De=Pe[vt])[0]},De[0]){case"M":ke.length=0,et=Ze=De[1],Qe=nt=De[2];break;case"L":ke.length=$(Ze,nt,De[1],De[2]),Ze=De[1],nt=De[2];break;case"C":je=ie(Ze,nt,De[1],De[2],De[3],De[4],De[5],De[6]),Ae=ee(Ze,nt,De[1],De[2],De[3],De[4],De[5],De[6]),ke.iterator=je,ke.angleFinder=Ae,ke.length=fe(je,Ze,nt),Ze=De[5],nt=De[6];break;case"Q":je=ne(Ze,nt,De[1],De[2],De[3],De[4]),Ae=le(Ze,nt,De[1],De[2],De[3],De[4]),ke.iterator=je,ke.angleFinder=Ae,ke.length=fe(je,Ze,nt),Ze=De[3],nt=De[4];break;case"Z":case"z":ke.destX=et,ke.destY=Qe,ke.length=$(Ze,nt,et,Qe),Ze=et,nt=Qe}he+=ke.length,at.push(ke)}return at.push({length:he,x:Ze,y:nt}),at}te.util.joinPath=function(Pe){return Pe.map(function(De){return De.join(" ")}).join(" ")},te.util.parsePath=function(Pe){var De,je,ke,Ae,he,tt=[],Ze=[],nt=te.rePathCommand,et="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",Qe="("+et+")"+te.commaWsp,at="([01])"+te.commaWsp+"?",vt=new RegExp(Qe+"?"+Qe+"?"+Qe+at+at+Qe+"?("+et+")","g");if(!Pe||!Pe.match)return tt;for(var dt,Je=0,it=(he=Pe.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;Je<it;Je++){Ae=(De=he[Je]).slice(1).trim(),Ze.length=0;var ct=De.charAt(0);if(dt=[ct],"a"===ct.toLowerCase())for(var wt;wt=vt.exec(Ae);)for(var ht=1;ht<wt.length;ht++)Ze.push(wt[ht]);else for(;ke=nt.exec(Ae);)Ze.push(ke[0]);ht=0;for(var At=Ze.length;ht<At;ht++)je=parseFloat(Ze[ht]),isNaN(je)||dt.push(je);var kt=L[ct.toLowerCase()],Bt=Y[ct]||ct;if(dt.length-1>kt)for(var Ft=1,Ht=dt.length;Ft<Ht;Ft+=kt)tt.push([ct].concat(dt.slice(Ft,Ft+kt))),ct=Bt;else tt.push(dt)}return tt},te.util.makePathSimpler=function(Pe){var De,je,ke,Ae,he,tt,Ze=0,nt=0,et=Pe.length,Qe=0,at=0,vt=[];for(je=0;je<et;++je){switch(ke=!1,(De=Pe[je].slice(0))[0]){case"l":De[0]="L",De[1]+=Ze,De[2]+=nt;case"L":Ze=De[1],nt=De[2];break;case"h":De[1]+=Ze;case"H":De[0]="L",De[2]=nt,Ze=De[1];break;case"v":De[1]+=nt;case"V":De[0]="L",nt=De[1],De[1]=Ze,De[2]=nt;break;case"m":De[0]="M",De[1]+=Ze,De[2]+=nt;case"M":Ze=De[1],nt=De[2],Qe=De[1],at=De[2];break;case"c":De[0]="C",De[1]+=Ze,De[2]+=nt,De[3]+=Ze,De[4]+=nt,De[5]+=Ze,De[6]+=nt;case"C":he=De[3],tt=De[4],Ze=De[5],nt=De[6];break;case"s":De[0]="S",De[1]+=Ze,De[2]+=nt,De[3]+=Ze,De[4]+=nt;case"S":"C"===Ae?(he=2*Ze-he,tt=2*nt-tt):(he=Ze,tt=nt),Ze=De[3],nt=De[4],De[0]="C",De[5]=De[3],De[6]=De[4],De[3]=De[1],De[4]=De[2],De[1]=he,De[2]=tt,he=De[3],tt=De[4];break;case"q":De[0]="Q",De[1]+=Ze,De[2]+=nt,De[3]+=Ze,De[4]+=nt;case"Q":he=De[1],tt=De[2],Ze=De[3],nt=De[4];break;case"t":De[0]="T",De[1]+=Ze,De[2]+=nt;case"T":"Q"===Ae?(he=2*Ze-he,tt=2*nt-tt):(he=Ze,tt=nt),De[0]="Q",Ze=De[1],nt=De[2],De[1]=he,De[2]=tt,De[3]=Ze,De[4]=nt;break;case"a":De[0]="A",De[6]+=Ze,De[7]+=nt;case"A":ke=!0,vt=vt.concat(N(Ze,nt,De)),Ze=De[6],nt=De[7];break;case"z":case"Z":Ze=Qe,nt=at}ke||vt.push(De),Ae=De[0]}return vt},te.util.getSmoothPathFromPoints=function(Pe,De){var je,ke=[],Ae=new te.Point(Pe[0].x,Pe[0].y),he=new te.Point(Pe[1].x,Pe[1].y),tt=Pe.length,Ze=1,nt=0,et=tt>2;for(et&&(Ze=Pe[2].x<he.x?-1:Pe[2].x===he.x?0:1,nt=Pe[2].y<he.y?-1:Pe[2].y===he.y?0:1),ke.push(["M",Ae.x-Ze*(De=De||0),Ae.y-nt*De]),je=1;je<tt;je++){if(!Ae.eq(he)){var Qe=Ae.midPointFrom(he);ke.push(["Q",Ae.x,Ae.y,Qe.x,Qe.y])}Ae=Pe[je],je+1<Pe.length&&(he=Pe[je+1])}return et&&(Ze=Ae.x>Pe[je-2].x?1:Ae.x===Pe[je-2].x?0:-1,nt=Ae.y>Pe[je-2].y?1:Ae.y===Pe[je-2].y?0:-1),ke.push(["L",Ae.x+Ze*De,Ae.y+nt*De]),ke},te.util.getPathSegmentsInfo=xe,te.util.getBoundsOfCurve=function(Pe,De,je,ke,Ae,he,tt,Ze){var nt;if(te.cachesBoundsOfCurve&&(nt=j.call(arguments),te.boundsOfCurveCache[nt]))return te.boundsOfCurveCache[nt];var et,Qe,at,vt,dt,Je,it,ct,wt=Math.sqrt,ht=Math.min,At=Math.max,kt=Math.abs,Bt=[],Ft=[[],[]];Qe=6*Pe-12*je+6*Ae,et=-3*Pe+9*je-9*Ae+3*tt,at=3*je-3*Pe;for(var Ht=0;Ht<2;++Ht)if(Ht>0&&(Qe=6*De-12*ke+6*he,et=-3*De+9*ke-9*he+3*Ze,at=3*ke-3*De),kt(et)<1e-12){if(kt(Qe)<1e-12)continue;0<(vt=-at/Qe)&&vt<1&&Bt.push(vt)}else(it=Qe*Qe-4*at*et)<0||(0<(dt=(-Qe+(ct=wt(it)))/(2*et))&&dt<1&&Bt.push(dt),0<(Je=(-Qe-ct)/(2*et))&&Je<1&&Bt.push(Je));for(var Kt,fn,ln=Bt.length,wn=ln;ln--;)Kt=(fn=1-(vt=Bt[ln]))*fn*fn*Pe+3*fn*fn*vt*je+3*fn*vt*vt*Ae+vt*vt*vt*tt,Ft[0][ln]=Kt,Ft[1][ln]=fn*fn*fn*De+3*fn*fn*vt*ke+3*fn*vt*vt*he+vt*vt*vt*Ze;Ft[0][wn]=Pe,Ft[1][wn]=De,Ft[0][wn+1]=tt,Ft[1][wn+1]=Ze;var ut=[{x:ht.apply(null,Ft[0]),y:ht.apply(null,Ft[1])},{x:At.apply(null,Ft[0]),y:At.apply(null,Ft[1])}];return te.cachesBoundsOfCurve&&(te.boundsOfCurveCache[nt]=ut),ut},te.util.getPointOnPath=function(Pe,De,je){je||(je=xe(Pe));for(var ke=0;De-je[ke].length>0&&ke<je.length-2;)De-=je[ke].length,ke++;var Ae,he=je[ke],tt=De/he.length,nt=Pe[ke];switch(he.command){case"M":return{x:he.x,y:he.y,angle:0};case"Z":case"z":return(Ae=new te.Point(he.x,he.y).lerp(new te.Point(he.destX,he.destY),tt)).angle=Math.atan2(he.destY-he.y,he.destX-he.x),Ae;case"L":return(Ae=new te.Point(he.x,he.y).lerp(new te.Point(nt[1],nt[2]),tt)).angle=Math.atan2(nt[2]-he.y,nt[1]-he.x),Ae;case"C":case"Q":return function(et,Qe){for(var at,vt,dt,Je=0,it=0,ct=et.iterator,wt={x:et.x,y:et.y},ht=.01,At=et.angleFinder;it<Qe&&ht>1e-4;)at=ct(Je),dt=Je,(vt=$(wt.x,wt.y,at.x,at.y))+it>Qe?(Je-=ht,ht/=2):(wt=at,Je+=ht,it+=vt);return at.angle=At(dt),at}(he,De)}},te.util.transformPath=function(Pe,De,je){return je&&(De=te.util.multiplyTransformMatrices(De,[1,0,0,1,-je.x,-je.y])),Pe.map(function(ke){for(var Ae=ke.slice(0),he={},tt=1;tt<ke.length-1;tt+=2)he.x=ke[tt],he.y=ke[tt+1],he=te.util.transformPoint(he,De),Ae[tt]=he.x,Ae[tt+1]=he.y;return Ae})}}(),function(){var j=Array.prototype.slice;function L(Y,q,k){if(Y&&0!==Y.length){var N=Y.length-1,$=q?Y[N][q]:Y[N];if(q)for(;N--;)k(Y[N][q],$)&&($=Y[N][q]);else for(;N--;)k(Y[N],$)&&($=Y[N]);return $}}te.util.array={fill:function(Y,q){for(var k=Y.length;k--;)Y[k]=q;return Y},invoke:function(Y,q){for(var k=j.call(arguments,2),N=[],$=0,ie=Y.length;$<ie;$++)N[$]=k.length?Y[$][q].apply(Y[$],k):Y[$][q].call(Y[$]);return N},min:function(Y,q){return L(Y,q,function(k,N){return k<N})},max:function(Y,q){return L(Y,q,function(k,N){return k>=N})}}}(),function(){function j(L,Y,q){if(q)if(!te.isLikelyNode&&Y instanceof Element)L=Y;else if(Y instanceof Array){L=[];for(var k=0,N=Y.length;k<N;k++)L[k]=j({},Y[k],q)}else if(Y&&"object"==typeof Y)for(var $ in Y)"canvas"===$||"group"===$?L[$]=null:Y.hasOwnProperty($)&&(L[$]=j({},Y[$],q));else L=Y;else for(var $ in Y)L[$]=Y[$];return L}te.util.object={extend:j,clone:function(L,Y){return j({},L,Y)}},te.util.object.extend(te.util,te.Observable)}(),function(){function j(L,Y){var q=L.charCodeAt(Y);if(isNaN(q))return"";if(q<55296||q>57343)return L.charAt(Y);if(55296<=q&&q<=56319){if(L.length<=Y+1)throw"High surrogate without following low surrogate";var k=L.charCodeAt(Y+1);if(56320>k||k>57343)throw"High surrogate without following low surrogate";return L.charAt(Y)+L.charAt(Y+1)}if(0===Y)throw"Low surrogate without preceding high surrogate";var N=L.charCodeAt(Y-1);if(55296>N||N>56319)throw"Low surrogate without preceding high surrogate";return!1}te.util.string={camelize:function(L){return L.replace(/-+(.)?/g,function(Y,q){return q?q.toUpperCase():""})},capitalize:function(L,Y){return L.charAt(0).toUpperCase()+(Y?L.slice(1):L.slice(1).toLowerCase())},escapeXml:function(L){return L.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(L){var Y,q=0,k=[];for(q=0;q<L.length;q++)!1!==(Y=j(L,q))&&k.push(Y);return k}}}(),function(){var j=Array.prototype.slice,L=function(){},Y=function(){for(var $ in{toString:1})if("toString"===$)return!1;return!0}(),q=function($,ie,ee){for(var ne in ie)$.prototype[ne]=ne in $.prototype&&"function"==typeof $.prototype[ne]&&(ie[ne]+"").indexOf("callSuper")>-1?function(le){return function(){var fe=this.constructor.superclass;this.constructor.superclass=ee;var xe=ie[le].apply(this,arguments);if(this.constructor.superclass=fe,"initialize"!==le)return xe}}(ne):ie[ne],Y&&(ie.toString!==Object.prototype.toString&&($.prototype.toString=ie.toString),ie.valueOf!==Object.prototype.valueOf&&($.prototype.valueOf=ie.valueOf))};function k(){}function N($){for(var ie=null,ee=this;ee.constructor.superclass;){var ne=ee.constructor.superclass.prototype[$];if(ee[$]!==ne){ie=ne;break}ee=ee.constructor.superclass.prototype}return ie?arguments.length>1?ie.apply(this,j.call(arguments,1)):ie.call(this):console.log("tried to callSuper "+$+", method not found in prototype chain",this)}te.util.createClass=function(){var $=null,ie=j.call(arguments,0);function ee(){this.initialize.apply(this,arguments)}"function"==typeof ie[0]&&($=ie.shift()),ee.superclass=$,ee.subclasses=[],$&&(k.prototype=$.prototype,ee.prototype=new k,$.subclasses.push(ee));for(var ne=0,le=ie.length;ne<le;ne++)q(ee,ie[ne],$);return ee.prototype.initialize||(ee.prototype.initialize=L),ee.prototype.constructor=ee,ee.prototype.callSuper=N,ee}}(),I=!!te.document.createElement("div").attachEvent,A=["touchstart","touchmove","touchend"],te.util.addListener=function(j,L,Y,q){j&&j.addEventListener(L,Y,!I&&q)},te.util.removeListener=function(j,L,Y,q){j&&j.removeEventListener(L,Y,!I&&q)},te.util.getPointer=function(j){var k,N,Y=te.util.getScrollLeftTop(j.target),q=(N=(k=j).changedTouches)&&N[0]?N[0]:k;return{x:q.clientX+Y.left,y:q.clientY+Y.top}},te.util.isTouchEvent=function(j){return A.indexOf(j.type)>-1||"touch"===j.pointerType},F="string"==typeof(M=te.document.createElement("div")).style.opacity,B=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,Q=function(j){return j},F?Q=function(j,L){return j.style.opacity=L,j}:"string"==typeof M.style.filter&&(Q=function(j,L){var Y=j.style;return j.currentStyle&&!j.currentStyle.hasLayout&&(Y.zoom=1),B.test(Y.filter)?Y.filter=Y.filter.replace(B,L=L>=.9999?"":"alpha(opacity="+100*L+")"):Y.filter+=" alpha(opacity="+100*L+")",j}),te.util.setStyle=function(j,L){var Y=j.style;if(!Y)return j;if("string"==typeof L)return j.style.cssText+=";"+L,L.indexOf("opacity")>-1?Q(j,L.match(/opacity:\s*(\d?\.?\d*)/)[1]):j;for(var q in L)"opacity"===q?Q(j,L[q]):Y["float"===q||"cssFloat"===q?void 0===Y.styleFloat?"cssFloat":"styleFloat":q]=L[q];return j},function(){var j,L,Y,q,k=Array.prototype.slice,N=function(ee){return k.call(ee,0)};try{j=N(te.document.childNodes)instanceof Array}catch(ee){}function $(ee,ne){var le=te.document.createElement(ee);for(var fe in ne)"class"===fe?le.className=ne[fe]:"for"===fe?le.htmlFor=ne[fe]:le.setAttribute(fe,ne[fe]);return le}function ie(ee){for(var ne=0,le=0,fe=te.document.documentElement,xe=te.document.body||{scrollLeft:0,scrollTop:0};ee&&(ee.parentNode||ee.host)&&((ee=ee.parentNode||ee.host)===te.document?(ne=xe.scrollLeft||fe.scrollLeft||0,le=xe.scrollTop||fe.scrollTop||0):(ne+=ee.scrollLeft||0,le+=ee.scrollTop||0),1!==ee.nodeType||"fixed"!==ee.style.position););return{left:ne,top:le}}j||(N=function(ee){for(var ne=new Array(ee.length),le=ee.length;le--;)ne[le]=ee[le];return ne}),L=te.document.defaultView&&te.document.defaultView.getComputedStyle?function(ee,ne){var le=te.document.defaultView.getComputedStyle(ee,null);return le?le[ne]:void 0}:function(ee,ne){var le=ee.style[ne];return!le&&ee.currentStyle&&(le=ee.currentStyle[ne]),le},q="userSelect"in(Y=te.document.documentElement.style)?"userSelect":"MozUserSelect"in Y?"MozUserSelect":"WebkitUserSelect"in Y?"WebkitUserSelect":"KhtmlUserSelect"in Y?"KhtmlUserSelect":"",te.util.makeElementUnselectable=function(ee){return void 0!==ee.onselectstart&&(ee.onselectstart=te.util.falseFunction),q?ee.style[q]="none":"string"==typeof ee.unselectable&&(ee.unselectable="on"),ee},te.util.makeElementSelectable=function(ee){return void 0!==ee.onselectstart&&(ee.onselectstart=null),q?ee.style[q]="":"string"==typeof ee.unselectable&&(ee.unselectable=""),ee},te.util.setImageSmoothing=function(ee,ne){ee.imageSmoothingEnabled=ee.imageSmoothingEnabled||ee.webkitImageSmoothingEnabled||ee.mozImageSmoothingEnabled||ee.msImageSmoothingEnabled||ee.oImageSmoothingEnabled,ee.imageSmoothingEnabled=ne},te.util.getById=function(ee){return"string"==typeof ee?te.document.getElementById(ee):ee},te.util.toArray=N,te.util.addClass=function(ee,ne){ee&&-1===(" "+ee.className+" ").indexOf(" "+ne+" ")&&(ee.className+=(ee.className?" ":"")+ne)},te.util.makeElement=$,te.util.wrapElement=function(ee,ne,le){return"string"==typeof ne&&(ne=$(ne,le)),ee.parentNode&&ee.parentNode.replaceChild(ne,ee),ne.appendChild(ee),ne},te.util.getScrollLeftTop=ie,te.util.getElementOffset=function(ee){var ne,le,fe=ee&&ee.ownerDocument,xe={left:0,top:0},Pe={left:0,top:0},De={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!fe)return Pe;for(var je in De)Pe[De[je]]+=parseInt(L(ee,je),10)||0;return ne=fe.documentElement,void 0!==ee.getBoundingClientRect&&(xe=ee.getBoundingClientRect()),le=ie(ee),{left:xe.left+le.left-(ne.clientLeft||0)+Pe.left,top:xe.top+le.top-(ne.clientTop||0)+Pe.top}},te.util.getNodeCanvas=function(ee){var ne=te.jsdomImplForWrapper(ee);return ne._canvas||ne._image},te.util.cleanUpJsdomNode=function(ee){if(te.isLikelyNode){var ne=te.jsdomImplForWrapper(ee);ne&&(ne._image=null,ne._canvas=null,ne._currentSrc=null,ne._attributes=null,ne._classList=null)}}}(),function(){function j(){}te.util.request=function(L,Y){Y||(Y={});var ie,ee,q=Y.method?Y.method.toUpperCase():"GET",k=Y.onComplete||function(){},N=new te.window.XMLHttpRequest,$=Y.body||Y.parameters;return N.onreadystatechange=function(){4===N.readyState&&(k(N),N.onreadystatechange=j)},"GET"===q&&($=null,"string"==typeof Y.parameters&&(ee=Y.parameters,L=(ie=L)+(/\?/.test(ie)?"&":"?")+ee)),N.open(q,L,!0),"POST"!==q&&"PUT"!==q||N.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),N.send($),N}}(),te.log=console.log,te.warn=console.warn,function(){var j=te.util.object.extend,L=te.util.object.clone,Y=[];function q(){return!1}function k(ee,ne,le,fe){return-le*Math.cos(ee/fe*(Math.PI/2))+le+ne}te.util.object.extend(Y,{cancelAll:function(){var ee=this.splice(0);return ee.forEach(function(ne){ne.cancel()}),ee},cancelByCanvas:function(ee){if(!ee)return[];var ne=this.filter(function(le){return"object"==typeof le.target&&le.target.canvas===ee});return ne.forEach(function(le){le.cancel()}),ne},cancelByTarget:function(ee){var ne=this.findAnimationsByTarget(ee);return ne.forEach(function(le){le.cancel()}),ne},findAnimationIndex:function(ee){return this.indexOf(this.findAnimation(ee))},findAnimation:function(ee){return this.find(function(ne){return ne.cancel===ee})},findAnimationsByTarget:function(ee){return ee?this.filter(function(ne){return ne.target===ee}):[]}});var N=te.window.requestAnimationFrame||te.window.webkitRequestAnimationFrame||te.window.mozRequestAnimationFrame||te.window.oRequestAnimationFrame||te.window.msRequestAnimationFrame||function(ee){return te.window.setTimeout(ee,1e3/60)},$=te.window.cancelAnimationFrame||te.window.clearTimeout;function ie(){return N.apply(te.window,arguments)}te.util.animate=function(ee){ee||(ee={});var ne,le=!1,fe=function(){var xe=te.runningAnimations.indexOf(ne);return xe>-1&&te.runningAnimations.splice(xe,1)[0]};return ne=j(L(ee),{cancel:function(){return le=!0,fe()},currentValue:"startValue"in ee?ee.startValue:0,completionRate:0,durationRate:0}),te.runningAnimations.push(ne),ie(function(xe){var Pe,De=xe||+new Date,je=ee.duration||500,ke=De+je,Ae=ee.onChange||q,he=ee.abort||q,tt=ee.onComplete||q,Ze=ee.easing||k,nt="startValue"in ee&&ee.startValue.length>0,et="startValue"in ee?ee.startValue:0,Qe="endValue"in ee?ee.endValue:100,at=ee.byValue||(nt?et.map(function(vt,dt){return Qe[dt]-et[dt]}):Qe-et);ee.onStart&&ee.onStart(),function vt(dt){var Je=(Pe=dt||+new Date)>ke?je:Pe-De,it=Je/je,ct=nt?et.map(function(ht,At){return Ze(Je,et[At],at[At],je)}):Ze(Je,et,at,je),wt=Math.abs(nt?(ct[0]-et[0])/at[0]:(ct-et)/at);if(ne.currentValue=nt?ct.slice():ct,ne.completionRate=wt,ne.durationRate=it,!le){if(!he(ct,wt,it))return Pe>ke?(ne.currentValue=nt?Qe.slice():Qe,ne.completionRate=1,ne.durationRate=1,Ae(nt?Qe.slice():Qe,1,1),tt(Qe,1,1),void fe()):(Ae(ct,wt,it),void ie(vt));fe()}}(De)}),ne.cancel},te.util.requestAnimFrame=ie,te.util.cancelAnimFrame=function(){return $.apply(te.window,arguments)},te.runningAnimations=Y}(),function(){function j(L,Y,q){var k="rgba("+parseInt(L[0]+q*(Y[0]-L[0]),10)+","+parseInt(L[1]+q*(Y[1]-L[1]),10)+","+parseInt(L[2]+q*(Y[2]-L[2]),10);return(k+=","+(L&&Y?parseFloat(L[3]+q*(Y[3]-L[3])):1))+")"}te.util.animateColor=function(L,Y,q,k){var N=new te.Color(L).getSource(),$=new te.Color(Y).getSource(),ie=k.onComplete,ee=k.onChange;return te.util.animate(te.util.object.extend(k=k||{},{duration:q||500,startValue:N,endValue:$,byValue:$,easing:function(ne,le,fe,xe){return j(le,fe,k.colorEasing?k.colorEasing(ne,xe):1-Math.cos(ne/xe*(Math.PI/2)))},onComplete:function(ne,le,fe){if(ie)return ie(j($,$,0),le,fe)},onChange:function(ne,le,fe){if(ee){if(Array.isArray(ne))return ee(j(ne,ne,0),le,fe);ee(ne,le,fe)}}}))}}(),function(){function j(k,N,$,ie){return k<Math.abs(N)?(k=N,ie=$/4):ie=0===N&&0===k?$/(2*Math.PI)*Math.asin(1):$/(2*Math.PI)*Math.asin(N/k),{a:k,c:N,p:$,s:ie}}function L(k,N,$){return k.a*Math.pow(2,10*(N-=1))*Math.sin((N*$-k.s)*(2*Math.PI)/k.p)}function Y(k,N,$,ie){return $-q(ie-k,0,$,ie)+N}function q(k,N,$,ie){return(k/=ie)<1/2.75?$*(7.5625*k*k)+N:k<2/2.75?$*(7.5625*(k-=1.5/2.75)*k+.75)+N:k<2.5/2.75?$*(7.5625*(k-=2.25/2.75)*k+.9375)+N:$*(7.5625*(k-=2.625/2.75)*k+.984375)+N}te.util.ease={easeInQuad:function(k,N,$,ie){return $*(k/=ie)*k+N},easeOutQuad:function(k,N,$,ie){return-$*(k/=ie)*(k-2)+N},easeInOutQuad:function(k,N,$,ie){return(k/=ie/2)<1?$/2*k*k+N:-$/2*(--k*(k-2)-1)+N},easeInCubic:function(k,N,$,ie){return $*(k/=ie)*k*k+N},easeOutCubic:function(k,N,$,ie){return $*((k=k/ie-1)*k*k+1)+N},easeInOutCubic:function(k,N,$,ie){return(k/=ie/2)<1?$/2*k*k*k+N:$/2*((k-=2)*k*k+2)+N},easeInQuart:function(k,N,$,ie){return $*(k/=ie)*k*k*k+N},easeOutQuart:function(k,N,$,ie){return-$*((k=k/ie-1)*k*k*k-1)+N},easeInOutQuart:function(k,N,$,ie){return(k/=ie/2)<1?$/2*k*k*k*k+N:-$/2*((k-=2)*k*k*k-2)+N},easeInQuint:function(k,N,$,ie){return $*(k/=ie)*k*k*k*k+N},easeOutQuint:function(k,N,$,ie){return $*((k=k/ie-1)*k*k*k*k+1)+N},easeInOutQuint:function(k,N,$,ie){return(k/=ie/2)<1?$/2*k*k*k*k*k+N:$/2*((k-=2)*k*k*k*k+2)+N},easeInSine:function(k,N,$,ie){return-$*Math.cos(k/ie*(Math.PI/2))+$+N},easeOutSine:function(k,N,$,ie){return $*Math.sin(k/ie*(Math.PI/2))+N},easeInOutSine:function(k,N,$,ie){return-$/2*(Math.cos(Math.PI*k/ie)-1)+N},easeInExpo:function(k,N,$,ie){return 0===k?N:$*Math.pow(2,10*(k/ie-1))+N},easeOutExpo:function(k,N,$,ie){return k===ie?N+$:$*(1-Math.pow(2,-10*k/ie))+N},easeInOutExpo:function(k,N,$,ie){return 0===k?N:k===ie?N+$:(k/=ie/2)<1?$/2*Math.pow(2,10*(k-1))+N:$/2*(2-Math.pow(2,-10*--k))+N},easeInCirc:function(k,N,$,ie){return-$*(Math.sqrt(1-(k/=ie)*k)-1)+N},easeOutCirc:function(k,N,$,ie){return $*Math.sqrt(1-(k=k/ie-1)*k)+N},easeInOutCirc:function(k,N,$,ie){return(k/=ie/2)<1?-$/2*(Math.sqrt(1-k*k)-1)+N:$/2*(Math.sqrt(1-(k-=2)*k)+1)+N},easeInElastic:function(k,N,$,ie){var ee=0;return 0===k?N:1==(k/=ie)?N+$:(ee||(ee=.3*ie),-L(j($,$,ee,1.70158),k,ie)+N)},easeOutElastic:function(k,N,$,ie){var ee=0;if(0===k)return N;if(1==(k/=ie))return N+$;ee||(ee=.3*ie);var ne=j($,$,ee,1.70158);return ne.a*Math.pow(2,-10*k)*Math.sin((k*ie-ne.s)*(2*Math.PI)/ne.p)+ne.c+N},easeInOutElastic:function(k,N,$,ie){var ee=0;if(0===k)return N;if(2==(k/=ie/2))return N+$;ee||(ee=ie*(.3*1.5));var ne=j($,$,ee,1.70158);return k<1?-.5*L(ne,k,ie)+N:ne.a*Math.pow(2,-10*(k-=1))*Math.sin((k*ie-ne.s)*(2*Math.PI)/ne.p)*.5+ne.c+N},easeInBack:function(k,N,$,ie,ee){return void 0===ee&&(ee=1.70158),$*(k/=ie)*k*((ee+1)*k-ee)+N},easeOutBack:function(k,N,$,ie,ee){return void 0===ee&&(ee=1.70158),$*((k=k/ie-1)*k*((ee+1)*k+ee)+1)+N},easeInOutBack:function(k,N,$,ie,ee){return void 0===ee&&(ee=1.70158),(k/=ie/2)<1?$/2*(k*k*((1+(ee*=1.525))*k-ee))+N:$/2*((k-=2)*k*((1+(ee*=1.525))*k+ee)+2)+N},easeInBounce:Y,easeOutBounce:q,easeInOutBounce:function(k,N,$,ie){return k<ie/2?.5*Y(2*k,0,$,ie)+N:.5*q(2*k-ie,0,$,ie)+.5*$+N}}}(),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.util.object.clone,k=L.util.toFixed,N=L.util.parseUnit,$=L.util.multiplyTransformMatrices,ie={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},ee={stroke:"strokeOpacity",fill:"fillOpacity"},ne="font-size",le="clip-path";function fe(et){return et in ie?ie[et]:et}function xe(et,Qe,at,vt){var dt,Je=Array.isArray(Qe);if("fill"!==et&&"stroke"!==et||"none"!==Qe){if("strokeUniform"===et)return"non-scaling-stroke"===Qe;if("strokeDashArray"===et)Qe="none"===Qe?null:Qe.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===et)Qe=at&&at.transformMatrix?$(at.transformMatrix,L.parseTransformAttribute(Qe)):L.parseTransformAttribute(Qe);else if("visible"===et)Qe="none"!==Qe&&"hidden"!==Qe,at&&!1===at.visible&&(Qe=!1);else if("opacity"===et)Qe=parseFloat(Qe),at&&void 0!==at.opacity&&(Qe*=at.opacity);else if("textAnchor"===et)Qe="start"===Qe?"left":"end"===Qe?"right":"center";else if("charSpacing"===et)dt=N(Qe,vt)/vt*1e3;else if("paintFirst"===et){var it=Qe.indexOf("fill"),ct=Qe.indexOf("stroke");Qe="fill",(it>-1&&ct>-1&&ct<it||-1===it&&ct>-1)&&(Qe="stroke")}else{if("href"===et||"xlink:href"===et||"font"===et)return Qe;if("imageSmoothing"===et)return"optimizeQuality"===Qe;dt=Je?Qe.map(N):N(Qe,vt)}}else Qe="";return!Je&&isNaN(dt)?Qe:dt}function Pe(et){return new RegExp("^("+et.join("|")+")\\b","i")}function De(et,Qe){var vt,dt,Je,it=[];for(dt=0,Je=Qe.length;dt<Je;dt++)vt=et.getElementsByTagName(Qe[dt]),it=it.concat(Array.prototype.slice.call(vt));return it}function je(et,Qe){var at,vt=!0;return(at=ke(et,Qe.pop()))&&Qe.length&&(vt=function(dt,Je){for(var it,ct=!0;dt.parentNode&&1===dt.parentNode.nodeType&&Je.length;)ct&&(it=Je.pop()),ct=ke(dt=dt.parentNode,it);return 0===Je.length}(et,Qe)),at&&vt&&0===Qe.length}function ke(et,Qe){var at,vt,dt=et.nodeName,Je=et.getAttribute("class"),it=et.getAttribute("id");if(at=new RegExp("^"+dt,"i"),Qe=Qe.replace(at,""),it&&Qe.length&&(at=new RegExp("#"+it+"(?![a-zA-Z\\-]+)","i"),Qe=Qe.replace(at,"")),Je&&Qe.length)for(vt=(Je=Je.split(" ")).length;vt--;)at=new RegExp("\\."+Je[vt]+"(?![a-zA-Z\\-]+)","i"),Qe=Qe.replace(at,"");return 0===Qe.length}function Ae(et,Qe){var at;if(et.getElementById&&(at=et.getElementById(Qe)),at)return at;var vt,dt,Je,it=et.getElementsByTagName("*");for(dt=0,Je=it.length;dt<Je;dt++)if(Qe===(vt=it[dt]).getAttribute("id"))return vt}L.svgValidTagNamesRegEx=Pe(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),L.svgViewBoxElementsRegEx=Pe(["symbol","image","marker","pattern","view","svg"]),L.svgInvalidAncestorsRegEx=Pe(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),L.svgValidParentsRegEx=Pe(["symbol","g","a","svg","clipPath","defs"]),L.cssRules={},L.gradientDefs={},L.clipPaths={},L.parseTransformAttribute=function(){function et(ct,wt,ht){ct[ht]=Math.tan(L.util.degreesToRadians(wt[0]))}var Qe=L.iMatrix,at=L.reNum,vt=L.commaWsp,dt="(?:(?:(matrix)\\s*\\(\\s*("+at+")"+vt+"("+at+")"+vt+"("+at+")"+vt+"("+at+")"+vt+"("+at+")"+vt+"("+at+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+at+")(?:"+vt+"("+at+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+at+")(?:"+vt+"("+at+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+at+")(?:"+vt+"("+at+")"+vt+"("+at+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+at+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+at+")\\s*\\)))",Je=new RegExp("^\\s*(?:(?:"+dt+"(?:"+vt+"*"+dt+")*)?)\\s*$"),it=new RegExp(dt,"g");return function(ct){var wt=Qe.concat(),ht=[];if(!ct||ct&&!Je.test(ct))return wt;ct.replace(it,function(kt){var Kt,an,Bt=new RegExp(dt).exec(kt).filter(function(Kt){return!!Kt}),Ft=Bt[1],Ht=Bt.slice(2).map(parseFloat);switch(Ft){case"translate":(Kt=wt)[4]=(an=Ht)[0],2===an.length&&(Kt[5]=an[1]);break;case"rotate":Ht[0]=L.util.degreesToRadians(Ht[0]),function(Kt,an){var fn=L.util.cos(an[0]),ln=L.util.sin(an[0]),wn=0,ut=0;3===an.length&&(wn=an[1],ut=an[2]),Kt[0]=fn,Kt[1]=ln,Kt[2]=-ln,Kt[3]=fn,Kt[4]=wn-(fn*wn-ln*ut),Kt[5]=ut-(ln*wn+fn*ut)}(wt,Ht);break;case"scale":!function(Kt,an){var ln=2===an.length?an[1]:an[0];Kt[0]=an[0],Kt[3]=ln}(wt,Ht);break;case"skewX":et(wt,Ht,2);break;case"skewY":et(wt,Ht,1);break;case"matrix":wt=Ht}ht.push(wt.concat()),wt=Qe.concat()});for(var At=ht[0];ht.length>1;)ht.shift(),At=L.util.multiplyTransformMatrices(At,ht[0]);return At}}();var he=new RegExp("^\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*,?\\s*("+L.reNum+"+)\\s*$");function tt(et){if(!L.svgViewBoxElementsRegEx.test(et.nodeName))return{};var Qe,at,vt,dt,Je,it,ct=et.getAttribute("viewBox"),wt=1,ht=1,At=et.getAttribute("width"),kt=et.getAttribute("height"),Bt=et.getAttribute("x")||0,Ft=et.getAttribute("y")||0,Ht=et.getAttribute("preserveAspectRatio")||"",Kt=!ct||!(ct=ct.match(he)),an=!At||!kt||"100%"===At||"100%"===kt,fn=Kt&&an,ln={},wn="",ut=0,ft=0;if(ln.width=0,ln.height=0,ln.toBeParsed=fn,Kt&&(Bt||Ft)&&et.parentNode&&"#document"!==et.parentNode.nodeName&&(wn=" translate("+N(Bt)+" "+N(Ft)+") ",Je=(et.getAttribute("transform")||"")+wn,et.setAttribute("transform",Je),et.removeAttribute("x"),et.removeAttribute("y")),fn)return ln;if(Kt)return ln.width=N(At),ln.height=N(kt),ln;if(Qe=-parseFloat(ct[1]),at=-parseFloat(ct[2]),vt=parseFloat(ct[3]),dt=parseFloat(ct[4]),ln.minX=Qe,ln.minY=at,ln.viewBoxWidth=vt,ln.viewBoxHeight=dt,an?(ln.width=vt,ln.height=dt):(ln.width=N(At),ln.height=N(kt),wt=ln.width/vt,ht=ln.height/dt),"none"!==(Ht=L.util.parsePreserveAspectRatioAttribute(Ht)).alignX&&("meet"===Ht.meetOrSlice&&(ht=wt=wt>ht?ht:wt),"slice"===Ht.meetOrSlice&&(ht=wt=wt>ht?wt:ht),ut=ln.width-vt*wt,ft=ln.height-dt*wt,"Mid"===Ht.alignX&&(ut/=2),"Mid"===Ht.alignY&&(ft/=2),"Min"===Ht.alignX&&(ut=0),"Min"===Ht.alignY&&(ft=0)),1===wt&&1===ht&&0===Qe&&0===at&&0===Bt&&0===Ft)return ln;if((Bt||Ft)&&"#document"!==et.parentNode.nodeName&&(wn=" translate("+N(Bt)+" "+N(Ft)+") "),Je=wn+" matrix("+wt+" 0 0 "+ht+" "+(Qe*wt+ut)+" "+(at*ht+ft)+") ","svg"===et.nodeName){for(it=et.ownerDocument.createElementNS(L.svgNS,"g");et.firstChild;)it.appendChild(et.firstChild);et.appendChild(it)}else(it=et).removeAttribute("x"),it.removeAttribute("y"),Je=it.getAttribute("transform")+Je;return it.setAttribute("transform",Je),ln}function Ze(et,Qe){var at="xlink:href",vt=Ae(et,Qe.getAttribute(at).slice(1));if(vt&&vt.getAttribute(at)&&Ze(et,vt),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(Je){vt&&!Qe.hasAttribute(Je)&&vt.hasAttribute(Je)&&Qe.setAttribute(Je,vt.getAttribute(Je))}),!Qe.children.length)for(var dt=vt.cloneNode(!0);dt.firstChild;)Qe.appendChild(dt.firstChild);Qe.removeAttribute(at)}L.parseSVGDocument=function(et,Qe,at,vt){if(et){!function(Bt){for(var Ft=De(Bt,["use","svg:use"]),Ht=0;Ft.length&&Ht<Ft.length;){var Kt=Ft[Ht],an=Kt.getAttribute("xlink:href")||Kt.getAttribute("href");if(null===an)return;var fn,ln,wn,ut,ft=an.slice(1),Lt=Kt.getAttribute("x")||0,Ut=Kt.getAttribute("y")||0,sn=Ae(Bt,ft).cloneNode(!0),Yn=(sn.getAttribute("transform")||"")+" translate("+Lt+", "+Ut+")",ki=Ft.length,Hi=L.svgNS;if(tt(sn),/^svg$/i.test(sn.nodeName)){var Qi=sn.ownerDocument.createElementNS(Hi,"g");for(ln=0,ut=(wn=sn.attributes).length;ln<ut;ln++)fn=wn.item(ln),Qi.setAttributeNS(Hi,fn.nodeName,fn.nodeValue);for(;sn.firstChild;)Qi.appendChild(sn.firstChild);sn=Qi}for(ln=0,ut=(wn=Kt.attributes).length;ln<ut;ln++)"x"!==(fn=wn.item(ln)).nodeName&&"y"!==fn.nodeName&&"xlink:href"!==fn.nodeName&&"href"!==fn.nodeName&&("transform"===fn.nodeName?Yn=fn.nodeValue+" "+Yn:sn.setAttribute(fn.nodeName,fn.nodeValue));sn.setAttribute("transform",Yn),sn.setAttribute("instantiated_by_use","1"),sn.removeAttribute("id"),Kt.parentNode.replaceChild(sn,Kt),Ft.length===ki&&Ht++}}(et);var dt,Je,it=L.Object.__uid++,ct=tt(et),wt=L.util.toArray(et.getElementsByTagName("*"));if(ct.crossOrigin=vt&&vt.crossOrigin,ct.svgUid=it,0===wt.length&&L.isLikelyNode){var ht=[];for(dt=0,Je=(wt=et.selectNodes('//*[name(.)!="svg"]')).length;dt<Je;dt++)ht[dt]=wt[dt];wt=ht}var At=wt.filter(function(Bt){return tt(Bt),L.svgValidTagNamesRegEx.test(Bt.nodeName.replace("svg:",""))&&!function(Ft,Ht){for(;Ft&&(Ft=Ft.parentNode);)if(Ft.nodeName&&Ht.test(Ft.nodeName.replace("svg:",""))&&!Ft.getAttribute("instantiated_by_use"))return!0;return!1}(Bt,L.svgInvalidAncestorsRegEx)});if(!At||At&&!At.length)Qe&&Qe([],{});else{var kt={};wt.filter(function(Bt){return"clipPath"===Bt.nodeName.replace("svg:","")}).forEach(function(Bt){var Ft=Bt.getAttribute("id");kt[Ft]=L.util.toArray(Bt.getElementsByTagName("*")).filter(function(Ht){return L.svgValidTagNamesRegEx.test(Ht.nodeName.replace("svg:",""))})}),L.gradientDefs[it]=L.getGradientDefs(et),L.cssRules[it]=L.getCSSRules(et),L.clipPaths[it]=kt,L.parseElements(At,function(Bt,Ft){Qe&&(Qe(Bt,ct,Ft,wt),delete L.gradientDefs[it],delete L.cssRules[it],delete L.clipPaths[it])},q(ct),at,vt)}}};var nt=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+L.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+L.reNum+"))?\\s+(.*)");Y(L,{parseFontDeclaration:function(et,Qe){var at=et.match(nt);if(at){var vt=at[1],dt=at[3],Je=at[4],it=at[5],ct=at[6];vt&&(Qe.fontStyle=vt),dt&&(Qe.fontWeight=isNaN(parseFloat(dt))?dt:parseFloat(dt)),Je&&(Qe.fontSize=N(Je)),ct&&(Qe.fontFamily=ct),it&&(Qe.lineHeight="normal"===it?1:it)}},getGradientDefs:function(et){var Qe,at=De(et,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),vt=0,dt={};for(vt=at.length;vt--;)(Qe=at[vt]).getAttribute("xlink:href")&&Ze(et,Qe),dt[Qe.getAttribute("id")]=Qe;return dt},parseAttributes:function(et,Qe,at){if(et){var vt,dt,Je,it={};void 0===at&&(at=et.getAttribute("svgUid")),et.parentNode&&L.svgValidParentsRegEx.test(et.parentNode.nodeName)&&(it=L.parseAttributes(et.parentNode,Qe,at));var ct=Qe.reduce(function(Ht,Kt){return(vt=et.getAttribute(Kt))&&(Ht[Kt]=vt),Ht},{}),wt=Y(function(Ht,Kt){var an={};for(var fn in L.cssRules[Kt])if(je(Ht,fn.split(" ")))for(var ln in L.cssRules[Kt][fn])an[ln]=L.cssRules[Kt][fn][ln];return an}(et,at),L.parseStyleAttribute(et));ct=Y(ct,wt),wt[le]&&et.setAttribute(le,wt[le]),dt=Je=it.fontSize||L.Text.DEFAULT_SVG_FONT_SIZE,ct[ne]&&(ct[ne]=dt=N(ct[ne],Je));var ht,At,kt={};for(var Bt in ct)At=xe(ht=fe(Bt),ct[Bt],it,dt),kt[ht]=At;kt&&kt.font&&L.parseFontDeclaration(kt.font,kt);var Ft=Y(it,kt);return L.svgValidParentsRegEx.test(et.nodeName)?Ft:function(Ht){for(var Kt in ee)if(void 0!==Ht[ee[Kt]]&&""!==Ht[Kt]){if(void 0===Ht[Kt]){if(!L.Object.prototype[Kt])continue;Ht[Kt]=L.Object.prototype[Kt]}if(0!==Ht[Kt].indexOf("url(")){var an=new L.Color(Ht[Kt]);Ht[Kt]=an.setAlpha(k(an.getAlpha()*Ht[ee[Kt]],2)).toRgba()}}return Ht}(Ft)}},parseElements:function(et,Qe,at,vt,dt){new L.ElementsParser(et,Qe,at,vt,dt).parse()},parseStyleAttribute:function(et){var dt,Je,it,Qe={},at=et.getAttribute("style");return at&&("string"==typeof at?(dt=Qe,at.replace(/;\s*$/,"").split(";").forEach(function(ct){var wt=ct.split(":");Je=wt[0].trim().toLowerCase(),it=wt[1].trim(),dt[Je]=it})):function(vt,dt){for(var ct in vt)void 0!==vt[ct]&&(dt[ct.toLowerCase()]=vt[ct])}(at,Qe)),Qe},parsePointsAttribute:function(et){if(!et)return null;var Qe,at,vt=[];for(Qe=0,at=(et=(et=et.replace(/,/g," ").trim()).split(/\s+/)).length;Qe<at;Qe+=2)vt.push({x:parseFloat(et[Qe]),y:parseFloat(et[Qe+1])});return vt},getCSSRules:function(et){var Qe,at,vt=et.getElementsByTagName("style"),dt={};for(Qe=0,at=vt.length;Qe<at;Qe++){var Je=vt[Qe].textContent;""!==(Je=Je.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&Je.split("}").filter(function(it){return it.trim()}).forEach(function(it){var ct=it.split("{"),wt={},ht=ct[1].trim().split(";").filter(function(Ft){return Ft.trim()});for(Qe=0,at=ht.length;Qe<at;Qe++){var At=ht[Qe].split(":"),kt=At[0].trim(),Bt=At[1].trim();wt[kt]=Bt}(it=ct[0].trim()).split(",").forEach(function(Ft){""!==(Ft=Ft.replace(/^svg/i,"").trim())&&(dt[Ft]?L.util.object.extend(dt[Ft],wt):dt[Ft]=L.util.object.clone(wt))})})}return dt},loadSVGFromURL:function(et,Qe,at,vt){et=et.replace(/^\n\s*/,"").trim(),new L.util.request(et,{method:"get",onComplete:function(dt){var Je=dt.responseXML;if(!Je||!Je.documentElement)return Qe&&Qe(null),!1;L.parseSVGDocument(Je.documentElement,function(it,ct,wt,ht){Qe&&Qe(it,ct,wt,ht)},at,vt)}})},loadSVGFromString:function(et,Qe,at,vt){var dt=(new L.window.DOMParser).parseFromString(et.trim(),"text/xml");L.parseSVGDocument(dt.documentElement,function(Je,it,ct,wt){Qe(Je,it,ct,wt)},at,vt)}})}(n),te.ElementsParser=function(j,L,Y,q,k,N){this.elements=j,this.callback=L,this.options=Y,this.reviver=q,this.svgUid=Y&&Y.svgUid||0,this.parsingOptions=k,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=N},(J=te.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},J.createObjects=function(){var j=this;this.elements.forEach(function(L,Y){L.setAttribute("svgUid",j.svgUid),j.createObject(L,Y)})},J.findTag=function(j){return te[te.util.string.capitalize(j.tagName.replace("svg:",""))]},J.createObject=function(j,L){var Y=this.findTag(j);if(Y&&Y.fromElement)try{Y.fromElement(j,this.createCallback(L,j),this.options)}catch(q){te.log(q)}else this.checkIfDone()},J.createCallback=function(j,L){var Y=this;return function(q){var k;Y.resolveGradient(q,L,"fill"),Y.resolveGradient(q,L,"stroke"),q instanceof te.Image&&q._originalElement&&(k=q.parsePreserveAspectRatioAttribute(L)),q._removeTransformMatrix(k),Y.resolveClipPath(q,L),Y.reviver&&Y.reviver(L,q),Y.instances[j]=q,Y.checkIfDone()}},J.extractPropertyDefinition=function(j,L,Y){var q=j[L],k=this.regexUrl;if(k.test(q)){k.lastIndex=0;var N=k.exec(q)[1];return k.lastIndex=0,te[Y][this.svgUid][N]}},J.resolveGradient=function(j,L,Y){var q=this.extractPropertyDefinition(j,Y,"gradientDefs");if(q){var k=L.getAttribute(Y+"-opacity"),N=te.Gradient.fromElement(q,j,k,this.options);j.set(Y,N)}},J.createClipPathCallback=function(j,L){return function(Y){Y._removeTransformMatrix(),Y.fillRule=Y.clipRule,L.push(Y)}},J.resolveClipPath=function(j,L){var Y,q,k,N,$=this.extractPropertyDefinition(j,"clipPath","clipPaths");if($){k=[],q=te.util.invertTransform(j.calcTransformMatrix());for(var ie=$[0].parentNode,ee=L;ee.parentNode&&ee.getAttribute("clip-path")!==j.clipPath;)ee=ee.parentNode;ee.parentNode.appendChild(ie);for(var ne=0;ne<$.length;ne++)this.findTag(Y=$[ne]).fromElement(Y,this.createClipPathCallback(j,k),this.options);$=1===k.length?k[0]:new te.Group(k),N=te.util.multiplyTransformMatrices(q,$.calcTransformMatrix()),$.clipPath&&this.resolveClipPath($,ee);var le=te.util.qrDecompose(N);$.flipX=!1,$.flipY=!1,$.set("scaleX",le.scaleX),$.set("scaleY",le.scaleY),$.angle=le.angle,$.skewX=le.skewX,$.skewY=0,$.setPositionByOrigin({x:le.translateX,y:le.translateY},"center","center"),j.clipPath=$}else delete j.clipPath},J.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(j){return null!=j}),this.callback(this.instances,this.elements))},function(j){var L=j.fabric||(j.fabric={});function Y(q,k){this.x=q,this.y=k}L.Point?L.warn("fabric.Point is already defined"):(L.Point=Y,Y.prototype={type:"point",constructor:Y,add:function(q){return new Y(this.x+q.x,this.y+q.y)},addEquals:function(q){return this.x+=q.x,this.y+=q.y,this},scalarAdd:function(q){return new Y(this.x+q,this.y+q)},scalarAddEquals:function(q){return this.x+=q,this.y+=q,this},subtract:function(q){return new Y(this.x-q.x,this.y-q.y)},subtractEquals:function(q){return this.x-=q.x,this.y-=q.y,this},scalarSubtract:function(q){return new Y(this.x-q,this.y-q)},scalarSubtractEquals:function(q){return this.x-=q,this.y-=q,this},multiply:function(q){return new Y(this.x*q,this.y*q)},multiplyEquals:function(q){return this.x*=q,this.y*=q,this},divide:function(q){return new Y(this.x/q,this.y/q)},divideEquals:function(q){return this.x/=q,this.y/=q,this},eq:function(q){return this.x===q.x&&this.y===q.y},lt:function(q){return this.x<q.x&&this.y<q.y},lte:function(q){return this.x<=q.x&&this.y<=q.y},gt:function(q){return this.x>q.x&&this.y>q.y},gte:function(q){return this.x>=q.x&&this.y>=q.y},lerp:function(q,k){return void 0===k&&(k=.5),k=Math.max(Math.min(1,k),0),new Y(this.x+(q.x-this.x)*k,this.y+(q.y-this.y)*k)},distanceFrom:function(q){var k=this.x-q.x,N=this.y-q.y;return Math.sqrt(k*k+N*N)},midPointFrom:function(q){return this.lerp(q)},min:function(q){return new Y(Math.min(this.x,q.x),Math.min(this.y,q.y))},max:function(q){return new Y(Math.max(this.x,q.x),Math.max(this.y,q.y))},toString:function(){return this.x+","+this.y},setXY:function(q,k){return this.x=q,this.y=k,this},setX:function(q){return this.x=q,this},setY:function(q){return this.y=q,this},setFromPoint:function(q){return this.x=q.x,this.y=q.y,this},swap:function(q){var k=this.x,N=this.y;this.x=q.x,this.y=q.y,q.x=k,q.y=N},clone:function(){return new Y(this.x,this.y)}})}(n),function(j){var L=j.fabric||(j.fabric={});function Y(q){this.status=q,this.points=[]}L.Intersection?L.warn("fabric.Intersection is already defined"):(L.Intersection=Y,L.Intersection.prototype={constructor:Y,appendPoint:function(q){return this.points.push(q),this},appendPoints:function(q){return this.points=this.points.concat(q),this}},L.Intersection.intersectLineLine=function(q,k,N,$){var ie,ee=($.x-N.x)*(q.y-N.y)-($.y-N.y)*(q.x-N.x),ne=(k.x-q.x)*(q.y-N.y)-(k.y-q.y)*(q.x-N.x),le=($.y-N.y)*(k.x-q.x)-($.x-N.x)*(k.y-q.y);if(0!==le){var fe=ee/le,xe=ne/le;0<=fe&&fe<=1&&0<=xe&&xe<=1?(ie=new Y("Intersection")).appendPoint(new L.Point(q.x+fe*(k.x-q.x),q.y+fe*(k.y-q.y))):ie=new Y}else ie=new Y(0===ee||0===ne?"Coincident":"Parallel");return ie},L.Intersection.intersectLinePolygon=function(q,k,N){var ee,ne,le=new Y,fe=N.length;for(ne=0;ne<fe;ne++)ee=Y.intersectLineLine(q,k,N[ne],N[(ne+1)%fe]),le.appendPoints(ee.points);return le.points.length>0&&(le.status="Intersection"),le},L.Intersection.intersectPolygonPolygon=function(q,k){var N,$=new Y,ie=q.length;for(N=0;N<ie;N++){var le=Y.intersectLinePolygon(q[N],q[(N+1)%ie],k);$.appendPoints(le.points)}return $.points.length>0&&($.status="Intersection"),$},L.Intersection.intersectPolygonRectangle=function(q,k,N){var $=k.min(N),ie=k.max(N),ee=new L.Point(ie.x,$.y),ne=new L.Point($.x,ie.y),le=Y.intersectLinePolygon($,ee,q),fe=Y.intersectLinePolygon(ee,ie,q),xe=Y.intersectLinePolygon(ie,ne,q),Pe=Y.intersectLinePolygon(ne,$,q),De=new Y;return De.appendPoints(le.points),De.appendPoints(fe.points),De.appendPoints(xe.points),De.appendPoints(Pe.points),De.points.length>0&&(De.status="Intersection"),De})}(n),function(j){var L=j.fabric||(j.fabric={});function Y(k){k?this._tryParsingColor(k):this.setSource([0,0,0,1])}function q(k,N,$){return $<0&&($+=1),$>1&&($-=1),$<1/6?k+6*(N-k)*$:$<.5?N:$<2/3?k+(N-k)*(2/3-$)*6:k}L.Color?L.warn("fabric.Color is already defined."):(L.Color=Y,L.Color.prototype={_tryParsingColor:function(k){var N;k in Y.colorNameMap&&(k=Y.colorNameMap[k]),"transparent"===k&&(N=[255,255,255,0]),N||(N=Y.sourceFromHex(k)),N||(N=Y.sourceFromRgb(k)),N||(N=Y.sourceFromHsl(k)),N||(N=[0,0,0,1]),N&&this.setSource(N)},_rgbToHsl:function(k,N,$){var ie,ee,ne,le=L.util.array.max([k/=255,N/=255,$/=255]),fe=L.util.array.min([k,N,$]);if(ne=(le+fe)/2,le===fe)ie=ee=0;else{var xe=le-fe;switch(ee=ne>.5?xe/(2-le-fe):xe/(le+fe),le){case k:ie=(N-$)/xe+(N<$?6:0);break;case N:ie=($-k)/xe+2;break;case $:ie=(k-N)/xe+4}ie/=6}return[Math.round(360*ie),Math.round(100*ee),Math.round(100*ne)]},getSource:function(){return this._source},setSource:function(k){this._source=k},toRgb:function(){var k=this.getSource();return"rgb("+k[0]+","+k[1]+","+k[2]+")"},toRgba:function(){var k=this.getSource();return"rgba("+k[0]+","+k[1]+","+k[2]+","+k[3]+")"},toHsl:function(){var k=this.getSource(),N=this._rgbToHsl(k[0],k[1],k[2]);return"hsl("+N[0]+","+N[1]+"%,"+N[2]+"%)"},toHsla:function(){var k=this.getSource(),N=this._rgbToHsl(k[0],k[1],k[2]);return"hsla("+N[0]+","+N[1]+"%,"+N[2]+"%,"+k[3]+")"},toHex:function(){var k,N,$,ie=this.getSource();return k=1===(k=ie[0].toString(16)).length?"0"+k:k,N=1===(N=ie[1].toString(16)).length?"0"+N:N,$=1===($=ie[2].toString(16)).length?"0"+$:$,k.toUpperCase()+N.toUpperCase()+$.toUpperCase()},toHexa:function(){var k,N=this.getSource();return k=1===(k=(k=Math.round(255*N[3])).toString(16)).length?"0"+k:k,this.toHex()+k.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(k){var N=this.getSource();return N[3]=k,this.setSource(N),this},toGrayscale:function(){var k=this.getSource(),N=parseInt((.3*k[0]+.59*k[1]+.11*k[2]).toFixed(0),10);return this.setSource([N,N,N,k[3]]),this},toBlackWhite:function(k){var N=this.getSource(),$=(.3*N[0]+.59*N[1]+.11*N[2]).toFixed(0),ie=N[3];return k=k||127,$=Number($)<Number(k)?0:255,this.setSource([$,$,$,ie]),this},overlayWith:function(k){k instanceof Y||(k=new Y(k));var N,$=[],ie=this.getAlpha(),ee=this.getSource(),ne=k.getSource();for(N=0;N<3;N++)$.push(Math.round(.5*ee[N]+.5*ne[N]));return $[3]=ie,this.setSource($),this}},L.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,L.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,L.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,L.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},L.Color.fromRgb=function(k){return Y.fromSource(Y.sourceFromRgb(k))},L.Color.sourceFromRgb=function(k){var N=k.match(Y.reRGBa);if(N){var $=parseInt(N[1],10)/(/%$/.test(N[1])?100:1)*(/%$/.test(N[1])?255:1),ie=parseInt(N[2],10)/(/%$/.test(N[2])?100:1)*(/%$/.test(N[2])?255:1),ee=parseInt(N[3],10)/(/%$/.test(N[3])?100:1)*(/%$/.test(N[3])?255:1);return[parseInt($,10),parseInt(ie,10),parseInt(ee,10),N[4]?parseFloat(N[4]):1]}},L.Color.fromRgba=Y.fromRgb,L.Color.fromHsl=function(k){return Y.fromSource(Y.sourceFromHsl(k))},L.Color.sourceFromHsl=function(k){var N=k.match(Y.reHSLa);if(N){var $,ie,ee,ne=(parseFloat(N[1])%360+360)%360/360,le=parseFloat(N[2])/(/%$/.test(N[2])?100:1),fe=parseFloat(N[3])/(/%$/.test(N[3])?100:1);if(0===le)$=ie=ee=fe;else{var xe=fe<=.5?fe*(le+1):fe+le-fe*le,Pe=2*fe-xe;$=q(Pe,xe,ne+1/3),ie=q(Pe,xe,ne),ee=q(Pe,xe,ne-1/3)}return[Math.round(255*$),Math.round(255*ie),Math.round(255*ee),N[4]?parseFloat(N[4]):1]}},L.Color.fromHsla=Y.fromHsl,L.Color.fromHex=function(k){return Y.fromSource(Y.sourceFromHex(k))},L.Color.sourceFromHex=function(k){if(k.match(Y.reHex)){var N=k.slice(k.indexOf("#")+1),$=3===N.length||4===N.length,ie=8===N.length||4===N.length,ee=$?N.charAt(0)+N.charAt(0):N.substring(0,2),ne=$?N.charAt(1)+N.charAt(1):N.substring(2,4),le=$?N.charAt(2)+N.charAt(2):N.substring(4,6),fe=ie?$?N.charAt(3)+N.charAt(3):N.substring(6,8):"FF";return[parseInt(ee,16),parseInt(ne,16),parseInt(le,16),parseFloat((parseInt(fe,16)/255).toFixed(2))]}},L.Color.fromSource=function(k){var N=new Y;return N.setSource(k),N})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=["e","se","s","sw","w","nw","n","ne","e"],q=["ns","nesw","ew","nwse"],k={},N="left",$="top",ie="right",ee="bottom",ne="center",le={top:ee,bottom:$,left:ie,right:N,center:ne},fe=L.util.radiansToDegrees,xe=Math.sign||function(Je){return(Je>0)-(Je<0)||+Je};function Pe(Je,it){var ct=Je.angle+fe(Math.atan2(it.y,it.x))+360;return Math.round(ct%360/45)}function De(Je,it){var ct=it.transform.target,wt=ct.canvas,ht=L.util.object.clone(it);ht.target=ct,wt&&wt.fire("object:"+Je,ht),ct.fire(Je,it)}function je(Je,it){var ct=it.canvas,wt=Je[ct.uniScaleKey];return ct.uniformScaling&&!wt||!ct.uniformScaling&&wt}function ke(Je){return Je.originX===ne&&Je.originY===ne}function Ae(Je,it,ct){var wt=Je.lockScalingX,ht=Je.lockScalingY;return!((!wt||!ht)&&(it||!wt&&!ht||!ct)&&(!wt||"x"!==it)&&(!ht||"y"!==it))}function he(Je,it,ct,wt){return{e:Je,transform:it,pointer:{x:ct,y:wt}}}function tt(Je){return function(it,ct,wt,ht){var At=ct.target,kt=At.getCenterPoint(),Bt=At.translateToOriginPoint(kt,ct.originX,ct.originY),Ft=Je(it,ct,wt,ht);return At.setPositionByOrigin(Bt,ct.originX,ct.originY),Ft}}function Ze(Je,it){return function(ct,wt,ht,At){var kt=it(ct,wt,ht,At);return kt&&De(Je,he(ct,wt,ht,At)),kt}}function nt(Je,it,ct,wt,ht){var At=Je.target,kt=At.controls[Je.corner],Bt=At.canvas.getZoom(),Ft=At.padding/Bt,Ht=At.toLocalPoint(new L.Point(wt,ht),it,ct);return Ht.x>=Ft&&(Ht.x-=Ft),Ht.x<=-Ft&&(Ht.x+=Ft),Ht.y>=Ft&&(Ht.y-=Ft),Ht.y<=Ft&&(Ht.y+=Ft),Ht.x-=kt.offsetX,Ht.y-=kt.offsetY,Ht}function et(Je){return Je.flipX!==Je.flipY}function Qe(Je,it,ct,wt,ht){if(0!==Je[it]){var At=ht/Je._getTransformedDimensions()[wt]*Je[ct];Je.set(ct,At)}}function at(Je,it,ct,wt){var ht,At=it.target,kt=At._getTransformedDimensions(0,At.skewY),Bt=nt(it,it.originX,it.originY,ct,wt),Ft=Math.abs(2*Bt.x)-kt.x,Ht=At.skewX;Ft<2?ht=0:(ht=fe(Math.atan2(Ft/At.scaleX,kt.y/At.scaleY)),it.originX===N&&it.originY===ee&&(ht=-ht),it.originX===ie&&it.originY===$&&(ht=-ht),et(At)&&(ht=-ht));var Kt=Ht!==ht;if(Kt){var an=At._getTransformedDimensions().y;At.set("skewX",ht),Qe(At,"skewY","scaleY","y",an)}return Kt}function vt(Je,it,ct,wt){var ht,At=it.target,kt=At._getTransformedDimensions(At.skewX,0),Bt=nt(it,it.originX,it.originY,ct,wt),Ft=Math.abs(2*Bt.y)-kt.y,Ht=At.skewY;Ft<2?ht=0:(ht=fe(Math.atan2(Ft/At.scaleY,kt.x/At.scaleX)),it.originX===N&&it.originY===ee&&(ht=-ht),it.originX===ie&&it.originY===$&&(ht=-ht),et(At)&&(ht=-ht));var Kt=Ht!==ht;if(Kt){var an=At._getTransformedDimensions().x;At.set("skewY",ht),Qe(At,"skewX","scaleX","x",an)}return Kt}function dt(Je,it,ct,wt,ht){var At,kt,Bt,Ft,Ht,Kt,an=it.target,fn=an.lockScalingX,ln=an.lockScalingY,wn=(ht=ht||{}).by,ut=je(Je,an),ft=Ae(an,wn,ut),Lt=it.gestureScale;if(ft)return!1;if(Lt)kt=it.scaleX*Lt,Bt=it.scaleY*Lt;else{if(At=nt(it,it.originX,it.originY,ct,wt),Ht="y"!==wn?xe(At.x):1,Kt="x"!==wn?xe(At.y):1,it.signX||(it.signX=Ht),it.signY||(it.signY=Kt),an.lockScalingFlip&&(it.signX!==Ht||it.signY!==Kt))return!1;if(Ft=an._getTransformedDimensions(),ut&&!wn){var Ut=Math.abs(At.x)+Math.abs(At.y),sn=it.original,Yn=Ut/(Math.abs(Ft.x*sn.scaleX/an.scaleX)+Math.abs(Ft.y*sn.scaleY/an.scaleY));kt=sn.scaleX*Yn,Bt=sn.scaleY*Yn}else kt=Math.abs(At.x*an.scaleX/Ft.x),Bt=Math.abs(At.y*an.scaleY/Ft.y);ke(it)&&(kt*=2,Bt*=2),it.signX!==Ht&&"y"!==wn&&(it.originX=le[it.originX],kt*=-1,it.signX=Ht),it.signY!==Kt&&"x"!==wn&&(it.originY=le[it.originY],Bt*=-1,it.signY=Kt)}var ki=an.scaleX,Hi=an.scaleY;return wn?("x"===wn&&an.set("scaleX",kt),"y"===wn&&an.set("scaleY",Bt)):(!fn&&an.set("scaleX",kt),!ln&&an.set("scaleY",Bt)),ki!==an.scaleX||Hi!==an.scaleY}k.scaleCursorStyleHandler=function(Je,it,ct){var wt=je(Je,ct),ht="";if(0!==it.x&&0===it.y?ht="x":0===it.x&&0!==it.y&&(ht="y"),Ae(ct,ht,wt))return"not-allowed";var At=Pe(ct,it);return Y[At]+"-resize"},k.skewCursorStyleHandler=function(Je,it,ct){if(0!==it.x&&ct.lockSkewingY||0!==it.y&&ct.lockSkewingX)return"not-allowed";var ht=Pe(ct,it)%4;return q[ht]+"-resize"},k.scaleSkewCursorStyleHandler=function(Je,it,ct){return Je[ct.canvas.altActionKey]?k.skewCursorStyleHandler(Je,it,ct):k.scaleCursorStyleHandler(Je,it,ct)},k.rotationWithSnapping=Ze("rotating",tt(function(Je,it,ct,wt){var ht=it,At=ht.target,kt=At.translateToOriginPoint(At.getCenterPoint(),ht.originX,ht.originY);if(At.lockRotation)return!1;var Bt,Ft=Math.atan2(ht.ey-kt.y,ht.ex-kt.x),Ht=Math.atan2(wt-kt.y,ct-kt.x),Kt=fe(Ht-Ft+ht.theta);if(At.snapAngle>0){var an=At.snapAngle,fn=At.snapThreshold||an,ln=Math.ceil(Kt/an)*an,wn=Math.floor(Kt/an)*an;Math.abs(Kt-wn)<fn?Kt=wn:Math.abs(Kt-ln)<fn&&(Kt=ln)}return Kt<0&&(Kt=360+Kt),Bt=At.angle!==(Kt%=360),At.angle=Kt,Bt})),k.scalingEqually=Ze("scaling",tt(function(Je,it,ct,wt){return dt(Je,it,ct,wt)})),k.scalingX=Ze("scaling",tt(function(Je,it,ct,wt){return dt(Je,it,ct,wt,{by:"x"})})),k.scalingY=Ze("scaling",tt(function(Je,it,ct,wt){return dt(Je,it,ct,wt,{by:"y"})})),k.scalingYOrSkewingX=function(Je,it,ct,wt){return Je[it.target.canvas.altActionKey]?k.skewHandlerX(Je,it,ct,wt):k.scalingY(Je,it,ct,wt)},k.scalingXOrSkewingY=function(Je,it,ct,wt){return Je[it.target.canvas.altActionKey]?k.skewHandlerY(Je,it,ct,wt):k.scalingX(Je,it,ct,wt)},k.changeWidth=Ze("resizing",tt(function(Je,it,ct,wt){var ht=it.target,At=nt(it,it.originX,it.originY,ct,wt),kt=ht.strokeWidth/(ht.strokeUniform?ht.scaleX:1),Bt=ke(it)?2:1,Ft=ht.width,Ht=Math.abs(At.x*Bt/ht.scaleX)-kt;return ht.set("width",Math.max(Ht,0)),Ft!==Ht})),k.skewHandlerX=function(Je,it,ct,wt){var ht,At=it.target,kt=At.skewX,Bt=it.originY;return!At.lockSkewingX&&(0===kt?ht=nt(it,ne,ne,ct,wt).x>0?N:ie:(kt>0&&(ht=Bt===$?N:ie),kt<0&&(ht=Bt===$?ie:N),et(At)&&(ht=ht===N?ie:N)),it.originX=ht,Ze("skewing",tt(at))(Je,it,ct,wt))},k.skewHandlerY=function(Je,it,ct,wt){var ht,At=it.target,kt=At.skewY,Bt=it.originX;return!At.lockSkewingY&&(0===kt?ht=nt(it,ne,ne,ct,wt).y>0?$:ee:(kt>0&&(ht=Bt===N?$:ee),kt<0&&(ht=Bt===N?ee:$),et(At)&&(ht=ht===$?ee:$)),it.originY=ht,Ze("skewing",tt(vt))(Je,it,ct,wt))},k.dragHandler=function(Je,it,ct,wt){var ht=it.target,At=ct-it.offsetX,kt=wt-it.offsetY,Bt=!ht.get("lockMovementX")&&ht.left!==At,Ft=!ht.get("lockMovementY")&&ht.top!==kt;return Bt&&ht.set("left",At),Ft&&ht.set("top",kt),(Bt||Ft)&&De("moving",he(Je,it,ct,wt)),Bt||Ft},k.scaleOrSkewActionName=function(Je,it,ct){var wt=Je[ct.canvas.altActionKey];return 0===it.x?wt?"skewX":"scaleY":0===it.y?wt?"skewY":"scaleX":void 0},k.rotationStyleHandler=function(Je,it,ct){return ct.lockRotation?"not-allowed":it.cursorStyle},k.fireEvent=De,k.wrapWithFixedAnchor=tt,k.wrapWithFireEvent=Ze,k.getLocalPoint=nt,L.controlsUtils=k}(n),L=(j=n).fabric||(j.fabric={}),Y=L.util.degreesToRadians,(q=L.controlsUtils).renderCircleControl=function(k,N,$,ie,ee){ie=ie||{};var ne,le=this.sizeX||ie.cornerSize||ee.cornerSize,fe=this.sizeY||ie.cornerSize||ee.cornerSize,xe=void 0!==ie.transparentCorners?ie.transparentCorners:ee.transparentCorners,Pe=xe?"stroke":"fill",De=!xe&&(ie.cornerStrokeColor||ee.cornerStrokeColor),je=N,ke=$;k.save(),k.fillStyle=ie.cornerColor||ee.cornerColor,k.strokeStyle=ie.cornerStrokeColor||ee.cornerStrokeColor,le>fe?(ne=le,k.scale(1,fe/le),ke=$*le/fe):fe>le?(ne=fe,k.scale(le/fe,1),je=N*fe/le):ne=le,k.lineWidth=1,k.beginPath(),k.arc(je,ke,ne/2,0,2*Math.PI,!1),k[Pe](),De&&k.stroke(),k.restore()},q.renderSquareControl=function(k,N,$,ie,ee){ie=ie||{};var ne=this.sizeX||ie.cornerSize||ee.cornerSize,le=this.sizeY||ie.cornerSize||ee.cornerSize,fe=void 0!==ie.transparentCorners?ie.transparentCorners:ee.transparentCorners,xe=fe?"stroke":"fill",Pe=!fe&&(ie.cornerStrokeColor||ee.cornerStrokeColor),De=ne/2,je=le/2;k.save(),k.fillStyle=ie.cornerColor||ee.cornerColor,k.strokeStyle=ie.cornerStrokeColor||ee.cornerStrokeColor,k.lineWidth=1,k.translate(N,$),k.rotate(Y(ee.angle)),k[xe+"Rect"](-De,-je,ne,le),Pe&&k.strokeRect(-De,-je,ne,le),k.restore()},function(j){var L=j.fabric||(j.fabric={});L.Control=function(Y){for(var q in Y)this[q]=Y[q]},L.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(Y,q){return q.cursorStyle},getActionName:function(Y,q){return q.actionName},getVisibility:function(Y,q){var k=Y._controlsVisibility;return k&&void 0!==k[q]?k[q]:this.visible},setVisibility:function(Y){this.visible=Y},positionHandler:function(Y,q){return L.util.transformPoint({x:this.x*Y.x+this.offsetX,y:this.y*Y.y+this.offsetY},q)},calcCornerCoords:function(Y,q,k,N,$){var ie,ee,ne,le,fe=$?this.touchSizeX:this.sizeX,xe=$?this.touchSizeY:this.sizeY;if(fe&&xe&&fe!==xe){var Pe=Math.atan2(xe,fe),De=Math.sqrt(fe*fe+xe*xe)/2,je=Pe-L.util.degreesToRadians(Y),ke=Math.PI/2-Pe-L.util.degreesToRadians(Y);ie=De*L.util.cos(je),ee=De*L.util.sin(je),ne=De*L.util.cos(ke),le=De*L.util.sin(ke)}else De=.7071067812*(fe&&xe?fe:q),je=L.util.degreesToRadians(45-Y),ie=ne=De*L.util.cos(je),ee=le=De*L.util.sin(je);return{tl:{x:k-le,y:N-ne},tr:{x:k+ie,y:N-ee},bl:{x:k-ie,y:N+ee},br:{x:k+le,y:N+ne}}},render:function(Y,q,k,N,$){"circle"===((N=N||{}).cornerStyle||$.cornerStyle)?L.controlsUtils.renderCircleControl.call(this,Y,q,k,N,$):L.controlsUtils.renderSquareControl.call(this,Y,q,k,N,$)}}}(n),function(){function j(Y,q){var k,N,$,ie,ee=Y.getAttribute("style"),ne=Y.getAttribute("offset")||0;if(ne=(ne=parseFloat(ne)/(/%$/.test(ne)?100:1))<0?0:ne>1?1:ne,ee){var le=ee.split(/\s*;\s*/);for(""===le[le.length-1]&&le.pop(),ie=le.length;ie--;){var fe=le[ie].split(/\s*:\s*/),xe=fe[0].trim(),Pe=fe[1].trim();"stop-color"===xe?k=Pe:"stop-opacity"===xe&&($=Pe)}}return k||(k=Y.getAttribute("stop-color")||"rgb(0,0,0)"),$||($=Y.getAttribute("stop-opacity")),N=(k=new te.Color(k)).getAlpha(),$=isNaN(parseFloat($))?1:parseFloat($),$*=N*q,{offset:ne,color:k.toRgb(),opacity:$}}var L=te.util.object.clone;te.Gradient=te.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(Y){Y||(Y={}),Y.coords||(Y.coords={});var q,k=this;Object.keys(Y).forEach(function(N){k[N]=Y[N]}),this.id?this.id+="_"+te.Object.__uid++:this.id=te.Object.__uid++,q={x1:Y.coords.x1||0,y1:Y.coords.y1||0,x2:Y.coords.x2||0,y2:Y.coords.y2||0},"radial"===this.type&&(q.r1=Y.coords.r1||0,q.r2=Y.coords.r2||0),this.coords=q,this.colorStops=Y.colorStops.slice()},addColorStop:function(Y){for(var q in Y){var k=new te.Color(Y[q]);this.colorStops.push({offset:parseFloat(q),color:k.toRgb(),opacity:k.getAlpha()})}return this},toObject:function(Y){var q={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return te.util.populateWithProperties(this,q,Y),q},toSVG:function(Y,q){var k,N,$,ie,ee=L(this.coords,!0),ne=(q=q||{},L(this.colorStops,!0)),le=ee.r1>ee.r2,fe=this.gradientTransform?this.gradientTransform.concat():te.iMatrix.concat(),xe=-this.offsetX,Pe=-this.offsetY,De=!!q.additionalTransform,je="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(ne.sort(function(tt,Ze){return tt.offset-Ze.offset}),"objectBoundingBox"===je?(xe/=Y.width,Pe/=Y.height):(xe+=Y.width/2,Pe+=Y.height/2),"path"===Y.type&&"percentage"!==this.gradientUnits&&(xe-=Y.pathOffset.x,Pe-=Y.pathOffset.y),fe[4]-=xe,fe[5]-=Pe,ie='id="SVGID_'+this.id+'" gradientUnits="'+je+'"',ie+=' gradientTransform="'+(De?q.additionalTransform+" ":"")+te.util.matrixToSVG(fe)+'" ',"linear"===this.type?$=["<linearGradient ",ie,' x1="',ee.x1,'" y1="',ee.y1,'" x2="',ee.x2,'" y2="',ee.y2,'">\n']:"radial"===this.type&&($=["<radialGradient ",ie,' cx="',le?ee.x1:ee.x2,'" cy="',le?ee.y1:ee.y2,'" r="',le?ee.r1:ee.r2,'" fx="',le?ee.x2:ee.x1,'" fy="',le?ee.y2:ee.y1,'">\n']),"radial"===this.type){if(le)for((ne=ne.concat()).reverse(),k=0,N=ne.length;k<N;k++)ne[k].offset=1-ne[k].offset;var ke=Math.min(ee.r1,ee.r2);if(ke>0){var Ae=ke/Math.max(ee.r1,ee.r2);for(k=0,N=ne.length;k<N;k++)ne[k].offset+=Ae*(1-ne[k].offset)}}for(k=0,N=ne.length;k<N;k++){var he=ne[k];$.push("<stop ",'offset="',100*he.offset+"%",'" style="stop-color:',he.color,void 0!==he.opacity?";stop-opacity: "+he.opacity:";",'"/>\n')}return $.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),$.join("")},toLive:function(Y){var q,k,N,$=te.util.object.clone(this.coords);if(this.type){for("linear"===this.type?q=Y.createLinearGradient($.x1,$.y1,$.x2,$.y2):"radial"===this.type&&(q=Y.createRadialGradient($.x1,$.y1,$.r1,$.x2,$.y2,$.r2)),k=0,N=this.colorStops.length;k<N;k++){var ie=this.colorStops[k].color,ee=this.colorStops[k].opacity,ne=this.colorStops[k].offset;void 0!==ee&&(ie=new te.Color(ie).setAlpha(ee).toRgba()),q.addColorStop(ne,ie)}return q}}}),te.util.object.extend(te.Gradient,{fromElement:function(Y,q,k,N){var $=parseFloat(k)/(/%$/.test(k)?100:1);$=$<0?0:$>1?1:$,isNaN($)&&($=1);var ie,ee,ne,le,Ae,he,tt,Ze,nt,et,fe=Y.getElementsByTagName("stop"),xe="userSpaceOnUse"===Y.getAttribute("gradientUnits")?"pixels":"percentage",Pe=Y.getAttribute("gradientTransform")||"",De=[],je=0,ke=0;for("linearGradient"===Y.nodeName||"LINEARGRADIENT"===Y.nodeName?(ie="linear",ee={x1:(Ae=Y).getAttribute("x1")||0,y1:Ae.getAttribute("y1")||0,x2:Ae.getAttribute("x2")||"100%",y2:Ae.getAttribute("y2")||0}):(ie="radial",ee=function(Ae){return{x1:Ae.getAttribute("fx")||Ae.getAttribute("cx")||"50%",y1:Ae.getAttribute("fy")||Ae.getAttribute("cy")||"50%",r1:0,x2:Ae.getAttribute("cx")||"50%",y2:Ae.getAttribute("cy")||"50%",r2:Ae.getAttribute("r")||"50%"}}(Y)),ne=fe.length;ne--;)De.push(j(fe[ne],$));return le=te.parseTransformAttribute(Pe),he=ee,tt=N,Ze=xe,Object.keys(he).forEach(function(Qe){"Infinity"===(nt=he[Qe])?et=1:"-Infinity"===nt?et=0:(et=parseFloat(he[Qe],10),"string"==typeof nt&&/^(\d+\.\d+)%|(\d+)%$/.test(nt)&&(et*=.01,"pixels"===Ze&&("x1"!==Qe&&"x2"!==Qe&&"r2"!==Qe||(et*=tt.viewBoxWidth||tt.width),"y1"!==Qe&&"y2"!==Qe||(et*=tt.viewBoxHeight||tt.height)))),he[Qe]=et}),"pixels"===xe&&(je=-q.left,ke=-q.top),new te.Gradient({id:Y.getAttribute("id"),type:ie,coords:ee,colorStops:De,gradientUnits:xe,gradientTransform:le,offsetX:je,offsetY:ke})}})}(),Z=te.util.toFixed,te.Pattern=te.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(j,L){if(j||(j={}),this.id=te.Object.__uid++,this.setOptions(j),!j.source||j.source&&"string"!=typeof j.source)L&&L(this);else{var Y=this;this.source=te.util.createImage(),te.util.loadImage(j.source,function(q,k){Y.source=q,L&&L(Y,k)},null,this.crossOrigin)}},toObject:function(j){var L,Y,q=te.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?L=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(L=this.source.toDataURL()),Y={type:"pattern",source:L,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:Z(this.offsetX,q),offsetY:Z(this.offsetY,q),patternTransform:this.patternTransform?this.patternTransform.concat():null},te.util.populateWithProperties(this,Y,j),Y},toSVG:function(j){var L="function"==typeof this.source?this.source():this.source,Y=L.width/j.width,q=L.height/j.height,k=this.offsetX/j.width,N=this.offsetY/j.height,$="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(q=1,N&&(q+=Math.abs(N))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(Y=1,k&&(Y+=Math.abs(k))),L.src?$=L.src:L.toDataURL&&($=L.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+k+'" y="'+N+'" width="'+Y+'" height="'+q+'">\n<image x="0" y="0" width="'+L.width+'" height="'+L.height+'" xlink:href="'+$+'"></image>\n</pattern>\n'},setOptions:function(j){for(var L in j)this[L]=j[L]},toLive:function(j){var L=this.source;return L&&(void 0===L.src||L.complete&&0!==L.naturalWidth&&0!==L.naturalHeight)?j.createPattern(L,this.repeat):""}}),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.toFixed;L.Shadow?L.warn("fabric.Shadow is already defined."):(L.Shadow=L.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(q){for(var k in"string"==typeof q&&(q=this._parseShadow(q)),q)this[k]=q[k];this.id=L.Object.__uid++},_parseShadow:function(q){var k=q.trim(),N=L.Shadow.reOffsetsAndBlur.exec(k)||[];return{color:(k.replace(L.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(N[1],10)||0,offsetY:parseFloat(N[2],10)||0,blur:parseFloat(N[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(q){var k=40,N=40,$=L.Object.NUM_FRACTION_DIGITS,ie=L.util.rotateVector({x:this.offsetX,y:this.offsetY},L.util.degreesToRadians(-q.angle)),ee=new L.Color(this.color);return q.width&&q.height&&(k=100*Y((Math.abs(ie.x)+this.blur)/q.width,$)+20,N=100*Y((Math.abs(ie.y)+this.blur)/q.height,$)+20),q.flipX&&(ie.x*=-1),q.flipY&&(ie.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+N+'%" height="'+(100+2*N)+'%" x="-'+k+'%" width="'+(100+2*k)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+Y(this.blur?this.blur/2:0,$)+'"></feGaussianBlur>\n\t<feOffset dx="'+Y(ie.x,$)+'" dy="'+Y(ie.y,$)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+ee.toRgb()+'" flood-opacity="'+ee.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var q={},k=L.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(N){this[N]!==k[N]&&(q[N]=this[N])},this),q}}),L.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(n),function(){if(te.StaticCanvas)te.warn("fabric.StaticCanvas is already defined.");else{var j=te.util.object.extend,L=te.util.getElementOffset,Y=te.util.removeFromArray,q=te.util.toFixed,k=te.util.transformPoint,N=te.util.invertTransform,$=te.util.getNodeCanvas,ie=te.util.createCanvasElement,ee=new Error("Could not initialize `canvas` element");te.StaticCanvas=te.util.createClass(te.CommonMethods,{initialize:function(ne,le){le||(le={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(ne,le)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:te.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(ne,le){var fe=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(ne),this._initOptions(le),this.interactive||this._initRetinaScaling(),le.overlayImage&&this.setOverlayImage(le.overlayImage,fe),le.backgroundImage&&this.setBackgroundImage(le.backgroundImage,fe),le.backgroundColor&&this.setBackgroundColor(le.backgroundColor,fe),le.overlayColor&&this.setOverlayColor(le.overlayColor,fe),this.calcOffset()},_isRetinaScaling:function(){return te.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,te.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var ne=te.devicePixelRatio;this.__initRetinaScaling(ne,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(ne,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(ne,le,fe){le.setAttribute("width",this.width*ne),le.setAttribute("height",this.height*ne),fe.scale(ne,ne)},calcOffset:function(){return this._offset=L(this.lowerCanvasEl),this},setOverlayImage:function(ne,le,fe){return this.__setBgOverlayImage("overlayImage",ne,le,fe)},setBackgroundImage:function(ne,le,fe){return this.__setBgOverlayImage("backgroundImage",ne,le,fe)},setOverlayColor:function(ne,le){return this.__setBgOverlayColor("overlayColor",ne,le)},setBackgroundColor:function(ne,le){return this.__setBgOverlayColor("backgroundColor",ne,le)},__setBgOverlayImage:function(ne,le,fe,xe){return"string"==typeof le?te.util.loadImage(le,function(Pe,De){if(Pe){var je=new te.Image(Pe,xe);this[ne]=je,je.canvas=this}fe&&fe(Pe,De)},this,xe&&xe.crossOrigin):(xe&&le.setOptions(xe),this[ne]=le,le&&(le.canvas=this),fe&&fe(le,!1)),this},__setBgOverlayColor:function(ne,le,fe){return this[ne]=le,this._initGradient(le,ne),this._initPattern(le,ne,fe),this},_createCanvasElement:function(){var ne=ie();if(!ne||(ne.style||(ne.style={}),void 0===ne.getContext))throw ee;return ne},_initOptions:function(ne){var le=this.lowerCanvasEl;this._setOptions(ne),this.width=this.width||parseInt(le.width,10)||0,this.height=this.height||parseInt(le.height,10)||0,this.lowerCanvasEl.style&&(le.width=this.width,le.height=this.height,le.style.width=this.width+"px",le.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(ne){this.lowerCanvasEl=ne&&ne.getContext?ne:te.util.getById(ne)||this._createCanvasElement(),te.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(ne,le){return this.setDimensions({width:ne},le)},setHeight:function(ne,le){return this.setDimensions({height:ne},le)},setDimensions:function(ne,le){var fe;for(var xe in le=le||{},ne)fe=ne[xe],le.cssOnly||(this._setBackstoreDimension(xe,ne[xe]),fe+="px",this.hasLostContext=!0),le.backstoreOnly||this._setCssDimension(xe,fe);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),le.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(ne,le){return this.lowerCanvasEl[ne]=le,this.upperCanvasEl&&(this.upperCanvasEl[ne]=le),this.cacheCanvasEl&&(this.cacheCanvasEl[ne]=le),this[ne]=le,this},_setCssDimension:function(ne,le){return this.lowerCanvasEl.style[ne]=le,this.upperCanvasEl&&(this.upperCanvasEl.style[ne]=le),this.wrapperEl&&(this.wrapperEl.style[ne]=le),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(ne){var le,fe,xe,Pe=this._activeObject,De=this.backgroundImage,je=this.overlayImage;for(this.viewportTransform=ne,fe=0,xe=this._objects.length;fe<xe;fe++)(le=this._objects[fe]).group||le.setCoords(!0);return Pe&&Pe.setCoords(),De&&De.setCoords(!0),je&&je.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(ne,le){var fe=ne,xe=this.viewportTransform.slice(0);ne=k(ne,N(this.viewportTransform)),xe[0]=le,xe[3]=le;var Pe=k(ne,xe);return xe[4]+=fe.x-Pe.x,xe[5]+=fe.y-Pe.y,this.setViewportTransform(xe)},setZoom:function(ne){return this.zoomToPoint(new te.Point(0,0),ne),this},absolutePan:function(ne){var le=this.viewportTransform.slice(0);return le[4]=-ne.x,le[5]=-ne.y,this.setViewportTransform(le)},relativePan:function(ne){return this.absolutePan(new te.Point(-ne.x-this.viewportTransform[4],-ne.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(ne){this.stateful&&ne.setupState(),ne._set("canvas",this),ne.setCoords(),this.fire("object:added",{target:ne}),ne.fire("added")},_onObjectRemoved:function(ne){this.fire("object:removed",{target:ne}),ne.fire("removed"),delete ne.canvas},clearContext:function(ne){return ne.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=te.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var ne={},le=this.width,fe=this.height,xe=N(this.viewportTransform);return ne.tl=k({x:0,y:0},xe),ne.br=k({x:le,y:fe},xe),ne.tr=new te.Point(ne.br.x,ne.tl.y),ne.bl=new te.Point(ne.tl.x,ne.br.y),this.vptCoords=ne,ne},cancelRequestedRender:function(){this.isRendering&&(te.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(ne,le){var fe=this.viewportTransform,xe=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(ne),te.util.setImageSmoothing(ne,this.imageSmoothingEnabled),this.fire("before:render",{ctx:ne}),this._renderBackground(ne),ne.save(),ne.transform(fe[0],fe[1],fe[2],fe[3],fe[4],fe[5]),this._renderObjects(ne,le),ne.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(ne),xe&&(xe.canvas=this,xe.shouldCache(),xe._transformDone=!0,xe.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(ne)),this._renderOverlay(ne),this.controlsAboveOverlay&&this.interactive&&this.drawControls(ne),this.fire("after:render",{ctx:ne})},drawClipPathOnCanvas:function(ne){var le=this.viewportTransform,fe=this.clipPath;ne.save(),ne.transform(le[0],le[1],le[2],le[3],le[4],le[5]),ne.globalCompositeOperation="destination-in",fe.transform(ne),ne.scale(1/fe.zoomX,1/fe.zoomY),ne.drawImage(fe._cacheCanvas,-fe.cacheTranslationX,-fe.cacheTranslationY),ne.restore()},_renderObjects:function(ne,le){var fe,xe;for(fe=0,xe=le.length;fe<xe;++fe)le[fe]&&le[fe].render(ne)},_renderBackgroundOrOverlay:function(ne,le){var fe=this[le+"Color"],xe=this[le+"Image"],Pe=this.viewportTransform,De=this[le+"Vpt"];if(fe||xe){if(fe){ne.save(),ne.beginPath(),ne.moveTo(0,0),ne.lineTo(this.width,0),ne.lineTo(this.width,this.height),ne.lineTo(0,this.height),ne.closePath(),ne.fillStyle=fe.toLive?fe.toLive(ne,this):fe,De&&ne.transform(Pe[0],Pe[1],Pe[2],Pe[3],Pe[4],Pe[5]),ne.transform(1,0,0,1,fe.offsetX||0,fe.offsetY||0);var je=fe.gradientTransform||fe.patternTransform;je&&ne.transform(je[0],je[1],je[2],je[3],je[4],je[5]),ne.fill(),ne.restore()}xe&&(ne.save(),De&&ne.transform(Pe[0],Pe[1],Pe[2],Pe[3],Pe[4],Pe[5]),xe.render(ne),ne.restore())}},_renderBackground:function(ne){this._renderBackgroundOrOverlay(ne,"background")},_renderOverlay:function(ne){this._renderBackgroundOrOverlay(ne,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new te.Point(this.width/2,this.height/2)},centerObjectH:function(ne){return this._centerObject(ne,new te.Point(this.getCenterPoint().x,ne.getCenterPoint().y))},centerObjectV:function(ne){return this._centerObject(ne,new te.Point(ne.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(ne){var le=this.getCenterPoint();return this._centerObject(ne,le)},viewportCenterObject:function(ne){var le=this.getVpCenter();return this._centerObject(ne,le)},viewportCenterObjectH:function(ne){var le=this.getVpCenter();return this._centerObject(ne,new te.Point(le.x,ne.getCenterPoint().y)),this},viewportCenterObjectV:function(ne){var le=this.getVpCenter();return this._centerObject(ne,new te.Point(ne.getCenterPoint().x,le.y))},getVpCenter:function(){var ne=this.getCenterPoint(),le=N(this.viewportTransform);return k(ne,le)},_centerObject:function(ne,le){return ne.setPositionByOrigin(le,"center","center"),ne.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(ne){return this.toDatalessObject(ne)},toObject:function(ne){return this._toObjectMethod("toObject",ne)},toDatalessObject:function(ne){return this._toObjectMethod("toDatalessObject",ne)},_toObjectMethod:function(ne,le){var fe=this.clipPath,xe={version:te.version,objects:this._toObjects(ne,le)};return fe&&!fe.excludeFromExport&&(xe.clipPath=this._toObject(this.clipPath,ne,le)),j(xe,this.__serializeBgOverlay(ne,le)),te.util.populateWithProperties(this,xe,le),xe},_toObjects:function(ne,le){return this._objects.filter(function(fe){return!fe.excludeFromExport}).map(function(fe){return this._toObject(fe,ne,le)},this)},_toObject:function(ne,le,fe){var xe;this.includeDefaultValues||(xe=ne.includeDefaultValues,ne.includeDefaultValues=!1);var Pe=ne[le](fe);return this.includeDefaultValues||(ne.includeDefaultValues=xe),Pe},__serializeBgOverlay:function(ne,le){var fe={},xe=this.backgroundImage,Pe=this.overlayImage,De=this.backgroundColor,je=this.overlayColor;return De&&De.toObject?De.excludeFromExport||(fe.background=De.toObject(le)):De&&(fe.background=De),je&&je.toObject?je.excludeFromExport||(fe.overlay=je.toObject(le)):je&&(fe.overlay=je),xe&&!xe.excludeFromExport&&(fe.backgroundImage=this._toObject(xe,ne,le)),Pe&&!Pe.excludeFromExport&&(fe.overlayImage=this._toObject(Pe,ne,le)),fe},svgViewportTransformation:!0,toSVG:function(ne,le){ne||(ne={}),ne.reviver=le;var fe=[];return this._setSVGPreamble(fe,ne),this._setSVGHeader(fe,ne),this.clipPath&&fe.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(fe,"background"),this._setSVGBgOverlayImage(fe,"backgroundImage",le),this._setSVGObjects(fe,le),this.clipPath&&fe.push("</g>\n"),this._setSVGBgOverlayColor(fe,"overlay"),this._setSVGBgOverlayImage(fe,"overlayImage",le),fe.push("</svg>"),fe.join("")},_setSVGPreamble:function(ne,le){le.suppressPreamble||ne.push('<?xml version="1.0" encoding="',le.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(ne,le){var fe,xe=le.width||this.width,Pe=le.height||this.height,De='viewBox="0 0 '+this.width+" "+this.height+'" ',je=te.Object.NUM_FRACTION_DIGITS;le.viewBox?De='viewBox="'+le.viewBox.x+" "+le.viewBox.y+" "+le.viewBox.width+" "+le.viewBox.height+'" ':this.svgViewportTransformation&&(De='viewBox="'+q(-(fe=this.viewportTransform)[4]/fe[0],je)+" "+q(-fe[5]/fe[3],je)+" "+q(this.width/fe[0],je)+" "+q(this.height/fe[3],je)+'" '),ne.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',xe,'" ','height="',Pe,'" ',De,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",te.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(le),"</defs>\n")},createSVGClipPathMarkup:function(ne){var le=this.clipPath;return le?(le.clipPathId="CLIPPATH_"+te.Object.__uid++,'<clipPath id="'+le.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(ne.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var ne=this;return["background","overlay"].map(function(le){var fe=ne[le+"Color"];if(fe&&fe.toLive){var xe=ne[le+"Vpt"],Pe=ne.viewportTransform;return fe.toSVG({width:ne.width/(xe?Pe[0]:1),height:ne.height/(xe?Pe[3]:1)},{additionalTransform:xe?te.util.matrixToSVG(Pe):""})}}).join("")},createSVGFontFacesMarkup:function(){var ne,le,fe,xe,Pe,De,je,ke,Ae="",he={},tt=te.fontPaths,Ze=[];for(this._objects.forEach(function et(Qe){Ze.push(Qe),Qe._objects&&Qe._objects.forEach(et)}),je=0,ke=Ze.length;je<ke;je++)if(le=(ne=Ze[je]).fontFamily,-1!==ne.type.indexOf("text")&&!he[le]&&tt[le]&&(he[le]=!0,ne.styles))for(Pe in fe=ne.styles)for(De in xe=fe[Pe])!he[le=xe[De].fontFamily]&&tt[le]&&(he[le]=!0);for(var nt in he)Ae+=["\t\t@font-face {\n","\t\t\tfont-family: '",nt,"';\n","\t\t\tsrc: url('",tt[nt],"');\n","\t\t}\n"].join("");return Ae&&(Ae=['\t<style type="text/css">',"<![CDATA[\n",Ae,"]]>","</style>\n"].join("")),Ae},_setSVGObjects:function(ne,le){var fe,xe,Pe,De=this._objects;for(xe=0,Pe=De.length;xe<Pe;xe++)(fe=De[xe]).excludeFromExport||this._setSVGObject(ne,fe,le)},_setSVGObject:function(ne,le,fe){ne.push(le.toSVG(fe))},_setSVGBgOverlayImage:function(ne,le,fe){this[le]&&!this[le].excludeFromExport&&this[le].toSVG&&ne.push(this[le].toSVG(fe))},_setSVGBgOverlayColor:function(ne,le){var fe=this[le+"Color"],Pe=this.width,De=this.height;if(fe)if(fe.toLive){var je=fe.repeat,ke=te.util.invertTransform(this.viewportTransform),Ae=this[le+"Vpt"]?te.util.matrixToSVG(ke):"";ne.push('<rect transform="'+Ae+" translate(",Pe/2,",",De/2,')"',' x="',fe.offsetX-Pe/2,'" y="',fe.offsetY-De/2,'" ','width="',"repeat-y"===je||"no-repeat"===je?fe.source.width:Pe,'" height="',"repeat-x"===je||"no-repeat"===je?fe.source.height:De,'" fill="url(#SVGID_'+fe.id+')"',"></rect>\n")}else ne.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',fe,'"',"></rect>\n")},sendToBack:function(ne){if(!ne)return this;var le,fe,xe,Pe=this._activeObject;if(ne===Pe&&"activeSelection"===ne.type)for(le=(xe=Pe._objects).length;le--;)Y(this._objects,fe=xe[le]),this._objects.unshift(fe);else Y(this._objects,ne),this._objects.unshift(ne);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(ne){if(!ne)return this;var le,fe,xe,Pe=this._activeObject;if(ne===Pe&&"activeSelection"===ne.type)for(xe=Pe._objects,le=0;le<xe.length;le++)Y(this._objects,fe=xe[le]),this._objects.push(fe);else Y(this._objects,ne),this._objects.push(ne);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(ne,le){if(!ne)return this;var fe,xe,Pe,De,je,ke=this._activeObject,Ae=0;if(ne===ke&&"activeSelection"===ne.type)for(je=ke._objects,fe=0;fe<je.length;fe++)(Pe=this._objects.indexOf(xe=je[fe]))>0+Ae&&(De=Pe-1,Y(this._objects,xe),this._objects.splice(De,0,xe)),Ae++;else 0!==(Pe=this._objects.indexOf(ne))&&(De=this._findNewLowerIndex(ne,Pe,le),Y(this._objects,ne),this._objects.splice(De,0,ne));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(ne,le,fe){var xe,Pe;if(fe){for(xe=le,Pe=le-1;Pe>=0;--Pe)if(ne.intersectsWithObject(this._objects[Pe])||ne.isContainedWithinObject(this._objects[Pe])||this._objects[Pe].isContainedWithinObject(ne)){xe=Pe;break}}else xe=le-1;return xe},bringForward:function(ne,le){if(!ne)return this;var fe,xe,Pe,De,je,ke=this._activeObject,Ae=0;if(ne===ke&&"activeSelection"===ne.type)for(fe=(je=ke._objects).length;fe--;)(Pe=this._objects.indexOf(xe=je[fe]))<this._objects.length-1-Ae&&(De=Pe+1,Y(this._objects,xe),this._objects.splice(De,0,xe)),Ae++;else(Pe=this._objects.indexOf(ne))!==this._objects.length-1&&(De=this._findNewUpperIndex(ne,Pe,le),Y(this._objects,ne),this._objects.splice(De,0,ne));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(ne,le,fe){var xe,Pe,De;if(fe){for(xe=le,Pe=le+1,De=this._objects.length;Pe<De;++Pe)if(ne.intersectsWithObject(this._objects[Pe])||ne.isContainedWithinObject(this._objects[Pe])||this._objects[Pe].isContainedWithinObject(ne)){xe=Pe;break}}else xe=le+1;return xe},moveTo:function(ne,le){return Y(this._objects,ne),this._objects.splice(le,0,ne),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(te.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(ne){ne.dispose&&ne.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),te.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),te.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),j(te.StaticCanvas.prototype,te.Observable),j(te.StaticCanvas.prototype,te.Collection),j(te.StaticCanvas.prototype,te.DataURLExporter),j(te.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(ne){var le=ie();if(!le||!le.getContext)return null;var fe=le.getContext("2d");return fe&&"setLineDash"===ne?void 0!==fe.setLineDash:null}}),te.StaticCanvas.prototype.toJSON=te.StaticCanvas.prototype.toObject,te.isLikelyNode&&(te.StaticCanvas.prototype.createPNGStream=function(){var ne=$(this.lowerCanvasEl);return ne&&ne.createPNGStream()},te.StaticCanvas.prototype.createJPEGStream=function(ne){var le=$(this.lowerCanvasEl);return le&&le.createJPEGStream(ne)})}}(),te.BaseBrush=te.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(j){j.strokeStyle=this.color,j.lineWidth=this.width,j.lineCap=this.strokeLineCap,j.miterLimit=this.strokeMiterLimit,j.lineJoin=this.strokeLineJoin,j.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(j){var L=this.canvas.viewportTransform;j.save(),j.transform(L[0],L[1],L[2],L[3],L[4],L[5])},_setShadow:function(){if(this.shadow){var j=this.canvas,L=this.shadow,Y=j.contextTop,q=j.getZoom();j&&j._isRetinaScaling()&&(q*=te.devicePixelRatio),Y.shadowColor=L.color,Y.shadowBlur=L.blur*q,Y.shadowOffsetX=L.offsetX*q,Y.shadowOffsetY=L.offsetY*q}},needsFullRender:function(){return new te.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var j=this.canvas.contextTop;j.shadowColor="",j.shadowBlur=j.shadowOffsetX=j.shadowOffsetY=0},_isOutSideCanvas:function(j){return j.x<0||j.x>this.canvas.getWidth()||j.y<0||j.y>this.canvas.getHeight()}}),te.PencilBrush=te.util.createClass(te.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(j){this.canvas=j,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(j,L,Y){var q=L.midPointFrom(Y);return j.quadraticCurveTo(L.x,L.y,q.x,q.y),q},onMouseDown:function(j,L){this.canvas._isMainEvent(L.e)&&(this.drawStraightLine=L.e[this.straightLineKey],this._prepareForDrawing(j),this._captureDrawingPath(j),this._render())},onMouseMove:function(j,L){if(this.canvas._isMainEvent(L.e)&&(this.drawStraightLine=L.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(j))&&this._captureDrawingPath(j)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var Y=this._points,q=Y.length,k=this.canvas.contextTop;this._saveAndTransform(k),this.oldEnd&&(k.beginPath(),k.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(k,Y[q-2],Y[q-1],!0),k.stroke(),k.restore()}},onMouseUp:function(j){return!this.canvas._isMainEvent(j.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(j){var L=new te.Point(j.x,j.y);this._reset(),this._addPoint(L),this.canvas.contextTop.moveTo(L.x,L.y)},_addPoint:function(j){return!(this._points.length>1&&j.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(j),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(j){var L=new te.Point(j.x,j.y);return this._addPoint(L)},_render:function(j){var L,Y,q=this._points[0],k=this._points[1];if(this._saveAndTransform(j=j||this.canvas.contextTop),j.beginPath(),2===this._points.length&&q.x===k.x&&q.y===k.y){var N=this.width/1e3;q=new te.Point(q.x,q.y),k=new te.Point(k.x,k.y),q.x-=N,k.x+=N}for(j.moveTo(q.x,q.y),L=1,Y=this._points.length;L<Y;L++)this._drawSegment(j,q,k),q=this._points[L],k=this._points[L+1];j.lineTo(q.x,q.y),j.stroke(),j.restore()},convertPointsToSVGPath:function(j){return te.util.getSmoothPathFromPoints(j,this.width/1e3)},_isEmptySVGPath:function(j){return"M 0 0 Q 0 0 0 0 L 0 0"===te.util.joinPath(j)},createPath:function(j){var L=new te.Path(j,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,L.shadow=new te.Shadow(this.shadow)),L},decimatePoints:function(j,L){if(j.length<=2)return j;var Y,q=this.canvas.getZoom(),k=Math.pow(L/q,2),N=j.length-1,$=j[0],ie=[$];for(Y=1;Y<N-1;Y++)Math.pow($.x-j[Y].x,2)+Math.pow($.y-j[Y].y,2)>=k&&ie.push($=j[Y]);return ie.push(j[N]),ie},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var j=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(j))this.canvas.requestRenderAll();else{var L=this.createPath(j);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:L}),this.canvas.add(L),this.canvas.requestRenderAll(),L.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:L})}}}),te.CircleBrush=te.util.createClass(te.BaseBrush,{width:10,initialize:function(j){this.canvas=j,this.points=[]},drawDot:function(j){var L=this.addPoint(j),Y=this.canvas.contextTop;this._saveAndTransform(Y),this.dot(Y,L),Y.restore()},dot:function(j,L){j.fillStyle=L.fill,j.beginPath(),j.arc(L.x,L.y,L.radius,0,2*Math.PI,!1),j.closePath(),j.fill()},onMouseDown:function(j){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(j)},_render:function(){var j,L,Y=this.canvas.contextTop,q=this.points;for(this._saveAndTransform(Y),j=0,L=q.length;j<L;j++)this.dot(Y,q[j]);Y.restore()},onMouseMove:function(j){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(j)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(j),this._render()):this.drawDot(j))},onMouseUp:function(){var j,L,Y=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var q=[];for(j=0,L=this.points.length;j<L;j++){var k=this.points[j],N=new te.Circle({radius:k.radius,left:k.x,top:k.y,originX:"center",originY:"center",fill:k.fill});this.shadow&&(N.shadow=new te.Shadow(this.shadow)),q.push(N)}var $=new te.Group(q);$.canvas=this.canvas,this.canvas.fire("before:path:created",{path:$}),this.canvas.add($),this.canvas.fire("path:created",{path:$}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=Y,this.canvas.requestRenderAll()},addPoint:function(j){var L=new te.Point(j.x,j.y),Y=te.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,q=new te.Color(this.color).setAlpha(te.util.getRandomInt(0,100)/100).toRgba();return L.radius=Y,L.fill=q,this.points.push(L),L}}),te.SprayBrush=te.util.createClass(te.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(j){this.canvas=j,this.sprayChunks=[]},onMouseDown:function(j){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(j),this.render(this.sprayChunkPoints)},onMouseMove:function(j){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(j)||(this.addSprayChunk(j),this.render(this.sprayChunkPoints))},onMouseUp:function(){var j=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var L=[],Y=0,q=this.sprayChunks.length;Y<q;Y++)for(var k=this.sprayChunks[Y],N=0,$=k.length;N<$;N++){var ie=new te.Rect({width:k[N].width,height:k[N].width,left:k[N].x+1,top:k[N].y+1,originX:"center",originY:"center",fill:this.color});L.push(ie)}this.optimizeOverlapping&&(L=this._getOptimizedRects(L));var ee=new te.Group(L);this.shadow&&ee.set("shadow",new te.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:ee}),this.canvas.add(ee),this.canvas.fire("path:created",{path:ee}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=j,this.canvas.requestRenderAll()},_getOptimizedRects:function(j){var L,Y,q,k={};for(Y=0,q=j.length;Y<q;Y++)k[L=j[Y].left+""+j[Y].top]||(k[L]=j[Y]);var N=[];for(L in k)N.push(k[L]);return N},render:function(j){var L,Y,q=this.canvas.contextTop;for(q.fillStyle=this.color,this._saveAndTransform(q),L=0,Y=j.length;L<Y;L++){var k=j[L];void 0!==k.opacity&&(q.globalAlpha=k.opacity),q.fillRect(k.x,k.y,k.width,k.width)}q.restore()},_render:function(){var j,L,Y=this.canvas.contextTop;for(Y.fillStyle=this.color,this._saveAndTransform(Y),j=0,L=this.sprayChunks.length;j<L;j++)this.render(this.sprayChunks[j]);Y.restore()},addSprayChunk:function(j){this.sprayChunkPoints=[];var L,Y,q,k,N=this.width/2;for(k=0;k<this.density;k++){L=te.util.getRandomInt(j.x-N,j.x+N),Y=te.util.getRandomInt(j.y-N,j.y+N),q=this.dotWidthVariance?te.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var $=new te.Point(L,Y);$.width=q,this.randomOpacity&&($.opacity=te.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push($)}this.sprayChunks.push(this.sprayChunkPoints)}}),te.PatternBrush=te.util.createClass(te.PencilBrush,{getPatternSrc:function(){var j=te.util.createCanvasElement(),L=j.getContext("2d");return j.width=j.height=25,L.fillStyle=this.color,L.beginPath(),L.arc(10,10,10,0,2*Math.PI,!1),L.closePath(),L.fill(),j},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(j){return j.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(j){this.callSuper("_setBrushStyles",j),j.strokeStyle=this.getPattern(j)},createPath:function(j){var L=this.callSuper("createPath",j),Y=L._getLeftTopCoords().scalarAdd(L.strokeWidth/2);return L.stroke=new te.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-Y.x,offsetY:-Y.y}),L}}),function(){var j=te.util.getPointer,L=te.util.degreesToRadians,Y=te.util.isTouchEvent;for(var q in te.Canvas=te.util.createClass(te.StaticCanvas,{initialize:function(k,N){N||(N={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(k,N),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=te.PencilBrush&&new te.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var k,N,$,ie=this.getActiveObjects();if(ie.length>0&&!this.preserveObjectStacking){N=[],$=[];for(var ee=0,ne=this._objects.length;ee<ne;ee++)-1===ie.indexOf(k=this._objects[ee])?N.push(k):$.push(k);ie.length>1&&(this._activeObject._objects=$),N.push.apply(N,$)}else N=this._objects;return N},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(k){k.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(k),this.contextTopDirty=!0),k.restore()},renderTop:function(){var k=this.contextTop;return this.clearContext(k),this.renderTopLayer(k),this.fire("after:render"),this},_normalizePointer:function(k,N){var $=k.calcTransformMatrix(),ie=te.util.invertTransform($),ee=this.restorePointerVpt(N);return te.util.transformPoint(ee,ie)},isTargetTransparent:function(k,N,$){if(k.shouldCache()&&k._cacheCanvas&&k!==this._activeObject){var ie=this._normalizePointer(k,{x:N,y:$}),ee=Math.max(k.cacheTranslationX+ie.x*k.zoomX,0),ne=Math.max(k.cacheTranslationY+ie.y*k.zoomY,0);return te.util.isTransparent(k._cacheContext,Math.round(ee),Math.round(ne),this.targetFindTolerance)}var le=this.contextCache,fe=k.selectionBackgroundColor,xe=this.viewportTransform;return k.selectionBackgroundColor="",this.clearContext(le),le.save(),le.transform(xe[0],xe[1],xe[2],xe[3],xe[4],xe[5]),k.render(le),le.restore(),k.selectionBackgroundColor=fe,te.util.isTransparent(le,N,$,this.targetFindTolerance)},_isSelectionKeyPressed:function(k){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(N){return!0===k[N]}):k[this.selectionKey]},_shouldClearSelection:function(k,N){var $=this.getActiveObjects(),ie=this._activeObject;return!N||N&&ie&&$.length>1&&-1===$.indexOf(N)&&ie!==N&&!this._isSelectionKeyPressed(k)||N&&!N.evented||N&&!N.selectable&&ie&&ie!==N},_shouldCenterTransform:function(k,N,$){var ie;if(k)return"scale"===N||"scaleX"===N||"scaleY"===N||"resizing"===N?ie=this.centeredScaling||k.centeredScaling:"rotate"===N&&(ie=this.centeredRotation||k.centeredRotation),ie?!$:$},_getOriginFromCorner:function(k,N){var $={x:k.originX,y:k.originY};return"ml"===N||"tl"===N||"bl"===N?$.x="right":"mr"!==N&&"tr"!==N&&"br"!==N||($.x="left"),"tl"===N||"mt"===N||"tr"===N?$.y="bottom":"bl"!==N&&"mb"!==N&&"br"!==N||($.y="top"),$},_getActionFromCorner:function(k,N,$,ie){if(!N||!k)return"drag";var ee=ie.controls[N];return ee.getActionName($,ee,ie)},_setupCurrentTransform:function(k,N,$){if(N){var ie=this.getPointer(k),ee=N.__corner,ne=N.controls[ee],le=$&&ee?ne.getActionHandler(k,N,ne):te.controlsUtils.dragHandler,fe=this._getActionFromCorner($,ee,k,N),xe=this._getOriginFromCorner(N,ee),Pe=k[this.centeredKey],De={target:N,action:fe,actionHandler:le,corner:ee,scaleX:N.scaleX,scaleY:N.scaleY,skewX:N.skewX,skewY:N.skewY,offsetX:ie.x-N.left,offsetY:ie.y-N.top,originX:xe.x,originY:xe.y,ex:ie.x,ey:ie.y,lastX:ie.x,lastY:ie.y,theta:L(N.angle),width:N.width*N.scaleX,shiftKey:k.shiftKey,altKey:Pe,original:te.util.saveObjectTransform(N)};this._shouldCenterTransform(N,fe,Pe)&&(De.originX="center",De.originY="center"),De.original.originX=xe.x,De.original.originY=xe.y,this._currentTransform=De,this._beforeTransform(k)}},setCursor:function(k){this.upperCanvasEl.style.cursor=k},_drawSelection:function(k){var N=this._groupSelector,$=new te.Point(N.ex,N.ey),ie=te.util.transformPoint($,this.viewportTransform),ee=new te.Point(N.ex+N.left,N.ey+N.top),ne=te.util.transformPoint(ee,this.viewportTransform),le=Math.min(ie.x,ne.x),fe=Math.min(ie.y,ne.y),xe=Math.max(ie.x,ne.x),Pe=Math.max(ie.y,ne.y),De=this.selectionLineWidth/2;this.selectionColor&&(k.fillStyle=this.selectionColor,k.fillRect(le,fe,xe-le,Pe-fe)),this.selectionLineWidth&&this.selectionBorderColor&&(k.lineWidth=this.selectionLineWidth,k.strokeStyle=this.selectionBorderColor,le+=De,fe+=De,xe-=De,Pe-=De,te.Object.prototype._setLineDash.call(this,k,this.selectionDashArray),k.strokeRect(le,fe,xe-le,Pe-fe))},findTarget:function(k,N){if(!this.skipTargetFind){var $,ie,ee=this.getPointer(k,!0),ne=this._activeObject,le=this.getActiveObjects(),fe=Y(k),xe=le.length>1&&!N||1===le.length;if(this.targets=[],xe&&ne._findTargetCorner(ee,fe)||le.length>1&&!N&&ne===this._searchPossibleTargets([ne],ee))return ne;if(1===le.length&&ne===this._searchPossibleTargets([ne],ee)){if(!this.preserveObjectStacking)return ne;$=ne,ie=this.targets,this.targets=[]}var Pe=this._searchPossibleTargets(this._objects,ee);return k[this.altSelectionKey]&&Pe&&$&&Pe!==$&&(Pe=$,this.targets=ie),Pe}},_checkTarget:function(k,N,$){if(N&&N.visible&&N.evented&&N.containsPoint(k)&&(!this.perPixelTargetFind&&!N.perPixelTargetFind||N.isEditing||!this.isTargetTransparent(N,$.x,$.y)))return!0},_searchPossibleTargets:function(k,N){for(var $,ie,ee=k.length;ee--;){var ne=k[ee],le=ne.group?this._normalizePointer(ne.group,N):N;if(this._checkTarget(le,ne,N)){($=k[ee]).subTargetCheck&&$ instanceof te.Group&&(ie=this._searchPossibleTargets($._objects,N))&&this.targets.push(ie);break}}return $},restorePointerVpt:function(k){return te.util.transformPoint(k,te.util.invertTransform(this.viewportTransform))},getPointer:function(k,N){if(this._absolutePointer&&!N)return this._absolutePointer;if(this._pointer&&N)return this._pointer;var $,ie=j(k),ee=this.upperCanvasEl,ne=ee.getBoundingClientRect(),le=ne.width||0,fe=ne.height||0;le&&fe||("top"in ne&&"bottom"in ne&&(fe=Math.abs(ne.top-ne.bottom)),"right"in ne&&"left"in ne&&(le=Math.abs(ne.right-ne.left))),this.calcOffset(),ie.x=ie.x-this._offset.left,ie.y=ie.y-this._offset.top,N||(ie=this.restorePointerVpt(ie));var xe=this.getRetinaScaling();return 1!==xe&&(ie.x/=xe,ie.y/=xe),{x:ie.x*($=0===le||0===fe?{width:1,height:1}:{width:ee.width/le,height:ee.height/fe}).width,y:ie.y*$.height}},_createUpperCanvas:function(){var k=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),N=this.lowerCanvasEl,$=this.upperCanvasEl;$?$.className="":($=this._createCanvasElement(),this.upperCanvasEl=$),te.util.addClass($,"upper-canvas "+k),this.wrapperEl.appendChild($),this._copyCanvasStyle(N,$),this._applyCanvasStyle($),this.contextTop=$.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=te.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),te.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),te.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(k){var N=this.width||k.width,$=this.height||k.height;te.util.setStyle(k,{position:"absolute",width:N+"px",height:$+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),k.width=N,k.height=$,te.util.makeElementUnselectable(k)},_copyCanvasStyle:function(k,N){N.style.cssText=k.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var k=this._activeObject;return k?"activeSelection"===k.type&&k._objects?k._objects.slice(0):[k]:[]},_onObjectRemoved:function(k){k===this._activeObject&&(this.fire("before:selection:cleared",{target:k}),this._discardActiveObject(),this.fire("selection:cleared",{target:k}),k.fire("deselected")),k===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",k)},_fireSelectionEvents:function(k,N){var $=!1,ie=this.getActiveObjects(),ee=[],ne=[];k.forEach(function(le){-1===ie.indexOf(le)&&($=!0,le.fire("deselected",{e:N,target:le}),ne.push(le))}),ie.forEach(function(le){-1===k.indexOf(le)&&($=!0,le.fire("selected",{e:N,target:le}),ee.push(le))}),k.length>0&&ie.length>0?$&&this.fire("selection:updated",{e:N,selected:ee,deselected:ne}):ie.length>0?this.fire("selection:created",{e:N,selected:ee}):k.length>0&&this.fire("selection:cleared",{e:N,deselected:ne})},setActiveObject:function(k,N){var $=this.getActiveObjects();return this._setActiveObject(k,N),this._fireSelectionEvents($,N),this},_setActiveObject:function(k,N){return this._activeObject!==k&&!!this._discardActiveObject(N,k)&&!k.onSelect({e:N})&&(this._activeObject=k,!0)},_discardActiveObject:function(k,N){var $=this._activeObject;if($){if($.onDeselect({e:k,object:N}))return!1;this._activeObject=null}return!0},discardActiveObject:function(k){var N=this.getActiveObjects(),$=this.getActiveObject();return N.length&&this.fire("before:selection:cleared",{target:$,e:k}),this._discardActiveObject(k),this._fireSelectionEvents(N,k),this},dispose:function(){var k=this.wrapperEl;return this.removeListeners(),k.removeChild(this.upperCanvasEl),k.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(N){te.util.cleanUpJsdomNode(this[N]),this[N]=void 0}.bind(this)),k.parentNode&&k.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,te.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(k){var N=this._activeObject;N&&N._renderControls(k)},_toObject:function(k,N,$){var ie=this._realizeGroupTransformOnObject(k),ee=this.callSuper("_toObject",k,N,$);return this._unwindGroupTransformOnObject(k,ie),ee},_realizeGroupTransformOnObject:function(k){if(k.group&&"activeSelection"===k.group.type&&this._activeObject===k.group){var N={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function($){N[$]=k[$]}),te.util.addTransformToObject(k,this._activeObject.calcOwnMatrix()),N}return null},_unwindGroupTransformOnObject:function(k,N){N&&k.set(N)},_setSVGObject:function(k,N,$){var ie=this._realizeGroupTransformOnObject(N);this.callSuper("_setSVGObject",k,N,$),this._unwindGroupTransformOnObject(N,ie)},setViewportTransform:function(k){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),te.StaticCanvas.prototype.setViewportTransform.call(this,k)}}),te.StaticCanvas)"prototype"!==q&&(te.Canvas[q]=te.StaticCanvas[q])}(),function(){var j=te.util.addListener,L=te.util.removeListener,Y={passive:!1};function q(k,N){return k.button&&k.button===N-1}te.util.object.extend(te.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(j,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(k,N){var $=this.upperCanvasEl,ie=this._getEventPrefix();k(te.window,"resize",this._onResize),k($,ie+"down",this._onMouseDown),k($,ie+"move",this._onMouseMove,Y),k($,ie+"out",this._onMouseOut),k($,ie+"enter",this._onMouseEnter),k($,"wheel",this._onMouseWheel),k($,"contextmenu",this._onContextMenu),k($,"dblclick",this._onDoubleClick),k($,"dragover",this._onDragOver),k($,"dragenter",this._onDragEnter),k($,"dragleave",this._onDragLeave),k($,"drop",this._onDrop),this.enablePointerEvents||k($,"touchstart",this._onTouchStart,Y),"undefined"!=typeof eventjs&&N in eventjs&&(eventjs[N]($,"gesture",this._onGesture),eventjs[N]($,"drag",this._onDrag),eventjs[N]($,"orientation",this._onOrientationChange),eventjs[N]($,"shake",this._onShake),eventjs[N]($,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(L,"remove");var k=this._getEventPrefix();L(te.document,k+"up",this._onMouseUp),L(te.document,"touchend",this._onTouchEnd,Y),L(te.document,k+"move",this._onMouseMove,Y),L(te.document,"touchmove",this._onMouseMove,Y)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(k,N){this.__onTransformGesture&&this.__onTransformGesture(k,N)},_onDrag:function(k,N){this.__onDrag&&this.__onDrag(k,N)},_onMouseWheel:function(k){this.__onMouseWheel(k)},_onMouseOut:function(k){var N=this._hoveredTarget;this.fire("mouse:out",{target:N,e:k}),this._hoveredTarget=null,N&&N.fire("mouseout",{e:k});var $=this;this._hoveredTargets.forEach(function(ie){$.fire("mouse:out",{target:N,e:k}),ie&&N.fire("mouseout",{e:k})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(ie){ie.isEditing&&ie.hiddenTextarea.focus()})},_onMouseEnter:function(k){this._currentTransform||this.findTarget(k)||(this.fire("mouse:over",{target:null,e:k}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(k,N){this.__onOrientationChange&&this.__onOrientationChange(k,N)},_onShake:function(k,N){this.__onShake&&this.__onShake(k,N)},_onLongPress:function(k,N){this.__onLongPress&&this.__onLongPress(k,N)},_onDragOver:function(k){k.preventDefault();var N=this._simpleEventHandler("dragover",k);this._fireEnterLeaveEvents(N,k)},_onDrop:function(k){return this._simpleEventHandler("drop:before",k),this._simpleEventHandler("drop",k)},_onContextMenu:function(k){return this.stopContextMenu&&(k.stopPropagation(),k.preventDefault()),!1},_onDoubleClick:function(k){this._cacheTransformEventData(k),this._handleEvent(k,"dblclick"),this._resetTransformEventData(k)},getPointerId:function(k){var N=k.changedTouches;return N?N[0]&&N[0].identifier:this.enablePointerEvents?k.pointerId:-1},_isMainEvent:function(k){return!0===k.isPrimary||!1!==k.isPrimary&&("touchend"===k.type&&0===k.touches.length||!k.changedTouches||k.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(k){k.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(k)),this.__onMouseDown(k),this._resetTransformEventData();var N=this.upperCanvasEl,$=this._getEventPrefix();j(te.document,"touchend",this._onTouchEnd,Y),j(te.document,"touchmove",this._onMouseMove,Y),L(N,$+"down",this._onMouseDown)},_onMouseDown:function(k){this.__onMouseDown(k),this._resetTransformEventData();var N=this.upperCanvasEl,$=this._getEventPrefix();L(N,$+"move",this._onMouseMove,Y),j(te.document,$+"up",this._onMouseUp),j(te.document,$+"move",this._onMouseMove,Y)},_onTouchEnd:function(k){if(!(k.touches.length>0)){this.__onMouseUp(k),this._resetTransformEventData(),this.mainTouchId=null;var N=this._getEventPrefix();L(te.document,"touchend",this._onTouchEnd,Y),L(te.document,"touchmove",this._onMouseMove,Y);var $=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){j($.upperCanvasEl,N+"down",$._onMouseDown),$._willAddMouseDown=0},400)}},_onMouseUp:function(k){this.__onMouseUp(k),this._resetTransformEventData();var N=this.upperCanvasEl,$=this._getEventPrefix();this._isMainEvent(k)&&(L(te.document,$+"up",this._onMouseUp),L(te.document,$+"move",this._onMouseMove,Y),j(N,$+"move",this._onMouseMove,Y))},_onMouseMove:function(k){!this.allowTouchScrolling&&k.preventDefault&&k.preventDefault(),this.__onMouseMove(k)},_onResize:function(){this.calcOffset()},_shouldRender:function(k){var N=this._activeObject;return!!(!!N!=!!k||N&&k&&N!==k)||!1},__onMouseUp:function(k){var N,$=this._currentTransform,ie=this._groupSelector,ee=!1,ne=!ie||0===ie.left&&0===ie.top;if(this._cacheTransformEventData(k),N=this._target,this._handleEvent(k,"up:before"),q(k,3))this.fireRightClick&&this._handleEvent(k,"up",3,ne);else{if(q(k,2))return this.fireMiddleClick&&this._handleEvent(k,"up",2,ne),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(k);else if(this._isMainEvent(k)){if($&&(this._finalizeCurrentTransform(k),ee=$.actionPerformed),!ne){var le=N===this._activeObject;this._maybeGroupObjects(k),ee||(ee=this._shouldRender(N)||!le&&N===this._activeObject)}var fe,xe;if(N){if(fe=N._findTargetCorner(this.getPointer(k,!0),te.util.isTouchEvent(k)),N.selectable&&N!==this._activeObject&&"up"===N.activeOn)this.setActiveObject(N,k),ee=!0;else{var Pe=N.controls[fe],De=Pe&&Pe.getMouseUpHandler(k,N,Pe);De&&De(k,$,(xe=this.getPointer(k)).x,xe.y)}N.isMoving=!1}if($&&($.target!==N||$.corner!==fe)){var je=$.target&&$.target.controls[$.corner],ke=je&&je.getMouseUpHandler(k,N,Pe);xe=xe||this.getPointer(k),ke&&ke(k,$,xe.x,xe.y)}this._setCursorFromEvent(k,N),this._handleEvent(k,"up",1,ne),this._groupSelector=null,this._currentTransform=null,N&&(N.__corner=0),ee?this.requestRenderAll():ne||this.renderTop()}}},_simpleEventHandler:function(k,N){var $=this.findTarget(N),ie=this.targets,ee={e:N,target:$,subTargets:ie};if(this.fire(k,ee),$&&$.fire(k,ee),!ie)return $;for(var ne=0;ne<ie.length;ne++)ie[ne].fire(k,ee);return $},_handleEvent:function(k,N,$,ie){var ee=this._target,ne=this.targets||[],le={e:k,target:ee,subTargets:ne,button:$||1,isClick:ie||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===N&&(le.currentTarget=this.findTarget(k),le.currentSubTargets=this.targets),this.fire("mouse:"+N,le),ee&&ee.fire("mouse"+N,le);for(var fe=0;fe<ne.length;fe++)ne[fe].fire("mouse"+N,le)},_finalizeCurrentTransform:function(k){var N=this._currentTransform,$=N.target,ie={e:k,target:$,transform:N,action:N.action};$._scaling&&($._scaling=!1),$.setCoords(),(N.actionPerformed||this.stateful&&$.hasStateChanged())&&this._fire("modified",ie)},_onMouseDownInDrawingMode:function(k){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(k).requestRenderAll();var N=this.getPointer(k);this.freeDrawingBrush.onMouseDown(N,{e:k,pointer:N}),this._handleEvent(k,"down")},_onMouseMoveInDrawingMode:function(k){if(this._isCurrentlyDrawing){var N=this.getPointer(k);this.freeDrawingBrush.onMouseMove(N,{e:k,pointer:N})}this.setCursor(this.freeDrawingCursor),this._handleEvent(k,"move")},_onMouseUpInDrawingMode:function(k){var N=this.getPointer(k);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:k,pointer:N}),this._handleEvent(k,"up")},__onMouseDown:function(k){this._cacheTransformEventData(k),this._handleEvent(k,"down:before");var N=this._target;if(q(k,3))this.fireRightClick&&this._handleEvent(k,"down",3);else if(q(k,2))this.fireMiddleClick&&this._handleEvent(k,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(k);else if(this._isMainEvent(k)&&!this._currentTransform){var $=this._pointer;this._previousPointer=$;var ie=this._shouldRender(N),ee=this._shouldGroup(k,N);if(this._shouldClearSelection(k,N)?this.discardActiveObject(k):ee&&(this._handleGrouping(k,N),N=this._activeObject),!this.selection||N&&(N.selectable||N.isEditing||N===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),N){var ne=N===this._activeObject;N.selectable&&"down"===N.activeOn&&this.setActiveObject(N,k);var le=N._findTargetCorner(this.getPointer(k,!0),te.util.isTouchEvent(k));if(N.__corner=le,N===this._activeObject&&(le||!ee)){this._setupCurrentTransform(k,N,ne);var fe=N.controls[le],xe=($=this.getPointer(k),fe&&fe.getMouseDownHandler(k,N,fe));xe&&xe(k,this._currentTransform,$.x,$.y)}}this._handleEvent(k,"down"),(ie||ee)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(k){this._resetTransformEventData(),this._pointer=this.getPointer(k,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(k)||null},_beforeTransform:function(k){var N=this._currentTransform;this.stateful&&N.target.saveState(),this.fire("before:transform",{e:k,transform:N})},__onMouseMove:function(k){var N,$;if(this._handleEvent(k,"move:before"),this._cacheTransformEventData(k),this.isDrawingMode)this._onMouseMoveInDrawingMode(k);else if(this._isMainEvent(k)){var ie=this._groupSelector;ie?(ie.left=($=this._absolutePointer).x-ie.ex,ie.top=$.y-ie.ey,this.renderTop()):this._currentTransform?this._transformObject(k):(N=this.findTarget(k)||null,this._setCursorFromEvent(k,N),this._fireOverOutEvents(N,k)),this._handleEvent(k,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(k,N){var $=this._hoveredTarget,ie=this._hoveredTargets,ee=this.targets,ne=Math.max(ie.length,ee.length);this.fireSyntheticInOutEvents(k,N,{oldTarget:$,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var le=0;le<ne;le++)this.fireSyntheticInOutEvents(ee[le],N,{oldTarget:ie[le],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=k,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(k,N){var $=this._draggedoverTarget,ie=this._hoveredTargets,ee=this.targets,ne=Math.max(ie.length,ee.length);this.fireSyntheticInOutEvents(k,N,{oldTarget:$,evtOut:"dragleave",evtIn:"dragenter"});for(var le=0;le<ne;le++)this.fireSyntheticInOutEvents(ee[le],N,{oldTarget:ie[le],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=k},fireSyntheticInOutEvents:function(k,N,$){var ie,ee,ne,le=$.oldTarget,fe=le!==k,xe=$.canvasEvtIn,Pe=$.canvasEvtOut;fe&&(ie={e:N,target:k,previousTarget:le},ee={e:N,target:le,nextTarget:k}),ne=k&&fe,le&&fe&&(Pe&&this.fire(Pe,ee),le.fire($.evtOut,ee)),ne&&(xe&&this.fire(xe,ie),k.fire($.evtIn,ie))},__onMouseWheel:function(k){this._cacheTransformEventData(k),this._handleEvent(k,"wheel"),this._resetTransformEventData()},_transformObject:function(k){var N=this.getPointer(k),$=this._currentTransform;$.reset=!1,$.shiftKey=k.shiftKey,$.altKey=k[this.centeredKey],this._performTransformAction(k,$,N),$.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(k,N,$){var ne=N.action,le=!1,fe=N.actionHandler;fe&&(le=fe(k,N,$.x,$.y)),"drag"===ne&&le&&(N.target.isMoving=!0,this.setCursor(N.target.moveCursor||this.moveCursor)),N.actionPerformed=N.actionPerformed||le},_fire:te.controlsUtils.fireEvent,_setCursorFromEvent:function(k,N){if(!N)return this.setCursor(this.defaultCursor),!1;var $=N.hoverCursor||this.hoverCursor,ie=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,ee=(!ie||!ie.contains(N))&&N._findTargetCorner(this.getPointer(k,!0));ee?this.setCursor(this.getCornerCursor(ee,N,k)):(N.subTargetCheck&&this.targets.concat().reverse().map(function(ne){$=ne.hoverCursor||$}),this.setCursor($))},getCornerCursor:function(k,N,$){var ie=N.controls[k];return ie.cursorStyleHandler($,ie,N)}})}(),re=Math.min,se=Math.max,te.util.object.extend(te.Canvas.prototype,{_shouldGroup:function(j,L){var Y=this._activeObject;return Y&&this._isSelectionKeyPressed(j)&&L&&L.selectable&&this.selection&&(Y!==L||"activeSelection"===Y.type)&&!L.onSelect({e:j})},_handleGrouping:function(j,L){var Y=this._activeObject;Y.__corner||(L!==Y||(L=this.findTarget(j,!0))&&L.selectable)&&(Y&&"activeSelection"===Y.type?this._updateActiveSelection(L,j):this._createActiveSelection(L,j))},_updateActiveSelection:function(j,L){var Y=this._activeObject,q=Y._objects.slice(0);Y.contains(j)?(Y.removeWithUpdate(j),this._hoveredTarget=j,this._hoveredTargets=this.targets.concat(),1===Y.size()&&this._setActiveObject(Y.item(0),L)):(Y.addWithUpdate(j),this._hoveredTarget=Y,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(q,L)},_createActiveSelection:function(j,L){var Y=this.getActiveObjects(),q=this._createGroup(j);this._hoveredTarget=q,this._setActiveObject(q,L),this._fireSelectionEvents(Y,L)},_createGroup:function(j){var L=this._objects,Y=L.indexOf(this._activeObject)<L.indexOf(j)?[this._activeObject,j]:[j,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new te.ActiveSelection(Y,{canvas:this})},_groupSelectedObjects:function(j){var L,Y=this._collectObjects(j);1===Y.length?this.setActiveObject(Y[0],j):Y.length>1&&(L=new te.ActiveSelection(Y.reverse(),{canvas:this}),this.setActiveObject(L,j))},_collectObjects:function(j){for(var L,Y=[],q=this._groupSelector.ex,k=this._groupSelector.ey,N=q+this._groupSelector.left,$=k+this._groupSelector.top,ie=new te.Point(re(q,N),re(k,$)),ee=new te.Point(se(q,N),se(k,$)),ne=!this.selectionFullyContained,le=q===N&&k===$,fe=this._objects.length;fe--&&!((L=this._objects[fe])&&L.selectable&&L.visible&&(ne&&L.intersectsWithRect(ie,ee,!0)||L.isContainedWithinRect(ie,ee,!0)||ne&&L.containsPoint(ie,null,!0)||ne&&L.containsPoint(ee,null,!0))&&(Y.push(L),le)););return Y.length>1&&(Y=Y.filter(function(xe){return!xe.onSelect({e:j})})),Y},_maybeGroupObjects:function(j){this.selection&&this._groupSelector&&this._groupSelectedObjects(j),this.setCursor(this.defaultCursor),this._groupSelector=null}}),te.util.object.extend(te.StaticCanvas.prototype,{toDataURL:function(j){j||(j={});var L=j.format||"png",Y=j.quality||1,q=(j.multiplier||1)*(j.enableRetinaScaling?this.getRetinaScaling():1),k=this.toCanvasElement(q,j);return te.util.toDataURL(k,L,Y)},toCanvasElement:function(j,L){var Y=((L=L||{}).width||this.width)*(j=j||1),q=(L.height||this.height)*j,k=this.getZoom(),N=this.width,$=this.height,ie=k*j,ee=this.viewportTransform,fe=this.interactive,xe=[ie,0,0,ie,(ee[4]-(L.left||0))*j,(ee[5]-(L.top||0))*j],Pe=this.enableRetinaScaling,De=te.util.createCanvasElement(),je=this.contextTop;return De.width=Y,De.height=q,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=xe,this.width=Y,this.height=q,this.calcViewportBoundaries(),this.renderCanvas(De.getContext("2d"),this._objects),this.viewportTransform=ee,this.width=N,this.height=$,this.calcViewportBoundaries(),this.interactive=fe,this.enableRetinaScaling=Pe,this.contextTop=je,De}}),te.util.object.extend(te.StaticCanvas.prototype,{loadFromJSON:function(j,L,Y){if(j){var q="string"==typeof j?JSON.parse(j):te.util.object.clone(j),k=this,N=q.clipPath,$=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete q.clipPath,this._enlivenObjects(q.objects,function(ie){k.clear(),k._setBgOverlay(q,function(){N?k._enlivenObjects([N],function(ee){k.clipPath=ee[0],k.__setupCanvas.call(k,q,ie,$,L)}):k.__setupCanvas.call(k,q,ie,$,L)})},Y),this}},__setupCanvas:function(j,L,Y,q){var k=this;L.forEach(function(N,$){k.insertAt(N,$)}),this.renderOnAddRemove=Y,delete j.objects,delete j.backgroundImage,delete j.overlayImage,delete j.background,delete j.overlay,this._setOptions(j),this.renderAll(),q&&q()},_setBgOverlay:function(j,L){var Y={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(j.backgroundImage||j.overlayImage||j.background||j.overlay){var q=function(){Y.backgroundImage&&Y.overlayImage&&Y.backgroundColor&&Y.overlayColor&&L&&L()};this.__setBgOverlay("backgroundImage",j.backgroundImage,Y,q),this.__setBgOverlay("overlayImage",j.overlayImage,Y,q),this.__setBgOverlay("backgroundColor",j.background,Y,q),this.__setBgOverlay("overlayColor",j.overlay,Y,q)}else L&&L()},__setBgOverlay:function(j,L,Y,q){var k=this;if(!L)return Y[j]=!0,void(q&&q());"backgroundImage"===j||"overlayImage"===j?te.util.enlivenObjects([L],function(N){k[j]=N[0],Y[j]=!0,q&&q()}):this["set"+te.util.string.capitalize(j,!0)](L,function(){Y[j]=!0,q&&q()})},_enlivenObjects:function(j,L,Y){j&&0!==j.length?te.util.enlivenObjects(j,function(q){L&&L(q)},null,Y):L&&L([])},_toDataURL:function(j,L){this.clone(function(Y){L(Y.toDataURL(j))})},_toDataURLWithMultiplier:function(j,L,Y){this.clone(function(q){Y(q.toDataURLWithMultiplier(j,L))})},clone:function(j,L){var Y=JSON.stringify(this.toJSON(L));this.cloneWithoutData(function(q){q.loadFromJSON(Y,function(){j&&j(q)})})},cloneWithoutData:function(j){var L=te.util.createCanvasElement();L.width=this.width,L.height=this.height;var Y=new te.Canvas(L);this.backgroundImage?(Y.setBackgroundImage(this.backgroundImage.src,function(){Y.renderAll(),j&&j(Y)}),Y.backgroundImageOpacity=this.backgroundImageOpacity,Y.backgroundImageStretch=this.backgroundImageStretch):j&&j(Y)}}),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.util.object.clone,k=L.util.toFixed,N=L.util.string.capitalize,$=L.util.degreesToRadians;L.Object||(L.Object=L.util.createClass(L.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!L.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(ee){ee&&this.setOptions(ee)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=L.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(ee){var ne=L.perfLimitSizeTotal,le=ee.width,fe=ee.height,xe=L.maxCacheSideLimit,Pe=L.minCacheSideLimit;if(le<=xe&&fe<=xe&&le*fe<=ne)return le<Pe&&(ee.width=Pe),fe<Pe&&(ee.height=Pe),ee;var je=L.util.limitDimsByArea(le/fe,ne),ke=L.util.capValue,Ae=ke(Pe,je.x,xe),he=ke(Pe,je.y,xe);return le>Ae&&(ee.zoomX/=le/Ae,ee.width=Ae,ee.capped=!0),fe>he&&(ee.zoomY/=fe/he,ee.height=he,ee.capped=!0),ee},_getCacheCanvasDimensions:function(){var ee=this.getTotalObjectScaling(),ne=this._getTransformedDimensions(0,0),le=ne.x*ee.scaleX/this.scaleX,fe=ne.y*ee.scaleY/this.scaleY;return{width:le+2,height:fe+2,zoomX:ee.scaleX,zoomY:ee.scaleY,x:le,y:fe}},_updateCacheCanvas:function(){var ee=this.canvas;if(this.noScaleCache&&ee&&ee._currentTransform){var le=ee._currentTransform.action;if(this===ee._currentTransform.target&&le.slice&&"scale"===le.slice(0,5))return!1}var fe,xe,Pe=this._cacheCanvas,De=this._limitCacheSize(this._getCacheCanvasDimensions()),je=L.minCacheSideLimit,ke=De.width,Ae=De.height,he=De.zoomX,tt=De.zoomY,Ze=ke!==this.cacheWidth||Ae!==this.cacheHeight,et=Ze||this.zoomX!==he||this.zoomY!==tt,Qe=0,at=0,vt=!1;if(Ze){var dt=this._cacheCanvas.width,Je=this._cacheCanvas.height,it=ke>dt||Ae>Je;vt=it||(ke<.9*dt||Ae<.9*Je)&&dt>je&&Je>je,it&&!De.capped&&(ke>je||Ae>je)&&(Qe=.1*ke,at=.1*Ae)}return this instanceof L.Text&&this.path&&(et=!0,vt=!0,Qe+=this.getHeightOfLine(0)*this.zoomX,at+=this.getHeightOfLine(0)*this.zoomY),!!et&&(vt?(Pe.width=Math.ceil(ke+Qe),Pe.height=Math.ceil(Ae+at)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,Pe.width,Pe.height)),fe=De.x/2,xe=De.y/2,this.cacheTranslationX=Math.round(Pe.width/2-fe)+fe,this.cacheTranslationY=Math.round(Pe.height/2-xe)+xe,this.cacheWidth=ke,this.cacheHeight=Ae,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(he,tt),this.zoomX=he,this.zoomY=tt,!0)},setOptions:function(ee){this._setOptions(ee),this._initGradient(ee.fill,"fill"),this._initGradient(ee.stroke,"stroke"),this._initPattern(ee.fill,"fill"),this._initPattern(ee.stroke,"stroke")},transform:function(ee){var le=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&ee===this.canvas.contextTop));ee.transform(le[0],le[1],le[2],le[3],le[4],le[5])},toObject:function(ee){var ne=L.Object.NUM_FRACTION_DIGITS,le={type:this.type,version:L.version,originX:this.originX,originY:this.originY,left:k(this.left,ne),top:k(this.top,ne),width:k(this.width,ne),height:k(this.height,ne),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:k(this.strokeWidth,ne),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:k(this.strokeMiterLimit,ne),scaleX:k(this.scaleX,ne),scaleY:k(this.scaleY,ne),angle:k(this.angle,ne),flipX:this.flipX,flipY:this.flipY,opacity:k(this.opacity,ne),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:k(this.skewX,ne),skewY:k(this.skewY,ne)};return this.clipPath&&!this.clipPath.excludeFromExport&&(le.clipPath=this.clipPath.toObject(ee),le.clipPath.inverted=this.clipPath.inverted,le.clipPath.absolutePositioned=this.clipPath.absolutePositioned),L.util.populateWithProperties(this,le,ee),this.includeDefaultValues||(le=this._removeDefaultValues(le)),le},toDatalessObject:function(ee){return this.toObject(ee)},_removeDefaultValues:function(ee){var ne=L.util.getKlass(ee.type).prototype;return ne.stateProperties.forEach(function(le){"left"!==le&&"top"!==le&&(ee[le]===ne[le]&&delete ee[le],Array.isArray(ee[le])&&Array.isArray(ne[le])&&0===ee[le].length&&0===ne[le].length&&delete ee[le])}),ee},toString:function(){return"#<fabric."+N(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var ee=L.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(ee.scaleX),scaleY:Math.abs(ee.scaleY)}},getTotalObjectScaling:function(){var ee=this.getObjectScaling(),ne=ee.scaleX,le=ee.scaleY;if(this.canvas){var fe=this.canvas.getZoom(),xe=this.canvas.getRetinaScaling();ne*=fe*xe,le*=fe*xe}return{scaleX:ne,scaleY:le}},getObjectOpacity:function(){var ee=this.opacity;return this.group&&(ee*=this.group.getObjectOpacity()),ee},_set:function(ee,ne){var fe=this[ee]!==ne,xe=!1;return("scaleX"===ee||"scaleY"===ee)&&(ne=this._constrainScale(ne)),"scaleX"===ee&&ne<0?(this.flipX=!this.flipX,ne*=-1):"scaleY"===ee&&ne<0?(this.flipY=!this.flipY,ne*=-1):"shadow"!==ee||!ne||ne instanceof L.Shadow?"dirty"===ee&&this.group&&this.group.set("dirty",ne):ne=new L.Shadow(ne),this[ee]=ne,fe&&(xe=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(ee)>-1?(this.dirty=!0,xe&&this.group.set("dirty",!0)):xe&&this.stateProperties.indexOf(ee)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:L.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(ee){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(ee.save(),this._setupCompositeOperation(ee),this.drawSelectionBackground(ee),this.transform(ee),this._setOpacity(ee),this._setShadow(ee,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(ee)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(ee),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),ee.restore())},renderCache:function(ee){ee=ee||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,ee.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(ee,ne){if(ee.save(),ee.globalCompositeOperation=ne.inverted?"destination-out":"destination-in",ne.absolutePositioned){var le=L.util.invertTransform(this.calcTransformMatrix());ee.transform(le[0],le[1],le[2],le[3],le[4],le[5])}ne.transform(ee),ee.scale(1/ne.zoomX,1/ne.zoomY),ee.drawImage(ne._cacheCanvas,-ne.cacheTranslationX,-ne.cacheTranslationY),ee.restore()},drawObject:function(ee,ne){var le=this.fill,fe=this.stroke;ne?(this.fill="black",this.stroke="",this._setClippingProperties(ee)):this._renderBackground(ee),this._render(ee),this._drawClipPath(ee,this.clipPath),this.fill=le,this.stroke=fe},_drawClipPath:function(ee,ne){ne&&(ne.canvas=this.canvas,ne.shouldCache(),ne._transformDone=!0,ne.renderCache({forClipping:!0}),this.drawClipPathOnCache(ee,ne))},drawCacheOnCanvas:function(ee){ee.scale(1/this.zoomX,1/this.zoomY),ee.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(ee){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!ee&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!ee){var ne=this.cacheWidth/this.zoomX,le=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-ne/2,-le/2,ne,le)}return!0}return!1},_renderBackground:function(ee){if(this.backgroundColor){var ne=this._getNonTransformedDimensions();ee.fillStyle=this.backgroundColor,ee.fillRect(-ne.x/2,-ne.y/2,ne.x,ne.y),this._removeShadow(ee)}},_setOpacity:function(ee){this.group&&!this.group._transformDone?ee.globalAlpha=this.getObjectOpacity():ee.globalAlpha*=this.opacity},_setStrokeStyles:function(ee,ne){var le=ne.stroke;le&&(ee.lineWidth=ne.strokeWidth,ee.lineCap=ne.strokeLineCap,ee.lineDashOffset=ne.strokeDashOffset,ee.lineJoin=ne.strokeLineJoin,ee.miterLimit=ne.strokeMiterLimit,le.toLive?"percentage"===le.gradientUnits||le.gradientTransform||le.patternTransform?this._applyPatternForTransformedGradient(ee,le):(ee.strokeStyle=le.toLive(ee,this),this._applyPatternGradientTransform(ee,le)):ee.strokeStyle=ne.stroke)},_setFillStyles:function(ee,ne){var le=ne.fill;le&&(le.toLive?(ee.fillStyle=le.toLive(ee,this),this._applyPatternGradientTransform(ee,ne.fill)):ee.fillStyle=le)},_setClippingProperties:function(ee){ee.globalAlpha=1,ee.strokeStyle="transparent",ee.fillStyle="#000000"},_setLineDash:function(ee,ne){ne&&0!==ne.length&&(1&ne.length&&ne.push.apply(ne,ne),ee.setLineDash(ne))},_renderControls:function(ee,ne){var le,fe,xe,Pe=this.getViewportTransform(),De=this.calcTransformMatrix();fe=void 0!==(ne=ne||{}).hasBorders?ne.hasBorders:this.hasBorders,xe=void 0!==ne.hasControls?ne.hasControls:this.hasControls,De=L.util.multiplyTransformMatrices(Pe,De),le=L.util.qrDecompose(De),ee.save(),ee.translate(le.translateX,le.translateY),ee.lineWidth=1*this.borderScaleFactor,this.group||(ee.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(le.angle-=180),ee.rotate($(this.group?le.angle:this.angle)),ne.forActiveSelection||this.group?fe&&this.drawBordersInGroup(ee,le,ne):fe&&this.drawBorders(ee,ne),xe&&this.drawControls(ee,ne),ee.restore()},_setShadow:function(ee){if(this.shadow){var ne,le=this.shadow,fe=this.canvas,xe=fe&&fe.viewportTransform[0]||1,Pe=fe&&fe.viewportTransform[3]||1;ne=le.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),fe&&fe._isRetinaScaling()&&(xe*=L.devicePixelRatio,Pe*=L.devicePixelRatio),ee.shadowColor=le.color,ee.shadowBlur=le.blur*L.browserShadowBlurConstant*(xe+Pe)*(ne.scaleX+ne.scaleY)/4,ee.shadowOffsetX=le.offsetX*xe*ne.scaleX,ee.shadowOffsetY=le.offsetY*Pe*ne.scaleY}},_removeShadow:function(ee){this.shadow&&(ee.shadowColor="",ee.shadowBlur=ee.shadowOffsetX=ee.shadowOffsetY=0)},_applyPatternGradientTransform:function(ee,ne){if(!ne||!ne.toLive)return{offsetX:0,offsetY:0};var le=ne.gradientTransform||ne.patternTransform,fe=-this.width/2+ne.offsetX||0,xe=-this.height/2+ne.offsetY||0;return"percentage"===ne.gradientUnits?ee.transform(this.width,0,0,this.height,fe,xe):ee.transform(1,0,0,1,fe,xe),le&&ee.transform(le[0],le[1],le[2],le[3],le[4],le[5]),{offsetX:fe,offsetY:xe}},_renderPaintInOrder:function(ee){"stroke"===this.paintFirst?(this._renderStroke(ee),this._renderFill(ee)):(this._renderFill(ee),this._renderStroke(ee))},_render:function(){},_renderFill:function(ee){this.fill&&(ee.save(),this._setFillStyles(ee,this),"evenodd"===this.fillRule?ee.fill("evenodd"):ee.fill(),ee.restore())},_renderStroke:function(ee){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(ee),ee.save(),this.strokeUniform&&this.group){var ne=this.getObjectScaling();ee.scale(1/ne.scaleX,1/ne.scaleY)}else this.strokeUniform&&ee.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(ee,this.strokeDashArray),this._setStrokeStyles(ee,this),ee.stroke(),ee.restore()}},_applyPatternForTransformedGradient:function(ee,ne){var le,fe=this._limitCacheSize(this._getCacheCanvasDimensions()),xe=L.util.createCanvasElement(),Pe=this.canvas.getRetinaScaling(),De=fe.x/this.scaleX/Pe,je=fe.y/this.scaleY/Pe;xe.width=De,xe.height=je,(le=xe.getContext("2d")).beginPath(),le.moveTo(0,0),le.lineTo(De,0),le.lineTo(De,je),le.lineTo(0,je),le.closePath(),le.translate(De/2,je/2),le.scale(fe.zoomX/this.scaleX/Pe,fe.zoomY/this.scaleY/Pe),this._applyPatternGradientTransform(le,ne),le.fillStyle=ne.toLive(ee),le.fill(),ee.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),ee.scale(Pe*this.scaleX/fe.zoomX,Pe*this.scaleY/fe.zoomY),ee.strokeStyle=le.createPattern(xe,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var ee=L.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",ee.scaleX),this.set("scaleY",ee.scaleY),this.angle=ee.angle,this.skewX=ee.skewX,this.skewY=0}},_removeTransformMatrix:function(ee){var ne=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),ne=L.util.transformPoint(ne,this.transformMatrix)),this.transformMatrix=null,ee&&(this.scaleX*=ee.scaleX,this.scaleY*=ee.scaleY,this.cropX=ee.cropX,this.cropY=ee.cropY,ne.x+=ee.offsetLeft,ne.y+=ee.offsetTop,this.width=ee.width,this.height=ee.height),this.setPositionByOrigin(ne,"center","center")},clone:function(ee,ne){var le=this.toObject(ne);this.constructor.fromObject?this.constructor.fromObject(le,ee):L.Object._fromObject("Object",le,ee)},cloneAsImage:function(ee,ne){var le=this.toCanvasElement(ne);return ee&&ee(new L.Image(le)),this},toCanvasElement:function(ee){ee||(ee={});var ne=L.util,le=ne.saveObjectTransform(this),fe=this.group,xe=this.shadow,Pe=Math.abs,De=(ee.multiplier||1)*(ee.enableRetinaScaling?L.devicePixelRatio:1);delete this.group,ee.withoutTransform&&ne.resetObjectTransform(this),ee.withoutShadow&&(this.shadow=null);var je,ke,he,tt=L.util.createCanvasElement(),Ze=this.getBoundingRect(!0,!0),nt=this.shadow,et={x:0,y:0};nt&&(ke=nt.blur,je=nt.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),et.x=2*Math.round(Pe(nt.offsetX)+ke)*Pe(je.scaleX),et.y=2*Math.round(Pe(nt.offsetY)+ke)*Pe(je.scaleY)),he=Ze.height+et.y,tt.width=Math.ceil(Ze.width+et.x),tt.height=Math.ceil(he);var Qe=new L.StaticCanvas(tt,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===ee.format&&(Qe.backgroundColor="#fff"),this.setPositionByOrigin(new L.Point(Qe.width/2,Qe.height/2),"center","center");var at=this.canvas;Qe.add(this);var vt=Qe.toCanvasElement(De||1,ee);return this.shadow=xe,this.set("canvas",at),fe&&(this.group=fe),this.set(le).setCoords(),Qe._objects=[],Qe.dispose(),Qe=null,vt},toDataURL:function(ee){return ee||(ee={}),L.util.toDataURL(this.toCanvasElement(ee),ee.format||"png",ee.quality||1)},isType:function(ee){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===ee},complexity:function(){return 1},toJSON:function(ee){return this.toObject(ee)},rotate:function(ee){var ne=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return ne&&this._setOriginToCenter(),this.set("angle",ee),ne&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(ee,ne){ne=ne||this.canvas.getPointer(ee);var le=new L.Point(ne.x,ne.y),fe=this._getLeftTopCoords();return this.angle&&(le=L.util.rotatePoint(le,fe,$(-this.angle))),{x:le.x-fe.x,y:le.y-fe.y}},_setupCompositeOperation:function(ee){this.globalCompositeOperation&&(ee.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){L.runningAnimations&&L.runningAnimations.cancelByTarget(this)}}),L.util.createAccessors&&L.util.createAccessors(L.Object),Y(L.Object.prototype,L.Observable),L.Object.NUM_FRACTION_DIGITS=2,L.Object.ENLIVEN_PROPS=["clipPath"],L.Object._fromObject=function(ee,ne,le,fe){var xe=L[ee];ne=q(ne,!0),L.util.enlivenPatterns([ne.fill,ne.stroke],function(Pe){void 0!==Pe[0]&&(ne.fill=Pe[0]),void 0!==Pe[1]&&(ne.stroke=Pe[1]),L.util.enlivenObjectEnlivables(ne,ne,function(){var De=fe?new xe(ne[fe],ne):new xe(ne);le&&le(De)})})},L.Object.__uid=0)}(n),ce=te.util.degreesToRadians,pe={left:-.5,center:0,right:.5},Ce={top:-.5,center:0,bottom:.5},te.util.object.extend(te.Object.prototype,{translateToGivenOrigin:function(j,L,Y,q,k){var N,$,ie,ee=j.x,ne=j.y;return"string"==typeof L?L=pe[L]:L-=.5,"string"==typeof q?q=pe[q]:q-=.5,"string"==typeof Y?Y=Ce[Y]:Y-=.5,"string"==typeof k?k=Ce[k]:k-=.5,$=k-Y,((N=q-L)||$)&&(ie=this._getTransformedDimensions(),ee=j.x+N*ie.x,ne=j.y+$*ie.y),new te.Point(ee,ne)},translateToCenterPoint:function(j,L,Y){var q=this.translateToGivenOrigin(j,L,Y,"center","center");return this.angle?te.util.rotatePoint(q,j,ce(this.angle)):q},translateToOriginPoint:function(j,L,Y){var q=this.translateToGivenOrigin(j,"center","center",L,Y);return this.angle?te.util.rotatePoint(q,j,ce(this.angle)):q},getCenterPoint:function(){var j=new te.Point(this.left,this.top);return this.translateToCenterPoint(j,this.originX,this.originY)},getPointByOrigin:function(j,L){var Y=this.getCenterPoint();return this.translateToOriginPoint(Y,j,L)},toLocalPoint:function(j,L,Y){var q,k,N=this.getCenterPoint();return q=void 0!==L&&void 0!==Y?this.translateToGivenOrigin(N,"center","center",L,Y):new te.Point(this.left,this.top),k=new te.Point(j.x,j.y),this.angle&&(k=te.util.rotatePoint(k,N,-ce(this.angle))),k.subtractEquals(q)},setPositionByOrigin:function(j,L,Y){var q=this.translateToCenterPoint(j,L,Y),k=this.translateToOriginPoint(q,this.originX,this.originY);this.set("left",k.x),this.set("top",k.y)},adjustPosition:function(j){var L,Y,q=ce(this.angle),k=this.getScaledWidth(),N=te.util.cos(q)*k,$=te.util.sin(q)*k;this.left+=N*((Y="string"==typeof j?pe[j]:j-.5)-(L="string"==typeof this.originX?pe[this.originX]:this.originX-.5)),this.top+=$*(Y-L),this.setCoords(),this.originX=j},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var j=this.getCenterPoint();this.originX="center",this.originY="center",this.left=j.x,this.top=j.y},_resetOrigin:function(){var j=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=j.x,this.top=j.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var j=te.util,L=j.degreesToRadians,Y=j.multiplyTransformMatrices,q=j.transformPoint;j.object.extend(te.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(k,N){return N?k?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),k?this.aCoords:this.lineCoords)},getCoords:function(k,N){return $=this._getCoords(k,N),[new te.Point($.tl.x,$.tl.y),new te.Point($.tr.x,$.tr.y),new te.Point($.br.x,$.br.y),new te.Point($.bl.x,$.bl.y)];var $},intersectsWithRect:function(k,N,$,ie){var ee=this.getCoords($,ie);return"Intersection"===te.Intersection.intersectPolygonRectangle(ee,k,N).status},intersectsWithObject:function(k,N,$){return"Intersection"===te.Intersection.intersectPolygonPolygon(this.getCoords(N,$),k.getCoords(N,$)).status||k.isContainedWithinObject(this,N,$)||this.isContainedWithinObject(k,N,$)},isContainedWithinObject:function(k,N,$){for(var ie=this.getCoords(N,$),ne=0,le=k._getImageLines(N?k.aCoords:k.lineCoords);ne<4;ne++)if(!k.containsPoint(ie[ne],le))return!1;return!0},isContainedWithinRect:function(k,N,$,ie){var ee=this.getBoundingRect($,ie);return ee.left>=k.x&&ee.left+ee.width<=N.x&&ee.top>=k.y&&ee.top+ee.height<=N.y},containsPoint:function(k,N,$,ie){var ee=this._getCoords($,ie),ne=(N=N||this._getImageLines(ee),this._findCrossPoints(k,N));return 0!==ne&&ne%2==1},isOnScreen:function(k){if(!this.canvas)return!1;var N=this.canvas.vptCoords.tl,$=this.canvas.vptCoords.br;return!!this.getCoords(!0,k).some(function(ie){return ie.x<=$.x&&ie.x>=N.x&&ie.y<=$.y&&ie.y>=N.y})||!!this.intersectsWithRect(N,$,!0,k)||this._containsCenterOfCanvas(N,$,k)},_containsCenterOfCanvas:function(k,N,$){return!!this.containsPoint({x:(k.x+N.x)/2,y:(k.y+N.y)/2},null,!0,$)},isPartiallyOnScreen:function(k){if(!this.canvas)return!1;var N=this.canvas.vptCoords.tl,$=this.canvas.vptCoords.br;return!!this.intersectsWithRect(N,$,!0,k)||this.getCoords(!0,k).every(function(ie){return(ie.x>=$.x||ie.x<=N.x)&&(ie.y>=$.y||ie.y<=N.y)})&&this._containsCenterOfCanvas(N,$,k)},_getImageLines:function(k){return{topline:{o:k.tl,d:k.tr},rightline:{o:k.tr,d:k.br},bottomline:{o:k.br,d:k.bl},leftline:{o:k.bl,d:k.tl}}},_findCrossPoints:function(k,N){var $,ie,ee,ne=0;for(var le in N)if(!((ee=N[le]).o.y<k.y&&ee.d.y<k.y||ee.o.y>=k.y&&ee.d.y>=k.y||(ee.o.x===ee.d.x&&ee.o.x>=k.x?ie=ee.o.x:($=(ee.d.y-ee.o.y)/(ee.d.x-ee.o.x),ie=-(k.y-0*k.x-(ee.o.y-$*ee.o.x))/(0-$)),ie>=k.x&&(ne+=1),2!==ne)))break;return ne},getBoundingRect:function(k,N){var $=this.getCoords(k,N);return j.makeBoundingBoxFromPoints($)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(k){return Math.abs(k)<this.minScaleLimit?k<0?-this.minScaleLimit:this.minScaleLimit:0===k?1e-4:k},scale:function(k){return this._set("scaleX",k),this._set("scaleY",k),this.setCoords()},scaleToWidth:function(k,N){var $=this.getBoundingRect(N).width/this.getScaledWidth();return this.scale(k/this.width/$)},scaleToHeight:function(k,N){var $=this.getBoundingRect(N).height/this.getScaledHeight();return this.scale(k/this.height/$)},calcLineCoords:function(){var k=this.getViewportTransform(),N=this.padding,$=L(this.angle),ie=j.cos($)*N,ee=j.sin($)*N,ne=ie+ee,le=ie-ee,fe=this.calcACoords(),xe={tl:q(fe.tl,k),tr:q(fe.tr,k),bl:q(fe.bl,k),br:q(fe.br,k)};return N&&(xe.tl.x-=le,xe.tl.y-=ne,xe.tr.x+=ne,xe.tr.y-=le,xe.bl.x-=ne,xe.bl.y+=le,xe.br.x+=le,xe.br.y+=ne),xe},calcOCoords:function(){var k=this._calcRotateMatrix(),N=this._calcTranslateMatrix(),$=this.getViewportTransform(),ie=Y($,N),ee=Y(ie,k),ne=(ee=Y(ee,[1/$[0],0,0,1/$[3],0,0]),this._calculateCurrentDimensions()),le={};return this.forEachControl(function(fe,xe,Pe){le[xe]=fe.positionHandler(ne,ee,Pe)}),le},calcACoords:function(){var k=this._calcRotateMatrix(),N=this._calcTranslateMatrix(),$=Y(N,k),ie=this._getTransformedDimensions(),ee=ie.x/2,ne=ie.y/2;return{tl:q({x:-ee,y:-ne},$),tr:q({x:ee,y:-ne},$),bl:q({x:-ee,y:ne},$),br:q({x:ee,y:ne},$)}},setCoords:function(k){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),k||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return j.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var k=this.getCenterPoint();return[1,0,0,1,k.x,k.y]},transformMatrixKey:function(k){var N="_",$="";return!k&&this.group&&($=this.group.transformMatrixKey(k)+N),$+this.top+N+this.left+N+this.scaleX+N+this.scaleY+N+this.skewX+N+this.skewY+N+this.angle+N+this.originX+N+this.originY+N+this.width+N+this.height+N+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(k){var N=this.calcOwnMatrix();if(k||!this.group)return N;var $=this.transformMatrixKey(k),ie=this.matrixCache||(this.matrixCache={});return ie.key===$?ie.value:(this.group&&(N=Y(this.group.calcTransformMatrix(!1),N)),ie.key=$,ie.value=N,N)},calcOwnMatrix:function(){var k=this.transformMatrixKey(!0),N=this.ownMatrixCache||(this.ownMatrixCache={});if(N.key===k)return N.value;var $=this._calcTranslateMatrix(),ie={angle:this.angle,translateX:$[4],translateY:$[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return N.key=k,N.value=j.composeMatrix(ie),N.value},_getNonTransformedDimensions:function(){var k=this.strokeWidth;return{x:this.width+k,y:this.height+k}},_getTransformedDimensions:function(k,N){void 0===k&&(k=this.skewX),void 0===N&&(N=this.skewY);var $,ie,ee,ne=0===k&&0===N;if(this.strokeUniform?(ie=this.width,ee=this.height):(ie=($=this._getNonTransformedDimensions()).x,ee=$.y),ne)return this._finalizeDimensions(ie*this.scaleX,ee*this.scaleY);var le=j.sizeAfterTransform(ie,ee,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:k,skewY:N});return this._finalizeDimensions(le.x,le.y)},_finalizeDimensions:function(k,N){return this.strokeUniform?{x:k+this.strokeWidth,y:N+this.strokeWidth}:{x:k,y:N}},_calculateCurrentDimensions:function(){var k=this.getViewportTransform(),N=this._getTransformedDimensions();return q(N,k,!0).scalarAdd(2*this.padding)}})}(),te.util.object.extend(te.Object.prototype,{sendToBack:function(){return this.group?te.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?te.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(j){return this.group?te.StaticCanvas.prototype.sendBackwards.call(this.group,this,j):this.canvas&&this.canvas.sendBackwards(this,j),this},bringForward:function(j){return this.group?te.StaticCanvas.prototype.bringForward.call(this.group,this,j):this.canvas&&this.canvas.bringForward(this,j),this},moveTo:function(j){return this.group&&"activeSelection"!==this.group.type?te.StaticCanvas.prototype.moveTo.call(this.group,this,j):this.canvas&&this.canvas.moveTo(this,j),this}}),function(){function j(Y,q){if(q){if(q.toLive)return Y+": url(#SVGID_"+q.id+"); ";var k=new te.Color(q),N=Y+": "+k.toRgb()+"; ",$=k.getAlpha();return 1!==$&&(N+=Y+"-opacity: "+$.toString()+"; "),N}return Y+": none; "}var L=te.util.toFixed;te.util.object.extend(te.Object.prototype,{getSvgStyles:function(Y){var q=this.fillRule?this.fillRule:"nonzero",k=this.strokeWidth?this.strokeWidth:"0",N=this.strokeDashArray?this.strokeDashArray.join(" "):"none",$=this.strokeDashOffset?this.strokeDashOffset:"0",ie=this.strokeLineCap?this.strokeLineCap:"butt",ee=this.strokeLineJoin?this.strokeLineJoin:"miter",ne=this.strokeMiterLimit?this.strokeMiterLimit:"4",le=void 0!==this.opacity?this.opacity:"1",fe=this.visible?"":" visibility: hidden;",xe=Y?"":this.getSvgFilter(),Pe=j("fill",this.fill);return[j("stroke",this.stroke),"stroke-width: ",k,"; ","stroke-dasharray: ",N,"; ","stroke-linecap: ",ie,"; ","stroke-dashoffset: ",$,"; ","stroke-linejoin: ",ee,"; ","stroke-miterlimit: ",ne,"; ",Pe,"fill-rule: ",q,"; ","opacity: ",le,";",xe,fe].join("")},getSvgSpanStyles:function(Y,q){var k="; ",N=Y.fontFamily?"font-family: "+(-1===Y.fontFamily.indexOf("'")&&-1===Y.fontFamily.indexOf('"')?"'"+Y.fontFamily+"'":Y.fontFamily)+k:"",$=Y.strokeWidth?"stroke-width: "+Y.strokeWidth+k:"",ie=Y.fontSize?"font-size: "+Y.fontSize+"px"+k:"",ee=Y.fontStyle?"font-style: "+Y.fontStyle+k:"",ne=Y.fontWeight?"font-weight: "+Y.fontWeight+k:"",le=Y.fill?j("fill",Y.fill):"",fe=Y.stroke?j("stroke",Y.stroke):"",xe=this.getSvgTextDecoration(Y);return xe&&(xe="text-decoration: "+xe+k),[fe,$,N,ie,ee,ne,xe,le,Y.deltaY?"baseline-shift: "+-Y.deltaY+"; ":"",q?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(Y){return["overline","underline","line-through"].filter(function(q){return Y[q.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(Y,q){var k=Y?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+te.util.matrixToSVG(k)+(q||"")+'" '},_setSVGBg:function(Y){if(this.backgroundColor){var q=te.Object.NUM_FRACTION_DIGITS;Y.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',L(-this.width/2,q),'" y="',L(-this.height/2,q),'" width="',L(this.width,q),'" height="',L(this.height,q),'"></rect>\n')}},toSVG:function(Y){return this._createBaseSVGMarkup(this._toSVG(Y),{reviver:Y})},toClipPathSVG:function(Y){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(Y),{reviver:Y})},_createBaseClipPathSVGMarkup:function(Y,q){var k=(q=q||{}).reviver,$=[this.getSvgTransform(!0,q.additionalTransform||""),this.getSvgCommons()].join(""),ie=Y.indexOf("COMMON_PARTS");return Y[ie]=$,k?k(Y.join("")):Y.join("")},_createBaseSVGMarkup:function(Y,q){var k,N,$=(q=q||{}).noStyle,ie=q.reviver,ee=$?"":'style="'+this.getSvgStyles()+'" ',ne=q.withShadow?'style="'+this.getSvgFilter()+'" ':"",le=this.clipPath,fe=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",xe=le&&le.absolutePositioned,Pe=this.stroke,De=this.fill,je=this.shadow,ke=[],Ae=Y.indexOf("COMMON_PARTS"),he=q.additionalTransform;return le&&(le.clipPathId="CLIPPATH_"+te.Object.__uid++,N='<clipPath id="'+le.clipPathId+'" >\n'+le.toClipPathSVG(ie)+"</clipPath>\n"),xe&&ke.push("<g ",ne,this.getSvgCommons()," >\n"),ke.push("<g ",this.getSvgTransform(!1),xe?"":ne+this.getSvgCommons()," >\n"),k=[ee,fe,$?"":this.addPaintOrder()," ",he?'transform="'+he+'" ':""].join(""),Y[Ae]=k,De&&De.toLive&&ke.push(De.toSVG(this)),Pe&&Pe.toLive&&ke.push(Pe.toSVG(this)),je&&ke.push(je.toSVG(this)),le&&ke.push(N),ke.push(Y.join("")),ke.push("</g>\n"),xe&&ke.push("</g>\n"),ie?ie(ke.join("")):ke.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var j=te.util.object.extend,L="stateProperties";function Y(k,N,$){var ie={};$.forEach(function(ee){ie[ee]=k[ee]}),j(k[N],ie,!0)}function q(k,N,$){if(k===N)return!0;if(Array.isArray(k)){if(!Array.isArray(N)||k.length!==N.length)return!1;for(var ie=0,ee=k.length;ie<ee;ie++)if(!q(k[ie],N[ie]))return!1;return!0}if(k&&"object"==typeof k){var ne,le=Object.keys(k);if(!N||"object"!=typeof N||!$&&le.length!==Object.keys(N).length)return!1;for(ie=0,ee=le.length;ie<ee;ie++)if("canvas"!==(ne=le[ie])&&"group"!==ne&&!q(k[ne],N[ne]))return!1;return!0}}te.util.object.extend(te.Object.prototype,{hasStateChanged:function(k){var N="_"+(k=k||L);return Object.keys(this[N]).length<this[k].length||!q(this[N],this,!0)},saveState:function(k){var N=k&&k.propertySet||L,$="_"+N;return this[$]?(Y(this,$,this[N]),k&&k.stateProperties&&Y(this,$,k.stateProperties),this):this.setupState(k)},setupState:function(k){var N=(k=k||{}).propertySet||L;return k.propertySet=N,this["_"+N]={},this.saveState(k),this}})}(),function(){var j=te.util.degreesToRadians;te.util.object.extend(te.Object.prototype,{_findTargetCorner:function(L,Y){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var q,k,N,$=L.x,ie=L.y,ee=Object.keys(this.oCoords),ne=ee.length-1;for(this.__corner=0;ne>=0;ne--)if(this.isControlVisible(N=ee[ne])&&(k=this._getImageLines(Y?this.oCoords[N].touchCorner:this.oCoords[N].corner),0!==(q=this._findCrossPoints({x:$,y:ie},k))&&q%2==1))return this.__corner=N,N;return!1},forEachControl:function(L){for(var Y in this.controls)L(this.controls[Y],Y,this)},_setCornerCoords:function(){var L=this.oCoords;for(var Y in L){var q=this.controls[Y];L[Y].corner=q.calcCornerCoords(this.angle,this.cornerSize,L[Y].x,L[Y].y,!1),L[Y].touchCorner=q.calcCornerCoords(this.angle,this.touchCornerSize,L[Y].x,L[Y].y,!0)}},drawSelectionBackground:function(L){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;L.save();var Y=this.getCenterPoint(),q=this._calculateCurrentDimensions(),k=this.canvas.viewportTransform;return L.translate(Y.x,Y.y),L.scale(1/k[0],1/k[3]),L.rotate(j(this.angle)),L.fillStyle=this.selectionBackgroundColor,L.fillRect(-q.x/2,-q.y/2,q.x,q.y),L.restore(),this},drawBorders:function(L,Y){Y=Y||{};var q=this._calculateCurrentDimensions(),k=this.borderScaleFactor,N=q.x+k,$=q.y+k,ie=void 0!==Y.hasControls?Y.hasControls:this.hasControls,ee=!1;return L.save(),L.strokeStyle=Y.borderColor||this.borderColor,this._setLineDash(L,Y.borderDashArray||this.borderDashArray),L.strokeRect(-N/2,-$/2,N,$),ie&&(L.beginPath(),this.forEachControl(function(ne,le,fe){ne.withConnection&&ne.getVisibility(fe,le)&&(ee=!0,L.moveTo(ne.x*N,ne.y*$),L.lineTo(ne.x*N+ne.offsetX,ne.y*$+ne.offsetY))}),ee&&L.stroke()),L.restore(),this},drawBordersInGroup:function(L,Y,q){q=q||{};var k=te.util.sizeAfterTransform(this.width,this.height,Y),N=this.strokeWidth,$=this.strokeUniform,ie=this.borderScaleFactor,ee=k.x+N*($?this.canvas.getZoom():Y.scaleX)+ie,ne=k.y+N*($?this.canvas.getZoom():Y.scaleY)+ie;return L.save(),this._setLineDash(L,q.borderDashArray||this.borderDashArray),L.strokeStyle=q.borderColor||this.borderColor,L.strokeRect(-ee/2,-ne/2,ee,ne),L.restore(),this},drawControls:function(L,Y){Y=Y||{},L.save();var q,k,N=this.canvas.getRetinaScaling();return L.setTransform(N,0,0,N,0,0),L.strokeStyle=L.fillStyle=Y.cornerColor||this.cornerColor,this.transparentCorners||(L.strokeStyle=Y.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(L,Y.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(q=this.group.calcTransformMatrix()),this.forEachControl(function($,ie,ee){k=ee.oCoords[ie],$.getVisibility(ee,ie)&&(q&&(k=te.util.transformPoint(k,q)),$.render(L,k.x,k.y,Y,ee))}),L.restore(),this},isControlVisible:function(L){return this.controls[L]&&this.controls[L].getVisibility(this,L)},setControlVisible:function(L,Y){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[L]=Y,this},setControlsVisibility:function(L){for(var Y in L||(L={}),L)this.setControlVisible(Y,L[Y]);return this},onDeselect:function(){},onSelect:function(){}})}(),te.util.object.extend(te.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(j,L){var Y=function(){},q=(L=L||{}).onComplete||Y,k=L.onChange||Y,N=this;return te.util.animate({target:this,startValue:j.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function($){j.set("left",$),N.requestRenderAll(),k()},onComplete:function(){j.setCoords(),q()}})},fxCenterObjectV:function(j,L){var Y=function(){},q=(L=L||{}).onComplete||Y,k=L.onChange||Y,N=this;return te.util.animate({target:this,startValue:j.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function($){j.set("top",$),N.requestRenderAll(),k()},onComplete:function(){j.setCoords(),q()}})},fxRemove:function(j,L){var Y=function(){},q=(L=L||{}).onComplete||Y,k=L.onChange||Y,N=this;return te.util.animate({target:this,startValue:j.opacity,endValue:0,duration:this.FX_DURATION,onChange:function($){j.set("opacity",$),N.requestRenderAll(),k()},onComplete:function(){N.remove(j),q()}})}}),te.util.object.extend(te.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var j,Y=[],q=[];for(j in arguments[0])Y.push(j);for(var k=0,N=Y.length;k<N;k++)q.push(this._animate(j=Y[k],arguments[0][j],arguments[1],k!==N-1));return q}return this._animate.apply(this,arguments)},_animate:function(j,L,Y,q){var k,N=this;L=L.toString(),Y=Y?te.util.object.clone(Y):{},~j.indexOf(".")&&(k=j.split("."));var $=N.colorProperties.indexOf(j)>-1||k&&N.colorProperties.indexOf(k[1])>-1,ie=k?this.get(k[0])[k[1]]:this.get(j);"from"in Y||(Y.from=ie),$||(L=~L.indexOf("=")?ie+parseFloat(L.replace("=","")):parseFloat(L));var ee={target:this,startValue:Y.from,endValue:L,byValue:Y.by,easing:Y.easing,duration:Y.duration,abort:Y.abort&&function(ne,le,fe){return Y.abort.call(N,ne,le,fe)},onChange:function(ne,le,fe){k?N[k[0]][k[1]]=ne:N.set(j,ne),q||Y.onChange&&Y.onChange(ne,le,fe)},onComplete:function(ne,le,fe){q||(N.setCoords(),Y.onComplete&&Y.onComplete(ne,le,fe))}};return $?te.util.animateColor(ee.startValue,ee.endValue,ee.duration,ee):te.util.animate(ee)}}),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.util.object.clone,k={x1:1,x2:1,y1:1,y2:1};function N($,ie){var ee=$.origin,ne=$.axis1,le=$.axis2,fe=$.dimension,xe=ie.nearest,Pe=ie.center,De=ie.farthest;return function(){switch(this.get(ee)){case xe:return Math.min(this.get(ne),this.get(le));case Pe:return Math.min(this.get(ne),this.get(le))+.5*this.get(fe);case De:return Math.max(this.get(ne),this.get(le))}}}L.Line?L.warn("fabric.Line is already defined"):(L.Line=L.util.createClass(L.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:L.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function($,ie){$||($=[0,0,0,0]),this.callSuper("initialize",ie),this.set("x1",$[0]),this.set("y1",$[1]),this.set("x2",$[2]),this.set("y2",$[3]),this._setWidthHeight(ie)},_setWidthHeight:function($){$||($={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in $?$.left:this._getLeftToOriginX(),this.top="top"in $?$.top:this._getTopToOriginY()},_set:function($,ie){return this.callSuper("_set",$,ie),void 0!==k[$]&&this._setWidthHeight(),this},_getLeftToOriginX:N({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:N({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function($){$.beginPath();var ie=this.calcLinePoints();$.moveTo(ie.x1,ie.y1),$.lineTo(ie.x2,ie.y2),$.lineWidth=this.strokeWidth;var ee=$.strokeStyle;$.strokeStyle=this.stroke||$.fillStyle,this.stroke&&this._renderStroke($),$.strokeStyle=ee},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function($){return Y(this.callSuper("toObject",$),this.calcLinePoints())},_getNonTransformedDimensions:function(){var $=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&($.y-=this.strokeWidth),0===this.height&&($.x-=this.strokeWidth)),$},calcLinePoints:function(){var $=this.x1<=this.x2?-1:1,ie=this.y1<=this.y2?-1:1;return{x1:$*this.width*.5,x2:$*this.width*-.5,y1:ie*this.height*.5,y2:ie*this.height*-.5}},_toSVG:function(){var $=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',$.x1,'" y1="',$.y1,'" x2="',$.x2,'" y2="',$.y2,'" />\n']}}),L.Line.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),L.Line.fromElement=function($,ie,ee){ee=ee||{};var ne=L.parseAttributes($,L.Line.ATTRIBUTE_NAMES);ie(new L.Line([ne.x1||0,ne.y1||0,ne.x2||0,ne.y2||0],Y(ne,ee)))},L.Line.fromObject=function($,ie){var ee=q($,!0);ee.points=[$.x1,$.y1,$.x2,$.y2],L.Object._fromObject("Line",ee,function(ne){delete ne.points,ie&&ie(ne)},"points")})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.degreesToRadians;L.Circle?L.warn("fabric.Circle is already defined."):(L.Circle=L.util.createClass(L.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:L.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(q,k){return this.callSuper("_set",q,k),"radius"===q&&this.setRadius(k),this},toObject:function(q){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(q))},_toSVG:function(){var q,k=(this.endAngle-this.startAngle)%360;if(0===k)q=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var N=Y(this.startAngle),$=Y(this.endAngle),ie=this.radius;q=['<path d="M '+L.util.cos(N)*ie+" "+L.util.sin(N)*ie," A "+ie+" "+ie," 0 ",+(k>180?"1":"0")+" 1"," "+L.util.cos($)*ie+" "+L.util.sin($)*ie,'" ',"COMMON_PARTS"," />\n"]}return q},_render:function(q){q.beginPath(),q.arc(0,0,this.radius,Y(this.startAngle),Y(this.endAngle),!1),this._renderPaintInOrder(q)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(q){return this.radius=q,this.set("width",2*q).set("height",2*q)}}),L.Circle.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),L.Circle.fromElement=function(q,k){var N,$=L.parseAttributes(q,L.Circle.ATTRIBUTE_NAMES);if(!("radius"in(N=$)&&N.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");$.left=($.left||0)-$.radius,$.top=($.top||0)-$.radius,k(new L.Circle($))},L.Circle.fromObject=function(q,k){L.Object._fromObject("Circle",q,k)})}(n),function(j){var L=j.fabric||(j.fabric={});L.Triangle?L.warn("fabric.Triangle is already defined"):(L.Triangle=L.util.createClass(L.Object,{type:"triangle",width:100,height:100,_render:function(Y){var q=this.width/2,k=this.height/2;Y.beginPath(),Y.moveTo(-q,k),Y.lineTo(0,-k),Y.lineTo(q,k),Y.closePath(),this._renderPaintInOrder(Y)},_toSVG:function(){var Y=this.width/2,q=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-Y+" "+q,"0 "+-q,Y+" "+q].join(","),'" />']}}),L.Triangle.fromObject=function(Y,q){return L.Object._fromObject("Triangle",Y,q)})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=2*Math.PI;L.Ellipse?L.warn("fabric.Ellipse is already defined."):(L.Ellipse=L.util.createClass(L.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:L.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(q){this.callSuper("initialize",q),this.set("rx",q&&q.rx||0),this.set("ry",q&&q.ry||0)},_set:function(q,k){switch(this.callSuper("_set",q,k),q){case"rx":this.rx=k,this.set("width",2*k);break;case"ry":this.ry=k,this.set("height",2*k)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(q){return this.callSuper("toObject",["rx","ry"].concat(q))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(q){q.beginPath(),q.save(),q.transform(1,0,0,this.ry/this.rx,0,0),q.arc(0,0,this.rx,0,Y,!1),q.restore(),this._renderPaintInOrder(q)}}),L.Ellipse.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),L.Ellipse.fromElement=function(q,k){var N=L.parseAttributes(q,L.Ellipse.ATTRIBUTE_NAMES);N.left=(N.left||0)-N.rx,N.top=(N.top||0)-N.ry,k(new L.Ellipse(N))},L.Ellipse.fromObject=function(q,k){L.Object._fromObject("Ellipse",q,k)})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend;L.Rect?L.warn("fabric.Rect is already defined"):(L.Rect=L.util.createClass(L.Object,{stateProperties:L.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:L.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(q){this.callSuper("initialize",q),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(q){var k=this.rx?Math.min(this.rx,this.width/2):0,N=this.ry?Math.min(this.ry,this.height/2):0,$=this.width,ie=this.height,ee=-this.width/2,ne=-this.height/2,le=0!==k||0!==N,fe=.4477152502;q.beginPath(),q.moveTo(ee+k,ne),q.lineTo(ee+$-k,ne),le&&q.bezierCurveTo(ee+$-fe*k,ne,ee+$,ne+fe*N,ee+$,ne+N),q.lineTo(ee+$,ne+ie-N),le&&q.bezierCurveTo(ee+$,ne+ie-fe*N,ee+$-fe*k,ne+ie,ee+$-k,ne+ie),q.lineTo(ee+k,ne+ie),le&&q.bezierCurveTo(ee+fe*k,ne+ie,ee,ne+ie-fe*N,ee,ne+ie-N),q.lineTo(ee,ne+N),le&&q.bezierCurveTo(ee,ne+fe*N,ee+fe*k,ne,ee+k,ne),q.closePath(),this._renderPaintInOrder(q)},toObject:function(q){return this.callSuper("toObject",["rx","ry"].concat(q))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),L.Rect.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),L.Rect.fromElement=function(q,k,N){if(!q)return k(null);N=N||{};var $=L.parseAttributes(q,L.Rect.ATTRIBUTE_NAMES);$.left=$.left||0,$.top=$.top||0,$.height=$.height||0,$.width=$.width||0;var ie=new L.Rect(Y(N?L.util.object.clone(N):{},$));ie.visible=ie.visible&&ie.width>0&&ie.height>0,k(ie)},L.Rect.fromObject=function(q,k){return L.Object._fromObject("Rect",q,k)})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.util.array.min,k=L.util.array.max,N=L.util.toFixed,$=L.util.projectStrokeOnPoints;L.Polyline?L.warn("fabric.Polyline is already defined"):(L.Polyline=L.util.createClass(L.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:L.Object.prototype.cacheProperties.concat("points"),initialize:function(ie,ee){ee=ee||{},this.points=ie||[],this.callSuper("initialize",ee),this._setPositionDimensions(ee)},_projectStrokeOnPoints:function(){return $(this.points,this,!0)},_setPositionDimensions:function(ie){var ee,ne=this._calcDimensions(ie),le=this.exactBoundingBox?this.strokeWidth:0;this.width=ne.width-le,this.height=ne.height-le,ie.fromSVG||(ee=this.translateToGivenOrigin({x:ne.left-this.strokeWidth/2+le/2,y:ne.top-this.strokeWidth/2+le/2},"left","top",this.originX,this.originY)),void 0===ie.left&&(this.left=ie.fromSVG?ne.left:ee.x),void 0===ie.top&&(this.top=ie.fromSVG?ne.top:ee.y),this.pathOffset={x:ne.left+this.width/2+le/2,y:ne.top+this.height/2+le/2}},_calcDimensions:function(){var ie=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,ee=q(ie,"x")||0,ne=q(ie,"y")||0;return{left:ee,top:ne,width:(k(ie,"x")||0)-ee,height:(k(ie,"y")||0)-ne}},toObject:function(ie){return Y(this.callSuper("toObject",ie),{points:this.points.concat()})},_toSVG:function(){for(var ie=[],ee=this.pathOffset.x,ne=this.pathOffset.y,le=L.Object.NUM_FRACTION_DIGITS,fe=0,xe=this.points.length;fe<xe;fe++)ie.push(N(this.points[fe].x-ee,le),",",N(this.points[fe].y-ne,le)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',ie.join(""),'" />\n']},commonRender:function(ie){var ee,ne=this.points.length,le=this.pathOffset.x,fe=this.pathOffset.y;if(!ne||isNaN(this.points[ne-1].y))return!1;ie.beginPath(),ie.moveTo(this.points[0].x-le,this.points[0].y-fe);for(var xe=0;xe<ne;xe++)ie.lineTo((ee=this.points[xe]).x-le,ee.y-fe);return!0},_render:function(ie){this.commonRender(ie)&&this._renderPaintInOrder(ie)},complexity:function(){return this.get("points").length}}),L.Polyline.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat(),L.Polyline.fromElementGenerator=function(ie){return function(ee,ne,le){if(!ee)return ne(null);le||(le={});var fe=L.parsePointsAttribute(ee.getAttribute("points")),xe=L.parseAttributes(ee,L[ie].ATTRIBUTE_NAMES);xe.fromSVG=!0,ne(new L[ie](fe,Y(xe,le)))}},L.Polyline.fromElement=L.Polyline.fromElementGenerator("Polyline"),L.Polyline.fromObject=function(ie,ee){return L.Object._fromObject("Polyline",ie,ee,"points")})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.projectStrokeOnPoints;L.Polygon?L.warn("fabric.Polygon is already defined"):(L.Polygon=L.util.createClass(L.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return Y(this.points,this)},_render:function(q){this.commonRender(q)&&(q.closePath(),this._renderPaintInOrder(q))}}),L.Polygon.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat(),L.Polygon.fromElement=L.Polyline.fromElementGenerator("Polygon"),L.Polygon.fromObject=function(q,k){L.Object._fromObject("Polygon",q,k,"points")})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.array.min,q=L.util.array.max,k=L.util.object.extend,N=L.util.object.clone,$=L.util.toFixed;L.Path?L.warn("fabric.Path is already defined"):(L.Path=L.util.createClass(L.Object,{type:"path",path:null,cacheProperties:L.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:L.Object.prototype.stateProperties.concat("path"),initialize:function(ie,ee){delete(ee=N(ee||{})).path,this.callSuper("initialize",ee),this._setPath(ie||[],ee)},_setPath:function(ie,ee){this.path=L.util.makePathSimpler(Array.isArray(ie)?ie:L.util.parsePath(ie)),L.Polyline.prototype._setPositionDimensions.call(this,ee||{})},_renderPathCommands:function(ie){var ee,ne=0,le=0,fe=0,xe=0,je=-this.pathOffset.x,ke=-this.pathOffset.y;ie.beginPath();for(var Ae=0,he=this.path.length;Ae<he;++Ae)switch((ee=this.path[Ae])[0]){case"L":ie.lineTo((fe=ee[1])+je,(xe=ee[2])+ke);break;case"M":ne=fe=ee[1],le=xe=ee[2],ie.moveTo(fe+je,xe+ke);break;case"C":ie.bezierCurveTo(ee[1]+je,ee[2]+ke,ee[3]+je,ee[4]+ke,(fe=ee[5])+je,(xe=ee[6])+ke);break;case"Q":ie.quadraticCurveTo(ee[1]+je,ee[2]+ke,ee[3]+je,ee[4]+ke),fe=ee[3],xe=ee[4];break;case"z":case"Z":fe=ne,xe=le,ie.closePath()}},_render:function(ie){this._renderPathCommands(ie),this._renderPaintInOrder(ie)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(ie){return k(this.callSuper("toObject",ie),{path:this.path.map(function(ee){return ee.slice()})})},toDatalessObject:function(ie){var ee=this.toObject(["sourcePath"].concat(ie));return ee.sourcePath&&delete ee.path,ee},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',L.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var ie=L.Object.NUM_FRACTION_DIGITS;return" translate("+$(-this.pathOffset.x,ie)+", "+$(-this.pathOffset.y,ie)+")"},toClipPathSVG:function(ie){var ee=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:ie,additionalTransform:ee})},toSVG:function(ie){var ee=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:ie,additionalTransform:ee})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var ie,ee,ne=[],le=[],fe=0,xe=0,Pe=0,De=0,je=0,ke=this.path.length;je<ke;++je){switch((ie=this.path[je])[0]){case"L":Pe=ie[1],De=ie[2],ee=[];break;case"M":fe=Pe=ie[1],xe=De=ie[2],ee=[];break;case"C":ee=L.util.getBoundsOfCurve(Pe,De,ie[1],ie[2],ie[3],ie[4],ie[5],ie[6]),Pe=ie[5],De=ie[6];break;case"Q":ee=L.util.getBoundsOfCurve(Pe,De,ie[1],ie[2],ie[1],ie[2],ie[3],ie[4]),Pe=ie[3],De=ie[4];break;case"z":case"Z":Pe=fe,De=xe}ee.forEach(function(tt){ne.push(tt.x),le.push(tt.y)}),ne.push(Pe),le.push(De)}var Ae=Y(ne)||0,he=Y(le)||0;return{left:Ae,top:he,width:(q(ne)||0)-Ae,height:(q(le)||0)-he}}}),L.Path.fromObject=function(ie,ee){"string"==typeof ie.sourcePath?L.loadSVGFromURL(ie.sourcePath,function(le){var fe=le[0];fe.setOptions(ie),ee&&ee(fe)}):L.Object._fromObject("Path",ie,ee,"path")},L.Path.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat(["d"]),L.Path.fromElement=function(ie,ee,ne){var le=L.parseAttributes(ie,L.Path.ATTRIBUTE_NAMES);le.fromSVG=!0,ee(new L.Path(le.d,k(le,ne)))})}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.array.min,q=L.util.array.max;L.Group||(L.Group=L.util.createClass(L.Object,L.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(k,N,$){N=N||{},this._objects=[],$&&this.callSuper("initialize",N),this._objects=k||[];for(var ie=this._objects.length;ie--;)this._objects[ie].group=this;if($)this._updateObjectsACoords();else{var ee=N&&N.centerPoint;void 0!==N.originX&&(this.originX=N.originX),void 0!==N.originY&&(this.originY=N.originY),ee||this._calcBounds(),this._updateObjectsCoords(ee),delete N.centerPoint,this.callSuper("initialize",N)}this.setCoords()},_updateObjectsACoords:function(){for(var k=this._objects.length;k--;)this._objects[k].setCoords(!0)},_updateObjectsCoords:function(k){k=k||this.getCenterPoint();for(var N=this._objects.length;N--;)this._updateObjectCoords(this._objects[N],k)},_updateObjectCoords:function(k,N){k.set({left:k.left-N.x,top:k.top-N.y}),k.group=this,k.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(k){var N=!!this.group;return this._restoreObjectsState(),L.util.resetObjectTransform(this),k&&(N&&L.util.removeTransformFromObject(k,this.group.calcTransformMatrix()),this._objects.push(k),k.group=this,k._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,N?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(k){return this._restoreObjectsState(),L.util.resetObjectTransform(this),this.remove(k),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(k){this.dirty=!0,k.group=this,k._set("canvas",this.canvas)},_onObjectRemoved:function(k){this.dirty=!0,delete k.group},_set:function(k,N){var $=this._objects.length;if(this.useSetOnGroup)for(;$--;)this._objects[$].setOnGroup(k,N);if("canvas"===k)for(;$--;)this._objects[$]._set(k,N);L.Object.prototype._set.call(this,k,N)},toObject:function(k){var N=this.includeDefaultValues,$=this._objects.filter(function(ee){return!ee.excludeFromExport}).map(function(ee){var ne=ee.includeDefaultValues;ee.includeDefaultValues=N;var le=ee.toObject(k);return ee.includeDefaultValues=ne,le}),ie=L.Object.prototype.toObject.call(this,k);return ie.objects=$,ie},toDatalessObject:function(k){var N,$=this.sourcePath;if($)N=$;else{var ie=this.includeDefaultValues;N=this._objects.map(function(ne){var le=ne.includeDefaultValues;ne.includeDefaultValues=ie;var fe=ne.toDatalessObject(k);return ne.includeDefaultValues=le,fe})}var ee=L.Object.prototype.toDatalessObject.call(this,k);return ee.objects=N,ee},render:function(k){this._transformDone=!0,this.callSuper("render",k),this._transformDone=!1},shouldCache:function(){var k=L.Object.prototype.shouldCache.call(this);if(k)for(var N=0,$=this._objects.length;N<$;N++)if(this._objects[N].willDrawShadow())return this.ownCaching=!1,!1;return k},willDrawShadow:function(){if(L.Object.prototype.willDrawShadow.call(this))return!0;for(var k=0,N=this._objects.length;k<N;k++)if(this._objects[k].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(k){for(var N=0,$=this._objects.length;N<$;N++)this._objects[N].render(k);this._drawClipPath(k,this.clipPath)},isCacheDirty:function(k){if(this.callSuper("isCacheDirty",k))return!0;if(!this.statefullCache)return!1;for(var N=0,$=this._objects.length;N<$;N++)if(this._objects[N].isCacheDirty(!0)){if(this._cacheCanvas){var ie=this.cacheWidth/this.zoomX,ee=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-ie/2,-ee/2,ie,ee)}return!0}return!1},_restoreObjectsState:function(){var k=this.calcOwnMatrix();return this._objects.forEach(function(N){L.util.addTransformToObject(N,k),delete N.group,N.setCoords()}),this},destroy:function(){return this._objects.forEach(function(k){k.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(k){k.dispose&&k.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var k=this._objects,N=this.canvas;this._objects=[];var $=this.toObject();delete $.objects;var ie=new L.ActiveSelection([]);return ie.set($),ie.type="activeSelection",N.remove(this),k.forEach(function(ee){ee.group=ie,ee.dirty=!0,N.add(ee)}),ie.canvas=N,ie._objects=k,N._activeObject=ie,ie.setCoords(),ie}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(k){k.setCoords(!0)}),this},_calcBounds:function(k){for(var N,$,ie,ee,ne=[],le=[],fe=["tr","br","bl","tl"],xe=0,Pe=this._objects.length,De=fe.length;xe<Pe;++xe){for(ie=(N=this._objects[xe]).calcACoords(),ee=0;ee<De;ee++)ne.push(ie[$=fe[ee]].x),le.push(ie[$].y);N.aCoords=ie}this._getBounds(ne,le,k)},_getBounds:function(k,N,$){var ie=new L.Point(Y(k),Y(N)),ee=new L.Point(q(k),q(N)),ne=ie.y||0,le=ie.x||0,xe=ee.y-ie.y||0;this.width=ee.x-ie.x||0,this.height=xe,$||this.setPositionByOrigin({x:le,y:ne},"left","top")},_toSVG:function(k){for(var N=["<g ","COMMON_PARTS"," >\n"],$=0,ie=this._objects.length;$<ie;$++)N.push("\t\t",this._objects[$].toSVG(k));return N.push("</g>\n"),N},getSvgStyles:function(){var N=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),N].join("")},toClipPathSVG:function(k){for(var N=[],$=0,ie=this._objects.length;$<ie;$++)N.push("\t",this._objects[$].toClipPathSVG(k));return this._createBaseClipPathSVGMarkup(N,{reviver:k})}}),L.Group.fromObject=function(k,N){var $=k.objects,ie=L.util.object.clone(k,!0);delete ie.objects,"string"!=typeof $?L.util.enlivenObjects($,function(ee){var ne=L.util.object.clone(k,!0);delete ne.objects,L.util.enlivenObjectEnlivables(k,ne,function(){N&&N(new L.Group(ee,ne,!0))})}):L.loadSVGFromURL($,function(ee){var ne=L.util.groupSVGElements(ee,k,$);ne.set(ie),N&&N(ne)})})}(n),function(j){var L=j.fabric||(j.fabric={});L.ActiveSelection||(L.ActiveSelection=L.util.createClass(L.Group,{type:"activeSelection",initialize:function(Y,q){q=q||{},this._objects=Y||[];for(var k=this._objects.length;k--;)this._objects[k].group=this;q.originX&&(this.originX=q.originX),q.originY&&(this.originY=q.originY),this._calcBounds(),this._updateObjectsCoords(),L.Object.prototype.initialize.call(this,q),this.setCoords()},toGroup:function(){var Y=this._objects.concat();this._objects=[];var q=L.Object.prototype.toObject.call(this),k=new L.Group([]);if(delete q.type,k.set(q),Y.forEach(function($){$.canvas.remove($),$.group=k}),k._objects=Y,!this.canvas)return k;var N=this.canvas;return N.add(k),N._activeObject=k,k.setCoords(),k},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(Y,q,k){Y.save(),Y.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",Y,q),void 0===(k=k||{}).hasControls&&(k.hasControls=!1),k.forActiveSelection=!0;for(var N=0,$=this._objects.length;N<$;N++)this._objects[N]._renderControls(Y,k);Y.restore()}}),L.ActiveSelection.fromObject=function(Y,q){L.util.enlivenObjects(Y.objects,function(k){delete Y.objects,q&&q(new L.ActiveSelection(k,Y,!0))})})}(n),function(j){var L=te.util.object.extend;j.fabric||(j.fabric={}),j.fabric.Image?te.warn("fabric.Image is already defined."):(te.Image=te.util.createClass(te.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:te.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:te.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(Y,q){q||(q={}),this.filters=[],this.cacheKey="texture"+te.Object.__uid++,this.callSuper("initialize",q),this._initElement(Y,q)},getElement:function(){return this._element||{}},setElement:function(Y,q){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=Y,this._originalElement=Y,this._initConfig(q),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(Y){var q=te.filterBackend;q&&q.evictCachesForKey&&q.evictCachesForKey(Y)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(Y){te.util.cleanUpJsdomNode(this[Y]),this[Y]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var Y=this.getElement();return{width:Y.naturalWidth||Y.width,height:Y.naturalHeight||Y.height}},_stroke:function(Y){if(this.stroke&&0!==this.strokeWidth){var q=this.width/2,k=this.height/2;Y.beginPath(),Y.moveTo(-q,-k),Y.lineTo(q,-k),Y.lineTo(q,k),Y.lineTo(-q,k),Y.lineTo(-q,-k),Y.closePath()}},toObject:function(Y){var q=[];this.filters.forEach(function(N){N&&q.push(N.toObject())});var k=L(this.callSuper("toObject",["cropX","cropY"].concat(Y)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:q});return this.resizeFilter&&(k.resizeFilter=this.resizeFilter.toObject()),k},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var Y,q=[],k=[],N=this._element,$=-this.width/2,ie=-this.height/2,ee="",ne="";if(!N)return[];if(this.hasCrop()){var le=te.Object.__uid++;q.push('<clipPath id="imageCrop_'+le+'">\n','\t<rect x="'+$+'" y="'+ie+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),ee=' clip-path="url(#imageCrop_'+le+')" '}if(this.imageSmoothing||(ne='" image-rendering="optimizeSpeed'),k.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',$-this.cropX,'" y="',ie-this.cropY,'" width="',N.width||N.naturalWidth,'" height="',N.height||N.height,ne,'"',ee,"></image>\n"),this.stroke||this.strokeDashArray){var fe=this.fill;this.fill=null,Y=["\t<rect ",'x="',$,'" y="',ie,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=fe}return"fill"!==this.paintFirst?q.concat(Y,k):q.concat(k,Y)},getSrc:function(Y){var q=Y?this._element:this._originalElement;return q?q.toDataURL?q.toDataURL():this.srcFromAttribute?q.getAttribute("src"):q.src:this.src||""},setSrc:function(Y,q,k){return te.util.loadImage(Y,function(N,$){this.setElement(N,k),this._setWidthHeight(),q&&q(this,$)},this,k&&k.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var Y=this.resizeFilter,q=this.minimumScaleTrigger,k=this.getTotalObjectScaling(),N=k.scaleX,$=k.scaleY,ie=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!Y||N>q&&$>q)return this._element=ie,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=N,void(this._lastScaleY=$);te.filterBackend||(te.filterBackend=te.initFilterBackend());var ee=te.util.createCanvasElement(),ne=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,le=ie.width,fe=ie.height;ee.width=le,ee.height=fe,this._element=ee,this._lastScaleX=Y.scaleX=N,this._lastScaleY=Y.scaleY=$,te.filterBackend.applyFilters([Y],ie,le,fe,this._element,ne),this._filterScalingX=ee.width/this._originalElement.width,this._filterScalingY=ee.height/this._originalElement.height},applyFilters:function(Y){if(Y=(Y=Y||this.filters||[]).filter(function(ie){return ie&&!ie.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===Y.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var q=this._originalElement,k=q.naturalWidth||q.width,N=q.naturalHeight||q.height;if(this._element===this._originalElement){var $=te.util.createCanvasElement();$.width=k,$.height=N,this._element=$,this._filteredEl=$}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,k,N),this._lastScaleX=1,this._lastScaleY=1;return te.filterBackend||(te.filterBackend=te.initFilterBackend()),te.filterBackend.applyFilters(Y,this._originalElement,k,N,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(Y){te.util.setImageSmoothing(Y,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(Y),this._renderPaintInOrder(Y)},drawCacheOnCanvas:function(Y){te.util.setImageSmoothing(Y,this.imageSmoothing),te.Object.prototype.drawCacheOnCanvas.call(this,Y)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(Y){var q=this._element;if(q){var k=this._filterScalingX,N=this._filterScalingY,$=this.width,ie=this.height,ee=Math.min,ne=Math.max,le=ne(this.cropX,0),fe=ne(this.cropY,0),xe=q.naturalWidth||q.width,Pe=q.naturalHeight||q.height,De=le*k,je=fe*N,ke=ee($*k,xe-De),Ae=ee(ie*N,Pe-je),he=-$/2,tt=-ie/2,Ze=ee($,xe/k-le),nt=ee(ie,Pe/N-fe);q&&Y.drawImage(q,De,je,ke,Ae,he,tt,Ze,nt)}},_needsResize:function(){var Y=this.getTotalObjectScaling();return Y.scaleX!==this._lastScaleX||Y.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(Y,q){this.setElement(te.util.getById(Y),q),te.util.addClass(this.getElement(),te.Image.CSS_CANVAS)},_initConfig:function(Y){Y||(Y={}),this.setOptions(Y),this._setWidthHeight(Y)},_initFilters:function(Y,q){Y&&Y.length?te.util.enlivenObjects(Y,function(k){q&&q(k)},"fabric.Image.filters"):q&&q()},_setWidthHeight:function(Y){Y||(Y={});var q=this.getElement();this.width=Y.width||q.naturalWidth||q.width||0,this.height=Y.height||q.naturalHeight||q.height||0},parsePreserveAspectRatioAttribute:function(){var Y,q=te.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),k=this._element.width,N=this._element.height,$=1,ie=1,ee=0,ne=0,le=0,fe=0,xe=this.width,Pe=this.height,De={width:xe,height:Pe};return!q||"none"===q.alignX&&"none"===q.alignY?($=xe/k,ie=Pe/N):("meet"===q.meetOrSlice&&(Y=(xe-k*($=ie=te.util.findScaleToFit(this._element,De)))/2,"Min"===q.alignX&&(ee=-Y),"Max"===q.alignX&&(ee=Y),Y=(Pe-N*ie)/2,"Min"===q.alignY&&(ne=-Y),"Max"===q.alignY&&(ne=Y)),"slice"===q.meetOrSlice&&(Y=k-xe/($=ie=te.util.findScaleToCover(this._element,De)),"Mid"===q.alignX&&(le=Y/2),"Max"===q.alignX&&(le=Y),Y=N-Pe/ie,"Mid"===q.alignY&&(fe=Y/2),"Max"===q.alignY&&(fe=Y),k=xe/$,N=Pe/ie)),{width:k,height:N,scaleX:$,scaleY:ie,offsetLeft:ee,offsetTop:ne,cropX:le,cropY:fe}}}),te.Image.CSS_CANVAS="canvas-img",te.Image.prototype.getSvgSrc=te.Image.prototype.getSrc,te.Image.fromObject=function(Y,q){var k=te.util.object.clone(Y);te.util.loadImage(k.src,function(N,$){$?q&&q(null,!0):te.Image.prototype._initFilters.call(k,k.filters,function(ie){k.filters=ie||[],te.Image.prototype._initFilters.call(k,[k.resizeFilter],function(ee){k.resizeFilter=ee[0],te.util.enlivenObjectEnlivables(k,k,function(){var ne=new te.Image(N,k);q(ne,!1)})})})},null,k.crossOrigin)},te.Image.fromURL=function(Y,q,k){te.util.loadImage(Y,function(N,$){q&&q(new te.Image(N,k),$)},null,k&&k.crossOrigin)},te.Image.ATTRIBUTE_NAMES=te.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),te.Image.fromElement=function(Y,q,k){var N=te.parseAttributes(Y,te.Image.ATTRIBUTE_NAMES);te.Image.fromURL(N["xlink:href"],q,L(k?te.util.object.clone(k):{},N))})}(n),te.util.object.extend(te.Object.prototype,{_getAngleValueForStraighten:function(){var j=this.angle%360;return j>0?90*Math.round((j-1)/90):90*Math.round(j/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(j){var L=function(){},Y=(j=j||{}).onComplete||L,q=j.onChange||L,k=this;return te.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(N){k.rotate(N),q()},onComplete:function(){k.setCoords(),Y()}})}}),te.util.object.extend(te.StaticCanvas.prototype,{straightenObject:function(j){return j.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(j){return j.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function j(Y,q){var k="precision "+q+" float;\nvoid main(){}",N=Y.createShader(Y.FRAGMENT_SHADER);return Y.shaderSource(N,k),Y.compileShader(N),!!Y.getShaderParameter(N,Y.COMPILE_STATUS)}function L(Y){Y&&Y.tileSize&&(this.tileSize=Y.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}te.isWebglSupported=function(Y){if(te.isLikelyNode)return!1;Y=Y||te.WebglFilterBackend.prototype.tileSize;var q=document.createElement("canvas"),k=q.getContext("webgl")||q.getContext("experimental-webgl"),N=!1;if(k){te.maxTextureSize=k.getParameter(k.MAX_TEXTURE_SIZE),N=te.maxTextureSize>=Y;for(var $=["highp","mediump","lowp"],ie=0;ie<3;ie++)if(j(k,$[ie])){te.webGlPrecision=$[ie];break}}return this.isSupported=N,N},te.WebglFilterBackend=L,L.prototype={tileSize:2048,resources:{},setupGLContext:function(Y,q){this.dispose(),this.createWebGLCanvas(Y,q),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(Y,q)},chooseFastestCopyGLTo2DMethod:function(Y,q){var k,N=void 0!==window.performance;try{new ImageData(1,1),k=!0}catch(Pe){k=!1}var $="undefined"!=typeof ArrayBuffer,ie="undefined"!=typeof Uint8ClampedArray;if(N&&k&&$&&ie){var ee=te.util.createCanvasElement(),ne=new ArrayBuffer(Y*q*4);if(te.forceGLPutImageData)return this.imageBuffer=ne,void(this.copyGLTo2D=Le);var le,fe,xe={imageBuffer:ne,destinationWidth:Y,destinationHeight:q,targetCanvas:ee};ee.width=Y,ee.height=q,le=window.performance.now(),we.call(xe,this.gl,xe),fe=window.performance.now()-le,le=window.performance.now(),Le.call(xe,this.gl,xe),fe>window.performance.now()-le?(this.imageBuffer=ne,this.copyGLTo2D=Le):this.copyGLTo2D=we}},createWebGLCanvas:function(Y,q){var k=te.util.createCanvasElement();k.width=Y,k.height=q;var N={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},$=k.getContext("webgl",N);$||($=k.getContext("experimental-webgl",N)),$&&($.clearColor(0,0,0,0),this.canvas=k,this.gl=$)},applyFilters:function(Y,q,k,N,$,ie){var ee,ne=this.gl;ie&&(ee=this.getCachedTexture(ie,q));var xe,Pe,ke,Ae,le={originalWidth:q.width||q.originalWidth,originalHeight:q.height||q.originalHeight,sourceWidth:k,sourceHeight:N,destinationWidth:k,destinationHeight:N,context:ne,sourceTexture:this.createTexture(ne,k,N,!ee&&q),targetTexture:this.createTexture(ne,k,N),originalTexture:ee||this.createTexture(ne,k,N,!ee&&q),passes:Y.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:$},fe=ne.createFramebuffer();return ne.bindFramebuffer(ne.FRAMEBUFFER,fe),Y.forEach(function(xe){xe&&xe.applyTo(le)}),Ae=(xe=le).destinationHeight,(Pe=xe.targetCanvas).width===(ke=xe.destinationWidth)&&Pe.height===Ae||(Pe.width=ke,Pe.height=Ae),this.copyGLTo2D(ne,le),ne.bindTexture(ne.TEXTURE_2D,null),ne.deleteTexture(le.sourceTexture),ne.deleteTexture(le.targetTexture),ne.deleteFramebuffer(fe),$.getContext("2d").setTransform(1,0,0,1,0,0),le},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(Y,q,k,N){var $=Y.createTexture();return Y.bindTexture(Y.TEXTURE_2D,$),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.NEAREST),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.NEAREST),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),N?Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,N):Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,q,k,0,Y.RGBA,Y.UNSIGNED_BYTE,null),$},getCachedTexture:function(Y,q){if(this.textureCache[Y])return this.textureCache[Y];var k=this.createTexture(this.gl,q.width,q.height,q);return this.textureCache[Y]=k,k},evictCachesForKey:function(Y){this.textureCache[Y]&&(this.gl.deleteTexture(this.textureCache[Y]),delete this.textureCache[Y])},copyGLTo2D:we,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var Y=this.gl,q={renderer:"",vendor:""};if(!Y)return q;var k=Y.getExtension("WEBGL_debug_renderer_info");if(k){var N=Y.getParameter(k.UNMASKED_RENDERER_WEBGL),$=Y.getParameter(k.UNMASKED_VENDOR_WEBGL);N&&(q.renderer=N.toLowerCase()),$&&(q.vendor=$.toLowerCase())}return this.gpuInfo=q,q}}}(),function(){var j=function(){};function L(){}te.Canvas2dFilterBackend=L,L.prototype={evictCachesForKey:j,dispose:j,clearWebGLCaches:j,resources:{},applyFilters:function(Y,q,k,N,$){var ie=$.getContext("2d");ie.drawImage(q,0,0,k,N);var ee={sourceWidth:k,sourceHeight:N,imageData:ie.getImageData(0,0,k,N),originalEl:q,originalImageData:ie.getImageData(0,0,k,N),canvasEl:$,ctx:ie,filterBackend:this};return Y.forEach(function(ne){ne.applyTo(ee)}),ee.imageData.width===k&&ee.imageData.height===N||($.width=ee.imageData.width,$.height=ee.imageData.height),ie.putImageData(ee.imageData,0,0),ee}}}(),te.Image=te.Image||{},te.Image.filters=te.Image.filters||{},te.Image.filters.BaseFilter=te.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(j){j&&this.setOptions(j)},setOptions:function(j){for(var L in j)this[L]=j[L]},createProgram:function(j,L,Y){L=L||this.fragmentSource,Y=Y||this.vertexSource,"highp"!==te.webGlPrecision&&(L=L.replace(/precision highp float/g,"precision "+te.webGlPrecision+" float"));var q=j.createShader(j.VERTEX_SHADER);if(j.shaderSource(q,Y),j.compileShader(q),!j.getShaderParameter(q,j.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+j.getShaderInfoLog(q));var k=j.createShader(j.FRAGMENT_SHADER);if(j.shaderSource(k,L),j.compileShader(k),!j.getShaderParameter(k,j.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+j.getShaderInfoLog(k));var N=j.createProgram();if(j.attachShader(N,q),j.attachShader(N,k),j.linkProgram(N),!j.getProgramParameter(N,j.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+j.getProgramInfoLog(N));var $=this.getAttributeLocations(j,N),ie=this.getUniformLocations(j,N)||{};return ie.uStepW=j.getUniformLocation(N,"uStepW"),ie.uStepH=j.getUniformLocation(N,"uStepH"),{program:N,attributeLocations:$,uniformLocations:ie}},getAttributeLocations:function(j,L){return{aPosition:j.getAttribLocation(L,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(j,L,Y){var q=L.aPosition,k=j.createBuffer();j.bindBuffer(j.ARRAY_BUFFER,k),j.enableVertexAttribArray(q),j.vertexAttribPointer(q,2,j.FLOAT,!1,0,0),j.bufferData(j.ARRAY_BUFFER,Y,j.STATIC_DRAW)},_setupFrameBuffer:function(j){var L,Y,q=j.context;j.passes>1?(Y=j.destinationHeight,j.sourceWidth===(L=j.destinationWidth)&&j.sourceHeight===Y||(q.deleteTexture(j.targetTexture),j.targetTexture=j.filterBackend.createTexture(q,L,Y)),q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,j.targetTexture,0)):(q.bindFramebuffer(q.FRAMEBUFFER,null),q.finish())},_swapTextures:function(j){j.passes--,j.pass++;var L=j.targetTexture;j.targetTexture=j.sourceTexture,j.sourceTexture=L},isNeutralState:function(){var j=this.mainParameter,L=te.Image.filters[this.type].prototype;if(j){if(Array.isArray(L[j])){for(var Y=L[j].length;Y--;)if(this[j][Y]!==L[j][Y])return!1;return!0}return L[j]===this[j]}return!1},applyTo:function(j){j.webgl?(this._setupFrameBuffer(j),this.applyToWebGL(j),this._swapTextures(j)):this.applyTo2d(j)},retrieveShader:function(j){return j.programCache.hasOwnProperty(this.type)||(j.programCache[this.type]=this.createProgram(j.context)),j.programCache[this.type]},applyToWebGL:function(j){var L=j.context,Y=this.retrieveShader(j);L.bindTexture(L.TEXTURE_2D,0===j.pass&&j.originalTexture?j.originalTexture:j.sourceTexture),L.useProgram(Y.program),this.sendAttributeData(L,Y.attributeLocations,j.aPosition),L.uniform1f(Y.uniformLocations.uStepW,1/j.sourceWidth),L.uniform1f(Y.uniformLocations.uStepH,1/j.sourceHeight),this.sendUniformData(L,Y.uniformLocations),L.viewport(0,0,j.destinationWidth,j.destinationHeight),L.drawArrays(L.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(j,L,Y){j.activeTexture(Y),j.bindTexture(j.TEXTURE_2D,L),j.activeTexture(j.TEXTURE0)},unbindAdditionalTexture:function(j,L){j.activeTexture(L),j.bindTexture(j.TEXTURE_2D,null),j.activeTexture(j.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(j){this[this.mainParameter]=j},sendUniformData:function(){},createHelpLayer:function(j){if(!j.helpLayer){var L=document.createElement("canvas");L.width=j.sourceWidth,L.height=j.sourceHeight,j.helpLayer=L}},toObject:function(){var j={type:this.type},L=this.mainParameter;return L&&(j[L]=this[L]),j},toJSON:function(){return this.toObject()}}),te.Image.filters.BaseFilter.fromObject=function(j,L){var Y=new te.Image.filters[j.type](j);return L&&L(Y),Y},function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.ColorMatrix=(0,L.util.createClass)(Y.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(k){this.callSuper("initialize",k),this.matrix=this.matrix.slice(0)},applyTo2d:function(k){var N,$,ie,ee,ne,le=k.imageData.data,fe=le.length,xe=this.matrix,Pe=this.colorsOnly;for(ne=0;ne<fe;ne+=4)N=le[ne],$=le[ne+1],ie=le[ne+2],Pe?(le[ne]=N*xe[0]+$*xe[1]+ie*xe[2]+255*xe[4],le[ne+1]=N*xe[5]+$*xe[6]+ie*xe[7]+255*xe[9],le[ne+2]=N*xe[10]+$*xe[11]+ie*xe[12]+255*xe[14]):(le[ne]=N*xe[0]+$*xe[1]+ie*xe[2]+(ee=le[ne+3])*xe[3]+255*xe[4],le[ne+1]=N*xe[5]+$*xe[6]+ie*xe[7]+ee*xe[8]+255*xe[9],le[ne+2]=N*xe[10]+$*xe[11]+ie*xe[12]+ee*xe[13]+255*xe[14],le[ne+3]=N*xe[15]+$*xe[16]+ie*xe[17]+ee*xe[18]+255*xe[19])},getUniformLocations:function(k,N){return{uColorMatrix:k.getUniformLocation(N,"uColorMatrix"),uConstants:k.getUniformLocation(N,"uConstants")}},sendUniformData:function(k,N){var $=this.matrix,ee=[$[4],$[9],$[14],$[19]];k.uniformMatrix4fv(N.uColorMatrix,!1,[$[0],$[1],$[2],$[3],$[5],$[6],$[7],$[8],$[10],$[11],$[12],$[13],$[15],$[16],$[17],$[18]]),k.uniform4fv(N.uConstants,ee)}}),L.Image.filters.ColorMatrix.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Brightness=(0,L.util.createClass)(Y.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(k){if(0!==this.brightness){var N,$=k.imageData.data,ie=$.length,ee=Math.round(255*this.brightness);for(N=0;N<ie;N+=4)$[N]=$[N]+ee,$[N+1]=$[N+1]+ee,$[N+2]=$[N+2]+ee}},getUniformLocations:function(k,N){return{uBrightness:k.getUniformLocation(N,"uBrightness")}},sendUniformData:function(k,N){k.uniform1f(N.uBrightness,this.brightness)}}),L.Image.filters.Brightness.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.Image.filters;q.Convolute=(0,L.util.createClass)(q.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(N){var $=Math.sqrt(this.matrix.length),ie=this.type+"_"+$+"_"+(this.opaque?1:0),ee=this.fragmentSource[ie];return N.programCache.hasOwnProperty(ie)||(N.programCache[ie]=this.createProgram(N.context,ee)),N.programCache[ie]},applyTo2d:function(N){var $,ie,ee,ne,le,fe,xe,Pe,De,je,ke,Ae,he,tt=N.imageData,Ze=tt.data,nt=this.matrix,et=Math.round(Math.sqrt(nt.length)),Qe=Math.floor(et/2),at=tt.width,vt=tt.height,dt=N.ctx.createImageData(at,vt),Je=dt.data,it=this.opaque?1:0;for(ke=0;ke<vt;ke++)for(je=0;je<at;je++){for(le=4*(ke*at+je),$=0,ie=0,ee=0,ne=0,he=0;he<et;he++)for(Ae=0;Ae<et;Ae++)fe=je+Ae-Qe,(xe=ke+he-Qe)<0||xe>=vt||fe<0||fe>=at||($+=Ze[Pe=4*(xe*at+fe)]*(De=nt[he*et+Ae]),ie+=Ze[Pe+1]*De,ee+=Ze[Pe+2]*De,it||(ne+=Ze[Pe+3]*De));Je[le]=$,Je[le+1]=ie,Je[le+2]=ee,Je[le+3]=it?Ze[le+3]:ne}N.imageData=dt},getUniformLocations:function(N,$){return{uMatrix:N.getUniformLocation($,"uMatrix"),uOpaque:N.getUniformLocation($,"uOpaque"),uHalfSize:N.getUniformLocation($,"uHalfSize"),uSize:N.getUniformLocation($,"uSize")}},sendUniformData:function(N,$){N.uniform1fv($.uMatrix,this.matrix)},toObject:function(){return Y(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),L.Image.filters.Convolute.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Grayscale=(0,L.util.createClass)(Y.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(k){var N,$,ie=k.imageData.data,ee=ie.length,ne=this.mode;for(N=0;N<ee;N+=4)"average"===ne?$=(ie[N]+ie[N+1]+ie[N+2])/3:"lightness"===ne?$=(Math.min(ie[N],ie[N+1],ie[N+2])+Math.max(ie[N],ie[N+1],ie[N+2]))/2:"luminosity"===ne&&($=.21*ie[N]+.72*ie[N+1]+.07*ie[N+2]),ie[N]=$,ie[N+1]=$,ie[N+2]=$},retrieveShader:function(k){var N=this.type+"_"+this.mode;return k.programCache.hasOwnProperty(N)||(k.programCache[N]=this.createProgram(k.context,this.fragmentSource[this.mode])),k.programCache[N]},getUniformLocations:function(k,N){return{uMode:k.getUniformLocation(N,"uMode")}},sendUniformData:function(k,N){k.uniform1i(N.uMode,1)},isNeutralState:function(){return!1}}),L.Image.filters.Grayscale.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Invert=(0,L.util.createClass)(Y.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(k){var N,$=k.imageData.data,ie=$.length;for(N=0;N<ie;N+=4)$[N]=255-$[N],$[N+1]=255-$[N+1],$[N+2]=255-$[N+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(k,N){return{uInvert:k.getUniformLocation(N,"uInvert")}},sendUniformData:function(k,N){k.uniform1i(N.uInvert,this.invert)}}),L.Image.filters.Invert.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.Image.filters;q.Noise=(0,L.util.createClass)(q.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(N){if(0!==this.noise){var $,ie,ne,ee=N.imageData.data,le=this.noise;for($=0,ne=ee.length;$<ne;$+=4)ie=(.5-Math.random())*le,ee[$]+=ie,ee[$+1]+=ie,ee[$+2]+=ie}},getUniformLocations:function(N,$){return{uNoise:N.getUniformLocation($,"uNoise"),uSeed:N.getUniformLocation($,"uSeed")}},sendUniformData:function(N,$){N.uniform1f($.uNoise,this.noise/255),N.uniform1f($.uSeed,Math.random())},toObject:function(){return Y(this.callSuper("toObject"),{noise:this.noise})}}),L.Image.filters.Noise.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Pixelate=(0,L.util.createClass)(Y.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(k){var N,$,ie,ee,ne,le,fe,xe,Pe,De,je,ke=k.imageData,Ae=ke.data,he=ke.height,tt=ke.width;for($=0;$<he;$+=this.blocksize)for(ie=0;ie<tt;ie+=this.blocksize)for(ee=Ae[N=4*$*tt+4*ie],ne=Ae[N+1],le=Ae[N+2],fe=Ae[N+3],De=Math.min($+this.blocksize,he),je=Math.min(ie+this.blocksize,tt),xe=$;xe<De;xe++)for(Pe=ie;Pe<je;Pe++)Ae[N=4*xe*tt+4*Pe]=ee,Ae[N+1]=ne,Ae[N+2]=le,Ae[N+3]=fe},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(k,N){return{uBlocksize:k.getUniformLocation(N,"uBlocksize"),uStepW:k.getUniformLocation(N,"uStepW"),uStepH:k.getUniformLocation(N,"uStepH")}},sendUniformData:function(k,N){k.uniform1f(N.uBlocksize,this.blocksize)}}),L.Image.filters.Pixelate.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.extend,q=L.Image.filters;q.RemoveColor=(0,L.util.createClass)(q.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(N){var $,ie,ee,ne,le=N.imageData.data,fe=255*this.distance,xe=new L.Color(this.color).getSource(),Pe=[xe[0]-fe,xe[1]-fe,xe[2]-fe],De=[xe[0]+fe,xe[1]+fe,xe[2]+fe];for($=0;$<le.length;$+=4)ee=le[$+1],ne=le[$+2],(ie=le[$])>Pe[0]&&ee>Pe[1]&&ne>Pe[2]&&ie<De[0]&&ee<De[1]&&ne<De[2]&&(le[$+3]=0)},getUniformLocations:function(N,$){return{uLow:N.getUniformLocation($,"uLow"),uHigh:N.getUniformLocation($,"uHigh")}},sendUniformData:function(N,$){var ie=new L.Color(this.color).getSource(),ee=parseFloat(this.distance),le=[ie[0]/255+ee,ie[1]/255+ee,ie[2]/255+ee,1];N.uniform4fv($.uLow,[0+ie[0]/255-ee,0+ie[1]/255-ee,0+ie[2]/255-ee,1]),N.uniform4fv($.uHigh,le)},toObject:function(){return Y(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),L.Image.filters.RemoveColor.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters,q=L.util.createClass,k={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var N in k)Y[N]=q(Y.ColorMatrix,{type:N,matrix:k[N],mainParameter:!1,colorsOnly:!0}),L.Image.filters[N].fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric,Y=L.Image.filters;Y.BlendColor=(0,L.util.createClass)(Y.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(k){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[k]+"}\n}"},retrieveShader:function(k){var N,$=this.type+"_"+this.mode;return k.programCache.hasOwnProperty($)||(N=this.buildSource(this.mode),k.programCache[$]=this.createProgram(k.context,N)),k.programCache[$]},applyTo2d:function(k){var N,$,ie,ee,ne,le,fe,xe=k.imageData.data,Pe=xe.length,De=1-this.alpha;N=(fe=new L.Color(this.color).getSource())[0]*this.alpha,$=fe[1]*this.alpha,ie=fe[2]*this.alpha;for(var je=0;je<Pe;je+=4)switch(ee=xe[je],ne=xe[je+1],le=xe[je+2],this.mode){case"multiply":xe[je]=ee*N/255,xe[je+1]=ne*$/255,xe[je+2]=le*ie/255;break;case"screen":xe[je]=255-(255-ee)*(255-N)/255,xe[je+1]=255-(255-ne)*(255-$)/255,xe[je+2]=255-(255-le)*(255-ie)/255;break;case"add":xe[je]=ee+N,xe[je+1]=ne+$,xe[je+2]=le+ie;break;case"diff":case"difference":xe[je]=Math.abs(ee-N),xe[je+1]=Math.abs(ne-$),xe[je+2]=Math.abs(le-ie);break;case"subtract":xe[je]=ee-N,xe[je+1]=ne-$,xe[je+2]=le-ie;break;case"darken":xe[je]=Math.min(ee,N),xe[je+1]=Math.min(ne,$),xe[je+2]=Math.min(le,ie);break;case"lighten":xe[je]=Math.max(ee,N),xe[je+1]=Math.max(ne,$),xe[je+2]=Math.max(le,ie);break;case"overlay":xe[je]=N<128?2*ee*N/255:255-2*(255-ee)*(255-N)/255,xe[je+1]=$<128?2*ne*$/255:255-2*(255-ne)*(255-$)/255,xe[je+2]=ie<128?2*le*ie/255:255-2*(255-le)*(255-ie)/255;break;case"exclusion":xe[je]=N+ee-2*N*ee/255,xe[je+1]=$+ne-2*$*ne/255,xe[je+2]=ie+le-2*ie*le/255;break;case"tint":xe[je]=N+ee*De,xe[je+1]=$+ne*De,xe[je+2]=ie+le*De}},getUniformLocations:function(k,N){return{uColor:k.getUniformLocation(N,"uColor")}},sendUniformData:function(k,N){var $=new L.Color(this.color).getSource();$[0]=this.alpha*$[0]/255,$[1]=this.alpha*$[1]/255,$[2]=this.alpha*$[2]/255,$[3]=this.alpha,k.uniform4fv(N.uColor,$)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),L.Image.filters.BlendColor.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric,Y=L.Image.filters;Y.BlendImage=(0,L.util.createClass)(Y.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(k){var N=this.type+"_"+this.mode,$=this.fragmentSource[this.mode];return k.programCache.hasOwnProperty(N)||(k.programCache[N]=this.createProgram(k.context,$)),k.programCache[N]},applyToWebGL:function(k){var N=k.context,$=this.createTexture(k.filterBackend,this.image);this.bindAdditionalTexture(N,$,N.TEXTURE1),this.callSuper("applyToWebGL",k),this.unbindAdditionalTexture(N,N.TEXTURE1)},createTexture:function(k,N){return k.getCachedTexture(N.cacheKey,N._element)},calculateMatrix:function(){var k=this.image;return[1/k.scaleX,0,0,0,1/k.scaleY,0,-k.left/k._element.width,-k.top/k._element.height,1]},applyTo2d:function(k){var N,$,ie,ee,ne,le,fe,xe,Pe,De,je,ke=k.imageData,Ae=k.filterBackend.resources,he=ke.data,tt=he.length,Ze=ke.width,nt=ke.height,et=this.image;Ae.blendImage||(Ae.blendImage=L.util.createCanvasElement()),De=(Pe=Ae.blendImage).getContext("2d"),Pe.width!==Ze||Pe.height!==nt?(Pe.width=Ze,Pe.height=nt):De.clearRect(0,0,Ze,nt),De.setTransform(et.scaleX,0,0,et.scaleY,et.left,et.top),De.drawImage(et._element,0,0,Ze,nt),je=De.getImageData(0,0,Ze,nt).data;for(var Qe=0;Qe<tt;Qe+=4)switch(ne=he[Qe],le=he[Qe+1],fe=he[Qe+2],xe=he[Qe+3],N=je[Qe],$=je[Qe+1],ie=je[Qe+2],ee=je[Qe+3],this.mode){case"multiply":he[Qe]=ne*N/255,he[Qe+1]=le*$/255,he[Qe+2]=fe*ie/255,he[Qe+3]=xe*ee/255;break;case"mask":he[Qe+3]=ee}},getUniformLocations:function(k,N){return{uTransformMatrix:k.getUniformLocation(N,"uTransformMatrix"),uImage:k.getUniformLocation(N,"uImage")}},sendUniformData:function(k,N){var $=this.calculateMatrix();k.uniform1i(N.uImage,1),k.uniformMatrix3fv(N.uTransformMatrix,!1,$)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),L.Image.filters.BlendImage.fromObject=function(k,N){L.Image.fromObject(k.image,function($){var ie=L.util.object.clone(k);ie.image=$,N(new L.Image.filters.BlendImage(ie))})}}(n),function(j){var L=j.fabric||(j.fabric={}),Y=Math.pow,q=Math.floor,k=Math.sqrt,N=Math.abs,$=Math.round,ie=Math.sin,ee=Math.ceil,ne=L.Image.filters;ne.Resize=(0,L.util.createClass)(ne.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(fe,xe){return{uDelta:fe.getUniformLocation(xe,"uDelta"),uTaps:fe.getUniformLocation(xe,"uTaps")}},sendUniformData:function(fe,xe){fe.uniform2fv(xe.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),fe.uniform1fv(xe.uTaps,this.taps)},retrieveShader:function(fe){var xe=this.getFilterWindow(),Pe=this.type+"_"+xe;if(!fe.programCache.hasOwnProperty(Pe)){var De=this.generateShader(xe);fe.programCache[Pe]=this.createProgram(fe.context,De)}return fe.programCache[Pe]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var fe=this.lanczosCreate(this.lanczosLobes),xe=this.tempScale,Pe=this.getFilterWindow(),De=new Array(Pe),je=1;je<=Pe;je++)De[je-1]=fe(je*xe);return De},generateShader:function(fe){for(var xe=new Array(fe),Pe=this.fragmentSourceTOP,De=1;De<=fe;De++)xe[De-1]=De+".0 * uDelta";return Pe+="uniform float uTaps["+fe+"];\n",Pe+="void main() {\n",Pe+="  vec4 color = texture2D(uTexture, vTexCoord);\n",Pe+="  float sum = 1.0;\n",xe.forEach(function(je,ke){Pe+="  color += texture2D(uTexture, vTexCoord + "+je+") * uTaps["+ke+"];\n",Pe+="  color += texture2D(uTexture, vTexCoord - "+je+") * uTaps["+ke+"];\n",Pe+="  sum += 2.0 * uTaps["+ke+"];\n"}),Pe+="  gl_FragColor = color / sum;\n",Pe+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(fe){fe.webgl?(fe.passes++,this.width=fe.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=fe.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),fe.destinationWidth=this.dW,this._setupFrameBuffer(fe),this.applyToWebGL(fe),this._swapTextures(fe),fe.sourceWidth=fe.destinationWidth,this.height=fe.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),fe.destinationHeight=this.dH,this._setupFrameBuffer(fe),this.applyToWebGL(fe),this._swapTextures(fe),fe.sourceHeight=fe.destinationHeight):this.applyTo2d(fe)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(fe){return function(xe){if(xe>=fe||xe<=-fe)return 0;if(xe<1.1920929e-7&&xe>-1.1920929e-7)return 1;var Pe=(xe*=Math.PI)/fe;return ie(xe)/xe*ie(Pe)/Pe}},applyTo2d:function(fe){var xe=fe.imageData,Pe=this.scaleX,De=this.scaleY;this.rcpScaleX=1/Pe,this.rcpScaleY=1/De;var je,ke=xe.width,Ae=xe.height,he=$(ke*Pe),tt=$(Ae*De);"sliceHack"===this.resizeType?je=this.sliceByTwo(fe,ke,Ae,he,tt):"hermite"===this.resizeType?je=this.hermiteFastResize(fe,ke,Ae,he,tt):"bilinear"===this.resizeType?je=this.bilinearFiltering(fe,ke,Ae,he,tt):"lanczos"===this.resizeType&&(je=this.lanczosResize(fe,ke,Ae,he,tt)),fe.imageData=je},sliceByTwo:function(fe,xe,Pe,De,je){var ke,Ae,he=fe.imageData,Ze=!1,nt=!1,et=.5*xe,Qe=.5*Pe,at=L.filterBackend.resources,vt=0,dt=0,Je=xe,it=0;for(at.sliceByTwo||(at.sliceByTwo=document.createElement("canvas")),((ke=at.sliceByTwo).width<1.5*xe||ke.height<Pe)&&(ke.width=1.5*xe,ke.height=Pe),(Ae=ke.getContext("2d")).clearRect(0,0,1.5*xe,Pe),Ae.putImageData(he,0,0),De=q(De),je=q(je);!Ze||!nt;)xe=et,Pe=Qe,De<q(.5*et)?et=q(.5*et):(et=De,Ze=!0),je<q(.5*Qe)?Qe=q(.5*Qe):(Qe=je,nt=!0),Ae.drawImage(ke,vt,dt,xe,Pe,Je,it,et,Qe),vt=Je,dt=it,it+=Qe;return Ae.getImageData(vt,dt,De,je)},lanczosResize:function(fe,xe,Pe,De,je){var ke=fe.imageData.data,Ae=fe.ctx.createImageData(De,je),he=Ae.data,tt=this.lanczosCreate(this.lanczosLobes),Ze=this.rcpScaleX,nt=this.rcpScaleY,et=2/this.rcpScaleX,Qe=2/this.rcpScaleY,at=ee(Ze*this.lanczosLobes/2),vt=ee(nt*this.lanczosLobes/2),dt={},Je={},it={};return function ct(wt){var ht,At,kt,Bt,Ft,Ht,Kt,an,fn,ln,wn;for(Je.x=(wt+.5)*Ze,it.x=q(Je.x),ht=0;ht<je;ht++){for(Je.y=(ht+.5)*nt,it.y=q(Je.y),Ft=0,Ht=0,Kt=0,an=0,fn=0,At=it.x-at;At<=it.x+at;At++)if(!(At<0||At>=xe)){ln=q(1e3*N(At-Je.x)),dt[ln]||(dt[ln]={});for(var ut=it.y-vt;ut<=it.y+vt;ut++)ut<0||ut>=Pe||(wn=q(1e3*N(ut-Je.y)),dt[ln][wn]||(dt[ln][wn]=tt(k(Y(ln*et,2)+Y(wn*Qe,2))/1e3)),(kt=dt[ln][wn])>0&&(Ft+=kt,Ht+=kt*ke[Bt=4*(ut*xe+At)],Kt+=kt*ke[Bt+1],an+=kt*ke[Bt+2],fn+=kt*ke[Bt+3]))}he[Bt=4*(ht*De+wt)]=Ht/Ft,he[Bt+1]=Kt/Ft,he[Bt+2]=an/Ft,he[Bt+3]=fn/Ft}return++wt<De?ct(wt):Ae}(0)},bilinearFiltering:function(fe,xe,Pe,De,je){var ke,Ae,he,tt,Ze,nt,et,at,vt=0,dt=this.rcpScaleX,Je=this.rcpScaleY,it=4*(xe-1),ct=fe.imageData.data,wt=fe.ctx.createImageData(De,je),ht=wt.data;for(he=0;he<je;he++)for(tt=0;tt<De;tt++)for(Ze=dt*tt-(ke=q(dt*tt)),nt=Je*he-(Ae=q(Je*he)),at=4*(Ae*xe+ke),et=0;et<4;et++)ht[vt++]=ct[at+et]*(1-Ze)*(1-nt)+ct[at+4+et]*Ze*(1-nt)+ct[at+it+et]*nt*(1-Ze)+ct[at+it+4+et]*Ze*nt;return wt},hermiteFastResize:function(fe,xe,Pe,De,je){for(var ke=this.rcpScaleX,Ae=this.rcpScaleY,he=ee(ke/2),tt=ee(Ae/2),Ze=fe.imageData.data,nt=fe.ctx.createImageData(De,je),et=nt.data,Qe=0;Qe<je;Qe++)for(var at=0;at<De;at++){for(var vt=4*(at+Qe*De),dt=0,Je=0,it=0,ct=0,wt=0,ht=0,At=0,kt=(Qe+.5)*Ae,Bt=q(Qe*Ae);Bt<(Qe+1)*Ae;Bt++)for(var Ft=N(kt-(Bt+.5))/tt,Ht=(at+.5)*ke,Kt=Ft*Ft,an=q(at*ke);an<(at+1)*ke;an++){var fn=N(Ht-(an+.5))/he,ln=k(Kt+fn*fn);ln>1&&ln<-1||(dt=2*ln*ln*ln-3*ln*ln+1)>0&&(At+=dt*Ze[3+(fn=4*(an+Bt*xe))],it+=dt,Ze[fn+3]<255&&(dt=dt*Ze[fn+3]/250),ct+=dt*Ze[fn],wt+=dt*Ze[fn+1],ht+=dt*Ze[fn+2],Je+=dt)}et[vt]=ct/Je,et[vt+1]=wt/Je,et[vt+2]=ht/Je,et[vt+3]=At/it}return nt},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),L.Image.filters.Resize.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Contrast=(0,L.util.createClass)(Y.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(k){if(0!==this.contrast){var N,$=k.imageData.data,ie=$.length,ee=Math.floor(255*this.contrast),ne=259*(ee+255)/(255*(259-ee));for(N=0;N<ie;N+=4)$[N]=ne*($[N]-128)+128,$[N+1]=ne*($[N+1]-128)+128,$[N+2]=ne*($[N+2]-128)+128}},getUniformLocations:function(k,N){return{uContrast:k.getUniformLocation(N,"uContrast")}},sendUniformData:function(k,N){k.uniform1f(N.uContrast,this.contrast)}}),L.Image.filters.Contrast.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Saturation=(0,L.util.createClass)(Y.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(k){if(0!==this.saturation){var N,$,ie=k.imageData.data,ee=ie.length,ne=-this.saturation;for(N=0;N<ee;N+=4)$=Math.max(ie[N],ie[N+1],ie[N+2]),ie[N]+=$!==ie[N]?($-ie[N])*ne:0,ie[N+1]+=$!==ie[N+1]?($-ie[N+1])*ne:0,ie[N+2]+=$!==ie[N+2]?($-ie[N+2])*ne:0}},getUniformLocations:function(k,N){return{uSaturation:k.getUniformLocation(N,"uSaturation")}},sendUniformData:function(k,N){k.uniform1f(N.uSaturation,-this.saturation)}}),L.Image.filters.Saturation.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Vibrance=(0,L.util.createClass)(Y.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(k){if(0!==this.vibrance){var N,$,ee,ne=k.imageData.data,le=ne.length,fe=-this.vibrance;for(N=0;N<le;N+=4)$=Math.max(ne[N],ne[N+1],ne[N+2]),ee=2*Math.abs($-(ne[N]+ne[N+1]+ne[N+2])/3)/255*fe,ne[N]+=$!==ne[N]?($-ne[N])*ee:0,ne[N+1]+=$!==ne[N+1]?($-ne[N+1])*ee:0,ne[N+2]+=$!==ne[N+2]?($-ne[N+2])*ee:0}},getUniformLocations:function(k,N){return{uVibrance:k.getUniformLocation(N,"uVibrance")}},sendUniformData:function(k,N){k.uniform1f(N.uVibrance,-this.vibrance)}}),L.Image.filters.Vibrance.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Blur=(0,L.util.createClass)(Y.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(k){k.webgl?(this.aspectRatio=k.sourceWidth/k.sourceHeight,k.passes++,this._setupFrameBuffer(k),this.horizontal=!0,this.applyToWebGL(k),this._swapTextures(k),this._setupFrameBuffer(k),this.horizontal=!1,this.applyToWebGL(k),this._swapTextures(k)):this.applyTo2d(k)},applyTo2d:function(k){k.imageData=this.simpleBlur(k)},simpleBlur:function(k){var N,$,ie=k.filterBackend.resources,ee=k.imageData.width,ne=k.imageData.height;ie.blurLayer1||(ie.blurLayer1=L.util.createCanvasElement(),ie.blurLayer2=L.util.createCanvasElement()),$=ie.blurLayer2,(N=ie.blurLayer1).width===ee&&N.height===ne||($.width=N.width=ee,$.height=N.height=ne);var le,fe,xe,Pe,De=N.getContext("2d"),je=$.getContext("2d"),ke=.06*this.blur*.5;for(De.putImageData(k.imageData,0,0),je.clearRect(0,0,ee,ne),Pe=-15;Pe<=15;Pe++)xe=ke*(fe=Pe/15)*ee+(le=(Math.random()-.5)/4),je.globalAlpha=1-Math.abs(fe),je.drawImage(N,xe,le),De.drawImage($,0,0),je.globalAlpha=1,je.clearRect(0,0,$.width,$.height);for(Pe=-15;Pe<=15;Pe++)xe=ke*(fe=Pe/15)*ne+(le=(Math.random()-.5)/4),je.globalAlpha=1-Math.abs(fe),je.drawImage(N,le,xe),De.drawImage($,0,0),je.globalAlpha=1,je.clearRect(0,0,$.width,$.height);k.ctx.drawImage(N,0,0);var Ae=k.ctx.getImageData(0,0,N.width,N.height);return De.globalAlpha=1,De.clearRect(0,0,N.width,N.height),Ae},getUniformLocations:function(k,N){return{delta:k.getUniformLocation(N,"uDelta")}},sendUniformData:function(k,N){var $=this.chooseRightDelta();k.uniform2fv(N.delta,$)},chooseRightDelta:function(){var k,N=1,$=[0,0];return this.horizontal?this.aspectRatio>1&&(N=1/this.aspectRatio):this.aspectRatio<1&&(N=this.aspectRatio),k=N*this.blur*.12,this.horizontal?$[0]=k:$[1]=k,$}}),Y.Blur.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Gamma=(0,L.util.createClass)(Y.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(k){this.gamma=[1,1,1],Y.BaseFilter.prototype.initialize.call(this,k)},applyTo2d:function(k){var N,$=k.imageData.data,ie=this.gamma,ee=$.length,ne=1/ie[0],le=1/ie[1],fe=1/ie[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),N=0,ee=256;N<ee;N++)this.rVals[N]=255*Math.pow(N/255,ne),this.gVals[N]=255*Math.pow(N/255,le),this.bVals[N]=255*Math.pow(N/255,fe);for(N=0,ee=$.length;N<ee;N+=4)$[N]=this.rVals[$[N]],$[N+1]=this.gVals[$[N+1]],$[N+2]=this.bVals[$[N+2]]},getUniformLocations:function(k,N){return{uGamma:k.getUniformLocation(N,"uGamma")}},sendUniformData:function(k,N){k.uniform3fv(N.uGamma,this.gamma)}}),L.Image.filters.Gamma.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.Composed=(0,L.util.createClass)(Y.BaseFilter,{type:"Composed",subFilters:[],initialize:function(k){this.callSuper("initialize",k),this.subFilters=this.subFilters.slice(0)},applyTo:function(k){k.passes+=this.subFilters.length-1,this.subFilters.forEach(function(N){N.applyTo(k)})},toObject:function(){return L.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(k){return k.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(k){return!k.isNeutralState()})}}),L.Image.filters.Composed.fromObject=function(k,N){var $=(k.subFilters||[]).map(function(ee){return new L.Image.filters[ee.type](ee)}),ie=new L.Image.filters.Composed({subFilters:$});return N&&N(ie),ie}}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.Image.filters;Y.HueRotation=(0,L.util.createClass)(Y.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var k=this.rotation*Math.PI,N=L.util.cos(k),$=L.util.sin(k),ie=1/3,ee=Math.sqrt(ie)*$,ne=1-N;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=N+ne/3,this.matrix[1]=ie*ne-ee,this.matrix[2]=ie*ne+ee,this.matrix[5]=ie*ne+ee,this.matrix[6]=N+ie*ne,this.matrix[7]=ie*ne-ee,this.matrix[10]=ie*ne-ee,this.matrix[11]=ie*ne+ee,this.matrix[12]=N+ie*ne},isNeutralState:function(k){return this.calculateMatrix(),Y.BaseFilter.prototype.isNeutralState.call(this,k)},applyTo:function(k){this.calculateMatrix(),Y.BaseFilter.prototype.applyTo.call(this,k)}}),L.Image.filters.HueRotation.fromObject=L.Image.filters.BaseFilter.fromObject}(n),function(j){var L=j.fabric||(j.fabric={}),Y=L.util.object.clone;if(L.Text)L.warn("fabric.Text is already defined");else{var q="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");L.Text=L.util.createClass(L.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:L.Object.prototype.stateProperties.concat(q),cacheProperties:L.Object.prototype.cacheProperties.concat(q),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(k,N){this.styles=N&&N.styles||{},this.text=k,this.__skipDimension=!0,this.callSuper("initialize",N),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var k=this.path;k&&(k.segmentsInfo=L.util.getPathSegmentsInfo(k.path))},getMeasuringContext:function(){return L._measuringContext||(L._measuringContext=this.canvas&&this.canvas.contextCache||L.util.createCanvasElement().getContext("2d")),L._measuringContext},_splitText:function(){var k=this._splitTextIntoLines(this.text);return this.textLines=k.lines,this._textLines=k.graphemeLines,this._unwrappedTextLines=k._unwrappedLines,this._text=k.graphemeText,k},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var k,N,ie,ee,ne,le,fe=0,xe=this._textLines.length;fe<xe;fe++)if(("justify"===this.textAlign||fe!==xe-1&&!this.isEndOfWrapping(fe))&&(ie=0,ee=this._textLines[fe],(N=this.getLineWidth(fe))<this.width&&(le=this.textLines[fe].match(this._reSpacesAndTabs)))){k=(this.width-N)/le.length;for(var Pe=0,De=ee.length;Pe<=De;Pe++)ne=this.__charBounds[fe][Pe],this._reSpaceAndTab.test(ee[Pe])?(ne.width+=k,ne.kernedWidth+=k,ne.left+=ie,ie+=k):ne.left+=ie}},isEndOfWrapping:function(k){return k===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var k=this.callSuper("_getCacheCanvasDimensions"),N=this.fontSize;return k.width+=N*k.zoomX,k.height+=N*k.zoomY,k},_render:function(k){var N=this.path;N&&!N.isNotVisible()&&N._render(k),this._setTextStyles(k),this._renderTextLinesBackground(k),this._renderTextDecoration(k,"underline"),this._renderText(k),this._renderTextDecoration(k,"overline"),this._renderTextDecoration(k,"linethrough")},_renderText:function(k){"stroke"===this.paintFirst?(this._renderTextStroke(k),this._renderTextFill(k)):(this._renderTextFill(k),this._renderTextStroke(k))},_setTextStyles:function(k,N,$){if(k.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":k.textBaseline="middle";break;case"ascender":k.textBaseline="top";break;case"descender":k.textBaseline="bottom"}k.font=this._getFontDeclaration(N,$)},calcTextWidth:function(){for(var k=this.getLineWidth(0),N=1,$=this._textLines.length;N<$;N++){var ie=this.getLineWidth(N);ie>k&&(k=ie)}return k},_renderTextLine:function(k,N,$,ie,ee,ne){this._renderChars(k,N,$,ie,ee,ne)},_renderTextLinesBackground:function(k){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var N,$,ie,ee,ne,le,fe,xe=k.fillStyle,Pe=this._getLeftOffset(),De=this._getTopOffset(),je=0,ke=0,Ae=this.path,he=0,tt=this._textLines.length;he<tt;he++)if(N=this.getHeightOfLine(he),this.textBackgroundColor||this.styleHas("textBackgroundColor",he)){ie=this._textLines[he],$=this._getLineLeftOffset(he),ke=0,je=0,ee=this.getValueOfPropertyAt(he,0,"textBackgroundColor");for(var Ze=0,nt=ie.length;Ze<nt;Ze++)ne=this.__charBounds[he][Ze],le=this.getValueOfPropertyAt(he,Ze,"textBackgroundColor"),Ae?(k.save(),k.translate(ne.renderLeft,ne.renderTop),k.rotate(ne.angle),k.fillStyle=le,le&&k.fillRect(-ne.width/2,-N/this.lineHeight*(1-this._fontSizeFraction),ne.width,N/this.lineHeight),k.restore()):le!==ee?(fe=Pe+$+je,"rtl"===this.direction&&(fe=this.width-fe-ke),k.fillStyle=ee,ee&&k.fillRect(fe,De,ke,N/this.lineHeight),je=ne.left,ke=ne.width,ee=le):ke+=ne.kernedWidth;le&&!Ae&&(fe=Pe+$+je,"rtl"===this.direction&&(fe=this.width-fe-ke),k.fillStyle=le,k.fillRect(fe,De,ke,N/this.lineHeight)),De+=N}else De+=N;k.fillStyle=xe,this._removeShadow(k)}},getFontCache:function(k){var N=k.fontFamily.toLowerCase();L.charWidthsCache[N]||(L.charWidthsCache[N]={});var $=L.charWidthsCache[N],ie=k.fontStyle.toLowerCase()+"_"+(k.fontWeight+"").toLowerCase();return $[ie]||($[ie]={}),$[ie]},_measureChar:function(k,N,$,ie){var ee,ne,le,fe,xe=this.getFontCache(N),Pe=$+k,De=this._getFontDeclaration(N)===this._getFontDeclaration(ie),je=N.fontSize/this.CACHE_FONT_SIZE;if($&&void 0!==xe[$]&&(le=xe[$]),void 0!==xe[k]&&(fe=ee=xe[k]),De&&void 0!==xe[Pe]&&(fe=(ne=xe[Pe])-le),void 0===ee||void 0===le||void 0===ne){var ke=this.getMeasuringContext();this._setTextStyles(ke,N,!0)}return void 0===ee&&(fe=ee=ke.measureText(k).width,xe[k]=ee),void 0===le&&De&&$&&(le=ke.measureText($).width,xe[$]=le),De&&void 0===ne&&(ne=ke.measureText(Pe).width,xe[Pe]=ne,fe=ne-le),{width:ee*je,kernedWidth:fe*je}},getHeightOfChar:function(k,N){return this.getValueOfPropertyAt(k,N,"fontSize")},measureLine:function(k){var N=this._measureLine(k);return 0!==this.charSpacing&&(N.width-=this._getWidthOfCharSpacing()),N.width<0&&(N.width=0),N},_measureLine:function(k){var N,$,ie,ee,ne,le,fe=0,xe=this._textLines[k],Pe=new Array(xe.length),De=0,je=this.path,ke="right"===this.pathSide;for(this.__charBounds[k]=Pe,N=0;N<xe.length;N++)ee=this._getGraphemeBox($=xe[N],k,N,ie),Pe[N]=ee,fe+=ee.kernedWidth,ie=$;if(Pe[N]={left:ee?ee.left+ee.width:0,width:0,kernedWidth:0,height:this.fontSize},je){switch(le=je.segmentsInfo[je.segmentsInfo.length-1].length,(ne=L.util.getPointOnPath(je.path,0,je.segmentsInfo)).x+=je.pathOffset.x,ne.y+=je.pathOffset.y,this.textAlign){case"left":De=ke?le-fe:0;break;case"center":De=(le-fe)/2;break;case"right":De=ke?0:le-fe}for(De+=this.pathStartOffset*(ke?-1:1),N=ke?xe.length-1:0;ke?N>=0:N<xe.length;ke?N--:N++)De>le?De%=le:De<0&&(De+=le),this._setGraphemeOnPath(De,ee=Pe[N],ne),De+=ee.kernedWidth}return{width:fe,numOfSpaces:0}},_setGraphemeOnPath:function(k,N,$){var ee=this.path,ne=L.util.getPointOnPath(ee.path,k+N.kernedWidth/2,ee.segmentsInfo);N.renderLeft=ne.x-$.x,N.renderTop=ne.y-$.y,N.angle=ne.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(k,N,$,ie,ee){var ne,le=this.getCompleteStyleDeclaration(N,$),fe=ie?this.getCompleteStyleDeclaration(N,$-1):{},xe=this._measureChar(k,le,ie,fe),Pe=xe.kernedWidth,De=xe.width;0!==this.charSpacing&&(De+=ne=this._getWidthOfCharSpacing(),Pe+=ne);var je={width:De,left:0,height:le.fontSize,kernedWidth:Pe,deltaY:le.deltaY};if($>0&&!ee){var ke=this.__charBounds[N][$-1];je.left=ke.left+ke.width+xe.kernedWidth-xe.width}return je},getHeightOfLine:function(k){if(this.__lineHeights[k])return this.__lineHeights[k];for(var N=this._textLines[k],$=this.getHeightOfChar(k,0),ie=1,ee=N.length;ie<ee;ie++)$=Math.max(this.getHeightOfChar(k,ie),$);return this.__lineHeights[k]=$*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var k,N=0,$=0,ie=this._textLines.length;$<ie;$++)k=this.getHeightOfLine($),N+=$===ie-1?k/this.lineHeight:k;return N},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(k,N){k.save();for(var $=0,ie=this._getLeftOffset(),ee=this._getTopOffset(),ne=0,le=this._textLines.length;ne<le;ne++){var fe=this.getHeightOfLine(ne),xe=fe/this.lineHeight,Pe=this._getLineLeftOffset(ne);this._renderTextLine(N,k,this._textLines[ne],ie+Pe,ee+$+xe,ne),$+=fe}k.restore()},_renderTextFill:function(k){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(k,"fillText")},_renderTextStroke:function(k){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(k),k.save(),this._setLineDash(k,this.strokeDashArray),k.beginPath(),this._renderTextCommon(k,"strokeText"),k.closePath(),k.restore())},_renderChars:function(k,N,$,ie,ee,ne){var le,fe,xe,Pe,je=this.getHeightOfLine(ne),ke=-1!==this.textAlign.indexOf("justify"),Ae="",he=0,tt=this.path,Ze=!ke&&0===this.charSpacing&&this.isEmptyStyles(ne)&&!tt,nt="ltr"===this.direction,et="ltr"===this.direction?1:-1,Qe=N.canvas.getAttribute("dir");if(N.save(),Qe!==this.direction&&(N.canvas.setAttribute("dir",nt?"ltr":"rtl"),N.direction=nt?"ltr":"rtl",N.textAlign=nt?"left":"right"),ee-=je*this._fontSizeFraction/this.lineHeight,Ze)return this._renderChar(k,N,ne,0,$.join(""),ie,ee,je),void N.restore();for(var at=0,vt=$.length-1;at<=vt;at++)Pe=at===vt||this.charSpacing||tt,Ae+=$[at],xe=this.__charBounds[ne][at],0===he?(ie+=et*(xe.kernedWidth-xe.width),he+=xe.width):he+=xe.kernedWidth,ke&&!Pe&&this._reSpaceAndTab.test($[at])&&(Pe=!0),Pe||(le=le||this.getCompleteStyleDeclaration(ne,at),fe=this.getCompleteStyleDeclaration(ne,at+1),Pe=this._hasStyleChanged(le,fe)),Pe&&(tt?(N.save(),N.translate(xe.renderLeft,xe.renderTop),N.rotate(xe.angle),this._renderChar(k,N,ne,at,Ae,-he/2,0,je),N.restore()):this._renderChar(k,N,ne,at,Ae,ie,ee,je),Ae="",le=fe,ie+=et*he,he=0);N.restore()},_applyPatternGradientTransformText:function(k){var N,$=L.util.createCanvasElement(),ie=this.width+this.strokeWidth,ee=this.height+this.strokeWidth;return $.width=ie,$.height=ee,(N=$.getContext("2d")).beginPath(),N.moveTo(0,0),N.lineTo(ie,0),N.lineTo(ie,ee),N.lineTo(0,ee),N.closePath(),N.translate(ie/2,ee/2),N.fillStyle=k.toLive(N),this._applyPatternGradientTransform(N,k),N.fill(),N.createPattern($,"no-repeat")},handleFiller:function(k,N,$){var ie,ee;return $.toLive?"percentage"===$.gradientUnits||$.gradientTransform||$.patternTransform?(k.translate(ie=-this.width/2,ee=-this.height/2),k[N]=this._applyPatternGradientTransformText($),{offsetX:ie,offsetY:ee}):(k[N]=$.toLive(k,this),this._applyPatternGradientTransform(k,$)):(k[N]=$,{offsetX:0,offsetY:0})},_setStrokeStyles:function(k,N){return k.lineWidth=N.strokeWidth,k.lineCap=this.strokeLineCap,k.lineDashOffset=this.strokeDashOffset,k.lineJoin=this.strokeLineJoin,k.miterLimit=this.strokeMiterLimit,this.handleFiller(k,"strokeStyle",N.stroke)},_setFillStyles:function(k,N){return this.handleFiller(k,"fillStyle",N.fill)},_renderChar:function(k,N,$,ie,ee,ne,le){var fe,xe,Pe=this._getStyleDeclaration($,ie),De=this.getCompleteStyleDeclaration($,ie),je="fillText"===k&&De.fill,ke="strokeText"===k&&De.stroke&&De.strokeWidth;(ke||je)&&(N.save(),je&&(fe=this._setFillStyles(N,De)),ke&&(xe=this._setStrokeStyles(N,De)),N.font=this._getFontDeclaration(De),Pe&&Pe.textBackgroundColor&&this._removeShadow(N),Pe&&Pe.deltaY&&(le+=Pe.deltaY),je&&N.fillText(ee,ne-fe.offsetX,le-fe.offsetY),ke&&N.strokeText(ee,ne-xe.offsetX,le-xe.offsetY),N.restore())},setSuperscript:function(k,N){return this._setScript(k,N,this.superscript)},setSubscript:function(k,N){return this._setScript(k,N,this.subscript)},_setScript:function(k,N,$){var ie=this.get2DCursorLocation(k,!0),ee=this.getValueOfPropertyAt(ie.lineIndex,ie.charIndex,"fontSize"),ne=this.getValueOfPropertyAt(ie.lineIndex,ie.charIndex,"deltaY");return this.setSelectionStyles({fontSize:ee*$.size,deltaY:ne+ee*$.baseline},k,N),this},_hasStyleChanged:function(k,N){return k.fill!==N.fill||k.stroke!==N.stroke||k.strokeWidth!==N.strokeWidth||k.fontSize!==N.fontSize||k.fontFamily!==N.fontFamily||k.fontWeight!==N.fontWeight||k.fontStyle!==N.fontStyle||k.deltaY!==N.deltaY},_hasStyleChangedForSvg:function(k,N){return this._hasStyleChanged(k,N)||k.overline!==N.overline||k.underline!==N.underline||k.linethrough!==N.linethrough},_getLineLeftOffset:function(k){var N=this.getLineWidth(k),$=this.width-N,ie=this.textAlign,ee=this.direction,ne=0,le=this.isEndOfWrapping(k);return"justify"===ie||"justify-center"===ie&&!le||"justify-right"===ie&&!le||"justify-left"===ie&&!le?0:("center"===ie&&(ne=$/2),"right"===ie&&(ne=$),"justify-center"===ie&&(ne=$/2),"justify-right"===ie&&(ne=$),"rtl"===ee&&(ne-=$),ne)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var k=this._forceClearCache;return k||(k=this.hasStateChanged("_dimensionAffectingProps")),k&&(this.dirty=!0,this._forceClearCache=!1),k},getLineWidth:function(k){if(void 0!==this.__lineWidths[k])return this.__lineWidths[k];var N=this.measureLine(k).width;return this.__lineWidths[k]=N,N},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(k,N,$){var ie=this._getStyleDeclaration(k,N);return ie&&void 0!==ie[$]?ie[$]:this[$]},_renderTextDecoration:function(k,N){if(this[N]||this.styleHas(N)){for(var $,ie,ee,ne,le,fe,xe,Pe,De,je,ke,Ae,he,tt,Ze,nt,et=this._getLeftOffset(),Qe=this._getTopOffset(),at=this.path,vt=this._getWidthOfCharSpacing(),dt=this.offsets[N],Je=0,it=this._textLines.length;Je<it;Je++)if($=this.getHeightOfLine(Je),this[N]||this.styleHas(N,Je)){xe=this._textLines[Je],tt=$/this.lineHeight,ne=this._getLineLeftOffset(Je),je=0,ke=0,Pe=this.getValueOfPropertyAt(Je,0,N),nt=this.getValueOfPropertyAt(Je,0,"fill"),De=Qe+tt*(1-this._fontSizeFraction),ie=this.getHeightOfChar(Je,0),le=this.getValueOfPropertyAt(Je,0,"deltaY");for(var ct=0,wt=xe.length;ct<wt;ct++)if(Ae=this.__charBounds[Je][ct],he=this.getValueOfPropertyAt(Je,ct,N),Ze=this.getValueOfPropertyAt(Je,ct,"fill"),ee=this.getHeightOfChar(Je,ct),fe=this.getValueOfPropertyAt(Je,ct,"deltaY"),at&&he&&Ze)k.save(),k.fillStyle=nt,k.translate(Ae.renderLeft,Ae.renderTop),k.rotate(Ae.angle),k.fillRect(-Ae.kernedWidth/2,dt*ee+fe,Ae.kernedWidth,this.fontSize/15),k.restore();else if((he!==Pe||Ze!==nt||ee!==ie||fe!==le)&&ke>0){var ht=et+ne+je;"rtl"===this.direction&&(ht=this.width-ht-ke),Pe&&nt&&(k.fillStyle=nt,k.fillRect(ht,De+dt*ie+le,ke,this.fontSize/15)),je=Ae.left,ke=Ae.width,Pe=he,nt=Ze,ie=ee,le=fe}else ke+=Ae.kernedWidth;ht=et+ne+je,"rtl"===this.direction&&(ht=this.width-ht-ke),k.fillStyle=Ze,he&&Ze&&k.fillRect(ht,De+dt*ie+le,ke-vt,this.fontSize/15),Qe+=$}else Qe+=$;this._removeShadow(k)}},_getFontDeclaration:function(k,N){var $=k||this,ie=this.fontFamily,ee=L.Text.genericFonts.indexOf(ie.toLowerCase())>-1,ne=void 0===ie||ie.indexOf("'")>-1||ie.indexOf(",")>-1||ie.indexOf('"')>-1||ee?$.fontFamily:'"'+$.fontFamily+'"';return[L.isLikelyNode?$.fontWeight:$.fontStyle,L.isLikelyNode?$.fontStyle:$.fontWeight,N?this.CACHE_FONT_SIZE+"px":$.fontSize+"px",ne].join(" ")},render:function(k){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",k)))},_splitTextIntoLines:function(k){for(var N=k.split(this._reNewline),$=new Array(N.length),ie=["\n"],ee=[],ne=0;ne<N.length;ne++)$[ne]=L.util.string.graphemeSplit(N[ne]),ee=ee.concat($[ne],ie);return ee.pop(),{_unwrappedLines:$,lines:N,graphemeText:ee,graphemeLines:$}},toObject:function(k){var N=q.concat(k),$=this.callSuper("toObject",N);return $.styles=Y(this.styles,!0),$.path&&($.path=this.path.toObject()),$},set:function(k,N){this.callSuper("set",k,N);var $=!1,ie=!1;if("object"==typeof k)for(var ee in k)"path"===ee&&this.setPathInfo(),$=$||-1!==this._dimensionAffectingProps.indexOf(ee),ie=ie||"path"===ee;else $=-1!==this._dimensionAffectingProps.indexOf(k),ie="path"===k;return ie&&this.setPathInfo(),$&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),L.Text.ATTRIBUTE_NAMES=L.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),L.Text.DEFAULT_SVG_FONT_SIZE=16,L.Text.fromElement=function(k,N,$){if(!k)return N(null);var ie=L.parseAttributes(k,L.Text.ATTRIBUTE_NAMES),ee=ie.textAnchor||"left";if(($=L.util.object.extend($?Y($):{},ie)).top=$.top||0,$.left=$.left||0,ie.textDecoration){var ne=ie.textDecoration;-1!==ne.indexOf("underline")&&($.underline=!0),-1!==ne.indexOf("overline")&&($.overline=!0),-1!==ne.indexOf("line-through")&&($.linethrough=!0),delete $.textDecoration}"dx"in ie&&($.left+=ie.dx),"dy"in ie&&($.top+=ie.dy),"fontSize"in $||($.fontSize=L.Text.DEFAULT_SVG_FONT_SIZE);var le="";"textContent"in k?le=k.textContent:"firstChild"in k&&null!==k.firstChild&&"data"in k.firstChild&&null!==k.firstChild.data&&(le=k.firstChild.data),le=le.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var fe=$.strokeWidth;$.strokeWidth=0;var xe=new L.Text(le,$),Pe=xe.getScaledHeight()/xe.height,De=((xe.height+xe.strokeWidth)*xe.lineHeight-xe.height)*Pe,je=xe.getScaledHeight()+De,ke=0;"center"===ee&&(ke=xe.getScaledWidth()/2),"right"===ee&&(ke=xe.getScaledWidth()),xe.set({left:xe.left-ke,top:xe.top-(je-xe.fontSize*(.07+xe._fontSizeFraction))/xe.lineHeight,strokeWidth:void 0!==fe?fe:1}),N(xe)},L.Text.fromObject=function(k,N){var $=Y(k),ie=k.path;return delete $.path,L.Object._fromObject("Text",$,function(ee){ie?L.Object._fromObject("Path",ie,function(ne){ee.set("path",ne),N(ee)},"path"):N(ee)},"text")},L.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],L.util.createAccessors&&L.util.createAccessors(L.Text)}}(n),te.util.object.extend(te.Text.prototype,{isEmptyStyles:function(j){if(!this.styles||void 0!==j&&!this.styles[j])return!0;var L=void 0===j?this.styles:{line:this.styles[j]};for(var Y in L)for(var q in L[Y])for(var k in L[Y][q])return!1;return!0},styleHas:function(j,L){if(!this.styles||!j||""===j||void 0!==L&&!this.styles[L])return!1;var Y=void 0===L?this.styles:{0:this.styles[L]};for(var q in Y)for(var k in Y[q])if(void 0!==Y[q][k][j])return!0;return!1},cleanStyle:function(j){if(!this.styles||!j||""===j)return!1;var L,Y,q=this.styles,k=0,N=!0,$=0;for(var ie in q){for(var ee in L=0,q[ie]){var ne;k++,(ne=q[ie][ee]).hasOwnProperty(j)?(Y?ne[j]!==Y&&(N=!1):Y=ne[j],ne[j]===this[j]&&delete ne[j]):N=!1,0!==Object.keys(ne).length?L++:delete q[ie][ee]}0===L&&delete q[ie]}for(var le=0;le<this._textLines.length;le++)$+=this._textLines[le].length;N&&k===$&&(this[j]=Y,this.removeStyle(j))},removeStyle:function(j){if(this.styles&&j&&""!==j){var L,Y,q,k=this.styles;for(Y in k){for(q in L=k[Y])delete L[q][j],0===Object.keys(L[q]).length&&delete L[q];0===Object.keys(L).length&&delete k[Y]}}},_extendStyles:function(j,L){var Y=this.get2DCursorLocation(j);this._getLineStyle(Y.lineIndex)||this._setLineStyle(Y.lineIndex),this._getStyleDeclaration(Y.lineIndex,Y.charIndex)||this._setStyleDeclaration(Y.lineIndex,Y.charIndex,{}),te.util.object.extend(this._getStyleDeclaration(Y.lineIndex,Y.charIndex),L)},get2DCursorLocation:function(j,L){void 0===j&&(j=this.selectionStart);for(var Y=L?this._unwrappedTextLines:this._textLines,q=Y.length,k=0;k<q;k++){if(j<=Y[k].length)return{lineIndex:k,charIndex:j};j-=Y[k].length+this.missingNewlineOffset(k)}return{lineIndex:k-1,charIndex:Y[k-1].length<j?Y[k-1].length:j}},getSelectionStyles:function(j,L,Y){void 0===j&&(j=this.selectionStart||0),void 0===L&&(L=this.selectionEnd||j);for(var q=[],k=j;k<L;k++)q.push(this.getStyleAtPosition(k,Y));return q},getStyleAtPosition:function(j,L){var Y=this.get2DCursorLocation(j);return(L?this.getCompleteStyleDeclaration(Y.lineIndex,Y.charIndex):this._getStyleDeclaration(Y.lineIndex,Y.charIndex))||{}},setSelectionStyles:function(j,L,Y){void 0===L&&(L=this.selectionStart||0),void 0===Y&&(Y=this.selectionEnd||L);for(var q=L;q<Y;q++)this._extendStyles(q,j);return this._forceClearCache=!0,this},_getStyleDeclaration:function(j,L){var Y=this.styles&&this.styles[j];return Y?Y[L]:null},getCompleteStyleDeclaration:function(j,L){for(var Y,q=this._getStyleDeclaration(j,L)||{},k={},N=0;N<this._styleProperties.length;N++)k[Y=this._styleProperties[N]]=void 0===q[Y]?this[Y]:q[Y];return k},_setStyleDeclaration:function(j,L,Y){this.styles[j][L]=Y},_deleteStyleDeclaration:function(j,L){delete this.styles[j][L]},_getLineStyle:function(j){return!!this.styles[j]},_setLineStyle:function(j){this.styles[j]={}},_deleteLineStyle:function(j){delete this.styles[j]}}),function(){function j(L){L.textDecoration&&(L.textDecoration.indexOf("underline")>-1&&(L.underline=!0),L.textDecoration.indexOf("line-through")>-1&&(L.linethrough=!0),L.textDecoration.indexOf("overline")>-1&&(L.overline=!0),delete L.textDecoration)}te.IText=te.util.createClass(te.Text,te.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(L,Y){this.callSuper("initialize",L,Y),this.initBehavior()},setSelectionStart:function(L){L=Math.max(L,0),this._updateAndFire("selectionStart",L)},setSelectionEnd:function(L){L=Math.min(L,this.text.length),this._updateAndFire("selectionEnd",L)},_updateAndFire:function(L,Y){this[L]!==Y&&(this._fireSelectionChanged(),this[L]=Y),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(L){this.clearContextTop(),this.callSuper("render",L),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(L){this.callSuper("_render",L)},clearContextTop:function(L){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var Y=this.canvas.contextTop,q=this.canvas.viewportTransform;Y.save(),Y.transform(q[0],q[1],q[2],q[3],q[4],q[5]),this.transform(Y),this._clearTextArea(Y),L||Y.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var L=this._getCursorBoundaries(),Y=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(L,Y):this.renderSelection(L,Y),Y.restore()}},_clearTextArea:function(L){var Y=this.width+4,q=this.height+4;L.clearRect(-Y/2,-q/2,Y,q)},_getCursorBoundaries:function(L){void 0===L&&(L=this.selectionStart);var Y=this._getLeftOffset(),q=this._getTopOffset(),k=this._getCursorBoundariesOffsets(L);return{left:Y,top:q,leftOffset:k.left,topOffset:k.top}},_getCursorBoundariesOffsets:function(L){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var Y,q,k,N,$=0,ie=0,ee=this.get2DCursorLocation(L);k=ee.charIndex,q=ee.lineIndex;for(var ne=0;ne<q;ne++)$+=this.getHeightOfLine(ne);Y=this._getLineLeftOffset(q);var le=this.__charBounds[q][k];return le&&(ie=le.left),0!==this.charSpacing&&k===this._textLines[q].length&&(ie-=this._getWidthOfCharSpacing()),N={top:$,left:Y+(ie>0?ie:0)},"rtl"===this.direction&&(N.left*=-1),this.cursorOffsetCache=N,this.cursorOffsetCache},renderCursor:function(L,Y){var q=this.get2DCursorLocation(),k=q.lineIndex,N=q.charIndex>0?q.charIndex-1:0,$=this.getValueOfPropertyAt(k,N,"fontSize"),ie=this.scaleX*this.canvas.getZoom(),ee=this.cursorWidth/ie,ne=L.topOffset,le=this.getValueOfPropertyAt(k,N,"deltaY");ne+=(1-this._fontSizeFraction)*this.getHeightOfLine(k)/this.lineHeight-$*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(L,Y),Y.fillStyle=this.cursorColor||this.getValueOfPropertyAt(k,N,"fill"),Y.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,Y.fillRect(L.left+L.leftOffset-ee/2,ne+L.top+le,ee,$)},renderSelection:function(L,Y){for(var q=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,k=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,N=-1!==this.textAlign.indexOf("justify"),$=this.get2DCursorLocation(q),ie=this.get2DCursorLocation(k),ee=$.lineIndex,ne=ie.lineIndex,le=$.charIndex<0?0:$.charIndex,fe=ie.charIndex<0?0:ie.charIndex,xe=ee;xe<=ne;xe++){var Pe,De=this._getLineLeftOffset(xe)||0,je=this.getHeightOfLine(xe),ke=0,Ae=0;if(xe===ee&&(ke=this.__charBounds[ee][le].left),xe>=ee&&xe<ne)Ae=N&&!this.isEndOfWrapping(xe)?this.width:this.getLineWidth(xe)||5;else if(xe===ne)if(0===fe)Ae=this.__charBounds[ne][fe].left;else{var he=this._getWidthOfCharSpacing();Ae=this.__charBounds[ne][fe-1].left+this.__charBounds[ne][fe-1].width-he}Pe=je,(this.lineHeight<1||xe===ne&&this.lineHeight>1)&&(je/=this.lineHeight);var tt=L.left+De+ke,Ze=Ae-ke,nt=je,et=0;this.inCompositionMode?(Y.fillStyle=this.compositionColor||"black",nt=1,et=je):Y.fillStyle=this.selectionColor,"rtl"===this.direction&&(tt=this.width-tt-Ze),Y.fillRect(tt,L.top+L.topOffset+et,Ze,nt),L.topOffset+=Pe}},getCurrentCharFontSize:function(){var L=this._getCurrentCharIndex();return this.getValueOfPropertyAt(L.l,L.c,"fontSize")},getCurrentCharColor:function(){var L=this._getCurrentCharIndex();return this.getValueOfPropertyAt(L.l,L.c,"fill")},_getCurrentCharIndex:function(){var L=this.get2DCursorLocation(this.selectionStart,!0);return{l:L.lineIndex,c:L.charIndex>0?L.charIndex-1:0}}}),te.IText.fromObject=function(L,Y){if(j(L),L.styles)for(var q in L.styles)for(var k in L.styles[q])j(L.styles[q][k]);te.Object._fromObject("IText",L,Y,"text")}}(),Ve=te.util.object.clone,te.util.object.extend(te.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var j=this;this.on("added",function(){var L=j.canvas;L&&(L._hasITextHandlers||(L._hasITextHandlers=!0,j._initCanvasHandlers(L)),L._iTextInstances=L._iTextInstances||[],L._iTextInstances.push(j))})},initRemovedHandler:function(){var j=this;this.on("removed",function(){var L=j.canvas;L&&(L._iTextInstances=L._iTextInstances||[],te.util.removeFromArray(L._iTextInstances,j),0===L._iTextInstances.length&&(L._hasITextHandlers=!1,j._removeCanvasHandlers(L)))})},_initCanvasHandlers:function(j){j._mouseUpITextHandler=function(){j._iTextInstances&&j._iTextInstances.forEach(function(L){L.__isMousedown=!1})},j.on("mouse:up",j._mouseUpITextHandler)},_removeCanvasHandlers:function(j){j.off("mouse:up",j._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(j,L,Y,q){var k;return k={isAborted:!1,abort:function(){this.isAborted=!0}},j.animate("_currentCursorOpacity",L,{duration:Y,onComplete:function(){k.isAborted||j[q]()},onChange:function(){j.canvas&&j.selectionStart===j.selectionEnd&&j.renderCursorOrSelection()},abort:function(){return k.isAborted}}),k},_onTickComplete:function(){var j=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){j._currentTickCompleteState=j._animateCursor(j,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(j){var L=this,Y=j?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){L._tick()},Y)},abortCursorAnimation:function(){var j=this._currentTickState||this._currentTickCompleteState,L=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,j&&L&&L.clearContext(L.contextTop||L.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(j){var L=0,Y=j-1;if(this._reSpace.test(this._text[Y]))for(;this._reSpace.test(this._text[Y]);)L++,Y--;for(;/\S/.test(this._text[Y])&&Y>-1;)L++,Y--;return j-L},findWordBoundaryRight:function(j){var L=0,Y=j;if(this._reSpace.test(this._text[Y]))for(;this._reSpace.test(this._text[Y]);)L++,Y++;for(;/\S/.test(this._text[Y])&&Y<this._text.length;)L++,Y++;return j+L},findLineBoundaryLeft:function(j){for(var L=0,Y=j-1;!/\n/.test(this._text[Y])&&Y>-1;)L++,Y--;return j-L},findLineBoundaryRight:function(j){for(var L=0,Y=j;!/\n/.test(this._text[Y])&&Y<this._text.length;)L++,Y++;return j+L},searchWordBoundary:function(j,L){for(var Y=this._text,q=this._reSpace.test(Y[j])?j-1:j,k=Y[q],N=te.reNonWord;!N.test(k)&&q>0&&q<Y.length;)k=Y[q+=L];return N.test(k)&&(q+=1===L?0:1),q},selectWord:function(j){var L=this.searchWordBoundary(j=j||this.selectionStart,-1),Y=this.searchWordBoundary(j,1);this.selectionStart=L,this.selectionEnd=Y,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(j){var L=this.findLineBoundaryLeft(j=j||this.selectionStart),Y=this.findLineBoundaryRight(j);return this.selectionStart=L,this.selectionEnd=Y,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(j){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(j),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(j){j._iTextInstances&&j._iTextInstances.forEach(function(L){L.selected=!1,L.isEditing&&L.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(j){if(this.__isMousedown&&this.isEditing){var L=this.getSelectionStartFromPointer(j.e),Y=this.selectionStart,q=this.selectionEnd;(L===this.__selectionStartOnMouseDown&&Y!==q||Y!==L&&q!==L)&&(L>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=L):(this.selectionStart=L,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===Y&&this.selectionEnd===q||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(j,L,Y){var q=Y.slice(0,j),k=te.util.string.graphemeSplit(q).length;if(j===L)return{selectionStart:k,selectionEnd:k};var N=Y.slice(j,L);return{selectionStart:k,selectionEnd:k+te.util.string.graphemeSplit(N).length}},fromGraphemeToStringSelection:function(j,L,Y){var q=Y.slice(0,j).join("").length;return j===L?{selectionStart:q,selectionEnd:q}:{selectionStart:q,selectionEnd:q+Y.slice(j,L).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var j=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=j.selectionStart,this.hiddenTextarea.selectionEnd=j.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var j=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=j.selectionEnd,this.inCompositionMode||(this.selectionStart=j.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var j=this._calcTextareaPosition();this.hiddenTextarea.style.left=j.left,this.hiddenTextarea.style.top=j.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var j=this.inCompositionMode?this.compositionStart:this.selectionStart,L=this._getCursorBoundaries(j),Y=this.get2DCursorLocation(j),N=this.getValueOfPropertyAt(Y.lineIndex,Y.charIndex,"fontSize")*this.lineHeight,$=L.leftOffset,ie=this.calcTransformMatrix(),ee={x:L.left+$,y:L.top+L.topOffset+N},ne=this.canvas.getRetinaScaling(),le=this.canvas.upperCanvasEl,fe=le.width/ne,xe=le.height/ne,Pe=fe-N,De=xe-N,je=le.clientWidth/fe,ke=le.clientHeight/xe;return ee=te.util.transformPoint(ee,ie),(ee=te.util.transformPoint(ee,this.canvas.viewportTransform)).x*=je,ee.y*=ke,ee.x<0&&(ee.x=0),ee.x>Pe&&(ee.x=Pe),ee.y<0&&(ee.y=0),ee.y>De&&(ee.y=De),ee.x+=this.canvas._offset.left,ee.y+=this.canvas._offset.top,{left:ee.x+"px",top:ee.y+"px",fontSize:N+"px",charHeight:N}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var j=this._textBeforeEdit!==this.text,L=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,L&&(L.blur&&L.blur(),L.parentNode&&L.parentNode.removeChild(L)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),j&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),j&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var j in this.styles)this._textLines[j]||delete this.styles[j]},removeStyleFromTo:function(j,L){var Y,q,k=this.get2DCursorLocation(j,!0),N=this.get2DCursorLocation(L,!0),$=k.lineIndex,ie=k.charIndex,ee=N.lineIndex,ne=N.charIndex;if($!==ee){if(this.styles[$])for(Y=ie;Y<this._unwrappedTextLines[$].length;Y++)delete this.styles[$][Y];if(this.styles[ee])for(Y=ne;Y<this._unwrappedTextLines[ee].length;Y++)(q=this.styles[ee][Y])&&(this.styles[$]||(this.styles[$]={}),this.styles[$][ie+Y-ne]=q);for(Y=$+1;Y<=ee;Y++)delete this.styles[Y];this.shiftLineStyles(ee,$-ee)}else if(this.styles[$]){q=this.styles[$];var le,fe,xe=ne-ie;for(Y=ie;Y<ne;Y++)delete q[Y];for(fe in this.styles[$])(le=parseInt(fe,10))>=ne&&(q[le-xe]=q[fe],delete q[fe])}},shiftLineStyles:function(j,L){var Y=Ve(this.styles);for(var q in this.styles){var k=parseInt(q,10);k>j&&(this.styles[k+L]=Y[k],Y[k-L]||delete this.styles[k])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(j,L,Y,q){var k,N={},$=!1,ie=this._unwrappedTextLines[j].length===L;for(var ee in Y||(Y=1),this.shiftLineStyles(j,Y),this.styles[j]&&(k=this.styles[j][0===L?L:L-1]),this.styles[j]){var ne=parseInt(ee,10);ne>=L&&($=!0,N[ne-L]=this.styles[j][ee],ie&&0===L||delete this.styles[j][ee])}var le=!1;for($&&!ie&&(this.styles[j+Y]=N,le=!0),le&&Y--;Y>0;)q&&q[Y-1]?this.styles[j+Y]={0:Ve(q[Y-1])}:k?this.styles[j+Y]={0:Ve(k)}:delete this.styles[j+Y],Y--;this._forceClearCache=!0},insertCharStyleObject:function(j,L,Y,q){this.styles||(this.styles={});var k=this.styles[j],N=k?Ve(k):{};for(var $ in Y||(Y=1),N){var ie=parseInt($,10);ie>=L&&(k[ie+Y]=N[ie],N[ie-Y]||delete k[ie])}if(this._forceClearCache=!0,q)for(;Y--;)Object.keys(q[Y]).length&&(this.styles[j]||(this.styles[j]={}),this.styles[j][L+Y]=Ve(q[Y]));else if(k)for(var ee=k[L?L-1:1];ee&&Y--;)this.styles[j][L+Y]=Ve(ee)},insertNewStyleBlock:function(j,L,Y){for(var q=this.get2DCursorLocation(L,!0),k=[0],N=0,$=0;$<j.length;$++)"\n"===j[$]?k[++N]=0:k[N]++;for(k[0]>0&&(this.insertCharStyleObject(q.lineIndex,q.charIndex,k[0],Y),Y=Y&&Y.slice(k[0]+1)),N&&this.insertNewlineStyleObject(q.lineIndex,q.charIndex+k[0],N),$=1;$<N;$++)k[$]>0?this.insertCharStyleObject(q.lineIndex+$,0,k[$],Y):Y&&this.styles[q.lineIndex+$]&&Y[0]&&(this.styles[q.lineIndex+$][0]=Y[0]),Y=Y&&Y.slice(k[$]+1);k[$]>0&&this.insertCharStyleObject(q.lineIndex+$,0,k[$],Y)},setSelectionStartEndWithShift:function(j,L,Y){Y<=j?(L===j?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=j),this.selectionStart=Y):Y>j&&Y<L?"right"===this._selectionDirection?this.selectionEnd=Y:this.selectionStart=Y:(L===j?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=L),this.selectionEnd=Y)},setSelectionInBoundaries:function(){var j=this.text.length;this.selectionStart>j?this.selectionStart=j:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>j?this.selectionEnd=j:this.selectionEnd<0&&(this.selectionEnd=0)}}),te.util.object.extend(te.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(j){if(this.canvas){this.__newClickTime=+new Date;var L=j.pointer;this.isTripleClick(L)&&(this.fire("tripleclick",j),this._stopEvent(j.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=L,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(j){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===j.x&&this.__lastPointer.y===j.y},_stopEvent:function(j){j.preventDefault&&j.preventDefault(),j.stopPropagation&&j.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(j){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(j.e))},tripleClickHandler:function(j){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(j.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(j){!this.canvas||!this.editable||j.e.button&&1!==j.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(j.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(j){!this.canvas||!this.editable||j.e.button&&1!==j.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(j){if(this.__isMousedown=!1,!(!this.editable||this.group||j.transform&&j.transform.actionPerformed||j.e.button&&1!==j.e.button)){if(this.canvas){var L=this.canvas._activeObject;if(L&&L!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(j.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(j){var L=this.getSelectionStartFromPointer(j);j.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,L):(this.selectionStart=L,this.selectionEnd=L),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(j){for(var L,Y=this.getLocalPointer(j),q=0,k=0,N=0,$=0,ie=0,ee=0,ne=this._textLines.length;ee<ne&&N<=Y.y;ee++)N+=this.getHeightOfLine(ee)*this.scaleY,ie=ee,ee>0&&($+=this._textLines[ee-1].length+this.missingNewlineOffset(ee-1));k=this._getLineLeftOffset(ie)*this.scaleX,L=this._textLines[ie],"rtl"===this.direction&&(Y.x=this.width*this.scaleX-Y.x+k);for(var le=0,fe=L.length;le<fe&&(q=k,(k+=this.__charBounds[ie][le].kernedWidth*this.scaleX)<=Y.x);le++)$++;return this._getNewSelectionStartFromOffset(Y,q,k,$,fe)},_getNewSelectionStartFromOffset:function(j,L,Y,q,k){var $=Y-j.x,ie=q+($>j.x-L||$<0?0:1);return this.flipX&&(ie=k-ie),ie>this._text.length&&(ie=this._text.length),ie}}),te.util.object.extend(te.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=te.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var j=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+j.top+"; left: "+j.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+j.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):te.document.body.appendChild(this.hiddenTextarea),te.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),te.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),te.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),te.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),te.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),te.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),te.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),te.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),te.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(te.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(j){if(this.isEditing){var L="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(j.keyCode in L)this[L[j.keyCode]](j);else{if(!(j.keyCode in this.ctrlKeysMapDown)||!j.ctrlKey&&!j.metaKey)return;this[this.ctrlKeysMapDown[j.keyCode]](j)}j.stopImmediatePropagation(),j.preventDefault(),j.keyCode>=33&&j.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(j){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:j.keyCode in this.ctrlKeysMapUp&&(j.ctrlKey||j.metaKey)&&(this[this.ctrlKeysMapUp[j.keyCode]](j),j.stopImmediatePropagation(),j.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(j){var L=this.fromPaste;if(this.fromPaste=!1,j&&j.stopPropagation(),this.isEditing){var Y,q,k,N,$,ie=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,ee=this._text.length,ne=ie.length,le=ne-ee,fe=this.selectionStart,xe=this.selectionEnd,Pe=fe!==xe;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var De=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),je=fe>De.selectionStart;Pe?(Y=this._text.slice(fe,xe),le+=xe-fe):ne<ee&&(Y=je?this._text.slice(xe+le,xe):this._text.slice(fe,fe-le)),q=ie.slice(De.selectionEnd-le,De.selectionEnd),Y&&Y.length&&(q.length&&(k=this.getSelectionStyles(fe,fe+1,!1),k=q.map(function(){return k[0]})),Pe?(N=fe,$=xe):je?(N=xe-Y.length,$=xe):(N=xe,$=xe+Y.length),this.removeStyleFromTo(N,$)),q.length&&(L&&q.join("")===te.copiedText&&!te.disableStyleCopyPaste&&(k=te.copiedTextStyle),this.insertNewStyleBlock(q,fe,k)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(j){this.compositionStart=j.target.selectionStart,this.compositionEnd=j.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(te.copiedText=this.getSelectedText(),te.copiedTextStyle=te.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(j){return j&&j.clipboardData||te.window.clipboardData},_getWidthBeforeCursor:function(j,L){var Y,q=this._getLineLeftOffset(j);return L>0&&(q+=(Y=this.__charBounds[j][L-1]).left+Y.width),q},getDownCursorOffset:function(j,L){var Y=this._getSelectionForOffset(j,L),q=this.get2DCursorLocation(Y),k=q.lineIndex;if(k===this._textLines.length-1||j.metaKey||34===j.keyCode)return this._text.length-Y;var N=q.charIndex,$=this._getWidthBeforeCursor(k,N),ie=this._getIndexOnLine(k+1,$);return this._textLines[k].slice(N).length+ie+1+this.missingNewlineOffset(k)},_getSelectionForOffset:function(j,L){return j.shiftKey&&this.selectionStart!==this.selectionEnd&&L?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(j,L){var Y=this._getSelectionForOffset(j,L),q=this.get2DCursorLocation(Y),k=q.lineIndex;if(0===k||j.metaKey||33===j.keyCode)return-Y;var N=q.charIndex,$=this._getWidthBeforeCursor(k,N),ie=this._getIndexOnLine(k-1,$),ee=this._textLines[k].slice(0,N),ne=this.missingNewlineOffset(k-1);return-this._textLines[k-1].length+ie-ee.length+(1-ne)},_getIndexOnLine:function(j,L){for(var Y,q,k=this._textLines[j],N=this._getLineLeftOffset(j),$=0,ie=0,ee=k.length;ie<ee;ie++)if((N+=Y=this.__charBounds[j][ie].width)>L){q=!0;var le=N,fe=Math.abs(N-Y-L);$=Math.abs(le-L)<fe?ie:ie-1;break}return q||($=k.length-1),$},moveCursorDown:function(j){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",j)},moveCursorUp:function(j){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",j)},_moveCursorUpOrDown:function(j,L){var Y=this["get"+j+"CursorOffset"](L,"right"===this._selectionDirection);L.shiftKey?this.moveCursorWithShift(Y):this.moveCursorWithoutShift(Y),0!==Y&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(j){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+j:this.selectionEnd+j),0!==j},moveCursorWithoutShift:function(j){return j<0?(this.selectionStart+=j,this.selectionEnd=this.selectionStart):(this.selectionEnd+=j,this.selectionStart=this.selectionEnd),0!==j},moveCursorLeft:function(j){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",j)},_move:function(j,L,Y){var q;if(j.altKey)q=this["findWordBoundary"+Y](this[L]);else{if(!j.metaKey&&35!==j.keyCode&&36!==j.keyCode)return this[L]+="Left"===Y?-1:1,!0;q=this["findLineBoundary"+Y](this[L])}if(void 0!==typeof q&&this[L]!==q)return this[L]=q,!0},_moveLeft:function(j,L){return this._move(j,L,"Left")},_moveRight:function(j,L){return this._move(j,L,"Right")},moveCursorLeftWithoutShift:function(j){var L=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(L=this._moveLeft(j,"selectionStart")),this.selectionEnd=this.selectionStart,L},moveCursorLeftWithShift:function(j){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(j,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(j,"selectionStart")):void 0},moveCursorRight:function(j){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",j)},_moveCursorLeftOrRight:function(j,L){var Y="moveCursor"+j+"With";this._currentCursorOpacity=1,this[Y+=L.shiftKey?"Shift":"outShift"](L)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(j){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(j,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(j,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(j){var L=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(L=this._moveRight(j,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,L},removeChars:function(j,L){void 0===L&&(L=j+1),this.removeStyleFromTo(j,L),this._text.splice(j,L-j),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(j,L,Y,q){void 0===q&&(q=Y),q>Y&&this.removeStyleFromTo(Y,q);var k=te.util.string.graphemeSplit(j);this.insertNewStyleBlock(k,Y,L),this._text=[].concat(this._text.slice(0,Y),k,this._text.slice(q)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var j=te.util.toFixed,L=/  +/g;te.util.object.extend(te.Text.prototype,{_toSVG:function(){var Y=this._getSVGLeftTopOffsets(),q=this._getSVGTextAndBg(Y.textTop,Y.textLeft);return this._wrapSVGTextAndBg(q)},toSVG:function(Y){return this._createBaseSVGMarkup(this._toSVG(),{reviver:Y,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(Y){var q=this.getSvgTextDecoration(this);return[Y.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",q?'text-decoration="'+q+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",Y.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(Y,q){var k,N=[],$=[],ie=Y;this._setSVGBg($);for(var ee=0,ne=this._textLines.length;ee<ne;ee++)k=this._getLineLeftOffset(ee),(this.textBackgroundColor||this.styleHas("textBackgroundColor",ee))&&this._setSVGTextLineBg($,ee,q+k,ie),this._setSVGTextLineText(N,ee,q+k,ie),ie+=this.getHeightOfLine(ee);return{textSpans:N,textBgRects:$}},_createTextCharSpan:function(Y,q,k,N){var $=Y!==Y.trim()||Y.match(L),ie=this.getSvgSpanStyles(q,$),ee=ie?'style="'+ie+'"':"",ne=q.deltaY,le="",fe=te.Object.NUM_FRACTION_DIGITS;return ne&&(le=' dy="'+j(ne,fe)+'" '),['<tspan x="',j(k,fe),'" y="',j(N,fe),'" ',le,ee,">",te.util.string.escapeXml(Y),"</tspan>"].join("")},_setSVGTextLineText:function(Y,q,k,N){var $,ie,ee,ne,le,fe=this.getHeightOfLine(q),xe=-1!==this.textAlign.indexOf("justify"),Pe="",De=0,je=this._textLines[q];N+=fe*(1-this._fontSizeFraction)/this.lineHeight;for(var ke=0,Ae=je.length-1;ke<=Ae;ke++)le=ke===Ae||this.charSpacing,Pe+=je[ke],ee=this.__charBounds[q][ke],0===De?(k+=ee.kernedWidth-ee.width,De+=ee.width):De+=ee.kernedWidth,xe&&!le&&this._reSpaceAndTab.test(je[ke])&&(le=!0),le||($=$||this.getCompleteStyleDeclaration(q,ke),ie=this.getCompleteStyleDeclaration(q,ke+1),le=this._hasStyleChangedForSvg($,ie)),le&&(ne=this._getStyleDeclaration(q,ke)||{},Y.push(this._createTextCharSpan(Pe,ne,k,N)),Pe="",$=ie,k+=De,De=0)},_pushTextBgRect:function(Y,q,k,N,$,ie){var ee=te.Object.NUM_FRACTION_DIGITS;Y.push("\t\t<rect ",this._getFillAttributes(q),' x="',j(k,ee),'" y="',j(N,ee),'" width="',j($,ee),'" height="',j(ie,ee),'"></rect>\n')},_setSVGTextLineBg:function(Y,q,k,N){for(var $,ie,ee=this._textLines[q],ne=this.getHeightOfLine(q)/this.lineHeight,le=0,fe=0,xe=this.getValueOfPropertyAt(q,0,"textBackgroundColor"),Pe=0,De=ee.length;Pe<De;Pe++)$=this.__charBounds[q][Pe],(ie=this.getValueOfPropertyAt(q,Pe,"textBackgroundColor"))!==xe?(xe&&this._pushTextBgRect(Y,xe,k+fe,N,le,ne),fe=$.left,le=$.width,xe=ie):le+=$.kernedWidth;ie&&this._pushTextBgRect(Y,ie,k+fe,N,le,ne)},_getFillAttributes:function(Y){var q=Y&&"string"==typeof Y?new te.Color(Y):"";return q&&q.getSource()&&1!==q.getAlpha()?'opacity="'+q.getAlpha()+'" fill="'+q.setAlpha(1).toRgb()+'"':'fill="'+Y+'"'},_getSVGLineTopOffset:function(Y){for(var q,k=0,N=0;N<Y;N++)k+=this.getHeightOfLine(N);return q=this.getHeightOfLine(N),{lineTop:k,offset:(this._fontSizeMult-this._fontSizeFraction)*q/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(Y){return te.Object.prototype.getSvgStyles.call(this,Y)+" white-space: pre;"}})}(),function(j){var L=j.fabric||(j.fabric={});L.Textbox=L.util.createClass(L.IText,L.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:L.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(Y){for(var q=0,k=0,N=0,$={},ie=0;ie<Y.graphemeLines.length;ie++)"\n"===Y.graphemeText[N]&&ie>0?(k=0,N++,q++):!this.splitByGrapheme&&this._reSpaceAndTab.test(Y.graphemeText[N])&&ie>0&&(k++,N++),$[ie]={line:q,offset:k},N+=Y.graphemeLines[ie].length,k+=Y.graphemeLines[ie].length;return $},styleHas:function(Y,q){if(this._styleMap&&!this.isWrapping){var k=this._styleMap[q];k&&(q=k.line)}return L.Text.prototype.styleHas.call(this,Y,q)},isEmptyStyles:function(Y){if(!this.styles)return!0;var q,k,N=0,$=!1,ie=this._styleMap[Y],ee=this._styleMap[Y+1];for(var ne in ie&&(Y=ie.line,N=ie.offset),ee&&($=ee.line===Y,q=ee.offset),k=void 0===Y?this.styles:{line:this.styles[Y]})for(var le in k[ne])if(le>=N&&(!$||le<q))for(var fe in k[ne][le])return!1;return!0},_getStyleDeclaration:function(Y,q){if(this._styleMap&&!this.isWrapping){var k=this._styleMap[Y];if(!k)return null;Y=k.line,q=k.offset+q}return this.callSuper("_getStyleDeclaration",Y,q)},_setStyleDeclaration:function(Y,q,k){var N=this._styleMap[Y];this.styles[Y=N.line][q=N.offset+q]=k},_deleteStyleDeclaration:function(Y,q){var k=this._styleMap[Y];delete this.styles[Y=k.line][q=k.offset+q]},_getLineStyle:function(Y){return!!this.styles[this._styleMap[Y].line]},_setLineStyle:function(Y){this.styles[this._styleMap[Y].line]={}},_wrapText:function(Y,q){var k,N=[];for(this.isWrapping=!0,k=0;k<Y.length;k++)N=N.concat(this._wrapLine(Y[k],k,q));return this.isWrapping=!1,N},_measureWord:function(Y,q,k){var N,$=0;k=k||0;for(var ie=0,ee=Y.length;ie<ee;ie++)$+=this._getGraphemeBox(Y[ie],q,ie+k,N,!0).kernedWidth,N=Y[ie];return $},_wrapLine:function(Y,q,k,N){var $=0,ie=this.splitByGrapheme,ee=[],ne=[],le=ie?L.util.string.graphemeSplit(Y):Y.split(this._wordJoiners),fe="",xe=0,Pe=ie?"":" ",De=0,je=0,ke=0,Ae=!0,he=this._getWidthOfCharSpacing();N=N||0,0===le.length&&le.push([]),k-=N;for(var tt=0;tt<le.length;tt++)fe=ie?le[tt]:L.util.string.graphemeSplit(le[tt]),De=this._measureWord(fe,q,xe),xe+=fe.length,($+=je+De-he)>k&&!Ae?(ee.push(ne),ne=[],$=De,Ae=!0):$+=he,Ae||ie||ne.push(Pe),ne=ne.concat(fe),je=ie?0:this._measureWord([Pe],q,xe),xe++,Ae=!1,De>ke&&(ke=De);return tt&&ee.push(ne),ke+N>this.dynamicMinWidth&&(this.dynamicMinWidth=ke-he+N),ee},isEndOfWrapping:function(Y){return!this._styleMap[Y+1]||this._styleMap[Y+1].line!==this._styleMap[Y].line},missingNewlineOffset:function(Y){return this.splitByGrapheme?this.isEndOfWrapping(Y)?1:0:1},_splitTextIntoLines:function(Y){for(var q=L.Text.prototype._splitTextIntoLines.call(this,Y),k=this._wrapText(q.lines,this.width),N=new Array(k.length),$=0;$<k.length;$++)N[$]=k[$].join("");return q.lines=N,q.graphemeLines=k,q},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var Y={};for(var q in this._styleMap)this._textLines[q]&&(Y[this._styleMap[q].line]=1);for(var q in this.styles)Y[q]||delete this.styles[q]},toObject:function(Y){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(Y))}}),L.Textbox.fromObject=function(Y,q){return L.Object._fromObject("Textbox",Y,q,"text")}}(n),function(){var j=te.controlsUtils,L=j.scaleSkewCursorStyleHandler,Y=j.scaleCursorStyleHandler,q=j.scalingEqually,k=j.scalingYOrSkewingX,N=j.scalingXOrSkewingY,$=j.scaleOrSkewActionName,ie=te.Object.prototype.controls;if(ie.ml=new te.Control({x:-.5,y:0,cursorStyleHandler:L,actionHandler:N,getActionName:$}),ie.mr=new te.Control({x:.5,y:0,cursorStyleHandler:L,actionHandler:N,getActionName:$}),ie.mb=new te.Control({x:0,y:.5,cursorStyleHandler:L,actionHandler:k,getActionName:$}),ie.mt=new te.Control({x:0,y:-.5,cursorStyleHandler:L,actionHandler:k,getActionName:$}),ie.tl=new te.Control({x:-.5,y:-.5,cursorStyleHandler:Y,actionHandler:q}),ie.tr=new te.Control({x:.5,y:-.5,cursorStyleHandler:Y,actionHandler:q}),ie.bl=new te.Control({x:-.5,y:.5,cursorStyleHandler:Y,actionHandler:q}),ie.br=new te.Control({x:.5,y:.5,cursorStyleHandler:Y,actionHandler:q}),ie.mtr=new te.Control({x:0,y:-.5,actionHandler:j.rotationWithSnapping,cursorStyleHandler:j.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),te.Textbox){var ee=te.Textbox.prototype.controls={};ee.mtr=ie.mtr,ee.tr=ie.tr,ee.br=ie.br,ee.tl=ie.tl,ee.bl=ie.bl,ee.mt=ie.mt,ee.mb=ie.mb,ee.mr=new te.Control({x:.5,y:0,actionHandler:j.changeWidth,cursorStyleHandler:L,actionName:"resizing"}),ee.ml=new te.Control({x:-.5,y:0,actionHandler:j.changeWidth,cursorStyleHandler:L,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},sK={};function vv(p){var n=sK[p];if(void 0!==n)return n.exports;var o=sK[p]={exports:{}};return hEe[p](o,o.exports,vv),o.exports}vv.d=(p,n)=>{for(var o in n)vv.o(n,o)&&!vv.o(p,o)&&Object.defineProperty(p,o,{enumerable:!0,get:n[o]})},vv.o=(p,n)=>Object.prototype.hasOwnProperty.call(p,n);var aK={};(()=>{let p;vv.d(aK,{R:()=>p}),p="undefined"!=typeof document&&"undefined"!=typeof window?vv(653).fabric:{version:"5.2.1"}})();var Na,Vc,Dg,lK,Vi=aK.R;(function(p){p[p.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",p[p.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",p[p.DIMT_TEXT=4]="DIMT_TEXT",p[p.DIMT_ARC=8]="DIMT_ARC",p[p.DIMT_IMAGE=16]="DIMT_IMAGE",p[p.DIMT_POLYGON=32]="DIMT_POLYGON",p[p.DIMT_LINE=64]="DIMT_LINE",p[p.DIMT_GROUP=128]="DIMT_GROUP"})(Na||(Na={})),function(p){p[p.DIS_DEFAULT=1]="DIS_DEFAULT",p[p.DIS_SELECTED=2]="DIS_SELECTED"}(Vc||(Vc={})),function(p){p[p.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",p[p.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",p[p.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Dg||(Dg={})),function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(lK||(lK={}));const Hy=p=>"number"==typeof p&&!Number.isNaN(p),L4=p=>"string"==typeof p;var EI,ex,Gy,N4,Wh,DI;(function(p){p[p.ARC=0]="ARC",p[p.IMAGE=1]="IMAGE",p[p.LINE=2]="LINE",p[p.POLYGON=3]="POLYGON",p[p.QUAD=4]="QUAD",p[p.RECT=5]="RECT",p[p.TEXT=6]="TEXT",p[p.GROUP=7]="GROUP"})(Wh||(Wh={})),function(p){p[p.DEFAULT=0]="DEFAULT",p[p.SELECTED=1]="SELECTED"}(DI||(DI={}));class lc{get mediaType(){return new Map([["rect",Na.DIMT_RECTANGLE],["quad",Na.DIMT_QUADRILATERAL],["text",Na.DIMT_TEXT],["arc",Na.DIMT_ARC],["image",Na.DIMT_IMAGE],["polygon",Na.DIMT_POLYGON],["line",Na.DIMT_LINE],["group",Na.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(qe(this,ex,"f")){case Vc.DIS_DEFAULT:return"default";case Vc.DIS_SELECTED:return"selected"}}set drawingStyleId(n){this.styleId=n}get drawingStyleId(){return this.styleId}set coordinateBase(n){if(!["view","image"].includes(n))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===qe(this,Gy,"f")&&"view"===n?this.updateCoordinateBaseFromImageToView():"view"===qe(this,Gy,"f")&&"image"===n&&this.updateCoordinateBaseFromViewToImage()),Ln(this,Gy,n,"f")}get coordinateBase(){return qe(this,Gy,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(n,o){if(EI.add(this),ex.set(this,void 0),Gy.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=o&&!Hy(o))throw new TypeError("Invalid 'drawingStyleId'.");n&&this._setFabricObject(n),this.setState(Vc.DIS_DEFAULT),this.styleId=o}_setFabricObject(n){this._fabricObject=n,this._fabricObject.on("selected",()=>{this.setState(Vc.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Vc.DIS_SELECTED):this.setState(Vc.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),n.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(n){Ln(this,ex,n,"f")}getState(){return qe(this,ex,"f")}_on(n,o){if(!o)return;const h=n.toLowerCase(),v=this.mapEvent_Callbacks.get(h);if(!v)throw new Error(`Event '${n}' does not exist.`);let y=v.get(o);y||(y=_=>{const b=_.e;if(!b)return void(o&&o.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const w={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let I,A,M,F;const V=b.target.getBoundingClientRect();I=V.left,A=V.top,M=I+window.scrollX,F=A+window.scrollY;const{width:B,height:Q}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),J=this._drawingLayer.width,Z=this._drawingLayer.height,re=B/Q,se=J/Z,ce=this._drawingLayer._getObjectFit();let pe,Ce,Ve,te,Me=1;if("contain"===ce)re<se?(Me=B/J,pe=I+this.get("x")*Me,Ce=A+this.get("y")*Me+(Q-Z*Me)/2,Ve=M+this.get("x")*Me,te=F+this.get("y")*Me+(Q-Z*Me)/2):(Me=Q/Z,pe=I+this.get("x")*Me+(B-J*Me)/2,Ce=A+this.get("y")*Me,Ve=M+this.get("x")*Me+(B-J*Me)/2,te=F+this.get("y")*Me);else if("cover"===ce)if(re<se){Me=Q/Z;let we=this.get("x")*Me-(J*Me-B)/2;we=Math.max(we,0),we=Math.min(we,B),pe=I+we,Ce=A+this.get("y")*Me,Ve=M+we,te=F+this.get("y")*Me}else{Me=B/J;let we=this.get("y")*Me-(Z*Me-Q)/2;we=Math.max(we,0),we=Math.min(we,Q),pe=I+this.get("x")*Me,Ce=A+we,Ve=M+this.get("x")*Me,te=F+we}w.itemClientX=Math.round(pe),w.itemClientY=Math.round(Ce),w.itemPageX=Math.round(Ve),w.itemPageY=Math.round(te)}for(let I of Object.getOwnPropertyNames(w))Object.defineProperty(b,I,{value:w[I],writable:!0});o&&o.apply(this,[b])},v.set(o,y),this._fabricObject.on("dblclick"===h?"mousedblclick":h,y))}on(n,o){this._on(n,o)}_off(n,o){const h=n.toLowerCase(),v=this.mapEvent_Callbacks.get(h);if(!v)throw new Error(`Event '${n}' does not exist.`);let y=v.get(o);y&&(v.delete(o),this._fabricObject.off("dblclick"===h?"mousedblclick":h,y))}off(n,o){this._off(n,o)}_setEditable(n){const o=this._fabricObject;n?(o.selectable=!0,o.hasControls=!0,o.hoverCursor=null):(o.selectable=!1,o.hasControls=!1,o.hoverCursor="default")}hasNote(n){return this.mapNoteName_Content.has(n)}addNote(n,o){if(this.hasNote(n.name)&&!o)throw new Error("A note with the same name already exists, please use a different name.");const h=n.content?JSON.parse(JSON.stringify(n.content)):n.content;this.mapNoteName_Content.set(n.name,[h])}getNote(n){const o=this.mapNoteName_Content.get(n);return o?1===o.length?{name:n,content:o[0]?JSON.parse(JSON.stringify(o[0])):o[0]}:{name:n,content:JSON.parse(JSON.stringify(o))}:null}getNotes(){const n=[];for(let o of this.mapNoteName_Content){let h=1===o[1].length?o[1][0]:o[1];h=h&&JSON.parse(JSON.stringify(h)),n.push({name:o[0],content:h})}return n}updateNote(n,o,h){const v=this.mapNoteName_Content.get(n);if(!v)throw new Error("The note name does not exist.");h||(v.length=0),o=o&&JSON.parse(JSON.stringify(o)),v.push(o)}deleteNote(n){this.mapNoteName_Content.delete(n)}clearNotes(){this.mapNoteName_Content.clear()}set(n,o){if(!this.extendSet(n,o))if("x"===n){const h=this._fabricObject.group;h?(this._fabricObject.set("left",o-h.left-h.width/2),h.addWithUpdate()):this._fabricObject.set("left",o)}else if("y"===n){const h=this._fabricObject.group;h?(this._fabricObject.set("top",o-h.top-h.height/2),h.addWithUpdate()):this._fabricObject.set("top",o)}else"styleId"===n?this.styleId=o:this._fabricObject.set(n,o);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(n)&&this._fabricObject.setCoords()}get(n){let o=this.extendGet(n);if(void 0===o)if("x"===n){const h=this._fabricObject.group;o=h?this._fabricObject.get("left")+h.left+h.width/2:this._fabricObject.get("left")}else if("y"===n){const h=this._fabricObject.group;o=h?this._fabricObject.get("top")+h.top+h.height/2:this._fabricObject.get("top")}else o="scaledWidth"===n?this._fabricObject.getScaledWidth():"scaledHeight"===n?this._fabricObject.getScaledHeight():["type","mediaType"].includes(n)?this.mediaType:"state"===n?this.getState():"styleId"===n?this.styleId:"drawingLayerId"===n?this.drawingLayerId:this._fabricObject.get(n);return o}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(n){if("number"!=typeof n)throw new TypeError("Invalid value.");return n*qe(this,EI,"m",N4).call(this)}convertPropFromViewToImage(n){if("number"!=typeof n)throw new TypeError("Invalid value.");return n/qe(this,EI,"m",N4).call(this)}_setLineWidth(n){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(n));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",n)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(n){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(n));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",n)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}ex=new WeakMap,Gy=new WeakMap,EI=new WeakSet,N4=function(){const p=this._drawingLayer;if(!p)return 1;const n=p.width,o=p.height,{width:h,height:v}=p.fabricCanvas.wrapperEl.getBoundingClientRect();if(h<=0||v<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const y=h/n,_=v/o,b=p._getObjectFit();let w=1;return"contain"===b?w=y<_?h/n:v/o:"cover"===b&&(w=y<_?v/o:h/n),w},lc.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],lc.mapItemType=new Map([[Wh.ARC,"arc"],[Wh.IMAGE,"image"],[Wh.LINE,"line"],[Wh.POLYGON,"polygon"],[Wh.QUAD,"quad"],[Wh.RECT,"rect"],[Wh.TEXT,"text"],[Wh.GROUP,"group"]]),lc.arrStyleSelectors=["default","selected"],lc.mapItemState=new Map([[DI.DEFAULT,"default"],[DI.SELECTED,"selected"]]);const cK=p=>null!==p&&"object"==typeof p&&!Array.isArray(p),B4=p=>!!L4(p)&&""!==p,U4=p=>!(!jd(p)||!hs(p.left)||p.left<0||!hs(p.top)||p.top<0||!hs(p.right)||p.right<0||!hs(p.bottom)||p.bottom<0||p.left>=p.right||p.top>=p.bottom||!f4(p.isMeasuredInPercentage)),dK=p=>!!jd(p)&&!!h4(p.points)&&0!=p.points.length&&!p.points.some(n=>!Uy(n)),fEe=Uy,hK=p=>!!jd(p)&&!!h4(p.points)&&0!=p.points.length&&4==p.points.length&&!p.points.some(n=>!Uy(n)),ep=p=>!(!jd(p)||!hs(p.x)||!hs(p.y)||!hs(p.width)||p.width<0||!hs(p.height)||p.height<0||"isMeasuredInPercentage"in p&&!f4(p.isMeasuredInPercentage)),fK=p=>!(!cK(p)||"id"in p&&!Hy(p.id)||"lineWidth"in p&&!Hy(p.lineWidth)||"fillStyle"in p&&!B4(p.fillStyle)||"strokeStyle"in p&&!B4(p.strokeStyle)||"paintMode"in p&&!["fill","stroke","strokeAndFill"].includes(p.paintMode)||"fontFamily"in p&&!B4(p.fontFamily)||"fontSize"in p&&!Hy(p.fontSize));class AI{static convert(n,o,h){const v={x:0,y:0,width:o,height:h};if(!n)return v;if(ep(n))n.isMeasuredInPercentage?(v.x=n.x/100*o,v.y=n.y/100*h,v.width=n.width/100*o,v.height=n.height/100*h):(v.x=n.x,v.y=n.y,v.width=n.width,v.height=n.height);else{if(!U4(n))throw TypeError("Invalid region.");n.isMeasuredInPercentage?(v.x=n.left/100*o,v.y=n.top/100*h,v.width=(n.right-n.left)/100*o,v.height=(n.bottom-n.top)/100*h):(v.x=n.left,v.y=n.top,v.width=n.right-n.left,v.height=n.bottom-n.top)}return v.x=Math.round(v.x),v.y=Math.round(v.y),v.width=Math.round(v.width),v.height=Math.round(v.height),v}}var yv,PI;class pK{constructor(){yv.set(this,new Map),PI.set(this,!1)}get disposed(){return qe(this,PI,"f")}on(n,o){n=n.toLowerCase();const h=qe(this,yv,"f").get(n);if(h){if(h.includes(o))return;h.push(o)}else qe(this,yv,"f").set(n,[o])}off(n,o){n=n.toLowerCase();const h=qe(this,yv,"f").get(n);if(!h)return;const v=h.indexOf(o);-1!==v&&h.splice(v,1)}offAll(n){n=n.toLowerCase();const o=qe(this,yv,"f").get(n);o&&(o.length=0)}fire(n,o=[],h={async:!1,copy:!0}){o||(o=[]),n=n.toLowerCase();const v=qe(this,yv,"f").get(n);if(v&&v.length){h=Object.assign({async:!1,copy:!0},h);for(let y of v){if(!y)continue;let _=[];if(h.copy)for(let w of o){try{w=JSON.parse(JSON.stringify(w))}catch(I){}_.push(w)}else _=o;let b=!1;if(h.async)setTimeout(()=>{this.disposed||v.includes(y)&&y.apply(h.target,_)},0);else try{b=y.apply(h.target,_)}catch(w){}if(!0===b)break}}}dispose(){Ln(this,PI,!0,"f")}}function pEe(p,n,o){return(o.x-p.x)*(n.y-p.y)==(n.x-p.x)*(o.y-p.y)&&Math.min(p.x,n.x)<=o.x&&o.x<=Math.max(p.x,n.x)&&Math.min(p.y,n.y)<=o.y&&o.y<=Math.max(p.y,n.y)}function V4(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function RI(p,n,o,h){let v=p[0]*(o[1]-n[1])+n[0]*(p[1]-o[1])+o[0]*(n[1]-p[1]),y=p[0]*(h[1]-n[1])+n[0]*(p[1]-h[1])+h[0]*(n[1]-p[1]);return!((v^y)>=0&&0!==v&&0!==y||(v=o[0]*(p[1]-h[1])+h[0]*(o[1]-p[1])+p[0]*(h[1]-o[1]),y=o[0]*(n[1]-h[1])+h[0]*(o[1]-n[1])+n[0]*(h[1]-o[1]),(v^y)>=0&&0!==v&&0!==y))}yv=new WeakMap,PI=new WeakMap;const gK=function(){var p=Fe(function*(n){if("string"!=typeof n)throw new TypeError("Invalid url.");const o=yield fetch(n);if(!o.ok)throw Error("Network Error: "+o.statusText);const h=yield o.text();if(!h.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const v=document.createElement("div");if(v.insertAdjacentHTML("beforeend",h),1===v.childElementCount&&v.firstChild instanceof HTMLTemplateElement)return v.firstChild.content;const y=new DocumentFragment;for(let _ of v.children)y.append(_);return y});return function(o){return p.apply(this,arguments)}}();var Ag,Pg,kg;class zy extends lc{constructor(n,o){if(super(null,o),Ag.set(this,void 0),!ep(n))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Vi.Rect({left:n.x,top:n.y,width:n.width,height:n.height})),Ln(this,Ag,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="rect"}extendSet(n,o){return!1}extendGet(n){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(n){this.setRect(n)}getPosition(){return this.getRect()}updatePosition(){qe(this,Ag,"f")&&this.setRect(qe(this,Ag,"f"))}setRect(n){if(!ep(n))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(n.x)),this.set("top",this.convertPropFromViewToImage(n.y)),this.set("width",this.convertPropFromViewToImage(n.width)),this.set("height",this.convertPropFromViewToImage(n.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",n.x),this.set("top",n.y),this.set("width",n.width),this.set("height",n.height)}this._drawingLayer.renderAll()}else Ln(this,Ag,JSON.parse(JSON.stringify(n)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return qe(this,Ag,"f")?JSON.parse(JSON.stringify(qe(this,Ag,"f"))):null}}function j4(p,n,o){return Vi.util.transformPoint({x:o.points[this.pointIndex].x-o.pathOffset.x,y:o.points[this.pointIndex].y-o.pathOffset.y},o.calcTransformMatrix())}function mK(p){let n=new Vi.Point(p.strokeUniform?1/p.scaleX:1,p.strokeUniform?1/p.scaleY:1).multiply(p.strokeWidth);return new Vi.Point(p.width+n.x,p.height+n.y)}function H4(p,n,o,h){let v=n.target,y=v.controls[v.__corner],_=v.toLocalPoint(new Vi.Point(o,h),"center","center"),b=mK(v),w=v._getTransformedDimensions(0,0);return v.points[y.pointIndex]={x:_.x*b.x/w.x+v.pathOffset.x,y:_.y*b.y/w.y+v.pathOffset.y},Vi.controlsUtils.fireEvent("scaling",{e:p,transform:n,pointer:{x:o,y:h}}),!0}function G4(p,n){return function(o,h,v,y){let _=h.target,b=Vi.util.transformPoint({x:_.points[p].x-_.pathOffset.x,y:_.points[p].y-_.pathOffset.y},_.calcTransformMatrix()),w=n(o,h,v,y);_._setPositionDimensions({});let I=mK(_);return _.setPositionByOrigin(b,(_.points[p].x-_.pathOffset.x)/I.x+.5,(_.points[p].y-_.pathOffset.y)/I.y+.5),w}}Ag=new WeakMap;class z4 extends lc{constructor(n,o){if(super(null,o),Pg.set(this,void 0),!dK(n))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Vi.Polygon(n.points,{objectCaching:!1}));const h=this._fabricObject;let v=h.points.length-1;h.controls=h.points.reduce(function(y,_,b){return y["p"+b]=new Vi.Control({positionHandler:j4,actionHandler:G4(b>0?b-1:v,H4),actionName:"modifyPolygon",pointIndex:b}),y},{}),Ln(this,Pg,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="polygon"}extendSet(n,o){if("vertices"===n){const h=this._fabricObject;if(h.group){const y=h.group;h.points=o.map(_=>({x:_.x-y.left-y.width/2,y:_.y-y.top-y.height/2})),y.addWithUpdate()}else h.points=o;const v=h.points.length-1;return h.controls=h.points.reduce(function(y,_,b){return y["p"+b]=new Vi.Control({positionHandler:j4,actionHandler:G4(b>0?b-1:v,H4),actionName:"modifyPolygon",pointIndex:b}),y},{}),h._setPositionDimensions({}),!0}}extendGet(n){if("vertices"===n){const o=[],h=this._fabricObject;if(h.selectable&&!h.group)for(let v in h.oCoords)o.push({x:h.oCoords[v].x,y:h.oCoords[v].y});else for(let v of h.points){const b=Vi.util.transformPoint({x:v.x-h.pathOffset.x,y:v.y-h.pathOffset.y},h.calcTransformMatrix());o.push({x:b.x,y:b.y})}return o}}updateCoordinateBaseFromImageToView(){const n=this.get("vertices").map(o=>({x:this.convertPropFromViewToImage(o.x),y:this.convertPropFromViewToImage(o.y)}));this.set("vertices",n)}updateCoordinateBaseFromViewToImage(){const n=this.get("vertices").map(o=>({x:this.convertPropFromImageToView(o.x),y:this.convertPropFromImageToView(o.y)}));this.set("vertices",n)}setPosition(n){this.setPolygon(n)}getPosition(){return this.getPolygon()}updatePosition(){qe(this,Pg,"f")&&this.setPolygon(qe(this,Pg,"f"))}setPolygon(n){if(!dK(n))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const o=n.points.map(h=>({x:this.convertPropFromViewToImage(h.x),y:this.convertPropFromViewToImage(h.y)}));this.set("vertices",o)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",n.points)}this._drawingLayer.renderAll()}else Ln(this,Pg,JSON.parse(JSON.stringify(n)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return qe(this,Pg,"f")?JSON.parse(JSON.stringify(qe(this,Pg,"f"))):null}}Pg=new WeakMap;const vK=p=>{let n=p.split("\n").map(h=>h.split("\t"));return(o=>{for(let h=0;;h++){let v=-1;for(let y=0;y<o.length;y++){let _=o[y][h];void 0!==_&&_.length>v&&(v=_.length)}if(-1===v)break;for(let y=0;y<o.length;y++){if(h>=o[y].length-1)continue;let _=" ".repeat(v+2-o[y][h].length);o[y][h]=o[y][h].concat(_)}}})(n),(o=>{let h="";for(let v=0;v<o.length;v++)h=h.concat(...o[v],v===o.length-1?"":"\n");return h})(n)};class gEe extends lc{constructor(n,o,h){if(super(null,h),kg.set(this,void 0),!L4(n))throw new TypeError("Invalid 'text'.");if(!ep(o))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Vi.Textbox(vK(n),{left:o.x,top:o.y,width:o.width})),this._text=n,Ln(this,kg,JSON.parse(JSON.stringify(o)),"f"),this._mediaType="text"}extendSet(n,o){if("text"===n)return this._text=o,this._fabricObject.set("text",vK(o)),!0}extendGet(n){if("text"===n)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(n){this.setTextRect(n)}getPosition(){return this.getTextRect()}updatePosition(){qe(this,kg,"f")&&this.setTextRect(qe(this,kg,"f"))}setText(n){if(!L4(n))throw new TypeError("Invalid 'text'.");this.set("text",n)}getText(){return this.get("text")}setTextRect(n){if(!ep(n))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(n.x)),this.set("top",this.convertPropFromViewToImage(n.y)),this.set("width",this.convertPropFromViewToImage(n.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",n.x),this.set("top",n.y),this.set("width",n.width)}this._drawingLayer.renderAll()}else Ln(this,kg,JSON.parse(JSON.stringify(n)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return qe(this,kg,"f")?JSON.parse(JSON.stringify(qe(this,kg,"f"))):null}}var Og,Fg,Yy,Y4,Xy,tx,$y,jc,nx,ix,rx,yK,_K,CK,bK,kI,Gr,ox,sx,ax,ca,MI,OI,FI,Lg,lx,cx,X4,Hc,LI,xK,$4,q4,ux,NI;kg=new WeakMap;class mEe extends z4{constructor(n,o){if(super({points:null==n?void 0:n.points},o),Og.set(this,void 0),!hK(n))throw new TypeError("Invalid 'quad'.");Ln(this,Og,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="quad"}setPosition(n){this.setQuad(n)}getPosition(){return this.getQuad()}updatePosition(){qe(this,Og,"f")&&this.setQuad(qe(this,Og,"f"))}setPolygon(){}getPolygon(){return null}setQuad(n){if(!hK(n))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const o=n.points.map(h=>({x:this.convertPropFromViewToImage(h.x),y:this.convertPropFromViewToImage(h.y)}));this.set("vertices",o)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",n.points)}this._drawingLayer.renderAll()}else Ln(this,Og,JSON.parse(JSON.stringify(n)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return qe(this,Og,"f")?JSON.parse(JSON.stringify(qe(this,Og,"f"))):null}}Og=new WeakMap;class vEe extends lc{constructor(n){super(new Vi.Group(n.map(o=>o._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Vc.DIS_SELECTED);const o=this._fabricObject._objects;for(let h of o)setTimeout(()=>{h&&h.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Vc.DIS_DEFAULT);const o=this._fabricObject._objects;for(let h of o)setTimeout(()=>{h&&h.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(n,o){return!1}extendGet(n){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(n=>n.getDrawingItem())}setChildDrawingItems(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,n,"add"):this._fabricObject.addWithUpdate(n._getFabricObject())}removeChildItem(n){n&&n.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,n,"remove"):this._fabricObject.removeWithUpdate(n._getFabricObject()))}}class un{static createDrawingStyle(n){if(!fK(n))throw new Error("Invalid style definition.");let o,h=un.USER_START_STYLE_ID;for(;qe(un,Fg,"f",Yy).has(h);)h++;o=h;const v=JSON.parse(JSON.stringify(n));v.id=o;for(let y in qe(un,Fg,"f",Y4))v.hasOwnProperty(y)||(v[y]=qe(un,Fg,"f",Y4)[y]);return qe(un,Fg,"f",Yy).set(o,v),v.id}static _getDrawingStyle(n,o){if("number"!=typeof n)throw new Error("Invalid style id.");const h=qe(un,Fg,"f",Yy).get(n);return h?o?JSON.parse(JSON.stringify(h)):h:null}static getDrawingStyle(n){return this._getDrawingStyle(n,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(qe(un,Fg,"f",Yy).values())))}static _updateDrawingStyle(n,o){if(!fK(o))throw new Error("Invalid style definition.");const h=qe(un,Fg,"f",Yy).get(n);if(h)for(let v in o)h.hasOwnProperty(v)&&(h[v]=o[v])}static updateDrawingStyle(n,o){this._updateDrawingStyle(n,o)}}Fg=un,un.STYLE_BLUE_STROKE=1,un.STYLE_GREEN_STROKE=2,un.STYLE_ORANGE_STROKE=3,un.STYLE_YELLOW_STROKE=4,un.STYLE_BLUE_STROKE_FILL=5,un.STYLE_GREEN_STROKE_FILL=6,un.STYLE_ORANGE_STROKE_FILL=7,un.STYLE_YELLOW_STROKE_FILL=8,un.STYLE_BLUE_STROKE_TRANSPARENT=9,un.STYLE_GREEN_STROKE_TRANSPARENT=10,un.STYLE_ORANGE_STROKE_TRANSPARENT=11,un.USER_START_STYLE_ID=1024,Yy={value:new Map([[un.STYLE_BLUE_STROKE,{id:un.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[un.STYLE_GREEN_STROKE,{id:un.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_ORANGE_STROKE,{id:un.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_YELLOW_STROKE,{id:un.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[un.STYLE_BLUE_STROKE_FILL,{id:un.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_GREEN_STROKE_FILL,{id:un.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_ORANGE_STROKE_FILL,{id:un.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_YELLOW_STROKE_FILL,{id:un.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_BLUE_STROKE_TRANSPARENT,{id:un.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_GREEN_STROKE_TRANSPARENT,{id:un.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[un.STYLE_ORANGE_STROKE_TRANSPARENT,{id:un.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},Y4={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(Vi.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Vi.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Vi.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Vi.Object.prototype.transparentCorners=!1,Vi.Object.prototype.cornerSize=20,Vi.Object.prototype.touchCornerSize=100,Vi.Object.prototype.cornerColor="rgb(254,142,20)",Vi.Object.prototype.cornerStyle="circle",Vi.Object.prototype.strokeUniform=!0,Vi.Object.prototype.hasBorders=!1,Vi.Canvas.prototype.containerClass="",Vi.Canvas.prototype.getPointer=function(p,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var o,h=this.upperCanvasEl,v=Vi.util.getPointer(p,h),y=h.getBoundingClientRect(),_=y.width||0,b=y.height||0;_&&b||("top"in y&&"bottom"in y&&(b=Math.abs(y.top-y.bottom)),"right"in y&&"left"in y&&(_=Math.abs(y.right-y.left))),this.calcOffset(),v.x=v.x-this._offset.left,v.y=v.y-this._offset.top,n||(v=this.restorePointerVpt(v));var w=this.getRetinaScaling();if(1!==w&&(v.x/=w,v.y/=w),0!==_&&0!==b){var I=window.getComputedStyle(h).objectFit,A=h.width,M=h.height;o={width:A/_,height:M/b};var J=A/M,Z=_/b;return"contain"===I?J>Z?{x:v.x*o.width,y:(v.y-(b-_/J)/2)*o.width}:{x:(v.x-(_-b*J)/2)*o.height,y:v.y*o.height}:"cover"===I?J>Z?{x:(A-o.height*_)/2+v.x*o.height,y:v.y*o.height}:{x:v.x*o.width,y:(M-o.width*b)/2+v.y*o.width}:{x:v.x*o.width,y:v.y*o.height}}return{x:v.x*(o={width:1,height:1}).width,y:v.y*o.height}},Vi.Canvas.prototype._onTouchStart=function(p){var n=this.findTarget(p);!this.allowTouchScrolling&&p.cancelable&&p.preventDefault&&p.preventDefault(),n&&p.cancelable&&p.preventDefault&&p.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var o=this.upperCanvasEl,h=this._getEventPrefix();Vi.util.addListener(Vi.document,"touchend",this._onTouchEnd,{passive:!1}),Vi.util.addListener(Vi.document,"touchmove",this._onMouseMove,{passive:!1}),Vi.util.removeListener(o,h+"down",this._onMouseDown)},Vi.Textbox.prototype._wrapLine=function(p,n,o,h){const v=p.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var _=0,b=this.splitByGrapheme||!(!v||!v.length),w=[],I=[],A=b?Vi.util.string.graphemeSplit(p):p.split(this._wordJoiners),M="",F=0,V=b?"":" ",B=0,Q=0,J=0,Z=!0,re=this._getWidthOfCharSpacing();h=h||0,0===A.length&&A.push([]),o-=h;for(var se=0;se<A.length;se++)M=b?A[se]:Vi.util.string.graphemeSplit(A[se]),B=this._measureWord(M,n,F),F+=M.length,(_+=Q+B-re)>o&&!Z?(w.push(I),I=[],_=B,Z=!0):_+=re,Z||b||I.push(V),I=I.concat(M),Q=b?0:this._measureWord([V],n,F),F++,Z=!1,B>J&&(J=B);return se&&w.push(I),J+h>this.dynamicMinWidth&&(this.dynamicMinWidth=J-re+h),w});class po{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(n){this.fabricCanvas.selection=n,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(n,o,h){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,n.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=n.getFabricCanvas();else{let _=this.fabricCanvas=new Vi.Canvas(n,Object.assign(h,{allowTouchScrolling:!0,selection:!1}));_.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),_.lowerCanvasEl.className="",_.upperCanvasEl.className="",_.on("selection:created",function(b){const w=b.selected,I=[];for(let A of w){const M=A.getDrawingItem()._drawingLayer;M&&!I.includes(M)&&I.push(M)}for(let A of I){const M=[];for(let F of w){const V=F.getDrawingItem();V._drawingLayer===A&&M.push(V)}setTimeout(()=>{A.onSelectionChanged&&A.onSelectionChanged(M,[])},0)}}),_.on("before:selection:cleared",function(b){const w=this.getActiveObjects(),I=[];for(let A of w){const M=A.getDrawingItem()._drawingLayer;M&&!I.includes(M)&&I.push(M)}for(let A of I){const M=[];for(let F of w){const V=F.getDrawingItem();V._drawingLayer===A&&M.push(V)}setTimeout(()=>{const F=[];for(let V of M)A.hasDrawingItem(V)&&F.push(V);F.length>0&&A.onSelectionChanged&&A.onSelectionChanged([],F)},0)}}),_.on("selection:updated",function(b){const w=b.selected,I=b.deselected,A=[];for(let M of w){const F=M.getDrawingItem()._drawingLayer;F&&!A.includes(F)&&A.push(F)}for(let M of I){const F=M.getDrawingItem()._drawingLayer;F&&!A.includes(F)&&A.push(F)}for(let M of A){const F=[],V=[];for(let B of w){const Q=B.getDrawingItem();Q._drawingLayer===M&&F.push(Q)}for(let B of I){const Q=B.getDrawingItem();Q._drawingLayer===M&&V.push(Q)}setTimeout(()=>{M.onSelectionChanged&&M.onSelectionChanged(F,V)},0)}}),_.wrapperEl.style.position="absolute",n.getFabricCanvas=()=>this.fabricCanvas}let v,y;switch(this.id=o,o){case po.DDN_LAYER_ID:v=un.getDrawingStyle(un.STYLE_BLUE_STROKE),y=un.getDrawingStyle(un.STYLE_BLUE_STROKE_FILL);break;case po.DBR_LAYER_ID:v=un.getDrawingStyle(un.STYLE_ORANGE_STROKE),y=un.getDrawingStyle(un.STYLE_ORANGE_STROKE_FILL);break;case po.DLR_LAYER_ID:v=un.getDrawingStyle(un.STYLE_GREEN_STROKE),y=un.getDrawingStyle(un.STYLE_GREEN_STROKE_FILL);break;default:v=un.getDrawingStyle(un.STYLE_YELLOW_STROKE),y=un.getDrawingStyle(un.STYLE_YELLOW_STROKE_FILL)}for(let _ of lc.arrMediaTypes)this.mapType_StateAndStyleId.set(_,{default:v.id,selected:y.id})}getId(){return this.id}setVisible(n){if(n){for(let o of this._arrFabricObject)o.visible=!0,o.hasControls=!0;this._visible=!0}else{for(let o of this._arrFabricObject)o.visible=!1,o.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(n){return n.styleId?un.getDrawingStyle(n.styleId):un.getDrawingStyle(n._mapState_StyleId.get(n.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(n,o,h,v){const y=this.getDrawingItems(_=>_._mediaType===n);for(let _ of y)_.styleSelector===o&&this._changeItemStyle(_,h,!0);v||this.fabricCanvas.renderAll()}_changeItemStyle(n,o,h){if(!n||!o)return;const v=n._getFabricObject();"number"==typeof n.styleId&&(o=un.getDrawingStyle(n.styleId)),v.strokeWidth=o.lineWidth,"fill"===o.paintMode?(v.fill=o.fillStyle,v.stroke=o.fillStyle):"stroke"===o.paintMode?(v.fill="transparent",v.stroke=o.strokeStyle):"strokeAndFill"===o.paintMode&&(v.fill=o.fillStyle,v.stroke=o.strokeStyle),v.fontFamily&&(v.fontFamily=o.fontFamily),v.fontSize&&(v.fontSize=o.fontSize),v.group||(v.dirty=!0),h||this.fabricCanvas.renderAll()}_updateGroupItem(n,o,h){if(!n||!o)return;const v=n.getChildDrawingItems();if("add"===h){if(v.includes(o))return;const y=o._getFabricObject();if(this.fabricCanvas.getObjects().includes(y)){if(!this._arrFabricObject.includes(y))throw new Error("Existed in other drawing layers.");o._zIndex=null}else{let _;if(o.styleId)_=un.getDrawingStyle(o.styleId);else{const b=this.mapType_StateAndStyleId.get(o._mediaType);_=un.getDrawingStyle(b[n.styleSelector]);const w=()=>{this._changeItemStyle(o,un.getDrawingStyle(this.mapType_StateAndStyleId.get(o._mediaType).selected),!0)},I=()=>{this._changeItemStyle(o,un.getDrawingStyle(this.mapType_StateAndStyleId.get(o._mediaType).default),!0)};o._on("selected",w),o._on("deselected",I),o._funcChangeStyleToSelected=w,o._funcChangeStyleToDefault=I}o._drawingLayer=this,o._drawingLayerId=this.id,this._changeItemStyle(o,_,!0)}n._fabricObject.addWithUpdate(o._getFabricObject())}else{if("remove"!==h||!v.includes(o))return;o._zIndex=null,o._drawingLayer=null,o._drawingLayerId=null,o._off("selected",o._funcChangeStyleToSelected),o._off("deselected",o._funcChangeStyleToDefault),o._funcChangeStyleToSelected=null,o._funcChangeStyleToDefault=null,n._fabricObject.removeWithUpdate(o._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(n,o){if(!(n instanceof lc))throw new TypeError("Invalid 'drawingItem'.");if(n._drawingLayer){if(n._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let h=n._getFabricObject();const v=this.fabricCanvas.getObjects();let y,_;if(v.includes(h)){if(this._arrFabricObject.includes(h))return;throw new Error("Existed in other drawing layers.")}if("group"===n._mediaType){y=n.getChildDrawingItems();for(let I of y)if(I._drawingLayer&&I._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(o&&"object"==typeof o&&!Array.isArray(o))for(let I in o)h.set(I,o[I]);if(y){for(let I of y){const A=this.mapType_StateAndStyleId.get(I._mediaType);for(let M of lc.arrStyleSelectors)I._mapState_StyleId.set(M,A[M]);if(I.styleId)_=un.getDrawingStyle(I.styleId);else{_=un.getDrawingStyle(A.default);const M=()=>{this._changeItemStyle(I,un.getDrawingStyle(this.mapType_StateAndStyleId.get(I._mediaType).selected),!0)},F=()=>{this._changeItemStyle(I,un.getDrawingStyle(this.mapType_StateAndStyleId.get(I._mediaType).default),!0)};I._on("selected",M),I._on("deselected",F),I._funcChangeStyleToSelected=M,I._funcChangeStyleToDefault=F}I._drawingLayer=this,I._drawingLayerId=this.id,this._changeItemStyle(I,_,!0)}h.dirty=!0,this.fabricCanvas.renderAll()}else{const I=this.mapType_StateAndStyleId.get(n._mediaType);for(let A of lc.arrStyleSelectors)n._mapState_StyleId.set(A,I[A]);if(n.styleId)_=un.getDrawingStyle(n.styleId);else{_=un.getDrawingStyle(I.default);const A=()=>{this._changeItemStyle(n,un.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).selected))},M=()=>{this._changeItemStyle(n,un.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).default))};n._on("selected",A),n._on("deselected",M),n._funcChangeStyleToSelected=A,n._funcChangeStyleToDefault=M}this._changeItemStyle(n,_)}n._zIndex=this.id,n._drawingLayer=this,n._drawingLayerId=this.id;const b=this._arrFabricObject.length;let w=v.length;if(b)w=v.indexOf(this._arrFabricObject[b-1])+1;else for(let I=0;I<v.length;I++)if(n._zIndex<v[I].getDrawingItem()._zIndex){w=I;break}this._arrDrwaingItem.push(n),this._arrFabricObject.push(h),h.visible=!!this._visible,this.fabricCanvas.insertAt(h,w,!1)}addDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)n._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");n._setEditable(!0)}this._addDrawingItem(n),n.updatePosition()}addDrawingItems(n){for(let o of n)this.addDrawingItem(o)}removeDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(n))return;if(n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,"group"===n._mediaType){const h=n.getChildDrawingItems();for(let v of h)v._zIndex=null,v._drawingLayer=null,v._drawingLayerId=null,v._off("selected",v._funcChangeStyleToSelected),v._off("deselected",v._funcChangeStyleToDefault),v._funcChangeStyleToSelected=null,v._funcChangeStyleToDefault=null,v._mapState_StyleId.clear()}else n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,n._mapState_StyleId.clear();const o=n._getFabricObject();"selected"===n.styleSelector&&(o.group?o.group.removeWithUpdate(o):this.fabricCanvas._activeObject=null,n.setState(Vc.DIS_DEFAULT)),this.fabricCanvas.remove(o),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(n),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(o),1)}removeDrawingItems(n){for(let o of n)this.removeDrawingItem(o)}setDrawingItems(n){this.clearDrawingItems(),this.addDrawingItems(n)}getDrawingItems(n){return n&&"function"==typeof n?this._arrDrwaingItem.filter(n):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const n=this.fabricCanvas.getActiveObjects(),o=[];for(let h of n)this._arrFabricObject.includes(h)&&o.push(h.getDrawingItem());return o}hasDrawingItem(n){if(!n||!n.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(n)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(n,o,h){o?o.forEach(_=>_.toLowerCase()):o=lc.arrMediaTypes,h?h.forEach(_=>_.toLowerCase()):h=lc.arrStyleSelectors;const v=un.getDrawingStyle(n);if(!v)throw new Error(`The 'drawingStyle' with id '${n}' doesn't exist.`);let y;for(let _ of o)if(y=this.mapType_StateAndStyleId.get(_),y)for(let b of h){this._changeMediaTypeCurStyleInStyleSelector(_,b,v,!0),y[b]=n;for(let w of this._arrDrwaingItem)w._mediaType===_&&w._mapState_StyleId.set(b,n)}this.fabricCanvas.renderAll()}setDefaultStyle(n,o,h){const v=[];h&Na.DIMT_RECTANGLE&&v.push("rect"),h&Na.DIMT_QUADRILATERAL&&v.push("quad"),h&Na.DIMT_TEXT&&v.push("text"),h&Na.DIMT_ARC&&v.push("arc"),h&Na.DIMT_IMAGE&&v.push("image"),h&Na.DIMT_POLYGON&&v.push("polygon"),h&Na.DIMT_LINE&&v.push("line");const y=[];o&Vc.DIS_DEFAULT&&y.push("default"),o&Vc.DIS_SELECTED&&y.push("selected"),this._setDefaultStyle(n,v.length?v:null,y.length?y:null)}setMode(n){if("viewer"===(n=n.toLowerCase())){for(let o of this._arrDrwaingItem)o._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==n)throw new RangeError("Invalid value.");for(let o of this._arrDrwaingItem)o._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(n,o){this.fabricCanvas.setDimensions(n,o)}_setObjectFit(n){if(n=n.toLowerCase(),!["contain","cover"].includes(n))throw new Error(`Unsupported value '${n}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=n,this.fabricCanvas.upperCanvasEl.style.objectFit=n}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let n of this._arrDrwaingItem){const o=this._getItemCurrentStyle(n);this._changeItemStyle(n,o,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}po.DDN_LAYER_ID=1,po.DBR_LAYER_ID=2,po.DLR_LAYER_ID=3,po.USER_DEFINED_LAYER_BASE_ID=100,po.TIP_LAYER_ID=999;class yEe{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(n,o){if(this.getDrawingLayer(o))throw new Error("Existed drawing layer id.");const h=new po(n,o,{enableRetinaScaling:!1});return h._manager=this,this._arrDrawingLayer.push(h),this._switchPointerEvent(),h}deleteDrawingLayer(n){const o=this.getDrawingLayer(n);if(!o)return;const h=this._arrDrawingLayer;o.dispose(),h.splice(h.indexOf(o),1),this._switchPointerEvent()}clearDrawingLayers(){for(let n of this._arrDrawingLayer)n.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(n){for(let o of this._arrDrawingLayer)if(o.getId()===n)return o;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const n=this._getFabricCanvas().getActiveObjects(),o=[];for(let h of n)o.push(h.getDrawingItem());return o}setDimensions(n,o){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(n,o)}setObjectFit(n){for(let o of this._arrDrawingLayer)o&&o._setObjectFit(n)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(n){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=n?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let n of this._arrDrawingLayer)n.getMode()}}class _Ee extends gEe{constructor(n,o,h,v,y){super(n,{x:o,y:h,width:v,height:0},y),Xy.set(this,void 0),tx.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var _=0,b=0,w=this._textLines.length;b<w;b++)_+=this.getHeightOfLine(b);return _+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(n){Ln(this,Xy,n,"f"),qe(this,tx,"f")&&clearTimeout(qe(this,tx,"f")),qe(this,Xy,"f")>=0&&Ln(this,tx,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},qe(this,Xy,"f")),"f")}getDuration(){return qe(this,Xy,"f")}}Xy=new WeakMap,tx=new WeakMap,jc=new WeakMap,nx=new WeakMap,ix=new WeakMap,rx=new WeakMap,$y=new WeakSet,yK=function(p,n,o,h,v,y){const _=new _Ee(p,n,o,h,y);return _.coordinateBase=v,_},_K=function(p,n){n.hasDrawingItem(p)||n.addDrawingItems([p])},CK=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},bK=function(){if(!this._tip)return;const p=qe(this,jc,"f");this._tip.coordinateBase=p.coordinateBase,this._tip.setTextRect({x:p.topLeftPoint.x,y:p.topLeftPoint.y,width:p.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class K4 extends HTMLElement{constructor(){super(),kI.set(this,void 0);const n=new DocumentFragment,o=document.createElement("div");o.setAttribute("class","wrapper"),n.appendChild(o),Ln(this,kI,o,"f");const h=document.createElement("slot");h.setAttribute("name","single-frame-input-container"),o.append(h);const v=document.createElement("slot");v.setAttribute("name","content"),o.append(v);const y=document.createElement("slot");y.setAttribute("name","drawing-layer"),o.append(y);const _=document.createElement("style");_.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',n.appendChild(_),this.attachShadow({mode:"open"}).appendChild(n)}getWrapper(){return qe(this,kI,"f")}setElement(n,o){if(!(o instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");this.removeElement(n),o.setAttribute("slot",n),this.appendChild(o)}getElement(n){if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${n}"]`)}removeElement(n){var o;if(!["content","single-frame-input-container","drawing-layer"].includes(n))throw new TypeError("Invalid 'slot'.");null===(o=this.querySelectorAll(`[slot="${n}"]`))||void 0===o||o.forEach(h=>h.remove())}}kI=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",K4);class js extends class CEe{constructor(){$y.add(this),jc.set(this,void 0),nx.set(this,void 0),ix.set(this,void 0),rx.set(this,!0),this._drawingLayerManager=new yEe}createDrawingLayerBaseCvs(n,o,h="contain"){if("number"!=typeof n||n<=1)throw new Error("Invalid 'width'.");if("number"!=typeof o||o<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(h))throw new Error("Unsupported 'objectFit'.");const v=document.createElement("canvas");return v.width==n&&v.height==o||(v.width=n,v.height=o),v.style.objectFit=h,v}_createDrawingLayer(n,o,h,v){if(!this._layerBaseCvs){let b;try{b=this.getContentDimensions()}catch(w){if("Invalid content dimensions."!==(w.message||w))throw w}o||(o=(null==b?void 0:b.width)||1280),h||(h=(null==b?void 0:b.height)||720),v||(v=(null==b?void 0:b.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(o,h,v)}const y=this._layerBaseCvs,_=this._drawingLayerManager.createDrawingLayer(y,n);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",y.parentElement),_}createDrawingLayer(){let n;for(let o=po.USER_DEFINED_LAYER_BASE_ID;;o++)if(!this._drawingLayerManager.getDrawingLayer(o)&&o!==po.TIP_LAYER_ID){n=o;break}return this._createDrawingLayer(n)}deleteDrawingLayer(n){var o;this._drawingLayerManager.deleteDrawingLayer(n),this._drawingLayerManager.getAllDrawingLayers().length||(null===(o=this._innerComponent)||void 0===o||o.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(n){if("number"!=typeof n)throw new TypeError("Invalid id.");if(n<po.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${n} is not defined by users.`);this.deleteDrawingLayer(n)}_clearDrawingLayers(){const n=this.getAllDrawingLayers();for(let o of n)this.deleteDrawingLayer(o.getId())}clearUserDefinedDrawingLayers(){const n=this.getAllDrawingLayers();for(let o of n){const h=o.getId();h<po.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(h)}}getDrawingLayer(n){return n==po.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(n)||([po.DDN_LAYER_ID,po.DBR_LAYER_ID,po.DLR_LAYER_ID].includes(n)?this._createDrawingLayer(n):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(n=>n.getId()>=0&&n.getId()!==po.TIP_LAYER_ID)}updateDrawingLayers(n){((o,h,v)=>{if(!(o<=1||h<=1)){if(!["contain","cover"].includes(v))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:o,height:h},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(v)}})(n.width,n.height,n.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(n){if(!(cK(o=n)&&fEe(o.topLeftPoint)&&Hy(o.width))||o.width<=0||!Hy(o.duration)||"coordinateBase"in o&&!["view","image"].includes(o.coordinateBase))throw new Error("Invalid tip config.");var o;Ln(this,jc,JSON.parse(JSON.stringify(n)),"f"),qe(this,jc,"f").coordinateBase||(qe(this,jc,"f").coordinateBase="view"),Ln(this,ix,n.duration,"f"),qe(this,$y,"m",bK).call(this)}getTipConfig(){return qe(this,jc,"f")?qe(this,jc,"f"):null}setTipVisible(n){if("boolean"!=typeof n)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",n),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Ln(this,rx,n,"f")}isTipVisible(){return qe(this,rx,"f")}updateTipMessage(n){if(!qe(this,jc,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=un.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(po.TIP_LAYER_ID)||this._createDrawingLayer(po.TIP_LAYER_ID)),this._tip?this._tip.set("text",n):this._tip=qe(this,$y,"m",yK).call(this,n,qe(this,jc,"f").topLeftPoint.x,qe(this,jc,"f").topLeftPoint.y,qe(this,jc,"f").width,qe(this,jc,"f").coordinateBase,this._tipStyleId),qe(this,$y,"m",_K).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",qe(this,rx,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),qe(this,nx,"f")&&clearTimeout(qe(this,nx,"f")),qe(this,ix,"f")>=0&&Ln(this,nx,setTimeout(()=>{qe(this,$y,"m",CK).call(this)},qe(this,ix,"f")),"f")}}{static get engineResourcePath(){return pv(Mo.engineResourcePaths,kn).dce}static set defaultUIElementURL(n){js._defaultUIElementURL=n}static get defaultUIElementURL(){var n;return null===(n=js._defaultUIElementURL)||void 0===n?void 0:n.replace("@engineResourcePath/",js.engineResourcePath)}static createInstance(n){return Fe(function*(){const o=new js;return"string"==typeof n&&(n=n.replace("@engineResourcePath/",js.engineResourcePath)),yield o.setUIElement(n||js.defaultUIElementURL),o})()}static _transformCoordinates(n,o,h,v,y,_,b){const I=b/y;n.x=Math.round(n.x/(_/v)+o),n.y=Math.round(n.y/I+h)}set _singleFrameMode(n){if(!["disabled","image","camera"].includes(n))throw new Error("Invalid value.");if(n!==qe(this,lx,"f")){if(Ln(this,lx,n,"f"),qe(this,Gr,"m",Hc).call(this))Ln(this,ca,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!qe(this,ca,"f")){const o=document.createElement("video");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.objectFit=this.getVideoFit(),o.setAttribute("autoplay","true"),o.setAttribute("playsinline","true"),o.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(la.OS)&&o.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ln(this,ca,o,"f");const h=document.createElement("div");h.append(o),h.style.overflow="hidden",this._videoContainer=h,this._innerComponent.setElement("content",h)}qe(this,Gr,"m",Hc).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return qe(this,lx,"f")}get disposed(){return qe(this,X4,"f")}constructor(){var n;super(),n=this,Gr.add(this),ox.set(this,void 0),sx.set(this,void 0),ax.set(this,void 0),this.containerClassName="dce-video-container",ca.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,MI.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,OI.set(this,!1),FI.set(this,!1),Lg.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{qe(this,Gr,"m",ux).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&qe(this,Gr,"m",q4).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{js._onLog&&js._onLog("window resize event triggered."),qe(this,Lg,"f").width===document.documentElement.clientWidth&&qe(this,Lg,"f").height===document.documentElement.clientHeight||(qe(this,Lg,"f").width=document.documentElement.clientWidth,qe(this,Lg,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},lx.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!qe(this,Gr,"m",Hc).call(this))return;let o;if(this._singleFrameInputContainer)o=this._singleFrameInputContainer.firstElementChild;else{o=document.createElement("input"),o.setAttribute("type","file"),"camera"===this._singleFrameMode?(o.setAttribute("capture",""),o.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(o.removeAttribute("capture"),o.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),o.addEventListener("change",Fe(function*(){const v=o.files[0];o.value="";{const y=function(){var V=Fe(function*(B){let Q=null,J=null;if("undefined"!=typeof createImageBitmap)try{if(Q=yield createImageBitmap(B),Q)return Q}catch(re){}var Z;return Q||(J=yield(Z=B,new Promise((re,se)=>{let ce=URL.createObjectURL(Z),pe=new Image;pe.src=ce,pe.onload=()=>{URL.revokeObjectURL(pe.src),re(pe)},pe.onerror=Ce=>{se(new Error("Can't convert blob to image : "+(Ce instanceof Event?Ce.type:Ce)))}}))),J});return function(Q){return V.apply(this,arguments)}}(),_=(V,B,Q,J)=>{V.width==Q&&V.height==J||(V.width=Q,V.height=J);const Z=V.getContext("2d");Z.clearRect(0,0,V.width,V.height),Z.drawImage(B,0,0)},b=yield y(v),w=b instanceof HTMLImageElement?b.naturalWidth:b.width,I=b instanceof HTMLImageElement?b.naturalHeight:b.height;let A=n._cvsSingleFrameMode;const M=null==A?void 0:A.width,F=null==A?void 0:A.height;A||(A=document.createElement("canvas"),n._cvsSingleFrameMode=A),_(A,b,w,I),n._innerComponent.setElement("content",A),M===A.width&&F===A.height||n.eventHandler.fire("content:updated",null,{async:!1})}n._onSingleFrameAcquired&&setTimeout(()=>{n._onSingleFrameAcquired(n._cvsSingleFrameMode)},0)})),o.style.position="absolute",o.style.top="-9999px",o.style.backgroundColor="transparent",o.style.color="transparent";const h=document.createElement("div");h.append(o),this._innerComponent.setElement("single-frame-input-container",h),this._singleFrameInputContainer=h}null==o||o.click()},cx.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(o,h)=>{var v,y,_,b;if(this.disposed||(this.clearAllInnerDrawingItems(),!o))return;const w=o.originalImageTag;if(!w)return;const I=o.items;if(!(null==I?void 0:I.length))return;const A=(null===(v=w.cropRegion)||void 0===v?void 0:v.left)||0,M=(null===(y=w.cropRegion)||void 0===y?void 0:y.top)||0,F=(null===(_=w.cropRegion)||void 0===_?void 0:_.right)?w.cropRegion.right-A:w.originalWidth,V=(null===(b=w.cropRegion)||void 0===b?void 0:b.bottom)?w.cropRegion.bottom-M:w.originalHeight,B=w.currentWidth,Q=w.currentHeight,J=(se,ce,pe,Ce,Ve,te,Me,we,Le=[],j)=>{ce.forEach(Y=>js._transformCoordinates(Y,pe,Ce,Ve,te,Me,we));const L=new mEe({points:[{x:ce[0].x,y:ce[0].y},{x:ce[1].x,y:ce[1].y},{x:ce[2].x,y:ce[2].y},{x:ce[3].x,y:ce[3].y}]},j);for(let Y of Le)L.addNote(Y);se.addDrawingItems([L]),qe(this,cx,"f").push(L)};let Z,re;for(let se of I)switch(se.type){case pr.CRIT_ORIGINAL_IMAGE:break;case pr.CRIT_BARCODE:Z=this.getDrawingLayer(po.DBR_LAYER_ID),re=[{name:"format",content:se.formatString},{name:"text",content:se.text}],(null==h?void 0:h.isBarcodeVerifyOpen)?se.verified?J(Z,se.location.points,A,M,F,V,B,Q,re):J(Z,se.location.points,A,M,F,V,B,Q,re,un.STYLE_ORANGE_STROKE_TRANSPARENT):J(Z,se.location.points,A,M,F,V,B,Q,re);break;case pr.CRIT_TEXT_LINE:Z=this.getDrawingLayer(po.DLR_LAYER_ID),re=[{name:"text",content:se.text}],h.isLabelVerifyOpen?se.verified?J(Z,se.location.points,A,M,F,V,B,Q,re):J(Z,se.location.points,A,M,F,V,B,Q,re,un.STYLE_GREEN_STROKE_TRANSPARENT):J(Z,se.location.points,A,M,F,V,B,Q,re);break;case pr.CRIT_DETECTED_QUAD:Z=this.getDrawingLayer(po.DDN_LAYER_ID),(null==h?void 0:h.isDetectVerifyOpen)?se.verified?J(Z,se.location.points,A,M,F,V,B,Q,[]):J(Z,se.location.points,A,M,F,V,B,Q,[],un.STYLE_BLUE_STROKE_TRANSPARENT):J(Z,se.location.points,A,M,F,V,B,Q,[]);break;case pr.CRIT_NORMALIZED_IMAGE:Z=this.getDrawingLayer(po.DDN_LAYER_ID),(null==h?void 0:h.isNormalizeVerifyOpen)?se.verified?J(Z,se.location.points,A,M,F,V,B,Q,[]):J(Z,se.location.points,A,M,F,V,B,Q,[],un.STYLE_BLUE_STROKE_TRANSPARENT):J(Z,se.location.points,A,M,F,V,B,Q,[]);break;case pr.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},X4.set(this,!1),this.eventHandler=new pK,this.eventHandler.on("content:updated",()=>{qe(this,ox,"f")&&clearTimeout(qe(this,ox,"f")),Ln(this,ox,setTimeout(()=>{if(this.disposed)return;let o;this._updateVideoContainer();try{o=this.getContentDimensions()}catch(h){if("Invalid content dimensions."===(h.message||h))return;throw h}this.updateDrawingLayers(o),this.updateConvertedRegion(o)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{qe(this,sx,"f")&&clearTimeout(qe(this,sx,"f")),Ln(this,sx,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(n){this.UIElement=n,this._unbindUI(),this._bindUI()}setUIElement(n){var o=this;return Fe(function*(){let h;if("string"==typeof n){let v=yield gK(n);h=document.createElement("div"),Object.assign(h.style,{width:"100%",height:"100%"}),h.attachShadow({mode:"open"}).appendChild(v.cloneNode(!0))}else h=n;o._setUIElement(h)})()}getUIElement(){return this.UIElement}_bindUI(){var n,o;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let h=this.UIElement;h=h.shadowRoot||h;let v=(null===(n=h.classList)||void 0===n?void 0:n.contains(this.containerClassName))?h:h.querySelector(`.${this.containerClassName}`);if(!v)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new K4,v.appendChild(this._innerComponent),!qe(this,Gr,"m",Hc).call(this)){const y=document.createElement("video");Object.assign(y.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",objectFit:this.getVideoFit()}),y.setAttribute("autoplay","true"),y.setAttribute("playsinline","true"),y.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(la.OS)&&y.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ln(this,ca,y,"f");const _=document.createElement("div");_.append(y),_.style.overflow="hidden",this._videoContainer=_,this._innerComponent.setElement("content",_)}if(this._selRsl=h.querySelector(".dce-sel-resolution"),this._selMinLtr=h.querySelector(".dlr-sel-minletter"),this._divScanArea=h.querySelector(".dce-scanarea"),this._divScanLight=h.querySelector(".dce-scanlight"),this._bgLoading=h.querySelector(".dce-bg-loading"),this._bgCamera=h.querySelector(".dce-bg-camera"),this._selCam=h.querySelector(".dce-sel-camera"),this._optGotRsl=h.querySelector(".dce-opt-gotResolution"),this._btnClose=h.querySelector(".dce-btn-close"),this._optGotMinLtr=h.querySelector(".dlr-opt-gotMinLtr"),this._selRsl&&(this._hideDefaultSelection||qe(this,Gr,"m",Hc).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||qe(this,Gr,"m",Hc).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||qe(this,Gr,"m",ux).call(this),qe(this,Gr,"m",Hc).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),qe(this,Gr,"m",Hc).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(_=>{var b;js._onLog&&js._onLog("resize observer triggered.");for(let w of _)w.target===(null===(b=this._innerComponent)||void 0===b?void 0:b.getWrapper())&&this._videoResizeListener()}));const y=null===(o=this._innerComponent)||void 0===o?void 0:o.getWrapper();y&&this._resizeObserver.observe(y)}qe(this,Lg,"f").width=document.documentElement.clientWidth,qe(this,Lg,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var n,o,h,v;qe(this,Gr,"m",Hc).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),qe(this,Gr,"m",ux).call(this),null===(n=this._drawingLayerManager)||void 0===n||n.clearDrawingLayers(),null===(o=this._innerComponent)||void 0===o||o.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(h=this._innerComponent)||void 0===h||h.remove(),this._innerComponent=null,Ln(this,ca,null,"f"),null===(v=this._videoContainer)||void 0===v||v.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(n,o){if(this._selCam){let v;this._selCam.textContent="";for(let y of o){const _=document.createElement("option");_.value=y.deviceId,_.innerText=y.label,this._selCam.append(_),y.deviceId&&n&&n.deviceId==y.deviceId&&(v=_)}this._selCam.value=v?v.value:""}let h=this.UIElement;if(h=h.shadowRoot||h,h.querySelector(".dce-macro-use-mobile-native-like-ui")){let v=h.querySelector(".dce-mn-cameras");if(v){v.textContent="";for(let y of o){const _=document.createElement("div");_.classList.add("dce-mn-camera-option"),_.setAttribute("data-davice-id",y.deviceId),_.textContent=y.label,v.append(_)}}}}_renderResolutionInfo(n){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",n.width),this._optGotRsl.setAttribute("data-height",n.height),this._optGotRsl.innerText="got "+n.width+"x"+n.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"));{let o=this.UIElement;o=(null==o?void 0:o.shadowRoot)||o;let h=null==o?void 0:o.querySelector(".dce-mn-resolution-box");if(h){let v="";if(n&&n.width&&n.height){let y=Math.max(n.width,n.height),_=Math.min(n.width,n.height);v=_<=1080?_+"P":y<3e3?"2K":Math.round(y/1e3)+"K"}h.textContent=v}}}getVideoElement(){return qe(this,ca,"f")}isVideoLoaded(){return!(!qe(this,ca,"f")||!this.cameraEnhancer)&&this.cameraEnhancer.isOpen()}setVideoFit(n){if(n=n.toLowerCase(),!["contain","cover"].includes(n))throw new Error(`Unsupported value '${n}'.`);if(this.videoFit=n,!qe(this,ca,"f")||(qe(this,ca,"f").style.objectFit=n,qe(this,Gr,"m",Hc).call(this)))return;let o;this._updateVideoContainer();try{o=this.getContentDimensions()}catch(h){if("Invalid content dimensions."===(h.message||h))return;throw h}qe(this,Gr,"m",NI).call(this,o,this.getConvertedRegion()),this.updateDrawingLayers(o)}getVideoFit(){return this.videoFit}getContentDimensions(){var n,o,h,v;let y,_,b;if(qe(this,Gr,"m",Hc).call(this)?(y=null===(h=this._cvsSingleFrameMode)||void 0===h?void 0:h.width,_=null===(v=this._cvsSingleFrameMode)||void 0===v?void 0:v.height,b="contain"):(y=null===(n=qe(this,ca,"f"))||void 0===n?void 0:n.videoWidth,_=null===(o=qe(this,ca,"f"))||void 0===o?void 0:o.videoHeight,b=this.getVideoFit()),!y||!_)throw new Error("Invalid content dimensions.");return{width:y,height:_,objectFit:b}}updateConvertedRegion(n){const o=AI.convert(this.scanRegion,n.width,n.height);Ln(this,MI,o,"f"),qe(this,ax,"f")&&clearTimeout(qe(this,ax,"f")),Ln(this,ax,setTimeout(()=>{let h;try{h=this.getContentDimensions()}catch(v){if("Invalid content dimensions."===(v.message||v))return;throw v}qe(this,Gr,"m",LI).call(this,h,o),qe(this,Gr,"m",NI).call(this,h,o)},0),"f")}getConvertedRegion(){return qe(this,MI,"f")}setScanRegion(n){if(null!=n&&!U4(n)&&!ep(n))throw TypeError("Invalid 'region'.");let o;this.scanRegion=n?JSON.parse(JSON.stringify(n)):null;try{o=this.getContentDimensions()}catch(h){if("Invalid content dimensions."===(h.message||h))return;throw h}this.updateConvertedRegion(o)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(n){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const o=qe(this,ca,"f").videoWidth,h=qe(this,ca,"f").videoHeight,v=this.getVideoFit(),{width:y,height:_}=this._innerComponent.getBoundingClientRect();if(y<=0||_<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let b;const w={x:0,y:0,width:o,height:h,isMeasuredInPercentage:!1};if("cover"===v&&(y/_<o/h?(b=_/h,w.x=Math.floor((o-y/b)/2),w.y=0,w.width=Math.ceil(y/b),w.height=h):(b=y/o,w.x=0,w.y=Math.floor((h-_/b)/2),w.width=o,w.height=Math.ceil(_/b))),null==n?void 0:n.inPixels)return w;const I=w;return I.x=Math.ceil(I.x/h*100),I.y=Math.ceil(I.y/o*100),I.width=Math.floor(I.width/o*100),I.height=Math.floor(I.height/h*100),I.isMeasuredInPercentage=!0,w}setScanRegionMask(n,o,h,v){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||qe(this,Gr,"m",$4).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=un.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=un.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const y=this._drawingLayerOfMask.width,_=this._drawingLayerOfMask.height,b=new zy({x:0,y:0,width:y,height:_},this._maskBackRectStyleId),w=new zy({x:-y/2,y:-_/2+o,width:n,height:v}),I=new zy({x:-y/2+n+h,y:-_/2+o,width:y-n-h<0?0:y-n-h,height:v}),A=new zy({x:-y/2,y:-_/2,width:y,height:o}),M=new zy({x:-y/2,y:-_/2+o+v,width:y,height:_-o-v<0?0:_-o-v});w.set("strokeWidth",0),I.set("strokeWidth",0),A.set("strokeWidth",0),M.set("strokeWidth",0);const F=new vEe([w,I,A,M])._getFabricObject();b.set("clipPath",F);const V=new zy({x:n,y:o,width:h,height:v},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([b,V])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(n){Ln(this,OI,n,"f"),n?qe(this,Gr,"m",xK).call(this):qe(this,Gr,"m",$4).call(this)}setScanRegionMaskVisible(n){this._setScanRegionMaskVisible(n),this._userSetMaskVisible=n}isScanRegionMaskVisible(){return qe(this,OI,"f")}setScanRegionMaskStyle(n){if(!n)return;let o;n.fillStyle&&(this.regionMaskFillStyle=n.fillStyle),n.strokeStyle&&(this.regionMaskStrokeStyle=n.strokeStyle),n.lineWidth&&(this.regionMaskLineWidth=n.lineWidth),this._maskBackRectStyleId&&un.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&un.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{o=this.getContentDimensions()}catch(h){if("Invalid content dimensions."===(h.message||h))return;throw h}qe(this,Gr,"m",LI).call(this,o,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(n){Ln(this,FI,n,"f"),n?qe(this,Gr,"m",q4).call(this):qe(this,Gr,"m",ux).call(this)}setScanLaserVisible(n){this._setScanLaserVisible(n),this._userSetLaserVisible=n}isScanLaserVisible(){return qe(this,FI,"f")}_updateVideoContainer(){if(!qe(this,ca,"f")||qe(this,Gr,"m",Hc).call(this))return;let n=1;const o=qe(this,ca,"f").style.transform.match(/scale\((.+)\)/);o&&(n=parseFloat(o[1]));const h=this._videoContainer;if("contain"===this.videoFit&&n>1){const v=qe(this,ca,"f").videoWidth,y=qe(this,ca,"f").videoHeight,{width:_,height:b}=this._innerComponent.getBoundingClientRect(),w=v/y;if(_/b<w){let I=_/w;h.style.left="0",h.style.top=(b-I)/2/b*100+"%",h.style.width="100%",h.style.height=I/b*100+"%"}else{let I=b*w;h.style.left=(_-I)/2/_*100+"%",h.style.top="0",h.style.width=I/_*100+"%",h.style.height="100%"}}else h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%"}updateLayers(){let n;this._updateVideoContainer();try{n=this.getContentDimensions()}catch(h){if("Invalid content dimensions."===(h.message||h))return;throw h}const o=this.getConvertedRegion();qe(this,Gr,"m",NI).call(this,n,o),this.updateDrawingLayers(n),qe(this,Gr,"m",LI).call(this,n,o)}clearAllInnerDrawingItems(){qe(this,cx,"f").forEach(n=>n.remove()),qe(this,cx,"f").length=0}dispose(){this._unbindUI(),this.__proto__=null;for(let n in this)delete this[n];Object.defineProperty(this,"disposed",{value:!0})}}function st(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function tr(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}ox=new WeakMap,sx=new WeakMap,ax=new WeakMap,ca=new WeakMap,MI=new WeakMap,OI=new WeakMap,FI=new WeakMap,Lg=new WeakMap,lx=new WeakMap,cx=new WeakMap,X4=new WeakMap,Gr=new WeakSet,Hc=function(){return"disabled"!==this._singleFrameMode},LI=function(p,n){!n||0===n.x&&0===n.y&&n.width===p.width&&n.height===p.height?this.clearScanRegionMask():this.setScanRegionMask(n.x,n.y,n.width,n.height)},xK=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},$4=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},q4=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},ux=function(){this._divScanLight&&(this._divScanLight.style.display="none")},NI=function(p,n){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:o,height:h,objectFit:v}=p;n||(n={x:0,y:0,width:o,height:h});const{width:y,height:_}=this._innerComponent.getBoundingClientRect();if(y<=0||_<=0)return;const b=y/_,w=o/h;let I,A,M,F,V=1;if("contain"===v)b<w?(V=y/o,I=0,A=(_-h*V)/2):(V=_/h,I=(y-o*V)/2,A=0),I+=n.x*V,A+=n.y*V,M=n.width*V,F=n.height*V;else if("cover"===v)if(b<w){V=_/h,I=n.x*V-(o*V-y)/2,I=Math.max(I,0),I=Math.min(I,y),A=n.y*V;let B=(n.x+n.width)*V-(o*V-y)/2;B=Math.max(B,0),B=Math.min(B,y),M=B-I,F=n.height*V}else{V=y/o,I=n.x*V,A=n.y*V-(h*V-_)/2,A=Math.max(A,0),A=Math.min(A,_);let B=(n.y+n.height)*V-(h*V-_)/2;B=Math.max(B,0),B=Math.min(B,_),M=n.width*V,F=B-A}else I=0,A=0,M=0,F=0;this._divScanArea.style.left=I+"px",this._divScanArea.style.top=A+"px",this._divScanArea.style.width=M+"px",this._divScanArea.style.height=F+"px"},js._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const wK="undefined"==typeof self;let dx,hx,BI,J4,ul;function Bl(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function Gd(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}"undefined"!=typeof navigator&&(dx=navigator,hx=dx.userAgent,BI=dx.platform,J4=dx.mediaDevices),function(){if(!wK){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:dx.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:BI,search:"Win"},Mac:{str:BI},Linux:{str:BI}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||hx,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||hx).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||hx).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=hx.indexOf("Windows NT")&&(v="HarmonyOS"),ul={browser:o,version:h,OS:v}}wK&&(ul={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let np=class{static multiply(n,o){const h=[];for(let v=0;v<3;v++){const y=o.slice(3*v,3*v+3);for(let _=0;_<3;_++){const b=[n[_],n[_+3],n[_+6]].reduce((w,I,A)=>w+I*y[A],0);h.push(b)}}return h}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(n,o,h){return kn.multiply(n,[1,0,0,0,1,0,o,h,1])}static rotate(n,o){var h=Math.cos(o),v=Math.sin(o);return kn.multiply(n,[h,-v,0,v,h,0,0,0,1])}static scale(n,o,h){return kn.multiply(n,[o,0,0,0,h,0,0,0,1])}};var nr,ip,rp,WI,qy,fx,px,Ky,UI,_v,VI,Q4,Mn,Ei,_r,jI,HI,qr,ju,op,Jy,GI,Uh,sp,Gc,Qy,Zy,gx,zI,e_,Cv,ap,lp,Z4,Hs,eO,bv,SK,YI,XI,TK,zd,tO,nO,t_,mx,$I,zc,n_,iO,rO,IK;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(nr||(nr={}));class ai{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Gd(ai,ip,!1,"f",rp),!1):(Gd(ai,ip,!0,"f",rp),!0)}get disposed(){return Bl(this,UI,"f")}constructor(){WI.set(this,nr.RGBA),qy.set(this,null),fx.set(this,null),px.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ky.set(this,null),UI.set(this,!1)}drawImage(n,o,h,v,y,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!h||!v)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Bl(ai,ip,"f",rp)&&ai.checkWebGLSupport(),(null==_?void 0:_.bUseWebGL)&&!Bl(ai,ip,"f",rp))throw new Error("Your browser or machine may not support WebGL.");if(o instanceof HTMLVideoElement&&4!==o.readyState||o instanceof HTMLImageElement&&!o.complete)throw new Error("The source is not loaded.");let b;ai._onLog&&(b=Date.now(),ai._onLog("drawImage(), START: "+b));let w=0,I=0,A=h,M=v,F=0,V=0,B=h,Q=v;y&&(y.sx&&(w=Math.round(y.sx)),y.sy&&(I=Math.round(y.sy)),y.sWidth&&(A=Math.round(y.sWidth)),y.sHeight&&(M=Math.round(y.sHeight)),y.dx&&(F=Math.round(y.dx)),y.dy&&(V=Math.round(y.dy)),y.dWidth&&(B=Math.round(y.dWidth)),y.dHeight&&(Q=Math.round(y.dHeight)));let J,Z=nr.RGBA;if((null==_?void 0:_.pixelFormat)&&(Z=_.pixelFormat),(null==_?void 0:_.bufferContainer)&&(J=_.bufferContainer,J.length<4*B*Q))throw new Error("Unexpected size of the 'bufferContainer'.");const re=n;if(!Bl(ai,ip,"f",rp)||!(this.useWebGLByDefault&&null==(null==_?void 0:_.bUseWebGL)||(null==_?void 0:_.bUseWebGL))){ai._onLog&&ai._onLog("drawImage() in context2d."),re.ctx2d||(re.ctx2d=re.getContext("2d",{willReadFrequently:!0}));const se=re.ctx2d;if(!se)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q),se.drawImage(o,w,I,A,M,F,V,B,Q),ai._onLog&&ai._onLog("drawImage() in context2d end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:nr.RGBA,bUseWebGL:!1}}ai._onLog&&ai._onLog("drawImage() in WebGL.");try{(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q,re.ctxWebGL&&re.ctxWebGL.viewport(0,0,F+B,V+Q));const se=re.ctxWebGL||re.getContext("webgl",{antialias:!1})||re.getContext("experimental-webgl",{antialias:!1});if(!se){ai._onLog&&ai._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const te=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw te.name="WebGLError",te}if(!re.ctxWebGL||Z!==Bl(this,WI,"f")){re.ctxWebGL=se;const te=k=>{const N=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,N),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW);const $=k.createBuffer();return k.bindBuffer(k.ARRAY_BUFFER,$),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW),{positions:N,texCoords:$}},Me=k=>{const N=k.createTexture();return k.bindTexture(k.TEXTURE_2D,N),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),N},we=(k,N)=>{const $=k.createProgram();if(N.forEach(ie=>k.attachShader($,ie)),k.linkProgram($),!k.getProgramParameter($,k.LINK_STATUS)){const ie=new Error(`An error occured linking the program: ${k.getProgramInfoLog($)}.`);throw ie.name="WebGLError",ie}return k.useProgram($),$},Le=(k,N,$)=>{const ie=k.createShader(N);if(k.shaderSource(ie,$),k.compileShader(ie),!k.getShaderParameter(ie,k.COMPILE_STATUS)){const ee=new Error(`An error occured compiling the shader: ${k.getShaderInfoLog(ie)}.`);throw ee.name="WebGLError",ee}return ie},j="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let L="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Z)&&(L=Z.slice(0,3));const Y=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${L} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,q=we(se,[Le(se,se.VERTEX_SHADER,j),Le(se,se.FRAGMENT_SHADER,Y)]);Gd(this,fx,{program:q,attribLocations:{vertexPosition:se.getAttribLocation(q,"a_position"),texPosition:se.getAttribLocation(q,"a_texCoord")},uniformLocations:{uSampler:se.getUniformLocation(q,"u_image"),uColorFactor:se.getUniformLocation(q,"uColorFactor"),uMatrix:se.getUniformLocation(q,"u_matrix"),uTextureMatrix:se.getUniformLocation(q,"u_textureMatrix")}},"f"),Gd(this,px,te(se),"f"),Gd(this,qy,Me(se),"f"),Gd(this,WI,Z,"f")}const ce=(te,Me,we)=>{te.bindBuffer(te.ARRAY_BUFFER,Me),te.enableVertexAttribArray(we),te.vertexAttribPointer(we,2,te.FLOAT,!1,0,0)},Ce=(te,Me,we,Le)=>{te.clearColor(0,0,0,1),te.clearDepth(1),te.enable(te.DEPTH_TEST),te.depthFunc(te.LEQUAL),te.clear(te.COLOR_BUFFER_BIT|te.DEPTH_BUFFER_BIT),ce(te,we.positions,Me.attribLocations.vertexPosition),ce(te,we.texCoords,Me.attribLocations.texPosition),te.activeTexture(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,Le),te.uniform1i(Me.uniformLocations.uSampler,0),te.uniform1f(Me.uniformLocations.uColorFactor,[nr.GREY,nr.GREY32].includes(Z)?1:0);let j,L,Y=np.translate(np.identity(),-1,-1);Y=np.scale(Y,2,2),Y=np.scale(Y,1/te.canvas.width,1/te.canvas.height),j=np.translate(Y,F,V),j=np.scale(j,B,Q),te.uniformMatrix3fv(Me.uniformLocations.uMatrix,!1,j),L=np.translate(np.identity(),w/h,I/v),L=np.scale(L,A/h,M/v),te.uniformMatrix3fv(Me.uniformLocations.uTextureMatrix,!1,L),te.drawArrays(te.TRIANGLES,0,6)};((te,Me,we)=>{const Le=te.RGBA,j=te.RGBA,L=te.UNSIGNED_BYTE;te.bindTexture(te.TEXTURE_2D,Me),te.texImage2D(te.TEXTURE_2D,0,Le,j,L,we)})(se,Bl(this,qy,"f"),o),Ce(se,Bl(this,fx,"f"),Bl(this,px,"f"),Bl(this,qy,"f"));const Ve=J||new Uint8Array(4*B*Q);if(se.readPixels(F,V,B,Q,se.RGBA,se.UNSIGNED_BYTE,Ve),255!==Ve[3]){ai._onLog&&ai._onLog("Incorrect WebGL drawing .");const te=new Error("WebGL error: incorrect drawing.");throw te.name="WebGLError",te}return ai._onLog&&ai._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:Z===nr.GREY?nr.GREY32:Z,bUseWebGL:!0}}catch(se){if(this.forceLoseContext(),null==(null==_?void 0:_.bUseWebGL))return ai._onLog&&ai._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(n,o,h,v,y,Object.assign({},_,{bUseWebGL:!1}));throw se.name="WebGLError",se}}readCvsData(n,o,h){if(!(n instanceof CanvasRenderingContext2D||n instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let v,y=0,_=0,b=n.canvas.width,w=n.canvas.height;if(o&&(o.x&&(y=o.x),o.y&&(_=o.y),o.width&&(b=o.width),o.height&&(w=o.height)),(null==h?void 0:h.length)<4*b*w)throw new Error("Unexpected size of the 'bufferContainer'.");if(n instanceof WebGLRenderingContext){const I=n;h?(I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,h),v=new Uint8Array(h.buffer,0,4*b*w)):(v=new Uint8Array(4*b*w),I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,v))}else if(n instanceof CanvasRenderingContext2D){let I;I=n.getImageData(y,_,b,w),v=new Uint8Array(I.data.buffer),null==h||h.set(v)}return v}transformPixelFormat(n,o,h,v){let y,_;if(ai._onLog&&(y=Date.now(),ai._onLog("transformPixelFormat(), START: "+y)),o===h)return ai._onLog&&ai._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),v?new Uint8Array(n):n;const b=[nr.RGBA,nr.RBGA,nr.GRBA,nr.GBRA,nr.BRGA,nr.BGRA];if(b.includes(o))if(h===nr.GREY){_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=.21*n[w]+.71*n[w+1]+.07*n[w+2]}else if(h===nr.GREY32){_=v?new Uint8Array(n):n;for(let w=0;w<n.length;w+=4){const I=.21*n[w]+.71*n[w+1]+.07*n[w+2];_[w]=I,_[w+1]=I,_[w+2]=I}}else{if(!b.includes(h))throw new Error("Unable to transform.");if(v){_=new Uint8Array(n);const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4)_[B+M]=n[B+w],_[B+F]=n[B+I],_[B+V]=n[B+A]}else{_=n;const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4){let Q=[n[B],n[B+1],n[B+2]];_[B+M]=Q[w],_[B+F]=Q[I],_[B+V]=Q[A]}}}else if(o===nr.GREY){if(h!==nr.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*n.length);for(let w=0;w<n.length;w++)_[4*w]=n[w],_[4*w+1]=n[w],_[4*w+2]=n[w],_[4*w+3]=255}else{if(o!==nr.GREY32)throw new Error("Unable to transform.");if(h!==nr.GREY)throw new Error("Unable to transform.");_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=n[w]}return ai._onLog&&ai._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),_}getImageData(n,o,h,v,y){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!o||!h)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Bl(ai,ip,"f",rp)&&ai.checkWebGLSupport(),(null==y?void 0:y.bUseWebGL)&&!Bl(ai,ip,"f",rp))throw new Error("Your browser or machine may not support WebGL.");if(v.sx>o||v.sy>h||v.sx+v.sWidth>o||v.sy+v.sHeight>h)throw new Error("Invalid position.");if(n instanceof HTMLVideoElement&&4!==n.readyState||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let _;ai._onLog&&(_=Date.now(),ai._onLog("getImageData(), START: "+_));const b=Math.round(v.sx),w=Math.round(v.sy),I=Math.round(v.sWidth),A=Math.round(v.sHeight),M=Math.round(v.dWidth),F=Math.round(v.dHeight);let V=nr.RGBA;(null==y?void 0:y.pixelFormat)&&(V=y.pixelFormat);let B,Q,J,Z=null;if((null==y?void 0:y.bufferContainer)&&(Z=y.bufferContainer),Bl(ai,ip,"f",rp)&&(this.useWebGLByDefault&&null==(null==y?void 0:y.bUseWebGL)||(null==y?void 0:y.bUseWebGL))){ai._onLog&&ai._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),B=this._reusedWebGLCvs;try{if(Z)if(V===nr.GREY){if(J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}}else Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:Z}),J=new Uint8Array(Z.buffer,0,4*M*F),J=this.transformPixelFormat(J,Q.pixelFormat,V);else V===nr.GREY?((!Bl(this,Ky,"f")||Bl(this,Ky,"f").length<4*M*F)&&Gd(this,Ky,new Uint8Array(4*M*F),"f"),J=new Uint8Array(Bl(this,Ky,"f").buffer,0,4*M*F)):J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V)}catch(re){if("WebGLError"===re.name&&(this.forceLoseContext(),null==(null==y?void 0:y.bUseWebGL)))return ai._onLog&&ai._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},Object.assign({},y,{bUseWebGL:!1}));throw re}}else if(ai._onLog&&ai._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),B=this._reusedCvs,Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:nr.RGBA,bUseWebGL:!1}),J=this.readCvsData(Q.context,{width:M,height:F},null),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}return ai._onLog&&ai._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:J,pixelFormat:V,width:M,height:F,bUseWebGL:Q.bUseWebGL}}convertDataToCvs(n,o,h,v){if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof o||o<=0)throw new Error("Invalid 'width'.");if("number"!=typeof h||h<=0)throw new Error("Invalid 'height'.");const y=document.createElement("canvas");let _;if(y.width=o,y.height=h,v===nr.GREY){_=new Uint8ClampedArray(4*o*h);for(let w=0;w<_.length;w+=4)_[w]=n[w/4],_[w+1]=n[w/4],_[w+2]=n[w/4],_[w+3]=255}else _=new Uint8ClampedArray(n.buffer);const b=new ImageData(_,o,h);return y.getContext("2d").putImageData(b,0,0),y}forceLoseContext(){if(!this._reusedWebGLCvs)return;const n=this._reusedWebGLCvs.ctxWebGL;n&&!n.isContextLost()&&n.getExtension("WEBGL_lose_context")&&n.getExtension("WEBGL_lose_context").loseContext(),Gd(this,qy,null,"f"),Gd(this,fx,null,"f"),Gd(this,px,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Gd(this,UI,!0,"f")}}ip=ai,WI=new WeakMap,qy=new WeakMap,fx=new WeakMap,px=new WeakMap,Ky=new WeakMap,UI=new WeakMap,rp={value:void 0};class bEe{constructor(){_v.set(this,new Map),VI.set(this,!1)}get disposed(){return st(this,VI,"f")}on(n,o){n=n.toLowerCase();const h=st(this,_v,"f").get(n);if(h){if(h.includes(o))return;h.push(o)}else st(this,_v,"f").set(n,[o])}off(n,o){n=n.toLowerCase();const h=st(this,_v,"f").get(n);if(!h)return;const v=h.indexOf(o);-1!==v&&h.splice(v,1)}offAll(n){n=n.toLowerCase();const o=st(this,_v,"f").get(n);o&&(o.length=0)}fire(n,o=[],h={async:!1,copy:!0}){o||(o=[]),n=n.toLowerCase();const v=st(this,_v,"f").get(n);if(v&&v.length){h=Object.assign({async:!1,copy:!0},h);for(let y of v){if(!y)continue;let _=[];if(h.copy)for(let w of o){try{w=JSON.parse(JSON.stringify(w))}catch(I){}_.push(w)}else _=o;let b=!1;if(h.async)setTimeout(()=>{this.disposed||v.includes(y)&&y.apply(h.target,_)},0);else try{b=y.apply(h.target,_)}catch(w){}if(!0===b)break}}}dispose(){tr(this,VI,!0,"f")}}_v=new WeakMap,VI=new WeakMap;const cc=(p,n,o,h)=>{if(!o)return p;let v=n+Math.round((p-n)/o)*o;return h&&(v=Math.min(v,h)),v};class ti{static get version(){return"2.0.13"}static isStorageAvailable(n){let o;try{o=window[n];const h="__storage_test__";return o.setItem(h,h),o.removeItem(h),!0}catch(h){return h instanceof DOMException&&(22===h.code||1014===h.code||"QuotaExceededError"===h.name||"NS_ERROR_DOM_QUOTA_REACHED"===h.name)&&o&&0!==o.length}}static findBestRearCameraInIOS(n,o){if(!n||!n.length)return null;let h=!1;if((null==o?void 0:o.getMainCamera)&&(h=!0),h){const v=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],y=n.find(_=>v.includes(_.label.toLowerCase()));return null==y?void 0:y.deviceId}{const v=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],y=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],_=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],b=n.filter(A=>{const M=A.label.toLowerCase();return v.some(F=>M.includes(F))});if(!b.length)return null;const w=b.find(A=>{const M=A.label.toLowerCase();return y.some(F=>M.includes(F))});if(w)return w.deviceId;const I=b.find(A=>{const M=A.label.toLowerCase();return _.some(F=>M.includes(F))});return I?I.deviceId:b[0].deviceId}}static findBestRearCamera(n,o){if(!n||!n.length)return null;if(["iPhone","iPad","Mac"].includes(ul.OS))return ti.findBestRearCameraInIOS(n,{getMainCamera:null==o?void 0:o.getMainCameraInIOS});const h=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let v of n){const y=v.label.toLowerCase();if(y&&h.some(_=>y.includes(_))&&/\b0(\b)?/.test(y))return v.deviceId}return["Android","HarmonyOS"].includes(ul.OS)?n[n.length-1].deviceId:null}static findBestCamera(n,o,h){return n&&n.length?"environment"===o?this.findBestRearCamera(n,h):"user"===o?null:o?void 0:null:null}static playVideo(n,o,h){return Fe(function*(){if(!n)throw new Error("Invalid 'videoEl'.");if(!o)throw new Error("Invalid 'source'.");return new Promise(function(){var v=Fe(function*(y,_){let b;const w=()=>{n.removeEventListener("loadstart",F),n.removeEventListener("abort",V),n.removeEventListener("play",B),n.removeEventListener("error",Q),n.removeEventListener("loadedmetadata",re)};let I=!1;const A=()=>{I=!0,b&&clearTimeout(b),w(),y(n)},M=se=>{b&&clearTimeout(b),w(),_(se)},F=()=>{n.addEventListener("abort",V,{once:!0})},V=()=>{const se=new Error("Video playing was interrupted.");se.name="AbortError",M(se)},B=()=>{A()},Q=()=>{M(new Error(`Video error ${n.error.code}: ${n.error.message}.`))};let J;const Z=new Promise(se=>{J=se}),re=()=>{J()};if(n.addEventListener("loadstart",F,{once:!0}),n.addEventListener("play",B,{once:!0}),n.addEventListener("error",Q,{once:!0}),n.addEventListener("loadedmetadata",re,{once:!0}),"string"==typeof o||o instanceof String?n.src=o:n.srcObject=o,n.autoplay&&(yield new Promise(se=>{setTimeout(se,1e3)})),!I){h&&(b=setTimeout(()=>{w(),_(new Error("Failed to play video. Timeout."))},h));try{n.src&&(yield n.load()),yield n.play(),A()}catch(se){console.warn("1st play error: "+((null==se?void 0:se.message)||se))}if(!I){yield Z;try{yield n.play(),A()}catch(se){console.warn("2rd play error: "+((null==se?void 0:se.message)||se)),M(se)}}}});return function(y,_){return v.apply(this,arguments)}}())})()}static testCameraAccess(n){return Fe(function*(){var o,h;if(!(null===(h=null===(o=null==window?void 0:window.navigator)||void 0===o?void 0:o.mediaDevices)||void 0===h?void 0:h.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let v;try{v=n?yield navigator.mediaDevices.getUserMedia(n):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(y){return{ok:!1,errorName:y.name,errorMessage:y.message}}finally{null==v||v.getTracks().forEach(y=>{y.stop()})}return{ok:!0}})()}get state(){if(!st(this,Gc,"f"))return"closed";if("pending"===st(this,Gc,"f"))return"opening";if("fulfilled"===st(this,Gc,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(n){n?ti.isStorageAvailable("localStorage")?tr(this,Jy,!0,"f"):(tr(this,Jy,!1,"f"),console.warn("Local storage is unavailable")):tr(this,Jy,!1,"f")}get ifSaveLastUsedCamera(){return st(this,Jy,"f")}get isVideoPlaying(){return!(!st(this,Ei,"f")||st(this,Ei,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(n){var o,h,v;if(!(n instanceof HTMLElement)&&null!=n)throw new TypeError("Invalid 'element'.");null===(o=st(this,Cv,"f"))||void 0===o||o.removeEventListener("click",st(this,e_,"f")),null===(h=st(this,Cv,"f"))||void 0===h||h.removeEventListener("touchend",st(this,e_,"f")),null===(v=st(this,Cv,"f"))||void 0===v||v.removeEventListener("touchmove",st(this,zI,"f")),tr(this,Cv,n,"f"),n&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(ul.OS)?(n.addEventListener("touchend",st(this,e_,"f")),n.addEventListener("touchmove",st(this,zI,"f"))):n.addEventListener("click",st(this,e_,"f")))}get tapFocusEventBoundEl(){return st(this,Cv,"f")}get disposed(){return st(this,XI,"f")}constructor(n){var h,v,o=this;Mn.add(this),Ei.set(this,null),_r.set(this,void 0),jI.set(this,()=>{"opened"===this.state&&st(this,Hs,"f").fire("resumed",null,{target:this,async:!1})}),HI.set(this,()=>{st(this,Hs,"f").fire("paused",null,{target:this,async:!1})}),qr.set(this,void 0),ju.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],op.set(this,void 0),Jy.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,GI.set(this,void 0),Uh.set(this,!0),sp.set(this,void 0),Gc.set(this,void 0),Qy.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Zy.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(y,_)=>{let b,w;const I=window.getComputedStyle(st(this,Ei,"f")).objectFit,A=this.getResolution(),M=st(this,Ei,"f").getBoundingClientRect(),F=M.left,V=M.top,{width:B,height:Q}=st(this,Ei,"f").getBoundingClientRect();if(B<=0||Q<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const J=B/Q,Z=A.width/A.height;let re=1;if("contain"===I)Z>J?(re=B/A.width,b=(y-F)/re,w=(_-V-(Q-B/Z)/2)/re):(re=Q/A.height,w=(_-V)/re,b=(y-F-(B-Q*Z)/2)/re);else{if("cover"!==I)throw new Error("Unsupported object-fit.");Z>J?(re=Q/A.height,w=(_-V)/re,b=(y-F+(Q*Z-B)/2)/re):(re=B/A.width,b=(y-F)/re,w=(_-V+(B/Z-Q)/2)/re)}return{x:b,y:w}},gx.set(this,!1),zI.set(this,()=>{tr(this,gx,!0,"f")}),e_.set(this,function(){var y=Fe(function*(_){var b;if(st(o,gx,"f"))return void tr(o,gx,!1,"f");if(!(st(o,Zy,"f")&&o.isVideoPlaying&&st(o,_r,"f")&&o._focusSupported))return;if(!o._focusParameters.fds&&(o._focusParameters.fds=null===(b=o.getCameraCapabilities())||void 0===b?void 0:b.focusDistance,!o._focusParameters.fds))return void(o._focusSupported=!1);if(null==o._focusParameters.kTimeout&&(o._focusParameters.kTimeout=(o._focusParameters.maxTimeout-o._focusParameters.minTimeout)/(1/o._focusParameters.fds.min-1/o._focusParameters.fds.max)),1==o._focusParameters.isDoingFocus)return;let w,I;if(o._focusParameters.taskBackToContinous&&(clearTimeout(o._focusParameters.taskBackToContinous),o._focusParameters.taskBackToContinous=null),_ instanceof MouseEvent)w=_.clientX,I=_.clientY;else{if(!(_ instanceof TouchEvent))throw new Error("Unknown event type.");if(!_.changedTouches.length)return;w=_.changedTouches[0].clientX,I=_.changedTouches[0].clientY}const A=o.getResolution(),M=2*Math.round(Math.min(A.width,A.height)/o._focusParameters.defaultFocusAreaSizeRatio/2);let F;try{F=o.calculateCoordInVideo(w,I)}catch(Z){}if(F.x<0||F.x>A.width||F.y<0||F.y>A.height)return;const V={x:F.x+"px",y:F.y+"px"},B=M+"px",Q=B;let J;ti._onLog&&(J=Date.now());try{yield st(o,Mn,"m",iO).call(o,V,B,Q,o._focusParameters.tapFocusMinDistance,o._focusParameters.tapFocusMaxDistance)}catch(Z){if(ti._onLog)throw ti._onLog(Z),Z}ti._onLog&&ti._onLog(`Tap focus costs: ${Date.now()-J} ms`),o._focusParameters.taskBackToContinous=setTimeout(()=>{var Z;ti._onLog&&ti._onLog("Back to continuous focus."),null===(Z=st(o,_r,"f"))||void 0===Z||Z.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},o._focusParameters.focusBackToContinousTime),st(o,Hs,"f").fire("tapfocus",null,{target:o,async:!1})});return function(_){return y.apply(this,arguments)}}()),Cv.set(this,null),ap.set(this,1),lp.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!st(this,Ei,"f"))return;const y=st(this,ap,"f");if(y<1)throw new RangeError("Invalid scale value.");if(1===y)st(this,Ei,"f").style.transform="";else{const _=window.getComputedStyle(st(this,Ei,"f")).objectFit,b=st(this,Ei,"f").videoWidth,w=st(this,Ei,"f").videoHeight,{width:I,height:A}=st(this,Ei,"f").getBoundingClientRect();if(I<=0||A<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const M=I/A,F=b/w;let V=1;"contain"===_?V=M<F?I/(b/y):A/(w/y):"cover"===_&&(V=F>M?A/(b/y):I/(w/y));const B=V*(1-1/y)*(b/2-st(this,lp,"f").x),Q=V*(1-1/y)*(w/2-st(this,lp,"f").y);st(this,Ei,"f").style.transform=`translate(${B}px, ${Q}px) scale(${y})`}},Z4.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const y=document.createElement("canvas");let _;if(y.width=this.width,y.height=this.height,this.pixelFormat===nr.GREY){_=new Uint8ClampedArray(this.width*this.height*4);for(let w=0;w<_.length;w+=4)_[w]=this.data[w/4],_[w+1]=this.data[w/4],_[w+2]=this.data[w/4],_[w+3]=255}else _=new Uint8ClampedArray(this.data.buffer);const b=new ImageData(_,this.width,this.height);return y.getContext("2d").putImageData(b,0,0),y}),Hs.set(this,void 0),eO.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],bv.set(this,new Map),SK.set(this,!1),YI.set(this,Fe(function*(){var y,_;if("visible"===document.visibilityState){if(ti._onLog&&ti._onLog("document visible. video paused: "+(null===(y=st(o,Ei,"f"))||void 0===y?void 0:y.paused)),"opening"==o.state||"opened"==o.state){let b=!1;if(!o.isVideoPlaying){ti._onLog&&ti._onLog("document visible. Not auto resume. 1st resume start.");try{yield o.resume(),b=!0}catch(w){ti._onLog&&ti._onLog("document visible. 1st resume video failed, try open instead.")}b||(yield st(o,Mn,"m",t_).call(o))}if(yield new Promise(w=>setTimeout(w,300)),!o.isVideoPlaying){ti._onLog&&ti._onLog("document visible. 1st open failed. 2rd resume start."),b=!1;try{yield o.resume(),b=!0}catch(w){ti._onLog&&ti._onLog("document visible. 2rd resume video failed, try open instead.")}b||(yield st(o,Mn,"m",t_).call(o))}}}else"hidden"===document.visibilityState&&(ti._onLog&&ti._onLog("document hidden. video paused: "+(null===(_=st(o,Ei,"f"))||void 0===_?void 0:_.paused)),"opening"==o.state||"opened"==o.state&&o.isVideoPlaying&&o.pause())})),XI.set(this,!1),(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia)||setTimeout(()=>{ti.onWarning&&ti.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),n instanceof HTMLVideoElement&&this.setVideoEl(n),tr(this,Hs,new bEe,"f"),this.imageDataGetter=new ai,document.addEventListener("visibilitychange",st(this,YI,"f"))}setVideoEl(n){if(!(n&&n instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");n.addEventListener("play",st(this,jI,"f")),n.addEventListener("pause",st(this,HI,"f")),tr(this,Ei,n,"f")}getVideoEl(){return st(this,Ei,"f")}releaseVideoEl(){var n,o;null===(n=st(this,Ei,"f"))||void 0===n||n.removeEventListener("play",st(this,jI,"f")),null===(o=st(this,Ei,"f"))||void 0===o||o.removeEventListener("pause",st(this,HI,"f")),tr(this,Ei,null,"f")}isVideoLoaded(){return!!st(this,Ei,"f")&&4==st(this,Ei,"f").readyState}open(){var n=this;return Fe(function*(){if(st(n,sp,"f")&&!st(n,Uh,"f")){if("pending"===st(n,Gc,"f"))return st(n,sp,"f");if("fulfilled"===st(n,Gc,"f"))return}st(n,Hs,"f").fire("before:open",null,{target:n}),yield st(n,Mn,"m",t_).call(n),st(n,Hs,"f").fire("played",null,{target:n,async:!1}),st(n,Hs,"f").fire("opened",null,{target:n,async:!1})})()}close(){var n=this;return Fe(function*(){if("closed"===n.state)return;st(n,Hs,"f").fire("before:close",null,{target:n});const o=st(n,sp,"f");if(st(n,Mn,"m",$I).call(n),o&&"pending"===st(n,Gc,"f")){try{yield o}catch(h){}if(!1===st(n,Uh,"f")){const h=new Error("'close()' was interrupted.");throw h.name="AbortError",h}}tr(n,sp,null,"f"),tr(n,Gc,null,"f"),st(n,Hs,"f").fire("closed",null,{target:n,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");st(this,Ei,"f").pause()}resume(){var n=this;return Fe(function*(){if(!n.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==n.state)throw new Error("Camera or video is not open.");yield st(n,Ei,"f").play()})()}setCamera(n){var o=this;return Fe(function*(){if("string"!=typeof n)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof st(o,qr,"f").video&&(st(o,qr,"f").video={}),delete st(o,qr,"f").video.facingMode,st(o,qr,"f").video.deviceId={exact:n},!("closed"===o.state||o.videoSrc||"opening"===o.state&&st(o,Uh,"f"))){st(o,Hs,"f").fire("before:camera:change",[],{target:o,async:!1}),yield st(o,Mn,"m",mx).call(o);try{o.resetSoftwareScale()}catch(h){}return st(o,ju,"f")}})()}switchToFrontCamera(n){var o=this;return Fe(function*(){if("object"!=typeof st(o,qr,"f").video&&(st(o,qr,"f").video={}),(null==n?void 0:n.resolution)&&(st(o,qr,"f").video.width={ideal:n.resolution.width},st(o,qr,"f").video.height={ideal:n.resolution.height}),delete st(o,qr,"f").video.deviceId,st(o,qr,"f").video.facingMode={exact:"user"},tr(o,op,null,"f"),!("closed"===o.state||o.videoSrc||"opening"===o.state&&st(o,Uh,"f"))){st(o,Hs,"f").fire("before:camera:change",[],{target:o,async:!1}),st(o,Mn,"m",mx).call(o);try{o.resetSoftwareScale()}catch(h){}return st(o,ju,"f")}})()}getCamera(){var n;if(st(this,ju,"f"))return st(this,ju,"f");{let o=(null===(n=st(this,qr,"f").video)||void 0===n?void 0:n.deviceId)||"";if(o){o=o.exact||o.ideal||o;for(let h of this._arrCameras)if(h.deviceId===o)return JSON.parse(JSON.stringify(h))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(n){var o=this;return Fe(function*(){var h,v;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let y;if(n){let w=yield navigator.mediaDevices.getUserMedia({video:!0});y=(yield navigator.mediaDevices.enumerateDevices()).filter(I=>"videoinput"===I.kind),w.getTracks().forEach(I=>{I.stop()})}else y=(yield navigator.mediaDevices.enumerateDevices()).filter(w=>"videoinput"===w.kind);const _=[],b=[];if(o._arrCameras)for(let w of o._arrCameras)w._checked&&b.push(w);for(let w=0;w<y.length;w++){let I,A=y[w];for(let M of b)if(A.deviceId==M.deviceId){I=M;break}I||(I={deviceId:A.deviceId,label:A.label?A.label:"camera "+w,_checked:!1}),I.deviceId&&_.push(I)}return o._arrCameras=_,ti._onLog&&ti._onLog(JSON.stringify(o._arrCameras)),_})()}getCameras(){var n=this;return Fe(function*(){var o,h;if(!(null===(h=null===(o=null==window?void 0:window.navigator)||void 0===o?void 0:o.mediaDevices)||void 0===h?void 0:h.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const v=(yield navigator.mediaDevices.enumerateDevices()).filter(y=>"videoinput"===y.kind);return n._getCameras(!(!v||!v.length||v[0].deviceId))})()}getAllCameras(){var n=this;return Fe(function*(){return n.getCameras()})()}setResolution(n,o,h){var v=this;return Fe(function*(){if("number"!=typeof n||n<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof o||o<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof st(v,qr,"f").video&&(st(v,qr,"f").video={}),h?(st(v,qr,"f").video.width={exact:n},st(v,qr,"f").video.height={exact:o}):(st(v,qr,"f").video.width={ideal:n},st(v,qr,"f").video.height={ideal:o}),"closed"===v.state||v.videoSrc||"opening"===v.state&&st(v,Uh,"f"))return null;st(v,Hs,"f").fire("before:resolution:change",[],{target:v,async:!1}),yield st(v,Mn,"m",mx).call(v);try{v.resetSoftwareScale()}catch(_){}const y=v.getResolution();return{width:y.width,height:y.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&st(this,Ei,"f"))return{width:st(this,Ei,"f").videoWidth,height:st(this,Ei,"f").videoHeight};if(st(this,_r,"f")){const n=st(this,_r,"f").getSettings();return{width:n.width,height:n.height}}if(this.isVideoLoaded())return{width:st(this,Ei,"f").videoWidth,height:st(this,Ei,"f").videoHeight};{const n={width:0,height:0};let o=st(this,qr,"f").video.width||0,h=st(this,qr,"f").video.height||0;return o&&(n.width=o.exact||o.ideal||o),h&&(n.height=h.exact||h.ideal||h),n}}getResolutions(n){var o=this;return Fe(function*(){var h,v,y,_,b,w,I,A,M,F,V;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let B="";const Q=(J,Z)=>{const re=st(o,bv,"f").get(J);if(!re||!re.length)return!1;for(let se of re)if(se.width===Z.width&&se.height===Z.height)return!0;return!1};if(o._mediaStream){B=null===(V=st(o,ju,"f"))||void 0===V?void 0:V.deviceId;let J=st(o,bv,"f").get(B);if(J&&!n)return JSON.parse(JSON.stringify(J));J=[],st(o,bv,"f").set(B,J),tr(o,Qy,!0,"f");try{for(let Z of o.detectedResolutions){yield st(o,_r,"f").applyConstraints({width:{ideal:Z.width},height:{ideal:Z.height}}),st(o,Mn,"m",zd).call(o);const re=st(o,_r,"f").getSettings(),se={width:re.width,height:re.height};Q(B,se)||J.push({width:se.width,height:se.height})}}catch(Z){throw st(o,Mn,"m",$I).call(o),tr(o,Qy,!1,"f"),Z}try{yield st(o,Mn,"m",t_).call(o)}catch(Z){if("AbortError"===Z.name)return J;throw Z}finally{tr(o,Qy,!1,"f")}return J}{const J=function(){var se=Fe(function*(ce,pe,Ce){const Ve={video:{deviceId:{exact:ce},width:{ideal:pe},height:{ideal:Ce}}};let te=null;try{te=yield navigator.mediaDevices.getUserMedia(Ve)}catch(Le){return null}if(!te)return null;const Me=te.getVideoTracks();let we=null;try{const Le=Me[0].getSettings();we={width:Le.width,height:Le.height}}catch(Le){const j=document.createElement("video");j.srcObject=te,we={width:j.videoWidth,height:j.videoHeight},j.srcObject=null}return Me.forEach(Le=>{Le.stop()}),we});return function(pe,Ce,Ve){return se.apply(this,arguments)}}();let Z=(null===(b=null===(_=null===(y=st(o,qr,"f"))||void 0===y?void 0:y.video)||void 0===_?void 0:_.deviceId)||void 0===b?void 0:b.exact)||(null===(A=null===(I=null===(w=st(o,qr,"f"))||void 0===w?void 0:w.video)||void 0===I?void 0:I.deviceId)||void 0===A?void 0:A.ideal)||(null===(F=null===(M=st(o,qr,"f"))||void 0===M?void 0:M.video)||void 0===F?void 0:F.deviceId);if(!Z)return[];let re=st(o,bv,"f").get(Z);if(re&&!n)return JSON.parse(JSON.stringify(re));re=[],st(o,bv,"f").set(Z,re);for(let se of o.detectedResolutions){const ce=yield J(Z,se.width,se.height);ce&&!Q(Z,ce)&&re.push({width:ce.width,height:ce.height})}return re}})()}setMediaStreamConstraints(n,o){var h=this;return Fe(function*(){if(null===(v=n)||"[object Object]"!==Object.prototype.toString.call(v))throw new TypeError("Invalid 'mediaStreamConstraints'.");var v;tr(h,qr,JSON.parse(JSON.stringify(n)),"f"),tr(h,op,null,"f"),o&&st(h,Mn,"m",mx).call(h)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(st(this,qr,"f")))}resetMediaStreamConstraints(){tr(this,qr,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!st(this,_r,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return st(this,_r,"f").getCapabilities?st(this,_r,"f").getCapabilities():{}}getCameraSettings(){if(!st(this,_r,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return st(this,_r,"f").getSettings()}turnOnTorch(){var n=this;return Fe(function*(){if(!st(n,_r,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const o=n.getCameraCapabilities();if(!(null==o?void 0:o.torch))throw Error("Not supported.");yield st(n,_r,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var n=this;return Fe(function*(){if(!st(n,_r,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const o=n.getCameraCapabilities();if(!(null==o?void 0:o.torch))throw Error("Not supported.");yield st(n,_r,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!st(h,_r,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.colorTemperature;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=cc(n,y.min,y.step,y.max)),yield st(h,_r,"f").applyConstraints({advanced:[{colorTemperature:n,whiteBalanceMode:"manual"}]}),n})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!st(h,_r,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.exposureCompensation;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=cc(n,y.min,y.step,y.max)),yield st(h,_r,"f").applyConstraints({advanced:[{exposureCompensation:n}]}),n})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!st(h,_r,"f")||"opened"!==h.state)throw new Error("Camera is not open.");let y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.frameRate;if(!y)throw Error("Not supported.");o&&(n<y.min?n=y.min:n>y.max&&(n=y.max));const _=h.getResolution();return yield st(h,_r,"f").applyConstraints({width:{ideal:Math.max(_.width,_.height)},frameRate:n}),n})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(n,o){var h=this;return Fe(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if(!st(h,_r,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const v=h.getCameraCapabilities(),y=null==v?void 0:v.focusMode,_=null==v?void 0:v.focusDistance;if(!y)throw Error("Not supported.");if("string"!=typeof n.mode)throw TypeError("Invalid 'mode'.");const b=n.mode.toLowerCase();if(!y.includes(b))throw Error("Unsupported focus mode.");if("manual"===b){if(!_)throw Error("Manual focus unsupported.");if(n.hasOwnProperty("distance")){let w=n.distance;o&&(w<_.min?w=_.min:w>_.max&&(w=_.max),w=cc(w,_.min,_.step,_.max)),h._focusParameters.focusArea=null,yield st(h,_r,"f").applyConstraints({advanced:[{focusMode:b,focusDistance:w}]})}else{if(!n.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const w=n.area.centerPoint;let I=n.area.width,A=n.area.height;if(!I||!A){const M=h.getResolution();I||(I=2*Math.round(Math.min(M.width,M.height)/h._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),A||(A=2*Math.round(Math.min(M.width,M.height)/h._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}h._focusParameters.focusArea={centerPoint:{x:w.x,y:w.y},width:I,height:A},yield st(h,Mn,"m",iO).call(h,w,I,A)}}}else h._focusParameters.focusArea=null,yield st(h,_r,"f").applyConstraints({advanced:[{focusMode:b}]})})()}getFocus(){const n=this.getCameraSettings(),o=n.focusMode;return o?"manual"===o?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:n.focusDistance}:{mode:o}:null}enableTapToFocus(){var n=this;return Fe(function*(){tr(n,Zy,!0,"f")})()}disableTapToFocus(){tr(this,Zy,!1,"f")}isTapToFocusEnabled(){return st(this,Zy,"f")}setZoom(n){var o=this;return Fe(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if("number"!=typeof n.factor)throw new TypeError("Illegal type of 'factor'.");if(n.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==o.state)throw new Error("Video is not playing.");n.centerPoint?st(o,Mn,"m",rO).call(o,n.centerPoint):o.resetScaleCenter();try{if(st(o,Mn,"m",IK).call(o,st(o,lp,"f"))){const h=yield o.setHardwareScale(n.factor,!0);let v=o.getHardwareScale();1==v&&1!=h&&(v=h),o.setSoftwareScale(n.factor>v?n.factor/v:1)}else yield o.setHardwareScale(1),o.setSoftwareScale(n.factor)}catch(h){const v=h.message||h;if("Not supported."!==v&&"Camera is not open."!==v)throw h;o.setSoftwareScale(n.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let n=1;try{n=this.getHardwareScale()}catch(o){if("Camera is not open."!==(o.message||o))throw o}return{factor:n*st(this,ap,"f")}}resetZoom(){var n=this;return Fe(function*(){yield n.setZoom({factor:1})})()}setHardwareScale(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if(!st(h,_r,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.zoom;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=cc(n,y.min,y.step,y.max)),yield st(h,_r,"f").applyConstraints({advanced:[{zoom:n}]}),n})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(n,o){if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");o&&st(this,Mn,"m",rO).call(this,o),tr(this,ap,n,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return st(this,ap,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();tr(this,lp,{x:n.width/2,y:n.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(n){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||st(this,Qy,"f"))return null;const o=Date.now();ti._onLog&&ti._onLog("getFrameData() START: "+o);const h=st(this,Ei,"f").videoWidth,v=st(this,Ei,"f").videoHeight;let y={sx:0,sy:0,sWidth:h,sHeight:v,dWidth:h,dHeight:v};(null==n?void 0:n.position)&&(y=JSON.parse(JSON.stringify(n.position)));let _=nr.RGBA;(null==n?void 0:n.pixelFormat)&&(_=n.pixelFormat);let b=st(this,ap,"f");(null==n?void 0:n.scale)&&(b=n.scale);let w=st(this,lp,"f");if(null==n?void 0:n.scaleCenter){if("string"!=typeof n.scaleCenter.x||"string"!=typeof n.scaleCenter.y)throw new Error("Invalid scale center.");let F=0,V=0;if(n.scaleCenter.x.endsWith("px"))F=parseFloat(n.scaleCenter.x);else{if(!n.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");F=parseFloat(n.scaleCenter.x)/100*h}if(n.scaleCenter.y.endsWith("px"))V=parseFloat(n.scaleCenter.y);else{if(!n.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");V=parseFloat(n.scaleCenter.y)/100*v}if(isNaN(F)||isNaN(V))throw new Error("Invalid scale center.");w.x=Math.round(F),w.y=Math.round(V)}let I=null;if((null==n?void 0:n.bufferContainer)&&(I=n.bufferContainer),0==h||0==v)return null;1!==b&&(y.sWidth=Math.round(y.sWidth/b),y.sHeight=Math.round(y.sHeight/b),y.sx=Math.round((1-1/b)*w.x+y.sx/b),y.sy=Math.round((1-1/b)*w.y+y.sy/b));const A=this.imageDataGetter.getImageData(st(this,Ei,"f"),h,v,y,{pixelFormat:_,bufferContainer:I});if(!A)return null;const M=Date.now();return ti._onLog&&ti._onLog("getFrameData() END: "+M),{data:A.data,width:A.width,height:A.height,pixelFormat:A.pixelFormat,timeSpent:M-o,timeStamp:M,toCanvas:st(this,Z4,"f")}}on(n,o){if(!st(this,eO,"f").includes(n.toLowerCase()))throw new Error(`Event '${n}' does not exist.`);st(this,Hs,"f").on(n,o)}off(n,o){st(this,Hs,"f").off(n,o)}dispose(){var n=this;return Fe(function*(){n.tapFocusEventBoundEl=null,yield n.close(),n.releaseVideoEl(),st(n,Hs,"f").dispose(),n.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",st(n,YI,"f")),tr(n,XI,!0,"f")})()}}var vx,qI,i_,xv,KI,r_,EK,DK,Yc,yx,_x,oO,sO,ir,aO,lO,Cx,cp,JI,QI,ZI,bx,wv,eE,up,Xc,Oo,Nn,Vh,cO,Kr,AK,PK,uO,dO;Ei=new WeakMap,_r=new WeakMap,jI=new WeakMap,HI=new WeakMap,qr=new WeakMap,ju=new WeakMap,op=new WeakMap,Jy=new WeakMap,GI=new WeakMap,Uh=new WeakMap,sp=new WeakMap,Gc=new WeakMap,Qy=new WeakMap,Zy=new WeakMap,gx=new WeakMap,zI=new WeakMap,e_=new WeakMap,Cv=new WeakMap,ap=new WeakMap,lp=new WeakMap,Z4=new WeakMap,Hs=new WeakMap,eO=new WeakMap,bv=new WeakMap,SK=new WeakMap,YI=new WeakMap,XI=new WeakMap,Mn=new WeakSet,TK=function(){var p=Fe(function*(){var n=this;const o=this.getMediaStreamConstraints();if("boolean"==typeof o.video&&(o.video={}),!o.video.deviceId)if(st(this,op,"f"))delete o.video.facingMode,o.video.deviceId={exact:st(this,op,"f")};else if(this.ifSaveLastUsedCamera&&ti.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete o.video.facingMode,o.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const h=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),v=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));h&&v&&(o.video.width=h,o.video.height=v)}else if(!this.ifSkipCameraInspection){const h=function(){var _=Fe(function*(b){let w=null;return"environment"===b&&["Android","HarmonyOS","iPhone","iPad"].includes(ul.OS)?(yield n._getCameras(!1),st(n,Mn,"m",zd).call(n),w=ti.findBestCamera(n._arrCameras,"environment",{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})):b||["Android","HarmonyOS","iPhone","iPad"].includes(ul.OS)||(yield n._getCameras(!1),st(n,Mn,"m",zd).call(n),w=ti.findBestCamera(n._arrCameras,null,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})),w});return function(w){return _.apply(this,arguments)}}();let v=o.video.facingMode;v instanceof Array&&v.length&&(v=v[0]),"object"==typeof v&&(v=v.exact||v.ideal);const y=yield h(v);y&&(delete o.video.facingMode,o.video.deviceId={exact:y})}return o});return function(){return p.apply(this,arguments)}}(),zd=function(){if(st(this,Uh,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},tO=function(){var p=Fe(function*(n){var h,v,o=this;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let y;try{ti._onLog&&ti._onLog("======try getUserMedia========");let _=[0,500,1e3,2e3],b=null;const w=function(){var I=Fe(function*(A){for(let M of _){M&&(yield new Promise(F=>setTimeout(F,M)),st(o,Mn,"m",zd).call(o));try{ti._onLog&&ti._onLog("ask "+JSON.stringify(A)),y=yield navigator.mediaDevices.getUserMedia(A),st(o,Mn,"m",zd).call(o);break}catch(F){if("NotFoundError"===F.name||"NotAllowedError"===F.name||"AbortError"===F.name||"OverconstrainedError"===F.name)throw F;b=F,ti._onLog&&ti._onLog(F.message||F)}}});return function(M){return I.apply(this,arguments)}}();if(yield w(n),y||"object"!=typeof n.video||(n.video.deviceId&&(delete n.video.deviceId,yield w(n)),!y&&n.video.facingMode&&(delete n.video.facingMode,yield w(n)),y||!n.video.width&&!n.video.height||(delete n.video.width,delete n.video.height,yield w(n))),!y)throw b;return y}catch(_){throw null==y||y.getTracks().forEach(b=>{b.stop()}),"NotFoundError"===_.name&&(DOMException?_=new DOMException("No camera available, please use a device with an accessible camera.",_.name):(_=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),_}});return function(o){return p.apply(this,arguments)}}(),nO=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),tr(this,_r,null,"f")},t_=function(){var p=Fe(function*(){var n=this;tr(this,Uh,!1,"f");const o=tr(this,GI,Symbol(),"f");if(st(this,sp,"f")&&"pending"===st(this,Gc,"f")){try{yield st(this,sp,"f")}catch(v){}st(this,Mn,"m",zd).call(this)}return o!==st(this,GI,"f")?void 0:tr(this,sp,Fe(function*(){tr(n,Gc,"pending","f");try{if(n.videoSrc){if(!st(n,Ei,"f"))throw new Error("'videoEl' should be set.");yield ti.playVideo(st(n,Ei,"f"),n.videoSrc,n.cameraOpenTimeout),st(n,Mn,"m",zd).call(n)}else{let v=yield st(n,Mn,"m",TK).call(n);st(n,Mn,"m",nO).call(n);let y=yield st(n,Mn,"m",tO).call(n,v);yield n._getCameras(!1),st(n,Mn,"m",zd).call(n);const _=()=>{const A=y.getVideoTracks();let M,F;if(A.length&&(M=A[0]),M){const V=M.getSettings();if(V)for(let B of n._arrCameras)if(V.deviceId===B.deviceId){B._checked=!0,B.label=M.label,F=B;break}}return F},b=st(n,qr,"f");if("object"==typeof b.video){let A=b.video.facingMode;if(A instanceof Array&&A.length&&(A=A[0]),"object"==typeof A&&(A=A.exact||A.ideal),!(st(n,op,"f")||n.ifSaveLastUsedCamera&&ti.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||n.ifSkipCameraInspection||b.video.deviceId)){const M=_(),F=ti.findBestCamera(n._arrCameras,A,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault});F&&F!=(null==M?void 0:M.deviceId)&&(y.getTracks().forEach(V=>{V.stop()}),v.video.deviceId={exact:F},y=yield st(n,Mn,"m",tO).call(n,v),st(n,Mn,"m",zd).call(n))}}const w=_();(null==w?void 0:w.deviceId)&&(tr(n,op,w&&w.deviceId,"f"),n.ifSaveLastUsedCamera&&ti.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",st(n,op,"f")),"object"==typeof v.video&&v.video.width&&v.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(v.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(v.video.height))))),st(n,Ei,"f")&&(yield ti.playVideo(st(n,Ei,"f"),y,n.cameraOpenTimeout),st(n,Mn,"m",zd).call(n)),n._mediaStream=y;const I=y.getVideoTracks();(null==I?void 0:I.length)&&tr(n,_r,I[0],"f"),tr(n,ju,w,"f")}}catch(v){throw st(n,Mn,"m",$I).call(n),tr(n,Gc,null,"f"),v}tr(n,Gc,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),mx=function(){var p=Fe(function*(){var n;if("closed"===this.state||this.videoSrc)return;const o=null===(n=st(this,ju,"f"))||void 0===n?void 0:n.deviceId,h=this.getResolution();yield st(this,Mn,"m",t_).call(this);const v=this.getResolution();o&&o!==st(this,ju,"f").deviceId&&st(this,Hs,"f").fire("camera:changed",[st(this,ju,"f").deviceId,o],{target:this,async:!1}),h.width==v.width&&h.height==v.height||st(this,Hs,"f").fire("resolution:changed",[{width:v.width,height:v.height},{width:h.width,height:h.height}],{target:this,async:!1}),st(this,Hs,"f").fire("played",null,{target:this,async:!1})});return function(){return p.apply(this,arguments)}}(),$I=function(){st(this,Mn,"m",nO).call(this),tr(this,ju,null,"f"),st(this,Ei,"f")&&(st(this,Ei,"f").srcObject=null,this.videoSrc&&(st(this,Ei,"f").pause(),st(this,Ei,"f").currentTime=0)),tr(this,Uh,!0,"f");try{this.resetSoftwareScale()}catch(p){}},zc=function(){var p=Fe(function*(o,h){const v=J=>{if(!st(this,_r,"f")||!this.isVideoPlaying||J.focusTaskId!=this._focusParameters.curFocusTaskId){st(this,_r,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const Z=new Error(`Focus task ${J.focusTaskId} canceled.`);throw Z.name="DeprecatedTaskError",Z}1===this._focusParameters.isDoingFocus&&Date.now()-J.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let y;h=cc(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield st(this,_r,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]}),v(o),y=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/h),Math.abs(1/this._focusParameters.fds.max-1/h))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/h)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=h,yield new Promise(J=>{setTimeout(J,y)}),v(o);let _=o.focusL-o.focusW/2,b=o.focusT-o.focusH/2,w=o.focusW,I=o.focusH;const A=this.getResolution();_=Math.round(_),b=Math.round(b),w=Math.round(w),I=Math.round(I),w>A.width&&(w=A.width),I>A.height&&(I=A.height),_<0?_=0:_+w>A.width&&(_=A.width-w),b<0?b=0:b+I>A.height&&(b=A.height-I);const M=4*A.width*A.height*this._focusParameters.defaultTempBufferContainerLenRatio,F=4*w*I;let V=this._focusParameters.tempBufferContainer;if(V){const J=V.length;M>J&&M>=F?V=new Uint8Array(M):F>J&&F>=M&&(V=new Uint8Array(F))}else V=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(M,F));if(!this.imageDataGetter.getImageData(st(this,Ei,"f"),A.width,A.height,{sx:_,sy:b,sWidth:w,sHeight:I,dWidth:w,dHeight:I},{pixelFormat:nr.RGBA,bufferContainer:V}))return st(this,Mn,"m",n).call(this,o,h);const B=V;let Q=0;for(let J=0,Z=F-8;J<Z;++J){let re=B[J]-B[J+8];++J;let se=B[J]-B[J+8];++J;let ce=B[J]-B[J+8];++J,Q+=re*re+se*se+ce*ce}return-Q});function n(o,h){return p.apply(this,arguments)}return n}(),n_=function(){var p=Fe(function*(o,h,v,y,_,b,w){let I;if(h=cc(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y=cc(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b?b=cc(b,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(b=cc(Math.sqrt((h||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),w=yield st(this,Mn,"m",zc).call(this,o,b)),w<=v&&w<=_?I=3:v<_&&v<w?I=1:_<v&&_<w&&(I=2),(y-h)/2<=this._focusParameters.fds.step)return 3===I||(1===I?yield st(this,_r,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]}):2===I&&(yield st(this,_r,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:y}]}))),!0;if(1===I)return yield st(this,Mn,"m",n).call(this,o,h,v,b,w);if(2===I)return yield st(this,Mn,"m",n).call(this,o,b,w,y,_);if(3!==I)return v=yield st(this,Mn,"m",zc).call(this,o,h),_=yield st(this,Mn,"m",zc).call(this,o,y),yield st(this,Mn,"m",n).call(this,o,h,v,y,_);let A=cc(Math.sqrt((h||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),M=cc(Math.sqrt((y||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/A)<=Math.abs(1/this._focusParameters.oldDistance-1/M)){let F=yield st(this,Mn,"m",zc).call(this,o,A);if(F<w)return yield st(this,Mn,"m",n).call(this,o,h,v,b,w,A,F);if(F==w)return yield st(this,Mn,"m",n).call(this,o,A,F,b,w);let V=yield st(this,Mn,"m",zc).call(this,o,M);if(F>w&&w<V)return yield st(this,Mn,"m",n).call(this,o,A,F,M,V,b,w);if(w==V)return yield st(this,Mn,"m",n).call(this,o,b,w,M,V);if(w>V)return yield st(this,Mn,"m",n).call(this,o,b,w,y,_,M,V)}else{let F=yield st(this,Mn,"m",zc).call(this,o,M);if(w>F)return yield st(this,Mn,"m",n).call(this,o,b,w,y,_,M,F);if(w==F)return yield st(this,Mn,"m",n).call(this,o,b,w,M,F);let V=yield st(this,Mn,"m",zc).call(this,o,A);if(V>w&&w<F)return yield st(this,Mn,"m",n).call(this,o,A,V,M,F,b,w);if(V==w)return yield st(this,Mn,"m",n).call(this,o,A,V,b,w);if(V<w)return yield st(this,Mn,"m",n).call(this,o,h,v,b,w,A,V)}return!1});function n(o,h,v,y,_,b,w){return p.apply(this,arguments)}return n}(),iO=function(){var p=Fe(function*(n,o,h,v,y){var b,_=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!n||"string"!=typeof n.x||"string"!=typeof n.y)throw new Error("Invalid 'centerPoint'.");if(!o||"string"!=typeof o)throw new Error("Invalid 'width'.");if(!h||"string"!=typeof h)throw new Error("Invalid 'height'.");const w=this.getResolution();let I=0,A=0;if(n.x.endsWith("px"))I=parseFloat(n.x);else{if(!n.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");I=parseFloat(n.x)/100*w.width}if(n.y.endsWith("px"))A=parseFloat(n.y);else{if(!n.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");A=parseFloat(n.y)/100*w.height}if(isNaN(I)||isNaN(A)||I<0||I>w.width||A<0||A>w.height)throw new Error("Invalid 'centerPoint'.");let M=0;if(o.endsWith("px"))M=parseFloat(o);else{if(!o.endsWith("%"))throw new Error("Invalid 'width'.");M=parseFloat(o)/100*w.width}if(isNaN(M)||M<0)throw new Error("Invalid 'width'.");let F=0;if(h.endsWith("px"))F=parseFloat(h);else{if(!h.endsWith("%"))throw new Error("Invalid 'height'.");F=parseFloat(h)/100*w.height}if(isNaN(F)||F<0)throw new Error("Invalid 'height'.");if(1!==st(this,ap,"f")){const Q=st(this,ap,"f"),J=st(this,lp,"f");M/=Q,F/=Q,I=(1-1/Q)*J.x+I/Q,A=(1-1/Q)*J.y+A/Q}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(b=this.getCameraCapabilities())||void 0===b?void 0:b.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const V={focusL:I,focusT:A,focusW:M,focusH:F,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},B=function(){var Q=Fe(function*(J,Z,re){try{(null==Z||Z<_._focusParameters.fds.min)&&(Z=_._focusParameters.fds.min),(null==re||re>_._focusParameters.fds.max)&&(re=_._focusParameters.fds.max),_._focusParameters.oldDistance=null;let se=cc(Math.sqrt(re*(Z||_._focusParameters.fds.step)),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),ce=cc(Math.sqrt((Z||_._focusParameters.fds.step)*se),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),pe=cc(Math.sqrt(se*re),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),Ce=yield st(_,Mn,"m",zc).call(_,J,pe),Ve=yield st(_,Mn,"m",zc).call(_,J,ce),te=yield st(_,Mn,"m",zc).call(_,J,se);if(Ve>te&&te<Ce){const Me=yield st(_,Mn,"m",n_).call(_,J,ce,Ve,pe,Ce,se,te);return _._focusParameters.isDoingFocus=0,Me}if(Ve<te&&Ve<Ce){let Me=yield st(_,Mn,"m",zc).call(_,J,Z);const we=yield st(_,Mn,"m",n_).call(_,J,Z,Me,se,te,ce,Ve);return _._focusParameters.isDoingFocus=0,we}if(te>Ce&&Ve>Ce){let Me=yield st(_,Mn,"m",zc).call(_,J,re);const we=yield st(_,Mn,"m",n_).call(_,J,se,te,re,Me,pe,Ce);return _._focusParameters.isDoingFocus=0,we}if(Ve==te&&te<Ce){const Me=yield st(_,Mn,"m",n_).call(_,J,ce,Ve,se,te);return _._focusParameters.isDoingFocus=0,Me}if(te==Ce&&Ve>te){const Me=yield st(_,Mn,"m",n_).call(_,J,se,te,pe,Ce);return _._focusParameters.isDoingFocus=0,Me}return B(J,Z,re)}catch(se){if("DeprecatedTaskError"!==se.name)throw se}});return function(Z,re,se){return Q.apply(this,arguments)}}();return B(V,v,y)});return function(o,h,v,y,_){return p.apply(this,arguments)}}(),rO=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const n=this.getResolution();let o=0,h=0;if(p.x.endsWith("px"))o=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(p.x)/100*n.width}if(p.y.endsWith("px"))h=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");h=parseFloat(p.y)/100*n.height}if(isNaN(o)||isNaN(h))throw new Error("Invalid scale center.");tr(this,lp,{x:o,y:h},"f")},IK=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();return p&&p.x==n.width/2&&p.y==n.height/2},ti.browserInfo=ul,ti.onWarning=null===(Q4=null==window?void 0:window.console)||void 0===Q4?void 0:Q4.warn;class dp{constructor(n){vx.add(this),qI.set(this,void 0),i_.set(this,0),xv.set(this,void 0),KI.set(this,0),r_.set(this,!1),Ln(this,qI,n,"f")}startCharging(){qe(this,r_,"f")||(dp._onLog&&dp._onLog("start charging."),qe(this,vx,"m",DK).call(this),Ln(this,r_,!0,"f"))}stopCharging(){qe(this,xv,"f")&&clearTimeout(qe(this,xv,"f")),qe(this,r_,"f")&&(dp._onLog&&dp._onLog("stop charging."),Ln(this,i_,Date.now()-qe(this,KI,"f"),"f"),Ln(this,r_,!1,"f"))}}qI=new WeakMap,i_=new WeakMap,xv=new WeakMap,KI=new WeakMap,r_=new WeakMap,vx=new WeakSet,EK=function(){Mo.cfd(1),dp._onLog&&dp._onLog("charge 1.")},DK=function p(){0==qe(this,i_,"f")&&qe(this,vx,"m",EK).call(this),Ln(this,KI,Date.now(),"f"),qe(this,xv,"f")&&clearTimeout(qe(this,xv,"f")),Ln(this,xv,setTimeout(()=>{Ln(this,i_,0,"f"),qe(this,vx,"m",p).call(this)},qe(this,qI,"f")-qe(this,i_,"f")),"f")};class ua{static beep(){if(!this.allowBeep||!this.beepSoundSource)return;let n,o=Date.now();if(!(o-qe(this,Yc,"f",oO)<100)){if(Ln(this,Yc,o,"f",oO),qe(this,Yc,"f",yx).size&&(n=qe(this,Yc,"f",yx).values().next().value,this.beepSoundSource==n.src?(qe(this,Yc,"f",yx).delete(n),n.play()):n=null),!n)if(qe(this,Yc,"f",_x).size<16){n=new Audio(this.beepSoundSource);let h=null,v=()=>{n.removeEventListener("loadedmetadata",v),n.play(),h=setTimeout(()=>{qe(this,Yc,"f",_x).delete(n)},2e3*n.duration)};n.addEventListener("loadedmetadata",v),n.addEventListener("ended",()=>{null!=h&&(clearTimeout(h),h=null),n.pause(),n.currentTime=0,qe(this,Yc,"f",_x).delete(n),qe(this,Yc,"f",yx).add(n)})}else qe(this,Yc,"f",sO)||(Ln(this,Yc,!0,"f",sO),console.warn("The requested audio tracks exceed 16 and will not be played."));n&&qe(this,Yc,"f",_x).add(n)}}static vibrate(){if(this.allowVibrate){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(ua.vibrateDuration)}}}Yc=ua,yx={value:new Set},_x={value:new Set},oO={value:0},sO={value:!1},ua.allowBeep=!0,ua.beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",ua.allowVibrate=!0,ua.vibrateDuration=300;const RK=new Map([[Un.IPF_GRAYSCALED,nr.GREY],[Un.IPF_ABGR_8888,nr.RGBA],[Un.IPF_ARGB_8888,nr.BGRA]]),kK=new Map([[nr.GREY,Un.IPF_GRAYSCALED],[nr.RGBA,Un.IPF_ABGR_8888],[nr.BGRA,Un.IPF_ARGB_8888]]),hO="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Ci extends Nu{static set _onLog(n){Ln(Ci,aO,n,"f",lO),ti._onLog=n,dp._onLog=n}static get _onLog(){return qe(Ci,aO,"f",lO)}static detectEnvironment(){return Fe(function*(){return yield Fe(function*(){return{wasm:cEe,worker:uEe,getUserMedia:oK,camera:yield dEe(),browser:la.browser,version:la.version,OS:la.OS}})()})()}static testCameraAccess(){return Fe(function*(){const n=yield ti.testCameraAccess();return n.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===n.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===n.errorName||"NotFoundError"===n.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===n.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===n.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===n.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===n.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:n.errorMessage}})()}static createInstance(n){return Fe(function*(){var o,h;if(n&&!(n instanceof js))throw new TypeError("Invalid view.");if(null===(o=io.license)||void 0===o?void 0:o.LicenseManager){if(!(null===(h=io.license)||void 0===h?void 0:h.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield Mo.loadWasm(["license"]),yield io.license.dynamsoft()}const v=new Ci(n);return Ci.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{Ci.onWarning&&Ci.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Ci.onWarning&&Ci.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),v})()}get video(){return this.cameraManager.getVideoEl()}set videoSrc(n){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraView&&(this.cameraView._hideDefaultSelection=!0),this.cameraManager.videoSrc=n}get videoSrc(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.videoSrc}set ifSaveLastUsedCamera(n){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSaveLastUsedCamera=n}get ifSaveLastUsedCamera(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.ifSaveLastUsedCamera}set ifSkipCameraInspection(n){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSkipCameraInspection=n}get ifSkipCameraInspection(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.ifSkipCameraInspection}set cameraOpenTimeout(n){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.cameraOpenTimeout=n}get cameraOpenTimeout(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.cameraOpenTimeout}set singleFrameMode(n){if(!["disabled","image","camera"].includes(n))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Ln(this,JI,n,"f")}get singleFrameMode(){return qe(this,JI,"f")}get _isFetchingStarted(){return qe(this,up,"f")}get disposed(){return qe(this,cO,"f")}constructor(n){var o;if(super(),o=this,ir.add(this),Cx.set(this,"closed"),cp.set(this,void 0),this.isTorchOn=void 0,JI.set(this,void 0),this._onCameraSelChange=Fe(function*(){o.isOpen()&&o.cameraView&&!o.cameraView.disposed&&(yield o.selectCamera(o.cameraView._selCam.value))}),this._onResolutionSelChange=Fe(function*(){if(!o.isOpen()||!o.cameraView||o.cameraView.disposed)return;let h,v;if(o.cameraView._selRsl&&-1!=o.cameraView._selRsl.selectedIndex){let y=o.cameraView._selRsl.options[o.cameraView._selRsl.selectedIndex];h=parseInt(y.getAttribute("data-width")),v=parseInt(y.getAttribute("data-height"))}yield o.setResolution({width:h,height:v})}),this._onCloseBtnClick=Fe(function*(){o.isOpen()&&o.cameraView&&!o.cameraView.disposed&&o.close()}),QI.set(this,(h,v,y,_)=>{const b=Date.now(),w={sx:_.x,sy:_.y,sWidth:_.width,sHeight:_.height,dWidth:_.width,dHeight:_.height},I=Math.max(w.dWidth,w.dHeight);if(this.canvasSizeLimit&&I>this.canvasSizeLimit){const F=this.canvasSizeLimit/I;w.dWidth>w.dHeight?(w.dWidth=this.canvasSizeLimit,w.dHeight=Math.round(w.dHeight*F)):(w.dWidth=Math.round(w.dWidth*F),w.dHeight=this.canvasSizeLimit)}const A=this.cameraManager.imageDataGetter.getImageData(h,v,y,w,{pixelFormat:RK.get(this.getPixelFormat())});let M=null;if(A){const F=Date.now();let V;V=A.pixelFormat===nr.GREY?A.width:4*A.width;let B=!0;0===w.sx&&0===w.sy&&w.sWidth===v&&w.sHeight===y&&(B=!1),M={bytes:A.data,width:A.width,height:A.height,stride:V,format:kK.get(A.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:bI.ITT_FILE_IMAGE,isCropped:B,cropRegion:{left:_.x,top:_.y,right:_.x+_.width,bottom:_.y+_.height,isMeasuredInPercentage:!1},originalWidth:v,originalHeight:y,currentWidth:A.width,currentHeight:A.height,timeSpent:F-b,timeStamp:F},toCanvas:qe(this,ZI,"f"),isDCEFrame:!0}}return M}),this._onSingleFrameAcquired=h=>{let v;v=this.cameraView?this.cameraView.getConvertedRegion():AI.convert(qe(this,wv,"f"),h.width,h.height),v||(v={x:0,y:0,width:h.width,height:h.height});const y=qe(this,QI,"f").call(this,h,h.width,h.height,v);qe(this,cp,"f").fire("singleFrameAcquired",[y],{async:!1,copy:!1})},ZI.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const h=document.createElement("canvas");let v;if(h.width=this.width,h.height=this.height,this.format===Un.IPF_GRAYSCALED){v=new Uint8ClampedArray(this.width*this.height*4);for(let y=0;y<v.length;y+=4)v[y]=this.bytes[y/4],v[y+1]=this.bytes[y/4],v[y+2]=this.bytes[y/4],v[y+3]=255}else v=new Uint8ClampedArray(this.bytes.buffer);return h.getContext("2d").putImageData(new ImageData(v,this.width,this.height),0,0),h}),bx.set(this,void 0),wv.set(this,void 0),eE.set(this,Un.IPF_ABGR_8888),up.set(this,!1),this._imageId=-1,Xc.set(this,void 0),this.fetchInterval=0,Oo.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Nn.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Vh.set(this,void 0),cO.set(this,!1),this.isCameraEnhancer=!0,this._taskid4AutoTorch=null,this._delay4AutoTorch=250,this.grayThreshold4AutoTorch=20,this.maxDarkCount4AutoTroch=3,n&&!(n instanceof js))throw new TypeError("Invalid view.");Ln(this,cp,new pK,"f"),this.cameraManager=new ti,this._imageDataGetter=this.cameraManager.imageDataGetter,this.cameraManager.updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const h=this.cameraManager.getSoftwareScale();if(h<1)throw new RangeError("Invalid scale value.");this.cameraView&&!this.cameraView.disposed?(this.video.style.transform=1===h?"":`scale(${h})`,this.cameraView._updateVideoContainer()):this.video.style.transform=1===h?"":`scale(${h})`},["iPhone","iPad","Android","HarmonyOS"].includes(la.OS)?this.cameraManager.setResolution(1280,720):this.cameraManager.setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",n&&(this.setCameraView(n),n.cameraEnhancer=this),this._on("before:camera:change",()=>{qe(this,Vh,"f").stopCharging();const h=this.cameraView;h&&!h.disposed&&(h._startLoading(),h.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const h=this.cameraView;h&&!h.disposed&&(h._startLoading(),h.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),n.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{qe(this,Vh,"f").stopCharging()}),this._on("resumed",()=>{}),this._on("tapfocus",()=>{qe(this,Oo,"f").tapToFocus&&qe(this,Vh,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var h=Fe(function*(v,y){var _,b,w,I;if(qe(o,ir,"m",Kr).call(o)||!o.isOpen()||o.isPaused())return;const A=v.intermediateResultUnits;Ci._onLog&&(Ci._onLog("intermediateResultUnits:"),Ci._onLog(A));let M=!1,F=!1;for(let V of A){if(V.unitType===xI_IRUT_DECODED_BARCODES&&V.decodedBarcodes.length){M=!0;break}V.unitType===xI_IRUT_LOCALIZED_BARCODES&&V.localizedBarcodes.length&&(F=!0)}if(Ci._onLog&&(Ci._onLog("hasLocalizedBarcodes:"),Ci._onLog(F)),qe(o,Oo,"f").autoZoom||qe(o,Oo,"f").enhancedFocus)if(M)qe(o,Nn,"f").autoZoomInFrameArray.length=0,qe(o,Nn,"f").autoZoomOutFrameCount=0,qe(o,Nn,"f").frameArrayInIdealZoom.length=0,qe(o,Nn,"f").autoFocusFrameArray.length=0;else{const V=function(){var Q=Fe(function*(J){yield o.setZoom(J),qe(o,Oo,"f").autoZoom&&qe(o,Vh,"f").startCharging()});return function(Z){return Q.apply(this,arguments)}}(),B=function(){var Q=Fe(function*(J){yield o.setFocus(J),qe(o,Oo,"f").enhancedFocus&&qe(o,Vh,"f").startCharging()});return function(Z){return Q.apply(this,arguments)}}();if(F){const Q=A[0].originalImageTag,J=(null===(_=Q.cropRegion)||void 0===_?void 0:_.left)||0,Z=(null===(b=Q.cropRegion)||void 0===b?void 0:b.top)||0,re=(null===(w=Q.cropRegion)||void 0===w?void 0:w.right)?Q.cropRegion.right-J:Q.originalWidth,se=(null===(I=Q.cropRegion)||void 0===I?void 0:I.bottom)?Q.cropRegion.bottom-Z:Q.originalHeight,ce=Q.currentWidth,pe=Q.currentHeight;let Ce;{let Ve,te,Me,we,Le;{const Y=o.video.videoWidth*(1-qe(o,Nn,"f").autoZoomDetectionArea)/2,q=o.video.videoWidth*(1+qe(o,Nn,"f").autoZoomDetectionArea)/2,k=q,N=Y,$=o.video.videoHeight*(1-qe(o,Nn,"f").autoZoomDetectionArea)/2,ie=$,ee=o.video.videoHeight*(1+qe(o,Nn,"f").autoZoomDetectionArea)/2;Le=[{x:Y,y:$},{x:q,y:ie},{x:k,y:ee},{x:N,y:ee}]}Ci._onLog&&(Ci._onLog("detectionArea:"),Ci._onLog(Le));const j=[];{const Y=(q,k)=>{const N=(ie,ee)=>{if(!ie&&!ee)throw new Error("Invalid arguments.");return function(ne,le,fe){let xe=!1;const Pe=ne.length;if(Pe<=2)return!1;for(let De=0;De<Pe;De++){const je=ne[De],ke=ne[(De+1)%Pe];if(pEe(je,ke,{x:le,y:fe}))return!0;V4(je.y-fe)>0!=V4(ke.y-fe)>0&&V4(le-(fe-je.y)*(je.x-ke.x)/(je.y-ke.y)-je.x)<0&&(xe=!xe)}return xe}(ee,ie.x,ie.y)},$=(ie,ee)=>!!(RI([ie[0],ie[1]],[ie[2],ie[3]],[ee[0].x,ee[0].y],[ee[1].x,ee[1].y])||RI([ie[0],ie[1]],[ie[2],ie[3]],[ee[1].x,ee[1].y],[ee[2].x,ee[2].y])||RI([ie[0],ie[1]],[ie[2],ie[3]],[ee[2].x,ee[2].y],[ee[3].x,ee[3].y])||RI([ie[0],ie[1]],[ie[2],ie[3]],[ee[3].x,ee[3].y],[ee[0].x,ee[0].y]));return!!(N({x:q[0].x,y:q[0].y},k)||N({x:q[1].x,y:q[1].y},k)||N({x:q[2].x,y:q[2].y},k)||N({x:q[3].x,y:q[3].y},k))||!!(N({x:k[0].x,y:k[0].y},q)||N({x:k[1].x,y:k[1].y},q)||N({x:k[2].x,y:k[2].y},q)||N({x:k[3].x,y:k[3].y},q))||!!($([k[0].x,k[0].y,k[1].x,k[1].y],q)||$([k[1].x,k[1].y,k[2].x,k[2].y],q)||$([k[2].x,k[2].y,k[3].x,k[3].y],q)||$([k[3].x,k[3].y,k[0].x,k[0].y],q))};for(let q of A)if(q.unitType===xI_IRUT_LOCALIZED_BARCODES)for(let k of q.localizedBarcodes){if(!k)continue;const N=k.location.points;N.forEach($=>{js._transformCoordinates($,J,Z,re,se,ce,pe)}),Y(Le,N)&&j.push(k)}if(Ci._debug&&o.cameraView){const q=o.__layer||(o.__layer=o.cameraView._createDrawingLayer(99));q.clearDrawingItems();const k=o.__styleId2||(o.__styleId2=un.createDrawingStyle({strokeStyle:"red"}));for(let N of A)if(N.unitType===xI_IRUT_LOCALIZED_BARCODES)for(let $ of N.localizedBarcodes){if(!$)continue;const ee=new z4({points:$.location.points},k);q.addDrawingItems([ee])}}}if(Ci._onLog&&(Ci._onLog("intersectedResults:"),Ci._onLog(j)),!j.length)return;let L;if(j.length){let Y=j.filter(q=>q.possibleFormats==hO.BF_QR_CODE||q.possibleFormats==hO.BF_DATAMATRIX);if(Y.length||(Y=j.filter(q=>q.possibleFormats==hO.BF_ONED),Y.length||(Y=j)),Y.length){const q=N=>{const $=N.location.points,ie=($[0].x+$[1].x+$[2].x+$[3].x)/4,ee=($[0].y+$[1].y+$[2].y+$[3].y)/4;return(ie-ce/2)*(ie-ce/2)+(ee-pe/2)*(ee-pe/2)};L=Y[0];let k=q(L);if(1!=Y.length)for(let N=1;N<Y.length;N++){const $=q(Y[N]);(Y[N].confidence>1.1*L.confidence||Y[N].confidence>.9*L.confidence&&$<k)&&(L=Y[N],k=$)}}}if(Ci._onLog&&(Ci._onLog("highPriorityResult:"),Ci._onLog(L)),L){const Y=L.location.points;Ve=Math.min(Y[0].x,Y[1].x,Y[2].x,Y[3].x),te=Math.max(Y[0].x,Y[1].x,Y[2].x,Y[3].x),Me=Math.min(Y[0].y,Y[1].y,Y[2].y,Y[3].y),we=Math.max(Y[0].y,Y[1].y,Y[2].y,Y[3].y),Ce={points:[{x:Ve,y:Me},{x:te,y:Me},{x:te,y:we},{x:Ve,y:we}],result:L}}}if(Ci._onLog&&(Ci._onLog("boundingRect:"),Ci._onLog(Ce)),!Ce)return;if(Ci._debug&&o.cameraView&&(null==Ce?void 0:Ce.points)){const Ve=o.__layer||(o.__layer=o.cameraView._createDrawingLayer(99)),te=o.__styleId1||(o.__styleId1=un.createDrawingStyle({strokeStyle:"blue"})),Me=new z4({points:Ce.points},te);Ve.addDrawingItems([Me])}if(qe(o,Nn,"f").autoZoomOutFrameCount=0,qe(o,Oo,"f").autoZoom){const Ve=qe(o,Nn,"f").autoZoomIdealArea[1];let te=(1-qe(o,Nn,"f").autoZoomTargetBorder)/2;const Me=Ce.points[0].x/re,we=(re-Ce.points[2].x)/re,Le=Ce.points[0].y/se,j=(se-Ce.points[2].y)/se;if(Me>Ve&&we>Ve&&Le>Ve&&j>Ve&&Ce.result.moduleSize<qe(o,Nn,"f").autoZoomInIdealModuleSize){if(qe(o,Nn,"f").autoZoomInFrameArray.push(!0),qe(o,Nn,"f").autoZoomInFrameArray.splice(0,qe(o,Nn,"f").autoZoomInFrameArray.length-qe(o,Nn,"f").autoZoomInFrameLimit[0]),qe(o,Nn,"f").frameArrayInIdealZoom.length=0,qe(o,Oo,"f").enhancedFocus&&B({mode:"continuous"}).catch(()=>{}),qe(o,Nn,"f").autoZoomInFrameArray.filter(L=>!0===L).length>=qe(o,Nn,"f").autoZoomInFrameLimit[1]){qe(o,Nn,"f").autoZoomInFrameArray.length=0;const L=[(.5-te)/(.5-Me),(.5-te)/(.5-we),(.5-te)/(.5-Le),(.5-te)/(.5-j)].filter($=>$>0),Y=Math.min(...L,qe(o,Nn,"f").autoZoomInIdealModuleSize/Ce.result.moduleSize),q=o.getZoomSettings().factor;let k=Math.max(Math.pow(q*Y,1/qe(o,Nn,"f").autoZoomInMaxTimes),qe(o,Nn,"f").autoZoomInMinStep);k=Math.min(k,Y);let N=q*k;N=Math.max(qe(o,Nn,"f").minValue,N),N=Math.min(qe(o,Nn,"f").maxValue,N);try{yield V({factor:N})}catch($){console.warn($.message||$)}o.clearBuffer()}}else if(qe(o,Nn,"f").autoZoomInFrameArray.length=0,qe(o,Nn,"f").frameArrayInIdealZoom.push(!0),qe(o,Nn,"f").frameArrayInIdealZoom.splice(0,qe(o,Nn,"f").frameArrayInIdealZoom.length-qe(o,Nn,"f").frameLimitInIdealZoom[0]),qe(o,Nn,"f").frameArrayInIdealZoom.filter(L=>!0===L).length>=qe(o,Nn,"f").frameLimitInIdealZoom[1]&&(qe(o,Nn,"f").frameArrayInIdealZoom.length=0,qe(o,Oo,"f").enhancedFocus)){const L=Ce.points;try{yield B({mode:"manual",area:{centerPoint:{x:(L[0].x+L[2].x)/2+"px",y:(L[0].y+L[2].y)/2+"px"},width:L[2].x-L[0].x+"px",height:L[2].y-L[0].y+"px"}})}catch(Y){console.warn(Y.message||Y)}o.clearBuffer()}}if(!qe(o,Oo,"f").autoZoom&&qe(o,Oo,"f").enhancedFocus&&(qe(o,Nn,"f").autoFocusFrameArray.push(!0),qe(o,Nn,"f").autoFocusFrameArray.splice(0,qe(o,Nn,"f").autoFocusFrameArray.length-qe(o,Nn,"f").autoFocusFrameLimit[0]),qe(o,Nn,"f").autoFocusFrameArray.filter(Ve=>!0===Ve).length>=qe(o,Nn,"f").autoFocusFrameLimit[1])){qe(o,Nn,"f").autoFocusFrameArray.length=0;try{const Ve=Ce.points;yield B({mode:"manual",area:{centerPoint:{x:(Ve[0].x+Ve[2].x)/2+"px",y:(Ve[0].y+Ve[2].y)/2+"px"},width:Ve[2].x-Ve[0].x+"px",height:Ve[2].y-Ve[0].y+"px"}})}catch(Ve){console.warn(Ve.message||Ve)}o.clearBuffer()}}else{if(qe(o,Oo,"f").autoZoom){if(qe(o,Nn,"f").autoZoomInFrameArray.push(!1),qe(o,Nn,"f").autoZoomInFrameArray.splice(0,qe(o,Nn,"f").autoZoomInFrameArray.length-qe(o,Nn,"f").autoZoomInFrameLimit[0]),qe(o,Nn,"f").autoZoomOutFrameCount++,qe(o,Nn,"f").frameArrayInIdealZoom.push(!1),qe(o,Nn,"f").frameArrayInIdealZoom.splice(0,qe(o,Nn,"f").frameArrayInIdealZoom.length-qe(o,Nn,"f").frameLimitInIdealZoom[0]),qe(o,Nn,"f").autoZoomOutFrameCount>=qe(o,Nn,"f").autoZoomOutFrameLimit){qe(o,Nn,"f").autoZoomOutFrameCount=0;const Q=o.getZoomSettings().factor;let J=Q-Math.max((Q-1)*qe(o,Nn,"f").autoZoomOutStepRate,qe(o,Nn,"f").autoZoomOutMinStep);J=Math.max(qe(o,Nn,"f").minValue,J),J=Math.min(qe(o,Nn,"f").maxValue,J);try{yield V({factor:J})}catch(Z){console.warn(Z.message||Z)}o.clearBuffer()}qe(o,Oo,"f").enhancedFocus&&B({mode:"continuous"}).catch(()=>{})}!qe(o,Oo,"f").autoZoom&&qe(o,Oo,"f").enhancedFocus&&(qe(o,Nn,"f").autoFocusFrameArray.length=0,B({mode:"continuous"}).catch(()=>{}))}}});return function(v,y){return h.apply(this,arguments)}}(),Ln(this,Vh,new dp(1e4),"f")}setCameraView(n){if(!(n instanceof js))throw new TypeError("Invalid view.");if(n.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),n._singleFrameMode=this.singleFrameMode,n._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(this.cameraView._hideDefaultSelection=!0),qe(this,ir,"m",Kr).call(this)||this.cameraManager.setVideoEl(n.getVideoElement()),this.cameraView=n,this.addListenerToView()}getCameraView(){return this.cameraView}releaseCameraView(){this.cameraView&&(this.removeListenerFromView(),this.cameraView.disposed||(this.cameraView._singleFrameMode="disabled",this.cameraView._onSingleFrameAcquired=null,this.cameraView._hideDefaultSelection=!1),this.cameraManager.releaseVideoEl(),this.cameraView=null)}addListenerToView(){if(!this.cameraView)return;if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");const n=this.cameraView;qe(this,ir,"m",Kr).call(this)||this.videoSrc||(n._innerComponent&&(this.cameraManager.tapFocusEventBoundEl=n._innerComponent),n._selCam&&n._selCam.addEventListener("change",this._onCameraSelChange),n._selRsl&&n._selRsl.addEventListener("change",this._onResolutionSelChange)),n._btnClose&&n._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!this.cameraView||this.cameraView.disposed)return;const n=this.cameraView;this.cameraManager.tapFocusEventBoundEl=null,n._selCam&&n._selCam.removeEventListener("change",this._onCameraSelChange),n._selRsl&&n._selRsl.removeEventListener("change",this._onResolutionSelChange),n._btnClose&&n._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return qe(this,ir,"m",Kr).call(this)?qe(this,Cx,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(this.cameraManager.state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var n=this;return Fe(function*(){const o=n.cameraView;if(null==o?void 0:o.disposed)throw new Error("'cameraView' has been disposed.");o&&(o._singleFrameMode=n.singleFrameMode,qe(n,ir,"m",Kr).call(n)?o._clickIptSingleFrameMode():(n.cameraManager.setVideoEl(o.getVideoElement()),o._startLoading()));let h={width:0,height:0,deviceId:""};if(!qe(n,ir,"m",Kr).call(n)){try{yield n.cameraManager.open()}catch(b){throw o&&o._stopLoading(),"NotFoundError"===b.name?new Error(`No camera devices were detected. Please ensure a camera is connected and recognized by your system. ${null==b?void 0:b.name}: ${null==b?void 0:b.message}`):"NotAllowedError"===b.name?new Error(`Camera access is blocked. Please check your browser settings or grant permission to use the camera. ${null==b?void 0:b.name}: ${null==b?void 0:b.message}`):b}let v,y=o.getUIElement();if(y=y.shadowRoot||y,v=y.querySelector(".dce-macro-use-mobile-native-like-ui")){let b=y.elTorchAuto=y.querySelector(".dce-mn-torch-auto"),w=y.elTorchOn=y.querySelector(".dce-mn-torch-on"),I=y.elTorchOff=y.querySelector(".dce-mn-torch-off");b&&(w.style.display=null==n.isTorchOn?"":"none"),w&&(w.style.display=1==n.isTorchOn?"":"none"),I&&(I.style.display=0==n.isTorchOn?"":"none");let A=y.elBeepOn=y.querySelector(".dce-mn-beep-on"),M=y.elBeepOff=y.querySelector(".dce-mn-beep-off");A&&(A.style.display=ua.allowBeep?"":"none"),M&&(M.style.display=ua.allowBeep?"none":"");let F=y.elVibrateOn=y.querySelector(".dce-mn-vibrate-on"),V=y.elVibrateOff=y.querySelector(".dce-mn-vibrate-off");F&&(F.style.display=ua.allowVibrate?"":"none"),V&&(V.style.display=ua.allowVibrate?"none":""),y.elResolutionBox=y.querySelector(".dce-mn-resolution-box");let B,Q=y.elZoom=y.querySelector(".dce-mn-zoom");Q&&(Q.style.display="none",B=y.elZoomSpan=Q.querySelector("span"));let J=y.elToast=y.querySelector(".dce-mn-toast"),Z=y.elCameraClose=y.querySelector(".dce-mn-camera-close"),re=y.elTakePhoto=y.querySelector(".dce-mn-take-photo"),se=y.elCameraSwitch=y.querySelector(".dce-mn-camera-switch"),ce=y.elCameraAndResolutionSettings=y.querySelector(".dce-mn-camera-and-resolution-settings");ce&&(ce.style.display="none");const pe=y.dceMnFs={},Ce=()=>{n.turnOnTorch()};null==b||b.addEventListener("pointerdown",Ce);const Ve=()=>{n.turnOffTorch()};null==w||w.addEventListener("pointerdown",Ve);const te=()=>{n.turnAutoTorch()};null==I||I.addEventListener("pointerdown",te);const Me=()=>{ua.allowBeep=!ua.allowBeep,A&&(A.style.display=ua.allowBeep?"":"none"),M&&(M.style.display=ua.allowBeep?"none":"")};for(let xe of[M,A])null==xe||xe.addEventListener("pointerdown",Me);const we=()=>{ua.allowVibrate=!ua.allowVibrate,F&&(F.style.display=ua.allowVibrate?"":"none"),V&&(V.style.display=ua.allowVibrate?"none":"")};for(let xe of[V,F])null==xe||xe.addEventListener("pointerdown",we);const Le=function(){var xe=Fe(function*(Pe){let De,je=Pe.target;if(De=je.closest(".dce-mn-camera-option"))n.selectCamera(De.getAttribute("data-davice-id"));else if(De=je.closest(".dce-mn-resolution-option")){let ke,Ae=parseInt(De.getAttribute("data-width")),he=parseInt(De.getAttribute("data-height")),tt=yield n.setResolution({width:Ae,height:he});{let Ze=Math.max(tt.width,tt.height),nt=Math.min(tt.width,tt.height);ke=nt<=1080?nt+"P":Ze<3e3?"2K":Math.round(Ze/1e3)+"K"}ke!=De.textContent&&Y(`Fallback to ${ke}`)}else je.closest(".dce-mn-camera-and-resolution-settings")||(je.closest(".dce-mn-resolution-box")?ce&&(ce.style.display=ce.style.display?"":"none"):ce&&""===ce.style.display&&(ce.style.display="none"))});return function(De){return xe.apply(this,arguments)}}();y.addEventListener("click",Le);let j=null;pe.funcInfoZoomChange=(xe,Pe=3e3)=>{Q&&B&&(B.textContent=xe.toFixed(1),Q.style.display="",null!=j&&(clearTimeout(j),j=null),j=setTimeout(()=>{Q.style.display="none",j=null},Pe))};let L=null,Y=pe.funcShowToast=(xe,Pe=3e3)=>{J&&(J.textContent=xe,J.style.display="",null!=L&&(clearTimeout(L),L=null),L=setTimeout(()=>{J.style.display="none",L=null},Pe))};const q=()=>{n.close()};null==Z||Z.addEventListener("click",q);const k=()=>{};null==re||re.addEventListener("pointerdown",k);const N=()=>{var xe,Pe;let De,je=n.getVideoSettings(),ke=je.video.facingMode,Ae=null===(Pe=null===(xe=n.cameraManager.getCamera())||void 0===xe?void 0:xe.label)||void 0===Pe?void 0:Pe.toLowerCase(),he=null==Ae?void 0:Ae.indexOf("front");-1===he&&(he=null==Ae?void 0:Ae.indexOf("\u524d"));let tt=null==Ae?void 0:Ae.indexOf("back");-1===tt&&(tt=null==Ae?void 0:Ae.indexOf("\u540e")),"number"==typeof he&&-1!==he?De=!0:"number"==typeof tt&&-1!==tt&&(De=!1),void 0===De&&(De="user"===((null==ke?void 0:ke.ideal)||(null==ke?void 0:ke.exact)||ke)),je.video.facingMode={ideal:De?"environment":"user"},delete je.video.deviceId,n.updateVideoSettings(je)};null==se||se.addEventListener("pointerdown",N);let $=-1/0,ie=1;const ee=xe=>{let Pe=Date.now();Pe-$>1e3&&(ie=n.getZoomSettings().factor),ie-=xe.deltaY/200,ie>20&&(ie=20),ie<1&&(ie=1),n.setZoom({factor:ie}),$=Pe};v.addEventListener("wheel",ee);const ne=new Map;let le=!1;const fe=function(){var xe=Fe(function*(Pe){var De;for(Pe.touches.length>=2&&"touchmove"==Pe.type&&Pe.preventDefault();Pe.changedTouches.length>1&&2==Pe.touches.length;){let je=Pe.touches[0],ke=Pe.touches[1],Ae=ne.get(je.identifier),he=ne.get(ke.identifier);if(!Ae||!he)break;let tt=Math.pow(Math.pow(Ae.x-he.x,2)+Math.pow(Ae.y-he.y,2),.5),Ze=Math.pow(Math.pow(je.clientX-ke.clientX,2)+Math.pow(je.clientY-ke.clientY,2),.5),nt=Date.now();if(le||nt-$<100)return;nt-$>1e3&&(ie=n.getZoomSettings().factor),ie*=Ze/tt,ie>20&&(ie=20),ie<1&&(ie=1);let et=!1;"safari"==(null===(De=null==la?void 0:la.browser)||void 0===De?void 0:De.toLocaleLowerCase())&&(Ze/tt>1&&ie<2?(ie=2,et=!0):Ze/tt<1&&ie<2&&(ie=1,et=!0)),le=!0,et&&Y("zooming..."),yield n.setZoom({factor:ie}),et&&(J.textContent=""),le=!1,$=Date.now();break}ne.clear();for(let je of Pe.touches)ne.set(je.identifier,{x:je.clientX,y:je.clientY})});return function(De){return xe.apply(this,arguments)}}();y.addEventListener("touchstart",fe),y.addEventListener("touchmove",fe),y.addEventListener("touchend",fe),y.addEventListener("touchcancel",fe),pe.unbind=()=>{null==b||b.removeEventListener("pointerdown",Ce),null==w||w.removeEventListener("pointerdown",Ve),null==I||I.removeEventListener("pointerdown",te);for(let xe of[M,A])null==xe||xe.removeEventListener("pointerdown",Me);for(let xe of[V,F])null==xe||xe.removeEventListener("pointerdown",we);y.removeEventListener("click",Le),null==Z||Z.removeEventListener("click",q),null==re||re.removeEventListener("pointerdown",k),null==se||se.removeEventListener("pointerdown",N),v.removeEventListener("wheel",ee),y.removeEventListener("touchstart",fe),y.removeEventListener("touchmove",fe),y.removeEventListener("touchend",fe),y.removeEventListener("touchcancel",fe),delete y.dceMnFs,v.style.display="none"},v.style.display="",b&&null==n.isTorchOn&&setTimeout(()=>{n.turnAutoTorch(1e3)},0)}n.isTorchOn&&n.turnOnTorch().catch(()=>{});const _=n.getResolution();h.width=_.width,h.height=_.height,h.deviceId=n.getSelectedCamera().deviceId}return Ln(n,Cx,"open","f"),o&&(o._innerComponent.style.display="",qe(n,ir,"m",Kr).call(n)||(o._stopLoading(),o._renderCamerasInfo(n.getSelectedCamera(),n.cameraManager._arrCameras),o._renderResolutionInfo({width:h.width,height:h.height}),o.eventHandler.fire("content:updated",null,{async:!1}),o.eventHandler.fire("videoEl:resized",null,{async:!1}))),qe(n,cp,"f").fire("opened",null,{target:n,async:!1}),h})()}close(){var n;const o=this.cameraView;if(null==o?void 0:o.disposed)throw new Error("'cameraView' has been disposed.");if(this.stopFetching(),this.clearBuffer(),!qe(this,ir,"m",Kr).call(this)){this.cameraManager.close();let h=o.getUIElement();h=h.shadowRoot||h,h.querySelector(".dce-macro-use-mobile-native-like-ui")&&(null===(n=h.dceMnFs)||void 0===n||n.unbind())}Ln(this,Cx,"closed","f"),qe(this,Vh,"f").stopCharging(),o&&(o._innerComponent.style.display="none",qe(this,ir,"m",Kr).call(this)&&o._innerComponent.removeElement("content"),o._stopLoading()),qe(this,cp,"f").fire("closed",null,{target:this,async:!1})}pause(){if(qe(this,ir,"m",Kr).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");this.cameraManager.pause()}isPaused(){var n;return!qe(this,ir,"m",Kr).call(this)&&!0===(null===(n=this.video)||void 0===n?void 0:n.paused)}resume(){var n=this;return Fe(function*(){if(qe(n,ir,"m",Kr).call(n))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield n.cameraManager.resume()})()}selectCamera(n){var o=this;return Fe(function*(){if(!n)throw new Error("Invalid value.");let h;h="string"==typeof n?n:n.deviceId,yield o.cameraManager.setCamera(h),o.isTorchOn=!1;const v=o.getResolution(),y=o.cameraView;return y&&!y.disposed&&(y._stopLoading(),y._renderCamerasInfo(o.getSelectedCamera(),o.cameraManager._arrCameras),y._renderResolutionInfo({width:v.width,height:v.height})),{width:v.width,height:v.height,deviceId:o.getSelectedCamera().deviceId}})()}getSelectedCamera(){return this.cameraManager.getCamera()}getAllCameras(){var n=this;return Fe(function*(){return n.cameraManager.getCameras()})()}setResolution(n){var o=this;return Fe(function*(){yield o.cameraManager.setResolution(n.width,n.height),o.isTorchOn&&o.turnOnTorch().catch(()=>{});const h=o.getResolution(),v=o.cameraView;return v&&!v.disposed&&(v._stopLoading(),v._renderResolutionInfo({width:h.width,height:h.height})),{width:h.width,height:h.height,deviceId:o.getSelectedCamera().deviceId}})()}getResolution(){return this.cameraManager.getResolution()}getAvailableResolutions(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getResolutions()}_on(n,o){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(n.toLowerCase())?qe(this,cp,"f").on(n,o):this.cameraManager.on(n,o)}_off(n,o){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(n.toLowerCase())?qe(this,cp,"f").off(n,o):this.cameraManager.off(n,o)}on(n,o){const h=n.toLowerCase(),v=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(h);if(!v)throw new Error("Invalid event.");this._on(v,o)}off(n,o){const h=n.toLowerCase(),v=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(h);if(!v)throw new Error("Invalid event.");this._off(v,o)}getVideoSettings(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getMediaStreamConstraints()}updateVideoSettings(n){var o=this;return Fe(function*(){var h;yield null===(h=o.cameraManager)||void 0===h?void 0:h.setMediaStreamConstraints(n,!0)})()}getCapabilities(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getCameraCapabilities()}getCameraSettings(){return this.cameraManager.getCameraSettings()}turnOnTorch(){var n=this;return Fe(function*(){var o,h;if(qe(n,ir,"m",Kr).call(n))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");try{yield null===(o=n.cameraManager)||void 0===o?void 0:o.turnOnTorch()}catch(y){let _=n.cameraView.getUIElement();throw _=_.shadowRoot||_,null===(h=null==_?void 0:_.dceMnFs)||void 0===h||h.funcShowToast("Torch Not Supported"),y}n.isTorchOn=!0;let v=n.cameraView.getUIElement();v=v.shadowRoot||v,v.elTorchAuto&&(v.elTorchAuto.style.display="none"),v.elTorchOn&&(v.elTorchOn.style.display=""),v.elTorchOff&&(v.elTorchOff.style.display="none")})()}turnOffTorch(){var n=this;return Fe(function*(){var o;if(qe(n,ir,"m",Kr).call(n))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(o=n.cameraManager)||void 0===o?void 0:o.turnOffTorch(),n.isTorchOn=!1;let h=n.cameraView.getUIElement();h=h.shadowRoot||h,h.elTorchAuto&&(h.elTorchAuto.style.display="none"),h.elTorchOn&&(h.elTorchOn.style.display="none"),h.elTorchOff&&(h.elTorchOff.style.display="")})()}turnAutoTorch(n=250){var o=this;return Fe(function*(){if(null!=o._taskid4AutoTorch){if(!(n<o._delay4AutoTorch))return;clearInterval(o._taskid4AutoTorch),o._taskid4AutoTorch=null}o._delay4AutoTorch=n;let h=!1,v=0,y=0;const _=function(){var w=Fe(function*(){var I,A;if(h||null!=o.isTorchOn||!o.isOpen())return clearInterval(o._taskid4AutoTorch),void(o._taskid4AutoTorch=null);if(++y>10&&o._delay4AutoTorch<1e3)return clearInterval(o._taskid4AutoTorch),o._taskid4AutoTorch=null,void o.turnAutoTorch(1e3);let M;try{M=o.fetchImage()}catch(V){}if(!M||!M.width||!M.height)return;let F=0;if(Un.IPF_GRAYSCALED===M.format){for(let V=0;V<M.bytes.length;++V)F+=M.bytes[V];F/=M.bytes.length}else{if(Un.IPF_ABGR_8888!==M.format)return;for(let V=0;V<M.bytes.length;V+=4)F+=M.bytes[V],F+=M.bytes[V+1],F+=M.bytes[V+2];F/=M.bytes.length/4*3}if(F<o.grayThreshold4AutoTorch){if(++v>=o.maxDarkCount4AutoTroch){console.log(`darkCount ${v}`);try{yield o.turnOnTorch(),o.isTorchOn=!0;let V=o.cameraView.getUIElement();V=V.shadowRoot||V,null===(I=null==V?void 0:V.dceMnFs)||void 0===I||I.funcShowToast("Torch Auto On")}catch(V){console.error(V),h=!0;let B=o.cameraView.getUIElement();B=B.shadowRoot||B,null===(A=null==B?void 0:B.dceMnFs)||void 0===A||A.funcShowToast("Torch Not Supported")}}}else v=0});return function(){return w.apply(this,arguments)}}();o._taskid4AutoTorch=setInterval(_,n),o.isTorchOn=void 0,_();let b=o.cameraView.getUIElement();b=b.shadowRoot||b,b.elTorchAuto&&(b.elTorchAuto.style.display=""),b.elTorchOn&&(b.elTorchOn.style.display="none"),b.elTorchOff&&(b.elTorchOff.style.display="none")})()}setColorTemperature(n){var o=this;return Fe(function*(){if(qe(o,ir,"m",Kr).call(o))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield o.cameraManager.setColorTemperature(n,!0)})()}getColorTemperature(){return this.cameraManager.getColorTemperature()}setExposureCompensation(n){var o=this;return Fe(function*(){var h;if(qe(o,ir,"m",Kr).call(o))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(h=o.cameraManager)||void 0===h?void 0:h.setExposureCompensation(n,!0)})()}getExposureCompensation(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getExposureCompensation()}_setZoom(n){var o=this;return Fe(function*(){var h,v,y;if(qe(o,ir,"m",Kr).call(o))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(h=o.cameraManager)||void 0===h?void 0:h.setZoom(n);{let _=null===(v=o.cameraView)||void 0===v?void 0:v.getUIElement();_=(null==_?void 0:_.shadowRoot)||_,null===(y=null==_?void 0:_.dceMnFs)||void 0===y||y.funcInfoZoomChange(n.factor)}})()}setZoom(n){var o=this;return Fe(function*(){yield o._setZoom(n)})()}getZoomSettings(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getZoom()}resetZoom(){var n=this;return Fe(function*(){var o;if(qe(n,ir,"m",Kr).call(n))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(o=n.cameraManager)||void 0===o?void 0:o.resetZoom()})()}setFrameRate(n){var o=this;return Fe(function*(){var h;if(qe(o,ir,"m",Kr).call(o))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(h=o.cameraManager)||void 0===h?void 0:h.setFrameRate(n,!0)})()}getFrameRate(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getFrameRate()}setFocus(n){var o=this;return Fe(function*(){var h;if(qe(o,ir,"m",Kr).call(o))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(h=o.cameraManager)||void 0===h?void 0:h.setFocus(n,!0)})()}getFocusSettings(){var n;return null===(n=this.cameraManager)||void 0===n?void 0:n.getFocus()}setAutoZoomRange(n){qe(this,Nn,"f").minValue=n.min,qe(this,Nn,"f").maxValue=n.max}getAutoZoomRange(){return{min:qe(this,Nn,"f").minValue,max:qe(this,Nn,"f").maxValue}}enableEnhancedFeatures(n){var o=this;return Fe(function*(){var h,v;if(!(null===(v=null===(h=io.license)||void 0===h?void 0:h.LicenseManager)||void 0===v?void 0:v.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==Mo.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");n&Dg.EF_ENHANCED_FOCUS&&(qe(o,Oo,"f").enhancedFocus=!0),n&Dg.EF_AUTO_ZOOM&&(qe(o,Oo,"f").autoZoom=!0),n&Dg.EF_TAP_TO_FOCUS&&(qe(o,Oo,"f").tapToFocus=!0,o.cameraManager.enableTapToFocus())})()}disableEnhancedFeatures(n){n&Dg.EF_ENHANCED_FOCUS&&(qe(this,Oo,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),n&Dg.EF_AUTO_ZOOM&&(qe(this,Oo,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),n&Dg.EF_TAP_TO_FOCUS&&(qe(this,Oo,"f").tapToFocus=!1,this.cameraManager.disableTapToFocus()),qe(this,ir,"m",PK).call(this)&&qe(this,ir,"m",AK).call(this)||qe(this,Vh,"f").stopCharging()}_setScanRegion(n){if(null!=n&&!U4(n)&&!ep(n))throw TypeError("Invalid 'region'.");Ln(this,wv,n?JSON.parse(JSON.stringify(n)):null,"f"),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegion(n)}setScanRegion(n){this._setScanRegion(n),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegionMaskVisible(null!==n)}getScanRegion(){return JSON.parse(JSON.stringify(qe(this,wv,"f")))}setErrorListener(n){if(!n)throw new TypeError("Invalid 'listener'");Ln(this,bx,n,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!this.cameraManager.isVideoLoaded()||qe(this,ir,"m",Kr).call(this))}startFetching(){if(qe(this,ir,"m",Kr).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");qe(this,up,"f")||(Ln(this,up,!0,"f"),qe(this,ir,"m",uO).call(this))}stopFetching(){qe(this,up,"f")&&(Ci._onLog&&Ci._onLog("DCE: stop fetching loop: "+Date.now()),qe(this,Xc,"f")&&clearTimeout(qe(this,Xc,"f")),Ln(this,up,!1,"f"))}fetchImage(){if(qe(this,ir,"m",Kr).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const n=this.getResolution();if(!(null==n?void 0:n.width)||!(null==n?void 0:n.height))throw new Error("The video is not loaded.");let o;if(o=AI.convert(qe(this,wv,"f"),n.width,n.height),o||(o={x:0,y:0,width:n.width,height:n.height}),o.x>n.width||o.y>n.height)throw new Error("Invalid scan region.");o.x+o.width>n.width&&(o.width=n.width-o.x),o.y+o.height>n.height&&(o.height=n.height-o.y);const h={sx:o.x,sy:o.y,sWidth:o.width,sHeight:o.height,dWidth:o.width,dHeight:o.height},v=Math.max(h.dWidth,h.dHeight);if(this.canvasSizeLimit&&v>this.canvasSizeLimit){const w=this.canvasSizeLimit/v;h.dWidth>h.dHeight?(h.dWidth=this.canvasSizeLimit,h.dHeight=Math.round(h.dHeight*w)):(h.dWidth=Math.round(h.dWidth*w),h.dHeight=this.canvasSizeLimit)}const y=this.cameraManager.getFrameData({position:h,pixelFormat:RK.get(this.getPixelFormat())});if(!y)return null;let _;_=y.pixelFormat===nr.GREY?y.width:4*y.width;let b=!0;return 0===h.sx&&0===h.sy&&h.sWidth===n.width&&h.sHeight===n.height&&(b=!1),{bytes:y.data,width:y.width,height:y.height,stride:_,format:kK.get(y.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:bI.ITT_VIDEO_FRAME,isCropped:b,cropRegion:{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height,isMeasuredInPercentage:!1},originalWidth:n.width,originalHeight:n.height,currentWidth:y.width,currentHeight:y.height,timeSpent:y.timeSpent,timeStamp:y.timeStamp},toCanvas:qe(this,ZI,"f"),isDCEFrame:!0}}setImageFetchInterval(n){this.fetchInterval=n,qe(this,up,"f")&&(qe(this,Xc,"f")&&clearTimeout(qe(this,Xc,"f")),Ln(this,Xc,setTimeout(()=>{this.disposed||qe(this,ir,"m",uO).call(this)},n),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(n){Ln(this,eE,n,"f")}getPixelFormat(){return qe(this,eE,"f")}takePhoto(n){var o=this;if(!this.isOpen())throw new Error("Not open.");if(qe(this,ir,"m",Kr).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const h=document.createElement("input");h.setAttribute("type","file"),h.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),h.setAttribute("capture",""),h.style.position="absolute",h.style.top="-9999px",h.style.backgroundColor="transparent",h.style.color="transparent",h.addEventListener("click",()=>{const v=this.isOpen();this.close(),window.addEventListener("focus",()=>{v&&this.open(),h.remove()},{once:!0})}),h.addEventListener("change",Fe(function*(){const v=h.files[0],y=yield(A=Fe(function*(M){let F=null,V=null;if("undefined"!=typeof createImageBitmap)try{if(F=yield createImageBitmap(M),F)return F}catch(Q){}var B;return F||(V=yield(B=M,new Promise((Q,J)=>{let Z=URL.createObjectURL(B),re=new Image;re.src=Z,re.onload=()=>{URL.revokeObjectURL(re.src),Q(re)},re.onerror=se=>{J(new Error("Can't convert blob to image : "+(se instanceof Event?se.type:se)))}}))),V}),function(M){return A.apply(this,arguments)})(v),_=y instanceof HTMLImageElement?y.naturalWidth:y.width,b=y instanceof HTMLImageElement?y.naturalHeight:y.height;var A;let w=AI.convert(qe(o,wv,"f"),_,b);w||(w={x:0,y:0,width:_,height:b});const I=qe(o,QI,"f").call(o,y,_,b,w);n&&n(I)})),document.body.appendChild(h),h.click()}convertToPageCoordinates(n){const o=qe(this,ir,"m",dO).call(this,n);return{x:o.pageX,y:o.pageY}}convertToClientCoordinates(n){const o=qe(this,ir,"m",dO).call(this,n);return{x:o.clientX,y:o.clientY}}dispose(){this.close(),this.cameraManager.dispose(),this.releaseCameraView(),this.__proto__=null;for(let n in this)delete this[n];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function Wl(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function Yd(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}aO=Ci,Cx=new WeakMap,cp=new WeakMap,JI=new WeakMap,QI=new WeakMap,ZI=new WeakMap,bx=new WeakMap,wv=new WeakMap,eE=new WeakMap,up=new WeakMap,Xc=new WeakMap,Oo=new WeakMap,Nn=new WeakMap,Vh=new WeakMap,cO=new WeakMap,ir=new WeakSet,Kr=function(){return"disabled"!==this.singleFrameMode},AK=function(){return!this.videoSrc&&"opened"===this.cameraManager.state},PK=function(){for(let p in qe(this,Oo,"f"))if(1==qe(this,Oo,"f")[p])return!0;return!1},uO=function p(){if(this.disposed)return;if("open"!==this.getCameraState()||!qe(this,up,"f"))return qe(this,Xc,"f")&&clearTimeout(qe(this,Xc,"f")),void Ln(this,Xc,setTimeout(()=>{this.disposed||qe(this,ir,"m",p).call(this)},this.fetchInterval),"f");const n=()=>{var o;let h;Ci._onLog&&Ci._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{h=this.fetchImage()}catch(v){const y=v.message||v;if("The video is not loaded."===y)return;if(null===(o=qe(this,bx,"f"))||void 0===o?void 0:o.onErrorReceived)return void setTimeout(()=>{var _;null===(_=qe(this,bx,"f"))||void 0===_||_.onErrorReceived(w4.EC_IMAGE_READ_FAILED,y)},0);console.warn(v)}h?(this.addImageToBuffer(h),Ci._onLog&&Ci._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),qe(this,cp,"f").fire("frameAddedToBuffer",null,{async:!1})):Ci._onLog&&Ci._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case fv.BOPM_BLOCK:break;case fv.BOPM_UPDATE:n()}else n();qe(this,Xc,"f")&&clearTimeout(qe(this,Xc,"f")),Ln(this,Xc,setTimeout(()=>{this.disposed||qe(this,ir,"m",p).call(this)},this.fetchInterval),"f")},dO=function(p){if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!qe(this,ir,"m",Kr).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(qe(this,ir,"m",Kr).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");const n=this.cameraView._innerComponent.getBoundingClientRect(),o=n.left,h=n.top,v=o+window.scrollX,y=h+window.scrollY,{width:_,height:b}=this.cameraView._innerComponent.getBoundingClientRect();if(_<=0||b<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let w,I,A;if(qe(this,ir,"m",Kr).call(this)){const re=this.cameraView._innerComponent.getElement("content");w=re.width,I=re.height,A="contain"}else{const re=this.getVideoEl();w=re.videoWidth,I=re.videoHeight,A=this.cameraView.getVideoFit()}const M=_/b,F=w/I;let V,B,Q,J,Z=1;if("contain"===A)M<F?(Z=_/w,V=o+p.x*Z,B=h+p.y*Z+(b-I*Z)/2,Q=v+p.x*Z,J=y+p.y*Z+(b-I*Z)/2):(Z=b/I,V=o+p.x*Z+(_-w*Z)/2,B=h+p.y*Z,Q=v+p.x*Z+(_-w*Z)/2,J=y+p.y*Z);else if("cover"===A)if(M<F){Z=b/I;let re=p.x*Z-(w*Z-_)/2;re=Math.max(re,0),re=Math.min(re,_),V=o+re,B=h+p.y*Z,Q=v+re,J=y+p.y*Z}else{Z=_/w;let re=p.y*Z-(I*Z-b)/2;re=Math.max(re,0),re=Math.min(re,b),V=o+p.x*Z,B=h+re,Q=v+p.x*Z,J=y+re}return{clientX:V,clientY:B,pageX:Q,pageY:J}},Ci._debug=!1,lO={value:void 0},Ci.browserInfo=la,"function"==typeof SuppressedError&&SuppressedError;class $c{static multiply(n,o){const h=[];for(let v=0;v<3;v++){const y=o.slice(3*v,3*v+3);for(let _=0;_<3;_++){const b=[n[_],n[_+3],n[_+6]].reduce((w,I,A)=>w+I*y[A],0);h.push(b)}}return h}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(n,o,h){return $c.multiply(n,[1,0,0,0,1,0,o,h,1])}static rotate(n,o){var h=Math.cos(o),v=Math.sin(o);return $c.multiply(n,[h,-v,0,v,h,0,0,0,1])}static scale(n,o,h){return $c.multiply(n,[o,0,0,0,h,0,0,0,1])}}var go,hp,fp,tE,o_,xx,wx,s_,nE;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(go||(go={}));class li{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Yd(li,hp,!1,"f",fp),!1):(Yd(li,hp,!0,"f",fp),!0)}get disposed(){return Wl(this,nE,"f")}constructor(){tE.set(this,go.RGBA),o_.set(this,null),xx.set(this,null),wx.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,s_.set(this,null),nE.set(this,!1)}drawImage(n,o,h,v,y,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!h||!v)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Wl(li,hp,"f",fp)&&li.checkWebGLSupport(),(null==_?void 0:_.bUseWebGL)&&!Wl(li,hp,"f",fp))throw new Error("Your browser or machine may not support WebGL.");if(o instanceof HTMLVideoElement&&4!==o.readyState||o instanceof HTMLImageElement&&!o.complete)throw new Error("The source is not loaded.");let b;li._onLog&&(b=Date.now(),li._onLog("drawImage(), START: "+b));let w=0,I=0,A=h,M=v,F=0,V=0,B=h,Q=v;y&&(y.sx&&(w=Math.round(y.sx)),y.sy&&(I=Math.round(y.sy)),y.sWidth&&(A=Math.round(y.sWidth)),y.sHeight&&(M=Math.round(y.sHeight)),y.dx&&(F=Math.round(y.dx)),y.dy&&(V=Math.round(y.dy)),y.dWidth&&(B=Math.round(y.dWidth)),y.dHeight&&(Q=Math.round(y.dHeight)));let J,Z=go.RGBA;if((null==_?void 0:_.pixelFormat)&&(Z=_.pixelFormat),(null==_?void 0:_.bufferContainer)&&(J=_.bufferContainer,J.length<4*B*Q))throw new Error("Unexpected size of the 'bufferContainer'.");const re=n;if(!Wl(li,hp,"f",fp)||!(this.useWebGLByDefault&&null==(null==_?void 0:_.bUseWebGL)||(null==_?void 0:_.bUseWebGL))){li._onLog&&li._onLog("drawImage() in context2d."),re.ctx2d||(re.ctx2d=re.getContext("2d",{willReadFrequently:!0}));const se=re.ctx2d;if(!se)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q),se.drawImage(o,w,I,A,M,F,V,B,Q),li._onLog&&li._onLog("drawImage() in context2d end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:go.RGBA,bUseWebGL:!1}}li._onLog&&li._onLog("drawImage() in WebGL.");try{(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q,re.ctxWebGL&&re.ctxWebGL.viewport(0,0,F+B,V+Q));const se=re.ctxWebGL||re.getContext("webgl",{antialias:!1})||re.getContext("experimental-webgl",{antialias:!1});if(!se){li._onLog&&li._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const te=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw te.name="WebGLError",te}if(!re.ctxWebGL||Z!==Wl(this,tE,"f")){re.ctxWebGL=se;const te=k=>{const N=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,N),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW);const $=k.createBuffer();return k.bindBuffer(k.ARRAY_BUFFER,$),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW),{positions:N,texCoords:$}},Me=k=>{const N=k.createTexture();return k.bindTexture(k.TEXTURE_2D,N),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),N},we=(k,N)=>{const $=k.createProgram();if(N.forEach(ie=>k.attachShader($,ie)),k.linkProgram($),!k.getProgramParameter($,k.LINK_STATUS)){const ie=new Error(`An error occured linking the program: ${k.getProgramInfoLog($)}.`);throw ie.name="WebGLError",ie}return k.useProgram($),$},Le=(k,N,$)=>{const ie=k.createShader(N);if(k.shaderSource(ie,$),k.compileShader(ie),!k.getShaderParameter(ie,k.COMPILE_STATUS)){const ee=new Error(`An error occured compiling the shader: ${k.getShaderInfoLog(ie)}.`);throw ee.name="WebGLError",ee}return ie},j="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let L="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Z)&&(L=Z.slice(0,3));const Y=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${L} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,q=we(se,[Le(se,se.VERTEX_SHADER,j),Le(se,se.FRAGMENT_SHADER,Y)]);Yd(this,xx,{program:q,attribLocations:{vertexPosition:se.getAttribLocation(q,"a_position"),texPosition:se.getAttribLocation(q,"a_texCoord")},uniformLocations:{uSampler:se.getUniformLocation(q,"u_image"),uColorFactor:se.getUniformLocation(q,"uColorFactor"),uMatrix:se.getUniformLocation(q,"u_matrix"),uTextureMatrix:se.getUniformLocation(q,"u_textureMatrix")}},"f"),Yd(this,wx,te(se),"f"),Yd(this,o_,Me(se),"f"),Yd(this,tE,Z,"f")}const ce=(te,Me,we)=>{te.bindBuffer(te.ARRAY_BUFFER,Me),te.enableVertexAttribArray(we),te.vertexAttribPointer(we,2,te.FLOAT,!1,0,0)},Ce=(te,Me,we,Le)=>{te.clearColor(0,0,0,1),te.clearDepth(1),te.enable(te.DEPTH_TEST),te.depthFunc(te.LEQUAL),te.clear(te.COLOR_BUFFER_BIT|te.DEPTH_BUFFER_BIT),ce(te,we.positions,Me.attribLocations.vertexPosition),ce(te,we.texCoords,Me.attribLocations.texPosition),te.activeTexture(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,Le),te.uniform1i(Me.uniformLocations.uSampler,0),te.uniform1f(Me.uniformLocations.uColorFactor,[go.GREY,go.GREY32].includes(Z)?1:0);let j,L,Y=$c.translate($c.identity(),-1,-1);Y=$c.scale(Y,2,2),Y=$c.scale(Y,1/te.canvas.width,1/te.canvas.height),j=$c.translate(Y,F,V),j=$c.scale(j,B,Q),te.uniformMatrix3fv(Me.uniformLocations.uMatrix,!1,j),L=$c.translate($c.identity(),w/h,I/v),L=$c.scale(L,A/h,M/v),te.uniformMatrix3fv(Me.uniformLocations.uTextureMatrix,!1,L),te.drawArrays(te.TRIANGLES,0,6)};((te,Me,we)=>{const Le=te.RGBA,j=te.RGBA,L=te.UNSIGNED_BYTE;te.bindTexture(te.TEXTURE_2D,Me),te.texImage2D(te.TEXTURE_2D,0,Le,j,L,we)})(se,Wl(this,o_,"f"),o),Ce(se,Wl(this,xx,"f"),Wl(this,wx,"f"),Wl(this,o_,"f"));const Ve=J||new Uint8Array(4*B*Q);if(se.readPixels(F,V,B,Q,se.RGBA,se.UNSIGNED_BYTE,Ve),255!==Ve[3]){li._onLog&&li._onLog("Incorrect WebGL drawing .");const te=new Error("WebGL error: incorrect drawing.");throw te.name="WebGLError",te}return li._onLog&&li._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:Z===go.GREY?go.GREY32:Z,bUseWebGL:!0}}catch(se){if(this.forceLoseContext(),null==(null==_?void 0:_.bUseWebGL))return li._onLog&&li._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(n,o,h,v,y,Object.assign({},_,{bUseWebGL:!1}));throw se.name="WebGLError",se}}readCvsData(n,o,h){if(!(n instanceof CanvasRenderingContext2D||n instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let v,y=0,_=0,b=n.canvas.width,w=n.canvas.height;if(o&&(o.x&&(y=o.x),o.y&&(_=o.y),o.width&&(b=o.width),o.height&&(w=o.height)),(null==h?void 0:h.length)<4*b*w)throw new Error("Unexpected size of the 'bufferContainer'.");if(n instanceof WebGLRenderingContext){const I=n;h?(I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,h),v=new Uint8Array(h.buffer,0,4*b*w)):(v=new Uint8Array(4*b*w),I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,v))}else if(n instanceof CanvasRenderingContext2D){let I;I=n.getImageData(y,_,b,w),v=new Uint8Array(I.data.buffer),null==h||h.set(v)}return v}transformPixelFormat(n,o,h,v){let y,_;if(li._onLog&&(y=Date.now(),li._onLog("transformPixelFormat(), START: "+y)),o===h)return li._onLog&&li._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),v?new Uint8Array(n):n;const b=[go.RGBA,go.RBGA,go.GRBA,go.GBRA,go.BRGA,go.BGRA];if(b.includes(o))if(h===go.GREY){_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=.21*n[w]+.71*n[w+1]+.07*n[w+2]}else if(h===go.GREY32){_=v?new Uint8Array(n):n;for(let w=0;w<n.length;w+=4){const I=.21*n[w]+.71*n[w+1]+.07*n[w+2];_[w]=I,_[w+1]=I,_[w+2]=I}}else{if(!b.includes(h))throw new Error("Unable to transform.");if(v){_=new Uint8Array(n);const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4)_[B+M]=n[B+w],_[B+F]=n[B+I],_[B+V]=n[B+A]}else{_=n;const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4){let Q=[n[B],n[B+1],n[B+2]];_[B+M]=Q[w],_[B+F]=Q[I],_[B+V]=Q[A]}}}else if(o===go.GREY){if(h!==go.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*n.length);for(let w=0;w<n.length;w++)_[4*w]=n[w],_[4*w+1]=n[w],_[4*w+2]=n[w],_[4*w+3]=255}else{if(o!==go.GREY32)throw new Error("Unable to transform.");if(h!==go.GREY)throw new Error("Unable to transform.");_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=n[w]}return li._onLog&&li._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),_}getImageData(n,o,h,v,y){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!o||!h)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Wl(li,hp,"f",fp)&&li.checkWebGLSupport(),(null==y?void 0:y.bUseWebGL)&&!Wl(li,hp,"f",fp))throw new Error("Your browser or machine may not support WebGL.");if(v.sx>o||v.sy>h||v.sx+v.sWidth>o||v.sy+v.sHeight>h)throw new Error("Invalid position.");if(n instanceof HTMLVideoElement&&4!==n.readyState||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let _;li._onLog&&(_=Date.now(),li._onLog("getImageData(), START: "+_));const b=Math.round(v.sx),w=Math.round(v.sy),I=Math.round(v.sWidth),A=Math.round(v.sHeight),M=Math.round(v.dWidth),F=Math.round(v.dHeight);let V=go.RGBA;(null==y?void 0:y.pixelFormat)&&(V=y.pixelFormat);let B,Q,J,Z=null;if((null==y?void 0:y.bufferContainer)&&(Z=y.bufferContainer),Wl(li,hp,"f",fp)&&(this.useWebGLByDefault&&null==(null==y?void 0:y.bUseWebGL)||(null==y?void 0:y.bUseWebGL))){li._onLog&&li._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),B=this._reusedWebGLCvs;try{if(Z)if(V===go.GREY){if(J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}}else Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:Z}),J=new Uint8Array(Z.buffer,0,4*M*F),J=this.transformPixelFormat(J,Q.pixelFormat,V);else V===go.GREY?((!Wl(this,s_,"f")||Wl(this,s_,"f").length<4*M*F)&&Yd(this,s_,new Uint8Array(4*M*F),"f"),J=new Uint8Array(Wl(this,s_,"f").buffer,0,4*M*F)):J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V)}catch(re){if("WebGLError"===re.name&&(this.forceLoseContext(),null==(null==y?void 0:y.bUseWebGL)))return li._onLog&&li._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},Object.assign({},y,{bUseWebGL:!1}));throw re}}else if(li._onLog&&li._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),B=this._reusedCvs,Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:go.RGBA,bUseWebGL:!1}),J=this.readCvsData(Q.context,{width:M,height:F},null),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}return li._onLog&&li._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:J,pixelFormat:V,width:M,height:F,bUseWebGL:Q.bUseWebGL}}convertDataToCvs(n,o,h,v){if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof o||o<=0)throw new Error("Invalid 'width'.");if("number"!=typeof h||h<=0)throw new Error("Invalid 'height'.");const y=document.createElement("canvas");let _;if(y.width=o,y.height=h,v===go.GREY){_=new Uint8ClampedArray(4*o*h);for(let w=0;w<_.length;w+=4)_[w]=n[w/4],_[w+1]=n[w/4],_[w+2]=n[w/4],_[w+3]=255}else _=new Uint8ClampedArray(n.buffer);const b=new ImageData(_,o,h);return y.getContext("2d").putImageData(b,0,0),y}forceLoseContext(){if(!this._reusedWebGLCvs)return;const n=this._reusedWebGLCvs.ctxWebGL;n&&!n.isContextLost()&&n.getExtension("WEBGL_lose_context")&&n.getExtension("WEBGL_lose_context").loseContext(),Yd(this,o_,null,"f"),Yd(this,xx,null,"f"),Yd(this,wx,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Yd(this,nE,!0,"f")}}hp=li,tE=new WeakMap,o_=new WeakMap,xx=new WeakMap,wx=new WeakMap,s_=new WeakMap,nE=new WeakMap,fp={value:void 0};const FK="undefined"==typeof self,gO=(()=>{if(!FK&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),LK=p=>{if(null==p&&(p="./"),!FK){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p};kn.dbr={version:"10.4.20",path:gO},Bu.dbr={js:!1,wasm:!0,deps:["license","dip"]},io.dbr={};const mO="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,mO)<0&&(kn.std={version:mO,path:LK(gO+`../../dynamsoft-capture-vision-std@${mO}/dist/`)});const vO="2.4.20";var NK,BK,WK,UK;(!kn.dip||"string"!=typeof kn.dip&&Wc(kn.dip.version,vO)<0)&&(kn.dip={version:vO,path:LK(gO+`../../dynamsoft-image-processing@${vO}/dist/`)}),BigInt(0),BigInt("0xFFFFFFFEFFFFFFFF"),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552),function(p){p[p.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",p[p.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",p[p.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(NK||(NK={})),function(p){p[p.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",p[p.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",p[p.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",p[p.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(BK||(BK={})),function(p){p[p.LM_AUTO=1]="LM_AUTO",p[p.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",p[p.LM_STATISTICS=4]="LM_STATISTICS",p[p.LM_LINES=8]="LM_LINES",p[p.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",p[p.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",p[p.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",p[p.LM_CENTRE=128]="LM_CENTRE",p[p.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",p[p.LM_REV=-2147483648]="LM_REV",p[p.LM_SKIP=0]="LM_SKIP"}(WK||(WK={})),function(p){p[p.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",p[p.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",p[p.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",p[p.DM_SMOOTHING=8]="DM_SMOOTHING",p[p.DM_MORPHING=16]="DM_MORPHING",p[p.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",p[p.DM_SHARPENING=64]="DM_SHARPENING",p[p.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",p[p.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",p[p.DM_REV=-2147483648]="DM_REV",p[p.DM_SKIP=0]="DM_SKIP"}(UK||(UK={}));const VK="undefined"==typeof self,Ix=(()=>{if(!VK&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),oE=p=>{if(null==p&&(p="./"),!VK){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p};kn.dlr={version:"3.4.20",path:Ix},null==kn.dlrData&&(kn.dlrData={version:"1.0.11",path:oE(Ix+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")}),Bu.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},Bu.dnn={wasm:!0,deps:["dip"]};const yO="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,yO)<0&&(kn.std={version:yO,path:oE(Ix+`../../dynamsoft-capture-vision-std@${yO}/dist/`)});const _O="2.4.20";(!kn.dip||"string"!=typeof kn.dip&&Wc(kn.dip.version,_O)<0)&&(kn.dip={version:_O,path:oE(Ix+`../../dynamsoft-image-processing@${_O}/dist/`)});const CO="1.0.20";(!kn.dnn||"string"!=typeof kn.dnn&&Wc(kn.dnn.version,CO)<0)&&(kn.dnn={version:CO,path:oE(Ix+`../../dynamsoft-capture-vision-dnn@${CO}/dist/`)});let jK=!1;class Ex{static getVersion(){return`3.4.20(Worker: ${Ll.dlr&&Ll.dlr.worker||"Not Loaded"}, Wasm: ${Ll.dlr&&Ll.dlr.wasm||"Not Loaded"})`}static loadRecognitionData(n,o){return Fe(function*(){return yield Wu("dlr"),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var b=Fe(function*(w){if(w.success){const I=w.result;if(0!==I.exception){let A=new Error(I.description);return A.errorCode=I.exception,v(A)}return I.bModel||(jK=!0),h(I)}{let I=new Error(w.message);return I.stack=w.stack+"\n"+I.stack,v(I)}});return function(w){return b.apply(this,arguments)}}(),o&&!o.endsWith("/")&&(o+="/");const _=pv(Mo.engineResourcePaths,kn);o||"ConfusableChars"!==n||(o=_.dlr),_i.postMessage({type:"dlr_loadData",id:y,body:{dataName:n,dataPath:o||_.dlrData}})})})()}}var HK,sE,aE;function GK(p){delete p.moduleId;const n=JSON.parse(p.jsonString).ResultInfo,o=p.fullCodeString;p.getFieldValue=h=>"fullcodestring"===h.toLowerCase()?o:zK(n,h),p.getFieldMappingStatus=h=>YK(n,h),p.getFieldValidationStatus=h=>XK(n,h),delete p.fullCodeString}function zK(p,n){for(let o of p){if(o.FieldName===n)return o.Value;if(o.ChildFields&&o.ChildFields.length>0){let h;for(let v of o.ChildFields)h=zK(v,n);if(void 0!==h)return h}}}function YK(p,n){for(let o of p){if(o.FieldName===n)return o.MappingStatus?Number(sE[o.MappingStatus]):sE.MS_NONE;if(o.ChildFields&&o.ChildFields.length>0){let h;for(let v of o.ChildFields)h=YK(v,n);if(void 0!==h)return h}}}function XK(p,n){for(let o of p){if(o.FieldName===n&&o.ValidationStatus)return o.ValidationStatus?Number(aE[o.ValidationStatus]):aE.VS_NONE;if(o.ChildFields&&o.ChildFields.length>0){let h;for(let v of o.ChildFields)h=XK(v,n);if(void 0!==h)return h}}}function lE(p){if(p.disposed)throw new Error('"CodeParser" instance has been disposed')}io.dlr={loadRecognitionData:Ex.loadRecognitionData,get bLoadConfusableCharsData(){return jK}},function(p){p[p.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",p[p.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",p[p.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED"}(HK||(HK={})),Ui[-1]=function(){var p=Fe(function*(n){Ex.onDataLoadProgressChanged&&Ex.onDataLoadProgressChanged(n.resourcesPath,n.tag,{loaded:n.loaded,total:n.total})});return function(n){return p.apply(this,arguments)}}(),function(p){p[p.MS_NONE=0]="MS_NONE",p[p.MS_SUCCEEDED=1]="MS_SUCCEEDED",p[p.MS_FAILED=2]="MS_FAILED"}(sE||(sE={})),function(p){p[p.VS_NONE=0]="VS_NONE",p[p.VS_SUCCEEDED=1]="VS_SUCCEEDED",p[p.VS_FAILED=2]="VS_FAILED"}(aE||(aE={}));const $K=p=>p&&"object"==typeof p&&"function"==typeof p.then;class wEe extends Promise{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(n){var o=this;let h;this._task=n,$K(n)?h=n:"function"==typeof n&&(h=new Promise(n)),h&&Fe(function*(){try{const v=yield h;n===o._task&&o.resolve(v)}catch(v){n===o._task&&o.reject(v)}})()}get isEmpty(){return null==this._task}constructor(n){let o,h;super((v,y)=>{o=v,h=y}),this._s="pending",this.resolve=v=>{this.isPending&&($K(v)?this.task=v:(this._s="fulfilled",o(v)))},this.reject=v=>{this.isPending&&(this._s="rejected",h(v))},this.task=n}}class cE{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static createInstance(){return Fe(function*(){if(!io.license)throw Error("Module `license` is not existed.");yield io.license.dynamsoft(),yield Wu("dcp");const n=new cE,o=new wEe;let h=Sr();return Ui[h]=function(){var v=Fe(function*(y){if(y.success)n._instanceID=y.instanceID,o.resolve(n);else{const _=Error(y.message);y.stack&&(_.stack=y.stack),o.reject(_)}});return function(y){return v.apply(this,arguments)}}(),_i.postMessage({type:"dcp_createInstance",id:h}),o})()}dispose(){var n=this;return Fe(function*(){lE(n);let o=Sr();n.bDestroyed=!0,Ui[o]=h=>{if(!h.success){let v=new Error(h.message);throw v.stack=h.stack+"\n"+v.stack,v}},_i.postMessage({type:"dcp_dispose",id:o,instanceID:n._instanceID})})()}get disposed(){return this.bDestroyed}initSettings(n){var o=this;return Fe(function*(){return lE(o),n&&["string","object"].includes(typeof n)?("string"==typeof n&&function zIe(p){return/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(p)}(n)&&(n=yield p4(n,"text")),"object"==typeof n&&(n=JSON.stringify(n)),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var _=Fe(function*(b){if(b.success){const w=JSON.parse(b.response);if(0!==w.exception){let I=new Error(w.description?w.description:"Init Settings Failed.");return I.errorCode=w.exception,v(I)}return h(w)}{let w=new Error(b.message);return w.stack=b.stack+"\n"+w.stack,v(w)}});return function(b){return _.apply(this,arguments)}}(),_i.postMessage({type:"dcp_initSettings",id:y,instanceID:o._instanceID,body:{settings:n}})})):console.error("Invalid settings.")})()}resetSettings(){var n=this;return Fe(function*(){return lE(n),yield new Promise((o,h)=>{let v=Sr();Ui[v]=function(){var y=Fe(function*(_){if(_.success)return o();{let b=new Error(_.message);return b.stack=_.stack+"\n"+b.stack,h(b)}});return function(_){return y.apply(this,arguments)}}(),_i.postMessage({type:"dcp_resetSettings",id:v,instanceID:n._instanceID})})})()}parse(n,o=""){var h=this;return Fe(function*(){if(lE(h),!n||!(n instanceof Array||n instanceof Uint8Array||"string"==typeof n))throw new Error("`parse` must pass in an Array or Uint8Array or string");return yield new Promise((v,y)=>{let _=Sr();n instanceof Array&&(n=Uint8Array.from(n)),"string"==typeof n&&(n=Uint8Array.from(function(b){let w=[];for(let I=0;I<b.length;++I)w.push(b.charCodeAt(I));return w}(n))),Ui[_]=function(){var b=Fe(function*(w){if(w.success){let I=JSON.parse(w.parseResponse);return I.exception?y(new Error(I.description)):(GK(I),v(I))}{let I=new Error(w.message);return I.stack=w.stack+"\n"+I.stack,y(I)}});return function(w){return b.apply(this,arguments)}}(),_i.postMessage({type:"dcp_parse",id:_,instanceID:h._instanceID,body:{source:n,taskSettingName:o}})})})()}}const qK="undefined"==typeof self,KK=(()=>{if(!qK&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})();kn.dcp={version:"2.4.22",path:KK},Bu.dcp={js:!0,wasm:!0,deps:["license"]},io.dcp={handleParsedResultItem:GK};const bO="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,bO)<0&&(kn.std={version:bO,path:(p=>{if(null==p&&(p="./"),!qK){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p})(KK+`../../dynamsoft-capture-vision-std@${bO}/dist/`)});class Hu{static getVersion(){return`2.4.22(Worker: ${Ll.dcp&&Ll.dcp.worker||"Not Loaded"}, Wasm: ${Ll.dcp&&Ll.dcp.wasm||"Not Loaded"})`}static loadSpec(n,o){return Fe(function*(){return yield Wu("dcp"),yield new Promise((h,v)=>{let y=Sr();Ui[y]=function(){var w=Fe(function*(I){if(I.success)return h();{let A=new Error(I.message);return A.stack=I.stack+"\n"+A.stack,v(A)}});return function(I){return w.apply(this,arguments)}}(),o&&!o.endsWith("/")&&(o+="/");const _=n instanceof Array?n:[n],b=pv(Mo.engineResourcePaths,kn);_i.postMessage({type:"dcp_appendResourceBuffer",id:y,body:{specificationPath:o||b.dcp+"specification/",specificationNames:_}})})})()}}const JK="undefined"==typeof self,xO=(()=>{if(!JK&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),QK=p=>{if(null==p&&(p="./"),!JK){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p};kn.ddn={version:"2.4.20",path:xO},Bu.ddn={js:!0,wasm:!0,deps:["license","dip"]},io.ddn={handleNormalizedImageResultItem:function(p){let n=p,o=vI(n.imageData);n.toCanvas=()=>m4(o),n.toImage=h=>((p,n)=>{Gb(n)&&(n=vI(n));const o=m4(n);let h=new Image,v=o.toDataURL(p);return h.src=v,h})(h,o),n.toBlob=h=>Pq(h,o),n.saveToFile=function(){var h=Fe(function*(v,y){if(!v)return null;if("string"!=typeof v)throw new TypeError("FileName must be of type string.");return XIe(o,v,y)});return function(v,y){return h.apply(this,arguments)}}()}};const wO="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,wO)<0&&(kn.std={version:wO,path:QK(xO+`../../dynamsoft-capture-vision-std@${wO}/dist/`)});const SO="2.4.20";var jh;(!kn.dip||"string"!=typeof kn.dip&&Wc(kn.dip.version,SO)<0)&&(kn.dip={version:SO,path:QK(xO+`../../dynamsoft-image-processing@${SO}/dist/`)}),function(p){p[p.ICM_COLOUR=0]="ICM_COLOUR",p[p.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",p[p.ICM_BINARY=2]="ICM_BINARY"}(jh||(jh={}));const eJ="undefined"==typeof self,TO=(()=>{if(!eJ&&document.currentScript){let p=document.currentScript.src,n=p.indexOf("?");if(-1!=n)p=p.substring(0,n);else{let o=p.indexOf("#");-1!=o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})(),tJ=p=>{if(null==p&&(p="./"),!eJ){let n=document.createElement("a");n.href=p,p=n.href}return p.endsWith("/")||(p+="/"),p};kn.utility={version:"1.4.20",path:TO},Bu.utility={js:!0,wasm:!0};const IO="1.4.10";"string"!=typeof kn.std&&Wc(kn.std.version,IO)<0&&(kn.std={version:IO,path:tJ(TO+`../../dynamsoft-capture-vision-std@${IO}/dist/`)});const EO="2.4.20";function nJ(p){const n={};let o=p.getFieldValue("documentCode");n["Document Type"]=JSON.parse(p.jsonString).CodeType;let h=p.getFieldValue("issuingState");n["Issuing State"]=h;let v=p.getFieldValue("primaryIdentifier");n.Surname=v;let y=p.getFieldValue("secondaryIdentifier");n["Given Name"]=y;let _=p.getFieldValue("P"===o?"passportNumber":"documentNumber");n["Passport Number"]=_;let b=p.getFieldValue("nationality");n.Nationality=b;let w=p.getFieldValue("sex");n.Gender=w;let I=p.getFieldValue("birthYear"),A=p.getFieldValue("birthMonth"),M=p.getFieldValue("birthDay");I=parseInt(I)>(new Date).getFullYear()%100?"19"+I:"20"+I,n["Date of Birth (YYYY-MM-DD)"]=I+"-"+A+"-"+M;let F=p.getFieldValue("expiryYear"),V=p.getFieldValue("expiryMonth"),B=p.getFieldValue("expiryDay");return F=parseInt(F)>=60?"19"+F:"20"+F,n["Date of Expiry (YYYY-MM-DD)"]=F+"-"+V+"-"+B,n}function qc(p){return`${window.location.protocol}//${window.location.host}${window.location.pathname}${p}`}function lt(p,n,o){if("function"==typeof p?p===n:p.has(n))return arguments.length<3?n:o;throw new TypeError("Private element is not present on this object")}function iJ(p,n){if(n.has(p))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Xe(p,n){return p.get(lt(p,n))}function bi(p,n,o){iJ(p,n),n.set(p,o)}function Wn(p,n,o){return p.set(lt(p,n),o),o}function Hh(p,n,o){return o(lt(p,n))}function dl(p,n){iJ(p,n),n.add(p)}function W(p,n,o){return(n="symbol"==typeof(v=function(y,_){if("object"!=typeof y||!y)return y;var b=y[Symbol.toPrimitive];if(void 0!==b){var w=b.call(y,"string");if("object"!=typeof w)return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}(n))?v:v+"")in p?Object.defineProperty(p,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):p[n]=o,p;var v}function gn(p,n,o,h){return new(o||(o=Promise))(function(v,y){function _(I){try{w(h.next(I))}catch(A){y(A)}}function b(I){try{w(h.throw(I))}catch(A){y(A)}}function w(I){var A;I.done?v(I.value):(A=I.value,A instanceof o?A:new o(function(M){M(A)})).then(_,b)}w((h=h.apply(p,n||[])).next())})}function Ne(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function Ot(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}var Tr,Fo,wo,DO,pp,Gu,Kc,da,rJ,Xd,vE,Dx,yE,Xt,_E,AO,CE,bE,PO,xE,wE,oJ,Sv,c_,wa,RO,kO,zu,Tv,SE,u_,TE,IE,d_,h_,f_,EE,uc,sJ,aJ,$d,DE,Ba,p_,Gh,Iv,lJ,cJ,Bg,AE,Wg,qd,Ax,PE,RE,kE,Ev,uJ,dJ,MO,hJ,OO,FO,ps,hl,Px,Ds,g_,fJ,Rx,ME,Yu,m_,LO,NO,pJ,gJ,mJ,vJ,yJ,BO,_J,CJ,bJ,kx,xJ,wJ,Wa,WO,UO,Jc,v_,Ua,Or,OE,y_,Mx,VO,jO,HO,FE,Qc,gp,Ox,Fx,Lx,LE,NE,SJ,__,BE,GO,zO,TJ,IJ,EJ,WE,YO,XO,C_,DJ,Ug,Vg,UE,$O,Dv,Nx,VE,AJ,Xu,Av,b_,Pv,Bx,PJ,Wx,RJ,kJ,jg,jE,mp,Rv,kv,MJ,OJ,FJ,LJ,NJ,cn,x_,Hg,mo,vo,w_,vp,yp,qO,BJ,WJ,UJ;(!kn.dip||"string"!=typeof kn.dip&&Wc(kn.dip.version,EO)<0)&&(kn.dip={version:EO,path:tJ(TO+`../../dynamsoft-image-processing@${EO}/dist/`)}),"function"==typeof SuppressedError&&SuppressedError,"function"==typeof SuppressedError&&SuppressedError,function(p){p.logInfo="logInfo",p.logDebug="logDebug",p.logAll="logAll",p.imgIO="imgIO",p.core="imgCore",p.imgProc="imgProc",p.pdfR="pdfReader",p.pdfW="pdfWriter",p.crypto="crypto",p.binaryBlobType="application/octet-stream",p.wasmExtension=".wasm"}(Tr||(Tr={})),function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(Fo||(Fo={})),function(p){p.pending="pending",p.ready="ready",p.failed="failed",p.destroyed="destroyed",p.init="init"}(wo||(wo={})),function(p){p.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",p.TIMEOUT="Timeout no Response = ",p.FILE_STREAM_ERROR="File Stream Error = ",p.WASM_EXCEPTION_ERROR="An WASM exception occurred."}(DO||(DO={})),function(p){p[p.LONG_KEY=0]="LONG_KEY",p[p.DLS_KEY=1]="DLS_KEY"}(pp||(pp={})),function(p){p[p.wasmSucceed=0]="wasmSucceed",p[p.wasmBase=-4e3]="wasmBase",p[p.wasmException=-4001]="wasmException",p[p.wasmNoModule=-4002]="wasmNoModule",p[p.wasmJsBase=-4100]="wasmJsBase",p[p.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",p[p.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",p[p.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",p[p.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",p[p.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",p[p.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",p[p.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",p[p.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",p[p.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",p[p.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",p[p.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",p[p.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed"}(Gu||(Gu={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(Kc||(Kc={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(da||(da={})),function(p){p[p.SF_DEF=0]="SF_DEF",p[p.SF_ENABLE=1]="SF_ENABLE",p[p.SF_DISABLE=2]="SF_DISABLE"}(rJ||(rJ={})),function(p){p.imgIOVer="2.0.0",p.coreVer="2.0.0",p.imgProcVer="2.0.0",p.pdfRVer="2.0.0",p.pdfWVer="2.0.0",p.cryptoVer="2.0.0"}(uc||(uc={}));class On{static setLogFunc(n,o,h){Ot(this,Xd,n,"f",vE),Ot(this,Xd,o,"f",Dx),Ot(this,Xd,h,"f",yE)}static get level(){return Ne(this,Xd,"f",vE)}static get func(){return Ne(this,Xd,"f",Dx)}static get context(){return Ne(this,Xd,"f",yE)}static logAll(n){this.log(Tr.logAll,n)}static logD(n){this.log(Tr.logDebug,n)}static log(n,o){Ne(this,Xd,"f",Dx)&&Ne(this,Xd,"f",vE)===n&&Ne(this,Xd,"f",Dx).call(this,o,Ne(this,Xd,"f",yE))}}Xd=On,vE={value:""},Dx={value:void 0},yE={value:null};class _n{static unload(){Ot(this,Xt,"","f",_E),Ot(this,Xt,"","f",CE),Ot(this,Xt,null,"f",bE),Ot(this,Xt,{name:Tr.imgIO,workerName:Fo.core,autoLoad:!1,ver:uc.imgIOVer,prefixName:_n.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:Ne(_n,Xt,"f",zu)},"f",TE),Ot(this,Xt,{name:Tr.crypto,workerName:Fo.core,autoLoad:!1,ver:uc.cryptoVer,prefixName:_n.CryptoPrefixName,dependencyModules:[Tr.imgIO],fetchOptions:Ne(_n,Xt,"f",zu)},"f",IE),Ot(this,Xt,{name:Tr.pdfR,workerName:Fo.reader,autoLoad:!1,ver:uc.pdfRVer,prefixName:_n.PdfReaderPrefixName,dependencyModules:[Tr.imgIO,Tr.core],fetchOptions:Ne(_n,Xt,"f",zu)},"f",d_),Ot(this,Xt,{name:Tr.core,workerName:Fo.core,autoLoad:!1,ver:uc.coreVer,prefixName:_n.ImagecorePrefixName,dependencyModules:[Tr.imgIO],fetchOptions:Ne(_n,Xt,"f",zu)},"f",h_),Ot(this,Xt,{name:Tr.imgProc,workerName:Fo.core,autoLoad:!1,ver:uc.imgProcVer,prefixName:_n.ImageProcPrefixName,dependencyModules:[Tr.imgIO,Tr.core],useSimd:_n.UseSimd},"f",f_),On.setLogFunc("",void 0,null)}static get UseSimd(){return Ne(this,Xt,"f",xE)}static set UseSimd(n){Ot(this,Xt,n,"f",xE)}static get License(){return Ne(this,Xt,"f",_E)}static set License(n){Ot(this,Xt,n,"f",_E)}static get LicMode(){return Ne(this,Xt,"f",AO)}static set LicMode(n){Ot(this,Xt,n,"f",AO),Ne(this,Xt,"m",oJ).call(this)}static get UUID(){return Ne(this,Xt,"f",CE)}static set UUID(n){Ot(this,Xt,n,"f",CE)}static get NavInfo(){return Ne(this,Xt,"f",bE)}static set NavInfo(n){Ot(this,Xt,n,"f",bE)}static get Mobile(){return Ne(this,Xt,"f",PO)}static set Mobile(n){Ot(this,Xt,n,"f",PO)}static get DefHeapSize(){return Ne(this,Xt,"f",Sv)}static set DefHeapSize(n){Ot(this,Xt,n,"f",Sv)}static get MaxHeapSize(){return Ne(this,Xt,"f",c_)}static get HeapConfig(){return Ne(this,Xt,"m",RO).call(this),Object.assign({},Ne(this,Xt,"f",wa))}static getWorkerHeap(n){return void 0!==Ne(this,Xt,"f",wa)[n]?Ne(this,Xt,"f",wa)[n]:{maxHeapSize:Ne(this,Xt,"f",c_),initHeapSize:Ne(this,Xt,"f",Sv)}}static UpdateHeapConfig(n,o,h){Ne(this,Xt,"m",RO).call(this),o&&void 0!==Ne(this,Xt,"f",wa)[n]&&(Ne(this,Xt,"f",wa)[n].maxHeapSize=o),h&&void 0!==Ne(this,Xt,"f",wa)[n]&&(Ne(this,Xt,"f",wa)[n].initHeapSize=h)}static get ImageIOWorkerJS(){return"ddv-imageio.worker.js?v="+uc.imgIOVer}static get PdfReaderWorkerJS(){return"dynamsoft.pdfReader_wasm-"+uc.pdfRVer+".js"}static get ImageIOPrefixName(){return"ddv-imageio"}static get ImagecorePrefixName(){return"ddv-imagecore"}static get ImageProcPrefixName(){return"ddv-imageproc"}static get PdfReaderPrefixName(){return"ddv-pdfreader"}static get CryptoPrefixName(){return"ddv-crypto"}static get ImageIOResource(){return Ne(this,Xt,"f",Tv)}static set ImageIOResource(n){Ot(this,Xt,Ne(this,Xt,"m",kO).call(this,n),"f",Tv),Ne(this,Xt,"m",u_).call(this,Ne(this,Xt,"f",Tv),Ne(this,Xt,"f",TE)),Ne(this,Xt,"m",u_).call(this,Ne(this,Xt,"f",Tv),Ne(this,Xt,"f",IE)),Ne(this,Xt,"m",u_).call(this,Ne(this,Xt,"f",Tv),Ne(this,Xt,"f",h_)),Ne(this,Xt,"m",u_).call(this,Ne(this,Xt,"f",Tv),Ne(this,Xt,"f",f_))}static get PdfReaderResource(){return Ne(this,Xt,"f",SE)}static set PdfReaderResource(n){n.useFastCompEdition=!1,Ot(this,Xt,Ne(this,Xt,"m",kO).call(this,n),"f",SE),Ne(this,Xt,"m",u_).call(this,Ne(this,Xt,"f",SE),Ne(this,Xt,"f",d_)),this.PdfReaderModule.singleInstance=!0}static get ImageIOModule(){return Ne(this,Xt,"f",TE)}static get CryptoModule(){return Ne(this,Xt,"f",IE)}static get PdfReaderModule(){return Ne(this,Xt,"f",d_)}static get ImagecoreModule(){return Ne(this,Xt,"f",h_)}static get ImageReadereModule(){const n=Object.assign({},Ne(this,Xt,"f",h_));return n.workerName=Fo.reader,n}static get ImageProcModule(){return Ne(this,Xt,"f",f_)}static get DetectorModule(){return Ot(this,Xt,Object.assign({},Ne(this,Xt,"f",f_)),"f",EE),Ne(this,Xt,"f",EE).workerName=Fo.detector,Ne(this,Xt,"f",EE)}static get PdfWriterModule(){const n=Object.assign({},Ne(this,Xt,"f",d_));return n.workerName=Fo.core,n}static setLogFunc(n,o,h){On.setLogFunc(n,o,h)}}Xt=_n,wE=function(p){this.LicMode==pp.DLS_KEY&&p.dependencyModules&&-1!=p.dependencyModules.indexOf(Tr.imgIO)&&-1==p.dependencyModules.indexOf(Tr.crypto)&&p.dependencyModules.push(Tr.crypto)},oJ=function(){Ne(this,Xt,"m",wE).call(this,Ne(this,Xt,"f",h_)),Ne(this,Xt,"m",wE).call(this,Ne(this,Xt,"f",f_)),Ne(this,Xt,"m",wE).call(this,Ne(this,Xt,"f",d_))},RO=function(){0===Object.keys(Ne(this,Xt,"f",wa)).length&&(Ne(this,Xt,"f",wa)[Fo.core]={},Ne(this,Xt,"f",wa)[Fo.core].maxHeapSize=Ne(this,Xt,"f",c_),Ne(this,Xt,"f",wa)[Fo.core].initHeapSize=Ne(this,Xt,"f",Sv),Ne(this,Xt,"f",wa)[Fo.reader]={},Ne(this,Xt,"f",wa)[Fo.reader].maxHeapSize=Ne(this,Xt,"f",c_),Ne(this,Xt,"f",wa)[Fo.reader].initHeapSize=Ne(this,Xt,"f",Sv),Ne(this,Xt,"f",wa)[Fo.detector]={},Ne(this,Xt,"f",wa)[Fo.detector].maxHeapSize=Ne(this,Xt,"f",c_),Ne(this,Xt,"f",wa)[Fo.detector].initHeapSize=Ne(this,Xt,"f",Sv))},kO=function(p){var n,o,h;let v={crossScript:!1,resourceDir:p.resourceDir,workerScript:p.workerScript,useFastCompEdition:null!==(n=p.useFastCompEdition)&&void 0!==n&&n,useSimd:null!==(o=p.useSimd)&&void 0!==o?o:Ne(this,Xt,"f",xE),fetchOptions:null!==(h=p.fetchOptions)&&void 0!==h?h:Ne(this,Xt,"f",zu)};return v.workerScript=p.resourceDir+p.workerScript,v.workerScript.startsWith("http://")||v.workerScript.startsWith("https://")?(v.resourceDir=p.resourceDir,v.workerScript.startsWith(location.origin)||(v.crossScript=!0)):p.resourceDir.startsWith("/")?null!=location.origin&&(v.resourceDir=location.origin+p.resourceDir):null!=location.href&&(v.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+p.resourceDir),v.resourceDir.endsWith("/")||(v.resourceDir+="/"),p.useFastCompEdition&&(v.resourceDir+="fastcomp/",v.workerScript=v.resourceDir+p.workerScript),v},u_=function(p,n){n.resourceDir=p.resourceDir,n.crossScript=p.crossScript,n.useSimd=n.name===Tr.imgProc&&p.useSimd,n.script=p.workerScript,n.fetchOptions=p.fetchOptions},_E={value:""},AO={value:pp.LONG_KEY},CE={value:""},bE={value:null},PO={value:!1},xE={value:!1},Sv={value:32},c_={value:200},wa={value:Object.create(null)},Tv={value:{resourceDir:"",workerScript:_n.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ne(_n,Xt,"f",zu={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}})}},SE={value:{resourceDir:"",workerScript:_n.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ne(_n,Xt,"f",zu)}},TE={value:{name:Tr.imgIO,workerName:Fo.core,autoLoad:!1,ver:uc.imgIOVer,prefixName:_n.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:Ne(_n,Xt,"f",zu)}},IE={value:{name:Tr.crypto,workerName:Fo.core,autoLoad:!1,ver:uc.cryptoVer,prefixName:_n.CryptoPrefixName,dependencyModules:[Tr.imgIO],fetchOptions:Ne(_n,Xt,"f",zu)}},d_={value:{name:Tr.pdfR,workerName:Fo.reader,autoLoad:!1,ver:uc.pdfRVer,prefixName:_n.PdfReaderPrefixName,dependencyModules:[Tr.imgIO,Tr.core],fetchOptions:Ne(_n,Xt,"f",zu)}},h_={value:{name:Tr.core,workerName:Fo.core,autoLoad:!1,ver:uc.coreVer,prefixName:_n.ImagecorePrefixName,dependencyModules:[Tr.imgIO],fetchOptions:Ne(_n,Xt,"f",zu)}},f_={value:{name:Tr.imgProc,workerName:Fo.core,autoLoad:!1,ver:uc.imgProcVer,prefixName:_n.ImageProcPrefixName,dependencyModules:[Tr.imgIO,Tr.core],useSimd:_n.UseSimd}},EE={value:void 0};class Gg{static read(n){return new Promise(function(o,h){let v=Object.prototype.toString.call(n);if("[object String]"===v){if(0===n.indexOf("blob:")||n.indexOf(".jpg")>0||n.indexOf(".jpeg")>0||n.indexOf(".png")>0||n.indexOf(".bmp")>0||n.indexOf(".dib")>0||n.indexOf(".pdf")>0||n.indexOf(".tiff")>0||n.indexOf(".tif")>0)return fetch(n,{mode:"cors"}).then(function(y){return y.arrayBuffer()}).then(function(y){return o(y)}).catch(function(y){return Promise.reject(y)});h("Error url: Can not read the file URL")}else if("[object Blob]"===v||"[object FileList]"===v||"[object File]"===v){let y=n;"[object FileList]"!==v&&"[object File]"!==v||(y=n[0]?n[0]:n),Ne(Gg,sJ,"m",aJ).call(Gg,y,o,h)}else"[object ArrayBuffer]"===v||"[object Uint8ClampedArray]"===v?o(n):h("Not support source type: "+v)})}}sJ=Gg,aJ=function(p,n,o){let h,v,y=0;try{h=new ArrayBuffer(p.size),v=new Uint8Array(h)}catch(_){o(_)}!function _(){const b=new FileReader;b.onload=function(A){var M;if(null===(M=null==A?void 0:A.target)||void 0===M?void 0:M.result){const F=A.target.result;v.set(new Uint8Array(F),y),y+=F.byteLength,y<p.size?_():n(h)}else o(A)},b.onerror=function(A){o(A)},b.onabort=function(A){o(A)};const w=Math.min(y+1048576,p.size),I=p.slice(y,w);b.readAsArrayBuffer(I)}()};class IEe{constructor(n,o,h,v,y,_){$d.add(this),DE.set(this,void 0),Ba.set(this,void 0),p_.set(this,void 0),Gh.set(this,void 0),Iv.set(this,void 0),lJ.set(this,void 0),cJ.set(this,void 0),Bg.set(this,void 0),AE.set(this,void 0),Wg.set(this,void 0),qd.set(this,void 0),Ax.set(this,void 0),PE.set(this,void 0),RE.set(this,0),kE.set(this,{}),Ev.set(this,null),Ot(this,DE,n,"f"),Ot(this,AE,v,"f"),Ot(this,PE,h,"f"),Ot(this,p_,[],"f"),Ot(this,Gh,!1,"f"),Ot(this,Iv,!1,"f"),Ot(this,RE,o,"f"),Ot(this,Ev,Object.create(null),"f"),Ne(this,kE,"f").modulesInfo=[],Ot(this,qd,Object.create(null),"f"),Ot(this,Bg,null,"f"),Ot(this,Wg,0,"f"),Ot(this,Ax,0,"f"),Ot(this,Ba,Ne(this,$d,"m",dJ).call(this,Ne(this,DE,"f")),"f"),Ne(this,Ba,"f").on("message",Ne(this,$d,"m",hJ),this),Ne(this,Ba,"f").on("error",Ne(this,$d,"m",MO),this),Ne(this,Ba,"f").on("exit",function(b,w,I){let A="Worker #terminated Unexpectedly\n";A+=" exitCode: `"+b+"`\n",A+=" signalCode: `"+w+"`\n",A+=" #script: `"+n+"`\n",Ne(I,$d,"m",MO).call(I,new Error(A),I)},this)}get WorkerScript(){return Ne(this,AE,"f")}get id(){return Ne(this,RE,"f")}get Module(){return Ne(this,kE,"f")}get Instances(){return Ne(this,Ev,"f")}get WorkerName(){return Ne(this,PE,"f")}execTask(n,o,h){h||((h={}).promise=new Promise(function(_,b){h.resolve=_,h.reject=b}));let v=Ot(this,Ax,+Ne(this,Ax,"f")+1,"f");Ne(this,qd,"f")[v]={id:v,insId:o.insId,resolver:h,cost:o.cost},delete o.cost;let y={id:v,func:n,params:o};return On.logD("["+o.insId+"] "+n+" send"),Ne(this,Iv,"f")?h.reject(new Error("Worker is #terminated")):Ne(this,Gh,"f")?h.reject(new Error("Worker is #terminating")):Ne(this,Ba,"f").wasmReady||Ne(this,Ba,"f").ready&&"loadWasm"===n?Ne(this,Ba,"f").send(y):Ne(this,p_,"f").push(y),h.promise}get memSize(){return Ne(this,Wg,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(Ne(this,qd,"f")).length}get alive(){return!Ne(this,Gh,"f")&&!Ne(this,Iv,"f")}terminate(n,o){if(On.logD("["+this.id+"] worker terminate "+n),n&&Ne(this,$d,"m",FO).call(this,"Worker has been #terminated"),"function"==typeof o&&Ot(this,Bg,o,"f"),this.busy)Ot(this,Gh,!0,"f");else{if(Ne(this,Ba,"f")){if("function"!=typeof Ne(this,Ba,"f").terminate)throw new Error("Failed to terminate worker");On.logD("["+this.id+"] will be terminated"),Ne(this,Ba,"f").terminate(),Ot(this,Ba,null,"f")}Ot(this,Gh,!1,"f"),Ot(this,Iv,!0,"f"),Ne(this,Bg,"f")&&Ne(this,Bg,"f").call(this,this)}}hasInstance(n){if(n){const o=Ne(this,Ev,"f")[n];if(o)return 0!=Object.keys(o).length}else{const o=Object.keys(Ne(this,Ev,"f"));for(const h of o)if(0!=Object.keys(Ne(this,Ev,"f")[h]).length)return!0}return!1}exceedMaxMemory(){const n=1024*_n.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return!!(Ne(this,Wg,"f")&&Ne(this,Wg,"f")>n&&0!=n)&&(On.logD("[w-"+this.id+"] current memSize="+Ne(this,Wg,"f")+", max="+n),!0)}shouldBeFreed(){return!(!this.exceedMaxMemory()||this.hasInstance(void 0)||(On.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}DE=new WeakMap,Ba=new WeakMap,p_=new WeakMap,Gh=new WeakMap,Iv=new WeakMap,lJ=new WeakMap,cJ=new WeakMap,Bg=new WeakMap,AE=new WeakMap,Wg=new WeakMap,qd=new WeakMap,Ax=new WeakMap,PE=new WeakMap,RE=new WeakMap,kE=new WeakMap,Ev=new WeakMap,$d=new WeakSet,uJ=function(p){let n=new Error(""),o=Object.keys(p);for(let h=0;h<o.length;h++)n[o[h]]=p[o[h]];return n},dJ=function(p){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let n=new Worker(p,{name:this.WorkerName});return n.on=function(o,h,v){this.addEventListener(o,function(y){"exit"===o?h(y.data,"",v):h(y.data,v)})},n.send=function(o){if(null!=o&&null!=o.params&&null!=o.params.input){let h=Object.prototype.toString.call(o.params.input);if("[object Array]"===Object.prototype.toString.call(o.params.input)){if(h=Object.prototype.toString.call(o.params.input[0]),"[object ArrayBuffer]"===h||"[object Uint8ClampedArray]"===h||"[object Uint8Array]"===h)return void this.postMessage(o,[null!=o.params.input[0].buffer?o.params.input[0].buffer:o.params.input[0]])}else if("[object ArrayBuffer]"===h||"[object Uint8ClampedArray]"===h||"[object Uint8Array]"===h)return void this.postMessage(o,[null!=o.params.input.buffer?o.params.input.buffer:o.params.input])}this.postMessage(o)},n},MO=function(p,n){Ot(n,Iv,!0,"f"),On.logD("[js]["+n.id+"] worker error "+JSON.stringify(p)),Ne(n,Gh,"f")&&Ne(n,Bg,"f")&&Ne(n,Bg,"f").call(n,n),Ot(n,Gh,!1,"f"),Ne(n,$d,"m",FO).call(n)},hJ=function(p,n){let o=p.id,h=Ne(n,qd,"f")[o];if(p&&p.cost&&h&&h.cost){const v=h.cost;v.exec=p.cost;const y=Date.now();v.total=y-v.ctime,v.msgQueue=p.ctime-v.time;const _=y-p.time;delete v.time,delete v.ctime,p.cost=v,p.cost.receive=_,delete p.ctime,delete p.time}if(On.logD(p.log?p.log:p),"string"==typeof p&&"ready"===p)Ne(n,Ba,"f").ready=!0,setTimeout(()=>{Ne(n,$d,"m",OO).call(n)},0);else if(!p.log){if("object"==typeof p){let v=p.result;"object"==typeof v?(null!=v.errorCode&&(v.code=v.errorCode,delete v.errorCode),null!=v.errorMessage&&(v.message=v.errorMessage,delete v.errorMessage)):"string"==typeof v&&(v=v.replace('"errorCode"','"code"'),v=v.replace("'errorCode'","'code'"),v=v.replace('"errorMessage"','"message"'),v=v.replace("'errorMessage'","'message'"),p.result=v),null!=p.memSize&&Ot(n,Wg,p.memSize,"f")}if(void 0!==h){const v=h.insId;delete Ne(n,qd,"f")[o],On.logD("["+v+"] "+p.func+" received"),!0===Ne(n,Gh,"f")&&n.terminate(),"loadWasm"===p.func&&null!=p.result&&(Ne(n,Ba,"f").wasmReady=!0,setTimeout(()=>{Ne(n,$d,"m",OO).call(n)},0)),p.error?h.resolver.reject(Ne(n,$d,"m",uJ).call(n,p.error)):p.result&&h.resolver.resolve(p.result)}}},OO=function(){this.alive&&(Ne(this,p_,"f").forEach(Ne(this,Ba,"f").send.bind(Ne(this,Ba,"f"))),Ot(this,p_,[],"f"))},FO=function(p){for(let n in Ne(this,qd,"f"))void 0!==Ne(this,qd,"f")[n]&&Ne(this,qd,"f")[n].resolver.reject(new Error(p));Ot(this,qd,Object.create(null),"f")};class Cr{constructor(){ps.add(this),Ds.set(this,[]),g_.set(this,4),fJ.set(this,60),Rx.set(this,!1),ME.set(this,0),m_.set(this,!1)}static get Instance(){return Ne(this,hl,"f",Px)||Ot(this,hl,new Cr,"f",Px),Ne(this,hl,"f",Px)}get Terminated(){return Ne(this,Rx,"f")}getModuleLoadedError(n){for(let o of Ne(Cr,hl,"f",Yu))if(o.name==n)return o.error}getModuleStatus(n){for(let o of Ne(Cr,hl,"f",Yu))if(o.name==n)return o.status;return""}addModules(n,o){let h=!1;if(Ne(Cr,hl,"f",Yu).forEach(function(v,y,_){v.name==n.name&&(v.ver==n.ver?h=!0:_.splice(y,1))}),!h){let v=n;v.status=o||"",v.wasmModule=null,Ne(Cr,hl,"f",Yu).push(v)}}loadModule(n,o){return gn(this,void 0,void 0,function*(){null==o&&(o=0!=Ne(this,ps,"m",BO).call(this,n).length),this.addModules(n);for(let _ of n.dependencyModules)_===Tr.imgIO?(this.addModules(_n.ImageIOModule,wo.pending),_n.LicMode===pp.DLS_KEY&&n.name!=Tr.crypto&&this.addModules(_n.CryptoModule,wo.pending)):_===Tr.core&&this.addModules(_n.ImagecoreModule,wo.pending);let h,v;for(let _ of Ne(Cr,hl,"f",Yu))if(_.name===n.name){if(_.status===wo.pending)return!1;if(_.wasmModule){if(o)return!0;h=_.wasmModule,v=_.wasmBinary;break}break}let y=null;if(h)y=n,y.wasmModule=h,y.wasmBinary=v,y.status=wo.pending;else if(y=n,""===y.status)y.status=wo.pending,y.wasmModule=null;else{if(y.status===wo.pending)return!1;o||(y.error={code:0,message:""},y.status=wo.pending)}return Ne(this,ps,"m",LO).call(this,y)})}get busy(){Ne(this,ps,"m",kx).call(this);let n=Ne(this,Ds,"f");for(let o of n)if(o.busy)return!0;return!1}getWorker(n,o){return gn(this,void 0,void 0,function*(){if(Ne(this,ps,"m",_J).call(this,n.name))return Ne(this,ps,"m",bJ).call(this),{worker:null,workers:0};let h=Ne(this,ps,"m",BO).call(this,n,!0);return 0!=h.length?{worker:Ne(this,ps,"m",xJ).call(this,h,o,n),workers:h.length}:(yield this.loadModule(n,!1),{worker:null,workers:0})})}removeInstanceInWorker(n,o,h,v){if(Ne(this,ps,"m",wJ).call(this,o,n.name,h),v&&o&&o.shouldBeFreed()){let y=Ne(this,Ds,"f").indexOf(o);-1!==y&&Ne(this,Ds,"f").splice(y,1)}}terminate(n){Ot(Cr,hl,null,"f",Px),On.logD("worker pool terminate "+n),Ot(this,Rx,!0,"f");let o=[],h=Ne(this,Ds,"f").slice();return Ot(this,Ds,[],"f"),h.forEach(function(v){let y={};y.promise=new Promise(function(_,b){y.resolve=_,y.reject=b}),o.push(y.promise),v.terminate(n,function(_){y.resolve(_)})}),Promise.all(o)}static unload(){Ot(this,hl,new Array,"f",Yu)}terminateWorker(n){Ne(this,Ds,"f").splice(0,Ne(this,Ds,"f").length,...Ne(this,Ds,"f").filter(o=>o.WorkerName!==n||(o.terminate(!0),!1)))}getMemoryUsed(){let n=Ne(this,Ds,"f"),o=[],h=0;for(let v of n)v&&null!=v.memSize&&(o[h]={},o[h].size=v.memSize,o[h].limit=1024*_n.getWorkerHeap(v.WorkerName).maxHeapSize*1024,o[h].name=v.WorkerName,o[h].id=v.id,h+=1);return o}}hl=Cr,Ds=new WeakMap,g_=new WeakMap,fJ=new WeakMap,Rx=new WeakMap,ME=new WeakMap,m_=new WeakMap,ps=new WeakSet,LO=function(p){return gn(this,void 0,void 0,function*(){let n=this,o=yield Ne(this,ps,"m",vJ).call(this,p);if(o){let h={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:p.fetchOptions}};if(h.params.resourceDir=p.resourceDir,h.params.initMemory=_n.getWorkerHeap(p.workerName).initHeapSize,h.params.module){for(let v of Ne(Cr,hl,"f",Yu))for(let y of p.dependencyModules)y==v.name&&h.params.module.modulesInfo.push(v);h.params.module.modulesInfo.push(p)}yield Ne(this,ps,"m",pJ).call(this,o,h),Ot(n,g_,Ne(n,ps,"m",mJ).call(n),"f"),p.status===wo.pending&&(p.status="")}else p.status="",p.wasmModule=null})},NO=function(p,n,o,h){for(let v of Ne(Cr,hl,"f",Yu))if(v.name===p){v.status=n,v.wasmModule=o.wasmModule,v.wasmBinary=o.wasmBinary,v.error=h;break}},pJ=function(p,n,o){return gn(this,void 0,void 0,function*(){let h=this;try{const v=yield p.execTask(n.func,n.params);let y=!1;return void 0===v.code||v.modules?y=Ne(h,ps,"m",gJ).call(h,v,p):On.logD(v),y}catch(v){return On.logD(v),!1}finally{o&&o()}})},gJ=function(p,n){if(On.logD("handleWasmLoad:"),On.logD(p),Ne(this,Rx,"f"))return n.terminate(),!1;if(("object"!=typeof p||null==p.modules)&&"object"==typeof p)return!1;let o=!1;for(const h of p.modules)p.code?(Ne(this,ps,"m",NO).call(this,h.name,wo.failed,null,{code:p.code,message:p.message}),n.Module.modulesInfo[h.name]=!1):(Ne(this,ps,"m",NO).call(this,h.name,wo.ready,h.wasmResource,void 0),n.Module.modulesInfo[h.name]=!0,o=!0);return o},mJ=function(){let p=2;return"hardwareConcurrency"in self.navigator&&(p=self.navigator.hardwareConcurrency),Math.max(Math.min(Ne(this,g_,"f"),Math.max(Ne(this,g_,"f"),p/2)),1)},vJ=function(p){return gn(this,void 0,void 0,function*(){Ne(this,ps,"m",kx).call(this);let n=Ne(this,Ds,"f");for(let o of n)if(o.WorkerName===p.workerName)return o.busy?null:o;return Ne(this,ps,"m",yJ).call(this,p)})},yJ=function(p){var n;return gn(this,void 0,void 0,function*(){let o=this,h=Ne(o,Ds,"f");if(h.length<Ne(o,g_,"f")&&!Ne(o,m_,"f")){Ot(o,m_,!0,"f");let v=p.script;p.crossScript&&(v=yield class TEe{static fetchRetry(n,o,h,v){let y=o.retries,_=o.retryDelay;return new Promise(function(b,w){const I=function(A){return fetch(n,o).then(function(M){b(M)}).catch(function(M){var F;A<y?(F=A,h&&h(M,v),setTimeout(function(){I(++F)},_)):w(M)})};return I(0)})}}.fetchRetry(p.script,p.fetchOptions,On.func,o).then(_=>_.blob()).then(_=>URL.createObjectURL(_)).catch(_=>(On.logD("get new worker fetch failed: "),On.logD(_),Ot(o,m_,!1,"f"),null)));let y=new IEe(v,Ot(n=o,ME,+Ne(n,ME,"f")+1,"f"),p.workerName,p.script,On.func,On.context);return h.push(y),Ot(o,m_,!1,"f"),On.logAll(h),On.logD("[wl-"+Ne(o,Ds,"f").length+"] got new worker w-"+y.id+"("+y.WorkerName+") succeed!"),y}return null})},BO=function(p,n){Ne(this,ps,"m",kx).call(this);let o=Ne(this,Ds,"f");On.logAll(o);let h=[];for(let v of o)if(v.Module.modulesInfo[p.name]){let y=!0;if(p.dependencyModules.forEach(_=>{v.Module.modulesInfo[_]||(y=!1)}),!y||n&&v.WorkerName!==p.workerName)continue;h.push(v)}return On.logAll("[wl-"+o.length+"] got workers for module "+p.name),On.logAll(h),h},_J=function(p){for(let n of Ne(Cr,hl,"f",Yu))if(n.name===p&&n.status===wo.pending)return!0;return!1},CJ=function(){return gn(this,void 0,void 0,function*(){this.terminate(!0);for(let p of Ne(Cr,hl,"f",Yu))yield Ne(this,ps,"m",LO).call(this,p)})},bJ=function(){Ne(this,ps,"m",kx).call(this),0==Ne(this,Ds,"f").length&&0!=Ne(Cr,hl,"f",Yu).length&&(On.logD("no worker ready, reinit"),Ne(this,ps,"m",CJ).call(this))},kx=function(){Ne(this,Ds,"f").splice(0,Ne(this,Ds,"f").length,...Ne(this,Ds,"f").filter(function(p){return p.alive}))},xJ=function(p,n,o){On.logAll("[wl-"+Ne(this,Ds,"f").length+"] getWorkerByIntanceId"),On.logAll(p);let h,v=9007199254740991;for(let y of p){if(o.singleInstance&&y.hasInstance(o.name))continue;const _=y.Instances[o.name];if(!_||null!=_[n]){h=y;break}{let b=y.howManyTasks;b<v&&(h=y,v=b)}}if(h){if(h.shouldBeFreed())return null;const y=h.Instances[o.name];if(y)y[n]="";else{const _=Object.create(null);_[n]="",h.Instances[o.name]=_}return On.logAll(p),On.logD("[wl-"+p.length+"]["+n+"] got worker w-"+h.id),h}return On.logAll("#getWorkerByIntanceId: no suitable worker"),null},wJ=function(p,n,o){let h=Ne(this,Ds,"f");On.logAll("removeInstanceInWorkerInner"),On.logAll(h);for(let v of h)if(v===p){const y=v.Instances[n];if(y){null!=y[o]?(delete y[o],On.logAll(h),On.logD("[w-"+v.id+"] removeInstanceInWorkerInner "+o+" in "+p.id+" succeed!")):On.logD("[w-"+v.id+"] not found instance "+o);break}}},Px={value:null},Yu={value:new Array};class Ux{constructor(n,o){var h,v,y,_;Wa.add(this),Jc.set(this,void 0),this._outputType=Kc.IT_JPG,this._inputType=Kc.IT_ALL,this._jpegQuality=80,v_.set(this,null!==(h=_n.License)&&void 0!==h?h:""),Ua.set(this,[]),Or.set(this,null),OE.set(this,0),y_.set(this,Ot(_=Ux,WO,+Ne(_,WO,"f",UO)+1,"f",UO)),Mx.set(this,null),VO.set(this,JSON.parse(JSON.stringify(_n.NavInfo))),jO.set(this,_n.Mobile),HO.set(this,location.origin),FE.set(this,""),Qc.set(this,wo.init),gp.set(this,!1),Ox.set(this,null!==(v=_n.LicMode)&&void 0!==v?v:pp.LONG_KEY),Fx.set(this,null!==(y=_n.UUID)&&void 0!==y?y:""),Lx.set(this,0),LE.set(this,!1),NE.set(this,!1),this._handleBooleanResult=function(b,w){return!0},Ot(this,Jc,n,"f"),Ot(this,v_,null!=o?o:_n.License,"f")}_prepareModule(n){}get workerId(){return Ne(this,Or,"f")&&Ne(this,Or,"f").alive?Ne(this,Or,"f").id:0}get id(){return Ne(this,y_,"f")}hasTask(){return Ne(this,Ua,"f").length>0}_canTerminateWork(){return!1}_makeSureWorkerMemoryNotExceed(){return!(Ne(this,Or,"f")&&Ne(this,Or,"f").alive&&this._canTerminateWork()&&Ne(this,Or,"f").exceedMaxMemory()&&(On.logD(`[${this.id}] try to termiate worker [${Ne(this,Or,"f").id}]`),Ne(this,Or,"f").terminate(!0),Ot(this,Or,null,"f"),Ot(this,Qc,wo.init,"f"),1))}_workerChanged(n){}_handleBasicResult(n,o){return delete n.code,delete n.message,n}_handleImageData(n,o){var h,v,y;if("object"==typeof n.imageData)if(null!=n.imageCount&&n.imageCount>1)for(let _=0;_<n.imageCount;_++)n.imageData[_]=Ne(h=o.context,Wa,"m",BE).call(h,n.imageData[_],n.blobType,o.params.returnBlob);else n.imageData=Ne(v=o.context,Wa,"m",BE).call(v,n.imageData,n.blobType,o.params.returnBlob);return"object"==typeof n.pdfData&&(n.pdfData=Ne(y=o.context,Wa,"m",BE).call(y,n.pdfData,n.blobType,o.params.returnBlob)),n}_handleResult(n,o){var h,v;let y=Ne(v=o.context,Wa,"m",GO).call(v,n);if(void 0===y.code||!y.code&&"Successful."===y.message)y=o.handleResult(y,o),setTimeout(()=>{var _;Ne(_=o.context,Wa,"m",__).call(_)},0),(0,o.resolve)(y);else{let _={code:y.code,message:y.code===Gu.wasmException?DO.WASM_EXCEPTION_ERROR+"("+(null===(h=o.params)||void 0===h?void 0:h.moduleName)+":"+o.func+":"+y.message+")":y.message};o.context.terminated?o.resolve(_):o.reject(_)}}_execTask(n){let o=this,h=Ne(o,Or,"f");if(On.logAll(n),h)try{if(n.params.cost){const v=n.params.cost.time;n.params.cost.time=Date.now(),n.params.cost.taskQueue=n.params.cost.time-v}h.execTask(n.func,n.params).then(function(v){o._handleResult(Ne(o,Wa,"m",GO).call(o,v),n)}).catch(function(v){On.logD(v),setTimeout(()=>{Ne(o,Wa,"m",__).call(o)},0);let y=v;"object"==typeof v&&null!=v.message&&(y=v.message);let _={code:Gu.wasmJsWorkerRunFailed,message:y};Ne(o,gp,"f")?n.resolve(_):n.reject(_)})}catch(v){setTimeout(()=>{Ne(o,Wa,"m",__).call(o)},0),On.logD(v);let y={code:Gu.wasmJsWorkerRunException,message:v.message,stack:v.stack};Ne(o,gp,"f")?n.resolve(y):n.reject(y)}}_cancelAllTasks(n,o){for(let h of Ne(this,Ua,"f"))if(void 0!==h){let v={code:n,message:o};Ne(this,gp,"f")?h.resolve(v):h.reject(v)}Ot(this,Ua,[],"f")}_createTask(n,o,h){let v={moduleName:Ne(this,Jc,"f").name,insId:Ne(this,y_,"f")},y={id:Ot(this,OE,+Ne(this,OE,"f")+1,"f"),func:n,params:v};return y.promise=new Promise(function(_,b){y.resolve=_,y.reject=b}),y.func=n,y.context=this,y.handleResult=void 0!==h&&h?h:this._handleBasicResult,y.params.input=void 0!==o&&o?o:"",y.params.returnType=da.RT_AUTO,y.params.returnBlob=!0,y.params.logLevel=On.level,y.params.cost={},y.params.cost.ctime=Date.now(),y.params.cost.time=y.params.cost.ctime,y}_addTask(n,o){if(n.params.cost){const h=n.params.cost.time;n.params.cost.time=Date.now(),n.params.cost.create=n.params.cost.time-h}return Ne(this,Qc,"f")===wo.destroyed?n.reject({code:Gu.wasmJsObjectNotInit,message:Ne(this,gp,"f")?"object has been disposed":"object not init"}):Ne(this,Qc,"f")===wo.failed?n.reject({code:Gu.wasmJsObjectInitFailed,message:Ne(this,FE,"f")}):(o?Ne(this,Ua,"f").unshift(n):Ne(this,Ua,"f").push(n),Ne(this,Wa,"m",__).call(this)),n.promise}terminate(n){let o=this;Ne(o,LE,"f")?Ot(o,gp,!0,"f"):(Ot(this,NE,!0,"f"),Ne(o,Wa,"m",TJ).call(o).then(function(h){On.logD("["+o.id+"] "+Ne(o,Jc,"f").name+" destroy return: "),On.logD(h)}).catch(function(h){On.logD(Ne(o,Jc,"f").name+" destroy failed"),On.logD(h)}).finally(()=>{let h=Cr.Instance;h&&h.removeInstanceInWorker(Ne(o,Jc,"f"),Ne(o,Or,"f"),Ne(o,y_,"f"),null==n||n),Ot(o,Or,null,"f"),Ot(o,gp,!0,"f"),Ot(o,NE,!1,"f")})),Ot(o,Qc,"","f")}_readFile(n){return Gg.read(n).catch(function(o){let h=o;return"object"!=typeof h&&(h={},h.code=Gu.wasmJsReadFileFailed,h.message=o),Promise.reject(h)})}updateLicense(n,o,h){return gn(this,void 0,void 0,function*(){Ot(this,v_,n,"f"),Ot(this,Ox,null!=o?o:pp.LONG_KEY,"f"),Ot(this,Fx,null!=h?h:"","f");let v=this,y=v._createTask("UpdateLicense");return y.params.input=[Ne(v,v_,"f"),Ne(v,Ox,"f"),Ne(v,Fx,"f")],v._addTask(y),y.promise})}}WO=Ux,Jc=new WeakMap,v_=new WeakMap,Ua=new WeakMap,Or=new WeakMap,OE=new WeakMap,y_=new WeakMap,Mx=new WeakMap,VO=new WeakMap,jO=new WeakMap,HO=new WeakMap,FE=new WeakMap,Qc=new WeakMap,gp=new WeakMap,Ox=new WeakMap,Fx=new WeakMap,Lx=new WeakMap,LE=new WeakMap,NE=new WeakMap,Wa=new WeakSet,SJ=function p(n){let o=null!=n?n:this;if(Ne(o,Mx,"f")&&clearTimeout(Ne(o,Mx,"f")),Ne(o,gp,"f")&&On.logD(`[${o.id}"] has been termiated.(getWorker)`),Ne(o,Or,"f")&&Ne(o,Or,"f").alive)return Ne(o,Or,"f");let h=Cr.Instance;h?h.getWorker(Ne(o,Jc,"f"),Ne(o,y_,"f")).then(v=>{if(Ot(o,Or,v.worker,"f"),Ne(o,Or,"f")&&Ne(o,Or,"f").alive)Ne(o,Lx,"f")!=Ne(o,Or,"f").id&&(0!==Ne(o,Lx,"f")&&o._workerChanged(Ne(o,Or,"f").id),Ot(o,Lx,Ne(o,Or,"f").id,"f")),Ne(o,Ua,"f").length>0&&setTimeout(()=>{Ne(o,Wa,"m",__).call(o)},0);else{let y=h.getModuleLoadedError(Ne(o,Jc,"f").name);if(null==y?void 0:y.code)return o._cancelAllTasks(Gu.wasmJsNotLoaded,y.message),Ne(o,Or,"f");Ne(o,Ua,"f").length>0&&Ot(o,Mx,setTimeout(Ne(o,Wa,"m",p),50,o),"f")}return Ne(o,Or,"f")}).catch(v=>Ne(o,Or,"f")):o._cancelAllTasks(Gu.wasmJsNotLoaded,"wasm env not loaded or unloaded")},__=function(){if(On.logAll(Ne(this,Ua,"f")),Ne(this,Qc,"f")!=wo.init)if(Ne(this,Or,"f")&&Ne(this,Or,"f").alive){if(Ne(this,Ua,"f").length>0){let p=Ne(this,Ua,"f")[0];Ne(this,Qc,"f")!==wo.ready&&"init"!==p.func||(delete Ne(this,Ua,"f")[0],Ne(this,Ua,"f").splice(0,1),this._execTask(p))}}else{if(Ne(this,Or,"f")&&!Ne(this,Or,"f").alive&&Ne(this,Ua,"f").length>0&&"init"!=Ne(this,Ua,"f")[0].func)return Ot(this,Or,null,"f"),void Ne(this,Wa,"m",zO).call(this);Ne(this,Ua,"f").length>0&&Ne(this,Jc,"f").script&&Ne(this,Wa,"m",SJ).call(this,this)}else Ne(this,Wa,"m",zO).call(this)},BE=function(p,n,o){if(o){let h;return h=null!=n?new Blob([p],{type:n}):new Blob([p]),h}return p},GO=function(p){try{return"string"==typeof p?JSON.parse(p):p}catch(n){return p}},zO=function(){let p=this;p._prepareModule(Ne(this,Jc,"f"));let n=this._createTask("init");n.params.key=Ne(this,v_,"f"),n.params.uuid=Ne(this,Fx,"f"),n.params.licMode=Ne(this,Ox,"f"),n.params.val={nv:Ne(this,VO,"f"),mb:Ne(this,jO,"f"),dm:Ne(this,HO,"f")},n.handleResult=function(o,h){return Ot(h.context,Qc,wo.ready,"f"),o},Ot(this,Qc,wo.pending,"f"),this._addTask(n,!0),n.promise.then(function(o){On.logD("["+p.id+"] "+Ne(p,Jc,"f").name+" init return: "),On.logD(o),Ot(p,LE,!1,"f")}).catch(function(o){Ot(p,Qc,wo.failed,"f"),Ot(p,FE,o.message,"f"),On.logD(Ne(p,Jc,"f").name+" init failed"),On.logD(o),p._cancelAllTasks(Gu.wasmJsObjectInitFailed,o.message)})},TJ=function(){if(Ne(this,Qc,"f")==wo.pending||Ne(this,Qc,"f")==wo.ready){let p=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(p),p.promise}return Promise.resolve(!0)},UO={value:0};class zg extends Ux{constructor(n,o){super(n,o)}_prepareModule(n){let o=Cr.Instance;o.addModules(_n.ImageIOModule),_n.LicMode===pp.DLS_KEY&&o.addModules(_n.CryptoModule),Ne(zg,IJ,"m",EJ).call(zg,_n.ImageIOModule,n),o.addModules(n)}}IJ=zg,EJ=function(p,n){n.resourceDir=p.resourceDir,n.crossScript=p.crossScript,n.script=p.script,n.useSimd=p.useSimd,n.useSimd=n.name===Tr.imgProc&&_n.UseSimd,n.fetchOptions=p.fetchOptions};class VJ extends zg{constructor(n){super(_n.ImagecoreModule,n),WE.add(this),YO.set(this,0)}getImageFormat(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("GetImageFormat");const v=yield o._readFile(n);return h.params.input=v,o._addTask(h),h.promise})}readImageInfo(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("ReadImageInfo");const v=yield o._readFile(n);return h.params.input=v,o._addTask(h),h.promise})}getMD5(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("GetMD5");const v=yield o._readFile(n);return h.params.input=v,h.handleResult=function(y,_){return y.MD5},o._addTask(h),h.promise})}getLicenseInfo(){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetLicenseInfo"))})}getAesResult(n){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("GetAesResult",[n=null!=n?n:""]))})}saveImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){return(y=null!=y&&y)?Ne(this,WE,"m",XO).call(this,n,void 0,void 0,void 0,1,void 0,void 0,o,h,v):Ne(this,WE,"m",XO).call(this,n,void 0,void 0,void 0,void 0,void 0,void 0,o,h,v)})}readImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){o=null!=o?o:this._outputType,h=null!=h?h:this._jpegQuality,v=null!=v&&v,y=null!=y&&y;let _=this,b=_._createTask("ReadImage");const w=yield _._readFile(n);b.params.input=[w,o,h,y],b.params.returnType=v?da.RT_BASE64:da.RT_AUTO,b.params.returnBlob=!v,b.handleResult=_._handleImageData,_._addTask(b);const I=yield b.promise;if(I.srcBuffer){let A=Object.prototype.toString.call(n);"[object ArrayBuffer]"!=A&&"[object Uint8ClampedArray]"!=A&&delete I.srcBuffer}return I})}openTiff(n,o){return gn(this,void 0,void 0,function*(){let h=this,v=h._createTask("LoadTiff");o=null!=o&&o;const y=yield h._readFile(n);v.params.input=[y,o],h._addTask(v);const _=yield v.promise;if(_.srcBuffer){let b=Object.prototype.toString.call(n);"[object ArrayBuffer]"!=b&&"[object Uint8ClampedArray]"!=b&&delete _.srcBuffer}return _})}readTiff(n,o,h,v){n=null!=n?n:0,o=null!=o?o:this._outputType,h=null!=h&&h,v=null!=v&&v;let y=this._createTask("ReadTiffPage");return y.params.input=[n,o,v],y.params.returnType=h?da.RT_BASE64:da.RT_AUTO,y.params.returnBlob=!h,y.handleResult=this._handleImageData,this._addTask(y)}readTiffInfos(n){let o=this._createTask("GetTiffPageInfos");return o.params.input=[n],this._addTask(o)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){o=null!=o?o:this._inputType,h=null!=h?h:Ne(this,YO,"f"),v=null!=v?v:this._jpegQuality,y=null!=y&&y;let _=this,b=_._createTask("AppendImageToTiff");const w=yield _._readFile(n);return b.params.input=[w,o,h,v,y],b.handleResult=_._handleBooleanResult,_._addTask(b),b.promise})}addTag(n,o,h){return this._addTask(this._createTask("AddTagToNextPage",[n,o,h=null!=h&&h],this._handleBooleanResult))}getTiff(n){let o=this._createTask("GetTiffStream");return o.handleResult=this._handleImageData,o.params.returnType=null!=n?n:da.RT_AUTO,o.params.returnBlob=n!=da.RT_AUTO,this._addTask(o)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,function(n,o){return n.memoryUsed}))}getMultiPartFile(n,o){return this._addTask(this._createTask("ds_get_file",[n,o],function(h,v){return h}))}}YO=new WeakMap,WE=new WeakSet,XO=function(p,n,o,h,v,y,_,b,w,I){return gn(this,void 0,void 0,function*(){let A=this;n=null!=n?n:this._inputType,o=null!=o?o:0,h=null!=h?h:0,v=null!=v?v:24,y=null!=y?y:96,_=null!=_?_:96,b=null!=b?b:this._outputType,w=null!=w?w:this._jpegQuality,I=null!=I?I:da.RT_AUTO;let M=A._createTask("SaveImage");const F=yield A._readFile(p);return M.params.input=[F,n,o,h,v,y,_,b,w],M.params.returnType=I,M.params.returnBlob=I!=da.RT_BASE64,M.handleResult=A._handleImageData,A._addTask(M),M.promise})};class EEe extends zg{constructor(n){super(_n.ImageReadereModule,n),C_.add(this),DJ.set(this,0),Ug.set(this,!1),Vg.set(this,null),UE.set(this,void 0),$O.set(this,0),Dv.set(this,void 0),Nx.set(this,void 0)}workerChanged(n){Ot(this,Ug,!1,"f"),n&&(On.logD("["+this.id+"] worker changed to "+n),Ot(this,$O,n,"f"))}setExternalWorkerChanged(n,o){Ot(this,Dv,n,"f"),Ot(this,Nx,o,"f")}_workerChanged(n){this.workerChanged(n),Ne(this,Dv,"f")&&Ne(this,Dv,"f").call(this,Ne(this,Nx,"f"),this,n)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(Ot(this,Ug,!1,"f"),Ne(this,Dv,"f")&&Ne(this,Dv,"f").call(this,Ne(this,Nx,"f"),this))}getImageFormat(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("GetImageFormat");const v=yield o._readFile(n.fileSource);return h.params.input=v,o._addTask(h),h.promise})}readImageInfo(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("ReadImageInfo");const v=yield o._readFile(n.fileSource);return h.params.input=v,o._addTask(h),h.promise})}readImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){o=null!=o?o:this._outputType,h=null!=h?h:this._jpegQuality,v=null!=v&&v,y=null!=y&&y;let _=this,b=_._createTask("ReadImage");const w=yield _._readFile(n.fileSource);b.params.input=[w,o,h,y],b.params.returnType=v?da.RT_BASE64:da.RT_AUTO,b.params.returnBlob=!v,b.handleResult=_._handleImageData,_._addTask(b);const I=yield b.promise;if(I.srcBuffer){let A=Object.prototype.toString.call(n.fileSource);"[object ArrayBuffer]"!=A&&"[object Uint8ClampedArray]"!=A&&delete I.srcBuffer}return I})}openTiff(n,o){return gn(this,void 0,void 0,function*(){o=null!=o&&o;let h,v=this,y=v._createTask("LoadTiff");if(n!=Ne(this,Vg,"f")){const b=yield v._readFile(n);n instanceof Blob?Ot(v,Vg,n,"f"):Ot(v,Vg,new Blob([b]),"f")}h||(h=yield v._readFile(Ne(v,Vg,"f"))),y.params.input=[h,o],v._addTask(y);const _=yield y.promise;if(Ot(v,Ug,!0,"f"),_.srcBuffer){let b=Object.prototype.toString.call(n);"[object ArrayBuffer]"!=b&&"[object Uint8ClampedArray]"!=b&&delete _.srcBuffer}return Ot(v,UE,{pageCount:_.pageCount},"f"),_})}readTiffPage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){yield Ne(this,C_,"m",VE).call(this,n.fileSource),o=null!=o?o:0,h=null!=h?h:this._outputType,v=null!=v&&v,y=null!=y&&y;let _=this._createTask("ReadTiffPage");return _.params.input=[o,h,y],_.params.returnType=v?da.RT_BASE64:da.RT_AUTO,_.params.returnBlob=!v,_.handleResult=this._handleImageData,this._addTask(_)})}getTiffInfo(n,o){return gn(this,void 0,void 0,function*(){return yield Ne(this,C_,"m",VE).call(this,n.fileSource),Ne(this,UE,"f")})}getTiffPageInfos(n,o){return gn(this,void 0,void 0,function*(){yield Ne(this,C_,"m",VE).call(this,n.fileSource);let h=this._createTask("GetTiffPageInfos");return h.params.input=[o],this._addTask(h)})}}DJ=new WeakMap,Ug=new WeakMap,Vg=new WeakMap,UE=new WeakMap,$O=new WeakMap,Dv=new WeakMap,Nx=new WeakMap,C_=new WeakSet,VE=function(p){return gn(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),Ne(this,Ug,"f")){if(Ne(this,Vg,"f")===p)return void On.logD("["+this.id+"] already opened in "+this.workerId);yield Ne(this,C_,"m",AJ).call(this)}On.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(p,!1)})},AJ=function(){if(Ot(this,Vg,null,"f"),Ne(this,Ug,"f"))return Ot(this,Ug,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))},function(p){p[p.render=1]="render",p[p.extractImageOnly=2]="extractImageOnly",p[p.auto=3]="auto",p[p.renderWithAnnot=4]="renderWithAnnot"}(NJ||(NJ={}));class Yg extends Ux{constructor(n){super(_n.PdfReaderModule,n),Xu.add(this),Pv.set(this,void 0),Bx.set(this,void 0),Wx.set(this,0),RJ.set(this,200),kJ.set(this,3),jg.set(this,!1),jE.set(this,void 0),mp.set(this,null),Rv.set(this,""),this._outputType=Kc.IT_ALL}static get fonts(){return Ne(this,Av,"f",b_)}static addPdfFont(n,o){return gn(this,void 0,void 0,function*(){return Ne(this,Av,"m",PJ).call(this,n,o)})}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){Ot(this,Av,Object.create(null),"f",b_)}workerChanged(n){Ot(this,jg,!1,"f"),n&&(On.logD("["+this.id+"] worker changed to "+n),Ot(this,Wx,n,"f"))}setExternalWorkerChanged(n,o){Ot(this,Pv,n,"f"),Ot(this,Bx,o,"f")}_workerChanged(n){this.workerChanged(n),Ne(this,Pv,"f")&&Ne(this,Pv,"f").call(this,Ne(this,Bx,"f"),this,n)}_canTerminateWork(){return!0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(Ot(this,jg,!1,"f"),Ne(this,Pv,"f")&&Ne(this,Pv,"f").call(this,Ne(this,Bx,"f"),this))}getPdfInfo(n){return gn(this,void 0,void 0,function*(){return yield Ne(this,Xu,"m",kv).call(this,n),Ne(this,jE,"f")})}readPage(n,o,h,v,y,_,b,w){return gn(this,void 0,void 0,function*(){return this.readPageEx(n,o,{convertMode:v,renderOptions:{resolution:h}},y,_,b,w)})}readPageEx(n,o,h,v,y,_,b){return gn(this,void 0,void 0,function*(){yield Ne(this,Xu,"m",kv).call(this,n),o=null!=o?o:0,v=null!=v?v:this._outputType,_=null!=_&&_,y=null!=y&&y,b=null!=b&&b;let w=h?JSON.stringify(h):"{}",I=this._createTask("ReadPdfPageEx");return I.params.input=[o,w,v,y,b],I.params.returnType=_?da.RT_BASE64:da.RT_AUTO,I.params.returnBlob=!_,I.handleResult=this._handleImageData,this._addTask(I)})}readPageImageInfos(n,o,h,v){return gn(this,void 0,void 0,function*(){yield Ne(this,Xu,"m",kv).call(this,n),v=null!=v?v:this._outputType;let y=h?JSON.stringify(h):"{}",_=this._createTask("ReadPageImageInfos");return _.params.input=[o,y,v],this._addTask(_)})}readPageAnnot(n,o){return gn(this,void 0,void 0,function*(){yield Ne(this,Xu,"m",kv).call(this,n);let h=this._createTask("GetPageAnnot",[o=null!=o?o:0]);return this._addTask(h)})}findText(n,o,h,v){return gn(this,void 0,void 0,function*(){return yield Ne(this,Xu,"m",kv).call(this,n),this._addTask(this._createTask("SearchText",[o,h,v=null!=v?v:0]))})}getPageInfos(n,o){return gn(this,void 0,void 0,function*(){return yield Ne(this,Xu,"m",kv).call(this,n),this._addTask(this._createTask("GetPdfPageInfos",[o]))})}}Av=Yg,Pv=new WeakMap,Bx=new WeakMap,Wx=new WeakMap,RJ=new WeakMap,kJ=new WeakMap,jg=new WeakMap,jE=new WeakMap,mp=new WeakMap,Rv=new WeakMap,Xu=new WeakSet,PJ=function(p,n){return gn(this,void 0,void 0,function*(){if("string"==typeof p&&0!==p.length||Promise.reject("The 'name' should be a valid string"),void 0===Ne(this,Av,"f",b_)[p])if(n instanceof Blob)Ne(this,Av,"f",b_)[p]=n;else{const o=yield Gg.read(n);Ne(this,Av,"f",b_)[p]=new Blob([o])}})},kv=function(p){var n,o;return gn(this,void 0,void 0,function*(){if(this.makeSureWorkerMemoryNotExceed(),Ne(this,jg,"f")){if(Ne(this,mp,"f")===p.fileSource)return void On.logD("["+this.id+"] already opened in "+this.workerId);yield Ne(this,Xu,"m",LJ).call(this)}On.logD("["+this.id+"] reopen in worker "+this.workerId),yield Ne(this,Xu,"m",FJ).call(this,null!==(n=p.fileSource)&&void 0!==n?n:Ne(this,mp,"f"),null!==(o=p.password)&&void 0!==o?o:Ne(this,Rv,"f"))})},MJ=function(){return gn(this,void 0,void 0,function*(){if(0===Ne(this,Wx,"f")||Ne(this,Wx,"f")!==this.workerId){On.logD("["+this.id+"] load font in worker "+this.workerId);const p=Yg.fonts,n=Object.keys(p);for(let o of n){const h=p[o],v=yield Gg.read(h);v&&(yield Ne(this,Xu,"m",OJ).call(this,o,v))}}})},OJ=function(p,n){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("AddSystemFont",[p,n]))})},FJ=function(p,n){return gn(this,void 0,void 0,function*(){yield Ne(this,Xu,"m",MJ).call(this),n=null!=n?n:"";let o,h=this,v=h._createTask("LoadPdf");if(p!==Ne(h,mp,"f")||n!==Ne(h,Rv,"f")){const y=yield h._readFile(p);p instanceof Blob?Ot(h,mp,p,"f"):Ot(h,mp,new Blob([y]),"f"),o=y,Ot(h,Rv,n,"f")}else n=Ne(h,Rv,"f");return o||(o=yield h._readFile(Ne(h,mp,"f"))),v.params.input=[o,n],v.handleResult=function(y,_){if(y.srcBuffer){let w=Object.prototype.toString.call(p);"[object ArrayBuffer]"!=w&&"[object Uint8ClampedArray]"!=w&&delete y.srcBuffer}let b=class DEe{static decode(n){const o={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function h(v){let y,_,b,w,I,A,M,F=[],V=v.length;for(y=0;y<V;y++)w=v.charCodeAt(y),w>>7&255?6==(w>>5&255)?(I=v.charCodeAt(++y),_=(31&w)<<6,b=63&I,M=_|b,F.push(String.fromCharCode(M))):14==(w>>4&255)&&(I=v.charCodeAt(++y),A=v.charCodeAt(++y),_=w<<4|I>>2&15,b=(3&I)<<6|63&A,M=(255&_)<<8|b,F.push(String.fromCharCode(M))):F.push(v.charAt(y));return F.join("")}return function(v){let y,_,b,w,I=[],A=0,M=v.length;for(;A<M;){do{y=o.decodeChars[255&v.charCodeAt(A++)]}while(A<M&&-1==y);if(-1==y)break;do{_=o.decodeChars[255&v.charCodeAt(A++)]}while(A<M&&-1==_);if(-1==_)break;I.push(String.fromCharCode(y<<2|(48&_)>>4));do{if(b=255&v.charCodeAt(A++),61==b)return h(I.join(""));b=o.decodeChars[b]}while(A<M&&-1==b);if(-1==b)break;I.push(String.fromCharCode((15&_)<<4|(60&b)>>2));do{if(w=255&v.charCodeAt(A++),61==w)return h(I.join(""));w=o.decodeChars[w]}while(A<M&&-1==w);if(-1==w)break;I.push(String.fromCharCode((3&b)<<6|w))}return h(I.join(""))}(n)}}.decode(y.infoBase64);try{let w;try{b.replace(new RegExp("\\\\","gi"),"\\\\"),w=JSON.parse(b)}catch(A){w=b}let I={PdfCount:y.pageCount,PdfInfo:w,isTextBased:y.isTextBased};return y.srcBuffer&&(I.srcBuffer=y.srcBuffer,delete y.srcBuffer),Ot(h,jg,!0,"f"),Ot(h,jE,I,"f"),I}catch(w){_.reject({code:Gu.wasmJsInvalidJson,message:w.message,stack:w.stack})}},h._addTask(v)})},LJ=function(){return gn(this,void 0,void 0,function*(){if(Ot(this,mp,null,"f"),Ot(this,Rv,"","f"),Ne(this,jg,"f"))return Ot(this,jg,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))})},b_={value:Object.create(null)};const KO=["readPdfPage","readTiffPage","readImage"];class jJ{constructor(n){this.items=[],n&&(this.items=n)}push(n){this.items.push(n)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(n){let o;-1!==KO.indexOf(n.api)&&this.push(n);for(let h of this.items)h.api===n.api&&h.params[0]===n.params[0]&&h.params[1]===n.params[1]&&(o=h);o?(o.resolves=[...o.resolves,...n.resolves],o.rejects=[...o.rejects,...n.rejects]):this.push(n)}remove(n){-1!==KO.indexOf(n.api)&&this.items.forEach((o,h)=>{o.api===n.api&&o.params[0]===n.params[0]&&o.params[1]===n.params[1]&&this.items.splice(h,1).forEach(v=>{null==v||v.resolves.forEach(y=>{y(null)})})})}}class oo{static unload(){if(Ot(this,cn,[],"f",x_),Ot(this,cn,new jJ,"f",Hg),Ot(this,cn,!1,"f",w_),Yg.removeFont(),Ne(this,cn,"f",mo)){On.logD("pdfReader destroy");const n=Ne(this,cn,"f",mo);Ot(this,cn,null,"f",mo),n.terminate()}if(Ne(this,cn,"f",vo)){On.logD("imageReader destroy");const n=Ne(this,cn,"f",vo);Ot(this,cn,null,"f",vo),n.terminate()}}static updateLicense(n,o,h){return gn(this,void 0,void 0,function*(){let v=[];return Ne(this,cn,"f",mo)&&v.push(Ne(this,cn,"f",mo).updateLicense(n,o,h)),Ne(this,cn,"f",vo)&&v.push(Ne(this,cn,"f",vo).updateLicense(n,o,h)),Promise.all(v)})}static add(n){return gn(this,void 0,void 0,function*(){Ne(this,cn,"f",x_).push(n),Ne(this,cn,"f",mo)||(Ot(this,cn,new Yg,"f",mo),Ne(this,cn,"f",mo).setExternalWorkerChanged(Ne(oo,cn,"m",qO),this),this.initPdfReaderFunctionMap()),Ne(this,cn,"f",vo)||(Ot(this,cn,new EEe,"f",vo),Ne(this,cn,"f",vo).setExternalWorkerChanged(Ne(oo,cn,"m",qO),this),this.initImageReaderFunctionMap())})}static addFont(n,o){return gn(this,void 0,void 0,function*(){Yg.addPdfFont(n,o)})}static getFonts(){return Yg.getPdfFonts()}static delete(n){const o=Ne(this,cn,"f",x_).indexOf(n);if(o>=0&&(Ne(this,cn,"f",x_).splice(o,1),0===Ne(this,cn,"f",x_).length&&!Ne(this,cn,"f",w_))){if(Ne(this,cn,"f",mo)){On.logD("pdfReader destroy");const h=Ne(this,cn,"f",mo);Ot(this,cn,null,"f",mo),h.terminate()}if(Ne(this,cn,"f",vo)){On.logD("imageReader destroy");const h=Ne(this,cn,"f",vo);Ot(this,cn,null,"f",vo),h.terminate()}}}static createTask(n,o){const h={api:n,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const y of o)h.params.push(y);const v=new Promise(function(y,_){h.resolves.push(y),h.rejects.push(_)});return h.promise.push(v),Ne(this,cn,"m",BJ).call(this,h),v}static cancelTask(n,o){if(-1!==KO.indexOf(n)){const h={api:n,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const v of o)h.params.push(v);Ne(this,cn,"f",Hg).remove(h)}}static initPdfReaderFunctionMap(){var n,o,h,v,y,_;Ne(this,cn,"f",vp).findPdfText=null===(n=Ne(this,cn,"f",mo))||void 0===n?void 0:n.findText,Ne(this,cn,"f",vp).getPdfPageInfos=null===(o=Ne(this,cn,"f",mo))||void 0===o?void 0:o.getPageInfos,Ne(this,cn,"f",vp).getPdfInfo=null===(h=Ne(this,cn,"f",mo))||void 0===h?void 0:h.getPdfInfo,Ne(this,cn,"f",vp).readPdfPageAnnot=null===(v=Ne(this,cn,"f",mo))||void 0===v?void 0:v.readPageAnnot,Ne(this,cn,"f",vp).readPdfPage=null===(y=Ne(this,cn,"f",mo))||void 0===y?void 0:y.readPageEx,Ne(this,cn,"f",vp).readPdfPageImageInfos=null===(_=Ne(this,cn,"f",mo))||void 0===_?void 0:_.readPageImageInfos}static initImageReaderFunctionMap(){var n,o,h,v,y,_;Ne(this,cn,"f",yp).readImage=null===(n=Ne(this,cn,"f",vo))||void 0===n?void 0:n.readImage,Ne(this,cn,"f",yp).getImageFormat=null===(o=Ne(this,cn,"f",vo))||void 0===o?void 0:o.getImageFormat,Ne(this,cn,"f",yp).readImageInfo=null===(h=Ne(this,cn,"f",vo))||void 0===h?void 0:h.readImageInfo,Ne(this,cn,"f",yp).getTiffInfo=null===(v=Ne(this,cn,"f",vo))||void 0===v?void 0:v.getTiffInfo,Ne(this,cn,"f",yp).readTiffPage=null===(y=Ne(this,cn,"f",vo))||void 0===y?void 0:y.readTiffPage,Ne(this,cn,"f",yp).getTiffPageInfos=null===(_=Ne(this,cn,"f",vo))||void 0===_?void 0:_.getTiffPageInfos}}cn=oo,qO=function(p,n,o){let h=null!=p?p:this;Ne(h,cn,"f",mo)&&Ne(h,cn,"f",mo)!==n&&Ne(h,cn,"f",mo).workerChanged(o),Ne(h,cn,"f",vo)&&Ne(h,cn,"f",vo)!==n&&Ne(h,cn,"f",vo).workerChanged(o)},BJ=function(p){Ne(this,cn,"f",Hg).add(p),Ne(this,cn,"f",w_)||(Ot(this,cn,!0,"f",w_),Ne(this,cn,"m",UJ).call(this))},WJ=function(){try{Ne(this,cn,"f",vo)&&Ne(this,cn,"f",vo).makeSureWorkerMemoryNotExceed(),Ne(this,cn,"f",mo)&&Ne(this,cn,"f",mo).makeSureWorkerMemoryNotExceed()}catch(p){}},UJ=function(){return gn(this,void 0,void 0,function*(){do{if(Ne(this,cn,"f",Hg).isEmpty()||!Ne(this,cn,"f",mo)||!Ne(this,cn,"f",vo))break;const p=Ne(this,cn,"f",Hg).pop();if(p)try{let n,o=Ne(this,cn,"f",vp)[p.api];o?(n=yield Ne(this,cn,"f",vp)[p.api].apply(Ne(this,cn,"f",mo),p.params),Ne(this,cn,"f",mo).makeSureWorkerMemoryNotExceed()):(o=Ne(this,cn,"f",yp)[p.api],o&&(n=yield Ne(this,cn,"f",yp)[p.api].apply(Ne(this,cn,"f",vo),p.params),Ne(this,cn,"f",vo).makeSureWorkerMemoryNotExceed())),null==p||p.resolves.forEach(h=>{h(n)})}catch(n){On.logD(n),p.retry<1?(p.retry+=1,Ne(this,cn,"m",WJ).call(this),Ne(this,cn,"f",Hg).push(p)):null==p||p.rejects.forEach(o=>{o(n)})}}while(!Ne(this,cn,"f",Hg).isEmpty());Ot(this,cn,!1,"f",w_)})},x_={value:[]},Hg={value:new jJ},mo={value:void 0},vo={value:void 0},w_={value:!1},vp={value:Object.create(null)},yp={value:Object.create(null)};class AEe{constructor(){oo.add(this)}destroy(){oo.delete(this)}readImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){return oo.createTask("readImage",[n,o,h,v,y])})}getImageFormat(n){return gn(this,void 0,void 0,function*(){return oo.createTask("getImageFormat",[n])})}readImageInfo(n){return gn(this,void 0,void 0,function*(){return oo.createTask("readImageInfo",[n])})}cancelReadImage(n,o){return oo.cancelTask("readImage",[n,o])}getTiffInfo(n){return gn(this,void 0,void 0,function*(){return oo.createTask("getTiffInfo",[n,!1])})}readTiffPage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){return oo.createTask("readTiffPage",[n,o,h,v,y])})}cancelReadTiffPage(n,o){return oo.cancelTask("readTiffPage",[n,o])}getTiffPageInfos(n,o){return gn(this,void 0,void 0,function*(){return oo.createTask("getTiffPageInfos",[n,o])})}}var Ul,dc,S_,_p,Vx,HJ,JO,GJ,zJ,YJ,XJ,$J,qJ,KJ,JJ,QJ,ZJ,eQ,tQ,nQ;!function(p){p[p.NearestNeighbour=1]="NearestNeighbour",p[p.Bilinear=2]="Bilinear",p[p.Bicublic=3]="Bicublic",p[p.BestQuality=5]="BestQuality"}(S_||(S_={}));class PEe extends zg{constructor(n){super(_n.ImageProcModule,n),Ul.add(this)}initImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){o=null!=o&&o,h=null!=h?h:0,v=null!=v?v:0,y=null!=y&&y;let _=this,b=_._createTask("InitImageObject");if(b.params.input=[n,h,v],o||y)b.params.input.push(o?Kc.IT_RGBA:Kc.IT_BGRA),_._addTask(b);else{const I=yield _._readFile(n);b.params.input[0]=I,b.params.input.push(Kc.IT_ALL),_._addTask(b)}const w=yield b.promise;if(w.srcBuffer){let I=Object.prototype.toString.call(n);"[object ArrayBuffer]"!=I&&"[object Uint8ClampedArray]"!=I&&delete w.srcBuffer}return w})}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(n,o,h){var v,y,_,b,w,I,A,M,F,V;let B=this;o=null!=o?o:{},h=null!=h?h:{};let Q=B._createTask("Filter");if(Q.params.input=[],Q.params.input.push(n),"toBW"===n)Q.params.input.push(JSON.stringify(Ne(B,Ul,"m",dc).call(B,o)));else if("toGray"===n)Q.params.input.push(JSON.stringify(Ne(B,Ul,"m",dc).call(B,o)));else if("removeShadow"===n)Q.params.input.push(JSON.stringify(Ne(B,Ul,"m",dc).call(B,o)));else if("enhance"===n)Q.params.input.push(JSON.stringify(Ne(B,Ul,"m",dc).call(B,o)));else if("invert"===n)Q.params.input.push(JSON.stringify(Ne(B,Ul,"m",dc).call(B,o)));else if("brightnessAndContrast"===n){let te=null!==(v=o.brightness)&&void 0!==v?v:0,Me=null!==(y=o.contrast)&&void 0!==y?y:0;Q.params.input.push(te),Q.params.input.push(Me)}let J=null!==(_=h.returnType)&&void 0!==_?_:Kc.IT_JPG,Z=null!==(b=h.jpegQuality)&&void 0!==b?b:this._jpegQuality,re=null!==(w=h.bRGBA)&&void 0!==w&&w,se=null!==(I=h.bitDepth)&&void 0!==I?I:0,ce=null!==(A=h.xdpi)&&void 0!==A?A:0,pe=null!==(M=h.ydpi)&&void 0!==M?M:0,Ce=null===(F=h.returnBlob)||void 0===F||F;J=re&&null==J?Kc.IT_JPG:null!=J?J:Kc.IT_ALL;let Ve=null!==(V=h.is1BitTo8Bit)&&void 0!==V&&V;return Q.params.input.push([J,se,ce,pe,!1,Z,!1,Ve]),Q.params.returnBlob=Ce,Q.handleResult=this._handleImageData,B._addTask(Q),Q.promise}rotate(n,o,h,v){return((n=null!=n?n:0)<0||n>360)&&(n%=360)<0&&(n+=360),this._addTask(this._createTask("RotateEx",[n,h=null!=h&&h,v=null!=v?v:S_.Bicublic,o=null!=o?o:"FFFFFF"],this._handleBooleanResult))}flip(n){n=null!=n?n:1;let o=this._createTask("");return o.handleResult=this._handleBooleanResult,1===n?o.func="Flip":-1===n&&(o.func="Mirror"),this._addTask(o),o.promise}erase(n,o,h,v,y){let _=this,b=_._createTask("Erase");return b.handleResult=this._handleBooleanResult,b.params.input=[n,o,h,v,JSON.stringify(Ne(_,Ul,"m",dc).call(_,y))],_._addTask(b),b.promise}crop(n,o,h,v){return this._addTask(this._createTask("Crop",[n,o,h,v],this._handleBooleanResult))}resize(n,o,h){return this._addTask(this._createTask("ChangeImageSize",[n,o,h=null!=h?h:S_.BestQuality],this._handleBooleanResult))}toGrayscaleLevel(n){(n=null!=n?n:1)<1&&(n=1),n>3&&(n=3);let o={};return 2===n?(o.clean=!0,o.sigma=3,o.scaleLimit=720,o.alpha=1.05):3===n&&(o.clean=!0,o.sigma=5,o.scaleLimit=1080,o.alpha=1.05),this.toGrayscale(o)}toGrayscale(n){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(Ne(this,Ul,"m",dc).call(this,n)),this._handleBooleanResult))}toBinaryLevel(n,o){(o=null!=o?o:1)<1&&(o=1),o>3&&(o=3);let h={};return null!=n&&(n?h.method="adaptiveThreshold":(h.method="threshold",2===o?(h.clean=!0,h.sigma=3,h.scaleLimit=720,h.alpha=1.05):3===o&&(h.clean=!0,h.sigma=5,h.scaleLimit=1080,h.alpha=1.05))),this.toBinary(h)}toBinary(n){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(Ne(this,Ul,"m",dc).call(this,n)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(n,o){return this._addTask(this._createTask("SetImageWidth",[n,JSON.stringify(Ne(this,Ul,"m",dc).call(this,o))],this._handleBooleanResult))}setImageHeight(n,o){return this._addTask(this._createTask("SetImageHeight",[n,JSON.stringify(Ne(this,Ul,"m",dc).call(this,o))],this._handleBooleanResult))}setDPI(n,o,h,v,y,_){return this._addTask(this._createTask("SetDPI",[n,o,h,v,y=null!=y&&y,_=null!=_?_:S_.Bilinear],this._handleBooleanResult))}getImage(n,o,h,v,y,_,b,w,I){n=null!=n?n:this._jpegQuality,o=null==o||o,v=null!=v?v:0,y=null!=y?y:0,_=null!=_?_:0,b=null==b||b,w=(h=null!=h&&h)&&null==w?Kc.IT_JPG:null!=w?w:Kc.IT_ALL,I=null!=I&&I;let A=this._createTask("GetCurrentImage");return A.params.input=[w,v,y,_,!1,n,o,I],A.params.returnBlob=b,A.handleResult=this._handleImageData,this._addTask(A)}getSkewAngle(n){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(Ne(this,Ul,"m",dc).call(this,n))],function(o,h){return o.skewAngle}))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(n,o,h,v,y){return this._addTask(this._createTask("DocumentDetect",[n=null!=n?n:S_.Bilinear,(o=null!=o?o:75)/100,h=null!=h?h:100,(v=null!=v?v:0)/255,y=null!=y?y:"","1"]))}perspective(n,o,h,v,y,_,b,w){return this._addTask(this._createTask("Perspective",[n,o,h,v,y,_,b,w],this._handleBooleanResult))}changeBrightness(n,o){return n=null!=n?n:0,0!=(o=null!=o?o:1)&&1!=o&&(o=0),this._addTask(1===o?this._createTask("ChangeBrightnessAndContrast",[n,0],this._handleBooleanResult):this._createTask("ChangeBrightness",[Math.floor(n/1e3*255)],this._handleBooleanResult))}changeContrast(n,o){return n=null!=n?n:0,0!=(o=null!=o?o:1)&&1!=o&&(o=0),this._addTask(1===o?this._createTask("ChangeBrightnessAndContrast",[0,n],this._handleBooleanResult):this._createTask("ChangeContrast",[1+n/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(n,o){return this._addTask(this._createTask("ChangeBrightnessAndContrast",[n=null!=n?n:0,o=null!=o?o:0],this._handleBooleanResult))}removeShadowLevel(n,o){o=null!=o?o:1.05,(n=null!=n?n:1)<1&&(n=1),n>3&&(n=3);let h={};return 1===n&&(h.sigma=3,h.scaleLimit=720,h.alpha=o),2===n?(h.sigma=5,h.scaleLimit=1080,h.alpha=o):3===n&&(h.sigma=10,h.scaleLimit=0,h.alpha=o),this.removeShadow(h)}removeShadow(n){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(Ne(this,Ul,"m",dc).call(this,n))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],function(n,o){return n.blurryScore}))}drawQuadrangle(n,o,h,v,y,_,b,w,I){return this._addTask(this._createTask("DrawQuadrangle",[n,o,h,v,y,_,b,w,JSON.stringify(Ne(this,Ul,"m",dc).call(this,I))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}Ul=new WeakSet,dc=function(p){let n={};if(null!=p&&"object"==typeof p)for(let o in p)n[o]=p[o];return n};class HE{constructor(){oo.add(this)}destroy(){oo.delete(this)}static addPdfFont(n,o){return gn(this,void 0,void 0,function*(){return oo.addFont(n,o)})}static getPdfFonts(){return oo.getFonts()}getPdfInfo(n){return gn(this,void 0,void 0,function*(){return oo.createTask("getPdfInfo",[n])})}readPage(n,o,h,v,y,_,b,w){return gn(this,void 0,void 0,function*(){return this.readPageEx(n,o,{convertMode:v,renderOptions:{resolution:h}},y,_,b,w)})}readPageEx(n,o,h,v,y,_,b){return gn(this,void 0,void 0,function*(){return oo.createTask("readPdfPage",[n,o,h,v,y,_,b])})}cancelReadPage(n,o){return oo.cancelTask("readPdfPage",[n,o])}readPageImageInfos(n,o,h,v,y,_,b){return gn(this,void 0,void 0,function*(){return oo.createTask("readPdfPageImageInfos",[n,o,h,v,y,_,b])})}readPageAnnot(n,o){return gn(this,void 0,void 0,function*(){return oo.createTask("readPdfPageAnnot",[n,o])})}findText(n,o,h,v){return gn(this,void 0,void 0,function*(){return oo.createTask("findPdfText",[n,o,h,v])})}getPageInfos(n,o){return gn(this,void 0,void 0,function*(){return oo.createTask("getPdfPageInfos",[n,o])})}}!function(p){p[p.auto=0]="auto",p[p.store=1]="store"}(GJ||(GJ={}));class REe extends zg{constructor(n){super(_n.PdfWriterModule,n),_p.add(this)}initPdfSetting(n){return gn(this,void 0,void 0,function*(){let o=this,h=o._createTask("CreateDocument");return h.params.input=[JSON.stringify(Ne(o,_p,"m",JO).call(o,n))],h.handleResult=this._handleBooleanResult,o._addTask(h)})}appendPage(n,o){return gn(this,void 0,void 0,function*(){let h=this,v=h._createTask("InsertImagePage");o=null!=o&&o;const y=yield h._readFile(n);return v.params.input=[y,-1,o],v.handleResult=h._handleBooleanResult,h._addTask(v),v.promise})}insertPage(n,o,h){return gn(this,void 0,void 0,function*(){let v=this,y=v._createTask("InsertImagePage");h=null!=h&&h;const _=yield v._readFile(n);return y.params.input=[_,o,h],y.handleResult=v._handleBooleanResult,v._addTask(y),y.promise})}writePdf(n){return gn(this,void 0,void 0,function*(){let o=this._createTask("GetCurrentPdf");return o.params.returnType=null!=n?n:da.RT_AUTO,o.params.returnBlob=n!=da.RT_AUTO,o.handleResult=this._handleImageData,this._addTask(o)})}insertBlankPage(n,o,h){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("InsertBlankPage",[n=null!=n?n:0,o=null!=o?o:595,h=null!=h?h:842]))})}deletePage(n){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePdfPage",[n=null!=n?n:0],this._handleBooleanResult))})}pageSetRotation(n,o){return gn(this,void 0,void 0,function*(){n=null!=n?n:0,0!=(o=((o=null!=o?o:0)%360+360)%360)&&90!==o&&180!==o&&270!==o&&(o=0);let h=this._createTask("SetPageRotation");return h.params.input=[n,o],h.handleResult=this._handleBooleanResult,this._addTask(h)})}pageSetCropBox(n,o,h,v,y){return gn(this,void 0,void 0,function*(){n=null!=n?n:0,o=null!=o?o:0,h=null!=h?h:0,(v=null!=v?v:o)<o&&(v=o),(y=null!=y?y:h)<h&&(y=h);let _=this._createTask("SetPageCropBox");return _.params.input=[n,o,h,v,y],_.handleResult=this._handleBooleanResult,this._addTask(_)})}pageSetMediaBox(n,o,h,v,y){return gn(this,void 0,void 0,function*(){n=null!=n?n:0,o=null!=o?o:0,h=null!=h?h:0,(v=null!=v?v:o)<o&&(v=o),(y=null!=y?y:h)<h&&(y=h);let _=this._createTask("SetPageMediaBox");return _.params.input=[n,o,h,v,y],_.handleResult=this._handleBooleanResult,this._addTask(_)})}pageAddImage(n,o,h,v,y){return gn(this,void 0,void 0,function*(){let _=this,b=_._createTask("PageAddImage"),w=JSON.stringify(Ne(_,_p,"m",JO).call(_,h));const I=yield _._readFile(n);return b.params.input=[I,o,w,v,y],b.handleResult=_._handleBooleanResult,_._addTask(b),b.promise})}pageAddText(n,o){return gn(this,void 0,void 0,function*(){yield Ne(this,_p,"m",Vx).call(this);let h=JSON.stringify(o);return this._addTask(this._createTask("PageAddText",[n,h],this._handleBooleanResult))})}pageAddPath(n,o){return gn(this,void 0,void 0,function*(){let h=JSON.stringify(o);return this._addTask(this._createTask("PageAddPath",[n,h],this._handleBooleanResult))})}pageClearObjects(n){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageClearObjects",[n=null!=n?n:0],this._handleBooleanResult))})}pageSetAnnot(n,o){return gn(this,void 0,void 0,function*(){let h;return n=null!=n?n:0,Array.isArray(o)?(h="[",o.forEach((v,y)=>{y>0&&(h+=","),h+=JSON.stringify(v)}),h+="]"):h=JSON.stringify(o),yield Ne(this,_p,"m",Vx).call(this),this._addTask(this._createTask("SetPageAnnot",[n,h],this._handleBooleanResult))})}getFontFromTextObject(n){return n.fontName?n.fontName:""}getFontFromAnnot(n){let o=[];return n&&n.normalAppearance&&n.normalAppearance.objs&&n.normalAppearance.objs.forEach(v=>{if("text"===v.type){const _=this.getFontFromTextObject(v);_&&o.push(_)}}),o=[...new Set(o)],o}getFontFromAnnots(n){let o=[];return Array.isArray(n)?n.forEach(v=>{const y=this.getFontFromAnnot(v);o=o.concat(y)}):o=this.getFontFromAnnot(n),o=[...new Set(o)],o}pageAddAnnot(n,o){return gn(this,void 0,void 0,function*(){let h;return n=null!=n?n:0,Array.isArray(o)?(h="[",o.forEach((v,y)=>{y>0&&(h+=","),h+=JSON.stringify(v)}),h+="]"):h=JSON.stringify(o),yield Ne(this,_p,"m",Vx).call(this),this._addTask(this._createTask("PageAddAnnot",[n,h],this._handleBooleanResult))})}pageDeleteAnnot(n,o){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnot",[n=null!=n?n:0,o=null!=o?o:0],this._handleBooleanResult))})}pageDeleteAnnotByTypes(n,o){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByTypes",[n=null!=n?n:0,o=null!=o?o:""],this._handleBooleanResult))})}pageDeleteAnnotByNames(n,o){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("DeletePageAnnotByNames",[n=null!=n?n:0,o=null!=o?o:""],this._handleBooleanResult))})}mergePdf(n,o,h,v,y){return gn(this,void 0,void 0,function*(){v=null!=v?v:-1,h=null!=h?h:[],o=null!=o?o:"",y=null!=y&&y;let _=this,b=_._createTask("MergePdfPages");const w=yield _._readFile(n);return b.params.input=[w,v,o,h,y],b.handleResult=_._handleBooleanResult,_._addTask(b),b.promise})}pageFlatten(n,o){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("PageFlatten",[n=null!=n?n:0,o=null!=o?o:0],this._handleBooleanResult))})}GetFontInfo(n){return gn(this,void 0,void 0,function*(){const o=yield this._readFile(n);return this._addTask(this._createTask("GetFontInfo",[o]))})}IfFontsExist(n){return gn(this,void 0,void 0,function*(){let o=JSON.stringify(n);return yield Ne(this,_p,"m",Vx).call(this),this._addTask(this._createTask("IfFontsExist",[o]))})}}_p=new WeakSet,Vx=function(){return gn(this,void 0,void 0,function*(){On.logD("["+this.id+"] load font in worker "+this.workerId);const p=Yg.fonts,n=Object.keys(Yg.fonts);for(let o of n){const h=p[o],v=yield Gg.read(h);v&&(yield Ne(this,_p,"m",HJ).call(this,o,v))}})},HJ=function(p,n){return gn(this,void 0,void 0,function*(){return this._addTask(this._createTask("LoadFont",[n,p]))})},JO=function(p){let n={};if(null!=p&&"object"==typeof p)for(let o in p)n[o]=p[o];return n},function(p){p.Text="Text",p.Link="Link",p.FreeText="FreeText",p.Line="Line",p.Square="Square",p.Circle="Circle",p.Polygon="Polygon",p.PolyLine="PolyLine",p.Hignlight="Highlight",p.Underline="Underline",p.Squiggly="Squiggly",p.StrikeOut="StrikeOut",p.Stamp="Stamp",p.Caret="Caret",p.Ink="Ink",p.Popup="Popup"}(zJ||(zJ={})),function(p){p.None="none",p.Invisible="invisible",p.Hidden="hidden",p.Print="print",p.NoZoom="nozoom",p.NoRotate="norotate",p.NoView="noview",p.ReadOnly="readonly",p.Locked="locked",p.ToggleNoView="togglenoview",p.LockedContents="lockedcontents"}(YJ||(YJ={})),function(p){p.Solid="S",p.Dashed="D",p.Beveled="B",p.Insert="I",p.Underline="U"}(XJ||(XJ={})),function(p){p.NoEffect="S",p.Cloudy="C"}($J||($J={})),function(p){p.Comment="Comment",p.Key="Key",p.Note="Note",p.Help="Help",p.NewParagraph="NewParagraph",p.Paragraph="Paragraph",p.Insert="Insert"}(qJ||(qJ={})),function(p){p.Marked="Marked",p.Review="Review"}(KJ||(KJ={})),function(p){p.Accepted="Accepted",p.Rejected="Rejected",p.Cancelled="Cancelled",p.Completed="Completed",p.None="None"}(JJ||(JJ={})),function(p){p.None="None",p.Square="Square",p.Circle="Circle",p.Diamond="Diamond",p.OpenArrow="OpenArrow",p.ClosedArrow="ClosedArrow",p.Butt="Butt",p.ROpenArrow="ROpenArrow",p.RClosedArrow="RClosedArrow",p.Slash="Slash"}(QJ||(QJ={})),function(p){p[p.LeftJustified=0]="LeftJustified",p[p.Centered=1]="Centered",p[p.RightJustified=2]="RightJustified"}(ZJ||(ZJ={})),function(p){p.FreeText="FreeText",p.FreeTextCallout="FreeTextCallout",p.FreeTextTypeWriter="FreeTextTypeWriter"}(eQ||(eQ={})),function(p){p.LineArrow="LineArrow",p.LineDimension="LineDimension"}(tQ||(tQ={})),function(p){p.Approved="Approved",p.Experimental="Experimental",p.NotApproved="NotApproved",p.Asls="Asls",p.Expired="Expired",p.NotForPublicRelease="NotForPublicRelease",p.Confidential="Confidential",p.Final="Final",p.Sold="Sold",p.Departmental="Departmental",p.ForComment="ForComment",p.TopSecret="TopSecret",p.Draft="Draft",p.ForPublicRelease="ForPublicRelease"}(nQ||(nQ={}));const Mv="undefined"==typeof self,Ov=Mv?{}:self;let jx,Hx,GE,QO,fl;"undefined"!=typeof navigator&&(jx=navigator,Hx=jx.userAgent,GE=jx.platform,QO=jx.mediaDevices),function(){if(!Mv){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:jx.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:GE,search:"Win"},Mac:{str:GE},Linux:{str:GE}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||Hx,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||Hx).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||Hx).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=Hx.indexOf("Windows NT")&&(v="HarmonyOS"),fl={browser:o,version:h,OS:v}}Mv&&(fl={browser:"ssr",version:0,OS:"ssr"})}();const kEe="Chrome"===fl.browser&&fl.version>66||"Safari"===fl.browser&&fl.version>13||"OPR"===fl.browser&&fl.version>43||"Edge"===fl.browser&&fl.version>15,T_="\\s*([+-]?\\d+)\\s*",Gx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",iQ=/^#([0-9a-f]{3,8})$/,rQ=new RegExp(`^rgb\\(${T_},${T_},${T_}\\)$`),oQ=new RegExp(`^rgb\\(${zh},${zh},${zh}\\)$`),sQ=new RegExp(`^rgba\\(${T_},${T_},${T_},${Gx}\\)$`),aQ=new RegExp(`^rgba\\(${zh},${zh},${zh},${Gx}\\)$`),lQ=new RegExp(`^hsl\\(${Gx},${zh},${zh}\\)$`),cQ=new RegExp(`^hsla\\(${Gx},${zh},${zh},${Gx}\\)$`),uQ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let Fv=class{constructor(p,n,o,h){W(this,"r",void 0),W(this,"g",void 0),W(this,"b",void 0),W(this,"opacity",void 0),this.r=p,this.g=n,this.b=o,this.opacity=h}};function dQ(p){return new Fv(p>>16&255,p>>8&255,255&p,1)}function zE(p,n,o,h){return h<=0&&(p=NaN,n=NaN,o=NaN),new Fv(p,n,o,h)}function hQ(p,n,o,h){return h<=0?(p=NaN,n=NaN,o=NaN):o<=0||o>=1?(p=NaN,n=NaN):n<=0&&(p=NaN),{h:p,s:n,l:o,opacity:h}}function ZO(p,n,o){return p<60?(n+(o-n)*p)/60*255:p<180?255*o:p<240?(n+(o-n)*(240-p))/60*255:255*n}function fQ(p){const n=p.h<0?p.h%360+360:p.h%360,o=Number.isNaN(n)||Number.isNaN(p.s)?0:p.s,{l:h}=p,v=h+(h<.5?h:1-h)*o,y=2*h-v;return new Fv(ZO(n>=240?n-240:n+120,y,v),ZO(n,y,v),ZO(n<120?n+240:n-120,y,v),p.opacity)}const MEe=p=>{let n,o;if(p=`${p}`.trim().toLowerCase(),iQ.exec(p))switch(n=iQ.exec(p),o=n[1].length,n=parseInt(n[1],16),o){case 6:return dQ(n);case 3:return new Fv(n>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1);case 8:return zE(n>>24&255,n>>16&255,n>>8&255,(255&n)/255);case 4:return zE(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|240&n,((15&n)<<4|15&n)/255);default:return null}return rQ.exec(p)?(n=rQ.exec(p),new Fv(n[1],n[2],n[3],1)):oQ.exec(p)?(n=oQ.exec(p),new Fv(255*n[1]/100,255*n[2]/100,255*n[3]/100,1)):sQ.exec(p)?(n=sQ.exec(p),zE(n[1],n[2],n[3],n[4])):aQ.exec(p)?(n=aQ.exec(p),zE(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4])):lQ.exec(p)?(n=lQ.exec(p),fQ(hQ(n[1],n[2]/100,n[3]/100,1))):cQ.exec(p)?(n=cQ.exec(p),fQ(hQ(n[1],n[2]/100,n[3]/100,n[4]))):uQ.hasOwnProperty(p)?dQ(uQ[p]):"transparent"===p?new Fv(NaN,NaN,NaN,0):null},OEe=p=>p.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`),zx=p=>Object.prototype.toString.call(p),Di=p=>Array.isArray?Array.isArray(p):"[object Array]"===zx(p),Vn=p=>null!==p&&"[object Object]"===zx(p),pn=p=>{let n=null;return Di(p)&&(n||(n=[]),p.forEach(o=>{n.push(pn(o))})),Vn(p)&&(n||(n={}),Object.keys(p).forEach(o=>{n[o]=pn(p[o])})),n||p},gt=p=>void 0===p,pQ=(p,n)=>{var o;p=null!==(o=p)&&void 0!==o?o:"yyyy-MM-dd hh:mm:ss";const h=gt(n)?new Date:new Date(n),v={"M+":(h.getMonth()+1).toString(),"d+":h.getDate().toString(),"h+":h.getHours().toString(),"m+":h.getMinutes().toString(),"s+":h.getSeconds().toString(),"q+":Math.floor((h.getMonth()+3)/3).toString(),S:h.getMilliseconds().toString()};return/(y+)/.test(p)&&(p=p.replace(RegExp.$1,`${h.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(v).forEach(y=>{new RegExp(`(${y})`).test(p)&&(p=p.replace(RegExp.$1,1===RegExp.$1.length?v[y]:`00${v[y]}`.substring(`${v[y]}`.length)))}),p},YE=p=>"[object ArrayBuffer]"===zx(p),pl=p=>"[object Blob]"===zx(p),As=p=>"[object Boolean]"===zx(p),I_=p=>"function"==typeof p,rr=()=>"ontouchstart"in document.documentElement,$t=p=>"number"==typeof p&&!Number.isNaN(p),Sn=p=>"string"==typeof p,Ir=(p,n,o)=>Math.min(Math.max(p,n),o);let gQ=0;const Ai=()=>(gQ+=1,`${(new Date).getTime().toString(36)}${gQ.toString(36)}`),XE=p=>{const n=window.URL||window.webkitURL;let o="string";return Sn(p)?o="string":pl(p)?(o="blob",p=n.createObjectURL(p)):(YE(p)||Di(p))&&(o="blob",p=n.createObjectURL(new Blob([p]))),{type:o,data:p}};function E_(p){return"object"==typeof HTMLElement?p instanceof HTMLElement:p&&"object"==typeof p&&1===p.nodeType&&"string"==typeof p.nodeName}let Yh=class Ope{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";W(this,"prefix",void 0),W(this,"postfix",void 0),W(this,"isDestroyed",!1),W(this,"uid",Ai()),W(this,"cacheEvents",void 0),W(this,"events",void 0),W(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=n,this.postfix=o}static create(n,o){return new Ope(n,o)}save(){this.isCached=!0}restore(){this.isCached=!1,this.cacheEvents.forEach(n=>{let{eventName:o,param:h}=n;this.emit(o,...h)}),this.cacheEvents.length=0}destroy(){if(!this.isDestroyed){for(const n in this.events)if(Object.prototype.hasOwnProperty.call(this.events,n)){const o=this.events[n];o&&o.slice().forEach(h=>{let{name:v,fn:y,context:_,once:b}=h;this.off(v,y,_,b)})}this.events={},this.isDestroyed=!0}}on(n,o,h){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:y}=this,_={name:n=this.format(n),uid:Ai(),context:h,once:v,fn:o};return y[n]||(y[n]=[]),y[n].indexOf(_)<0&&y[n].push(_),_}once(n,o,h){return this.on(n,o,h,!0)}emit(n){for(var o=arguments.length,h=new Array(o>1?o-1:0),v=1;v<o;v++)h[v-1]=arguments[v];if(this.isCached)return this.cacheEvents.push({eventName:n,param:h}),!0;const{events:y}=this,_=y[n=this.format(n)];return!(!_||!_.length||(_.slice().forEach(b=>{let{fn:w,context:I}=b;w.call(I||null,...h)}),_.slice().forEach(b=>{let{fn:w,context:I,once:A}=b;A&&this.off(n,w,I,A)}),0))}off(n,o,h,v){const{events:y}=this,_=y[n=this.format(n)];if(!_)return!1;if(!arguments.length)return _.length=0,!0;for(let b=_.length-1;b>=0;b--){const w=_[b];o&&w.fn!==o||h&&w.context!==h||v&&w.once!==v||_.splice(b,1)}return!0}removeAllEventListeners(n){if(n){n=this.format(n);const o=this.cacheEvents.findIndex(h=>h.eventName===n);o>-1&&this.cacheEvents.splice(o,1),this.events[n]&&delete this.events[n]}else this.cacheEvents=[],this.events={}}getAllEvents(){return this.events}format(n){return`${this.prefix||""}${n}${this.postfix||""}`}};const e5="default";let Lo=class Fpe{constructor(){W(this,"emitter",new Yh)}static create(){return new Fpe}on(n){this.emitter.on(e5,n)}emit(){for(var n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];this.emitter.emit(e5,...o)}off(n){this.emitter.off(e5,n)}};function Cp(){return new Lo}let FEe=class AC{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),this.x=n,this.y=o,this.z=h}static fromPoint(n){return new AC(n.x,n.y,n.z)}static fromTwoPoint(n,o){var h,v,y,_,b,w;return new AC((null!==(h=o.x)&&void 0!==h?h:0)-(null!==(v=n.x)&&void 0!==v?v:0),(null!==(y=o.y)&&void 0!==y?y:0)-(null!==(_=n.y)&&void 0!==_?_:0),(null!==(b=o.z)&&void 0!==b?b:0)-(null!==(w=n.z)&&void 0!==w?w:0))}static fromValue(n,o,h){return new AC(n,o,h)}setFromVector(n){var o;this.x=n.x,this.y=n.y,this.z=null!==(o=n.z)&&void 0!==o?o:0}clone(){return new AC(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(n){var o;return this.x*n.x+this.y*n.y+this.z*(null!==(o=n.z)&&void 0!==o?o:0)}projectionTo(n){const o=Math.hypot(n.x,n.y,n.z);return this.dot(n)/o}angle(n){const o=this.norm()*Math.hypot(n.x,n.y,n.z),h=o&&this.dot(n)/o;return Math.acos(Ir(h,-1,1))}equals(n){var o;return this.x===n.x&&this.y===n.y&&this.z===(null!==(o=n.z)&&void 0!==o?o:0)}distance(n){var o;return Math.hypot(this.x-n.x,this.y-n.y,this.z-(null!==(o=n.z)&&void 0!==o?o:0))}lerp(n){var o;let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:v,y,z:_}=this;return new AC(v+h*(n.x-v),y+h*(n.y-y),_+h*((null!==(o=n.z)&&void 0!==o?o:0)-_))}normalize(){const n=this,o=n.norm();return n.x/=o,n.y/=o,n.z/=o,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(n){const o=this;return{x:o.y*n.z-o.z*n.y,y:o.z*n.x-o.x*n.z,z:o.x*n.y-o.y*n.x}}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this}};function $E(p,n){return FEe.fromTwoPoint(p,n)}let t5=class Lpe{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),this.x=n,this.y=o,this.z=h}static fromPoint(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Lpe(n.x,n.y,n.z)}matrixTransform(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:o,y:h,z:v}=this,{m11:y,m21:_,m31:b,m41:w,m12:I,m22:A,m32:M,m42:F,m13:V,m23:B,m33:Q,m43:J,m14:Z,m24:re,m34:se,m44:ce}=n,pe=Z*o+re*h+se*v+ce;return qE({x:(y*o+_*h+b*v+w)/pe,y:(I*o+A*h+M*v+F)/pe,z:(V*o+B*h+Q*v+J)/pe})}setFromPoint(n){return this.x=n.x||0,this.y=n.y||0,this.z=n.z||0,this}clone(){return qE(this)}equals(n){const{x:o=0,y:h=0,z:v=0}=n,y=this;return y.x===o&&y.y===h&&y.z===v}distanceTo(n){const{x:o=0,y:h=0,z:v=0}=n,y=this;return Math.hypot(y.x-o,y.y-h,y.z-v)}lerpTo(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:h=0,y:v=0,z:y=0}=n,_=this;return qE({x:_.x+o*(h-_.x),y:_.y+o*(v-_.y),z:_.z+o*(y-_.z)})}footPointInSegment(n,o){const h=$E(n,this),v=$E(n,o),y=v.norm(),_=qE(n);if(0===y)return _;const b=h.projectionTo(v)/y;return _.lerpTo(o,b)}perpendicularToSegment(n,o){const h=this.footPointInSegment(n,o);return this.distanceTo(h)}};function qE(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return $t(p)?new t5(p,n,o):new t5(p.x,p.y,p.z)}let mQ=class{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),W(this,"w",void 0),this.x=p,this.y=n,this.z=o,this.w=h}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const p=this.norm();this.x/=p,this.y/=p,this.z/=p,this.w/=p}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}};function Xg(p,n){return((p.x-n.x)**2+(p.y-n.y)**2)**.5}class vQ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;W(this,"x",0),W(this,"y",0),W(this,"left",0),W(this,"top",0),W(this,"right",0),W(this,"bottom",0),W(this,"width",0),W(this,"height",0),this.update(n,o,h,v)}update(n,o,h,v){this.x=n,this.y=o,this.left=n,this.top=o,this.right=n+h,this.bottom=o+v,this.width=h,this.height=v}toJSON(){}}const n5=new class{constructor(){W(this,"tasks",[])}createTimer(p,n){const o=Ai();return this.tasks.push({uid:o,callback:p,time:n}),this.executeTimer(o),o}executeTimer(p){const n=this.tasks.find(h=>h.uid===p);if(!n)return;const o=()=>{n.callback(),null!==n.timer&&(n.timer=setTimeout(o,n.time))};n.timer=setTimeout(o,n.time)}clearTimer(p){const n=this.tasks.findIndex(o=>o.uid===p);n>-1&&(clearTimeout(this.tasks[n].timer),this.tasks[n].timer=null,this.tasks.splice(n,1))}};function LEe(p,n,o,h){if(v=p,y=n,_=o,b=h,Math.min(v[0],y[0])<=Math.max(_[0],b[0])&&Math.min(_[0],b[0])<=Math.max(v[0],y[0])&&Math.min(v[1],y[1])<=Math.max(_[1],b[1])&&Math.min(_[1],b[1])<=Math.max(v[1],y[1])&&function(v,y,_,b){let w=v[0]*(_[1]-y[1])+y[0]*(v[1]-_[1])+_[0]*(y[1]-v[1]),I=v[0]*(b[1]-y[1])+y[0]*(v[1]-b[1])+b[0]*(y[1]-v[1]);return!((w^I)>=0&&0!==w&&0!==I||(w=_[0]*(v[1]-b[1])+b[0]*(_[1]-v[1])+v[0]*(b[1]-_[1]),I=_[0]*(y[1]-b[1])+b[0]*(_[1]-y[1])+y[0]*(b[1]-_[1]),(w^I)>=0&&0!==w&&0!==I))}(p,n,o,h)){let v=(h[0]-o[0])*(p[1]-n[1])-(n[0]-p[0])*(o[1]-h[1]),y=(p[1]-o[1])*(n[0]-p[0])*(h[0]-o[0])+o[0]*(h[1]-o[1])*(n[0]-p[0])-p[0]*(n[1]-p[1])*(h[0]-o[0]);if(0===v||0===y){const b=yQ(p,n),w=yQ(o,h),I=b[0],A=b[1],M=w[0],F=w[1];if(A[0]===M[0]&&A[1]===M[1])return A;if(I[0]===F[0]&&I[1]===F[1])return I;if($g(A,w)&&$g(M,b))return[M,A];if($g(I,w)&&$g(F,b))return[I,F];if($g(I,w)&&$g(A,w))return[I,A];if($g(M,w)&&$g(F,w))return[M,F]}const _=y/v;return v=(p[0]-n[0])*(h[1]-o[1])-(n[1]-p[1])*(o[0]-h[0]),y=n[1]*(p[0]-n[0])*(h[1]-o[1])+(h[0]-n[0])*(h[1]-o[1])*(p[1]-n[1])-h[1]*(o[0]-h[0])*(n[1]-p[1]),[_,y/v]}var v,y,_,b;return!1}function yQ(p,n){return p[0]===n[0]?p[1]<n[1]?[p,n]:[n,p]:p[0]<n[0]?[p,n]:[n,p]}function $g(p,n){return n[0][0]===n[1][0]?p[1]>=n[0][1]&&p[1]<=n[1][1]:p[0]>=n[0][0]&&p[0]<=n[1][0]}function KE(p){const n=[];let o=null;const h=p.slice(0,8).concat(p[0],p[1]);for(let v=0;v<4;v++){const y=h[2*(v+1)+1]-h[2*v+1],_=h[2*(v+1)]-h[2*v];o=0===y&&0===_?0:y/_,n.push(o)}return n}function JE(p){const[n,o,h,v,y,_,b,w]=p,I=(b-n)*(v-o)-(w-o)*(h-n),A=(n-h)*(_-v)-(o-v)*(y-h),M=(h-y)*(w-_)-(v-_)*(b-y),F=(y-b)*(o-w)-(_-w)*(n-b);if(I*A*M*F<0)return!1;const V=p.slice().concat(p.slice(0,2)),B=KE(p);if(B.length)for(let Q=0;Q<2;Q++)if(B[Q]!==B[Q+2]&&LEe(V.slice(2*Q,2*(Q+1)),V.slice(2*(Q+1),2*(Q+2)),V.slice(2*(Q+2),2*(Q+3)),V.slice(2*(Q+3),2*(Q+4))))return!1;return I*A*M*F>0}function qg(p,n){return((p.x-n.x)**2+(p.y-n.y)**2)**.5}function NEe(p){const{type:n,value:o}=p;return"hex"===n?`#${o}`:"literal"===n?o:"rgb"===n?`rgb(${o.join(",")})`:`rgba(${o.join(",")})`}const BEe=function(){const p_linearGradient=/^(linear\-gradient)/i,p_repeatingLinearGradient=/^(repeating\-linear\-gradient)/i,p_radialGradient=/^(radial\-gradient)/i,p_repeatingRadialGradient=/^(repeating\-radial\-gradient)/i,p_conicGradient=/^(conic\-gradient)/i,p_sideOrCorner=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,p_extentKeywords=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,p_positionKeywords=/^(left|center|right|top|bottom)/i,p_pixelValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,p_percentageValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,p_emValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,p_angleValue=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,p_startCall=/^\(/,p_endCall=/^\)/,p_comma=/^,/,p_hexColor=/^\#([0-9a-fA-F]+)/,p_literalColor=/^([a-zA-Z]+)/,p_rgbColor=/^rgb/i,p_rgbaColor=/^rgba/i,p_number=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/;let n="";function o(ce){throw new Error(`${n}: ${ce}`)}function h(){return v("linear-gradient",p_linearGradient,_)||v("repeating-linear-gradient",p_repeatingLinearGradient,_)||v("radial-gradient",p_radialGradient,b)||v("repeating-radial-gradient",p_repeatingRadialGradient,b)||v("conic-gradient",p_conicGradient,b)}function v(ce,pe,Ce){return y(pe,Ve=>{const te=Ce();return te&&(re(p_comma)||o("Missing comma before color stops")),{type:ce,orientation:te,colorStops:F(V)}})}function y(ce,pe){const Ce=re(ce);if(Ce){re(p_startCall)||o("Missing (");const Ve=pe(Ce);return re(p_endCall)||o("Missing )"),Ve}}function _(){return Z("directional",p_sideOrCorner,1)||Z("angular",p_angleValue,1)}function b(){let ce,pe,Ce=w();return Ce&&(ce=[],ce.push(Ce),pe=n,re(p_comma)&&(Ce=w(),Ce?ce.push(Ce):n=pe)),ce}function w(){let ce=function(){const pe=Z("shape",/^(circle)/i,0);return pe&&(pe.style=J()||I()),pe}()||function(){const pe=Z("shape",/^(ellipse)/i,0);return pe&&(pe.style=Q()||I()),pe}();if(ce)ce.at=A();else{const pe=I();if(pe){ce=pe;const Ce=A();Ce&&(ce.at=Ce)}else{const Ce=M();Ce&&(ce={type:"default-radial",at:Ce})}}return ce}function I(){return Z("extent-keyword",p_extentKeywords,1)}function A(){if(Z("position",/^at/,0)){const ce=M();return ce||o("Missing positioning value"),ce}}function M(){const ce={x:Q(),y:Q()};if(ce.x||ce.y)return{type:"position",value:ce}}function F(ce){let pe=ce();const Ce=[];if(pe)for(Ce.push(pe);re(p_comma);)pe=ce(),pe?Ce.push(pe):o("One extra comma");return Ce}function V(){const ce=Z("hex",p_hexColor,1)||y(p_rgbaColor,()=>({type:"rgba",value:F(B)}))||y(p_rgbColor,()=>({type:"rgb",value:F(B)}))||Z("literal",p_literalColor,0);return ce||o("Expected color definition"),ce.length=Q(),ce}function B(){return re(p_number)[1]}function Q(){return Z("%",p_percentageValue,1)||Z("position-keyword",p_positionKeywords,1)||J()}function J(){return Z("px",p_pixelValue,1)||Z("em",p_emValue,1)}function Z(ce,pe,Ce){const Ve=re(pe);if(Ve)return{type:ce,value:Ve[Ce]}}function re(ce){const pe=/^[\n\r\t\s]+/.exec(n);pe&&se(pe[0].length);const Ce=ce.exec(n);return Ce&&se(Ce[0].length),Ce}function se(ce){n=n.substring(ce)}return function(ce){return n=ce,function(){const pe=F(h);return n.length>0&&o("Invalid input not EOF"),pe}()}}(),_Q=(p,n,o)=>{try{void 0===n?o.appendChild(p):o.insertBefore(p,n)}catch(h){}},Yx=()=>{const p=window;if(p){if(p.devicePixelRatio)return p.devicePixelRatio;if(p.screen.deviceXDPI&&p.screen.logicalXDPI)return p.screen.deviceXDPI/p.screen.logicalXDPI}return 1};function Xx(p){let n="0px",o="",h="solid";if(!gt(p)&&""!==p){const v=document.createElement("div");v.style.border=p;const{borderWidth:y,borderColor:_,borderStyle:b}=v.style;"initial"!==y&&""!==y&&(n=y),"initial"!==_&&""!==_&&(o=_),"initial"!==b&&""!==b&&(h=b)}return{borderWidth:n,borderColor:o,borderStyle:h}}const D_=p=>{const{pointerType:n}=p;return"touch"===n||"pen"===n||void 0===n},CQ=function(p,n){const o=p.indexOf(n);return!(o<0||(p.splice(o,1),0))},bQ=function(p,n,o){if($t(o)){let h=[],v=[];if(n.includes(o)){const I=n.length;if(I>1){const A=n.indexOf(o);0===A?v=n.slice(1):A===I-1?h=n.slice(0,-1):(h=n.slice(0,A),v=n.slice(A+1))}}else h=n;const y=p[o],_=h.map(I=>p[I]),b=v.map(I=>p[I]);_.forEach(I=>{const A=p.indexOf(I);A>-1&&p.splice(A,1)}),b.forEach(I=>{const A=p.indexOf(I);A>-1&&p.splice(A,1)});const w=p.indexOf(y);p.splice(w+1,0,...b),p.splice(w,0,..._)}else n.map(h=>p[h]).forEach(h=>{const v=p.indexOf(h);p.splice(v,1),p.push(h)});return!0},xQ=function(p,n,o){if(n===o)return!0;const h=p[n];return p[n]=p[o],p[o]=h,!0},wQ=function(p,n){const o=n.length;return!(p.length!==o||!o||(n.every((h,v)=>h===v)||n.map(h=>p[h]).forEach((h,v)=>{p[v]=h}),0))};function gl(p){return null==p}const QE=(p,n)=>p in n,SQ=(p,n)=>{const o=[];for(;p;){const h=p.match(n);if(!h)break;o.push(h),p=p.substring(h.index+h[0].length)}return o};function yo(p,n){return Object.keys(p).forEach(o=>{gt(n[o])?n[o]=p[o]:Vn(p[o])?yo(p[o],n[o]):n[o]=p[o]}),n}class i5{static read(n){return new Promise((o,h)=>{const v=Object.prototype.toString.call(n);if("[object String]"===v){if(0===n.indexOf("blob:")||n.indexOf(".jpg")>0||n.indexOf(".jpeg")>0||n.indexOf(".png")>0||n.indexOf(".bmp")>0||n.indexOf(".dib")>0||n.indexOf(".pdf")>0||n.indexOf(".tiff")>0||n.indexOf(".tif")>0)return fetch(n,{mode:"cors"}).then(y=>y.arrayBuffer()).then(y=>o(y)).catch(y=>Promise.reject(y));h("Error url: Can not read the file URL")}else if("[object Blob]"===v||"[object FileList]"===v||"[object File]"===v){let y=n;"[object FileList]"!==v&&"[object File]"!==v||(y=n[0]?n[0]:n),WEe.call(i5,y,o,h)}else"[object ArrayBuffer]"===v||"[object Uint8ClampedArray]"===v?o(n):h(`Not support source type: ${v}`)})}}function WEe(p,n,o){let h,v,y=0;try{h=new ArrayBuffer(p.size),v=new Uint8Array(h)}catch(_){o(_)}!function _(){const b=new FileReader;b.onload=function(A){var M;if(null!=A&&null!==(M=A.target)&&void 0!==M&&M.result){const F=A.target.result;v.set(new Uint8Array(F),y),y+=F.byteLength,y<p.size?_():n(h)}else o(A)},b.onerror=function(A){o(A)},b.onabort=function(A){o(A)};const w=Math.min(y+1048576,p.size),I=p.slice(y,w);b.readAsArrayBuffer(I)}()}function ZE(p){return r5.apply(this,arguments)}function r5(){return r5=Fe(function*(p){let n;if(p instanceof ArrayBuffer)p.byteLength>12&&(n=new Uint8Array(p.slice(0,12)));else if(p instanceof Blob&&p.size>12){const o=p.slice(0,12),h=yield i5.read(o);n=new Uint8Array(h)}if(n){if(37===(o=n)[0]&&80===o[1]&&68===o[2]&&70===o[3])return"application/pdf";if(function(o){return 137===o[0]&&80===o[1]&&78===o[2]&&71===o[3]}(n))return"image/png";if(function(o){return 255===o[0]&&216===o[1]}(n))return"image/jpeg";if(function(o){return 66===o[0]&&77===o[1]}(n))return"image/bmp";if(function(o){return 73===o[0]&&73===o[1]&&42===o[2]&&0===o[3]||77===o[0]&&77===o[1]&&0===o[2]&&42===o[3]}(n))return"image/tiff";if(function(o){return 0===o[0]&&0===o[1]&&0===o[2]&&12===o[3]&&106===o[4]&&80===o[5]&&32===o[6]&&32===o[7]||255===o[0]&&79===o[1]&&255===o[2]&&81===o[3]}(n))return"image/jp2";if(function(o){return 82===o[0]&&73===o[1]&&70===o[2]&&70===o[3]&&87===o[8]&&69===o[9]&&66===o[10]&&80===o[11]}(n))return null;if(p instanceof Blob&&("application/pdf"===p.type||"image/bmp"===p.type||"image/jp2"===p.type||"image/jpeg"===p.type||"image/png"===p.type||"image/tiff"===p.type||"image/rgba"===p.type))return p.type}var o;return p instanceof Blob&&"application/ddv-blank-image"===p.type?p.type:null}),r5.apply(this,arguments)}function Kn(p,n,o){return n===o?p:$t(p)?p/n*o:Di(p)?p.map(h=>Di(h)?[h[0]/n*o,h[1]/n*o]:h/n*o):(p=Ke({},p),Object.keys(p).forEach(h=>{p[h]=p[h]/n*o}),p)}function o5(p,n){return p.every((o,h)=>{let[v,y]=o;const[_,b]=n[h];return v===_&&y===b})}function Xh(p,n){return Number.parseFloat(p.toFixed(n))}class TQ{constructor(){W(this,"disposed",!1),W(this,"toDispose",new Set)}get isDisposed(){return this.disposed}add(n){if(!n)return n;if(n===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(n),n}delete(n){if(n){if(n===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(n),n.dispose()}}dispose(){this.disposed||(this.disposed=!0,this.clear())}clear(){try{for(const n of this.toDispose)if(n)try{n.dispose()}catch(o){throw new Error("can not dispose an object")}}finally{this.toDispose.clear()}}}class or{constructor(){W(this,"store",new TQ)}dispose(){this.store.dispose()}register(n){if(n===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(n)}}class e2{static create(n){return new e2(n)}constructor(n){W(this,"isDisposed",!1),W(this,"listeners",void 0),W(this,"options",void 0),this.options=n,this.listeners=[]}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null))}on(n,o,h){var v,y,_,b;if(this.isDisposed)return{dispose:()=>{}};const w={uid:Ai(),callback:n,context:o};this.listeners.length?this.listeners.push(w):(null!==(v=this.options)&&void 0!==v&&null!==(y=v.beforeAddFirstListener)&&void 0!==y&&y.call(v,this),this.listeners.push(w),null===(_=this.options)||void 0===_||null===(b=_.afterAddFirstListener)||void 0===b||b.call(_,this));const I={dispose:()=>{this.remove(w)}};return h instanceof TQ?h.add(I):Array.isArray(h)?h.push(I):h instanceof or&&h.register(I),I}remove(n){var o,h,v,y;if(null!==(o=this.options)&&void 0!==o&&null!==(h=o.beforeRemoveListener)&&void 0!==h&&h.call(o,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(v=this.options)||void 0===v||null===(y=v.afterRemoveLastListener)||void 0===y||y.call(v,this));const _=this.listeners.indexOf(n);if(_<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(_,1)}off(n){if(this.isDisposed||!this.listeners)return;const o=this.listeners.findIndex(h=>h.callback===n);o>-1&&this.listeners.splice(o,1)}emit(n){this.listeners&&this.listeners.length&&this.listeners.slice().forEach(o=>{try{o.context?o.callback.call(o.context,n):o.callback(n)}catch(h){}})}}function $o(p,n,o){return{on:(h,v)=>{const y=new e2({beforeAddFirstListener:()=>{p.addEventListener(n,h,v)},afterRemoveLastListener:()=>{p.removeEventListener(n,h)}});o.register(y.on(()=>{})),o.register(y)}}}function Dt(p){const n=p.register(new e2);return{on:(o,h)=>n.on(o,p,h),emit:o=>{n.emit(o)}}}var s5,A_;!function(p){p.core="ddv-core",p.reader="ddv-reader",p.detector="ddv-detector",p.loader="ddv-loader"}(A_||(A_={}));class vn{static get isApple(){return lt(vn,this,EQ)._}static get version(){return _n.CryptoModule.ver}static enableDebugOutput(n,o){n?_n.setLogFunc("logDebug",v=>{var y,_,b;let w=pn(v);w.srcBuffer&&(w.srcBuffer=lt(vn,this,$x).call(this,w.srcBuffer)),null!==(y=w.result)&&void 0!==y&&y.srcBuffer&&(w.result.srcBuffer=lt(vn,this,$x).call(this,w.result.srcBuffer)),null!==(_=w.result)&&void 0!==_&&_.imageData&&(w.result.imageData=lt(vn,this,$x).call(this,w.result.imageData)),null!==(b=w.result)&&void 0!==b&&b.pdfData&&(w.result.pdfData=lt(vn,this,$x).call(this,w.result.pdfData)),w.imageData&&(w.imageData=lt(vn,this,$x).call(this,w.imageData)),o&&(Sn(w)&&(w=`[${Date.now()}]${w}`),o(w))}):_n.setLogFunc("",void 0)}static getMemoryUsed(){return Cr.Instance.getMemoryUsed()}static get heapConfig(){return _n.HeapConfig}static updateHeapConfig(n,o,h){_n.UpdateHeapConfig(n,o,h),lt(vn,this,P_)._[n]||(lt(vn,this,P_)._[n]={}),o&&(lt(vn,this,P_)._[n].maxHeapSize=o),h&&(lt(vn,this,P_)._[n].initHeapSize=h)}static getLicenseInfo(n,o,h){var v=this;return Fe(function*(){v.Init(n,o,h),o&&(yield Cr.Instance.loadModule(_n.CryptoModule)),yield Cr.Instance.loadModule(_n.ImageIOModule),yield oo.updateLicense(lt(vn,v,qx)._,lt(vn,v,a5)._,lt(vn,v,t2)._);const y=new VJ(lt(vn,v,qx)._);try{return yield y.getLicenseInfo()}finally{y.terminate()}})()}static Init(n,o,h){var v;qx._=lt(vn,this,null!=n?n:lt(vn,this,qx)._),void 0!==o&&(a5._=lt(vn,this,o?1:0)),t2._=lt(vn,this,null!=h?h:lt(vn,this,t2)._);const y={bMac:"Mac"===fl.OS,biPhone:"iPhone"===fl.OS,biPad:"iPad"===fl.OS};EQ._=lt(vn,this,y.bMac||y.biPhone||y.biPad),_n.NavInfo=y,_n.License=lt(vn,this,qx)._,_n.UUID=lt(vn,this,t2)._,_n.LicMode=lt(vn,this,a5)._,lt(vn,this,IQ).call(this),_n.UpdateHeapConfig(A_.detector,null!==(v=lt(vn,this,UEe).call(this,A_.detector))&&void 0!==v?v:100)}static isResourceDirValid(){var n=arguments,o=this;return Fe(function*(){let h=n.length>0&&void 0!==n[0]?n[0]:3,v=n.length>1&&void 0!==n[1]?n[1]:1e3;lt(vn,o,IQ).call(o);let y=0;for(;y<h;){try{const _=_n.PdfReaderModule;if(lt(vn,o,DQ)._===_.script)return!0;const b=Ke({},_.fetchOptions);if(b.method="HEAD",(yield fetch(_.script,b)).ok)return DQ._=lt(vn,o,_.script),!0}catch(_){}yield new Promise(_=>setTimeout(_,v)),y+=1}return!1})()}static loadPdfReader(n,o,h){var v=this;return Fe(function*(){return v.Init(n,o,h),lt(vn,v,Vl)._||(yield Cr.Instance.loadModule(_n.ImageProcModule),Vl._=lt(vn,v,Cr.Instance.loadModule(_n.PdfReaderModule)),yield lt(vn,v,Vl)._),lt(vn,v,Vl)._})()}static loadMain(n,o,h){var v=this;return Fe(function*(){return v.Init(n,o,h),lt(vn,v,$u)._||($u._=lt(vn,v,Cr.Instance.loadModule(_n.ImagecoreModule)),yield lt(vn,v,$u)._,Cr.Instance.loadModule(_n.ImageProcModule)),lt(vn,v,$u)._})()}static load(n,o,h){var v=this;return Fe(function*(){Cr.Instance.terminate(!0),v.Init(n,o,h),yield v.loadMain(n,o,h)})()}static preloadModule(n){var o=this;return Fe(function*(){let h;const v=Ke({},_n.PdfReaderModule),y=Ke({},_n.ImageProcModule);switch(n){case"core":if(lt(vn,o,$u)._){h=lt(vn,o,$u)._;break}$u._=lt(vn,o,Cr.Instance.loadModule(_n.ImagecoreModule)),h=lt(vn,o,$u)._,yield lt(vn,o,$u)._;break;case"pdf":case"proc":if(lt(vn,o,Vl)._){h=lt(vn,o,Vl)._;break}y.workerName=A_.loader,Vl._=lt(vn,o,Cr.Instance.loadModule(y)),h=lt(vn,o,Vl)._,yield lt(vn,o,Vl)._,v.workerName=A_.loader,Vl._=lt(vn,o,Cr.Instance.loadModule(v)),h=lt(vn,o,Vl)._,yield lt(vn,o,Vl)._,Cr.Instance.terminateWorker(v.workerName)}return h})()}static unloadMainWorker(){$u._=lt(vn,this,void 0),Cr.Instance.terminateWorker(_n.ImageIOModule.workerName)}static unloadPdfReaderWorker(){Vl._=lt(vn,this,void 0),Cr.Instance.terminateWorker(_n.PdfReaderModule.workerName)}static unloadDocumentDetectorWorker(){Cr.Instance.terminateWorker(_n.DetectorModule.workerName)}static unloadWorker(){var n=this;return Fe(function*(){$u._=lt(vn,n,void 0),Vl._=lt(vn,n,void 0),yield Cr.Instance.terminate(!0)})()}static unload(){var n=this;return Fe(function*(){Cr.unload(),_n.unload(),oo.unload(),$u._=lt(vn,n,void 0),Vl._=lt(vn,n,void 0);try{yield Cr.Instance.terminate(!0)}catch(o){}})()}static getUseSimd(){if(this.enableSimd){var n;const o=navigator;if(null!==(n=o.userAgentData)&&void 0!==n&&n.brands)for(const{brand:h,version:v}of o.userAgentData.brands)if(h&&("Chromium"===h||"Google Chrome"===h)&&v&&parseInt(v,10)>=94)return!0}return!1}static getPdfFonts(){return HE.getPdfFonts()}static getPdfInfo(n,o){return Fe(function*(){let h;try{h=new HE;const v=yield h.getPdfInfo({fileSource:n,password:o});return h.destroy(),v}catch(v){return null}finally{h&&h.destroy()}})()}}function $x(p){return p instanceof ArrayBuffer?{type:"ArrayBuffer",length:p.byteLength}:p instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:p.byteLength}:{type:Object.prototype.toString.call(p)}}function UEe(p){return void 0!==lt(s5,this,P_)._[p]?lt(s5,this,P_)._[p].maxHeapSize:null}function IQ(){_n.UseSimd=!!this.enableSimd&&this.getUseSimd();const p={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:_n.UseSimd,fetchOptions:this.fetchOptions};p.workerScript=_n.ImageIOWorkerJS,_n.ImageIOResource=p;const n=Ke({},p);n.workerScript=_n.ImageIOWorkerJS,_n.PdfReaderResource=n}s5=vn,W(vn,"resourceDir","");var qx={_:""},a5={_:pp.LONG_KEY},t2={_:""};W(vn,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),W(vn,"enableSimd",!0);var Er,Va,n2,Vl={_:void 0},$u={_:void 0},EQ={_:!1},DQ={_:void 0},P_={_:Object.create(null)};class Kg{constructor(){W(this,"processor",void 0),this.processor=new PEe}initImage(n){var o=this;return Fe(function*(){return o.processor.initImage(n.source,n.isRGBA,n.width,n.height,n.isBGRA)})()}getImage(n){var o=this;return Fe(function*(){return yield o.processor.getImage(n.jpegQuality,n.ifDeleteObject,n.isRGBA,n.bitDepth,n.xDpi,n.yDpi,n.returnBlob,n.returnType,vn.isApple)})()}getImageInfo(){var n=this;return Fe(function*(){return yield n.processor.getImageInfo()})()}freeReservedData(){var n=this;return Fe(function*(){n.processor.freeReservedData()})()}toBinaryLevel(n,o){var h=this;return Fe(function*(){return h.processor.toBinaryLevel(n,o)})()}toGrayscale(n){var o=this;return Fe(function*(){return o.processor.toGrayscale(n)})()}removeShadowLevel(n,o){var h=this;return Fe(function*(){return h.processor.removeShadowLevel(n,o)})()}brighten(){var n=this;return Fe(function*(){return n.processor.brighten()})()}invert(){var n=this;return Fe(function*(){return n.processor.invert()})()}changeBrightnessAndContrast(n,o){var h=this;return Fe(function*(){return h.processor.changeBrightnessAndContrast(n,o)})()}perspective(n){var o=this;return Fe(function*(){return o.processor.perspective(n[0][0],n[0][1],n[1][0],n[1][1],n[2][0],n[2][1],n[3][0],n[3][1])})()}getSkewAngle(n){var o=this;return Fe(function*(){return o.processor.getSkewAngle(n)})()}rotate(n){var o=this;return Fe(function*(){return o.processor.rotate(n.angle,n.fillColor,n.keepSize,n.mode)})()}flip(){var n=this;return Fe(function*(){return n.processor.flip()})()}resize(n,o,h){var v=this;return Fe(function*(){return v.processor.resize(n,o,h)})()}resizeWidth(n,o){var h=this;return Fe(function*(){return h.processor.setImageWidth(n,o)})()}resizeHeight(n,o){var h=this;return Fe(function*(){return h.processor.setImageHeight(n,o)})()}crop(n){var o=this;return Fe(function*(){return o.processor.crop(n.left,n.top,n.left+n.width,n.top+n.height)})()}erase(n,o){var h=this;return Fe(function*(){return h.processor.erase(n.left,n.top,n.left+n.width,n.top+n.height,o)})()}setDpi(n){var o=this;return Fe(function*(){return o.processor.setDPI(n.rawResolutionX,n.rawResolutionY,n.resolutionX,n.resolutionY,n.resample,n.mode)})()}drawQuadrangle(n){var o=this;return Fe(function*(){return o.processor.drawQuadrangle(n.location[0][0],n.location[0][1],n.location[1][0],n.location[1][1],n.location[2][0],n.location[2][1],n.location[3][0],n.location[3][1],n)})()}filter(n,o,h){var v=this;return Fe(function*(){return v.processor.filter(n,o,h)})()}setImageWidth(n,o){var h=this;return Fe(function*(){return h.processor.setImageWidth(n,o)})()}setImageHeight(n,o){var h=this;return Fe(function*(){return h.processor.setImageHeight(n,o)})()}terminate(n){return this.processor.terminate(n)}}class Lv{constructor(){W(this,"reader",void 0),this.reader=new AEe}readImage(n){var o=this;return Fe(function*(){return yield o.reader.readImage(n.source,n.outputType,n.jpegQuality,n.returnBase64,vn.isApple)})()}readImageInfo(n){var o=this;return Fe(function*(){return yield o.reader.readImageInfo(n)})()}cancelReadImage(n,o){this.reader.cancelReadImage(n,o)}readTiffPage(n){var o=this;return Fe(function*(){return yield o.reader.readTiffPage(n.source,n.index,n.outputType,n.returnBase64,vn.isApple)})()}readTiffPageInfo(n,o){var h=this;return Fe(function*(){const{imageInfos:v}=yield h.reader.getTiffPageInfos(n,o);return v})()}getTiffPageCount(n){var o=this;return Fe(function*(){return(yield o.reader.getTiffInfo(n)).pageCount})()}cancelReadTiffPage(n,o){this.reader.cancelReadTiffPage(n,o)}destroy(){var n;null===(n=this.reader)||void 0===n||n.destroy(),this.reader=void 0}}(function(p){p[p.RGBA=1]="RGBA",p[p.BGRA=2]="BGRA",p[p.JPEG=3]="JPEG",p[p.PNG=4]="PNG"})(Er||(Er={})),function(p){p[p.IT_DIB=-1]="IT_DIB",p[p.IT_RGBA=-2]="IT_RGBA",p[p.IT_BGRA=-3]="IT_BGRA",p[p.IT_BMP=0]="IT_BMP",p[p.IT_JPG=1]="IT_JPG",p[p.IT_PNG=3]="IT_PNG",p[p.IT_ALL=5]="IT_ALL"}(Va||(Va={})),function(p){p[p.RT_AUTO=-1]="RT_AUTO",p[p.RT_BINARY=1]="RT_BINARY",p[p.RT_BASE64=2]="RT_BASE64"}(n2||(n2={}));class AQ{constructor(){W(this,"writer",void 0),this.writer=new VJ}terminate(){var n;null===(n=this.writer)||void 0===n||n.terminate(),this.writer=void 0}createTiff(){return this.writer.createTiff()}addTiffTag(n,o,h){return this.writer.addTag(n,o,h)}appendImage(n,o){var h=this;return Fe(function*(){var v;return o=null!==(v=o)&&void 0!==v?v:{},yield h.writer.appendImage(n,o.inputType,o.tiffFormat,o.jpegQuality,o.is1Bit)})()}getTiff(){var n=this;return Fe(function*(){return(yield n.writer.getTiff(n2.RT_BINARY)).imageData})()}saveImage(n,o){var h=this;return Fe(function*(){var v;return o=null!==(v=o)&&void 0!==v?v:{},(yield h.writer.saveImage(n,o.outputType,o.jpegQuality,o.returnType)).imageData})()}}class i2{constructor(){W(this,"reader",void 0),this.reader=new HE}initFonts(n){var o;const h=null==n||null===(o=n.renderOptions)||void 0===o?void 0:o.fonts;if(h)for(const v of h)v.name&&v.data&&i2.addPdfFont(v.name,v.data)}static addPdfFont(n,o){HE.addPdfFont(n,o)}readPageImageInfos(n){var o=this;return Fe(function*(){yield o.initFonts(n.readOptions);const{imageInfos:h}=yield o.reader.readPageImageInfos(n.source,n.indices,n.readOptions,n.outputType,n.isInfoOnly,n.returnBase64,vn.isApple);return h})()}readPage(n){var o=this;return Fe(function*(){return yield o.initFonts(n.readOptions),yield o.reader.readPageEx(n.source,n.index,n.readOptions,n.outputType,n.isInfoOnly,n.returnBase64,vn.isApple)})()}cancelReadPage(n,o){this.reader.cancelReadPage(n,o)}getPdfPageCount(n,o){var h=this;return Fe(function*(){return yield h.initFonts(o),(yield h.reader.getPdfInfo(n)).PdfCount})()}readAnnotations(n,o){var h=this;return Fe(function*(){const{annot:{annots:v}}=yield h.reader.readPageAnnot(n,o);return v})()}destroy(){this.reader.destroy(),this.reader=null}}class PQ{constructor(){W(this,"writer",void 0),this.writer=new REe}terminate(){var n;null===(n=this.writer)||void 0===n||n.terminate(),this.writer=null}initPdfSetting(n){var o=this;return Fe(function*(){return o.writer.initPdfSetting(n)})()}insertBlankPage(n,o,h){var v=this;return Fe(function*(){return v.writer.insertBlankPage(n,o,h)})()}appendPage(n,o){var h=this;return Fe(function*(){return h.writer.appendPage(n,o)})()}addImageToPages(n,o,h,v,y){var _=this;return Fe(function*(){return _.writer.pageAddImage(n,o,h,v,y)})()}mergeRawPdfPages(n,o,h){var v=this;return Fe(function*(){return v.writer.mergePdf(n,o,h)})()}setPageRotation(n,o){var h=this;return Fe(function*(){return h.writer.pageSetRotation(n,o)})()}clearPageObjects(n){var o=this;return Fe(function*(){return o.writer.pageClearObjects(n)})()}setPageCropBox(n,o,h,v,y){var _=this;return Fe(function*(){return _.writer.pageSetCropBox(n,o,h,v,y)})()}setPageMediaBox(n,o,h,v,y){var _=this;return Fe(function*(){return _.writer.pageSetMediaBox(n,o,h,v,y)})()}setPageAnnotations(n,o){var h=this;return Fe(function*(){return h.writer.pageSetAnnot(n,o)})()}addAnnotationsToPage(n,o){var h=this;return Fe(function*(){return h.writer.pageAddAnnot(n,o)})()}deletePageAnnotationsByTypes(n,o){var h=this;return Fe(function*(){return h.writer.pageDeleteAnnotByTypes(n,o)})()}deletePageAnnotations(n){var o=this;return Fe(function*(){return o.writer.pageDeleteAnnot(n)})()}flattenPage(n,o){var h=this;return Fe(function*(){return h.writer.pageFlatten(n,o)})()}getPdf(n){var o=this;return Fe(function*(){return(yield o.writer.writePdf(n)).pdfData})()}getFontInfo(n){var o=this;return Fe(function*(){return yield o.writer.GetFontInfo(n)})()}ifFontsExist(n){var o=this;return Fe(function*(){return(yield o.writer.IfFontsExist(n)).fontsExist})()}}class RQ{constructor(n){W(this,"items",[]),n&&(this.items=n)}push(n){this.items.push(n)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(n){"filter"===n.api&&this.items.forEach((o,h)=>{o.api===n.api&&o.params[0]===n.params[0]&&o.params[1]===n.params[1]&&o.params[2]===n.params[2]&&this.items.splice(h,1).forEach(v=>{null==v||v.resolve(null)})})}}const Kx={[Er.BGRA]:Va.IT_BGRA,[Er.RGBA]:Va.IT_RGBA,[Er.PNG]:Va.IT_PNG,[Er.JPEG]:Va.IT_JPG},VEe={[Va.IT_BGRA]:Er.BGRA,[Va.IT_RGBA]:Er.RGBA,[Va.IT_PNG]:Er.PNG,[Va.IT_JPG]:Er.JPEG},jn={displayResolution:96,dataResolution:72,pdfResolution:72,enableResolution:!0,autoReleaseImg:rr(),autoReleaseBlob:!0};class kQ{constructor(){W(this,"db",void 0),this.db=new Map}has(n){throw new Error("Method not implemented.")}save(n){throw new Error("Method not implemented.")}getSaverConstructor(n){return this.db.get(n)}setSaverConstructor(n,o){this.db.set(n,o)}deleteSaverConstructor(n){this.db.delete(n)}clear(){this.db.clear()}}const l5=new kQ,jEe=new kQ,HEe=new class{constructor(p,n){W(this,"saverConstructorRepo",void 0),W(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=p,this.customSaverConstructorRepo=n}execute(p){let n=this.customSaverConstructorRepo.getSaverConstructor(p);return n||(n=this.saverConstructorRepo.getSaverConstructor(p)),new n}}(l5,jEe),GEe=new class{constructor(p){W(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){let{mime:n,saverConstructor:o}=p;this.saverConstructorRepo.setSaverConstructor(n,o)}}(l5),zEe=new class{constructor(p){W(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=p}execute(p){this.saverConstructorRepo.deleteSaverConstructor(p)}}(l5);var bp,xp,No,$h;(function(p){p.TIFF_AUTO="tiff/auto",p.TIFF_FAX3="tiff/fax3",p.TIFF_FAX4="tiff/fax4",p.TIFF_LZW="tiff/lzw",p.TIFF_JPEG="tiff/jpeg"})(bp||(bp={})),function(p){p.PDF_AUTO="pdf/auto",p.PDF_FAX4="pdf/fax4",p.PDF_LZW="pdf/lzw",p.PDF_JPEG="pdf/jpeg",p.PDF_JP2000="pdf/jp2000",p.PDF_JBIG2="pdf/jbig2"}(xp||(xp={})),function(p){p.PAGE_DEFAULT="page/default",p.PAGE_A4="page/a4",p.PAGE_A4_REVERSE="page/a4reverse",p.PAGE_A3="page/a3",p.PAGE_A3_REVERSE="page/a3reverse",p.PAGE_LETTER="page/letter",p.PAGE_LETTER_REVERSE="page/letterreverse",p.PAGE_LEGAL="page/legal",p.PAGE_LEGAL_REVERSE="page/legalreverse"}(No||(No={})),function(p){p.PRINT="print",p.MODIFY_CONTENTS="modify_contents",p.COPY_CONTENTS="copy_contents",p.EXTRACT_CONTENTS="extract_contents",p.MODIFY_ANNOTATIONS="modify_annotations",p.FILL_IN="fill_in",p.ASSEMBLY="assembly",p.DEGRADED_PRINT="degraded_print"}($h||($h={}));const c5=new Map([[No.PAGE_DEFAULT,0],[No.PAGE_A4,2],[No.PAGE_A4_REVERSE,3],[No.PAGE_A3,4],[No.PAGE_A3_REVERSE,5],[No.PAGE_LETTER,6],[No.PAGE_LETTER_REVERSE,7],[No.PAGE_LEGAL,8],[No.PAGE_LEGAL_REVERSE,9]]),u5=new Map([[xp.PDF_AUTO,0],[xp.PDF_FAX4,2],[xp.PDF_LZW,3],[xp.PDF_JPEG,5],[xp.PDF_JP2000,6],[xp.PDF_JBIG2,7]]),r2=new Map([[bp.TIFF_AUTO,0],[bp.TIFF_FAX3,1],[bp.TIFF_FAX4,2],[bp.TIFF_LZW,3],[bp.TIFF_JPEG,5]]);var qo=new WeakMap,qh=new WeakMap,Jg=new WeakMap;class YEe{constructor(){bi(this,qo,void 0),bi(this,qh,void 0),bi(this,Jg,void 0),Wn(qo,this,new PQ),Wn(qh,this,new Map)}destroy(){var n;null===(n=Xe(qo,this))||void 0===n||n.terminate(),Wn(qo,this,void 0)}convertPageSize(n,o){let h=0,v=0,y=0,_=0,b=0,w=0,I=0,A=0;const{pdfResolution:M,displayResolution:F}=jn;switch(n){case No.PAGE_A4:y=210/25.4*M,_=297/25.4*M,I=y,w=_;break;case No.PAGE_A4_REVERSE:y=297/25.4*M,_=210/25.4*M,I=y,w=_;break;case No.PAGE_A3:y=297/25.4*M,_=420/25.4*M,I=y,w=_;break;case No.PAGE_A3_REVERSE:y=420/25.4*M,_=297/25.4*M,I=y,w=_;break;case No.PAGE_LETTER:y=8.5*M,_=11*M,I=y,w=_;break;case No.PAGE_LETTER_REVERSE:y=11*M,_=8.5*M,I=y,w=_;break;case No.PAGE_LEGAL:y=8.5*M,_=14*M,I=y,w=_;break;case No.PAGE_LEGAL_REVERSE:y=14*M,_=8.5*M,I=y,w=_;break;default:h=o.mediaBox.left/F*M,v=o.mediaBox.top/F*M,y=o.mediaBox.width/F*M,_=o.mediaBox.height/F*M,b=o.cropBox.left/F*M,w=2*v+_-o.cropBox.top/F*M,I=b+o.cropBox.width/F*M,A=w-o.cropBox.height/F*M}return{left:h,top:v,width:y,height:_,cropLeft:b,cropTop:w,cropRight:I,cropBottom:A}}convertPdfSettings(n){const o={};return o.author=null==n?void 0:n.author,o.compression=null!=n&&n.compression?u5.get(n.compression):void 0,o.creationDate=null==n?void 0:n.creationDate,o.creator=null==n?void 0:n.creator,o.keyWords=null==n?void 0:n.keyWords,o.modifiedDate=null==n?void 0:n.modifiedDate,o.pageType=null!=n&&n.pageType?c5.get(n.pageType):void 0,o.producer=null==n?void 0:n.producer,o.quality=null==n?void 0:n.quality,o.subject=null==n?void 0:n.subject,o.title=null==n?void 0:n.title,o.version=null==n?void 0:n.version,null!=n&&n.password&&(o.encryptOptions={},o.encryptOptions.enabled=!0,o.encryptOptions.userPassword=n.password),o}init(n){var o=this;return Fe(function*(){Wn(Jg,o,n||{});const h=o.convertPdfSettings(n);yield Xe(qo,o).initPdfSetting(h)})()}appendImagePage(n,o){var h=this;return Fe(function*(){const{mediaBox:v}=o,y=h.convertPageSize(Xe(Jg,h).pageType,o);let _=yield Xe(qo,h).insertBlankPage(-1,y.left+y.width,y.top+y.height);const{pageIndex:b}=_;yield Xe(qo,h).setPageMediaBox(b,y.left,y.top,y.left+y.width,y.top+y.height),o.rotation&&(yield Xe(qo,h).setPageRotation(b,o.rotation));const{displayResolution:w,pdfResolution:I}=jn;let A=y.width,M=y.height,F=0,V=0;if(Xe(Jg,h).pageType&&Xe(Jg,h).pageType!==No.PAGE_DEFAULT){const Z={width:v.width/w*I,height:v.height/w*I},re=y.width/Z.width,se=y.height/Z.height;if(re<se){const ce=Z.height*re;V=(y.height-ce)/2,A=y.width,M=ce}else{const ce=Z.width*se;F=(y.width-ce)/2,A=ce,M=y.height}Xe(qh,h).set(b,[A/Z.width,0,0,M/Z.height,F,V])}F+=y.left,V+=y.top;let B=o.width,Q=o.height,J=n;if(Xe(Jg,h).imageScaleFactor){let Z=Math.floor(o.width*Xe(Jg,h).imageScaleFactor+.5),re=Math.floor(o.height*Xe(Jg,h).imageScaleFactor+.5);if(Z<1&&(Z=1),re<1&&(re=1),Z!==B&&re!==Q){const se=new Kg;yield se.initImage({source:n}),yield se.resize(Z,re),J=(yield se.getImage({})).imageData,B=Z,Q=re,yield se.freeReservedData()}}return _=yield Xe(qo,h).addImageToPages(J,[b],{type:"image",imageWidth:A,imageHeight:M,position:[F,V]},B,Q),yield Xe(qo,h).setPageCropBox(b,y.cropLeft,y.cropBottom,y.cropRight,y.cropTop),_})()}appendRawPdfPages(n,o,h){var v=this;return Fe(function*(){yield Xe(qo,v).mergeRawPdfPages(n,o,h)})()}changePageImage(n,o,h){var v=this;return Fe(function*(){const y=v.convertPageSize(No.PAGE_DEFAULT,h);return yield Xe(qo,v).clearPageObjects(n),yield Xe(qo,v).addImageToPages(o,[n],{type:"image",imageWidth:y.width,imageHeight:y.height,position:[y.left,y.top]},h.width,h.height)})()}setPageInfo(n){var o=this;return Fe(function*(){for(const[h,v]of n){const y=o.convertPageSize(No.PAGE_DEFAULT,v),{rotation:_}=v;yield Xe(qo,o).setPageCropBox(h,y.cropLeft,y.cropBottom,y.cropRight,y.cropTop),yield Xe(qo,o).setPageRotation(h,(_%360+360)%360)}})()}setPageRotation(n){var o=this;return Fe(function*(){for(const[h,v]of n){const y=(v%360+360)%360;yield Xe(qo,o).setPageRotation(h,y)}})()}getPdf(n){var o=this;return Fe(function*(){return Xe(qo,o).getPdf(n)})()}updateAnnotPoint(n,o){return[n[0]*o[0]+n[1]*o[2]+o[4],n[0]*o[1]+n[1]*o[3]+o[5]]}fixAnnotationPosition(n,o){Xe(qh,this).has(n)&&o.forEach(h=>{const v=this.updateAnnotPoint([h.rect[0],h.rect[1]],Xe(qh,this).get(n)),y=this.updateAnnotPoint([h.rect[2],h.rect[3]],Xe(qh,this).get(n));h.rect=[v[0],v[1],y[0],y[1]],"Highlight"!==h.type&&"StrikeOut"!==h.type&&"Underline"!==h.type&&"Squiggly"!==h.type||h.quadPoints.forEach(_=>{const b=this.updateAnnotPoint([_[0],_[1]],Xe(qh,this).get(n)),w=this.updateAnnotPoint([_[2],_[3]],Xe(qh,this).get(n)),I=this.updateAnnotPoint([_[4],_[5]],Xe(qh,this).get(n)),A=this.updateAnnotPoint([_[6],_[7]],Xe(qh,this).get(n));_=[b[0],b[1],w[0],w[1],I[0],I[1],A[0],A[1]]})})}removePageAnnotations(n){var o=this;return Fe(function*(){yield Xe(qo,o).deletePageAnnotationsByTypes(n,"")})()}setPageAnnotations(n,o,h){var v=this;return Fe(function*(){let y;return o&&o.length>0&&v.fixAnnotationPosition(n,o),h?o&&o.length>0&&(y=yield Xe(qo,v).addAnnotationsToPage(n,o)):y=yield Xe(qo,v).setPageAnnotations(n,o),y})()}flattenPage(n){var o=this;return Fe(function*(){return yield Xe(qo,o).flattenPage(n)})()}getFontInfo(n){var o=this;return Fe(function*(){return yield Xe(qo,o).getFontInfo(n)})()}ifFontsExist(n){var o=this;return Fe(function*(){return yield Xe(qo,o).ifFontsExist(n)})()}}class MQ{constructor(){W(this,"imageWriter",void 0),this.imageWriter=new AQ}destroy(){var n;null===(n=this.imageWriter)||void 0===n||n.terminate(),this.imageWriter=void 0}save(n){var o=arguments,h=this;return Fe(function*(){let v=o.length>1&&void 0!==o[1]?o[1]:{};return yield h.imageWriter.saveImage(n,{outputType:v.outputType,jpegQuality:v.jpegQuality,returnType:v.returnType})})()}}class XEe{constructor(){W(this,"imageWriter",void 0),W(this,"tiffCompression",void 0),W(this,"tiffQuality",void 0),this.imageWriter=new AQ,this.tiffCompression=r2.get(bp.TIFF_AUTO)}destroy(){var n;null===(n=this.imageWriter)||void 0===n||n.terminate(),this.imageWriter=void 0}init(n){var o=this;return Fe(function*(){if(yield o.imageWriter.createTiff(),n&&(o.tiffQuality=n.quality,n.compression&&(o.tiffCompression=r2.get(n.compression)),n.customTag))for(let h=0;h<n.customTag.length;h++)yield o.imageWriter.addTiffTag(n.customTag[h].id,n.customTag[h].content,n.customTag[h].contentIsBase64)})()}appendPage(n){var o=this;return Fe(function*(){yield o.imageWriter.appendImage(n,{inputType:void 0,tiffFormat:o.tiffCompression,jpegQuality:o.tiffQuality})})()}getTiff(){var n=this;return Fe(function*(){return n.imageWriter.getTiff()})()}}class R_{constructor(n){W(this,"uid",void 0),this.uid=n||Ai()}equals(n){return null!=n&&void 0!==n&&(this===n||!!(n instanceof R_)&&this.uid===n.uid)}}class $Ee extends R_{}let jl=class{constructor(p){W(this,"type",void 0),W(this,"uid",void 0),this.type=p,this.uid=Ai()}};class Jx{constructor(n){W(this,"bubbles",!0),W(this,"cancelBubble",!0),W(this,"cancelable",!1),W(this,"composed",!1),W(this,"currentTarget",void 0),W(this,"defaultPrevented",!1),W(this,"eventPhase",Jx.prototype.NONE),W(this,"isTrusted",void 0),W(this,"returnValue",void 0),W(this,"srcElement",void 0),W(this,"target",void 0),W(this,"timeStamp",void 0),W(this,"type",void 0),W(this,"detail",void 0),W(this,"view",void 0),W(this,"which",void 0),W(this,"path",void 0),W(this,"immediatePropagationStopped",!1),W(this,"propagationStopped",!1),W(this,"nativeEvent",void 0),W(this,"originalEvent",void 0),W(this,"eventService",void 0),W(this,"NONE",0),W(this,"CAPTURING_PHASE",1),W(this,"AT_TARGET",2),W(this,"BUBBLING_PHASE",3),this.eventService=n}initUIEvent(n,o,h,v,y){}composedPath(){const{path:n,eventService:o,target:h}=this;return!o||n&&n[this.path.length-1]===h||(this.path=h?o.getPropagationPath(h):[]),this.path}bindEvents(n,o,h){}preventDefault(){const{nativeEvent:n}=this;n instanceof Event&&n.cancelable&&n.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.immediatePropagationStopped=!0}stopPropagation(){this.propagationStopped=!0}}function Qx(p,n){n.isTrusted=p.isTrusted,n.srcElement=p.srcElement,n.timeStamp=performance.now(),n.type=p.type,n.detail=p.detail,n.view=p.view,n.which=p.which}class Qg extends Jx{constructor(n,o){super(null),this.type=n,this.detail=o}}class OQ{constructor(){W(this,"pubsub",Yh.create())}addEventListener(n,o,h){let v,y=As(h)&&h;Vn(h)&&(y=h.capture,v=h.once),n=y?`${n}:capture`:n,o=I_(o)?o:o.handleEvent,this.pubsub.on(n,o,this,v)}dispatchEvent(n){const o=this.ownerDocument||this.document;var h;return o&&(n.eventService=(null===(h=o.defaultView)||void 0===h?void 0:h.eventService)||null,n.defaultPrevented=!1,n.path=[],n.target=this,Sa(n)),!n.defaultPrevented}removeEventListener(n,o,h){let v=As(h)&&h;Vn(h)&&(v=h.capture),n=v?`${n}:capture`:n,o=I_(o)?o:o.handleEvent,this.pubsub.off(n,o)}removeAllEventListeners(){this.pubsub.removeAllEventListeners()}getAllEvents(){return this.pubsub.getAllEvents()}}function Zc(p,n){const o=p.currentTarget.getAllEvents()[n]||[];for(let h=0,v=o.length;h<v;h++){if(p.immediatePropagationStopped)return;const{context:y,fn:_}=o[h];_.call(y,p)}}function Sa(p,n){var o;if(n=null!==(o=n)&&void 0!==o?o:p.type,p.propagationStopped=!1,p.immediatePropagationStopped=!1,!p.target)return;const h=p.composedPath(),v=h.length;p.eventPhase=p.CAPTURING_PHASE;for(let y=0;y<v-1;y++)if(p.currentTarget=h[y],Zc(p,`${n}:capture`),d5(p))return;if(p.eventPhase=p.AT_TARGET,p.currentTarget=p.target,Zc(p,n),!d5(p)){p.eventPhase=p.BUBBLING_PHASE;for(let y=v-2;y>=0;y--)if(p.currentTarget=h[y],Zc(p,n),d5(p))return}}function d5(p){return p.propagationStopped||p.immediatePropagationStopped}const k_=p=>p/180*Math.PI,o2=p=>p/Math.PI*180;class Zg{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),W(this,"w",void 0),this.x=n,this.y=o,this.z=h,this.w=v}static fromQuat(n){return(new Zg).setFromQuat(n)}static fromEuler(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n=k_(n)/2,o=k_(o)/2,h=k_(h)/2;const v=Math.sin(n),y=Math.cos(n),_=Math.sin(o),b=Math.cos(o),w=Math.sin(h),I=Math.cos(h),A=new Zg;return A.setFromQuat({x:v*b*I-y*_*w,y:y*_*I+v*b*w,z:y*b*w-v*_*I,w:y*b*I+v*_*w}),A}clone(){const n=new Zg;return n.setFromQuat(this),n}setFromQuat(n){var o,h,v,y;const _=this;return _.x=null!==(o=n.x)&&void 0!==o?o:0,_.y=null!==(h=n.y)&&void 0!==h?h:0,_.z=null!==(v=n.z)&&void 0!==v?v:0,_.w=null!==(y=n.w)&&void 0!==y?y:1,this}toEuler(){const{x:n,y:o,z:h,w:v}=this,y=.4990234375,_=this.w*this.y-this.x*this.z;if(_<-y||_>y){const b=Math.sign(_);return{z:-2*b*Math.atan2(this.x,this.w),y:b*(Math.PI/2),x:0}}return{x:o2(Math.atan2(2*(o*h+v*n),v*v-n*n-o*o+h*h)),y:o2(Math.asin(-2*(n*h-v*o))),z:o2(Math.atan2(2*(n*o+v*h),v*v+n*n-o*o-h*h))}}invert(){const{x:n,y:o,z:h,w:v}=this,y=n*n+o*o+h*h+v*v,_=y?1/y:0;return this.x=-n*_,this.y=-o*_,this.z=-h*_,this.w=v*_,this}multiply(n){const{x:o,y:h,z:v,w:y}=this,{x:_,y:b,z:w,w:I}=n;return this.x=o*I+y*_+h*w-v*b,this.y=h*I+y*b+v*_-o*w,this.z=v*I+y*w+o*b-h*_,this.w=y*I-o*_-h*b-v*w,this}normalize(){const{x:n,y:o,z:h,w:v}=this,y=n*n+o*o+h*h+v*v;return this.x/=y,this.y/=y,this.z/=y,this.w/=y,this}}function s2(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return $t(p)?new Zg(p,n,o,h):Zg.fromQuat(p)}function a2(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Zg.fromEuler(p,n,o)}class zs{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),this.x=n,this.y=o,this.z=h}static fromPoint(n){return new zs(n.x,n.y,n.z)}static fromTwoPoint(n,o){var h,v,y,_,b,w;return new zs((null!==(h=o.x)&&void 0!==h?h:0)-(null!==(v=n.x)&&void 0!==v?v:0),(null!==(y=o.y)&&void 0!==y?y:0)-(null!==(_=n.y)&&void 0!==_?_:0),(null!==(b=o.z)&&void 0!==b?b:0)-(null!==(w=n.z)&&void 0!==w?w:0))}static fromValue(n,o,h){return new zs(n,o,h)}setFromVector(n){var o;this.x=n.x,this.y=n.y,this.z=null!==(o=n.z)&&void 0!==o?o:0}clone(){return new zs(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(n){var o;return this.x*n.x+this.y*n.y+this.z*(null!==(o=n.z)&&void 0!==o?o:0)}projectionTo(n){const o=Math.hypot(n.x,n.y,n.z);return this.dot(n)/o}angle(n){const o=this.norm()*Math.hypot(n.x,n.y,n.z),h=o&&this.dot(n)/o;return Math.acos(Ir(h,-1,1))}equals(n){var o;return this.x===n.x&&this.y===n.y&&this.z===(null!==(o=n.z)&&void 0!==o?o:0)}distance(n){var o;return Math.hypot(this.x-n.x,this.y-n.y,this.z-(null!==(o=n.z)&&void 0!==o?o:0))}lerp(n){var o;let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:v,y,z:_}=this;return new zs(v+h*(n.x-v),y+h*(n.y-y),_+h*((null!==(o=n.z)&&void 0!==o?o:0)-_))}normalize(){const n=this,o=n.norm();return n.x/=o,n.y/=o,n.z/=o,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(n){const o=this;return{x:o.y*n.z-o.z*n.y,y:o.z*n.x-o.x*n.z,z:o.x*n.y-o.y*n.x}}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this}}function Wr(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return $t(p)?zs.fromValue(p,n,o):zs.fromPoint(p)}function FQ(p,n){return zs.fromTwoPoint(p,n)}class Rr{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),this.x=n,this.y=o,this.z=h}static fromPoint(n){return new Rr(n.x,n.y,n.z)}matrixTransform(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:o,y:h,z:v}=this,{m11:y,m21:_,m31:b,m41:w,m12:I,m22:A,m32:M,m42:F,m13:V,m23:B,m33:Q,m43:J,m14:Z,m24:re,m34:se,m44:ce}=n,pe=Z*o+re*h+se*v+ce;return Zx({x:(y*o+_*h+b*v+w)/pe,y:(I*o+A*h+M*v+F)/pe,z:(V*o+B*h+Q*v+J)/pe})}setFromPoint(n){return this.x=n.x||0,this.y=n.y||0,this.z=n.z||0,this}clone(){return Zx(this)}equals(n){const{x:o=0,y:h=0,z:v=0}=n,y=this;return y.x===o&&y.y===h&&y.z===v}distanceTo(n){const{x:o=0,y:h=0,z:v=0}=n,y=this;return Math.hypot(y.x-o,y.y-h,y.z-v)}lerpTo(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:h=0,y:v=0,z:y=0}=n,_=this;return Zx({x:_.x+o*(h-_.x),y:_.y+o*(v-_.y),z:_.z+o*(y-_.z)})}footPointInSegment(n,o){const h=FQ(n,this),v=FQ(n,o),y=v.norm(),_=Zx(n);if(0===y)return _;const b=h.projectionTo(v)/y;return _.lerpTo(o,b)}perpendicularToSegment(n,o){const h=this.footPointInSegment(n,o);return this.distanceTo(h)}}function Zx(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return $t(p)?new Rr(p,n,o):new Rr(p.x,p.y,p.z)}const LQ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class so{constructor(n){if(W(this,"a",1),W(this,"b",0),W(this,"c",0),W(this,"d",1),W(this,"e",0),W(this,"f",0),W(this,"m11",1),W(this,"m12",0),W(this,"m13",0),W(this,"m14",0),W(this,"m21",0),W(this,"m22",1),W(this,"m23",0),W(this,"m24",0),W(this,"m31",0),W(this,"m32",0),W(this,"m33",1),W(this,"m34",0),W(this,"m41",0),W(this,"m42",0),W(this,"m43",0),W(this,"m44",1),W(this,"is2D",void 0),n||(n=LQ),!Sn(n)){if(!Di(n))throw new Error("Matrix4 error.");p5(n,this)}}static fromQuat(n){const{x:o,y:h,z:v,w:y}=n,_=new so;return _.m11=1-2*(h*h+v*v),_.m12=2*(o*h+v*y),_.m13=2*(o*v-h*y),_.m21=2*(o*h-v*y),_.m22=1-2*(o*o+v*v),_.m23=2*(h*v+o*y),_.m31=2*(o*v+h*y),_.m32=2*(h*v-o*y),_.m33=1-2*(o*o+h*h),_.setFromMatrix(_),_}static fromMatrix(n){const o=new so;return o.setFromMatrix(n),o.is2D=!!n.is2D,o}static fromFloat32Array(n){const o=new so;return p5(n,o),o}static fromFloat64Array(n){const o=new so;return p5(n,o),o}get isIdentity(){const n=this.toArray();for(let o=0;o<16;o++)if(n[o]!==LQ[o])return!1;return!0}translate(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(n,o,h)}scale(n,o,h,v,y,_){var b,w,I,A,M;return null!==(b=n)&&void 0!==b||(n=1),null!==(w=o)&&void 0!==w||(o=1),null!==(I=v)&&void 0!==I||(v=0),null!==(A=y)&&void 0!==A||(y=0),null!==(M=_)&&void 0!==M||(_=0),gt(o)&&(o=n),this.clone().scaleSelf(n,o,h,v,y,_)}scale3d(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(n,o,h,v)}rotate(n,o,h){var v;return null!==(v=n)&&void 0!==v||(n=0),this.clone().rotateSelf(n,o,h)}rotateFromVector(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(n,o)}rotateAxisAngle(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(n,o,h,v)}skewX(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(n)}skewY(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(n)}multiply(n){return this.clone().multiplySelf(n)}flipX(){return this.clone().multiplySelf(new so([-1,0,0,1,0,0]))}flipY(){return this.clone().multiplySelf(new so([1,0,0,-1,0,0]))}inverse(){return this.clone().invertSelf()}transformPoint(n){return Zx(n).matrixTransform(this)}toFloat32Array(){const n=this.toArray();return new Float32Array(n)}toFloat64Array(){const n=this.toArray();return new Float64Array(n)}toJSON(){}multiplySelf(){const n=BQ(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(n),this}preMultiplySelf(){const n=BQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(n),this}translateSelf(){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{m11:1,m21:0,m31:0,m41:h,m12:0,m22:1,m32:0,m42:v,m13:0,m23:0,m33:1,m43:y,m14:0,m24:0,m34:0,m44:1}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n);return this.multiplySelf(o),n&&(this.is2D=!1),this}scaleSelf(n,o,h,v,y,_){var b,w,I,A,M;null!==(b=n)&&void 0!==b||(n=1),null!==(w=o)&&void 0!==w||(o=1),null!==(I=v)&&void 0!==I||(v=0),null!==(A=y)&&void 0!==A||(y=0),null!==(M=_)&&void 0!==M||(_=0),(v||y||_)&&this.translateSelf(v,y,_),gt(o)&&(o=n);const F=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{m11:V,m21:0,m31:0,m41:0,m12:0,m22:B,m32:0,m42:0,m13:0,m23:0,m33:Q,m43:0,m14:0,m24:0,m34:0,m44:1}}(n,o,h);return this.multiplySelf(F),this.translateSelf(-v,-y,-_),1!==h&&(this.is2D=!1),this}scale3dSelf(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.scaleSelf(n,n,n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}rotateSelf(n,o,h){var v,y,_;null!==(v=n)&&void 0!==v||(n=0),gt(o)&&gt(h)&&(h=n,n=0,o=0),null!==(y=o)&&void 0!==y||(o=0),null!==(_=h)&&void 0!==_||(h=0),0===n&&0===o||(this.is2D=!1);const b=ew(h,[0,0,1]),w=ew(o,[0,1,0]),I=ew(n,[1,0,0]);return this.multiplySelf(b),this.multiplySelf(w),this.multiplySelf(I),this}rotateFromVectorSelf(){const n=Wr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),o=Wr(1,0),h=ew(n.angle(o),[0,0,1]);return this.multiplySelf(h),this}rotateAxisAngleSelf(){const n=ew(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(n),this}skewXSelf(){const n=WQ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(n),this}skewYSelf(){const n=WQ(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(n),this}invertSelf(){const n=function(o){if(o[0].length!==o.length)throw new Error;const h=f5(o),v=function(y){if(y[0].length!==y.length)throw new Error("Not square matrix.");const _=y.length,b=new Array(_).fill(0).map(w=>new Array(_).fill(0));for(let w=0;w<_;w++)for(let I=0;I<_;I++)b[w][I]=NQ(y,w,I);return function(w){const I=new Array(w.length).fill(0).map(A=>new Array(w[0].length).fill(0));for(let A=0;A<I.length;A++)for(let M=0;M<I[0].length;M++)I[A][M]=w[M][A];return I}(b)}(o);for(let y=0;y<v.length;y++)for(let _=0;_<v.length;_++)v[y][_]/=h;return v}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(n),this}setMatrixValue(n){return new so}setFromMatrix(n){const o=this;o.m11=n.m11,o.m12=n.m12,o.m13=n.m13,o.m14=n.m14,o.m21=n.m21,o.m22=n.m22,o.m23=n.m23,o.m24=n.m24,o.m31=n.m31,o.m32=n.m32,o.m33=n.m33,o.m34=n.m34,o.m41=n.m41,o.m42=n.m42,o.m43=n.m43,o.m44=n.m44,o.a=n.m11,o.b=n.m12,o.c=n.m21,o.d=n.m22,o.e=n.m41,o.f=n.m42,!1===n.is2D&&(o.is2D=!1)}setFromTwoDimensionalArray(n){const[[o,h,v,y],[_,b,w,I],[A,M,F,V],[B,Q,J,Z]]=n;this.setFromMatrix({m11:o,m21:h,m31:v,m41:y,m12:_,m22:b,m32:w,m42:I,m13:A,m23:M,m33:F,m43:V,m14:B,m24:Q,m34:J,m44:Z})}clone(){return so.fromMatrix(this)}determinant(){return f5(this.toTwoDimensionalArray())}toTwoDimensionalArray(){const n=this;return[[n.m11,n.m21,n.m31,n.m41],[n.m12,n.m22,n.m32,n.m42],[n.m13,n.m23,n.m33,n.m43],[n.m14,n.m24,n.m34,n.m44]]}toArray(){const n=this;return[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44]}decompose(){if(0===this.m44)return{};let n=function(M){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return $t(M)?new mQ(M,F,V,B):new mQ(M.x,M.y,M.z,M.w)}(0,0,0,1);const o=s2(0,0,0,1),h=Wr(0,0,0),v=Wr(0,0,0),y=Wr(0,0,0),_=this;_.normalize();const b=_.clone();if(b.m14=0,b.m24=0,b.m34=0,b.m44=1,0===b.determinant())return!1;if(0!==_.m14||0!==_.m24||0!==_.m34){const M={x:_.m14,y:_.m24,z:_.m34,w:_.m44};n=b.invertSelf().transposeSelf().multiplyVector(M)}else n.x=0,n.y=0,n.z=0,n.w=1;y.x=_.m41,y.y=_.m42,y.z=_.m43;const w=[Wr(_.m11,_.m12,_.m13),Wr(_.m21,_.m22,_.m23),Wr(_.m31,_.m32,_.m33)];h.x=w[0].norm(),w[0].normalize(),v.x=w[0].dot(w[1]),w[1]=Wr(h5(w[1],w[0],1,-v.x)),h.y=w[1].norm(),w[1].normalize(),v.x/=h.y,v.y=w[0].dot(w[2]),w[2]=Wr(h5(w[2],w[0],1,-v.y)),v.z=w[1].dot(w[2]),w[2]=Wr(h5(w[2],w[1],1,-v.z)),h.z=w[2].norm(),w[2].normalize(),v.y/=h.z,v.z/=h.z;const I=w[1].cross(w[2]);let A;if(w[0].dot(I)<0&&(h.negate(),w[0].negate(),w[1].negate(),w[2].negate()),o.x=.5*Math.max(1+w[0].x-w[1].y-w[2].z,0)**.5,o.y=.5*Math.max(1-w[0].x+w[1].y-w[2].z,0)**.5,o.z=.5*Math.max(1-w[0].x-w[1].y+w[2].z,0)**.5,o.w=.5*Math.max(1+w[0].x+w[1].y+w[2].z,0)**.5,w[2].y>w[1].z&&(o.x*=-1),w[0].z>w[2].x&&(o.y*=-1),w[1].x>w[0].y&&(o.z*=-1),o.x<.001&&o.x>=0&&o.y<.001&&o.y>=0){const M=Math.atan2(w[0].y,w[0].x);A={x:0,y:0,z:Number(o2(M).toFixed(3))}}else A=o.toEuler();return{rotation:A,scale:h,translation:y,skew:v,quaternion:o,perspective:n}}multiplyVector(n){const o=this,{x:h,y:v,z:y,w:_}=n;return{x:o.m11*h+o.m21*v+o.m31*y+o.m41*_,y:o.m12*h+o.m22*v+o.m32*y+o.m42*_,z:o.m13*h+o.m23*v+o.m33*y+o.m43*_,w:o.m14*h+o.m24*v+o.m34*y+o.m44*_}}transpose(){const n=this.clone();return n.transposeSelf(),n}transposeSelf(){const{m11:n,m21:o,m31:h,m41:v,m12:y,m22:_,m32:b,m42:w,m13:I,m23:A,m33:M,m43:F,m14:V,m24:B,m34:Q,m44:J}=this;return this.setFromMatrix({m11:n,m21:y,m31:I,m41:V,m12:o,m22:_,m32:A,m42:B,m13:h,m23:b,m33:M,m43:Q,m14:v,m24:w,m34:F,m44:J}),this}normalize(){const n=this,o=n.m44;n.m11/=o,n.m12/=o,n.m13/=o,n.m14/=o,n.m21/=o,n.m22/=o,n.m23/=o,n.m24/=o,n.m31/=o,n.m32/=o,n.m33/=o,n.m34/=o,n.m41/=o,n.m42/=o,n.m43/=o,n.m44/=o}getTranslation(){return Wr(this.m41,this.m42,this.m43)}getRotation(){const n=this,o=.5*(n.m11+n.m22+n.m33+1)**.5;return s2(.25*(n.m23-n.m32)/o,.25*(n.m31-n.m13)/o,.25*(n.m12-n.m21)/o,o)}getScaling(){const n=this;return Wr(Math.hypot(n.m11,n.m12,n.m13),Math.hypot(n.m21,n.m22,n.m23),Math.hypot(n.m31,n.m32,n.m33))}toEuler(){const n=this.getRotation().toEuler();return Wr(n.x,n.y,n.z)}}function h5(p,n,o,h){return{x:o*p.x+h*n.x,y:o*p.y+h*n.y,z:o*p.z+h*n.z}}function f5(p){if(p.length!==p[0].length)throw new Error;const n=p.length;let o=0;if(n>3)for(let h=0;h<n;h++)o+=p[0][h]*NQ(p,0,h);else 3===n?o=p[0][0]*p[1][1]*p[2][2]+p[0][1]*p[1][2]*p[2][0]+p[0][2]*p[1][0]*p[2][1]-p[0][2]*p[1][1]*p[2][0]-p[0][1]*p[1][0]*p[2][2]-p[0][0]*p[1][2]*p[2][1]:2===n?o=p[0][0]*p[1][1]-p[0][1]*p[1][0]:1===n&&([[o]]=p);return o}function NQ(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const h=p.length,v=new Array(h-1).fill(0).map(y=>new Array(h-1).fill(0));for(let y=0;y<h-1;y++)for(let _=0;_<h-1;_++)v[y][_]=p[y<n?y:y+1][_<o?_:_+1];return(-1)**(n+o)*f5(v)}function p5(p,n){const[o,h,v,y,_,b,w,I,A,M,F,V,B,Q,J,Z]=p;if(6===p.length)n.m11=o,n.m12=h,n.m21=v,n.m22=y,n.m41=_,n.m42=b,n.m13=0,n.m14=0,n.m23=0,n.m24=0,n.m31=0,n.m32=0,n.m34=0,n.m33=1,n.m44=1,n.is2D=!0;else{if(16!==p.length)throw new Error;n.m11=o,n.m12=h,n.m13=v,n.m14=y,n.m21=_,n.m22=b,n.m23=w,n.m24=I,n.m31=A,n.m32=M,n.m33=F,n.m34=V,n.m41=B,n.m42=Q,n.m43=J,n.m44=Z,n.is2D=!1}}function BQ(p,n){const o={},{m11:h,m21:v,m31:y,m41:_,m12:b,m22:w,m32:I,m42:A,m13:M,m23:F,m33:V,m43:B,m14:Q,m24:J,m34:Z,m44:re}=p,{m11:se,m21:ce,m31:pe,m41:Ce,m12:Ve,m22:te,m32:Me,m42:we,m13:Le,m23:j,m33:L,m43:Y,m14:q,m24:k,m34:N,m44:$}=n;return o.m11=h*se+v*Ve+y*Le+_*q,o.m21=h*ce+v*te+y*j+_*k,o.m31=h*pe+v*Me+y*L+_*N,o.m41=h*Ce+v*we+y*Y+_*$,o.m12=b*se+w*Ve+I*Le+A*q,o.m22=b*ce+w*te+I*j+A*k,o.m32=b*pe+w*Me+I*L+A*N,o.m42=b*Ce+w*we+I*Y+A*$,o.m13=M*se+F*Ve+V*Le+B*q,o.m23=M*ce+F*te+V*j+B*k,o.m33=M*pe+F*Me+V*L+B*N,o.m43=M*Ce+F*we+V*Y+B*$,o.m14=Q*se+J*Ve+Z*Le+re*q,o.m24=Q*ce+J*te+Z*j+re*k,o.m34=Q*pe+J*Me+Z*L+re*N,o.m44=Q*Ce+J*we+Z*Y+re*$,o}function ew(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];p=k_(p);const o=Math.sin(p/2)*Math.cos(p/2),h=Math.sin(p/2)**2,[v,y,_]=n;return{m11:1-2*(y**2+_**2)*h,m21:2*(v*y*h-_*o),m31:2*(v*_*h+y*o),m41:0,m12:2*(v*y*h+_*o),m22:1-2*(v**2+y**2)*h,m32:2*(y*_*h-v*o),m42:0,m13:2*(v*_*h-y*o),m23:2*(y*_*h+v*o),m33:1-2*(v**2+y**2)*h,m43:0,m14:0,m24:0,m34:0,m44:1}}function WQ(p,n){const o=new so;return p&&(o.m21=Math.tan(k_(p))),n&&(o.m12=Math.tan(k_(n))),o}class UQ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;W(this,"x",void 0),W(this,"y",void 0),W(this,"z",void 0),W(this,"w",void 0),this.x=n,this.y=o,this.z=h,this.w=v}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1}normalize(){const n=this.norm();this.x/=n,this.y/=n,this.z/=n,this.w/=n}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}}function l2(p,n,o){const h=p.x-n.x,v=p.y-n.y;let y=(o.x-p.x)*h+(o.y-p.y)*v;return y/=h*h+v*v,new Rr(p.x+y*h,p.y+y*v)}function g5(p,n,o,h){let v=p[0]*(o[1]-n[1])+n[0]*(p[1]-o[1])+o[0]*(n[1]-p[1]),y=p[0]*(h[1]-n[1])+n[0]*(p[1]-h[1])+h[0]*(n[1]-p[1]);return!((v^y)>=0&&0!==v&&0!==y||(v=o[0]*(p[1]-h[1])+h[0]*(o[1]-p[1])+p[0]*(h[1]-o[1]),y=o[0]*(n[1]-h[1])+h[0]*(o[1]-n[1])+n[0]*(h[1]-o[1]),(v^y)>=0&&0!==v&&0!==y))}const qi=new class{recursiveUpdateHierarchy(p){const{transform:n,childNodes:o}=p;n.frozen||(n.frozen=!0,(n.localDirty||n.worldDirty)&&this.updateHierarchy(p),o.forEach(h=>{this.recursiveUpdateHierarchy(h)}))}querySelector(p,n){return p.startsWith("#")?n.find(o=>o.id===p.substring(1)):null}querySelectorAll(p,n){return[]}append(p,n,o){p.parentNode&&this.remove(p),p.parentNode=n;const{childNodes:h,sortable:v}=n;void 0!==o?h.splice(o,0,p):h.push(p),v&&(v.dirty=!0);const{transform:y}=p;y&&this.dirtyWorld(p,y),y.frozen&&this.unfreezeParentToRoot(p)}remove(p){const{parentNode:n}=p;let o=!0;if(!n)return o=!1,o;const{sortable:h}=n;h&&(h.dirty=!0);const{childNodes:v}=n,y=v.indexOf(p);y>-1?(o=!0,v.splice(y,1)):o=!1;const{transform:_}=p;return _&&this.dirtyWorld(p,_),p.parentNode=null,o}isChildExist(p){const{parentNode:n}=p;if(!n)return!1;const{childNodes:o}=n;return!(o.indexOf(p)<0)}setOrigin(p,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;$t(n)&&(n=zs.fromValue(n,o));const{transform:h}=p;h.origin.equals(n)||(h.origin.setFromVector(n),this.dirtyLocal(p,h))}getOrigin(p){return p.transform.origin}setPosition(p,n){const{transform:o}=p,h=zs.fromValue(n.x,n.y,n.z||0),v=this.getPosition(p);if(h.equals(v))return;let y=this.getWorldTransform(p);const _=this.getPosition(p),b=h.x-_.x,w=h.y-_.y,I=h.z-_.z;if(o.position=h,p.hasParentTransform()){y=(new so).translateSelf(b,w,I).multiply(y);const{worldTransform:A}=p.parentNode.transform,M=this.getWorldTransform(p);M.m41=h.x,M.m42=h.y,M.m43=h.z;const F=A.inverse().multiply(y),V=this.getOrigin(p),B=F.getScaling(),Q=this.createScaleMatrix(B.x,B.y,B.z),J=so.fromMatrix(Q).inverse(),Z=F.translate(V.x,V.y,V.z).multiply(J),re=Z.getRotation(),se=so.fromQuat(re).inverse(),ce=Z.multiply(se).getTranslation();ce.x-=V.x,ce.y-=V.y,ce.z-=V.z,o.localPosition.setFromVector(ce)}else o.localPosition=h;this.dirtyLocal(p,o)}setLocalPosition(p,n){const{transform:o}=p,h=zs.fromValue(n.x,n.y,n.z||0);h.equals(o.localPosition)||(o.localPosition=h,this.dirtyLocal(p,o))}getPosition(p){const n=this.getWorldTransform(p),{transform:o}=p,h=n.getTranslation();return o.position.setFromVector(h),p.transform.position}getLocalPosition(p){return p.transform.localPosition}translate(p,n){if(n.equals(new zs))return;const o=this.getPosition(p),h=this.getWorldTransform(p),v=h.getScaling(),y=this.createScaleMatrix(v.x,v.y,v.z),_=h.multiply(so.fromMatrix(y).inverse()).getRotation(),b=so.fromQuat(_).transformPoint(n);180===p.getAngle()&&(b.x=-b.x,b.y=-b.y),o.add(b),this.setPosition(p,o)}translateLocal(p,n){const{transform:o}=p;if(n.equals(new zs))return;n.multiply(o.localScale);const h=so.fromQuat(o.localRotation).transformPoint(n);o.localPosition.add(h),this.dirtyLocal(p,o)}scaleLocal(p,n){const{transform:o}=p;o.localScale.multiply(n),this.dirtyLocal(p,o)}setLocalScale(p,n){const{transform:o}=p,h=zs.fromValue(n.x,n.y,n.z||o.localScale.z);h.equals(o.localScale)||(o.localScale=h,this.dirtyLocal(p,o))}getScale(p){const{transform:n}=p,o=this.getWorldTransform(p).getScaling();return n.scale.setFromVector(o),n.scale}getLocalScale(p){return p.transform.localScale}getRotation(p){const{transform:n}=p,o=this.getWorldTransform(p),h=o.getScaling(),v=this.createScaleMatrix(h.x,h.y,h.z),y=o.multiply(so.fromMatrix(v).inverse()).getRotation();return n.rotation.setFromQuat(y),n.rotation}getLocalRotation(p){return p.transform.localRotation}rotate(p,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{transform:v}=p;if($t(n)&&(n=Wr(n,o,h)),p.hasParentTransform()){const y=a2(n.x,n.y,n.z),_=this.getRotation(p),b=this.getRotation(p.parentNode).clone().invert().multiply(y).multiply(_).normalize();v.localRotation.setFromQuat(b),this.dirtyLocal(p,v)}else this.rotateLocal(p,n)}rotateLocal(p,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$t(n)&&(n=Wr(n,o,h));const{transform:v}=p,y=a2(n.x,n.y,n.z);v.localRotation.multiply(y),this.dirtyLocal(p,v)}setAngle(p,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$t(n)&&(n=Wr(n,o,h));const{transform:v}=p;if(p.hasParentTransform()){const y=a2(n.x,n.y,n.z);v.localRotation.setFromQuat(y);const _=this.getRotation(p.parentNode);_.invert(),v.localRotation.setFromQuat(_.multiply(v.localRotation)),this.dirtyLocal(p,v)}else this.setLocalAngle(p,n)}setLocalAngle(p,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$t(n)&&(n=Wr(n,o,h));const{transform:v}=p,y=a2(n.x,n.y,n.z);v.localRotation.setFromQuat(y),this.dirtyLocal(p,v)}setRotation(p,n){const{transform:o}=p;if(p.hasParentTransform()){let h=this.getRotation(p.parentNode);h=h.clone().invert().multiply(n).normalize(),o.localRotation.setFromQuat(h),this.dirtyLocal(p,o)}else this.setLocalRotation(p,n)}setLocalRotation(p,n){const{transform:o}=p;o.localRotation.setFromQuat(n),this.dirtyLocal(p,o)}getAngle(p){const n=this.getWorldTransform(p);return Zg.fromQuat(n.decompose().quaternion).toEuler()}getLocalAngle(p){return this.getLocalRotation(p).toEuler()}setLocalTransform(p,n){const o=this.getOrigin(p),{rotation:v,scale:y}=n.decompose(),_=this.createScaleMatrix(y.x,y.y,y.z),b=so.fromMatrix(_).inverse(),w=n.translate(o.x,o.y,o.z).multiply(b).getTranslation();w.x-=o.x,w.y-=o.y,w.z-=o.z,this.setLocalPosition(p,w),this.setLocalAngle(p,v.x,v.y,v.z),this.setLocalScale(p,y)}createScaleMatrix(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}resetLocalTransform(p){this.setLocalScale(p,new zs(1,1,1)),this.setLocalPosition(p,new zs(0,0,0)),this.setLocalAngle(p,0)}getWorldTransform(p){const{transform:n}=p;if(!n.worldDirty&&!n.localDirty)return n.worldTransform;const{parentNode:o}=p;return o&&o.transform&&this.getWorldTransform(o),this.updateHierarchy(p),n.worldTransform}getLocalTransform(p){const{transform:n}=p;return n.localDirty&&n.updateLocalTransform(),n.localTransform}getBounds(p,n){const{renderable:o,childNodes:h}=p;if(n&&!o.renderBoundsDirty&&o)return o.renderBounds;if(!n&&!o.boundsDirty&&o.bounds)return o.bounds;let v=this.getTransformedGeometryBounds(p,n);h.forEach(_=>{const b=this.getBounds(_,n);b&&(v?v.addBounds(b):v=Hl.fromBounds(b))});const{clipPath:y}=p.style;if(y){const _=this.getTransformedGeometryBounds(y,!0);let b=null;_&&(b=Hl.create(),b.setFromTransformedBounds(this.getWorldTransform(p),_)),v?b&&(v=b.intersection(v)):v=b}return n?(o.renderBoundsDirty=!1,v&&(o.renderBounds=v)):(o.boundsDirty=!1,v&&(o.bounds=v)),v||Hl.create()}getLocalBounds(p){const{parentNode:n}=p;if(n){let o=new so;n.transform&&(o=this.getWorldTransform(n).inverse());const h=this.getBounds(p);if(!Hl.isEmpty(h)){const v=Hl.create();return v.setFromTransformedBounds(o,h),v}}return this.getBounds(p)}getGeometryBounds(p,n){const{geometry:o}=p;return(n?o.renderBounds:o.contentBounds)||Hl.create()}getBoundingClientRect(p){var n;let o;const h=this.getGeometryBounds(p);Hl.isEmpty(h)||(o=Hl.create(),o.setFromTransformedBounds(this.getWorldTransform(p),h));const v=null===(n=p.ownerDocument)||void 0===n?void 0:n.defaultView.getContextService().getBoundingClientRect();return o?{x:o.minX+((null==v?void 0:v.left)||0),y:o.minY+((null==v?void 0:v.top)||0),width:o.maxX-o.minX,height:o.maxY-o.minY}:{x:(null==v?void 0:v.left)||0,y:(null==v?void 0:v.top)||0,width:0,height:0}}updateHierarchy(p){const{transform:n}=p;if(n.localDirty&&n.updateLocalTransform(),n.worldDirty){var o;let h=null==p||null===(o=p.parentNode)||void 0===o?void 0:o.transform;p.parentNode&&h||(h=new VQ),n.updateWorldTransform(h)}}getTransformedGeometryBounds(p){const o=this.getGeometryBounds(p,arguments.length>1&&void 0!==arguments[1]&&arguments[1]);if(!Hl.isEmpty(o)){const h=Hl.create();return this.getWorldTransform(p),h.setFromTransformedBounds(this.getWorldTransform(p),o),h}return null}dirtyLocal(p,n){n.localDirty||(n.localDirty=!0,n.worldDirty||this.dirtyWorld(p,n))}dirtyWorld(p,n){n.worldDirty||this.unfreezeParentToRoot(p),this.recursiveDirtyWorld(p,n),function(o){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=o;for(;v;){const{renderable:_}=v;_&&(_.boundsDirty=!0,_.renderBoundsDirty=!0),v=v.parentNode}const y=new Qg("bounds-changed",{affectChildren:h});o.dispatchEvent(y)}(p,!0)}recursiveDirtyWorld(p,n){if(n.worldDirty)return;n.worldDirty=!0,n.frozen=!1,p.childNodes.forEach(v=>{const{transform:y}=v;y.worldDirty||this.recursiveDirtyWorld(v,y)});const{renderable:o}=p;o&&(o.boundsDirty=!0,o.renderBoundsDirty=!0);const h=new Uv("DOMAttrModified",p,null,null,"modelMatrix",Uv.MODIFICATION,null,null);p.dispatchEvent(h)}unfreezeParentToRoot(p){let n=p;for(;n;){const{transform:o}=n;o&&(o.frozen=!1),n=n.parentNode}}};class qEe{constructor(){W(this,"contentBounds",void 0),W(this,"renderBounds",void 0)}}class KEe{constructor(){W(this,"boundsDirty",!0),W(this,"bounds",void 0),W(this,"renderBoundsDirty",!0),W(this,"renderBounds",void 0)}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0}}class JEe{constructor(){W(this,"renderOrder",0),W(this,"lastSortedIndex",void 0),W(this,"sorted",void 0),W(this,"dirty",!1)}}let VQ=class{constructor(){W(this,"frozen",!0),W(this,"worldDirty",!1),W(this,"localDirty",!1),W(this,"localRotation",s2(0,0,0,1)),W(this,"rotation",s2(0,0,0,1)),W(this,"localScale",Wr(1,1,1)),W(this,"scale",Wr(1,1,1)),W(this,"localPosition",Wr(0,0,0)),W(this,"position",Wr(0,0,0)),W(this,"localSkew",Wr(0,0,0)),W(this,"skew",Wr(0,0,0)),W(this,"origin",Wr(0,0,0)),W(this,"worldTransform",new so),W(this,"localTransform",new so)}updateLocalTransform(){const{origin:p,localScale:n,localPosition:o,localRotation:h,localSkew:v}=this,y=new so;y.translateSelf(p.x,p.y,p.z);const _=function(w){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return $t(w)?new UQ(w,I,A,M):new UQ(w.x,w.y,w.z,w.w)}(0,0,0,1),b=this.compose(_,o,h,v,n);y.multiplySelf(b),y.translateSelf(-p.x,-p.y,-p.z),this.localTransform.setFromMatrix(y),this.localDirty=!1}updateWorldTransform(p){const n=p.worldTransform.clone();n.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(n),this.worldDirty=!1}compose(p,n,o,h,v){const y=new so;y.m14=p.x,y.m24=p.y,y.m34=p.z,y.m44=p.w,y.translateSelf(n.x,n.y,n.z);const _=so.fromQuat(o);y.multiplySelf(_);const b=new so;return h.z&&(b.m32=h.z,y.multiplySelf(b)),h.y&&(b.m32=0,b.m31=h.y,y.multiplySelf(b)),h.x&&(b.m31=0,b.m21=h.x,y.multiplySelf(b)),y.scaleSelf(v.x,v.y,v.z),y}};function m5(p,n){if(Number.isNaN(n))return{unit:"px",value:0};if(gl(n))return{unit:"px",value:0};if($t(n))return{unit:"px",value:n};if(n=n.trim().toLowerCase(),Number.isFinite(Number(n))&&"px".search(p)>=0)return{unit:"px",value:Number(n)};const o=[];n=n.replace(p,v=>(o.push(v),`U${v}`));const h=`U(${p.source})`;return o.map(v=>({unit:v,value:Number(n.replace(new RegExp(`U${v}`,"g"),"").replace(new RegExp(h,"g"),"*0"))}))[0]}const ni=p=>m5(/px|pt/g,p),Nv=p=>m5(/px|%|em/g,p),tw=p=>m5(/deg|rad|grad|turn/g,p);class c2{constructor(n,o,h){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];W(this,"r",void 0),W(this,"g",void 0),W(this,"b",void 0),W(this,"alpha",void 0),W(this,"isNone",void 0),W(this,"formatted",""),this.r=n,this.g=o,this.b=h,this.alpha=v,this.isNone=y,this.formatted=`rgba(${n}, ${o}, ${h}, ${v})`}clone(){return new c2(this.r,this.g,this.b,this.alpha)}}class M_{constructor(n,o){W(this,"type",void 0),W(this,"value",void 0),this.type=n,this.value=o}clone(){return new M_(this.type,this.value)}}const QEe={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},ZEe=p=>{let n;return n="angular"===p.type?Number(p.value):QEe[p.value]||0,{value:n,unit:"deg"}},e2e=p=>{if(p.includes("linear")||p.includes("radial"))return BEe(p).map(n=>{let{type:o,orientation:h,colorStops:v}=n;!function(_){var b;const{length:w}=_;var I;_[w-1].length=null!==(b=_[w-1].length)&&void 0!==b?b:{type:"%",value:"100"},w>1&&(_[0].length=null!==(I=_[0].length)&&void 0!==I?I:{type:"%",value:"0"});let A=0,M=Number(_[0].length.value);for(let V=1;V<w;V++){var F;const B=null===(F=_[V].length)||void 0===F?void 0:F.value;if(!gl(B)&&!gl(M)){for(let Q=1;Q<V-A;Q++)_[A+Q].length={type:"%",value:`${M+(Number(B)-M)*Q/(V-A)}`};A=V,M=Number(B)}}}(v);const y=v.map(_=>({offset:{value:_.length.value,unit:"%"},color:NEe(_)}));if("linear-gradient"===o)return new M_(1,{angle:h?ZEe(h):{value:0,unit:"deg"},steps:y});if("radial-gradient"===o){h||(h=[{type:"shape",value:"circle"}]);const _=h[0];if("shape"===(null==_?void 0:_.type)&&"circle"===(null==_?void 0:_.value)){const{cx:b,cy:w}=(A=>{let M=50,F=50,V="%",B="%";if("position"===(null==A?void 0:A.type)){const{x:Q,y:J}=A.value;"position-keyword"===(null==Q?void 0:Q.type)&&("left"===Q.value?M=0:"center"===Q.value?M=50:"right"===Q.value?M=100:"top"===Q.value?F=0:"bottom"===Q.value&&(F=100)),"position-keyword"===(null==J?void 0:J.type)&&("left"===J.value?M=0:"center"===J.value?F=50:"right"===J.value?M=100:"top"===J.value?F=0:"bottom"===J.value&&(F=100)),"px"!==(null==Q?void 0:Q.type)&&"%"!==(null==Q?void 0:Q.type)&&"em"!==(null==Q?void 0:Q.type)||(V=null==Q?void 0:Q.type,M=Number(Q.value)),"px"!==(null==J?void 0:J.type)&&"%"!==(null==J?void 0:J.type)&&"em"!==(null==J?void 0:J.type)||(B=null==J?void 0:J.type,F=Number(J.value))}return{cx:{value:M,unit:V},cy:{value:F,unit:B}}})(null==_?void 0:_.at);let I;if(null!=_&&_.style){const{type:A,value:M}=_.style;I="extent-keyword"===A?M:{value:M,unit:o}}return new M_(2,{cx:b,cy:w,size:I,steps:y})}}})};function u2(p){const n=p.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(n[3]||"1"),h=Math.floor(o*parseInt(n[0],10)+255*(1-o)),v=Math.floor(o*parseInt(n[1],10)+255*(1-o)),y=Math.floor(o*parseInt(n[2],10)+255*(1-o));return`#${`0${h.toString(16)}`.slice(-2)}${`0${v.toString(16)}`.slice(-2)}${`0${y.toString(16)}`.slice(-2)}`}function t2e(p){return/^hsla?\(.+\)$/i.test(p)}function Kd(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(gl(p))return null;if("currentColor"===p&&(p="black"),"transparent"===p)return new c2(0,0,0,0);const n=e2e(p);if(n)return n;if(t2e){const v=document.createElement("div");v.style.color=p,p=v.style.color}const o=MEe(p),h=[0,0,0,0];return null!==o&&(h[0]=parseInt(o.r,10)||0,h[1]=parseInt(o.g,10)||0,h[2]=parseInt(o.b,10)||0,h[3]=parseFloat(o.opacity)),new c2(...h)}function n2e(p){let n=null;Di(p)&&(n=p),Sn(p)&&(n=p.split(" "));for(let h=0;h<3;h++)n[h]=n[h]?ni(n[h]).value:0;const o=Kd(n[3]);return n[3]=o?o.formatted:"black",n.slice(0,4)}function i2e(p){const n=[];return Sn(p)?p.split(" ").forEach(o=>{const h=ni(o);h&&n.push(h.value)}):n.push(...p),1===n.length?[n[0],n[0]]:n}const r2e=p=>{let n=p;if(Sn(p)){const o=Nv(p);"%"===o.unit&&(n=o.value/100),"px"===o.unit&&(n=o.value)}return n>1&&(n=1),n},eu={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},jQ={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function o2e(p){const n=[];return p.forEach(o=>{n.push(zt(Ke(Ke({},jQ),o),{fontSize:ni(o.fontSize||jQ.fontSize)}))}),n}function s2e(p,n,o,h){const{x:v=0,y=0}=o.parsedStyle,{x:_,y:b}=o.getLocalPosition();o.boundsDirty=!0,"x"===h&&v===_||"y"===h&&y===b||o.setLocalPosition(v,y)}function a2e(p,n,o){if(!(o instanceof m2||o instanceof w5||o instanceof nZ)||p===n)return;o.pathDirty=!0,o.boundsDirty=!0,o.getPath();const{x:h,y:v}=o.getBoundingRect();o.updatePosition(h,v),o.updateOrigin()}function l2e(p,n,o){o instanceof rw&&p!==n&&(o.pathDirty=!0,o.boundsDirty=!0,o.setTextFont(),o.calculateTextPosition(),o.calculateLineWarp(),o.calculateCharPosition(),o.updateOrigin())}function c2e(p,n,o){!(o instanceof ms)||o instanceof T5||o instanceof Wv||p!==n&&(o.pathDirty=!0,o.boundsDirty=!0,o.getPath(),o.updateOrigin())}function u2e(p,n,o){(o instanceof eZ||o instanceof em||o instanceof tZ)&&p!==n&&(o.pathDirty=!0,o.boundsDirty=!0,o.getPath())}function d2e(p,n,o){if(!(o instanceof S5||o instanceof w5)||p===n)return;o.pathDirty=!0,o.boundsDirty=!0,o.getPath();const{x:h,y:v}=o.getBoundingRect();o.updatePosition(h,v),o.updateOrigin()}function h2e(p,n,o){p!==n&&(o.pathDirty=!0,o.boundsDirty=!0,o.getPath())}function f2e(p,n,o){o instanceof v2&&p!==n&&(o.pathDirty=!0,o.boundsDirty=!0,o.getPath())}function p2e(p,n,o,h){o instanceof aZ&&p!==n&&(o.setLimitWidth(o.parsedStyle.width.value),o.pathDirty=!0,o.boundsDirty=!0,("freeTextWriter"!==o.textType||"freeTextWriter"===o.textType&&["width","textContents"].includes(h))&&o.calculateContentLines(),o.getPath(),null!=o&&o.isEditMode||o.updateOrigin())}function d2(p,n,o,h,v){const y=v||[],_=p[n],b=p[o];let w=0,I=1;for(let F=n+1;F<o;F++){const B=(((A=l2(_,b,p[F])).x-(M=p[F]).x)**2+(A.y-M.y)**2)**.5;B>w&&(w=B,I=F)}var A,M;return w>=h?(d2(p,n,I,h,y),d2(p,I,o,h,y)):(!y.length&&_&&y.push(_),y.push(b)),y}function g2e(p,n,o,h,v,y){const _=function(w,I,A,M,F,V){const B=function(Me,we,Le){const j=Math.cos(Me),L=Math.sin(Me);return function(Y,q){return{x:j*(Y-we)+L*(q-Le),y:-L*(Y-we)+j*(q-Le)}}}(Math.atan2(V-I,F-w),(w+F)/2,(I+V)/2),Q=B(w,I),J=B(A,M),Z=B(F,V),re=Math.abs(Q.x),[se,ce]=[J.y/2,0].sort((Me,we)=>Me-we);let Ve,te;return[Ve,te]=J.x>=Q.x&&J.x<=Z.y?[Q.x,Z.x]:J.x>0?[Q.x,.5*(J.x+re*re/J.x)]:[.5*(J.x+re*re/J.x),Z.x],function(Me,we,Le){const j=B(Me,we);return!(j.x<Ve-Le||j.x>te+Le||j.y<se-Le||j.y>ce+Le)}}(p,n,o,h,v,y),{getDistance:b}=function(w,I,A,M,F,V){const B=[A-w,M-I],Q=[w-2*A+F,I-2*M+V],J=[2*B[0],2*B[1]],Z=1/Bv(Q,Q),re=Z*Bv(B,Q),se=re*re,ce=Bv(B,B),Ce=0===Bv(Q,Q)?function(Ve){return 0===ce?0:h2(-Bv(B,Ve)/2/ce,0,1)}:function(Ve){const te=Z*(2*ce+Bv(Ve,Q))/3,Me=Z*Bv(Ve,B),we=te-se,Le=re*(2*se-3*te)+Me;let j=Le*Le+we*we*we*4;if(j>=0){j=Math.sqrt(j);const N=(j-Le)/2,$=(-j-Le)/2;return h2(Math.sign(N)*Math.abs(N)**(1/3)+Math.sign($)*Math.abs($)**(1/3)-re,0,1)}const L=Math.sqrt(-we),Y=Math.acos(Le/(we*L*2))/3,q=Math.cos(Y),k=1.7320508075688772*Math.sin(Y);return[h2((q+q)*L-re,0,1),h2((-k-q)*L-re,0,1)]};return{getDistance(Ve,te){const Me=[w-Ve,I-te],we=Ce(Me);if("number"==typeof we)return Math.sqrt(v5((J[0]+Q[0]*we)*we+Me[0],(J[1]+Q[1]*we)*we+Me[1]));const[Le,j]=we;return Math.sqrt(Math.min(v5(Me[0]+(J[0]+Q[0]*Le)*Le,Me[1]+(J[1]+Q[1]*Le)*Le),v5(Me[0]+(J[0]+Q[0]*j)*j,Me[1]+(J[1]+Q[1]*j)*j)))}}}(p,n,o,h,v,y);return{isHit:function(w,I){return!!_(A=w[0],M=w[1],F=I)&&b(A,M)<=F;var A,M,F}}}function h2(p,n,o){return Math.min(Math.max(p,n),o)}function Bv(p,n){return p[0]*n[0]+p[1]*n[1]}function v5(p,n){return p*p+n*n}function HQ(p,n,o,h,v){const{PI:y,cos:_,sin:b,min:w,max:I,tan:A}=Math;v-h>2*y&&(v=h+2*y);let M=I(y/12,(v-h)/12);const F=[];for(F.push({x:p+o*_(h),y:n+o*b(h)});h<v;){const V=p+o*_(h),B=n+o*b(h),Q=w(v,h+M);M=w(v-h,M);const J=p+o*_(Q),Z=n+o*b(Q),re=o*A(M/3);F.push({x:V-(B-n)/o*re,y:B+(V-p)/o*re},{x:J+(Z-n)/o*re,y:Z-(J-p)/o*re},{x:J,y:Z}),h+=M}return F}function GQ(p,n,o,h){const v=p-o,y=p+o,_=n-h,b=n+h,w=.551915024494,I=w*o,A=w*h,M=[];return M.push({x:y,y:n}),M.push({x:y,y:n+A},{x:p+I,y:b},{x:p,y:b}),M.push({x:p-I,y:b},{x:v,y:n+A},{x:v,y:n}),M.push({x:v,y:n-A},{x:p-I,y:_},{x:p,y:_}),M.push({x:p+I,y:_},{x:y,y:n-A},{x:y,y:n}),M}function Ys(p,n){return{type:p,data:n}}function y5(p){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=p.length;if(o<=1)return[];const h=[],[v]=p;h.push(Ys("moveTo",[v]));for(let y=0;y+3<o;y+=3)h.push(Ys("bezierCurveTo",[p[y+1],p[y+2],p[y+3]]));return n&&p.length>2&&h.push(Ys("lineTo",[v])),h}function nw(p,n){return Math.sqrt((p.x-n.x)*(p.x-n.x)+(p.y-n.y)*(p.y-n.y))}function _5(p,n){const o=p.length;if(o<=1)return[];if(2===o)return[{index:0,ops:[Ys("moveTo",[p[0]])]},{index:1,ops:[Ys("lineTo",[p[1]])]}];let h=o-n;o<=n&&(h=0);const v=[];let y=[],_={index:h,ops:[]};if(v.push(_),o<=n){const Q=Ys("moveTo",[p[0]]);_.ops.push(Q),y=[...p]}else y=p.slice(-n);const b=function(Q,J,Z){const re=[];for(let se=1;se<Q.length-1;se++){const ce=180*_2e(rZ(Q[se-1],Q[se]),rZ(Q[se],Q[se+1]))/Math.PI;ce>=45&&ce<=135&&re.push(se)}return re}(y),w=[];for(let Q=0;Q<y.length;Q++)if(b.includes(Q)){const J=p[Q-1],Z=p[Q+1],re=nw(p[Q],J),se=nw(p[Q],Z);let ce,pe;re>6&&(ce=f2(J,p[Q],.2),w.push({val:ce})),w.push({index:Q+h,val:y[Q]}),se>6&&(pe=f2(Z,p[Q],.2),w.push({val:pe}))}else w.push({index:Q+h,val:y[Q]});for(let Q=0;Q<w.length;Q++){var I,A,M,F,V,B;const J=w[Q],Z=w[Q].val,re=null!==(I=null===(A=w[Q-1])||void 0===A?void 0:A.val)&&void 0!==I?I:Z,se=null!==(M=null===(F=w[Q+1])||void 0===F?void 0:F.val)&&void 0!==M?M:Z,ce=m2e(re,Z,se,null!==(V=null===(B=w[Q+2])||void 0===B?void 0:B.val)&&void 0!==V?V:se);void 0!==J.index&&(J.index!==h&&(_={index:void 0,ops:[]},v.push(_)),_.index=J.index),_.ops.push(ce)}return v}function m2e(p,n,o,h){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const y=nw(n,o);let _={x:n.x+(o.x-p.x)/v,y:n.y+(o.y-p.y)/v},b={x:o.x-(h.x-n.x)/v,y:o.y-(h.y-n.y)/v};const w=nw(_,n),I=nw(b,o);return w>y&&(_=f2(_,n,y)),I>y&&(b=f2(b,o,y)),Ys("bezierCurveTo",[_,b,o])}function v2e(p,n,o){const h=(p.x+n.x)/2,v=(p.y+n.y)/2,y=(n.x+o.x)/2,_=(n.y+o.y)/2;return Ys("bezierCurveTo",[{x:h+2*(n.x-h)/3,y:v+2*(n.y-v)/3},{x:y+2*(n.x-y)/3,y:_+2*(n.y-_)/3},n])}function O_(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=[];let[h]=p;o.push(Ys("moveTo",[h]));for(let v=1;v<p.length;v++)h=p[v],o.push(Ys("lineTo",[h]));return n&&p.length>2&&([h]=p,o.push(Ys("lineTo",[h]))),o}function F_(p,n){const{data:o,type:h}=n,[v,y,_]=o;switch(h){case"moveTo":p.moveTo(v.x,v.y);break;case"lineTo":p.lineTo(v.x,v.y);break;case"bezierCurveTo":p.bezierCurveTo(v.x,v.y,y.x,y.y,_.x,_.y);break;case"quadraticCurveTo":p.quadraticCurveTo(v.x,v.y,y.x,y.y)}}function wp(p){let{x:n,y:o}=p[0],h=n,v=o;for(let y=1;y<p.length;y++){const{x:_,y:b}=p[y];n=Math.min(n,_),h=Math.max(h,_),o=Math.min(o,b),v=Math.max(v,b)}return{left:n,top:o,right:h,bottom:v,width:h-n,height:v-o}}function f2(p,n,o){const h=n.x-p.x,v=n.y-p.y,y=Math.abs(h)/Math.abs(v);let _=Math.sqrt(o*o/(y*y+1)),b=_*y;return 0===h&&(b=0,_=Math.sqrt(o)),0===v&&(_=0,b=Math.sqrt(o)),{x:n.x-(h>=0?b:-b),y:n.y-(v>=0?_:-_)}}function zQ(p){if(p.length<1)return[];const n=[];let o=[];for(let h=0;h<p.length;h++){const v=p[h];0===v.step?(h>0&&n.push({step:o,close:p[h-1].close}),o=[],o.push(Ys("moveTo",[{x:v.x,y:v.y}]))):1===v.step?o.push(Ys("lineTo",[{x:v.x,y:v.y}])):2===v.step&&h+2<p.length&&2===p[h+1].step&&2===p[h+2].step&&(o.push(Ys("bezierCurveTo",[v,p[h+1],p[h+2]])),h+=2)}return n.push({step:o,close:p[p.length-1].close}),n}function C5(p){return 180*p/Math.PI}function b5(p){return p<0?p%360+360:p%360}function p2(p,n,o,h){return p/(o*o)+n/(h*h)}function iw(p,n,o,h){let v=0,y=0,_=0,b=0;const w=[p,n],I=wp(w),A=function(M,F,V,B){let Q=B/2,J=B/2;const Z=F.y-M.y,re=F.x-M.x;if(0===Z||0===re)return[re,Z];const ce=Math.atan(-1/((F.y-M.y)/(F.x-M.x)));return"square"===V?(Q=Math.sqrt(2)*B/2,J=Math.sqrt(2)*B/2):"round"===V?(Q=B/2,J=B/2):(Q=Math.abs(Math.cos(ce)*B)/2,J=Math.abs(Math.sin(ce)*B)/2),[Q,J]}(w[0],w[1],h,o||0);return 0===A[1]?(v=I.left,y=I.top-o/2,_=I.width,b=I.height+o,"square"!==h&&"round"!==h||(v-=o/2,_+=o)):0===A[0]?(v=I.left-o/2,y=I.top,_=I.width+o,b=I.height,"square"!==h&&"round"!==h||(y-=o/2,b+=o)):(v=I.left-A[0],y=I.top-A[1],_=I.width+2*A[0],b=I.height+2*A[1]),{x:v,y,width:_,height:b}}function x5(p){return Math.abs(p)<1e-6?0:p<0?-1:1}function g2(p,n,o,h){const{x:v,y}=p,{x:_,y:b}=n,{x:w,y:I}=h,A=Math.min(v,_),M=Math.max(v,_),F=Math.min(y,b),V=Math.max(y,b),B=o/2;return w>=A-B&&w<=M+B&&I>=F-B&&I<=V+B&&function(Q,J,Z,re,se,ce){const pe=[Z-Q,re-J];if(new zs(pe[0],pe[1]).equals({x:0,y:0}))return Math.sqrt((se-Q)*(se-Q)+(ce-J)*(ce-J));const Ce=[-pe[1],pe[0]],Ve=new zs(Ce[0],Ce[1]);Ve.normalize();const te=[se-Q,ce-J],Me=new zs(te[0],te[1]);return Math.abs(Me.dot(Ve))}(v,y,_,b,w,I)<=o/2}function YQ(p,n,o,h,v){const y=p.length;if(y<2)return!1;for(let _=0;_<y-1;_++)if(g2(p[_],p[_+1],n,{x:o,y:h}))return!0;return!(!v||!g2(p[0],p[y-1],n,{x:o,y:h}))}function L_(p,n,o,h,v,y){return v>=p&&v<=p+o&&y>=n&&y<=n+h}function XQ(p,n,o,h,v,y){const _=y;let b=h.x,w=h.y,I=v.x,A=v.y;0===n&&(b=v.x,w=v.y,I=h.x,A=h.y);let M=Math.PI/2;const F=I-b>=0?1:-1,V=A-w>=0?1:-1;b!==I&&(M=Math.atan(Math.abs(A-w)/Math.abs(I-b)));const B=Math.cos(M),Q=Math.sin(M),J=o?1:-1,Z={x:I+7.8*J*_*B*F-4.5*_*Q*F,y:A+7.8*J*_*Q*V+4.5*_*B*V,step:0,close:!1},re={x:I,y:A,step:1,close:!1};o&&(re.x=I+_*J*B*F,re.y=A+_*J*Q*V),p.push(Z,re,{x:I+7.8*J*_*B*F+4.5*_*Q*F,y:A+7.8*J*_*Q*V-4.5*_*B*V,step:1,close:!1})}function $Q(p,n,o,h,v,y){const _=y;let b=h.x,w=h.y,I=v.x,A=v.y;0===n&&(b=v.x,w=v.y,I=h.x,A=h.y);let M=Math.PI/2;const F=I-b>=0?1:-1,V=A-w>=0?1:-1;b!==I&&(M=Math.atan(Math.abs(A-w)/Math.abs(I-b)));const B=Math.cos(M),Q=Math.sin(M),J=o?1:-1,Z={x:I+7.8*J*_*B*F-4.5*_*Q*F,y:A+7.8*J*_*Q*V+4.5*_*B*V,step:0,close:!1},re={x:I,y:A,step:1,close:!1};o&&(re.x=I+_*J*B*F,re.y=A+_*J*Q*V),p.push(Z,re,{x:I+7.8*J*_*B*F+4.5*_*Q*F,y:A+7.8*J*_*Q*V-4.5*_*B*V,step:1,close:!0})}function qQ(p,n,o,h,v){const y=v;let _=o.x,b=o.y,w=h.x,I=h.y;0===n&&(_=h.x,b=h.y,w=o.x,I=o.y);let A=Math.PI/2;const M=w-_>=0?1:-1,F=I-b>=0?1:-1;_!==w&&(A=Math.atan(Math.abs(I-b)/Math.abs(w-_)));const V=Math.cos(A),B=Math.sin(A);p.push({x:w-3*y*B*M,y:I+3*y*V*F,step:0,close:!1},{x:w+3*y*B*M,y:I-3*y*V*F,step:1,close:!1})}function KQ(p,n,o,h,v){const y=v;let _=o.x,b=o.y,w=h.x,I=h.y;0===n&&(_=h.x,b=h.y,w=o.x,I=o.y);let A=Math.PI/2;const M=w-_>=0?1:-1,F=I-b>=0?1:-1,V=I>=b&&w>=_||I<=b&&w<=_?-1:1;_!==w&&(A=Math.atan(Math.abs(I-b)/Math.abs(w-_)));const B=Math.cos(A),Q=Math.sin(A),J=4.5*Math.sqrt(3)*y;p.push({x:w+4.5*y*B*M-J*Q*M*V,y:I+4.5*y*Q*F+J*B*F*V,step:0,close:!1},{x:w-4.5*y*B*M+J*Q*M*V,y:I-4.5*y*Q*F-J*B*F*V,step:1,close:!1})}function JQ(p,n,o,h,v){const y=v;let{x:_,y:b}=h;0===n&&(_=o.x,b=o.y),p.push({x:_-3*y,y:b-3*y,step:0,close:!1},{x:_+3*y,y:b-3*y,step:1,close:!1},{x:_+3*y,y:b+3*y,step:1,close:!1},{x:_-3*y,y:b+3*y,step:1,close:!0})}function QQ(p,n,o,h,v){const y=v;let{x:_,y:b}=h;0===n&&(_=o.x,b=o.y),p.push({x:_-3*y,y:b,step:0,close:!1},{x:_,y:b-3*y,step:1,close:!1},{x:_+3*y,y:b,step:1,close:!1},{x:_,y:b+3*y,step:1,close:!0})}function ZQ(p,n,o,h,v){const y=v;let{x:_,y:b}=h;0===n&&(_=o.x,b=o.y);const w=3*y-0*y,I=GQ(_,b,w,w);I.forEach((A,M)=>{p.push({x:A.x,y:A.y,step:0===M?0:2,close:M===I.length-1})})}class y2e{constructor(n){W(this,"lineAlign",void 0),W(this,"owner",void 0),this.owner=n,this.reset()}reset(){this.lineAlign=.5}get x(){return this.owner.getAttribute("x")}set x(n){this.owner.setAttribute("x",n)}get y(){return this.owner.getAttribute("y")}set y(n){this.owner.setAttribute("y",n)}get r(){return this.owner.getAttribute("r")}set r(n){this.owner.setAttribute("r",n)}get width(){return this.owner.getAttribute("width")}set width(n){this.owner.setAttribute("width",n)}get height(){return this.owner.getAttribute("height")}set height(n){this.owner.setAttribute("height",n)}get points(){return this.owner.getAttribute("points")}set points(n){this.owner.setAttribute("points",n)}get origin(){return this.owner.getAttribute("origin")}set origin(n){this.owner.setAttribute("origin",n)}get anchor(){return this.owner.getAttribute("anchor")}set anchor(n){this.owner.setAttribute("anchor",n)}get visibility(){return this.owner.getAttribute("visibility")}set visibility(n){this.owner.setAttribute("visibility",n)}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(n){this.owner.setAttribute("zIndex",n)}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(n){this.owner.setAttribute("borderWidth",n)}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(n){this.owner.setAttribute("borderColor",n)}get opacity(){return this.owner.getAttribute("opacity")}set opacity(n){this.owner.setAttribute("opacity",n)}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(n){this.owner.setAttribute("fillOpacity",n)}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(n){this.owner.setAttribute("borderOpacity",n)}get background(){return this.owner.getAttribute("background")}set background(n){this.owner.setAttribute("background",n)}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(n){this.owner.setAttribute("clipPath",n)}get cursor(){return this.owner.getAttribute("cursor")}set cursor(n){this.owner.setAttribute("cursor",n)}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(n){this.owner.setAttribute("hitArea",n)}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(n){this.owner.setAttribute("pointerEvents",n)}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(n){this.owner.setAttribute("miterLimit",n)}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(n){this.owner.setAttribute("roundedRadius",n)}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(n){this.owner.setAttribute("lineCap",n)}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(n){this.owner.setAttribute("lineJoin",n)}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(n){this.owner.setAttribute("lineDash",n)}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(n){this.owner.setAttribute("lineDashOffset",n)}get shadow(){return this.owner.getAttribute("shadow")}set shadow(n){this.owner.setAttribute("shadow",n)}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(n){this.owner.setAttribute("shadowOffsetX",n)}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(n){this.owner.setAttribute("shadowOffsetY",n)}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(n){this.owner.setAttribute("shadowBlur",n)}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(n){this.owner.setAttribute("shadowColor",n)}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(n){this.owner.setAttribute("startAngle",n)}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(n){this.owner.setAttribute("endAngle",n)}get rx(){return this.owner.getAttribute("rx")}set rx(n){this.owner.setAttribute("rx",n)}get ry(){return this.owner.getAttribute("ry")}set ry(n){this.owner.setAttribute("ry",n)}get img(){return this.owner.getAttribute("img")}set img(n){this.owner.setAttribute("img",n)}get src(){return this.owner.getAttribute("src")}set src(n){this.owner.setAttribute("src",n)}get text(){return this.owner.getAttribute("text")}set text(n){this.owner.setAttribute("text",n)}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(n){this.owner.setAttribute("wordWarp",n)}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(n){this.owner.setAttribute("wordBreak",n)}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(n){this.owner.setAttribute("textMaxWidth",n)}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(n){this.owner.setAttribute("letterSpacing",n)}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(n){this.owner.setAttribute("textBaseLine",n)}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(n){this.owner.setAttribute("textTransform",n)}get color(){return this.owner.getAttribute("color")}set color(n){this.owner.setAttribute("color",n)}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(n){this.owner.setAttribute("fontStyle",n)}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(n){this.owner.setAttribute("fontVariant",n)}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(n){this.owner.setAttribute("fontWeight",n)}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(n){this.owner.setAttribute("fontSize",n)}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(n){this.owner.setAttribute("lineHeight",n)}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(n){this.owner.setAttribute("fontFamily",n)}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(n){this.owner.setAttribute("startPoint",n)}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(n){this.owner.setAttribute("endPoint",n)}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(n){this.owner.setAttribute("lineEnding",n)}get segments(){return this.owner.getAttribute("segments")}set segments(n){this.owner.setAttribute("segments",n)}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(n){this.owner.setAttribute("stampPoints",n)}get imageData(){return this.owner.getAttribute("imageData")}set imageData(n){this.owner.setAttribute("imageData",n)}get iconName(){return this.owner.getAttribute("iconName")}set iconName(n){this.owner.setAttribute("iconName",n)}get textContents(){return this.owner.getAttribute("textContents")}set textContents(n){this.owner.setAttribute("textContents",function(o){const h=[];return o.forEach(v=>{v.content.length&&h.push(v)}),h}(n))}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(n){this.owner.setAttribute("textAlign",n)}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(n){this.owner.setAttribute("renderBlendMode",n)}}const qu=new class{constructor(){W(this,"parsers",void 0),W(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater()}getStyleParser(p){return this.parsers.get(p)}getStyleUpdaters(p){return this.updaters.get(p)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],ni,void 0),this.bindHandler(["startAngle","endAngle"],tw,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],ni,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],Kd,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],r2e,void 0),this.bindHandler(["lineDash"],i2e,void 0),this.bindHandler(["shadow"],n2e,void 0),this.bindHandler(["textContents"],o2e,void 0)}initUpdater(){this.bindHandler(["borderWidth"],void 0,h2e),this.bindHandler(["x","y"],void 0,s2e),this.bindHandler(["width","height"],void 0,c2e),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,u2e),this.bindHandler(["points","segments"],void 0,a2e),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,d2e),this.bindHandler(["text","textTransform","textBaseLine","x","y","width","wordWarp","lineHeight","fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,l2e),this.bindHandler(["stampPoints"],void 0,f2e),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,p2e)}bindHandler(p,n,o){for(let h=0;h<p.length;h++)if(n&&this.parsers.set(p[h],n),o){const v=this.updaters.get(p[h])||[];v.push(o),this.updaters.set(p[h],v)}}};class gs extends OQ{constructor(n){super(),W(this,"attributes",{}),W(this,"id",void 0),W(this,"pageUid",void 0),W(this,"index",void 0),W(this,"name",void 0),W(this,"renderable",new KEe),W(this,"sortable",new JEe),W(this,"geometry",new qEe),W(this,"transform",new VQ),W(this,"parsedStyle",{}),W(this,"style",void 0),W(this,"isDestroyed",!1),W(this,"childNodes",[]),W(this,"nodeName",""),W(this,"nodeType",0),W(this,"nodeValue",null),W(this,"ownerDocument",null),W(this,"parentNode",null),W(this,"isConnected",!1),W(this,"textContent",void 0),W(this,"shapeType",void 0),W(this,"config",void 0),W(this,"path",void 0),W(this,"steps",void 0),W(this,"pathDirty",!0),W(this,"boundsDirty",!0),W(this,"bounds",void 0),W(this,"strokePath",void 0),W(this,"strokeSteps",void 0),W(this,"externalMatrices",[]),W(this,"clippable",!1),W(this,"imageData",null),this.config=n,this.id=n.id||n.uid||"",this.name=n.name||"",this.index=n.index,this.nodeName=n.type||"container",this.pageUid=n.pageUid||"",(n.className||n.class)&&(this.className=n.className||n.class),this.style=new y2e(this),this.initAttributes(n)}static isNode(n){return!!n.childNodes}set className(n){this.setAttribute("class",n)}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter(n=>""!==n)}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:n}=this;return n.length>0?n[n.length-1]:null}get nextSibling(){const{parentNode:n}=this;if(n){const o=n.childNodes.indexOf(this);return n.childNodes[o+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:n}=this;if(n){const o=n.childNodes.indexOf(this);return n.childNodes[o-1]}return null}getAttribute(n){const o=this.attributes[n];return null==o?null:o}getElementsByName(n){return qi.querySelectorAll(`[name="${n}"]`,this)}getElementsByClassName(n){return qi.querySelectorAll(`.${n}`,this)}getElementsByTagName(n){return qi.querySelectorAll(n,this)}hasAttribute(n){return Object.keys(this.attributes).indexOf(n)>-1}removeAttribute(n){this.setAttribute(n,null),delete this.attributes[n]}appendChild(n,o){qi.append(n,this,o);const h=new Qg("child-inserted",{child:n});this.dispatchEvent(h);const v=new Uv("DOMNodeInserted",this,"","","",0,"","");return n.dispatchEvent(v),n}cloneNode(n){return null}insertBefore(n,o){if(o){const h=this.childNodes.indexOf(o);this.appendChild(n,h-1)}else this.appendChild(n);return n}removeChild(n){const o=new Uv("removed",this,"","","",0,"","");n.dispatchEvent(o);const h=new Qg("child-removed",{child:n});return this.dispatchEvent(h),qi.remove(n),n}isChildExist(n){return qi.isChildExist(n)}replaceChild(n,o){const h=this.childNodes.indexOf(o);return this.removeChild(o),this.appendChild(n,h),o}destroy(){const n=new Qg("destroy",{});this.dispatchEvent(n),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0}after(){const{parentNode:n}=this;if(n){const y=n.childNodes.indexOf(this);for(var o=arguments.length,h=new Array(o),v=0;v<o;v++)h[v]=arguments[v];h.forEach((_,b)=>{null==n||n.appendChild(_,y+b+1)})}}before(){const{parentNode:n}=this;if(n){const y=n.childNodes.indexOf(this);for(var o=arguments.length,h=new Array(o),v=0;v<o;v++)h[v]=arguments[v];h.forEach((_,b)=>{null==n||n.appendChild(_,y+b)})}}remove(){this.parentNode&&this.parentNode.removeChild(this)}replaceWith(){this.after(...arguments),this.remove()}append(){for(var n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];o.forEach(v=>{this.appendChild(v)})}prepend(){for(var n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];o.forEach((v,y)=>{this.appendChild(v,y)})}querySelector(n){return qi.querySelector(n,this)}querySelectorAll(n){return qi.querySelectorAll(n,this)}find(n){let o=null;return this.recursiveCall(h=>!(h!==this||!n(h)||(o=h,0))),o}findAll(n){const o=[];return this.recursiveCall(h=>{h===this&&n(h)&&o.push(h)}),o}contains(n){let o=n;for(;o&&this!==o;)o=o.parentNode;return!!o}getRootNode(n){return this.parentNode?this.parentNode.getRootNode(n):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(n){return this===n}isSameNode(n){return this.isEqualNode(n)}normalize(){throw new Error("Method to be implemented")}recursiveCall(n){n(this)||this.childNodes.forEach(o=>{o.recursiveCall(n)})}hasParentTransform(){return!(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return qi.getGeometryBounds(this)}getRenderBounds(){return qi.getBounds(this,!0)}getBounds(){return qi.getBounds(this)}getLocalBounds(){return qi.getLocalBounds(this)}getBoundingClientRect(){return qi.getBoundingClientRect(this)}get isVisible(){return"visible"===this.parsedStyle.visibility}get isInteractive(){return"none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const o in n)if(QE(o,n)){if("style"===o)continue;this.attributes[o]=n[o]}for(const o in n.style)QE(o,n.style)&&(this.parseStyleProperty(o,n.style[o]),this.attributes[o]=n.style[o]);this.renderable.toRenderable()}setAttribute(n,o){if(gt(o))return;const v=this.attributes[n];(o!==this.attributes[n]||"x"===n||"y"===n)&&(this.attributes[n]=o,Object.keys(this.config).includes(n)||(this.parseStyleProperty(n,o),this.updateStyleProperty(n,v,o)))}parseStyleProperty(n,o){const h=qu.getStyleParser(n);this.parsedStyle[n]=h?h(o,this,n):o}updateStyleProperty(n,o,h){const v=qu.getStyleUpdaters(n);v&&v.forEach(y=>{y(o,h,this,n)})}toFront(){const{parentNode:n}=this;if(n){const o=Math.max(...n.children.map(h=>h.style.zIndex));this.style.zIndex=o+1}return this}toBack(){const{parentNode:n}=this;if(n){const o=Math.min(...n.children.map(h=>h.style.zIndex));this.style.zIndex=o-1}return this}setOrigin(n){return qi.setOrigin(this,n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}getOrigin(){return qi.getOrigin(this)}setPosition(n){return qi.setPosition(this,n),this}setLocalPosition(n){const o=Wr(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return qi.setLocalPosition(this,o),this}getPosition(){return qi.getPosition(this)}getLocalPosition(){return qi.getLocalPosition(this)}translate(n){const o=Wr(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return qi.translate(this,o),this}translateLocal(n){const o=Wr(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return qi.translateLocal(this,o),this}scale(n,o,h){return this.scaleLocal(n,o,h)}scaleLocal(n,o,h){return $t(n)&&(n=Wr(n,o=o||n,h=h||n)),qi.scaleLocal(this,n),this}setLocalScale(n,o,h){return $t(n)&&(n=Wr(n,o=o||n,h=h||n)),qi.setLocalScale(this,n),this}getScale(){return qi.getScale(this)}getLocalScale(){return qi.getLocalScale(this)}rotate(n,o,h){return gt(o)&&gt(h)?qi.rotate(this,0,0,n):qi.rotate(this,n,o,h),this}rotateLocal(n,o,h){return gt(o)&&gt(h)?qi.rotateLocal(this,0,0,n):qi.rotateLocal(this,n,o,h),this}setAngle(n){return qi.setAngle(this,0,0,n),this}setLocalAngle(n){return 180===Math.abs(n%360)&&(n-=.001),qi.setLocalAngle(this,0,0,n),this}getAngle(){return qi.getAngle(this).z}getLocalAngle(){return qi.getLocalAngle(this).z}getLocalTransform(){return qi.getLocalTransform(this)}getWorldTransform(){return qi.getWorldTransform(this)}setLocalTransform(n){return qi.setLocalTransform(this,n),this}resetLocalTransform(){qi.resetLocalTransform(this)}getPath(){}getBoundingRect(){return{x:0,y:0,width:0,height:0}}isPointInPath(n){return!1}updateStyle(n){Object.keys(n).forEach(o=>{QE(o,n)&&(this.style[o]=n[o])})}updatePosition(n,o){this.style.x=n||0,this.style.y=o||0}updateOrigin(){const{width:n,height:o}=this.getBoundingRect();this.setOrigin(n/2,o/2)}getBoundingRectObject(){const{x:n,y:o,width:h,height:v}=this.getBoundingRect();return new ms({style:{x:n,y:o,width:h,height:v,borderWidth:1,background:"transparent"}})}}class eZ extends gs{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:n}=y,o=ic(y,["style"]);super(Ke({type:"arc",style:Ke(zt(Ke({},eu),{r:0,startAngle:0,endAngle:1.5*Math.PI}),n)},o)),W(this,"shapeType","arc");const{x:h,y:v}=this.parsedStyle;this.setLocalPosition(h,v),this.updateOrigin()}normAngle(){const{startAngle:n,endAngle:o}=this.style;let h=tw(n).value,v=tw(o).value;if(h>v){const y=h;h=v,v=y}if(Math.abs(v-h)>=2*Math.PI-1e-5&&(h=0,v=2*Math.PI),h<-2*Math.PI||v<-2*Math.PI){const y=Math.max(Math.floor(h/(-2*Math.PI)),Math.floor(v/(-2*Math.PI)));h+=2*Math.PI*y,v+=2*Math.PI*y}if(h>2*Math.PI||v>2*Math.PI){const y=Math.max(Math.floor(h/(2*Math.PI)),Math.floor(v/(2*Math.PI)));h-=2*Math.PI*y,v-=2*Math.PI*y}this.parsedStyle.startAngle=tw(h),this.parsedStyle.endAngle=tw(v)}updateOrigin(){const{width:n,height:o,x:h,y:v}=this.getBoundingRect();this.setOrigin(h-this.style.x+n/2,v-this.style.y+o/2)}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:n,borderWidth:o,startAngle:h,endAngle:v}=this.parsedStyle;return this.path=HQ(0,0,n.value-.5*((null==o?void 0:o.value)||0),h.value,v.value),this.steps=y5(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:n,y:o,r:h,startAngle:v,endAngle:y}=this.parsedStyle,b=h.value,w=v.value,I=y.value;if(v===y)return{x:n-b-0,y:o-b-0,width:2*b+0,height:2*b+0};const{sin:A,cos:M,PI:F}=Math,V=[n+b*M(w),n+b*M(I)],B=[o+b*A(w),o+b*A(I)];return w<0&&I>0&&V.push(n+b),(w<.5*F&&I>.5*F||w<-1.5*F&&I>-1.5*F)&&B.push(o+b),(w<F&&I>F||w<-F&&I>-F)&&V.push(n-b),(w<1.5*F&&I>1.5*F||w<-.5*F&&I>-.5*F)&&B.push(o-b),V.sort((Q,J)=>Q-J),B.sort((Q,J)=>Q-J),this.boundsDirty=!1,this.bounds={x:V[0]-0,y:B[0]-0,width:V[V.length-1]-V[0]+0,height:B[B.length-1]-B[0]+0},this.bounds}isPointInPath(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(n,o))return!1;const{x:h,y:v,r:y,startAngle:_,endAngle:b,background:w,borderWidth:I}=this.parsedStyle,A=b5(C5(_.value)),M=b5(C5(b.value)),F=b5(C5(_.value+b.value)/2),V=Sn(this.style.background)&&""!==this.style.background,B=I&&I.value,J=(I.value+(V?0:o)||0)/2,Z=y.value-J,re=new Rr(h+Z*Math.cos(A*Math.PI/180),v+Z*Math.sin(A*Math.PI/180)),se=new Rr(h+Z*Math.cos(M*Math.PI/180),v+Z*Math.sin(M*Math.PI/180)),ce=new Rr(h+Z*Math.cos(F*Math.PI/180),v+Z*Math.sin(F*Math.PI/180)),pe=new Rr(n.x,n.y),Ce=pe.distanceTo({x:h,y:v}),Ve=g5([re.x,re.y],[ce.x,ce.y],[pe.x,pe.y],[h,v]),te=g5([se.x,se.y],[ce.x,ce.y],[pe.x,pe.y],[h,v]),Me=g5([re.x,re.y],[se.x,se.y],[pe.x,pe.y],[h,v]);if(Ce>Z+J)return!1;const we=g2(re,se,2*J,n);if(M-A<180&&M-A>0||M-A<-180){if(w&&Me||we||!w&&B&&Ce>=Z-J&&Ce<=Z+J&&Me)return!0}else if(180===Math.abs(M-A)){if(w&&(Ve||te||function(Le,j,L,Y){const{x:q,y:k}=Le,{x:N,y:$}=j,{x:ie,y:ee}=L,{x:ne,y:le}=Y;return!(((ne-q)*($-k)-(le-k)*(N-q))*((ie-q)*($-k)-(ee-k)*(N-q))<=0||((ne-ie)*($-ee)-(le-ee)*(N-ie))*((q-ie)*($-ee)-(k-ee)*(N-ie))<=0||((ne-q)*(ee-k)-(le-k)*(ie-q))*((N-q)*(ee-k)-($-k)*(ie-q))<=0)}(re,ce,se,n))||!w&&B&&Ce>=Z-J&&Ce<=Z+J&&(Ve||te))return!0}else if(w&&(Ve||te||!Me)||!w&&B&&Ce>=Z-J&&Ce<=Z+J&&(Ve||te))return!0;return!!we}}class em extends gs{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:n}=y,o=ic(y,["style"]);super(Ke({type:"circle",style:Ke(zt(Ke({},eu),{r:0,anchor:[.5,.5]}),n)},o)),W(this,"shapeType","circle");const{x:h,y:v}=this.parsedStyle;this.setLocalPosition(h,v),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{r:n,borderWidth:o}=this.parsedStyle;let h=.5*((null==o?void 0:o.value)||0);return n.value===h&&(h=0),this.path=HQ(0,0,n.value-h,0,2*Math.PI),this.steps=y5(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:n,y:o,r:h}=this.parsedStyle,v=h.value;return this.boundsDirty=!1,this.bounds={x:n-v-0,y:o-v-0,width:2*v+0,height:2*v+0},this.bounds}isPointInPath(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(n,o))return!1;const{x:h,y:v,r:y,background:_,borderWidth:b}=this.parsedStyle,w=Sn(this.style.background)&&""!==this.style.background,I=b&&b.value,M=(b.value+(w?0:o)||0)/2,F=y.value-M,V=new Rr(n.x,n.y).distanceTo({x:h,y:v});return _&&I?V<=F+M:_?V<=F:!!I&&V>=F-M&&V<=F+M}}let tZ=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"ellipse",style:Ke(zt(Ke({},eu),{rx:"",ry:"",borderWidth:0,anchor:[.5,.5]}),p)},n)),W(this,"shapeType","ellipse");const{x:o,y:h}=this.parsedStyle;this.setLocalPosition(o,h),this.updateOrigin()}updateOrigin(){this.setOrigin(0,0)}getPath(){if(!this.pathDirty)return this.path;const{rx:p,ry:n,borderWidth:o}=this.parsedStyle,h=.5*o.value;return this.path=GQ(0,0,p.value-h,n.value-h),this.steps=y5(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:n,rx:o,ry:h}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p-o.value-0,y:n-h.value-0,width:2*o.value+0,height:2*h.value+0},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,n))return!1;const{x:o,y:h,rx:v,ry:y,borderWidth:_}=this.parsedStyle,b=Sn(this.style.background)&&""!==this.style.background,w=_&&_.value,I=b?0:n,A=(_.value||0)/2,M=v.value-A,F=y.value-A,V=(p.x-o)*(p.x-o),B=(p.y-h)*(p.y-h);return b&&w?p2(V,B,M+A,F+A)<=1:b?p2(V,B,M,F)<=1:!!w&&p2(V,B,M-A-I/2,F-A-I/2)>=1&&p2(V,B,M+A+I/2,F+A+I/2)<=1}},Wv=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"image",style:Ke(zt(Ke({},eu),{width:0,height:0,img:""}),p)},n)),W(this,"shapeType","image"),W(this,"meteData",void 0),this.meteData=(null==n?void 0:n.metadata)||null;const{x:o,y:h}=this.parsedStyle;this.setLocalPosition(o,h),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:n,width:o,height:h}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:n,width:o.value,height:h.value},this.bounds}isPointInPath(p){return this.getBoundingRectObject().isPointInPath(p)}},nZ=class extends gs{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=o,n=ic(o,["style"]);super(Ke({type:"ink",style:Ke(zt(Ke({},eu),{segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),p)},n)),W(this,"shapeType","ink"),W(this,"inkPaths",[]),W(this,"inkSteps",[]),W(this,"inkRenderPaths",[]),W(this,"inkOriginalRenderPath",void 0),W(this,"inkRenderSteps",[]),W(this,"initialRect",void 0),W(this,"useDouglasPeucker",!0),W(this,"douglasPeuckerPoints",[]),W(this,"partDirty",!1),W(this,"optimizedOpSteps",[]),W(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height)}addSegment(){const{segments:p}=this.style;p[p.length-1].length&&this.style.segments.push([])}addPoint(p){const n=[...this.style.segments],o=this.style.segments.length,h=n[o-1],v=h[h.length-1];if((null==v?void 0:v.x)!==p.x||(null==v?void 0:v.y)!==p.y){this.partDirty=!0;const y=this.getBoundingRect(),_=this.parsedStyle.borderWidth.value/2;(p.x<y.x+_||p.y<y.y+_)&&(this.positionDirty=!0),n[o-1].push(p),this.style.segments=n;const b=this.getBoundingRect();(p.x<b.x||p.y<b.y||p.x>b.x+b.width||p.y>b.y+b.height)&&(this.boundsDirty=!0)}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:p}=this.parsedStyle;if(this.partDirty){const n=p.length;if(n>1)for(let v=0;v<n-1;v++){const y=p[v];if(!this.optimizedOpSteps[v]){let _=[...y];1===_.length?_=this.offsetPoints(y[0],.1):(_=d2(_,0,_.length-1,1),_.length<=3&&_.push(Ke({},_[_.length-1])));const b=_5(_,_.length).map(w=>w.ops).flat(2);this.optimizedOpSteps[v]=b}if(this.positionDirty||!this.inkRenderSteps[v]){const _=this.getRenderStep(this.optimizedOpSteps[v]);this.inkRenderSteps[v]=_}}let o=p[n-1];1===o.length?o=this.offsetPoints(o[0],.1):o.length<=3&&o.push(o[o.length-1]),o=this.getRenderPath(o);const h=function(v){const y=v.length;if(y<=1)return[];if(2===y)return[Ys("moveTo",[v[0]]),Ys("lineTo",[v[1]])];const _=[Ys("moveTo",[v[0]])];for(let b=0;b<y-1;b++)_.push(v2e(v[b-1]||v[b],v[b],v[b+1]||v[b]));return _}(o);this.inkRenderSteps[n-1]=h}else this.pathDirty&&(this.reset(),p.forEach((n,o)=>{if(0===n.length)return;let h=[...n];1===n.length?h=this.offsetPoints(n[0],.1):(h=d2(h,0,h.length-1,1),h.length<=3&&h.push(Ke({},h[h.length-1]))),this.inkPaths[o]=h;const v=_5(h,h.length);this.inkSteps[o]=v.map(b=>b.ops).flat(2);const y=this.getRenderPath(h),_=_5(y,y.length).map(b=>b.ops).flat(2);this.inkRenderSteps[o]=_}));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:o,y:h}=p;return[{x:o-n,y:h-n},{x:o+n,y:h-n},{x:o+n,y:h+n},{x:o-n,y:h+n}]}getRenderStep(p){return p.map(n=>zt(Ke({},n),{data:this.getRenderPath(n.data)}))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:p}=this.parsedStyle,n=[];for(let o=0;o<p.length;o++){const h=this.getRenderPath(p[o]);n.push(h)}this.inkOriginalRenderPath=n}getRenderPath(p){const{x:n,y:o}=this.getBoundingRect(),h=[];return p.forEach(v=>{!v||Number.isNaN(v.x)||Number.isNaN(v.y)||h.push({x:v.x-n,y:v.y-o})}),h}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p}=this.parsedStyle,n=[],o=[];this.parsedStyle.segments.forEach(w=>{w.forEach(I=>{I&&(n.push(I.x),o.push(I.y))})});const{min:h,max:v}=iZ(n),{min:y,max:_}=iZ(o),b=p.value/2;return this.boundsDirty=!1,this.bounds={x:h-b,y:y-b,width:v-h+2*b,height:_-y+2*b},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,n))return!1;const{borderWidth:o}=this.parsedStyle;for(let h=0;h<this.inkSteps.length;h++){const v=this.inkSteps[h];for(let y=1;y<v.length;y+=2){const _=v[y-1].data[0],b=v[y].data[0],w=v[y].data[1];if(g2e(_.x,_.y,b.x,b.y,w.x,w.y).isHit([p.x,p.y],o.value+n))return!0}}return!1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[]}};function iZ(p){if(0===p.length)return{min:void 0,max:void 0};let n=p[0],o=p[0];for(let h=1;h<p.length;h++)p[h]<n&&(n=p[h]),p[h]>o&&(o=p[h]);return{min:n,max:o}}function rZ(p,n){return{x:n.x-p.x,y:n.y-p.y}}function oZ(p){return Math.sqrt(p.x*p.x+p.y*p.y)}function _2e(p,n){const o=(y=p).x*(_=n).x+y.y*_.y,h=oZ(p),v=oZ(n);var y,_;return Math.acos(o/(h*v))}let m2=class extends gs{constructor(){let _=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=_,n=ic(_,["style"]);super(Ke({type:"polygon",style:Ke(zt(Ke({},eu),{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2}),p)},n)),W(this,"shapeType","polygon"),W(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:o,y:h,width:v,height:y}=this.getBoundingRect();this.updatePosition(o,h),this.setOrigin(v/2,y/2)}addPoint(p){const n=[...this.style.points];n.push(p),this.style.points=n}updatePoints(){const{renderPath:p}=this,n=this.getLocalPosition(),o=[];p.forEach(h=>{o.push({x:h.x+n.x,y:h.y+n.y})}),this.style.points=o}getPath(){if(!this.pathDirty)return this.path;const{x:p,y:n}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map(o=>({x:o.x-p,y:o.y-n})),this.steps=O_(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,points:n,lineCap:o}=this.parsedStyle;if(2===n.length)return this.boundsDirty=!1,this.bounds=iw(n[0],n[1],p.value,o),this.bounds;const h=wp(n),v=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:h.left-v,y:h.top-v,width:h.width+2*v,height:h.height+2*v},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,n))return!1;const{borderWidth:o,points:h}=this.parsedStyle,v=Sn(this.style.background)&&""!==this.style.background;let _=!1;return o&&o.value&&(_=YQ(h,o.value+(v?0:n),p.x,p.y,!0)),!_&&v&&(_=function(b,w,I){let A=!1;const M=b.length;if(M<=2)return!1;for(let Q=0;Q<M;Q++){const J=b[Q],Z=b[(Q+1)%M];if(((B={x:w,y:I}).x-(F=J).x)*((V=Z).y-F.y)==(V.x-F.x)*(B.y-F.y)&&Math.min(F.x,V.x)<=B.x&&B.x<=Math.max(F.x,V.x)&&Math.min(F.y,V.y)<=B.y&&B.y<=Math.max(F.y,V.y))return!0;x5(J.y-I)>0!=x5(Z.y-I)>0&&x5(w-(I-J.y)*(J.x-Z.x)/(J.y-Z.y)-J.x)<0&&(A=!A)}var F,V,B;return A}(h,p.x,p.y)),_}},w5=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"polyline",style:Ke(zt(Ke({},eu),{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4}),p)},n)),W(this,"shapeType","polyline"),W(this,"renderPath",void 0),this.getPath();const{x:o,y:h}=this.getBoundingRect();this.updatePosition(o,h),this.updateOrigin()}initPath(){const{points:p,lineEnding:n}=this.parsedStyle,o=[];if(p.forEach((h,v)=>{o.push(0===v?{x:h.x,y:h.y,step:0,close:!1}:{x:h.x,y:h.y,step:1,close:!1})}),n&&o.length>1)for(let h=0;h<n.length;h++)switch(n[h]){case"OpenArrow":this.addOpenArrow(o,h,!1);break;case"ROpenArrow":this.addOpenArrow(o,h,!0);break;case"ClosedArrow":this.addCloseArrow(o,h,!1);break;case"RClosedArrow":this.addCloseArrow(o,h,!0);break;case"Butt":this.addButt(o,h);break;case"Slash":this.addSlash(o,h);break;case"Square":this.addSquare(o,h);break;case"Diamond":this.addDiamond(o,h);break;case"Circle":this.addCircle(o,h)}return o}getRenderPath(p){const{x:n,y:o}=this.getBoundingRect(),h=[];return p.forEach(v=>{!v||Number.isNaN(v.x)||Number.isNaN(v.y)||h.push({x:v.x-n,y:v.y-o,step:v.step,close:v.close})}),h}addPoint(p){const n=[...this.style.points];n.push(p),this.style.points=n}updatePoints(){const{length:p}=this.parsedStyle.points,n=this.getLocalPosition(),o=[];this.renderPath.slice(0,p).forEach(h=>{o.push({x:h.x+n.x,y:h.y+n.y})}),this.style.points=o}updatePoint(){const p=this.getLocalPosition(),n=this.parsedStyle.points.length,o=[];for(let h=0;h<n;h++)o.push({x:this.renderPath[h].x+p.x,y:this.renderPath[h].y+p.y});this.updateStyle({points:o})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=zQ(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:n}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=iw(this.path[0],this.path[1],p.value,n),this.bounds;const o=wp(this.path),h=p.value/2;return this.boundsDirty=!1,this.bounds={x:o.left-h,y:o.top-h,width:o.width+2*h,height:o.height+2*h},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,n))return!1;const{borderWidth:o,points:h}=this.parsedStyle;return YQ(h,o.value+n,p.x,p.y,!1)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addOpenArrow(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:h,borderWidth:v}=this.parsedStyle,{length:y}=h;let _=h[y-2],b=h[y-1];0===n&&(_=Ke({},h[0]),b=Ke({},h[1])),XQ(p,n,o,_,b,v.value)}addCloseArrow(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:h,borderWidth:v}=this.parsedStyle,{length:y}=h;let _=h[y-2],b=h[y-1];0===n&&(_=Ke({},h[0]),b=Ke({},h[1])),$Q(p,n,o,_,b,v.value)}addCircle(p,n){const{points:o,borderWidth:h}=this.parsedStyle,{length:v}=o;ZQ(p,n,o[0],o[v-1],h.value)}addDiamond(p,n){const{points:o,borderWidth:h}=this.parsedStyle,{length:v}=o;QQ(p,n,o[0],o[v-1],h.value)}addSquare(p,n){const{points:o,borderWidth:h}=this.parsedStyle,{length:v}=o;JQ(p,n,o[0],o[v-1],h.value)}addSlash(p,n){const{points:o,borderWidth:h}=this.parsedStyle,{length:v}=o;let y=o[v-2],_=o[v-1];0===n&&(y=Ke({},o[0]),_=Ke({},o[1])),KQ(p,n,y,_,h.value)}addButt(p,n){const{points:o,borderWidth:h}=this.parsedStyle,{length:v}=o;let y=o[v-2],_=o[v-1];0===n&&(y=Ke({},o[0]),_=Ke({},o[1])),qQ(p,n,y,_,h.value)}},ms=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"rect",style:Ke(zt(Ke({},eu),{width:0,height:0}),p)},n)),W(this,"shapeType","rect");const{x:o,y:h}=this.parsedStyle;this.setLocalPosition(o,h),this.updateOrigin()}getPath(){if(!this.pathDirty)return this.path;const{width:p,height:n,borderWidth:o}=this.parsedStyle,h=(null==o?void 0:o.value)||0,_=p.value-2*h,b=n.value-2*h;return this.path=[{x:h,y:h},{x:h+_,y:h},{x:h+_,y:h+b},{x:h,y:h+b}],this.steps=O_(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:p,height:n,borderWidth:o}=this.parsedStyle,h=.5*((null==o?void 0:o.value)||0),_=p.value-2*h,b=n.value-2*h;this.strokePath=[{x:h,y:h},{x:h+_,y:h},{x:h+_,y:h+b},{x:h,y:h+b}],this.strokeSteps=O_(this.strokePath)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:n,width:o,height:h}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:p,y:n,width:o.value,height:h.value},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:o,y:h,borderWidth:v,width:y,height:_}=this.parsedStyle,b=Sn(this.style.background)&&""!==this.style.background,w=v&&v.value,I=n/2;return b?L_(o,h,y.value,_.value,p.x,p.y):!!w&&(V=_.value+n,L_(A=o-I,M=h-I,F=y.value+n,B=v.value+n,Q=p.x,J=p.y)||L_(A,M,B,V,Q,J)||L_(A,M+V-B,F,B,Q,J)||L_(A+F-B,M,B,V,Q,J));var A,M,F,V,B,Q,J}},rw=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"text",style:Ke(zt(Ke({},eu),{text:"",width:300,wordWarp:!0,wordBreak:!0,textAlign:"left",textBaseLine:"top",textTransform:"none",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:1,letterSpacing:0}),p)},n)),W(this,"shapeType","text"),W(this,"font",void 0),W(this,"lines",[]),W(this,"chars",[]),W(this,"underlines",[]),W(this,"strikeouts",[]),W(this,"textX",void 0),W(this,"textY",void 0),W(this,"rowWidth",void 0),W(this,"realWidth",void 0),W(this,"totalHeight",void 0),this.setTextFont(),this.calculateTextPosition(),this.calculateLineWarp(),this.calculateCharPosition();const{x:o,y:h}=this.parsedStyle;this.setLocalPosition(o,h),this.updateOrigin()}setTextFont(){const{fontStyle:p,fontVariant:n,fontWeight:o,fontFamily:h,fontSize:v}=this.parsedStyle;this.font=`${p} ${n} ${o} ${v.value}${v.unit} ${h}`}updateOrigin(){if(!this.chars[0])return;const{width:p,height:n}=this.getBoundingRect(),o=this.chars[0].height/10||0,h=this.chars[0].height/2||0;let v=0;switch(this.parsedStyle.textBaseLine){case"top":v=n/2-o;break;case"hanging":v=n/2;break;case"middle":v=h*(this.lines.length-1)-o;break;case"ideographic":v=1.5*-o+h*(this.lines.length-2);break;case"bottom":v=h*(this.lines.length-2)-o;break;default:v=o+h*(this.lines.length-2)}this.setOrigin(p/2-o,v)}calculateTextPosition(){const{x:p,y:n,width:o,letterSpacing:h,borderWidth:v}=this.parsedStyle,y=((null==v?void 0:v.value)||0)/2;this.textX=p+y+h.value,this.textY=n+y+h.value,this.rowWidth=o.value-2*y-2*h.value}calculateLineWarp(){this.totalHeight=0,this.realWidth=0;const{textX:p,rowWidth:n,parsedStyle:o}=this,{lineHeight:h,wordWarp:v,fontSize:y,borderWidth:_}=o,b=document.createElement("canvas").getContext("2d");b.font=this.font;const w=Math.max(y.value,h),I=this.transformText(this.parsedStyle.text);I.length||(this.lines=[],this.totalHeight=0);let A=0;if(I.length){const M=[];let{textY:F}=this,V="";for(let B=0;B<I.length;B++){const Q=I.charAt(B);if("\n"!==Q&&"\r"!==Q){if(V+=Q,b.measureText(V).width>=n&&v){if(V=V.substring(0,V.length-1),""===V){V=Q;continue}A+=V.length;const J=b.measureText(V).width;J>this.realWidth&&(this.realWidth=b.measureText(V).width),M.push({text:V,x:p,y:F,lineWidth:J,length:V.length,sum:A}),V=Q,F+=w,this.totalHeight+=w}}else{const J=b.measureText(V).width;J>this.realWidth&&(this.realWidth=b.measureText(V).width),V+=Q,A+=V.length,M.push({text:V,x:p,y:F,lineWidth:J,length:V.length,sum:A}),V="",F+=w,this.totalHeight+=w}}if(""!==V){A+=V.length;const B=b.measureText(V).width;B>this.realWidth&&(this.realWidth=b.measureText(V).width),M.push({text:V,x:p,y:F,lineWidth:B,length:V.length,sum:A})}this.totalHeight+=w,this.lines=M}1===this.lines.length&&(this.realWidth=b.measureText(this.lines[0].text).width),_&&_.value&&(this.realWidth+=_.value)}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:p,y:n,textBaseLine:o,fontSize:h,lineHeight:v}=this.parsedStyle,y=h.value>v?h.value:v,_=sZ(o,n,y),b=y/10;return this.boundsDirty=!1,this.bounds={x:p-b,y:_-b,width:this.realWidth+2*b,height:this.totalHeight},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getBoundingRectObject().isPointInPath(p,n)}calculateCharPosition(){this.chars=[];const{lines:p}=this,{fontSize:n,textBaseLine:o}=this.parsedStyle,h=document.createElement("canvas").getContext("2d"),v=n.value;h.font=this.font;let y=0;p.forEach((_,b)=>{let w=_.x;for(let I=0;I<_.text.length;I++){const A=_.text.charAt(I);let{width:M}=h.measureText(A);"\n"!==A&&"\r"!==A||(M=.1),this.chars.push({char:A,index:y+I+1,charIndex:I+1,lineIndex:b,x:w,y:sZ(o,_.y,v),width:M,height:v}),w+=h.measureText(A).width,I===_.text.length-1&&(y+=_.text.length)}})}getCharByPosition(p,n){const o={x:p,y:n};for(let h=0;h<this.chars.length;h++)if(this.getCharBoundingRect(h).isPointInPath(o))return this.chars[h];return null}getCharBoundingRect(p){const{x:n,y:o,width:h,height:v}=this.chars[p];return new ms({style:{x:n,y:o-v/10,width:h,height:v,borderWidth:1,background:"transparent"}})}transformText(p){const{textTransform:n}=this.parsedStyle;switch(n){case"capitalize":p=p[0].toUpperCase()+p.substring(1);break;case"uppercase":p.toLowerCase();break;case"lowercase":p.toUpperCase()}return p}getRelativeYAxis(p){const{height:n}=this.chars[0];return p-this.getTextBaseLineOffset(n)}getTextBaseLineOffset(p){const{textBaseLine:n}=this.parsedStyle,o=p/10;let h;switch(n){case"top":h=o;break;case"hanging":h=0;break;case"middle":h=p/2+o;break;case"ideographic":h=p+1*o;break;case"bottom":h=p+.5*o;break;default:h=p-1.5*o}return h}};function sZ(p,n,o){let h;const v=o/10;switch(p){case"top":h=n-.5*v;break;case"hanging":h=n+.5*v;break;case"middle":h=n-o/2-.5*v;break;case"ideographic":h=n-o-.5*v;break;case"bottom":h=n-o;break;default:h=n+2*v-o}return h}class v2 extends gs{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:n}=h,o=ic(h,["style"]);super(Ke({type:"stampPath",style:Ke(zt(Ke({},eu),{stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4}),n)},o)),W(this,"shapeType","stampPath"),W(this,"renderPath",void 0),this.getPath()}getRenderPath(n){const{x:o,y:h}=this.getBoundingRect(),v=[];return n.forEach(y=>{!y||Number.isNaN(y.x)||Number.isNaN(y.y)||v.push({x:y.x-o,y:y.y-h,step:y.step})}),v}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(n){if(n.length<1)return[];const o=[];for(let h=0;h<n.length;h++){const v=n[h];0===v.step?o.push(Ys("lineTo",[v])):1===v.step?h+2<n.length&&1===n[h+1].step&&1===n[h+2].step&&(o.push(Ys("bezierCurveTo",[v,n[h+1],n[h+2]])),h+=2):2===v.step&&o.push(Ys("moveTo",[v]))}return o}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:n,stampPoints:o,lineCap:h}=this.parsedStyle;if(2===o.length)return this.boundsDirty=!1,this.bounds=iw(o[0],o[1],n.value,h),this.bounds;const v=wp(o),y=n.value/2;return this.boundsDirty=!1,this.bounds={x:v.left-y,y:v.top-y,width:v.width+2*y,height:v.height+2*y},this.bounds}}let S5=class extends gs{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=v,n=ic(v,["style"]);super(Ke({type:"line",style:Ke(zt(Ke({},eu),{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2}),p)},n)),W(this,"shapeType","line"),W(this,"renderPath",void 0),this.getPath();const{x:o,y:h}=this.getBoundingRect();this.updatePosition(o,h),this.updateOrigin()}initPath(){const{startPoint:p,endPoint:n,lineEnding:o}=this.parsedStyle,h=[zt(Ke({},p),{step:0,close:!1}),zt(Ke({},n),{step:1,close:!1})];if(o)for(let v=0;v<o.length;v++)switch(o[v]){case"OpenArrow":this.addOpenArrow(h,v,!1);break;case"ROpenArrow":this.addOpenArrow(h,v,!0);break;case"ClosedArrow":this.addCloseArrow(h,v,!1);break;case"RClosedArrow":this.addCloseArrow(h,v,!0);break;case"Butt":this.addButt(h,v);break;case"Slash":this.addSlash(h,v);break;case"Square":this.addSquare(h,v);break;case"Diamond":this.addDiamond(h,v);break;case"Circle":this.addCircle(h,v)}return h}getRenderPath(p){const{x:n,y:o}=this.getBoundingRect(),h=[];return p.forEach(v=>{!v||Number.isNaN(v.x)||Number.isNaN(v.y)||h.push({x:v.x-n,y:v.y-o,step:v.step,close:v.close})}),h}updatePoints(){const p=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+p.x,y:this.renderPath[0].y+p.y},endPoint:{x:this.renderPath[1].x+p.x,y:this.renderPath[1].y+p.y}})}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=zQ(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:p,lineCap:n}=this.parsedStyle,o=wp(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=iw(this.path[0],this.path[1],p.value,n),this.bounds;const h=p.value/2||0;return this.boundsDirty=!1,this.bounds={x:o.left-h,y:o.top-h,width:o.width+2*h,height:o.height+2*h},this.bounds}isPointInPath(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(p,n))return!1;const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;return g2(o,h,v.value+n,p)}isLineArrow(){const{lineEnding:p}=this.parsedStyle;return!!p&&("None"!==p[0]||"None"!==p[1])}addCircle(p,n){const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;ZQ(p,n,o,h,v.value)}addDiamond(p,n){const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;QQ(p,n,o,h,v.value)}addSquare(p,n){const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;JQ(p,n,o,h,v.value)}addSlash(p,n){const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;KQ(p,n,o,h,v.value)}addButt(p,n){const{startPoint:o,endPoint:h,borderWidth:v}=this.parsedStyle;qQ(p,n,o,h,v.value)}addOpenArrow(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:h,endPoint:v,borderWidth:y}=this.parsedStyle;XQ(p,n,o,h,v,y.value)}addCloseArrow(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:h,endPoint:v,borderWidth:y}=this.parsedStyle;$Q(p,n,o,h,v,y.value)}},C2e=class extends ms{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:p}=o,n=ic(o,["style"]);super(Ke({type:"stamp",style:zt(Ke({},p),{background:"transparent",borderColor:"transparent"})},n)),W(this,"shapeType","stamp"),W(this,"stampConfig",[]),W(this,"stampItemShapes",[]),W(this,"renderType","stamp"),W(this,"initialWidth",0),W(this,"initialHeight",0),this.stampConfig=p.stampConfig||[]}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle())}initStampItem(){if(!Di(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:p,stampItemShapes:n}=this,{renderBlendMode:o}=this.parsedStyle;for(let h=0;h<p.length;h++){let v;"path"===p[h].type&&(v=new v2({style:Ke({opacity:this.style.opacity,renderBlendMode:o},p[h])})),"text"===p[h].type&&(v=new rw({style:Ke({opacity:this.style.opacity,renderBlendMode:o},p[h])})),"image"===p[h].type&&(v=new Wv({style:Ke({opacity:this.style.opacity,renderBlendMode:o},p[h])})),v&&n.push(v)}}initStampStyle(){if(!Di(this.stampConfig))return;const p=[],n=[],{stampItemShapes:o}=this;for(let h=0;h<o.length;h++){const v=o[h];if(!(v instanceof rw)){const y=v.getBoundingRect();p.push(y.x,y.x+y.width),n.push(y.y,y.y+y.height)}this.appendChild(v)}this.initialWidth=Math.max(...p)-Math.min(...p),this.initialHeight=Math.max(...n)-Math.min(...n),this.updateStyle({x:Math.min(...p),y:Math.min(...n),width:this.initialWidth,height:this.initialHeight});for(let h=0;h<o.length;h++){const v=o[h].getBoundingRect();o[h].setLocalPosition(v.x-this.style.x,v.y-this.style.y)}this.updateOrigin()}isPointInPath(p,n){return super.isPointInPath(p,0)}};class T5 extends gs{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:n}=y,o=ic(y,["style"]);super(Ke({type:"roundedRect",style:Ke(zt(Ke({},eu),{roundedRadius:0,width:0,height:0}),n)},o)),W(this,"shapeType","roundedRect");const{x:h,y:v}=this.parsedStyle;this.setLocalPosition(h,v),this.updateOrigin()}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:n,y:o,width:h,height:v}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:n,y:o,width:h.value,height:v.value},this.bounds}isPointInPath(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:h,y:v,width:y,height:_,borderWidth:b}=this.parsedStyle,w=(b.value+o||0)/2;return L_(h-w,v-w,y.value+2*w,_.value+2*w,n.x,n.y)}getCenterPosition(){const{width:n,height:o}=this.parsedStyle,h=new em({style:{x:n.value/2,y:o.value/2}});this.appendChild(h);const{x:v,y}=h.getPosition();return h.destroy(),{x:v,y}}}class aZ extends gs{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{style:n}=y,o=ic(y,["style"]);super(Ke({type:"freeText",style:Ke(zt(Ke({},eu),{width:0,height:0,textAlign:"left"}),n)},o)),W(this,"shapeType","freeText"),W(this,"lines",void 0),W(this,"textType","textBox"),W(this,"renderClipPath",void 0),W(this,"renderClipStep",void 0),W(this,"totalTextHeight",0),W(this,"limitWidth",1),W(this,"textMaxWidth",0),W(this,"borderOffset",0),W(this,"padding",1),this.textType=n.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateContentLines();const{x:h,y:v}=this.parsedStyle;this.setLocalPosition(h,v),this.updateOrigin()}getLimitTextWithoutSpace(n,o){const{textContents:h}=this.parsedStyle,v=pn(n),_=v.segmentation[v.segmentation.length-1],b=Ku(" ",h[_.freeContentIndex]),w=_.text.split(" ").length-1;let I;for(let A=0;A<w&&(I=A+1,!(v.width-I*b<o));A++);for(let A=0;A<I;A++)v.word=v.word.slice(0,-1),v.width-=b,_.text=_.text.slice(0,-1),_.width-=b;return v}splitWordSegment(n,o){const h=n,v=[],y=[];let _=o;const b=h.segmentation.length;for(let I=0;I<b;I++){const A=h.segmentation[I];if(!(A.width<_)){if(A.width===_){v.push(Ke({},A)),y.push(...h.segmentation.slice(b-I-1));break}{const M=this.parsedStyle.textContents[A.freeContentIndex],F=b2e(A.text,_,M);2===F.length?(v.push({text:F[0],width:Ku(F[0],M),freeContentIndex:A.freeContentIndex}),y.push({text:F[1],width:Ku(F[1],M),freeContentIndex:A.freeContentIndex})):y.push(Ke({},A));const V=b-I-1;V>0&&y.push(...h.segmentation.slice(-V));break}}v.push(Ke({},A)),_-=A.width}const w=I=>{let A="",M=0;return I.forEach(F=>{A+=F.text,M+=F.width}),{word:A,width:M,segmentation:I}};return 0===v.length?[w(y)]:[w(v),w(y)]}getWordSegmentation(){const{textContents:n}=this.parsedStyle;let o="";const h=[0];n.forEach(w=>{o+=w.content,h.push(o.length)});const v=o.match(/\S+\s*/g)||[],y=[];let _=0;const b=function(w){const A=w.match(/^(?:\r\n|\r|\n)*/);if(A){const M=A[0];let F=0;for(const V of M)"\n"!==V&&"\r"!==V||(F+=1);return M.includes("\r\n")&&(F-=1),Array.from({length:F},()=>"\n")}return[]}(o);if(b.length&&v.unshift(...b)," "===o[0]){const w=o.match(/^ +/)[0];v[0]=v[0]?w+v[0]:w}for(let w=0;w<v.length;w++){const I=v[w].split(/(\r\n|[\r\n])/).filter(A=>""!==A);I.length>2&&(v[w]=I[0]+I[1],v.splice(w+1,0,...I.slice(2)))}return v.forEach(w=>{const I=_+w.length-1,A=[...h.filter(M=>M>_&&M<=I)];if(0===A.length){const M=h.filter(V=>V<=_).length,F=Ku(w,n[M-1]);y.push({word:w,segmentation:[{text:w,width:F,freeContentIndex:M-1}],width:F})}else{const M=[];let F=0;A.forEach((V,B)=>{const Q=V-(A[B-1]||_),J=A[B-1]-_||0,Z=w.substring(J,J+Q),re=Ku(Z,n[h.indexOf(V)-1]);if(M.push({text:Z,width:re,freeContentIndex:h.indexOf(V)-1}),F+=re,B===A.length-1){const se=Ku(w.substring(J+Q),n[h.indexOf(V)]);M.push({text:w.substring(J+Q),freeContentIndex:h.indexOf(V),width:se}),F+=se}}),y.push({word:w,width:F,segmentation:M})}_+=w.length}),y}organizeLine(){if(0===this.lines.length)return;const{y:n}=this.parsedStyle;let o=n+this.borderOffset+this.padding,h=0,v=0;this.lines.forEach((y,_)=>{v=0,h=Math.max(y.width,h);let b=0,w="";if(0===y.width&&""===y.words[0].text){const I=Ku(" ",y.words[0].style);y.width=I,y.words[0].wordWidth=I,y.words[0].text=" "}if(y.words.forEach(I=>{w+=I.text,b=Math.max(b,I.wordHeight),I.widthWithoutLf=ow(I.text)?Ku(I.text,I.style,!0):I.wordWidth,v+=I.widthWithoutLf}),"textBox"===this.textType&&"justify"===this.style.textAlign&&_!==this.lines.length-1){const I=[],A=/\b\w/g;let M,F=0;for(;null!==(M=A.exec(w));)I.push(M.index);if(I.length>1){const V=(this.limitWidth-v)/(I.length-1),B=Q=>{for(let J=0;J<I.length;J++)if(I[J]>Q)return J;return I.length};y.words.forEach((Q,J)=>{J>0&&(Q.x+=V*(B(F)-1)),F+=Q.text.length}),v=this.limitWidth,y.width=this.limitWidth}}y.widthWithoutLF=v,y.height=b,y.y=.8*b+o,o+=b,_>0&&(y.y+=.2*this.lines[_-1].height,o+=.2*this.lines[_-1].height)}),this.textMaxWidth=h}getTextAlignOffset(n){if("freeTextWriter"===this.textType)return 0;const{limitWidth:o}=this,{textAlign:h}=this.parsedStyle,v=n?n.widthWithoutLF:0;let y=0;return"center"===h?y=(o-v)/2:"right"===h&&(y=o-v),y}getPath(){var n;if(!this.pathDirty)return this.path;const{width:o,height:h}=this.getBoundingRect(),v=.5*((null===(n=this.parsedStyle.borderWidth)||void 0===n?void 0:n.value)||0),y=v,_=v,b=o-2*v,w=h-2*v;if(this.path=[{x:y,y:_},{x:y+b,y:_},{x:y+b,y:_+w},{x:y,y:_+w}],this.borderOffset){const I=this.borderOffset/2;this.renderClipPath=[{x:y+I,y:_+I},{x:y+b-I,y:_+I},{x:y+b-I,y:_+w-I},{x:y+I,y:_+w-I}],this.renderClipStep=O_(this.renderClipPath)}return this.steps=O_(this.path),this.pathDirty=!1,this.path}setLimitWidth(n){const{borderWidth:o,borderColor:h}=this.parsedStyle;"textBox"===this.textType&&o.value&&!h.isNone&&(this.borderOffset=o.value,this.padding=o.value),this.limitWidth=n-2*this.borderOffset-2*this.padding}calculateContentLines(){const{textContents:n,x:o}=this.parsedStyle;if(null==n||!n.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const h=this.getWordSegmentation(),v=[],y=o+this.borderOffset+this.padding;let _=y,b=0,w=[];const I=function(F){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F;F.segmentation.forEach((B,Q)=>{const J=n[B.freeContentIndex];w.push({text:B.text,originText:V.segmentation[Q].text,freeContentIndex:B.freeContentIndex,x:_,wordWidth:B.width,wordHeight:J.fontSize.value,style:J}),_+=B.width,b+=B.width})},A=()=>{0!==w.length&&(v.push({words:w,width:b,x:y}),_=y,b=0,w=[])},M=(F,V)=>{if(F.width<=V)I(F),ow(F.word)&&A();else{const B=this.getLimitTextWithoutSpace(F,V);if(B.width<=V)I(B,F);else{const Q=this.splitWordSegment(F,V);if(2===Q.length){const J=Q[1].word;"\r"!==J&&"\n"!==J&&"\r\n"!==J?(I(Q[0]),A(),M(Q[1],V)):(I(F),A())}else{const J=Ku(F.word[0],n[F.segmentation[0].freeContentIndex]),Z=this.splitWordSegment(F,J+.1);I(Z[0]),A(),M(Z[1],V)}}}};h.forEach(F=>{const V=this.limitWidth-b;if(F.width<=V)I(F),ow(F.word)&&A();else{const B=this.getLimitTextWithoutSpace(F,V);B.width>V?F.width>this.limitWidth?(A(),M(F,this.limitWidth)):(A(),I(F),ow(F.word)&&A()):(I(B,F),A())}}),A(),this.lines=v,this.organizeLine(),this.calculateTotalHeight()}calculateTotalHeight(){const{y:n,height:o}=this.parsedStyle,h=this.lines.length;if(h){const v=this.lines[h-1];let y=v.y+.2*v.height+-n+2*this.borderOffset;ow(v.words[0].text)&&(y+=1.2*v.height),this.totalTextHeight=y>o.value?y:o.value}else this.totalTextHeight=o.value}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:n,y:o,height:h}=this.parsedStyle;let v=h.value,y=this.limitWidth+2*this.borderOffset+2*this.padding;return"freeTextWriter"===this.textType?(y=this.textMaxWidth+2*this.borderOffset+2*this.padding,v=this.totalTextHeight):y=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:n,y:o,width:y,height:v},this.bounds}isPointInPath(n){return this.getBoundingRectObject().isPointInPath(n)}}function Ku(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:h,fontStyle:v,fontFamily:y,fontWeight:_}=n,b=document.createElement("canvas").getContext("2d"),w=""===(null==y?void 0:y.trim())?"sans-serif":y;b.font=null!=y&&y.includes(" ")?`${v} ${_} ${h.value}${h.unit} '${w}'`:`${v} ${_} ${h.value}${h.unit} ${w}`;let I=0;for(let A=0;A<p.length;A++){const M=p.charAt(A);o&&x2e(M)||(I+=b.measureText(M).width)}return I}function b2e(p,n,o){let h=0;for(let v=0;v<p.length;v++)if(Ku(p.substring(0,v+1),o)>n){h=v;break}return 0===h?[p]:[p.substring(0,h),p.substring(h)]}function x2e(p){return/^[\r\n]+$/.test(p)}function ow(p){return p.endsWith("\n")||p.endsWith("\r")||p.endsWith("\r\n")}const y2=1/0;class Hl{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y2,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y2,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;W(this,"minX",void 0),W(this,"maxX",void 0),W(this,"minY",void 0),W(this,"maxY",void 0),W(this,"rect",void 0),W(this,"updateId",void 0),this.minX=n,this.maxX=o,this.minY=h,this.maxY=v,this.rect=null,this.updateId=-1}static isEmpty(n){return n.minX===n.maxX&&n.minY===n.maxY}static fromBounds(n){return(new Hl).setFromBounds(n)}static create(){return new Hl}setFromBounds(n){return this.minX=n.minX,this.minY=n.minY,this.maxX=n.maxX,this.maxY=n.maxY,this}clear(){return this.minX=y2,this.maxX=-1/0,this.minY=y2,this.maxY=-1/0,this}getRect(n){const{minX:o,minY:h,maxX:v,maxY:y}=this;if(o>v||h>y)return new vQ(0,0,0,0);const _=n||new vQ;return _.update(o,h,v-o,y-h),_}addPoint(n){return this.addBounds({minX:n.x,maxX:n.x,minY:n.y,maxY:n.y})}addBounds(n){const o=I5(this,n);return this.setFromBounds(o)}addBoundsMask(n,o){const h=lZ(n,o);if(h.minX<=h.maxX&&h.minY<=h.maxY){const v=I5(h,this);this.setFromBounds(v)}return this}intersection(n){if(!((o=this).minX<=(h=n).maxX&&o.maxX>=h.minX&&o.minY<=h.maxY&&o.maxY>=h.minY))return null;var o,h;const v=lZ(this,n);return Hl.fromBounds(v)}union(n){const o=I5(this,n);return Hl.fromBounds(o)}addBoundsArea(n,o){const{x:h,y:v,width:y,height:_}=o;return this.addBoundsMask(n,{minX:h,minY:v,maxX:h+y,maxY:v+_})}addFrame(n,o){return this.setFromTransformedBounds(n.worldTransform,o)}setFromTransformedBounds(n,o){for(let h=0;h<2;h++){const v=n.transformPoint({x:h?o.maxX:o.minX,y:h?o.maxY:o.minY});this.addPoint(v)}return this}addQuad(n){for(let o=0;o<4;o++)this.addPoint({x:n[2*o],y:n[2*o+1]})}}function lZ(p,n){return{minX:p.minX>n.minX?p.minX:n.minX,minY:p.minY>n.minY?p.minY:n.minY,maxX:p.maxX<n.maxX?p.maxX:n.maxX,maxY:p.maxY<n.maxY?p.maxY:n.maxY}}function I5(p,n){return{minX:p.minX<n.minX?p.minX:n.minX,minY:p.minY<n.minY?p.minY:n.minY,maxX:p.maxX>n.maxX?p.maxX:n.maxX,maxY:p.maxY>n.maxY?p.maxY:n.maxY}}class w2e extends gs{constructor(){super({}),W(this,"name","Document"),W(this,"defaultView",void 0),W(this,"documentElement",void 0),W(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new gs({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement]}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(n,o){return new(this.defaultView.customElements.get(n))(o)}getElementById(n){return null}getElementsByName(n){return this.documentElement.getElementsByTagName(n)}getElementsByTagName(n){return this.documentElement.getElementsByTagName(n)}getElementsByClassName(n){return this.documentElement.getElementsByClassName(n)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(n){return this.documentElement.querySelector(n)}querySelectorAll(n){return this.documentElement.querySelectorAll(n)}find(n){return this.documentElement.find(n)}findAll(n){return this.documentElement.findAll(n)}appendChild(n){return this.documentElement.appendChild(n)}cloneNode(n){return this.documentElement.cloneNode(n)}insertBefore(n,o){return this.documentElement.insertBefore(n,o)}removeChild(n){return this.documentElement.removeChild(n)}replaceChild(n,o){return this.documentElement.replaceChild(n,o)}destroy(){}}class cZ extends Jx{constructor(){super(...arguments),W(this,"altKey",void 0),W(this,"button",void 0),W(this,"buttons",void 0),W(this,"ctrlKey",void 0),W(this,"metaKey",void 0),W(this,"shiftKey",void 0),W(this,"relatedTarget",void 0),W(this,"client",new Rr),W(this,"movement",new Rr),W(this,"offset",new Rr),W(this,"page",new Rr),W(this,"screen",new Rr),W(this,"global",new Rr),W(this,"canvas",new Rr)}initEvent(n,o,h){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(n){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(n)}initMouseEvent(n,o,h,v,y,_,b,w,I,A,M,F,V,B,Q){throw this.initUIEvent(n,h,h,v,y),new Error("initMouseEvent() DOM API is deprecated.")}}function E5(p,n){n.altKey=p.altKey,n.button=p.button,n.buttons=p.buttons,n.ctrlKey=p.ctrlKey,n.metaKey=p.metaKey,n.shiftKey=p.shiftKey,n.relatedTarget=null,n.client.setFromPoint(p.client),n.movement.setFromPoint(p.movement),n.offset.setFromPoint(p.offset),n.page.setFromPoint(p.page),n.screen.setFromPoint(p.screen),n.global.setFromPoint(p.global),n.canvas.setFromPoint(p.canvas)}class D5 extends cZ{constructor(){super(...arguments),W(this,"deltaMode",void 0),W(this,"deltaX",void 0),W(this,"deltaY",void 0),W(this,"deltaZ",void 0),W(this,"DOM_DELTA_PIXEL",0),W(this,"DOM_DELTA_LINE",1),W(this,"DOM_DELTA_PAGE",2)}}function uZ(p,n){n.deltaMode=p.deltaMode,n.deltaX=p.deltaX,n.deltaY=p.deltaY,n.deltaZ=p.deltaZ}class tm extends cZ{constructor(n){super(n),W(this,"height",0),W(this,"isPrimary",void 0),W(this,"pointerId",void 0),W(this,"pointerType",void 0),W(this,"pressure",void 0),W(this,"tangentialPressure",void 0),W(this,"tiltX",void 0),W(this,"tiltY",void 0),W(this,"twist",void 0),W(this,"width",0),W(this,"getCoalescedEvents",void 0),W(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0}}function A5(p,n){n.isPrimary=p.isPrimary,n.width=p.width,n.height=p.height,n.tiltX=p.tiltX,n.tiltY=p.tiltY,n.pointerType=p.pointerType,n.pointerId=p.pointerId,n.pressure=p.pressure,n.twist=p.twist,n.tangentialPressure=p.tangentialPressure}class S2e{constructor(n,o){W(this,"root",void 0),W(this,"cursor","default"),W(this,"events",void 0),W(this,"trackingData",void 0),W(this,"contextService",void 0),this.root=n,this.contextService=o,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this))}clientToCanvas(n){const o=this.contextService.getBoundingClientRect();return new Rr(n.x-(o.x||0),n.y-(o.y||0))}canvasToClient(n){const o=this.root.defaultView.contextService.getBoundingClientRect();return new Rr(n.x+(o.x||0),n.y+(o.y||0))}getPropagationPath(n){const o=[n];for(;gs.isNode(n)&&n!==this.root;)o.push(n=n.parentNode);return o.reverse()}getHitTarget(n,o){const{root:h}=this,{isInteractive:v}=h,y=dZ(h,v,new Rr(n,o));return y?y[0]:null}on(n,o){this.events[n]||(this.events[n]=[]),this.events[n].push({fn:o,order:0}),this.events[n].sort((h,v)=>h.order-v.order)}emit(n){if(!this.root)return;const o=this.events[n.type]||[];for(let h=0;h<o.length;h++)o[h].fn(n)}onPointerdown(n){if(!(n instanceof tm))return;const o=this.generatePointerEvent(n);let h;Sa(o,"pointerdown"),"touch"===o.pointerType?h="touchstart":N_(o)&&(h=2===o.button?"rightdown":"mousedown"),Sa(o,h),this.getTrackingData(n.pointerId).pressTargetsByButton[n.button]=o.composedPath()}onPointermove(n){if(!(n instanceof tm))return;const o=this.generatePointerEvent(n),h=N_(o),v=this.getTrackingData(n.pointerId),y=P5(v.overTargets);if(y&&y!==o.target){const w=this.generatePointerEvent(n,"mousemove"===n.type?"mouseout":"pointerout",y);Sa(w,"pointerout"),h&&Sa(w,"mouseout");const I=o.composedPath();if(!I.includes(y)){const A=this.generatePointerEvent(n,"pointerleave",y);for(A.eventPhase=A.AT_TARGET;A.target&&!I.includes(A.target);)A.currentTarget=A.target,Zc(A,A.type),h&&Zc(A,"mouseleave"),A.target=A.target.parentNode}}if(y!==o.target){const w=this.clonePointerEvent(o,"mousemove"===n.type?"mouseover":"pointerover");Sa(w,"pointerover"),h&&Sa(w,"mouseover");let I=gs.isNode(y)&&(null==y?void 0:y.parentNode);for(;I&&I!==(gs.isNode(this.root)&&this.root.parentNode)&&I!==o.target;)I=I.parentNode;if(!I||I===this.root.parentNode){const A=this.clonePointerEvent(o,"pointerenter");for(A.eventPhase=A.AT_TARGET;A.target&&A.target!==y&&A.target!==this.root.parentNode;)A.currentTarget=A.target,Zc(A,A.type),h&&Zc(A,"mouseenter"),A.target=A.target.parentNode}}var _;Sa(o,"pointermove"),"touch"===o.pointerType&&Sa(o,"touchmove"),h&&(Sa(o,"mousemove"),this.cursor=null===(_=o.target)||void 0===_?void 0:_.cursor),v.overTargets=o.composedPath()}onPointerup(n){if(!(n instanceof tm))return;const o=performance.now(),h=this.generatePointerEvent(n);Sa(h,"pointerup");const{pointerType:v}=h;let y;"touch"===v?y="touchend":N_(h)&&(y=2===h.button?"rightup":"mouseup"),Sa(h,y);const _=this.getTrackingData(n.pointerId),b=P5(_.pressTargetsByButton[n.button]);let w=b;const I=h.composedPath();if(b&&!I.includes(b)){let A=b;for(;A&&!I.includes(A);)h.currentTarget=A,Zc(h,"pointerupoutside"),"touch"===v?y="touchendoutside":N_(h)&&(y=2===h.button?"rightupoutside":"mouseupoutside"),Zc(h,y),A=A.parentNode;delete _.pressTargetsByButton[n.button],w=A}if(w){const A=this.clonePointerEvent(h,"click");A.target=w,A.path=null,_.clicksByButton[n.button]||(_.clicksByButton[n.button]={clickCount:0,target:A.target,timeStamp:o});const M=_.clicksByButton[n.button];M.target===A.target&&o-M.timeStamp<200?M.clickCount+=1:M.clickCount=1,M.target=A.target,M.timeStamp=o,A.detail=M.clickCount,y="mouse"===v?"click":"touch"===v?"tap":"pointertap",Sa(A,y)}}onPointerout(n){if(!(n instanceof tm))return;const o=this.getTrackingData(n.pointerId);if(o.overTargets){const h=N_(n),v=P5(o.overTargets),y=this.generatePointerEvent(n,"pointerout",v);Sa(y),h&&Sa(y,"mouseout");const _=this.generatePointerEvent(n,"pointerleave",v);for(_.eventPhase=_.AT_TARGET;_.target&&_.target!==this.root.parentNode;)_.currentTarget=_.target,Zc(_,_.type),h&&Zc(_,"mouseleave"),_.target=_.target.parentNode;o.overTargets=null}this.cursor=null}onPointerover(n){if(!(n instanceof tm))return;const o=this.getTrackingData(n.pointerId),h=this.generatePointerEvent(n),v=N_(n);var y;Sa(h,"pointerover"),v&&Sa(h,"mouseover"),"mouse"===h.pointerType&&(this.cursor=null===(y=h.target)||void 0===y?void 0:y.cursor);const _=this.clonePointerEvent(h,"pointerenter");for(_.eventPhase=_.AT_TARGET;_.target&&_.target!==this.root.parentNode;)_.currentTarget=h.target,Zc(_,_.type),v&&Zc(_,"mouseenter"),_.target=_.target.parentNode;o.overTargets=h.composedPath()}onWheel(n){n instanceof D5&&Sa(this.generateWheelEvent(n))}generatePointerEvent(n,o,h){const v=new tm(this);return A5(n,v),E5(n,v),Qx(n,v),v.nativeEvent=n.nativeEvent,v.originalEvent=n,v.target=null!=h?h:this.getHitTarget(v.globalX,v.globalY),v.type=null!=o?o:v.type,v}generateWheelEvent(n){const o=new D5(this);return uZ(n,o),E5(n,o),Qx(n,o),o.nativeEvent=n.nativeEvent,o.originalEvent=n,o.target=this.getHitTarget(o.globalX,o.globalY),o}clonePointerEvent(n,o){const h=new tm(this);return A5(n,h),E5(n,h),Qx(n,h),h.nativeEvent=n.nativeEvent,h.originalEvent=n,h.target=n.target,h.path=n.composedPath().slice(),h}getTrackingData(n){return this.trackingData[n]||(this.trackingData[n]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[n]}}function N_(p){const{pointerType:n}=p;return"mouse"===n||"pen"===n}function P5(p){if(!p)return null;let n=p[0]||null;for(let o=1,h=p.length;o<h&&p[o].parentNode===n;o++)n=p[o];return n}function dZ(p,n,o){if(!p||"visible"!==p.style.visibility)return null;const{hitArea:h}=p.style;if(h){const{x:y,y:_}=p.transform.worldTransform.transformPoint(o);if(!h.contains(y,_))return null}const{clipPath:v}=p.style;if(v&&!v.containPoint(o))return null;if(p.isChildrenInteractive&&p.children){const{children:y}=p;for(let _=y.length-1;_>=0;_--){const b=y[_],w=dZ(b,n||b.isInteractive,o);if(w)return(w.length>0||p.isInteractive)&&w.push(p),w}}return n&&p.containPoint(o)?p.isInteractive?[p]:[]:null}W(class{constructor(){W(this,"canvasConfig",void 0),W(this,"contextService",void 0),W(this,"renderingContext",void 0),W(this,"eventService",void 0),W(this,"rootPointerEvent",new tm(null)),W(this,"rootWheelEvent",new D5(null)),W(this,"autoPreventDefault",!0)}init(p){const{renderingService:n,renderingContext:o,contextService:h,canvasConfig:v}=p;this.eventService=new S2e(o.root.parentNode,h),p.eventService=this.eventService,this.renderingContext=o,this.contextService=h,this.canvasConfig=v,n.hooks.wheel.on(this.onWheel),n.hooks.pointerdown.on(this.onPointerdown),n.hooks.pointermove.on(this.onPointermove),n.hooks.pointerup.on(this.onPointerup),n.hooks.pointerout.on(this.onPointermove),n.hooks.pointerover.on(this.onPointermove)}destroy(){}onWheel(p){const n=this.normalizeWheelEvent(p);this.eventService.emit(n)}onPointerdown(p){if(this.isTouchEvent(p))return;const n=this.normalizeToPointerEvent(p);this.autoPreventDefault&&n.isNormalized&&(p.cancelable||!("cancelable"in p))&&p.preventDefault();const o=this.bootstrapEvent(n,this.rootPointerEvent);this.eventService.emit(o),this.setCursor(this.eventService.cursor)}onPointermove(p){if(this.isTouchEvent(p))return;const n=this.normalizeToPointerEvent(p),o=this.bootstrapEvent(n,this.rootPointerEvent);this.eventService.emit(o),this.setCursor(this.eventService.cursor)}onPointerup(p){if(this.isTouchEvent(p))return;const n=this.contextService.getDomElement(),o=p.target===n?"":"outside",h=this.normalizeToPointerEvent(p),v=this.bootstrapEvent(h,this.rootPointerEvent);v.type+=o,this.eventService.emit(v),this.setCursor(this.eventService.cursor)}setCursor(p){this.contextService.setCursor(p||this.canvasConfig.cursor||"default")}normalizeWheelEvent(p){const n=this.rootWheelEvent;n.nativeEvent=p,this.transferMouseData(p,n),uZ(p,n);const o=new Rr(p.clientX,p.clientY),{x:h,y:v}=this.eventService.clientToCanvas(o);return n.canvas.x=h,n.canvas.y=v,n.offset.setFromPoint(n.canvas),n.global.setFromPoint(n.canvas),Qx(p,n),n}normalizeToPointerEvent(p){const n=this.renderingContext.root.ownerDocument.defaultView;if(n.supportTouchEvent&&p instanceof TouchEvent){const o=p;o.isNormalized=!0,o.pointerType="touch"}else if(!MouseEvent||p instanceof MouseEvent&&(!n.supportPointerEvent||!(p instanceof PointerEvent))){const o=p;o.isPrimary=!0,o.width=1,o.height=1,o.tiltX=0,o.tiltY=0,o.pointerType="mouse",o.pointerId=1,o.pressure=.5,o.twist=0,o.tangentialPressure=0,o.isNormalized=!0}return p}bootstrapEvent(p,n){n.originalEvent=null,n.nativeEvent=p,A5(p,n),this.transferMouseData(p,n);const{x:o,y:h}=this.eventService.clientToCanvas(new Rr(p.clientX,p.clientY));return n.canvas.x=o,n.canvas.y=h,n.offset.setFromPoint(n.canvas),n.global.setFromPoint(n.canvas),Qx(p,n),"pointerleave"===n.type&&(n.type="pointerout"),n.type.startsWith("mouse")&&n.type.replace("mouse","pointer"),n}transferMouseData(p,n){n.altKey=p.altKey,n.button=p.button,n.buttons=p.buttons,n.ctrlKey=p.ctrlKey,n.metaKey=p.metaKey,n.shiftKey=p.shiftKey,n.relatedTarget=null,n.client.x=p.clientX,n.client.y=p.clientY,n.movement.x=p.movementX,n.movement.y=p.movementY,n.page.x=p.pageX,n.page.y=p.pageY,n.screen.x=p.screenX,n.screen.y=p.screenY}isTouchEvent(p){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===p.pointerType}},"moduleName","Event");class Uv extends Jx{constructor(n,o,h,v,y,_,b,w){super(null),W(this,"relatedNode",void 0),W(this,"prevValue",void 0),W(this,"newValue",void 0),W(this,"attrName",void 0),W(this,"attrChange",void 0),W(this,"prevParsedValue",void 0),W(this,"newParsedValue",void 0),this.type=n,this.relatedNode=o,this.prevValue=h,this.newValue=v,this.attrName=y,this.attrChange=_,this.prevParsedValue=b,this.newParsedValue=w}}W(Uv,"ADDITION",2),W(Uv,"MODIFICATION",1),W(Uv,"REMOVAL",3);class I2e{constructor(n){W(this,"hooks",{init:Lo.create(),beginFrame:Lo.create(),beforeRender:Lo.create(),render:Lo.create(),afterRender:Lo.create(),putImageData:Lo.create(),endFrame:Lo.create(),destroy:Lo.create(),pointerdown:Lo.create(),pointerup:Lo.create(),pointermove:Lo.create(),pointerout:Lo.create(),pointerover:Lo.create(),pointerCancel:Lo.create(),wheel:Lo.create()}),W(this,"isInited",!1),W(this,"zIndexCounter",0),W(this,"renderingContext",void 0),this.renderingContext=n}init(){this.hooks.init.emit(),this.isInited=!0}destroy(){this.isInited=!1,this.hooks.destroy.emit()}render(){const{root:n}=this.renderingContext;this.zIndexCounter=0,qi.recursiveUpdateHierarchy(n),this.isInited&&(this.renderDisplayObject(n),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear())}renderDisplayObject(n){if(!n.isVisible)return;const{sortable:o}=n;if(o.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),n.imageData)return void this.hooks.putImageData.emit(n);this.hooks.beforeRender.emit(n),this.hooks.render.emit(n),this.hooks.afterRender.emit(n);let h=!1;o.dirty&&(o.sorted=n.childNodes.slice().sort(E2e),o.dirty=!1,h=!0);const v=o.sorted||n.childNodes;v.length>1&&v.sort((y,_)=>y.style.zIndex-_.style.zIndex),v.forEach(y=>{this.renderDisplayObject(y)}),v.sort((y,_)=>y.index-_.index),h&&n.recursiveCall(y=>{const _=new Qg("renderOrderChanged",{renderOrder:y.sortable.renderOrder});y.dispatchEvent(_)})}dirty(){this.renderingContext.renderCondition.add(0)}}function E2e(p,n){const o=Number(p.style.zIndex),h=Number(n.style.zIndex);if(o===h&&p.parentNode){const{childNodes:v=[]}=p.parentNode;return v.indexOf(p)-v.indexOf(n)}return o-h}class hZ extends OQ{constructor(n){super(),W(this,"document",void 0),W(this,"customElements",void 0),W(this,"devicePixelRatio",void 0),W(this,"eventService",void 0),W(this,"renderingService",void 0),W(this,"renderingContext",void 0),W(this,"canvasConfig",void 0),W(this,"renderer",void 0),W(this,"supportTouchEvent",void 0),W(this,"supportPointerEvent",void 0),W(this,"contextService",void 0);const{renderer:o,dpr:h,width:v,height:y,canvas:_,supportPointerEvent:b,supportTouchEvent:w}=n;this.supportPointerEvent=null!=b?b:!!globalThis.PointerEvent,this.supportTouchEvent=null!=w?w:"touchstart"in window;let I=v,A=y,M=h;_&&(M=h||window.devicePixelRatio||1,I=v||_.width/M,A=y||_.height/M),this.canvasConfig=zt(Ke({},n),{width:I,height:A,dpr:M}),this.canvasConfig=n,this.renderer=o,this.document=new w2e,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new I2e(this.renderingContext),this.initRenderer(o)}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",n=>{this.mountChildren(n.detail.child)}),this.document.documentElement.addEventListener("child-removed",n=>{this.unmountChildren(n.detail.child)})}initRenderer(n){this.renderingService.init(),n.initPlugins(this),this.contextService.init(),n.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(o=>{const{renderable:h}=o;h&&(h.boundsDirty=!0,h.renderBoundsDirty=!0)}),this.mountChildren(this.document.documentElement)}render(){const n=new Qg("beforeRender",{});this.dispatchEvent(n),this.contextService.clearCanvas(),this.renderingService.render()}setDPR(n){this.canvasConfig.dpr=n,this.contextService.setDPR(n)}resize(n,o){this.canvasConfig.width=n,this.canvasConfig.height=o,this.contextService.resize(n,o)}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(n,o){return this.document.documentElement.appendChild(n,o)}insertBefore(n,o){return this.document.documentElement.insertBefore(n,o)}removeChild(n){return this.document.documentElement.removeChild(n)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(n){n.recursiveCall(o=>{if(!o.isConnected){o.isConnected=!0,o.ownerDocument=this.document;const h=new Qg("DOMNodeInsertedIntoDocument",{});o.dispatchEvent(h)}})}unmountChildren(n){const o=[];n.recursiveCall(h=>{h.isConnected&&o.push(h)}),o.reverse().forEach(h=>{h.isConnected=!1;const v=new Qg("DOMNodeRemovedFromDocument",{});h.dispatchEvent(v),h!==this.document.documentElement&&(h.ownerDocument=null)})}}class ja extends class D2e{}{constructor(){super(...arguments),W(this,"close",!0),W(this,"shape",void 0),W(this,"ctx",void 0)}render(n,o){const{background:h,borderColor:v,visibility:y}=n.parsedStyle;if("hidden"===y)return;const _=!gl(h)&&!h.isNone,b=!gl(v)&&!v.isNone;this.renderPath(n,o),_&&this.renderFill(n,o),this.renderStrokePath(n,o),b&&this.renderStroke(n,o)}renderPath(n,o){n.getPath(),o.beginPath(),n.steps.forEach(h=>{F_(o,h)}),this.close&&n.steps.length>2&&o.closePath()}renderStrokePath(n,o){I_(null==n?void 0:n.getStrokePath)&&(n.getStrokePath(),0!==n.strokePath.length&&(o.beginPath(),n.strokeSteps.forEach(h=>{F_(o,h)}),this.close&&n.strokeSteps.length>2&&o.closePath()))}renderFill(n,o){const{parsedStyle:h}=n,{background:v,opacity:y,fillOpacity:_,renderBlendMode:b}=h;if(o.save(),o.globalAlpha=y*_,"normal"!==b&&(o.globalCompositeOperation=b),Array.isArray(v)){this.setShapeGradientOrigin(n,o);for(let w=0;w<v.length;w++)0===w&&this.setShadow(n,o),o.fillStyle=this.getColor(n,v[w],o),o.fill()}else this.setShadow(n,o),o.fillStyle=v.formatted,o.fill();o.restore()}renderStroke(n,o){const{parsedStyle:h}=n,{borderWidth:v,borderColor:y,opacity:_,lineCap:b,lineJoin:w,miterLimit:I,lineDash:A,lineDashOffset:M,borderOpacity:F,renderBlendMode:V}=h;v&&v.value>0&&(o.save(),gl(v)||(o.lineWidth=v.value),"normal"!==V&&(o.globalCompositeOperation=V),o.miterLimit=I,o.globalAlpha=_*F,o.lineCap=b,o.lineJoin=w,o.setLineDash(A),o.lineDashOffset=M.value,Array.isArray(y)?(this.setShapeGradientOrigin(n,o),y.forEach(B=>{o.strokeStyle=this.getColor(n,B,o),o.stroke()})):(o.strokeStyle=y.formatted,o.stroke()),o.restore())}setShadow(n,o){const{shadow:h,shadowOffsetX:v,shadowOffsetY:y,shadowBlur:_,shadowColor:b}=n.parsedStyle;(h||b)&&(o.shadowOffsetX=(null==v?void 0:v.value)||h[0],o.shadowOffsetY=(null==y?void 0:y.value)||h[1],o.shadowBlur=(null==_?void 0:_.value)||h[2],o.shadowColor=(null==b?void 0:b.formatted)||h[3])}getColor(n,o,h){let v;if(1===o.type||2===o.type){const y=n.getBoundingRect(),{width:_,height:b}=y,w=_,I=b;v=function(A,M){const{type:F,steps:V,width:B,height:Q,angle:J,cx:Z,cy:re,size:se}=A;let ce=null;if(1===F){const{x1:pe,y1:Ce,x2:Ve,y2:te}=function(Me,we,Le){const j=Le*Math.PI/180,L=0+Me/2,Y=0+we/2,q=Math.abs(Me*Math.cos(j))+Math.abs(we*Math.sin(j));return{x1:L-Math.cos(j)*q/2,y1:Y-Math.sin(j)*q/2,x2:L+Math.cos(j)*q/2,y2:Y+Math.sin(j)*q/2}}(B,Q,J.value);ce=M.createLinearGradient(pe,Ce,Ve,te)}else if(2===F){const{x:pe,y:Ce,r:Ve}=function(te,Me,we,Le,j){let L=we.value,Y=Le.value;"%"===we.unit&&(L=we.value/100*te),"%"===Le.unit&&(Y=Le.value/100*Me);let q=Math.max(qg({x:0,y:0},{x:L,y:Y}),qg({x:0,y:Me},{x:L,y:Y}),qg({x:te,y:Me},{x:L,y:Y}),qg({x:te,y:0},{x:L,y:Y}));return j&&(Vn(j)?q=j.value:Sn(j)&&("closest-side"===j?q=Math.min(L,te-L,Y,Me-Y):"farthest-side"===j?q=Math.max(L,te-L,Y,Me-Y):"closest-corner"===j&&(q=Math.min(qg({x:0,y:0},{x:L,y:Y}),qg({x:0,y:Me},{x:L,y:Y}),qg({x:te,y:Me},{x:L,y:Y}),qg({x:te,y:0},{x:L,y:Y}))))),{x:L,y:Y,r:q}}(B,Q,Z,re,se);ce=M.createRadialGradient(pe,Ce,0,pe,Ce,Ve)}return ce&&V.forEach(pe=>{let{offset:Ce,color:Ve}=pe;var te;"%"===Ce.unit&&(null===(te=ce)||void 0===te||te.addColorStop(Ce.value/100,Ve.toString()))}),ce}(zt(Ke({type:o.type},o.value),{width:w,height:I}),h)}return v}setShapeGradientOrigin(n,o){const{type:h}=n.config;switch(h){case"circle":case"arc":{const{r:v}=n.parsedStyle;o.translate(0-v.value,0-v.value);break}case"ellipse":{const{rx:v,ry:y}=n.parsedStyle;o.translate(0-v.value,0-y.value);break}default:o.translate(0,0)}}}class A2e extends ja{constructor(){super(),this.close=!1}}class P2e extends ja{}class R2e extends ja{}class fZ extends ja{render(n,o){const{width:h,height:v,img:y,opacity:_,visibility:b}=n.parsedStyle;"hidden"!==b&&(Sn(y)||y&&(o.save(),o.globalAlpha=_,y instanceof ImageData?o.putImageData(y,0,0):(o.imageSmoothingEnabled=!0,o.imageSmoothingQuality&&(o.imageSmoothingQuality="high"),o.drawImage(y,0,0,h.value,v.value)),o.restore()))}}class pZ extends ja{constructor(){super(...arguments),W(this,"close",!1)}render(n,o){const{visibility:h}=n.parsedStyle;"hidden"!==h&&(this.renderPath(n,o),this.renderStroke(n,o))}renderPath(n,o){n.getPath(),o.beginPath(),n.inkRenderSteps.forEach(h=>{h.forEach(v=>{F_(o,v)})})}}class k2e extends ja{}class gZ extends ja{render(n,o){const{background:h,borderColor:v,visibility:y}=n.parsedStyle;if("hidden"===y)return;const _=!gl(h)&&!h.isNone,b=!gl(v)&&!v.isNone;n.getPath();const w=n.steps.length;for(let I=0;I<w;I++){const A=n.steps[I];o.beginPath(),A.step.forEach(M=>{F_(o,M)}),A.close&&(o.closePath(),_&&this.renderFill(n,o)),b&&this.renderStroke(n,o)}}}class M2e extends ja{}class mZ extends ja{render(n,o){n&&this.renderText(n,o)}renderText(n,o){var h;const{parsedStyle:v,lines:y}=n,{color:_,borderWidth:b,borderColor:w,textBaseLine:I,opacity:A,textAlign:M,lineDash:F,fillOpacity:V,borderOpacity:B,letterSpacing:Q}=v;n.setTextFont(),o.save(),_&&Array.isArray(_)?_.forEach(Z=>{o.fillStyle=this.getColor(n,Z,o)}):o.fillStyle=_.formatted,w&&Array.isArray(w)?w.forEach(Z=>{o.strokeStyle=this.getColor(n,Z,o)}):o.strokeStyle=w.formatted,this.setShadow(n,o),o.font=n.font,o.globalAlpha=A,o.lineWidth=null==b?void 0:b.value,o.textAlign=M,o.textBaseline=I,o.letterSpacing=`${Q.value}px`,o.setLineDash(F),o.beginPath();const J=(null===(h=y[0])||void 0===h?void 0:h.y)||0;y.forEach(Z=>{let{text:re}=Z;const se=Z.y-J;re=n.transformText(re),_&&this.fillText(o,re,0,se,V),b&&b.value&&b.value>0&&this.strokeText(o,re,0,se,B)}),o.closePath(),o.restore()}fillText(n,o,h,v,y,_){let b;const w=!gl(y)&&1!==y;w&&(b=n.globalAlpha,n.globalAlpha=y*y),n.fillText(o,h,v,_),w&&(n.globalAlpha=b)}strokeText(n,o,h,v,y,_){let b;const w=!gl(y)&&1!==y;w&&(b=n.globalAlpha,n.globalAlpha=y),n.strokeText(o,h,v,_),w&&(n.globalAlpha=b)}}class O2e extends ja{constructor(){super(...arguments),W(this,"close",!0)}}class vZ extends ja{render(n,o){const{background:h,borderColor:v,visibility:y}=n.parsedStyle;if("hidden"===y)return;const _=!gl(h)&&!h.isNone,b=!gl(v)&&!v.isNone;n.getPath();const w=n.steps.length;for(let I=0;I<w;I++){const A=n.steps[I];o.beginPath(),A.step.forEach(M=>{F_(o,M)}),A.close&&(o.closePath(),_&&this.renderFill(n,o)),b&&this.renderStroke(n,o)}}}class F2e extends ja{render(n,o){const{width:h,height:v,roundedRadius:y,background:_,borderWidth:b,visibility:w}=n.parsedStyle;if("hidden"!==w){for(let I=0;I<4;I++){o.beginPath();const A=y.value;if(0===A)o.rect(0,0,h.value,v.value);else{const{PI:M}=Math;o.arc(A,A,A,M,3*M/2),o.arc(h.value-A,A,A,3*M/2,2*M),o.arc(h.value-A,v.value-A,A,0,M/2),o.arc(A,v.value-A,A,M/2,M)}}o.closePath(),_&&this.renderFill(n,o),b.value>0&&this.renderStroke(n,o)}}}class yZ extends ja{render(n,o){n&&"hidden"!==n.parsedStyle.visibility&&(this.renderBox(n,o),o.save(),n.renderClipStep&&(o.beginPath(),n.renderClipStep.forEach(h=>{F_(o,h)}),o.closePath(),o.clip()),this.renderText(n,o),o.restore())}renderBox(n,o){const{background:h,borderColor:v}=n.parsedStyle,y="textBox"===n.textType&&!gl(h)&&!h.isNone,_="textBox"===n.textType&&!gl(v)&&!v.isNone;this.renderPath(n,o),y&&this.renderFill(n,o),_&&this.renderStroke(n,o)}renderText(n,o){const{parsedStyle:h,lines:v}=n,{opacity:y,y:_,x:b}=h;o.globalAlpha=y,v.forEach(w=>{const I=w.height/30,A=n.getTextAlignOffset(w);w.words.forEach(M=>{const{color:F,fontFamily:V,fontSize:B,fontStyle:Q,fontWeight:J,lineThrough:Z,underline:re}=M.style;o.fillStyle=F;const se=""===V.trim()?"sans-serif":V;o.font=V.includes(" ")?`${Q} ${J} ${B.value}${B.unit} '${se}'`:`${Q} ${J} ${B.value}${B.unit} ${se}`;let ce=M.x-b+A;for(let pe=0;pe<M.text.length;pe++){const Ce=M.text.charAt(pe);o.fillText(Ce,ce,w.y-_),ce+=o.measureText(Ce).width}re&&o.fillRect(M.x-b+A,w.y-_+I,M.widthWithoutLf,I),Z&&o.fillRect(M.x-b+A,w.y-M.wordHeight/3-_,M.widthWithoutLf,B.value/30)})})}}class L2e{constructor(n){W(this,"canvasConfig",void 0),W(this,"container",void 0),W(this,"canvas",void 0),W(this,"dpr",void 0),W(this,"context",void 0),W(this,"shapeRenderers",{}),this.canvasConfig=n}init(){const{container:n,canvas:o,dpr:h,willReadFrequently:v}=this.canvasConfig;if(o){this.canvas=o;const{parentElement:y}=o;n&&y!==n&&n.appendChild(o),this.container=y,this.canvasConfig.container=y}else if(n&&(this.container=n,Sn(n)&&(this.container=document.getElementById(n)),this.container)){const y=document.createElement("canvas");this.container.appendChild(y),this.canvas=y}this.context=this.canvas.getContext("2d",{willReadFrequently:v}),this.dpr=h||Yx(),this.resize(this.canvasConfig.width,this.canvasConfig.height)}registerShapeRenderer(n,o){this.shapeRenderers[n]||(this.shapeRenderers[n]=o)}getShapeRenderer(n){return this.shapeRenderers[n]}destroy(){const{canvas:n,container:o}=this;o&&null!=n&&n.parentNode&&o.removeChild(n)}resize(n,o){const{canvas:h,dpr:v}=this;h&&(h.width=n*v,h.height=o*v,this.context.scale(v,v))}getDPR(){return this.dpr}setDPR(n){this.canvasConfig.dpr=n,this.dpr=n}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(n){var o;null!=this&&null!==(o=this.container)&&void 0!==o&&o.style&&(this.container.style.cursor=n)}getBoundingClientRect(){var n;return null===(n=this.canvas)||void 0===n?void 0:n.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr))}}class _Z{constructor(){W(this,"restoreStack",[])}init(n){const{hooks:o}=n.renderingService;o.endFrame.on(()=>{const{contextService:h}=n,v=h.getContext();this.restoreStack.forEach(()=>{v.restore()}),this.restoreStack=[]}),o.render.on(h=>{this.renderDisplayObject(h,n)}),o.putImageData.on(h=>{if(h.imageData){const{x:v,y}=h.getPosition(),_=n.contextService.getContext(),b=n.contextService.getDPR();_.putImageData(h.imageData,Math.floor(v*b+.5),Math.floor(y*b+.5))}})}renderDisplayObject(n,o){if(!n.isVisible)return;const{contextService:h}=o,v=h.getContext();let y=this.restoreStack[this.restoreStack.length-1];for(;y&&n.parentNode!==y;)v.restore(),this.restoreStack.pop(),y=this.restoreStack[this.restoreStack.length-1];v.save(),this.applyTransform(v,n);const{clipPath:_}=n.style;_&&(v.save(),this.applyTransform(v,_),v.restore(),v.clip()),this.useAnchor(v,n);const b=h.getShapeRenderer(n.shapeType);b&&(b.render(n,v),n.clippable&&v.clip()),this.restoreStack.push(n)}applyTransform(n,o){o.externalMatrices.length&&o.externalMatrices.slice().reverse().forEach(A=>{const{a:M,b:F,c:V,d:B,e:Q,f:J}=A;n.transform(M,F,V,B,Q,J)});const h=o.getLocalTransform(),{a:v,b:y,c:_,d:b,e:w,f:I}=h;n.transform(v,y,_,b,w,I)}applyAttributes(n,o,h){}useAnchor(n,o){const{anchor:h}=o.parsedStyle||{};if(!h||0===h[0]&&0===h[1])return;const v=o.getGeometryBounds().getRect();n.translate(-(h&&h[0]||0)*v.width,-(h&&h[1]||0)*v.height)}destroy(){}}W(_Z,"moduleName",void 0);class N2e{init(n){const o=new L2e(n.canvasConfig);n.contextService=o,[{name:"arc",renderer:new A2e},{name:"circle",renderer:new P2e},{name:"ellipse",renderer:new R2e},{name:"line",renderer:new vZ},{name:"image",renderer:new fZ},{name:"ink",renderer:new pZ},{name:"polygon",renderer:new k2e},{name:"polyline",renderer:new gZ},{name:"rect",renderer:new M2e},{name:"stampPath",renderer:new O2e},{name:"text",renderer:new mZ},{name:"roundedRect",renderer:new F2e},{name:"freeText",renderer:new yZ}].forEach(h=>{let{name:v,renderer:y}=h;o.registerShapeRenderer(v,y)})}destroy(){}}class CZ extends class T2e{constructor(n){W(this,"contextService",void 0),W(this,"renderingPlugins",[]),W(this,"config",{autoRendering:!0}),Object.assign(this.config,n)}use(n){this.renderingPlugins.includes(n)||this.renderingPlugins.push(n)}initPlugins(n){this.renderingPlugins.forEach(o=>{o.init(n)})}destroyPlugins(){this.renderingPlugins.forEach(n=>{n.destroy()})}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}{constructor(n){super(n),this.use(new N2e),this.use(new _Z)}}function bZ(p,n,o){const _=(n.x-p.x)*(o.y-p.y)-(n.y-p.y)*(o.x-p.x),b=Xg(p,n),w=Xg(p,o);let I=(b**2+w**2-Xg(n,o)**2)/(2*b*w);I<-1&&(I=-1),I>1&&(I=1);let A=180*Math.acos(I)/Math.PI;return A=Math.round(100*A)/100,_<0?-A:A}function R5(p,n,o){const h=$E(n,p);return $E(n,o).angle(h)>Math.PI/2?-1:1}function Ju(p,n){return(n=p.getWorldTransform().inverse().transformPoint(n)).x+=p.parsedStyle.x,n.y+=p.parsedStyle.y,n}function sw(p){if(!p)return!1;const{shapeType:n}=p;return"annotationRect"===n||"annotationFreeText"===n&&"textBox"===p.textType||"annotationStamp"===n&&"image"===p.renderType}function nm(p){return!!p&&("annotationPolyline"===p.shapeType||"annotationPolygon"===p.shapeType||"annotationLine"===p.shapeType)}function aw(p){return!!p&&("annotationFreeText"===p.shapeType||"annotationTextBox"===p.shapeType)}function Jd(p,n){const o=window.TouchEvent&&n instanceof TouchEvent?n.targetTouches[0]:n,h=p.getBoundingClientRect();return{offsetX:o.pageX-window.scrollX-h.left,offsetY:o.pageY-window.scrollY-h.top}}function xZ(p){let n,o;if(p.controls){const{width:h,height:v}=p.controls.getLength();n=h,o=v}else{const{x:h,y:v}=p.getScale(),{width:y,height:_}=p.getBoundingRect();n=y*h,o=_*v}return{width:n,height:o}}function B_(p){return/^[\r\n]+$/.test(p)}function wZ(p,n,o){return p.slice(0,n)+p.slice(o+1)}function k5(p,n){const{textContents:o}=p.style,h=[];return o.forEach(v=>{h.push(Ke(Ke({},v),n))}),h}function M5(p,n){const{textContents:o}=p.style,{textSelection:h}=p.textEditEventHandler;if(!h.length)return o;const[v,y]=h,_=v.freeContentIndex,b=y.freeContentIndex,w=o.slice(0,_),I=o.slice(_,b+1),A=o.slice(b+1),M=[];if(v.freeContentIndex===y.freeContentIndex){const{content:F}=I[0],V=F.slice(0,v.indexInFreeContent),B=F.slice(v.indexInFreeContent,y.indexInFreeContent+1),Q=F.slice(y.indexInFreeContent+1);V&&M.push(zt(Ke({},I[0]),{content:V})),B&&M.push(zt(Ke(Ke({},I[0]),n),{content:B})),Q&&M.push(zt(Ke({},I[0]),{content:Q}))}else for(let F=0;F<I.length;F++){const V=I[F];0===F?(M.push(zt(Ke({},V),{content:V.content.slice(0,v.indexInFreeContent)})),M.push(zt(Ke(Ke({},V),n),{content:V.content.slice(v.indexInFreeContent)}))):F===I.length-1?(M.push(zt(Ke(Ke({},V),n),{content:V.content.slice(0,y.indexInFreeContent+1)})),M.push(zt(Ke({},V),{content:V.content.slice(y.indexInFreeContent+1)}))):M.push(Ke(Ke({},V),n))}return[...w,...M,...A]}function SZ(p){if(!p)return!1;let n=p,o="visible"===n.parsedStyle.visibility;for(;n;)n.parsedStyle.visibility&&"hidden"===n.parsedStyle.visibility&&(o=!1),n=n.parentNode;return o}var Pi;!function(p){p.REJECTED="SBRejected",p.ACCEPTED="SHAccepted",p.INITIAL_HERE="SHInitialHere",p.SIGN_HERE="SHSignHere",p.WITNESS="SHWitness",p.APPROVED="SBApproved",p.NOT_APPROVED="SBNotApproved",p.DRAFT="SBDraft",p.FINAL="SBFinal",p.COMPLETED="SBCompleted",p.CONFIDENTIAL="SBConfidential",p.VOID="SBVoid"}(Pi||(Pi={}));const Vv={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},TZ={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},Ki={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:Pi.DRAFT,imageData:null,textAlign:"left",textContent:Ke({},TZ)},B2e={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},W2e={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,inkCreateDelay:3e3,controlsStyle:Vv,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class tu{constructor(n){W(this,"shape",void 0),W(this,"startTime",void 0),W(this,"startPoint",void 0),W(this,"lastPoint",void 0),W(this,"limitPosition",void 0),W(this,"limitAngle",void 0),W(this,"unLimitPosition",void 0),W(this,"unLimitScale",void 0),W(this,"unLimitStyle",void 0),W(this,"limitArea",void 0),this.shape=n}setLimitArea(n){this.limitArea=n}updateShapeByLimitArea(){const{shapeType:n}=this.shape,{left:o,right:h,top:v,bottom:y}=this.isOutOfLimitArea(1,1),_=o||h||v||y,b=sw(this.shape)||"annotationEllipse"===n;_?(b?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(b&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone())}getShapeOriginPosition(){const{x:n,y:o,width:h,height:v}=this.shape.getBoundingRect(),y=new em({style:{x:n-this.shape.style.x+h/2,y:o-this.shape.style.y+v/2}});this.shape.appendChild(y);const{x:_,y:b}=y.getPosition();return y.destroy(),{x:_,y:b}}getShapeVertexPosition(){const{x:n,y:o,width:h,height:v}=this.shape.getBoundingRect(),y=[];for(let _=0;_<4;_++){let b=n-this.shape.style.x,w=o-this.shape.style.y;switch(_){case 1:b+=h;break;case 2:b+=h,w+=v;break;case 3:w+=v}const I=new em({style:{x:b,y:w}});this.shape.appendChild(I);const{x:A,y:M}=I.getPosition();y.push({x:A,y:M}),I.destroy()}return y}isOutOfLimitArea(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.limitArea)return{left:!1,right:!1,top:!1,bottom:!1};const{x:h,y:v,width:y,height:_}=this.limitArea;let b=!1,w=!1,I=!1,A=!1;const M=this.getShapeVertexPosition();for(let F=0;F<4;F++){const{x:V,y:B}=M[F];b=V<h-n||b,w=V>h+y+n||w,I=B<v-o||I,A=B>v+_+o||A}return{left:b,right:w,top:I,bottom:A}}getLimitPosition(){if(!this.limitArea)return null;const n=this.getShapeVertexPosition(),{x:o,y:h}=n[0],{x:v,y,width:_,height:b}=this.limitArea,w=n[1].x-o,I=n[2].x-o,A=n[3].x-o,M=n[1].y-h,F=n[2].y-h,V=n[3].y-h;let B=v-Math.min(w,I,A),Q=v+_-Math.max(w,I,A),J=y-Math.min(M,F,V),Z=y+b-Math.max(M,F,V);if(w>=0&&I>=0&&A>=0?B=v:w<=0&&I<=0&&A<=0&&(Q=v+_),M>=0&&F>=0&&V>=0?J=y:M<=0&&F<=0&&V<=0&&(Z=y+b),(re=this.shape)&&("annotationEllipse"===re.shapeType||"annotationCircle"===re.shapeType)){const{x:se,y:ce}=this.getShapeOriginPosition(),pe=se-o,Ce=ce-h;B+=pe,Q+=pe,J+=Ce,Z+=Ce}var re;return{minPosX:B,maxPosX:Q,minPosY:J,maxPosY:Z}}getLimitRotateAngle(){if(!this.limitArea)return[];const n=function(y,_){const b=y,[w,I,A,M]=b,{x:F,y:V,width:B,height:Q}=_,J=F+B,Z=V+Q,re=(w.x+I.x+A.x+M.x)/4,se=(w.y+I.y+A.y+M.y)/4,ce=Math.sqrt((re-w.x)**2+(se-w.y)**2),pe=re-ce,Ce=re+ce,Ve=se-ce,te=se+ce;if(pe>F&&Ve>V&&Ce<J&&te<Z)return[];const Me=L=>{const Y=ce*ce-(L-re)**2;return[{x:L,y:se-Math.sqrt(Y)},{x:L,y:se+Math.sqrt(Y)}]},we=L=>{const Y=ce*ce-(L-se)**2;return[{x:re-Math.sqrt(Y),y:L},{x:re+Math.sqrt(Y),y:L}]},Le=(L,Y)=>{const q=[];return L.forEach(k=>{y.forEach(N=>{let $=bZ({x:re,y:se},N,k);0===$&&($=re>N.x?se>N.y?-0:0:se>N.y?0:-0,"top"!==Y&&"bottom"!==Y||($=-$)),q.push($)})}),q},j=[];if(pe<F){const L=Me(F);j.push(...Le(L,"left"))}if(Ve<V){const L=we(V);j.push(...Le(L,"top"))}if(Ce>J){const L=Me(J);j.push(...Le(L,"right"))}if(te>Z){const L=we(Z);j.push(...Le(L,"bottom"))}return j}(this.getShapeVertexPosition(),this.limitArea);if(0===n.length)return[];let o=0;if(n.forEach(y=>{0===y&&o++}),o>=2)return[0,0];const{maxNegative:h,minPositive:v}=function(y){let _=-1/0,b=1/0;for(let w=0;w<y.length;w++)y[w]<0&&y[w]>_||Object.is(y[w],-0)?_=y[w]:(y[w]>0&&y[w]<b||Object.is(y[w],0))&&(b=y[w]);return _===-1/0&&(_=0),b===1/0&&(b=0),{maxNegative:_,minPositive:b}}(n);return[h,v]}moveShape(n){const{shape:o,startPoint:h}=this,{lastWorldPosition:v,controlsFlags:y}=o.context;if(!y.enableMove||new Rr(n.x,n.y).distanceTo(h)<0)return;let w=v.x+(n.x-h.x),I=v.y+(n.y-h.y);const{left:A,right:M,top:F,bottom:V}=this.isOutOfLimitArea(1,1);if(this.limitPosition&&!(A||M||F||V)){const{minPosX:Q,maxPosX:J,minPosY:Z,maxPosY:re}=this.limitPosition;w<Q&&(w=Q),w>J&&(w=J),I<Z&&(I=Z),I>re&&(I=re)}this.shape.setPosition({x:w,y:I})}moveVertex(n){const{shape:o}=this,{context:h,shapeType:v}=o,{hitControlPoint:y,lastLocalScale:_,lastControlsWidth:b,lastControlsHeight:w,keepAspectRatio:I,lastHitControlPoint:A,lastShareAxisYPoint:M,lastShareAxisXPoint:F,lastLocalTransform:V}=h,B=l2(A,F,n).distanceTo(F)||1;if(R5(A,F,n)<0)return;let Q=B-b,J=B/b;const Z=l2(A,M,n).distanceTo(M)||1;if(R5(A,M,n)<0)return;let re=Z-w,se=Z/w;I&&(J>=se?(se=J,re=se*w-w):(J=se,Q=J*b-b));const{left:ce,right:pe,top:Ce,bottom:Ve}=this.isOutOfLimitArea(1,1),te=ce||pe||Ce||Ve,Me="annotationEllipse"===v;sw(o)?this.moveRectVertex(y,Q,re):Me?this.moveEllipseVertex(y,Q,re):(y<2&&(re=-re),0!==y&&3!==y||(Q=-Q),o.setLocalTransform(V),o.translate(Q/2,re/2),o.setLocalScale(J*_.x,se*_.y,1)),te||0===o.getAngle()||this.updateShapeByLimitArea(),o.context.updateControls()}moveEllipseVertex(n,o,h){const{shape:v}=this,{x:y,y:_}=v.getScale(),{lastShapeWidth:b,lastShapeHeight:w,lastLocalTransform:I}=this.shape.context,A=(b+o/Math.abs(y))/2,M=(w+h/Math.abs(_))/2;v.style.rx=A<1?1:A,v.style.ry=M<1?1:M,n<2&&(h=-h),0!==n&&3!==n||(o=-o),this.shape.setLocalTransform(I),this.shape.translate(o/2,h/2)}moveRectVertex(n,o,h){const{shape:v}=this,{x:y,y:_}=v.getScale(),{lastShapeWidth:b,lastShapeHeight:w,lastLocalTransform:I,lastWorldPosition:A}=this.shape.context,M=n,F=b+o/Math.abs(y),V=w+h/Math.abs(_);if(v.style.width=F<1?1:F,v.style.height=V<1?1:V,2===M)v.setPosition({x:A.x,y:A.y});else switch(v.setLocalTransform(I),M){case 1:v.translate(0,-h);break;case 3:v.translate(-o,0);break;default:v.translate(-o,-h)}}moveMidpoints(n){const{shape:o}=this,{context:h,shapeType:v}=o,{lastLocalScale:y,lastControlsWidth:_,lastControlsHeight:b,lastLocalTransform:w,lastHitControlPoint:I,lastShareAxisPoint:A,hitControlPoint:M}=h,F=M-4,V=l2(I,A,n).distanceTo(A);if(R5(I,A,n)<0)return;const B="annotationEllipse"===v,Q=V/_*y.x,J=V/b*y.y,Z=(1===F?1:-1)*(V-_),re=(2===F?1:-1)*(V-b),{left:se,right:ce,top:pe,bottom:Ce}=this.isOutOfLimitArea(1,1),Ve=se||ce||pe||Ce;sw(o)?this.moveRectMidPoint(F,Z,re):B?this.moveEllipseMidPoint(F,Z,re):F%2?(this.shape.setLocalTransform(w),this.shape.translate(Z/2,0),this.shape.setLocalScale(Q,y.y,1)):(this.shape.setLocalTransform(w),this.shape.translate(0,re/2),this.shape.setLocalScale(y.x,J,1)),Ve||0===o.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls()}moveRectMidPoint(n,o,h){const{shape:v}=this,{x:y,y:_}=v.getScale(),{lastShapeHeight:b,lastWorldPosition:w,lastLocalTransform:I,lastShapeWidth:A}=v.context;if(n%2){const M=(1===n?o:-o)/Math.abs(y)+A;v.style.width=M<1?1:M,1===n?this.shape.setPosition({x:w.x,y:w.y}):(this.shape.setLocalTransform(I),this.shape.translate(o,0))}else{const M=(2===n?h:-h)/Math.abs(_)+b;v.style.height=M<1?1:M,2===n?this.shape.setPosition({x:w.x,y:w.y}):(this.shape.setLocalTransform(I),this.shape.translate(0,h))}}moveEllipseMidPoint(n,o,h){const{shape:v}=this,{x:y,y:_}=v.getScale(),{lastShapeHeight:b,lastLocalTransform:w,lastShapeWidth:I}=v.context;if(n%2){const A=(1===n?o:-o)/Math.abs(y)+I;v.style.rx=A<2?1:A/2,this.shape.setLocalTransform(w),this.shape.translate(o/2,0)}else{const A=(2===n?h:-h)/Math.abs(_)+b;v.style.ry=A<2?1:A/2,this.shape.setLocalTransform(w),this.shape.translate(0,h/2)}}moveRotationPoint(n){const{startPoint:o,shape:h}=this,{lastOriginWorldPosition:v,lastLocalTransform:y}=h.context,_=bZ(v,o,n);this.shape.setLocalTransform(y),this.shape.rotateLocal(_)}isHit(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:h}=this,{context:v,parsedStyle:y}=h;if("hidden"===y.visibility||!v.controlsFlags.enableControl)return-1;if(v.isGrouped)return v.unHitShape(),-1;let{controls:_}=h,b=!0;_||(b=!1,v.initControls(),v.renderControls(),_=h.controls);let w=_.checkHitArea(n.x,n.y);return nm(h)&&!h.context.controlsFlags.useDefaultControls&&(8===w?w=-1:w>0&&(w=9),-1!==h.pointEventsHandler.isHitPoint(n)&&(w=0)),w<0?(o&&(v.unHitShape(),b||h.context.destroyControls()),-1):w}startHandler(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=this.isHit(n);if(-1===h&&!o)return;-1===h&&o&&(h=9);const{shape:v}=this,{context:y,controls:_}=v;if(y.isStart=!0,this.lastPoint=Ke({},n),this.startPoint=Ke({},n),this.startTime=(new Date).getTime(),nm(v)&&(v.pointEventsHandler.enableEditMode(),v.pointEventsHandler.editStartHandler(n)),aw(v)&&v.textEditEventHandler.editStartHandler(n),this.limitPosition=this.getLimitPosition(),y.controlsFlags.useDefaultControls){y.hitShape(),y.hitControlPoint=h;const{ctrlWidth:b,ctrlHeight:w}=y.parsedControlsStyle,I=b/2,A=w/2;if(h<4){const M=_.controlPoints.slice(0,4),F=M[h].getPosition().x+I,V=M[h].getPosition().y+A;y.lastHitControlPoint=Ke({},n),y.lastHitControlPointCenter={x:F,y:V},y.lastShareAxisYPoint={x:M[3-h].getPosition().x+I+n.x-F,y:M[3-h].getPosition().y+A+n.y-V},y.lastShareAxisXPoint={x:M[h%2?h-1:h+1].getPosition().x+I+n.x-F,y:M[h%2?h-1:h+1].getPosition().y+A+n.y-V}}else if(h<8){const M=_.controlPoints.slice(4,8),F=M[h-4].getPosition().x+I,V=M[h-4].getPosition().y+A;y.lastHitControlPoint=Ke({},n),y.lastHitControlPointCenter={x:F,y:V},y.lastShareAxisPoint={x:M[(h-2)%4].getPosition().x+I+n.x-F,y:M[(h-2)%4].getPosition().y+A+n.y-V}}}else y.isHit=!0,y.hitControlPoint=9,y.lastWorldPosition=v.getPosition(),y.lastControlsWorldPosition=v.controls.getPosition()}moveHandler(n,o){const{shape:h,lastPoint:v}=this,{context:y,controls:_}=h,{isHit:b,isStart:w,hitControlPoint:I}=y,A=nm(h),M=aw(h);b&&w&&_&&(v.x=n.x,v.y=n.y,A&&-1!==h.pointEventsHandler.hitIndex?h.pointEventsHandler.editMoveHandler(n):M&&h.textEditEventHandler.editMode?h.textEditEventHandler.editMoveHandler(n):I<4?(y.keepAspectRatio=o,this.moveVertex(n)):I<8?this.moveMidpoints(n):I<9?this.moveRotationPoint(n):(this.moveShape(n),A&&h.pointEventsHandler.updateLineControls()))}endHandler(n){const{shape:o,startPoint:h,lastPoint:v}=this,{context:y}=o,{isStart:_,isHit:b}=o.context;if(!_||!b)return;const M=(new Date).getTime()-this.startTime<=200&&((v.x-h.x)**2+(v.y-h.y)**2)**.5<2,F=nm(o),V=aw(o);if(F&&o.pointEventsHandler.editEndHandler(),V&&o.textEditEventHandler.editEndHandler(),!y.isActive&&M&&(y.isActive=!0),n){if(V&&o.textEditEventHandler.editMode)return void(y.hitControlPoint=-1);const B=[];if(8===y.hitControlPoint)B.push("rotated");else{const{lastControlsWorldPosition:J,lastControlsWidth:Z,lastControlsHeight:re,lastWorldPosition:se}=y,{width:ce,height:pe}=o.controls.getLength(),Ce=o.controls.getPosition(),Ve=o.getPosition(),te=o instanceof jv?J:se,Me=o instanceof jv?Ce:Ve;Me.x.toFixed(1)===te.x.toFixed(1)&&Me.y.toFixed(1)===te.y.toFixed(1)||B.push("moved");const we=F&&-1!==o.pointEventsHandler.hitIndex,Le=!(!Z||!re||ce.toFixed(3)===Z.toFixed(3)&&pe.toFixed(3)===re.toFixed(3));o instanceof Sp||!we&&!Le||B.push("resized")}const Q=[...new Set(B)];Q.length&&n.emitModifyAnnotation(Q,[o])}y.isHit=!1,y.keepAspectRatio=!1}}class U2e extends gs{constructor(n,o){super({type:"annotationGroup",style:{visibility:"visible"}}),W(this,"shapeType","annotationControls"),W(this,"container",void 0),W(this,"borders",void 0),W(this,"rotationPoint",void 0),W(this,"controlPoints",void 0),W(this,"rotationBorder",void 0),W(this,"rotationPointOffset",30),W(this,"vertexes",[]),W(this,"midpoints",[]),this.container=n;for(const h in o)QE(h,o)&&(this[h]=o[h]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls()}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&SZ(null==this?void 0:this.container)}initBorders(){const{borderColor:n,borderWidth:o,lineDash:h,background:v}=this.container.context.parsedControlsStyle,{width:y}=this.container.getBoundingRect(),_=o/2;this.borders=new m2({style:{points:this.vertexes,borderWidth:o,background:v,borderColor:n,lineDash:h}}),this.borders.setLocalPosition(-_,-_),this.rotationBorder=new m2({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:o,borderColor:n,lineDash:h}});const b=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(y/2-_,-b),this.appendChild(this.borders),this.appendChild(this.rotationBorder)}initControls(){const{vertexes:n,midpoints:o,rotationPoint:h}=this,{ctrlBorderColor:v,ctrlBorderWidth:y,ctrlLineDash:_,ctrlBackground:b,ctrlWidth:w,ctrlHeight:I,ctrlBorderRadius:A}=this.container.context.parsedControlsStyle,{x:M,y:F}=this.container.getBoundingRect(),V=[...n,...o,h],B={background:b,borderColor:v,borderWidth:y,lineDash:_,width:w,height:I,roundedRadius:A};V.forEach(Q=>{const J=new T5({style:Ke({x:Q.x,y:Q.y},B)});J.setLocalPosition(Q.x-ni(w).value/2-M,Q.y-ni(I).value/2-F),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(J),this.appendChild(J)})}calculateMidpoints(n){const o=[];for(let h=0,v=n.length;h<v;h++){const y=new Rr((n[h].x+n[(h+1)%v].x)/2,(n[h].y+n[(h+1)%v].y)/2);o.push(y)}return o}calculateRotationPoint(n){const o=n[0].distanceTo(n[2]);return n[2].lerpTo(n[0],this.rotationPointOffset/o+1)}update(n){const{midpoints:o,rotationPoint:h,container:v}=this,{ctrlWidth:y,ctrlHeight:_,borderWidth:b}=this.container.context.parsedControlsStyle,w=[...n,...o,h],{x:I,y:A,width:M,height:F}=v.getBoundingRect(),V=b/2;this.controlPoints.forEach((J,Z)=>{const{x:re,y:se}=w[Z];J.updateStyle({x:re,y:se}),J.setLocalPosition(re-y/2-I,se-_/2-A)}),this.borders.updateStyle({points:n}),this.borders.setLocalPosition(M<0?M:-V,F<0?F:-V);const B=Math.min(o[0].x,h.x),Q=Math.min(o[0].y,h.y);this.rotationBorder.updateStyle({points:[o[0],h]}),this.rotationBorder.setLocalPosition(B-I-V,Q-A)}updateOrigin(){this.setOrigin(this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y)}updateControlPoints(n){this.vertexes=n,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints)}getLength(){return{width:this.midpoints[1].x-this.midpoints[3].x,height:this.midpoints[2].y-this.midpoints[0].y}}setVisible(n){this.style.visibility=n}setBoxVisible(n){this.borders.style.visibility=n}setRotationPointVisible(n){this.rotationBorder.style.visibility=n,this.controlPoints[8].style.visibility=n}setControlPointVisible(n){this.controlPoints.forEach((o,h)=>{h<8&&(o.style.visibility=n)})}checkHitArea(n,o){const h=this.getWorldTransform().inverse().transformPoint({x:n,y:o}),{x:v,y}=this.controlPoints[0].parsedStyle,_={x:h.x+v,y:h.y+y},{ctrlWidth:b,ctrlHeight:w}=this.container.context.parsedControlsStyle;h.x+=v+b/2,h.y+=y+w/2;const I=rr()?10:0;let A=-1;for(let M=0;M<this.controlPoints.length;M++){const F=this.controlPoints[M];if("visible"===F.style.visibility&&F.isPointInPath({x:h.x,y:h.y},I)){A=M;break}}return A>-1?A:this.borders.isPointInPath(_)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null)}}class nu{constructor(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};W(this,"shape",void 0),W(this,"referencePoint",void 0),W(this,"controlsStyle",void 0),W(this,"controlsFlags",void 0),W(this,"parsedControlsStyle",void 0),W(this,"keepAspectRatio",!1),W(this,"isInGroup",!1),W(this,"isGrouped",!1),W(this,"isActive",!1),W(this,"isStart",!1),W(this,"isHit",!1),W(this,"hitControlPoint",-1),W(this,"lastHitControlPoint",void 0),W(this,"lastHitControlPointCenter",void 0),W(this,"lastLocalTransform",void 0),W(this,"lastWorldPosition",void 0),W(this,"lastLocalScale",void 0),W(this,"lastOriginWorldPosition",void 0),W(this,"lastControlsWorldPosition",void 0),W(this,"lastControlsWidth",void 0),W(this,"lastControlsHeight",void 0),W(this,"lastShareAxisPoint",void 0),W(this,"lastShareAxisXPoint",void 0),W(this,"lastShareAxisYPoint",void 0),W(this,"lastShapeWidth",void 0),W(this,"lastShapeHeight",void 0),this.shape=n,this.controlsStyle=Ke(Ke({},Vv),o),this.controlsFlags=Ke({},B2e),this.parseControlsStyle()}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:n,y:o}=this.shape.getBoundingRect(),y=new em({style:{x:n-this.shape.style.x,y:o-this.shape.style.y,r:0}});this.shape.appendChild(y),this.referencePoint=y}updateReferenceBox(){if(!this.referencePoint)return;const{x:n,y:o}=this.shape.getBoundingRect();this.referencePoint.updateStyle({x:n-this.shape.style.x,y:o-this.shape.style.y})}getControlVertexes(){const{shape:n}=this,{x:o,y:h,width:v,height:y}=n.getBoundingRect();return[new Rr(o,h),new Rr(o+v,h),new Rr(o+v,h+y),new Rr(o,h+y)]}getScaledControlVertexes(){const{shape:n}=this,{x:o,y:h}=n.getScale(),{x:v,y,width:_,height:b}=n.getBoundingRect(),w=_*Math.abs(o)||1,I=b*Math.abs(h)||1;return[new Rr(v,y),new Rr(v+w,y),new Rr(v+w,y+I),new Rr(v,y+I)]}showControls(){this.initReferenceBox();const{shape:n,referencePoint:o}=this,{x:h,y:v}=o.getPosition(),y=n.getAngle(),_=h,b=v;n.controls.setAngle(y),n.controls.setPosition({x:_,y:b})}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:n,border:o,ctrlWidth:h,ctrlHeight:v,ctrlBackground:y,ctrlBorderRadius:_,ctrlBorder:b}=this.controlsStyle,w=o||Vv.border,{borderColor:I,borderStyle:A,borderWidth:M}=Xx(w),F=ni(M).value,V=b||Vv.ctrlBorder,{borderColor:B,borderStyle:Q,borderWidth:J}=Xx(V),Z=ni(J).value,re=ni(h).value,se=Nv(_);this.parsedControlsStyle={background:n||Vv.background,ctrlBackground:y||Vv.ctrlBackground,ctrlBorderRadius:"%"===se.unit?se.value/100*re:_||Vv.ctrlBorderRadius,borderColor:I,borderWidth:F,lineDash:"solid"===A?[0,0]:[2*F,F],ctrlWidth:re,ctrlHeight:ni(v).value,ctrlBorderColor:B,ctrlBorderWidth:Z,ctrlLineDash:"solid"===Q?[0,0]:[2*Z,Z]}}updateControlsFlags(n){const{enableEdit:o,enableRotate:h,enableControl:v,isVisible:y}=n;this.shape.controls&&(As(o)&&this.shape.controls.setControlPointVisible(o?"visible":"hidden"),As(h)&&this.shape.controls.setRotationPointVisible(h?"visible":"hidden"),As(v)&&!v&&this.destroyControls()),As(y)&&(this.shape.style.visibility=y?"visible":"hidden"),this.controlsFlags=Ke(Ke({},this.controlsFlags),n)}hitShape(){const{shape:n}=this,{shapeType:o,controls:h}=n;this.isHit=!0,this.lastWorldPosition=n.getPosition().clone(),this.lastLocalTransform=n.getLocalTransform().clone(),this.lastLocalScale=n.getLocalScale(),this.lastControlsWorldPosition=h.getPosition().clone(),this.lastControlsWidth=h.getLength().width,this.lastControlsHeight=h.getLength().height;const v=n.getBoundingRect(),y=new em({style:{x:v.x-n.style.x+v.width/2,y:v.y-n.style.y+v.height/2,r:0}});n.appendChild(y),this.lastOriginWorldPosition=y.getPosition(),y.destroy(),"annotationEllipse"===o&&(this.lastShapeWidth=2*n.parsedStyle.rx.value,this.lastShapeHeight=2*n.parsedStyle.ry.value),sw(this.shape)&&(this.lastShapeWidth=n.parsedStyle.width.value,this.lastShapeHeight=n.parsedStyle.height.value)}unHitShape(){const{context:n}=this.shape;n.isStart=!1,n.isHit=!1,n.isActive=!1,n.hitControlPoint=-1,aw(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),nm(this.shape)&&this.shape.pointEventsHandler.disableEditMode()}initControls(){const{shape:n}=this,o=this.getControlVertexes(),h=new U2e(n,{vertexes:o});n.controls=h,n.getRootNode().appendChild(h),this.updateControlsFlags(this.controlsFlags)}updateControls(){var n,o,h,v;const{shape:y}=this,_=this.getScaledControlVertexes();JSON.stringify(_)!==JSON.stringify(null===(n=y.controls)||void 0===n?void 0:n.vertexes)&&(null===(o=y.controls)||void 0===o||o.updateControlPoints(_),null===(h=y.controls)||void 0===h||h.update(_),null===(v=y.controls)||void 0===v||v.updateOrigin())}renderControls(){const{shape:n,isStart:o,isActive:h,controlsFlags:v,isInGroup:y}=this,{useDefaultControls:_}=v,{controls:b}=n;let w="hidden";b&&(_&&(o||h||y)&&(w="visible"),b&&b.setVisible(w),this.updateControls(),this.showControls())}destroyControls(){var n,o;null===(n=this.referencePoint)||void 0===n||n.destroy(),this.referencePoint=null,null===(o=this.shape.controls)||void 0===o||o.destroy(),this.shape.controls=null}getTransform(){const{parentNode:n}=this.shape,o=n instanceof Sp&&this.shape.context.isGrouped;o&&n.delete(this.shape,!1);const h=Ke({},this.shape.getLocalPosition()),v=this.shape.getLocalAngle(),y=Ke({},this.shape.getLocalScale());return o&&n.add(this.shape),{angle:v,scale:y,position:h}}setTransform(n){if(n){const{scale:o,angle:h,position:v}=n;v&&this.shape.setLocalPosition(v),gt(h)||this.shape.setLocalAngle(h),gt(o)||this.shape.setLocalScale(o)}}getCommonStyleConfig(){const{lineCap:n,lineJoin:o,lineDash:h,background:v,opacity:_,miterLimit:w,borderColor:I,borderWidth:A}=this.shape.attributes;return{lineCap:n,lineJoin:o,lineDash:h,background:v,opacity:_,borderColor:I,borderWidth:A,miterLimit:w}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:n,y:o,width:h,height:v}=this.shape.getBoundingRect(),y=[],{useDefaultControls:_,enableRotate:b}=this.shape.context.controlsFlags,w=_&&b?5:4;for(let I=0;I<w;I++){let A=n-this.shape.style.x,M=o-this.shape.style.y;1!==I&&2!==I||(A+=h),2!==I&&3!==I||(M+=v),4===I&&(A+=h/2,M-=30/this.shape.getScale().y);const F=new em({style:{x:A,y:M,r:0}});this.shape.appendChild(F);const{x:V,y:B}=F.getPosition();y.push({x:V,y:B}),F.destroy()}return wp(y)}}class IZ extends eZ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationArc"},n)),W(this,"shapeType","annotationArc"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}getAnnotationConfig(){const n=this.context.getTransform(),{position:o}=n,{r:h,startAngle:v,endAngle:y}=this.attributes;return{type:"annotationArc",style:Ke({x:o.x,y:o.y,r:h,startAngle:v,endAngle:y},this.context.getCommonStyleConfig()),transform:n}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}class EZ extends em{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationCircle"},n)),W(this,"shapeType","annotationCircle"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const n=this.context.getTransform(),{position:o}=n,{r:h}=this.attributes;return{type:"annotationCircle",style:Ke({x:o.x,y:o.y,r:h},this.context.getCommonStyleConfig()),transform:n}}}class jv extends tZ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationEllipse"},n)),W(this,"shapeType","annotationEllipse"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const n=this.context.getTransform(),{rx:o,ry:h}=this.parsedStyle,{position:v}=n;return{type:"annotationEllipse",style:Ke({x:v.x-o.value,y:v.y-h.value,width:2*o.value,height:2*h.value},this.context.getCommonStyleConfig()),transform:n}}}class V2e extends Wv{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationImage"},n)),W(this,"shapeType","annotationImage"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:n,y:o,img:h,opacity:v,visibility:y,width:_,height:b}=this.attributes;return{type:"annotationImage",style:{x:n,y:o,width:_,height:b,img:h,opacity:v,visibility:y},meteData:this.meteData,transform:this.context.getTransform()}}}class Qd extends nZ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationInk"},n)),W(this,"shapeType","annotationInk"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n),this.update()}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}setUseDouglasPeucker(n){n?(this.boundsDirty=!0,this.pathDirty=!0,this.useDouglasPeucker=!0):this.useDouglasPeucker=!1}getAnnotationConfig(){let n=this.attributes.segments;const o=this.context.getTransform(),h=this.getBoundingRect(),{position:v}=o;return(v.x!==h.x||v.y!==h.y)&&(n=[],this.attributes.segments.forEach(y=>{const _=[];y.forEach(b=>{_.push({x:b.x-h.x+v.x,y:b.y-h.y+v.y,z:0})}),n.push(_)}),this.context.isGrouped||(this.style.segments=n)),{type:"annotationInk",style:Ke({segments:n},this.context.getCommonStyleConfig()),transform:o}}}class _2 extends ms{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationRect"},n)),W(this,"shapeType","annotationRect"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const n=this.context.getTransform(),{width:o,height:h}=this.attributes,{position:v}=n;return{type:"annotationRect",id:this.id,style:Ke({x:v.x,y:v.y,width:o,height:h},this.context.getCommonStyleConfig()),transform:n}}getPath(){if(!this.pathDirty)return this.path;const{width:n,height:o,borderWidth:h}=this.parsedStyle,v=.5*((null==h?void 0:h.value)||0),b=n.value-2*v,w=o.value-2*v;return this.path=[{x:v,y:v},{x:v+b,y:v},{x:v+b,y:v+w},{x:v,y:v+w}],this.steps=O_(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class j2e extends rw{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(Ke({type:"annotationText"},n)),W(this,"shapeType","annotationText"),W(this,"controls",void 0),W(this,"eventHandler",void 0),W(this,"context",void 0),W(this,"editMode",!1),W(this,"textCursor",void 0),W(this,"textArea",void 0),W(this,"startSelectText",!1),W(this,"selectRectArray",[]),W(this,"inputChinese",!1),W(this,"curIndex",0),W(this,"startIndex",0),W(this,"endIndex",0),W(this,"lastEndIndex",0),W(this,"renderHooks",void 0),this.init(n.transform,n.selectableStyle),o&&(this.renderHooks=o)}init(n,o){this.context=new nu(this,o),this.eventHandler=new tu(this),this.context.setTransform(n)}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}getAnnotationConfig(){const{x:n,y:o,color:h,text:v,wordWarp:y,textBaseLine:_,fontStyle:b,fontVariant:w,fontWeight:I,fontFamily:A,fontSize:M,lineHeight:F,textAlign:V}=this.attributes;return{type:"annotationText",style:Ke({x:n,y:o,color:h,text:v,wordWarp:y,textBaseLine:_,fontStyle:b,fontVariant:w,fontWeight:I,fontFamily:A,fontSize:M,lineHeight:F,textAlign:V},this.context.getCommonStyleConfig()),transform:this.context.getTransform()}}startEditor(n,o){const h=Ju(this,{x:n,y:o});if(n=h.x,o=h.y,this.textArea&&(document.body.removeChild(this.textArea),this.textArea=void 0),!this.getCharByPosition(n,o))return void this.closeEditor();const v=this.getCharByPosition(n,o),y=.9*v.height;let _=0,b=0;if(n<v.x+v.width/2?(this.curIndex=v.index-1,_=v.x-this.chars[0].x):(this.curIndex=v.index,_=v.x-this.chars[0].x+v.width),b=v.y-this.chars[0].y,!this.textCursor){const I=new S5({style:{startPoint:{x:0,y:0},endPoint:{x:0,y},borderWidth:this.parsedStyle.fontSize.value/50,borderColor:"black"}});this.appendChild(I),this.textCursor=I}this.textCursor.setLocalPosition(_,this.getRelativeYAxis(b)),this.openTextarea(n,o)}closeEditor(){this.textCursor&&this.removeChild(this.textCursor),this.textArea&&(this.textArea.removeEventListener("input",n=>this.textareaInput(n)),this.textArea.removeEventListener("compositionstart",n=>this.textareaCompositionstart(n)),this.textArea.removeEventListener("compositionend",n=>this.textareaCompositionend(n)),this.textArea.removeEventListener("keydown",n=>this.textareaKeydown(n)),document.body.removeChild(this.textArea)),this.clearTextSelection(),this.textCursor=void 0,this.textArea=void 0,this.curIndex=0,this.editMode=!1}textStartHandler(){0!==this.selectRectArray.length&&this.clearTextSelection(),this.editMode&&(this.startSelectText=!0,this.startIndex=this.curIndex,this.endIndex=this.curIndex)}textMoveHandler(n){if(!this.editMode||!this.startSelectText)return;const{x:o,y:h}=Ju(this,n),v=this.getCharByPosition(o,h);if(this.endIndex=o<v.x+v.width/2?v.index-1:v.index,!v){const{lines:y,chars:_,parsedStyle:b}=this,{textBaseLine:w}=b,{height:I}=_[0],A=I/10;let M=0,F=h;switch(w){case"alphabetic":F=h+I-1.5*A;break;case"middle":F=h+I/2+A;break;case"ideographic":F=h+I+A;break;case"bottom":F=h+I+.5*A}for(let Q=y.length;Q>0;Q--)if(F>y[Q-1].y){M=Q-1;break}const V=y[M].sum-y[M].length,B=y[M].sum-1;this.endIndex=V;for(let Q=B;Q>=V;Q--)if(o>this.chars[Q].x+this.chars[Q].width/2){this.endIndex=Q+1;break}}this.endIndex!==this.lastEndIndex&&(this.lastEndIndex=this.endIndex,this.endIndex!==this.startIndex?(this.textCursor&&(this.removeChild(this.textCursor),this.textCursor=void 0),this.createTextSelectionArea(this.startIndex,this.endIndex)):this.clearTextSelection())}textEndHandler(){if(this.editMode){if(this.startSelectText=!1,this.startIndex!==this.endIndex&&this.textArea){var n;const{startIndex:o,endIndex:h}=this,v=Math.min(o,h),y=Math.max(o,h);null===(n=this.textArea)||void 0===n||n.setSelectionRange(v,y)}this.startIndex=0,this.endIndex=0}}openTextarea(n,o){if(!this.context.isActive)return;const h=document.createElement("input");h.type="text",h.setAttribute("style","position:fixed; opacity:0; width:1; height:1; top:80%; left:80%; z-index:-999; word-break:break-all"),h.value=this.parsedStyle.text,document.body.appendChild(h);const v=this.curIndex;this.textArea=h,h.setSelectionRange(v,v),h.addEventListener("input",y=>this.textareaInput(y),!1),h.addEventListener("compositionstart",y=>this.textareaCompositionstart(y),!1),h.addEventListener("compositionend",y=>this.textareaCompositionend(y),!1),h.addEventListener("keydown",y=>this.textareaKeydown(y),!1),h.focus()}moveTextCursor(n,o){if(!this.textCursor)return;if(0===this.chars.length)return void this.destroy();const h=n+o-1;let v,y;h<-1||h===this.chars.length||(-1===h?(v=0,y=0):(v=this.chars[h].x-this.chars[0].x+this.chars[h].width,y=this.chars[h].y-this.chars[0].y),this.curIndex+=o,this.textCursor.setLocalPosition(v,this.getRelativeYAxis(y)))}updateTextCursor(n){if(!this.textCursor||n<0||n>this.chars.length)return;let o,h;0===n?(o=0,h=0):(o=this.chars[n-1].x-this.chars[0].x+this.chars[n-1].width,h=this.chars[n-1].y-this.chars[0].y),this.curIndex=n,this.textCursor.setLocalPosition(o,this.getRelativeYAxis(h)),setTimeout(()=>{this.textArea.setSelectionRange(this.curIndex,this.curIndex)},0)}createTextSelectionArea(n,o){this.clearTextSelection();const h=Math.min(n,o),v=Math.max(n,o),y=[[]];let _=this.chars[h].lineIndex;for(let w=h;w<v;w++)_!==this.chars[w].lineIndex&&(y.push([]),_=this.chars[w].lineIndex),y[y.length-1].push(this.chars[w]);const b=this.chars[0].height;for(let w=0;w<y.length;w++){const A=y[w][0],M=y[w][y[w].length-1],F=A.x-this.lines[A.lineIndex].x,B=M.x-this.lines[M.lineIndex].x-F+M.width,Q=new ms({style:{x:F,y:this.getRelativeYAxis(A.y-this.chars[0].y)-2,height:b,width:B,background:"rgba(85,160,255,0.6)",borderColor:"transparent"}});this.selectRectArray.push(Q),this.renderSelectedRect()}}renderSelectedRect(){if(0!==this.selectRectArray.length)for(let n=0;n<this.selectRectArray.length;n++)this.appendChild(this.selectRectArray[n])}clearTextSelection(){if(0!==this.selectRectArray.length){for(let n=0;n<this.selectRectArray.length;n++)this.selectRectArray[n].destroy();this.selectRectArray=[]}}textareaInput(n){var o;if(this.inputChinese)return;const{length:h}=this.parsedStyle.text;this.style.text=this.textArea.value,""===this.textArea.value?(this.style.text=" ",this.textArea.value=" ",this.updateTextCursor(0)):this.moveTextCursor(this.curIndex,this.textArea.value.length-h),this.updateOrigin(),null===(o=this.renderHooks)||void 0===o||o.emit()}textareaCompositionstart(n){this.inputChinese=!0}textareaCompositionend(n){var o;const h=this.textArea.value.length-this.style.text.length;this.inputChinese=!1,this.style.text=this.textArea.value,this.moveTextCursor(this.curIndex,h),this.updateOrigin(),null===(o=this.renderHooks)||void 0===o||o.emit()}textareaKeydown(n){var o;if("ArrowLeft"===n.key&&this.moveTextCursor(this.curIndex,-1),"ArrowRight"===n.key&&this.moveTextCursor(this.curIndex,1),"ArrowUp"===n.key){if(0===this.curIndex)return;if(0===this.chars[this.curIndex-1].lineIndex)this.updateTextCursor(0);else{const{charIndex:h,lineIndex:v}=this.chars[this.curIndex-1];this.curIndex=h>this.lines[v-1].length?this.lines[v-1].sum:v-1==0?h:this.lines[v-2].sum+h,this.updateTextCursor(this.curIndex)}}if("ArrowDown"===n.key){if(this.curIndex===this.chars.length)return;if(0===this.curIndex)return void this.updateTextCursor(this.lines[0].length+1);if(this.chars[this.curIndex-1].lineIndex===this.lines.length-1)this.updateTextCursor(this.chars.length);else{const{charIndex:h,lineIndex:v}=this.chars[this.curIndex-1];this.curIndex=h>this.lines[v+1].length?this.lines[v+1].sum:this.lines[v].sum+h,this.updateTextCursor(this.curIndex)}}if("Backspace"===n.key){if(0===this.selectRectArray.length)return;this.clearTextSelection()}null===(o=this.renderHooks)||void 0===o||o.emit()}}class H2e{constructor(n){W(this,"shape",void 0),W(this,"textCursor",void 0),W(this,"textCursorInitCache",void 0),W(this,"inputComposition",!1),W(this,"startChar",void 0),W(this,"startDirection",void 0),W(this,"startPoint",void 0),W(this,"textRects",[]),W(this,"virtualChar",void 0),W(this,"isStart",!1),W(this,"canvas",void 0),W(this,"textClipboard",[]),W(this,"lineChars",void 0),W(this,"flatChars",void 0),W(this,"editMode",void 0),W(this,"textarea",void 0),W(this,"textSelection",[]),this.shape=n,this.calculateCharPosition()}getLineIndexByMoved(n){const{lines:o}=this.shape;let h=0;for(let v=0;v<o.length;v++){const{y,height:_}=o[v];n.y>y-.8*_&&(h=v)}return h}getLineIndexByPosition(n){const{lines:o,limitWidth:h}=this.shape;for(let v=0;v<o.length;v++){const y=o[v],{x:_,y:b,height:w}=y;if(new ms({style:{x:_,y:b-.8*w,width:h,height:w*(v===o.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(n))return v}return-1}getCharByPosition(n,o){if(-1===o)return null;const{lineChars:h}=this,v=h[o];for(let y=0;y<v.length;y++){const _=v[y],{x:b,y:w,charWidth:I,charHeight:A}=_;if(new ms({style:{x:b,y:w-.8*A,width:I,height:A*(_.lineIndex===h.length-1?1:1.2),borderWidth:1,background:"transparent"}}).isPointInPath(n))return _}return null}getCharAndDirection(n){const o=this.getLineIndexByPosition(n);let h,v=1;if(-1===o)return h=this.flatChars[this.flatChars.length-1],v=1,{char:h,direction:v};const y="textBox"===this.shape.textType;if(h=this.getCharByPosition(n,o),h){const{x:_,charWidth:b}=h;v=n.x<_+b/2?0:1}else{const _=this.lineChars[o];h=_[_.length-1],v=1,y&&n.x<_[0].x&&(h=_[0],v=0)}return"\r"!==h.text&&"\n"!==h.text&&"\r\n"!==h.text||(v=0),0===v&&0!==h.indexInLine&&(h=this.lineChars[h.lineIndex][h.indexInLine-1],v=1),{char:h,direction:v}}createCursor(n,o,h,v){if(!this.textCursor){const y=document.createElement("div");return y.className="ddv-annotation-cursor",y.style.left=n-.5+"px",y.style.top=`${o}px`,y.style.transform=`rotate(${h}deg)`,y.style.width="1px",y.style.height=`${v}px`,this.canvas.parentNode.appendChild(y),void(this.textCursor=y)}this.textCursor.style.left=n-.5+"px",this.textCursor.style.top=`${o}px`,this.textCursor.style.height=`${v}px`,this.textCursor.style.transform=`rotate(${h}deg)`,this.textCursor.style.animation="none",this.textCursor.style.animation=""}showTextCursor(n,o){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=(M,F)=>{const{x:V,y:B,charWidth:Q,charHeight:J,lineIndex:Z}=M;return new ms({style:{x:(F?V+Q:V)-this.shape.style.x,y:B-.8*J-this.shape.style.y,borderWidth:"1px",height:J*(Z>=this.lineChars.length-1?1:1.2)}})},y=M=>{this.shape.appendChild(M);const F=this.shape.getScale().y,V=M.getAngle();M.setAngle(0);const{x:B,y:Q}=M.getPosition();M.destroy(),this.createCursor(B,Q,V,M.parsedStyle.height.value*F)};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:_,shape:b}=this;if(!_.length&&this.virtualChar){const{fontSize:M}=this.shape.freeTextContentStyle,F=ni(M).value;if(F!==this.virtualChar.charHeight){const{borderOffset:V,padding:B}=this.shape,{y:Q}=this.shape.style;this.virtualChar.charHeight=F,this.virtualChar.y=Q+V+B+.8*F}return y(v(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let w=_[n];if(gt(n)&&(w=_[0],o=0),!_[n])return;"justify"===b.style.textAlign&&"textBox"===b.textType&&" "===w.text&&o&&_[w.totalIndex+1]&&(w=_[w.totalIndex+1],o=0);const I=_[w.totalIndex+1];let A;B_(w.text)&&o&&I&&(w=I,o=0),A=B_(w.text)&&o&&!I?v(this.virtualChar,1):v(w,o),y(A),this.startChar=w,this.startDirection=o,this.textCursorInitCache={char:w,isBack:o},h&&this.shape.hooks.selectTextChars.emit({startChar:w,endChar:w,isBack:!!o,needUpdate:!1})}moveTextCursor(n){const{textSelection:o}=this;let h,v;if(2===o.length){const[I,A]=o;switch(n){case"up":case"left":h=I.totalIndex,v=0;break;default:h=A.totalIndex,v=1}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(h,v)}const y=this.flatChars,_=y.length,{startChar:b,startDirection:w}=this;if(b){if("left"===n){const I=w?b.totalIndex-1:b.totalIndex-2;h=I>=0?I:0,v=I>=0?1:0}else if("right"===n){const I=w?b.totalIndex+1:b.totalIndex;h=I>_-1?_-1:I,v=1}else{const{x:I,charWidth:A,lineIndex:M}=b;if(0===M&&"up"===n)h=0,v=0;else if(M===this.lineChars.length-1&&"down"===n)h=y.length-1,v=1;else{const F=w?I+A:I,V="up"===n?this.lineChars[M-1]:this.lineChars[M+1];h=V[0].totalIndex,v=0,V.forEach(B=>{F>B.x+A/2&&(h=B.totalIndex,v=1)})}}this.showTextCursor(h,v)}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null)}showTextSelection(n,o){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=[],{lines:y,parsedStyle:_,textType:b}=this.shape;if(this.hideTextSelection(),this.textSelection=[n,o],!n||!o)return;const w=["right","justify"].includes(_.textAlign)&&"textBox"===b;if(n.y===o.y){const M=B_(n.text),F=B_(o.text);if(M&&F)return;v.push({x:n.x,y:n.y,lineIndex:n.lineIndex,width:n.x===o.x?n.charWidth:F?o.x-n.x:o.x-n.x+o.charWidth,height:y[n.lineIndex].height})}else{const M=this.shape.getTextAlignOffset(y[n.lineIndex]),{x:F,height:V}=y[n.lineIndex];if(v.push({x:n.x,y:n.y,lineIndex:n.lineIndex,width:F+(w?y[n.lineIndex].widthWithoutLF:y[n.lineIndex].width)+M-n.x,height:V}),o.lineIndex-n.lineIndex>1)for(let ce=n.lineIndex+1;ce<o.lineIndex;ce++){const{x:pe,y:Ce,height:Ve}=y[ce],te=w?y[ce].widthWithoutLF:y[ce].width,Me=this.shape.getTextAlignOffset(y[ce]);v.push({x:pe+Me,y:Ce,width:te,height:Ve,lineIndex:ce})}const Q=this.shape.getTextAlignOffset(y[o.lineIndex]),{x:J,y:Z,height:re}=y[o.lineIndex],se=w&&B_(o.text)?0:o.charWidth;v.push({x:J+Q,y:Z,width:o.x+se-J-Q,height:re,lineIndex:o.lineIndex})}const{x:I,y:A}=this.shape.style;this.hideTextCursor(),v.forEach(M=>{const V=new ms({style:{x:M.x-I,y:M.y-A-.8*M.height,width:M.width,height:M.height*(M.lineIndex===this.lineChars.length-1?1:1.2),background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(V),this.textRects.push(V)}),this.shape.hooks.selectTextChars.emit({startChar:n,endChar:o,isBack:!0,needUpdate:h})}hideTextSelection(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach(o=>{o.destroy()}),this.textSelection=[],this.textRects=[],n){const{char:o,isBack:h}=this.textCursorInitCache;this.showTextCursor(o.totalIndex,h)}}addText(n,o,h){if(!h||""===h)return;if(!n){const V=zt(Ke({},this.shape.freeTextContentStyle),{content:h});return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[V]}),this.shape.hooks.textContentUpdated.emit(),void this.showTextCursor(h.length-1,1)}const v=pn(this.shape.style.textContents),{freeContentIndex:y,indexInFreeContent:_}=n,b=v[y],{content:w}=b,I=DZ(this.shape.freeTextContentStyle,b),A=()=>zt(Ke({},this.shape.freeTextContentStyle),{content:h});if(o&&_===w.length-1)I?b.content+=h:v.splice(y+1,0,A());else if(o||_)if(I){const V=0===o?_:_+1;b.content=w.slice(0,V)+h+w.slice(V)}else{const V=[],B=w.slice(0,o?_+1:_),Q=w.slice(o?_+1:_);B&&V.push(zt(Ke({},b),{content:B})),V.push(A()),Q&&V.push(zt(Ke({},b),{content:Q})),v.splice(y,1,...V)}else y?DZ(this.shape.freeTextContentStyle,v[y-1])?v[y-1].content+=h:v.splice(y,0,A()):I?b.content=h+b.content:v.unshift(A());this.shape.updateStyle({textContents:[...v]}),this.shape.hooks.textContentUpdated.emit();const{char:M,isBack:F}=this.textCursorInitCache;this.showTextCursor(F?M.totalIndex+h.length:M.totalIndex+h.length-1,1)}deleteText(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const o=pn(this.shape.style.textContents);if(!o.length)return;let h=0;if(2===this.textSelection.length){const[v,y]=this.textSelection;if(v.freeContentIndex===y.freeContentIndex){const _=o[v.freeContentIndex];_.content=wZ(_.content,v.indexInFreeContent,y.indexInFreeContent)}else{const _=o[v.freeContentIndex],b=o[y.freeContentIndex];_.content=_.content.substring(0,v.indexInFreeContent),b.content=b.content.substring(y.indexInFreeContent+1);for(let w=v.freeContentIndex+1;w<y.freeContentIndex;w++)o[w].content=""}h=v.totalIndex-1}else{const{startChar:v,startDirection:y}=this;if(!v)return;const _=y?v:this.flatChars[v.totalIndex-1];if(!_)return;const{freeContentIndex:b,indexInFreeContent:w}=_,I=o[b];if(!I.color)return;I.content=wZ(I.content,w,w),h=_.totalIndex-1}this.shape.updateStyle({textContents:[...o]}),n&&this.shape.hooks.textContentUpdated.emit(),this.hideTextSelection(),this.showTextCursor(h,1,!1),this.shape.hooks.reRenderText.emit()}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:n}=this.shape.style,[o,h]=this.textSelection,v=[],y=o.freeContentIndex,_=h.freeContentIndex;if(y===_){const b=n[y],w=b.content.slice(o.indexInFreeContent,h.indexInFreeContent+1);v.push(zt(Ke({},b),{content:w}))}else for(let b=y;b<=_;b++){const w=Ke({},n[b]),I=w.content;b===y?w.content=I.slice(o.indexInFreeContent):b===_&&(w.content=I.slice(0,h.indexInFreeContent+1)),v.push(Ke({},w))}this.textClipboard=[...v],function(b){let w="";b.forEach(I=>{w+=I.content});try{navigator.clipboard.writeText(w)}catch(I){}}(v)}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:n,char:o}=this.textCursorInitCache,{textContents:h}=this.shape.style,v=n?o:this.flatChars[o.totalIndex-1];let y=0,_=(null==v?void 0:v.totalIndex)||-1;if(this.textClipboard.forEach(b=>{y+=b.content.length}),v)if(this.flatChars.length){const b=h[o.freeContentIndex];if(b.content.length===v.indexInFreeContent+1)h.splice(o.freeContentIndex+1,0,...pn(this.textClipboard)),this.shape.updateStyle({textContents:[...h]});else{const{content:w}=b,{indexInFreeContent:I}=v,A=[zt(Ke({},b),{content:w.slice(0,I+1)}),...pn(this.textClipboard),zt(Ke({},b),{content:w.slice(I+1)})];h.splice(o.freeContentIndex,1,...A),this.shape.updateStyle({textContents:[...h]})}}else this.shape.updateStyle({textContents:pn(this.textClipboard)}),_=-1;else h.unshift(...pn(this.textClipboard)),this.shape.updateStyle({textContents:h});this.showTextCursor(_+y,1),this.shape.hooks.textContentUpdated.emit()}selectAllText(){this.flatChars.length&&(this.showTextSelection(this.flatChars[0],this.flatChars[this.flatChars.length-1]),this.shape.hooks.reRenderText.emit())}updateTextSelection(){if(!this.textSelection.length)return;const[n,o]=this.textSelection;this.showTextSelection(this.flatChars[n.totalIndex],this.flatChars[o.totalIndex],!0),this.shape.hooks.reRenderText.emit()}calculateCharPosition(){const{lines:n}=this.shape,o=[];let h=0,v=0,y=0,_=0;n.forEach((I,A)=>{const M=I.height,F=[],V=this.shape.getTextAlignOffset(I),B=(Q,J,Z,re,se)=>{F.push({text:Q,x:J,y:Z,charWidth:re,charHeight:M,freeContentIndex:se,lineIndex:A,indexInLine:v,indexInFreeContent:h,totalIndex:_})};v=0,I.words.forEach(Q=>{const{wordWidth:J,freeContentIndex:Z,x:re,text:se}=Q;if(Z!==y&&(h=0,y=Z),1===Q.text.length)B(se,re+V,I.y,J,Z),_+=1,v+=1,h+=1;else{let ce=Q.x+V;for(let pe=0;pe<se.length;pe++){const Ce=se.charAt(pe),Ve=Ku(Ce,Q.style);B(Ce,ce,I.y,Ve,Z),ce+=Ve,_+=1,h+=1,v+=1}Q.text.length!==Q.originText.length&&(h+=Q.originText.length-Q.text.length)}}),o.push(F)});const b=this.shape.getTextAlignOffset();if(this.flatChars=o.flat(),this.lineChars=o,this.virtualChar=null,!n.length){const{x:I,y:A,textAlign:M}=this.shape.parsedStyle,{borderOffset:F,padding:V}=this.shape,{fontSize:B}=this.shape.freeTextContentStyle,Q=ni(B).value;return void(this.virtualChar={x:"right"===M?I+V+b:I+F+V+b,y:A+F+V+.8*Q,charWidth:1,charHeight:Q,lineIndex:0})}const w=this.flatChars[this.flatChars.length-1];B_(w.text)&&(this.virtualChar={x:this.shape.lines[0].x+b,y:w.y+1.2*this.shape.lines[w.lineIndex].height,charWidth:1,charHeight:w.charHeight,lineIndex:w.lineIndex+1})}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:n,isBack:o}=this.textCursorInitCache;this.showTextCursor(n.totalIndex,o)}enableEditMode(n,o){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateContentLines(),this.shape.hooks.reRenderText.emit()),this.calculateCharPosition(),this.editMode=!0,this.canvas=o;let h=!1;if("textBox"===this.shape.textType){const{totalTextHeight:v}=this.shape,{height:y}=this.shape.parsedStyle;v!==y.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0)}if(this.flatChars.length){const v=Ju(this.shape,n),y=this.getCharAndDirection(v),{char:_,direction:b}=y;this.startChar=_,this.startDirection=b,this.showTextCursor(_.totalIndex,b)}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(h=!0);this.shape.context.updateControlsFlags({useDefaultControls:h,enableMove:!1}),this.shape.hooks.enableTextEditMode.emit(),this.openTextarea(n)}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:n}=this.shape,{height:o}=this.shape.parsedStyle;n!==o.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit())}this.shape.hooks.disableTextEditMode.emit()}}editStartHandler(n){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const o=Ju(this.shape,n),h=this.getCharAndDirection(o);this.hideTextSelection();const{char:v,direction:y}=h;this.showTextCursor(v.totalIndex,y),this.isStart=!0,this.startChar=v,this.startDirection=y,this.startPoint=o,this.shape.hooks.reRenderText.emit()}editMoveHandler(n){if(!this.editMode||!this.isStart)return;const{lineChars:o}=this,h=Ju(this.shape,n),v=this.getLineIndexByMoved(h);let{startChar:y,startDirection:_}=this,b=null;const w=o[v],I=v===this.startChar.lineIndex?h.x>this.startPoint.x:h.y>this.startPoint.y,{lineIndex:A,indexInLine:M}=this.startChar;if(!this.startDirection&&!I){if(0===y.totalIndex)return void this.hideTextSelection(!0);const J=y.lineIndex===o.length-1;if(J&&h.y<this.startPoint.y)y=this.flatChars[y.totalIndex-1],_=1;else if(J)return void this.hideTextSelection(!0)}if(I&&_&&(y=o[A][M+1],_=0,!y))return void this.hideTextSelection(!0);if(I&&h.x<w[0].x+w[0].charWidth/2&&y.lineIndex!==v){const J=o[v-1];return b=J[J.length-1],void this.showTextSelection(y,b)}if(I)w.forEach((J,Z)=>{const{x:re,charWidth:se}=J;h.x>re+se/2&&(b=w[Z])});else for(let J=w.length-1;J>=0;J--){const{x:Z,charWidth:re}=w[J];Z+re/2>h.x&&(b=w[J])}if(!b)return void this.hideTextSelection(!0);const{lineIndex:F,indexInLine:V}=y,{lineIndex:B,indexInLine:Q}=b;I&&F===B&&V===Q+1||!I&&F===B&&V===Q-1?this.hideTextSelection(!0):I?this.showTextSelection(y,b):this.showTextSelection(b,y)}editEndHandler(){this.isStart=!1}editClickHandler(n,o){this.editMode&&(this.canvas=o,this.openTextarea(n))}openTextarea(n){if(this.editMode){if(!this.textarea){const o=document.createElement("textarea");o.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(o),this.textarea=o,o.addEventListener("input",h=>{this.inputComposition||this.textareaInput(h)},!1),o.addEventListener("compositionstart",h=>this.textareaCompositionstart(h),!1),o.addEventListener("compositionend",h=>{this.inputComposition=!1,this.textareaInput(h)},!1),o.addEventListener("keydown",h=>this.textareaKeydown(h),!1)}if(n){const{x:o,y:h}=n;this.textarea.style.left=`${o}px`,this.textarea.style.top=`${h}px`}this.textarea.value="",this.textarea.focus()}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null)}textareaInput(n){const o=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:h,isBack:v}=this.textCursorInitCache;this.addText(h,v,o)}else this.addText(void 0,void 0,o);this.textarea.value=""}textareaCompositionstart(n){this.inputComposition=!0}textareaKeydown(n){if(this.inputComposition||"Backspace"!==n.key||8!==n.keyCode)switch(n.ctrlKey&&"C"===n.key.toLocaleUpperCase()&&this.copyText(),n.ctrlKey&&"X"===n.key.toLocaleUpperCase()&&(this.copyText(),this.textSelection.length&&this.deleteText()),n.ctrlKey&&"V"===n.key.toLocaleUpperCase()&&this.textClipboard.length&&(n.preventDefault(),this.pasteText()),n.ctrlKey&&"Z"===n.key.toLocaleUpperCase()&&n.stopPropagation(),n.ctrlKey&&"A"===n.key.toLocaleUpperCase()&&this.selectAllText(),n.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down")}else this.deleteText()}}function DZ(p,n){return p.color===n.color&&p.fontFamily===n.fontFamily&&p.fontSize===n.fontSize&&p.fontStyle===n.fontStyle&&p.fontWeight===n.fontWeight&&p.lineThrough===n.lineThrough&&p.underline===n.underline}class sr extends aZ{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:TZ,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:n.id,style:Ke({freeTextType:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox"},n.style)}),W(this,"lastSelectedEndChar",void 0),W(this,"lastIsBack",void 0),W(this,"shapeType","annotationFreeText"),W(this,"textEditEventHandler",void 0),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),W(this,"freeTextContentStyle",void 0),W(this,"inputModeTimer",void 0),W(this,"hooks",{reRenderText:Cp(),selectTextChars:Cp(),textContentUpdated:Cp(),enableTextEditMode:Cp(),disableTextEditMode:Cp()}),this.freeTextContentStyle=h,this.init(n.transform,n.selectableStyle,v),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on(y=>{const _=y.endChar;if(this.isSameChar(_,this.lastSelectedEndChar)&&y.isBack===this.lastIsBack&&!y.needUpdate)return;let b=_.freeContentIndex;_.indexInFreeContent||!_.freeContentIndex||y.isBack||(b-=1);const w=this.style.textContents[b];this.lastSelectedEndChar=_,this.lastIsBack=y.isBack,this.freeTextContentStyle=zt(Ke({},w),{content:this.freeTextContentStyle.content})})}get isEditMode(){var n;return null===(n=this.textEditEventHandler)||void 0===n?void 0:n.editMode}get hasSelectedChars(){var n;return(null===(n=this.textEditEventHandler)||void 0===n?void 0:n.textSelection.length)>0}init(n,o,h){if("freeTextWriter"===this.textType&&h&&super.updateOrigin(),this.context=new nu(this,o),this.textEditEventHandler=new H2e(this),this.eventHandler=new tu(this),this.context.setTransform(n),"freeTextWriter"===this.textType&&h){const{x:v,y}=this.getPosition();this.updateOrigin(),this.setPosition({x:v,y})}}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin()}getAnnotationConfig(){const n="textBox"===this.textType?"annotationTextBox":"annotationFreeText",o=this.context.getTransform(),{position:h}=o,{width:v,height:y,textContents:_}=this.attributes,b={type:n,style:zt(Ke({x:h.x,y:h.y,textContents:pn(_),textAlign:this.style.textAlign},this.context.getCommonStyleConfig()),{width:v}),transform:o};return"textBox"===this.textType&&(b.style.height=y),b}calculateTotalHeight(){var n,o;const h=ni((null===(n=this.freeTextContentStyle)||void 0===n?void 0:n.fontSize)||16);if(null!==(o=this.lines)&&void 0!==o&&o.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=h.value+2*this.borderOffset;else{const{height:v}=this.parsedStyle;this.totalTextHeight=v.value>h.value+2*this.borderOffset?v.value:h.value+2*this.borderOffset+2*this.padding}}getBoundingRect(){var n;if(!this.boundsDirty)return this.bounds;const{x:o,y:h}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(n=this.lines)||void 0===n||!n.length)){var v;const y=ni((null===(v=this.freeTextContentStyle)||void 0===v?void 0:v.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:o,y:h,width:Ku("  ",zt(Ke({},this.freeTextContentStyle),{fontSize:y})),height:y.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight),this.bounds}updateFreeTextContentStyle(n){this.freeTextContentStyle=n,this.textEditEventHandler.updateCursor();const{flatChars:o}=this.textEditEventHandler;this.isEditMode&&!o.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit())}focusTexture(){const n=rr();this.isEditMode&&this.textEditEventHandler.textarea&&(n||this.textEditEventHandler.textarea.focus())}updateCursor(){this.textEditEventHandler.updateCursor()}isSameChar(n,o){return!(!n||!o)&&n.charHeight===o.charHeight&&n.charWidth===o.charWidth&&n.freeContentIndex===o.freeContentIndex&&n.indexInFreeContent===o.indexInFreeContent&&n.indexInLine===o.indexInLine&&n.text===o.text&&n.totalIndex===o.totalIndex}}class Sp extends ms{constructor(n){super({id:n,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),W(this,"shapeType","annotationGroup"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),W(this,"parent",void 0),W(this,"parentPosition",void 0),W(this,"shapes",[]),W(this,"clickedShape",null),W(this,"state",!1),W(this,"groupMode",0),this.context=new nu(this),this.eventHandler=new tu(this),this.eventHandler.isHit=this.isHit.bind(this),this.context.updateControlsFlags(this.groupMode?{enableEdit:!1}:{useDefaultControls:!1})}isHit(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:h,parsedStyle:v}=this;let{controls:y}=this;if(!this.state||"hidden"===v.visibility||!h.controlsFlags.enableControl)return this.clickedShape=null,-1;y||(h.initControls(),h.renderControls(),y=this.controls);let _=-1;if(this.groupMode)_=y.checkHitArea(n.x,n.y);else for(let b=0;b<this.shapes.length;b++)if(this.shapes[b].controls||(this.shapes[b].context.initControls(),this.shapes[b].context.renderControls()),this.shapes[b].controls.checkHitArea(n.x,n.y)>=0){this.clickedShape=this.shapes[b],_=9;break}return _<0&&o?(this.clickedShape=null,h.unHitShape(),this.context.destroyControls(),-1):_}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach(n=>{n instanceof sr&&n.isEditMode&&n.textEditEventHandler.disableEditMode(),this.appendChild(n),n.context.isGrouped=!0}),this.update(),this.context.initControls()}add(n){if(!this.parent){const o=n.parentNode;this.parent=o,this.parentPosition=o.getPosition()}if("hidden"!==n.parsedStyle.visibility&&-1===this.shapes.indexOf(n)){if(n.context.isInGroup=!0,this.shapes.push(n),this.state){const o=[];this.shapes.forEach(h=>{o.push(h.getWorldTransform().clone())}),n instanceof sr&&n.isEditMode&&n.textEditEventHandler.disableEditMode(),n.context.isGrouped=!0,this.appendChild(n),this.groupMode||this.showAllControls(n),this.shapes.forEach((h,v)=>{const y=this.getWorldTransform().inverse().multiply(o[v]);h.setLocalTransform(y)}),this.update()}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init())}}update(){const n=[],o=[],h=[];for(let A=0;A<this.shapes.length;A++){const M=this.shapes[A];let{controls:F}=M;F||(M.context.initControls(),F=M.controls),M.context.renderControls(),this.groupMode&&M.context.unHitShape();const V=F.controlPoints.slice(0,4);for(let B=0;B<4;B++){const{x:Q,y:J}=V[B].getCenterPosition();n.push(Q),o.push(J)}h.push(this.shapes[A].getWorldTransform().clone())}const v=Math.max(...n),y=Math.min(...n),_=Math.max(...o),b=Math.min(...o);this.updateStyle({x:0,y:0,width:v-y,height:_-b}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1,1);const{x:w,y:I}=this.getScale();this.scale(1/Math.abs(w),1/Math.abs(I)),this.setPosition({x:y,y:b}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach((A,M)=>{const F=this.getWorldTransform().inverse().multiply(h[M]);A.setLocalTransform(F)})}delete(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent||-1===this.shapes.indexOf(n))return;const h=n.getWorldTransform().clone();this.parent.appendChild(n);const v=this.parent.getWorldTransform().inverse().multiply(h);n.setLocalTransform(v),n.context.isInGroup=!1,n.context.isGrouped=!1,n.context.isActive=!1,n.context.destroyControls(),"freeTextWriter"!==(null==n?void 0:n.textType)&&n.context.updateControlsFlags({enableRotate:!0}),nm(n)&&n.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(n),1),o&&this.update(),0===this.shapes.length&&this.clear()}clear(){const{length:n}=this.shapes;for(let o=n-1;o>=0;o--)this.delete(this.shapes[o],!1);this.context.destroyControls(),this.reset()}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden"}destroy(){const{length:n}=this.shapes;for(let o=n-1;o>=0;o--)this.shapes[o].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0})}showAllControls(n){if(!this.state||this.groupMode)return;const o=h=>{nm(h)&&h.pointEventsHandler.enableEditMode(),h.controls||h.context.initControls(),h.context.updateControlsFlags({enableRotate:!1}),h.context.isActive=!0,h.context.renderControls()};n?o(n):this.shapes.forEach(h=>{o(h)})}getAnnotationConfig(){return{type:"annotationGroup"}}}class G2e extends ms{constructor(n){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),W(this,"shapeType","annotationLineControls"),W(this,"container",void 0),this.container=n}get isVisible(){return"hidden"!==this.parsedStyle.visibility&&SZ(null==this?void 0:this.container)}}class O5{constructor(n){W(this,"shape",void 0),W(this,"editMode",void 0),W(this,"hitIndex",-1),W(this,"hitPointPos",void 0),W(this,"startPoint",void 0),W(this,"controlsBox",void 0),W(this,"controlsPoints",[]),this.shape=n}getLineShapePoints(){const{shape:n}=this,{shapeType:o}=n;if("annotationLine"===o){const{startPoint:v,endPoint:y}=n.style;return[v,y]}const{points:h}=this.shape.parsedStyle;return h.slice(0,h.length)}initLineControls(){const{shape:n}=this;n.updatePoints();const{x:o,y:h}=this.shape.getScale(),{ctrlBorderColor:v,ctrlBorderWidth:y,ctrlLineDash:_,borderColor:b,borderWidth:w,lineDash:I,ctrlBorderRadius:A,ctrlWidth:M,ctrlHeight:F,background:V,ctrlBackground:B}=n.context.parsedControlsStyle,Q={background:B,borderColor:v,borderWidth:y,lineDash:_},J=this.shape.getBoundingRect(),Z=this.getLineShapePoints();this.controlsBox=new G2e(this.shape,{style:{width:J.width*o,height:J.height*h,borderColor:b,borderWidth:w,background:V,lineDash:I}}),Z.forEach(re=>{const se=new T5({style:Ke({width:M,height:F,roundedRadius:A},Q)}),ce=(re.x-J.x)*o-ni(M).value/2,pe=(re.y-J.y)*h-ni(F).value/2;se.setLocalPosition(ce,pe),this.controlsPoints.push(se),this.controlsBox.appendChild(se)}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox)}isHitPoint(n){if(!this.editMode)return-1;for(let o=0;o<this.controlsPoints.length;o++){const h=Ju(this.controlsPoints[o],n);if(this.controlsPoints[o].isPointInPath(h))return o}return-1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length||!this.editMode)return;const{ctrlWidth:n,ctrlHeight:o}=this.shape.context.parsedControlsStyle,{x:h,y:v}=this.shape.getScale(),y=this.shape.getBoundingRect(),_=this.getLineShapePoints();this.controlsPoints.length!==_.length&&(this.destroyLineControls(),this.initLineControls()),_.forEach((b,w)=>{this.controlsPoints[w].setLocalPosition((b.x-y.x)*h-n/2,(b.y-y.y)*v-o/2)}),this.controlsBox.updateStyle({width:y.width*h,height:y.height*v}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height)}destroyLineControls(){var n;null===(n=this.controlsBox)||void 0===n||n.destroy(),this.controlsPoints.forEach(o=>{o.destroy(),o=null}),this.controlsBox=null,this.controlsPoints=[]}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount||this.controlsPoints.length>0)return;const{shape:n}=this;this.editMode||this.initLineControls(),this.editMode=!0,n.context.isHit=!0,n.controls&&(n.context.lastControlsWidth=n.controls.getLength().width,n.context.lastControlsHeight=n.controls.getLength().height)}disableEditMode(){this.destroyLineControls(),this.editMode=!1}editStartHandler(n){if(!this.editMode)return;this.hitIndex=-1;const o=this.isHitPoint(n);-1!==o&&(this.hitIndex=o,this.hitPointPos=Ke({},this.shape.path[this.hitIndex])),this.startPoint=n,this.shape.context.lastLocalTransform=this.shape.getLocalTransform()}editMoveHandler(n){if(!this.editMode||-1===this.hitIndex)return;const{shape:o}=this,h="annotationLine"===o.shapeType,v=h?[...o.path]:[...o.parsedStyle.points],y=Ju(o,n);v[this.hitIndex]=y,h?o.updateStyle({startPoint:{x:v[0].x,y:v[0].y},endPoint:{x:v[1].x,y:v[1].y}}):o.style.points=v,this.updateLineControls()}editEndHandler(){this.editMode&&this.shape.updatePoints()}}class lw extends m2{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationPolygon"},n)),W(this,"shapeType","annotationPolygon"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),W(this,"pointEventsHandler",void 0),W(this,"pointerLimitCount",200),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.pointEventsHandler=new O5(this),this.eventHandler=new tu(this),this.context.setTransform(n),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const n=this.context.getTransform(),o=this.getBoundingRect(),{position:h}=n;let y=this.attributes.points;return(h.x!==o.x||h.y!==o.y)&&(y=[],this.attributes.points.forEach(_=>{y.push({x:_.x-o.x+h.x,y:_.y-o.y+h.y})})),{type:"annotationPolygon",style:Ke({points:y},this.context.getCommonStyleConfig()),transform:n}}}class cw extends w5{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationPolyline"},n)),W(this,"shapeType","annotationPolyline"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),W(this,"pointEventsHandler",void 0),W(this,"pointerLimitCount",200),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.pointEventsHandler=new O5(this),this.eventHandler=new tu(this),this.context.setTransform(n),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const n=this.context.getTransform(),o=this.getBoundingRect(),{position:h}=n;let y=this.attributes.points;return(h.x!==o.x||h.y!==o.y)&&(y=[],this.attributes.points.forEach(_=>{y.push({x:_.x-o.x+h.x,y:_.y-o.y+h.y})})),{type:"annotationPolyline",style:Ke({points:y,lineEnding:this.attributes.lineEnding},this.context.getCommonStyleConfig()),transform:n}}}class uw extends S5{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Ke({type:"annotationLine"},n)),W(this,"shapeType","annotationLine"),W(this,"eventHandler",void 0),W(this,"controls",void 0),W(this,"context",void 0),W(this,"pointEventsHandler",void 0),this.init(n.transform,n.selectableStyle)}init(n,o){this.context=new nu(this,o),this.pointEventsHandler=new O5(this),this.eventHandler=new tu(this),this.context.setTransform(n),this.context.updateControlsFlags({useDefaultControls:!1})}update(){this.updateOrigin(),this.context.updateControls()}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls()}getAnnotationConfig(){const n=this.context.getTransform(),o=this.getBoundingRect(),{startPoint:h,endPoint:v,lineEnding:y}=this.attributes,{position:_}=n,b=_.x!==o.x||_.y!==o.y;return{type:"annotationLine",style:Ke({startPoint:b?{x:h.x-o.x+_.x,y:h.y-o.y+_.y}:h,endPoint:b?{x:v.x-o.x+_.x,y:v.y-o.y+_.y}:v,lineEnding:y},this.context.getCommonStyleConfig()),transform:n}}}const z2e=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],Y2e=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],X2e=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],$2e=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],q2e=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],K2e=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],J2e=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Q2e=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],Z2e=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],eDe=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],tDe=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],nDe=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class iu extends C2e{constructor(n){var o;super(zt(Ke({type:"annotationStamp"},n),{style:zt(Ke({},n.style),{stampConfig:(null==n||null===(o=n.style)||void 0===o?void 0:o.stampConfig)||AZ(null==n?void 0:n.style.iconName)})})),W(this,"shapeType","annotationStamp"),W(this,"stampType","base"),W(this,"controls",void 0),W(this,"eventHandler",void 0),W(this,"context",void 0),W(this,"shapes",[]),W(this,"initialRect",void 0),W(this,"iconName",void 0),W(this,"imageLoadedByDraw",!1),W(this,"initByDraw",!1),W(this,"hooks",{reRenderImage:Cp()}),this.initByDraw=(null==n?void 0:n.initByDraw)||!1,this.initStamp(),this.init(n.transform,n.selectableStyle),this.initSize(n.style,n.transform)}init(n,o){this.eventHandler=new tu(this),this.context=new nu(this,o),this.context.setTransform(n),this.initialRect=this.getBoundingRect()}initStamp(){const{imageData:n,width:o,height:h}=this.style;if(this.stampItemShapes.forEach(v=>{v.destroy()}),this.stampItemShapes=[],n){let v;this.renderType="image",this.imageLoadedByDraw=!1,v=n instanceof Blob?URL.createObjectURL(n):n;const y=new Image;y.src=v,this.style.img=y,y.onload=()=>{if(this.initByDraw||!$t(o)||!$t(h)){const{width:_,height:b}=y;let w=_,I=b;if(_>400||b>400){const A=Math.max(_/400,b/400);w/=A,I/=A}this.updateStyle({width:w,height:I}),this.setLocalScale(1,1,1),this.initialWidth=w,this.initialHeight=I,this.initByDraw=!1,this.imageLoadedByDraw=!0}this.hooks.reRenderImage.emit()}}else this.initByDraw=!1,super.initStamp()}initSize(n,o){if("image"===this.renderType){const{x:w,y:I}=this.getLocalScale();1===w&&1===I||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value)}const h={},v=this.getAnnotationConfig(),{x:y,y:_}=(null==o?void 0:o.scale)||{x:1,y:1};var b;$t(null==n?void 0:n.x)&&(null==n?void 0:n.x)!==v.style.x&&(h.x=n.x),$t(null==n?void 0:n.y)&&(null==n?void 0:n.y)!==v.style.y&&(h.y=n.y),$t(null==n?void 0:n.width)&&n.width*y!==v.style.width&&(h.width=n.width),$t(null==n?void 0:n.height)&&n.height*_!==v.style.height&&(h.height=n.height),b=h,(0!==Object.keys(b).length||b.constructor!==Object)&&this.updateStampStyle(h)}update(){this.updateOrigin(),this.context.updateControls()}updateSize(n,o){const{x:h,y:v}=this.getLocalScale(),{x:y,y:_}=this.getPosition();if("image"===this.renderType){const{x:M,y:F}=this.getLocalPosition(),V=this.getAngle(),B=n*h,Q=o*v;this.setAngle(0),this.setLocalScale(1,1,1),this.updateStyle({width:B,height:Q});const J=M+(n-B)/2,Z=F+(o-Q)/2;return this.initialWidth=B,this.initialHeight=Q,this.setLocalPosition({x:J,y:Z}),void this.setAngle(V)}const{width:b,height:w}=this.parsedStyle;this.setLocalScale((n||b.value*h)/b.value,(o||w.value*v)/w.value),this.setPosition({x:y,y:_})}updateStampStyle(n){const{x:o,y:h}=this.getLocalPosition(),{x:v,y}=this.getLocalScale(),{width:_,height:b}=this.parsedStyle,{width:w,height:I}=n,{imageData:A,iconName:M}=this.style;let F=o,V=h;A||gt(null==n?void 0:n.imageData)||this.setLocalScale(1),null!=n&&n.imageData&&n.imageData!==A?(this.style.imageData=n.imageData,this.initStamp()):null!=n&&n.iconName&&n.iconName!==M&&(this.style.imageData=null,this.style.iconName=n.iconName,this.stampConfig=AZ(n.iconName),this.initStamp()),$t(null==n?void 0:n.opacity)&&(null==n?void 0:n.opacity)!==this.style.opacity&&(this.style.opacity=n.opacity),this.updateSize($t(w)?w:_.value*v,$t(I)?I:b.value*y);const{x:B,y:Q}=this.getLocalScale();$t(null==n?void 0:n.x)&&(F=n.x-(this.initialWidth-this.initialWidth*B)/2),$t(null==n?void 0:n.y)&&(V=n.y-(this.initialHeight-this.initialHeight*Q)/2),this.setLocalPosition(F,V)}getAnnotationConfig(){const n=this.context.getTransform(),{x:o,y:h}=this.style,v=pn(n);if(v.position.x===o&&v.position.y===h&&1===v.scale.x&&1===v.scale.y&&(delete v.position,delete v.scale),this.style.imageData)return{type:"annotationStamp",style:{x:n.position.x,y:n.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:Ke({},v)};const{initialWidth:y,initialHeight:_}=this,b=y*n.scale.x,w=_*n.scale.y;return{type:"annotationStamp",style:{x:n.position.x+(y-b)/2,y:n.position.y+(_-w)/2,width:b,height:w,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:Ke({},v)}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy()}}function AZ(p){return[Z2e,z2e,Y2e,Q2e,X2e,q2e,K2e,tDe,$2e,J2e,eDe,nDe][[Pi.REJECTED,Pi.ACCEPTED,Pi.APPROVED,Pi.NOT_APPROVED,Pi.COMPLETED,Pi.DRAFT,Pi.FINAL,Pi.VOID,Pi.CONFIDENTIAL,Pi.INITIAL_HERE,Pi.SIGN_HERE,Pi.WITNESS].indexOf(p)]}var Zd;!function(p){p.HIGHLIGHT="highlight",p.UNDERLINE="underline",p.STRIKEOUT="strikeout"}(Zd||(Zd={}));class Kh extends iu{constructor(n,o){super(Ke({},n)),W(this,"stampType","textAssist"),W(this,"textAssistType",void 0),W(this,"annotationRaw",void 0),this.textAssistType=o,this.annotationRaw=n.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const n=super.getAnnotationConfig();return this.annotationRaw&&(n.style.annotationRaw=this.annotationRaw),n}}class F5 extends iu{constructor(n){super(Ke({},n)),W(this,"stampType","raw"),W(this,"annotationRaw",void 0),this.annotationRaw=n.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1})}getAnnotationConfig(){const n=super.getAnnotationConfig();return this.annotationRaw&&(n.style.annotationRaw=this.annotationRaw),n}}function iDe(p,n,o){var h;(o instanceof EZ||o instanceof jv||o instanceof IZ)&&p!==n&&(null===(h=o.context)||void 0===h||h.updateControls())}function rDe(p,n,o){p!==n&&o.childNodes.length>0&&o.childNodes.forEach(h=>{h&&h.style&&(h.style.opacity=n)})}function oDe(p,n,o){var h;(o instanceof Qd||o instanceof lw||o instanceof cw)&&p!==n&&(null===(h=o.context)||void 0===h||h.updateControls())}function sDe(p,n,o){if(!(o instanceof lw||o instanceof cw||o instanceof uw||o instanceof Qd)||p===n)return;const{x:h,y:v}=o.getBoundingRect();o.updatePosition(h,v),o.updateOrigin()}function aDe(p,n,o){var h;(o instanceof _2||o instanceof sr)&&p!==n&&(null===(h=o.context)||void 0===h||h.updateControls())}function PZ(p,n,o){var h;o instanceof j2e&&p!==n&&(null===(h=o.context)||void 0===h||h.updateControls())}function lDe(p,n,o){var h;o instanceof uw&&p!==n&&(null==o||null===(h=o.context)||void 0===h||h.updateControls())}function cDe(p,n,o){o instanceof sr&&p!==n&&(o.textEditEventHandler.calculateCharPosition(),o.updateCursor(),o.hooks.reRenderText.emit())}function uDe(p,n,o){o instanceof sr&&p!==n&&(o.textEditEventHandler.calculateCharPosition(),o.textEditEventHandler.updateTextSelection(),o.hooks.reRenderText.emit())}const dDe={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class hDe{constructor(n){W(this,"eraser",void 0),W(this,"eraserPath",void 0),W(this,"erasedShapeIds",[]),W(this,"selectionBox",void 0),W(this,"startCanvasPoint",void 0),W(this,"startLocalPoint",void 0),W(this,"lastMovePoint",void 0),W(this,"resetActivatedZIndex",!0),W(this,"isSeparateText",!1),W(this,"lastClickPointerType",""),W(this,"drawType","annotationRect"),W(this,"isStartEdit",!1),W(this,"isStartDraw",!1),W(this,"controller",void 0),W(this,"eventArea",void 0),W(this,"eventMode","none"),W(this,"defaultGroup",void 0),W(this,"activatedShape",void 0),W(this,"activatedZIndex",0),W(this,"drawLineShape",!1),W(this,"stampPreview",void 0),W(this,"inkDelayTimeout",void 0),W(this,"drawInkShape",!1),this.controller=n,this.defaultGroup=new Sp("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5}isDefaultGroup(n){return n===this.defaultGroup}getDrawInitStyle(n,o){var h,v;let y={};const{defaultStyleConfig:_,eraserStyle:b,selectionStyle:w}=this.controller.interactiveConfig,I={x:o.x,y:o.y};switch(n){case"annotationInk":y={lineCap:"round",lineJoin:"round",segments:[[o]]};break;case"annotationPolygon":case"annotationPolyline":y={points:[o]};break;case"annotationLine":y={startPoint:o,endPoint:o};break;case"annotationFreeText":y=zt(Ke({},I),{textContents:[Ke(Ke({},Ki.textContent),null==_||null===(h=_.textTypewriter)||void 0===h?void 0:h.textContent)]});break;case"annotationTextBox":y=zt(Ke({},I),{textContents:[Ke(Ke({},Ki.textContent),null==_||null===(v=_.textBox)||void 0===v?void 0:v.textContent)]});break;default:y=I}let A=Ke(Ke({},Ki),_[dDe[n]]||{});return"select"===this.eventMode?A=zt(Ke({},w),{zIndex:999}):"erase"===this.eventMode&&(A=b),Ke(Ke({},A),y)}getDrawUpdateStyle(n,o){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=(this.startLocalPoint.x+o.x)/2,y=(this.startLocalPoint.y+o.y)/2,_=o.x-this.startLocalPoint.x,b=o.y-this.startLocalPoint.y;const w=["annotationCircle","annotationEllipse"].includes(n),I=Math.min(Math.abs(_),Math.abs(b));h&&(_=o.x>=this.startLocalPoint.x?I:-I,b=o.y>=this.startLocalPoint.y?I:-I,w&&(v=(2*this.startLocalPoint.x+_)/2,y=(2*this.startLocalPoint.y+b)/2));let A={};switch(n){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":A={x:v,y,r:I};break;case"annotationEllipse":A={x:v,y,rx:Math.abs(_)/2,ry:Math.abs(b)/2};break;case"annotationLine":A={endPoint:o};break;default:A={width:_,height:b}}return A}limitPoint(n,o,h){if(!this.eventArea)return;const{x:v,y,width:_,height:b}=this.eventArea;let w=0,I=0,A=0;if(o){const{lastHitControlPoint:M,lastHitControlPointCenter:F}=this.activatedShape.context;M&&F&&(I=M.x-F.x,A=M.y-F.y)}else w=sw(h)?h.parsedStyle.borderWidth.value:0;n.x<v+w+I&&(n.x=v+w+I),n.y<y+w+A&&(n.y=y+w+A),n.x>v+_+I&&(n.x=v+_+I),n.y>y+b+A&&(n.y=y+b+A)}executeErase(){var n;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(n=this.eraserPath)||void 0===n?void 0:n.id],!1),this.eraser=null,this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[])}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:n,containerId:o}=this.controller,h=[],v=n.get(o),{width:y,height:_}=this.selectionBox.parsedStyle;if(y.value<2&&_.value<2){const b=[];v.forEach(w=>{if("hidden"===w.style.visibility||!w.context.controlsFlags.enableControl||w===this.selectionBox||"annotationGroup"===w.shapeType)return;const I=Ju(w,this.startCanvasPoint);!w.context.isGrouped&&w.isPointInPath(I,this.getHitBorderOffset(w))&&b.push(w)}),b.length&&(b.sort((w,I)=>w.style.zIndex-I.style.zIndex),h.push(b[b.length-1]))}else v.forEach(b=>{"annotationGroup"!==b.shapeType&&"visible"===b.style.visibility&&b.context.controlsFlags.enableControl&&b!==this.selectionBox&&function(w,I){I.controls||I.context.initControls(),I.context.renderControls();const A=I.controls.controlPoints.slice(0,4);for(let ce=0;ce<4;ce++){const pe=Ju(w,A[ce].getPosition());if(w.isPointInPath(pe))return!0}const M=[],{x:F,y:V}=w.getPosition(),{width:B,height:Q}=w.parsedStyle,J=Math.abs(w.getScale().x),Z=Math.abs(w.getScale().y);M.push({x:F,y:V},{x:F+B.value*J,y:V},{x:F+B.value*J,y:V+Q.value*Z},{x:F,y:V+Q.value*Z});const re=I.getBoundingRectObject();re.setLocalTransform(I.getLocalTransform()),I.parentNode.appendChild(re);const se=re.getWorldTransform().inverse();for(let ce=0;ce<4;ce++){const pe=se.transformPoint(M[ce]);if(pe.x+=re.parsedStyle.x,pe.y+=re.parsedStyle.y,re.isPointInPath(pe))return re.destroy(),!0}return re.destroy(),I.context.destroyControls(),!1}(this.selectionBox,b)&&h.push(b)});1===h.length?this.selectShapes([h[0]]):h.length>1?this.selectShapes(h):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender()}activateShape(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n||"hidden"===n.style.visibility||!n.context.controlsFlags.enableControl||this.activatedShape===n&&n.context.isActive)return;const{showOnTopWhenSelected:v}=this.controller.interactiveConfig;var y;this.activatedShape&&this.activatedShape!==n&&(o?(v&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(y=this.activatedShape)||void 0===y?void 0:y.parentNode)===(null==n?void 0:n.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape()),this.activatedShape=n,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),v&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||n.context.initControls(),n.context.renderControls(),nm(n)&&n.pointEventsHandler.enableEditMode(),this.isDefaultGroup(n)&&n.showAllControls(),o||this.controller.hooks.emitSelectAnnotation(n),h&&this.controller.hooks.emitAnnotationRender()}inactivateShape(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:h}=this.controller.interactiveConfig;if(h&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof Qd&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof sr&&"freeTextWriter"===this.activatedShape.textType){const{textContents:v}=this.activatedShape.style;let y="";v.forEach(_=>{y+=(null==_?void 0:_.content)||""}),0===y.length&&this.controller.deleteShape([this.activatedShape.id],!0)}this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),n&&this.controller.hooks.emitSelectAnnotation(null,o)}setEventArea(n){this.eventArea=n,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea)}setEventMode(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof Qd&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const h=[...this.activatedShape.style.points];rr()||h.pop(),this.activatedShape.style.points=h}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=n,this.drawType=o,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==n&&(this.inactivateShape(!0),"erase"===n&&(this.drawType="annotationInk"),"select"===n&&(this.drawType="annotationRect"))}getFreeTextLimitWidth(n,o,h,v,y,_){const b=n,w=o,I=Math.round(h),A=Math.round(_);if(!b)return 0;let M=b,F=v;if(A!==I){if(0===A)switch(I){case 90:return y;case 180:return v;case-90:M=w,F=y}if(-90===A)switch(I){case 0:return y;case 90:return v;case 180:M=w,F=y}if(180===A||-180===A)switch(I){case 0:return v;case-90:return y;case 90:M=w,F=y}if(90===A)switch(I){case 180:return y;case-90:return v;case 0:M=w,F=y}}let V=M-F;return V<0&&(V=M),V}selectShapes(n){const o=[];return n.forEach(h=>{"visible"===h.parsedStyle.visibility&&h.context.controlsFlags.enableControl&&o.push(h)}),this.inactivateShape(!n.length),!!o.length&&(this.defaultGroup.clear(),1===o.length?this.activateShape(o[0],!1,!0):(o.forEach(h=>{this.defaultGroup.add(h)}),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(n){if("none"!==this.eventMode||!this.activatedShape)return;const{offsetX:o,offsetY:h}=Jd(this.controller.canvas,n),v={x:o,y:h};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(v,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape)}editMoveHandler(n){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:o,offsetY:h}=Jd(this.controller.canvas,n),v={x:o,y:h};this.limitPoint(v,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(v,n.shiftKey),this.controller.hooks.emitAnnotationRender()}editEndHandler(n){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape))}drawStartHandler(n){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==n.pointerType&&"pen"!==n.pointerType||this.drawStampMoveHandler(n,!1));if(!this.eventArea)return;const{controller:o}=this,{drawType:h,drawLineShape:v,eventMode:y}=this,{offsetX:_,offsetY:b}=Jd(o.canvas,n),{x:w,y:I,width:A,height:M}=this.eventArea;if(_<w||_>w+A||b<I||b>I+M)return;const F={x:_,y:b},V=o.container.getWorldTransform().inverse().transformPoint(F);if(this.isStartDraw=!0,this.startCanvasPoint=F,this.startLocalPoint=V,this.lastMovePoint=null,"select"===y&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===y&&(v||this.drawInkShape)){const re=this.activatedShape instanceof Qd;return re&&(this.activatedShape.addSegment(),this.activatedShape.setUseDouglasPeucker(!1)),this.activatedShape.addPoint(V),void(re||"touch"!==n.pointerType&&"pen"!==n.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(h)&&(this.drawLineShape=!0),"draw"===y&&-1!==["annotationInk"].indexOf(h)&&(this.drawInkShape=!0);const B={style:this.getDrawInitStyle(this.drawType,V)};if("annotationFreeText"===this.drawType){const{cropBoxRect:re}=this.controller.container.parentNode.parentNode.parentNode,se=this.getFreeTextLimitWidth(re.width,re.height,this.controller.container.getAngle(),B.style.x-re.left||0,B.style.y-re.top||0,0);B.style.width=se||B.style.width}const Q=this.controller.addShape(this.drawType,B,!1);Q.style.zIndex=999,Q instanceof Qd&&Q.setUseDouglasPeucker(!1);const J=()=>{0!==this.controller.container.getAngle()&&RZ(Q)&&(Q.setAngle(0),Q.setPosition(F))},{container:Z}=this.controller;if("draw"===y)this.controller.hooks.emitBeforeAnnotationDraw(Q),J();else if("erase"===y){if(Q.style.background=null,Z){const re=Q.style.borderWidth/Z.getScale().x;Q.style.borderWidth=re}this.eraserPath=Q}else{if(Z){const re=Q.style.borderWidth/Z.getScale().x;Q.style.borderWidth=re}this.selectionBox=Q,J()}this.activatedShape=Q,this.controller.hooks.emitAnnotationRender()}drawMoveHandler(n,o){const{activatedShape:h,eventMode:v,isStartDraw:y,drawType:_}=this;if("none"===v)return;if("draw"===v&&"annotationStamp"===_)return void this.drawStampMoveHandler(n,o);if("draw"===v&&"annotationFreeText"===_||!y)return;const{offsetX:b,offsetY:w}=Jd(this.controller.canvas,n),I={x:b,y:w};this.limitPoint(I,!1,this.activatedShape);const A=this.controller.container.getWorldTransform().inverse().transformPoint(I);if("annotationPolyline"===_||"annotationPolygon"===_){const M=pn(h.parsedStyle.points),F=M.length;1===F?M[F]=A:M[F-1]=A,h.style.points=M}else if("annotationInk"===_)h.addPoint(A);else{const M=this.getDrawUpdateStyle(this.drawType,A,n.shiftKey),F=this.controller.container.getAngle();if(0!==F&&RZ(h)){if(90===Math.abs(Math.round(F))){const V=M.width;M.width=M.height,M.height=V}M.width=I.x-this.startCanvasPoint.x>0?Math.abs(M.width):-Math.abs(M.width),M.height=I.y-this.startCanvasPoint.y>0?Math.abs(M.height):-Math.abs(M.height),h.updateStyle(M),h.setPosition(Ke({},this.startCanvasPoint))}else h.updateStyle(M)}this.controller.hooks.emitAnnotationRender()}drawStampMoveHandler(n,o){const{offsetX:h,offsetY:v}=Jd(this.controller.canvas,n),y={x:h,y:v},_=this.controller.container.getRootNode(),b=_.getWorldTransform().inverse().transformPoint(y),w=()=>{if(!this.stampPreview)return;const I=this.stampPreview.getBoundingRect(),A=(null==n?void 0:n.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!o&&A?"visible":"hidden",this.stampPreview.setLocalPosition(b.x-I.width/2,b.y-I.height/2)};if(!this.stampPreview){const{defaultStyleConfig:I}=this.controller.interactiveConfig,{stamp:A}=I,M=(null==A?void 0:A.stampIcon)||(null==Ki?void 0:Ki.stampIcon),F=(null==A?void 0:A.imageData)||(null==Ki?void 0:Ki.imageData);if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:M,imageData:F,opacity:$t(A.opacity)?A.opacity:.5,zIndex:9999},initByDraw:!0}),_.appendChild(this.stampPreview),!F&&M){const{width:V,height:B}=this.stampPreview.parsedStyle;if(B.value>60){const Q=B.value/60;this.stampPreview.updateSize(V.value/Q,B.value/Q)}this.stampPreview.hooks.reRenderImage.on(()=>{this.controller.hooks.emitAnnotationRender()})}else this.stampPreview.hooks.reRenderImage.on(()=>{w(),this.controller.hooks.emitAnnotationRender()})}w(),this.controller.hooks.emitAnnotationRender()}eraseMoveHandler(n){const{eventMode:h,eraser:v,isStartDraw:y,erasedShapeIds:_,controller:b}=this;if("erase"!==h&&v&&(this.eraser=null,v.destroy()),"erase"!==h||!b.container||!y)return;const{offsetX:w,offsetY:I}=Jd(b.canvas,n),A={x:w,y:I};this.lastMovePoint||(this.lastMovePoint=A),b.shapeArrMap.get(b.containerId).forEach(M=>{M!==this.eraserPath&&"visible"===M.parsedStyle.visibility&&M.context.controlsFlags.enableControl&&function(F,V,B){const Q=Ju(F,V),J=Xg(V,B),Z=F.isPointInPath(Q,5);if(Z||J<=.9)return Z;const re=J/1,se=(V.x-B.x)/re,ce=(V.y-B.y)/re;for(let pe=0;pe<Math.abs(re);pe++){const Ce=Ju(F,{x:B.x+se*pe,y:B.y+ce*pe});if(F.isPointInPath(Ce,5))return!0}return!1}(M,A,this.lastMovePoint)&&(M.style.opacity=.5,_.push(M.id))}),this.lastMovePoint=A,this.controller.hooks.emitAnnotationRender()}drawEndHandler(n){const{eventMode:o,isStartDraw:h,drawLineShape:v,drawType:y,activatedShape:_,controller:b}=this;if("draw"===o&&"annotationStamp"===y)return void this.drawStampEndHandler(n);if("none"===o||!h||v)return;if(this.isStartDraw=!1,["annotationRect","annotationTextBox"].includes(y)){const{width:I,height:A,borderWidth:M}=_.parsedStyle,{x:F,y:V}=_.getPosition(),{x:B,y:Q}=_.getScale(),J=(null==M?void 0:M.value)||0;let Z=F,re=V;I.value<0&&(Z=F-(-I.value+J)*B,_.style.width=2*J-I.value),A.value<0&&(re=V-(-A.value+J)*Q,_.style.height=2*J-A.value),_.setPosition({x:Z,y:re})}if("draw"===o&&this.drawInkShape)return _.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?b.hooks.emitAddAnnotation("draw",[this.activatedShape]):b.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout(()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof Qd&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)))},this.controller.interactiveConfig.inkCreateDelay));if("draw"===o&&"annotationFreeText"!==y&&"annotationStamp"!==y){const{offsetX:I,offsetY:A}=Jd(b.canvas,n);((this.startCanvasPoint.x-I)**2+(this.startCanvasPoint.y-A)**2)**.5<2&&"annotationStamp"!==_.shapeType&&(b.deleteShape([_.id],!1),b.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null)}const w=(I,A)=>{I instanceof sr&&(I.textEditEventHandler.enableEditMode(this.startCanvasPoint,A),"textBox"===I.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===I.textType&&setTimeout(()=>{document.activeElement instanceof HTMLTextAreaElement||I.textEditEventHandler.enableEditMode(this.startCanvasPoint,A)},10))};if("draw"===o&&this.activatedShape){const I=this.activatedShape,{canvas:A}=this.controller;b.hooks.emitAddAnnotation("draw",[this.activatedShape]),b.interactiveConfig.enableContinuousDrawing?_ instanceof sr?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),w(_,A)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),b.hooks.emitAfterAnnotationDraw(I),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),w(_,A))}"erase"===o&&this.executeErase(),"select"===o&&this.executeBoxSelect()}drawStampEndHandler(n){const{offsetX:o,offsetY:h}=Jd(this.controller.canvas,n);if(!this.stampPreview||!this.eventArea||this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return;const{x:v,y,width:_,height:b}=this.eventArea;if(o<v||o>_+v||h<y||h>b+y)return;const{defaultStyleConfig:w}=this.controller.interactiveConfig,{stamp:I}=w,A=$t(null==I?void 0:I.opacity)?null==I?void 0:I.opacity:null==Ki?void 0:Ki.opacity,M=this.stampPreview;M.style.opacity=A;const{containerId:F,container:V,shapeArrMap:B}=this.controller,Q=Ke({},M.getPosition()),J=Ke({},M.getScale()),Z=V.getScale(),re=J.x/Z.x,se=J.y/Z.y;if(B.get(F).set(M.id,M),M.index=B.get(F).size,M.pageUid=F,V.appendChild(M),M.style.imageData){const{width:ce,height:pe}=M.parsedStyle;M.updateStyle({width:ce.value*re,height:pe.value*se}),M.setLocalScale(1,1,1)}else M.scale(re,se);M.setAngle(0),M.setPosition(Q),this.stampPreview=null,this.activatedShape=M,this.controller.hooks.emitBeforeAnnotationDraw(M),this.controller.hooks.emitAddAnnotation("draw",[M]),this.controller.interactiveConfig.enableContinuousDrawing||(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(M,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(M))}dblClickHandler(n){const{activatedShape:o,controller:h}=this;if(!o)return;const{shapeType:v}=o;if(this.drawLineShape&&("annotationPolygon"===v||"annotationPolyline"===v)){const y=[...o.style.points],_=y.length;return rr()?Xg(y[_-1],y[_-2])<=15&&y.pop():y.pop(),"mouse"===this.lastClickPointerType&&(y.pop(),this.lastClickPointerType=""),y.length<2?(h.deleteShape([o.id],!1),this.activatedShape=null):(o.style.points=y,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!h.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(o),this.resetActivatedZIndex=!1,this.activateShape(o,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===v&&!this.isSeparateText){const{offsetX:y,offsetY:_}=Jd(this.controller.canvas,n),{textEditEventHandler:b}=o,w={x:y,y:_};if(this.activatedShape instanceof sr&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:I}=this.controller.container.parentNode.parentNode.parentNode,A=this.getFreeTextLimitWidth(I.width,I.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-I.left,this.activatedShape.getLocalPosition().y-I.top,this.activatedShape.getAngle());A!==this.activatedShape.style.width&&(this.activatedShape.style.width=A,this.controller.hooks.emitModifyAnnotation(["appearanceChanged"],[this.activatedShape]))}b.enableEditMode(w,this.controller.canvas),this.controller.hooks.emitAnnotationRender()}}clickHandler(n){const{activatedShape:o,eventMode:h}=this;if(!o)return;const{shapeType:v}=o,y=()=>{if("annotationFreeText"===v){const{offsetX:_,offsetY:b}=Jd(this.controller.canvas,n),{textEditEventHandler:w}=o;w.editClickHandler({x:_,y:b},this.controller.canvas)}};if(this.lastClickPointerType=null==n?void 0:n.pointerType,this.isSeparateText=!1,"none"===h){if(n.ctrlKey){if(this.isDefaultGroup(o)){const{clickedShape:_}=o;this.defaultGroup.delete(_);const{shapes:b}=this.defaultGroup;if(b.length<2&&(this.defaultGroup.context.isActive=!1),1===b.length){const w=b[0];this.activateShape(w,!1,!1),this.isSeparateText=w instanceof sr}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(o),y());return void this.controller.hooks.emitAnnotationRender()}y()}}keyDownHandler(n){const{activatedShape:o}=this;if(o&&("Delete"===n.key||"Backspace"===n.key)){if(aw(o)&&o.textEditEventHandler.editMode)return;this.controller.deleteShape([o.id]),this.inactivateShape()}}getHitBorderOffset(n){if(!n)return 10;const o=n.getScale();if(o.x<1||o.y<1){const h=Math.min(o.x,o.y);return Math.round(Math.abs(10/h))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:n}=this.controller.interactiveConfig,{stamp:o}=n,h=(null==o?void 0:o.stampIcon)||(null==Ki?void 0:Ki.stampIcon),v=(null==o?void 0:o.imageData)||(null==Ki?void 0:Ki.imageData),y=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:h,imageData:v,opacity:$t(o.opacity)?o.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),y.appendChild(this.stampPreview),!v&&h){const{width:_,height:b}=this.stampPreview.parsedStyle;if(b.value>60){const w=b.value/60;this.stampPreview.updateSize(_.value/w,b.value/w)}}}}function RZ(p){return["annotationFreeText","annotationTextBox","annotationRect"].includes(p.shapeType)}var ml,Jh,C2=new WeakMap;class fDe extends or{constructor(){super(...arguments),W(this,"renderAnnotation",Dt(this)),W(this,"addAnnotation",Dt(this)),W(this,"deleteAnnotation",Dt(this)),W(this,"selectAnnotation",Dt(this)),W(this,"modifyAnnotation",Dt(this)),W(this,"annotationModeChanged",Dt(this)),W(this,"beforeAnnotationEdit",Dt(this)),W(this,"afterAnnotationEdit",Dt(this)),W(this,"beforeAnnotationDraw",Dt(this)),W(this,"afterAnnotationDraw",Dt(this)),W(this,"selectAnnotationTextChars",Dt(this)),W(this,"enableAnnotationTextEditMode",Dt(this)),W(this,"disableAnnotationTextEditMode",Dt(this)),bi(this,C2,[])}emitAddAnnotation(n,o){const h=[];o.forEach(v=>{h.push({uid:v.id,shape:v})}),this.addAnnotation.emit({action:n,shapes:h})}emitDeleteAnnotation(n){const o=[];n.forEach(h=>{o.push({uid:h.id,shape:h})}),this.deleteAnnotation.emit({shapes:o})}emitSelectAnnotation(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=[];n instanceof Sp?n.shapes.forEach(v=>{h.push(v.id)}):n&&h.push(n.id),(h.length||Xe(C2,this).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...h],oldAnnotationsUids:[...Xe(C2,this)],emitSelected:o}),Wn(C2,this,h))}emitModifyAnnotation(n,o){const h=[];o.forEach(v=>{v instanceof Sp?v.shapes.forEach(y=>{h.push({uid:y.id,shape:y})}):h.push({uid:v.id,shape:v})}),this.modifyAnnotation.emit({actions:n,shapes:h})}emitAnnotationModeChanged(n){this.annotationModeChanged.emit(n)}emitBeforeAnnotationEdit(n){n instanceof sr&&n.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(n)}emitAfterAnnotationEdit(n){this.afterAnnotationEdit.emit(n)}emitAnnotationRender(){this.renderAnnotation.emit()}emitSelectAnnotationTextChar(n){this.selectAnnotationTextChars.emit(n)}emitBeforeAnnotationDraw(n){this.beforeAnnotationDraw.emit(n)}emitAfterAnnotationDraw(n){this.afterAnnotationDraw.emit(n)}emitEnableAnnotationTextEditMode(n){this.enableAnnotationTextEditMode.emit(n)}emitDisableAnnotationTextEditMode(n){this.disableAnnotationTextEditMode.emit(n)}}class pDe{constructor(n){W(this,"shapeArrMap",void 0),W(this,"shapeMap",void 0),W(this,"annotationMode","none"),W(this,"brush","annotationRect"),W(this,"canvas",void 0),W(this,"hooks",void 0),W(this,"interactiveConfig",pn(W2e)),W(this,"eventService",void 0),W(this,"containerId",void 0),W(this,"container",void 0),qu.bindHandler(["opacity"],void 0,rDe),qu.bindHandler(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,PZ),qu.bindHandler(["text","width","wordWarp","borderWidth","lineHeight","fontWeight","textTransform","textBaseLine"],void 0,PZ),qu.bindHandler(["width","height","borderWidth"],void 0,aDe),qu.bindHandler(["startPoint","endPoint","lineEnding"],void 0,lDe),qu.bindHandler(["r","rx","ry","borderWidth"],void 0,iDe),qu.bindHandler(["points","segments"],void 0,oDe),qu.bindHandler(["borderWidth"],void 0,sDe),qu.bindHandler(["textContents","borderWidth","textAlign"],void 0,cDe),qu.bindHandler(["textAlign"],void 0,uDe),this.canvas=n,this.eventService=new hDe(this),this.hooks=new fDe,this.shapeArrMap=new Map,this.shapeMap=new Map}set drawType(n){this.brush=n,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",n)}get drawType(){return this.brush}bindFreeTextHooks(n){if(!(n instanceof sr))return;const o=n.hooks;let h;o.reRenderText.on(()=>{this.hooks.emitAnnotationRender()}),o.textContentUpdated.on(()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[n])}),o.selectTextChars.on(v=>{var y;if(v.startChar===v.endChar&&n.isSameChar(h,v.endChar)&&!v.needUpdate)return;const{freeTextContentStyle:_}=n,b="freeTextWriter"===n.textType?"textTypewriter":"textBox",{defaultStyleConfig:w}=this.interactiveConfig;w[b]||(w[b]={}),w[b].textContent=zt(Ke({},_),{content:null===(y=w[b])||void 0===y||null===(y=y.textContent)||void 0===y?void 0:y.content}),h=v.endChar,this.hooks.emitSelectAnnotationTextChar(n)}),o.enableTextEditMode.on(v=>{this.hooks.emitEnableAnnotationTextEditMode(n)}),o.disableTextEditMode.on(v=>{h=null,this.hooks.emitDisableAnnotationTextEditMode(n)})}bindStampHooks(n){n instanceof iu&&n.hooks.reRenderImage.on(()=>{this.hooks.emitAnnotationRender()})}isHitShape(n){const{offsetX:o,offsetY:h}=Jd(this.canvas,n),{activatedShape:v,defaultGroup:y}=this.eventService,_={x:o,y:h},{shapeArrMap:b,shapeMap:w,containerId:I}=this,A=b.get(I)||w;if(v&&(y===this.eventService.activatedShape&&(null==y?void 0:y.parentNode)===this.container||A.has(v.id))){const Q=v.eventHandler.isHit(_,!1);if(-1!==Q)return{isHit:!0,isHitSelected:!0,hitControlPointIndex:Q,shape:v}}const F=[];let V=!1,B=null;return A.forEach(Q=>{if("hidden"===Q.style.visibility||!Q.context.controlsFlags.enableControl||Q===v)return;const J=Ju(Q,_);!Q.context.isGrouped&&Q.isPointInPath(J,this.eventService.getHitBorderOffset(Q))&&(V=!0,F.push(Q))}),V&&(F.sort((Q,J)=>Q.style.zIndex-J.style.zIndex),B=F[F.length-1]),{isHit:V,shape:B,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return!!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof sr)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=n,this.eventService.setEventMode(n,this.drawType),rr()&&"draw"===n&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==n&&this.eventService.inactivateShape(),o&&this.hooks.emitAnnotationModeChanged(n)}setAnnotationContainer(n,o){if(o!==this.container){const{activatedShape:h,drawLineShape:v,drawInkShape:y,drawType:_}=this.eventService;if("draw"===this.eventService.eventMode&&h){if(y&&h instanceof Qd&&(clearTimeout(this.eventService.inkDelayTimeout),h.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),v){const b=[...h.style.points];h.style.points=b,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1}"annotationInk"!==_&&(this.hooks.emitAddAnnotation("draw",[h]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(h)),this.eventService.activatedShape=null)}}this.containerId=n,this.container=o,this.shapeArrMap.get(n)||this.shapeArrMap.set(n,new Map)}setAnnotationInteractiveConfig(n){const o=pn(n),{controlsStyle:h,defaultStyleConfig:v,eraserStyle:y,selectionStyle:_}=this.interactiveConfig;o.defaultStyleConfig=(null==o?void 0:o.defaultStyleConfig)||{};const{stamp:b}=v,{stamp:w}=o.defaultStyleConfig,I=(null==b?void 0:b.stampIcon)||Ki.stampIcon,A=(null==w?void 0:w.stampIcon)||Ki.stampIcon,M=(null==b?void 0:b.imageData)||Ki.imageData,F=(null==w?void 0:w.imageData)||Ki.imageData;this.interactiveConfig=zt(Ke(Ke({},this.interactiveConfig),o),{controlsStyle:yo((null==o?void 0:o.controlsStyle)||{},h),defaultStyleConfig:yo((null==o?void 0:o.defaultStyleConfig)||{},v),eraserStyle:yo((null==o?void 0:o.eraserStyle)||{},y),selectionStyle:yo((null==o?void 0:o.selectionStyle)||{},_)}),null!=o&&o.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:V}=this.eventService;var B;V&&V.style.opacity!==(null==w?void 0:w.opacity)&&(this.eventService.stampPreview.style.opacity=null==w?void 0:w.opacity),I===A&&M===F||!this.eventService.stampPreview||(null===(B=this.eventService.stampPreview)||void 0===B||B.destroy(),this.eventService.stampPreview=null)}setAnnotationFlags(n,o){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this.getShape(n);if(!(v instanceof F5||v instanceof Kh)&&v){if(v!==this.eventService.activatedShape||!1!==o.enableControl&&!1!==o.isVisible||this.eventService.inactivateShape(!0),v.context.updateControlsFlags(Ke({},o)),v.context.isInGroup&&(!v.context.controlsFlags.isVisible||!v.context.controlsFlags.enableControl)){const{defaultGroup:y}=this.eventService;y.delete(v),this.eventService.activatedShape===y&&1===y.shapes.length&&this.eventService.activateShape(y.shapes[0],!1,!0)}h&&this.hooks.emitAnnotationRender()}}getShape(n){return"ddvDefaultGroup"===n?this.eventService.defaultGroup:this.shapeMap.get(n)||null}getSelectedShapeUids(){const{activatedShape:n}=this.eventService;if(!n)return[];const o=[];return n instanceof Sp?n.shapes.forEach(h=>{o.push(h.id)}):o.push(n.id),o}createShape(n,o){var h,v;let y;if(o.selectableStyle=Ke(Ke({},this.interactiveConfig.controlsStyle),o.selectableStyle),"annotationEllipse"===n){const{style:b}=o;b.x+=b.width/2||0,b.y+=b.height/2||0,b.rx=b.width/2||b.rx,b.ry=b.height/2||b.ry}const{defaultStyleConfig:_}=this.interactiveConfig;switch(n){case"annotationRect":y=new _2(o);break;case"annotationGroup":y=new Sp(null==o?void 0:o.id);break;case"annotationArc":y=new IZ(o);break;case"annotationCircle":y=new EZ(o);break;case"annotationEllipse":y=new jv(o);break;case"annotationLine":y=new uw(o);break;case"annotationInk":y=new Qd(o);break;case"annotationPolygon":y=new lw(o);break;case"annotationPolyline":y=new cw(o);break;case"annotationFreeText":y=new sr(o,"freeTextWriter",Ke(Ke({},Ki.textContent),null===(h=_.textTypewriter)||void 0===h?void 0:h.textContent));break;case"annotationTextBox":y=new sr(o,"textBox",Ke(Ke({},Ki.textContent),null===(v=_.textBox)||void 0===v?void 0:v.textContent));break;case"annotationImage":y=new V2e(o);break;case"annotationStamp":y=new iu(o);break;case"annotationHighlight":y=new Kh(o,Zd.HIGHLIGHT);break;case"annotationUnderline":y=new Kh(o,Zd.UNDERLINE);break;case"annotationStrikeout":y=new Kh(o,Zd.STRIKEOUT);break;default:y=new F5(o)}return y?(y.id||(y.id=Ai()),this.shapeMap.set(y.id,y),y):null}addShape(n,o){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=o&&o.id){const y=this.getShape(null==o?void 0:o.id);if(y)return y}const v=this.createShape(n,o);return this.containerId&&this.shapeArrMap.get(this.containerId).set(v.id,v),this.container&&(v.index=this.shapeArrMap.get(this.containerId).size,v.pageUid=this.containerId,this.container.appendChild(v),h&&this.hooks.emitAddAnnotation("data",[v])),this.bindFreeTextHooks(v),this.bindStampHooks(v),v}updateShape(n,o){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this.getShape(n);if(!v)return!1;const{isGrouped:y}=v.context;if(y&&this.eventService.defaultGroup.delete(v),null!=o&&o.style)if(v instanceof iu)v.updateStampStyle(Ke({},o.style));else{if(v instanceof jv){const{x:_,y:b,width:w,height:I}=o.style,{x:A,y:M}=v.getLocalPosition(),F=w?ni(w).value/2:0,V=I?ni(I).value/2:0,B=$t(_)?_+F:A,Q=$t(b)?b+V:M,J=F||v.style.rx,Z=V||v.style.ry;o.style=zt(Ke({},o.style),{x:B,y:Q,rx:J,ry:Z})}v.updateStyle(Ke({},o.style))}if(null!=o&&o.transform){const{angle:_,scale:b}=o.transform;gt(_)||v.setLocalAngle(_),gt(b)||v instanceof iu||v.setLocalScale(b)}return h&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[v]),y&&this.eventService.defaultGroup.add(v),!0}updateAllShapeControlsStyle(n){let o=!1;this.shapeMap.forEach(h=>{h.context.controlsStyle=n,h.context.parseControlsStyle(),h.controls&&(h.controls.isVisible&&(o=!0),h.context.destroyControls(),h.context.initControls(),h.context.renderControls())}),o&&this.hooks.emitAnnotationRender()}updateFreeTextDefaultConfig(){const{defaultStyleConfig:n}=this.interactiveConfig;this.shapeMap.forEach(o=>{if(o instanceof sr){const h=Ki.textContent,v="freeTextWriter"===o.textType?"textTypewriter":"textBox",{textContent:y}=n[v]||{};o.updateFreeTextContentStyle(zt(Ke(Ke({},h),y),{content:h.content}))}})}updateLayer(n,o){const h=this.getShape(n);return!!h&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===h?this.eventService.activatedZIndex=o:h.updateStyle({zIndex:o}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&h.updateStyle({zIndex:o}),!0)}deleteShape(n){var o;let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const y=[],{eventService:_}=this,b=n.includes(null==_||null===(o=_.activatedShape)||void 0===o?void 0:o.id);if(n.forEach(M=>{const F=this.getShape(M);F&&(F instanceof Sp?(y.push(...F.shapes),F.clear()):y.push(F))}),!y.length)return!1;h&&this.hooks.emitDeleteAnnotation(y),y.forEach(M=>{M.context.isInGroup&&this.eventService.defaultGroup.delete(M),this.shapeMap.delete(M.id),this.shapeArrMap.get(M.pageUid)&&this.shapeArrMap.get(M.pageUid).delete(M.id),M.destroy()});const{activatedShape:w,defaultGroup:I}=_;return(b||w===I&&!I.state)&&this.eventService.inactivateShape(!0,v),!0}selectShape(n){const o=[];return n.forEach(h=>{o.push(this.getShape(h))}),this.eventService.selectShapes(o)}moveShape(n,o,h){n.forEach(v=>{const y=this.getShape(v);if(!y)return;const b=this.shapeArrMap.get(y.pageUid);b&&b.delete(v),this.shapeArrMap.get(o)||this.shapeArrMap.set(o,new Map),this.shapeArrMap.get(o).set(v,y),y.context.isGrouped&&y.parentNode.delete(y,!0),h.appendChild(y)})}setShapeLayout(n,o){var h;if(!n.parentNode)return;const v=n.parentNode;let y,_;if(v instanceof Wv)y=v.width,_=v.height;else{const{width:pe,height:Ce}=xZ(v);y=pe,_=Ce}const{x:b,y:w}=v.getLocalScale();v.scale(b<0?-1:1,w<0?-1:1);const I=v.getAngle(),{width:A,height:M}=xZ(n),{x:F,y:V}=v.getPosition(),{x:B,y:Q}=n.getPosition(),{shapeType:J}=n;let Z,re;if(v.setAngle(0),null!=v&&null!==(h=v.context)&&void 0!==h&&h.referencePoint){const{x:pe,y:Ce}=v.context.referencePoint.getPosition();Z=pe,re=Ce}else Z=F,re=V;switch(o){case"left":re=Q;break;case"top":Z=B;break;case"right":Z+=y-A,re=Q;break;case"bottom":Z=B,re+=_-M;break;case"center":Z+=y/2-A/2,re+=_/2-M/2;break;case"horizontal-center":Z+=y/2-A/2,re=Q;break;case"vertical-center":Z=B,re+=_/2-M/2}const se=n.getAngle();if(n.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(J)&&(["left","right","horizontal-center"].includes(o)?Z+=A/2:(["top","bottom","vertical-center"].includes(o)||(Z+=A/2),re+=M/2)),"annotationText"===J&&["top","bottom","vertical-center","center"].includes(o)){var ce;const{lineHeight:pe}=n.parsedStyle,Ce=null===(ce=n.chars[0])||void 0===ce?void 0:ce.height,Ve=Math.max(pe,Ce);re+=n.getTextBaseLineOffset(Ve)/2}n.setPosition({x:Z,y:re}),n.setAngle(se),v.setAngle(I),v.scale(b<0?-1:1,w<0?-1:1),this.hooks.emitAnnotationRender()}clickHandler(n){this.eventService.clickHandler(n)}dblClickHandler(n){this.eventService.dblClickHandler(n)}keyDownHandler(n){this.eventService.keyDownHandler(n)}startHandler(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this.isHitShape(n);if("none"===this.annotationMode&&o&&(h.isHit?this.eventService.activateShape(h.shape,n.ctrlKey,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||h.isHit||this.annotationMode===this.eventService.eventMode||this.eventService.setEventMode(this.annotationMode,this.brush),"draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&h.isHit&&(this.eventService.setEventMode("none"),this.eventService.activateShape(h.shape,n.ctrlKey,!0)),"select"===this.annotationMode){const{isHitSelected:v,isHit:y}=h;v?this.eventService.setEventMode("none"):!v&&y&&n.ctrlKey?(this.eventService.setEventMode("none"),this.eventService.activateShape(h.shape,n.ctrlKey,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear())}this.eventService.editStartHandler(n),this.eventService.drawStartHandler(n)}moveHandler(n,o){this.eventService.editMoveHandler(n),this.eventService.drawMoveHandler(n,o),this.eventService.eraseMoveHandler(n)}endHandler(n){this.eventService.editEndHandler(n),this.eventService.drawEndHandler(n)}cursorHandler(n,o,h){if(!(this.container&&n.target instanceof HTMLCanvasElement))return;if(o||!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(n.target.style.cursor=h);if("erase"===this.eventService.eventMode)return void(n.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const v=this.isHitShape(n);if(this.eventService.isStartEdit){if(!v.isHitSelected||9!==v.hitControlPointIndex)return;n.target.style.cursor="move"}"draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType)?n.target.style.cursor="crosshair":v.isHit?v.isHitSelected?(n.target.style.cursor=9===v.hitControlPointIndex?"move":"grab",9===v.hitControlPointIndex&&v.shape instanceof sr&&v.shape.isEditMode&&(n.target.style.cursor="text")):n.target.style.cursor="pointer":n.target.style.cursor="draw"===this.annotationMode?"crosshair":h}}class W_ extends ja{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&n.context.renderControls())}}class gDe extends W_{constructor(){super(),this.close=!1}}class mDe extends W_{render(n,o){super.render(n,o)}}class vDe extends W_{}class yDe extends vZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&(n.pointEventsHandler.updateLineControls(),n.context.renderControls()))}}class _De extends W_{}class CDe extends fZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&n.context.renderControls())}}class bDe extends pZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&n.context.renderControls())}}class xDe extends W_{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&(n.pointEventsHandler.updateLineControls(),n.context.renderControls()))}}class wDe extends gZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&(n.pointEventsHandler.updateLineControls(),n.context.renderControls()))}}class SDe extends W_{}class TDe extends ja{render(n,o){if("hidden"!==n.parsedStyle.visibility){if("stamp"===n.renderType)super.render(n,o);else{const{width:h,height:v,img:y,opacity:_}=n.parsedStyle;if(Sn(y))return;o.save(),o.globalAlpha=_,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality&&(o.imageSmoothingQuality="high"),o.drawImage(y,0,0,h.value,v.value),o.restore()}n.controls&&n.context.renderControls()}}}class IDe extends mZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&n.context.renderControls())}}class EDe extends yZ{render(n,o){"hidden"!==n.parsedStyle.visibility&&(super.render(n,o),n.controls&&n.context.renderControls())}}class DDe extends ja{render(n,o){"hidden"!==n.parsedStyle.visibility&&kZ(n,o)}}function kZ(p,n){const{container:o}=p,h=p.parentNode;if(!h)return;const v=h.getLocalTransform(),{a:y,b:_,c:b,d:w,e:I,f:A}=v;let M=null,F=o.parentNode;for(;!M&&F;)"pageCropBox"===F.name&&(M=F),F=F.parentNode;if(M){const{x:V,y:B,width:Q,height:J}=function(Z){let{x:re,y:se}=Z.getPosition(),{width:ce,height:pe}=Z;const Ve=(Z.parentNode.parentNode.rotation%360+360)%360/90,te=devicePixelRatio;if(1===Ve?re-=pe:2===Ve?(re-=ce,se-=pe):3===Ve&&(se-=ce),1===Ve||3===Ve){const Me=ce;ce=pe,pe=Me}return{x:re*te,y:se*te,width:ce*te,height:pe*te}}(M);n.save(),n.setTransform(y,_,b,w,I,A),n.beginPath(),n.moveTo(V,B),n.lineTo(V+Q,B),n.lineTo(V+Q,B+J),n.lineTo(V,B+J),n.closePath(),n.restore(),n.clip()}}class ADe extends ja{render(n,o){"hidden"!==n.parsedStyle.visibility&&(kZ(n,o),super.render(n,o))}}class MZ{init(n){[{name:"annotationArc",renderer:new gDe},{name:"annotationCircle",renderer:new mDe},{name:"annotationEllipse",renderer:new vDe},{name:"annotationLine",renderer:new yDe},{name:"annotationImage",renderer:new CDe},{name:"annotationInk",renderer:new bDe},{name:"annotationPolygon",renderer:new xDe},{name:"annotationPolyline",renderer:new wDe},{name:"annotationRect",renderer:new SDe},{name:"annotationText",renderer:new IDe},{name:"annotationFreeText",renderer:new EDe},{name:"annotationGroup",renderer:new _De},{name:"annotationStamp",renderer:new TDe},{name:"annotationControls",renderer:new DDe},{name:"annotationLineControls",renderer:new ADe}].forEach(o=>{let{name:h,renderer:v}=o;n.contextService.registerShapeRenderer(h,v)})}destroy(){}}function U_(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jn.displayResolution;const o={left:0,top:0,width:p.imageWidth/p.imageXResolution*n,height:p.imageHeight/p.imageYResolution*n};return{fileIndex:0,mediaBox:o,cropBox:Ke({},o),resource:{data:p.imageData,width:p.imageWidth,height:p.imageHeight,resolutionX:p.imageXResolution,resolutionY:p.imageYResolution,bitDepth:p.imageBitDepth}}}class b2 extends R_{constructor(){super(),W(this,"type","imageParser"),W(this,"once",!1),W(this,"imgReader",void 0),W(this,"isDestroy",!1),W(this,"source",void 0),W(this,"parserOptions",void 0),this.imgReader=new Lv}initParser(n,o){this.source={fileSource:n},o&&(this.parserOptions=o)}getPageCount(){return Fe(function*(){return 1})()}destroy(){var n;null===(n=this.imgReader)||void 0===n||n.destroy(),this.imgReader=null,this.isDestroy=!0}parse(){var n=this;return Fe(function*(){return n.isDestroy?null:[U_(yield n.imgReader.readImageInfo(n.source))]})()}getPage(){var n=this;return Fe(function*(){var o;if(n.isDestroy)return null;const h={"image/jpeg":Va.IT_JPG,"image/png":Va.IT_PNG,"image/bmp":Va.IT_BMP},{outputType:v,jpegQuality:y,returnBase64:_}=null!==(o=n.parserOptions)&&void 0!==o?o:{},b=yield n.imgReader.readImage({source:n.source,outputType:null!=v?v:h[n.source.fileSource.type],jpegQuality:y,returnBase64:_});return b?U_(b):null})()}cancelGetPage(n){var o;if(this.isDestroy)return;const{outputType:h}=null!==(o=this.parserOptions)&&void 0!==o?o:{};this.imgReader.cancelReadImage(this.source,h)}}class PDe{constructor(){W(this,"type","tiffParser"),W(this,"once",!1),W(this,"imgReader",void 0),W(this,"parserOptions",void 0),W(this,"source",void 0),W(this,"isDestroy",!1),this.imgReader=new Lv}initParser(n,o){this.source={fileSource:n},o&&(this.parserOptions=o)}getPageCount(){var n=this;return Fe(function*(){return n.imgReader.getTiffPageCount(n.source)})()}destroy(){var n;null===(n=this.imgReader)||void 0===n||n.destroy(),this.imgReader=void 0,this.isDestroy=!0}parse(n){var o=this;return Fe(function*(){return o.isDestroy||!o.source?null:(yield o.imgReader.readTiffPageInfo(o.source,n)).map(h=>{const v=U_(h);return v.fileIndex=h.pageIndex,v})})()}getPage(n){var o=this;return Fe(function*(){var h;if(o.isDestroy||!o.source)return null;const{outputType:v,returnBase64:y}=null!==(h=o.parserOptions)&&void 0!==h?h:{},_=yield o.imgReader.readTiffPage({source:o.source,index:n,outputType:v,returnBase64:y});if(_){const b=U_(_);return b.fileIndex=_.pageIndex,b}return null})()}cancelGetPage(n){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,n)}}function V_(p,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=Kd(p),v=n||1;if(Di(h)&&h[0]&&h[0]instanceof M_){const A=h[0].value.steps,{length:M}=h[0].value.steps,F=[0,0,0];A.forEach(B=>{const Q=Kd(B.color);F[0]+=Q.r,F[1]+=Q.g,F[2]+=Q.b});const V=[F[0]/M,F[1]/M,F[2]/M];return o&&(V[3]=255),V}const{r:y,g:_,b,alpha:w}=h,I=[y,_,b];return o&&(I[3]=Math.floor(w*v*255+.5)),I}function j_(p,n){return{strokeColor:p?V_(p,1,!1):null,fillColor:n?V_(n,1,!1):null}}function Hv(p,n,o){let h,v;return h=p?V_(p,o,!0):null,v=n?V_(n,o,!0):null,{apStrokeColor:h,apFillColor:v}}function Gv(p,n,o){const h=p.value?p.value/o:0,v=zv(n||[],o);return v.length?{width:h,style:"D",dash:v}:{width:h}}function OZ(p){const n=p.getLocalTransform().clone(),{a:o,b:h,c:v,d:y}=n;return[x2(o),-x2(h),-x2(v),x2(y),0,0]}function FZ(p,n){const{min:o,max:h}=Math;let v=p[0][0],y=p[0][1],_=p[0][0],b=p[0][1];for(let w=1;w<p.length;w++){const I=p[w];v=o(v,I[0]),_=h(_,I[0]),b=o(b,I[1]),y=h(y,I[1])}return v===_&&(v-=1,_+=1),b===y&&(b-=1,y+=1),[v-n/2,b-n/2,_+n/2,y+n/2]}function im(p,n,o,h,v,y){const _=[],b=wp(n),w=o/2,I=[{x:b.left-w*h,y:b.bottom+w*v},{x:b.right+w*h,y:b.bottom+w*v},{x:b.right+w*h,y:b.top-w*v},{x:b.left-w*h,y:b.top-w*v}],A=p.getLocalTransform();return I.forEach(M=>{const F=A.transformPoint({x:M.x,y:M.y});_.push([F.x/h,y-F.y/v])}),FZ(_,0)}function LZ(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=[],{length:h}=p;if(h>50&&n){const v=Math.floor(h/2),y=Math.floor(h/4);o.push(p[0][0],p[0][1]),o.push(p[y][0],p[y][1]),o.push(p[v][0],p[v][1]),o.push(p[h-y][0],p[h-y][1]),o.push(p[h-1][0],p[h-1][1]),o.push(p[0][0],p[0][1])}else p.forEach(v=>{o.push(v[0],v[1])});return o}function RDe(p){const n=[];for(let o=0;o<p.length;o++){const h=[];p[o].forEach(v=>{h.push(v[0],v[1])}),n.push(h)}return n}function zv(p,n){return p?2===p.length&&0===p[0]&&0===p[1]?[]:p.map(o=>o/n):[]}function kDe(p){return Math.max(["butt","round","square"].indexOf(p),0)}function MDe(p){return Math.max(["miter","round","bevel"].indexOf(p),0)}function NZ(p){const n=[],o=p.getLocalTransform();return p.renderPath.forEach(h=>{const v=o.transformPoint({x:h.x,y:h.y});n.push({x:v.x,y:v.y})}),n}function ODe(p,n){const o=Kd(p);let h=0,v=0,y=99999,_=99999;if(Di(o)&&o[0]&&o[0]instanceof M_){const b=(M=>{const F=M.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!F)return null;const V=F[0],B=F.slice(1);return{direction:V.replace(/\s+/g," ").trim(),colors:B.map(Q=>Q.trim())}})(p);n.forEach(M=>{h=Math.max(h,M[0]),y=Math.min(y,M[0]),v=Math.max(v,M[1]),_=Math.min(_,M[1])});const w=[y,v,h,_];b.direction.includes("left")&&(w[0]=h,w[2]=y),b.direction.includes("top")&&(w[1]=_,w[3]=v);const I=Kd(b.colors[0]),A=Kd(b.colors[1]);return{coords:w,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[I.r/255,I.g/255,I.b/255],c1:[A.r/255,A.g/255,A.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function rm(p){return p.map(n=>n.toLowerCase())}function BZ(p,n,o,h,v){const{width:y,height:_}=p.parsedStyle;let b=y.value,w=_.value;if(p instanceof sr){const{width:J,height:Z}=p.getBoundingRect();b=J,w=Z}const{x:I,y:A}=p.getLocalPosition(),M=n/2,F=I/o,V=v-A/h,B=b/o,Q=w/h;return[[F+M,V-Q+M,2,!1],[F+B-M,V-Q+M,0,!1],[F+B-M,V-M,0,!1],[F+M,V-M,0,!1],[F+M,V-Q+M,0,!0]]}function WZ(p,n,o,h){p.renderPath||p.getPath();const{renderPath:v}=p,y=[],{x:_,y:b}=p.getLocalPosition();let w=[];for(let I=0;I<v.length;I++){const{step:A,close:M}=v[I],F=(v[I].x+_)/n,V=h-(v[I].y+b)/o;0!==I?0!==A||0===I?w.push([F,V,0,M]):(y.push(w),w=[],w.push([F,V,2,M])):w.push([F,V,2,M])}return y.push(w),y}function UZ(p,n,o,h){const v=p.childNodes,y=[];for(let _=0;_<v.length;_++){if(!(v[_]instanceof v2))continue;const b=[],{renderPath:w}=v[_],{x:I,y:A}=v[_].getLocalPosition();w.forEach((M,F)=>{const V=[(M.x+I)/n,h-(M.y+A)/o,M.step,!1];F===w.length-1&&(V[3]=!0),b.push(V)}),y.push(b)}return y}function Yv(p,n,o,h,v,y,_){let b=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:w}=p.parsedStyle,I=OZ(p),A=FZ(y,v),M=[];return b&&M.push(H_(p,y,n,o,v,zv(w,_))),{bbox:A,matrix:I,transform:A,objs:M}}function H_(p,n,o,h,v,y){const{miterLimit:_,lineCap:b,lineJoin:w}=p.parsedStyle;return{dashArray:y,dashPhase:0,fillColor:o||[0,0,0,0],fillType:o?2:0,isStroke:v>0,lineCap:kDe(b),lineJoin:MDe(w),lineWidth:v,miterLimit:_,objMatrix:[1,0,0,1,0,0],segments:n,strokeColor:h||[0,0,0,0],type:"path"}}function FDe(p,n,o,h){const{fontSize:v,fontFamily:y,fontWeight:_,fontStyle:b,opacity:w,text:I}=p.parsedStyle,{color:A,borderColor:M}=p.style,{x:F,y:V}=p.getLocalPosition(),{fillColor:B,strokeColor:Q}=j_(M,A),J=VZ(_),Z="italic"===b;return{type:"text",charSpace:0,wordSpace:0,fillColor:B?[...B,255*w]:[0,0,0,255],strokeColor:Q?[...Q,255*w]:[0,0,0,255],fontName:y,renderMode:0,fontIsBold:J,fontIsItalic:Z,fontSize:v.value/n,fontPitchFamily:16,text:I,position:[F/n,V/o],objMatrix:[1,0,0,1,F/n,h-V/o]}}function x2(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const o=p.toFixed(n);return Number.parseFloat(o)}function VZ(p){return"bold"===p||$t(p)&&p>=600}function w2(p,n,o){return p.replace(new RegExp(n,"g"),o)}function S2(p,n,o,h,v){const{segments:y,lineWidth:_,strokeColor:b,fillType:w,fillColor:I,dashArray:A,lineCap:M,lineJoin:F,miterLimit:V,isStroke:B,pattern:Q}=p,J={type:"path",stampPoints:LDe(y,o,h,v),borderWidth:B?(_||1)*o:0,borderColor:vs(b,n),background:w>0?vs(I,n):null,lineDash:Zh(A,o),lineCap:Xv(M),lineJoin:$v(F),miterLimit:V};return Q&&(J.background=function(Z,re,se,ce){var pe,Ce,Ve,te;const{coords:Me,type:we}=Z;if("shading"!==we)return null;const Le_y=ce-Me[1]*se,j_y=ce-Me[3]*se;if(!Z||null==Z||!Z.function||null==Z||null===(pe=Z.function[0])||void 0===pe||!pe.functions)return null;let q=null==Z||null===(Ce=Z.function[0])||void 0===Ce||null===(Ce=Ce.functions[0])||void 0===Ce?void 0:Ce.c0,k=null==Z||null===(Ve=Z.function[0])||void 0===Ve||null===(Ve=Ve.functions[0])||void 0===Ve?void 0:Ve.c1;if(!q||!k)return null;const N=(null==Z||null===(te=Z.function[0])||void 0===te?void 0:te.encode)||[1,0];if(N[0]>N[N.length-1]){const ee=k;k=q,q=ee}const ie=`rgb(${255*k[0]},${255*k[1]},${255*k[2]})`;return`linear-gradient(to ${Me[0]*re<Me[2]*re?"right":"left"} ${Le_y===j_y?"":Le_y<j_y?"bottom":"top"}, ${u2(`rgb(${255*q[0]},${255*q[1]},${255*q[2]})`)}, ${u2(ie)})`}(Q,o,h,v)||J.background),J}function L5(p,n,o,h,v){const{text:y,renderMode:_,fontIsBold:b,fontIsItalic:w,fillColor:I,fontSize:A,fontName:M,strokeColor:F,objMatrix:V}=p,B=new so(V),{scale:Q}=B.decompose(),J=function(Z,re,se,ce,pe,Ce){const Ve=Qh(Z,re,[1,0,0,1,0,0]);return[Ve[0]*se,(pe-Ve[1])*ce]}(V[4],V[5],o,h,v);return{type:"text",text:y,color:vs(I,n),borderWidth:_?o:"0px",borderColor:vs(F,n),fontWeight:b?"bold":"normal",fontStyle:w?"italic":"normal",fontSize:A*o*Math.abs(Q.x),fontFamily:M,textBaseLine:"alphabetic",x:J[0],y:J[1]+Math.floor(A*o*Math.abs(Q.x))}}function jZ(p,n,o){const h=function(b,w){const I=b.replace(/[^A-Za-z0-9\+\/]/g,""),A=I.length,M=3*A+1>>>2,F=new Uint8Array(M);for(let V,B,Q=0,J=0,Z=0;Z<A;Z++)if(B=3&Z,Q|=NDe(I.charCodeAt(Z))<<18-6*B,3===B||A-Z==1){for(V=0;V<3&&J<M;V++,J++)F[J]=Q>>>(16>>>V&24)&255;Q=0}return F}(p),v=new ImageData(new Uint8ClampedArray(h),n,o);let y=document.createElement("canvas");y.width=n,y.height=o,y.getContext("2d").putImageData(v,0,0);const _=y.toDataURL();return y=null,_}function Qh(p,n,o){return[o[0]*p+o[2]*n+o[4],o[1]*p+o[3]*n+o[5]]}function ru(p,n,o,h,v,y){let _=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const b=new so(o),w=b.decompose(),I={x:(n[2]+n[0])/2,y:(n[1]+n[3])/2},A=(n[2]-n[0])/2,M=(n[1]-n[3])/2,F=b.transformPoint(I),V={x:(F.x-A)*h,y:(y-F.y+M)*v},B=-w.rotation.z,Q={x:w.scale.x,y:w.scale.y};let J=V;var Z;return _&&(J=null!==(Z=function(re,se,ce,pe,Ce,Ve){const te=[];let Me=!0;if(re.forEach(we=>{let Le;"path"===we.type?(Le=S2(we,1,pe,Ce,Ve),Me=!1):"text"===we.type&&(Le=L5(we,1,pe,Ce,Ve),Me=!1),Le&&te.push(Le)}),Me)return null;if(te.length){const we=function(Le,j,L,Y,q){const k_x=j[0]*L,k_y=(q-j[3])*Y,N=[],$=[];return Le.forEach(ne=>{if("path"!==ne.type)return;const{borderWidth:le,stampPoints:fe,lineCap:xe}=ne;if(2===fe.length){const Pe=iw(fe[0],fe[1],ni(le).value,xe);N.push(Pe.x,Pe.x+Pe.width),$.push(Pe.y,Pe.y+Pe.height)}else{const Pe=wp(fe),De=ni(le).value/2,je=Pe.left-De,ke=Pe.top-De,he=Pe.height+2*De;N.push(je,je+(Pe.width+2*De)),$.push(ke,ke+he)}}),0===N.length?{offsetX:0,offsetY:0}:{offsetX:Math.min(...N)-k_x,offsetY:Math.min(...$)-k_y}}(te,se,pe,Ce,Ve);ce.x+=we.offsetX,ce.y+=we.offsetY}return ce}(p,n,Ke({},V),h,v,y))&&void 0!==Z?Z:J),{position:J,angle:B,scale:Q}}function N5(p,n,o,h){const v=[];return p.forEach(y=>{v.push({x:y[0]*n,y:(h-y[1])*o})}),v}function LDe(p,n,o,h){const v=[];return p.forEach(y=>{v.push({x:y[0]*n,y:(h-y[1])*o,step:y[2]})}),v}function Xv(p){return["butt","round","square"][null!=p?p:0]}function $v(p){return["miter","round","bevel"][null!=p?p:0]}function vs(p,n){return p.length<3?null:4===p.length?`rgba(${p.slice(0,3).join()},${p[3]/255/(n||1)})`:`rgb(${p.join()})`}function Zh(p,n){return p&&0!==p.length?p.map(o=>o*n):[0,0]}function Qu(p){let n=[];for(let o=0;o<p.length;o++)p[o]instanceof Array?n=n.concat(Qu(p[o])):n.push(pn(p[o]));return n}function NDe(p){return p>64&&p<91?p-65:p>96&&p<123?p-71:p>47&&p<58?p+4:43===p?62:47===p?63:0}function dw(p,n){if(!p)return"";let o="";return p.split(";").forEach(h=>{const v=h.split(":");v[0].trim()===n&&(o=v[1].trim())}),o}function HZ(p){if(!p)return{contents:[],textStyle:{}};const n=new DOMParser,o='xmlns="http://www.w3.org/1999/xhtml"';let h=p;p.includes('xmlns="')||(h=p.replace(/<body/,`<body ${o}`)),h=w2(h,'xmlns=""',o);const v=n.parseFromString(h,"text/xml"),y=v.getElementsByTagName("body")[0],_=v.getElementsByTagName("span"),b=v.getElementsByTagName("p"),w=re=>{for(const se in re)null!=re[se]&&""!==re[se]||delete re[se];return re},{color:I,fontFamily:A,fontSize:M,fontWeight:F,fontStyle:V,textDecoration:B}=y.style,Q=w({color:I,fontFamily:A,fontSize:M,fontWeight:F,fontStyle:V,lineThrough:B.includes("line-through"),underline:B.includes("word")||B.includes("underline")}),J=[];return(re=>{for(let se=0;se<re.length;se++){const ce=re[se],{color:pe,fontFamily:Ce,fontSize:Ve,fontStyle:te,fontWeight:Me}=ce.style||{},we=dw(ce.getAttribute("style"),"text-decoration"),Le=w({content:ce.textContent,color:pe,fontFamily:Ce,fontSize:Ve,fontWeight:Me,fontStyle:te,lineThrough:we.includes("line-through")||void 0,underline:we.includes("word")||we.includes("underline")||void 0});J.push(Le)}})(_.length?_:b),{textStyle:Q,contents:J}}class BDe{constructor(){W(this,"pageWidth",void 0),W(this,"pageHeight",void 0),W(this,"ratioX",0),W(this,"ratioY",0)}setParserConfig(n,o,h,v){this.pageWidth=n,this.pageHeight=o,this.ratioX=h,this.ratioY=v}parseAnnotation(n){let o=null;switch(n.type){case"FreeText":o=n.intent&&"FreeText"!==n.intent?"freetexttypewriter"===n.intent.toLocaleLowerCase()?this.parseFreeText(n):this.parseIncomplete(n):this.parseTextBox(n);break;case"Circle":o=this.parseCircle(n);break;case"Square":o=this.parseRect(n);break;case"Line":o=n.intent&&"linedimension"===n.intent.toLocaleLowerCase()?this.parseIncomplete(n):this.parseLine(n);break;case"Polygon":o=!n.intent||"polygondimension"!==n.intent.toLocaleLowerCase()&&"polygoncloud"!==n.intent.toLocaleLowerCase()?this.parsePolygon(n):this.parseIncomplete(n);break;case"PolyLine":o=n.intent&&"polylinedimension"===n.intent.toLocaleLowerCase()?this.parseIncomplete(n):this.parsePolyline(n);break;case"Ink":o=this.parseInk(n);break;case"Stamp":o=this.parseStamp(n);break;case"Highlight":o=this.parseTextAssist(n,"highlight");break;case"StrikeOut":o=this.parseTextAssist(n,"strikeout");break;case"Underline":o=this.parseTextAssist(n,"underline");break;default:o=n.normalAppearance?this.parseIncomplete(n):this.parseUnknown(n)}if(o||(o=n.normalAppearance?this.parseIncomplete(n):this.parseUnknown(n)),o){var h;const{opacity:v}=n,y=o.style;if(o.raw=n,y.opacity=$t(y.opacity)?y.opacity:null!=v?v:1,null!=n&&n.normalAppearance){const{blendMode:_}=n.normalAppearance;o.style.renderBlendMode=_.toLowerCase()}null!==(h=o)&&void 0!==h&&h.transform&&o.transform.angle<0&&(o.transform.angle+=360),o.uid=Ai()}return o}parseFreeText(n){const{normalAppearance:o,richText:h,rect:v,defaultAppearanceData:y,defaultStyle:_}=n,{objs:b,transform:w,bbox:I}=o,{ratioX:A,ratioY:M,pageHeight:F}=this,{position:V,angle:B,scale:Q}=ru(0===b.length?null:Qu(b),I,w,A,M,F,!1),{x:J,y:Z}=V;let re;(Math.round(B)+360)/90%2==0?(re=(v[2]-v[0])*this.ratioX+12,re+J>this.pageWidth*this.ratioX&&(re=this.pageWidth*this.ratioX-J)):(re=(v[3]-v[1])*this.ratioY,re+J>this.pageHeight*this.ratioY&&(re=this.pageHeight*this.ratioY-J));const{fontName:se,fontSize:ce,fontColor:pe}=y,Ce={content:"",fontFamily:se,color:dw(_,"color")||`rgb(${pe[0]},${pe[1]},${pe[2]})`,fontSize:ce},Ve=HZ(h),te=[];return Ve.contents.forEach(Me=>{const we=Ke(Ke(Ke({},Ce),Ve.textStyle),Me),Le=ni(we.fontSize);we.fontFamily=we.fontFamily.replace(/^"|"$/g,""),($t(we.fontSize)||"pt"===Le.unit)&&(we.fontSize=Le.value*this.ratioX),te.push(we)}),{type:"textTypewriter",style:{x:J,y:Z,width:re,textContents:te},transform:{scale:Q,angle:B},iconColor:Ce.color}}parseTextBox(n){const{normalAppearance:o,richText:h,defaultAppearanceData:v,defaultStyle:y,opacity:_}=n;if(!o)return null;const{objs:b,transform:w,bbox:I}=o;if(!b||0===b.length)return null;const{fillType:A,fillColor:M,dashArray:F,isStroke:V,lineWidth:B,strokeColor:Q,segments:J}=b[0],{ratioX:Z,ratioY:re,pageHeight:se}=this,{position:ce,angle:pe,scale:Ce}=ru(Qu(b),I,w,Z,re,se,"path"===b[0].type),Ve="path"===b[0].type?(J[1][0]-J[0][0]+B)*this.ratioX:(I[2]-I[0])*this.ratioX,te="path"===b[0].type?(J[2][1]-J[0][1]+B)*this.ratioY:(I[3]-I[1])*this.ratioY,{x:Me,y:we}=ce,{fontName:Le,fontSize:j,fontColor:L}=v,Y={content:"",fontFamily:Le,color:dw(y,"color")||`rgb(${L[0]},${L[1]},${L[2]})`,fontSize:j},q=HZ(h);let k=dw(h,"text-align")||dw(y,"text-align");"justify-center"===k&&(k="justify");const N=[];if(q.contents.forEach($=>{const ie=Ke(Ke(Ke({},Y),q.textStyle),$),ee=ni(ie.fontSize);ie.fontFamily=ie.fontFamily.replace(/^"|"$/g,""),($t(ie.fontSize)||"pt"===ee.unit)&&(ie.fontSize=ee.value*this.ratioX),N.push(ie)}),0===N.length&&n.contents){const $=zt(Ke({},Y),{content:n.contents});$t($.fontSize)&&($.fontSize*=this.ratioX),N.push($)}return{type:"textBox",style:{x:Me,y:we,width:Ve,height:te,borderWidth:V?(B||1)*this.ratioX:0,borderColor:vs(Q,_),background:A>0?vs(M,_):"",lineDash:Zh(F,this.ratioX),textContents:N,textAlign:k},transform:{scale:Ce,angle:pe},iconColor:Y.color}}parseCircle(n){const{normalAppearance:o,opacity:h,color:y,interiorColor:_,borderStyle:b}=n,{objs:w,transform:I,bbox:A}=o,{ratioX:M,ratioY:F,pageHeight:V}=this;let B;if(0===w.length){var Q;const{position:J,angle:Z,scale:re}=ru(null,A,I,M,F,V,!1),{x:se,y:ce}=J,pe=(A[2]-A[0])*this.ratioX,Ce=(A[3]-A[1])*this.ratioY,Ve=vs(y||[0,0,0],h),te=_?vs(_,h):"";B={type:"ellipse",style:{x:se,y:ce,width:pe,height:Ce,borderWidth:(null!==(Q=null==b?void 0:b.width)&&void 0!==Q?Q:1)*this.ratioX,borderColor:Ve,background:_?te:"",lineDash:Zh(null==b?void 0:b.dash,this.ratioX)},transform:{angle:Z,scale:re},iconColor:_?te:Ve}}else{if("path"!==w[0].type)return null;{const{fillColor:J,strokeColor:Z,lineWidth:re,dashArray:se,fillType:ce,isStroke:pe}=w[0],{position:Ce,angle:Ve,scale:te}=ru(Qu(w),A,I,M,F,V),{x:Me,y:we}=Ce,Le=(A[2]-A[0])*this.ratioX,j=(A[3]-A[1])*this.ratioY,L=vs(Z,h),Y=vs(J,h);B={type:"ellipse",style:{x:Me,y:we,width:Le,height:j,borderWidth:pe?(re||1)*this.ratioX:0,borderColor:L,background:ce>0?Y:"",lineDash:Zh(se,this.ratioX)},transform:{angle:Ve,scale:te},iconColor:ce>0?Y:L}}}return B}parseRect(n){const{normalAppearance:o,opacity:h,color:y,interiorColor:_,borderStyle:b}=n,{objs:w,transform:I,bbox:A}=o,{ratioX:M,ratioY:F,pageHeight:V}=this;let B;if(0===w.length){var Q;const{position:J,angle:Z,scale:re}=ru(null,A,I,M,F,V,!1),{x:se,y:ce}=J,pe=(A[2]-A[0])*this.ratioX,Ce=(A[3]-A[1])*this.ratioY,Ve=vs(y||[0,0,0],h),te=_?vs(_,h):"";B={type:"rectangle",style:{x:se,y:ce,width:pe,height:Ce,borderWidth:(null!==(Q=null==b?void 0:b.width)&&void 0!==Q?Q:1)*this.ratioX,borderColor:Ve,background:te,lineDash:Zh(null==b?void 0:b.dash,this.ratioX),lineCap:Xv(0),lineJoin:$v(0)},transform:{scale:re,angle:Z},iconColor:_?te:Ve}}else{const{fillColor:J,strokeColor:Z,lineWidth:re,dashArray:se,isStroke:ce,fillType:pe,segments:Ce,lineCap:Ve,lineJoin:te}=w[0],{position:Me,angle:we,scale:Le}=ru(Qu(w),A,I,M,F,V),{x:j,y:L}=Me,Y=(Ce[1][0]-Ce[0][0]+re)*this.ratioX,q=(Ce[2][1]-Ce[0][1]+re)*this.ratioY,k=vs(Z,h),N=vs(J,h);B={type:"rectangle",style:{x:j,y:L,width:Y,height:q,borderWidth:ce?(re||1)*this.ratioX:0,borderColor:k,background:pe>0?N:"",lineDash:Zh(se,this.ratioX),lineCap:Xv(Ve),lineJoin:$v(te)},transform:{scale:Le,angle:we},iconColor:pe>0?N:k}}return B}parseLine(n){const{normalAppearance:o,lineEnding:h,interiorColor:v,opacity:y}=n;if(!o)return null;const{objs:_,bbox:b}=o;let{transform:w}=o;if(0===_.length)return null;const{strokeColor:I,lineWidth:A,dashArray:M,lineCap:F,lineJoin:V,miterLimit:B,isStroke:Q,segments:J}=_[0],{ratioX:Z,ratioY:re,pageHeight:se}=this;if(1!==Math.abs(w[0])||1!==Math.abs(w[3])){const te=Qh(b[0],b[1],w),Me=Qh(b[2],b[3],w);_.forEach(we=>{we.segments.forEach(Le=>{const j=Qh(Le[0],Le[1],w);Le[0]=j[0],Le[1]=j[1]})}),b[0]=te[0],b[1]=te[1],b[2]=Me[0],b[3]=Me[1],w=[1,0,0,1,0,0]}const{position:ce,angle:pe,scale:Ce}=ru(Qu(_),b,w,Z,re,se),Ve=vs(I,y);return{type:"line",style:{startPoint:{x:J[0][0]*this.ratioX,y:(this.pageHeight-J[0][1])*this.ratioY},endPoint:{x:J[1][0]*this.ratioX,y:(this.pageHeight-J[1][1])*this.ratioY},lineEnding:h||["None","None"],borderColor:Ve,borderWidth:Q?(A||1)*this.ratioX:0,background:v?vs(v,y):"",lineCap:Xv(F),lineJoin:$v(V),miterLimit:B,lineDash:Zh(M,this.ratioX)},transform:{position:ce,scale:Ce,angle:pe},iconColor:Ve}}parsePolygon(n){const{normalAppearance:o,opacity:h}=n,{objs:v,bbox:y}=o;let{transform:_}=o;if(0===v.length)return null;const{dashArray:b,fillColor:w,fillType:I,lineCap:A,lineJoin:M,lineWidth:F,miterLimit:V,segments:B,strokeColor:Q}=v[0],{ratioX:J,ratioY:Z,pageHeight:re}=this;if(1!==Math.abs(_[0])||1!==Math.abs(_[3])){const Le=Qh(y[0],y[1],_),j=Qh(y[2],y[3],_);v.forEach(L=>{L.segments.forEach(Y=>{const q=Qh(Y[0],Y[1],_);Y[0]=q[0],Y[1]=q[1]})}),y[0]=Le[0],y[1]=Le[1],y[2]=j[0],y[3]=j[1],_=[1,0,0,1,0,0]}const{position:se,angle:ce,scale:pe}=ru(Qu(v),y,_,J,Z,re),Ce=N5(B,this.ratioX,this.ratioY,this.pageHeight),Ve=vs(Q,h),te=vs(w,h);var Me,we;return Ce.length>2&&(Me=Ce[0]).x===(we=Ce[Ce.length-1]).x&&Me.y===we.y&&Ce.pop(),{type:"polygon",style:{points:Ce,borderWidth:(F||0)*this.ratioX,borderColor:Ve,background:I>0?te:"",lineDash:Zh(b,this.ratioX),lineCap:Xv(A),lineJoin:$v(M),miterLimit:V},transform:{position:se,scale:pe,angle:ce},iconColor:I>0?te:Ve}}parsePolyline(n){const{normalAppearance:o,interiorColor:h,opacity:v}=n,{objs:y,bbox:_}=o;let{transform:b}=o;if(0===y.length)return null;const{dashArray:w,lineCap:I,lineJoin:A,lineWidth:M,miterLimit:F,segments:V,strokeColor:B,isStroke:Q}=y[0],{ratioX:J,ratioY:Z,pageHeight:re}=this;if(1!==Math.abs(b[0])||1!==Math.abs(b[3])){const te=Qh(_[0],_[1],b),Me=Qh(_[2],_[3],b);y.forEach(we=>{we.segments.forEach(Le=>{const j=Qh(Le[0],Le[1],b);Le[0]=j[0],Le[1]=j[1]})}),_[0]=te[0],_[1]=te[1],_[2]=Me[0],_[3]=Me[1],b=[1,0,0,1,0,0]}const{position:se,angle:ce,scale:pe}=ru(Qu(y),_,b,J,Z,re),Ce=N5(V,this.ratioX,this.ratioY,this.pageHeight),Ve=vs(B,v);return{type:"polyline",style:{points:Ce,borderWidth:Q?(M||1)*this.ratioX:0,borderColor:Ve,background:h?vs(h,v):"",lineDash:Zh(w,this.ratioX),lineCap:Xv(I),lineJoin:$v(A),lineEnding:n.lineEnding||["None","None"],miterLimit:F},transform:{position:se,scale:pe,angle:ce},iconColor:Ve}}parseInk(n){const{normalAppearance:o,inkList:h,opacity:v}=n,{objs:y,transform:_,bbox:b}=o;if(0===y.length||!h)return null;const{dashArray:w,lineCap:I,fillColor:A,lineJoin:M,lineWidth:F,miterLimit:V,strokeColor:B,fillType:Q,isStroke:J}=y[0],Z=[];for(let Me=0;Me<h.length;Me++){const we=h[Me],Le=[];for(let L=0;L<we.length;L+=2)Le.push([we[L],we[L+1],1,!1]);const j=N5(Le,this.ratioX,this.ratioY,this.pageHeight);Z.push(j)}const{ratioX:re,ratioY:se,pageHeight:ce}=this,{position:pe,angle:Ce,scale:Ve}=ru(Qu(y),b,_,re,se,ce),te=vs(B,v);return{type:"ink",style:{segments:Z,borderWidth:J?(F||1)*this.ratioX:0,borderColor:te,background:Q>0?vs(A,v):"",lineDash:Zh(w,this.ratioX),lineCap:Xv(I),lineJoin:$v(M),miterLimit:V},transform:{position:pe,scale:Ve,angle:Ce},iconColor:te}}parseStamp(n){const{icon:o,opacity:h}=n,{objs:v,transform:y,bbox:_}=n.normalAppearance;if(0===v.length)return null;const b=Qu(v),w=[],{ratioX:I,ratioY:A,pageHeight:M}=this,{position:F,angle:V,scale:B}=ru(b,_,y,I,A,M),Q={position:F,angle:V,scale:B};for(let J=0;J<b.length;J++){let Z;if("path"===b[J].type&&(Z=S2(b[J],h,this.ratioX,this.ratioY,this.pageHeight)),"text"===b[J].type&&(Z=L5(b[J],h,this.ratioX,this.ratioY,this.pageHeight)),"image"===b[J].type){let re;return re=b[J].jpegBase64?`data:image/jpeg;base64,${b[J].jpegBase64}`:jZ(b[J].RGBABase64,b[J].width,b[J].height),{type:"stamp",style:{imageData:re,width:_[2]*this.ratioX,height:_[3]*this.ratioY},transform:Q}}Z&&w.push(Z)}return{type:"stamp",style:{iconName:o,stampConfig:w},transform:Q,iconColor:"#868E96"}}parseTextAssist(n,o){const{objs:h,transform:v,bbox:y}=n.normalAppearance,{opacity:_}=n;if(0===h.length)return null;const b=Qu(h),w=[],{ratioX:I,ratioY:A,pageHeight:M}=this,{position:F,angle:V,scale:B}=ru(b,y,v,I,A,M),Q={position:F,angle:V,scale:B};for(let J=0;J<b.length;J++){let Z;"path"===b[J].type&&(Z=S2(b[J],_,this.ratioX,this.ratioY,this.pageHeight)),Z&&w.push(Z)}return{type:o,style:{opacity:_||1,stampConfig:w,annotationRaw:n},transform:Q}}parseIncomplete(n){const{normalAppearance:o,opacity:h}=n;if(!o)return null;const{objs:v,transform:y,bbox:_}=n.normalAppearance;if(!v||0===v.length)return null;const b=Qu(v),w=[],{ratioX:I,ratioY:A,pageHeight:M}=this,{position:F,angle:V,scale:B}=ru(b,_,y,I,A,M),Q={position:F,angle:V,scale:B};for(let J=0;J<b.length;J++){let Z;if("path"===b[J].type)Z=S2(b[J],h,I,A,M);else if("text"===b[J].type)Z=L5(b[J],h,I,A,M);else if("image"===b[J].type){let re;return re=b[J].jpegBase64?`data:image/jpeg;base64,${b[J].jpegBase64}`:jZ(b[J].RGBABase64,b[J].width,b[J].height),{type:"incomplete",style:{imageData:re,width:_[2]*this.ratioX,height:_[3]*this.ratioY,annotationRaw:n},transform:Q}}Z&&w.push(Z)}return{type:"incomplete",style:{stampConfig:w,annotationRaw:n},transform:Q}}parseUnknown(n){return{type:"unknown",style:{annotationRaw:n}}}}class WDe{constructor(){W(this,"map",new Map),W(this,"ratioX",jn.displayResolution/jn.pdfResolution),W(this,"ratioY",jn.displayResolution/jn.pdfResolution)}toPdfAnnotations(n,o){var h=this;return Fe(function*(){const v=[],y=[...n];y.sort((_,b)=>_.layer-b.layer);for(let _=0;_<y.length;_++){const b=y[_];if(b){const w=yield h.toPdfAnnotation(b,{width:o.width/h.ratioX,height:o.height/h.ratioY});w&&(w.oriIndex=b.oriIndex,w.modified=b.modified,v.push(w))}}return v})()}toPdfAnnotation(n,o){var h=this;return Fe(function*(){if("stamp"===n.type&&n.style.imageData&&(!$t(n.style.width)||!$t(n.style.height))){const _=new Lv,b=yield _.readImageInfo({fileSource:n.style.imageData});let w=b.imageWidth,I=b.imageHeight;if(w>400||I>400){const A=Math.max(w/400,I/400);w/=A,I/=A}n.style.width=w,n.style.height=I}const v=h.createShape(n);if(v instanceof sr&&"freeTextWriter"===v.textType){const{width:_,height:b}=v.getBoundingRect();v.setOrigin(_/2,b/2)}let y=null;switch(n.type){case"rectangle":case"ellipse":y=h.toPdfRectOrEllipse(n,o,v);break;case"polyline":case"polygon":y=h.toPdfPolygonal(n,o,v);break;case"line":y=h.toPdfLine(n,o,v);break;case"ink":y=h.toPdfInk(n,o,v);break;case"stamp":y=yield h.toPdfStamp(n,o,v);break;case"textBox":y=h.toPdfFreeText(n,o,v,"textBox");break;case"textTypewriter":y=h.toPdfFreeText(n,o,v,"freeTextWriter");break;case"highlight":y=h.toPdfTextAssist(n,"Highlight",o,v);break;case"underline":y=h.toPdfTextAssist(n,"Underline",o,v);break;case"strikeout":y=h.toPdfTextAssist(n,"StrikeOut",o,v);break;case"incomplete":y=n.style.annotationRaw}return y&&(y.title=n.comment.author,y.subject=n.comment.subject,y.creationdate=n.comment.creationDate),y})()}toPdfRectOrEllipse(n,o,h){const{borderColor:v,background:y,lineDash:_}=n.style,{borderWidth:b,opacity:w}=h.parsedStyle,{strokeColor:I,fillColor:A}=j_(v,y),{apStrokeColor:M,apFillColor:F}=Hv(v,y,w),V=Gv(b,_,this.ratioX),B=V.width,J=Yv(h,F,M,w,B,"rectangle"===n.type?BZ(h,B,this.ratioX,this.ratioY,o.height):function(Z,re,se,ce){const{x:pe,y:Ce}=Z.getLocalPosition();Z.path||Z.getPath();const{path:Ve}=Z,te=[];for(let Me=0;Me<Ve.length;Me++){const we=(Ve[Me].x+pe)/re,Le=ce-(Ve[Me].y+Ce)/se;0===Me?(te.push([we,Le,2,!1]),te.push([we,Le,0,!1])):te.push(Me===Ve.length-1?[we,Le,1,!0]:[we,Le,1,!1])}return te}(h,this.ratioX,this.ratioY,o.height),this.ratioX);return h.path||h.getPath(),{type:"rectangle"===n.type?"Square":"Circle",normalAppearance:J,interiorColor:A,color:I,borderStyle:V,opacity:w,rect:im(h,h.path,B,this.ratioX,this.ratioY,o.height),flags:rm([...n.flags]),date:n.comment.modificationDate,name:n.uid,contents:""}}toPdfPolygonal(n,o,h){const{borderWidth:v,opacity:y}=h.parsedStyle,{borderColor:_,background:b,lineEnding:w,lineDash:I}=n.style,A="polyline"===n.type,{strokeColor:M,fillColor:F}=j_(_,b),{apStrokeColor:V,apFillColor:B}=Hv(_,b,y),Q=Gv(v,I,this.ratioX),J=Q.width;let Z,re,se;A?(Z=WZ(h,this.ratioX,this.ratioY,o.height),re=Z.flat(),se=LZ(Z[0])):(Z=function(Ce,Ve,te,Me){Ce.renderPath||Ce.getPath();const{x:we,y:Le}=Ce.getLocalPosition(),{renderPath:j}=Ce,L=[];for(let Y=0;Y<j.length;Y++){const q=(j[Y].x+we)/Ve,k=Me-(j[Y].y+Le)/te;if(0!==Y){if(Y===j.length-1){L.push([q,k,0,!0]);break}L.push([q,k,0,!1])}else L.push([q,k,2,!1])}return L}(h,this.ratioX,this.ratioY,o.height),re=Z,se=LZ(re));const ce=Yv(h,B,V,y,J,re,this.ratioX,!A);if(A){const Ce=[];Z.forEach(Ve=>{Ce.push(H_(h,Ve,B,V,J,zv(I,this.ratioX)))}),ce.objs=Ce}const pe={type:A?"PolyLine":"Polygon",borderStyle:Q,color:M,interiorColor:F,normalAppearance:ce,vertices:se,opacity:y,rect:im(h,h.renderPath,J,this.ratioX,this.ratioY,o.height),name:n.uid,contents:"",flags:rm([...n.flags]),date:n.comment.modificationDate};return A&&h.isLineArrow()&&(pe.lineEnding=w),pe}toPdfLine(n,o,h){const{borderWidth:v,opacity:y}=h.parsedStyle,{borderColor:_,background:b,lineEnding:w,lineDash:I}=n.style,{strokeColor:A,fillColor:M}=j_(_,b),{apStrokeColor:F,apFillColor:V}=Hv(_,b,y),B=Gv(v,I,this.ratioX),Q=B.width,J=WZ(h,this.ratioX,this.ratioY,o.height),Z=J.flat(),re=[];J.forEach(pe=>{re.push(H_(h,pe,V,F,Q,zv(I,this.ratioX)))});const se=Yv(h,V,F,y,Q,Z,this.ratioX,!1);se.objs=re;const ce={type:"Line",line:[Z[0][0],Z[0][1],Z[1][0],Z[1][1]],interiorColor:M,color:A,normalAppearance:se,borderStyle:B,opacity:y,rect:im(h,h.renderPath,Q,this.ratioX,this.ratioY,o.height),name:n.uid,contents:"",flags:rm([...n.flags]),date:n.comment.modificationDate,toJsonString:()=>""};return h.isLineArrow()&&(ce.lineEnding=w,ce.intent="LineArrow"),ce}toPdfInk(n,o,h){const{borderWidth:v,opacity:y}=h.parsedStyle,{borderColor:_,background:b,lineDash:w}=n.style,{strokeColor:I}=j_(_,b),{apStrokeColor:A,apFillColor:M}=Hv(_,b,y),F=Gv(v,w,this.ratioX),V=F.width,B=function(Ce,Ve,te,Me){Ce.inkOriginalRenderPath||Ce.getInkOriginalRenderPath();const{x:we,y:Le}=Ce.getLocalPosition(),{inkOriginalRenderPath:j}=Ce,L=[];for(let Y=0;Y<j.length;Y++){const q=j[Y],k=[];for(let N=0;N<q.length;N++){const $=(q[N].x+we)/Ve,ie=Me-(q[N].y+Le)/te;k.push(0===N?[$,ie,2,!1]:[$,ie,1,!1])}if(k.length&&k.length<4)for(;k.length<4;)k.push([...k[k.length-1]]);L.push(k)}return L}(h,this.ratioX,this.ratioY,o.height),Q=B.flat(),J=[],{x:Z,y:re}=h.getLocalPosition();h.getPath();const{inkRenderSteps:se}=h,ce=[];se.forEach(Ce=>{const Ve=[];Ce.forEach((te,Me)=>{0===Me?Ve.push([(te.data[0].x+Z)/this.ratioX,o.height-(te.data[0].y+re)/this.ratioY,2,!1]):te.data.forEach(we=>{Ve.push([(we.x+Z)/this.ratioX,o.height-(we.y+re)/this.ratioY,1,!1])})}),ce.push(Ve)}),ce.forEach(Ce=>{J.push(H_(h,Ce,M,A,V,zv(w,this.ratioX)))});const pe=Yv(h,M,A,y,V,Q,this.ratioX,!1);return pe.objs=J,{type:"Ink",color:I,normalAppearance:pe,borderStyle:F,opacity:y,inkList:RDe(B),rect:im(h,h.inkOriginalRenderPath.flat(),V,this.ratioX,this.ratioY,o.height),name:n.uid,contents:"",flags:rm([...n.flags]),date:n.comment.modificationDate}}toPdfStamp(n,o,h){var v=this;return Fe(function*(){const{imageData:y,iconName:_,opacity:b}=n.style;if(y)return yield v.toPdfStampImage(n,o,h);const w=h.childNodes,I=UZ(h,v.ratioX,v.ratioY,o.height),A=[],M=[];let F=0,V=0;for(let Q=0;Q<w.length;Q++){let J;if(w[Q].style.opacity=w[Q].parsedStyle.opacity/(n.style.opacity||1),w[Q]instanceof v2){const re=NZ(w[Q]);M.push(...re);const{borderWidth:se,lineDash:ce}=w[Q].parsedStyle,{borderColor:pe,background:Ce}=w[Q].style,{apStrokeColor:Ve,apFillColor:te}=Hv(pe,Ce,b),Me=Gv(se,ce,v.ratioX).width,we=ODe(Ce,I[F]);V=Math.max(Me,V),J=H_(w[Q],I[F],te,Ve,Me,zv(ce,v.ratioX)),we&&(J.pattern=we),F+=1,A.push(J)}w[Q]instanceof rw&&(J=FDe(w[Q],v.ratioX,v.ratioY,o.height),A.push(J))}const B=Yv(h,null,null,b,V,I.flat(),v.ratioX,!1);return B.objs=A,{type:"Stamp",icon:_,rect:im(h,M,V,v.ratioX,v.ratioY,o.height),normalAppearance:B,opacity:b,name:n.uid,contents:"",flags:rm([...n.flags]),date:n.comment.modificationDate}})()}toPdfStampImage(n,o,h){var v=this;return Fe(function*(){const{imageData:y,opacity:_}=n.style;let b=y,w=[];Sn(y)&&(w=y.split(","),w[0].match(/:(.*?);/),b=function(Q){let J=null;const Z=Q.split(","),re=Z[0].match(/:(.*?);/)[1],se=window.atob(Z[1]);let ce=se.length;const pe=new Uint8Array(ce);for(;ce--;)pe[ce]=se.charCodeAt(ce);return J=new Blob([pe],{type:re}),J}(y));const{width:I,height:A}=h.parsedStyle,M=OZ(h),F=[0,0,I.value/v.ratioX,A.value/v.ratioY],V=yield(Q=Fe(function*(J,Z,re,se){const{width:ce,height:pe}=J.parsedStyle,Ce=ce.value/re,Ve=pe.value/se;let te;if("image/jpeg"===Z.type){const Me=new Lv,we=yield Me.readImage({source:{fileSource:Z},outputType:1,returnBase64:!0});Me.destroy(),te={type:"image",jpegBase64:we.imageData,objMatrix:[Ce,0,0,Ve,0,0],rect:[0,0,Ce,Ve]}}else{const Me=new Lv,we=yield Me.readImage({source:{fileSource:Z},outputType:-2,returnBase64:!0});Me.destroy(),te={type:"image",RGBABase64:we.imageData,height:we.imageHeight,width:we.imageWidth,objMatrix:[Ce,0,0,Ve,0,0],rect:[0,0,Ce,Ve]}}return te}),function(J,Z,re,se){return Q.apply(this,arguments)})(h,b,v.ratioX,v.ratioY),B=function(Q,J,Z,re){const{width:se,height:ce}=Q.parsedStyle,{x:pe,y:Ce}=Q.getLocalScale(),{x:Ve,y:te}=Q.getLocalPosition(),Me=Q.getAngle();let Y=new ms({style:{x:Ve+se.value/2-se.value*pe*.5,y:re*Z-ce.value*Ce-(re*Z-ce.value*Ce*.5-(te+ce.value/2)),width:se.value*pe,height:ce.value*Ce}});Y.setAngle(Me),Y.getPath();const q=im(Y,Y.path,0,J,Z,re);return Y=null,q}(h,v.ratioX,v.ratioY,o.height);var Q;return{type:"Stamp",normalAppearance:{bbox:F,matrix:M,objs:[V],transform:M},rect:B,opacity:_,name:n.uid,contents:"",flags:rm([...n.flags]),date:n.comment.modificationDate}})()}toPdfFreeText(n,o,h,v){const{opacity:y,textContents:_,borderColor:b,background:w,lineDash:I,textAlign:A}=n.style;"freeTextWriter"===v&&(h.style.borderWidth=0);const{borderWidth:M}=h.parsedStyle,{strokeColor:F,fillColor:V}=j_(b,w),{apStrokeColor:B,apFillColor:Q}=Hv(b,w,y),J="textBox"===v?Gv(M,I,this.ratioX):{width:0},Z=J.width,re=Yv(h,Q,B,y,Z,BZ(h,Z,this.ratioX,this.ratioY,o.height),this.ratioX,"textBox"===v),se=function(Le,j,L,Y){const{lines:q}=Le,{opacity:k}=Le.parsedStyle,N=[],$=(ie,ee,ne)=>({type:"path",strokeColor:ie,fillColor:ie,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:ne,objMatrix:[1,0,0,1,0,0],segments:ee,dashArray:[],dashPhase:0});return q.forEach(ie=>{const ee=ie.height/30,ne=Le.getTextAlignOffset(ie);ie.words.forEach(le=>{const{fontFamily:fe,fontSize:xe,fontStyle:Pe,fontWeight:De,color:je,underline:ke,lineThrough:Ae}=le.style,he=V_(je,1,!1),tt=he?[...he,255*k]:[0,0,0,255],Ze=(le.x+ne)/j,nt=Y-ie.y/L,et={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:tt,fontName:fe,fontIsBold:VZ(De),fontIsItalic:"italic"===Pe,fontSize:xe.value/j,text:(Qe=le.text,Qe.replace(/\r?\n$/,"")),objMatrix:[1,0,0,1,Ze,nt],position:[Ze,nt]};var Qe;if(N.push(et),ke){const at=Y-(ie.y+ee)/L,vt=$(tt,[[Ze,at,2,!1],[Ze+le.widthWithoutLf/j,at,0,!1]],ee/L);N.push(vt)}if(Ae){const at=Y-(ie.y-le.wordHeight/3)/L,vt=$(tt,[[Ze,at,2,!1],[Ze+le.widthWithoutLf/j,at,0,!1]],ee/L);N.push(vt)}})}),N}(h,this.ratioX,this.ratioY,o.height);"textBox"===v?re.objs.push(...se):re.objs=se;const{defaultAppearance:ce,defaultAppearanceData:pe,defaultStyle:Ce}=function(Le,j,L,Y,q){const k=L[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:N,fontSize:$,fontStyle:ie,fontWeight:ee,color:ne}=k,le=V_(ne,1,!1),fe=u2(`rgb(${le[0]}, ${le[1]}, ${le[2]})`),xe=ni($).value/q,Pe=w2(N," ","");return{defaultAppearance:"textBox"===Le?`${j[0]/255} ${j[1]/255} ${j[2]/255} rg /${Pe} ${xe} Tf`:`${le[0]/255} ${le[1]/255} ${le[2]/255} rg /${Pe} ${xe} Tf`,defaultStyle:`font:${"bold"===ee?"bold":""} ${"italic"===ie?"italic":""} '${N}' ${xe}pt; text-align:${"justify"===Y?"justify-center":Y}; color:${fe.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:le,fontSize:xe,fontName:N}}}(v,F||[0,0,0],_,"freeTextWriter"===v?"left":A,this.ratioX);h.getPath();const Ve=im(h,h.path,Z,this.ratioX,this.ratioY,o.height);let te="";_.forEach(Le=>{te+=Le.content});const Me=function(Le,j,L){if(!Le||!Le.length)return null;const Y=document.implementation.createDocument(null,"body",null),q=Y.documentElement;q.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),q.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),q.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),q.setAttribute("xfa:spec","2.0.2");const k=Ze=>`font-size:${ni(Ze).value/L}pt;`,N=Ze=>`font-weight:${"bold"===Ze?"bold":"normal"};`,$=Ze=>`font-style:${"italic"===Ze?"italic":"normal"};`,ie=Ze=>`color:${u2(Kd(Ze).formatted)};`,ee=Ze=>`font-family:'${Ze}';`,ne=Le[0],{fontFamily:le,fontSize:fe,fontStyle:xe,fontWeight:Pe,color:De}=ne,je=Kd(De),ke=`${k(fe)}text-align:${"justify"===j?"justify-center":j};${ie(je.formatted)}${N(Pe)}${$(xe)}${ee(le)}font-stretch:normal;`;q.setAttribute("style",ke);const Ae=Y.createElement("p");Ae.setAttribute("dir","ltr"),Le.forEach(Ze=>{if(!Ze.content.length)return;const nt=Y.createElement("span"),et=Y.createTextNode(Ze.content);nt.appendChild(et);let Qe="";le!==Ze.fontFamily&&(Qe+=ee(Ze.fontFamily)),fe!==Ze.fontSize&&(Qe+=k(Ze.fontSize)),xe!==Ze.fontStyle&&(Qe+=$(Ze.fontStyle)),Pe!==Ze.fontWeight&&(Qe+=N(Ze.fontWeight)),De!==Ze.color&&(Qe+=ie(Ze.color)),(Ze.lineThrough||Ze.underline)&&(Qe+=`text-decoration:${Ze.underline?"word":""} ${Ze.lineThrough?"line-through":""}`),Qe&&nt.setAttribute("style",Qe),Ae.appendChild(nt)}),q.appendChild(Ae);const he=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(Y)}`,tt='xmlns="http://www.w3.org/1999/xhtml"';return he.includes(tt)?w2(he,'xmlns=""',tt):w2(he.replace(/<body/,`<body ${tt}`),'xmlns=""',tt)}(_,A,this.ratioX),we={borderStyle:J,type:"FreeText",color:V,normalAppearance:re,defaultAppearance:ce,defaultAppearanceData:pe,defaultStyle:Ce,rect:Ve,name:n.uid,contents:te,opacity:y,flags:rm([...n.flags]),date:n.comment.modificationDate};return"freeTextWriter"===v&&(we.intent="FreeTextTypeWriter"),Me&&(we.richText=Me),we}toPdfTextAssist(n,o,h,v){if(n.style.annotationRaw)return n.style.annotationRaw;const{opacity:y}=n.style,_=v.childNodes,b=UZ(v,this.ratioX,this.ratioY,h.height),w=[],I=[];for(let V=0;V<_.length;V++){const B=NZ(_[V]);I.push(...B);const{borderWidth:Q,lineDash:J}=_[V].parsedStyle,{borderColor:Z,background:re}=_[V].style,{apStrokeColor:se,apFillColor:ce}=Hv(Z,re,y),pe=Gv(Q,J,this.ratioX).width,Ce=H_(_[V],b[V],ce,se,pe,zv(J,this.ratioX));w.push(Ce)}const A=Yv(v,null,null,y,0,b.flat(),this.ratioX,!1);A.objs=w;const M=im(v,I,0,this.ratioX,this.ratioY,h.height),F=[];return b.forEach(V=>{const B=[];V.forEach(ce=>{B.push({x:ce[0],y:ce[1]})});const Q=wp(B),{left:J,bottom:Z,top:re,right:se}=Q;F.push([J,Z,se,Z,J,re,se,re])}),{type:o,rect:M,normalAppearance:A,opacity:y,quadPoints:F,name:n.uid,flags:rm([...n.flags]),date:n.comment.modificationDate}}createShape(n){const{type:o,transform:h,style:v}=pn(n),y={id:n.uid,style:v,transform:h};let _;switch("ellipse"===o&&(v.x+=v.width/2||0,v.y+=v.height/2||0,v.rx=v.width/2||v.rx,v.ry=v.height/2||v.ry),o){case"rectangle":_=new _2(y);break;case"ellipse":_=new jv(y);break;case"line":_=new uw(y);break;case"ink":_=new Qd(y);break;case"polygon":_=new lw(y);break;case"polyline":_=new cw(y);break;case"textTypewriter":_=new sr(y,"freeTextWriter",{},!1);break;case"textBox":_=new sr(y,"textBox");break;case"stamp":_=new iu(y);break;case"highlight":_=new Kh(y,Zd.HIGHLIGHT);break;case"underline":_=new Kh(y,Zd.UNDERLINE);break;case"strikeout":_=new Kh(y,Zd.STRIKEOUT)}return _}}class GZ{constructor(){W(this,"annotationParser",new BDe),W(this,"annotationWriter",new WDe)}getParsedAnnotations(n,o,h){const v=jn.displayResolution/jn.pdfResolution;n=n.filter(_=>null!==_),this.annotationParser.setParserConfig(o,h,v,v),this.moveReplyToAnnotation(n);const y=[];return n.forEach(_=>{if(_){const w=this.annotationParser.parseAnnotation(_);if(w){var b;w.flags=this.parseFlags(_.flags||[]);const I=this.parseReply(_);null!==(b=_.replies)&&void 0!==b&&b.length&&(I.replies=_.replies.map(A=>this.parseReply(A))||[]),w.comment=I,y.push(w)}}}),y}moveReplyToAnnotation(n){n.forEach(o=>{if(o&&"Text"===o.type&&!gt(o.inreplyto)){const h=n[o.inreplyto];"Review"===o.statemodel?(h.reviewStates||(h.reviewStates=[]),h.reviewStates.push(o)):"Marked"===o.statemodel?(h.markedStates||(h.markedStates=[]),h.markedStates.push(o)):(h.replies||(h.replies=[]),h.replies.push(o))}}),n.slice().forEach(o=>{if(!o||"Popup"===o.type||!gt(o.inreplyto)){const h=n.findIndex(v=>v===o);n.splice(h,1)}})}parseReply(n){var o,h;const v=this.parseCommon(n);return v.subject=n.subject,null!==(o=n.reviewStates)&&void 0!==o&&o.length&&(v.reviewStates=n.reviewStates.map(y=>this.parseState(y))),null!==(h=n.markedStates)&&void 0!==h&&h.length&&(v.markedStates=n.markedStates.map(y=>this.parseState(y))),v}parseFlags(n){const o=[],h={readonly:"readOnly",noview:"noView"};return n.forEach(v=>{o.push(h[v]||v)}),o}parseState(n){return zt(Ke({},this.parseCommon(n)),{state:n.state,stateModel:n.statemodel})}parseCommon(n){const o=n.creationdate,h=n.date;return{uid:Ai(),author:n.title,contents:n.contents,type:n.type,creationDate:o||h,modifiedDate:h||o,flags:n.flags?[...n.flags]:[]}}parseDate(n){if(!n)return;let o=2;if(!n)return"";const h=[4,2,2,2,2,2].map(y=>{const _=n.slice(o,o+y);return o+=y,parseInt(_,10)});h[1]-=1;const v=new Date(...h).getTime();return pQ("yyyy.MM.dd hh:mm:ss",v)}getOriginalAnnotations(n,o){var h=this;return Fe(function*(){return yield h.annotationWriter.toPdfAnnotations(n,o)})()}}function T2(p){return{left:p[0],top:p[1],width:p[2]-p[0],height:p[3]-p[1]}}(function(p){p.CM_RENDERALL="cm/renderall",p.CM_IMAGEONLY="cm/imageonly",p.CM_AUTO="cm/auto"})(ml||(ml={})),function(p){p.NO_ANNOTATIONS="noAnnotations",p.RENDER_ANNOTATIONS="renderAnnotations",p.LOAD_ANNOTATIONS="loadAnnotations"}(Jh||(Jh={}));var I2=new WeakSet;class UDe{constructor(){dl(this,I2),W(this,"type","pdfParser"),W(this,"once",!1),W(this,"pdfReader",void 0),W(this,"parserOptions",{convertMode:ml.CM_AUTO}),W(this,"source",void 0),W(this,"isDestroy",!1),W(this,"annotationMapper",void 0),this.pdfReader=new i2,this.annotationMapper=new GZ}initParser(n,o){this.parserOptions=null!=o?o:{convertMode:ml.CM_AUTO},this.source={fileSource:n,password:this.parserOptions.password}}getPageCount(){var n=this;return Fe(function*(){return n.pdfReader.getPdfPageCount(n.source,lt(I2,n,B5).call(n))})()}destroy(){var n;null===(n=this.pdfReader)||void 0===n||n.destroy(),this.pdfReader=null,this.isDestroy=!0}parse(n){var o=this;return Fe(function*(){if(o.isDestroy||!o.source)return null;const h=[],v=yield o.pdfReader.readPageImageInfos({source:o.source,indices:(null==n?void 0:n.slice())||[],readOptions:lt(I2,o,B5).call(o),outputType:Va.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:y,pdfResolution:_}=jn;for(let A=0;A<v.length;++A){var b,w,I;const M=v[A],F=1===M.realReadMode,V=F?T2(M.mediaBox):{left:0,top:0,width:M.imageWidth/M.imageXResolution*_,height:M.imageHeight/M.imageYResolution*_},B=F?T2([M.cropBox[0],M.mediaBox[1]+M.mediaBox[3]-M.cropBox[3],M.cropBox[2],M.mediaBox[1]+M.mediaBox[3]-M.cropBox[1]]):Ke({},V),Q={fileIndex:M.pageIndex,rotation:M.rotation,mediaBox:Kn(V,_,y),cropBox:Kn(B,_,y),resource:{width:M.imageWidth,height:M.imageHeight,resolutionX:M.imageXResolution,resolutionY:M.imageYResolution,bitDepth:M.imageBitDepth},pdfOptions:{convertMode:F?ml.CM_RENDERALL:ml.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(b=o.parserOptions.renderOptions)||void 0===b?void 0:b.renderAnnotations,renderGrayscale:null===(w=o.parserOptions.renderOptions)||void 0===w?void 0:w.renderGrayscale}},annotations:[]};if(F&&(null===(I=o.parserOptions.renderOptions)||void 0===I?void 0:I.renderAnnotations)===Jh.LOAD_ANNOTATIONS){const J=yield o.pdfReader.readAnnotations(o.source,Q.fileIndex);J.length&&(Q.annotations=o.annotationMapper.getParsedAnnotations(J,2*V.left+V.width,2*V.top+V.height))}h.push(Q)}return h})()}getPage(n){var o=this;return Fe(function*(){if(o.isDestroy||!o.source)return null;const h=yield o.pdfReader.readPage({source:o.source,index:n,readOptions:lt(I2,o,B5).call(o),outputType:Va.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(h){const{displayResolution:v,pdfResolution:y}=jn,_=h.imageInfos[0];return{fileIndex:h.pageIndex,rotation:h.rotation,mediaBox:Kn(T2(h.mediaBox),y,v),cropBox:Kn(T2(h.cropBox),y,v),resource:{data:h.imageData,width:_.imageWidth,height:_.imageHeight,resolutionX:_.imageXResolution,resolutionY:_.imageYResolution,bitDepth:_.imageBitDepth}}}return null})()}cancelGetPage(n){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,n)}}function B5(){var p,n;if(this.isDestroy||!this.parserOptions)return null;const o={[Jh.NO_ANNOTATIONS]:0,[Jh.RENDER_ANNOTATIONS]:1,[Jh.LOAD_ANNOTATIONS]:2};return{convertMode:{[ml.CM_IMAGEONLY]:2,[ml.CM_RENDERALL]:1,[ml.CM_AUTO]:3}[(null===(p=this.parserOptions)||void 0===p?void 0:p.convertMode)||ml.CM_AUTO],renderOptions:zt(Ke({},this.parserOptions.renderOptions||{}),{renderAnnotations:o[null===(n=this.parserOptions.renderOptions)||void 0===n?void 0:n.renderAnnotations]||0,renderIgnoreCrop:!0})}}class VDe{constructor(){W(this,"type","rgbaParser"),W(this,"once",!1),W(this,"processor",void 0),W(this,"cachePage",[]),W(this,"source",void 0),W(this,"parserOptions",void 0),this.processor=new Kg}initParser(n,o){this.source=n,this.parserOptions=o}getPageCount(){return Fe(function*(){return 1})()}destroy(){var n;null===(n=this.processor)||void 0===n||n.terminate(),this.processor=void 0}parse(){var n=this;return Fe(function*(){var o;const{outputType:h,jpegQuality:v,width:_,height:b,bitDepth:w,xResolution:I,yResolution:A}=null!==(o=n.parserOptions)&&void 0!==o?o:{},M=yield n.source.arrayBuffer();yield n.processor.initImage({source:M,isRGBA:!0,width:_,height:b,isBGRA:!1});const V=U_(yield n.processor.getImage({jpegQuality:v,ifDeleteObject:!0,isRGBA:!0,bitDepth:w,xDpi:I,yDpi:A,returnBlob:!0,returnType:h}));return n.cachePage=[V],n.cachePage})()}getPage(){var n=this;return Fe(function*(){return Promise.resolve(n.cachePage[0])})()}cancelGetPage(n){}}class zZ{constructor(){W(this,"db",void 0),this.db=new Map}saveByMime(n,o){this.db.set(n,o)}hasByMime(n){return this.db.has(n)}deleteConstructorByMime(n){return!!this.hasByMime(n)&&(this.db.delete(n),!0)}getConstructorByMime(n){return this.db.get(n)}has(n){throw new Error("Method not implemented.")}save(n){throw new Error("Method not implemented.")}clear(){this.db.clear()}}const G_=new class{constructor(){W(this,"db",void 0),this.db=new Map}saveByFileUid(p,n){this.db.set(p,n)}getParserByFileUid(p){return this.db.get(p)}deleteParserByFileUid(p){return this.db.delete(p)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}getAllParsers(){return Array.from(this.db.values())}},E2=new zZ,hw=new zZ,fw=new class{constructor(){W(this,"db",void 0),this.db=new Map}getDefaultOptionsByMime(p){return this.db.get(p)}deleteDefaultOptionsByMime(p){return this.db.delete(p)}saveDefaultOptionsByMime(p,n){this.db.set(p,n)}has(p){throw new Error("Method not implemented.")}save(p){throw new Error("Method not implemented.")}clear(){this.db.clear()}},W5=new class{constructor(p,n,o){W(this,"parserRepo",void 0),W(this,"parserConstructorRepo",void 0),W(this,"customParserConstructorRepo",void 0),this.parserRepo=p,this.parserConstructorRepo=n,this.customParserConstructorRepo=o}getParser(p,n){let o=this.parserRepo.getParserByFileUid(p);return o||(o=new(this.customParserConstructorRepo.getConstructorByMime(n)||this.parserConstructorRepo.getConstructorByMime(n)),o.once||this.parserRepo.saveByFileUid(p,o),o)}}(G_,E2,hw),jDe=new class{constructor(p){W(this,"parserRepo",void 0),this.parserRepo=p}execute(p){let{fileIndex:n,fileUid:o}=p;const h=this.parserRepo.getParserByFileUid(o);h&&h.cancelGetPage(n)}}(G_),HDe=new class{constructor(p){W(this,"parserRepo",void 0),this.parserRepo=p}execute(p){const n=this.parserRepo.getParserByFileUid(p);n&&(n.destroy(),this.parserRepo.deleteParserByFileUid(p))}}(G_),GDe=new class{constructor(p,n){W(this,"parserService",void 0),W(this,"parserRepo",void 0),this.parserService=p,this.parserRepo=n}execute(p){var n=this;return Fe(function*(){const{fileData:o,mime:h,fileUid:v,fileIndex:y}=p;let _=n.parserRepo.getParserByFileUid(v);return _||(_=n.parserService.getParser(v,h),_.initParser(o)),_.getPage(y)})()}}(W5,G_),zDe=new class{constructor(p,n){W(this,"parserService",void 0),W(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=n}execute(p){var n=this;return Fe(function*(){const{fileData:o,mime:h,fileUid:v,indices:y}=p;let{parseOptions:_}=p;_=_||n.defaultParserOptionsRepo.getDefaultOptionsByMime(h);const b=n.parserService.getParser(v,h);return b.initParser(o,_),b.parse(y)})()}}(W5,fw),YDe=new class{constructor(p){W(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){let{mime:n,parser:o}=p;this.parserConstructorRepo.saveByMime(n,o)}}(E2),XDe=new class{constructor(p){W(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=p}execute(p){this.parserConstructorRepo.deleteConstructorByMime(p)}}(hw),$De=new class{constructor(p){W(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){let{mime:n,parser:o}=p;this.customParserConstructorRepo.saveByMime(n,o)}}(E2),qDe=new class{constructor(p){W(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){this.customParserConstructorRepo.deleteConstructorByMime(p)}}(hw),KDe=new class{constructor(p){W(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=p}execute(p){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(p)}}(fw),JDe=new class{constructor(p,n,o){W(this,"defaultParserOptionsRepo",void 0),W(this,"parserConstructorRepo",void 0),W(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=p,this.parserConstructorRepo=n,this.customParserConstructorRepo=o}execute(p){let{mime:n,options:o}=p;return!(!o||!Vn(o)||!this.customParserConstructorRepo.hasByMime(n)&&!this.parserConstructorRepo.hasByMime(n)||(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(n,pn(o)),0))}}(fw,E2,hw),QDe=new class{constructor(p){W(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=p}execute(p){return this.customParserConstructorRepo.getConstructorByMime(p)}}(hw),ZDe=new class{constructor(p,n){W(this,"parserService",void 0),W(this,"defaultParserOptionsRepo",void 0),this.parserService=p,this.defaultParserOptionsRepo=n}execute(p){var n=this;return Fe(function*(){var o,h;let{fileData:v,mime:y,fileUid:_,options:b}=p;b=b||n.defaultParserOptionsRepo.getDefaultOptionsByMime(y);const w=n.parserService.getParser(_,y);return w.initParser(v,b),{pageCount:yield w.getPageCount(),batchSize:null!==(o=null===(h=b)||void 0===h?void 0:h.batchSize)&&void 0!==o?o:0}})()}}(W5,fw);class eAe{constructor(){W(this,"type",void 0),W(this,"once",!1),W(this,"cachedPage",void 0),W(this,"parserOptions",void 0)}initParser(n,o){this.parserOptions=o}getPageCount(){return Fe(function*(){return Promise.resolve(1)})()}destroy(){}parse(){var n=this;return Fe(function*(){const{width:o,height:h,bitDepth:v,resolutionX:y,resolutionY:_}=n.parserOptions,b=U_({imageBitDepth:v,imageHeight:h,imageWidth:o,imageXResolution:y,imageYResolution:_});return n.cachedPage=b,[n.cachedPage]})()}getPage(){var n=this;return Fe(function*(){const o=yield n.createBlankPage(n.parserOptions.width,n.parserOptions.height);return n.cachedPage.resource.data=o,n.cachedPage})()}cancelGetPage(){}createBlankPage(n,o){var h=this;return Fe(function*(){var v,y,_;const b=new Uint8Array([255,255,255,255]),w=new Kg;yield w.initImage({source:b,isRGBA:!0,width:1,height:1,isBGRA:!1}),yield w.resize(n,o);const I=yield w.getImage({jpegQuality:null!==(v=h.parserOptions.jpegQuality)&&void 0!==v?v:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(y=h.parserOptions.resolutionX)&&void 0!==y?y:96,yDpi:null!==(_=h.parserOptions.resolutionY)&&void 0!==_?_:96,returnBlob:!1,returnType:Kx[Er.JPEG]});return new Blob([I.imageData],{type:I.blobType})})()}}var Ha;!function(p){p.GOOD="Good",p.AUTO_CAPTURE="AutoCaptured",p.SMALL_SIZE="SmallSize",p.OFF_CENTER="OffCenter",p.SKEW="Skew",p.NOTHING_DETECTED="NothingDetected"}(Ha||(Ha={}));var Xs,Ga=new WeakSet;class YZ{constructor(){dl(this,Ga),W(this,"detector",void 0),W(this,"succeedDetect",0),W(this,"failedDetect",0),W(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0}destroy(){this.clear()}clear(){var n;null===(n=this.detector)||void 0===n||n.terminate(),this.detector=void 0}detect(n,o){return Fe(function*(){return Promise.resolve({success:!1})})()}getStatusMsg(n){switch(n){case Ha.AUTO_CAPTURE:return"Auto capture completed.";case Ha.GOOD:return"Capturing your document... Please do not move the camera.";case Ha.SMALL_SIZE:return"The document is too small. Try moving closer.";case Ha.OFF_CENTER:return"Try holding the device at the center of the document.";case Ha.SKEW:return"Please hold the device over a document to start scanning.";case Ha.NOTHING_DETECTED:return"No document is detected."}}processDetectResult(n){if([].concat(...n.location).every(I=>0===I))return{success:!1,confidence:0,status:Ha.NOTHING_DETECTED};let o;const h=this.calculateConfidence(n.location,n.width,n.height);o=gt(n.confidence)?this.calculateTotalConfidence(h):n.confidence;const v={success:!0,location:n.location,confidence:o},{angleConfidence:y,areaConfidence:_,centerConfidence:b}=h,{config:w}=n;return o>=(null==w?void 0:w.acceptedPolygonConfidence)?(this.succeedDetect+=1,v.status=Ha.GOOD,null!=w&&w.enableAutoCapture?this.autoCaptureStartTime<=0?this.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-this.autoCaptureStartTime>w.autoCaptureDelay&&(this.autoCaptureStartTime=0,v.status=Ha.AUTO_CAPTURE):this.autoCaptureStartTime=0):.45*y+.45*b+10>=(null==w?void 0:w.acceptedPolygonConfidence)?(this.reset(),v.status=Ha.SMALL_SIZE):.45*y+.45*_+10>=(null==w?void 0:w.acceptedPolygonConfidence)?(this.reset(),v.status=Ha.OFF_CENTER):.45*_+.45*b+10>=(null==w?void 0:w.acceptedPolygonConfidence)?(this.reset(),v.status=Ha.SKEW):(v.success=!1,v.status=Ha.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0),this.failedDetect>5&&this.reset(),v.statusMsg=this.getStatusMsg(v.status),v}calculateConfidence(n,o,h){return lt(Ga,this,nAe).call(this,lt(Ga,this,tAe).call(this,n),o,h)}calculateTotalConfidence(n){const{angleConfidence:o,areaConfidence:h,centerConfidence:v}=n;return o&&h&&v?.3*o+.3*h+.3*v+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0}}function tAe(p){return p?[p[0][0],p[0][1],p[1][0],p[1][1],p[2][0],p[2][1],p[3][0],p[3][1]]:[0,0,0,0,0,0,0,0]}function nAe(p,n,o){return{angleConfidence:lt(Ga,this,iAe).call(this,p),areaConfidence:lt(Ga,this,rAe).call(this,p,n,o),centerConfidence:lt(Ga,this,oAe).call(this,p,n,o)}}function iAe(p){let n=0;const o=lt(Ga,this,A2).call(this,[p[0],p[1]],[p[2],p[3]],[p[4],p[5]]),h=lt(Ga,this,A2).call(this,[p[2],p[3]],[p[4],p[5]],[p[6],p[7]]),v=lt(Ga,this,A2).call(this,[p[4],p[5]],[p[6],p[7]],[p[0],p[1]]),y=lt(Ga,this,A2).call(this,[p[6],p[7]],[p[0],p[1]],[p[2],p[3]]);return n+=Math.abs(o-90),n+=Math.abs(h-90),n+=Math.abs(v-90),n+=Math.abs(y-90),Math.max(0,100*Math.min(1,1-.025*n))}function rAe(p,n,o){const h=lt(Ga,this,sAe).call(this,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7]);return Math.min(100,400*Math.max(0,h/(n*o)))}function oAe(p,n,o){const h=[(p[0]+p[2]+p[4]+p[6])/4,(p[1]+p[3]+p[5]+p[7])/4],v=lt(Ga,this,D2).call(this,h,[n/2,o/2]);return Math.max(0,100*Math.min(1,1-v/Math.min(n,o)))}function D2(p,n){return Math.sqrt((n[0]-p[0])*(n[0]-p[0])+(n[1]-p[1])*(n[1]-p[1]))}function A2(p,n,o){const h=lt(Ga,this,D2).call(this,n,p),v=lt(Ga,this,D2).call(this,n,o),y=lt(Ga,this,D2).call(this,p,o);return 0===h||0===v?0:Math.acos((h*h+v*v-y*y)/(2*h*v))/Math.PI*180}function XZ(p,n,o,h,v,y){return(p*h+n*v+o*y-v*h-y*p-o*n)/2}function sAe(p,n,o,h,v,y,_,b){return lt(Ga,this,XZ).call(this,p,n,o,h,v,y)+lt(Ga,this,XZ).call(this,p,n,v,y,_,b)}!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert",p.BRIGHTNESS="brightness",p.CONTRAST="contrast",p.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast"}(Xs||(Xs={}));var qv=new WeakMap,P2=new WeakMap,R2=new WeakSet;function aAe(p,n,o,h){return U5.apply(this,arguments)}function U5(){return U5=Fe(function*(p,n,o,h){var v;return yield null===(v=this.filter)||void 0===v?void 0:v.applyFilter(p,n)}),U5.apply(this,arguments)}function lAe(p){return Xe(qv,this).push(p),Xe(P2,this)||(Wn(P2,this,!0),lt(R2,this,cAe).call(this)),p.promise}function cAe(){return V5.apply(this,arguments)}function V5(){return V5=Fe(function*(){do{if(Xe(qv,this).isEmpty())break;const p=Xe(qv,this).pop();try{let n;"filter"===(null==p?void 0:p.api)&&(n=yield lt(R2,this,aAe).apply(this,p.params)),null==p||p.resolve(n)}catch(n){p.retry<1?(p.retry+=1,Xe(qv,this).push(p)):null==p||p.reject(n)}}while(!Xe(qv,this).isEmpty());Wn(P2,this,!1)}),V5.apply(this,arguments)}const $Z=new Map([[Xs.NONE,"None"],[Xs.BLACK_AND_WHITE,"toBW"],[Xs.GRAY,"toGray"],[Xs.REMOVE_SHADOW,"removeShadow"],[Xs.SAVE_INK,"toBW"],[Xs.ENHANCE,"enhance"],[Xs.INVERT,"invert"],[Xs.CONTRAST,"brightnessAndContrast"],[Xs.BRIGHTNESS,"brightnessAndContrast"],[Xs.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var ys,j5=new WeakSet;function uAe(p,n){const o=Ke({},n||{});return p===Xs.SAVE_INK&&(o.method="adaptiveThreshold"),o}function dAe(p){var n,o;return p.returnType=Kx[p.outputType],p.bRGBA=p.outputType===Er.RGBA,p.returnBlob=null!==(n=p.returnBlob)&&void 0!==n&&n,p.returnType=p.bRGBA&&void 0===p.returnType?Va.IT_JPG:null!==(o=p.returnType)&&void 0!==o?o:Va.IT_ALL,p.is1BitTo8Bit=vn.isApple,p}class rt{static replaceMessage(n,o,h){let v=n;return o&&(v=v.replace("<%api%>",o)),h&&(v=v.replace("<%param%>",h)),v}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null}static buildError(n,o,h){if(n&&!n.code&&n.cause&&n.cause.code&&n.cause.message)return Sn(n.message)&&(n.message=this.replaceMessage(n.message,o,h)),n;const v={code:n.code,message:n.message};null!=n&&n.details&&(v.details=n.details);let y=Ke({},n);return v.code>-8e4&&0!==v.code?v.code<=-2e4||(v.code=rt.WASM_ERR.code,v.message=rt.WASM_ERR.message,y.actualCode=y.code,y.code=v.code):v.code?(v.message=this.replaceMessage(v.message,o,h),y=Ke({},v),Array.isArray(v.details)&&0!==v.details.length&&(y.details=v.details)):(v.code=rt.EXTERNAL_ERR.code,v.message=rt.EXTERNAL_ERR.message,y.actualCode=n.code,y.message=n.message,n.name&&(y.name=n.name),n.stack&&(y.stack=n.stack),y.code=v.code,y.actualError=n),new Error(v.message,{cause:y})}static warning(n,o,h){const v=rt.buildError(n,o,h);this.lastError=v,this.onWarning.emit(v)}static error(n,o,h){const v=rt.buildError(n,o,h);throw this.lastError=v,this.onError.emit(v),v}static verbose(n,o,h){this.onVerbose.emit(n)}static throw(n,o,h){const v=rt.buildError(n,o,h);throw this.lastError=v,this.onError.emit(v),v}static reject(n,o,h){const v=rt.buildError(n,o,h);return this.lastError=v,this.onError.emit(v),Promise.reject(v)}static on(n,o){"error"===n?this.onError.on(o):"verbose"===n?(this.onVerbose.on(o),0===this.verboseListenerCount&&(vn.enableDebugOutput(!0,h=>{this.verbose(h)}),this.verboseListenerCount+=1)):"warning"===n&&this.onWarning.on(o)}static off(n,o){"error"===n?this.onError.off(o):"verbose"===n?(this.onVerbose.off(o),this.verboseListenerCount-=1,0===this.verboseListenerCount&&vn.enableDebugOutput(!1,void 0)):"warning"===n&&this.onWarning.off(o)}}function bn(p,n,o,h){return n?o?`${n}${h?"":"."}${o}`:`${n}`:o?`${p}${h?"":"."}${o}`:`${p}`}W(rt,"onError",new Lo),W(rt,"onWarning",new Lo),W(rt,"onVerbose",new Lo),W(rt,"verboseListenerCount",0),W(rt,"lastError",void 0),W(rt,"LIC_EMPTY",{code:-8e4,message:"No license."}),W(rt,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),W(rt,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),W(rt,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),W(rt,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),W(rt,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),W(rt,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),W(rt,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),W(rt,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),W(rt,"WASM_ERR",{code:-81e3,message:"WASM Error"}),W(rt,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),W(rt,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),W(rt,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),W(rt,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),W(rt,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),W(rt,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),W(rt,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),W(rt,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),W(rt,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),W(rt,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),W(rt,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),W(rt,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),W(rt,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),W(rt,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),W(rt,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),W(rt,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),W(rt,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),W(rt,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),W(rt,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),W(rt,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),W(rt,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),W(rt,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),W(rt,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),W(rt,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),W(rt,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),W(rt,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),W(rt,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),W(rt,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),W(rt,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),W(rt,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),W(rt,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),W(rt,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),W(rt,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),W(rt,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),W(rt,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),W(rt,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),W(rt,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),W(rt,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class mt{static makeSureValid(n,o,h,v){const y=this.composeError(h,v);rt.throw(y,n,o)}static output(n,o,h,v,y){let _=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=this.composeError(v,y);return 2===n?rt.reject(b,o,h):1===n?(rt.warning(b,o,h),_):0===n?rt.error(b,o,h):3===n?rt.verbose(b,o,h):void 0}static error(n,o,h,v){const y=this.composeError(h,v);rt.throw(y,n,o)}static warning(n,o,h,v){let y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const _=this.composeError(h,v);return rt.warning(_,n,o),y}static verbose(n,o,h,v){const y=this.composeError(h,v);rt.verbose(y,n,o)}static reject(n,o,h,v){const y=this.composeError(h,v);return rt.reject(y,n,o)}static composeError(n,o){const h=Ke({},gt(o)?rt.PARAM_INVALID:o);return n&&(h.details=n),h}static formatDetails(n,o){const h=[];if(As(o))o||h.push(`'${n}' is invalid.`);else{const{isValid:v,isInRange:y,isSupported:_}=o;!1===v&&h.push(`'${n}' is invalid.`),!1===y&&h.push(`'${n}' is out of range.`),!1===_&&h.push(`'${n}' is not supported.`)}return h}static formatError(n,o){const{isValid:h,isInRange:v,isSupported:y}=n;if(!1===h||!1===v||!1===y){if(o)return o;if(!h)return rt.PARAM_INVALID;if(!v)return rt.PARAM_OUT_OF_RANGE;if(!y)return rt.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(n){return YE(n)||pl(n)}static isArrayAndMeetMinLength(n,o){return Di(n)?$t(o)?{isValid:0!==n.length,isInRange:n.length>=o}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(n,o,h){return $t(n)?{isValid:!0,isInRange:!(!gt(o)&&n<o||!gt(h)&&n>h)}:{isValid:!1}}static isStringAndNotEmpty(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Sn(n)?o?{isValid:!0}:{isValid:0!==n.trim().length}:{isValid:!1}}static isPdfDate(n){if(!Sn(n))return{isValid:!1};const o=n.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let h=!1;if(o){const[,v,y,_,b,w,I,A,M,F]=o,V=new Date(`${v}-${y}-${_}T${b}:${w}:${I}`);if(h=!0,V.getFullYear()===parseInt(v,10)&&V.getMonth()+1===parseInt(y,10)&&V.getDate()===parseInt(_,10)&&V.getHours()===parseInt(b,10)&&V.getMinutes()===parseInt(w,10)&&V.getSeconds()===parseInt(I,10)||(h=!1),h&&A){const B=parseInt(M,10),Q=parseInt(F,10);(B<0||B>12||Q<0||Q>59||"+"!==A&&"-"!==A)&&(h=!1)}}return{isSupported:h}}}!function(p){p[p.BlackAndWhite=1]="BlackAndWhite",p[p.Gray=2]="Gray",p[p.RemoveShadow=3]="RemoveShadow",p[p.Enhance=4]="Enhance",p[p.Invert=5]="Invert",p[p.Brightness=6]="Brightness",p[p.Contrast=7]="Contrast",p[p.BrightnessAndContrast=8]="BrightnessAndContrast",p[p.Perspective=9]="Perspective",p[p.Deskew=10]="Deskew",p[p.Rotate=11]="Rotate",p[p.Flip=12]="Flip",p[p.Resize=13]="Resize",p[p.SetHeight=14]="SetHeight",p[p.SetWidth=15]="SetWidth",p[p.SetDPI=16]="SetDPI",p[p.Crop=17]="Crop",p[p.Erase=18]="Erase",p[p.DrawPolygon=19]="DrawPolygon"}(ys||(ys={}));var H5=new WeakSet;class hAe{constructor(){dl(this,H5)}process(n,o,h){var v=this;return Fe(function*(){Di(o)||(o=[o]),lt(H5,v,fAe).call(v,o);const y=new Kg,_={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var b,w,I,A;const M=yield y.initImage({source:n.data,isRGBA:n.type===Er.RGBA,width:n.width,height:n.height,isBGRA:n.type===Er.BGRA});M.srcBuffer&&(n.data=M.srcBuffer);for(const V of o)lt(H5,v,pAe).call(v,y,V);const F=yield y.getImage({jpegQuality:null==h||null===(b=h.params)||void 0===b?void 0:b.jpegQuality,ifDeleteObject:!0,isRGBA:n.type===Er.RGBA,bitDepth:null==h||null===(w=h.params)||void 0===w?void 0:w.bitDepth,xDpi:null==h||null===(I=h.params)||void 0===I?void 0:I.xDpi,yDpi:null==h||null===(A=h.params)||void 0===A?void 0:A.yDpi,returnBlob:!1,returnType:Kx[null==h?void 0:h.type]});yield y.freeReservedData(),_.output=F.imageData,_.outputContentType=F.blobType,_.outputImageInfo={width:F.imageWidth,height:F.imageHeight,bitDepth:F.imageBitDepth,resolutionX:F.imageXResolution,resolutionY:F.imageYResolution},_.outputType=VEe[F.imageType]}finally{try{yield y.terminate()}catch(M){rt.warning(M)}}return _})()}}function fAe(p){for(const n of p);}function pAe(p,n){return G5.apply(this,arguments)}function G5(){return G5=Fe(function*(p,n){var o;const h=null!==(o=n.params)&&void 0!==o?o:{};switch(n.type){case ys.BlackAndWhite:return p.toBinaryLevel(h.saveInk,h.level);case ys.Gray:return p.toGrayscale(h.level);case ys.RemoveShadow:return p.removeShadowLevel(h.level,h.alpha);case ys.Enhance:return p.brighten();case ys.Invert:return p.invert();case ys.Contrast:return p.changeBrightnessAndContrast(void 0,h.contrast);case ys.Brightness:return p.changeBrightnessAndContrast(h.brightness,void 0);case ys.BrightnessAndContrast:return p.changeBrightnessAndContrast(h.brightness,h.contrast);case ys.Perspective:return p.perspective(h.location);case ys.Deskew:{var v;const y=yield p.getSkewAngle(h.options);return p.rotate({angle:y,fillColor:h.fillColor,keepSize:null===(v=h.keepSize)||void 0===v||v,mode:h.mode})}case ys.Rotate:return p.rotate({angle:h.angle,fillColor:h.fillColor,keepSize:h.keepSize,mode:h.mode});case ys.Flip:return p.flip();case ys.Resize:{const{newWidth:y,newHeight:_,mode:b}=h;return p.resize(y,_,b)}case ys.SetHeight:{const{newHeight:y,fillColor:_}=h;return p.setImageHeight(y,_)}case ys.SetWidth:{const{newWidth:y,fillColor:_}=h;return p.setImageWidth(y,_)}case ys.SetDPI:return p.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:h.xRes,resolutionY:h.yRes,resample:!1});case ys.Crop:return p.crop({left:h.left,top:h.top,width:h.right-h.left,height:h.bottom-h.top});case ys.Erase:return p.erase({left:h.left,top:h.top,width:h.right-h.left,height:h.bottom-h.top},h.fillColor);case ys.DrawPolygon:return p.drawQuadrangle({location:h.location,strokeColor:h.strokeColor,lineWidth:h.lineWidth})}}),G5.apply(this,arguments)}!Mv&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!Mv&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const qZ=function(){var p=Fe(function*(n,o,h){if(!n._bNeverShowDialog)try{let v=yield fetch(n.engineResourcePath+"dls.license.dialog.html");if(!v.ok)throw Error("Get license dialog fail. Network Error: "+v.statusText);let y=yield v.text();if(!y.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let _=document.createElement("div");_.innerHTML=y;let b=[];for(let J=0;J<_.childElementCount;++J){let Z=_.children[J];Z instanceof HTMLStyleElement&&(b.push(Z),document.head.append(Z))}let w=1==_.childElementCount?_.children[0]:_;w.remove();let I,A,M,F,V,B=[w],Q=w.children;for(let J of Q)B.push(J);for(let J=0;J<B.length;++J)for(let Z of B[J].children)B.push(Z);for(let J of B)if(!I&&J.classList.contains("dls-license-mask"))I=J,J.addEventListener("click",Z=>{if(J==Z.target){w.remove();for(let re of b)re.remove()}});else if(!A&&J.classList.contains("dls-license-icon-close"))A=J,J.addEventListener("click",()=>{w.remove();for(let Z of b)Z.remove()});else if(!M&&J.classList.contains("dls-license-icon-error"))M=J,"error"!=o&&J.remove();else if(!F&&J.classList.contains("dls-license-icon-warn"))F=J,"warn"!=o&&J.remove();else if(!V&&J.classList.contains("dls-license-msg-content")){V=J;let Z=h;for(;Z;){let re=Z.indexOf("["),se=Z.indexOf("]",re),ce=Z.indexOf("(",se),pe=Z.indexOf(")",ce);if(-1==re||-1==se||-1==ce||-1==pe){J.appendChild(new Text(Z));break}re>0&&J.appendChild(new Text(Z.substring(0,re)));let Ce=document.createElement("a"),Ve=Z.substring(re+1,se);Ce.innerText=Ve;let te=Z.substring(ce+1,pe);Ce.setAttribute("href",te),Ce.setAttribute("target","_blank"),J.appendChild(Ce),Z=Z.substring(pe+1)}}document.body.appendChild(w)}catch(v){n._onLog&&n._onLog(v.message||v)}});return function(o,h,v){return p.apply(this,arguments)}}();var z_=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(p){return}}();function KZ(p,n){p=p||[],n=n||{};try{return new Blob(p,n)}catch(v){if("TypeError"!==v.name)throw v;for(var o=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),h=0;h<p.length;h+=1)o.append(p[h]);return o.getBlob(n.type)}}function Gl(p,n){n&&p.then(function(o){n(null,o)},function(o){n(o)})}function pw(p,n,o){"function"==typeof n&&p.then(n),"function"==typeof o&&p.catch(o)}function Y_(p){return"string"!=typeof p&&(p=String(p)),p}function JZ(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const z5="local-forage-detect-blob-support";let k2;const Zu={},mAe=Object.prototype.toString,Y5="readonly",M2="readwrite";function O2(p){var n=Zu[p.name],o={};o.promise=new Promise(function(h,v){o.resolve=h,o.reject=v}),n.deferredOperations.push(o),n.dbReady=n.dbReady?n.dbReady.then(function(){return o.promise}):o.promise}function X5(p){var n=Zu[p.name].deferredOperations.pop();if(n)return n.resolve(),n.promise}function $5(p,n){var o=Zu[p.name].deferredOperations.pop();if(o)return o.reject(n),o.promise}function QZ(p,n){return new Promise(function(o,h){if(Zu[p.name]=Zu[p.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},p.db){if(!n)return o(p.db);O2(p),p.db.close()}var v=[p.name];n&&v.push(p.version);var y=z_.open.apply(z_,v);n&&(y.onupgradeneeded=function(_){var b=y.result;try{b.createObjectStore(p.storeName),_.oldVersion<=1&&b.createObjectStore(z5)}catch(w){if("ConstraintError"!==w.name)throw w}}),y.onerror=function(_){_.preventDefault(),h(y.error)},y.onsuccess=function(){var _=y.result;_.onversionchange=function(b){b.target.close()},o(_),X5(p)}})}function q5(p){return QZ(p,!1)}function K5(p){return QZ(p,!0)}function ZZ(p,n){if(!p.db)return!0;var o=!p.db.objectStoreNames.contains(p.storeName),v=p.version>p.db.version;if(p.version<p.db.version&&(p.version=p.db.version),v||o){if(o){var y=p.db.version+1;y>p.version&&(p.version=y)}return!0}return!1}function _Ae(p){var n=this,o=n._initReady().then(function(){var h=Zu[n._dbInfo.name];if(h&&h.dbReady)return h.dbReady});return pw(o,p,p),o}function Kv(p,n,o,h){void 0===h&&(h=1);try{var v=p.db.transaction(p.storeName,n);o(null,v)}catch(y){if(h>0&&(!p.db||"InvalidStateError"===y.name||"NotFoundError"===y.name))return Promise.resolve().then(()=>{if(!p.db||"NotFoundError"===y.name&&!p.db.objectStoreNames.contains(p.storeName)&&p.version<=p.db.version)return p.db&&(p.version=p.db.version+1),K5(p)}).then(()=>function(_){O2(_);for(var b=Zu[_.name],w=b.forages,I=0;I<w.length;I++){const A=w[I];A._dbInfo.db&&(A._dbInfo.db.close(),A._dbInfo.db=null)}return _.db=null,q5(_).then(A=>(_.db=A,ZZ(_)?K5(_):A)).then(A=>{_.db=b.db=A;for(var M=0;M<w.length;M++)w[M]._dbInfo.db=A}).catch(A=>{throw $5(_,A),A})}(p).then(function(){Kv(p,n,o,h-1)})).catch(o);o(y)}}var CAe={_driver:"asyncStorage",_initStorage:function(p){var n=this,o={db:null};if(p)for(var h in p)o[h]=p[h];var v=Zu[o.name];v||(Zu[o.name]=v={forages:[],db:null,dbReady:null,deferredOperations:[]}),v.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=_Ae);var y=[];function _(){return Promise.resolve()}for(var b=0;b<v.forages.length;b++){var w=v.forages[b];w!==n&&y.push(w._initReady().catch(_))}var I=v.forages.slice(0);return Promise.all(y).then(function(){return o.db=v.db,q5(o)}).then(function(A){return o.db=A,ZZ(o)?K5(o):A}).then(function(A){o.db=v.db=A,n._dbInfo=o;for(var M=0;M<I.length;M++){var F=I[M];F!==n&&(F._dbInfo.db=o.db,F._dbInfo.version=o.version)}})},_support:function(){try{if(!z_||!z_.open)return!1;var p="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!p||n)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(o){return!1}}(),getItem:function(p,n){var o=this;p=Y_(p);var h=new Promise(function(v,y){o.ready().then(function(){Kv(o._dbInfo,Y5,function(_,b){if(_)return y(_);try{var w=b.objectStore(o._dbInfo.storeName).get(p);w.onsuccess=function(){var A,I=w.result;void 0===I&&(I=null),(A=I)&&A.__local_forage_encoded_blob&&(I=function yAe(p){return KZ([function(o){for(var h=o.length,v=new ArrayBuffer(h),y=new Uint8Array(v),_=0;_<h;_++)y[_]=o.charCodeAt(_);return v}(atob(p.data))],{type:p.type})}(I)),v(I)},w.onerror=function(){y(w.error)}}catch(I){y(I)}})}).catch(y)});return Gl(h,n),h},setItem:function(p,n,o){var h=this;p=Y_(p);var v=new Promise(function(y,_){var b;h.ready().then(function(){return b=h._dbInfo,"[object Blob]"===mAe.call(n)?function vAe(p){return"boolean"==typeof k2?Promise.resolve(k2):(n=p,new Promise(function(o){var h=n.transaction(z5,M2),v=KZ([""]);h.objectStore(z5).put(v,"key"),h.onabort=function(y){y.preventDefault(),y.stopPropagation(),o(!1)},h.oncomplete=function(){var y=navigator.userAgent.match(/Chrome\/(\d+)/),_=navigator.userAgent.match(/Edge\//);o(_||!y||parseInt(y[1],10)>=43)}}).catch(function(){return!1})).then(function(n){return k2=n,k2});var n}(b.db).then(function(w){return w?n:(I=n,new Promise(function(A,M){var F=new FileReader;F.onerror=M,F.onloadend=function(V){var B=btoa(V.target.result||"");A({__local_forage_encoded_blob:!0,data:B,type:I.type})},F.readAsBinaryString(I)}));var I}):n}).then(function(w){Kv(h._dbInfo,M2,function(I,A){if(I)return _(I);try{var M=A.objectStore(h._dbInfo.storeName);null===w&&(w=void 0);var F=M.put(w,p);A.oncomplete=function(){void 0===w&&(w=null),y(w)},A.onabort=A.onerror=function(){_(F.error?F.error:F.transaction.error)}}catch(V){_(V)}})}).catch(_)});return Gl(v,o),v},removeItem:function(p,n){var o=this;p=Y_(p);var h=new Promise(function(v,y){o.ready().then(function(){Kv(o._dbInfo,M2,function(_,b){if(_)return y(_);try{var w=b.objectStore(o._dbInfo.storeName).delete(p);b.oncomplete=function(){v()},b.onerror=function(){y(w.error)},b.onabort=function(){y(w.error?w.error:w.transaction.error)}}catch(I){y(I)}})}).catch(y)});return Gl(h,n),h},clear:function(p){var n=this,o=new Promise(function(h,v){n.ready().then(function(){Kv(n._dbInfo,M2,function(y,_){if(y)return v(y);try{var b=_.objectStore(n._dbInfo.storeName).clear();_.oncomplete=function(){h()},_.onabort=_.onerror=function(){v(b.error?b.error:b.transaction.error)}}catch(w){v(w)}})}).catch(v)});return Gl(o,p),o},length:function(p){var n=this,o=new Promise(function(h,v){n.ready().then(function(){Kv(n._dbInfo,Y5,function(y,_){if(y)return v(y);try{var b=_.objectStore(n._dbInfo.storeName).count();b.onsuccess=function(){h(b.result)},b.onerror=function(){v(b.error)}}catch(w){v(w)}})}).catch(v)});return Gl(o,p),o},keys:function(p){var n=this,o=new Promise(function(h,v){n.ready().then(function(){Kv(n._dbInfo,Y5,function(y,_){if(y)return v(y);try{var b=_.objectStore(n._dbInfo.storeName).openKeyCursor(),w=[];b.onsuccess=function(){var I=b.result;I?(w.push(I.key),I.continue()):h(w)},b.onerror=function(){v(b.error)}}catch(I){v(I)}})}).catch(v)});return Gl(o,p),o},dropInstance:function(p,n){n=JZ.apply(this,arguments);var o,h=this.config();if((p="function"!=typeof p&&p||{}).name||(p.name=p.name||h.name,p.storeName=p.storeName||h.storeName),p.name){o=(p.name===h.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):q5(p).then(y=>{const _=Zu[p.name],b=_.forages;_.db=y;for(var w=0;w<b.length;w++)b[w]._dbInfo.db=y;return y})).then(p.storeName?y=>{if(!y.objectStoreNames.contains(p.storeName))return;const _=y.version+1;O2(p);const b=Zu[p.name],w=b.forages;y.close();for(let A=0;A<w.length;A++){const M=w[A];M._dbInfo.db=null,M._dbInfo.version=_}return new Promise((A,M)=>{const F=z_.open(p.name,_);F.onerror=V=>{F.result.close(),M(V)},F.onupgradeneeded=()=>{F.result.deleteObjectStore(p.storeName)},F.onsuccess=()=>{const V=F.result;V.close(),A(V)}}).then(A=>{b.db=A;for(let M=0;M<w.length;M++){const F=w[M];F._dbInfo.db=A,X5(F._dbInfo)}}).catch(A=>{throw($5(p,A)||Promise.resolve()).catch(()=>{}),A})}:y=>{O2(p);const _=Zu[p.name],b=_.forages;y.close();for(var w=0;w<b.length;w++)b[w]._dbInfo.db=null;return new Promise((A,M)=>{var F=z_.deleteDatabase(p.name);F.onerror=()=>{const V=F.result;V&&V.close(),M(F.error)},F.onblocked=()=>{},F.onsuccess=()=>{const V=F.result;V&&V.close(),A(V)}}).then(A=>{_.db=A;for(var M=0;M<b.length;M++)X5(b[M]._dbInfo)}).catch(A=>{throw($5(p,A)||Promise.resolve()).catch(()=>{}),A})})}else o=Promise.reject("Invalid arguments");return Gl(o,n),o}};const ef=new Map;function eee(p,n){let o=p.name+"/";return p.storeName!==n.storeName&&(o+=p.storeName+"/"),o}var bAe={_driver:"tempStorageWrapper",_initStorage:function(){var p=Fe(function*(n){const o={};if(n)for(let v in n)o[v]=n[v];const h=o.keyPrefix=eee(n,this._defaultConfig);this._dbInfo=o,ef.has(h)||ef.set(h,new Map)});return function(o){return p.apply(this,arguments)}}(),getItem:function(p,n){p=Y_(p);const o=this.ready().then(()=>ef.get(this._dbInfo.keyPrefix).get(p));return Gl(o,n),o},setItem:function(p,n,o){p=Y_(p);const h=this.ready().then(()=>(void 0===n&&(n=null),ef.get(this._dbInfo.keyPrefix).set(p,n),n));return Gl(h,o),h},removeItem:function(p,n){p=Y_(p);const o=this.ready().then(()=>{ef.get(this._dbInfo.keyPrefix).delete(p)});return Gl(o,n),o},clear:function(p){const n=this.ready().then(()=>{const o=this._dbInfo.keyPrefix;ef.has(o)&&ef.delete(o)});return Gl(n,p),n},length:function(p){const n=this.ready().then(()=>ef.get(this._dbInfo.keyPrefix).size);return Gl(n,p),n},keys:function(p){const n=this.ready().then(()=>[...ef.get(this._dbInfo.keyPrefix).keys()]);return Gl(n,p),n},dropInstance:function(p,n){if(n=JZ.apply(this,arguments),!(p="function"!=typeof p&&p||{}).name){const h=this.config();p.name=p.name||h.name,p.storeName=p.storeName||h.storeName}let o;return o=p.name?new Promise(h=>{h(p.storeName?eee(p,this._defaultConfig):`${p.name}/`)}).then(h=>{ef.delete(h)}):Promise.reject("Invalid arguments"),Gl(o,n),o}};const xAe=(p,n)=>p===n||"number"==typeof p&&"number"==typeof n&&isNaN(p)&&isNaN(n),wAe=(p,n)=>{const o=p.length;let h=0;for(;h<o;){if(xAe(p[h],n))return!0;h++}return!1},tee=Array.isArray||function(p){return"[object Array]"===Object.prototype.toString.call(p)},gw={},nee={},mw={INDEXEDDB:CAe,TEMPSTORAGE:bAe},SAe=[mw.INDEXEDDB._driver,mw.TEMPSTORAGE._driver],F2=["dropInstance"],J5=["clear","getItem","keys","length","removeItem","setItem"].concat(F2),TAe={description:"",driver:SAe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function IAe(p,n){p[n]=function(){const o=arguments;return p.ready().then(function(){return p[n].apply(p,o)})}}function Q5(){for(let p=1;p<arguments.length;p++){const n=arguments[p];if(n)for(let o in n)n.hasOwnProperty(o)&&(arguments[0][o]=tee(n[o])?n[o].slice():n[o])}return arguments[0]}class Z5{constructor(n){for(let o in mw)if(mw.hasOwnProperty(o)){const h=mw[o],v=h._driver;this[o]=v,gw[v]||this.defineDriver(h)}this._defaultConfig=Q5({},TAe),this._config=Q5({},this._defaultConfig,n),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(()=>{})}config(n){if("object"==typeof n){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let o in n){if("storeName"===o&&(n[o]=n[o].replace(/\W/g,"_")),"version"===o&&"number"!=typeof n[o])return new Error("Database version must be a number.");this._config[o]=n[o]}return!("driver"in n)||!n.driver||this.setDriver(this._config.driver)}return"string"==typeof n?this._config[n]:this._config}defineDriver(n,o,h){const v=new Promise(function(y,_){try{const b=n._driver,w=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!n._driver)return void _(w);const I=J5.concat("_initStorage");for(let F=0,V=I.length;F<V;F++){const B=I[F];if((!wAe(F2,B)||n[B])&&"function"!=typeof n[B])return void _(w)}!function(){const F=function(V){return function(){const B=new Error(`Method ${V} is not implemented by the current driver`),Q=Promise.reject(B);return Gl(Q,arguments[arguments.length-1]),Q}};for(let V=0,B=F2.length;V<B;V++){const Q=F2[V];n[Q]||(n[Q]=F(Q))}}();const M=function(F){gw[b]=n,nee[b]=F,y()};"_support"in n?n._support&&"function"==typeof n._support?n._support().then(M,_):M(!!n._support):M(!0)}catch(b){_(b)}});return pw(v,o,h),v}driver(){return this._driver||null}getDriver(n,o,h){const v=gw[n]?Promise.resolve(gw[n]):Promise.reject(new Error("Driver not found."));return pw(v,o,h),v}ready(n){const o=this,h=o._driverSet.then(()=>(null===o._ready&&(o._ready=o._initDriver()),o._ready));return pw(h,n,n),h}setDriver(n,o,h){const v=this;tee(n)||(n=[n]);const y=this._getSupportedDrivers(n);function _(){v._config.driver=v.driver()}function b(I){return v._extend(I),_(),v._ready=v._initStorage(v._config),v._ready}const w=null!==this._driverSet?this._driverSet.catch(()=>Promise.resolve()):Promise.resolve();return this._driverSet=w.then(()=>{const I=y[0];return v._dbInfo=null,v._ready=null,v.getDriver(I).then(A=>{var M;v._driver=A._driver,_(),v._wrapLibraryMethodsWithReady(),v._initDriver=(M=y,function(){let F=0;return function V(){for(;F<M.length;){let Q=M[F];return F++,v._dbInfo=null,v._ready=null,v.getDriver(Q).then(b).catch(V)}_();const B=new Error("No available storage method found.");return v._driverSet=Promise.reject(B),v._driverSet}()})})}).catch(()=>{_();const I=new Error("No available storage method found.");return v._driverSet=Promise.reject(I),v._driverSet}),pw(this._driverSet,o,h),this._driverSet}supports(n){return!!nee[n]}_extend(n){Q5(this,n)}_getSupportedDrivers(n){const o=[];for(let h=0,v=n.length;h<v;h++){const y=n[h];this.supports(y)&&o.push(y)}return o}_wrapLibraryMethodsWithReady(){for(let n=0,o=J5.length;n<o;n++)IAe(this,J5[n])}createInstance(n){return new Z5(n)}}var EAe=new Z5;Date.prototype.kUtilFormat=function(p){const n={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(p)&&(p=p.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let o in n)new RegExp("("+o+")").test(p)&&(p=p.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("000"+n[o]).substr(("000"+n[o]).length-RegExp.$1.length)));return p},String.prototype.startsWith||(String.prototype.startsWith=function(p){return 0==this.indexOf(p)});let DAe=p=>{let n,o,h,v,y,_,b,w,I,A,M,F,V,B,Q,J,Z,re,se,ce,pe,Ce,Ve=p.fetch||Ov.fetch,te=p.btoa||Ov.btoa,Me=p.atob||Ov.atob,we=p.bd,Le=p.dm,j=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],L=!1,Y=Promise.resolve(),q=p.lf,k=p.log&&function(){try{for(var dt=arguments.length,Je=new Array(dt),it=0;it<dt;it++)Je[it]=arguments[it];p.log.apply(null,Je)}catch(ct){setTimeout(()=>{throw ct},0)}}||(()=>{}),N=we&&k||(()=>{}),$=p.fol,ie=p.sutlcb,ee=p.feab,ne=dt=>Me(Me(dt.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),le=dt=>te(String.fromCharCode(97+25*Math.random())+te(dt)).replace(/\+/g,"\n").replace(/=/g," "),fe=()=>{if(Ce)return Ce;if(Ov.crypto){let dt=new Uint8Array(36);Ov.crypto.getRandomValues(dt);let Je="";for(let it=0;it<36;++it){let ct=dt[it]%36;Je+=ct<10?ct:String.fromCharCode(ct+87)}return Je}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(dt){var Je=16*Math.random()|0;return("x"==dt?Je:3&Je|8).toString(16)})};const xe=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let Pe,De,je,ke,Ae={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+xe,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+xe,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},he=function(){var dt=Fe(function*(){return Pe=Pe||Fe(function*(){if(yield Fe(function*(){q||(q=EAe)})(),yield(yield q.createInstance({name:"dynamjssdkhello"})).setItem("dynamjssdkhello","available"),J=yield q.createInstance({name:"dynamdlsinfo"}),Z=Ce?null:te(te("v2")+String.fromCharCode(Le.charCodeAt(Le.length/2)+1)+te(Le)),!Ce){try{var Je,it;let ct=yield J.getItem(Z);!ct&&null!==(Je=yield null===(it=self.indexedDB)||void 0===it?void 0:it.databases())&&void 0!==Je&&Je.some(wt=>"dynamltsinfo"===(null==wt?void 0:wt.name))&&(ct=yield(yield q.createInstance({name:"dynamltsinfo"})).getItem(Z),ct&&(yield J.setItem(Z,ct))),ct&&([b,V]=JSON.parse(yield ne(ct)))}catch(ct){}try{null==b&&(b=fe(),J.setItem(Z,yield le(JSON.stringify([b,null]))))}catch(ct){}}})(),Pe});return function(){return dt.apply(this,arguments)}}(),tt=function(){var dt=Fe(function*(Je){je=Date.now(),De||(De=Fe(function*(){try{let it={pd:n,vm:h,v:o,dt:_||"browser",ed:"javascript",cu:b,ad:Le,os:w,fn:I};F&&(it.rmk=F),v&&(-1!=v.indexOf("-")?it.hs=v:it.og=v);let ct={};if(V&&!Ce){let ht=yield J.getItem(Z);ht&&([b,V]=JSON.parse(yield ne(ht))),ct["lts-time"]=V}M&&(it.sp=M),y=yield Promise.race([Fe(function*(){let ht,At=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");V&&!Ce&&(J.setItem(Z,yield le(JSON.stringify([b,At]))),V=At);let kt,Bt="auth/?ext="+encodeURIComponent(te(JSON.stringify(it))),Ft=!1,Ht=!1,Kt=function(){var fn=Fe(function*(ln){if(ln&&!ln.ok)try{let wn=yield ln.text();if(wn){let ut=JSON.parse(wn);ut.errorCode&&(kt=ut,ut.errorCode>100&&ut.errorCode<200&&(y=null,Ft=!0,Ht=!0))}}catch(wn){}});return function(wn){return fn.apply(this,arguments)}}();try{ht=yield Ve(j[0]+Bt,{headers:ct,cache:Je?"reload":"default",mode:"cors",timeout:1e4}),yield Kt(ht)}catch(fn){}if(!(y||ht&&ht.ok||Ft))try{ht=yield Ve(j[1]+Bt,{headers:ct,mode:"cors",timeout:3e4})}catch(fn){}if(!(y||ht&&ht.ok||Ft))try{ht=yield Ve(j[0]+Bt,{headers:ct,mode:"cors",timeout:3e4}),yield Kt(ht)}catch(fn){}kt&&151==kt.errorCode&&!Ce&&(J.removeItem(Z),J.removeItem(re),b=fe(),it.cu=b,V=void 0,Bt="auth/?ext="+encodeURIComponent(te(JSON.stringify(it))),ht=yield Ve(j[0]+Bt,{headers:ct,mode:"cors",timeout:3e4}),yield Kt(ht)),(()=>{if(!ht||!ht.ok){let fn;Ht&&J.setItem(re,""),kt?111==kt.errorCode?fn=kt.message:(fn=kt.message.trim(),fn.endsWith(".")||(fn+="."),fn=A?`An error occurred during authorization: ${fn} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${fn} Contact the site administrator for more information.`):fn=A?Ae.publicTrialFailConnect:Ae.failConnect;let ln=Error(fn);throw kt&&kt.errorCode&&(ln.ltsErrorCode=kt.errorCode),ln}})();let an=yield ht.text();try{V||Ce||(J.setItem(Z,yield le(JSON.stringify([b,At]))),V=At),J.setItem(re,an)}catch(fn){}return an})(),new Promise((ht,At)=>{let kt;kt=A?Ae.publicTrialNetworkTimeout:Ae.networkTimeout,setTimeout(()=>At(new Error(kt)),y?3e3:15e3)})])}catch(it){B=it}De=null})()),yield De});return function(it){return dt.apply(this,arguments)}}(),Ze=function(){var dt=Fe(function*(){ke||(ke=Fe(function*(){if(N(b),!y){if(!L)throw k(B.message),B;return}let Je={dm:Le};we&&(Je.bd=!0),Je.brtk=!0,Je.ls=j[0],v&&(-1!=v.indexOf("-")?Je.hs=v:Je.og=v),Je.cu=b,I&&(Je.fn=I),n&&(Je.pd=n),o&&(Je.v=o),_&&(Je.dt=_),w&&(Je.os=w),F&&(Je.rmk=F),N(y);try{Je.ar=y,Je.bafc=!!B}catch(it){}N(Je);try{yield se(Je)}catch(it){N("error updl")}yield nt(),L||(L=!0),ke=null})()),yield ke});return function(){return dt.apply(this,arguments)}}(),nt=function(){var dt=Fe(function*(){let Je=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),it=yield pe();if(N(it),it&&it<Je)throw B?new Error(Ae.dlsErrorAndCacheExpire):new Error(Ae.checkLocalTime)});return function(){return dt.apply(this,arguments)}}(),et=null;const Qe=new Promise(dt=>{et=()=>{Qe.isPending=!1,Qe.isFulfilled=!0,dt()}});let at=null,vt=function(){var dt=Fe(function*(Je,it){return Y=Y.then(Fe(function*(){try{let ct=yield Q.keys();if(it||(Qe.isFulfilled?Je&&(ct=ct.filter(wt=>wt<Je)):Je&&ct.includes(Je)?ct=[Je]:(ct=[],N("Unexpected null key"))),!ct.length)return;for(let wt=0;wt<ct.length/1e3;++wt){let ht=ct.slice(1e3*wt,1e3*(wt+1)),At=[];for(let kt=0;kt<ht.length;++kt)At.push(yield Q.getItem(ht[kt]));if(V=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!Ce){let kt=yield J.getItem(Z);kt&&([b]=JSON.parse(yield ne(kt))),J.setItem(Z,yield le(JSON.stringify([b,V])))}try{let kt,Bt,Ft=j[0]+"verify/v2";V&&!Ce&&(Ft+="?ltstime="+encodeURIComponent(V));try{kt=Ve(Ft,{method:"POST",body:At.join(";"),keepalive:!0})}finally{!Qe.isFulfilled&&kEe&&et()}try{Bt=yield kt}finally{Qe.isFulfilled||et()}if(!Bt.ok)throw new Error("verify failed. Status Code: "+Bt.status);for(let Ht=0;Ht<ht.length;++Ht)yield Q.removeItem(ht[Ht])}catch(kt){throw Qe.isFulfilled||et(),$&&($(kt),$=null),kt}}ie&&ie()}catch(ct){}})),yield Y});return function(it,ct){return dt.apply(this,arguments)}}();return{i:(dt=Fe(function*(Je){return n=Je.pd,o=Je.v,h=o.split(".")[0],Je.dt&&(_=Je.dt),v=Je.l||"",w="string"!=typeof Je.os?JSON.stringify(Je.os):Je.os,I=Je.fn,"string"==typeof I&&(I=I.substring(0,255)),Je.ls&&Je.ls.length&&(j=Je.ls,1==j.length&&j.push(j[0])),A=!v||"200001"===v||v.startsWith("200001-"),M=Je.sp,F=Je.rmk,"string"==typeof F&&(F=F.substring(0,255)),Je.lf&&(q=Je.lf),Je.lsu&&(b=Ce=Je.lsu),Je.feab&&(ee=Je.feab),se=Je.updl,ce=Je.mnet,pe=Je.mxet,Je.sutlcb&&(ie=Je.sutlcb),yield he(),yield Fe(function*(){re=te(String.fromCharCode(v.charCodeAt(0)+10)+te(n)+te(v)+h+te(""+_)),Q=yield q.createInstance({name:"dynamdlsuns"+te(te("v2"))+te(String.fromCharCode(v.charCodeAt(0)+10)+te(n)+te(v)+h+te(""+_))});try{y=yield J.getItem(re)}catch(it){}})(),yield tt(),yield Ze(),(!B||B.ltsErrorCode>=102&&B.ltsErrorCode<=120)&&vt(null,!0),{ar:y,cu:b}}),function(it){return dt.apply(this,arguments)}),c:function(){var dt=Fe(function*(){let Je=new Date;if(Je.getTime()<je+36e4)return;let it=Je.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),ct=yield ce(),wt=yield pe();if(wt&&wt<it)yield tt(!0),yield Ze();else if(ct&&ct<it){let ht=new Date(Je.getTime());ht.setMinutes(Je.getMinutes()-6);let At=ht.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");V<At&&tt().then(()=>Ze())}});return function(){return dt.apply(this,arguments)}}(),s:function(){var dt=Fe(function*(Je,it,ct,wt){if(it){try{let ht;ht=it.startsWith("{")&&it.endsWith("}")?yield ee(it):it,ht?(N("bs "+ct),yield Q.setItem(ct,ht),N("ss "+ct)):N("ept ecpt")}catch(ht){}wt&&(N("bd "+ct),yield vt(ct,2==wt),N("sd "+ct)),at&&clearTimeout(at),at=setTimeout(Fe(function*(){yield vt()}),36e4)}else yield vt(ct)});return function(it,ct,wt,ht){return dt.apply(this,arguments)}}(),p:Qe,u:function(){var dt=Fe(function*(){return yield he(),b});return function(){return dt.apply(this,arguments)}}(),caret:nt};var dt};var Tp;class xi{static init(){vw._=lt(xi,this,void 0),yw._=lt(xi,this,void 0),X_._=lt(xi,this,"init")}static reset(){vw._=lt(xi,this,void 0),yw._=lt(xi,this,void 0),X_._=lt(xi,this,"")}static setLicenseInfo(n){var o;X_._=lt(xi,this,"done"),vw._=lt(xi,this,[]),vw._=lt(xi,this,null!==(o=null==n?void 0:n.modules)&&void 0!==o?o:[])}static setLicenseErr(n){yw._=lt(xi,this,n),X_._=lt(xi,this,"done")}static makeSureLoadLicenseExist(){return lt(xi,this,L2).call(this,3101,5001)}static makeSureCoreLicenseExist(){return lt(xi,this,L2).call(this,3101)}static makeSureCameraLicenseExist(){return lt(xi,this,L2).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return lt(xi,this,L2).call(this,15)}static annotationLicenseModuleIsExist(){return lt(xi,this,AAe).call(this,15)}}function eF(p){for(const n of lt(Tp,this,vw)._)if(n.module===p)return n;return{code:rt.LIC_MISS_MODULE.code,message:rt.LIC_MISS_MODULE.message,module:p}}function L2(p,n){""===lt(Tp,this,X_)._&&rt.throw(rt.INIT_SHOULD_SET_CONFIG),"done"!==lt(Tp,this,X_)._&&rt.throw(rt.INIT_CONFIG_NOT_DONE),lt(Tp,this,yw)._&&rt.throw(lt(Tp,this,yw)._);const o=lt(Tp,this,eF).call(this,p);0!==o.code&&(!n||n&&0!==lt(Tp,this,eF).call(this,n).code)&&rt.throw({code:o.code,message:o.message})}function AAe(p){return 0===lt(Tp,this,eF).call(this,p).code}Tp=xi;var Ip,vw={_:void 0},yw={_:void 0},X_={_:""};function iee(p){let n;if(p){let o;const h=p.message;o=p.ltsErrorCode,$t(o)?111===o?o=rt.LIC_EXPIRED.code:106===o||108===o?o=rt.LIC_INVALID.code:o>0&&(o=-(2e4+o)):o=rt.LIC_INVALID.code,n={code:o,message:h}}else n=rt.LIC_INVALID;return n}!function(p){p[p.publicTrial=0]="publicTrial",p[p.privateTrial=1]="privateTrial",p[p.normal=2]="normal"}(Ip||(Ip={}));var tf,_w=new WeakMap,N2=new WeakMap,B2=new WeakMap,W2=new WeakMap,U2=new WeakMap,om=new WeakMap,V2=new WeakMap,Cw=new WeakMap,Jv=new WeakSet;class PAe{constructor(n){dl(this,Jv),bi(this,_w,void 0),bi(this,N2,void 0),bi(this,B2,void 0),bi(this,W2,void 0),bi(this,U2,void 0),bi(this,om,void 0),bi(this,V2,void 0),bi(this,Cw,void 0),Wn(N2,this,void 0),Wn(_w,this,void 0),Wn(B2,this,""),Wn(W2,this,""),Wn(om,this,Ip.publicTrial),Wn(Cw,this,void 0),Wn(V2,this,"");const o=function(p){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=p;if(o._pLoad.isEmpty){let h,v,y,_=o._license||"",b=JSON.parse(JSON.stringify(o._licenseServer)),w=o._sessionPassword,I=0;if(_.startsWith("t")||_.startsWith("f"))I=0;else if(0===_.length||_.startsWith("P")||_.startsWith("L")||_.startsWith("Y")||_.startsWith("A"))I=1;else{I=2;const A=_.indexOf(":");-1!=A&&(_=_.substring(A+1));const M=_.indexOf("?");if(-1!=M&&(v=_.substring(M+1),_=_.substring(0,M)),_.startsWith("DLC2"))I=0;else{if(_.startsWith("DLS2")){let F;try{let V=_.substring(4);V=atob(V),F=JSON.parse(V)}catch(V){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(_=F.handshakeCode?F.handshakeCode:F.organizationID?F.organizationID:"","number"==typeof _&&(_=JSON.stringify(_)),0===b.length){let V=[];F.mainServerURL&&(V[0]=F.mainServerURL),F.standbyServerURL&&(V[1]=F.standbyServerURL),b=(B=>{if(null==B)B=[];else{B=B instanceof Array?[...B]:[B];for(let Q=0;Q<B.length;++Q){if(!Mv){let J=document.createElement("a");J.href=B[Q],B[Q]=J.href}B[Q].endsWith("/")||(B[Q]+="/")}}return B})(V)}!w&&F.sessionPassword&&(w=F.sessionPassword),h=F.remark}_&&"200001"!==_&&!_.startsWith("200001-")||(I=1)}}if(I&&(n||(Ov.crypto||(y="Please upgrade your browser to support online key."),Ov.crypto.subtle||(y="Require https to use online key in this browser."))),y){if(1!==I)throw new Error(y);I=0,o._lastErrorCode=-1,o._lastErrorString=y}return 1===I&&(_=""),{lt:I,l:_,ls:b,sp:w,rmk:h,cv:v}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")}({_pLoad:{isEmpty:!0},_license:n,_licenseServer:[]},!0);let h;if(o&&Sn(o.l)?(h=o.l.trim(),Wn(om,this,1===o.lt?Ip.publicTrial:2===o.lt?Ip.privateTrial:Ip.normal)):(h="",Wn(om,this,Ip.publicTrial)),""===h?Wn(_w,this,h):h.includes("-")?Wn(N2,this,h):Wn(_w,this,h),Di(o.ls)){o.ls.length>0&&Wn(Cw,this,o.ls);const v=Xe(Cw,this);let y,_;if(v&&v.length>0){for(y=0;y<v.length;y++)_=v[y],_.endsWith("/")||(v[y]=`${_}/`);lt(Jv,this,RAe).call(this,v,h)&&Wn(om,this,Ip.publicTrial)}}Wn(V2,this,o.sp)}init(n,o,h){var v=this;return Fe(function*(){let y=n;y.endsWith("/")||(y=`${y}/`),Xe(U2,v)||(yield lt(Jv,v,MAe).call(v,h));try{yield lt(Jv,v,LAe).call(v,o)}catch(_){const b=iee(_);let w=!1;b.code===rt.LIC_EXPIRED.code?-1!==b.message.toLowerCase().indexOf("trial license")&&(w=!0):v.isPublicTrial()&&(w=!0),w&&qZ({_bNeverShowDialog:!1,engineResourcePath:y,_onLog:console.log},"error",b.message),rt.throw(b)}})()}getClientUUID(){return Xe(W2,this)}getAuthResult(){return Xe(B2,this)}isPublicTrial(){return Xe(om,this)===Ip.publicTrial}setClientUUID(n){Wn(W2,this,n)}setAuthResult(n){Wn(B2,this,n)}}function RAe(p,n){let o=!0;if(Di(p)&&p.length>0){const h=p[0];Sn(h)&&""!==h&&!h.includes("https://mlts.dynamsoft.com")&&(o=!1)}return o&&(!n||"200001"===n||n.startsWith("200001-"))}function kAe(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function MAe(p){const n={dm:lt(Jv,this,kAe).call(this),fetch:window.fetch};p&&(n.bd=!0,n.log=console.log),Wn(U2,this,DAe(n))}function OAe(){return this.isPublicTrial()?"":Xe(N2,this)||Xe(_w,this)}function FAe(){const p=[];return p.push(fl.browser),p.push(fl.version.toString()),p.push(fl.OS),p.join(" ")}function LAe(p){return tF.apply(this,arguments)}function tF(){return tF=Fe(function*(p){if(this.getAuthResult()&&this.getClientUUID())return{ar:this.getAuthResult(),cu:this.getClientUUID()};const n={pd:"ddv",dt:"browser",v:"2.0.0",os:lt(Jv,this,FAe).call(this),l:lt(Jv,this,OAe).call(this),ls:Xe(Cw,this),sp:Xe(V2,this),fn:p||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(n.lsu=this.getClientUUID()),n.updateLicense=h=>{this.setAuthResult(h.ar),this.getClientUUID()||this.setClientUUID(h.cu)};const o=yield Xe(U2,this).i(n);return this.getAuthResult()||this.setAuthResult(o.ar),this.getClientUUID()||this.setClientUUID(o.cu),o}),tF.apply(this,arguments)}function nF(){return nF=Fe(function*(p){let n=p.engineResourcePath.trim();if(n.endsWith("/")||(n=`${n}/`),vn.resourceDir=n,xi.init(),!(yield vn.isResourceDirValid()))return xi.reset(),rt.reject(rt.RESOURCE_NOT_FOUND,"DDV.Core.init");yield vn.preloadModule("core");const o=p.license.trim();let h,v,y=o.startsWith("DLS")||0===o.length,_=!1,b=!1;if(y)try{var w;let M=!1;if(!o&&null!==(w=window)&&void 0!==w&&null!==(w=w.Dynamsoft)&&void 0!==w&&w.DWT){let F=window.Dynamsoft.DWT,V=F.lgar(F.EnumInstance.dwt_desktop,""),B=F.li({instanceMode:F.EnumInstance.dwt_desktop},"");V&&B&&(h=V,v=B,_=F.isPublicLicense(),M=!0)}if(!M){var I;let F;if(null!=io&&io.license?F=yield io.license.getAR():null!==(I=window)&&void 0!==I&&null!==(I=I.Dynamsoft)&&void 0!==I&&null!==(I=I.Core)&&void 0!==I&&null!==(I=I.mapPackageRegister)&&void 0!==I&&I.license&&(F=yield window.Dynamsoft.Core.mapPackageRegister.license.getAR()),F)h=F.ar,v=F.u,_=F.pt,F.pk?(h=F.pk,y=!1):b=!0,gt(h)&&F.ae&&rt.throw(iee(F.ae));else{const V=yield(B=Fe(function*(Q,J,Z,re){const se=new PAe(Q);return yield se.init(J,Z,re),{authResult:se.getAuthResult(),clientUUID:se.getClientUUID(),bPublicTrial:se.isPublicTrial()}}),function(Q,J,Z,re){return B.apply(this,arguments)})(o,n,p.deviceFriendlyName||"");h=V.authResult,v=V.clientUUID,_=V.bPublicTrial}}}catch(M){throw xi.setLicenseErr(M),M}else h=o,v="";var B;const A={licenseInfo:null};try{const M=yield vn.getLicenseInfo(h,y,v);A.licenseInfo=M,xi.setLicenseInfo(M),!b&&_&&M.trial&&M.msg&&qZ({_bNeverShowDialog:!1,engineResourcePath:n,_onLog:console.log},"warn",M.msg)}catch(M){throw M&&M.code<=-8e4&&xi.setLicenseErr(M),M}return y&&(A.deviceUuid=v),A}),nF.apply(this,arguments)}const BAe={scrollToLatest:!1};class WAe{constructor(n){W(this,"viewerUids",void 0),W(this,"groupUid",void 0),W(this,"config",void 0),W(this,"isSetScrollToLatest",!1),this.groupUid=n,this.viewerUids=new Set,this.config=pn(BAe)}getViewerUids(){return[...this.viewerUids.values()]}updateConfig(){Object.assign(this.config,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}var oee,Ko;(function(p){p.LEFT="left",p.TOP="top",p.RIGHT="right",p.BOTTOM="bottom"})(oee||(oee={})),function(p){p.DEFAULT="default",p.CAPTURE="capture",p.PERSPECTIVE="perspective",p.THUMBNAIL="thumbnail"}(Ko||(Ko={}));class see{constructor(){W(this,"db",void 0),this.db=new Map}set(n,o){var h=this;return Fe(function*(){return new Promise((v,y)=>{h.db.has(n)?y(new Error(`The item ${n} already exists.`)):(h.db.set(n,o),v(`Save ${n} to database successful.`))})})()}get(n){var o=this;return Fe(function*(){return new Promise((h,v)=>{o.db.has(n)?h(o.db.get(n)):v(new Error(`The item ${n} does not exist.`))})})()}remove(n){var o=this;return Fe(function*(){return new Promise((h,v)=>{const y=o.db.get(n);o.db.delete(n),h(y)})})()}update(n,o){var h=this;return Fe(function*(){return new Promise((v,y)=>{h.db.has(n)?(h.db.set(n,o),v(`Update ${n} successful.`)):y(new Error(`The item ${n} does not exist.`))})})()}dispose(){this.db.clear()}reset(){this.db.clear()}}class UAe extends or{constructor(){super(),W(this,"openDocument",void 0),W(this,"closeDocument",void 0),W(this,"syncDocument",void 0),W(this,"addPagesToDoc",void 0),W(this,"deletePages",void 0),W(this,"updatePage",void 0),W(this,"selectedPageChanged",void 0),W(this,"viewerModeChanged",void 0),W(this,"pageChanged",void 0),W(this,"currentPageChanged",void 0),W(this,"pageChangedAfterRender",void 0),W(this,"pageExistenceChanged",void 0),W(this,"tabChanged",void 0),W(this,"displayModeChanged",void 0),W(this,"fitModeChanged",void 0),W(this,"filterChanged",void 0),W(this,"toolModeChanged",void 0),W(this,"zoomChanged",void 0),W(this,"visibleChanged",void 0),W(this,"cropRectDrawn",void 0),W(this,"cropRectDeleted",void 0),W(this,"cropModeChanged",void 0),W(this,"quadModified",void 0),W(this,"autoCaptureChanged",void 0),W(this,"autoDetectChanged",void 0),W(this,"torchChanged",void 0),W(this,"cameraPlayed",void 0),W(this,"cameraClosed",void 0),W(this,"cameraInit",void 0),W(this,"beforeLayout",void 0),W(this,"afterLayout",void 0),W(this,"beforeRender",void 0),W(this,"afterRender",void 0),W(this,"destroy",void 0),W(this,"canvasCursorStyleChanged",void 0),W(this,"quadSelectionStyleChanged",void 0),W(this,"perspectiveQuadChanged",void 0),W(this,"beforeCropPages",void 0),W(this,"operationsChanged",void 0),W(this,"resize",void 0),W(this,"annotationsUpdated",void 0),W(this,"annotationModeChanged",void 0),W(this,"annotationDefaultStyleChanged",void 0),W(this,"selectedAnnotationsChanged",void 0),W(this,"annotationLayerStateChanged",void 0),W(this,"beforeAnnotationEdit",void 0),W(this,"afterAnnotationEdit",void 0),W(this,"beforeAnnotationDraw",void 0),W(this,"afterAnnotationDraw",void 0),W(this,"annotationTextCharsSelected",void 0),W(this,"scroll",void 0),this.openDocument=Dt(this),this.closeDocument=Dt(this),this.syncDocument=Dt(this),this.addPagesToDoc=Dt(this),this.deletePages=Dt(this),this.updatePage=Dt(this),this.selectedPageChanged=Dt(this),this.viewerModeChanged=Dt(this),this.pageChanged=Dt(this),this.currentPageChanged=Dt(this),this.pageChangedAfterRender=Dt(this),this.pageExistenceChanged=Dt(this),this.tabChanged=Dt(this),this.displayModeChanged=Dt(this),this.fitModeChanged=Dt(this),this.filterChanged=Dt(this),this.toolModeChanged=Dt(this),this.zoomChanged=Dt(this),this.visibleChanged=Dt(this),this.cropRectDrawn=Dt(this),this.cropRectDeleted=Dt(this),this.cropModeChanged=Dt(this),this.quadModified=Dt(this),this.autoCaptureChanged=Dt(this),this.autoDetectChanged=Dt(this),this.torchChanged=Dt(this),this.cameraPlayed=Dt(this),this.cameraClosed=Dt(this),this.cameraInit=Dt(this),this.beforeLayout=Dt(this),this.afterLayout=Dt(this),this.beforeRender=Dt(this),this.afterRender=Dt(this),this.destroy=Dt(this),this.canvasCursorStyleChanged=Dt(this),this.quadSelectionStyleChanged=Dt(this),this.perspectiveQuadChanged=Dt(this),this.beforeCropPages=Dt(this),this.operationsChanged=Dt(this),this.resize=Dt(this),this.annotationModeChanged=Dt(this),this.selectedAnnotationsChanged=Dt(this),this.annotationLayerStateChanged=Dt(this),this.annotationDefaultStyleChanged=Dt(this),this.beforeAnnotationEdit=Dt(this),this.afterAnnotationEdit=Dt(this),this.beforeAnnotationDraw=Dt(this),this.afterAnnotationDraw=Dt(this),this.annotationsUpdated=Dt(this),this.annotationTextCharsSelected=Dt(this),this.scroll=Dt(this)}}class nn{static numberArrayIsValid(n,o,h,v,y){return lt(nn,this,j2).call(this,n,1,o,h,y,v)}static stringArrayIsValid(n,o){return lt(nn,this,j2).call(this,n,2,void 0,void 0,0,o)}static blobArrayIsValid(n,o){return lt(nn,this,j2).call(this,n,4,void 0,void 0,void 0,o)}static quadIsValid(n,o){const h=[],v="Quad";lt(nn,this,ao).call(this,h,n,6,lt(nn,this,Jr).call(this,v,o,void 0),4);let y=0;for(const _ of n){const b=`[${y}]`;h.push(...lt(nn,this,j2).call(this,_,1,void 0,void 0,2,lt(nn,this,Jr).call(this,v,o,b,!0))),y+=1}return h}static docDetectConfigIsValid(n,o){const h=[],v="DocumentDetectConfig";return lt(nn,this,ao).call(this,h,n,5,lt(nn,this,Jr).call(this,v,o)),lt(nn,this,ao).call(this,h,n.autoCaptureDelay,1,lt(nn,this,Jr).call(this,v,o,"autoCaptureDelay")),gt(n.acceptedPolygonConfidence)||lt(nn,this,ao).call(this,h,n.acceptedPolygonConfidence,1,lt(nn,this,Jr).call(this,v,o,"acceptedPolygonConfidence")),gt(n.enableAutoCapture)||lt(nn,this,ao).call(this,h,n.enableAutoCapture,3,lt(nn,this,Jr).call(this,v,o,"enableAutoCapture")),h}static docDetectConfIsValid(n,o){const h=[],v="DocumentDetectConfidence";return lt(nn,this,ao).call(this,h,n,5,lt(nn,this,Jr).call(this,v,o)),lt(nn,this,ao).call(this,h,n.angleConfidence,1,lt(nn,this,Jr).call(this,v,o,"angleConfidence"),0,100),lt(nn,this,ao).call(this,h,n.areaConfidence,1,lt(nn,this,Jr).call(this,v,o,"areaConfidence"),0,100),lt(nn,this,ao).call(this,h,n.centerConfidence,1,lt(nn,this,Jr).call(this,v,o,"centerConfidence"),0,100),h}static imageDataIsValid(n,o){const h=[],v="VImageData";return lt(nn,this,ao).call(this,h,n,5,lt(nn,this,Jr).call(this,v,o)),lt(nn,this,ao).call(this,h,n.data,8,lt(nn,this,Jr).call(this,v,o,"data")),lt(nn,this,ao).call(this,h,n.type,9,lt(nn,this,Jr).call(this,v,o,"type")),gt(n.height)||lt(nn,this,ao).call(this,h,n.height,1,lt(nn,this,Jr).call(this,v,o,"height")),gt(n.width)||lt(nn,this,ao).call(this,h,n.width,1,lt(nn,this,Jr).call(this,v,o,"width")),h}static filterTypeIsValid(n,o){const h=[];return lt(nn,this,ao).call(this,h,n,10,lt(nn,this,Jr).call(this,"EnumImageFilterType",o)),h}static imageEncodeOptionIsValid(n,o){const h=[],v="ImageEncodeOption";return lt(nn,this,ao).call(this,h,n,5,lt(nn,this,Jr).call(this,v,o)),lt(nn,this,ao).call(this,h,n.type,9,lt(nn,this,Jr).call(this,v,o,"type")),gt(n.params)||lt(nn,this,ao).call(this,h,n.params,5,lt(nn,this,Jr).call(this,v,o,"params")),h}static makeSureNumberValid(n,o,h,v,y,_){return lt(nn,this,aee).call(this,lt(nn,this,lee).call(this,n,o,h),v,y,_)}static makeSureStringValid(n,o,h,v){return lt(nn,this,aee).call(this,{isValid:lt(nn,this,rF).call(this,n)},o,h,v)}static makeSureDetectResultValid(n,o,h,v){const y=[],_="DetectResult";lt(nn,this,ao).call(this,y,n,5,lt(nn,this,Jr).call(this,_,v)),y.push(...nn.quadIsValid(null==n?void 0:n.location,_)),lt(nn,this,ao).call(this,y,null==n?void 0:n.width,1,lt(nn,this,Jr).call(this,_,v,"width"),1,void 0),lt(nn,this,ao).call(this,y,null==n?void 0:n.height,1,lt(nn,this,Jr).call(this,_,v,"height"),1,void 0),y.push(...nn.docDetectConfigIsValid(null==n?void 0:n.config,_)),null!=n&&n.confidence&&lt(nn,this,ao).call(this,y,n.confidence,1,lt(nn,this,Jr).call(this,_,v,"confidence")),this.makeSureValid(y,o,h)}static makeSureValid(n,o,h,v){0!==n.length&&lt(nn,this,iF).call(this,n,o,h,v)}static makeSureMissing(n,o,h){gt(n)&&lt(nn,this,iF).call(this,void 0,o,h,rt.PARAM_MISS)}static makeSureCameraObject(n,o,h){const v=[],y=h;this.makeSureMissing(n,o,h),Sn(n)?this.makeSureStringValid(n,o,h):(lt(nn,this,ao).call(this,v,n,5,lt(nn,this,Jr).call(this,y)),lt(nn,this,ao).call(this,v,n.deviceId,2,lt(nn,this,Jr).call(this,y,void 0,"deviceId")),lt(nn,this,ao).call(this,v,n.label,2,lt(nn,this,Jr).call(this,y,void 0,"label")),this.makeSureValid(v,o,h))}static initTypeCheckMap(){lt(nn,this,za)._[7]=YE,lt(nn,this,za)._[15]=Sn,lt(nn,this,za)._[3]=As,lt(nn,this,za)._[5]=Vn,lt(nn,this,za)._[4]=pl,lt(nn,this,za)._[2]=lt(nn,this,rF),lt(nn,this,za)._[8]=lt(nn,this,jAe),lt(nn,this,za)._[11]=lt(nn,this,YAe),lt(nn,this,za)._[12]=lt(nn,this,XAe),lt(nn,this,za)._[13]=lt(nn,this,$Ae),lt(nn,this,za)._[14]=lt(nn,this,qAe),lt(nn,this,za)._[1]=lt(nn,this,lee),lt(nn,this,za)._[6]=lt(nn,this,HAe),lt(nn,this,za)._[9]=lt(nn,this,GAe),lt(nn,this,za)._[10]=lt(nn,this,zAe),lt(nn,this,za)._[16]=lt(nn,this,KAe)}}function j2(p,n,o,h,v,y){const _=[],b="Array";if(lt(tf,this,ao).call(this,_,p,6,lt(tf,this,Jr).call(this,b,y),v),_.length>0)return _;let w=0;for(const I of p){const A=`[${w}]`;lt(tf,this,ao).call(this,_,I,n,lt(tf,this,Jr).call(this,b,y,A,!0),o,h),w+=1}return _}function aee(p,n,o,h){const{isValid:v,isInRange:y,isSupported:_}=p,b=!!gt(v)||v,w=!!gt(y)||y,I=!!gt(_)||_;b&&w&&I||(h||(h=b?w?rt.PARAM_NOT_SUPPORT:rt.PARAM_OUT_OF_RANGE:rt.PARAM_INVALID),lt(tf,this,iF).call(this,void 0,n,o,h))}function Jr(p,n,o,h){return n?o?`${n}${h?"":"."}${o}`:`${n}`:o?`${p}${h?"":"."}${o}`:`${p}`}function iF(p,n,o,h){const v=gt(h)?Ke({},rt.PARAM_INVALID):Ke({},h);p&&(v.details=p),rt.throw(v,n,o)}function ao(p,n,o,h,v,y){const _=lt(tf,this,VAe).call(this,n,o,h,v,y);_&&p.push(_)}function VAe(p,n,o,h,v){if(gt(p))return`${o} is missing.`;const y=lt(tf,this,za)._[n];if(y){const _=y.bind(this)(p,h,v);if(As(_)){if(!_)return`${o} is invalid.`}else if(Vn(_)){const{isValid:b,isInRange:w,isSupported:I}=_;if(!1===b)return`${o} is invalid.`;if(!1===w)return`${o} is out of range.`;if(!1===I)return`${o} is not supported.`}}}function jAe(p){return YE(p)||pl(p)}function HAe(p,n){return Di(p)?$t(n)&&0===p.length||!gt(n)&&p.length<n?{isValid:!1}:{isValid:!0,isInRange:!!gt(n)||p.length>=n}:{isValid:!1}}function GAe(p){return $t(p)?{isValid:!0,isInRange:p>=Er.RGBA&&p<=Er.PNG}:{isValid:!1}}function zAe(p){return Sn(p)?{isValid:!0,isInRange:(n=p,!!$Z.get(n))}:{isValid:!1};var n}function YAe(p){return void 0!==u5.get(p)}function XAe(p){return void 0!==r2.get(p)}function $Ae(p){return void 0!==c5.get(p)}function qAe(p){if(Sn(p)){const n=p.trim();return-1!==lt(tf,this,JAe)._.indexOf(n)}return!1}function lee(p,n,o){let h=!0;return $t(p)?(gt(n)||(h=p>=n),!gt(o)&&h&&(h=p<=o),{isValid:!0,isInRange:h}):{isValid:!1}}function rF(p){return!!Sn(p)&&0!==p.trim().length}function KAe(p){if(!lt(tf,this,rF).call(this,p))return{isValid:!1};const n=p.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['\u2019](\d{2})['\u2019]|)$/);let o=!1;if(n){const[,h,v,y,_,b,w,I,A,M]=n,F=new Date(`${h}-${v}-${y}T${_}:${b}:${w}`);if(o=!0,F.getFullYear()===parseInt(h,10)&&F.getMonth()+1===parseInt(v,10)&&F.getDate()===parseInt(y,10)&&F.getHours()===parseInt(_,10)&&F.getMinutes()===parseInt(b,10)&&F.getSeconds()===parseInt(w,10)||(o=!1),o&&I){const V=parseInt(A,10),B=parseInt(M,10);("+"===I&&(V<0||V>12||B<0||B>59)||"-"===I&&(V<0||V>12||B<0||B>59))&&(o=!1)}}return{isSupported:o}}tf=nn;var JAe={_:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},za={_:Object.create(null)};nn.initTypeCheckMap();class QAe{constructor(n){W(this,"maxConcurrency",void 0),W(this,"currentConcurrency",void 0),W(this,"queue",void 0),this.maxConcurrency=n,this.currentConcurrency=0,this.queue=[]}acquire(){var n=this;return Fe(function*(){return new Promise(o=>{n.currentConcurrency<n.maxConcurrency?(n.currentConcurrency+=1,o(!0)):n.queue.push(o)})})()}release(){this.queue.length>0?this.queue.shift()():this.currentConcurrency-=1}}class bw extends class ZAe{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;W(this,"tasks",void 0),W(this,"semaphore",void 0),this.tasks=[],this.semaphore=new QAe(n)}process(n){var o=this;return Fe(function*(){yield o.semaphore.acquire();let h=null;try{n.cancelled||(h=yield o.handler(n.taskUid))}catch(v){h=null}if(n.completed=!0,o.tasks.includes(n)){const v=o.tasks.indexOf(n);o.tasks.splice(v,1)}n.emitter.emit(n.taskUid,h),o.semaphore.release()})()}executeTask(n){var o=this;return Fe(function*(){return new Promise((h,v)=>{let y=o.tasks.find(_=>_.taskUid===n);y||(y={taskUid:n,emitter:new Yh,completed:!1,cancelled:!1,running:!1},o.tasks.push(y)),y.cancelled=!1,y.emitter.on(n,_=>{h(_)}),y.running||(y.running=!0,o.process(y))})})()}cancel(n){const o=this.tasks.find(h=>h.taskUid===n);o&&(o.cancelled=!0)}destroy(){this.tasks=[]}handler(n){return Fe(function*(){return Promise.resolve(null)})()}}{handler(n){return Fe(function*(){return new Promise((o,h)=>{const v=new Image;v.crossOrigin="Anonymous",v.onload=()=>{v.onload=null,v.onerror=null,o(v)},v.onerror=y=>{v.onload=null,v.onerror=null,o(null)},v.src=n})})()}}class ePe extends bw{constructor(n,o){super(),W(this,"core",void 0),W(this,"imageLoader",void 0),this.core=n,this.imageLoader=o}handler(n){var o=this;return Fe(function*(){let h=o.core.pageService.getPage(n);if(!h||h.isDestroyed)return null;let{img:v}=h.raw;if(!v){let{url:y}=h.raw;if(!y){let _=h.raw.data;if(!_){let b=yield o.core.imageDataService.getRaw(n);const w=o.core.pageService.getPage(n);if(!w||(h.isDestroyed&&!w.isDestroyed&&(b=yield o.core.imageDataService.getRaw(n,!0)),!b||w.isDestroyed))return null;_=b.data}y=URL.createObjectURL(_),h.raw.url=y}if(v=yield o.imageLoader.executeTask(y),h=o.core.pageService.getPage(n),!h||h.isDestroyed)return null;h.raw.img=v}return v})()}}class tPe extends bw{constructor(n,o){super(),W(this,"core",void 0),W(this,"imageLoader",void 0),this.core=n,this.imageLoader=o}handler(n){var o=this;return Fe(function*(){var h;let v=o.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;let y=null===(h=v.original)||void 0===h?void 0:h.img;if(!y){var _;let w=null===(_=v.original)||void 0===_?void 0:_.url;if(!w){var b;let I=null===(b=v.original)||void 0===b?void 0:b.data;if(!I){let A=yield o.core.imageDataService.getOriginal(n);const M=o.core.pageService.getPage(n);if(!M||(v.isDestroyed&&!M.isDestroyed&&(A=yield o.core.imageDataService.getRaw(n,!0)),!A||M.isDestroyed))return null;I=A.data}w=URL.createObjectURL(I),v.original.url=w}if(y=yield o.imageLoader.executeTask(w),v=o.core.pageService.getPage(n),!v||v.isDestroyed)return null;v.original.img=y}return y})()}}class nPe extends bw{constructor(n,o){super(),W(this,"core",void 0),W(this,"imageLoader",void 0),this.core=n,this.imageLoader=o}handler(n){var o=this;return Fe(function*(){var h;let v=o.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;let y=null===(h=v.display)||void 0===h?void 0:h.img;if(!y){var _;let w=null===(_=v.display)||void 0===_?void 0:_.url;if(!w){var b;let A=null===(b=v.display)||void 0===b?void 0:b.data;if(!A){let M=yield o.core.imageDataService.getDisplay(n,!0);const F=o.core.pageService.getPage(n);if(!F||(v.isDestroyed&&!F.isDestroyed&&(M=yield o.core.imageDataService.getDisplay(n,!0)),!M||F.isDestroyed))return null;A=M.data}w=URL.createObjectURL(A),v.display.url=w}const{filter:I}=v;if(y=yield o.imageLoader.executeTask(w),v=o.core.pageService.getPage(n),!v||v.isDestroyed)return null;if(I!==v.filter)return o.handler(v.uid);v.display.img=y}return y})()}}class iPe extends bw{constructor(n,o){super(),W(this,"core",void 0),W(this,"imageLoader",void 0),this.core=n,this.imageLoader=o}handler(n){var o=this;return Fe(function*(){var h;let v=o.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;let y=null===(h=v.thumbnail)||void 0===h?void 0:h.img;if(!y){var _;let w=null===(_=v.thumbnail)||void 0===_?void 0:_.url;if(!w){var b;let I=null===(b=v.thumbnail)||void 0===b?void 0:b.data;if(!I){const A=yield o.core.imageDataService.getThumbnail(n);if(v=o.core.pageService.getPage(n),!A||v.isDestroyed)return null;I=A.data}w=URL.createObjectURL(I),v.thumbnail.url=w}if(y=yield o.imageLoader.executeTask(w),v=o.core.pageService.getPage(n),v.isDestroyed)return null;v.thumbnail.img=y}return y})()}}class rPe{constructor(n){W(this,"rawImageLoader",void 0),W(this,"originalImageLoader",void 0),W(this,"displayImageLoader",void 0),W(this,"thumbnailImageLoader",void 0);const o=new bw;this.rawImageLoader=new ePe(n,o),this.originalImageLoader=new tPe(n,o),this.displayImageLoader=new nPe(n,o),this.thumbnailImageLoader=new iPe(n,o)}loadRawImage(n){var o=this;return Fe(function*(){return o.rawImageLoader.executeTask(n)})()}cancelLoadRawImage(n){this.rawImageLoader.cancel(n)}loadOriginalImage(n){var o=this;return Fe(function*(){return o.originalImageLoader.executeTask(n)})()}cancelLoadOriginalImage(n){this.originalImageLoader.cancel(n)}loadDisplayImage(n){var o=this;return Fe(function*(){return o.displayImageLoader.executeTask(n)})()}cancelLoadDisplayImage(n){this.displayImageLoader.cancel(n)}loadThumbnailImage(n){var o=this;return Fe(function*(){return o.thumbnailImageLoader.executeTask(n)})()}cancelLoadThumbnailImage(n){this.thumbnailImageLoader.cancel(n)}}class oPe{constructor(n,o,h){W(this,"worker",void 0),W(this,"id",void 0),W(this,"manager",void 0),W(this,"callbacks",{}),W(this,"busy",!1),W(this,"counter",0),W(this,"tasks",[]),this.worker=n,this.id=o,this.manager=h,this.worker.addEventListener("message",v=>{this.onMessage(v)},!1)}cancel(n){const o=this.tasks.findIndex(h=>{var v;return(null===(v=h.data)||void 0===v?void 0:v.taskUid)===n});if(o>=0){const h=this.tasks.splice(o,1)[0];this.callbacks[h.callbackId]&&delete this.callbacks[h.callbackId],this.setBusy(!1)}}setBusy(n){if(this.busy=n,!n)if(this.tasks.length){const o=this.tasks.shift();this.send(o)}else this.worker.terminate(),this.manager.removeActor(this)}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(n){this.setBusy(!1);const{callbackId:o}=n.data,h=o?this.callbacks[o]:null;h&&h(n.data),delete this.callbacks[o]}send(n,o){if(this.busy)return void this.tasks.push(Ke({},n));this.setBusy(!0);const h=`${this.id}-${n.action}-cb-${this.counter}`;n.callback&&(this.callbacks[h]=n.callback,this.counter+=1),n.callbackId=h;const v=zt(Ke({},n.data),{callbackId:h});o?this.worker.postMessage(v,[o.data.buffer]):this.worker.postMessage(v)}}class sPe{constructor(n,o){W(this,"concurrency",1),W(this,"actors",[]),W(this,"workerUrl",void 0),this.workerUrl=n,this.concurrency=o}send(n,o){this.getActor().send(n,o)}getActor(){const n=this.actors.filter(h=>!h.isBusy())[0];if(n)return n;if(this.actors.length<this.concurrency){const h=new Worker(this.workerUrl),v=new oPe(h,this.actors.length,this);return this.actors.push(v),v}const o=Math.floor(Math.random()*this.concurrency);return this.actors[o]}removeActor(n){const o=this.actors.indexOf(n);this.actors.splice(o,1)}cancel(n){for(const o of this.actors)o.cancel(n)}clear(){for(const n of this.actors)n.getWorker().terminate();this.actors=[]}}function aPe(){onmessage=p=>{const{index:n}=p.data,o=p.data.sourceWidth,h=p.data.sourceHeight,v=p.data.width,y=p.data.height,_=p.data.source.data,b=v*y*4,w=new ArrayBuffer(b);let I=null;try{I=new Uint8ClampedArray(w,0,b)}catch(M){I=new Uint8Array(w,0,b)}for(let M=0;M<y;M++){const F=M*h/y,V=Math.floor(F),B=1-(F-V),Q=V,J=(M+1)*h/y,Z=Math.floor(J-1e-5),re=J-Z,se=Z;let ce=M*v*4;for(let pe=0;pe<v;pe++){const Ce=pe*o/v,Ve=Math.floor(Ce),te=1-(Ce-Ve),Me=Ve,we=(pe+1)*o/v,Le=Math.floor(we-1e-5),j=we-Le,L=Le;let Y=0,q=0,k=0,N=0,$=0;const ie=255;let ee,ne,le=(Q+1)*o*4+4*Me;for(ee=Q+1;ee<se;++ee)Y+=_[le+2]*te*ie,q+=_[le+1]*te*ie,k+=_[le]*te*ie,N+=_[le+3]*te*ie,$+=ie*te,le+=4*o;let fe=(Q+1)*o*4+4*L;for(ee=Q+1;ee<se;++ee)Y+=_[fe+2]*j*ie,q+=_[fe+1]*j*ie,k+=_[fe]*j*ie,N+=_[fe+3]*j*ie,$+=ie*j,fe+=4*o;let xe=Q*o*4+4*(Me+1);for(ne=Me+1;ne<L;++ne)Y+=_[xe+2]*B*ie,q+=_[xe+1]*B*ie,k+=_[xe]*B*ie,N+=_[xe+3]*B*ie,$+=ie*B,xe+=4;let Pe=se*o*4+4*(Me+1);for(ne=Me+1;ne<L;++ne)Y+=_[Pe+2]*re*ie,q+=_[Pe+1]*re*ie,k+=_[Pe]*re*ie,N+=_[Pe+3]*re*ie,$+=ie*re,Pe+=4;for(ee=Q+1;ee<se;++ee){let Qe=ee*o*4+4*(Me+1);for(ne=Me+1;ne<L;++ne)Y+=_[Qe+2]*ie,q+=_[Qe+1]*ie,k+=_[Qe]*ie,N+=_[Qe+3]*ie,$+=ie,Qe+=4}let De=Q*o*4+4*Me;Y+=_[De+2]*(B*te)*ie,q+=_[De+1]*(B*te)*ie,k+=_[De]*(B*te)*ie,N+=_[De+3]*(B*te)*ie,$+=ie*(B*te),De=Q*o*4+4*L,Y+=_[De+2]*(B*j)*ie,q+=_[De+1]*(B*j)*ie,k+=_[De]*(B*j)*ie,N+=_[De+3]*(B*j)*ie,$+=ie*(B*j),De=se*o*4+4*Me,Y+=_[De+2]*(re*te)*ie,q+=_[De+1]*(re*te)*ie,k+=_[De]*(re*te)*ie,N+=_[De+3]*(re*te)*ie,$+=ie*(re*te),De=se*o*4+4*L,Y+=_[De+2]*(re*j)*ie,q+=_[De+1]*(re*j)*ie,k+=_[De]*(re*j)*ie,N+=_[De+3]*(re*j)*ie,$+=ie*(re*j);let tt=N/$,Ze=0,nt=0,et=0;0!==tt&&(Ze=Y/$,nt=q/$,et=k/$),Ze+=.5,nt+=.5,et+=.5,tt+=.5,I[ce]=Math.floor(et),ce+=1,I[ce]=Math.floor(nt),ce+=1,I[ce]=Math.floor(Ze),ce+=1,I[ce]=Math.floor(tt),ce+=1}}const A={index:n,target:I,taskUid:p.data.taskUid,callbackId:p.data.callbackId};try{postMessage(A,[I.buffer])}catch(M){postMessage(A,null)}I=null}}class cPe{constructor(){}reset(){}perspectivePreview(n,o,h,v){var y=arguments;return Fe(function*(){var _,b,w;let I=y.length>4&&void 0!==y[4]?y[4]:{};const A=new Kg,M=yield A.initImage({source:n,isRGBA:o===Er.RGBA,width:v.width,height:v.height,isBGRA:o===Er.BGRA});M.srcBuffer&&(n=M.srcBuffer);let F=v.width,V=v.height;const B=null!==(_=v.angle)&&void 0!==_?_:0;90!==B&&270!==B||(F=v.height,V=v.width);const Q=Math.min((null!==(b=I.width)&&void 0!==b?b:F)/F,(null!==(w=I.height)&&void 0!==w?w:V)/V),J=Math.floor(F*Q+.5),Z=Math.floor(V*Q+.5);yield A.resize(J,Z,I.mode),null!=v&&v.angle&&(yield A.rotate({angle:v.angle}));const re=[[Math.floor(h[0][0]*Q+.5),Math.floor(h[0][1]*Q+.5)],[Math.floor(h[1][0]*Q+.5),Math.floor(h[1][1]*Q+.5)],[Math.floor(h[2][0]*Q+.5),Math.floor(h[2][1]*Q+.5)],[Math.floor(h[3][0]*Q+.5),Math.floor(h[3][1]*Q+.5)]];yield A.drawQuadrangle({location:re,strokeColor:I.strokeColor,lineWidth:I.lineWidth});const se=yield A.getImage({ifDeleteObject:!0,isRGBA:o===Er.RGBA,returnBlob:!1});yield A.freeReservedData();const ce={data:new Blob([se.imageData],{type:se.blobType}),width:se.imageWidth,height:se.imageHeight,resolutionX:se.imageXResolution,resolutionY:se.imageYResolution};return A.terminate(),ce})()}resize(n,o,h,v,y){var _=arguments;return Fe(function*(){let b=_.length>5&&void 0!==_[5]?_[5]:{};const w=new Kg,I=yield w.initImage({source:n,isRGBA:o===Er.RGBA,width:h,height:v,isBGRA:o===Er.BGRA});if(I.srcBuffer&&(n=I.srcBuffer),y>0){let F=1;F=h>v?h/y:v/y;const V=Math.floor(h/F+.5),B=Math.floor(v/F+.5);yield w.resize(V,B,b.mode)}const A=yield w.getImage({ifDeleteObject:!0,isRGBA:o===Er.RGBA,returnBlob:!1});yield w.freeReservedData();const M={data:new Blob([A.imageData],{type:A.blobType}),width:A.imageWidth,height:A.imageHeight,resolutionX:A.imageXResolution,resolutionY:A.imageYResolution};return w.terminate(),M})()}}class Gn{constructor(n){}}class oF extends Gn{static create(n,o){return new oF(n,o)}constructor(n,o){super("cameraChanged"),W(this,"oldDeviceId",void 0),W(this,"newDeviceId",void 0),this.oldDeviceId=n,this.newDeviceId=o}}class sF extends Gn{static create(n){return new sF(n)}constructor(n){super("captured"),W(this,"pageUid",void 0),this.pageUid=n}}class aF extends Gn{static create(n){return new aF(n)}constructor(n){super("cropRectDeleted"),W(this,"rect",void 0),this.rect=n}}class lF extends Gn{static create(n){return new lF(n)}constructor(n){super("cropRectDrawn"),W(this,"rect",void 0),this.rect=n}}class cF extends Gn{static create(n,o){return new cF(n,o)}constructor(n,o){super("cropRectModified"),W(this,"oldRect",void 0),W(this,"newRect",void 0),this.oldRect=n,this.newRect=o}}class uF extends Gn{static create(n,o){return new uF(n,o)}constructor(n,o){super("currentIndexChanged"),W(this,"oldIndex",void 0),W(this,"newIndex",void 0),this.oldIndex=n,this.newIndex=o}}class dF extends Gn{static create(n,o){return new dF(n,o)}constructor(n,o){super("displayModeChanged"),W(this,"oldDisplayMode",void 0),W(this,"newDisplayMode",void 0),this.oldDisplayMode=n,this.newDisplayMode=o}}class H2 extends Gn{static create(n,o){return new H2(n,o)}constructor(n,o){super("document"),W(this,"docUid",void 0),W(this,"docName",void 0),this.docUid=n,this.docName=o}}class $_ extends Gn{static create(n,o){return new $_(n,o)}constructor(n,o){super("fitModeChanged"),W(this,"oldFitMode",void 0),W(this,"newFitMode",void 0),this.oldFitMode=n,this.newFitMode=o}}class hF extends Gn{static create(n,o){return new hF(n,o)}constructor(n,o){super("pagesDragged"),W(this,"indices",void 0),W(this,"pageUids",void 0),this.indices=n,this.pageUids=o}}class fF extends Gn{static create(n,o,h){return new fF(n,o,h)}constructor(n,o,h){super("pagesDropped"),W(this,"indicesBefore",void 0),W(this,"indicesAfter",void 0),W(this,"pageUids",void 0),this.indicesBefore=n,this.indicesAfter=o,this.pageUids=h}}class pF extends Gn{static create(n,o){return new pF(n,o)}constructor(n,o){super("pageRendered"),W(this,"index",void 0),W(this,"pageUid",void 0),this.index=n,this.pageUid=o}}class q_ extends Gn{static create(n,o,h){return new q_(n,o,h)}constructor(n,o,h){super("pagesAdded"),W(this,"docUid",void 0),W(this,"indices",void 0),W(this,"pageUids",void 0),this.docUid=n,this.indices=o,this.pageUids=h}}class G2 extends Gn{static create(n,o,h){return new G2(n,o,h)}constructor(n,o,h){super("pagesDeleted"),W(this,"docUid",void 0),W(this,"pageUids",void 0),W(this,"indices",void 0),this.docUid=n,this.pageUids=o,this.indices=h}}class gF extends Gn{static create(n,o){return new gF(n,o)}constructor(n,o){super("played"),W(this,"deviceId",void 0),W(this,"resolution",void 0),this.deviceId=n,this.resolution=o}}class z2 extends Gn{static create(n,o){return new z2(n,o)}constructor(n,o){super("quadModified"),W(this,"oldQuad",void 0),W(this,"newQuad",void 0),this.oldQuad=n,this.newQuad=o}}class mF extends Gn{static create(n,o,h,v){return new mF(n,o,h,v)}constructor(n,o,h,v){super("resized"),W(this,"oldWidth",void 0),W(this,"oldHeight",void 0),W(this,"newWidth",void 0),W(this,"newHeight",void 0),this.oldWidth=n,this.oldHeight=o,this.newWidth=h,this.newHeight=v}}class vF extends Gn{static create(n,o,h,v){return new vF(n,o,h,v)}constructor(n,o,h,v){super("selectedPagesChanged"),W(this,"oldIndices",void 0),W(this,"newIndices",void 0),W(this,"oldPageUids",void 0),W(this,"newPageUids",void 0),this.oldIndices=n,this.newIndices=o,this.oldPageUids=h,this.newPageUids=v}}class yF extends Gn{static create(n){return new yF(n)}constructor(n){super("stopped"),W(this,"deviceId",void 0),this.deviceId=n}}class _F extends Gn{static create(n,o){return new _F(n,o)}constructor(n,o){super("toolModeChanged"),W(this,"oldToolMode",void 0),W(this,"newToolMode",void 0),this.oldToolMode=n,this.newToolMode=o}}class Y2 extends Gn{static create(n,o,h,v,y,_,b){return new Y2(n,o,h,v,y,_,b)}constructor(n,o,h,v,y,_,b){super("vPointer"),W(this,"index",void 0),W(this,"pageUid",void 0),W(this,"imageX",void 0),W(this,"imageY",void 0),W(this,"canvasX",void 0),W(this,"canvasY",void 0),W(this,"nativeEvent",void 0),this.index=n,this.pageUid=o,this.imageX=h,this.imageY=v,this.canvasX=y,this.canvasY=_,this.nativeEvent=b}}class CF extends Gn{static create(n,o){return new CF(n,o)}constructor(n,o){super("zoomChanged"),W(this,"oldZoomRatio",void 0),W(this,"newZoomRatio",void 0),this.oldZoomRatio=n,this.newZoomRatio=o}}class bF extends Gn{static create(n,o){return new bF(n,o)}constructor(n,o){super("currentPageChanged"),W(this,"oldPageUid",void 0),W(this,"newPageUid",void 0),this.oldPageUid=n,this.newPageUid=o}}class xF extends Gn{static create(n,o){return new xF(n,o)}constructor(n,o){super("selectedAnnotationsChanged"),W(this,"oldAnnotationUids",void 0),W(this,"newAnnotationUids",void 0),this.oldAnnotationUids=n,this.newAnnotationUids=o}}class wF extends Gn{static create(n,o){return new wF(n,o)}constructor(n,o){super("annotationModeChanged"),W(this,"oldAnnotationMode",void 0),W(this,"newAnnotationMode",void 0),this.oldAnnotationMode=n,this.newAnnotationMode=o}}class SF extends Gn{static create(n){return new SF(n)}constructor(n){super("annotationLayerStateChanged"),W(this,"state",void 0),this.state=n}}class TF extends Gn{static create(n,o,h,v){return new TF(n,o,h,v)}constructor(n,o,h,v){super("addPagesToDoc"),W(this,"docUid",void 0),W(this,"pageUids",void 0),W(this,"indices",void 0),W(this,"index",void 0),this.docUid=n,this.pageUids=o,this.indices=h,this.index=v}}class IF extends Gn{static create(n,o,h){return new IF(n,o,h)}constructor(n,o,h){super("createPage"),W(this,"pageUid",void 0),W(this,"fileUid",void 0),W(this,"fileIndex",void 0),this.pageUid=n,this.fileUid=o,this.fileIndex=h}}class EF extends Gn{static create(n,o,h){return new EF(n,o,h)}constructor(n,o,h){super("movePages"),W(this,"docUid",void 0),W(this,"indices",void 0),W(this,"insertBeforeIndex",void 0),this.docUid=n,this.indices=o,this.insertBeforeIndex=h}}class DF extends Gn{static create(n,o,h){return new DF(n,o,h)}constructor(n,o,h){super("renameDocument"),W(this,"docUid",void 0),W(this,"oldName",void 0),W(this,"newName",void 0),this.docUid=n,this.oldName=o,this.newName=h}}class AF extends Gn{static create(n,o){return new AF(n,o)}constructor(n,o){super("reorderPages"),W(this,"docUid",void 0),W(this,"indices",void 0),this.docUid=n,this.indices=o}}class PF extends Gn{static create(n,o,h){return new PF(n,o,h)}constructor(n,o,h){super("switchPage"),W(this,"docUid",void 0),W(this,"one",void 0),W(this,"another",void 0),this.docUid=n,this.one=o,this.another=h}}class RF extends Gn{static create(n,o,h){return new RF(n,o,h)}constructor(n,o,h){super("updatePage"),W(this,"docUid",void 0),W(this,"pageUid",void 0),W(this,"data",void 0),this.docUid=n,this.pageUid=o,this.data=h}}class kF extends Gn{static create(n){return new kF(n)}constructor(n){super("autoCaptureChanged"),W(this,"enableAutoCapture",void 0),this.enableAutoCapture=n}}class MF extends Gn{static create(n){return new MF(n)}constructor(n){super("autoDetectChanged"),W(this,"enableAutoDetect",void 0),this.enableAutoDetect=n}}class OF extends Gn{static create(n){return new OF(n)}constructor(n){super("torchChanged"),W(this,"torchState",void 0),this.torchState=n}}class FF extends Gn{static create(n){return new FF(n)}constructor(n){super("cameraPlayed"),W(this,"resolution",void 0),this.resolution=n}}class xw extends Gn{static create(n,o){return new xw(n,o)}constructor(n,o){super("paginationChanged"),W(this,"current",void 0),W(this,"total",void 0),this.current=n,this.total=o}}class LF extends Gn{static create(n,o){return new LF(n,o)}constructor(n,o){super("visibleChanged"),W(this,"newVisibility",void 0),W(this,"oldVisibility",void 0),this.newVisibility=n,this.oldVisibility=o}}class NF extends Gn{static create(n,o,h){return new NF(n,o,h)}constructor(n,o,h){super("openDocument"),W(this,"doc",void 0),W(this,"viewerUid",void 0),W(this,"groupUid",void 0),this.doc=n,this.viewerUid=o,this.groupUid=h}}class BF extends Gn{static create(n,o,h){return new BF(n,o,h)}constructor(n,o,h){super("closeDocument"),W(this,"doc",void 0),W(this,"viewerUid",void 0),W(this,"groupUid",void 0),this.doc=n,this.viewerUid=o,this.groupUid=h}}class WF extends Gn{static create(n,o,h,v){return new WF(n,o,h,v)}constructor(n,o,h,v){super("gotoPage"),W(this,"docUid",void 0),W(this,"groupUid",void 0),W(this,"viewerUid",void 0),W(this,"index",void 0),this.docUid=n,this.groupUid=o,this.viewerUid=h,this.index=v}}class X2 extends Gn{static create(n){return new X2(n)}constructor(n){super("cameraInit"),W(this,"enableConvert",void 0),this.enableConvert=n}}class UF extends Gn{static create(n,o,h,v){return new UF(n,o,h,v)}constructor(n,o,h,v){super("selectPages"),W(this,"docUid",void 0),W(this,"groupUid",void 0),W(this,"viewerUid",void 0),W(this,"indices",void 0),this.docUid=n,this.groupUid=o,this.viewerUid=h,this.indices=v}}class $2 extends Gn{static create(n,o,h){return new $2(n,o,h)}constructor(n,o,h){super("filterChanged"),W(this,"docUid",void 0),W(this,"pageUids",void 0),W(this,"filterType",void 0),this.docUid=n,this.pageUids=o,this.filterType=h}}class q2 extends Gn{static create(n,o,h,v){return new q2(n,o,h,v)}constructor(n,o,h,v){super("currentChangedByScroll"),W(this,"docUid",void 0),W(this,"groupUid",void 0),W(this,"viewerUid",void 0),W(this,"current",void 0),this.docUid=n,this.groupUid=o,this.viewerUid=h,this.current=v}}class K2 extends Gn{static create(n,o,h){return new K2(n,o,h)}constructor(n,o,h){super("rotatePages"),W(this,"docUid",void 0),W(this,"angle",void 0),W(this,"pageUids",void 0),this.docUid=n,this.angle=o,this.pageUids=h}}class J2 extends Gn{static create(n,o,h){return new J2(n,o,h)}constructor(n,o,h){super("cropPages"),W(this,"docUid",void 0),W(this,"rect",void 0),W(this,"pageUids",void 0),this.docUid=n,this.rect=o,this.pageUids=h}}class K_ extends Gn{static create(n,o){return new K_(n,o)}constructor(n,o){super("perspectiveQuadChanged"),W(this,"quad",void 0),W(this,"isFull",void 0),this.quad=n,this.isFull=o}}class ww extends Gn{static create(n){return new ww(n)}constructor(n){super("deletePages"),W(this,"pageUids",void 0),this.pageUids=n}}class VF extends Gn{static create(n,o,h){return new VF(n,o,h)}constructor(n,o,h){super("operationsChanged"),W(this,"docUid",void 0),W(this,"undo",void 0),W(this,"redo",void 0),this.docUid=n,this.undo=o,this.redo=h}}class jF extends Gn{static create(n,o,h,v,y){return new jF(n,o,h,v,y)}constructor(n,o,h,v,y){super("perspective"),W(this,"docUid",void 0),W(this,"pageUid",void 0),W(this,"quad",void 0),W(this,"width",void 0),W(this,"height",void 0),this.docUid=n,this.pageUid=o,this.quad=h,this.width=v,this.height=y}}class HF extends Gn{static create(n){return new HF(n)}constructor(n){super("pageExistenceChanged"),W(this,"pageCount",void 0),this.pageCount=n}}class GF extends Gn{static create(n){return new GF(n)}constructor(n){super("deleteDocs"),W(this,"docUids",void 0),this.docUids=n}}class Q2 extends Gn{static create(n,o,h,v){return new Q2(n,o,h,v)}constructor(n,o,h,v){super("pagePreloadChanged"),W(this,"docUid",void 0),W(this,"viewerUid",void 0),W(this,"viewerMode",void 0),W(this,"changes",void 0),this.docUid=n,this.viewerUid=o,this.viewerMode=h,this.changes=v}}class zF extends Gn{static create(n){return new zF(n)}constructor(n){super("viewerCreated"),W(this,"viewer",void 0),this.viewer=n}}class YF extends Gn{static create(n,o){return new YF(n,o)}constructor(n,o){super("annotationsUpdated"),W(this,"uids",void 0),W(this,"actions",void 0),this.uids=n,this.actions=o}}class XF extends Gn{static create(n,o,h,v){return new XF(n,o,h,v)}constructor(n,o,h,v){super("copyPage"),W(this,"pageUid",void 0),W(this,"fileUid",void 0),W(this,"fileIndex",void 0),W(this,"annotations",void 0),this.pageUid=n,this.fileUid=o,this.fileIndex=h,this.annotations=v}}let cee=0;const uee=()=>{const p=`doc-${Date.now().toString()}-${cee.toString()}`;return cee+=1,p};function hc(p){if(p||(p=`D:${pQ("yyyyMMddhhmmss")}`),/[+-]\d{2}'\d{2}'$/.test(p))return p;const n=-(new Date).getTimezoneOffset();return`${p}${n>=0?"+":"-"}${String(Math.floor(Math.abs(n)/60)).padStart(2,"0")}'${String(Math.abs(n)%60).padStart(2,"0")}'`}class uPe{constructor(){var n,o;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};W(this,"type",void 0),W(this,"uid",void 0),W(this,"name",void 0),W(this,"pages",void 0),W(this,"tags",void 0),W(this,"creationDate",void 0),W(this,"author",void 0),W(this,"isDestroyed",void 0),W(this,"pageSize",void 0),this.uid=Ai(),this.name=null!==(n=h.name)&&void 0!==n?n:uee(),this.type=h.type||"document",this.pages=[],this.tags=h.tags||[],this.creationDate=hc(h.creationDate),this.author=null!==(o=h.author)&&void 0!==o?o:"",this.pageSize="none"}dispose(){this.isDestroyed=!0}}class dPe{constructor(){W(this,"users",void 0),this.users=[]}addUser(n){this.users.push(n)}deleteUser(n){const o=this.users.indexOf(n);o>-1&&this.users.splice(o,1)}}var dee;!function(p){p.IMAGE_PNG="image/png",p.IMAGE_JPEG="image/jpeg",p.IMAGE_BMP="image/bmp",p.IMAGE_TIFF="image/tiff",p.IMAGE_JP2="image/jp2",p.APPLICATION_PDF="application/pdf"}(dee||(dee={}));class hPe{constructor(n){let{uid:o,mime:h,pageCount:v}=n;W(this,"uid",void 0),W(this,"mime",void 0),W(this,"pageCount",void 0),W(this,"name",void 0),W(this,"count",void 0),W(this,"pages",void 0),this.uid=o,this.mime=h,this.count=0,this.pages=[],this.pageCount=v;for(let y=0;y<v;y++){const _=new dPe;this.pages.push(_)}}getPageByIndex(n){return this.pages[n]}addUser(n,o){const h=this.pages[n];return!!h&&(h.addUser(o),this.count+=1,!0)}deleteUser(n,o){const h=this.pages[n];return!!h&&(h.deleteUser(o),this.count-=1,!0)}}function hee(p,n,o,h){if(0==(n=(n%360+360)%360))return p;const v=n/90;for(let y=0;y<4;y++){const _=p[2*y],b=p[2*y+1];1===v?(p[2*y]=b,p[2*y+1]=h-_):2===v?(p[2*y]=o-_,p[2*y+1]=h-b):3===v&&(p[2*y]=o-b,p[2*y+1]=_)}return fee(p,8-2*v),p}function $F(p,n,o,h){if(0==(n=(n%360+360)%360))return p;const v=n/90;for(let y=0;y<4;y++){const _=p[2*y],b=p[2*y+1];1===v?(p[2*y]=h-b,p[2*y+1]=_):2===v?(p[2*y]=o-_,p[2*y+1]=h-b):3===v&&(p[2*y]=b,p[2*y+1]=o-_)}return fee(p,2*v),p}function qF(p,n,o){for(;n<o;){const h=p[n];p[n]=p[o],p[o]=h,n+=1,o-=1}}function fee(p,n){const o=n%p.length;0!==o&&(qF(p,0,p.length-1),qF(p,0,o-1),qF(p,o,p.length-1))}const Z2=p=>Array(4).fill(0).map((n,o)=>[p[2*o],p[2*o+1]]),pee=(p,n,o)=>0===p[0][0]&&0===p[0][1]&&p[1][0]===n&&0===p[1][1]&&p[2][0]===n&&p[2][1]===o&&0===p[3][0]&&p[3][1]===o;class nf{constructor(n){W(this,"data",void 0),W(this,"width",void 0),W(this,"height",void 0),W(this,"url",void 0),W(this,"img",void 0),W(this,"users",void 0),W(this,"isDestroyed",void 0),W(this,"isAvailable",void 0),W(this,"pageWidth",void 0),W(this,"pageHeight",void 0),W(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=n}getImageDetail(){const{docPage:n}=this;return{data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:n.resolutionX,resolutionY:n.resolutionY,url:this.url,img:this.img}}getPageSize(){return{width:this.pageWidth,height:this.pageHeight}}updateImageDetail(n){if(!n)return;n.data&&(this.isAvailable=!0,this.data=n.data);const{docPage:o}=this;this.width=n.width,this.height=n.height,this.pageWidth=n.width/o.resolutionX*jn.displayResolution,this.pageHeight=n.height/o.resolutionY*jn.displayResolution}addUser(n){this.getUserIndex(n)<0&&this.users.push(n)}deleteUser(n){const o=this.getUserIndex(n);o>-1&&this.users.splice(o,1)}hasUser(){return!!this.users.length}reset(){this.resetBlob(),this.resetImg()}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null}getUserIndex(n){return this.users.findIndex(o=>{let{viewerUid:h,docUid:v,pageUid:y}=o;return h===n.viewerUid&&v===n.docUid&&y===n.pageUid})}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset()}}function gee(p){const n=function(y){[...y].sort((V,B)=>B[1]-V[1]);let b=Number.MAX_SAFE_INTEGER,w=0;y.forEach((V,B)=>{V[1]<b&&([,b]=V,w=B)});const I=(w+3)%4,A=(w+1)%4,M=mee(y[I],y[w]);return mee(y[A],y[w])>M?I:w}(p),o=p.map((y,_)=>{let b=p[_+1];return 3===_&&([b]=p),vee(b,y)});let h=Math.max(o[n],o[(n+2)%4]),v=Math.max(o[(n+1)%4],o[(n+3)%4]);return h=Math.round(h),v=Math.round(v),{width:h,height:v}}function mee(p,n){const o=Math.abs(p[0]-n[0]),h=vee(p,n);return Math.acos(o/h)}function vee(p,n){return((p[0]-n[0])**2+(p[1]-n[1])**2)**.5}const sm=p=>{!p||p.forEach(n=>{const o=Math.ceil(n[0]);n[0]=o-n[0]<=1e-7?o:Math.floor(n[0]);const h=Math.ceil(n[1]);n[1]=h-n[1]<=1e-7?h:Math.floor(n[1])})};function Sw(p,n,o,h){n=(n%360+360)%360;const v=Ke({},p),{left:y,top:_,width:b,height:w}=p,I=Math.floor(n/90);return 1===I?(v.left=h-_-w,v.top=y):2===I?(v.left=o-y-b,v.top=h-_-w):3===I&&(v.left=_,v.top=o-y-b),I%2>0&&(v.width=w,v.height=b),v}class eD{constructor(n,o){let{fileIndex:h,pageUid:v,fileUid:y,rotation:_,filter:b,perspectiveQuad:w,annotations:I,pdfOptions:A,resource:M,cropBox:F,mediaBox:V,pageSize:B}=n;W(this,"uid",void 0),W(this,"doc",void 0),W(this,"metadata",void 0),W(this,"customData",void 0),W(this,"fileUid",void 0),W(this,"fileIndex",void 0),W(this,"resolutionX",void 0),W(this,"resolutionY",void 0),W(this,"filter",void 0),W(this,"rotation",void 0),W(this,"quad",void 0),W(this,"activeQuad",void 0),W(this,"isFull",void 0),W(this,"raw",void 0),W(this,"original",void 0),W(this,"display",void 0),W(this,"thumbnail",void 0),W(this,"editedDisplay",void 0),W(this,"initRotation",void 0),W(this,"editRotation",void 0),W(this,"actionRotation",void 0),W(this,"actions",void 0),W(this,"pActions",void 0),W(this,"actionResult",void 0),W(this,"pActionResult",void 0),W(this,"isDestroyed",void 0),W(this,"annotations",void 0),W(this,"pageSize",void 0),W(this,"cropBox",void 0),W(this,"mediaBox",void 0),W(this,"resource",void 0),W(this,"editCaches",void 0),W(this,"pdfOptions",void 0),W(this,"initState",void 0),this.uid=v,this.doc=o,this.annotations=I||[],this.resolutionX=M.resolutionX,this.resolutionY=M.resolutionY,this.fileIndex=h,this.fileUid=y,this.pageSize=null!=B?B:"none",this.resource=M,"none"===this.pageSize&&(this.mediaBox=Ke({},V),this.cropBox=Ke({},F)),this.filter=b,this.rotation=_||0,this.initRotation=_||0,this.editRotation=_||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=A,this.raw=new nf(this),this.original=new nf(this),this.display=new nf(this),this.thumbnail=new nf(this),this.editedDisplay=new nf(this);let Q={width:M.width,height:M.height};if(this.raw.updateImageDetail(Q),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:_},w){Q=gee(w),this.mediaBox={left:0,top:0,width:Kn(Q.width,M.resolutionX,jn.displayResolution),height:Kn(Q.height,M.resolutionY,jn.displayResolution)},this.cropBox=Ke({},this.mediaBox);const J=this.quadToDisplayPPI(w);this.setQuad(J)}this.original.updateImageDetail(Q),this.display.updateImageDetail(Q),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map}isMediaBoxEqualCropBox(){const{mediaBox:n,cropBox:o}=this;return n.left===o.left&&n.top===o.top&&n.width===o.width&&n.height===o.height}getPageSize(){return"inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(n,o){const h=new eD({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:n,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&pn(this.pdfOptions),mediaBox:pn(this.mediaBox),cropBox:pn(this.cropBox),resource:pn(this.resource),annotations:[]},o),v=pn(this.actions);v.forEach(b=>{b.docUid=o.uid});const y=pn(this.pActions);y.forEach(b=>{b.docUid=o.uid}),h.actions=v,h.pActions=y,h.initRotation=this.initRotation,h.actionRotation=this.actionRotation,h.editRotation=this.editRotation,h.quad=pn(this.quad),h.activeQuad=pn(this.activeQuad),h.isFull=this.isFull,h.actionResult=new Map(this.actionResult),h.pActionResult=new Map(this.pActionResult);const _={width:this.mediaBox.width||this.display.width||h.raw.width,height:this.mediaBox.height||this.display.height||h.raw.height};return h.original.updateImageDetail(_),h.display.updateImageDetail(_),h}setQuad(n){const o=this.isQuadFull(n);let h=!1;if(this.isFull=o,o)this.quad&&(h=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else{const{width:v,height:y}=this.raw.getPageSize(),_=hee(n.flat(),this.rotation,v,y),b=Z2(_);let w,I;this.quad&&(I=this.quadToPixelPPI(b),w=this.quadToPixelPPI(this.quad),sm(w),sm(I)),this.quad&&o5(w,I)||(this.quad=b,this.activeQuad=b,h=!0),this.editRotation=this.actionRotation}return h&&this.clearActions(),h}setActiveQuad(n){const{width:o,height:h}=this.raw.getPageSize();if(!this.isFull){const v=hee(n.flat(),this.rotation,o,h),y=Z2(v);this.activeQuad=y}}getQuadVertices(){let n;const{width:o,height:h}=this.raw.getPageSize();return n=this.isFull?[0,0,o,0,o,h,0,h]:this.activeQuad.flat(),n=$F(n,this.rotation,o,h),n}getProcessedQuad(){if(this.quad){let{width:n,height:o}=this.raw.getPageSize(),{quad:h}=this;h=this.quad.map(y=>[this.toPixelPPI(y[0],!1),this.toPixelPPI(y[1],!0)]),n=this.toPixelPPI(n,!1),o=this.toPixelPPI(o,!0);const v=$F(h.flat(),this.initRotation,n,o);return Z2(v)}return null}toggleFull(){let n=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,n=!0):this.isFull||(this.isFull=!0,n=!0),n}isQuadFull(n){let{width:o,height:h}=this.raw.getPageSize();const v=Math.abs((this.rotation%360+360)%360);if(90===v||270===v){const y=o;o=h,h=y}return pee(n,o,h)}getEditResultForPixel(){const n=this.getEditResult();return{rWidth:this.toPixelPPI(n.rWidth,!1),rHeight:this.toPixelPPI(n.rHeight,!0),cropLeft:this.toPixelPPI(n.cropLeft,!1),cropTop:this.toPixelPPI(n.cropTop,!0),cropWidth:this.toPixelPPI(n.cropWidth,!1),cropHeight:this.toPixelPPI(n.cropHeight,!0),rotation:n.rotation}}getEditResult(){if(!this.actions.length){const y=Sw(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return{rWidth:y.width,rHeight:y.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:Ke({},this.mediaBox),cropBox:Ke({},this.cropBox)}}const n=this.actions[this.actions.length-1],{rotatedCropBox:o,cropBox:h,rotation:v}=this.actionResult.get(n.actionUid).to;return{rWidth:o.width,rHeight:o.height,cropLeft:h.left,cropTop:h.top,cropWidth:h.width,cropHeight:h.height,rotation:v,mediaBox:Ke({},this.mediaBox),cropBox:Ke({},h)}}getEditResultForPerspective(){const n=this.raw.getPageSize(),o={left:0,top:0,width:n.width,height:n.height};if(!this.pActions.length){const b=Sw(o,this.rotation,o.width,o.height);return{rWidth:b.width,rHeight:b.height,cropLeft:0,cropTop:0,cropWidth:n.width,cropHeight:n.height,rotation:this.rotation,cropBox:Ke({},o),mediaBox:o}}const h=this.pActions[this.pActions.length-1],{rotatedCropBox:v,cropBox:y,rotation:_}=this.pActionResult.get(h.actionUid).to;return{rWidth:v.width,rHeight:v.height,cropLeft:y.left,cropTop:y.top,cropWidth:y.width,cropHeight:y.height,rotation:_,mediaBox:o,cropBox:Ke({},y)}}getActions(){return[...this.actions]}getPerspectiveActions(){return this.pActions}addAction(n){let o=null;if(this.actions.length){const h=this.actionResult.get(this.actions[this.actions.length-1].actionUid);o={mediaBox:Ke({},h.to.mediaBox),cropBox:Ke({},h.to.cropBox),rotation:h.to.rotation,rotatedCropBox:Ke({},h.to.rotatedCropBox)}}else o={mediaBox:Ke({},this.mediaBox),cropBox:Ke({},this.cropBox),rotation:this.rotation,rotatedCropBox:Ke({},this.cropBox)};if(this.actions.push(n),!this.actionResult.has(n.actionUid)){const h=function(v,y,_,b){let w=Ke({},v);const I=y.left+y.width,A=y.top+y.height;let M=_,F=Sw(v,M,I,A);if("rotate"===b.type)M+=b.angle,F=Sw(v,M,I,A);else if("crop"===b.type){const V=b.rect;F={left:V.left+F.left,top:V.top+F.top,width:V.width,height:V.height},w=function(B,Q,J,Z){Q=(Q%360+360)%360;const re=Ke({},B),{left:se,top:ce,width:pe,height:Ce}=B,Ve=Math.floor(Q/90);return 1===Ve?(re.left=ce,re.top=Z-pe-se):2===Ve?(re.left=J-pe-se,re.top=Z-Ce-ce):3===Ve&&(re.left=J-Ce-ce,re.top=se),Ve%2>0&&(re.width=Ce,re.height=pe),re}(F,M,I,A)}return{rotatedCropBox:F,cropBox:w,mediaBox:y,rotation:M}}(o.cropBox,this.mediaBox,this.rotation,n);this.actionResult.set(n.actionUid,{from:o,to:h}),this.cropBox=Ke({},h.cropBox),this.mediaBox=Ke({},h.mediaBox)}if("rotate"===n.type){let h=null;const{width:v,height:y}=this.raw.getPageSize(),_={left:0,top:0,width:v,height:y};if(this.pActions.length){const b=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);h={mediaBox:Ke({},b.to.mediaBox),cropBox:Ke({},b.to.cropBox),rotation:b.to.rotation,rotatedCropBox:Ke({},b.to.rotatedCropBox)}}else h={mediaBox:Ke({},_),cropBox:Ke({},_),rotation:this.rotation,rotatedCropBox:Ke({},_)};if(this.pActions.push(n),!this.pActionResult.has(n.actionUid)){const b=function(w,I,A,M){const F=A+M.angle;return{rotatedCropBox:Sw(w,F,I.left+I.width,I.top+I.height),cropBox:w,mediaBox:I,rotation:F}}({left:0,top:0,width:v,height:y},{left:0,top:0,width:v,height:y},this.rotation,n);this.pActionResult.set(n.actionUid,{from:h,to:b})}this.rotation+=n.angle}}deleteAction(n){var o,h;if((null===(o=this.actions[this.actions.length-1])||void 0===o?void 0:o.actionUid)===n){this.actions.pop();const v=this.actionResult.get(n);this.cropBox=Ke({},v.from.cropBox),this.mediaBox=Ke({},v.from.mediaBox),this.rotation=v.from.rotation,this.actionResult.delete(n)}(null===(h=this.pActions[this.pActions.length-1])||void 0===h?void 0:h.actionUid)===n&&(this.pActions.pop(),this.pActionResult.delete(n))}clearActions(){this.actions=[]}toDisplayPPI(n,o){const{resolutionX:h,resolutionY:v}=this;return o?n/v*jn.displayResolution:n/h*jn.displayResolution}toPixelPPI(n,o){const{resolutionX:h,resolutionY:v}=this;return o?n*v/jn.displayResolution:n*h/jn.displayResolution}quadToDisplayPPI(n){const o=pn(n);for(let h=0;h<4;h++)o[h][0]=this.toDisplayPPI(o[h][0],!1),o[h][1]=this.toDisplayPPI(o[h][1],!0);return o}quadToPixelPPI(n){const o=pn(n);for(let h=0;h<4;h++)o[h][0]=this.toPixelPPI(o[h][0],!1),o[h][1]=this.toPixelPPI(o[h][1],!0);return o}rectToDisplayPPI(n){const o=Ke({},n);return o.left=this.toDisplayPPI(n.left,!1),o.top=this.toDisplayPPI(n.top,!0),o.width=this.toDisplayPPI(n.width,!1),o.height=this.toDisplayPPI(n.height,!0),o}rectToPixelPPI(n){const o=Ke({},n);return o.left=this.toPixelPPI(n.left,!1),o.top=this.toPixelPPI(n.top,!0),o.width=this.toPixelPPI(n.width,!1),o.height=this.toPixelPPI(n.height,!0),o}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0}getAnnotationUids(){return[...this.annotations]}}class fPe extends or{constructor(){super(),W(this,"uid",void 0),W(this,"emitter",void 0),W(this,"repo",void 0),W(this,"onDocumentCreated",Dt(this)),W(this,"onDocumentDeleted",Dt(this)),W(this,"onDocumentRenamed",Dt(this)),W(this,"onPagesAdded",Dt(this)),W(this,"onAddPagesToDoc",Dt(this)),W(this,"onBeforeDeletePagesFromDoc",Dt(this)),W(this,"onDeletePagesFromDoc",Dt(this)),W(this,"onBeforeDeleteAllPagesFromDoc",Dt(this)),W(this,"onDeleteAllPagesFromDoc",Dt(this)),W(this,"onMovePages",Dt(this)),W(this,"onSwitchPage",Dt(this)),W(this,"onReorderPages",Dt(this)),W(this,"onBeforeDeleteDocs",Dt(this)),W(this,"onAfterDeleteDocs",Dt(this)),W(this,"onOpenDocument",Dt(this)),W(this,"onCloseDocument",Dt(this)),this.emitter=new Yh,this.uid=Ai(),this.repo=new Map}dispose(){this.repo.forEach(n=>n.dispose()),this.repo.clear(),super.dispose()}reset(){this.repo.clear()}createDocument(){const n=new uPe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(n.uid,n);const o=H2.create(n.uid,n.name);return this.onDocumentCreated.emit(o),n}getDocument(n){return this.repo.get(n)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(n,o){const h=this.repo.get(n);if(!h)return!1;const v=DF.create(n,h.name,o);return h.name=o,this.onDocumentRenamed.emit(v),!0}deleteDocuments(n){return n.forEach(o=>{const h=this.getDocument(o);h.dispose(),this.repo.delete(o);const v=H2.create(o,h.name);this.onDocumentDeleted.emit(v)}),!0}addPagesToDocument(n,o,h){const v=this.repo.get(n);if(!v)return!1;const{length:y}=o,_=[];let b=v.pages.length;$t(h)?(v.pages.splice(h,0,...o),b=h):v.pages.push(...o);for(let I=0;I<y;I++)_.push(b+I);const w=TF.create(n,o,_,h);return this.onAddPagesToDoc.emit(w),!0}removePagesFromDocument(n,o){const h=this.getDocument(n);if(!h)return!1;const v=o.map(_=>h.pages.indexOf(_));o.forEach(_=>{CQ(h.pages,_)});const y=G2.create(n,o,v);return this.onBeforeDeletePagesFromDoc.emit(y),this.onDeletePagesFromDoc.emit(y),!0}removeAllPagesFromDocument(n){const o=this.getDocument(n);if(!o)return!1;const h=[...o.pages.keys()],v=[...o.pages];o.pages.length=0;const y=G2.create(n,v,h);return this.onBeforeDeleteAllPagesFromDoc.emit(y),this.onDeleteAllPagesFromDoc.emit(y),!0}movePages(n,o,h){const v=this.repo.get(n);if(!v)return!1;bQ(v.pages,o,h);const y=EF.create(n,o,h);return this.onMovePages.emit(y),!0}swapPages(n,o,h){const v=this.repo.get(n);if(!v)return!1;xQ(v.pages,o,h);const y=PF.create(n,o,h);return this.onSwitchPage.emit(y),!0}reorderPages(n,o){const h=this.repo.get(n);if(!h)return!1;wQ(h.pages,o);const v=AF.create(n,o);return this.onReorderPages.emit(v),!0}}class yee{on(n,o){}emit(n){}}(new yee).on("debug",function(){});class pPe{constructor(){W(this,"undoStack",void 0),W(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[]}getOperation(){return{undo:this.undoStack.length,redo:this.redoStack.length}}execute(n){return!!n.execute()&&(this.undoStack.push(n),this.redoStack.length>0&&(this.redoStack.forEach(o=>{o.dispose()}),this.redoStack.length=0),!0)}undo(){const n=this.undoStack.pop();return n&&(n.undo(),this.redoStack.push(n)),!!n}redo(){const n=this.redoStack.pop();return n&&(n.execute(),this.undoStack.push(n)),!!n}removeUidsFromCommand(n){this.removeFromStack(this.undoStack,n),this.removeFromStack(this.redoStack,n)}removeFromStack(n,o){n.slice().forEach(h=>{if(!h.isValid){const v=n.indexOf(h);n.splice(v,1),h.dispose()}})}reset(){this.undoStack.forEach(n=>{n.dispose()}),this.redoStack.forEach(n=>{n.dispose()}),this.undoStack=[],this.redoStack=[]}}class gPe extends or{constructor(){super(),W(this,"invokers",void 0),W(this,"onOperationsChanged",Dt(this)),W(this,"onBeforeRefreshCommands",Dt(this)),W(this,"onRefreshCommands",Dt(this)),this.invokers=new Map}createInvoker(n){if(!this.invokers.has(n)){const o=new pPe;this.invokers.set(n,o)}}deleteInvokers(n){n.forEach(o=>{if(this.invokers.has(o)){const h=this.invokers.get(o);null==h||h.reset(),this.invokers.delete(o)}})}execute(n,o){const h=this.invokers.get(o);null!=h&&h.execute(n)&&this.emitOperationsChanged(o)}undo(n){const o=this.invokers.get(n),h=!(null==o||!o.undo());return h&&this.emitOperationsChanged(n),h}redo(n){const o=this.invokers.get(n),h=!(null==o||!o.redo());return h&&this.emitOperationsChanged(n),h}saveOperations(n){const o=this.invokers.get(n);return!!o&&(o.reset(),this.emitOperationsChanged(n),!0)}getOperationState(n){return this.invokers.get(n).getOperation()}removePageFromCommand(n,o){this.onBeforeRefreshCommands.emit({docUid:n,pageUids:o}),this.invokers.get(n).removeUidsFromCommand(o),this.emitOperationsChanged(n)}emitOperationsChanged(n){const o=this.invokers.get(n);let h=0,v=0;if(o){const _=o.getOperation();h=_.undo,v=_.redo}const y=VF.create(n,h,v);this.onOperationsChanged.emit(y)}dispose(){this.invokers.clear(),super.dispose()}reset(){this.invokers.forEach(n=>{n.reset()}),this.invokers.clear()}}class mPe extends or{constructor(){super(),W(this,"files",void 0),W(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=Dt(this)}dispose(){this.files.clear(),super.dispose()}reset(){this.files.clear()}addFile(n,o,h){const v=new hPe({uid:n,mime:o,pageCount:h});this.files.set(n,v)}getByUid(n){return this.files.get(n)}addUser(n,o,h){const v=this.getByUid(n);return null==v?void 0:v.addUser(o,h)}addUsersByParsedPages(n,o){o.forEach(h=>{this.addUser(n,h.fileIndex,h.pageUid)})}deleteUser(n,o,h){const v=this.getByUid(n);return v&&(v.deleteUser(o,h),v.count||(this.onDeleteFileData.emit(n),this.files.delete(n))),!1}}class vPe extends or{constructor(n){super(),W(this,"pages",void 0),W(this,"core",void 0),W(this,"onUpdatePage",Dt(this)),W(this,"onCreatePage",Dt(this)),W(this,"onCopyPage",Dt(this)),W(this,"onDeletePages",Dt(this)),W(this,"onBeforeDeletePages",Dt(this)),W(this,"onAfterDeletePages",Dt(this)),W(this,"onBeforeCopyPages",Dt(this)),W(this,"onCopyPages",Dt(this)),this.core=n,this.pages=new Map}handlePagePreloadChange(n){let{viewerUid:o,viewerMode:h,docUid:v,changes:y}=n;y.forEach(_=>{let{pageUid:b,from:w,to:I}=_;const A=this.getPage(b),M={viewerUid:o,docUid:v,pageUid:b},{autoReleaseBlob:F,autoReleaseImg:V}=jn;w&&!I?(A.raw.deleteUser(M),A.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(b),this.core.parserService.cancelGetPage(A.fileUid,A.fileIndex),F&&A.raw.resetBlob(),V&&A.raw.resetImg()),h!==Ko.DEFAULT&&h!==Ko.THUMBNAIL||(A.original.deleteUser(M),A.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(b),F&&A.original.resetBlob(),V&&A.original.resetImg()),A.display.deleteUser(M),A.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(b),F&&A.display.resetBlob(),V&&A.display.resetImg())),h===Ko.THUMBNAIL&&(A.thumbnail.deleteUser(M),A.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(b),F&&A.thumbnail.resetBlob(),V&&A.thumbnail.resetImg())),A.raw.hasUser()||this.core.parserService.cancelGetPage(A.fileUid,A.fileIndex)):(A.raw.addUser(M),h!==Ko.DEFAULT&&h!==Ko.THUMBNAIL||(A.original.addUser(M),A.display.addUser(M)),h===Ko.THUMBNAIL&&A.thumbnail.addUser(M))})}dispose(){this.pages.clear(),super.dispose()}reset(){this.pages.clear()}getPage(n){return this.pages.get(n)}createPagesByParsedPages(n,o,h,v){n.forEach((y,_)=>{this.createPage(zt(Ke({},y),{fileUid:h,annotations:o[_]}),v)})}createPage(n,o){const h=new eD(n,o);this.pages.set(h.uid,h);const v=IF.create(n.pageUid,n.fileUid,n.fileIndex);return this.onCreatePage.emit(v),h}copyPage(n,o,h){const v=h.copy(n,o);return this.pages.set(v.uid,v),XF.create(n,v.fileUid,v.fileIndex,h.annotations.slice()),v}deletePages(n){const o=ww.create(n);this.onBeforeDeletePages.emit(o),n.forEach(h=>{const v=this.pages.get(h);v&&v.dispose(),this.pages.delete(h)}),this.onDeletePages.emit(o),this.onAfterDeletePages.emit(o)}updatePage(n,o){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const v=this.pages.get(n);if(v){const{doc:y,customData:_}=v;v.dispose();const b=new eD(zt(Ke({},h),{pageUid:n}),y);b.customData=_,this.pages.set(n,b);const w=RF.create(y.uid,n,o);this.onUpdatePage.emit(w)}}getPageCount(){return this.pages.size}}var KF=new WeakSet;class yPe{constructor(n){dl(this,KF),W(this,"core",void 0),W(this,"annotationMapper",void 0),this.core=n,this.annotationMapper=new GZ}reset(){}saveToPng(n,o){var h=this;return Fe(function*(){const v=h.core.pageService.getPage(n);if(!v)return Promise.resolve(null);const y=yield h.core.getPageData(n,{display:!0,renderAnnotation:!(null==o||!o.saveAnnotation)});if((null==o||!o.saveAnnotation)&&y.fileData&&"image/png"===y.fileData.type&&!lt(KF,h,_ee).call(h,v))return y.fileData;const _=h.core.saverService.getSaver("image/png");try{return yield _.save(y.display.data,{outputType:3})}finally{_.destroy()}})()}saveToJpeg(n,o){var h=this;return Fe(function*(){const v=h.core.pageService.getPage(n);if(!v)return Promise.resolve(null);const y=yield h.core.getPageData(n,{display:!0,renderAnnotation:!(null==o||!o.saveAnnotation)});if((null==o||!o.saveAnnotation)&&y.fileData&&"image/jpeg"===y.fileData.type&&!lt(KF,h,_ee).call(h,v))return y.fileData;const _=h.core.saverService.getSaver("image/jpeg");try{return yield _.save(y.display.data,{outputType:1,jpegQuality:null==o?void 0:o.quality})}finally{_.destroy()}})()}saveToTiff(n,o){var h=this;return Fe(function*(){const v=h.core.saverService.getSaver("image/tiff"),y=!(null==o||!o.saveAnnotation);try{yield v.init(o);for(let _=0;_<n.length;_++){const b=n[_];if(!h.core.pageService.getPage(b))break;const w=yield h.core.getPageData(b,{display:!0,renderAnnotation:y});yield v.appendPage(w.display.data)}return yield v.getTiff()}finally{v.destroy()}})()}saveToPdf(n,o){var h=this;return Fe(function*(){null!=o&&o.creationDate&&(o.creationDate=hc(o.creationDate)),null!=o&&o.modifiedDate&&(o.modifiedDate=hc(o.modifiedDate)),!o||"annotation"!==o.saveAnnotation&&"flatten"!==o.saveAnnotation||xi.makeSureAnnotationLicenseExist();const v=h.core.saverService.getSaver("application/pdf");try{yield v.init(o);const A=new Map,M=o&&o.pageType&&o.pageType!==No.PAGE_DEFAULT;let F=0;for(let B=0;B<n.length;B++){var y,_;const Q=n[B],J=h.core.pageService.getPage(Q);if(!J)break;const Z=yield h.core.getPageData(Q,{raw:!0,display:!0,renderAnnotation:"image"===(null==o?void 0:o.saveAnnotation)}),re=yield h.core.imageDataService.getNotRotatedDisplay(Q,"image"===(null==o?void 0:o.saveAnnotation)),se=M||(null===(y=J.pdfOptions)||void 0===y?void 0:y.convertMode)===ml.CM_IMAGEONLY||(null===(_=J.pdfOptions)||void 0===_?void 0:_.renderOptions.renderGrayscale),ce=[],pe=[];if(Z.fileData&&"application/pdf"===Z.fileData.type&&!se)for(let Ce=B;Ce<n.length;Ce++){var b,w;const Ve=n[Ce],te=h.core.pageService.getPage(Ve);if(!te||te.fileUid!==J.fileUid||!te.isFull||"image"===(null==o?void 0:o.saveAnnotation)&&te.annotations.length>0||(null===(b=te.pdfOptions)||void 0===b?void 0:b.convertMode)===ml.CM_IMAGEONLY||null!==(w=te.pdfOptions)&&void 0!==w&&w.renderOptions.renderGrayscale)break;let Me=!1;te.filter&&"none"!==te.filter&&(Me=!0);const we=te.getActions(),Le=te.getPerspectiveActions();we.every(L=>"rotate"===L.type||"crop"===L.type)&&Le.every(L=>"rotate"===L.type||"crop"===L.type)||(Me=!0);let j=!1;if(Me&&h.core.getAnnotationsByPageUid(n[B]).forEach(L=>{L.oriIndex>=0&&!L.modified&&(j=!0)}),Me&&!j)break;A.set(F+ce.length,{mediaBox:te.mediaBox,cropBox:te.cropBox,rotation:te.rotation}),ce.push(te.fileIndex),j&&pe.push({pageUid:Ve,pageIndex:Ce})}if(ce.length>0){var I;const Ce=null===(I=(yield h.core.sourceStore.get(J.fileUid)).loadOptions)||void 0===I?void 0:I.password;yield v.appendRawPdfPages(Z.fileData,Ce,ce),B+=ce.length-1,F+=ce.length;for(let Ve=0;Ve<pe.length;Ve++){const te=yield h.core.imageDataService.getNotRotatedDisplay(pe[Ve].pageUid,"image"===(null==o?void 0:o.saveAnnotation));yield v.changePageImage(pe[Ve].pageIndex,te.data,{cropBox:J.cropBox,mediaBox:J.mediaBox,rotation:J.rotation,width:re.width,height:re.height})}}else yield v.appendImagePage(re.data,{cropBox:J.cropBox,mediaBox:J.mediaBox,rotation:J.rotation,width:re.width,height:re.height}),F+=1}A.size>0&&(yield v.setPageInfo(A));const V=[];for(let B=0;B<n.length;B++)if(!o||"annotation"!==o.saveAnnotation&&"flatten"!==o.saveAnnotation)yield v.removePageAnnotations(B);else{const Q=h.core.pageService.getPage(n[B]);if(!Q)continue;const J=Q.pdfOptions&&Q.pdfOptions.convertMode===ml.CM_RENDERALL&&Q.pdfOptions.renderOptions.renderAnnotations===Jh.RENDER_ANNOTATIONS,Z=h.core.getAnnotationsByPageUid(n[B]);if(!Z.length){J||(yield v.removePageAnnotations(B));continue}Z.forEach(se=>{!["textBox","textTypewriter"].includes(se.type)||!se.modified&&$t(null==se?void 0:se.oriIndex)||se.style.textContents.forEach(ce=>{V.push({family:ce.fontFamily,isBlob:"bold"===ce.fontWeight,isItalic:"italic"===ce.fontStyle})})});const re=yield h.annotationMapper.getOriginalAnnotations(Z,{width:Q.mediaBox.left+Q.mediaBox.width,height:2*Q.mediaBox.top+Q.mediaBox.height});yield v.setPageAnnotations(B,re,J),"flatten"===o.saveAnnotation&&(yield v.flattenPage(B))}return V.length&&((yield v.ifFontsExist(V))||rt.warning(rt.WASM_FONT_LOSS)),yield v.getPdf(n2.RT_BINARY)}finally{v.destroy()}})()}}function _ee(p){return!!(!p.isFull||p.filter&&"none"!==p.filter||p.getActions().some(n=>"rotate"!==n.type))||!!p.getPerspectiveActions().some(n=>"rotate"!==n.type)||0!==p.rotation}const Tw=p=>{const n=new Set(p);return Array.from(n.values())};class _Pe extends or{constructor(){super(),W(this,"observer",void 0),W(this,"onResizeObserver",Dt(this)),this.observer=new ResizeObserver(n=>{n.forEach(o=>{this.onResizeObserver.emit(o)})})}observe(n){this.observer.observe(n)}unobserve(n){this.observer.unobserve(n)}reset(){this.observer.disconnect()}dispose(){this.observer.disconnect(),this.observer=null,super.dispose()}}class CPe{constructor(){W(this,"canvas",void 0),W(this,"renderer",void 0),W(this,"root",void 0),document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),this.renderer=new CZ,this.canvas=new hZ({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new MZ).init(this.canvas)}render(n,o,h){this.root.children.slice().forEach(v=>{this.root.removeChild(v)}),this.root.appendChild(n),this.canvas.resize(o||n.width,h||n.height),this.canvas.render()}reset(){this.root.children.slice().forEach(n=>{this.root.removeChild(n)}),this.root.sortable.sorted=[]}getCanvas(){return this.canvas.contextService.getDomElement()}}let JF;const Cee="p".charCodeAt(0),bee="H".charCodeAt(0),xee="Y".charCodeAt(0),wee="s".charCodeAt(0);class TPe{constructor(n){W(this,"core",void 0),this.core=n}getRaw(n){var o=arguments,h=this;return Fe(function*(){let v=!(o.length>1&&void 0!==o[1])||o[1];try{const y=h.core.pageService.getPage(n);if(!y||y.isDestroyed)return null;if(y.raw.isAvailable)return y.raw.getImageDetail();const{fileUid:_,fileIndex:b}=y,w=yield h.core.sourceStore.get(_);let I;I=h.core.parserService.getCustomParserClasses(w.fileData.type)?w.fileData.type:yield ZE(w.fileData),I||rt.throw(rt.FILE_NOT_SUPPORT);const A=yield h.core.parserService.getPage(w.fileData,I,_,b);if(!A)return null;let{raw:M}=y;return v||(M=new nf(y)),M.updateImageDetail(A.resource),M.getImageDetail()}catch(y){return rt.error(y),null}})()}getOriginal(n){var o=arguments,h=this;return Fe(function*(){let v=!(o.length>1&&void 0!==o[1])||o[1];const y=h.core.pageService.getPage(n);if(!y||y.isDestroyed)return null;const{original:_}=y;if(_.isAvailable)return _.getImageDetail();const b=yield h.getRaw(n);if(!b)return null;const w=yield h.handlePerspectiveQuad(n,b);return v&&w&&y.original.updateImageDetail(w),w})()}handlePerspectiveQuad(n,o){var h=this;return Fe(function*(){const v=h.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;let y=o;const _=v.getProcessedQuad();if(_&&(y=yield h.core.perspectiveService.perspective({data:o.data,type:Er.JPEG},_,{angle:v.initRotation}),!y))return null;const b=new nf(v);return b.updateImageDetail(y),b.getImageDetail()})()}getDisplay(n){var o=arguments,h=this;return Fe(function*(){let v=!(o.length>1&&void 0!==o[1])||o[1];const y=h.core.pageService.getPage(n);if(!y||y.isDestroyed)return null;if(y.display.isAvailable)return y.display.getImageDetail();const _=yield h.getOriginal(n);if(!_)return null;const{filter:b}=y,w=yield h.handleFilter(n,_);return y.filter!==b?h.getDisplay(n):(v&&w&&y.display.updateImageDetail(w),w)})()}handleFilter(n,o){var h=this;return Fe(function*(){const v=h.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;const y=o,{filter:_}=v;if(_&&"none"!==_){const w=yield h.core.filterService.applyFilter({data:o.data,type:Er.JPEG,width:o.width,height:o.height},_);if(!w)return null;y.data=w}const b=new nf(v);return b.updateImageDetail(y),b.getImageDetail()})()}getEditedDisplay(n,o){var h=arguments,v=this;return Fe(function*(){let y=h.length>2&&void 0!==h[2]&&h[2];const _=v.core.pageService.getPage(n);if(!_||_.isDestroyed)return null;const b=yield v.getDisplay(n,!1);if(_.getActions().length||0!==_.rotation||!_.isMediaBoxEqualCropBox()||o&&_.annotations.length){const w=yield v.applyEditToDisplay(n,o,y),I=new nf(_);return I.updateImageDetail(w),I.getImageDetail()}return b})()}getNotRotatedDisplay(n,o){var h=this;return Fe(function*(){const v=h.core.pageService.getPage(n);if(!v||v.isDestroyed)return null;const y=yield h.getOriginal(n);if(!y)return null;const _=yield h.handleFilter(n,y);if(o&&v.annotations.length){const b=yield h.applyEditToDisplay(n,o,!1,!1),w=new nf(v);return w.updateImageDetail(b),w.getImageDetail()}return _})()}getThumbnail(n){var o=arguments,h=this;return Fe(function*(){let v=!(o.length>1&&void 0!==o[1])||o[1];const y=h.core.pageService.getPage(n);if(!y||y.isDestroyed)return null;if(y.thumbnail.isAvailable)return y.thumbnail.getImageDetail();const _=yield h.getDisplay(n,!0);if(!_)return null;const b=yield h.displayToThumbnail(_.data);return b?(v&&y.thumbnail.updateImageDetail(b),b):null})()}displayToThumbnail(n){return Fe(function*(){return n})()}applyEditToDisplay(n,o){var h=arguments,v=this;return Fe(function*(){let y=h.length>2&&void 0!==h[2]&&h[2],_=!(h.length>3&&void 0!==h[3])||h[3];const b=yield v.core.imageLoadService.loadDisplayImage(n),w=v.core.pageService.getPage(n),I=yield v.getDisplay(n,!1);let A;if(_)A=w.getEditResultForPixel();else{const[Q,J]=Kn([w.initState.mediaBox.width,w.initState.mediaBox.height],jn.displayResolution,w.resource.resolutionX);A={rWidth:Q,rHeight:J,cropLeft:0,cropTop:0,cropWidth:Q,cropHeight:J,rotation:0}}const M={width:Math.round(A.rWidth),height:Math.round(A.rHeight),data:null},F=new Wv({style:{x:-A.cropLeft,y:-A.cropTop,img:b,width:I.width,height:I.height}}),V=new ms({style:{x:-(A.cropWidth-A.rWidth)/2,y:-(A.cropHeight-A.rHeight)/2,width:A.cropWidth,height:A.cropHeight}});if(V.appendChild(F),V.setLocalAngle(A.rotation),v.core.annotationService&&w.annotations.length&&o){const Q=new ms({style:{x:-A.cropLeft,y:-A.cropTop,width:w.original.pageWidth,height:w.original.pageHeight}});yield v.applyAnnotationToPage(Q,n,y),V.appendChild(Q)}v.core.commonCanvas.render(V,A.rWidth,A.rHeight),v.core.commonCanvas.reset();const B=v.core.commonCanvas.getCanvas();return new Promise((Q,J)=>{B.toBlob(function(){var Z=Fe(function*(re){re=yield function SPe(p,n){const o=p.slice(0,33);return new Promise((h,v)=>{const y=new FileReader;y.onload=()=>{const _=new Uint8Array(y.result),b=p.slice(33),w=function(A,M,F,V){if("image/jpeg"===F)return A[13]=1,A[14]=M>>8,A[15]=255&M,A[16]=M>>8,A[17]=255&M,A;if("image/png"===F){const B=new Uint8Array(13);M*=39.3701,B[0]=Cee,B[1]=bee,B[2]=xee,B[3]=wee,B[4]=M>>>24,B[5]=M>>>16,B[6]=M>>>8,B[7]=255&M,[B[8],B[9],B[10],B[11]]=[B[4],B[5],B[6],B[7]],B[12]=1;const Q=function bPe(p){let n=-1;JF||(JF=function(){const o=new Int32Array(256);for(let h=0;h<256;h++){let v=h;for(let y=0;y<8;y++)v=1&v?3988292384^v>>>1:v>>>1;o[h]=v}return o}());for(let o=0;o<p.length;o++)n=JF[255&(n^p[o])]^n>>>8;return~n}(B),J=new Uint8Array(4);if(J[0]=Q>>>24,J[1]=Q>>>16,J[2]=Q>>>8,void(J[3]=255&Q)){const se=function(ce){for(let pe=ce.length-1;pe>=4;pe--)if(9===ce[pe-4]&&ce[pe-3]===Cee&&ce[pe-2]===bee&&ce[pe-1]===xee&&ce[pe]===wee)return pe-3;return-1}(A);return A.set(B,se),A.set(J,se+13),A}const Z=new Uint8Array(4);Z[0]=0,Z[1]=0,Z[2]=0,Z[3]=9;const re=new Uint8Array(54);return re.set(A,0),re.set(Z,33),re.set(B,37),re.set(J,50),re}throw new Error(`The format ${F} is not supported.`)}(_,n,p.type),I=new Blob([w,b],{type:p.type});h(I)},y.onerror=_=>{v(_)},y.readAsArrayBuffer(o)})}(re,w.resolutionX||jn.displayResolution),M.data=re,Q(M)});return function(re){return Z.apply(this,arguments)}}(),"image/jpeg",1)})})()}applyAnnotationToPage(n,o){var h=arguments,v=this;return Fe(function*(){let y=h.length>2&&void 0!==h[2]&&h[2];const _=v.core.pageService.getPage(o),b=[];_.annotations.forEach(w=>{const I=v.core.annotationService.getAnnotationByUid(w);b.push(I)}),b.sort((w,I)=>w.layer-I.layer);for(let w=0;w<b.length;w++){if(y&&!b[w].flags.includes("print"))continue;if("stamp"===b[w].type&&b[w].style.imageData&&(!$t(b[w].style.width)||!$t(b[w].style.height))){const A=new Lv,M=yield A.readImageInfo({fileSource:b[w].style.imageData});let F=M.imageWidth,V=M.imageHeight;if(F>400||V>400){const B=Math.max(F/400,V/400);F/=B,V/=B}b[w].style.width=F,b[w].style.height=V}const I=v.core.annotationService.createAnnotationShape(b[w],_);I instanceof iu&&I.style.imageData&&I.style.img instanceof HTMLImageElement&&(yield new Promise(A=>{I.style.img.onload=()=>{A()}})),I&&n.appendChild(I)}})()}}class IPe{constructor(n){W(this,"name",void 0),this.name=n||"Guest"}getUser(){return this.name}setUser(n){this.name=n}}class tD extends Gn{static create(n){return new tD(n)}constructor(n){super("setExternalHandler"),W(this,"handlerType",void 0),this.handlerType=n}}class QF{static makeSureSourcesTypeSupported(n,o,h,v){const y=[];if(Di(n))n.forEach((_,b)=>{if(!_||0===_.length){const w=bn("Source[]",o,`[${b}].fileData`,!0);y.push(`${w}: ${rt.FILE_NOT_SUPPORT.message}`)}});else if(!n||0===n.length){const _=bn("Source",o,"fileData");y.push(`${_}: ${rt.FILE_NOT_SUPPORT.message}`)}y.length>0&&rt.throw(zt(Ke({},rt.FILE_NOT_SUPPORT),{details:y}),h,v)}}const ZF=new Map,eL=[];let Qv=class IU extends or{constructor(n,o,h,v,y){super(),W(this,"parserService",void 0),W(this,"saverService",void 0),W(this,"perspectiveService",void 0),W(this,"filterService",void 0),W(this,"detectorService",void 0),W(this,"viewerService",void 0),W(this,"editService",void 0),W(this,"annotationService",void 0),W(this,"documentService",void 0),W(this,"trackerService",void 0),W(this,"imageLoadService",void 0),W(this,"optimizationService",void 0),W(this,"processService",void 0),W(this,"commandService",void 0),W(this,"fileSaveService",void 0),W(this,"fileService",void 0),W(this,"pageService",void 0),W(this,"resizeService",void 0),W(this,"imageDataService",void 0),W(this,"userService",void 0),W(this,"sourceStore",void 0),W(this,"commonCanvas",void 0),W(this,"onBeforeLoadSource",void 0),W(this,"onSetExternalHandler",void 0),W(this,"onAfterPerspective",void 0),W(this,"onFilterChanged",void 0),W(this,"onUnload",void 0),this.parserService=n,this.saverService=o,this.perspectiveService=h,this.filterService=v,this.detectorService=y,this.onBeforeLoadSource=Dt(this),this.onSetExternalHandler=Dt(this),this.onUnload=Dt(this),this.onAfterPerspective=Dt(this),this.onFilterChanged=Dt(this),this.commonCanvas=new CPe,this.sourceStore=new see,this.trackerService=new yee,this.documentService=new fPe,this.fileService=new mPe,this.pageService=new vPe(this),this.imageLoadService=new rPe(this),this.optimizationService=new class{constructor(){W(this,"actorSystem",void 0),W(this,"concurrency",3);const p=window.URL.createObjectURL(new Blob(["(",aPe.toString(),")()"],{type:"text/plain"}));this.actorSystem=new sPe(p,this.concurrency)}cancel(p){this.actorSystem.cancel(p)}optimize(p,n,o,h,v,y){return new Promise((_,b)=>{const w=p.getContext("2d"),I=Math.floor(n)||1,A=Math.floor(o)||1,M=w.getImageData(0,0,I,A),F={action:"optimize",data:{taskUid:y,sourceWidth:I,sourceHeight:A,width:Math.ceil(h)||1,height:Math.ceil(v)||1,source:M},callback(V){_(V)}};this.actorSystem.send(F,F.data.source)})}},this.processService=new cPe,this.commandService=new gPe,this.fileSaveService=new yPe(this),this.resizeService=new _Pe,this.imageDataService=new TPe(this),this.userService=new IPe("Guest"),eL.forEach(_=>{var b;null===(b=_.apply)||void 0===b||b.call(_,this)}),this.initServiceEvent()}initServiceEvent(){const{documentService:n,commandService:o,pageService:h,viewerService:v,fileService:y,parserService:_}=this;n.onDocumentCreated.on(b=>{o.createInvoker(b.docUid)},o),n.onDocumentDeleted.on(b=>{o.deleteInvokers([b.docUid])},o),v.onPagePreloadChanged.on(b=>{h.handlePagePreloadChange(b)},h),y.onDeleteFileData.on(b=>{this.sourceStore.remove(b)}),y.onDeleteFileData.on(b=>{_.freeParserByFileUid(b)},_)}static getClass(n){return ZF.get(n)}static setClass(n,o){ZF.set(n,o)}static registerPlugin(n){eL.includes(n)||eL.push(n),n.install&&n.install(IU)}getClass(n){return ZF.get(n)}createAsyncRepository(){return new see}createViewer(n){const o=IU.getClass("Viewer"),h=zt(Ke({},n),{core:this,groupUid:n.groupUid||Ai()}),v=this.viewerService.createViewer(o,h);return v.context.isInitialized=!0,v}removeViewer(n){this.viewerService.removeViewer(n.uid)}getViewer(n){return this.viewerService.getViewer(n)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(n){return this.parserService.getDefaultParserOptions(n)}setFileParserDefaultOptions(n,o){return this.parserService.setDefaultParserOptions(n,o)}setFileParser(n,o){this.parserService.registerCustomParser(n,o)}getSourceParseOptions(n,o){if("application/pdf"===o){var h;const v=n;return v.convertMode=null!==(h=v.convertMode)&&void 0!==h?h:ml.CM_AUTO,pn(v)}if("width"in n)return pn(n)}loadSource(n,o,h){var v=this;return Fe(function*(){Di(n)||(n=[n]);const y=v.documentService.getDocument(o);if(!y)return[];const _=$t(h)?{insertBeforeIndex:h}:Ke({},h),b="ignore"===_.exception,w=yield v.getSourcesMimeTypes(n);b||QF.makeSureSourcesTypeSupported(w,"sources");const I=function(){var M=Fe(function*(F,V){const B=w[V];b&&QF.makeSureSourcesTypeSupported(B,`sources[${V}]`);const Q=[],J=Ai(),Z=v.getSourceParseOptions(F,B),{fileData:re}=F,{pageCount:se,batchSize:ce}=yield v.parserService.getParseInfo(re,B,J,Z);v.sourceStore.set(J,{fileData:B===re.type?re:re.slice(0,re.size,B),loadOptions:Z}),v.fileService.addFile(J,B,se);const pe=v.getBatchIndices(ce,se);for(const Ve of pe){var Ce;const te=yield v.parserService.parse(re,B,J,Ve,Z).catch(Le=>{throw Le});null===(Ce=F.extraPageData)||void 0===Ce||Ce.forEach(Le=>{const j=te.find(L=>L.fileIndex===Le.index);if(j){const L=Ke({},Le);delete L.index,$t(j.rotation)&&$t(L.rotation)&&(L.rotation+=j.rotation),gt(L.filter)||(j.filter=L.filter),gt(L.rotation)||(j.rotation=L.rotation),gt(L.perspectiveQuad)||(j.perspectiveQuad=L.perspectiveQuad),gt(L.index)||(j.index=L.index)}});const Me=te.map(Le=>{var j;const L=Ai();return Le.pageUid=L,null!==(j=Le.filter)&&void 0!==j||(Le.filter=v.filterService.getDefaultFilterType()||"none"),L});v.fileService.addUsersByParsedPages(J,te);const we=v.annotationService.createAnnotationsByParsedPages(o,te);v.pageService.createPagesByParsedPages(te,we,J,y),v.documentService.addPagesToDocument(o,Me,_.insertBeforeIndex),gt(_.insertBeforeIndex)||(_.insertBeforeIndex+=te.length),Q.push(...Me)}return Q});return function(V,B){return M.apply(this,arguments)}}();v.onBeforeLoadSource.emit({docUid:o});const A=[];for(const[M,F]of n.entries())try{const V=yield I(F,M);A.push(...V)}catch(V){if(!b)throw V;rt.warning(V)}return v.documentService.onPagesAdded.emit(q_.create(o,A.map(M=>y.pages.indexOf(M)),A)),A})()}getSourcesMimeTypes(n){var o=this;return Fe(function*(){const h=[];for(const v of n){const y=o.parserService.getCustomParserClasses(v.fileData.type)?v.fileData.type:yield ZE(v.fileData);h.push(y)}return h})()}getAnnotationsByPageUid(n){const o=this.pageService.getPage(n);return o?o.annotations.map(h=>this.annotationService.getAnnotationByUid(h)):[]}getBatchIndices(n,o){const h=[];for(let v=0;v<o;){const y=n>0?Math.min(n,o-v):o;h.push(Array.from({length:y},(_,b)=>v+b)),v+=y}return h}getPageData(n,o){var h=this;return Fe(function*(){var v;null!==(v=o)&&void 0!==v||(o={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1});const y=h.pageService.getPage(n);if(!y)return null;const _=yield h.sourceStore.get(y.fileUid);let{quad:b}=y;b&&(b=y.quadToPixelPPI(b),sm(b));const w={uid:y.uid,fileData:"application/ddv-blank-image"!==_.fileData.type?_.fileData:null,fileIndex:y.fileIndex,perspectiveQuad:b,rotation:y.rotation,filter:y.filter,mediaBox:Ke({},y.mediaBox),cropBox:Ke({},y.cropBox)};if(o.raw){const I=yield h.imageDataService.getRaw(n);w.raw=Ke({},I)}if(o.display){const I=yield h.imageDataService.getEditedDisplay(n,o.renderAnnotation,o.isGetPrintPageData);w.display=Ke({},I)}if(o.thumbnail){const I=yield h.imageDataService.getEditedDisplay(n,o.renderAnnotation,o.isGetPrintPageData);w.thumbnail=Ke({},I)}return w})()}setCustomData(n,o){var h=this;return Fe(function*(){const v=h.pageService.getPage(n);return v?(v.customData=pn(o),!0):Promise.reject()})()}getCustomData(n){var o=this;return Fe(function*(){const h=o.pageService.getPage(n);return h?pn(h.customData):Promise.reject()})()}updatePage(n,o){var h=arguments,v=this;return Fe(function*(){var y,_;let b=h.length>2&&void 0!==h[2]?h[2]:{};const w=v.pageService.getPage(n);if(!w)return!1;const I=Ai(),A=v.parserService.getCustomParserClasses(o.type)?o.type:yield ZE(o);QF.makeSureSourcesTypeSupported([A],"data");const M=v.getSourceParseOptions({fileData:o},A),{pageCount:F}=yield v.parserService.getParseInfo(o,A,I,M);if($t(b.fileIndex)&&(b.fileIndex>=F||b.fileIndex<0))return rt.reject(rt.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");v.sourceStore.set(I,{fileData:o,loadOptions:M}),v.fileService.addFile(I,A,F);const[V]=yield v.parserService.parse(o,A,I,[b.fileIndex||0],M).catch(Q=>{throw Q});V.pageUid=n,null!==(y=V.filter)&&void 0!==y||(V.filter=v.filterService.getDefaultFilterType()||"none");const B=v.annotationService.createAnnotationsByParsedPages(w.doc.uid,[V]);return v.commandService.removePageFromCommand(w.doc.uid,[n]),v.fileService.addUser(I,b.fileIndex,n),v.fileService.deleteUser(w.fileUid,w.fileIndex,n),null===(_=v.annotationService)||void 0===_||_.deleteAnnotations(w.annotations,!1),v.pageService.updatePage(n,o,zt(Ke(Ke({},V),b),{fileUid:I,annotations:B[0]})),!0})()}getPerspectivePreviewData(n,o,h){var v=this;return Fe(function*(){const y=v.pageService.getPage(n),_=yield v.imageDataService.getRaw(n);if(!y||!_)return null;let{quad:b}=y;b||(b=[[0,0],[_.width,0],[_.width,_.height],[0,_.height]]);const w=yield v.processService.perspectivePreview(_.data,4,b,{width:_.width,height:_.height},Ke(Ke({},o),h));return Promise.resolve(w)})()}createDocument(n){return this.documentService.createDocument(n)}getDocument(n){return this.documentService.getDocument(n)}deleteDocuments(n){const{documentService:o,pageService:h}=this;if(n.map(_=>o.getDocument(_)).includes(void 0))return!1;const v=GF.create(n);o.onBeforeDeleteDocs.emit(v),n.forEach(_=>{const b=o.getDocument(_);var w;b&&(b.pages.forEach(I=>{const A=h.getPage(I);this.fileService.deleteUser(A.fileUid,A.fileIndex,I)}),null===(w=this.annotationService)||void 0===w||w.deleteAnnotationPages([...b.pages]),h.deletePages(b.pages))});const y=o.deleteDocuments(n);return o.onAfterDeleteDocs.emit(v),y}renameDocument(n,o){this.documentService.renameDocument(n,o)}transferDocument(n,o){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:v}=this,y=v.getDocument(n),_=v.getDocument(o);if(!y||!_)return!1;if(n===o&&!h.copy)return!h.sourceIndices||this.movePages(n,h.sourceIndices,h.insertBeforeIndex);let b=[];if(b=null!=h&&h.sourceIndices?Tw(h.sourceIndices).map(I=>y.pages[I]):[...y.pages],!b.length)return!0;h.copy?b.forEach((I,A,M)=>{const F=this.pageService.getPage(I),V=Ai();if(this.fileService.addUser(F.fileUid,F.fileIndex,V),this.pageService.copyPage(V,_,F),!1!==(null==h?void 0:h.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(V);const B=F.annotations.map(Q=>zt(Ke({},this.annotationService.getAnnotationByUid(Q).getConfig()),{docUid:_.uid,pageUid:V,uid:Ai()}));B.length&&this.annotationService.annotationApp.createAnnotations(B)}M[A]=V}):(v.removePagesFromDocument(y.uid,b),b.forEach(I=>{const A=this.pageService.getPage(I);var M;A.doc=_,!1===(null==h?void 0:h.includeAnnotations)&&(null===(M=this.annotationService)||void 0===M||M.deleteAnnotations(A.annotations),A.annotations=[])})),v.addPagesToDocument(_.uid,b,h.insertBeforeIndex);const w=b.map(I=>_.pages.indexOf(I));return v.onPagesAdded.emit(q_.create(_.uid,w,b)),!0}mergeDocuments(n,o){const{documentService:h}=this,v=h.createDocument(o);if(!n.length)return v;n=Tw(n);const y=[];if(n.forEach(_=>{const b=h.getDocument(_);y.push(...b.pages)}),null!=o&&o.deleteOriginal?(h.deleteDocuments(n),y.forEach(_=>{const b=this.pageService.getPage(_);var w;b.doc=v,!1===(null==o?void 0:o.includeAnnotations)&&(null===(w=this.annotationService)||void 0===w||w.deleteAnnotations(b.annotations),b.annotations=[])})):y.forEach((_,b,w)=>{const I=this.pageService.getPage(_),A=Ai();if(this.fileService.addUser(I.fileUid,I.fileIndex,A),this.pageService.copyPage(A,v,I),!1!==(null==o?void 0:o.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(A);const M=I.annotations.map(F=>zt(Ke({},this.annotationService.getAnnotationByUid(F).getConfig()),{docUid:v.uid,pageUid:A,uid:Ai()}));M.length&&this.annotationService.annotationApp.createAnnotations(M)}w[b]=A}),y.length){h.addPagesToDocument(v.uid,y);const _=y.map(b=>v.pages.indexOf(b));h.onPagesAdded.emit(q_.create(v.uid,_,y))}return v}openDocument(n,o){return this.openOrCloseDocument(n,o)}closeDocument(n,o){return this.openOrCloseDocument(n,o,!0)}openOrCloseDocument(n,o){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this.documentService.getDocument(n);if(!v||!this.viewerService.hasViewer(o))return!1;const y=this.viewerService.getViewer(o);return h?this.documentService.onCloseDocument.emit(BF.create(v,o,y.groupUid)):this.documentService.onOpenDocument.emit(NF.create(v,o,y.groupUid)),this.commandService.emitOperationsChanged(n),!0}deletePages(n,o){var h;return o=Tw(o),this.commandService.removePageFromCommand(n,[...o]),o.forEach(v=>{const y=this.pageService.getPage(v);this.fileService.deleteUser(y.fileUid,y.fileIndex,v)}),null===(h=this.annotationService)||void 0===h||h.deleteAnnotationPages(o),this.documentService.removePagesFromDocument(n,[...o]),this.pageService.deletePages(o),!0}deleteAllPages(n){var o;const h=this.documentService.getDocument(n),v=[...h.pages];return this.commandService.removePageFromCommand(n,v),h.pages.forEach(y=>{const _=this.pageService.getPage(y);this.fileService.deleteUser(_.fileUid,_.fileIndex,y)}),null===(o=this.annotationService)||void 0===o||o.deleteAnnotationPages(h.pages),this.documentService.removeAllPagesFromDocument(n),this.pageService.deletePages(v),!0}movePages(n,o,h){return o=Tw(o),this.documentService.movePages(n,o,h)}swapPages(n,o,h){return this.documentService.swapPages(n,o,h)}reorderPages(n,o){return o=Tw(o),this.documentService.reorderPages(n,o)}printPages(n,o,h){var v=this;return Fe(function*(){const y=v.documentService.getDocument(n);if(!y)return Promise.reject(rt.DOC_NOT_EXIST);const _=o||Array.from(Array(y.pages.length).keys()),b=[];for(let A=0;A<_.length;A++){var w;const M=yield v.getPageData(y.pages[_[A]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(w=null==h?void 0:h.printAnnotation)||void 0===w||w,isGetPrintPageData:!0});b.push(M)}if(0===b.length)return Promise.reject();const I=[];return b.forEach(A=>{I.push({data:A.display.data,width:A.display.width,height:A.display.height})}),function(A){let M,F,V="";A.forEach((Z,re)=>{let se=1120,ce=850;const pe=ce/Z.width,Ce=se/Z.height;pe<Ce?se=Math.floor(Z.height*pe):pe>Ce&&(ce=Math.floor(Z.width*Ce)),V+=`<div class="imageContainer"><img id="DDV_Image${re}" src='${XE(Z.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,M+=ce,F+=se});const Q=window.open("about:blank","_blank",`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${M}, height=${F}`);if(Q){Q.document.write(`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                width: 100%;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${V}</body></html>`),Q.document.close(),Q.focus();const Z=Q.document.getElementById("DDV_body");Z&&(Z.onload=()=>{Q&&Q.print()})}}(I),!0})()}setDetectHandler(n,o){this.onSetExternalHandler.emit(tD.create("detect")),this.detectorService.setDetector(o)}setImageFilterHandler(n){this.onSetExternalHandler.emit(tD.create("filter")),this.filterService.setImageFilter(n)}clearExternalHandler(n){if(Sn(n))switch(n){case"documentBoundariesDetect":this.setDetectHandler(n,null);break;case"imageFilter":this.setImageFilterHandler(null)}}unload(){var n;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(n=this.annotationService)||void 0===n||n.reset(),xi.reset(),vn.unload()}preloadModule(n){vn.preloadModule(n)}perspectivePage(n,o,h){var v=this;return Fe(function*(){let y;const _=v.pageService.getPage(o);if(_.setQuad(h)){if(v.annotationService.deleteAnnotations(_.annotations),v.commandService.removePageFromCommand(n,[o]),_.quad){const{width:I,height:A}=gee(_.quad);_.original.updateImageDetail({width:I,height:A}),_.display.updateImageDetail({width:I,height:A})}v.imageLoadService.cancelLoadOriginalImage(o),_.original.reset(),y=yield v.imageDataService.getOriginal(o),v.imageLoadService.cancelLoadDisplayImage(o),v.imageLoadService.cancelLoadThumbnailImage(o),_.display.reset(),_.thumbnail.reset();const{width:b,height:w}=_.original.getPageSize();_.isFull?(_.mediaBox=Ke({},_.initState.mediaBox),_.cropBox=Ke({},_.initState.cropBox)):(_.mediaBox={left:0,top:0,width:b,height:w},_.cropBox=Ke({},_.mediaBox)),v.onAfterPerspective.emit(jF.create(n,o,h,b,w))}return y||v.imageDataService.getOriginal(o)})()}filterPages(n,o,h){var v=this;return Fe(function*(){o.forEach(_=>{const b=v.pageService.getPage(_);b.filter!==h&&(b.filter=h,b.display.reset(),b.thumbnail.reset())});const y=$2.create(n,o,h);return v.onFilterChanged.emit(y),!0})()}insertBlankPage(n,o,h,v,y,_){const b=this.documentService.getDocument(n);if(!b)return"";this.onBeforeLoadSource.emit({docUid:n});const w=Ai(),I={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=o?o:816,height:null!=h?h:1056,resolutionX:null!=v?v:96,resolutionY:null!=y?y:96},A=this.getSourceParseOptions(I,"application/ddv-blank-image");this.sourceStore.set(w,{fileData:I.fileData,loadOptions:A}),this.fileService.addFile(w,"application/ddv-blank-image",1),this.parserService.parse(I.fileData,"application/ddv-blank-image",w,[0],A);const{displayResolution:M}=jn,F=Ai();this.fileService.addUser(w,0,F);const V={resource:{data:I.fileData,width:I.width,height:I.height,resolutionX:I.resolutionX,resolutionY:I.resolutionY},mediaBox:{left:0,top:0,width:I.width/I.resolutionX*M,height:I.height/I.resolutionY*M},cropBox:{left:0,top:0,width:I.width/I.resolutionX*M,height:I.height/I.resolutionY*M},annotations:[],fileIndex:0,pageUid:F,fileUid:w};return this.pageService.createPage(V,b),this.annotationService.createAnnotationsByParsedPages(n,[V]),this.documentService.addPagesToDocument(n,[F],_),this.documentService.onPagesAdded.emit(q_.create(n,[b.pages.indexOf(F)],[F])),F}};function am(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:o,style:h,id:v,className:y,children:_}=p,b=document.createElement(o);return v&&(b.id=v+n),y&&(b.className=y),h&&function(w,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Sn(I))w.style.cssText=I;else if(A){let M="";Object.keys(I).forEach(F=>{M+=`${F}:${I[F]};`}),w.style.cssText=M}else Object.keys(I).forEach(M=>{w.style[M]=I[M]})}(b,h),_&&_.forEach(w=>{const I=am(w,n);b.appendChild(I)}),b}function See(p){p&&(p.style.display="none")}function tL(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";p&&(p.style.display=n)}const J_=p=>parseFloat(Number(p).toFixed(4));class rf extends or{constructor(){super(),W(this,"uid",void 0),W(this,"type",void 0),W(this,"action",void 0),W(this,"isValid",void 0),this.isValid=!0,this.uid=Ai()}execute(){return null}undo(){return null}}new class extends or{constructor(){super(...arguments),W(this,"docCreated",Dt(this)),W(this,"docDeleted",Dt(this)),W(this,"pageAdded",Dt(this)),W(this,"pageDeleted",Dt(this)),W(this,"annotationCreated",Dt(this)),W(this,"annotationDeleted",Dt(this)),W(this,"annotationUpdated",Dt(this)),W(this,"replyToAnnotation",Dt(this)),W(this,"commentDeleted",Dt(this)),W(this,"commentUpdated",Dt(this))}};const EPe={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,visibility:"visible",viewerMode:Ko.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWidthKeyboard:!0,enableZoomOutWidthKeyboard:!0,enableUndoWidthKeyboard:!0,enableRedoWidthKeyboard:!0,enableDeleteWidthKeyboard:!0,enableSelectAllWidthKeyboard:!0,enableMoveAnnotationWidthKeyboard:!0,enableSaveWidthKeyboard:!0,enableLoadSourceWidthKeyboard:!0,enablePrintWidthKeyboard:!0,enableSelectPageWidthKeyboard:!0,enableCopyCutPasteWidthKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class DPe extends gs{constructor(){super({name:"Checkbox"}),W(this,"shapeType","checkbox"),W(this,"checkboxStyle",void 0),W(this,"parsedCheckboxStyle",void 0),W(this,"isChecked",!1)}get checked(){return this.isChecked}set checked(n){this.isChecked=n}updateStyle(n){Object.assign(this.style,n)}}class APe extends gs{constructor(){super({name:"PageNumber"}),W(this,"shapeType","pageNumber"),W(this,"text",void 0),W(this,"parsedPageNumberStyle",void 0),this.text="0"}updateText(n){this.text=n}updateStyle(n){Object.assign(this.style,n)}}class PPe extends ms{constructor(n){super(zt(Ke({},n),{name:"TabPage"})),W(this,"uid",void 0),W(this,"tab",void 0),W(this,"isSelected",!1),W(this,"isHovered",!1),W(this,"isDragging",!1),W(this,"isLoading",!1),W(this,"isPreload",!1),W(this,"isLoaded",!1),W(this,"rWidth",void 0),W(this,"rHeight",void 0),W(this,"rotation",0),W(this,"cropLeft",void 0),W(this,"cropTop",void 0),W(this,"cropWidth",void 0),W(this,"cropHeight",void 0),W(this,"mediaBoxRect",void 0),W(this,"cropBoxRect",void 0),W(this,"isOptimized",!1),W(this,"optimizedUid","1"),W(this,"optimizationUid","2"),W(this,"editUid",void 0),W(this,"editedUid",void 0),W(this,"zoom",1),W(this,"image",void 0),W(this,"borderBox",void 0),W(this,"checkbox",void 0),W(this,"pageNumber",void 0),W(this,"curBox",void 0),W(this,"mediaBox",void 0),W(this,"cropBox",void 0),W(this,"realTimeBox",void 0),this.tab=n.tab,this.uid=n.uid,this.rWidth=n.style.width,this.rHeight=n.style.height,this.initSubShapes(n)}initSubShapes(n){this.updateStyle({visibility:"hidden"});const o=new Wv({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),h=new ms({name:"pageOptimizedBox",style:{x:0,y:0}}),v=new ms({name:"pageCropBox"});v.clippable=!0;const y=new ms({name:"pageMediaBox"}),_=new ms({name:"pageBorderBox",style:Ke(Ke({},n.style),n.formattedPageStyle)}),b=new ms({name:"currentStyleBox",style:{visibility:"hidden"}}),w=new DPe,I=new APe;y.appendChild(o),v.appendChild(y),_.appendChild(h),_.appendChild(v),_.appendChild(b),_.appendChild(w),this.appendChild(I),this.appendChild(_),this.image=o,this.borderBox=_,this.realTimeBox=h,this.pageNumber=I,this.checkbox=w,this.curBox=b,this.cropBox=v,this.mediaBox=y}getRect(){const n=this.realTimeBox.getPosition();return{left:n.x,top:n.y,width:this.rWidth,height:this.rHeight}}setImgDom(n){this.image.style.img=n}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=Ai()}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null}setPage(n,o,h,v){this.updateStyle({x:n,y:o,width:h,height:v})}setBorderBox(n,o,h,v,y){gt(y)?this.borderBox.updateStyle({x:n,y:o,width:h,height:v}):this.borderBox.updateStyle({x:n,y:o,width:h,height:v,borderWidth:y})}setCropBox(n,o,h,v,y){let _=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:n,y:o,width:h,height:v}),this.cropBox.setLocalScale(y),this.cropBox.setLocalAngle(_),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9)}setRealTimeBox(n,o,h,v,y){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:n,y:o,width:h,height:v}),this.realTimeBox.setLocalScale(y,y,1)}setMediaBox(n,o,h,v){this.mediaBox.updateStyle({x:n,y:o,width:h,height:v})}setCurBox(n,o,h,v){this.curBox.updateStyle({x:n,y:o,width:h,height:v})}setImage(n,o,h,v){this.image.updateStyle({x:n,y:o,width:h,height:v})}}function nL(p){const{borderWidth:n,borderColor:o,borderStyle:h}=Xx(p),v=parseInt(n||"0px",10);let y=[0,0];return"dashed"===h&&(y=[2*v,v]),{borderWidth:v,borderStyle:y,borderColor:o||"",lineDash:y}}const Q_=p=>{const{border:n}=p;if(!n)return 0;const o=n.match(/[0-9]+/g)[0];return parseInt(o||"0",10)};function lm(p,n){if(gt(p)||""===p)return null;const o=Nv(p);return"%"===o.unit?n*o.value/100:o.value}function Z_(p,n,o){p.style.width=`${n}px`,p.style.height=`${o}px`}function Zv(p){const n=devicePixelRatio;return $t(p)&&p>0?(p=Math.floor(p*n)/n)||(p=1/n):p=0,p}function Ep(p){const n=devicePixelRatio;return $t(p)?(p=Math.round(p*n)/n)||(p=1/n):p=0,p}function vl(p){return Ep(p)}const iL=()=>{const p=document.createElement("div");p.style.width="100px",p.style.height="100px",p.style.overflow="scroll",p.style.position="absolute",p.style.top="-9999px",document.body.appendChild(p);const n=p.offsetWidth-p.clientWidth;return document.body.removeChild(p),n};class RPe{constructor(n,o){W(this,"tab",void 0),W(this,"viewerContext",void 0),W(this,"viewportWidth",600),W(this,"viewportHeight",800),W(this,"currentViewportWidth",0),W(this,"currentViewportHeight",0),W(this,"currentLayoutWidth",0),W(this,"currentLayoutHeight",0),W(this,"placeholderPages",[]),W(this,"scrollLeft",0),W(this,"scrollTop",0),W(this,"maxScrollLeft",0),W(this,"maxScrollTop",0),W(this,"startRow",0),W(this,"endRow",0),W(this,"startColumn",0),W(this,"endColumn",0),W(this,"preloadCount",1),W(this,"pagePreloadChanges",[]),W(this,"direction","vertical"),W(this,"displayMode",void 0),W(this,"fitMode",void 0),W(this,"rows",void 0),W(this,"columns",void 0),W(this,"zoom",void 0),W(this,"defaultReference",void 0),W(this,"zoomReference",void 0),W(this,"resizeReference",void 0),W(this,"oldZoom",void 0),W(this,"isZoomChanged",void 0),W(this,"isOutOfBounds",void 0),W(this,"isScrollbarResized",!0),W(this,"scrollbarWidthCache",void 0),W(this,"defaultWidth",void 0),W(this,"defaultHeight",void 0),this.tab=n,this.viewerContext=o;const{viewerConfig:h}=o;this.rows=h.rows,this.columns=h.columns,this.zoom=h.zoom,this.oldZoom=h.zoom,this.displayMode=h.displayMode,this.fitMode=h.fitMode,this.direction=h.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1}get isVertical(){return"vertical"===this.direction}get isContinuousDisplay(){return"continuous"===this.displayMode}get isSingleDisplay(){return"single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const n=iL();return this.scrollbarWidthCache=n,this.isScrollbarResized=!1,n}getRealRowAndColumnContinuous(){const{rows:n,columns:o,isVertical:h}=this,{total:v}=this.tab;let y=n,_=o;return h?(y=Math.ceil(v/o),v<=o&&(_=Math.max(1,v),y=1)):(_=Math.ceil(v/n),v<=n&&(y=Math.max(1,v),_=1)),{realRow:y,realColumn:_}}getRealRowAndColumnThumbnail(){const{total:n}=this.tab,{rows:o,columns:h,isVertical:v}=this,y=v?h:Math.ceil(n/o);return{realRow:v?Math.ceil(n/h):o,realColumn:y}}getZoomOriginCord(){const{zoomOrigin:n}=this.viewerContext.viewerConfig,o={start:0,center:.5,end:1};return{originX:this.currentViewportWidth*o[n.x],originY:this.currentViewportHeight*o[n.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:n}=this.viewerContext,{borderWidth:o}=n.getParsedPageStyle();return{borderWidth:o,selectedBorderWidth:n.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:n.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(n,o){return this.viewerContext.styleService.getParsedPageNumberStyle({width:n,height:o})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(n,o){return this.viewerContext.styleService.getParsedCheckboxStyle({width:n,height:o})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(n){if(Sn(n)){if(/px/.test(n)){const[h]=n.match(/(\d+)/);return parseInt(h,10)}const o=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(n)){const h=o.width/Yx(),[v]=n.match(/(\d+)/);return h*parseInt(v,10)/100}if(/em/.test(n)){const h=getComputedStyle(o).fontSize,[v]=h.match(/(\d+)/),[y]=n.match(/(\d+)/);return parseInt(v,10)*parseInt(y,10)}}return $t(n)?n:parseInt(n,10)}setZoom(n){this.oldZoom=this.zoom,this.zoom=n,this.tab.pages.forEach(o=>{o.zoom=n})}getTabOffset(){const{maxScrollLeft:n,maxScrollTop:o,currentLayoutWidth:h,currentLayoutHeight:v,currentViewportWidth:y,currentViewportHeight:_,scrollLeft:b,scrollTop:w}=this;let I=0,A=0;const M=this.getParsedCanvasStyle().borderWidth||0;return I=n>0?-b:(y-(h-2*M))/2,A=o>0?-w:(_-(v-2*M))/2,{offsetX:I,offsetY:A}}parseReferenceDefault(){const{tab:n,maxScrollLeft:o,maxScrollTop:h}=this,y=this.placeholderPages[n.current];if(!y)return{scrollLeft:0,scrollTop:0};const _=this.getMargin();let b=y.x-_,w=y.y-_;return this.isContinuousDisplay&&(b=y.pageX-_,w=y.pageY-_),b=Ir(b,0,o),w=Ir(w,0,h),{scrollLeft:b,scrollTop:w}}parseReferenceZoom(n,o,h){if(gt(n)&&(n=this.zoomReference),gt(o)||gt(h)){const{originX:w,originY:I}=this.getZoomOriginCord();o=w,h=I}let{scrollLeft:v,scrollTop:y}=this.parseReference(n,o,h);const{maxScrollLeft:_,maxScrollTop:b}=this;return v=Ir(v,0,_),y=Ir(y,0,b),{scrollLeft:v,scrollTop:y}}parseReferenceResize(){const{resizeReference:n}=this;let{scrollLeft:o,scrollTop:h}=this.parseReference(n,0,0);const{maxScrollLeft:v,maxScrollTop:y}=this;return o=Math.min(o,v),h=Math.min(h,y),{scrollLeft:o,scrollTop:h}}updateReference(){const{currentViewportWidth:n,currentViewportHeight:o}=this,h=this.generateReference(0,0),v=this.generateReference(n/2,o/2),{originX:y,originY:_}=this.getZoomOriginCord(),b=this.generateReference(y,_);this.defaultReference=v,this.resizeReference=h,this.zoomReference=b}generateReference(n,o){let h,v,y,_,b=null,w=Number.MAX_VALUE;const{offsetX:I,offsetY:A}=this.getTabOffset(),{zoom:M}=this;return this.placeholderPages.forEach(F=>{if(F&&("single"===this.displayMode&&F.uid===this.tab.currentUid||"continuous"===this.displayMode)){const V=F.x+I,B=F.y+A,Q=new t5(V+F.width/2,B+F.height/2).distanceTo({x:n,y:o});Q<w&&(w=Q,b=F.uid,n<V?(h="start",y=V-n):n>V+F.width?(h="end",y=n-(V+F.width)):(h="center",y=(n-V)/M),o<B?(v="start",_=B-o):o>B+F.height?(v="end",_=o-(B+F.height)):(v="center",_=(o-B)/M))}}),{pageX:y,pageY:_,positionX:h,positionY:v,pageUid:b}}parseReference(n,o,h){const{pageX:v,pageY:y,positionX:_,positionY:b,pageUid:w}=n,I=this.placeholderPages.find(Q=>Q.uid===w),{zoom:A}=this;let M,F,V=0,B=0;return I&&("start"===_?M=I.x-v:"center"===_?M=I.x+v*A:"end"===_&&(M=I.x+I.width+v),"start"===b?F=I.y-y:"center"===b?F=I.y+y*A:"end"===b&&(F=I.y+I.height+y)),V=M-o,B=F-h,{scrollLeft:V,scrollTop:B}}getScrollValuesByCurrentChanged(){const{placeholderPages:n,currentViewportWidth:o,currentViewportHeight:h,startRow:v,endRow:y,startColumn:_,endColumn:b,isVertical:w}=this,{current:I}=this.tab,A=this.getMargin(),{realRow:M,realColumn:F}=this.getRealRowAndColumnThumbnail();let V=I,B=I;w?(V=v*F+_,B=y*F+b):(V=_*M+v,B=b*M+b);let Q=Ir(this.scrollLeft,0,this.maxScrollLeft),J=Ir(this.scrollTop,0,this.maxScrollTop);if(I>=V&&I<=B)return{scrollLeft:Q,scrollTop:J};const Z=n[I];return Z&&(w?(Q=0,I<V?J=Z.y-A:I>B&&(J=Z.y+Z.height+A-h)):(J=0,I<V?Q=Z.x-A:I>B&&(Q=Z.x+Z.width+A-o))),Q=Ir(Q,0,this.maxScrollLeft),J=Ir(J,0,this.maxScrollTop),{scrollLeft:Q,scrollTop:J}}getCurrentByScroll(){let n=this.tab.current;const{placeholderPages:o,currentViewportWidth:h,currentViewportHeight:v,startRow:y,endRow:_,startColumn:b,endColumn:w,isVertical:I}=this,{realRow:A,realColumn:M}=this.getRealRowAndColumnContinuous(),F=h/2,V=v/2,{offsetX:B,offsetY:Q}=this.getTabOffset(),{current:J}=this.tab;let Z=Number.MAX_VALUE,re=Number.MAX_VALUE,se=I?Math.floor(J/M):J%A,ce=I?J%M:Math.floor(J/A);for(let pe=y;pe<=_;pe++){const Ce=o[pe*M];if(!Ce)continue;const{y:Ve,height:te}=Ce,Me=Ve+Q,we=Me-V,Le=V-Me-te;if(we<=0&&Le<=0){se=pe;break}we>0&&we<re?(re=we,se=pe):Le>0&&Le<re&&(re=Le,se=pe)}for(let pe=b;pe<=w;pe++){const Ce=o[b];if(!Ce)continue;const{x:Ve,width:te}=Ce,Me=Ve+B,we=Me-F,Le=F-Me-te;if(we<=0&&Le<=0){ce=pe;break}we>0&&we<Z?(Z=we,ce=pe):Le>0&&Le<Z&&(Z=Le,ce=pe)}return n=se*M+ce,n===this.tab.current?null:n}setTabScrollValue(n,o){this.scrollLeft=n,this.scrollTop=o;const{offsetX:h,offsetY:v}=this.getTabOffset();this.tab.setPosition({x:h,y:v})}}class kPe extends gs{constructor(n,o){super({name:"DocTab"}),W(this,"uid",void 0),W(this,"docType",void 0),W(this,"docName",void 0),W(this,"doc",void 0),W(this,"isActive",!1),W(this,"currentUid",void 0),W(this,"total",void 0),W(this,"selected",void 0),W(this,"context",void 0),W(this,"viewerContext",void 0),W(this,"shiftReference",void 0),W(this,"oldCurrentUid",void 0),W(this,"oldCurrent",void 0),this.doc=n,this.uid=n.uid,this.docName=n.name,this.docType=n.type,this.total=0,this.selected=[],this.viewerContext=o,this.context=new RPe(this,o),this.oldCurrent=-1,this.oldCurrentUid=void 0,n.pages.forEach(h=>{const v=this.createPage(h);this.appendChild(v)}),this.total=n.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid)}get scrollToLatest(){let{scrollToLatest:n}=this.viewerContext.viewer.group.config;return gt(n)&&(n=this.viewerContext.viewerConfig.scrollToLatest),n}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return"document"===this.docType}createPage(n){const{pageStyle:o,pageNumberStyle:h,checkboxStyle:v,removeBtnStyle:y,blankFillColor:_}=this.viewerContext.viewerConfig,b=function(A){const{border:M,background:F}=A;let V={};return M&&(V=nL(M)),Ke({background:F},V)}(o),{width:w,height:I}=this.viewerContext.getPageRenderSize(n);return new PPe({tab:this,uid:n,formattedPageStyle:b,pageNumberStyle:h,checkboxStyle:v,removeBtnStyle:y,blankFillColor:_,style:{pointerEvents:"auto",width:w,height:I}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current}updateViewportSize(n,o){this.context.viewportWidth=n,this.context.viewportHeight=o}rename(n){this.docName=n}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map(n=>n.uid)}appendPages(n,o,h){const v=n.length;if(!v)return;const y=$t(h);if(n.forEach((b,w)=>{const I=this.createPage(b);this.appendChild(I,y?h+w:void 0)}),this.total=this.pages.length,o)this.currentUid=this.indexToUid(y?h+v-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var _;this.currentUid=null===(_=this.pages[0])||void 0===_?void 0:_.uid,this.updateDefaultReference()}}deletePages(n){this.updateOldInfo();const o=[...n],h=n.includes(this.currentUid);if(h){const v=n.indexOf(this.currentUid);o.splice(v,1),o.push(this.currentUid)}o.forEach(v=>{const y=this.getPageByUid(v);if(h&&y.uid===this.currentUid){if(1===this.total)this.currentUid=null;else{const{current:_}=this;this.currentUid=this.indexToUid(_+(_===this.total-1?-1:1))}this.updateDefaultReference()}CQ(this.selected,v),this.removeChild(y),this.total-=1})}deleteAllPages(){this.updateOldInfo(),[...this.pages].forEach(n=>{this.removeChild(n)}),this.currentUid=null,this.selected=[],this.total=0}movePages(n,o){return this.updateOldInfo(),bQ(this.pages,n,o)}switchPage(n,o){return this.updateOldInfo(),xQ(this.pages,n,o)}reorderPages(n){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),wQ(this.pages,n)}gotoPage(n){return 0===this.total?-1:(this.updateOldInfo(),n!==this.current&&(n=Ir(n,0,this.total-1),this.currentUid=this.indexToUid(n),this.updateDefaultReference()),this.updateShiftReference(),n)}selectPages(n){this.pages.forEach(o=>{o.isSelected=n.includes(o.uid)}),this.selected=n}selectPagesByIndices(n){const o=this.indicesToUids(n);this.selectPages(o)}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map(n=>this.uidToIndex(n))}getPageByIndex(n){return this.pages[n]}getPageByUid(n){return this.pages.find(o=>o.uid===n)}getPageIndex(n){return this.pages.findIndex(o=>o.uid===n.uid)}uidToIndex(n){return this.pages.findIndex(o=>o.uid===n)}uidsToIndices(n){return n.map(o=>this.uidToIndex(o))}indexToUid(n){var o;return null===(o=this.pages[n])||void 0===o?void 0:o.uid}indicesToUids(n){return n.map(o=>this.indexToUid(o))}updateShiftReference(){this.shiftReference=this.currentUid}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid}}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0}}class MPe extends or{constructor(n){super(),W(this,"tabActivationStack",void 0),W(this,"tabs",void 0),W(this,"activeTabUid",void 0),W(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=n}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose()}updateViewportSize(n,o){const h=this.getActiveTab();null!=h&&h.isDocType&&h.updateViewportSize(n,o)}createTab(n){if(this.tabs.has(n.uid))return this.tabs.get(n.uid);let o=null;return"document"===n.type&&(o=new kPe(n,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(o.uid,o),o}closeTab(n){if(!this.tabs.has(n))return!1;const{tabActivationStack:o}=this;if(o.includes(n)){const h=o.indexOf(n);o.splice(h,1)}return this.getTab(n).isActive=!1,this.tabs.delete(n),this.activeTabUid===n&&(this.activeTabUid=o[o.length-1]),!0}getTab(n){return this.tabs.get(n)}getDocTab(n){const o=this.getTab(n);return null!=o&&o.isDocType?o:null}hasTab(n){return this.tabs.has(n)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(n){if(!this.tabs.has(n))return!1;const{tabActivationStack:o}=this;if(this.context.viewerConfig.enableMultiTab){if(o.includes(n)){const h=o.indexOf(n);o.splice(h,1)}}else o.length=0;return o.push(n),this.activeTabUid=n,this.tabs.forEach(h=>{h.isActive=h.uid===n}),!0}clearTabs(){this.getAllTabs().forEach(n=>{n.destroy()}),this.tabs.clear()}resizeScrollbar(){this.tabs.forEach(n=>{n.context.isScrollbarResized=!0})}}class OPe{constructor(n){W(this,"parsedPageStyleCache",void 0),W(this,"parsedCurrentPageStyleCache",void 0),W(this,"parsedSelectedPageStyleCache",void 0),W(this,"parsedHoveredPageStyleCache",void 0),W(this,"parsedPlaceholderStyleCache",void 0),W(this,"parsedCheckboxStyleCache",void 0),W(this,"parsedPageNumberStyleCache",void 0),W(this,"parsedQuadSelectionStyleCache",void 0),W(this,"parsedCanvasStyleCache",void 0),W(this,"context",void 0),W(this,"isPageStyleChanged",void 0),W(this,"isCurrentPageStyleChanged",void 0),W(this,"isSelectedPageStyleChanged",void 0),W(this,"isHoveredPageStyleChanged",void 0),W(this,"isPlaceholderStyleChanged",void 0),W(this,"isCheckboxStyleChanged",void 0),W(this,"isPageNumberStyleChanged",void 0),W(this,"isQuadSelectionStyleChanged",void 0),W(this,"isCanvasStyleChanged",void 0),this.context=n}getParsedCanvasStyle(){return!this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=Dp(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(n){return!this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=Dp(this.context.viewerConfig.checkboxStyle,n),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(n){return!this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=Dp(this.context.viewerConfig.pageNumberStyle,n),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return!this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=Dp(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return!this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=Dp(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return!this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=Dp(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return!this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=Dp(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return!this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=Dp(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return!this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=Dp(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:n}=this.context;return Q_(n.pageStyle)===Q_(n.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:n}=this.context;return Q_(n.selectedPageStyle)===Q_(n.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:n}=this.context;return Q_(n.pageStyle)===Q_(n.selectedPageStyle)}}function Dp(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const o={};if(function(h){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:y,ctrlBorder:_}=h;if(!gt(y)){const b=nL(y);Object.assign(v,b)}if(!gt(_)){const b=nL(_);Object.assign(v,{ctrlBorderWidth:b.borderWidth,ctrlBorderColor:b.borderColor,ctrlBorderStyle:b.borderStyle})}}(p,o),function(h){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};FPe.forEach(y=>{gt(h[y])||(v[y]=ni(h[y]).value||0)})}(p,o),function(h){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};LPe.forEach(y=>{gt(h[y])||(v[y]=h[y])})}(p,o),function(h,v){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!gt(h.width)&&(y.width=lm(h.width,v.width),gt(h.translateX)||(y.translateX=lm(h.translateX,y.width)),!gt(h.borderRadius))){const _=lm(h.borderRadius,y.width);y.borderRadiusX=Math.max(0,Math.min(_,y.width/2))}if(!gt(h.height)&&(y.height=lm(h.height,v.height),gt(h.translateY)||(y.translateY=lm(h.translateY,y.height)),!gt(h.borderRadius))){const _=lm(h.borderRadius,y.height);y.borderRadiusY=Math.max(0,Math.min(_,y.height/2))}if(!gt(h.borderRadius)){const _=lm(h.borderRadius,v.width);y.borderRadius=Math.max(0,Math.min(_,v.height/2,v.width/2))}if(!gt(h.ctrlBorderRadius)){const _=lm(h.ctrlBorderRadius,y.ctrlWidth);y.ctrlBorderRadius=Math.max(0,Math.min(_,y.ctrlWidth/2,y.ctrlHeight/2))}NPe.forEach(_=>{const b=["left","right"].includes(_)?v.width:v.height,w=Nv(h[_]);let I=w.value;"%"===w.unit&&(I=b*w.value/100),y[_]=I})}(p,n,o),p.left||p.right||p.bottom||p.top){const{left:h,top:v,right:y,bottom:_,width:b,height:w,translateX:I,translateY:A}=o;o.x=""!==p.left?h+I||0:""!==p.right&&$t(b)&&n.width-b-y+I||0,o.y=""!==p.top?v+A||0:""!==p.bottom&&$t(w)&&n.height-w-_+A||0}return o}const FPe=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],LPe=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],NPe=["left","top","right","bottom"],Iw="visible",of="hidden";class BPe{constructor(n){W(this,"context",void 0),this.context=n}handleVisibility(n){if(this.context.isDestroyed||n.isDestroyed||!n.total||!n.isActive)return;const{context:o}=this;if(o.isDefaultViewer?n.context.isContinuousDisplay?this.continuousVisibility(n):n.context.isSingleDisplay&&this.singleVisibility(n):o.isThumbnailViewer?this.thumbnailVisibility(n):o.isPerspectiveViewer&&n.context.isSingleDisplay&&this.singleVisibility(n),n.context.pagePreloadChanges.length){n.context.pagePreloadChanges.forEach(v=>{if(v.from&&!v.to){const y=n.getPageByUid(v.pageUid);y&&(y.isLoaded=!1)}});const h=Q2.create(n.uid,o.uid,o.viewerConfig.viewerMode,n.context.pagePreloadChanges);o.core.viewerService.onPagePreloadChanged.emit(h)}}thumbnailVisibility(n){const{total:o}=n;if(!o)return;const h=n.context;if(h.isOutOfBounds)return void n.pages.forEach($=>{$.updateStyle({visibility:"hidden"})});const{rows:v,columns:y,placeholderPages:_,preloadCount:b,isVertical:w}=h,{width:I,height:A}=_[0],M=h.getParsedPageStyle(),F=h.getParsedCurrentPageStyle(),V=h.getParsedSelectedPageStyle(),B=h.getParsedHoveredPageStyle(),Q=h.getParsedPlaceholderStyle(),J=h.getParsedPageNumberStyle(I,A),Z=h.getParsedCheckboxStyle(I,A),{visibility:re,top:se,bottom:ce,onPage:pe,height:Ce}=J;let Ve=0;const te="visible"===re,Me=h.getPageNumberStyle();if(te){const $=""!==Me.top?se:ce||0;pe||(Ve=""!==Me.top?Ce+$:0)}const{realColumn:we,realRow:Le}=h.getRealRowAndColumnThumbnail(),{startRow:j,endRow:L}=this.getVisibleRow(n,Le,we),{startColumn:Y,endColumn:q}=this.getVisibleColumn(n,Le,we);n.context.startRow=j,n.context.endRow=L,n.context.startColumn=Y,n.context.endColumn=q;const k=Zv(F.borderWidth),N=[];n.pages.forEach(($,ie)=>{const ee=w?Math.floor(ie/y):ie%v,ne=w?ie%y:Math.floor(ie/v),le=ee>=j-b&&ee<=L+b&&ne>=Y-b&&ne<=q+b,fe=ee>=j&&ee<=L&&ne>=Y&&ne<=q?Iw:of;$.isPreload!==le&&N.push({from:$.isPreload,to:le,pageUid:$.uid,index:ie});let xe={borderWidth:0,background:"#ffffff00"};$.isDragging&&(xe=Q);let Pe=M;$.isHovered&&(Pe=B),$.isSelected&&(Pe=V);const De=Zv(Pe.borderWidth);if($.isPreload=le,$.updateStyle(Ke({visibility:fe},xe)),$.borderBox.updateStyle(zt(Ke({},Pe),{visibility:fe,borderWidth:De})),te){let ke=J.y;pe||(ke=""!==Me.top?-Ve:J.y+J.bottom),$.pageNumber.parsedPageNumberStyle=zt(Ke({},J),{y:ke}),$.pageNumber.updateText((ie+1).toString())}$.pageNumber.updateStyle({visibility:J.visibility,zIndex:J.onPage?1:0});let je=Z.visibility;Z.visibleByHover&&(je=$.isHovered||$.isSelected?Z.visibility:"hidden"),$.checkbox.parsedCheckboxStyle=Ke({},Z),$.checkbox.updateStyle({visibility:je}),$.checkbox.checked=$.isSelected,$.curBox.updateStyle(zt(Ke({},F),{visibility:$.uid===n.currentUid?Iw:of,borderWidth:k}))}),n.context.pagePreloadChanges=N}continuousVisibility(n){const{preloadCount:o,isVertical:h}=n.context,{pages:v}=n,y=n.context.getParsedPageStyle(),_=n.context.getParsedCurrentPageStyle(),{realRow:b,realColumn:w}=n.context.getRealRowAndColumnContinuous(),{startRow:I,endRow:A}=this.getVisibleRow(n,b,w),{startColumn:M,endColumn:F}=this.getVisibleColumn(n,b,w);n.context.startRow=I,n.context.endRow=A,n.context.startColumn=M,n.context.endColumn=F;const V=Zv(y.borderWidth),B=Zv(_.borderWidth),Q=[];v.forEach((J,Z)=>{const re=h?Math.floor(Z/w):Z%b,se=h?Z%w:Math.floor(Z/b),ce=re>=I&&re<=A&&se>=M&&se<=F,pe=re>=I-o&&re<=A+o&&se>=M-o&&se<=F+o;J.isPreload!==pe&&Q.push({from:J.isPreload,to:pe,pageUid:J.uid,index:Z}),J.checkbox.updateStyle({visibility:of}),J.pageNumber.updateStyle({visibility:of}),J.curBox.updateStyle(zt(Ke({},_),{visibility:J.uid===n.currentUid?Iw:of,borderWidth:B})),J.borderBox.updateStyle(zt(Ke({},y),{borderWidth:V})),J.updateStyle({visibility:ce?Iw:of}),J.isPreload=pe}),n.context.pagePreloadChanges=Q}singleVisibility(n){const{preloadCount:o}=n.context,{current:h,total:v,pages:y}=n,_=n.getCurrentPage(),b=n.context.getParsedPageStyle(),w=Math.max(h-o,0),I=Math.min(h+o,v-1);_.checkbox.updateStyle({visibility:of}),_.pageNumber.updateStyle({visibility:of});const A=Zv(b.borderWidth),M=[];y.forEach((F,V)=>{const B=V>=w&&V<=I,Q=F.uid===_.uid;F.isPreload!==B&&M.push({from:F.isPreload,to:B,pageUid:F.uid,index:V}),F.borderBox.updateStyle(zt(Ke({},b),{borderWidth:A})),F.updateStyle({visibility:Q?Iw:of}),F.isPreload=B,F.curBox.updateStyle({visibility:of})}),n.context.pagePreloadChanges=M}getVisibleColumn(n,o,h){const{scrollLeft:v,placeholderPages:y,currentViewportWidth:_,isVertical:b}=n.context;let w=0,I=h-1;if(b&&this.context.isThumbnailViewer)return{startColumn:w,endColumn:I};let A=Number.MAX_VALUE,M=Number.MAX_VALUE,F=null,V=null;for(let B=0;B<h;B++){const Q=y[b?B:B*o];if(!Q)continue;const{width:J,x:Z}=Q;if(null===F){const re=Z-v;re<=0&&v-(Z+J)<-1?(F=B,w=B):re>0&&re<A&&(A=re,w=B)}if(null===V){const re=v+_,se=re-(Z+J);Z-re<-1&&se<=0?(V=B,I=B):se>0&&se<M&&(M=se,I=B)}if(null!==F&&null!==V)break}return{startColumn:w,endColumn:I}}getVisibleRow(n,o,h){const{scrollTop:v,placeholderPages:y,currentViewportHeight:_,isVertical:b}=n.context;let w=0,I=o-1;if(!b&&this.context.isThumbnailViewer)return{startRow:w,endRow:I};let A=Number.MAX_VALUE,M=Number.MAX_VALUE,F=null,V=null;for(let B=0;B<o;B++){const Q=y[b?B*h:B];if(!Q)continue;const{y:J,height:Z}=Q;if(null===F){const re=J-v;re<=0&&v-(J+Z)<-1?(F=B,w=B):re>0&&re<A&&(A=re,w=B)}if(null===V){const re=v+_,se=re-(J+Z);J-re<-1&&se<=0?(V=B,I=B):se>0&&se<M&&(M=se,I=B)}if(null!==F&&null!==V)break}return{startRow:w,endRow:I}}}function Tee(p,n,o,h){const v={isOver:!1,pointerX:-1,pointerY:-1,page:p};if(p&&h){const{x:y,y:_}=p.getPosition(),{width:b,height:w}=p;v.isOver=n>=y&&o>=_&&n<=y+b&&o<=_+w;const I=p.getScale();v.pointerX=(n-y)/I.x,v.pointerY=(o-_)/I.y}return v}const WPe={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},UPe={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},VPe={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},jPe={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},HPe={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},GPe={tag:"div",id:"ddv-core",className:"ddv-core"};class zPe extends or{constructor(n,o){super(),W(this,"container",void 0),W(this,"defaultDom",void 0),W(this,"mainAndThbContainer",void 0),W(this,"thumbnailContainer",void 0),W(this,"mainContainer",void 0),W(this,"scrollerAndCanvasContainer",void 0),W(this,"scrollContainer",void 0),W(this,"scrollContent",void 0),W(this,"canvasContainer",void 0),W(this,"videoContainer",void 0),W(this,"audioContainer",void 0),W(this,"rootDom",void 0),W(this,"hooks",void 0),W(this,"isBindContainer",!1),W(this,"viewportWidth",void 0),W(this,"viewportHeight",void 0),W(this,"context",void 0),W(this,"dpr",Yx()),W(this,"hasScrollbarX",!1),W(this,"hasScrollbarY",!1),this.context=n,this.hooks=o;const h=am(GPe,n.postfix);this.defaultDom=h}dispose(){var n,o;null===(n=this.rootDom)||void 0===n||n.remove(),null===(o=this.thumbnailContainer)||void 0===o||o.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose()}createMainAndThbContainer(){if(!this.mainAndThbContainer){const o=am(HPe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainAndThbContainer=o,this.defaultDom.appendChild(o)}}createMainContainer(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const o=am(UPe,n);this.mainContainer=o,this.mainAndThbContainer.appendChild(o);const h=o.querySelector(`#ddv-scroller-and-canvas${n}`),v=o.querySelector(`#ddv-canvas-container${n}`),y=o.querySelector(`#ddv-scroll-container${n}`),_=o.querySelector(`#ddv-scroll-content${n}`);this.scrollerAndCanvasContainer=h,this.canvasContainer=v,this.scrollContainer=y,this.scrollContent=_;const b=I=>{I.target===o&&this.isBindContainer&&this.context.isInitialized&&this.context.resize()},{resizeService:w}=this.context.core;w.observe(o),w.onResizeObserver.on(b,this),this.context.hooks.destroy.on(()=>{w.unobserve(o)})}}createThumbnailContainer(){if(!this.thumbnailContainer){const o=am(WPe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.thumbnailContainer=o,this.mainAndThbContainer.insertBefore(o,this.mainContainer)}}createVideoContainer(){if(!this.videoContainer){const o=am(VPe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(o)}}createAudioContainer(){if(!this.audioContainer){const o=am(jPe,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");this.mainContainer.appendChild(o)}}getViewportSize(){if(!this.mainContainer)return{width:0,height:0};const{offsetWidth:n,offsetHeight:o}=this.getElSize(this.mainContainer),h=this.getCanvasBorderSize();return{width:n-2*h,height:o-2*h}}resetViewport(){const{scrollContent:n,canvasContainer:o}=this;Z_(o,0,0),Z_(n,0,0);const{width:h,height:v}=this.getViewportSize();this.viewportWidth=h,this.viewportHeight=v,this.updateCanvasContainerSize()}resizeViewport(){const{canvasContainer:n,scrollContainer:o}=this;Z_(n,0,0);const{offsetWidth:h,offsetHeight:v}=this.getElSize(o);this.viewportWidth=h,this.viewportHeight=v,this.updateCanvasContainerSize()}checkIsRound(n){const o=getComputedStyle(n);return{roundWidth:parseFloat(o.width)%1>=.5,roundHeight:parseFloat(o.height)%1>=.5}}getElSize(n){const{roundWidth:o,roundHeight:h}=this.checkIsRound(n);let{clientWidth:v,clientHeight:y,offsetWidth:_,offsetHeight:b}=n;return o&&(v-=1,_-=1),h&&(y-=1,b-=1),{clientWidth:v,clientHeight:y,offsetWidth:_,offsetHeight:b}}getMaxScrollValue(){const{scrollContainer:n}=this;return{scrollLeft:n.scrollWidth-n.clientWidth,scrollTop:n.scrollHeight-n.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const n=Yx();return this.dpr!==n&&(this.dpr=n,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(n){let o=n;return n&&Sn(n)&&(o=document.querySelector(`#${n}`)),o instanceof HTMLElement&&(o.appendChild(this.defaultDom),this.container=o,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return!1;for(let n=0;n<this.container.children.length;n++)if(this.container.children[n]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(n,o){const{scrollContainer:h}=this;h.scrollTo?h.scrollTo(n,o):(h.scrollLeft=n,h.scrollTop=o)}scrollBy(n,o){const{scrollContainer:h}=this;h.scrollBy?h.scrollBy(n,o):(h.scrollLeft+=n,h.scrollTop+=o)}updateScrollerContentSize(n){const{currentLayoutWidth:o,currentLayoutHeight:h}=n.context,{scrollContent:v,canvasContainer:y,scrollContainer:_}=this;Z_(y,10,10),Z_(v,o,h);const b=_.scrollWidth-_.clientWidth,w=_.scrollHeight-_.clientHeight;n.context.maxScrollLeft=b,n.context.maxScrollTop=w;const I=b>0,A=w>0;let M=!1;I!==this.hasScrollbarX&&(this.hasScrollbarX=I,M=!0),A!==this.hasScrollbarY&&(this.hasScrollbarY=A,M=!0),M&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize()}updateCanvasContainerSize(){const{scrollContainer:n,canvasContainer:o}=this,{width:h,height:v}=getComputedStyle(this.scrollContainer);let y,_=parseFloat(h),b=parseFloat(v);n.offsetWidth!==n.clientWidth&&($t(y)||(y=iL()),_-=y),n.offsetHeight!==n.clientHeight&&($t(y)||(y=iL()),b-=y),Z_(o,_,b)}getCanvasBorderSize(){const{canvasContainer:n}=this;return(n.offsetWidth-n.clientWidth)/2}}class YPe{constructor(){W(this,"canvasDom",void 0),W(this,"canvas",void 0),W(this,"renderer",void 0),W(this,"isInitialized",!1),W(this,"canvasWidth",0),W(this,"canvasHeight",0)}clear(){var n;const o=null===(n=this.canvas)||void 0===n?void 0:n.document.documentElement;!o||(o.children.slice().forEach(h=>{o.removeChild(h)}),o.sortable.sorted=[])}render(n){var o;const h=null===(o=this.canvas)||void 0===o?void 0:o.document.documentElement;if(h){if(n)0===h.children.length?h.appendChild(n):h.children.indexOf(n)<0&&h.replaceChild(n,h.children[0]);else{const v=[...h.children];for(let y=v.length;y>=0;y--)h.removeChild(v[y])}this.canvas.render()}}initCanvas(n){let{container:o,width:h,height:v}=n;const y=new CZ({}),_=new hZ({renderer:y,container:o,width:h,height:v});this.canvasWidth=h,this.canvasHeight=v,this.renderer=y,this.canvas=_,this.canvasDom=_.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0}registerShapeRenderer(n,o){this.canvas.contextService.registerShapeRenderer(n,o)}getCanvasPosition(){const n=this.canvasDom.getBoundingClientRect(),{scrollX:o,scrollY:h}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return{x:n.left+o,y:n.top+h}}resize(n,o){const h=Yx();this.canvas.setDPR(h),this.canvasWidth=n,this.canvasHeight=o,this.canvas.resize(n,o)}}class XPe{render(n,o){const{opacity:h,visibility:v}=n.parsedCheckboxStyle;0!==h&&"hidden"!==v&&(o.save(),o.globalAlpha=h,this.renderBox(n,o,"out"),o.clip(),this.renderBox(n,o,"in"),this.fill(n,o),this.renderBox(n,o,"center"),this.stroke(n,o),this.renderCheckMark(n,o),o.restore())}renderBox(n,o,h){const{x:v,y,width:_,height:b,borderWidth:w,borderRadiusX:I,borderRadiusY:A}=n.parsedCheckboxStyle;let M=0;"center"===h?M=w/2:"in"===h&&(M=w);const F=[{x:v+I,y:y+A,start:Math.PI,end:3*Math.PI/2},{x:v+_-I,y:y+A,start:3*Math.PI/2,end:2*Math.PI},{x:v+_-I,y:y+b-A,start:0,end:Math.PI/2},{x:v+I,y:y+b-A,start:Math.PI/2,end:Math.PI}],V=Math.max(I-M,0),B=Math.max(A-M,0);if(o.beginPath(),o.ellipse&&V&&B)for(let Q=0;Q<4;Q++){const{x:J,y:Z,start:re,end:se}=F[Q];o.ellipse(J,Z,V,B,0,re,se)}else o.rect(v,y,_,b);o.closePath()}fill(n,o){const{background:h}=n.parsedCheckboxStyle;h&&""!==h&&(o.fillStyle=h,o.fill())}stroke(n,o){const{borderColor:h,borderWidth:v,borderStyle:y}=n.parsedCheckboxStyle;o.setLineDash(y),o.strokeStyle=h,o.lineWidth=v,v>0&&h&&""!==h&&o.stroke()}renderCheckMark(n,o){if(!n.checked)return;const{x:h,y:v,width:y,height:_,borderWidth:b,checkMarkLineWidth:w,checkMarkColor:I}=n.parsedCheckboxStyle,A=Math.max(Math.min(y-2*b,_-2*b),0);let M=h,F=v;0!==A&&(y<_?(M+=b,F=F+b+(_-y)/2):(M=M+b+(y-_)/2,F+=b),o.setLineDash([0,0]),o.lineWidth=w,o.strokeStyle=I,o.beginPath(),o.moveTo(M+.15*A,F+.5*A),o.lineTo(M+.4*A,F+.8*A),o.lineTo(M+.85*A,F+.2*A),o.stroke())}}class $Pe{render(n,o){const{opacity:h,visibility:v}=n.parsedPageNumberStyle;0!==h&&"hidden"!==v&&(o.save(),o.globalAlpha=h,this.renderBox(n,o,"out"),o.clip(),this.renderBox(n,o,"in"),this.fill(n,o),this.renderBox(n,o,"center"),this.stroke(n,o),this.renderFont(n,o),o.restore())}renderBox(n,o,h){const{x:v,y,width:_,height:b,borderWidth:w,borderRadiusX:I,borderRadiusY:A}=n.parsedPageNumberStyle;let M=0;"center"===h?M=w/2:"in"===h&&(M=w);const F=[{x:v+I,y:y+A,start:Math.PI,end:3*Math.PI/2},{x:v+_-I,y:y+A,start:3*Math.PI/2,end:2*Math.PI},{x:v+_-I,y:y+b-A,start:0,end:Math.PI/2},{x:v+I,y:y+b-A,start:Math.PI/2,end:Math.PI}],V=Math.max(I-M,0),B=Math.max(A-M,0);if(o.beginPath(),o.ellipse&&V&&B)for(let Q=0;Q<4;Q++){const{x:J,y:Z,start:re,end:se}=F[Q];o.ellipse(J,Z,V,B,0,re,se)}else o.rect(v,y,_,b);o.closePath()}renderFont(n,o){const{x:h,y:v,width:y,height:_,fontSize:b,color:w,fontFamily:I}=n.parsedPageNumberStyle;o.fillStyle=w,o.textAlign="center",o.textBaseline="middle",o.font=I.includes(" ")?`${b}px '${I}'`:`${b}px ${I}`,o.fillText(n.text,h+y/2,v+_/2+b/8,y)}fill(n,o){const{background:h}=n.parsedPageNumberStyle;h&&""!==h&&(o.fillStyle=h,o.fill())}stroke(n,o){const{borderColor:h,borderWidth:v,borderStyle:y}=n.parsedPageNumberStyle;o.setLineDash(y),o.strokeStyle=h,o.lineWidth=v,v>0&&h&&""!==h&&o.stroke()}}class qPe extends or{constructor(n,o){super(),W(this,"context",void 0),W(this,"docRenderer",void 0),W(this,"hooks",void 0),this.context=n,this.hooks=o,this.docRenderer=new YPe}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null}initRenderer(n,o,h){this.docRenderer.isInitialized||(Object.assign(n.style,this.context.viewerConfig.canvasStyle),this.docRenderer.initCanvas({container:n,width:o,height:h}),this.docRenderer.registerShapeRenderer("checkbox",new XPe),this.docRenderer.registerShapeRenderer("pageNumber",new $Pe))}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const n=this.getCanvasDom();!n||n.getContext("2d").clearRect(0,0,n.width,n.height)}resize(n,o){this.docRenderer&&this.docRenderer.resize(n,o)}updateCanvasSize(){if(this.docRenderer){const n=this.getCanvasDom();if(!n)return;const{clientWidth:o,clientHeight:h}=n;this.docRenderer.resize(o,h)}}render(n){n.isDestroyed||(this.hooks.beforeRender.emit(n),this.docRenderer.render(n),this.hooks.afterRender.emit(n),n.pages.forEach((o,h)=>{if(o.isVisible&&o.isLoaded){const v=pF.create(h,o.uid);this.context.emit("pageRendered",v)}}))}getCanvasPosition(){const n=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:o,scrollY:h}=window;return{x:n.left+o,y:n.top+h}}}function KPe(p){const n=p.getPages(),o=n.length;if(!o)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);let{viewportWidth:h,viewportHeight:v}=p;const{rows:y,columns:_,scrollbarWidth:b,tab:w,isVertical:I}=p,A=p.getMargin();_*y<o&&(I?h-=b:v-=b);let M=0,F=0;I?(M=(h-(_+1)*A)/_,F=(v-(y+1)*A)/y):(F=(v-(y+1)*A)/y,M=(h-(_+1)*A)/_);let V=!1;(M<0||F<0)&&(V=!0,M=Math.max(0,M),F=Math.max(0,F));const B=I?Math.max(y,Math.ceil(o/_)):y,Q=I?_:Math.max(_,Math.ceil(o/y)),J=M*Q+(Q+1)*A,Z=F*B+(B+1)*A,re=w.pages.map(ee=>({uid:ee.uid,x:0,y:0,width:M,height:F})),se=p.getParsedPageStyle(),ce=p.getParsedSelectedPageStyle(),pe=p.getParsedHoveredPageStyle(),Ce=p.getParsedPageNumberStyle(M,F),{visibility:Ve,top:te,bottom:Me,onPage:we,height:Le}=Ce;let j=M,L=F;const Y=M;let q=F,k=0;const N="visible"===Ve,$=p.getPageNumberStyle();if(N){const ee=""!==$.top?te:Me||0;we||(L=F-Le-ee,q=F-Le-ee,k=""!==$.top?Le+ee:0)}L<0&&(V=!0,L=Math.max(0,L)),(j-2*se.borderWidth<0||L-2*se.borderWidth<0)&&(V=!0);const ie=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=V?0:J+2*ie,p.currentLayoutHeight=V?0:Z+2*ie,p.currentViewportWidth=V?p.viewportWidth:h,p.currentViewportHeight=V?p.viewportHeight:v,p.isOutOfBounds=V,V||(j=vl(j),L=vl(L),n.forEach((ee,ne)=>{let le=se.borderWidth;ee.isHovered&&(le=pe.borderWidth),ee.isSelected&&(le=ce.borderWidth),le=Zv(le);const fe=I?ne%_:Math.floor(ne/y),xe=I?Math.floor(ne/_):ne%y,Pe=A+fe*(A+M),De=A+xe*(A+F);re[ne].x=Pe,re[ne].y=De;let je=j-2*le,ke=L-2*le;je=Math.max(je,0),ke=Math.max(ke,0);const Ae=ee.rWidth,he=ee.rHeight;let tt=Ae,Ze=he,nt=1;(Ae>je||he>ke)&&(Ae/he>je/ke?(nt=je/Ae,tt=je,Ze=he*nt):(nt=ke/he,Ze=ke,tt=Ae*nt)),ee.zoom=nt;const et=Ep(Pe),Qe=Ep(De+k);let at=le+(je-tt)/2,vt=le+(ke-Ze)/2;at=Ep(at),vt=Ep(vt);const dt=vl(Ae),Je=vl(he),it=Ae*(1-nt)/2,ct=he*(1-nt)/2,wt=ee.cropWidth,ht=ee.cropHeight,At=at-it-(wt-dt)/2,kt=vt-ct-(ht-Je)/2,Bt=at-it,Ft=vt-ct,Ht=dt,Kt=Je,an=at,fn=vt,ln=vl(tt),wn=vl(Ze);ee.setPage(et,Qe,Y,q),ee.setBorderBox(0,0,j,L,le),ee.setCropBox(At,kt,wt,ht,nt,ee.rotation),ee.setRealTimeBox(Bt,Ft,Ht,Kt,nt);const{width:ut,height:ft}=p.viewerContext.getPageRenderSize(ee.uid);ee.setMediaBox(-ee.cropLeft,-ee.cropTop,ut,ft),ee.setImage(0,0,ut,ft),ee.setCurBox(an,fn,ln,wn)}),p.placeholderPages=re)}function Iee(p){const{tab:n}=p,o=n.getCurrentPage();if(!o)return p.currentLayoutWidth=0,void(p.currentLayoutHeight=0);const{viewportWidth:h,viewportHeight:v,scrollbarWidth:y,fitMode:_}=p,b=p.getMargin(),w=p.getParsedPageStyle(),{borderWidth:I=0}=w,A=2*I,M=o.rWidth,F=o.rHeight,V=2*b,B=A+V,Q=A+V,J=h-B,Z=v-Q;let{zoom:re}=p;const se=Eee(_,{zoom:re,validLayoutWidth:M,validLayoutHeight:F,scrollbarWidth:y,fitViewportWidth:J,fitViewportHeight:Z,isZoomChanged:p.isZoomChanged},JPe);p.isZoomChanged=!1;const{zoomedLayoutWidth:ce,zoomedLayoutHeight:pe,zoomedViewportWidth:Ce,zoomedViewportHeight:Ve,newFitMode:te}=se;if(re=se.zoom,te&&_!==te){p.fitMode=te,p.viewerContext.viewerConfig.fitMode=te;const Qe=$_.create(_,te);p.viewerContext.hooks.fitModeChanged.emit(Qe)}p.setZoom(re);const Me=ce+B,we=pe+Q,Le=Ce+B,j=Ve+Q,L=p.viewerContext.viewService.getCanvasBorderSize();p.currentLayoutWidth=Me+2*L,p.currentLayoutHeight=we+2*L,p.currentViewportWidth=Le,p.currentViewportHeight=j,o.zoom=re,p.tab.setPosition({x:-0,y:-0});const Y=n.pages.map(Qe=>{let{uid:at}=Qe;return{uid:at,x:b,y:b,width:ce+A,height:pe+A}});p.placeholderPages=Y;const q=vl(ce+A),k=vl(pe+A),N=Ep(b),$=N,ie=Zv(I),ee=ie,ne=vl(M),le=vl(F),fe=M*(1-re)/2,xe=F*(1-re)/2,Pe=o.cropWidth,De=o.cropHeight,je=ie-fe-(Pe-ne)/2,ke=ee-xe-(De-le)/2,Ae=ie-fe,he=ee-xe,tt=ne,Ze=le;o.setPage(N,$,q,k),o.setBorderBox(0,0,q,k),o.setCropBox(je,ke,Pe,De,re,o.rotation),o.setRealTimeBox(Ae,he,tt,Ze,re);const{width:nt,height:et}=p.viewerContext.getPageRenderSize(o.uid);o.setMediaBox(-o.cropLeft,-o.cropTop,nt,et),o.setImage(0,0,nt,et)}function JPe(p,n){let{zoom:o,validLayoutWidth:h,validLayoutHeight:v,scrollbarWidth:y,fitViewportWidth:_,fitViewportHeight:b}=n;return"none"===p||"actualSize"===p?("actualSize"===p&&(o=1),Math.floor(h*o)>_&&(b-=y),Math.floor(v*o)>b&&(_-=y)):"width"===p||"window"===p&&h/_>=v/b?(o=_/h,v*o>b&&(_-=y,o=_/h)):(o=b/v,h*o>_&&(b-=y,o=b/v)),{zoom:o,zoomedLayoutWidth:h*o,zoomedLayoutHeight:v*o,zoomedViewportWidth:_,zoomedViewportHeight:b}}function Eee(p,n,o){const{zoom:h,isZoomChanged:v}=n;let y={};if(v){let _;const b=J_(h);1===h?(_="actualSize",y=o("actualSize",n)):(y=o("width",n),J_(y.zoom)===b?(_="width","window"===p&&(_="window")):(y=o("height",n),b===J_(y.zoom)&&(_="height","window"===p&&(_="window")))),_?y.newFitMode=_:(y=o("none",n),y.newFitMode="none")}else y=o(p,n);return y}function QPe(p,n){let{zoom:o,fitWidth:h,fitHeight:v,validLayoutWidth:y,validLayoutHeight:_,scrollbarWidth:b,isVertical:w,fitViewportWidth:I,fitViewportHeight:A}=n;return"none"===p||"actualSize"===p?("actualSize"===p&&(o=1),Math.floor(y*o)>I&&(A-=b),Math.floor(_*o)>A&&(I-=b)):"width"===p||"window"===p&&h/I>=v/A?(o=I/h,w?_*o>A&&(I-=b,o=I/h):(y*o>I&&(A-=b),v*o>A&&(I-=b,o=I/h))):(o=A/v,w?(_*o>A&&(I-=b),h*o>I&&(A-=b,o=A/v)):y*o>I&&(A-=b,o=A/v)),{zoom:o,zoomedLayoutWidth:y*o,zoomedLayoutHeight:_*o,zoomedViewportWidth:I,zoomedViewportHeight:A}}const Dee=p=>{const n=p.getPages();if(!n.length)return;const{tab:o}=p,h=o.current,v=n[h-1],y=n[h+1];v&&Aee(p,v,-1),y&&Aee(p,y,1)};function Aee(p,n,o){const{viewportWidth:h,viewportHeight:v}=p,y=p.getParsedPageStyle(),{borderWidth:_=0}=y,b=p.getMargin(),{rWidth:w,rHeight:I}=n,A=h-2*b-2*_,M=v-2*b-2*_;let F=0,V=0,B=1;w/I>A/M?(F=A,B=A/w,V=I*B):(V=M,B=M/I,F=w*B);let Q=(A-F)/2+b,J=(M-V)/2+b;Q=Math.max(b,Q),J=Math.max(b,J);const{x:Z,y:re}=p.tab.getPosition();-1===o?(Q=-h+Q-Z,J-=re):1===o&&(Q=h+Q-Z,J-=re);const Me=n.cropWidth,we=n.cropHeight,Le=_-w*(1-B)/2-(Me-w)/2,j=_-I*(1-B)/2-(we-I)/2,L="visible",Y="hidden";n.updateStyle({visibility:L,x:Q,y:J,width:F+2*_,height:V+2*_}),n.borderBox.updateStyle(zt(Ke({x:0,y:0,width:F+2*_,height:V+2*_},y),{background:"#ffffff00",visibility:L})),n.cropBox.setLocalScale(1),n.cropBox.updateStyle({x:Le,y:j,width:Me,height:we}),n.cropBox.setLocalScale(B,B,1),n.cropBox.setLocalAngle(n.rotation);const{width:q,height:k}=p.viewerContext.getPageRenderSize(n.uid);n.mediaBox.updateStyle({x:-n.cropLeft,y:-n.cropTop,width:q,height:k}),n.zoom=B,n.checkbox.updateStyle({visibility:Y}),n.pageNumber.updateStyle({visibility:Y}),n.setImage(0,0,q,k)}function ZPe(p){const{displayMode:n}=p;"single"===n?Iee(p):"continuous"===n?function(o){const h=o.getPages();if(!h.length)return o.currentLayoutWidth=0,void(o.currentLayoutHeight=0);let{zoom:v}=o;const{viewportWidth:y,viewportHeight:_,tab:b,fitMode:w,scrollbarWidth:I,isVertical:A}=o,M=o.getParsedPageStyle(),{borderWidth:F}=M,V=2*F,B=o.getMargin(),{realRow:Q,realColumn:J}=o.getRealRowAndColumnContinuous(),Z=new Array(J).fill(0),re=new Array(Q).fill(0);let se=0,ce=0;h.forEach((Ae,he)=>{const tt=A?Math.floor(he/J):he%Q,Ze=A?he%J:Math.floor(he/Q),et=Ae.rHeight+V;Z[Ze]=Math.max(Z[Ze],Ae.rWidth+V),re[tt]=Math.max(re[tt],et),se=Math.max(Z[Ze],se),ce=Math.max(re[tt],ce)});let pe=Z.reduce((Ae,he)=>Ae+he,0),Ce=re.reduce((Ae,he)=>Ae+he,0);const Ve=(J+1)*B,te=(Q+1)*B,Me=J*V+Ve,we=Q*V+te;pe+=Ve,Ce+=te;const Le=pe-Me,j=Ce-we;let L=0,Y=0,q=0,k=0;A?(L=y-Me,Y=_-2*B-V,q=Z.reduce((Ae,he)=>Ae+he-V,0),k=ce-V):(L=y-2*B-V,Y=_-we,q=se-V,k=re.reduce((Ae,he)=>Ae+he-V,0));const N=Eee(w,{zoom:v,fitWidth:q,fitHeight:k,validLayoutWidth:Le,validLayoutHeight:j,scrollbarWidth:I,isVertical:A,fitViewportWidth:L,fitViewportHeight:Y,isZoomChanged:o.isZoomChanged},QPe);o.isZoomChanged=!1;const{zoomedLayoutWidth:$,zoomedLayoutHeight:ie,zoomedViewportWidth:ee,zoomedViewportHeight:ne,newFitMode:le}=N;if(v=N.zoom,le&&w!==le){o.fitMode=le,o.viewerContext.viewerConfig.fitMode=le;const Ae=$_.create(w,le);o.viewerContext.hooks.fitModeChanged.emit(Ae)}o.setZoom(v);const fe=$+Me,xe=ie+we;let Pe=0,De=0;A?(Pe=ee+(J+1)*B+J*V,De=ne+2*B+V):(Pe=ee+2*B+V,De=ne+(Q+1)*B+Q*V);const je=o.viewerContext.viewService.getCanvasBorderSize();o.currentLayoutWidth=fe+2*je,o.currentLayoutHeight=xe+2*je,o.currentViewportWidth=Pe,o.currentViewportHeight=De,o.tab.setPosition({x:-0,y:-0});const ke=b.pages.map(Ae=>({uid:Ae.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0}));h.forEach((Ae,he)=>{const tt=A?Math.floor(he/J):he%Q,Ze=A?he%J:Math.floor(he/Q),nt=(Z[Ze]-V)*v+V,et=(re[tt]-V)*v+V,Qe=Ae.rWidth,at=Ae.rHeight;let vt=0,dt=0;if(0===Ze)vt=B;else{const lh=ke[A?he-1:(Ze-1)*Q+tt];vt=lh.x+lh.width+B}if(0===tt)dt=B;else{const lh=ke[A?(tt-1)*J+Ze:he-1];dt=lh.y+lh.height+B}const Je=ke[he];Je.width=nt,Je.height=et,Je.x=vt,Je.y=dt,Ae.zoom=v;const it=Qe*v,ct=at*v,wt=dt+(et-ct)/2-F,ht=Ep(vt+(nt-it)/2-F),At=Ep(wt);Je.pageX=ht,Je.pageY=At;let kt=it+V,Bt=ct+V;kt=vl(kt),Bt=vl(Bt);const Ft=Ep(F),Ht=Ft,Kt=vl(Qe),an=vl(at),fn=Qe*(1-v)/2,ln=at*(1-v)/2,wn=Ft,ut=Ft,ft=vl(it),Lt=vl(ct),Ut=Ae.cropWidth,sn=Ae.cropHeight,Yn=Ft-fn-(Ut-Kt)/2,ki=Ht-ln-(sn-an)/2,Hi=Ft-fn,Qi=Ht-ln,Lr=Kt,qa=an;Ae.setPage(ht,At,kt,Bt),Ae.setBorderBox(0,0,kt,Bt),Ae.setCropBox(Yn,ki,Ut,sn,v,Ae.rotation),Ae.setRealTimeBox(Hi,Qi,Lr,qa,v);const{width:fa,height:rd}=o.viewerContext.getPageRenderSize(Ae.uid);Ae.setMediaBox(-Ae.cropLeft,-Ae.cropTop,fa,rd),Ae.setImage(Ae.mediaBoxRect.left,Ae.mediaBoxRect.top,fa,rd),Ae.setCurBox(wn,ut,ft,Lt)}),o.placeholderPages=ke}(p):"slide"===n&&Dee(p)}class e6e{constructor(n,o){W(this,"context",void 0),W(this,"hooks",void 0),this.context=n,this.hooks=o}layout(n){if(n.isDestroyed||!n.isActive)return;let o;if(this.context.isDefaultViewer)o=ZPe;else if(this.context.isThumbnailViewer)o=KPe;else if(this.context.isPerspectiveViewer){const{displayMode:h}=n.context;"single"===h?o=Iee:"slide"===h&&(o=Dee)}o&&(this.hooks.beforeLayout.emit(n),o(n.context),this.hooks.afterLayout.emit(n))}}const t6e=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class n6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"handlers",{}),this.context=n}dispose(){this.context=null,this.handlers={},super.dispose()}updateConfig(n){for(const[o,h]of Object.entries(n))t6e.includes(o)&&this[o](h)}registerHandler(n,o){return!this[n]&&(this[n]=o,!0)}viewerMode(n){const{context:o}=this;o.viewerConfig.viewerMode=n}toolMode(n){const{context:o}=this,h=o.viewerConfig.toolMode;n!==h&&(o.viewerConfig.toolMode=n,o.hooks.toolModeChanged.emit(_F.create(h,n)))}annotationMode(n){const{context:o}=this,h=o.viewerConfig.annotationMode;n!==h&&(o.viewerConfig.annotationMode=n),o.hooks.annotationModeChanged.emit(wF.create(h,n))}fitMode(n){const{context:o}=this,h=o.getActiveTab();if(!h){const y=o.viewerConfig.fitMode;return y===n?void 0:(o.viewerConfig.fitMode=n,void o.hooks.fitModeChanged.emit($_.create(y,n)))}const v=h.context.fitMode;v!==n&&(h.context.fitMode=n,"none"!==n&&(o.showTab(h,!0),o.hooks.fitModeChanged.emit($_.create(v,n))))}displayMode(n){const{context:o}=this,h=o.getActiveTab();let v;if(h){if(v=h.context.displayMode,n===v)return;h.context.displayMode=n,o.showTab(h,!0)}else{if(v=o.viewerConfig.displayMode,n===v)return;o.viewerConfig.displayMode=n}if("slide"!==v&&"slide"!==n){const y=dF.create(v,n);o.viewer.hooks.displayModeChanged.emit(y)}}margin(n){const{context:o}=this;o.viewerConfig.margin!==n&&(o.viewerConfig.margin=n,o.showCurrentTab(!0))}rows(n){const{context:o}=this,h=o.getActiveTab();h?n!==h.context.rows&&(o.styleService.isCheckboxStyleChanged=!0,o.styleService.isPageNumberStyleChanged=!0,h.context.rows=n,this.context.showTab(h,!0)):o.viewerConfig.rows=n}columns(n){const{context:o}=this,h=o.getActiveTab();h?n!==h.context.columns&&(o.styleService.isCheckboxStyleChanged=!0,o.styleService.isPageNumberStyleChanged=!0,h.context.columns=n,this.context.showTab(h,!0)):o.viewerConfig.columns=n}maxColumns(n){n=Math.max(1,n);const{context:o}=this;o.viewerConfig.maxColumns=n;const h=o.getActiveTab();h&&h.context.columns>n&&this.columns(n)}maxRows(n){n=Math.max(1,n);const{context:o}=this;o.viewerConfig.maxRows=n;const h=o.getActiveTab();h&&h.context.rows>n&&this.rows(n)}zoom(n){const{context:o}=this;o.getActiveTab()&&o.zoomTo(n)}visibility(n){const{context:o}=this;if(n===o.viewerConfig.visibility)return;const{rootDom:h,defaultDom:v,thumbnailContainer:y}=o.viewService;if(!h)return;const{ui:_}=o.viewer,b=!y&&_.container.classList.contains("ddv-thumbnail-container"),w=o.viewerConfig.visibility;o.viewerConfig.visibility=n,"visible"===n?(h.style.display="flex",v.style.display="flex",b&&(_.container.style.display="flex"),o.core.viewerService.onResize.emit()):(h.style.display="none",b&&(_.container.style.display="none",o.core.viewerService.onResize.emit()));const I=LF.create(n,w);o.hooks.visibleChanged.emit(I)}zoomOrigin(n){const{context:o}=this;o.viewerConfig.zoomOrigin=n}minZoom(n){const{context:o}=this;o.viewerConfig.minZoom=n}maxZoom(n){const{context:o}=this;o.viewerConfig.maxZoom=n}multiselectMode(n){const{context:o}=this;o.viewerConfig.multiselectMode=n}canvasStyle(n){const{context:o}=this;if(Vn(n))if(Object.assign(o.viewerConfig.canvasStyle,n),o.isCaptureViewer){var h;const v=null===(h=o.viewer)||void 0===h||null===(h=h.cameraContext)||void 0===h?void 0:h.cameraContainer;v&&Object.assign(v.style,n)}else{const{canvasContainer:v}=o.viewService,y=o.rendererService.getCanvasDom();v&&(Object.assign(v.style,n),n.cursor&&y&&Object.assign(y.style,{cursor:n.cursor}),o.styleService.isCanvasStyleChanged=!0,n.border&&o.resize(),n.cursor&&o.hooks.canvasCursorStyleChanged.emit())}}pageStyle(n){const{context:o}=this;Vn(n)&&(Object.assign(o.viewerConfig.pageStyle,n),o.styleService.isPageStyleChanged=!0,o.showCurrentTab(!0))}selectedPageStyle(n){const{context:o}=this;Vn(n)&&(Object.assign(o.viewerConfig.selectedPageStyle,n),o.styleService.isSelectedPageStyleChanged=!0,o.showCurrentTab(!0))}hoveredPageStyle(n){const{context:o}=this;Vn(n)&&(Object.assign(o.viewerConfig.hoveredPageStyle,n),o.styleService.isHoveredPageStyleChanged=!0,o.showCurrentTab(!0))}placeholderStyle(n){const{context:o}=this;Vn&&(Object.assign(o.viewerConfig.placeholderStyle,n),o.styleService.isPlaceholderStyleChanged=!0,o.showCurrentTab())}currentPageStyle(n){const{context:o}=this;Vn&&(Object.assign(o.viewerConfig.currentPageStyle,n),o.styleService.isCurrentPageStyleChanged=!0,o.showCurrentTab())}pageNumberStyle(n){const{context:o}=this;if(Vn(n)){const{pageNumberStyle:h}=o.viewerConfig,v=(null==n?void 0:n.onPage)!==(null==h?void 0:h.onPage);Object.assign(h,n),o.styleService.isPageNumberStyleChanged=!0,o.showCurrentTab(v)}}checkboxStyle(n){const{context:o}=this;Vn(n)&&(Object.assign(o.viewerConfig.checkboxStyle,n),o.styleService.isCheckboxStyleChanged=!0,o.showCurrentTab())}quadSelectionStyle(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:o}=this;Vn(n)&&(Object.assign(o.viewerConfig.quadSelectionStyle,n),o.styleService.isQuadSelectionStyleChanged=!0,o.hooks.quadSelectionStyleChanged.emit(),o.showCurrentTab())}scrollDirection(n){const{context:o}=this;o.viewerConfig.scrollDirection=n;const h=o.getActiveTab();h&&(h.context.direction=n,o.resize())}}class i6e extends or{constructor(n){super(),W(this,"context",void 0),this.context=n}dispose(){super.dispose(),this.context=null}handleExternalEvents(){const{context:n}=this,{hooks:o}=this.context;if(o.pageChanged.on(h=>{const v=this.context.getActiveTab();let y;!v||0===v.total||-1===v.current&&-1!==v.oldCurrent?y=0:-1!==v.current&&-1===v.oldCurrent&&(y=h.total),gt(y)||o.pageExistenceChanged.emit(HF.create(y))}),o.pageChangedAfterRender.on(h=>{const v=this.context.getActiveTab();if(!v)return;const{current:y,oldCurrent:_,currentUid:b,oldCurrentUid:w}=v;if(_!==y){const I=uF.create(_,y);n.emit("currentIndexChanged",I)}if(w!==b){const I=bF.create(w||"",b||"");n.emit("currentPageChanged",I),o.currentPageChanged.emit(h)}}),o.displayModeChanged.on(h=>{n.emit("displayModeChanged",Ke({},h))}),o.fitModeChanged.on(h=>{n.emit("fitModeChanged",Ke({},h))}),o.toolModeChanged.on(h=>{n.emit("toolModeChanged",Ke({},h))}),o.zoomChanged.on(h=>{h.oldZoomRatio!==h.newZoomRatio&&this.context.viewer.emit("zoomChanged",Ke({},h))}),!this.context.isCaptureViewer){const h=this.context.rendererService.getCanvasDom();$o(h,"click",this).on(v=>{const y=this.formatEvent(v);n.emit("click",y)}),$o(h,"dblclick",this).on(v=>{const y=this.formatEvent(v);n.emit("dblclick",y)}),$o(document.body,"dblclick",this).on(v=>{}),$o(h,"contextmenu",this).on(v=>{v.preventDefault();const y=this.formatEvent(v);n.emit("rightclick",y)})}}formatEvent(n){var o,h;const[v]=this.context.formatTouches(n),y=this.context.getPointerOverPageInfo(v.pageX,v.pageY),_=jn.displayResolution,b=jn.dataResolution,{pointerX:w,pointerY:I}=y.imageInfo;return Y2.create(y.index,null!==(o=null===(h=y.pageInfo.page)||void 0===h?void 0:h.uid)&&void 0!==o?o:"",w<0?-1:Xh(Kn(w,_,b),2),I<0?-1:Xh(Kn(I,_,b),2),Math.floor(v.pageX),Math.floor(v.pageY),n)}}class r6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"offsetX",0),W(this,"offsetY",0),W(this,"startX",0),W(this,"startY",0),W(this,"isDragging",!1),W(this,"startPage",void 0),W(this,"newIndexes",void 0),W(this,"cacheChildren",void 0),W(this,"cacheSelectedIndexes",void 0),W(this,"isMousedown",!1),W(this,"starDragIndices",[]),this.context=n}dispose(){super.dispose(),this.context=null}startHandler(n){const{context:o}=this,{viewerConfig:h}=o;if("pan"!==h.toolMode||o.isLoadSource)return;const y=o.getActiveTab();if(null==y||!y.total)return;this.isMousedown=!0;const[_]=o.formatTouches(n),{page:b}=o.getPointerOverPageInfo(_.pageX,_.pageY).pageInfo;if(b&&b){this.startX=_.pageX,this.startY=_.pageY;const w=b.getPosition();this.offsetX=_.pageX-w.x,this.offsetY=_.pageY-w.y,this.startPage=b,this.cacheChildren=y.pages.slice()}}moveHandler(n){const{context:o}=this,h=o.getActiveTab();if(!h||!o.isThumbnailViewer)return;const[v]=o.formatTouches(n),y=o.getPointerOverPageInfo(v.pageX,v.pageY),{page:_}=y.pageInfo;if(this.isDragging){var b,w,I;if(_&&!_.isSelected){const B=h.selected.map(se=>h.uidToIndex(se)).sort((se,ce)=>se-ce),Q=B[0],J=h.getPageIndex(_),Z=h.pages.slice();B.slice().reverse().forEach(se=>{Z.splice(se,1)});let re=Z.indexOf(_);J>Q&&(re+=1),this.cacheSelectedIndexes.forEach((se,ce)=>{const pe=h.getPageByUid(se.uid);Z.splice(re+ce,0,pe)}),this.newIndexes=Z.map(se=>h.getPageIndex(se)),h.reorderPages(this.newIndexes,!1),o.layoutService.layout(h),o.visibilityService.handleVisibility(h)}const A=o.styleService.getParsedPlaceholderStyle(),M=devicePixelRatio;let F=v.pageX-this.offsetX,V=v.pageY-this.offsetY;F=Math.round(F*M)/M,V=Math.round(V*M)/M,h.selected.forEach(B=>{const Q=h.getPageByUid(B);Q.isDragging=!0,Q.updateStyle(Ke({},A)),Q.borderBox.updateStyle({visibility:"hidden"})}),null===(b=this.startPage)||void 0===b||b.updateStyle({zIndex:1}),null===(w=this.startPage)||void 0===w||w.borderBox.updateStyle({visibility:"visible"}),null===(I=this.startPage)||void 0===I||I.borderBox.setPosition({x:F,y:V}),o.loadVisiblePages(h),o.rendererService.render(h)}else if(_&&_===this.startPage&&_.isSelected&&((v.pageX-this.startX)**2+(v.pageY-this.startY)**2)**.5>=o.viewerConfig.dragThreshold&&this.startPage&&o.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=h.selected.map(M=>({uid:M,index:h.uidToIndex(M)})).sort((M,F)=>M.index-F.index);const A=h.uidsToIndices(h.selected);this.starDragIndices=[...A],o.viewer.emit("pagesDragged",hF.create(A,[...h.selected]))}}endHandler(n){var o;if(!this.isMousedown)return;const{context:h}=this,v=h.getActiveTab();if(v){if(this.isDragging){if(this.newIndexes){const _=v.pages.map(b=>this.cacheChildren.indexOf(b));v.childNodes=this.cacheChildren,h.viewer.reorderPages(_),this.newIndexes=null}v.selected.forEach(_=>{const b=v.getPageByUid(_);b.borderBox.setLocalPosition({x:0,y:0}),b.isDragging=!1,b.borderBox.updateStyle({visibility:"visible"})});const y=v.uidsToIndices(v.selected);h.viewer.emit("pagesDropped",fF.create(this.starDragIndices,y,[...v.selected]))}null===(o=this.startPage)||void 0===o||o.updateStyle({zIndex:0}),this.isDragging&&(h.scrollByCurrentChanged=!0,h.layoutService.layout(v),h.visibilityService.handleVisibility(v),h.rendererService.render(v)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1}}}class o6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"isStart",!1),W(this,"startX",void 0),W(this,"startY",void 0),W(this,"lastX",void 0),W(this,"lastY",void 0),W(this,"startTime",void 0),W(this,"startScrollLeft",void 0),W(this,"startScrollTop",void 0),W(this,"isScrolling",void 0),W(this,"scrollTimer",void 0),W(this,"scrollDirectionX","left"),W(this,"scrollDirectionY","top"),W(this,"canvasElX",void 0),W(this,"canvasElY",void 0),this.context=n,this.isScrolling=!1}startHandler(n){const{context:o}=this;if(o.isPanning||o.isZooming)return;const h=o.getActiveTab();if(null==h||!h.total)return;const v=o.formatTouches(n);if(v.length>1)return;this.canvasElX=n.screenX,this.canvasElY=n.screenY;const{pageX:y,pageY:_}=v[0];this.isStart=!0,this.startX=y,this.startY=_,this.lastX=y,this.lastY=_,this.startTime=(new Date).getTime();const{scrollLeft:b,scrollTop:w}=h.context;this.startScrollLeft=b,this.startScrollTop=w,this.isScrolling=!1,this.scrollTimer&&(n5.clearTimer(this.scrollTimer),this.scrollTimer=null)}moveHandler(n){if(!this.isStart)return;n instanceof PointerEvent&&n.cancelable&&n.preventDefault();const{context:o}=this;if(o.isZooming)return;const h=o.formatTouches(n);if(h.length>1)return;const v=o.getActiveTab(),{maxScrollLeft:y,maxScrollTop:_}=v.context;let{scrollLeft:b,scrollTop:w}=v.context;if(!y&&!_)return;const{viewerConfig:I}=o,{panThreshold:A,enablePanX:M,enablePanY:F}=I,{pageX:V,pageY:B}=h[0],Q=V-this.startX,J=B-this.startY,Z=V-this.lastX,re=B-this.lastY;if(o.isPanning){if(!b&&!w&&Z>=0&&re>=0||b===y&&w===_&&Z<=0&&re<=0)return;M&&(b=this.startScrollLeft-Q),F&&(w=this.startScrollTop-J),b=Ir(b,0,y),w=Ir(w,0,_),o.viewService.scrollTo(b,w)}else o.isPanning=M&&Math.abs(Q)>=A||F&&Math.abs(J)>=A;this.lastX=V,this.lastY=B}endHandler(n){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:o}=this,h=o.formatTouches(n,!0);if(h.length>1||o.isZooming||"mouse"===n.pointerType||this.canvasElX===n.screenX&&this.canvasElY===n.screenY)return;const{scrollLeft:v,scrollTop:y}=this.context.viewService.getMaxScrollValue(),{scrollLeft:_,scrollTop:b}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(v>0||y>0)){const w=(new Date).getTime(),M=h[0].pageX-this.startX,F=h[0].pageY-this.startY;let V=!1,B=!1;M>0?(V=0!==_,this.scrollDirectionX="right"):(V=_!==v,this.scrollDirectionX="left"),F>0?(B=0!==b,this.scrollDirectionY="bottom"):(B=b!==y,this.scrollDirectionY="top");const Q=w-this.startTime;if((Math.abs(M)>10||Math.abs(F)>10)&&Q>0&&Q<300&&(V||B)){let J=Math.abs(M)/Q,Z=Math.abs(F)/Q;(J>.4||Z>.4)&&(J=Math.min(J,2.8),Z=Math.min(Z,2.8),this.scroll(J,Z,-.05))}}}scroll(n,o,h){this.isScrolling=!0;const{scrollLeft:v,scrollTop:y}=this.context.viewService.scrollContainer;let _=0,b=0;this.scrollTimer=n5.createTimer(()=>{const{scrollLeft:w,scrollTop:I}=this.context.viewService.getMaxScrollValue();if(n<=0&&o<=0||!1===this.isScrolling)return n5.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);n>=0&&("right"===this.scrollDirectionX?_-=40*n:_+=40*n,n+=h),o>=0&&("bottom"===this.scrollDirectionY?b-=40*o:b+=40*o,o+=h);const A=Ir(v+_,0,w),M=Ir(y+b,0,I);this.context.viewService.scrollTo(A,M)},25)}}class s6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"scrollTimer",void 0),this.context=n}scrollHandler(n){const{context:o}=this;if(o.scrollByCurrentChanged)return void(o.scrollByCurrentChanged=!1);const h=o.getActiveTab();if(null==h||!h.total)return;const{scrollLeft:v,scrollTop:y}=n.target;h.context.setTabScrollValue(v,y),o.visibilityService.handleVisibility(h),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{if(!o.isDestroyed&&h.isActive){if(o.isDefaultViewer){if(h.context.updateReference(),h.context.isContinuousDisplay&&o.viewerConfig.autoChangeIndex){const _=h.context.getCurrentByScroll();null!==_&&(h.gotoPage(_),o.visibilityService.handleVisibility(h),o.emitPageChangedEvent(h),o.emitPageChangedAfterRenderEvent(h),o.core.viewerService.onCurrentChangedByScroll.emit(q2.create(h.uid,o.groupUid,o.uid,_)))}o.loadVisiblePages(h)}else o.isThumbnailViewer&&o.loadVisiblePages(h);this.scrollTimer=null}},42),o.rendererService.render(h),o.hooks.scroll.emit()}wheelHandler(n){const{context:o}=this;let{wheelDelta:h}=n;if(n.deltaY&&(h=-n.deltaY),1===n.deltaMode?h*=16:2===n.deltaMode&&(h=h<0?-100:100),!n.ctrlKey){const{scrollLeft:v,scrollTop:y}=o.viewService.getMaxScrollValue();if(v>0||y>0)n.shiftKey&&v>0?(n.cancelable&&n.preventDefault(),o.scrollByCurrentChanged=!1,o.viewService.scrollBy(-h,0)):(n.cancelable&&n.preventDefault(),o.scrollByCurrentChanged=!1,o.viewService.scrollBy(0,-h));else{const _=o.getActiveTab();if("single"===_.context.displayMode){n.cancelable&&n.preventDefault();let b=_.current;h>0&&0!==_.current?b-=1:h<0&&_.current!==_.total-1&&(b+=1),_.current!==b&&o.viewer.gotoPage(b)}}}}}class a6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"wheelTimer",void 0),W(this,"isStart",void 0),W(this,"isZooming",void 0),W(this,"startDistance",void 0),W(this,"touchZoomTimer",void 0),W(this,"startZoom",void 0),this.context=n,this.isZooming=!1,this.isStart=!1,this.startZoom=1}zoomTo(n,o,h){n=J_(n);const{context:v}=this;if(!v.isDefaultViewer)return;const y=v.getActiveTab();if(null==y||!y.total)return;const{viewerConfig:_}=v;if((n=Ir(n,_.minZoom,_.maxZoom))===_.zoom)return;$t(o)&&$t(h)||({originX:o,originY:h}=y.context.getZoomOriginCord());const b=y.context.generateReference(o,h),w=y.context.zoom;y.context.setZoom(n),_.zoom=n,y.context.isZoomChanged=!0,v.layoutService.layout(y),v.viewService.updateScrollerContentSize(y),v.rendererService.updateCanvasSize();const{scrollLeft:I,scrollTop:A}=y.context.parseReferenceZoom(b,o,h);y.context.setTabScrollValue(I,A),v.viewService.scrollTo(I,A),v.visibilityService.handleVisibility(y),v.loadVisiblePages(y),v.clearCurrentTabOptimization(),v.rendererService.render(y),y.context.oldZoom=w,v.emitZoomChangedEvent(y)}wheelHandler(n){const{context:o}=this,{viewerConfig:h}=o;let{wheelDelta:v}=n;n.deltaY&&(v=-n.deltaY),n.ctrlKey&&!n.shiftKey&&h.enableZoom&&h.enableZoomWithCtrl&&(n.cancelable&&n.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout(()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const _=h.wheelZoomFactor||1,b=v>0?_:1/_,{x:w,y:I}=o.rendererService.getCanvasPosition();this.zoomTo(h.zoom*b,n.pageX-w,n.pageY-I)},40)))}touchstartHandler(n){const{context:o}=this,h=o.getActiveTab(),{displayMode:v}=h.context;if(!o.viewerConfig.enableZoom||"continuous"!==v&&"single"!==v)return;const _=o.formatTouches(n);_.length<2||(o.isZooming=!0,this.startZoom=h.context.zoom,this.startDistance=Pee(_),this.isStart=!0)}touchmoveHandler(n){if(!this.isStart)return;n.cancelable&&n.preventDefault();const{context:o}=this,h=o.formatTouches(n);if(h.length<2)return;const v=(h[0].pageX+h[1].pageX)/2,y=(h[0].pageY+h[1].pageY)/2;let _=Pee(h)/this.startDistance;n.scale&&(_=n.scale);const b=o.getActiveTab();let{zoom:w}=b.context;const I=w;w=this.startZoom*_,w!==I&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout(()=>{this.zoomTo(w,v,y),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null},25))),o.isZooming=!0}touchendHandler(n){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1)}tapZoomHandler(n){const{toolMode:o,enableZoom:h,tapZoomFactor:v}=this.context.viewerConfig;if(!h)return;const y="zoomIn"===o,_="zoomOut"===o;if(!y&&!_)return;const b=this.context.formatTouches(n);if(b.length>1)return;const w=(b[0].pageX+b[1].pageX)/2,I=(b[0].pageY+b[1].pageY)/2,A=this.context.getActiveTab();let{zoom:M}=A.context;y?M*=v||1:_&&(M/=v||1),this.zoomTo(M,w,I)}}function Pee(p){return((p[0].pageX-p[1].pageX)**2+(p[0].pageY-p[1].pageY)**2)**.5}class l6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"isStart",!1),W(this,"startX",void 0),W(this,"isSliding",void 0),W(this,"slideDistance",void 0),W(this,"slideDirection",void 0),W(this,"slideRAF",void 0),W(this,"tabX",void 0),W(this,"tabY",void 0),this.context=n,this.isSliding=!1}startHandler(n){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const o=this.context.getActiveTab();if(null==o||!o.total)return;const{scrollLeft:h,scrollTop:v}=this.context.viewService.getMaxScrollValue();if(h||v)return;const y=this.context.formatTouches(n);if(y.length>1)return;const _=o.getPosition();this.tabX=_.x,this.tabY=_.y,this.startX=y[0].pageX,this.isStart=!0}moveHandler(n){if(!this.isStart)return;const{context:o}=this,h=o.getActiveTab(),v=o.formatTouches(n)[0].pageX-this.startX;if(v>0?this.slideDirection="right":v<0&&(this.slideDirection="left"),this.slideDistance=Math.min(h.context.viewportWidth,Math.abs(v)),this.isSliding)"right"===this.slideDirection?h.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&h.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),o.render();else if("single"===h.context.displayMode&&"pan"===o.viewerConfig.toolMode&&o.viewerConfig.enableSlide){const{scrollLeft:y,scrollTop:_}=this.context.viewService.getMaxScrollValue();Math.abs(v)>o.viewerConfig.startSlideThreshold&&!y&&!_&&(this.isSliding=!0,this.context.isSliding=!0,o.configService.updateConfig({displayMode:"slide"}))}}endHandler(n){if(!this.isStart)return;const{context:o}=this;this.context.formatTouches(n,!0);const h=o.getActiveTab(),{displayMode:v}=h.context;"slide"===v&&this.slide(h),this.isStart=!1}slide(n){let o,h=0,v=0,y=0,_=!1;const{viewerConfig:b}=this.context;this.slideDistance>=Math.max(n.context.viewportWidth*b.slideThresholdForPerspective,b.startSlideThreshold)?(v=n.context.viewportWidth,o=v-this.slideDistance,"left"===this.slideDirection?n.current!==n.total-1?(y=-this.slideDistance,h=-o/6):(v=0,o=this.slideDistance,_=!0,y=-this.slideDistance,h=o/6):0!==n.current?(y=this.slideDistance,h=o/6):(v=0,o=this.slideDistance,_=!0,y=this.slideDistance,h=-o/6)):(_=!0,v=0,o=this.slideDistance,"left"===this.slideDirection?(y=-this.slideDistance,h=o/6):(y=this.slideDistance,h=-o/6));const I=()=>{y+=h;const A=y>=0;if(Math.abs(y)>=v&&(y=v,A||(y*=-1)),n.setPosition({x:y+this.tabX,y:this.tabY,z:0}),Math.abs(y)===v)return _||(this.context.viewer.gotoPage("right"===this.slideDirection?n.current-1:n.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(I),this.context.render()};this.slideRAF=requestAnimationFrame(I)}}class c6e extends or{constructor(n){super(),W(this,"context",void 0),this.context=n}handleOptimizationEvents(){this.context.hooks.afterRender.on(n=>{this.optimizeTab(n)})}dispose(){super.dispose(),this.context=null}optimizeTab(n){this.context.viewerConfig.enableOptimizePage&&n.pages.forEach((o,h)=>{!rr()&&!o.isOptimized&&o.isVisible&&o.isLoaded&&o.zoom<1&&setTimeout(()=>{!o.isOptimized&&o.isVisible&&o.isLoaded&&o.zoom<1&&this.optimizePage(o.uid)},500)})}cancelOptimization(n){this.context.core.optimizationService.cancel(n)}optimizePage(n){if(!this.context)return;const{context:o}=this,{viewerConfig:h}=o;if(!h.enableOptimizePage)return;const v=o.getActiveTab();if(!v)return;const y=v.getPageByUid(n);if(!y||y.isOptimized||!y.isVisible||!y.isLoaded||y.optimizationUid===y.optimizedUid||o.isSliding||o.isDestroyed)return;const _=o.core.pageService.getPage(n);if(null==_||!_.display.img)return;const{img:b}=y.image.style;if(!b)return;const{naturalWidth:w,naturalHeight:I}=b;let A=w,M=I;const{maxOptimizationSize:F}=h;if(A>F||M>F||y.rWidth>F||y.rHeight>F)return;let V=0,B=0,Q=0,J=0,Z=0;({rWidth:A,rHeight:M,cropLeft:V,cropTop:B,cropWidth:Q,cropHeight:J,rotation:Z}=_.getEditResultForPixel());const re=Kn(_.mediaBox.left,jn.displayResolution,_.resource.resolutionX),se=Kn(_.mediaBox.top,jn.displayResolution,_.resource.resolutionX),ce=new Wv({style:{x:-V+re,y:-B+se,img:b,width:w,height:I}});let pe="rgba(0,0,0,0)";if(h.enableFillColor)pe=h.blankFillColor;else if(h.viewerMode===Ko.THUMBNAIL){let j=h.pageStyle;y.isSelected?j=h.selectedPageStyle:y.isHovered&&(j=h.hoveredPageStyle),pe=j.background}const Ce=new ms({style:{x:-(Q-A)/2,y:-(J-M)/2,width:Q,height:J,background:pe}});Ce.appendChild(ce),Ce.setLocalAngle(Z);const{commonCanvas:Ve}=o.core;Ve.render(Ce,A,M),Ve.reset();const te=Ve.getCanvas(),Me=devicePixelRatio,we=Math.floor(y.realTimeBox.width*Me+.5)||1,Le=Math.floor(y.realTimeBox.height*Me+.5)||1;y.isOptimized=!0,o.core.optimizationService.optimize(te,A,M,we,Le,y.optimizationUid).then(j=>{if(!o.isDestroyed&&j.taskUid===y.optimizationUid){y.isOptimized=!0,y.optimizedUid=y.optimizationUid;const L=te.getContext("2d",{willReadFrequently:!0}).createImageData(we,Le);L.data.set(j.target),y.realTimeBox.imageData=L,y.image.updateStyle({visibility:"hidden"}),y.isVisible&&o.render()}}).catch(j=>{y.isOptimized=!1})}}class u6e extends or{constructor(n,o,h,v,y,_){super(),W(this,"context",void 0),W(this,"panModeInteraction",void 0),W(this,"cropModeInteraction",void 0),W(this,"annotationModeInteraction",void 0),W(this,"zoomInModeInteraction",void 0),W(this,"zoomOutModeInteraction",void 0),this.context=n,this.panModeInteraction=o,this.cropModeInteraction=h,this.annotationModeInteraction=v,this.zoomInModeInteraction=y,this.zoomOutModeInteraction=_}handleEvents(){if(this.context.isCaptureViewer)return;const n=this.context.rendererService.getCanvasDom();$o(n,"pointerdown",this).on(o=>{if(0!==o.button)return;const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.pointerdownHandler(o),this.cropModeInteraction.pointerdownHandler(o),this.annotationModeInteraction.pointerdownHandler(o),this.zoomInModeInteraction.startHandler(o),this.zoomOutModeInteraction.startHandler(o))}),$o(n,"pointermove",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.pointermoveHandler(o,!1),this.cropModeInteraction.pointermoveHandler(o),this.annotationModeInteraction.cursorHandler(o))},{passive:!1}),$o(n,"pointerup",this).on(o=>{if(0!==o.button)return;const h=this.context.getActiveTab();null!=h&&h.total&&this.panModeInteraction.pointerupHandler(o)}),$o(document,"pointerdown",this).on(o=>{}),$o(document,"pointermove",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.pointermoveHandler(o,!0),this.annotationModeInteraction.pointermoveHandler(o))},{passive:!1}),$o(document,"pointerup",this).on(o=>{if(0!==o.button)return;const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.pointerupHandler(o),this.cropModeInteraction.pointerupHandler(o),this.annotationModeInteraction.pointerupHandler(o),this.zoomInModeInteraction.endHandler(o),this.zoomOutModeInteraction.endHandler(o))}),$o(n,"touchstart",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.touchstartHandler(o),this.cropModeInteraction.touchstartHandler(o))},{passive:!1}),$o(n,"touchmove",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(o.cancelable&&o.preventDefault(),this.panModeInteraction.touchmoveHandler(o),this.cropModeInteraction.touchmoveHandler(o))},{passive:!1}),$o(n,"touchend",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.touchendHandler(o),this.cropModeInteraction.touchendHandler(o))}),$o(n,"wheel",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.wheelHandler(o),this.cropModeInteraction.wheelHandler(o),this.annotationModeInteraction.wheelHandler(o))},{passive:!1}),$o(this.context.viewService.scrollContainer,"scroll",this).on(o=>{const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.scrollHandler(o),this.cropModeInteraction.scrollHandler(o),this.annotationModeInteraction.scrollHandler(o))}),$o(document,"keydown",this).on(o=>{if(!this.context.isFocused||!this.context.viewerConfig.enableKeyboardInteraction)return;const h=this.context.getActiveTab();null!=h&&h.total&&(this.panModeInteraction.keydownHandler(o),this.cropModeInteraction.keydownHandler(o),this.annotationModeInteraction.keydownHandler(o),this.zoomInModeInteraction.keydownHandler(o),this.zoomOutModeInteraction.keydownHandler(o))}),$o(document,"click",this).on(o=>{const h=this.context.rendererService.getCanvasDom();this.context.isFocused=o.target===h})}}class d6e extends or{constructor(n){super(),W(this,"context",void 0),W(this,"isPointerdown",!1),W(this,"startPage",void 0),W(this,"mouseOverPage",void 0),this.context=n}startHandler(n){const{context:o}=this,{viewerConfig:h,styleService:v}=o,y=this.context.getActiveTab();if(null==y||!y.total)return;this.isPointerdown=!0;const[_]=o.formatTouches(n),{page:b}=o.getPointerOverPageInfo(_.pageX,_.pageY).pageInfo;if(!b||(this.startPage=b,n.ctrlKey))return;const w=y.getPageIndex(b),I=y.getCurrentPage(),A=n.shiftKey&&h.enableSelectWithShift;if(A&&y.selected.length){if(A&&I!==b&&y.shiftReference){const M=y.uidToIndex(y.shiftReference),F=Math.min(w,M),V=Math.max(w,M),B=[];for(let Q=F;Q<=V;Q++)B.push(Q);if(o.viewerConfig.enableOptimizePage){v.isSelectedBorderWidthEqualHovered()||o.clearOptimization([b.uid]),v.isSelectedBorderWidthEqualNormal()||B.forEach(J=>{const Z=y.getPageByIndex(F+J);y.selected.includes(Z.uid)||Z.uid===b.uid||v.isSelectedBorderWidthEqualNormal()||o.clearOptimization([Z.uid])});const Q=y.indicesToUids(B);v.isSelectedBorderWidthEqualNormal()||y.selected.forEach(J=>{if(!Q.includes(J)){const Z=y.getPageByUid(J);Z&&o.clearOptimization([Z.uid])}})}w>M&&B.reverse(),o.viewer.gotoPage(w),o.viewer.selectPagesByIndices(B)}}else h.multiselectMode||(b.uid!==y.currentUid&&o.viewer.gotoPage(w),b.isSelected||(o.viewerConfig.enableOptimizePage&&(v.isSelectedBorderWidthEqualNormal()||y.selected.forEach(M=>{const F=y.getPageByUid(M);F&&o.clearOptimization([F.uid])}),v.isSelectedBorderWidthEqualHovered()||o.clearOptimization([b.uid])),o.viewer.selectPagesByIndices([w])))}moveHandler(n){const{context:o}=this,{styleService:h}=o,v=o.getActiveTab();if(null==v||!v.total)return;const[y]=o.formatTouches(n),_=o.getPointerOverPageInfo(y.pageX,y.pageY),{page:b}=_.pageInfo,{mouseOverPage:w}=this;o.viewerConfig.enableOptimizePage&&!h.isBorderWidthEqualHovered()&&(w&&!w.isSelected&&(b&&w===b||o.clearOptimization([w.uid])),b&&!b.isSelected&&(w&&w===b||o.clearOptimization([b.uid]))),this.mouseOverPage=b;let I=!1;"mouse"===n.pointerType&&v.pages.forEach(A=>{b&&b.uid===A.uid?(A.isHovered||(I=!0),A.isHovered=!0):(A.isHovered&&(I=!0),A.isHovered=!1)}),I&&(o.layoutService.layout(v),o.visibilityService.handleVisibility(v),o.rendererService.render(v))}endHandler(n){if(!this.isPointerdown)return;const{context:o}=this,{styleService:h}=o,[v]=o.formatTouches(n,!0),y=o.getActiveTab();if(null==y||!y.total)return;const _=o.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo.page;if(_&&_===this.startPage&&!n.shiftKey)if(n.ctrlKey&&o.viewerConfig.enableSelectWithCtrl||o.viewerConfig.multiselectMode){const b=y.selected.slice(),w=b.indexOf(_.uid);_.isSelected?b.splice(w,1):b.push(_.uid);const I=y.uidsToIndices(b);if(_.uid!==y.currentUid){const A=y.uidToIndex(_.uid);o.viewer.gotoPage(A)}!h.isSelectedBorderWidthEqualHovered()&&o.viewerConfig.enableOptimizePage&&o.clearOptimization([_.uid]),o.viewer.selectPagesByIndices(I)}else if(!n.ctrlKey&&!n.shiftKey){const b=y.getPageIndex(_);_.uid!==y.currentUid&&o.viewer.gotoPage(b),o.viewerConfig.enableOptimizePage&&(h.isSelectedBorderWidthEqualNormal()||y.selected.forEach(w=>{const I=y.getPageByUid(w);I&&o.clearOptimization([I.uid])}),h.isSelectedBorderWidthEqualHovered()||o.clearOptimization([_.uid])),o.viewer.selectPagesByIndices([b])}this.isPointerdown=!1,this.startPage=null}keydownHandler(n){}}class h6e extends or{constructor(n){super(),W(this,"context",void 0),this.context=n}undoHandler(n){n.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(n.preventDefault(),this.context.viewer.undo())}redoHandler(n){n.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(n.preventDefault(),this.context.viewer.redo())}zoomInHandler(n){n.ctrlKey&&this.context.viewerConfig.enableZoomInWidthKeyboard&&(n.preventDefault(),this.context.viewer.zoomIn())}zoomOutHandler(n){n.ctrlKey&&this.context.viewerConfig.enableZoomOutWidthKeyboard&&(n.preventDefault(),this.context.viewer.zoomOut())}arrowLeftHandler(n){}arrowRightHandler(n){}arrowUpHandler(n){}arrowDownHandler(n){}escapeHandler(n){}enterHandler(n){}pageUpHandler(n){}pageDownHandler(n){}homeHandler(n){}endHandler(n){}scrollHandler(n){}selectPageHandler(n){}}class f6e{constructor(n){W(this,"context",void 0),W(this,"isEditAnnotation",!1),W(this,"isMove",!1),W(this,"isSlide",!1),W(this,"isActivateAnnotation",!1),W(this,"isTouchstart",!1),W(this,"isPointerdown",!1),W(this,"isFirstMove",!0),W(this,"isPointerOnAnnotation",!1),W(this,"isAnnotationActive",!1),W(this,"activeShape",void 0),W(this,"pointerNum",0),W(this,"startPoint",void 0),W(this,"dragTimer",void 0),W(this,"isDragPages",!1),W(this,"isMoveForThumbnail",!1),W(this,"isMoved",!1),W(this,"keyboardHandlerMapForDefault",void 0),W(this,"keyboardHandlerMapForThumbnail",void 0),W(this,"canScroll",!0),W(this,"startX",void 0),W(this,"startY",void 0),this.context=n}get isPanMode(){return"pan"===this.context.viewerConfig.toolMode}pointerdownHandler(n){if(this.isPointerdown||!this.isPanMode)return;const o=this.context.getActiveTab();if(null==o||!o.total||"slide"===this.context.viewerConfig.displayMode)return;const{isDefaultViewer:h,isThumbnailViewer:v,viewService:y,hasAnnotationModule:_,annotationEditService:b,selectPagesService:w,moveService:I,dragService:A,slideService:M,viewerConfig:{dragStartTimeThreshold:F,enableSlide:V,enableDragPage:B}}=this.context,{displayMode:Q}=o.context;if(this.isPointerdown=!0,this.isFirstMove=!0,h){const{scrollLeft:J,scrollTop:Z}=y.getMaxScrollValue();if(_){const[re]=this.context.formatTouches(n),{page:se}=this.context.getPointerOverPageInfo(re.pageX,re.pageY).pageInfo;if(this.startPoint={x:re.pageX,y:re.pageY},se){let{x:Ve,y:te}=se.cropBox.getPosition(),{width:Me,height:we}=se.cropBox;const Le=(se.rotation%360+360)%360/90;if(1===Le?Ve-=we:2===Le?(Ve-=Me,te-=we):3===Le&&(te-=Me),1===Le||3===Le){const j=Me;Me=we,we=j}b.setAnnotationContainer(se),b.setAnnotationInteractionArea({x:Ve,y:te,width:Me,height:we})}const{isHit:ce,shape:pe,isHitSelected:Ce}=this.context.annotationEditService.isHitAnnotation(n);ce&&se?(this.activeShape=pe,this.isPointerOnAnnotation=!0,"touch"===n.pointerType||"pen"===n.pointerType?Ce?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,b.startHandler(n,!1)):this.isActivateAnnotation=!0:"mouse"===n.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,b.startHandler(n,!0)),b.hasActiveAnnotation()&&(this.canScroll=!1)):b.deactivateAnnotation()}this.isPointerOnAnnotation||(J||Z?(this.isMove=!0,this.isSlide=!1,I.startHandler(n)):"single"===Q&&V&&(this.isMove=!1,this.isSlide=!0,M.startHandler(n)))}else if(v){w.startHandler(n);const[J]=this.context.formatTouches(n),{page:Z}=this.context.getPointerOverPageInfo(J.pageX,J.pageY).pageInfo;Z&&!n.ctrlKey?"touch"===n.pointerType||"pen"===n.pointerType?(B?this.dragTimer=setTimeout(()=>{this.isMoveForThumbnail||(this.isDragPages=!0,A.startHandler(n))},F):(this.isMoveForThumbnail=!0,I.startHandler(n)),this.startX=n.pageX,this.startY=n.pageY):"mouse"===n.pointerType&&(B?(this.isDragPages=!0,A.startHandler(n)):(this.isMoveForThumbnail=!0,I.startHandler(n))):(this.isMoveForThumbnail=!0,I.startHandler(n))}}pointermoveHandler(n,o){if(this.pointerNum>1)return;const h=this.context.getActiveTab();if(null==h||!h.total)return;const{isDefaultViewer:v,isThumbnailViewer:y,viewService:_,moveService:b,slideService:w,annotationEditService:I,dragService:A,selectPagesService:M}=this.context,{displayMode:F}=h.context;if(v&&!o&&this.isPointerdown){if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){const[V]=this.context.formatTouches(n);Xg(this.startPoint,{x:V.pageX,y:V.pageY})>1&&(this.isActivateAnnotation=!1);const{scrollLeft:B,scrollTop:Q}=_.getMaxScrollValue();B||Q?(this.isMove=!0,this.isSlide=!1,b.startHandler(n)):"single"===F&&(this.isMove=!1,this.isSlide=!0,w.startHandler(n))}if(this.isEditAnnotation){const[V]=this.context.formatTouches(n),{page:B}=this.context.getPointerOverPageInfo(V.pageX,V.pageY).pageInfo;I.moveHandler(n,!B)}else this.isMove?b.moveHandler(n):this.isSlide&&w.moveHandler(n);this.isFirstMove=!1}else if(y&&o)if(M.moveHandler(n),"touch"===n.pointerType){const V=Xg({x:this.startX,y:this.startY},{x:n.pageX,y:n.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||b.startHandler(n),V>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,A.moveHandler(n)):!this.isDragPages&&this.isPointerdown&&(V>5&&(this.isMoveForThumbnail=!0,b.moveHandler(n)),this.isMoved=!0)}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||b.startHandler(n),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,A.moveHandler(n)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,b.moveHandler(n),this.isMoved=!0)}pointerupHandler(n){if(!this.isPointerdown)return;const{isDefaultViewer:o,isThumbnailViewer:h,annotationEditService:v,moveService:y,slideService:_,dragService:b,selectPagesService:w}=this.context;if(o)this.isEditAnnotation?v.endHandler(n):this.isActivateAnnotation?(v.activateAnnotation(this.activeShape,n.ctrlKey),this.context.render()):this.isMove?y.endHandler(n):this.isSlide&&_.endHandler(n);else if(h){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const I=Xg({x:this.startX,y:this.startY},{x:n.pageX,y:n.pageY});(!this.isMoved||I<5)&&w.endHandler(n),this.isDragPages?b.endHandler(n):y.endHandler(n)}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null}touchstartHandler(n){if(this.pointerNum=n.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:o,enableZoomInPanMode:h,enableZoomWithTouch:v}=this.context.viewerConfig;if(!this.isPanMode||2!==n.targetTouches.length||this.isTouchstart||!o||!v||!h)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(n)}}touchmoveHandler(n){this.pointerNum=n.targetTouches.length,2===n.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(n)}touchendHandler(n){this.pointerNum=n.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(n))}wheelHandler(n){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void n.preventDefault();const{isDefaultViewer:o,isThumbnailViewer:h,viewerConfig:{enableZoom:v,enableZoomInPanMode:y,enableZoomWithCtrl:_},zoomService:b,scrollService:w}=this.context;if(o)if(n.ctrlKey){if(!v||!y||!_)return;b.wheelHandler(n)}else w.wheelHandler(n);else h&&w.wheelHandler(n)}scrollHandler(n){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(n)}keydownHandler(n){if(!this.isPanMode)return;const{context:o,context:{keyboardService:h,annotationEditService:v,viewerConfig:{enableKeyboardInteraction:y,enableZoom:_,enableZoomInPanMode:b,enableZoomOutWidthKeyboard:w,enableZoomInWidthKeyboard:I,enableCopyCutPasteWidthKeyboard:A,enableUndoWidthKeyboard:M,enableRedoWidthKeyboard:F},hasAnnotationModule:B}}=this;if(!y)return;const Q=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(o.isDefaultViewer){let J=this.keyboardHandlerMapForDefault;if(J||(J={c:Z=>{A&&v.copyAnnotations()},x:Z=>{A&&v.cutAnnotations()},v:Z=>{A&&v.pasteAnnotations()},y:Z=>{F&&h.redoHandler(Z)},z:Z=>{M&&h.undoHandler(Z)},"-":Z=>{_&&b&&w&&h.zoomOutHandler(Z)},"=":Z=>{_&&b&&I&&h.zoomInHandler(Z)},Escape:Z=>{h.escapeHandler(Z)},Enter:Z=>{h.enterHandler(Z)},PageUp:Z=>{h.pageUpHandler(Z)},PageDown:Z=>{h.pageDownHandler(Z)},Home:Z=>{h.homeHandler(Z)},End:Z=>{h.endHandler(Z)}},this.keyboardHandlerMapForDefault=J),n.ctrlKey){const Z=J[n.key];Z&&n.ctrlKey?Z(n):Q.includes(n.key)&&(B&&v.hasActiveAnnotation()?v.moveAnnotationByKeyboard(n):h.scrollHandler(n))}}else if(o.isThumbnailViewer){let J=this.keyboardHandlerMapForThumbnail;J||(J={PageUp:re=>{h.pageUpHandler(re)},PageDown:re=>{h.pageDownHandler(re)},Home:re=>{h.homeHandler(re)},End:re=>{h.endHandler(re)}},this.keyboardHandlerMapForThumbnail=J);const Z=J[n.key];Z?Z(n):Q.includes(n.key)&&o.selectPagesService.keydownHandler(n)}}}class p6e{constructor(n){W(this,"context",void 0),W(this,"isEditCropBox",!1),W(this,"isPerspectiveQuad",!1),W(this,"isTouchstart",!1),W(this,"isPointerdown",!1),W(this,"pointerNum",0),W(this,"keyboardHandlerMap",void 0),this.context=n}get isCropMode(){return"crop"===this.context.viewerConfig.toolMode}pointerdownHandler(n){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:o}=this;o.hasBoxRendererModule?o.isDefaultViewer?(this.isEditCropBox=o.cropBoxEditService.isEditCropBox(n),this.isEditCropBox?o.cropBoxEditService.startHandler(n):o.moveService.startHandler(n)):o.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,o.perspectiveQuadEditService.startHandler(n)):o.isDefaultViewer&&o.moveService.startHandler(n)}pointermoveHandler(n){if(this.pointerNum>1)return;const{context:o}=this;o.isDefaultViewer?(o.cropBoxEditService.moveHandler(n),!this.isEditCropBox&&this.isPointerdown&&o.moveService.moveHandler(n)):o.isPerspectiveViewer&&o.perspectiveQuadEditService.moveHandler(n)}pointerupHandler(n){if(!this.isPointerdown)return;const{context:o}=this;o.isDefaultViewer?this.isEditCropBox?o.cropBoxEditService.endHandler(n):o.moveService.endHandler(n):o.isPerspectiveViewer&&this.isPerspectiveQuad&&o.perspectiveQuadEditService.endHandler(n),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1}touchstartHandler(n){this.pointerNum=n.targetTouches.length;const{context:o,context:{viewerConfig:h}}=this;if(o.isDefaultViewer){if(!this.isCropMode||2!==n.targetTouches.length||this.isTouchstart||!h.enableZoom||!h.enableZoomWithTouch||!h.enableZoomInCropMode)return;this.isTouchstart=!0,o.zoomService.touchstartHandler(n)}}touchmoveHandler(n){this.pointerNum=n.targetTouches.length,2===n.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(n)}touchendHandler(n){this.pointerNum=n.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(n))}wheelHandler(n){if(this.pointerNum=0,!this.isCropMode)return;const{context:o,context:{viewerConfig:h}}=this;if(o.isDefaultViewer)if(n.ctrlKey){if(!h.enableZoom||!h.enableZoomInCropMode||!h.enableZoomWithCtrl)return;o.zoomService.wheelHandler(n)}else o.scrollService.wheelHandler(n)}scrollHandler(n){if(!this.isCropMode)return;const{context:o}=this;(o.isDefaultViewer||o.isThumbnailViewer)&&o.scrollService.scrollHandler(n)}keydownHandler(n){if(!this.isCropMode)return;const{keyboardService:o,isDefaultViewer:h,viewerConfig:{enableKeyboardInteraction:v,enableZoom:y,enableZoomInCropMode:_,enableZoomOutWidthKeyboard:b,enableZoomInWidthKeyboard:w,enableUndoWidthKeyboard:I,enableRedoWidthKeyboard:A}}=this.context;if(!h||!v||!n.ctrlKey)return;let M=this.keyboardHandlerMap;M||(M={y:V=>{A&&o.redoHandler(V)},z:V=>{I&&o.undoHandler(V)},"-":V=>{y&&_&&b&&o.zoomOutHandler(V)},"=":V=>{y&&_&&w&&o.zoomInHandler(V)},Escape:V=>{o.escapeHandler(V)},Enter:V=>{o.enterHandler(V)},PageUp:V=>{o.pageUpHandler(V)},PageDown:V=>{o.pageDownHandler(V)}},this.keyboardHandlerMap=M);const F=M[n.key];F?F(n):["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(n.key)&&o.scrollHandler(n)}}class g6e{constructor(n){W(this,"context",void 0),W(this,"isPointerdown",!1),W(this,"pointerId",null),W(this,"keyboardHandlerMapForDefault",void 0),W(this,"canScroll",!0),this.context=n}get isAnnotationMode(){return"annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(n){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=n.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[o]=this.context.formatTouches(n),{page:h}=this.context.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(h){let{x:v,y}=h.cropBox.getPosition(),{width:_,height:b}=h.cropBox;const w=360,I=(h.rotation%w+w)%w/90;if(1===I?v-=b:2===I?(v-=_,y-=b):3===I&&(y-=_),1===I||3===I){const A=_;_=b,b=A}this.context.annotationEditService.setAnnotationContainer(h),this.context.annotationEditService.setAnnotationInteractionArea({x:v,y,width:_,height:b})}this.isPointerdown=!0,this.context.annotationEditService.startHandler(n,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1)}}pointermoveHandler(n){if((this.pointerId===n.pointerId||"touch"!==n.pointerType)&&this.context.isDefaultViewer){const[o]=this.context.formatTouches(n),{page:h}=this.context.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;this.context.annotationEditService.moveHandler(n,!h)}}cursorHandler(n){if("mouse"===(null==n?void 0:n.pointerType)&&this.context.isDefaultViewer){const[o]=this.context.formatTouches(n),{page:h}=this.context.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(n,!h,this.context.viewerConfig.canvasStyle.cursor)}}pointerupHandler(n){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(n),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null)}wheelHandler(n){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(n.ctrlKey){const{enableZoom:o,enableZoomInAnnotationMode:h,enableZoomWithCtrl:v}=this.context.viewerConfig;if(!(this.isAnnotationMode&&o&&h&&v))return;this.context.zoomService.wheelHandler(n)}else this.context.scrollService.wheelHandler(n)}else n.preventDefault()}scrollHandler(n){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(n)}keydownHandler(n){if(!this.isAnnotationMode)return;const{context:{keyboardService:h,annotationEditService:v,viewerConfig:{enableKeyboardInteraction:y,enableZoom:_,enableZoomInAnnotationMode:b,enableZoomOutWidthKeyboard:w,enableZoomInWidthKeyboard:I,enableCopyCutPasteWidthKeyboard:A,enableUndoWidthKeyboard:M,enableRedoWidthKeyboard:F},hasAnnotationModule:V}}=this;if(!y)return;const B=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(this.context.isDefaultViewer){let Q=this.keyboardHandlerMapForDefault;Q||(Q={c:Z=>{A&&v.copyAnnotations()},x:Z=>{A&&v.cutAnnotations()},v:Z=>{A&&v.pasteAnnotations()},y:Z=>{F&&h.redoHandler(Z)},z:Z=>{M&&h.undoHandler(Z)},"-":Z=>{_&&b&&w&&h.zoomOutHandler(Z)},"=":Z=>{_&&b&&I&&h.zoomInHandler(Z)},Escape:Z=>{h.escapeHandler(Z)},Enter:Z=>{h.enterHandler(Z)},PageUp:Z=>{h.pageUpHandler(Z)},PageDown:Z=>{h.pageDownHandler(Z)},Home:Z=>{h.homeHandler(Z)},End:Z=>{h.endHandler(Z)}},this.keyboardHandlerMapForDefault=Q);const J=Q[n.key];J&&n.ctrlKey?J(n):B.includes(n.key)&&(V&&v.hasActiveAnnotation()?v.moveAnnotationByKeyboard(n):h.scrollHandler(n))}}}class m6e{constructor(n){W(this,"context",void 0),W(this,"isPointerdown",!1),this.context=n}get isZoomInMode(){return"zoomIn"===this.context.viewerConfig.toolMode}startHandler(n){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(n),this.isPointerdown=!0)}endHandler(n){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(n){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:o}}=this;o.enableKeyboardInteraction&&o.enableZoom&&o.enableZoomInWidthKeyboard&&n.ctrlKey&&"="===n.key&&this.context.keyboardService.zoomInHandler(n)}}class v6e{constructor(n){W(this,"context",void 0),W(this,"isPointerdown",!1),this.context=n}get isZoomOutMode(){return"zoomOut"===this.context.viewerConfig.toolMode}startHandler(n){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(n),this.isPointerdown=!0)}endHandler(n){this.isPointerdown&&(this.isPointerdown=!1)}keydownHandler(n){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:o}}=this;o.enableKeyboardInteraction&&o.enableZoom&&o.enableZoomOutWidthKeyboard&&n.ctrlKey&&"-"===n.key&&this.context.keyboardService.zoomInHandler(n)}}class y6e extends or{constructor(n,o){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),W(this,"core",void 0),W(this,"viewer",void 0),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"hooks",void 0),W(this,"viewService",void 0),W(this,"rendererService",void 0),W(this,"tabService",void 0),W(this,"layoutService",void 0),W(this,"styleService",void 0),W(this,"configService",void 0),W(this,"visibilityService",void 0),W(this,"annotationEditService",void 0),W(this,"cropBoxEditService",void 0),W(this,"perspectiveQuadEditService",void 0),W(this,"eventsService",void 0),W(this,"dragService",void 0),W(this,"moveService",void 0),W(this,"scrollService",void 0),W(this,"zoomService",void 0),W(this,"slideService",void 0),W(this,"optimizationService",void 0),W(this,"interactionService",void 0),W(this,"selectPagesService",void 0),W(this,"keyboardService",void 0),W(this,"viewerConfig",pn(EPe)),W(this,"postfix",void 0),W(this,"isDestroyed",!1),W(this,"viewportWidth",0),W(this,"viewportHeight",0),W(this,"scrollByCurrentChanged",!1),W(this,"isInitialized",!1),W(this,"addPagesTimer",null),W(this,"isPanning",void 0),W(this,"isZooming",void 0),W(this,"isSliding",void 0),W(this,"isLoadSource",!1),W(this,"isFocused",!1),W(this,"hasBoxRendererModule",!1),W(this,"hasAnnotationModule",!1),this.core=n,this.viewer=o,this.postfix=o.postfix,this.hooks=o.hooks,this.uid=o.uid,this.groupUid=o.groupUid,yo(h,this.viewerConfig),this.styleService=new OPe(this),this.viewService=this.register(new zPe(this,this.hooks)),this.rendererService=this.register(new qPe(this,this.hooks)),this.layoutService=new e6e(this,this.hooks),this.configService=this.register(new n6e(this)),this.tabService=this.register(new MPe(this)),this.visibilityService=new BPe(this),this.optimizationService=this.register(new c6e(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new i6e(this)),this.dragService=this.register(new r6e(this)),this.moveService=this.register(new o6e(this)),this.scrollService=this.register(new s6e(this)),this.zoomService=this.register(new a6e(this)),this.slideService=this.register(new l6e(this)),this.interactionService=this.register(new u6e(this,new f6e(this),new p6e(this),new g6e(this),new m6e(this),new v6e(this))),this.selectPagesService=this.register(new d6e(this)),this.keyboardService=this.register(new h6e(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents()}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var n;return"visible"===(null===(n=this.viewerConfig)||void 0===n?void 0:n.visibility)}syncViewer(n){const o=n.getActiveTab();if(!o)return;const h=this.tabService.createTab(o.doc);if(h.isDocType){const{width:v,height:y}=this.viewService.getViewportSize();h.updateViewportSize(v,y)}h.currentUid=o.currentUid,h.selectPages([...o.selected]),this.tabService.activateTab(h.uid),this.hooks.syncDocument.emit(h.doc),this.emitPageChangedEvent(h),this.showTab(h),this.emitPageChangedAfterRenderEvent(h)}formatTouches(n){const o=[];let h=null;h=n instanceof MouseEvent||n instanceof PointerEvent?[n]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?n.changedTouches:n.touches;const{x:v,y}=this.rendererService.getCanvasPosition();for(let _=0;_<h.length;_++){const b=h[_];o.push({pageX:b.pageX-v,pageY:b.pageY-y})}return o}getPointerOverPageInfo(n,o){return function(v,y,_){const b={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(v)for(let w=0;w<v.pages.length;w++){const I=v.pages[w],A=Tee(I,y,_,I.isVisible);if(A.isOver){b.index=w,Object.assign(b.pageInfo,A);const M=Tee(I.image,y,_,!0);return M.isOver&&Object.assign(b.imageInfo,M),b}}return b}(this.getActiveTab(),n,o)}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const n=this.getActiveTab();n&&this.showTab(n,!0)}updateViewportSize(){const{width:n,height:o}=this.viewService.getViewportSize();this.viewportWidth=n,this.viewportHeight=o,this.tabService.updateViewportSize(n,o)}handleViewerModeChanged(){const{postfix:n,viewService:o,isDefaultViewer:h,isPerspectiveViewer:v,isThumbnailViewer:y}=this;if(h||v||y){o.createMainAndThbContainer(n),o.createMainContainer(n),y||o.createThumbnailContainer(n),h&&(o.createVideoContainer(n),o.createAudioContainer(n)),tL(o.mainAndThbContainer,"flex");const{width:_,height:b}=o.getViewportSize();this.rendererService.initRenderer(o.canvasContainer,_,b),this.rendererService.updateCanvasSize()}}loadSource(n){const o=this.getActiveTab();let h=null==o?void 0:o.uid;if(!o){const v=this.core.createDocument({name:uee(),type:"document"});this.viewer.openDocument(v),h=v.uid}return this.core.loadSource(n,h,{exception:"ignore"})}openDocument(n){const{tabService:o}=this;let h=o.getTab(n.uid);if(!h){const v=o.getActiveTab();if(v&&this.hooks.closeDocument.emit(v.doc),h=o.createTab(n),h.isDocType){const{width:y,height:_}=this.viewService.getViewportSize();h.updateViewportSize(y,_)}}h.isActive||(this.tabService.activateTab(h.uid),this.emitPageChangedEvent(h),this.showTab(h),this.hooks.openDocument.emit(n),this.emitPageChangedAfterRenderEvent(h))}closeTabs(n){const o=n.filter(y=>this.tabService.hasTab(y));if(!o.length)return;o.reduce((y,_,b)=>{const w=this.tabService.getTab(_);return w&&y.push(w),y},[]).forEach(y=>{y.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(y.uid),this.hooks.closeDocument.emit(y.doc)});const v=this.tabService.getActiveTab();v?this.showTab(v):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(xw.create(-1,0)))}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas())}render(){if("hidden"===this.viewerConfig.visibility||this.isDestroyed)return;const n=this.getActiveTab();n&&this.rendererService.render(n)}showCurrentTab(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o=this.getActiveTab();null!=o&&o.total&&this.showTab(o,n)}showTab(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||n.isDestroyed||(this.tabService.activateTab(n.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(n,o):this.isThumbnailViewer?this.showTabThumbnail(n,o):this.isPerspectiveViewer&&this.showTabPerspective(n)))}showTabDefault(n){const o=n;if(!o.isDocType)return;o.style.visibility="visible";const h=o.context.zoom;this.layoutService.layout(o),this.viewerConfig.zoom=o.context.zoom;const v=o.context.zoom!==h;if(this.viewService.updateScrollerContentSize(o),this.rendererService.updateCanvasSize(),!o.total)return void this.rendererService.render(o);const{scrollLeft:y,scrollTop:_}=o.context.parseReferenceDefault();o.context.setTabScrollValue(y,_),this.viewService.scrollTo(y,_),this.visibilityService.handleVisibility(o),this.loadVisiblePages(o),v&&this.clearCurrentTabOptimization(),this.rendererService.render(o),this.emitZoomChangedEvent(o)}showTabPerspective(n){const o=n;if(!o.isDocType)return;if(o.style.visibility="visible",this.layoutService.layout(o),this.viewService.updateScrollerContentSize(o),this.rendererService.updateCanvasSize(),!o.total)return void this.rendererService.render(o);const{scrollLeft:h,scrollTop:v}=o.context.parseReferenceDefault();o.context.setTabScrollValue(h,v),this.viewService.scrollTo(h,v),this.visibilityService.handleVisibility(o),this.loadVisiblePages(o),this.rendererService.render(o)}showTabThumbnail(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n.isDocType)return;if(n.style.visibility="visible",this.layoutService.layout(n),this.viewService.updateScrollerContentSize(n),this.rendererService.updateCanvasSize(),!n.total)return void this.rendererService.render(n);if(n.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:y,scrollTop:_}=n.context.getScrollValuesByCurrentChanged();n.context.setTabScrollValue(y,_)}const{scrollLeft:h,scrollTop:v}=n.context;this.viewService.scrollTo(h,v),this.visibilityService.handleVisibility(n),this.loadVisiblePages(n),o&&this.clearCurrentTabOptimization(),this.rendererService.render(n)}loadPageImage(n){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(n):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(n):null}loadVisiblePages(n){if(n.isDestroyed||null==n||!n.total)return;const o=[],h=[],v=n.getCurrentPage();let y=!1;n.pages.forEach(b=>{!b.isPreload||b.isLoaded||b.isLoading||(b.uid===(null==v?void 0:v.uid)?y=!0:b.isVisible?h.push(b):b.isPreload&&o.push(b))});const _=[];y&&_.push(v),_.push(...o.reverse(),...h.reverse()),_.forEach(b=>{!b.isPreload||b.isLoaded||b.isLoading||(b.isLoading=!0,this.loadPageImage(b.uid).then(w=>{b.isLoading=!1,w&&this.renderPage(n,b,w)}).catch(w=>{b.isLoading=!1}))})}renderPage(n,o,h){if(!this.isDestroyed&&this.isVisible&&n.isActive&&n.pages.includes(o)&&!n.isDestroyed&&o.isPreload&&(o.isLoaded=!0,o.setImgDom(h),o.isVisible)){if(this.isDefaultViewer&&n.context.isSingleDisplay){const v=n.getCurrentPage();if(v&&!v.isLoaded)return}this.rendererService.render(n)}}emitPageChangedEvent(n){this.hooks.pageChanged.emit(xw.create(n.current,n.total))}emitPageChangedAfterRenderEvent(n){this.hooks.pageChangedAfterRender.emit(xw.create(n.current,n.total))}emitZoomChangedEvent(n){const{oldZoom:o,zoom:h}=n.context;this.hooks.zoomChanged.emit(CF.create(J_(o),J_(h)))}beforeLoadSource(n){this.isLoadSource=!0;const{tabService:o}=this,h=o.getDocTab(n);h&&h.updateOldInfo()}afterLoadSource(n){this.isLoadSource=!1;const{tabService:o}=this,h=o.getDocTab(n);h&&(this.emitPageChangedEvent(h),this.emitPageChangedAfterRenderEvent(h),h.updateOldInfo())}addPages(n,o,h,v){const{tabService:y}=this,_=y.getDocTab(n);_&&(_.appendPages(o,h,v),this.emitPageChangedEvent(_),_.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout(()=>{_.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(_)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null},200)))}deletePages(n,o){const{tabService:h}=this,v=h.getDocTab(n);v&&(this.clearOptimization(o),v.deletePages(o),this.hooks.deletePages.emit(ww.create(o)),this.emitEventsForTab(v))}deleteAllPages(n){const{tabService:o}=this,h=o.getDocTab(n);if(!h)return;const v=h.pages.map(y=>y.uid);this.clearOptimization(v),h.deleteAllPages(),this.hooks.deletePages.emit(ww.create(v)),this.emitEventsForTab(h)}setCurrentPage(n,o){const{tabService:h}=this,v=h.getDocTab(n);v&&v.current!==o&&(v.gotoPage(o),this.emitEventsForTab(v))}selectPages(n,o){const{tabService:h}=this,v=h.getDocTab(n);if(!v)return;const y=v.getSelected(),_=v.getSelectedIndices();let b=!1;if(_.length!==o.length)b=!0;else for(let I=0;I<o.length;I++)if(_[I]!==o[I]){b=!0;break}if(!b)return;const w=v.indicesToUids(o);if(v.selectPages(w),v.isActive){this.showTab(v);const I=vF.create(_,[...o],[...y],w);this.hooks.selectedPageChanged.emit(I),this.viewer.emit("selectedPagesChanged",I)}}movePages(n,o,h){const v=this.tabService.getDocTab(n);v&&(v.movePages(o,h),this.emitEventsForTab(v,this.isDefaultViewer))}switchPage(n,o,h){const v=this.tabService.getDocTab(n);v&&(v.switchPage(o,h),this.emitEventsForTab(v,this.isDefaultViewer))}reorderPages(n,o){const h=this.tabService.getDocTab(n);h&&(h.reorderPages(o),this.emitEventsForTab(h,this.isDefaultViewer))}emitEventsForTab(n,o){n.isActive&&(this.emitPageChangedEvent(n),this.scrollByCurrentChanged=!0,this.showTab(n,o),this.emitPageChangedAfterRenderEvent(n))}updatePage(n,o,h){const v=this.tabService.getTab(n);if(v&&v.isActive){const y=v.getPageByUid(o);y.isLoaded=!1,y.isLoading=!1,this.clearOptimization([o]),this.showTab(v)}}renameDoc(n,o){const{tabService:h}=this,v=h.getTab(n);v&&(v.rename(o),this.hooks.tabChanged.emit())}filter(n,o,h){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const v=this.getActiveTab();v&&v.uid===n&&(o.forEach(y=>{const _=v.getPageByUid(y);_&&(_.isLoaded=!1)}),this.hooks.filterChanged.emit($2.create(n,o,h)),this.loadVisiblePages(v),this.clearOptimization(o),this.rendererService.render(v))}activateTab(n){const o=this.tabService.getTab(n);return!!o&&(this.showTab(o),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach(n=>{const o=[];if(n.pages.forEach((h,v)=>{h.isPreload&&o.push({from:!0,to:!1,pageUid:h.uid,index:v})}),o.length){const h=Q2.create(n.uid,this.uid,this.viewerConfig.viewerMode,o);this.core.viewerService.onPagePreloadChanged.emit(h)}}),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose()}get isDefaultViewer(){return this.viewerConfig.viewerMode===Ko.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===Ko.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===Ko.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===Ko.CAPTURE}zoomTo(n,o,h){this.zoomService.zoomTo(n,o,h)}getPageRenderSize(n){const o=this.core.pageService.getPage(n);return this.isPerspectiveViewer?o.raw.getPageSize():o.mediaBox}emit(n,o){this.viewer.emit(n,o)}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const n=this.getActiveTab();if(n){const o=n.pages.map(h=>h.uid);this.clearOptimization(o)}}clearOptimization(n){const o=[],h=this.getActiveTab();h&&n.forEach(v=>{const y=h.getPageByUid(v);y&&(o.push(y.optimizationUid),y.clearOptimization())}),o.forEach(v=>{this.optimizationService.cancelOptimization(v)})}}class _6e extends or{constructor(n){super(),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"group",void 0),W(this,"postfix",void 0),W(this,"context",void 0),W(this,"emitter",void 0),W(this,"hooks",void 0),W(this,"core",void 0),W(this,"isDisposed",!1),this.emitter=new Yh,n.core&&(this.core=n.core),this.uid=Ai(),this.groupUid=n.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new UAe),this.context=new y6e(this.core,this,n.viewerConfig),n.container&&!n.uiConfig&&this.context.viewService.bindContainer(n.container),this.listenGlobalEvents()}listenGlobalEvents(){const{documentService:n,viewerService:o}=this.core,{context:h}=this;this.core.onBeforeLoadSource.on(v=>{let{docUid:y}=v;h.beforeLoadSource(y)},this),this.core.pageService.onUpdatePage.on(v=>{h.updatePage(v.docUid,v.pageUid,v.data),h.hooks.updatePage.emit(v)},this),n.onPagesAdded.on(v=>{h.afterLoadSource(v.docUid),h.hooks.addPagesToDoc.emit(v)},this),n.onAddPagesToDoc.on(v=>{const{group:y}=this;let{scrollToLatest:_}=y.config;gt(_)&&({scrollToLatest:_}=h.viewerConfig),h.addPages(v.docUid,v.pageUids,_,v.index)},this),n.onDeletePagesFromDoc.on(v=>{h.deletePages(v.docUid,v.pageUids)},this),n.onDeleteAllPagesFromDoc.on(v=>{h.deleteAllPages(v.docUid)},this),n.onMovePages.on(v=>{h.movePages(v.docUid,v.indices,v.insertBeforeIndex)},this),n.onSwitchPage.on(v=>{h.switchPage(v.docUid,v.one,v.another)},this),n.onReorderPages.on(v=>{h.reorderPages(v.docUid,v.indices)},this),n.onBeforeDeleteDocs.on(v=>{h.closeTabs(v.docUids)},this),n.onDocumentRenamed.on(v=>{h.renameDoc(v.docUid,v.newName)},this),n.onDocumentDeleted.on(v=>{h.closeTabs([v.docUid])},this),n.onOpenDocument.on(v=>{h.groupUid===v.groupUid&&h.openDocument(v.doc)},this),n.onCloseDocument.on(v=>{h.groupUid===v.groupUid&&h.closeTabs([v.doc.uid])},this),o.onGotoPage.on(v=>{h.groupUid===v.groupUid&&h.setCurrentPage(v.docUid,v.index)},this),o.onSelectPages.on(v=>{h.groupUid===v.groupUid&&h.selectPages(v.docUid,v.indices)},this),o.onResize.on(()=>{h.resize()},this),o.onCurrentChangedByScroll.on(v=>{h.groupUid===v.groupUid&&h.uid!==v.viewerUid&&h.setCurrentPage(v.docUid,v.current)},this),this.core.onFilterChanged.on(v=>{const y=h.getActiveTab();(null==y?void 0:y.uid)===v.docUid&&h.filter(v.docUid,v.pageUids,v.filterType)},this),this.core.commandService.onOperationsChanged.on(v=>{const y=h.getActiveTab();y?y.uid===v.docUid&&h.hooks.operationsChanged.emit(v):this.hooks.operationsChanged.emit({docUid:v.docUid,undo:0,redo:0})},this)}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose())}undo(){const n=this.context.getActiveTab();return!!n&&this.core.commandService.undo(n.uid)}redo(){const n=this.context.getActiveTab();return!!n&&this.core.commandService.redo(n.uid)}getOperationState(){const n=this.context.getActiveTab();return n?this.core.commandService.getOperationState(n.uid):{undo:0,redo:0}}saveOperations(){const n=this.context.getActiveTab();return!!n&&this.core.commandService.saveOperations(n.uid)}setRowAndColumn(n,o){return this.context.configService.updateConfig({rows:n,columns:o}),!0}getRowAndColumn(){const n=this.context.getActiveTab();if(n)return{rows:n.context.rows,columns:n.context.columns};const{viewerConfig:o}=this.context;return{rows:o.rows||1,columns:o.columns||1}}on(n,o){this.emitter.on(n,o)}emit(n,o){this.emitter.emit(n,o)}off(n,o){this.emitter.off(n,o)}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(n){this.context.configService.updateConfig(n)}bindContainer(n){return this.context.viewService.bindContainer(n)}unbindContainer(){this.context.viewService.unbindContainer()}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab()}hide(){this.updateViewerConfig({visibility:"hidden"})}render(){}resize(){this.context.resize()}indexToUid(n){const o=this.context.getActiveTab();return null==o?void 0:o.indexToUid(n)}uidToIndex(n){const o=this.context.getActiveTab();return o?o.uidToIndex(n):-1}getCurrentPageIndex(){const n=this.context.getActiveTab();return n?n.current:-1}getPageCounts(){const n=this.context.getActiveTab();return n?n.total:0}getCurrentPageUid(){var n;const o=this.context.getActiveTab();return null==o||null===(n=o.getCurrentPage())||void 0===n?void 0:n.uid}selectAllPages(){const n=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(n).keys()))}selectPagesByIndices(n){const o=this.context.getActiveTab();if(!o)return[];const h=o.indicesToUids(n);return this.core.viewerService.onSelectPages.emit(UF.create(o.uid,this.groupUid,this.uid,n)),[...h]}getSelectedPageIndices(){const n=this.context.getActiveTab();return n?n.getSelectedIndices():[]}gotoPage(n){const o=this.context.getActiveTab();return o?(n=Ir(n,0,o.total-1),o.current===n||this.core.viewerService.onGotoPage.emit(WF.create(o.uid,this.groupUid,this.uid,n)),n):-1}movePages(n,o){const h=this.context.getActiveTab();return!!h&&this.core.movePages(h.uid,n,o)}swapPages(n,o){const h=this.context.getActiveTab();return!!h&&this.core.swapPages(h.uid,n,o)}reorderPages(n){const o=this.context.getActiveTab();return!!o&&this.core.reorderPages(o.uid,n)}deletePages(n){const o=this.context.getActiveTab();if(!o||!n.every(v=>v>=0&&v<o.total))return!1;const h=o.indicesToUids(n);return this.core.deletePages(o.uid,h)}deleteAllPages(){const n=this.context.getActiveTab();return!!n&&this.core.deleteAllPages(n.uid)}openDocument(n){this.core.openDocument(n.uid,this.uid)}closeDocument(n){if(!n){const o=this.context.getActiveTab();if(!o)return;n=o.uid}this.core.closeDocument(n,this.uid)}printDocument(){}activateTab(n){var o;return(null===(o=this.context)||void 0===o?void 0:o.activateTab(n))||!1}getActiveTab(){var n;return(null===(n=this.context)||void 0===n?void 0:n.getActiveTab())||null}getAllTabs(){var n;return(null===(n=this.context)||void 0===n?void 0:n.tabService.getAllTabs())||[]}getRealPageSize(n){const o=this.context.getActiveTab();if(!o)return{width:0,height:0};gt(n)&&(n=o.current);const h=o.getPageByIndex(n);return{width:h.rWidth,height:h.rHeight}}getRealPixelSize(n){const o=this.context.getActiveTab();if(!o)return{width:0,height:0};gt(n)&&(n=o.current);const h=o.getPageByIndex(n),v=this.core.pageService.getPage(h.uid),{rWidth:y,rHeight:_}=v.getEditResultForPerspective();return{width:Kn(y,jn.displayResolution,v.resource.resolutionX),height:Kn(_,jn.displayResolution,v.resource.resolutionY)}}zoomIn(){const n=this.getActiveTab();if(!n||!n.isDocType)return;const{maxZoom:o}=this.getViewerConfig(),{zoom:h}=n.context;let v=Ree(h,"in");(null===v||v>o)&&(v=o),this.updateViewerConfig({zoom:v})}zoomOut(){const n=this.getActiveTab();if(!n||!n.isDocType)return;const{minZoom:o}=this.getViewerConfig(),{zoom:h}=n.context;let v=Ree(h,"out");(null===v||v<o)&&(v=o),this.updateViewerConfig({zoom:v})}filter(n,o){const h=this.context.getActiveTab();if(!h)return!1;const v=h.indicesToUids(n);return this.core.filterPages(h.uid,v,o),!1}perspectivePage(n,o){var h=this;return Fe(function*(){const v=h.context.getActiveTab();if(!v)return null;let y=v.currentUid;return gt(o)||(y=v.indexToUid(o)),n=Kn(n,h.context.core.pageService.getPage(y).resource.resolutionX,jn.displayResolution),(yield h.core.perspectivePage(v.uid,y,n)).data})()}perspectiveAllPage(){const n=this.context.getActiveTab();if(!n)return;const o=[],h=[],v=[];n.pages.forEach((b,w)=>{b.isVisible?o.push(w):b.isPreload?h.push(w):v.push(w)});const y=[...o,...h,...v],{displayResolution:_}=jn;for(let b=0;b<y.length;b++){const w=this.indexToUid(y[b]),I=this.context.core.pageService.getPage(w);if(I.isFull){let{width:A,height:M}=I.raw.getImageDetail();const F=Math.abs((I.rotation%360+360)%360);if(90===F||270===F){const B=A;A=M,M=B}this.context.core.perspectivePage(n.uid,w,Kn([[0,0],[A,0],[A,M],[0,M]],I.resolutionX,_))}else if(I.activeQuad&&I.activeQuad!==I.quad){const{width:A,height:M}=I.raw.getPageSize(),F=$F(I.activeQuad.flat(),I.rotation,A,M),V=Z2(F);this.context.core.perspectivePage(n.uid,w,V)}}}getPerspectivePreviewImage(n,o,h,v){const y=this.context.getActiveTab();if(!y)return null;const _=y.getPageByIndex(n);if(!_)return null;const b=_.uid,{quadSelectionStyle:w}=this.getViewerConfig(),{borderColor:I}=Xx(w.border),A=function(M){const F=V=>{const B=V.toString(16);return 1===B.length?`0${B}`:B};if(M.startsWith("rgb")){const V=M.match(/(\d+)/g);if(3===V.length){const B=parseInt(V[0],10),Q=parseInt(V[1],10),J=parseInt(V[2],10);return`#${F(B)}${F(Q)}${F(J)}`}}return!M.startsWith("#")||7!==M.length&&4!==M.length?"#FE8E14":M}(I);return this.context.core.getPerspectivePreviewData(b,{width:o||200,height:h||200},{strokeColor:A.substring(1),lineWidth:v})}}function Ree(p,n){const o=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===n){for(let h=0;h<o.length;h++)if(o[h]>p)return o[h]}else for(let h=o.length-1;h>=0;h--)if(o[h]<p)return o[h];return null}class C6e extends or{constructor(n){super(),W(this,"isDestroyed",!1),W(this,"viewers",new Map),W(this,"groups",new Map),W(this,"onGotoPage",void 0),W(this,"onSelectPages",void 0),W(this,"onCurrentChangedByScroll",void 0),W(this,"onResize",void 0),W(this,"onPagePreloadChanged",void 0),W(this,"onViewerCreated",void 0),W(this,"core",void 0),this.core=n,this.initEventEmitter()}initEventEmitter(){this.onGotoPage=Dt(this),this.onSelectPages=Dt(this),this.onCurrentChangedByScroll=Dt(this),this.onResize=Dt(this),this.onPagePreloadChanged=Dt(this),this.onViewerCreated=Dt(this)}reset(){for(const n of this.viewers.values())n.dispose();this.viewers.clear(),this.groups.clear()}destroy(){if(!this.isDestroyed){for(const n of this.viewers.values())n.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0}}createViewer(n,o){var h;const{groupUid:v}=o,y=this.groups.get(v)||new WAe(v);var _;gt(null===(h=o.viewerConfig)||void 0===h?void 0:h.scrollToLatest)||y.isSetScrollToLatest||(y.updateConfig({scrollToLatest:null===(_=o.viewerConfig)||void 0===_?void 0:_.scrollToLatest}),y.isSetScrollToLatest=!0),o.groupConfig&&y.updateConfig(o.groupConfig);const b=new n(o);b.group=y,y.viewerUids.add(b.uid),this.groups.set(v,y),this.viewers.set(b.uid,b);const w=this.getViewersByGroupUid(v);if(w.length>0){b.context.syncViewer(w[0]);const I=w[0].getActiveTab();I&&this.core.commandService.emitOperationsChanged(I.uid)}return this.onViewerCreated.emit(zF.create(b)),b}removeViewer(n){let o;if(o=Sn(n)?this.getViewer(n):n,!o)return!1;const{uid:h,groupUid:v}=o,y=this.groups.get(v);return y&&(y.viewerUids.delete(h),y.viewerUids.size||this.groups.delete(v)),this.viewers.delete(o.uid),o.dispose(),!0}hasViewer(n){return this.viewers.has(n)}getViewer(n){return this.viewers.get(n)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(n){const o=this.viewers.get(n);return this.getViewersByGroupUid(o.groupUid)}getViewersByGroupUid(n){return this.groups.has(n)?this.groups.get(n).getViewerUids().map(o=>this.viewers.get(o)):[]}hasGroup(n){return this.groups.has(n)}}const b6e={apply(p){p.viewerService=new C6e(p)},install(p){p.setClass("Viewer",_6e)}},x6e=/^<\/([^>]*)>/,w6e=/^<([^\s>]+)[^>]*>/,S6e=/^<slot>.*<\/slot>/,T6e=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function rL(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:o,data:h,components:v,injection:y}=p,_=kee(o,h,v,y,n),b=_.length;return b&&(_[0].cpInstance=p,_[b-1].cpInstance=p),_}function kee(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],y=p.trim();const _=[];function b(M){y=y.substring(M)}function w(M){let[F,V]=M;if(V){const B=function(Z){const re={},se=SQ(Z,T6e);return se&&se.forEach(ce=>{let[,pe,Ce]=ce;re[pe]=Ce}),re}(F),Q=n[":for"];Q&&(delete n[":for"],B[":for"]=Q);const J={type:"start",name:V,data:n,attrs:B};_.push(J),(o[V]||h.components&&h.components[V])&&(J.cpOption={Component:o[V]||h.components[V],injection:h}),("input"===V||/\/>/.test(F))&&_.push({type:"end",name:V,data:n,attrs:{}})}}function I(M){let[,F]=M;F&&_.push({type:"end",name:F,attrs:{}})}function A(M){(M=M.trim())&&_.push({type:"text",name:M,attrs:{},data:n})}for(;y;){const M=y.indexOf("<");let F;if(0===M){const V=y.match(x6e);if(V){b(V[0].length),I(V);continue}const B=y.match(S6e);if(B){b(B[0].length),_.push(...v);continue}const Q=y.match(w6e);if(Q&&Q[0]!==Q.input){b(Q[0].length),w(Q);continue}F=y}else F=M>0?y.substring(0,M):y;F&&(b(F.length),A(F))}return _}function nD(p){const{cpInstance:n,children:o}=p;n&&!n.isInserted&&(n.isInserted=!0,n.hooks.inserted.emit()),o.forEach(h=>{nD(h)})}function oL(p){const{cpInstance:n,children:o}=p;n&&n.hooks.destroyed.emit(p),o.forEach(h=>{oL(h)})}function sL(p){if(p){const{el:n,children:o}=p;if(function(h){const{cpInstance:v}=h;v&&(v.dispose(),v.hooks.beforeDestroyed.emit(h))}(p),n){const h=n.parentElement;h&&h.removeChild(n),n.vNode=null,p.el=null}return oL(p),p.text=null,p.parent=null,o.length&&o.forEach(h=>{sL(h)}),!0}return!1}class iD{constructor(n){W(this,"el",void 0),W(this,"tagName",void 0),W(this,"sel",""),W(this,"data",void 0),W(this,"children",void 0),W(this,"text",void 0),W(this,"key",void 0),W(this,"cpInstance",void 0),W(this,"cpOptions",void 0),W(this,"parent",void 0),this.createVNode(n)}renderDom(){if(this.el)return this.el;let n;if("FRAGMENT"===this.tagName)n=document.createDocumentFragment();else if("TEXT"===this.tagName){const o=function(h){let v="";return 0===(h=String(h)).length?"":(v=h.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"'),v)}(this.text);n=document.createTextNode(o)}else{n=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[o,h]of Object.entries(this.data))n.setAttribute(o,h)}return this.children.forEach(o=>{const h=o.renderDom();n.appendChild(h)}),n.vNode=this,this.el=n,function(o){const{cpInstance:h,el:v}=o;h&&(h.vNode=o,h.hooks.created.emit(v))}(this),n}patch(n){return function I6e(p,n){const o=p.el,h=o.parentNode;null!==h&&(n.el=n.renderDom(),_Q(n.el,o,h),function(_){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;b<=w;)sL(_[b]),b+=1}([p]));let v=-1;const y=p.parent;return null==y||y.children.forEach((_,b)=>{_===p&&(v=b)}),v>-1&&(y.children[v]=n,n.parent=y,p.el=null),n}(this,n)}destroy(){return sL(this)}createVNode(n){const{tagName:o,data:h={},children:v=[],el:y=null,key:_,text:b="",cpOptions:w,cpInstance:I}=n;let A=o;h.id&&(A+=`#${h.id}`),h.class&&(A+=`.${h.class}`),this.sel=A,this.data=h,this.tagName=o,this.children=v,this.el=y,this.key=_,this.text=b,this.cpInstance=I,this.cpOptions=w}}function rD(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=[],h=[];let v=[];return p.forEach(y=>{if("start"===y.type)o.push(y),h.push(v),v=[];else if("text"===y.type)v.push({type:"text",value:y.name,data:y.data});else if(y instanceof iD)v.push(y);else{let _=o.pop();for(;_.name!==y.name;)_=o.pop();if(_){const{name:b,cpInstance:w,attrs:I,cpOption:A,data:M}=_,F={type:"token",tagName:b,cpInstance:w,cpOption:A,attrs:I,data:M,children:v};v.forEach(V=>{V.parent=F}),v=h.pop(),v.push(F)}}}),n?v[0]:v}const E6e=/'.+'|\\".+\\"|[\w$.]+/g,D6e=/{{([^\s@}]+)}}/;function e0(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Di(p)){const h=[];return p.forEach(v=>{h.push(...oD(e0(v)))}),h}if(p instanceof iD)return p;if("token"===p.type){var o;const{tagName:h,attrs:v,cpInstance:y,children:_,data:b,cpOption:w}=p;if(v[":for"])return function(F){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:B,data:Q}=F,J=JSON.parse(JSON.stringify(B)),Z={":for":B[":for"]};delete B[":for"],Mee(Z,Ke(Ke({},Q),V));const re=[];return Z[":for"].forEach(se=>{const ce=e0(F,se);re.push(...oD(ce))}),F.attrs=J,re}(p,n);const I=Ke(Ke({},b),n),A=Ke({},v);let M;if(Mee(v,I),Object.prototype.hasOwnProperty.call(v,"if")&&!v.if)M=null;else if(delete v.if,w)M=function(F){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:B,attrs:Q,cpOption:J}=F,Z=Oee(B,V),{Component:re,injection:se}=J,ce=new re({data:Q,injection:se}),pe=rD(rL(ce,Z));return pe?oD(e0(pe))[0]:null}(p,n);else{const{key:F}=v;void 0!==F&&delete v.key;const V=Oee(_,n);M=new iD({tagName:h.toUpperCase(),data:v,cpInstance:y,key:F,children:V})}return p.attrs=A,null===(o=M)||void 0===o||o.children.forEach(F=>{F.parent=M}),M}return function(h){var v;let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:_}=h;const b=null===(v=h.parent)||void 0===v||null===(v=v.attrs)||void 0===v?void 0:v.html;return _=function(w,I){const A=SQ(w,D6e);return A.length&&A.forEach(M=>{const F=M[1].split(".").reduce((B,Q)=>B[Q],I);w=w.replace(M[0],F)}),w}(_.trim(),Ke(Ke({},h.data),y)),b?e0(rD(kee(_),!1)):new iD({tagName:"TEXT",text:_})}(p,n)}function Mee(p,n){for(const v of Object.keys(p)){const[,y,_]=v.match(/^(:|@)(.+)/)||[];if(!_)continue;let b=p[v];if(delete p[v],"for"===_){var o,h;let[w,I]=b.split(" in "),[A,M]=w.split(",");A=A.trim(),M=null===(o=M)||void 0===o?void 0:o.trim(),I=null===(h=I)||void 0===h?void 0:h.trim();const F=[],V=I.split(".").reduce((B,Q)=>B[Q],n);if(Di(V))V.forEach((B,Q)=>{const J={};J[A]=B,M&&(J[M]=Q),F.push(J)});else if(Vn(V))for(const[B,Q]of Object.entries(V)){const J={};J[A]=Q,M&&(J[M]=B),F.push(J)}p[":for"]=F}else{const w="this"===b?n:b.split(".").reduce((I,A)=>null==I?void 0:I[A],n);if(void 0!==w)p[_]="class"===_&&p[_]?`${p[_]} ${w}`:w;else{b=b.replace(E6e,I=>I.includes('"')||I.includes("'")||/^(true|false|\d+|undefined|null)$/.test(I)?I:I.split("."));try{const I=A6e(b,n);gl(I)&&(p[_]=void 0),p[_]="class"===_&&p[_]?`${p[_]} ${I}`:I}catch(I){p[_]=void 0}}"@"===y&&(p.events||(p.events={}),p.events[_]=p[_],delete p[`@${_}`])}}}function oD(p){return p?(Di(p)||(p=[p]),p):[]}function Oee(p){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[];return p.forEach(h=>{const v=e0(h,n)||[];o.push(...oD(v))}),o}function A6e(p,n){let o=null;try{const h=p.split(",");for(let v=0;v<h.length;v++){const b=h[v].match(/(\w+)(\[(\d+)\])?/);if(!b){n=null;break}{const w=b[1],I=b[3];if(!Object.prototype.hasOwnProperty.call(n,w)){n=null;break}n=n[w],void 0!==I&&Array.isArray(n)&&(n=n[I])}}o=n}catch(h){o=null}return o}class Jo extends or{constructor(n){let{data:o={},template:h="",components:v={},injection:y={}}=n;super(),W(this,"el",void 0),W(this,"vNode",null),W(this,"template",""),W(this,"data",{}),W(this,"injection",{}),W(this,"components",{}),W(this,"emitter",void 0),W(this,"uiEmitter",void 0),W(this,"isInserted",!1),W(this,"hooks",{created:Lo.create(),inserted:Lo.create(),updated:Lo.create(),beforeDestroyed:Lo.create(),destroyed:Lo.create()}),W(this,"selfEvents",[]),W(this,"globalEvents",[]),W(this,"nativeEvents",[]),this.template=h,this.emitter=Yh.create(),this.setData(o),this.setComponents(v),this.setInjects(y),this.uiEmitter=this.injection.emitter,this.hooks.created.on(_=>{this.el=_}),this.hooks.destroyed.on(()=>{this.dispose()}),this.initEvents()}setInjects(n){Object.assign(this.injection,n)}initEvents(){var n=this;const o=(y,_)=>{this.on(y,function(){for(var b=arguments.length,w=new Array(b),I=0;I<b;I++)w[I]=arguments[I];Sn(_)?n.$emit(_,w):I_(_)&&_(...w)})};for(const[y,_]of Object.entries((null===(h=this.data)||void 0===h?void 0:h.events)||{})){var h;o(y,_)}for(const[y,_]of Object.entries((null===(v=this.data)||void 0===v||null===(v=v.options)||void 0===v?void 0:v.events)||{})){var v;o(y,_)}}setData(n){Object.assign(this.data,n)}setComponents(n){Object.assign(this.components,n)}on(n,o){this.emitter.on(n,o),this.selfEvents.push([n,o])}emit(n){for(var o=arguments.length,h=new Array(o>1?o-1:0),v=1;v<o;v++)h[v-1]=arguments[v];this.emitter.emit(n,...h)}unbindSelfEvents(){this.selfEvents.forEach(n=>{let[o,h]=n;this.emitter.off(o,h)}),this.selfEvents=[]}$on(n,o){var h;this.uiEmitter&&(null===(h=this.uiEmitter)||void 0===h||h.on(n,o),this.globalEvents.push([n,o]))}$emit(n){for(var o,h=arguments.length,v=new Array(h>1?h-1:0),y=1;y<h;y++)v[y-1]=arguments[y];null===(o=this.uiEmitter)||void 0===o||o.emit(n,...v)}unbindGlobalEvents(){this.globalEvents.forEach(n=>{let[o,h]=n;this.uiEmitter.off(o,h)}),this.globalEvents=[]}nativeOn(n,o,h){if(Di(n))n.forEach(v=>{this.nativeOn(v,o,h)});else{const v=(_=o,b=h,(y=n)?(y.addEventListener(_,b,void 0),()=>{y.removeEventListener(_,b)}):null);v&&this.nativeEvents.push(v)}var y,_,b}unbindNativeEvents(){this.nativeEvents.forEach(n=>{n()}),this.nativeEvents=[]}query(n){var o;return null===(o=this.el)||void 0===o?void 0:o.querySelector(n)}queryAll(n){var o;return null===(o=this.el)||void 0===o?void 0:o.querySelectorAll(n)}parseHTML(){return e0(rD(rL(this,[])))}reRenderVNode(){const n=e0(rD(rL(this)));this.vNode.patch(n)}bindEventsEmitter(){var n=this;const{options:o}=this.data;if(null!=o&&o.events)for(const[h,v]of Object.entries(o.events))this.nativeOn(this.el,h,function(){for(var y=arguments.length,_=new Array(y),b=0;b<y;b++)_[b]=arguments[b];n.emit(h,..._)})}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose()}}const Fr=(p,n,o,h)=>{const{id:v,tooltip:y,dataId:_,style:b,className:w}=p||{},I=(A=>{let M="";if(A)for(const[F,V]of Object.entries(A))M+=`${OEe(F)}:${V};`;return M})(b);return(gt(v)?"":` id="${v}"`)+` class="${n}${null!=o?o:""} ${w||""}"`+(gt(h)?"":` :class="${h}"`)+(I?` style="${I}"`:"")+(gt(y)?"":` title="${y}"`)+(gt(_)?"":` data-id="${_}"`)};function Fee(p){if(0===Object.keys(p).length||!p)return'<MainView :options="this"></MainView>';const n=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==p?void 0:p.type);return Sn(p.type)&&!n?`<${p.type} :options="this"></${p.type}>`:'<Root :options="this"></Root>'}function aL(){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=pn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=n&&n.children&&(n.children=n.children.map(o=>Sn(o)?{type:o}:Vn(o)?aL(o):o)),n.children||Di(n.children)||(n.children=[]),p.length&&n.children.push(...p),n}class fc{constructor(n){W(this,"options",void 0),W(this,"postfix",void 0),W(this,"uiEvents",[]),W(this,"parsedUiConfig",void 0),W(this,"injection",void 0),W(this,"rootComponent",void 0),W(this,"emitter",null),W(this,"rootDom",null),W(this,"rootVNode",void 0),W(this,"container",void 0),W(this,"uiConfig",{}),W(this,"popupUiConfig",[]);const{container:o,injection:h,postfix:v,uiConfig:y,emitter:_,popupUiConfig:b}=n;this.options=n,this.injection=h,this.uiConfig=y,this.popupUiConfig=b,this.parsedUiConfig=aL(y,b),this.emitter=_||Yh.create(),this.postfix=v||`-${Ai()}`,Sn(o)?this.container=document.getElementById(o):o instanceof HTMLElement&&(this.container=o),this.init()}static registerComponent(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[o,h]of Object.entries(n))fc.isAlreadyRegistered(o)||(this.components[`DDV${o}`]=h,this.components[o]=h)}static isAlreadyRegistered(n){return!!this.components[n]}static getComponents(){return this.components}init(){const n=new Jo({data:this.parsedUiConfig,template:Fee(this.parsedUiConfig),components:fc.getComponents(),injection:zt(Ke({},this.injection),{components:fc.getComponents(),postfix:this.postfix,emitter:this.emitter})}),o=n.parseHTML();if(!o)return;const h=o.renderDom();this.rootComponent=n,this.rootVNode=o,this.rootDom=h,this.container&&(this.container.appendChild(h),nD(this.rootVNode))}updateUiConfig(n){const o=aL(n,this.popupUiConfig),h=new Jo({data:o,template:Fee(this.parsedUiConfig),components:fc.getComponents(),injection:zt(Ke({},this.injection),{components:fc.getComponents(),postfix:this.postfix,emitter:this.emitter})}).parseHTML(),v=this.rootVNode.patch(h);return this.rootDom=v.el,this.rootVNode=v,this.uiConfig=n,nD(this.rootVNode),!0}bindContainer(n){let o;if(E_(n)&&(o=n),Sn(n)){const h=document.getElementById(n);E_(h)&&(o=h)}return!!o&&(this.container=o,o.appendChild(this.rootDom),nD(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let n=0;n<this.container.children.length;n++)if(this.container.children[n]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null}}queryByDataId(n){var o;return null===(o=this.rootDom)||void 0===o?void 0:o.querySelector(`[data-id=${n}]`)}queryAllByDataId(n){var o;return null===(o=this.rootDom)||void 0===o?void 0:o.querySelectorAll(`[data-id=${n}]`)}getElementsByType(n,o){var h;const v=[];return(null===(h=n.cpInstance)||void 0===h||null===(h=h.constructor)||void 0===h?void 0:h.cpName)===o&&n.el&&v.push(n.el),n.children.length>0&&n.children.forEach(y=>{v.push(...this.getElementsByType(y,o))}),v}on(n,o){const h=this.emitter.on(n,o);this.uiEvents.push(h)}emit(n){for(var o=arguments.length,h=new Array(o>1?o-1:0),v=1;v<o;v++)h[v-1]=arguments[v];this.emitter.emit(n,...h)}off(n,o){this.emitter.off(n,o)}offAllEvents(){this.uiEvents.forEach(n=>{let{name:o,fn:h,context:v,once:y}=n;this.emitter.off(o,h,v,y)})}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},oL(this.rootVNode)}}W(fc,"components",{});class lL extends Jo{constructor(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(n),W(this,"defaultClass","ddv-button"),this.initTemplate(o),this.bindBaseHooks()}bindBaseHooks(){this.hooks.inserted.on(n=>{this.bindEventsEmitter()})}initTemplate(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:o}=this.data,v=`<div ${Fr(o,""===n?this.defaultClass:`${this.defaultClass} ${n}`)} >`+(gt(null==o?void 0:o.label)?"":`<span>${o.label}</span>`)+"<slot></slot></div>";this.template=v}}class Lee extends Jo{constructor(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(n),W(this,"defaultClass","ddv-layout"),W(this,"enableScroll",!1),W(this,"showScrollArrow",!0),W(this,"scrollLeftOrTopBtn",void 0),W(this,"scrollRightOrBottomBtn",void 0);const{options:h}=this.data;this.enableScroll=(null==h?void 0:h.enableScroll)||!1,this.showScrollArrow=(null==h?void 0:h.showScrollArrow)||!0,this.initTemplate((null==h?void 0:h.flexDirection)||o),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{cL(this),this.bindCustomScroll()}),this.hooks.updated.on(()=>{cL(this)})}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const n=new ResizeObserver(()=>{this.showScrollArrow&&this.updateCustomScrollButton()});n.observe(this.el),this.hooks.destroyed.on(()=>{n.disconnect()})}initCustomScrollButton(){const n=document.createElement("div"),o=document.createElement("div"),h=150;n.addEventListener("click",()=>{const{scrollLeft:v,scrollTop:y}=this.el;n.classList.contains("ddv-scroll-top")?this.el.scroll(0,y-h):this.el.scroll(v-h,0)}),o.addEventListener("click",()=>{const{scrollLeft:v,scrollTop:y}=this.el;o.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,y+h):this.el.scroll(v+h,0)}),this.el.addEventListener("scroll",v=>{this.showScrollArrow&&this.updateCustomScrollButton()}),this.el.appendChild(n),this.el.appendChild(o),this.scrollLeftOrTopBtn=n,this.scrollRightOrBottomBtn=o,this.updateCustomScrollButton()}updateCustomScrollButton(){const{vertical:n,horizontal:o}=Nee(this.el),{scrollLeft:h,scrollTop:v}=this.el,{scrollRightOrBottomBtn:y,scrollLeftOrTopBtn:_}=this;if(!_||!y)return;if(!n&&!o)return _.style.display="none",void(y.style.display="none");_.className="ddv-scroll-button "+(o?"ddv-scroll-left":"ddv-scroll-top"),y.className="ddv-scroll-button "+(o?"ddv-scroll-right":"ddv-scroll-bottom");const b=function(w){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:A,horizontal:M}=Nee(w);if(!A&&!M)return[!1,!1];const{scrollLeft:F,scrollTop:V,scrollHeight:B,scrollWidth:Q,clientWidth:J,clientHeight:Z}=w;return M?[F<=I,F+J-I>=Q]:[V<=I,V+Z-I>=B]}(this.el,0);o?(_.style.left=`${h}px`,y.style.right=-h+"px"):(_.style.top=`${v}px`,y.style.bottom=-v+"px"),_.style.display=b[0]?"none":"",y.style.display=b[1]?"none":""}initTemplate(n){const{options:o}=this.data,h=(null==o?void 0:o.children)||[];let y=`${this.defaultClass}${"row"===n?"":"-col"}`;this.enableScroll&&(y+=" ddv-custom-scroll-hidden");let _=`<div ${Fr(o,y)}>`;h&&h.length&&h.forEach((b,w)=>{if(Vn(b)){const{type:I}=b;I.trim(),I.length>0&&(_+=`<${I} :options="options.children[${w}]"></${I}>`)}}),_+="</div>",this.template=_}}function cL(p){const{options:n}=p.data,o=p.el.children;((null==n?void 0:n.children)||[]).forEach((h,v)=>{if(E_(h)){const y=h;0===v?(p.el.append(y),p.el.insertBefore(y,o[0])):((_,b)=>{const w=b.parentNode;w.lastChild===b?w.appendChild(_):_Q(_,b.nextSibling,w)})(y,o[v-1])}})}function Nee(p){let n=p.scrollHeight>p.clientHeight,o=p.scrollWidth>p.clientWidth;return n&&o&&(p.scrollHeight-p.clientHeight>p.scrollWidth-p.clientWidth?o=!1:n=!1),{vertical:n,horizontal:o}}class Bee extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks()}initTemplate(){const{options:n}=this.data,{children:o}=n;let v=`<div ${Fr(n,"column"===n.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass,"")} >`;o&&o.length&&o.forEach((y,_)=>{if(Vn(y)){const{type:b}=y;b.trim(),b.length>0&&(v+=`<${b} :options="options.children[${_}]"></${b}>`)}}),v+="</div>",this.template=v}bindHooks(){this.hooks.inserted.on(()=>{cL(this)})}}class Wee extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.updateClassName()}),this.hooks.updated.on(()=>{this.isInserted&&this.updateClassName()})}updateClassName(){const o=window.getComputedStyle(this.el.parentNode),{flexDirection:h}=o;"column"===h&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"))}initTemplate(){const{options:n}=this.data,o=Fr(n,this.defaultClass);this.template=`<div ${o}></div>`}}const t0={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"};function Uee(p,n,o){const h=v=>{const y=(parseFloat(v.value)-n)/(o-n)*100;p.style.backgroundSize=`${y}% 100%`};h(p),p.oninput=v=>{h(p)},p.onchange=v=>{h(p)}}function uL(p,n){const{bottom:o,height:h}=p.parentNode.getBoundingClientRect(),{height:v}=p.getBoundingClientRect(),{bottom:y}=n.getBoundingClientRect();let _=h;return y-o<v&&(_=-v),_}function sD(p){p.$on("ui_hidePopup",n=>{n!==p&&I_(null==p?void 0:p.togglePopup)&&(null==p||p.togglePopup(!1))})}function Ew(p){p.$on("ui_cropClick",n=>{const{viewer:o}=p.injection,h=o.getPageCounts()||0;(n||h)&&sf(p.el,n)})}function pc(p){p.$on("ui_toolModeRefactor",()=>{const{viewer:n}=p.injection,o=n.getPageCounts()||0,{toolMode:h}=n.context.viewerConfig;o&&sf(p.el,"annotation"===h||"crop"===h)})}function sf(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!p)return;const{classList:o}=p,h=o.contains("ddv-button-disabled");n?h||p.classList.add("ddv-button-disabled"):h&&!n&&p.classList.remove("ddv-button-disabled")}function ed(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!p)return;const{classList:h}=p;let v="ddv-button-activated";"deep"===o?v="ddv-button-activated-deep":"light"===o&&(v="ddv-button-activated-light");const y=h.contains(v);n?y||p.classList.add(v):p.classList.remove(v)}function cm(p,n,o){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:y,right:_,bottom:b}=function(Ve,te){const Me=(te||Ve.parentElement).getBoundingClientRect(),we=Ve.getBoundingClientRect();return{top:we.top-Me.top,bottom:Me.bottom-we.bottom,left:we.left-Me.left,right:Me.right-we.right}}(n,p),{x:w,y:I,width:A}=p.getBoundingClientRect(),{height:M,width:F}=o.getBoundingClientRect(),{x:V,y:B,width:Q,height:J}=n.getBoundingClientRect(),Z=ni(getComputedStyle(p).borderWidth);let re=Math.floor(V)-Math.floor(w)-Z.value;re<5&&(re=0);const se=A-F,ce=re-(Math.floor(F)-Math.floor(Q))/2,pe=ce<5?"0px":`${ce}px`;let Ce=Math.floor(B)-Math.floor(I)-Z.value;o.style.left=v&&_>F/2&&y>F/2?pe:A<F+5?"0px":_>F?`${re}px`:y>F?re-(Math.floor(F)-Math.floor(Q))+"px":_>F/2&&y>F/2?pe:se<5?"0px":`${se}px`,b>M?(h&&(Ce+=2),o.style.top=Ce+Math.floor(J)-1+"px"):(h&&(Ce-=4),o.style.top=Ce-Math.floor(M)+"px")}function eh(p,n,o){const h=yl.getTooltip(),v=yl.getDisplayTextConfig();null!=o&&o.id||!(p in t0)||(o.id=t0[p]+n.postfix),null!=o&&o.tooltip||!(p in h)||(o.tooltip=h[p]),null!=o&&o.displayText&&(o.label=null==o?void 0:o.displayText),null!=o&&o.label||!(p in v)||(o.label=v[p])}function th(p){return(null==p?void 0:p.constructor.cpName)||""}function Vee(p){const{value:n}=p,{fontSize:o}=getComputedStyle(p),h=document.createElement("div");h.style.position="absolute",h.style.left="-9999px",h.style.top="-9999px",h.style.visibility="hidden",h.style.fontSize=o,h.style.fontFamily="Arial, Helvetica, sans-serif",document.body.appendChild(h),h.textContent=n;const v=h.clientWidth+1;return h.remove(),v}function aD(p,n){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];p.uiState!==n&&p.el&&(sf(p.el,"disabled"===n),function(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!v)return;const{classList:_}=v,b=_.contains("ddv-button-focused");y?b||v.classList.add("ddv-button-focused"):v.classList.remove("ddv-button-focused")}(p.el,"focused"===n),o&&ed(p.el,"focused"===n,h?"deep":"base"),p.uiState=n)}class br extends lL{constructor(n,o){super(n,o.class),W(this,"callback",void 0),W(this,"uiState","normal"),W(this,"isFocused",!1),W(this,"isMenuButton",!1),this.callback=o.callback,this.bindHooks(),this.isMenuButton=n.data.menu||!1,"false"!==n.data.default&&this.bindDefaultUi()}bindEvent(){this.nativeOn(this.el,"click",this.callback)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup")})}setUiState(n){aD(this,n,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton)}bindDefaultUi(){const{viewer:n}=this.injection,o=h=>{let v=this.isFocused?"focused":"normal";(gt(null==h?void 0:h.pageCount)?this.injection.viewer.getPageCounts():h.pageCount)||(v="disabled"),this.setUiState(v,!rr())};n.hooks.pageExistenceChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}bindHooks(){this.hooks.created.on(()=>{this.bindEvent(),this.bindHidePopup()}),this.hooks.updated.on(()=>{this.uiState="normal"})}initTemplate(n){const o=this.data;o.options||(o.options={});const{options:h,id:v}=this.data;v&&(h.id=v),eh(th(this),this.injection.viewer,h),"false"===o.default&&(h.label=void 0),super.initTemplate(n)}}class lD extends Jo{constructor(n){super(n),W(this,"uiState","normal"),W(this,"defaultClass",void 0),W(this,"pullDownBox",void 0),W(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks()}bindViewerResized(){const{viewer:n}=this.injection;n.hooks.resize.on(()=>{const{pullDownBox:o}=this;if(!o)return;const v=this.injection.viewer.rootDom;"none"===o.style.display?this.isFirstClick=!0:cm(v,this.el,this.pullDownBox)},this)}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",()=>{this.togglePopup(),this.isFirstClick&&(cm(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1)})}bindPopupSwitchEvent(){sD(this)}bindDefaultUi(){const n=o=>{const h=(gt(null==o?void 0:o.pageCount)?this.injection.viewer.getPageCounts():o.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(h)};this.injection.viewer.hooks.pageExistenceChanged.on(n,this),this.hooks.inserted.on(n),this.hooks.updated.on(n)}initPullDownBox(){this.hooks.created.on(()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents()}),this.hooks.updated.on(()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0})}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on(n=>{"hidden"===n.newVisibility&&this.togglePopup(!1)},this)}setUiState(n){aD(this,n)}togglePopup(n){const{pullDownBox:o}=this,{viewer:h}=this.injection;let v="none"===o.style.display;v=gt(n)?!v:!n,v?o.remove():(this.$emit("ui_hidePopup",this),h.rootDom.appendChild(o)),ed(this.el,!v),o.style.display=v?"none":""}}class cD extends lD{constructor(n){super(n),W(this,"lastSelectedIndex",0),W(this,"defaultClass","ddv-pdl"),W(this,"pullDownBoxClass","ddv-pull-down"),W(this,"children",[]),W(this,"hasCheckIcon",!1);const{defaultClassName:o,children:h,showCheckIcon:v}=n.data.options;o&&(this.defaultClass=o),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=h,this.hasCheckIcon=v,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let n="";return this.children.forEach((o,h)=>{const{id:v,label:y}=o;o.id=void 0,o.label=void 0,n+=`<${o.type} :options="options.children[${h}]" default="false"id="${v?v+this.injection.viewer.postfix:""}" ><span>${y}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${o.type}>`}),n}selectChildren(n){if(!this.hasCheckIcon)return;const{pullDownBox:o}=this;if(-1!==n&&!o.childNodes[n])return;if(-1!==this.lastSelectedIndex){const y=o.children[this.lastSelectedIndex],_=y.getElementsByTagName("i")[0];y.classList.remove("ddv-pull-down-selected"),_.style.visibility="hidden"}if(-1===n)return void(this.lastSelectedIndex=-1);const h=o.children[n],v=h.getElementsByTagName("i")[0];h.classList.add("ddv-pull-down-selected"),v.style.visibility="visible",this.lastSelectedIndex=n}initTemplate(){const n=this.data;n.options||(n.options={});const{options:o}=this.data,{pullDownBox:h}=o;eh(th(this),this.injection.viewer,o);const v=`<div ${Fr(o,`ddv-button ${this.defaultClass}`)}>`+(gt(null==o?void 0:o.label)?"":`<span>${o.label}</span>`)+`<div ${Fr(h,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=v}}class jee extends lD{constructor(n){super(n),W(this,"defaultClass","ddv-pdm"),W(this,"pullDownBoxClass","ddv-pull-down"),W(this,"children",[]);const{defaultClassName:o,children:h,enableScroll:v}=n.data.options;o&&(this.defaultClass=o),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,v&&(this.pullDownBoxClass+=rr()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=h,this.initPullDownBox(),this.initTemplate()}getChildrenTemplate(){let n="";return this.children.forEach((o,h)=>{n+=`<${o.type} :options="options.children[${h}]" menu="true"></${o.type}>`}),n}initTemplate(){const n=this.data;n.options||(n.options={});const{options:o}=this.data,{pullDownBox:h}=o;eh(th(this),this.injection.viewer,o);const v=`<div ${Fr(o,`ddv-button ${this.defaultClass}`)}>`+(gt(null==o?void 0:o.label)?"":`<span>${o.label}</span>`)+`<div ${Fr(h,this.pullDownBoxClass)}>${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=v}}class nh extends br{constructor(n,o){super(n,{class:o.class,callback:()=>{const{viewer:h}=this.injection;rr()&&this.el.classList.contains("ddv-button-focused")?h.updateViewerConfig({toolMode:"pan"}):(h.updateViewerConfig({toolMode:"annotation",annotationMode:o.annotationMode}),"stamp"===o.annotationMode&&h.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null}}}))}}),W(this,"annotationMode",void 0),this.annotationMode=o.annotationMode}bindDefaultUi(){const n=this.injection.viewer,o=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:h,annotationMode:v}=n.getViewerConfig();n.getPageCounts()?this.setUiState("annotation"!==h?"normal":v===this.annotationMode?"focused":"normal"):this.setUiState("disabled")};n.hooks.pageExistenceChanged.on(o,this),n.hooks.toolModeChanged.on(o,this),n.hooks.annotationModeChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}class Hee extends nh{constructor(n){super(n,{class:"ddv-ellipse",annotationMode:"ellipse"})}}W(Hee,"cpName","EllipseAnnotation");class Gee extends nh{constructor(n){super(n,{class:"ddv-annot-eraser",annotationMode:"erase"})}}W(Gee,"cpName","EraseAnnotation");class zee extends nh{constructor(n){super(n,{class:"ddv-ink",annotationMode:"ink"})}}W(zee,"cpName","InkAnnotation");class Yee extends nh{constructor(n){super(n,{class:"ddv-line",annotationMode:"line"})}}W(Yee,"cpName","LineAnnotation");class Xee extends nh{constructor(n){super(n,{class:"ddv-polygon",annotationMode:"polygon"})}}W(Xee,"cpName","PolygonAnnotation");class $ee extends nh{constructor(n){super(n,{class:"ddv-polyline",annotationMode:"polyline"})}}W($ee,"cpName","PolylineAnnotation");class qee extends nh{constructor(n){super(n,{class:"ddv-rect",annotationMode:"rectangle"})}}W(qee,"cpName","RectAnnotation");class Kee extends nh{constructor(n){super(n,{class:"ddv-annot-select",annotationMode:"select"})}}W(Kee,"cpName","SelectAnnotation");class Jee extends nh{constructor(n){super(n,{class:"ddv-stamp-icon",annotationMode:"stamp"})}bindDefaultUi(){const n=this.injection.viewer,o=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:h,annotationMode:v}=n.getViewerConfig(),y=n.getPageCounts(),{defaultStyleConfig:_}=n.getAnnotationConfig(),{stamp:b}=_;this.setUiState(y?"annotation"!==h||"stamp"!==v||(null==b?void 0:b.imageData)?"normal":"focused":"disabled")};n.hooks.pageExistenceChanged.on(o,this),n.hooks.toolModeChanged.on(o,this),n.hooks.annotationModeChanged.on(o,this),n.hooks.annotationDefaultStyleChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(Jee,"cpName","StampIconAnnotation");class Qee extends br{constructor(n){super(n,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,rr()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click())}}),W(this,"annotationImageLoader",void 0)}createAnnotationImageLoaderInput(){const n=document.createElement("input");return n.accept="image/png,image/jpeg,image/bmp",n.type="file",n.addEventListener("change",o=>{const{files:h}=n,v=new Blob([h[0]],{type:h[0].type});["image/png","image/jpeg","image/bmp"].includes(h[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:v}}}),n.value=null,n.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}))},!0),n}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const n=this.createAnnotationImageLoaderInput();n.style.display="none",this.el.appendChild(n),this.annotationImageLoader=n,this.annotationImageLoader.addEventListener("click",o=>{o.stopPropagation()})})}bindDefaultUi(){const n=this.injection.viewer,o=()=>{if(!xi.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:h,annotationMode:v}=n.getViewerConfig(),y=n.getPageCounts(),{defaultStyleConfig:_}=n.getAnnotationConfig(),{stamp:b}=_;this.setUiState(y?"annotation"!==h?"normal":"stamp"===v&&(null==b?void 0:b.imageData)?"focused":"normal":"disabled")};n.hooks.pageExistenceChanged.on(o,this),n.hooks.toolModeChanged.on(o,this),n.hooks.annotationModeChanged.on(o,this),n.hooks.annotationDefaultStyleChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(Qee,"cpName","StampImageAnnotation");class Zee extends nh{constructor(n){super(n,{class:"ddv-text-box",annotationMode:"textBox"})}}W(Zee,"cpName","TextBoxAnnotation");class ete extends nh{constructor(n){super(n,{class:"ddv-typewriter",annotationMode:"textTypewriter"})}}W(ete,"cpName","TextTypewriterAnnotation");class uD extends jee{constructor(n){const{AnnotationSet:o}=yl.getDisplayTextConfig(),h=n.data;h.options=zt(Ke({},h.options),{children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:o,enableScroll:!0}),super(n),Ew(this)}bindDefaultUi(){xi.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on(n=>{const{toolMode:o}=this.injection.viewer.getViewerConfig(),h=this.injection.viewer.getPageCounts();"annotation"===o&&h>0&&this.setUiState("focused")})):this.hooks.inserted.on(n=>{this.setUiState("disabled")})}togglePopup(n){if((!0!==n||""!==this.pullDownBox.style.display)&&(!1!==n||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(n),""===this.pullDownBox.style.display&&tte(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let o=0;for(let h=0;h<this.pullDownBox.children.length;h++){const v=this.pullDownBox.children[h];v.classList.contains("ddv-button-focused")&&(o=v.offsetLeft+v.clientWidth/2-this.pullDownBox.clientWidth/2)}this.pullDownBox.scroll(o,0)}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",n=>{if(n===this||"viewer"===n||n===uD.cpName)return;const{toolMode:o}=this.injection.viewer.getViewerConfig();"annotation"!==o&&this.togglePopup(!1)})}bindViewerHooks(){if(!xi.annotationLicenseModuleIsExist())return;const n=this.injection.viewer;n.hooks.resize.on(()=>{this.pullDownBox.style.justifyContent=tte(this.pullDownBox).horizontal?"start":""},this),n.hooks.pageExistenceChanged.on(()=>{const{toolMode:o}=n.getViewerConfig();let h="disabled";n.getPageCounts()>0?(h="normal","annotation"===o&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),h="focused")):this.togglePopup(!1),this.setUiState(h)},this),n.hooks.toolModeChanged.on(o=>{if("crop"===o.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const h="annotation"===o.newToolMode;n.getPageCounts()>0&&(this.setUiState(h?"focused":"normal"),this.$emit("ui_annotationModeClick",h),this.$emit("ui_toolModeRefactor",h),h&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)))},this)}setUiState(n){super.setUiState(n)}}function tte(p){return{vertical:p.scrollHeight>p.clientHeight,horizontal:p.scrollWidth>p.clientWidth}}W(uD,"cpName","AnnotationSet");class dD extends br{constructor(n,o){super(n,{class:o.class,callback:()=>{const{viewer:h}=this.injection,v=h.getSelectedAnnotations();if(1!==v.length)return;const y=v[0].uid;switch(this.layerType){case"bringForward":h.bringForward(y);break;case"bringToFront":h.bringToFront(y);break;case"sendBackward":h.sendBackward(y);break;case"sendToBack":h.sendToBack(y)}}}),W(this,"layerType",void 0),this.layerType=o.layerType}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const n=this.injection.viewer,o=xi.annotationLicenseModuleIsExist(),h=()=>{if(!o)return void this.setUiState("disabled");const{viewer:v}=this.injection,y=v.getSelectedAnnotations();n.getPageCounts()&&1===y.length?this.setUiState("normal"):this.setUiState("disabled")};n.hooks.annotationLayerStateChanged.on(v=>{let{state:y}=v;if(!o)return void this.setUiState("disabled");const _=n.getSelectedAnnotations();if(!_.length||_.length>1)return void this.setUiState("disabled");const b=n.getAnnotationObject(_[0].uid);if(b&&!b.context.isActive)return void this.setUiState("disabled");let w=!1;switch(this.layerType){case"bringForward":w=y.forward;break;case"bringToFront":w=y.front;break;case"sendBackward":w=y.backward;break;case"sendToBack":w=y.back}this.setUiState(w?"normal":"disabled")},this),n.hooks.pageExistenceChanged.on(h,this),this.hooks.inserted.on(h),this.hooks.updated.on(h)}}class nte extends dD{constructor(n){super(n,{class:"ddv-bring-forward",layerType:"bringForward"})}}W(nte,"cpName","BringForward");class ite extends dD{constructor(n){super(n,{class:"ddv-bring-to-front",layerType:"bringToFront"})}}W(ite,"cpName","BringToFront");class rte extends dD{constructor(n){super(n,{class:"ddv-send-backward",layerType:"sendBackward"})}}W(rte,"cpName","SendBackward");class ote extends dD{constructor(n){super(n,{class:"ddv-send-to-back",layerType:"sendToBack"})}}W(ote,"cpName","SendToBack");class ste extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-annotation-toolbar"),W(this,"lastSelected",void 0),W(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks()}bindHooks(){const n=o=>{this.el.style.display="none"};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){const{viewer:n}=this.injection,o=()=>{if(!this.lastSelected)return;const h=n.getActiveTab();if("single"===h.context.displayMode&&this.lastSelected.pageUid!==h.getCurrentPage().uid)return;const{show:v,x:y,y:_}=dL(n.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(v,y,_)};if(n.hooks.visibleChanged.on(()=>{this.togglePopup(!1)},this),n.hooks.pageExistenceChanged.on(h=>{0===h.pageCount&&(this.togglePopup(!1),this.lastSelected=null)},this),n.hooks.selectedAnnotationsChanged.on(h=>{if(1!==h.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const y=n.getAnnotationObject(h.newAnnotationUids[0]);if(!y)return;const{show:_,x:b,y:w}=dL(n.context.viewService.mainContainer,y,this.el,this.toolbarOffset);this.lastSelected=y,this.togglePopup(_,b,w)},this),n.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),n.hooks.afterAnnotationEdit.on(h=>{if(h instanceof Sp)return;const{show:v,x:y,y:_}=dL(n.context.viewService.mainContainer,h,this.el,this.toolbarOffset);this.lastSelected=h,this.togglePopup(v,y,_)},this),n.hooks.pageChanged.on(()=>{const h=n.getActiveTab();if(!h||"single"!==h.context.displayMode)return;const v=n.getSelectedAnnotations();if(1!==v.length)return;const y=v[0].pageUid===h.getCurrentPage().uid;this.togglePopup(y)},this),n.hooks.resize.on(o,this),n.hooks.scroll.on(o,this),n.hooks.fitModeChanged.on(o,this),n.hooks.displayModeChanged.on(o,this),n.hooks.zoomChanged.on(o,this),n.hooks.annotationsUpdated.on(o,this),null!=n&&n.annotationViewerContext){const{annotationViewerContext:h}=n,{hooks:v}=h.annotationController;v.enableAnnotationTextEditMode.on(o,this),v.disableAnnotationTextEditMode.on(o,this)}}togglePopup(n,o,h){const{viewer:v}=this.injection;n?(v.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${o||0}px`,this.el.style.top=`${h||0}px`):this.el.style.display="none"}initTemplate(){const{options:n}=this.data;eh(th(this),this.injection.viewer,n);const o=`<div ${Fr(n,this.defaultClass,"")}><AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton><AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>`;this.template=o}}function dL(p,n,o,h){const{width:v,height:y}=p.getBoundingClientRect(),_=n.context.getRealTimeBoundingBox(),b=getComputedStyle(o),w=ni(b.width).value,I=ni(b.height).value;if(_.right<0||_.left>v||_.top>y||_.bottom<0)return{show:!1,x:0,y:0};let M=_.bottom+h;return M+I>y&&(M=_.top-I-h),M<0&&(M=0),{show:!0,x:_.left+_.width/2-w/2,y:M}}W(ste,"cpName","AnnotationToolBar");class ate extends br{constructor(n){super(n,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible")}}),Ew(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture()})}focusTexture(){const n=this.injection.viewer.getSelectedAnnotations();if(1===n.length){const o=this.injection.viewer.getAnnotationObject(n[0].uid);o instanceof sr&&o.isEditMode&&o.focusTexture()}}}W(ate,"cpName","AnnotationPaletteButton");class lte extends br{constructor(n){super(n,{class:"ddv-delete-annot",callback:()=>{const{viewer:o}=this.injection,h=o.getSelectedAnnotations(),v=[];h.forEach(y=>{v.push(y.uid)}),o.deleteAnnotations(v)}}),Ew(this)}bindHidePopup(){this.nativeOn(this.el,"click",()=>{this.$emit("ui_hidePopup","AnnotationSet")})}bindDefaultUi(){const n=this.injection.viewer,o=()=>{const{viewer:h}=this.injection,v=h.getSelectedAnnotations();n.getPageCounts()&&v.length?this.setUiState("normal"):this.setUiState("disabled")};n.hooks.selectedAnnotationsChanged.on(o,this),n.hooks.pageExistenceChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(lte,"cpName","AnnotationDeleteButton");class P6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-color-panel"),W(this,"colorList",void 0),W(this,"enableChangeColor",void 0),W(this,"paletteType",void 0),W(this,"colorInput",void 0),W(this,"selectedColorButton",void 0),W(this,"lastUpdatedAnnotation",void 0),W(this,"lastInputColor",void 0),W(this,"lastTextContents",void 0),W(this,"lastPaletteType",void 0),W(this,"dblClickButtons",[]),this.colorList=n.data.colorList,this.enableChangeColor=n.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",o=>{this.el.style.display="stamp"===o?"none":"",this.paletteType=o,this.showNoFill("fill"===o),this.updateButtonSelected()})}bindHooks(){this.hooks.inserted.on(()=>{const n=document.createElement("input");n.type="color",this.colorInput=n,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents()})}bindEvents(){const n=this.el.querySelector(".ddv-palette-color-grid");n.addEventListener("click",o=>{const h=o.target;if(!(h instanceof HTMLButtonElement)||(this.dblClickButtons.push(h),this.dblClickButtons.length>2&&this.dblClickButtons.shift(),h.classList.contains("ddv-color-selected")))return;const v=h.value,{viewer:y}=this.injection;if(""===v)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=h;else{const _=y.getSelectedAnnotations();1===_.length&&this.updateColorByData(_[0],v),this.updateDefaultColor(v)}}),n.addEventListener("dblclick",o=>{if(!this.enableChangeColor)return;const h=o.target;if(!(h instanceof HTMLButtonElement)||2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const v=h.value;"transparent"!==v&&""!==v&&(this.colorInput.value=v,rr()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=h)})}bindColorInputEvents(){this.colorInput.addEventListener("input",n=>{const{viewer:o}=this.injection,h=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor(),this.selectedColorButton.children[0].style.background=h,this.selectedColorButton.value=h,1===o.getSelectedAnnotations().length&&this.updateColorByShape(h),this.updateDefaultColor(h),this.selectedColor(h)}),this.colorInput.addEventListener("change",n=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null)})}bindViewerHooks(){const n=this.injection.viewer;n.hooks.selectedAnnotationsChanged.on(()=>{this.updateButtonSelected()},this),n.hooks.annotationsUpdated.on(()=>{this.updateButtonSelected()},this),n.hooks.annotationModeChanged.on(()=>{this.updateButtonSelected()},this),n.hooks.annotationDefaultStyleChanged.on(()=>{this.updateButtonSelected()},this),n.hooks.annotationTextCharsSelected.on(o=>{const h=o.freeTextContentStyle,{color:v}=h;this.selectedColor(v)},this)}updateColorByShape(n){const o=this.injection.viewer.getSelectedAnnotations();if(1!==o.length)return;const h=this.injection.viewer.getAnnotationObject(o[0].uid);if("fill"===this.paletteType)h.style.background=n;else if("stroke"===this.paletteType)h.style.borderColor=n;else if("text"===this.paletteType&&h instanceof sr){if(h.hasSelectedChars){const v=M5(h,{color:n});h.style.textContents=v,h.textEditEventHandler.updateTextSelection()}else{if(h.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[o[0].type]:{textContent:{color:n}}}});{const v=k5(h,{color:n});v.length&&(h.style.textContents=v)}}this.lastTextContents=h.style.textContents}this.lastUpdatedAnnotation=o[0],this.lastInputColor=n,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render()}updateColorByData(n,o,h){const{viewer:v}=this.injection,{uid:y}=n,_={},b=this.injection.viewer.getAnnotationObject(y),w=h||this.paletteType;if("text"===w&&b instanceof sr){if(b.hasSelectedChars){const I=M5(b,{color:o});_.textContents=I}else{if(b.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n.type]:{textContent:{color:o}}}});{const I=k5(b,{color:o});I.length&&(_.textContents=I)}}return this.lastTextContents&&(_.textContents=this.lastTextContents,this.lastTextContents=null),v.updateAnnotation(y,{style:_},["appearanceChanged"]),void(b.hasSelectedChars&&b.textEditEventHandler.updateTextSelection())}"fill"===w?_.background="transparent"===o?"":o:"stroke"===w&&(_.borderColor=o),v.updateAnnotation(y,{style:_},["appearanceChanged"])}updateDefaultColor(n,o){const{annotationMode:h}=this.injection.viewer.getViewerConfig(),v=this.injection.viewer.getSelectedAnnotations();let y=h;v.length&&v[0]&&(y=v[0].type);const _={};switch(o||this.paletteType){case"fill":_.background=n;break;case"stroke":_.borderColor=n;break;case"text":_.textContent={},_.textContent.color=n}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[y]:_}})}selectedColor(n){const o=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let h=0;h<o.length;h++){const v=o[h];if(!v.value)continue;const y=Kd(v.value),_=Kd(n);y.formatted===_.formatted?v.classList.add("ddv-color-selected"):v.classList.contains("ddv-color-selected")&&v.classList.remove("ddv-color-selected")}}updateButtonSelected(){const{viewer:n}=this.injection,o=n.getSelectedAnnotations();if(1===o.length){let I=null;if("fill"===this.paletteType)I=o[0].style.background||"transparent";else if("stroke"===this.paletteType)I=o[0].style.borderColor||"transparent";else if("text"===this.paletteType){const A=n.getAnnotationObject(o[0].uid);var h;A instanceof sr&&(I=(null===(h=o[0].style)||void 0===h||null===(h=h.textContents[0])||void 0===h?void 0:h.color)||"transparent"),A instanceof sr&&(A.isEditMode||!A.style.textContents.length)&&(I=A.freeTextContentStyle.color)}return void(I&&this.selectedColor(I))}const{toolMode:v,annotationMode:y}=n.getViewerConfig();if("annotation"===v&&"select"!==y&&"erase"!==y){const{defaultStyleConfig:I}=n.getAnnotationConfig(),{background:A,borderColor:M,textContent:F}=Ki;let V=null;var _;if("fill"===this.paletteType)V=(null===(_=I[y])||void 0===_?void 0:_.background)||A||"transparent";else if("stroke"===this.paletteType){var b;V=(null===(b=I[y])||void 0===b?void 0:b.borderColor)||M||"transparent"}else if("text"===this.paletteType){var w;V=(null===(w=I[y])||void 0===w||null===(w=w.textContent)||void 0===w?void 0:w.color)||(null==F?void 0:F.color)||"transparent"}V&&this.selectedColor(V)}}getColorTemplate(){const n=document.createElement("div");let o="<div>",h=0;for(let y=0;y<this.colorList.length;y++){const _=this.colorList[y];if(n.style.background=_,""!==n.style.background){if(h>26)break;h+=1,o+=`<button value="${_}"><div style="background:${_}"></div></button>`,0!==h&&h%7==0&&(o+="</div><div>"),n.style.background=""}}const v=h>26?0:27-h;for(let y=0;y<v;y++)o+=0===y?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(h+y+1)%7==0&&(o+="</div><div>");return o+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',o+="</div>",n.remove(),o}showNoFill(n){this.el.querySelectorAll(".ddv-color-transparent").forEach(o=>{o.style.visibility=n?"":"hidden",o.style.pointerEvents=n?"":"none"})}addColor(){const n=this.el.querySelector(".ddv-palette-color-grid"),o=n.querySelector(".ddv-add-color"),h=n.querySelector(".ddv-color-placeholder");o&&o.classList.remove("ddv-add-color"),h&&(h.classList.remove("ddv-color-placeholder"),h.classList.add("ddv-add-color"))}initTemplate(){const n=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=n}}const hL=["Arial","Courier","Helvetica","Times New Roman"],um=jn.displayResolution/jn.dataResolution;class R6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-font-panel"),W(this,"fontFamilyEl",void 0),W(this,"fontSizeEl",void 0),W(this,"fontList",[...hL]),W(this,"inputIsBlur",!0),W(this,"currentFontSizeValue",void 0),W(this,"isArrowKeyPressed",!1),W(this,"maxFontSize",72),this.maxFontSize=n.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",o=>{"fontFamily"!==o&&this.toggleSelect("fontFamily",!1),"fontSize"!==o&&this.toggleSelect("fontSize",!1)}),this.$on("ui_changePalette_type",o=>{this.el.style.display="text"===o?"":"none"}),this.$on("ui_addFont",o=>{this.addFont(o)})}updateTextStyle(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:h,annotationMode:v}=this.injection.viewer.getViewerConfig(),y=this.injection.viewer.getSelectedAnnotations();if(1!==y.length||"textTypewriter"!==y[0].type&&"textBox"!==y[0].type)"annotation"!==h||"textBox"!==v&&"textTypewriter"!==v||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[v]:{textContent:n}}});else{const{uid:_,type:b}=y[0],w=this.injection.viewer.getAnnotationObject(_);if(w.isEditMode)w.hasSelectedChars&&(this.injection.viewer.updateAnnotation(_,{style:{textContents:M5(w,n)}},["appearanceChanged"]),w.textEditEventHandler.updateTextSelection());else{const I=k5(w,n);I.length&&this.injection.viewer.updateAnnotation(_,{style:{textContents:I}},["appearanceChanged"])}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[b]:{textContent:n}}})}o&&this.focusTexture()}bindHooks(){this.hooks.created.on(()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size")}),this.hooks.inserted.on(()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents()})}bindToggleEvent(){const n=this.fontSizeEl.querySelector(".ddv-down-arrow");$o(this.fontFamilyEl,"click",this).on(o=>{o.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily")},this),$o(n,"click",this).on(o=>{o.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize")},this)}bindSelectEvent(){const n=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),o=this.fontSizeEl.querySelector(".ddv-palette-font-size-select");n.addEventListener("click",h=>{h.stopPropagation(),this.toggleSelect("fontFamily",!1);const v=h.target.value;v&&this.updateTextStyle({fontFamily:v})}),o.addEventListener("click",h=>{h.stopPropagation(),this.toggleSelect("fontSize",!1);const v=h.target.value;v&&this.updateTextStyle({fontSize:ni(v).value*um})})}bindFontSizeInputEvent(){const n=this.fontSizeEl.getElementsByTagName("input")[0];n.addEventListener("keydown",h=>{h.stopPropagation(),"ArrowUp"!==h.key&&"ArrowDown"!==h.key||(this.isArrowKeyPressed=!0)}),n.addEventListener("keyup",h=>{if(h.stopPropagation(),this.isArrowKeyPressed){let v=Math.round(ni(n.value).value);v>this.maxFontSize&&(v=this.maxFontSize,n.value=`${this.maxFontSize}`),v<1&&(v=1,n.value="1"),this.updateTextStyle({fontSize:v*um},!1),this.isArrowKeyPressed=!1}}),n.addEventListener("focus",()=>{const v=ni(n.value).value;n.value=v,n.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=v,this.$emit("ui_shrinkSelectionBox")}),n.addEventListener("blur",h=>{this.inputIsBlur=!0,"text"!==n.type&&(this.currentFontSizeValue=n.value,n.type="text",n.value+="pt",h.relatedTarget instanceof HTMLInputElement||this.focusTexture())});const o=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;n.type="text",n.value+="pt",n.removeEventListener("change",o),n.blur(),n.addEventListener("change",o);let h=Math.round(ni(n.value).value);h>this.maxFontSize&&(h=this.maxFontSize),h<1&&(h=1),this.updateTextStyle({fontSize:h*um})};n.addEventListener("change",o)}bindTextAlignEvents(){const n=this.el.querySelector(".ddv-align-left"),o=this.el.querySelector(".ddv-align-center"),h=this.el.querySelector(".ddv-align-right"),v=this.el.querySelector(".ddv-justify-center"),y=_=>{const{toolMode:b,annotationMode:w}=this.injection.viewer.getViewerConfig(),I=this.injection.viewer.getSelectedAnnotations();1!==I.length||"textTypewriter"!==I[0].type&&"textBox"!==I[0].type?"annotation"!==b||"textBox"!==w&&"textTypewriter"!==w||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[w]:{textAlign:_}}}):this.injection.viewer.updateAnnotation(I[0].uid,{style:{textAlign:_}},["appearanceChanged"])};n.addEventListener("click",()=>{y("left")}),o.addEventListener("click",()=>{y("center")}),h.addEventListener("click",()=>{y("right")}),v.addEventListener("click",()=>{y("justify")})}bineFontStyleEvents(){const n=this.el.querySelector(".ddv-bold"),o=this.el.querySelector(".ddv-italic"),h=this.el.querySelector(".ddv-underline"),v=this.el.querySelector(".ddv-line-through");n.addEventListener("click",()=>{this.updateTextStyle({fontWeight:n.classList.contains("ddv-button-activated-light")?"normal":"bold"})}),o.addEventListener("click",()=>{this.updateTextStyle({fontStyle:o.classList.contains("ddv-button-activated-light")?"normal":"italic"})}),h.addEventListener("click",()=>{this.updateTextStyle({underline:!h.classList.contains("ddv-button-activated-light")})}),v.addEventListener("click",()=>{this.updateTextStyle({lineThrough:!v.classList.contains("ddv-button-activated-light")})})}bindViewerHooks(){const{viewer:n}=this.injection;n.hooks.selectedAnnotationsChanged.on(o=>{if(1!==o.newAnnotationUids.length)return;const h=n.getSelectedAnnotations()[0];if("textTypewriter"!==h.type&&"textBox"!==h.type)return;this.showTextAlignList("textBox"===h.type),this.selectTextAlign(h.style.textAlign||"left");const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),{textContent:y}=v[h.type],_=h.style.textContents.length?h.style.textContents[0]:y,{fontFamily:b,fontSize:w,fontWeight:I,fontStyle:A,underline:M,lineThrough:F}=_;this.selectFontStyle(b,Math.round(ni(w).value/um),"bold"===I,"italic"===A,M,F)},this),n.hooks.annotationDefaultStyleChanged.on(o=>{const{toolMode:h,annotationMode:v}=this.injection.viewer.getViewerConfig(),y=this.injection.viewer.getSelectedAnnotations();let _,b,w=!1;if("annotation"!==h||"textBox"!==v&&"textTypewriter"!==v||(w=!0,_=v),1===y.length){const Z=this.injection.viewer.getAnnotationObject(y[0].uid);Z instanceof sr&&(_=y[0].type,b=y[0].style.textAlign,Z.isEditMode&&!Z.hasSelectedChars?w=!0:Z.isEditMode||Z.style.textContents.length?(this.selectTextAlign(b),w=!1):w=!0)}if(!w)return;const{textAlign:I}=o[_],{fontFamily:A,fontSize:M,fontWeight:F,fontStyle:V,underline:B,lineThrough:Q}=o[_].textContent||{},{textContent:J}=Ki;this.selectTextAlign(b||I||Ki.textAlign),this.selectFontStyle(A||J.fontFamily,Math.round(ni(M||J.fontSize).value/um),"bold"===(F||J.fontWeight),"italic"===(V||J.fontStyle),B||J.underline,Q||J.lineThrough)},this),n.hooks.annotationTextCharsSelected.on(o=>{const h=o.freeTextContentStyle,{fontFamily:v,fontSize:y,fontStyle:_,fontWeight:b,underline:w,lineThrough:I}=h;this.selectFontStyle(v,Math.round(ni(y).value/um),"bold"===b,"italic"===_,w,I)},this),n.hooks.annotationsUpdated.on(o=>{const{actions:h,uids:v}=o,y=this.injection.viewer.getSelectedAnnotations();if(h.includes("appearanceChanged")&&1===y.length&&v.includes(y[0].uid)&&("textTypewriter"===y[0].type||"textBox"===y[0].type)&&(this.selectTextAlign(y[0].style.textAlign||"left"),!this.injection.viewer.getAnnotationObject(y[0].uid).isEditMode&&y[0].style.textContents.length)){const{fontFamily:_,fontSize:b,fontWeight:w,fontStyle:I,underline:A,lineThrough:M}=y[0].style.textContents[0];this.selectFontStyle(_,Math.round(ni(b).value/um),"bold"===w,"italic"===I,A,M)}},this),n.hooks.annotationModeChanged.on(o=>{if(!n.getSelectedAnnotations().length&&["textBox","textTypewriter"].includes(o.newAnnotationMode)){this.showTextAlignList("textBox"===o.newAnnotationMode);const{defaultStyleConfig:h}=this.injection.viewer.getAnnotationConfig(),{textContent:v,textAlign:y}=h[o.newAnnotationMode],{fontFamily:_,fontSize:b,fontWeight:w,fontStyle:I,underline:A,lineThrough:M}=v;this.selectTextAlign(y),this.selectFontStyle(_,Math.round(ni(b).value/um),"bold"===w,"italic"===I,A,M)}},this),n.hooks.toolModeChanged.on(o=>{if("annotation"!==o.newToolMode)return;const{annotationMode:h}=n.getViewerConfig();["textBox","textTypewriter"].includes(h)&&this.showTextAlignList("textBox"===h)},this)}toggleSelect(n,o){const v="fontFamily"===n?this.fontFamilyEl:this.fontSizeEl,y=v.querySelector("."+("fontFamily"===n?"ddv-palette-font-family-select":"ddv-palette-font-size-select")),_=v.querySelector(".ddv-down-arrow"),b="none"!==y.style.display,w=gt(o)?!b:o,I=this.injection.viewer.context.viewService.mainContainer;b!==w&&(w?(y.style.display="block",y.style.top=`${uL(y,I)}px`,_.style.transform="rotate(180deg)","fontSize"===n&&this.scrollFontSizeSelect()):(y.style.display="none",_.style.transform=""))}getFontFamilySelectTemplate(){let n="";for(let o=0;o<hL.length;o++){const h=hL[o];n+=`<button style="font-family:${h}" value="${h}">${h}</button>`}return`<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${n}</div></div>`}getFontSizeTemplate(){let n="";for(let o=1;o<=12;o++)n+=`<button value="${o}">${o}pt</button>`;for(let o=14;o<=36;o+=2)n+=`<button value="${o}">${o}pt</button>`;for(let o=40;o<=72;o+=4)n+=`<button value="${o}">${o}pt</button>`;if(this.maxFontSize>72){let o=72;for(;o+8<this.maxFontSize;)o+=8,n+=`<button value="${o}">${o}pt</button>`;n+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`}return`<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${n}</div></div>`}selectTextAlign(n){const o=this.el.querySelector(".ddv-align-left"),h=this.el.querySelector(".ddv-align-center"),v=this.el.querySelector(".ddv-align-right"),y=this.el.querySelector(".ddv-justify-center");ed(o,"left"===n,"light"),ed(h,"center"===n,"light"),ed(v,"right"===n,"light"),ed(y,"justify"===n,"light")}selectFontStyle(n,o,h,v,y,_){const b=this.fontFamilyEl.getElementsByTagName("span")[0],w=this.fontSizeEl.getElementsByTagName("input")[0],I=this.el.querySelector(".ddv-bold"),A=this.el.querySelector(".ddv-italic"),M=this.el.querySelector(".ddv-underline"),F=this.el.querySelector(".ddv-line-through");b.innerText=n,this.isArrowKeyPressed||("number"===w.type&&(w.type="text"),this.currentFontSizeValue=o,w.value=`${o}pt`),ed(I,h,"light"),ed(A,v,"light"),ed(M,y,"light"),ed(F,_,"light")}focusTexture(){const n=this.injection.viewer.getSelectedAnnotations();if(1===n.length){const o=this.injection.viewer.getAnnotationObject(n[0].uid);o instanceof sr&&o.isEditMode&&o.focusTexture()}}addFont(n){if(this.fontList.includes(n))return;this.fontList.push(n);const o=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),h=document.createElement("button");h.style.fontFamily=n,h.value=n,h.innerText=n,o.appendChild(h)}showTextAlignList(n){const o=this.el.querySelector(".ddv-text-align-list");o&&(o.style.display=n?"":"none")}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const n=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:o}=this;let h=0;for(let v=0;v<n.children.length;v++){const y=n.children[v];if(!(o>=y.value))break;h=y.offsetTop}n.scrollTo(0,h)}initTemplate(){const n=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=n}}const cte=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],k6e=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],ute={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},M6e={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class O6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-line-panel"),W(this,"commonClass","ddv-palette-line-panel-common"),W(this,"LineStyleClass","ddv-palette-border-style"),W(this,"lineStyleClassSmall","ddv-palette-border-style-small"),W(this,"startLineEndingClass","ddv-palette-line-start"),W(this,"endLineEndingClass","ddv-palette-line-end"),W(this,"selectionClass","ddv-palette-line-panel-selection"),W(this,"startLineEndingSelect",void 0),W(this,"borderStyleSelect",void 0),W(this,"endLineEndingSelect",void 0),W(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",o=>{"lineEndingStart"!==o&&this.toggleSelect(0,!1),"borderStyle"!==o&&this.toggleSelect(1,!1),"lineEndingEnd"!==o&&this.toggleSelect(2,!1)}),this.$on("ui_changePalette_type",o=>{this.el.style.display="stroke"===o?"":"none",this.isStrokePalette="stroke"===o;const{toolMode:h,annotationMode:v}=this.injection.viewer.getViewerConfig(),y=this.injection.viewer.getSelectedAnnotations();("annotation"===h&&"ink"===v||1===y.length&&"ink"===y[0].type)&&(this.el.style.display="none")})}bindHooks(){this.hooks.inserted.on(()=>{const n=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=n[0],this.borderStyleSelect=n[1],this.endLineEndingSelect=n[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent()})}bindSelectEvent(){const n=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),o=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),h=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),v=(y,_)=>{const b=_.target,w="BUTTON"===b.tagName?b:b.parentNode;return Array.from(y.childNodes).indexOf(w)||0};n.addEventListener("click",y=>{const _=v(n,y),b=cte[_]||"None";this.updateLineEndingByData(!0,b),this.updateDefaultLineEnding(!0,b)}),o.addEventListener("click",y=>{const _=v(o,y),b=k6e[_]||[0,0];this.updateLineDashByData(b),this.updateDefaultLineDash(b)}),h.addEventListener("click",y=>{const _=v(h,y),b=cte[_]||"None";this.updateLineEndingByData(!1,b),this.updateDefaultLineEnding(!1,b)})}bindToggleEvent(){this.startLineEndingSelect.addEventListener("click",n=>{n.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0)}),this.borderStyleSelect.addEventListener("click",n=>{n.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1)}),this.endLineEndingSelect.addEventListener("click",n=>{n.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2)})}bindViewerHooks(){const n=this.injection.viewer,o=(h,v,y,_)=>{if(this.startLineEndingSelect.style.display=h?"":"none",this.endLineEndingSelect.style.display=h?"":"none",this.borderStyleSelect.classList.remove(h?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(h?this.lineStyleClassSmall:this.LineStyleClass),h){const[b,w]=y;this.updateLineEndingSelect(!0,ute[b]||"ddv-solid"),this.updateLineEndingSelect(!1,ute[w]||"ddv-solid")}this.el.style.display=_||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(v||[0,0])};n.hooks.selectedAnnotationsChanged.on(h=>{var v,y;if(1!==h.newAnnotationUids.length)return;const _=n.getSelectedAnnotations()[0];_&&o("line"===_.type||"polyline"===_.type,null===(v=_.style)||void 0===v?void 0:v.lineDash,null===(y=_.style)||void 0===y?void 0:y.lineEnding,"ink"===_.type||"stamp"===_.type)},this),n.hooks.annotationModeChanged.on(h=>{const v=h.newAnnotationMode,y="polyline"===v||"line"===v,_="ink"===v;if("select"!==v&&"erase"!==v&&"stamp"!==v){var b,w;const{defaultStyleConfig:I}=this.injection.viewer.getAnnotationConfig(),A=(null===(b=I[v])||void 0===b?void 0:b.lineEnding)||(null==Ki?void 0:Ki.lineEnding),M=(null===(w=I[v])||void 0===w?void 0:w.lineDash)||(null==Ki?void 0:Ki.lineDash);o(y,M,A,_)}},this),n.hooks.annotationDefaultStyleChanged.on(h=>{var v;const{toolMode:y,annotationMode:_}=this.injection.viewer.getViewerConfig();if("annotation"!==y||"select"===_||"erase"===_||"stamp"===_||n.getSelectedAnnotations().length)return;const{defaultStyleConfig:b}=this.injection.viewer.getAnnotationConfig(),A=(null===(v=b[_])||void 0===v?void 0:v.lineEnding)||Ki.lineEnding;o("line"===_||"polyline"===_,b[_].lineDash||Ki.lineDash,A,"ink"===_)},this),n.hooks.annotationsUpdated.on(h=>{const{actions:v,uids:y}=h,_=n.getSelectedAnnotations();v.includes("appearanceChanged")&&1===_.length&&y.includes(_[0].uid)&&"ink"!==_[0].type&&"stamp"!==_[0].type&&o("line"===_[0].type||"polyline"===_[0].type,_[0].style.lineDash||[0,0],_[0].style.lineEnding||["None","None"],!1)},this)}toggleSelect(n,o){let h=this.borderStyleSelect;0===n?h=this.startLineEndingSelect:2===n&&(h=this.endLineEndingSelect);const v=h.querySelector(`.${this.selectionClass}`),y=h.querySelector(".ddv-down-arrow"),_="none"!==v.style.display,b=gt(o)?!_:o,w=this.injection.viewer.context.viewService.mainContainer;_!==b&&(b?(v.style.display="block",v.style.top=`${uL(v,w)}px`,y.style.transform="rotate(180deg)"):(v.style.display="none",y.style.transform=""))}updateLineEndingSelect(n,o){(n?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${o}`}updateBorderStyleSelect(n){const o=this.borderStyleSelect,h=n.join("")||"0",v=o.querySelector("div");let y="ddv-solid";(function(_){if(0===_.length)return!0;if(1===_.length)return 0===_[0];_.length%2!=0&&(_=_.concat(_));for(let b=1;b<_.length;b+=2)if(0!==_[b])return!1;return!0})(n)||(y=M6e[h]||"ddv-dashed-33"),v.className=`ddv-button ${y}`}updateLineDashByData(n){const o=this.injection.viewer.getSelectedAnnotations();1===o.length&&(o[0].style.lineDash||[0,0]).toString()!==n.toString()&&this.injection.viewer.updateAnnotation(o[0].uid,{style:{lineDash:n}},["appearanceChanged"])}updateLineEndingByData(n,o){const h=this.injection.viewer.getSelectedAnnotations();if(1!==h.length)return;const v=h[0].style.lineEnding||["None","None"];n&&o===v[0]||!n&&o===v[1]||this.injection.viewer.updateAnnotation(h[0].uid,{style:{lineEnding:n?[o,v[1]]:[v[0],o]}},["appearanceChanged"])}updateDefaultLineEnding(n,o){var h;const{annotationMode:v}=this.injection.viewer.getViewerConfig(),y=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:_}=this.injection.viewer.getAnnotationConfig();let b=(null===(h=_[v])||void 0===h?void 0:h.lineEnding)||Ki.lineEnding,w=v;y.length&&y[0]&&(b=y[0].style.lineEnding,w=y[0].type);const I=[...b];n?I[0]=o:I[1]=o,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[w]:{lineEnding:I}}})}updateDefaultLineDash(n){const{annotationMode:o}=this.injection.viewer.getViewerConfig(),h=this.injection.viewer.getSelectedAnnotations();let v=o;h.length&&h[0]&&(v=h[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[v]:{lineDash:n}}})}getBaseLineDashTemplate(){const n=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let o="";for(let h=0;h<n.length;h++)o+=`<button><i class="ddv-button ${n[h]}"></i></button>`;return`<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${o}</div></div>`}getLineEndingTemplate(n){const o=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let h="";for(let y=0;y<o.length;y++)h+=`<button><i class="ddv-button ${o[y]}"></i></button>`;return`<div class="${this.commonClass} ${n?this.startLineEndingClass:this.endLineEndingClass}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${h}</div></div>`}initTemplate(){const{label:n}=this.data,o=`<div class="${this.defaultClass}"><span>${n}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=o}}class F6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-opacity-panel"),W(this,"isPointerDown",!1),W(this,"lastPointerValue",void 0),W(this,"range",void 0),W(this,"input",void 0),W(this,"inputIsBlur",!0),W(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),Uee(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:n}=this;n.addEventListener("keydown",h=>{h.stopPropagation(),"ArrowUp"!==h.key&&"ArrowDown"!==h.key||(this.isArrowKeyPressed=!0)}),n.addEventListener("keyup",h=>{if(h.stopPropagation(),this.isArrowKeyPressed){const v=Nv(n.value).value;v>100&&(n.value=100),v<0&&(n.value=0);let y=parseInt(n.value,10);$t(y)||(y=100,this.updateInput(100)),this.updateDefaultOpacity(y),this.updateOpacityByData(y),this.isArrowKeyPressed=!1}}),n.addEventListener("focus",()=>{const v=Nv(n.value).value;n.value=v,n.type="number",this.inputIsBlur=!1}),n.addEventListener("blur",h=>{this.inputIsBlur=!0,h.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==n.type&&(n.type="text",n.value+="%")});const o=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;n.type="text",n.value+="%",n.removeEventListener("change",o),n.blur(),n.addEventListener("change",o);const h=Nv(n.value).value;h>100&&(n.value=100),h<0&&(n.value=0);let v=parseInt(n.value,10);$t(v)||(v=100,this.updateInput(100)),this.updateDefaultOpacity(v),this.updateOpacityByData(v)};n.addEventListener("change",o)}bindRangeEvent(){const{range:n}=this,o=()=>{const h=parseInt(n.value,10);this.updateOpacityByShape(h),this.input.value=`${h}%`;const{toolMode:v,annotationMode:y}=this.injection.viewer.getViewerConfig();"annotation"===v&&"select"!==y&&"erase"!==y&&this.updateInput(h)};n.addEventListener("click",()=>{const h=parseInt(n.value,10);h!==this.lastPointerValue&&(this.updateOpacityByData(h),this.updateDefaultOpacity(h))}),n.addEventListener("pointerdown",h=>{h.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),o()}),n.addEventListener("pointermove",()=>{this.isPointerDown&&o()}),n.addEventListener("pointerup",()=>{if(this.isPointerDown){const h=parseInt(n.value,10);this.lastPointerValue=h,this.updateOpacityByData(h),this.updateDefaultOpacity(h)}this.isPointerDown=!1}),n.addEventListener("keydown",h=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)&&o()}),n.addEventListener("keyup",h=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)){const v=parseInt(n.value,10);this.updateOpacityByData(v),this.updateDefaultOpacity(v)}})}bindViewerHooks(){const n=this.injection.viewer,o=()=>{const{annotationMode:h}=this.injection.viewer.getViewerConfig();if("select"===h||"erase"===h)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),y=$t(v[h].opacity)?v[h].opacity:Ki.opacity;this.updateInput(Math.round(100*y))};n.hooks.selectedAnnotationsChanged.on(h=>{if(1!==h.newAnnotationUids.length)return;const v=n.getSelectedAnnotations()[0];v&&this.updateInput(Math.round(100*v.style.opacity))},this),n.hooks.annotationsUpdated.on(h=>{const{actions:v,uids:y}=h,_=n.getSelectedAnnotations();v.includes("appearanceChanged")&&1===_.length&&y.includes(_[0].uid)&&this.updateInput(Math.round(100*_[0].style.opacity))},this),n.hooks.annotationModeChanged.on(h=>{o()},this),n.hooks.toolModeChanged.on(h=>{"annotation"===h.newToolMode&&o()},this),n.hooks.annotationDefaultStyleChanged.on(h=>{const{toolMode:v,annotationMode:y}=this.injection.viewer.getViewerConfig();if("annotation"!==v||"select"===y||"erase"===y||n.getSelectedAnnotations().length)return;const{defaultStyleConfig:_}=this.injection.viewer.getAnnotationConfig(),b=$t(_[y].opacity)?_[y].opacity:Ki.opacity;this.updateInput(100*b)},this)}updateInput(n){let o=n;n>100&&(o=100),n<0&&(o=0),o=Math.round(o),this.range.value=`${o}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?o:`${o}%`}updateOpacityByShape(n){const o=this.injection.viewer.getSelectedAnnotations();if(1!==o.length)return;const h=this.injection.viewer.getAnnotationObject(o[0].uid);if(!h)return;const v=100*h.style.opacity;(n=Math.round(n))!==v&&(h.style.opacity=n/100,this.injection.viewer.context.render())}updateOpacityByData(n){const o=this.injection.viewer.getSelectedAnnotations();if(1!==o.length)return;const h=100*o[0].style.opacity;(n=Math.round(n))!==h&&this.injection.viewer.updateAnnotation(o[0].uid,{style:{opacity:n/100}},["appearanceChanged"])}updateDefaultOpacity(n){const{annotationMode:o}=this.injection.viewer.getViewerConfig(),h=this.injection.viewer.getSelectedAnnotations();let v=o;h.length&&h[0]&&(v=h[0].type),n=Math.round(n),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[v]:{opacity:n/100}}})}focusTexture(){const n=this.injection.viewer.getSelectedAnnotations();if(1===n.length){const o=this.injection.viewer.getAnnotationObject(n[0].uid);o instanceof sr&&o.isEditMode&&o.focusTexture()}}initTemplate(){const{label:n}=this.data;this.template=`<div class="${this.defaultClass}"><span>${n}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`}}const dte=[Pi.DRAFT,Pi.FINAL,Pi.VOID,Pi.REJECTED,Pi.ACCEPTED,Pi.APPROVED,Pi.NOT_APPROVED,Pi.COMPLETED,Pi.CONFIDENTIAL,Pi.INITIAL_HERE,Pi.SIGN_HERE,Pi.WITNESS];class L6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-stamp-panel"),W(this,"select",void 0),W(this,"selectBox",void 0),W(this,"iconName",Pi.DRAFT),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",o=>{"stampIcon"!==o&&this.toggleSelect(!1)})}bindHooks(){this.hooks.inserted.on(()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.bindToggleEvent(),this.bindSelectEvent()})}bindToggleEvent(){this.select.addEventListener("click",n=>{n.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect()})}bindSelectEvent(){this.selectBox.addEventListener("click",n=>{this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:n.target.value}}})})}bindViewerHooks(){const n=this.injection.viewer,o=()=>{var h;const{toolMode:v,annotationMode:y}=n.getViewerConfig(),_=n.getAnnotationConfig();this.el.style.display="annotation"!==v||"stamp"!==y||null!==(h=_.defaultStyleConfig)&&void 0!==h&&null!==(h=h.stamp)&&void 0!==h&&h.imageData?"none":""};this.hooks.inserted.on(()=>{o();const{defaultStyleConfig:h}=n.getAnnotationConfig(),{stamp:v}=h;this.updateStampSpan((null==v?void 0:v.stampIcon)||(null==Ki?void 0:Ki.stampIcon))}),n.hooks.annotationDefaultStyleChanged.on(h=>{o();const{stamp:v}=h,y=(null==v?void 0:v.stampIcon)||(null==Ki?void 0:Ki.stampIcon);y!==this.iconName&&this.updateStampSpan(y)},this),n.hooks.toolModeChanged.on(o,this),n.hooks.annotationModeChanged.on(o,this)}toggleSelect(n){const o=this.select.querySelector(".ddv-down-arrow"),h="none"!==this.selectBox.style.display,v=gt(n)?!h:n,y=this.injection.viewer.context.viewService.mainContainer;h!==v&&(v?(this.selectBox.style.display="block",this.selectBox.style.top=`${uL(this.selectBox,y)}px`,o.style.transform="rotate(180deg)"):(this.selectBox.style.display="none",o.style.transform=""))}updateStampSpan(n){this.el.getElementsByTagName("span")[1].innerText=n.slice(2),this.iconName=n}getStampIconSelectTemplate(){let n="";for(let o=0;o<dte.length;o++){const h=dte[o];n+=`<button value="${h}">${h.slice(2)}</button>`}return`<div class="ddv-palette-stamp-icon"><span>${Pi.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${n}</div></div>`}initTemplate(){const{label:n}=this.data,o=`<div class="${this.defaultClass}"><span>${n}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=o}}const n0=jn.displayResolution/jn.dataResolution;class N6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-stroke-panel"),W(this,"isPointerDown",!1),W(this,"lastPointerValue",void 0),W(this,"range",void 0),W(this,"input",void 0),W(this,"inputIsBlur",!0),W(this,"isArrowKeyPressed",!1),W(this,"maxBorderWidth",20),this.maxBorderWidth=n.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",o=>{this.el.style.display="stroke"===o?"":"none"})}bindHooks(){this.hooks.inserted.on(()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),Uee(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent()})}bineInputEvent(){const{input:n}=this;n.addEventListener("keydown",h=>{h.stopPropagation(),"ArrowUp"!==h.key&&"ArrowDown"!==h.key||(this.isArrowKeyPressed=!0)}),n.addEventListener("keyup",h=>{if(h.stopPropagation(),this.isArrowKeyPressed){const v=ni(n.value).value;v>this.maxBorderWidth&&(n.value=this.maxBorderWidth),v<0&&(n.value=0);let y=parseInt(n.value,10);$t(y)||(y=1,this.updateInput(1*n0)),this.updateDefaultBorderWidth(y),this.updateBorderWidthByData(y),this.isArrowKeyPressed=!1}}),n.addEventListener("focus",()=>{const v=parseFloat(n.value);n.value=v,n.type="number",this.inputIsBlur=!1}),n.addEventListener("blur",h=>{this.inputIsBlur=!0,h.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==n.type&&(n.type="text",n.value+="pt")});const o=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;n.type="text",n.value+="pt",n.removeEventListener("change",o),n.blur(),n.addEventListener("change",o);const h=ni(n.value).value;h>this.maxBorderWidth&&(n.value=this.maxBorderWidth),h<0&&(n.value=0);let v=parseInt(n.value,10);$t(v)||(v=1,this.updateInput(1*n0)),this.updateDefaultBorderWidth(v),this.updateBorderWidthByData(v)};n.addEventListener("change",o)}bindRangeEvent(){const{range:n}=this,o=()=>{const h=ni(n.value).value;this.updateBorderWidthByShape(h),this.input.value=`${h}pt`;const{toolMode:v,annotationMode:y}=this.injection.viewer.getViewerConfig();"annotation"===v&&"select"!==y&&"erase"!==y&&this.updateInput(h*n0)};n.addEventListener("click",()=>{const h=ni(n.value).value;h!==this.lastPointerValue&&(this.updateBorderWidthByData(h),this.updateDefaultBorderWidth(h))}),n.addEventListener("pointerdown",h=>{h.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),o()}),n.addEventListener("pointermove",()=>{this.isPointerDown&&o()}),n.addEventListener("pointerup",()=>{if(this.isPointerDown){const h=ni(n.value).value;this.lastPointerValue=h,this.updateBorderWidthByData(h),this.updateDefaultBorderWidth(h)}this.isPointerDown=!1}),n.addEventListener("keydown",h=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)&&o()}),n.addEventListener("keyup",h=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)){const v=ni(n.value).value;this.updateBorderWidthByData(v),this.updateDefaultBorderWidth(v)}})}bindViewerHooks(){const n=this.injection.viewer,o=()=>{const{annotationMode:h}=this.injection.viewer.getViewerConfig();if("select"===h||"erase"===h)return;const{defaultStyleConfig:v}=this.injection.viewer.getAnnotationConfig(),y=$t(v[h].borderWidth)?v[h].borderWidth:Ki.borderWidth;this.updateInput(y)};n.hooks.selectedAnnotationsChanged.on(h=>{if(1!==h.newAnnotationUids.length)return;const v=n.getSelectedAnnotations()[0];v&&this.updateInput(ni(v.style.borderWidth).value,!0)},this),n.hooks.annotationsUpdated.on(h=>{const{actions:v,uids:y}=h,_=n.getSelectedAnnotations();v.includes("appearanceChanged")&&1===_.length&&y.includes(_[0].uid)&&this.updateInput(ni(_[0].style.borderWidth).value)},this),n.hooks.annotationModeChanged.on(h=>{o()},this),n.hooks.toolModeChanged.on(h=>{"annotation"===h.newToolMode&&o()},this),n.hooks.annotationDefaultStyleChanged.on(h=>{const{toolMode:v,annotationMode:y}=this.injection.viewer.getViewerConfig();if("annotation"!==v||"select"===y||"erase"===y||"stamp"===y||n.getSelectedAnnotations().length)return;const{defaultStyleConfig:_}=this.injection.viewer.getAnnotationConfig(),b=$t(_[y].borderWidth)?_[y].borderWidth:Ki.borderWidth;this.updateInput(b)},this)}updateInput(n,o){let h=n/n0;this.isPointerDown||o?h=Math.round(h):(h=h.toFixed(1),h.endsWith(".0")&&(h=parseInt(h,10))),this.range.value=h,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(h):`${h}pt`}updateBorderWidthByShape(n){const o=this.injection.viewer.getSelectedAnnotations();if(1!==o.length)return;const h=this.injection.viewer.getAnnotationObject(o[0].uid);if(!h)return;const v=n*n0,{borderWidth:y}=h.style;y!==v&&(h.style.borderWidth=v,this.injection.viewer.context.render())}updateBorderWidthByData(n){const o=this.injection.viewer.getSelectedAnnotations();if(1!==o.length)return;const h=n*n0,{borderWidth:v}=o[0].style;v!==h&&this.injection.viewer.updateAnnotation(o[0].uid,{style:{borderWidth:h}},["appearanceChanged"])}updateDefaultBorderWidth(n){const{annotationMode:o}=this.injection.viewer.getViewerConfig(),h=this.injection.viewer.getSelectedAnnotations();let v=o;h.length&&h[0]&&(v=h[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[v]:{borderWidth:n*n0}}})}focusTexture(){const n=this.injection.viewer.getSelectedAnnotations();if(1===n.length){const o=this.injection.viewer.getAnnotationObject(n[0].uid);o instanceof sr&&o.isEditMode&&o.focusTexture()}}initTemplate(){const{label:n}=this.data;this.template=`<div class="${this.defaultClass}"><span>${n}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`}}class hte extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-palette-box"),W(this,"header",void 0),W(this,"fillSpan",void 0),W(this,"textSpan",void 0),W(this,"strokeSpan",void 0),W(this,"thumbnail",void 0),fc.registerComponent({ColorPanel:P6e,FontPanel:R6e,LinePanel:O6e,StampPanel:L6e,OpacityPanel:F6e,StrokePanel:N6e}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",o=>{this.togglePopup(o)})}bindHooks(){const n=o=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const h=this.header.getElementsByTagName("span");this.textSpan=h[0],this.strokeSpan=h[1],this.fillSpan=h[2],this.bindEvents(),this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:v}=this.data.options;this.el.dataset.enableDrag=`${v}`,function(y){let _,b,w=!1;function I(M){if(!w)return;const V=M.clientY-b;y.style.left=`${y.offsetLeft+(M.clientX-_)}px`,y.style.top=`${y.offsetTop+V}px`,_=M.clientX,b=M.clientY}function A(){w=!1,document.removeEventListener("pointermove",I),document.removeEventListener("pointerup",A)}y.addEventListener("pointerdown",function(M){const F=M.target;F.classList.contains("ddv-button")||"false"===y.dataset.enableDrag||F instanceof HTMLInputElement||F instanceof HTMLButtonElement||(w=!0,_=M.clientX,b=M.clientY,document.addEventListener("pointermove",I),document.addEventListener("pointerup",A))})}(this.el)};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindEvents(){this.el.addEventListener("click",n=>{n.stopPropagation(),this.$emit("ui_shrinkSelectionBox",n)}),this.el.addEventListener("pointerup",n=>{n.target instanceof HTMLInputElement&&!(n.target instanceof HTMLInputElement&&"range"===n.target.type)||this.focusTexture()}),this.textSpan.addEventListener("click",n=>{this.setPaletteType("text")}),this.fillSpan.addEventListener("click",n=>{this.setPaletteType("fill")}),this.strokeSpan.addEventListener("click",n=>{this.setPaletteType("stroke")})}bindViewerHooks(){const n=this.injection.viewer,o=()=>{const{toolMode:v,annotationMode:y}=n.getViewerConfig(),_=n.getSelectedAnnotations();return!n.getPageCounts()||"annotation"!==v&&!_.length||"annotation"===v&&("select"===y||"erase"===y)},h=v=>{"stamp"===v?this.setPaletteType("stamp"):"text"===v?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"))};this.hooks.inserted.on(()=>{o()&&this.togglePopup(!1)}),n.hooks.beforeAnnotationEdit.on(()=>{this.togglePopup(!1)},this),n.hooks.beforeAnnotationDraw.on(()=>{this.togglePopup(!1)},this),n.hooks.pageChanged.on(v=>{v.total||this.togglePopup(!1);const y=n.getActiveTab();!y||"single"!==y.context.displayMode||1===n.getSelectedAnnotations().length&&this.togglePopup(!1)},this),n.hooks.toolModeChanged.on(v=>{if(o())return void this.togglePopup(!1);const{annotationMode:y}=n.getViewerConfig();if("annotation"===v.newToolMode&&"select"!==y&&"erase"!==y&&!rr()){const _=["textBox","textTypewriter"].includes(y);h("stamp"===y?"stamp":_?"text":"common"),this.togglePopup(!0)}},this),n.hooks.selectedAnnotationsChanged.on(v=>{o()&&this.togglePopup(!1);const y=n.getSelectedAnnotations();if(1!==y.length)return;const _=y[0],b=["textBox","textTypewriter"].includes(_.type),w="stamp"===_.type?"stamp":b?"text":"common";h(w),("text"===w&&"textTypewriter"===_.type||"ink"===_.type)&&(this.header.style.display="none")},this),n.hooks.annotationModeChanged.on(v=>{if(n.getSelectedAnnotations().length)return;const y=v.newAnnotationMode;if(["erase","select"].includes(y))return void this.togglePopup(!1);const _=["textBox","textTypewriter"].includes(y),b="stamp"===y?"stamp":_?"text":"common";h(b),("text"===b&&"textTypewriter"===y||"ink"===y)&&(this.header.style.display="none");const{toolMode:w}=this.injection.viewer.getViewerConfig(),I=this.injection.viewer.getPageCounts();rr()&&"stamp"!==b?this.togglePopup(!1):this.togglePopup(I>0&&"annotation"===w)},this)}setPaletteType(n){const{header:o,textSpan:h,strokeSpan:v,fillSpan:y}=this;if(this.$emit("ui_changePalette_type",n),"stamp"===n)return void(o.style.display="none");const{backgroundColor:_}=getComputedStyle(this.el);o.style.display="";const b=(w,I,A)=>{w.style.background=n===I?A:"",w.style.borderBottom=n===I?"none":""};b(h,"text",_),b(v,"stroke",_),b(y,"fill",_)}togglePopup(n,o,h){const v="none"!==this.el.style.display,y=gt(n)?!v:n;if(v===y)return;const{options:_}=this.data;y?(this.el.style.display="",null!=_&&_.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),gt(o)||(this.el.style.right=`${o||0}px`),gt(h)||(this.el.style.top=`${h||0}px`),this.injection.viewer.emit("annotationPaletteToggle",y),function(b){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if("none"===b.style.display||!b.parentElement)return!1;const I=b.getBoundingClientRect(),A=b.parentElement.getBoundingClientRect(),M=I.right-w<A.left||I.left+w>A.right,F=I.bottom-w<A.top||I.top+w>A.bottom;return M||F}(this.el)&&(this.el.style.left="",this.el.style.top="")}focusTexture(){const n=this.injection.viewer.getSelectedAnnotations();if(1===n.length){const o=this.injection.viewer.getAnnotationObject(n[0].uid);o instanceof sr&&o.isEditMode&&o.focusTexture()}}initTemplate(){const{options:n}=this.data;eh(th(this),this.injection.viewer,n),null!=n&&n.labels||(n.labels={}),n.labels=Ke({text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business"},n.labels),n.style=zt(Ke({},n.style),{display:"none"});const o=`<div ${Fr(n,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${n.labels.text}</span><span>${n.labels.stroke}</span><span>${n.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel label="${n.labels.standardBusiness}"></StampPanel><OpacityPanel label="${n.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${n.labels.stroke}"></StrokePanel><LinePanel label="${n.labels.style}"></LinePanel></div>`;this.template=o}}W(hte,"cpName","AnnotationPalette");class fte extends br{constructor(n){super(n,{class:"ddv-auto-capture",callback:()=>{const{viewer:o}=this.injection,{viewerMode:h}=o.getViewerConfig(),{enableAutoCapture:v}=o.getCameraConfig();h===Ko.CAPTURE&&o.updateCameraConfig({enableAutoCapture:!v})}}),this.bindViewerHooks()}bindDefaultUi(){const n=()=>{const o=this.injection.viewer;o.isVideoPlaying()?o.getCameraConfig().enableAutoCapture?this.setUiState("focused",!rr()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){const{hooks:n}=this.injection.viewer;n.autoCaptureChanged.on(o=>{this.setUiState(o.enableAutoCapture?"focused":"normal",!rr())},this),n.cameraPlayed.on(()=>{const{enableAutoCapture:o}=this.injection.viewer.getCameraConfig();this.setUiState(o?"focused":"normal",!rr())},this),n.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}W(fte,"cpName","AutoCapture");class pte extends br{constructor(n){super(n,{class:"ddv-auto-detect",callback:()=>{const{viewer:o}=this.injection,{viewerMode:h}=o.getViewerConfig(),{enableAutoDetect:v}=o.getCameraConfig();h===Ko.CAPTURE&&o.updateCameraConfig({enableAutoDetect:!v})}}),this.bindViewerHooks()}bindDefaultUi(){const n=()=>{const o=this.injection.viewer;o.isVideoPlaying()&&o.context.core.detectorService.enableDetect?o.getCameraConfig().enableAutoDetect?this.setUiState("focused",!rr()):this.setUiState("normal"):this.setUiState("disabled")};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){const{hooks:n}=this.injection.viewer;n.autoDetectChanged.on(o=>{this.setUiState(o.enableAutoDetect?"focused":"normal",!rr())},this),n.cameraPlayed.on(()=>{const{core:o}=this.injection.viewer.context;if(!o.detectorService.enableDetect)return;const{enableAutoDetect:h}=this.injection.viewer.getCameraConfig();this.setUiState(h?"focused":"normal",!rr())},this),n.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}W(pte,"cpName","AutoDetect");class gte extends br{constructor(n){super(n,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const o=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),o.capture().finally(()=>{this.isCapturing=!1,this.setUiState("normal")})}}),W(this,"isCapturing",!1),this.bindViewerHooks()}bindDefaultUi(){const n=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled")};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){const{hooks:n}=this.injection.viewer;n.cameraPlayed.on(()=>{this.setUiState("normal")},this),n.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}W(gte,"cpName","Capture");class mte extends br{constructor(n){super(n,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:o}=this.injection;o.cameraContext.turnOnTheTorch?o.turnOffTorch():o.turnOnTorch()}}),this.bindViewerHooks()}bindDefaultUi(){const n=()=>{const{viewer:o}=this.injection;o.isVideoPlaying()&&o.cameraContext.torchSupported?this.setUiState(o.cameraContext.turnOnTheTorch?"focused":"normal"):this.setUiState("disabled")};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on(n=>{switch(n.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!rr());break;default:this.setUiState("disabled")}},this)}}W(mte,"cpName","Flashlight");class vte extends br{constructor(n){super(n,{class:"ddv-camera-convert",callback:()=>{const{viewer:o}=this.injection;o.cameraContext.convertCamera()}}),this.bindViewerHooks()}bindDefaultUi(){const n=()=>{const o=this.injection.viewer;o.isVideoPlaying()?this.setUiState(o.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled")};this.hooks.inserted.on(n),this.hooks.updated.on(n)}bindViewerHooks(){const{hooks:n}=this.injection.viewer;n.cameraPlayed.on(()=>{this.setUiState(this.injection.viewer.cameraContext.canFrontCamera?"normal":"disabled")},this),n.cameraClosed.on(()=>{this.setUiState("disabled")},this)}}W(vte,"cpName","CameraConvert");const B6e=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class yte extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-resolution"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),W(this,"resolutionOptions",[]),W(this,"isFirstClick",!0),W(this,"fakeResolution",!1),W(this,"lastCheckIndex",0),W(this,"box",void 0),this.bindHooks(),this.initTemplate(),sD(this)}bindHooks(){this.hooks.created.on(n=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),sf(this.el,!0)}),this.hooks.updated.on(()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||sf(this.el,!0)})}bindEvents(){const n=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",()=>{const o=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(cm(o,this.el,this.box),this.isFirstClick=!1)}),this.ulEvent(n)}ulEvent(n){n&&this.nativeOn(n,"click",o=>{const h=this.injection.viewer,v=o.target,y=v.parentNode;if("LI"===v.tagName||"LI"===y.tagName){const _="LI"===v.tagName?v.value:y.value;if(_===this.lastCheckIndex)return;const{width:b,height:w}=this.resolutionOptions[_].value;this.fakeResolution=!0,h.setResolution(b,w),this.updateChecked(b,w)}this.togglePopup(!1)})}bindViewerHooks(){const{viewer:n}=this.injection,{hooks:o}=n;o.cameraPlayed.on(h=>{if(sf(this.el,!1),this.fakeResolution)return;const{width:v,height:y}=h.resolution;this.updateChecked(v,y),this.fakeResolution=!1},this),o.cameraClosed.on(()=>{sf(this.el,!0)},this),o.visibleChanged.on(h=>{"hidden"===h.newVisibility&&this.togglePopup(!1)},this)}updateChecked(n,o){const h=function(w,I){let A=-1;const M=I.width*I.height;for(let F=0;F<w.length;F++){const{value:V}=w[F],B=V.width*V.height;if(0===F&&M<=B)return 0;if(F===w.length&&M>=B)return w.length-1;M>B&&(A=F+1)}return A}(this.resolutionOptions,{width:n,height:o}),{box:v,checkedClassName:y}=this,_=v.getElementsByClassName(`${this.cssPrefix}checkbox`)[h],b=v.getElementsByClassName(y)[0];_!==b&&(this.lastCheckIndex=h,null==_||_.classList.add(y),null==b||b.classList.remove(y))}initTemplate(){const{options:n}=this.data,{popupBox:o}=n;eh(th(this),this.injection.viewer,n);const h=`<div ${Fr(n,`${this.defaultClass} ddv-button`)}>`+(gt(null==n?void 0:n.label)?"":`<span>${n.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Fr(o,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=h}getOptionTemplate(){const{options:n}=this.data;let o=B6e;if(Di(null==n?void 0:n.valueList))o=n.valueList;else{const{CameraResolution_720P:v,CameraResolution_1080P:y,CameraResolution_1440P:_,CameraResolution_2160P:b}=yl.getDisplayTextConfig(),w=[v,y,_,b];o.forEach((I,A)=>{w[A]&&(I.label=w[A])})}let h="";return o.forEach((v,y)=>{const{width:_,height:b}=v.value;$t(_)&&$t(b)&&(h+=[`<li value="${y}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==v?void 0:v.label)||""}</span>`,"</li>"].join(""))}),this.resolutionOptions=o,h}updateResolution(){const n=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=n}togglePopup(n){const{box:o}=this,{viewer:h}=this.injection;let v="none"!==o.style.display;v=gt(n)?!v:n,v?(this.$emit("ui_hidePopup",this),h.rootDom.appendChild(o)):o.remove(),ed(this.el,v),o.style.display=v?"":"none"}}W(yte,"cpName","CameraResolution");class _te extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-image-preview"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"uiState",void 0),W(this,"image",void 0),W(this,"counter",void 0),W(this,"imagePageUid",void 0),W(this,"hasTask",!1),W(this,"isUpdateTask",!1),W(this,"lastPageUid",void 0),W(this,"pageTaskUids",[]),W(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(n=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter()}),this.hooks.inserted.on(n=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`)}),this.hooks.destroyed.on(()=>{clearTimeout(this.currentTimer),this.image.src&&URL.revokeObjectURL(this.image.src)})}bindViewerHooks(){var n=this;const o=this.injection.viewer,h=rr()?10:4;o.hooks.updatePage.on(function(){var v=Fe(function*(y){if(y.pageUid!==n.lastPageUid)return;if(n.hasTask)return n.pageTaskUids.push(y.pageUid),void(n.isUpdateTask=!0);n.hasTask=!0;const _=o.getPageCounts(),b=yield o.getPerspectivePreviewImage(_-1,400,400,h);b&&(n.image.src&&URL.revokeObjectURL(n.image.src),n.image.src=XE(b.data).data),n.hasTask=!1,n.pageTaskUids.length>0&&n.createTask()});return function(y){return v.apply(this,arguments)}}(),this),o.hooks.pageChanged.on(function(){var v=Fe(function*(y){if(0===y.total)return n.image.src="",n.setState("disabled"),n.imagePageUid=void 0,void(n.lastPageUid=void 0);if(null==n||!n.counter)return;n.counter.innerText=`${y.total}`;const _=o.getActiveTab();if(!_)return;const b=_.pages[y.total-1].uid;n.pageTaskUids.push(b),n.hasTask||b!==n.lastPageUid&&n.createTask()});return function(y){return v.apply(this,arguments)}}(),this)}createTask(){var n=this;return Fe(function*(){n.hasTask||(n.hasTask=!0,yield n.updateImage(),n.currentTimer=setTimeout(()=>{n.hasTask=!1,0!==n.pageTaskUids.length&&n.createTask()},300))})()}updateImage(){var n=this;return Fe(function*(){const o=n.injection.viewer;if(!o||!o.context)return;const h=o.getActiveTab(),v=rr()?10:4;if(!h)return;const y=h.pages.length;if(!y)return;const _=n.pageTaskUids[n.pageTaskUids.length-1],b=h.pages[y-1].uid;if(n.pageTaskUids.length=0,n.lastPageUid=h.pages[y-1].uid,n.lastPageUid===_&&n.imagePageUid===_&&!n.isUpdateTask)return;let w;n.isUpdateTask&&(n.isUpdateTask=!1);try{w=yield o.getPerspectivePreviewImage(y-1,400,400,v)}catch(I){}w&&!o.isDestroy&&o.getActiveTab()&&(n.image.src&&URL.revokeObjectURL(n.image.src),n.image.src=XE(w.data).data,n.imagePageUid=b,n.setState(y>0?"normal":"disabled"))})()}setState(n){this.uiState!==n&&this.el&&("normal"===n?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=n)}initTemplate(){const{options:n}=this.data,{imageCounter:o}=n,h=this.injection.viewer.getPageCounts();eh(th(this),this.injection.viewer,n);const v=`<div ${Fr(n,this.defaultClass)}> <img src=""></img><div ${Fr(o,this.cssPrefix,"counter")}>${h}</div></div>`;this.template=v}}W(_te,"cpName","ImagePreview");class Cte extends br{constructor(n){super(n,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click()}}),W(this,"fileLoader",void 0),this.$on("ui_cropClick",o=>{const{viewer:h}=this.injection;0!==(h.getPageCounts()||0)&&this.setUiState(o?"disabled":"normal")})}createFileInput(){const n=document.createElement("input");return n.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",n.type="file",n.multiple=!0,n.addEventListener("change",o=>{const{files:h}=n,v=h.length,y=[];for(let _=0;_<v;_++){const b=new Blob([h[_]],{type:h[_].type});if("application/pdf"===h[_].type){const w=xi.annotationLicenseModuleIsExist();y.push({fileData:b,convertMode:ml.CM_AUTO,renderOptions:{renderAnnotations:w?Jh.LOAD_ANNOTATIONS:Jh.NO_ANNOTATIONS}})}else y.push({fileData:b})}this.injection.viewer.context.loadSource(y),n.value=null,n.files=null},!0),n}bindHooks(){super.bindHooks(),this.hooks.inserted.on(()=>{const n=this.createFileInput();n.style.display="none",this.el.appendChild(n),this.fileLoader=n,this.fileLoader.addEventListener("click",o=>{o.stopPropagation()})})}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on(n=>{null!=n&&n.pageCount||this.setUiState("normal")},this)}}W(Cte,"cpName","Load");class bte extends br{constructor(n){super(n,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages()}}),pc(this)}}W(bte,"cpName","DeleteAll");class xte extends br{constructor(n){super(n,{class:"ddv-delete-current",callback:()=>{const o=this.injection.viewer,h=o.getCurrentPageIndex();o.deletePages([h])}}),pc(this)}}function fL(p){try{p.dispatchEvent(new MouseEvent("click"))}catch(n){const o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(o)}}function wte(p,n,o){if("download"in HTMLAnchorElement.prototype){const h=document.createElementNS("http://www.w3.org/1999/xhtml","a");h.download=n=n||p.name||"download",h.rel="noopener","string"==typeof p?(h.href=p,h.origin!==location.origin?function(v){const y=new XMLHttpRequest;y.open("HEAD",v,!1);try{y.send()}catch(_){}return y.status>=200&&y.status<=299}(h.href)?function(v,y){const _=new XMLHttpRequest;_.open("GET",v),_.responseType="blob",_.onload=function(){wte(_.response,y)},_.onerror=function(){},_.send()}(p,n):fL(h,h.target="_blank"):fL(h)):(h.href=URL.createObjectURL(p),setTimeout(()=>{URL.revokeObjectURL(h.href)},4e4),setTimeout(()=>{fL(h)},0))}}W(xte,"cpName","DeleteCurrent");class Ste extends br{constructor(n){super(n,{class:"ddv-button-download",callback:()=>{const o=this.injection.viewer,h=o.getActiveTab();o.context.core.fileSaveService.saveToPdf(h.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:xi.annotationLicenseModuleIsExist()?"annotation":"none"}).then(v=>{wte(v,`${h.docName}.pdf`)})}}),Ew(this)}}W(Ste,"cpName","Download");class Tte extends cD{constructor(n){const{Delete_DeleteCurrent:o,Delete_DeleteAll:h}=yl.getDisplayTextConfig(),{Delete_DeleteCurrent:v,Delete_DeleteAll:y}=t0;n.data.options=zt(Ke({},n.data.options),{children:[{type:"DeleteCurrent",label:o,id:v},{type:"DeleteAll",label:h,id:y}],defaultClassName:"ddv-delete-btn",showCheckIcon:!1}),super(n),pc(this)}}W(Tte,"cpName","Delete");class Ite extends br{constructor(n){super(n,{class:"ddv-print-page",callback:()=>{const o=this.injection.viewer,h=o.getCurrentPageIndex(),v=o.getActiveTab(),{displayMode:y}=v.context;"single"===y?o.context.core.printPages(v.uid,[h]):o.context.core.printPages(v.uid)}}),Ew(this)}}W(Ite,"cpName","Print");class Ete extends br{constructor(n){super(n,{class:"ddv-crop-current",callback:()=>{this.cropEvent()}})}bindDefaultUi(){Dte(this)}cropEvent(){const n=this.injection.viewer,o=n.getRectBox(),h=n.getCurrentPageIndex();o&&n.cropPages(o,[h])}}function Dte(p){const n=p.injection.viewer,o=h=>{const v=gt(null==h?void 0:h.pageCount)?n.getPageCounts():h.pageCount,y=n.getRectBox();p.setUiState(v&&y?"normal":"disabled")};p.hooks.inserted.on(o),p.hooks.updated.on(o),n.hooks.pageExistenceChanged.on(o,p),n.hooks.cropRectDrawn.on(h=>{p.setUiState("normal")},p),n.hooks.cropRectDeleted.on(h=>{p.setUiState("disabled")},p)}W(Ete,"cpName","CropCurrent");class Ate extends br{constructor(n){super(n,{class:"ddv-crop-all",callback:()=>{this.cropEvent()}})}bindDefaultUi(){Dte(this)}cropEvent(){const{viewer:n}=this.injection,o=n.getRectBox(),h=n.getCropIndices();o&&n.cropPages(o,h)}}W(Ate,"cpName","CropAll");class Pte extends br{constructor(n){super(n,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent()}})}perspectiveEvent(){const{viewer:n}=this.injection;n.perspectiveAllPage()}}W(Pte,"cpName","PerspectiveAll");class Rte extends br{constructor(n){super(n,{class:"ddv-full-quad",callback:()=>{this.toggleFull()}}),this.bindViewerHooks()}toggleFull(){const{viewer:n}=this.injection;n.toggleFullPerspective()}bindViewerHooks(){const{hooks:n}=this.injection.viewer;n.perspectiveQuadChanged.on(o=>{this.isFocused=o.isFull||!1,this.setUiState(o.isFull?"focused":"normal",!rr())},this)}}W(Rte,"cpName","FullQuad");class kte extends br{constructor(n){super(n,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo()}}),this.$on("ui_cropClick",()=>{const o=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(o)})}bindDefaultUi(){Mte("redo",this)}}function Mte(p,n){const{viewer:o}=n.injection,h=()=>{const v=o.getOperationState();n.setUiState(("redo"===p?v.redo:v.undo)>0?"normal":"disabled")};n.hooks.inserted.on(h),n.hooks.updated.on(h),o.hooks.operationsChanged.on(v=>{let y="disabled";y="redo"===p?v.redo>0?"normal":"disabled":v.undo>0?"normal":"disabled",n.setUiState(y)},n)}W(kte,"cpName","Redo");class Ote extends br{constructor(n){super(n,{class:"ddv-restore-page",callback:()=>{const{viewer:o}=this.injection,h=o.getCurrentPageIndex();o.reset(h)}}),pc(this)}}W(Ote,"cpName","Restore");class Fte extends br{constructor(n){super(n,{class:"ddv-rotate-left",callback:()=>{const{viewer:o}=this.injection,h=o.getCurrentPageIndex();o.rotatePages(-90,[h])}}),pc(this)}}W(Fte,"cpName","RotateLeft");class Lte extends br{constructor(n){super(n,{class:"ddv-rotate-right",callback:()=>{const{viewer:o}=this.injection,h=o.getCurrentPageIndex();o.rotatePages(90,[h])}}),pc(this)}}W(Lte,"cpName","RotateRight");class Nte extends br{constructor(n){super(n,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo()}}),this.$on("ui_cropClick",()=>{const o=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(o)})}bindDefaultUi(){Mte("undo",this)}}W(Nte,"cpName","Undo");class Bte extends lD{constructor(n){super(n),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks()}initHooks(){const n=this.injection.viewer;n.hooks.toolModeChanged.on(o=>{const h="crop"===o.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(h?"focused":"normal"),this.togglePopup(h),this.isFirstClick&&h&&this.el.click()),this.$emit("ui_cropClick",h),this.$emit("ui_toolModeRefactor")},this),n.hooks.cropRectDrawn.on(()=>{sf(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1)},this),n.hooks.pageChanged.on(()=>{sf(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount())},this)}bindPullDownBoxEvents(){const{viewer:n}=this.injection,o=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),h=this.pullDownBox.getElementsByTagName("input")[1],v=this.pullDownBox.getElementsByTagName("input")[0],y=o.children[0],b=()=>{this.togglePopup(!1),n.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}})};this.nativeOn(o.children[1],"click",()=>{const w=n.getRectBox(),I=n.getCropIndices();w&&(n.cropPages(w,I),b())}),this.nativeOn(y,"click",b),this.nativeOn(this.el,"click",()=>{const w=n.rootDom,I=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];n.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor"),sf(I,!n.getRectBox()),this.isFirstClick&&(cm(w,this.el,this.pullDownBox),this.isFirstClick=!1)}),this.nativeOn(h,"change",()=>{n.cropMode="all"}),this.nativeOn(v,"change",()=>{n.cropMode="current"})}bindPopupSwitchEvent(){}bindDefaultUi(){const n=this.injection.viewer,o=()=>{const{toolMode:h}=n.getViewerConfig();let v="disabled";n.getPageCounts()>0?("crop"===h&&this.el.click(),v=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(v)};n.hooks.pageExistenceChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}bindViewerHooks(){}initTemplate(){const{defaultClass:n}=this,{options:o}=this.data,{popupBox:h}=o,{postfix:v,cropMode:y}=this.injection.viewer,{Crop_CropCurrent:_,Crop_CropAll:b,Crop_CropApply:w,Crop_CropCancel:I}=yl.getDisplayTextConfig(),{Crop_CropCurrent:A,Crop_CropAll:M,Crop_CropApply:F,Crop_CropCancel:V}=t0,B="current"===y?'checked="checked"':"",Q="all"===y?'checked="checked"':"";eh(th(this),this.injection.viewer,o);const J=`<div ${Fr(o,`ddv-button ${n}`)}>`+(gt(null==o?void 0:o.label)?"":`<span>${o.label}</span>`)+`<div ${Fr(h,`${n}-box`)}><div><input ${B} type="radio" id="${A+v}" name="cropType" value="cropCurrent" /><label for="${A+v}">${_}</label><input ${Q} type="radio" id="${M+v}" name="cropType" value="cropAll" /><label for="${M+v}">${b}</label></div><div class= "${n}-buttonGroup"><div id="${V+v}"><span>${I}</span></div><div id="${F+v}"><span>${w}</span></div></div></div></div>`;this.template=J}}W(Bte,"cpName","Crop");class W6e extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-filter-item"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks()}bindHooks(){this.hooks.created.on(n=>{this.bindEvents()}),this.hooks.inserted.on(()=>{this.bindFilterEvents()})}bindEvents(){const{el:n}=this;this.nativeOn(n,"click",()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:o}=this.data;this.$emit("ui_filterClick",o.type)})}bindFilterEvents(){this.$on("ui_filterReset",n=>{this.resetSelect(n.currentFilter);const{filterList:o}=n,{itemValue:h}=this.data,v=this.el.getElementsByTagName("img")[0];o.forEach(y=>{if(y.type===h.type){let _="";y.imageData&&(_=XE(y.imageData).data),v.src=_}})}),this.$on("ui_filterLoading",n=>{const o=this.el.getElementsByTagName("img")[0],h=this.el.getElementsByTagName("div")[0];o.style.display=n?"none":"",h.style.display=n?"":"none",this.el.style.pointerEvents=n?"none":""}),this.injection.viewer.hooks.filterChanged.on(n=>{this.resetSelect(n.filterType)},this)}resetSelect(n){const{itemValue:o}=this.data;n===o.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass)}initTemplate(){const{options:n,itemValue:o}=this.data,h=`<div ${Fr(n,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${o.label}</span></div>`;this.template=h}}const U6e=[{type:"none",label:"Original"}];class Wte extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-filter"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"isFirstClick",!0),W(this,"box",void 0),W(this,"applyAll",!1),W(this,"filterList",void 0),W(this,"filterUpdateStatus",!1),W(this,"enableFilter",!1),W(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),sD(this);const{filterService:o}=this.injection.viewer.context.core;o.enableFilter&&(this.enableFilter=!0,pc(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),fc.registerComponent({FilterItem:W6e})}bindHooks(){this.hooks.created.on(n=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.bindNativeEvents()}),this.hooks.updated.on(()=>{this.uiState="normal"})}bindViewerResized(){const{viewer:n}=this.injection;n.hooks.resize.on(()=>{const{box:o}=this,v=this.injection.viewer.rootDom;"none"===o.style.display?this.isFirstClick=!0:cm(v,this.el,this.box)},this)}bindViewerHooks(){var n=this;const o=this.injection.viewer;o.hooks.pageChanged.on(function(){var h=Fe(function*(v){if(0===v.total)return n.filterUpdateStatus=!0,void n.togglePopup(!1);const y=o.context.getActiveTab();if(!y||!n.box)return;const{currentUid:_,oldCurrentUid:b}=y;b!==_&&(n.filterUpdateStatus=!0,n.togglePopup(!1))});return function(v){return h.apply(this,arguments)}}(),this),o.hooks.updatePage.on(h=>{var v;const y=o.context.getActiveTab();y&&this.box&&(null===(v=y.getCurrentPage())||void 0===v?void 0:v.uid)===h.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1))},this),o.hooks.visibleChanged.on(h=>{"hidden"===h.newVisibility&&this.togglePopup(!1)},this)}bindNativeEvents(){var n=this;const{el:o,box:h}=this,v=h.querySelector(`.${this.cssPrefix}list-header`),y=v.getElementsByTagName("span")[0],_=v.getElementsByTagName("div")[0];this.nativeOn(o,"click",function(){var b=Fe(function*(w){n.togglePopup(),n.isFirstClick&&(cm(n.injection.viewer.rootDom,n.el,n.box),n.isFirstClick=!1)});return function(w){return b.apply(this,arguments)}}()),this.nativeOn(h,"click",b=>{b.stopPropagation()}),this.nativeOn([y,_],"click",()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:b}=this.injection,w=b.getPageCounts(),I=b.getCurrentPageUid(),A=b.context.core.pageService.getPage(I);b.filter(Array.from(Array(w).keys()),A.filter)}})}bindFilterEvents(){this.$on("ui_filterClick",n=>{const{viewer:o}=this.injection,h=o.getPageCounts();if(h<1)return;let v=Array.from(Array(h).keys());if(!this.applyAll){const y=o.getCurrentPageUid();if(o.context.core.pageService.getPage(y).fileIndex===n)return;v=[o.getCurrentPageIndex()]}o.filter(v,n)})}clickApplyToAll(n){const v=document.getElementById(t0.Filter_FilterAll+this.injection.viewer.postfix);if(gt(n))return this.applyAll?v.classList.remove(`${this.cssPrefix}checked`):v.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);n?v.classList.add(`${this.cssPrefix}checked`):v.classList.remove(`${this.cssPrefix}checked`),this.applyAll=n}updateFilterPreview(){var n=this;return Fe(function*(){const o=n.injection.viewer,h=o.getCurrentPageUid(),v=yield o.context.core.imageDataService.getOriginal(h);if(!v)return;n.$emit("ui_filterLoading",!0);const y=[],_=o.context.core.pageService.getPage(h);let b;try{b=yield o.context.core.processService.resize(v.data,3,v.width,v.height,200)}catch(I){}for(let I=0;I<n.filterList.length;I++){const A=n.filterList[I];if("none"===A.type)y.push({type:"none",imageData:v.data});else{let M;try{var w;b&&null!==(w=b)&&void 0!==w&&w.data&&(M=yield o.context.core.filterService.applyFilter({data:b.data,type:Er.JPEG,width:b.width,height:b.height},A.type))}catch(F){M=null}y.push({type:A.type,imageData:M})}}n.$emit("ui_filterLoading",!1),n.$emit("ui_filterReset",{currentFilter:_.filter||"none",filterList:y}),n.filterUpdateStatus=!1})()}initTemplate(){var n;const o=this.data,{options:h}=o,{popupBox:v,filterHeader:y,filterContent:_,valueList:b}=h,{filterService:w}=this.injection.viewer.context.core,I=t0.Filter_FilterAll+this.injection.viewer.postfix;eh(th(this),this.injection.viewer,h);const A=(null===(n=yl.getDisplayTextConfig())||void 0===n?void 0:n.Filter_FilterAll)||"Apply to All";o.valueList=b||U6e,w.enableFilter&&(o.valueList=w.getSupportedFilters()),this.filterList=o.valueList;const M=`<div ${Fr(h,`ddv-button ${this.defaultClass}`)}>`+(gt(null==h?void 0:h.label)?"":`<span>${h.label}</span>`)+`<i class="ddv-down-arrow"></i><div ${Fr(v,this.cssPrefix,"list")}><div id="${I}"${Fr(y,this.cssPrefix,"list-header")}><div></div><span>${A}</span></div><div ${Fr(_,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=M}togglePopup(n){var o=this;return Fe(function*(){const{box:h}=o,{viewer:v}=o.injection;let y="none"===h.style.display;y=gt(n)?!y:!n,y?h.remove():(o.$emit("ui_hidePopup",o),v.rootDom.appendChild(h),o.filterUpdateStatus&&o.updateFilterPreview()),ed(o.el,!y),h.style.display=y?"none":""})()}bindDefaultUi(){const n=this.injection.viewer,o=()=>{let h="normal";0!==n.getPageCounts()&&this.enableFilter||(h="disabled"),aD(this,h)};n.hooks.pageChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(Wte,"cpName","Filter");class Ute extends br{constructor(n){super(n,{class:"ddv-button-blank",callback:()=>{}})}bindDefaultUi(){}}class pL extends br{constructor(n){super(n,{class:"ddv-button-close",callback:()=>{}})}bindDefaultUi(){}}W(pL,"cpName","Close");class gL extends br{constructor(n){super(n,{class:"ddv-button-back",callback:()=>{}})}bindDefaultUi(){}}W(gL,"cpName","Back");class mL extends br{constructor(n){super(n,{class:"ddv-button-done",callback:()=>{}})}bindDefaultUi(){}}W(mL,"cpName","Done");const V6e=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class Vte extends cD{constructor(n){const{DisplayMode_ContinuousPage:o,DisplayMode_SinglePage:h}=yl.getDisplayTextConfig(),{DisplayMode_ContinuousPage:v,DisplayMode_SinglePage:y}=t0;n.data.options=zt(Ke({},n.data.options),{children:[{type:"ContinuousPage",label:o,id:v},{type:"SinglePage",label:h,id:y}],defaultClassName:"ddv-display-mode",showCheckIcon:!0}),super(n),pc(this)}updateUiState(n){const{el:o}=this;V6e.forEach((h,v)=>{n===h.displayName?(o.classList.add(h.className),this.selectChildren(v)):o.classList.remove(h.className)})}bindDefaultUi(){super.bindDefaultUi();const n=this.injection.viewer,o=()=>{const{displayMode:h}=n.getViewerConfig();this.updateUiState(h)};n.hooks.displayModeChanged.on(h=>{this.updateUiState(h.newDisplayMode)},this),n.hooks.openDocument.on(()=>{const h=n.context.getActiveTab();h&&this.updateUiState(h.context.displayMode)},this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(Vte,"cpName","DisplayMode");class vL extends br{constructor(n,o){super(n,{class:o.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:o.displayMode})}}),W(this,"displayMode",void 0),this.displayMode=o.displayMode,pc(this)}bindDefaultUi(){const n=this.injection.viewer,o=h=>{var v;const y=n.getActiveTab(),_=(null==h?void 0:h.pageCount)||n.getPageCounts(),b=(null==y||null===(v=y.context)||void 0===v?void 0:v.displayMode)||n.getViewerConfig().displayMode;this.setUiState(_?b===this.displayMode?"focused":"normal":"disabled")};n.hooks.pageExistenceChanged.on(o,this),n.hooks.displayModeChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}class jte extends vL{constructor(n){super(n,{class:"ddv-continuous-mode",displayMode:"continuous"})}}W(jte,"cpName","ContinuousPage");class Hte extends vL{constructor(n){super(n,{class:"ddv-multiple-mode",displayMode:"multiple"})}}W(Hte,"cpName","MultiPage");class Gte extends vL{constructor(n){super(n,{class:"ddv-single-mode",displayMode:"single"})}}W(Gte,"cpName","SinglePage");const j6e=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class zte extends cD{constructor(n){const{FitMode_FitWindow:o,FitMode_FitWidth:h,FitMode_FitHeight:v,FitMode_ActualSize:y}=yl.getDisplayTextConfig(),{FitMode_FitWindow:_,FitMode_FitWidth:b,FitMode_FitHeight:w,FitMode_ActualSize:I}=t0;n.data.options=zt(Ke({},n.data.options),{children:[{type:"FitWindow",label:o,id:_},{type:"FitWidth",label:h,id:b},{type:"FitHeight",label:v,id:w},{type:"ActualSize",label:y,id:I}],defaultClassName:"ddv-fit-type",showCheckIcon:!0}),super(n),pc(this)}updateUiState(n){const{el:o}=this;"none"!==n?j6e.forEach((h,v)=>{n===h.displayName?(o.classList.add(h.className),this.selectChildren(v)):o.classList.remove(h.className)}):this.selectChildren(-1)}bindDefaultUi(){super.bindDefaultUi();const n=this.injection.viewer,o=()=>{const{fitMode:h}=n.getViewerConfig();this.updateUiState(h)};n.hooks.fitModeChanged.on(h=>{this.updateUiState(h.newFitMode)},this),n.hooks.openDocument.on(()=>{const h=n.context.getActiveTab();h&&this.updateUiState(h.context.fitMode)},this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}W(zte,"cpName","FitMode");class hD extends br{constructor(n,o){super(n,{class:o.class,callback:()=>{const{viewer:h}=this.injection;h.updateViewerConfig({fitMode:o.fitMode})}}),W(this,"fitMode",void 0),this.fitMode=o.fitMode,pc(this)}bindDefaultUi(){const n=this.injection.viewer,o=()=>{const h=n.getPageCounts(),v=n.getActiveTab();let{fitMode:y}=n.getViewerConfig();v&&(y=v.context.fitMode),this.setUiState(h>0?h>0&&y===this.fitMode?"focused":"normal":"disabled")};n.hooks.pageExistenceChanged.on(o,this),n.hooks.fitModeChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}}class Yte extends hD{constructor(n){super(n,{class:"ddv-fit-height",fitMode:"height"})}}W(Yte,"cpName","FitHeight");class Xte extends hD{constructor(n){super(n,{class:"ddv-fit-width",fitMode:"width"})}}W(Xte,"cpName","FitWidth");class $te extends hD{constructor(n){super(n,{class:"ddv-fit-window",fitMode:"window"})}}W($te,"cpName","FitWindow");class qte extends hD{constructor(n){super(n,{class:"ddv-fit-actual",fitMode:"actualSize"})}}W(qte,"cpName","ActualSize");class Kte extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks()}bindHooks(){const{inserted:n}=this.hooks;n.on(()=>{var o;null===(o=this.injection.viewer)||void 0===o||o.context.viewService.bindContainer(this.el)})}initTemplate(){const{options:n}=this.data;n.id=n.id||`ddvMainView${this.injection.viewer.postfix}`;const o=`<div ${Fr(n,this.defaultClass,"")} ><slot></slot></div>`;this.template=o}}W(Kte,"cpName","MainView");class Jte extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-pagination"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"uiState","normal"),W(this,"input",void 0),W(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi()}bindHooks(){this.hooks.created.on(n=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`)})}bindEvents(){const n=this.injection.viewer,o=this.query(`.${this.cssPrefix}goto`);this.nativeOn(o,"input",h=>{yL(o,this.totalSpan.clientWidth)}),this.nativeOn(o,"blur",()=>{const h=n.getPageCounts(),v=n.getCurrentPageIndex();let y=parseInt(o.value,10);$t(y)?y<1?y=1:y>h&&(y=h):y=v+1,o.value=`${y}`,yL(o),n.gotoPage(y-1)}),this.nativeOn(o,"keydown",h=>{h.stopPropagation(),"Enter"===h.key&&o.blur()})}setState(n){this.uiState!==n&&this.el&&("normal"===n?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=n)}bindDefaultUi(){const n=this.injection.viewer,o=h=>{const v=gt(null==h?void 0:h.total)?n.getPageCounts():null==h?void 0:h.total,y=gt(null==h?void 0:h.current)?n.getCurrentPageIndex():null==h?void 0:h.current;this.setState(v>0?"normal":"disabled"),this.input.value=`${y+1}`,this.totalSpan.innerText=`${v}`,yL(this.input,this.totalSpan.clientWidth)};n.hooks.pageChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(()=>{this.uiState="normal",o(null)})}initTemplate(){const{options:n}=this.data,{gotoPage:o,total:h,separator:v}=n,{cssPrefix:y,injection:_,defaultClass:b}=this,{viewer:w}=_,I=w.getCurrentPageIndex()+1,A=w.getPageCounts(),M=`<div ${Fr(n,b,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${Fr(o,y,"goto")} value="${I}" type="number" ><div ${Fr(v,y,"separator")}></div><span ${Fr(h,y,"total")} >${A}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=M}}function yL(p,n){const{fontSize:o,width:h}=getComputedStyle(p);let v=function(_,b){const w=document.createElement("span");w.innerText=_,w.style.fontSize=b,w.style.position="absolute",w.style.top="0px",w.style.visibility="hidden",document.body.appendChild(w);const I=w.offsetWidth;return w.remove(),I}(p.value,o);gt(n)||0===n||(v=Math.min(n+10,v));const y=`${v+3}px`;h!==y&&(p.style.width=y)}W(Jte,"cpName","Pagination");class fD extends br{constructor(n,o){super(n,{class:o.class,callback:o.callback}),W(this,"type",void 0),this.type=o.type}bindDefaultUi(){const n=this.injection.viewer,o=()=>{const h=n.getPageCounts(),v=n.getCurrentPageIndex();let y=!1;switch(this.type){case"previous":case"first":y=h>0&&0!==v;break;case"last":case"next":y=v<h-1}0===h&&(y=!1),this.setUiState(y?"normal":"disabled")};this.hooks.inserted.on(o),this.hooks.updated.on(o),n.hooks.pageChanged.on(o,this)}}class Qte extends fD{constructor(n){super(n,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0)}})}}W(Qte,"cpName","FirstPage");class Zte extends fD{constructor(n){super(n,{class:"ddv-last-page",type:"last",callback:()=>{const o=this.injection.viewer,h=o.getPageCounts();o.gotoPage(h-1)}})}}W(Zte,"cpName","LastPage");class ene extends fD{constructor(n){super(n,{class:"ddv-next-page",type:"next",callback:()=>{const o=this.injection.viewer,h=o.getCurrentPageIndex();o.gotoPage(h+1)}})}}W(ene,"cpName","NextPage");class tne extends fD{constructor(n){super(n,{class:"ddv-prev-page",type:"previous",callback:()=>{const o=this.injection.viewer,h=o.getCurrentPageIndex();o.gotoPage(h-1)}})}}W(tne,"cpName","PrevPage");class nne extends br{constructor(n){super(n,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:o}=this;if(!o)return;const{visibility:h}=o.getViewerConfig();o.updateViewerConfig({visibility:"visible"===h?"hidden":"visible"})}}),W(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",o=>{if(this.thumbnail)return;const h=this.injection.viewer.context.core.getViewer(o);h&&(this.thumbnail=h,this.bindThumbnailHooks(h));const{visibility:v}=h.getViewerConfig();this.setUiState("visible"===v?"focused":"normal",!rr())}),this.injection.viewer.hooks.destroy.on(()=>{this.thumbnail=null},this)}bindThumbnailHooks(n){n.hooks.visibleChanged.on(o=>{this.setUiState("visible"===o.newVisibility?"focused":"normal",!rr())},this)}bindDefaultUi(){const n=()=>{if(!this.thumbnail)return;const{visibility:o}=this.thumbnail.getViewerConfig();this.setUiState("visible"===o?"focused":"normal",!rr())};this.injection.viewer.hooks.pageExistenceChanged.on(n,this),this.hooks.updated.on(n)}}W(nne,"cpName","ThumbnailSwitch");class _L extends br{constructor(n,o){super(n,{class:o.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:o.toolMode,canvasStyle:{cursor:o.cursor}})}}),W(this,"toolMode",void 0),this.toolMode=o.toolMode,this.bindViewerHooks()}bindDefaultUi(){const n=this.injection.viewer,o=()=>{const{toolMode:h}=n.getViewerConfig();n.getPageCounts()>0?this.setUiState(h===this.toolMode?"focused":"normal"):this.setUiState("disabled")};n.hooks.pageExistenceChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}bindViewerHooks(){const n=this.injection.viewer;n.hooks.toolModeChanged.on(o=>{const h=o.newToolMode===this.toolMode;n.getPageCounts()>0?this.setUiState(h?"focused":"normal"):this.setUiState("disabled")},this)}}class ine extends _L{constructor(n){super(n,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"})}}W(ine,"cpName","Pan"),W(class extends _L{constructor(p){super(p,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"})}},"cpName","ZoomMode");class rne extends _L{constructor(n){super(n,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"})}}W(rne,"cpName","CropMode");class CL extends br{constructor(n){super(n,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn()}}),this.bindViewerHooks(),pc(this)}bindViewerHooks(){const n=this.injection.viewer;n.hooks.zoomChanged.on(o=>{const{maxZoom:h}=n.getViewerConfig();n.getPageCounts()<1||o.newZoomRatio>=h?this.setUiState("disabled"):this.setUiState("normal")},this)}}W(CL,"cpName","ZoomIn");class bL extends br{constructor(n){super(n,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut()}}),this.bindViewerHooks(),pc(this)}bindViewerHooks(){const n=this.injection.viewer;n.hooks.zoomChanged.on(o=>{const{minZoom:h}=n.getViewerConfig();n.getPageCounts()<1||o.newZoomRatio<=h?this.setUiState("disabled"):this.setUiState("normal")},this)}}W(bL,"cpName","ZoomOut");class one extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-zoom-controller"),fc.registerComponent({ZoomIn:CL,ZoomOut:bL}),this.initTemplate()}initTemplate(){const{options:n}=this.data;eh(th(this),this.injection.viewer,n);const o=`<div ${Fr(n,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=o}}W(one,"cpName","Zoom");const H6e=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class sne extends Jo{constructor(n){super(n),W(this,"defaultClass","ddv-zoom-percentage"),W(this,"cssPrefix",`${this.defaultClass}-`),W(this,"isFirstClick",!0),W(this,"box",void 0),W(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),pc(this),sD(this),this.hooks.destroyed.on(()=>{this.dispose()})}bindHooks(){this.hooks.created.on(n=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents()}),this.hooks.inserted.on(()=>{const n=this.injection.viewer,{zoom:o}=n.getViewerConfig();this.updateZoom(o),this.updateZoomOption()}),this.hooks.updated.on(()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0})}bindDefaultUi(){const n=this.injection.viewer,o=()=>{aD(this,0===n.getPageCounts()?"disabled":"normal"),this.updateZoom(n.getViewerConfig().zoom)};n.hooks.pageChanged.on(o,this),this.hooks.inserted.on(o),this.hooks.updated.on(o)}bindViewerHooks(){const{viewer:n}=this.injection,{hooks:o}=n;o.zoomChanged.on(h=>{this.updateZoom(h.newZoomRatio)},this),o.visibleChanged.on(h=>{if("hidden"===h.newVisibility)return void this.togglePopup(!1);const{zoom:v}=n.getViewerConfig();this.updateZoom(v)},this)}bindEvents(){const{el:n,box:o}=this,h=n.querySelector(`.${this.cssPrefix}selector`),v=n.getElementsByTagName("input")[0],y=o.getElementsByTagName("ul")[0];this.nativeOn(h,"click",()=>{const _=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(cm(_,this.el,this.box,!0,!0),this.isFirstClick=!1)}),this.inputEvent(v),this.ulEvent(y)}bindViewerResized(){const{viewer:n}=this.injection;n.hooks.resize.on(()=>{const{box:o}=this,v=this.injection.viewer.rootDom;"none"===o.style.display?this.isFirstClick=!0:cm(v,this.el,this.box,!0,!0)},this)}inputEvent(n){const o=this.injection.viewer,{maxZoom:h,minZoom:v}=o.getViewerConfig();n.value=`${h}`;const y=Vee(n);function _(){const w=Ir(n.value/100,v,h);o.updateViewerConfig({zoom:w})}this.nativeOn(n,"input",()=>{this.adaptInputWidth(y)}),this.nativeOn(n,"blur",_),this.nativeOn(n,"keydown",b=>{b.stopPropagation(),"Enter"===b.key&&_()})}ulEvent(n){this.nativeOn(n,"click",o=>{o.stopPropagation();const{viewer:h}=this.injection,{maxZoom:v,minZoom:y}=h.getViewerConfig(),_=o.target;if("LI"===_.tagName){const b=Ir(_.value,100*y,100*v);h.updateViewerConfig({zoom:b/100})}this.togglePopup(!1)})}getZoomOptionTemplate(){var n;const o=(null===(n=this.data.options)||void 0===n?void 0:n.valueList)||null,h=this.injection.viewer,{maxZoom:v,minZoom:y}=h.getViewerConfig(),_=Di(o)?o:H6e,b=y<1e-4?.01:parseFloat((100*y).toFixed(2)),w=Math.floor(100*v);_.push(b,w);const I=Array.from(new Set(_)).sort((M,F)=>M-F);let A="";return I.forEach(M=>{$t(M)&&M<=100*v&&M>=100*y&&(A+=`<li value="${M}">${M}%</li>`)}),A}updateZoomOption(){const n=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=n}updateZoom(n){const o=this.el.getElementsByTagName("input")[0],h=100*n;if(Number.isInteger(h))o.value=`${h}`;else{let v=h;v=v>=1e3?+v.toFixed(0).toString():v>=100?+v.toFixed(1).toString():v>=10?+v.toFixed(2).toString():+v.toFixed(3).toString(),o.value=`${v}`}this.adaptInputWidth()}initTemplate(){const{options:n={}}=this.data,{input:o,selector:h,popupBox:v}=n,{cssPrefix:y}=this,{viewer:_}=this.injection;eh(th(this),_,n);const b=`<div ${Fr(n,this.defaultClass)}><div style="display: flex"><div ${Fr(o,y,"input")}><input type="number"><span>%</span></div><div ${Fr(h,y,"selector")}><i></i></div></div><div ${Fr(Ke({id:`ddvZoomByPercentageSelectBox${_.postfix}`},v),y,"selectbox")}><ul></ul></div></div>`;this.template=b}adaptInputWidth(n){const o=this.el.getElementsByTagName("input")[0];let h=Vee(o);n&&h>n&&(h=n),o.style.width=`${h}px`}togglePopup(n){const{viewer:o}=this.injection,{box:h}=this;let v="none"!==h.style.display;v=gt(n)?!v:n,v?(this.$emit("ui_hidePopup",this),o.rootDom.appendChild(h)):h.remove(),h.style.display=v?"":"none"}}W(sne,"cpName","ZoomByPercentage");class yl{static getTooltip(){return this.tooltip}static setTooltip(n){this.tooltip=Ke(Ke({},this.tooltip),n)}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(n){this.displayTextConfig=Ke(Ke({},this.displayTextConfig),n)}static registerAll(){fc.registerComponent({Capture:gte,Flashlight:mte,CameraConvert:vte,CameraResolution:yte,AutoDetect:pte,AutoCapture:fte,ImagePreview:_te,RotateLeft:Fte,RotateRight:Lte,Delete:Tte,DeleteAll:bte,DeleteCurrent:xte,Zoom:one,ZoomIn:CL,ZoomOut:bL,ZoomByPercentage:sne,PerspectiveAll:Pte,FullQuad:Rte,Restore:Ote,Undo:Nte,Redo:kte,FitMode:zte,FitWidth:Xte,FitHeight:Yte,FitWindow:$te,ActualSize:qte,DisplayMode:Vte,SinglePage:Gte,MultiPage:Hte,ContinuousPage:jte,Pan:ine,Print:Ite,Filter:Wte,ThumbnailSwitch:nne,Back:gL,Done:mL,Pagination:Jte,FirstPage:Qte,LastPage:Zte,NextPage:ene,PrevPage:tne,Root:Bee,Layout:Lee,Button:lL,MainView:Kte,Load:Cte,Download:Ste,Close:pL,Blank:Ute,SeparatorLine:Wee,CropCurrent:Ete,CropAll:Ate,CropMode:rne,Crop:Bte,AnnotationSet:uD,EllipseAnnotation:Hee,EraseAnnotation:Gee,InkAnnotation:zee,LineAnnotation:Yee,PolygonAnnotation:Xee,PolylineAnnotation:$ee,RectAnnotation:qee,SelectAnnotation:Kee,StampIconAnnotation:Jee,StampImageAnnotation:Qee,TextBoxAnnotation:Zee,TextTypewriterAnnotation:ete,BasePullDownButton:lD,PullDownListButton:cD,PullDownMenuButton:jee,BringForward:nte,BringToFront:ite,SendBackward:rte,SendToBack:ote,AnnotationToolBar:ste,AnnotationDeleteButton:lte,AnnotationPaletteButton:ate,AnnotationPalette:hte})}}W(yl,"tooltip",{}),W(yl,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const G6e={install(p){const n=function(o){var h,v,y,_;return h=new WeakMap,v=new WeakMap,y=new WeakMap,_=new WeakSet,class extends o{constructor(w){super(w),dl(this,_),W(this,"ui",void 0),W(this,"rootDom",void 0),bi(this,h,!1),bi(this,v,0),bi(this,y,0),yl.registerAll();const I=w.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==w?void 0:w.annotationToolBarConfig)||{},annotationPaletteConfig:(null==w?void 0:w.annotationPaletteConfig)||{}}):[];this.ui=new fc({container:w.container,emitter:this.emitter,postfix:this.uid,uiConfig:w.uiConfig,popupUiConfig:I,injection:{viewer:this}}),w.container&&(w.uiConfig?(this.bindContainer(w.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi()}listenNativeEventsForUi(){this.on("click",()=>{this.emit("ui_hidePopup","viewer")})}getPopupUiConfig(w){return[zt(Ke({},w.annotationToolBarConfig),{type:"AnnotationToolBar"}),zt(Ke({colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0},w.annotationPaletteConfig),{type:"AnnotationPalette"})]}addFontToUi(w){this.emit("ui_addFont",w)}getUiConfig(){return pn(this.ui.uiConfig)}updateUiConfig(w){const{resizeService:I}=this.context.core;I&&(I.unobserve(this.ui.rootDom),Wn(h,this,!1));const A=this.ui.updateUiConfig(w);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,lt(_,this,b).call(this,this.ui.rootDom),A}getElementsByType(w){return Sn(w)?this.ui.getElementsByType(this.ui.rootVNode,w):""}bindContainer(w){let I=w;return Sn(w)&&(I=document.querySelector(`#${w}`)),I instanceof HTMLElement&&(lt(_,this,b).call(this,this.ui.rootDom),this.ui.bindContainer(I),this.context.viewService.container=I,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1)}dispose(){var w;super.dispose(),null===(w=this.ui)||void 0===w||w.dispose()}};function b(w){if(Xe(h,this))return;const{resizeService:I}=this.context.core;I.observe(w),this.register(I.onResizeObserver.on(A=>{if(A.target===w){var M;let F=0,V=0;if((null===(M=A.borderBoxSize)||void 0===M?void 0:M.length)>0){const Q=A.borderBoxSize[0];F=Q.inlineSize,V=Q.blockSize}else F=w.offsetWidth,V=w.offsetHeight;const B=mF.create(Xe(v,this),Xe(y,this),F,V);Wn(v,this,F),Wn(y,this,V),this.hooks.resize.emit(B),this.emit("resized",{oldWidth:B.oldWidth,oldHeight:B.oldHeight,newWidth:B.newWidth,newHeight:B.newHeight})}})),this.hooks.destroy.on(()=>{I.unobserve(w)}),Wn(h,this,!0)}}(p.getClass("Viewer"));p.setClass("Viewer",n)}};function ot(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function Ji(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}"function"==typeof SuppressedError&&SuppressedError;const ane="undefined"==typeof self;let Dw,Aw,pD,xL,Qo;function zl(p,n,o,h){if("a"===o&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof n?p!==n||!h:!n.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?h:"a"===o?h.call(p):h?h.value:n.get(p)}function ih(p,n,o,h,v){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!v)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof n?p!==n||!v:!n.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?v.call(p,o):v?v.value=o:n.set(p,o),o}"undefined"!=typeof navigator&&(Dw=navigator,Aw=Dw.userAgent,pD=Dw.platform,xL=Dw.mediaDevices),function(){if(!ane){const p={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Dw.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},n={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:pD,search:"Win"},Mac:{str:pD},Linux:{str:pD}};let o="unknownBrowser",h=0,v="unknownOS";for(let y in p){const _=p[y]||{};let I=_.verStr||Aw,A=_.verSearch||y;if(A instanceof Array||(A=[A]),-1!=(_.str||Aw).indexOf(_.search||y)){o=y;for(let M of A){let F=I.indexOf(M);if(-1!=F){h=parseFloat(I.substring(F+M.length+1));break}}break}}for(let y in n){const _=n[y]||{};if(-1!=(_.str||Aw).indexOf(_.search||y)){v=y;break}}"Linux"==v&&-1!=Aw.indexOf("Windows NT")&&(v="HarmonyOS"),Qo={browser:o,version:h,OS:v}}ane&&(Qo={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;class ou{static multiply(n,o){const h=[];for(let v=0;v<3;v++){const y=o.slice(3*v,3*v+3);for(let _=0;_<3;_++){const b=[n[_],n[_+3],n[_+6]].reduce((w,I,A)=>w+I*y[A],0);h.push(b)}}return h}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(n,o,h){return ou.multiply(n,[1,0,0,0,1,0,o,h,1])}static rotate(n,o){var h=Math.cos(o),v=Math.sin(o);return ou.multiply(n,[h,-v,0,v,h,0,0,0,1])}static scale(n,o,h){return ou.multiply(n,[o,0,0,0,h,0,0,0,1])}}var zr,Ap,Pp,gD,e1,Pw,Rw,t1,mD,r0,vD,wL,Fn,wi,ar,yD,_D,Qr,td,Rp,kw,CD,af,kp,su,n1,i1,Mw,bD,r1,o0,Mp,Op,SL,$s,TL,s0,o1,xD,wD,lne,rh,IL,EL,s1,Ow,SD,au,a1,DL,AL,cne;!function(p){p.GREY="grey",p.GREY32="grey32",p.RGBA="rgba",p.RBGA="rbga",p.GRBA="grba",p.GBRA="gbra",p.BRGA="brga",p.BGRA="bgra"}(zr||(zr={}));class ci{static get version(){return"1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(ih(ci,Ap,!1,"f",Pp),!1):(ih(ci,Ap,!0,"f",Pp),!0)}get disposed(){return zl(this,mD,"f")}constructor(){gD.set(this,zr.RGBA),e1.set(this,null),Pw.set(this,null),Rw.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,t1.set(this,null),mD.set(this,!1)}drawImage(n,o,h,v,y,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!h||!v)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==zl(ci,Ap,"f",Pp)&&ci.checkWebGLSupport(),(null==_?void 0:_.bUseWebGL)&&!zl(ci,Ap,"f",Pp))throw new Error("Your browser or machine may not support WebGL.");if(o instanceof HTMLVideoElement&&4!==o.readyState||o instanceof HTMLImageElement&&!o.complete)throw new Error("The source is not loaded.");let b;ci._onLog&&(b=Date.now(),ci._onLog("drawImage(), START: "+b));let w=0,I=0,A=h,M=v,F=0,V=0,B=h,Q=v;y&&(y.sx&&(w=Math.round(y.sx)),y.sy&&(I=Math.round(y.sy)),y.sWidth&&(A=Math.round(y.sWidth)),y.sHeight&&(M=Math.round(y.sHeight)),y.dx&&(F=Math.round(y.dx)),y.dy&&(V=Math.round(y.dy)),y.dWidth&&(B=Math.round(y.dWidth)),y.dHeight&&(Q=Math.round(y.dHeight)));let J,Z=zr.RGBA;if((null==_?void 0:_.pixelFormat)&&(Z=_.pixelFormat),(null==_?void 0:_.bufferContainer)&&(J=_.bufferContainer,J.length<4*B*Q))throw new Error("Unexpected size of the 'bufferContainer'.");const re=n;if(!zl(ci,Ap,"f",Pp)||!(this.useWebGLByDefault&&null==(null==_?void 0:_.bUseWebGL)||(null==_?void 0:_.bUseWebGL))){ci._onLog&&ci._onLog("drawImage() in context2d."),re.ctx2d||(re.ctx2d=re.getContext("2d",{willReadFrequently:!0}));const se=re.ctx2d;if(!se)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q),se.drawImage(o,w,I,A,M,F,V,B,Q),ci._onLog&&ci._onLog("drawImage() in context2d end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:zr.RGBA,bUseWebGL:!1}}ci._onLog&&ci._onLog("drawImage() in WebGL.");try{(re.width<F+B||re.height<V+Q)&&(re.width=F+B,re.height=V+Q,re.ctxWebGL&&re.ctxWebGL.viewport(0,0,F+B,V+Q));const se=re.ctxWebGL||re.getContext("webgl",{antialias:!1})||re.getContext("experimental-webgl",{antialias:!1});if(!se){ci._onLog&&ci._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const te=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw te.name="WebGLError",te}if(!re.ctxWebGL||Z!==zl(this,gD,"f")){re.ctxWebGL=se;const te=k=>{const N=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,N),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW);const $=k.createBuffer();return k.bindBuffer(k.ARRAY_BUFFER,$),k.bufferData(k.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),k.STATIC_DRAW),{positions:N,texCoords:$}},Me=k=>{const N=k.createTexture();return k.bindTexture(k.TEXTURE_2D,N),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),N},we=(k,N)=>{const $=k.createProgram();if(N.forEach(ie=>k.attachShader($,ie)),k.linkProgram($),!k.getProgramParameter($,k.LINK_STATUS)){const ie=new Error(`An error occured linking the program: ${k.getProgramInfoLog($)}.`);throw ie.name="WebGLError",ie}return k.useProgram($),$},Le=(k,N,$)=>{const ie=k.createShader(N);if(k.shaderSource(ie,$),k.compileShader(ie),!k.getShaderParameter(ie,k.COMPILE_STATUS)){const ee=new Error(`An error occured compiling the shader: ${k.getShaderInfoLog(ie)}.`);throw ee.name="WebGLError",ee}return ie},j="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let L="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Z)&&(L=Z.slice(0,3));const Y=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${L} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,q=we(se,[Le(se,se.VERTEX_SHADER,j),Le(se,se.FRAGMENT_SHADER,Y)]);ih(this,Pw,{program:q,attribLocations:{vertexPosition:se.getAttribLocation(q,"a_position"),texPosition:se.getAttribLocation(q,"a_texCoord")},uniformLocations:{uSampler:se.getUniformLocation(q,"u_image"),uColorFactor:se.getUniformLocation(q,"uColorFactor"),uMatrix:se.getUniformLocation(q,"u_matrix"),uTextureMatrix:se.getUniformLocation(q,"u_textureMatrix")}},"f"),ih(this,Rw,te(se),"f"),ih(this,e1,Me(se),"f"),ih(this,gD,Z,"f")}const ce=(te,Me,we)=>{te.bindBuffer(te.ARRAY_BUFFER,Me),te.enableVertexAttribArray(we),te.vertexAttribPointer(we,2,te.FLOAT,!1,0,0)},Ce=(te,Me,we,Le)=>{te.clearColor(0,0,0,1),te.clearDepth(1),te.enable(te.DEPTH_TEST),te.depthFunc(te.LEQUAL),te.clear(te.COLOR_BUFFER_BIT|te.DEPTH_BUFFER_BIT),ce(te,we.positions,Me.attribLocations.vertexPosition),ce(te,we.texCoords,Me.attribLocations.texPosition),te.activeTexture(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,Le),te.uniform1i(Me.uniformLocations.uSampler,0),te.uniform1f(Me.uniformLocations.uColorFactor,[zr.GREY,zr.GREY32].includes(Z)?1:0);let j,L,Y=ou.translate(ou.identity(),-1,-1);Y=ou.scale(Y,2,2),Y=ou.scale(Y,1/te.canvas.width,1/te.canvas.height),j=ou.translate(Y,F,V),j=ou.scale(j,B,Q),te.uniformMatrix3fv(Me.uniformLocations.uMatrix,!1,j),L=ou.translate(ou.identity(),w/h,I/v),L=ou.scale(L,A/h,M/v),te.uniformMatrix3fv(Me.uniformLocations.uTextureMatrix,!1,L),te.drawArrays(te.TRIANGLES,0,6)};((te,Me,we)=>{const Le=te.RGBA,j=te.RGBA,L=te.UNSIGNED_BYTE;te.bindTexture(te.TEXTURE_2D,Me),te.texImage2D(te.TEXTURE_2D,0,Le,j,L,we)})(se,zl(this,e1,"f"),o),Ce(se,zl(this,Pw,"f"),zl(this,Rw,"f"),zl(this,e1,"f"));const Ve=J||new Uint8Array(4*B*Q);if(se.readPixels(F,V,B,Q,se.RGBA,se.UNSIGNED_BYTE,Ve),255!==Ve[3]){ci._onLog&&ci._onLog("Incorrect WebGL drawing .");const te=new Error("WebGL error: incorrect drawing.");throw te.name="WebGLError",te}return ci._onLog&&ci._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-b)),{context:se,pixelFormat:Z===zr.GREY?zr.GREY32:Z,bUseWebGL:!0}}catch(se){if(this.forceLoseContext(),null==(null==_?void 0:_.bUseWebGL))return ci._onLog&&ci._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(n,o,h,v,y,Object.assign({},_,{bUseWebGL:!1}));throw se.name="WebGLError",se}}readCvsData(n,o,h){if(!(n instanceof CanvasRenderingContext2D||n instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let v,y=0,_=0,b=n.canvas.width,w=n.canvas.height;if(o&&(o.x&&(y=o.x),o.y&&(_=o.y),o.width&&(b=o.width),o.height&&(w=o.height)),(null==h?void 0:h.length)<4*b*w)throw new Error("Unexpected size of the 'bufferContainer'.");if(n instanceof WebGLRenderingContext){const I=n;h?(I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,h),v=new Uint8Array(h.buffer,0,4*b*w)):(v=new Uint8Array(4*b*w),I.readPixels(y,_,b,w,I.RGBA,I.UNSIGNED_BYTE,v))}else if(n instanceof CanvasRenderingContext2D){let I;I=n.getImageData(y,_,b,w),v=new Uint8Array(I.data.buffer),null==h||h.set(v)}return v}transformPixelFormat(n,o,h,v){let y,_;if(ci._onLog&&(y=Date.now(),ci._onLog("transformPixelFormat(), START: "+y)),o===h)return ci._onLog&&ci._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),v?new Uint8Array(n):n;const b=[zr.RGBA,zr.RBGA,zr.GRBA,zr.GBRA,zr.BRGA,zr.BGRA];if(b.includes(o))if(h===zr.GREY){_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=.21*n[w]+.71*n[w+1]+.07*n[w+2]}else if(h===zr.GREY32){_=v?new Uint8Array(n):n;for(let w=0;w<n.length;w+=4){const I=.21*n[w]+.71*n[w+1]+.07*n[w+2];_[w]=I,_[w+1]=I,_[w+2]=I}}else{if(!b.includes(h))throw new Error("Unable to transform.");if(v){_=new Uint8Array(n);const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4)_[B+M]=n[B+w],_[B+F]=n[B+I],_[B+V]=n[B+A]}else{_=n;const w=o.indexOf("r"),I=o.indexOf("g"),A=o.indexOf("b"),M=h.indexOf("r"),F=h.indexOf("g"),V=h.indexOf("b");for(let B=0;B<n.length;B+=4){let Q=[n[B],n[B+1],n[B+2]];_[B+M]=Q[w],_[B+F]=Q[I],_[B+V]=Q[A]}}}else if(o===zr.GREY){if(h!==zr.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*n.length);for(let w=0;w<n.length;w++)_[4*w]=n[w],_[4*w+1]=n[w],_[4*w+2]=n[w],_[4*w+3]=255}else{if(o!==zr.GREY32)throw new Error("Unable to transform.");if(h!==zr.GREY)throw new Error("Unable to transform.");_=new Uint8Array(n.length/4);for(let w=0;w<n.length;w+=4)_[w/4]=n[w]}return ci._onLog&&ci._onLog("transformPixelFormat() end. Costs: "+(Date.now()-y)),_}getImageData(n,o,h,v,y){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!o||!h)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==zl(ci,Ap,"f",Pp)&&ci.checkWebGLSupport(),(null==y?void 0:y.bUseWebGL)&&!zl(ci,Ap,"f",Pp))throw new Error("Your browser or machine may not support WebGL.");if(v.sx>o||v.sy>h||v.sx+v.sWidth>o||v.sy+v.sHeight>h)throw new Error("Invalid position.");if(n instanceof HTMLVideoElement&&4!==n.readyState||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let _;ci._onLog&&(_=Date.now(),ci._onLog("getImageData(), START: "+_));const b=Math.round(v.sx),w=Math.round(v.sy),I=Math.round(v.sWidth),A=Math.round(v.sHeight),M=Math.round(v.dWidth),F=Math.round(v.dHeight);let V=zr.RGBA;(null==y?void 0:y.pixelFormat)&&(V=y.pixelFormat);let B,Q,J,Z=null;if((null==y?void 0:y.bufferContainer)&&(Z=y.bufferContainer),zl(ci,Ap,"f",Pp)&&(this.useWebGLByDefault&&null==(null==y?void 0:y.bUseWebGL)||(null==y?void 0:y.bUseWebGL))){ci._onLog&&ci._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),B=this._reusedWebGLCvs;try{if(Z)if(V===zr.GREY){if(J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}}else Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:Z}),J=new Uint8Array(Z.buffer,0,4*M*F),J=this.transformPixelFormat(J,Q.pixelFormat,V);else V===zr.GREY?((!zl(this,t1,"f")||zl(this,t1,"f").length<4*M*F)&&ih(this,t1,new Uint8Array(4*M*F),"f"),J=new Uint8Array(zl(this,t1,"f").buffer,0,4*M*F)):J=new Uint8Array(4*M*F),Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:V,bUseWebGL:!0,bufferContainer:J}),J=this.transformPixelFormat(J,Q.pixelFormat,V)}catch(re){if("WebGLError"===re.name&&(this.forceLoseContext(),null==(null==y?void 0:y.bUseWebGL)))return ci._onLog&&ci._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},Object.assign({},y,{bUseWebGL:!1}));throw re}}else if(ci._onLog&&ci._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),B=this._reusedCvs,Q=this.drawImage(B,n,o,h,{sx:b,sy:w,sWidth:I,sHeight:A,dWidth:M,dHeight:F},{pixelFormat:zr.RGBA,bUseWebGL:!1}),J=this.readCvsData(Q.context,{width:M,height:F},null),J=this.transformPixelFormat(J,Q.pixelFormat,V),Z){if(Z.length<J.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set(J)}return ci._onLog&&ci._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:J,pixelFormat:V,width:M,height:F,bUseWebGL:Q.bUseWebGL}}convertDataToCvs(n,o,h,v){if(!(n instanceof Uint8Array||n instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof o||o<=0)throw new Error("Invalid 'width'.");if("number"!=typeof h||h<=0)throw new Error("Invalid 'height'.");const y=document.createElement("canvas");let _;if(y.width=o,y.height=h,v===zr.GREY){_=new Uint8ClampedArray(4*o*h);for(let w=0;w<_.length;w+=4)_[w]=n[w/4],_[w+1]=n[w/4],_[w+2]=n[w/4],_[w+3]=255}else _=new Uint8ClampedArray(n.buffer);const b=new ImageData(_,o,h);return y.getContext("2d").putImageData(b,0,0),y}forceLoseContext(){if(!this._reusedWebGLCvs)return;const n=this._reusedWebGLCvs.ctxWebGL;n&&!n.isContextLost()&&n.getExtension("WEBGL_lose_context")&&n.getExtension("WEBGL_lose_context").loseContext(),ih(this,e1,null,"f"),ih(this,Pw,null,"f"),ih(this,Rw,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),ih(this,mD,!0,"f")}}Ap=ci,gD=new WeakMap,e1=new WeakMap,Pw=new WeakMap,Rw=new WeakMap,t1=new WeakMap,mD=new WeakMap,Pp={value:void 0};class z6e{constructor(){r0.set(this,new Map),vD.set(this,!1)}get disposed(){return ot(this,vD,"f")}on(n,o){n=n.toLowerCase();const h=ot(this,r0,"f").get(n);if(h){if(h.includes(o))return;h.push(o)}else ot(this,r0,"f").set(n,[o])}off(n,o){n=n.toLowerCase();const h=ot(this,r0,"f").get(n);if(!h)return;const v=h.indexOf(o);-1!==v&&h.splice(v,1)}offAll(n){n=n.toLowerCase();const o=ot(this,r0,"f").get(n);o&&(o.length=0)}fire(n){var o=arguments,h=this;return Fe(function*(){let v=o.length>1&&void 0!==o[1]?o[1]:[],y=o.length>2&&void 0!==o[2]?o[2]:{async:!1,copy:!0};v||(v=[]),n=n.toLowerCase();const _=ot(h,r0,"f").get(n);if(_&&_.length){y=Object.assign({async:!1,copy:!0},y);for(let b of _){if(!b)continue;let w=[];if(y.copy)for(let A of v){try{A=JSON.parse(JSON.stringify(A))}catch(M){}w.push(A)}else w=v;let I=!1;if(y.async)setTimeout(()=>{h.disposed||b.apply(y.target,w)},0);else try{I=yield b.apply(y.target,w)}catch(A){}if(!0===I)break}}})()}dispose(){Ji(this,vD,!0,"f")}}r0=new WeakMap,vD=new WeakMap;const gc=(p,n,o,h)=>{if(!o)return p;let v=n+Math.round((p-n)/o)*o;return h&&(v=Math.min(v,h)),v};class mi{static get version(){return"2.0.0-16"}static isStorageAvailable(n){let o;try{o=window[n];const h="__storage_test__";return o.setItem(h,h),o.removeItem(h),!0}catch(h){return h instanceof DOMException&&(22===h.code||1014===h.code||"QuotaExceededError"===h.name||"NS_ERROR_DOM_QUOTA_REACHED"===h.name)&&o&&0!==o.length}}static findBestRearCameraInIOS(n,o){if(!n||!n.length)return null;let h=!1;if((null==o?void 0:o.getMainCamera)&&(h=!0),h){const v=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],y=n.find(_=>v.includes(_.label.toLowerCase()));return null==y?void 0:y.deviceId}{const v=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],y=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],_=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],b=n.filter(A=>{const M=A.label.toLowerCase();return v.some(F=>M.includes(F))});if(!b.length)return null;const w=b.find(A=>{const M=A.label.toLowerCase();return y.some(F=>M.includes(F))});if(w)return w.deviceId;const I=b.find(A=>{const M=A.label.toLowerCase();return _.some(F=>M.includes(F))});return I?I.deviceId:b[0].deviceId}}static findBestRearCamera(n,o){if(!n||!n.length)return null;if(["iPhone","iPad","Mac"].includes(Qo.OS))return mi.findBestRearCameraInIOS(n,{getMainCamera:null==o?void 0:o.getMainCameraInIOS});const h=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let v of n){const y=v.label.toLowerCase();if(y&&h.some(_=>y.includes(_))&&/\b0(\b)?/.test(y))return v.deviceId}return["Android","HarmonyOS"].includes(Qo.OS)?n[n.length-1].deviceId:null}static findBestCamera(n,o,h){return n&&n.length?"environment"===o?this.findBestRearCamera(n,h):"user"===o?null:o?void 0:null:null}static playVideo(n,o,h){return Fe(function*(){if(!n)throw new Error("Invalid 'videoEl'.");if(!o)throw new Error("Invalid 'source'.");return"string"==typeof o||o instanceof String?n.src=o:n.srcObject=o,new Promise((v,y)=>{let _;const b=()=>{n.removeEventListener("loadstart",A),n.removeEventListener("abort",M),n.removeEventListener("play",F),n.removeEventListener("error",V)},w=()=>{_&&clearTimeout(_),b(),v(n)},I=B=>{_&&clearTimeout(_),b(),y(B)},A=()=>{n.addEventListener("abort",M,{once:!0})},M=()=>{const B=new Error("Video playing was interrupted.");B.name="AbortError",I(B)},F=()=>{w()},V=()=>{I(new Error(`Video error ${n.error.code}: ${n.error.message}.`))};n.addEventListener("loadstart",A,{once:!0}),n.autoplay&&["iPhone","iPad","Mac"].includes(Qo.OS)&&Qo.version>=17?(n.addEventListener("play",F,{once:!0}),n.addEventListener("error",V,{once:!0})):(n.load(),n.play().then(()=>{w()}).catch(B=>{I(B)})),h&&(_=setTimeout(()=>{b(),y(new Error("Failed to play video. Timeout."))},h))})})()}static testCameraAccess(n){return Fe(function*(){var o,h;if(!(null===(h=null===(o=null==window?void 0:window.navigator)||void 0===o?void 0:o.mediaDevices)||void 0===h?void 0:h.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let v;try{v=n?yield navigator.mediaDevices.getUserMedia(n):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(y){return{ok:!1,errorName:y.name,errorMessage:y.message}}finally{null==v||v.getTracks().forEach(y=>{y.stop()})}return{ok:!0}})()}get state(){if(!ot(this,su,"f"))return"closed";if("pending"===ot(this,su,"f"))return"opening";if("fulfilled"===ot(this,su,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(n){n&&mi.isStorageAvailable("localStorage")?Ji(this,kw,!0,"f"):Ji(this,kw,!1,"f")}get ifSaveLastUsedCamera(){return ot(this,kw,"f")}get isVideoPlaying(){return!(!ot(this,wi,"f")||ot(this,wi,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(n){var o,h,v;if(!(n instanceof HTMLElement)&&null!=n)throw new TypeError("Invalid 'element'.");null===(o=ot(this,o0,"f"))||void 0===o||o.removeEventListener("click",ot(this,r1,"f")),null===(h=ot(this,o0,"f"))||void 0===h||h.removeEventListener("touchend",ot(this,r1,"f")),null===(v=ot(this,o0,"f"))||void 0===v||v.removeEventListener("touchmove",ot(this,bD,"f")),Ji(this,o0,n,"f"),n&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Qo.OS)?(n.addEventListener("touchend",ot(this,r1,"f")),n.addEventListener("touchmove",ot(this,bD,"f"))):n.addEventListener("click",ot(this,r1,"f")))}get tapFocusEventBoundEl(){return ot(this,o0,"f")}get disposed(){return ot(this,wD,"f")}constructor(n){var h,v,o=this;Fn.add(this),wi.set(this,null),ar.set(this,void 0),yD.set(this,()=>{"opened"===this.state&&ot(this,$s,"f").fire("resumed",null,{target:this,async:!0})}),_D.set(this,()=>{ot(this,$s,"f").fire("paused",null,{target:this,async:!1})}),Qr.set(this,void 0),td.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],Rp.set(this,void 0),kw.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,CD.set(this,void 0),af.set(this,!0),kp.set(this,void 0),su.set(this,void 0),n1.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},i1.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(y,_)=>{let b,w;const I=window.getComputedStyle(ot(this,wi,"f")).objectFit,A=this.getResolution(),M=ot(this,wi,"f").getBoundingClientRect(),F=M.left,V=M.top,{width:B,height:Q}=ot(this,wi,"f").getBoundingClientRect();if(B<=0||Q<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const J=B/Q,Z=A.width/A.height;let re=1;if("contain"===I)Z>J?(re=B/A.width,b=(y-F)/re,w=(_-V-(Q-B/Z)/2)/re):(re=Q/A.height,w=(_-V)/re,b=(y-F-(B-Q*Z)/2)/re);else{if("cover"!==I)throw new Error("Unsupported object-fit.");Z>J?(re=Q/A.height,w=(_-V)/re,b=(y-F+(Q*Z-B)/2)/re):(re=B/A.width,b=(y-F)/re,w=(_-V+(B/Z-Q)/2)/re)}return{x:b,y:w}},Mw.set(this,!1),bD.set(this,()=>{Ji(this,Mw,!0,"f")}),r1.set(this,function(){var y=Fe(function*(_){var b;if(ot(o,Mw,"f"))return void Ji(o,Mw,!1,"f");if(!(ot(o,i1,"f")&&o.isVideoPlaying&&ot(o,ar,"f")&&o._focusSupported))return;if(!o._focusParameters.fds&&(o._focusParameters.fds=null===(b=o.getCameraCapabilities())||void 0===b?void 0:b.focusDistance,!o._focusParameters.fds))return void(o._focusSupported=!1);if(null==o._focusParameters.kTimeout&&(o._focusParameters.kTimeout=(o._focusParameters.maxTimeout-o._focusParameters.minTimeout)/(1/o._focusParameters.fds.min-1/o._focusParameters.fds.max)),1==o._focusParameters.isDoingFocus)return;let w,I;if(o._focusParameters.taskBackToContinous&&(clearTimeout(o._focusParameters.taskBackToContinous),o._focusParameters.taskBackToContinous=null),_ instanceof MouseEvent)w=_.clientX,I=_.clientY;else{if(!(_ instanceof TouchEvent))throw new Error("Unknown event type.");if(!_.changedTouches.length)return;w=_.changedTouches[0].clientX,I=_.changedTouches[0].clientY}const A=o.getResolution(),M=2*Math.round(Math.min(A.width,A.height)/o._focusParameters.defaultFocusAreaSizeRatio/2);let F;try{F=o.calculateCoordInVideo(w,I)}catch(Z){}if(F.x<0||F.x>A.width||F.y<0||F.y>A.height)return;const V={x:F.x+"px",y:F.y+"px"},B=M+"px",Q=B;let J;mi._onLog&&(J=Date.now());try{yield ot(o,Fn,"m",DL).call(o,V,B,Q,o._focusParameters.tapFocusMinDistance,o._focusParameters.tapFocusMaxDistance)}catch(Z){if(mi._onLog)throw mi._onLog(Z),Z}mi._onLog&&mi._onLog(`Tap focus costs: ${Date.now()-J} ms`),o._focusParameters.taskBackToContinous=setTimeout(()=>{var Z;mi._onLog&&mi._onLog("Back to continuous focus."),null===(Z=ot(o,ar,"f"))||void 0===Z||Z.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},o._focusParameters.focusBackToContinousTime),ot(o,$s,"f").fire("tapfocus",null,{target:o,async:!0})});return function(_){return y.apply(this,arguments)}}()),o0.set(this,null),Mp.set(this,1),Op.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!ot(this,wi,"f"))return;const y=ot(this,Mp,"f");if(y<1)throw new RangeError("Invalid scale value.");if(1===y)ot(this,wi,"f").style.transform="";else{const _=window.getComputedStyle(ot(this,wi,"f")).objectFit,b=ot(this,wi,"f").videoWidth,w=ot(this,wi,"f").videoHeight,{width:I,height:A}=ot(this,wi,"f").getBoundingClientRect();if(I<=0||A<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const M=I/A,F=b/w;let V=1;"contain"===_?V=M<F?I/(b/y):A/(w/y):"cover"===_&&(V=F>M?A/(b/y):I/(w/y));const B=V*(1-1/y)*(b/2-ot(this,Op,"f").x),Q=V*(1-1/y)*(w/2-ot(this,Op,"f").y);ot(this,wi,"f").style.transform=`translate(${B}px, ${Q}px) scale(${y})`}},SL.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const y=document.createElement("canvas");let _;if(y.width=this.width,y.height=this.height,this.pixelFormat===zr.GREY){_=new Uint8ClampedArray(this.width*this.height*4);for(let w=0;w<_.length;w+=4)_[w]=this.data[w/4],_[w+1]=this.data[w/4],_[w+2]=this.data[w/4],_[w+3]=255}else _=new Uint8ClampedArray(this.data.buffer);const b=new ImageData(_,this.width,this.height);return y.getContext("2d").putImageData(b,0,0),y}),$s.set(this,void 0),TL.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],s0.set(this,new Map),o1.set(this,!1),xD.set(this,Fe(function*(){var y,_;if("visible"===document.visibilityState){if(mi._onLog&&mi._onLog("document visible. video paused: "+(null===(y=ot(o,wi,"f"))||void 0===y?void 0:y.paused)),ot(o,o1,"f")&&ot(o,wi,"f")&&o.videoSrc&&"opened"===o.state)return void o.resume().catch(()=>{});if(!o._mediaStream)return;if(o._mediaStream.active&&ot(o,ar,"f"))if(ot(o,ar,"f").muted&&["iPhone","iPad","Mac"].includes(Qo.OS)){if(Qo.version>=17)return;yield ot(o,Fn,"m",s1).call(o)}else ot(o,o1,"f")&&o.resume().catch(()=>{});else yield ot(o,Fn,"m",s1).call(o)}else if("hidden"===document.visibilityState&&(mi._onLog&&mi._onLog("document hidden. video paused: "+(null===(_=ot(o,wi,"f"))||void 0===_?void 0:_.paused)),["iPhone","iPad","Mac"].includes(Qo.OS)?Ji(o,o1,!0,"f"):Ji(o,o1,o.isVideoPlaying,"f"),o.isVideoLoaded()&&"opened"==o.state)){if(["iPhone","iPad","Mac"].includes(Qo.OS)&&Qo.version>=17)return;o.pause()}})),wD.set(this,!1),(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia)||setTimeout(()=>{mi.onWarning&&mi.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),n instanceof HTMLVideoElement&&this.setVideoEl(n),Ji(this,$s,new z6e,"f"),this.imageDataGetter=new ci,document.addEventListener("visibilitychange",ot(this,xD,"f"))}setVideoEl(n){if(!(n&&n instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");n.addEventListener("play",ot(this,yD,"f")),n.addEventListener("pause",ot(this,_D,"f")),Ji(this,wi,n,"f")}getVideoEl(){return ot(this,wi,"f")}releaseVideoEl(){var n,o;null===(n=ot(this,wi,"f"))||void 0===n||n.removeEventListener("play",ot(this,yD,"f")),null===(o=ot(this,wi,"f"))||void 0===o||o.removeEventListener("pause",ot(this,_D,"f")),Ji(this,wi,null,"f")}isVideoLoaded(){return!!ot(this,wi,"f")&&4==ot(this,wi,"f").readyState}open(){var n=this;return Fe(function*(){if(ot(n,kp,"f")&&!ot(n,af,"f")){if("pending"===ot(n,su,"f"))return ot(n,kp,"f");if("fulfilled"===ot(n,su,"f"))return}ot(n,$s,"f").fire("before:open",null,{target:n}),yield ot(n,Fn,"m",s1).call(n),ot(n,$s,"f").fire("opened",null,{target:n,async:!0}),ot(n,$s,"f").fire("played",null,{target:n,async:!0})})()}close(){var n=this;return Fe(function*(){if("closed"===n.state)return;ot(n,$s,"f").fire("before:close",null,{target:n});const o=ot(n,kp,"f");if(ot(n,Fn,"m",SD).call(n),o&&"pending"===ot(n,su,"f")){try{yield o}catch(h){}if(!1===ot(n,af,"f")){const h=new Error("'close()' was interrupted.");throw h.name="AbortError",h}}Ji(n,kp,null,"f"),Ji(n,su,null,"f"),ot(n,$s,"f").fire("closed",null,{target:n,async:!0})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");ot(this,wi,"f").pause()}resume(){var n=this;return Fe(function*(){if(!n.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==n.state)throw new Error("Camera or video is not open.");yield ot(n,wi,"f").play()})()}setCamera(n){var o=this;return Fe(function*(){if("string"!=typeof n)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof ot(o,Qr,"f").video&&(ot(o,Qr,"f").video={}),delete ot(o,Qr,"f").video.facingMode,ot(o,Qr,"f").video.deviceId={exact:n},!("closed"===o.state||o.videoSrc||"opening"===o.state&&ot(o,af,"f"))){ot(o,$s,"f").fire("before:camera:change",[],{target:o,async:!1}),yield ot(o,Fn,"m",Ow).call(o);try{o.resetSoftwareScale()}catch(h){}return ot(o,td,"f")}})()}switchToFrontCamera(n){var o=this;return Fe(function*(){if("object"!=typeof ot(o,Qr,"f").video&&(ot(o,Qr,"f").video={}),(null==n?void 0:n.resolution)&&(ot(o,Qr,"f").video.width={ideal:n.resolution.width},ot(o,Qr,"f").video.height={ideal:n.resolution.height}),delete ot(o,Qr,"f").video.deviceId,ot(o,Qr,"f").video.facingMode={exact:"user"},Ji(o,Rp,null,"f"),!("closed"===o.state||o.videoSrc||"opening"===o.state&&ot(o,af,"f"))){ot(o,$s,"f").fire("before:camera:change",[],{target:o,async:!1}),ot(o,Fn,"m",Ow).call(o);try{o.resetSoftwareScale()}catch(h){}return ot(o,td,"f")}})()}getCamera(){var n;if(ot(this,td,"f"))return ot(this,td,"f");{let o=(null===(n=ot(this,Qr,"f").video)||void 0===n?void 0:n.deviceId)||"";if(o){o=o.exact||o.ideal||o;for(let h of this._arrCameras)if(h.deviceId===o)return JSON.parse(JSON.stringify(h))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(n){var o=this;return Fe(function*(){var h,v;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let y;if(n){let w=yield navigator.mediaDevices.getUserMedia({video:!0});y=(yield navigator.mediaDevices.enumerateDevices()).filter(I=>"videoinput"===I.kind),w.getTracks().forEach(I=>{I.stop()})}else y=(yield navigator.mediaDevices.enumerateDevices()).filter(w=>"videoinput"===w.kind);const _=[],b=[];if(o._arrCameras)for(let w of o._arrCameras)w._checked&&b.push(w);for(let w=0;w<y.length;w++){let I,A=y[w];for(let M of b)if(A.deviceId==M.deviceId){I=M;break}I||(I={deviceId:A.deviceId,label:A.label?A.label:"camera "+w,_checked:!1}),I.deviceId&&_.push(I)}return o._arrCameras=_,mi._onLog&&mi._onLog(JSON.stringify(o._arrCameras)),_})()}getCameras(){var n=this;return Fe(function*(){var o,h;if(!(null===(h=null===(o=null==window?void 0:window.navigator)||void 0===o?void 0:o.mediaDevices)||void 0===h?void 0:h.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const v=(yield navigator.mediaDevices.enumerateDevices()).filter(y=>"videoinput"===y.kind);return n._getCameras(!(!v||!v.length||v[0].deviceId))})()}getAllCameras(){var n=this;return Fe(function*(){return n.getCameras()})()}setResolution(n,o,h){var v=this;return Fe(function*(){if("number"!=typeof n||n<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof o||o<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof ot(v,Qr,"f").video&&(ot(v,Qr,"f").video={}),h?(ot(v,Qr,"f").video.width={exact:n},ot(v,Qr,"f").video.height={exact:o}):(ot(v,Qr,"f").video.width={ideal:n},ot(v,Qr,"f").video.height={ideal:o}),"closed"===v.state||v.videoSrc||"opening"===v.state&&ot(v,af,"f"))return null;ot(v,$s,"f").fire("before:resolution:change",[],{target:v,async:!1}),yield ot(v,Fn,"m",Ow).call(v);try{v.resetSoftwareScale()}catch(_){}const y=v.getResolution();return{width:y.width,height:y.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&ot(this,wi,"f"))return{width:ot(this,wi,"f").videoWidth,height:ot(this,wi,"f").videoHeight};if(ot(this,ar,"f")){const n=ot(this,ar,"f").getSettings();return{width:n.width,height:n.height}}if(this.isVideoLoaded())return{width:ot(this,wi,"f").videoWidth,height:ot(this,wi,"f").videoHeight};{const n={width:0,height:0};let o=ot(this,Qr,"f").video.width||0,h=ot(this,Qr,"f").video.height||0;return o&&(n.width=o.exact||o.ideal||o),h&&(n.height=h.exact||h.ideal||h),n}}getResolutions(n){var o=this;return Fe(function*(){var h,v,y,_,b,w,I,A,M,F,V;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let B="";const Q=(J,Z)=>{const re=ot(o,s0,"f").get(J);if(!re||!re.length)return!1;for(let se of re)if(se.width===Z.width&&se.height===Z.height)return!0;return!1};if(o._mediaStream){B=null===(V=ot(o,td,"f"))||void 0===V?void 0:V.deviceId;let J=ot(o,s0,"f").get(B);if(J&&!n)return JSON.parse(JSON.stringify(J));J=[],ot(o,s0,"f").set(B,J),Ji(o,n1,!0,"f");try{for(let Z of o.detectedResolutions){yield ot(o,ar,"f").applyConstraints({width:{ideal:Z.width},height:{ideal:Z.height}}),ot(o,Fn,"m",rh).call(o);const re=ot(o,ar,"f").getSettings(),se={width:re.width,height:re.height};Q(B,se)||J.push({width:se.width,height:se.height})}}catch(Z){throw ot(o,Fn,"m",SD).call(o),Ji(o,n1,!1,"f"),Z}try{yield ot(o,Fn,"m",s1).call(o)}catch(Z){if("AbortError"===Z.name)return J;throw Z}finally{Ji(o,n1,!1,"f")}return J}{const J=function(){var se=Fe(function*(ce,pe,Ce){const Ve={video:{deviceId:{exact:ce},width:{ideal:pe},height:{ideal:Ce}}};let te=null;try{te=yield navigator.mediaDevices.getUserMedia(Ve)}catch(Le){return null}if(!te)return null;const Me=te.getVideoTracks();let we=null;try{const Le=Me[0].getSettings();we={width:Le.width,height:Le.height}}catch(Le){const j=document.createElement("video");j.srcObject=te,we={width:j.videoWidth,height:j.videoHeight},j.srcObject=null}return Me.forEach(Le=>{Le.stop()}),we});return function(pe,Ce,Ve){return se.apply(this,arguments)}}();let Z=(null===(b=null===(_=null===(y=ot(o,Qr,"f"))||void 0===y?void 0:y.video)||void 0===_?void 0:_.deviceId)||void 0===b?void 0:b.exact)||(null===(A=null===(I=null===(w=ot(o,Qr,"f"))||void 0===w?void 0:w.video)||void 0===I?void 0:I.deviceId)||void 0===A?void 0:A.ideal)||(null===(F=null===(M=ot(o,Qr,"f"))||void 0===M?void 0:M.video)||void 0===F?void 0:F.deviceId);if(!Z)return[];let re=ot(o,s0,"f").get(Z);if(re&&!n)return JSON.parse(JSON.stringify(re));re=[],ot(o,s0,"f").set(Z,re);for(let se of o.detectedResolutions){const ce=yield J(Z,se.width,se.height);ce&&!Q(Z,ce)&&re.push({width:ce.width,height:ce.height})}return re}})()}setMediaStreamConstraints(n,o){var h=this;return Fe(function*(){if(null===(v=n)||"[object Object]"!==Object.prototype.toString.call(v))throw new TypeError("Invalid 'mediaStreamConstraints'.");var v;Ji(h,Qr,JSON.parse(JSON.stringify(n)),"f"),Ji(h,Rp,null,"f"),o&&ot(h,Fn,"m",Ow).call(h)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(ot(this,Qr,"f")))}resetMediaStreamConstraints(){Ji(this,Qr,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!ot(this,ar,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return ot(this,ar,"f").getCapabilities?ot(this,ar,"f").getCapabilities():{}}getCameraSettings(){if(!ot(this,ar,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return ot(this,ar,"f").getSettings()}turnOnTorch(){var n=this;return Fe(function*(){if(!ot(n,ar,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const o=n.getCameraCapabilities();if(!(null==o?void 0:o.torch))throw Error("Not supported.");yield ot(n,ar,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var n=this;return Fe(function*(){if(!ot(n,ar,"f")||"opened"!==n.state)throw new Error("Camera is not open.");const o=n.getCameraCapabilities();if(!(null==o?void 0:o.torch))throw Error("Not supported.");yield ot(n,ar,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!ot(h,ar,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.colorTemperature;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=gc(n,y.min,y.step,y.max)),yield ot(h,ar,"f").applyConstraints({advanced:[{colorTemperature:n,whiteBalanceMode:"manual"}]}),n})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!ot(h,ar,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.exposureCompensation;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=gc(n,y.min,y.step,y.max)),yield ot(h,ar,"f").applyConstraints({advanced:[{exposureCompensation:n}]}),n})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(!ot(h,ar,"f")||"opened"!==h.state)throw new Error("Camera is not open.");let y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.frameRate;if(!y)throw Error("Not supported.");o&&(n<y.min?n=y.min:n>y.max&&(n=y.max));const _=h.getResolution();return yield ot(h,ar,"f").applyConstraints({width:{ideal:Math.max(_.width,_.height)},frameRate:n}),n})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(n,o){var h=this;return Fe(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if(!ot(h,ar,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const v=h.getCameraCapabilities(),y=null==v?void 0:v.focusMode,_=null==v?void 0:v.focusDistance;if(!y)throw Error("Not supported.");if("string"!=typeof n.mode)throw TypeError("Invalid 'mode'.");const b=n.mode.toLowerCase();if(!y.includes(b))throw Error("Unsupported focus mode.");if("manual"===b){if(!_)throw Error("Manual focus unsupported.");if(n.hasOwnProperty("distance")){let w=n.distance;o&&(w<_.min?w=_.min:w>_.max&&(w=_.max),w=gc(w,_.min,_.step,_.max)),h._focusParameters.focusArea=null,yield ot(h,ar,"f").applyConstraints({advanced:[{focusMode:b,focusDistance:w}]})}else{if(!n.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const w=n.area.centerPoint;let I=n.area.width,A=n.area.height;if(!I||!A){const M=h.getResolution();I||(I=2*Math.round(Math.min(M.width,M.height)/h._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),A||(A=2*Math.round(Math.min(M.width,M.height)/h._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}h._focusParameters.focusArea={centerPoint:{x:w.x,y:w.y},width:I,height:A},yield ot(h,Fn,"m",DL).call(h,w,I,A)}}}else h._focusParameters.focusArea=null,yield ot(h,ar,"f").applyConstraints({advanced:[{focusMode:b}]})})()}getFocus(){const n=this.getCameraSettings(),o=n.focusMode;return o?"manual"===o?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:n.focusDistance}:{mode:o}:null}enableTapToFocus(){var n=this;return Fe(function*(){Ji(n,i1,!0,"f")})()}disableTapToFocus(){Ji(this,i1,!1,"f")}isTapToFocusEnabled(){return ot(this,i1,"f")}setZoom(n){var o=this;return Fe(function*(){if("object"!=typeof n||Array.isArray(n)||null==n)throw new TypeError("Invalid 'settings'.");if("number"!=typeof n.factor)throw new TypeError("Illegal type of 'factor'.");if(n.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==o.state)throw new Error("Video is not playing.");n.centerPoint?ot(o,Fn,"m",AL).call(o,n.centerPoint):o.resetScaleCenter();try{if(ot(o,Fn,"m",cne).call(o,ot(o,Op,"f"))){const h=yield o.setHardwareScale(n.factor,!0);let v=o.getHardwareScale();1==v&&1!=h&&(v=h),o.setSoftwareScale(n.factor>v?n.factor/v:1)}else yield o.setHardwareScale(1),o.setSoftwareScale(n.factor)}catch(h){const v=h.message||h;if("Not supported."!==v&&"Camera is not open."!==v)throw h;o.setSoftwareScale(n.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let n=1;try{n=this.getHardwareScale()}catch(o){if("Camera is not open."!==(o.message||o))throw o}return{factor:n*ot(this,Mp,"f")}}resetZoom(){var n=this;return Fe(function*(){yield n.setZoom({factor:1})})()}setHardwareScale(n,o){var h=this;return Fe(function*(){var v;if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if(!ot(h,ar,"f")||"opened"!==h.state)throw new Error("Camera is not open.");const y=null===(v=h.getCameraCapabilities())||void 0===v?void 0:v.zoom;if(!y)throw Error("Not supported.");return o&&(n<y.min?n=y.min:n>y.max&&(n=y.max),n=gc(n,y.min,y.step,y.max)),yield ot(h,ar,"f").applyConstraints({advanced:[{zoom:n}]}),n})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(n,o){if("number"!=typeof n)throw new TypeError("Invalid 'value'.");if(n<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");o&&ot(this,Fn,"m",AL).call(this,o),Ji(this,Mp,n,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return ot(this,Mp,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();Ji(this,Op,{x:n.width/2,y:n.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(n){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||ot(this,n1,"f"))return null;const o=Date.now();mi._onLog&&mi._onLog("getFrameData() START: "+o);const h=ot(this,wi,"f").videoWidth,v=ot(this,wi,"f").videoHeight;let y={sx:0,sy:0,sWidth:h,sHeight:v,dWidth:h,dHeight:v};(null==n?void 0:n.position)&&(y=JSON.parse(JSON.stringify(n.position)));let _=zr.RGBA;(null==n?void 0:n.pixelFormat)&&(_=n.pixelFormat);let b=ot(this,Mp,"f");(null==n?void 0:n.scale)&&(b=n.scale);let w=ot(this,Op,"f");if(null==n?void 0:n.scaleCenter){if("string"!=typeof n.scaleCenter.x||"string"!=typeof n.scaleCenter.y)throw new Error("Invalid scale center.");let F=0,V=0;if(n.scaleCenter.x.endsWith("px"))F=parseFloat(n.scaleCenter.x);else{if(!n.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");F=parseFloat(n.scaleCenter.x)/100*h}if(n.scaleCenter.y.endsWith("px"))V=parseFloat(n.scaleCenter.y);else{if(!n.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");V=parseFloat(n.scaleCenter.y)/100*v}if(isNaN(F)||isNaN(V))throw new Error("Invalid scale center.");w.x=Math.round(F),w.y=Math.round(V)}let I=null;if((null==n?void 0:n.bufferContainer)&&(I=n.bufferContainer),0==h||0==v)return null;1!==b&&(y.sWidth=Math.round(y.sWidth/b),y.sHeight=Math.round(y.sHeight/b),y.sx=Math.round((1-1/b)*w.x+y.sx/b),y.sy=Math.round((1-1/b)*w.y+y.sy/b));const A=this.imageDataGetter.getImageData(ot(this,wi,"f"),h,v,y,{pixelFormat:_,bufferContainer:I});if(!A)return null;const M=Date.now();return mi._onLog&&mi._onLog("getFrameData() END: "+M),{data:A.data,width:A.width,height:A.height,pixelFormat:A.pixelFormat,timeSpent:M-o,timeStamp:M,toCanvas:ot(this,SL,"f")}}on(n,o){if(!ot(this,TL,"f").includes(n.toLowerCase()))throw new Error(`Event '${n}' does not exist.`);ot(this,$s,"f").on(n,o)}off(n,o){ot(this,$s,"f").off(n,o)}dispose(){var n=this;return Fe(function*(){n.tapFocusEventBoundEl=null,yield n.close(),n.releaseVideoEl(),ot(n,$s,"f").dispose(),n.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",ot(n,xD,"f")),Ji(n,wD,!0,"f")})()}}function Y6e(p,n){$t(n)&&(p.config.maxFrameNumber=n)}function X6e(p,n){$t(n)&&(p.config.autoCaptureDelay=n)}function $6e(p,n){if(!As(n))return;const{context:o}=p.viewer;o.core.detectorService.enableDetect&&(p.config.enableAutoDetect=n,p.isVideoPlaying&&(p.viewer.hooks.autoDetectChanged.emit(MF.create(n)),n?p.loop.startLoop():p.config.enableAutoCapture?p.loop.cancelAnimation():p.loop.closeLoop()))}function q6e(p,n){As(n)&&(p.config.enableAutoCapture=n,p.isVideoPlaying&&(p.viewer.hooks.autoCaptureChanged.emit(kF.create(n)),n?p.loop.startLoop():p.config.enableAutoDetect||p.loop.closeLoop()))}function K6e(p,n){$t(n)&&(p.config.acceptedPolygonConfidence=n)}function J6e(p,n){return!!p.videoEl&&(p.config.fullscreen=n,p.videoEl.style.objectFit=n?"cover":"contain",p.loop.updateVideoLayout(),!0)}wi=new WeakMap,ar=new WeakMap,yD=new WeakMap,_D=new WeakMap,Qr=new WeakMap,td=new WeakMap,Rp=new WeakMap,kw=new WeakMap,CD=new WeakMap,af=new WeakMap,kp=new WeakMap,su=new WeakMap,n1=new WeakMap,i1=new WeakMap,Mw=new WeakMap,bD=new WeakMap,r1=new WeakMap,o0=new WeakMap,Mp=new WeakMap,Op=new WeakMap,SL=new WeakMap,$s=new WeakMap,TL=new WeakMap,s0=new WeakMap,o1=new WeakMap,xD=new WeakMap,wD=new WeakMap,Fn=new WeakSet,lne=function(){var p=Fe(function*(){var n=this;const o=this.getMediaStreamConstraints();if("boolean"==typeof o.video&&(o.video={}),!o.video.deviceId)if(ot(this,Rp,"f"))delete o.video.facingMode,o.video.deviceId={exact:ot(this,Rp,"f")};else if(this.ifSaveLastUsedCamera&&mi.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete o.video.facingMode,o.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const h=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),v=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));h&&v&&(o.video.width=h,o.video.height=v)}else if(!this.ifSkipCameraInspection){const h=function(){var _=Fe(function*(b){let w=null;return"environment"===b&&["Android","HarmonyOS","iPhone","iPad"].includes(Qo.OS)?(yield n._getCameras(!1),ot(n,Fn,"m",rh).call(n),w=mi.findBestCamera(n._arrCameras,"environment",{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})):b||["Android","HarmonyOS","iPhone","iPad"].includes(Qo.OS)||(yield n._getCameras(!1),ot(n,Fn,"m",rh).call(n),w=mi.findBestCamera(n._arrCameras,null,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault})),w});return function(w){return _.apply(this,arguments)}}();let v=o.video.facingMode;v instanceof Array&&v.length&&(v=v[0]),"object"==typeof v&&(v=v.exact||v.ideal);const y=yield h(v);y&&(delete o.video.facingMode,o.video.deviceId={exact:y})}return o});return function(){return p.apply(this,arguments)}}(),rh=function(){if(ot(this,af,"f")){const p=new Error("The operation was interrupted.");throw p.name="AbortError",p}},IL=function(){var p=Fe(function*(n){var h,v,o=this;if(!(null===(v=null===(h=null==window?void 0:window.navigator)||void 0===h?void 0:h.mediaDevices)||void 0===v?void 0:v.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let y;try{mi._onLog&&mi._onLog("======try getUserMedia========");let _=[0,500],b=null;const w=function(){var I=Fe(function*(A){for(let M of _){M&&(yield new Promise(F=>setTimeout(F,M)),ot(o,Fn,"m",rh).call(o));try{mi._onLog&&mi._onLog("ask "+JSON.stringify(A)),y=yield navigator.mediaDevices.getUserMedia(A),ot(o,Fn,"m",rh).call(o);break}catch(F){if("NotFoundError"===F.name||"NotAllowedError"===F.name||"AbortError"===F.name||"OverconstrainedError"===F.name)throw F;b=F,mi._onLog&&mi._onLog(F.message||F)}}});return function(M){return I.apply(this,arguments)}}();if(yield w(n),y||(mi._onLog&&mi._onLog("======try getUserMedia again========"),mi._onLog&&mi._onLog(n),yield w(n)),y||(_=[1e3,2e3],yield w(n)),y||(yield w(n)),!y)throw b;return y}catch(_){throw null==y||y.getTracks().forEach(b=>{b.stop()}),"NotFoundError"===_.name&&(DOMException?_=new DOMException("No camera available, please use a device with an accessible camera.",_.name):(_=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),_}});return function(o){return p.apply(this,arguments)}}(),EL=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(p=>{p.stop()}),this._mediaStream=null),Ji(this,ar,null,"f")},s1=function(){var p=Fe(function*(){var n=this;Ji(this,af,!1,"f");const o=Ji(this,CD,Symbol(),"f");if(ot(this,kp,"f")&&"pending"===ot(this,su,"f")){try{yield ot(this,kp,"f")}catch(v){}ot(this,Fn,"m",rh).call(this)}return o!==ot(this,CD,"f")?void 0:Ji(this,kp,Fe(function*(){Ji(n,su,"pending","f");try{if(n.videoSrc){if(!ot(n,wi,"f"))throw new Error("'videoEl' should be set.");yield mi.playVideo(ot(n,wi,"f"),n.videoSrc,n.cameraOpenTimeout),ot(n,Fn,"m",rh).call(n)}else{let v=yield ot(n,Fn,"m",lne).call(n);ot(n,Fn,"m",EL).call(n);let y=yield ot(n,Fn,"m",IL).call(n,v);yield n._getCameras(!1),ot(n,Fn,"m",rh).call(n);const _=()=>{const A=y.getVideoTracks();let M,F;if(A.length&&(M=A[0]),M){const V=M.getSettings();if(V)for(let B of n._arrCameras)if(V.deviceId===B.deviceId){B._checked=!0,B.label=M.label,F=B;break}}return F},b=ot(n,Qr,"f");if("object"==typeof b.video){let A=b.video.facingMode;if(A instanceof Array&&A.length&&(A=A[0]),"object"==typeof A&&(A=A.exact||A.ideal),!(ot(n,Rp,"f")||n.ifSaveLastUsedCamera&&mi.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||n.ifSkipCameraInspection||b.video.deviceId)){const M=_(),F=mi.findBestCamera(n._arrCameras,A,{getMainCameraInIOS:n.selectIOSRearMainCameraAsDefault});F&&F!=(null==M?void 0:M.deviceId)&&(y.getTracks().forEach(V=>{V.stop()}),v.video.deviceId={exact:F},y=yield ot(n,Fn,"m",IL).call(n,v),ot(n,Fn,"m",rh).call(n))}}const w=_();(null==w?void 0:w.deviceId)&&(Ji(n,Rp,w&&w.deviceId,"f"),n.ifSaveLastUsedCamera&&mi.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",ot(n,Rp,"f")),"object"==typeof v.video&&v.video.width&&v.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(v.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(v.video.height))))),ot(n,wi,"f")&&(yield mi.playVideo(ot(n,wi,"f"),y,n.cameraOpenTimeout),ot(n,Fn,"m",rh).call(n)),n._mediaStream=y;const I=y.getVideoTracks();(null==I?void 0:I.length)&&Ji(n,ar,I[0],"f"),Ji(n,td,w,"f")}}catch(v){throw ot(n,Fn,"m",SD).call(n),Ji(n,su,null,"f"),v}Ji(n,su,"fulfilled","f")})(),"f")});return function(){return p.apply(this,arguments)}}(),Ow=function(){var p=Fe(function*(){var n;if("closed"===this.state||this.videoSrc)return;const o=null===(n=ot(this,td,"f"))||void 0===n?void 0:n.deviceId,h=this.getResolution();yield ot(this,Fn,"m",s1).call(this);const v=this.getResolution();o&&o!==ot(this,td,"f").deviceId&&ot(this,$s,"f").fire("camera:changed",[ot(this,td,"f").deviceId,o],{target:this,async:!0}),h.width==v.width&&h.height==v.height||ot(this,$s,"f").fire("resolution:changed",[{width:v.width,height:v.height},{width:h.width,height:h.height}],{target:this,async:!0}),ot(this,$s,"f").fire("played",null,{target:this,async:!0})});return function(){return p.apply(this,arguments)}}(),SD=function(){ot(this,Fn,"m",EL).call(this),Ji(this,td,null,"f"),ot(this,wi,"f")&&(ot(this,wi,"f").srcObject=null,this.videoSrc&&(ot(this,wi,"f").pause(),ot(this,wi,"f").currentTime=0)),Ji(this,af,!0,"f");try{this.resetSoftwareScale()}catch(p){}},au=function(){var p=Fe(function*(o,h){const v=J=>{if(!ot(this,ar,"f")||!this.isVideoPlaying||J.focusTaskId!=this._focusParameters.curFocusTaskId){ot(this,ar,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const Z=new Error(`Focus task ${J.focusTaskId} canceled.`);throw Z.name="DeprecatedTaskError",Z}1===this._focusParameters.isDoingFocus&&Date.now()-J.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let y;h=gc(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield ot(this,ar,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]}),v(o),y=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/h),Math.abs(1/this._focusParameters.fds.max-1/h))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/h)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=h,yield new Promise(J=>{setTimeout(J,y)}),v(o);let _=o.focusL-o.focusW/2,b=o.focusT-o.focusH/2,w=o.focusW,I=o.focusH;const A=this.getResolution();if(_>=A.width||b>=A.height)throw new Error("Invalid area.");_+w>A.width&&(w=A.width-_),b+I>A.height&&(I=A.height-b),_=Math.round(_),b=Math.round(b),w=Math.round(w),I=Math.round(I);const M=4*A.width*A.height*this._focusParameters.defaultTempBufferContainerLenRatio,F=4*w*I;let V=this._focusParameters.tempBufferContainer;if(V){const J=V.length;M>J&&M>=F?V=new Uint8Array(M):F>J&&F>=M&&(V=new Uint8Array(F))}else V=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(M,F));if(!this.imageDataGetter.getImageData(ot(this,wi,"f"),A.width,A.height,{sx:_,sy:b,sWidth:w,sHeight:I,dWidth:w,dHeight:I},{pixelFormat:zr.RGBA,bufferContainer:V}))return ot(this,Fn,"m",n).call(this,o,h);const B=V;let Q=0;for(let J=0,Z=F-8;J<Z;++J){let re=B[J]-B[J+8];++J;let se=B[J]-B[J+8];++J;let ce=B[J]-B[J+8];++J,Q+=re*re+se*se+ce*ce}return-Q});function n(o,h){return p.apply(this,arguments)}return n}(),a1=function(){var p=Fe(function*(o,h,v,y,_,b,w){let I;if(h=gc(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y=gc(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b?b=gc(b,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(b=gc(Math.sqrt((h||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),w=yield ot(this,Fn,"m",au).call(this,o,b)),w<=v&&w<=_?I=3:v<_&&v<w?I=1:_<v&&_<w&&(I=2),(y-h)/2<=this._focusParameters.fds.step)return 3===I||(1===I?yield ot(this,ar,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]}):2===I&&(yield ot(this,ar,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:y}]}))),!0;if(1===I)return yield ot(this,Fn,"m",n).call(this,o,h,v,b,w);if(2===I)return yield ot(this,Fn,"m",n).call(this,o,b,w,y,_);if(3!==I)return v=yield ot(this,Fn,"m",au).call(this,o,h),_=yield ot(this,Fn,"m",au).call(this,o,y),yield ot(this,Fn,"m",n).call(this,o,h,v,y,_);let A=gc(Math.sqrt((h||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),M=gc(Math.sqrt((y||this._focusParameters.fds.step)*(b||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/A)<=Math.abs(1/this._focusParameters.oldDistance-1/M)){let F=yield ot(this,Fn,"m",au).call(this,o,A);if(F<w)return yield ot(this,Fn,"m",n).call(this,o,h,v,b,w,A,F);if(F==w)return yield ot(this,Fn,"m",n).call(this,o,A,F,b,w);let V=yield ot(this,Fn,"m",au).call(this,o,M);if(F>w&&w<V)return yield ot(this,Fn,"m",n).call(this,o,A,F,M,V,b,w);if(w==V)return yield ot(this,Fn,"m",n).call(this,o,b,w,M,V);if(w>V)return yield ot(this,Fn,"m",n).call(this,o,b,w,y,_,M,V)}else{let F=yield ot(this,Fn,"m",au).call(this,o,M);if(w>F)return yield ot(this,Fn,"m",n).call(this,o,b,w,y,_,M,F);if(w==F)return yield ot(this,Fn,"m",n).call(this,o,b,w,M,F);let V=yield ot(this,Fn,"m",au).call(this,o,A);if(V>w&&w<F)return yield ot(this,Fn,"m",n).call(this,o,A,V,M,F,b,w);if(V==w)return yield ot(this,Fn,"m",n).call(this,o,A,V,b,w);if(V<w)return yield ot(this,Fn,"m",n).call(this,o,h,v,b,w,A,V)}return!1});function n(o,h,v,y,_,b,w){return p.apply(this,arguments)}return n}(),DL=function(){var p=Fe(function*(n,o,h,v,y){var b,_=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!n||"string"!=typeof n.x||"string"!=typeof n.y)throw new Error("Invalid 'centerPoint'.");if(!o||"string"!=typeof o)throw new Error("Invalid 'width'.");if(!h||"string"!=typeof h)throw new Error("Invalid 'height'.");const w=this.getResolution();let I=0,A=0;if(n.x.endsWith("px"))I=parseFloat(n.x);else{if(!n.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");I=parseFloat(n.x)/100*w.width}if(n.y.endsWith("px"))A=parseFloat(n.y);else{if(!n.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");A=parseFloat(n.y)/100*w.height}if(isNaN(I)||isNaN(A)||I<0||I>w.width||A<0||A>w.height)throw new Error("Invalid 'centerPoint'.");let M=0;if(o.endsWith("px"))M=parseFloat(o);else{if(!o.endsWith("%"))throw new Error("Invalid 'width'.");M=parseFloat(o)/100*w.width}if(isNaN(M)||M<0)throw new Error("Invalid 'width'.");let F=0;if(h.endsWith("px"))F=parseFloat(h);else{if(!h.endsWith("%"))throw new Error("Invalid 'height'.");F=parseFloat(h)/100*w.height}if(isNaN(F)||F<0)throw new Error("Invalid 'height'.");if(1!==ot(this,Mp,"f")){const Q=ot(this,Mp,"f"),J=ot(this,Op,"f");M/=Q,F/=Q,I=(1-1/Q)*J.x+I/Q,A=(1-1/Q)*J.y+A/Q}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(b=this.getCameraCapabilities())||void 0===b?void 0:b.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const V={focusL:I,focusT:A,focusW:M,focusH:F,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},B=function(){var Q=Fe(function*(J,Z,re){try{(null==Z||Z<_._focusParameters.fds.min)&&(Z=_._focusParameters.fds.min),(null==re||re>_._focusParameters.fds.max)&&(re=_._focusParameters.fds.max),_._focusParameters.oldDistance=null;let se=gc(Math.sqrt(re*(Z||_._focusParameters.fds.step)),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),ce=gc(Math.sqrt((Z||_._focusParameters.fds.step)*se),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),pe=gc(Math.sqrt(se*re),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),Ce=yield ot(_,Fn,"m",au).call(_,J,pe),Ve=yield ot(_,Fn,"m",au).call(_,J,ce),te=yield ot(_,Fn,"m",au).call(_,J,se);if(Ve>te&&te<Ce){const Me=yield ot(_,Fn,"m",a1).call(_,J,ce,Ve,pe,Ce,se,te);return _._focusParameters.isDoingFocus=0,Me}if(Ve<te&&Ve<Ce){let Me=yield ot(_,Fn,"m",au).call(_,J,Z);const we=yield ot(_,Fn,"m",a1).call(_,J,Z,Me,se,te,ce,Ve);return _._focusParameters.isDoingFocus=0,we}if(te>Ce&&Ve>Ce){let Me=yield ot(_,Fn,"m",au).call(_,J,re);const we=yield ot(_,Fn,"m",a1).call(_,J,se,te,re,Me,pe,Ce);return _._focusParameters.isDoingFocus=0,we}if(Ve==te&&te<Ce){const Me=yield ot(_,Fn,"m",a1).call(_,J,ce,Ve,se,te);return _._focusParameters.isDoingFocus=0,Me}if(te==Ce&&Ve>te){const Me=yield ot(_,Fn,"m",a1).call(_,J,se,te,pe,Ce);return _._focusParameters.isDoingFocus=0,Me}return B(J,Z,re)}catch(se){if("DeprecatedTaskError"!==se.name)throw se}});return function(Z,re,se){return Q.apply(this,arguments)}}();return B(V,v,y)});return function(o,h,v,y,_){return p.apply(this,arguments)}}(),AL=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");if(!p||"string"!=typeof p.x||"string"!=typeof p.y)throw new Error("Invalid 'center'.");const n=this.getResolution();let o=0,h=0;if(p.x.endsWith("px"))o=parseFloat(p.x);else{if(!p.x.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(p.x)/100*n.width}if(p.y.endsWith("px"))h=parseFloat(p.y);else{if(!p.y.endsWith("%"))throw new Error("Invalid scale center.");h=parseFloat(p.y)/100*n.height}if(isNaN(o)||isNaN(h))throw new Error("Invalid scale center.");Ji(this,Op,{x:o,y:h},"f")},cne=function(p){if("opened"!==this.state)throw new Error("Video is not playing.");const n=this.getResolution();return p&&p.x==n.width/2&&p.y==n.height/2},mi.browserInfo=Qo,mi.onWarning=null===(wL=null==window?void 0:window.console)||void 0===wL?void 0:wL.warn;class Q6e{constructor(n){W(this,"isLooping",!1),W(this,"lastDetectTime",(new Date).getTime()),W(this,"loopTimer",void 0),W(this,"autoCaptureStartTime",0),W(this,"lastRenderedQuad",void 0),W(this,"animation",void 0),W(this,"cameraContext",void 0),W(this,"videoLayout",void 0),this.cameraContext=n}getLoopState(){const{enableAutoCapture:n,enableAutoDetect:o}=this.cameraContext.config;return n||o}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime()}loopTimeout(){var n=this;if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const o=this.getDetectRemainTime();this.loopTimer=setTimeout(Fe(function*(){if(!n.getLoopState()||n.isLooping)return;n.isLooping=!0;const h=yield n.loopTaskDetail();n.isLooping=!1,h&&n.getLoopState()&&setTimeout(()=>{n.getLoopState()&&n.loopTimeout()},10)}),o)}loopTaskDetail(){var n=this;return Fe(function*(){if(!(n.cameraContext&&n.cameraContext.isVideoPlaying&&n.cameraContext.videoEl&&n.cameraContext.canvasEl&&n.getLoopState()))return!1;const{viewer:o}=n.cameraContext;if(n.lastDetectTime=(new Date).getTime(),!o.context.viewService.isBindContainer)return!0;if("hidden"===o.getViewerConfig().visibility)return!1;const{config:h}=n.cameraContext,{enableDetect:v}=o.context.core.detectorService,y=n.cameraContext.getFrameData();if(!y)return!1;const _={type:1,data:y.data.buffer,height:y.height,width:y.width};let b={success:!1};var w;v&&(b=yield n.getDetectResult(_),0===y.data.length&&(y.data=new Uint8Array(_.data)),h.enableAutoDetect&&n.cameraContext.isVideoPlaying&&b.success&&null!==(w=b)&&void 0!==w&&w.location?(n.lastRenderedQuad?n.createDetectAnimation(n.lastRenderedQuad,b.location):n.drawQuadrilateral(b.location),n.lastRenderedQuad=b.location):(n.clearCanvas(),n.lastRenderedQuad=null));let I=!1;var A;if(h.enableAutoCapture?((null===(A=b)||void 0===A?void 0:A.status)===Ha.AUTO_CAPTURE&&(I=!0),!v&&(n.autoCaptureStartTime<=0?n.autoCaptureStartTime=(new Date).getTime():(new Date).getTime()-n.autoCaptureStartTime>h.autoCaptureDelay&&(n.autoCaptureStartTime=0,I=!0))):n.autoCaptureStartTime=0,I){var M,F,V;if(null===(M=n.cameraContext.viewer)||void 0===M||!M.context)return!1;const B=yield n.cameraContext.viewer.context.core.processService.resize(y.data.buffer,1,y.width,y.height,-1);if(n.cameraContext.isCapturedPages=!0,null===(F=n.cameraContext.viewer)||void 0===F||!F.context)return!1;yield n.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(V=b)||void 0===V?void 0:V.location}],fileData:B.data}),n.startCaptureAnimation(),yield une(),n.closeCaptureAnimation()}return!0})()}getDetectRemainTime(){const n=(new Date).getTime(),{maxFrameNumber:o}=this.cameraContext.config;return Math.max(0,1e3/o-(n-this.lastDetectTime))}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()))}closeLoop(){if(!this.loopTimer)return;const{context:n}=this.cameraContext.viewer,{detectorService:o}=n.core;o.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation)}updateVideoLayout(){const{videoEl:n,config:o}=this.cameraContext,{fullscreen:h}=o,{videoWidth:v,videoHeight:y}=n,{width:_,height:b}=n.getBoundingClientRect(),w={zoom:1,left:0,top:0};if(h){const I=Math.max(_/v,b/y);w.zoom=I}else{const I=Math.min(_/v,b/y),A=(_-v*I)/2,M=(b-y*I)/2;w.zoom=I,w.left=A,w.top=M}this.videoLayout=w}getDetectResult(n){var o=this;return Fe(function*(){const{cameraContext:h}=o,{context:v}=h.viewer,{detectorService:y}=v.core;if(!y.enableDetect)return Promise.resolve({success:!1});let _=n;if(!n){const F=h.getFrameData();_={type:1,data:F.data.buffer,height:F.height,width:F.width}}const{acceptedPolygonConfidence:b,enableAutoCapture:w,autoCaptureDelay:I}=h.config,A={acceptedPolygonConfidence:b,enableAutoCapture:w,autoCaptureDelay:I};return(yield y.detect(_,A))||Promise.resolve({success:!1})})()}drawQuadrilateral(n){if(!this.loopTimer)return;const{canvasEl:o,viewer:h}=this.cameraContext,{zoom:v,left:y,top:_}=this.videoLayout,b=o.getContext("2d");b.save(),b.clearRect(0,0,o.width,o.height),b.translate(y,_),b.scale(v,v),b.beginPath(),b.moveTo(n[0][0],n[0][1]);for(let J=1;J<n.length;J++)b.lineTo(n[J][0],n[J][1]);b.closePath();const{quadSelectionStyle:w}=h.getViewerConfig(),{border:I,background:A}=w,{borderWidth:M,borderColor:F,borderStyle:V}=Xx(I);let B=ni(M).value/v;0===B&&(B=1);const Q="solid"===V?[0,0]:[5*B,2*B];b.strokeStyle=F,b.fillStyle=A,b.lineCap="round",b.lineWidth=B,b.setLineDash(Q),b.fill(),b.stroke(),b.restore()}clearCanvas(){const{canvasEl:n}=this.cameraContext;!n||n.getContext("2d").clearRect(0,0,n.width,n.height)}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation)}createDetectAnimation(n,o){let h=0;const v=()=>{this.clearCanvas();const y=n.map((_,b)=>{const w=o[b];return[_[0]+(w[0]-_[0])*h,_[1]+(w[1]-_[1])*h]});this.drawQuadrilateral(y),h<1&&(h+=.2,this.animation=requestAnimationFrame(v))};v()}startCaptureAnimation(){var n,o;this.cameraContext&&null!==(n=this.cameraContext)&&void 0!==n&&n.videoEl&&null!==(o=this.cameraContext)&&void 0!==o&&o.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden")}closeCaptureAnimation(){var n,o;this.cameraContext&&null!==(n=this.cameraContext)&&void 0!==n&&n.videoEl&&null!==(o=this.cameraContext)&&void 0!==o&&o.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="")}}function une(){return new Promise(p=>{setTimeout(()=>{p("")},50)})}const Z6e={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},TD={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class eRe{constructor(n){var o;if(W(this,"camera",void 0),W(this,"configHandler",{}),W(this,"isHttps",!0),W(this,"lastDeviceId",void 0),W(this,"userDeviceId",void 0),W(this,"isFirstPlayed",!0),W(this,"isTurningTorch",!1),W(this,"initializing",!1),W(this,"cameraContainer",void 0),W(this,"viewer",void 0),W(this,"loop",void 0),W(this,"videoEl",void 0),W(this,"canvasEl",void 0),W(this,"config",pn(TD)),W(this,"bUser",!1),W(this,"canFrontCamera",!1),W(this,"isCapturedPages",!1),W(this,"lastEnvironmentCameraId",void 0),W(this,"cameraList",[]),W(this,"turnOnTheTorch",!1),W(this,"torchSupported",!1),this.viewer=n,this.camera=new mi,this.loop=new Q6e(this),this.initConfigHandler(),null!==(o=navigator)&&void 0!==o&&null!==(o=o.mediaDevices)&&void 0!==o&&o.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const h=this.getCameras().then(y=>{this.cameraList=y}),v=this.getFrontCamera().then(y=>{this.canFrontCamera=y,this.viewer.hooks.cameraInit.emit(X2.create(y))}).catch(y=>{});Promise.all([h,v]).finally(()=>{this.initializing=!1})}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents()}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks()}handleViewerModeChanged(){const{defaultDom:n,mainAndThbContainer:o}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const h=am(Z6e,this.viewer.postfix);this.cameraContainer=h,Object.assign(h.style,this.viewer.context.viewerConfig.canvasStyle),n.appendChild(h);const v=h.getElementsByTagName("video")[0],y=h.getElementsByTagName("canvas")[0];v.setAttribute("playsinline","true"),v.setAttribute("muted","true"),v.setAttribute("disablePictureInPicture","true"),v.setAttribute("autoplay","autoplay"),v.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),v.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(v),this.bindCameraCanvas(y),this.updateCameraConfig(TD)}tL(this.cameraContainer,"flex"),See(o)}else See(this.cameraContainer),tL(o,"flex")}initConfigHandler(){this.configHandler={maxFrameNumber:Y6e,enableAutoCapture:q6e,enableAutoDetect:$6e,acceptedPolygonConfidence:K6e,fullscreen:J6e,autoCaptureDelay:X6e}}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on(()=>{this.isCaptureViewer&&this.getFrontCamera().then(n=>{this.canFrontCamera=n,this.viewer.hooks.cameraInit.emit(X2.create(n))}),this.handleViewerModeChanged()}),this.viewer.hooks.visibleChanged.on(n=>{this.loop.closeLoop(),"visible"===n.newVisibility&&this.loop.startLoop()})}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on(n=>{if(!this.isCapturedPages)return;const o=sF.create(n.pageUids[0]);this.viewer.emit("captured",o),this.isCapturedPages=!1},this.viewer)}bindCameraEvents(){const{camera:n}=this;n.on("paused",()=>{this.loop.closeLoop()}),n.on("resumed",()=>{this.loop.closeLoop(),this.loop.startLoop()}),n.on("before:open",()=>{this.videoEl&&(this.videoEl.style.opacity="0")}),n.on("before:resolution:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop()}),n.on("before:camera:change",()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId}),n.on("camera:changed",()=>{const o=oF.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",o)}),n.on("played",()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:o}=this.config,h=this.camera.getResolution();let v="unsupported";try{const y=this.camera.getCameraCapabilities();v=null!=y&&y.torch?"supported":"unsupported"}catch(y){}this.torchSupported="supported"===v,this.emitTorchChanged(v),"supported"===v&&o&&this.turnOnTorch().catch(()=>{this.config.enableTorch=!0}),this.viewer.hooks.cameraPlayed.emit(FF.create(h)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop()}),n.on("closed",()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"))})}emitTorchChanged(n){this.viewer.hooks.torchChanged.emit(OF.create(n))}getVPointerEvent(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=0,y=0,_=0,b=0;if(o){const{left:w,top:I}=o.getBoundingClientRect();_=w,b=I}return n instanceof PointerEvent||n instanceof MouseEvent?(v=n.offsetX,y=n.offsetY):h?(v=n.changedTouches[0].clientX-_,y=n.changedTouches[0].clientY-b):(v=n.touches[0].clientX-_,y=n.touches[0].clientY-b),Y2.create(-1,"",-1,-1,Math.floor(v),Math.floor(y),n)}triggerPlayed(n){const o=gF.create(this.camera.getCamera().deviceId,n);this.viewer.emit("played",o)}bindNativeEvents(){const n=this.canvasEl;if(!n)return;const o=b=>{const w=this.getVPointerEvent(b);this.viewer.emit("click",w)},h=b=>{this.viewer.emit("dblclick",this.getVPointerEvent(b))},v=b=>{b.preventDefault();const w=this.getVPointerEvent(b);this.viewer.emit("rightclick",w)},y=()=>{setTimeout(()=>{this.resize()},500)},_=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop())};n.addEventListener("click",o),n.addEventListener("dblclick",h),n.addEventListener("contextmenu",v),document.addEventListener("visibilitychange",_),window.addEventListener("orientationchange",y),this.viewer.hooks.destroy.on(()=>{n.removeEventListener("click",o),n.removeEventListener("dblclick",h),n.removeEventListener("contextmenu",v),document.removeEventListener("visibilitychange",_),window.removeEventListener("orientationchange",y)})}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===Ko.CAPTURE}get isVideoPlaying(){return!!this.camera&&this.camera.isVideoPlaying}getFrontCamera(){var n=this;return Fe(function*(){if(!n.isHttps)return rt.reject(rt.CAMERA_NEED_HTTPS);const o=yield mi.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(o.ok)})()}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const n=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then(()=>(this.bUser=!0,this.lastEnvironmentCameraId=n,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve()))}return this.setCamera(this.lastEnvironmentCameraId).then(()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve()))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:n,height:o}=this.videoEl.getBoundingClientRect(),h=this.videoEl.videoWidth,v=this.videoEl.videoHeight,y=Math.max(n/h,o/v),_=n/(h*y),b=o/(v*y),w=Math.floor((1-_)/2*h),I=Math.floor((1-b)/2*v),A=Math.floor(h*_),M=Math.floor(v*b);return this.camera.getFrameData({position:{sx:w,sy:I,sWidth:A,sHeight:M,dWidth:A,dHeight:M}})}updateCameraConfig(n){for(const[o,h]of Object.entries(n)){const v=this.configHandler[o];v&&!gt(h)&&v(this,h)}}bindCameraVideo(n){n instanceof HTMLVideoElement&&(this.camera.setVideoEl(n),this.videoEl=n)}bindCameraCanvas(n){n instanceof HTMLCanvasElement&&(this.canvasEl=n)}capture(){var n=this;return Fe(function*(){n.loop.startCaptureAnimation(),yield une(),n.loop.closeCaptureAnimation(),rt.verbose(`[${Date.now()}][cv] start capture`);const o=n.getFrameData();if(rt.verbose(`[${Date.now()}][cv] get frame done`),!o)return null;const h={type:1,data:o.data.buffer,width:o.width,height:o.height},v=yield n.loop.getDetectResult(h);rt.verbose(`[${Date.now()}][cv] get detect result done`),0===o.data.length&&(o.data=new Uint8Array(h.data));const y=yield n.viewer.context.core.processService.resize(o.data.buffer,1,o.width,o.height,-1);return rt.verbose(`[${Date.now()}][cv] create image done`),n.isCapturedPages=!0,yield n.viewer.context.loadSource({fileData:y.data,extraPageData:[{index:0,perspectiveQuad:v.success?v.location:void 0}]}),rt.verbose(`[${Date.now()}][cv] capture done`),y.data})()}play(n){var o=this;return Fe(function*(){if(!o.isHttps)return Promise.reject(rt.CAMERA_NEED_HTTPS);if(!n&&o.isVideoPlaying)return Promise.resolve();const{fill:h,resolution:v}=n||{},y=o.camera.getResolution();if(As(h)&&o.updateCameraConfig({fullscreen:h}),o.isVideoPlaying&&dne(v)&&v[0]===y.width&&v[1]===y.height)return Promise.resolve();let _=[y.width,y.height];if(dne(v)){if(o.isVideoPlaying)return o.camera.setResolution(v[0],v[1]).then(b=>(o.resize(),o.triggerPlayed(v),Promise.resolve())).catch();o.camera.setResolution(v[0],v[1]),_=v}return!o.isFirstPlayed||o.isVideoPlaying||v||"opening"===o.camera.state||(o.camera.setResolution(1280,720),_=[1280,720]),o.initializing&&(yield new Promise(b=>{const w=setInterval(()=>{o.initializing||(clearInterval(w),b(""))},100)})),o.isFirstPlayed&&(o.isFirstPlayed=!1),o.camera.open().then(Fe(function*(){return o.resize(),o.triggerPlayed(_),Promise.resolve()})).catch(b=>{let w=rt.CAMERA_OCCUPIED;return"Permission denied"===b.message&&(w=rt.CAMERA_DENIED),8===b.code&&(w=rt.CAMERA_NO_CAMERA),Promise.reject(w)})})()}stop(){var n;this.loop.closeLoop(),this.viewer.emit("stopped",yF.create(this.getCamera().deviceId)),null===(n=this.camera)||void 0===n||n.close()}setCamera(n){var o=this;return Fe(function*(){let h="";Vn(n)?h=n.deviceId||"":Sn(n)&&(h=n);let v=!1;for(let b=0;b<o.cameraList.length;b++)o.cameraList[b].deviceId===h&&(v=!0);if(!v)return Promise.reject(rt.CAMERA_NOT_EXIST);yield o.camera.setCamera(h).catch(b=>{let w=rt.CAMERA_OCCUPIED;"Permission denied"===b.message&&(w=rt.CAMERA_DENIED),8===b.code&&(w=rt.CAMERA_NO_CAMERA),Promise.reject(w)});const y=o.camera.getResolution(),_={deviceId:h,width:y.width,height:y.height};return o.isVideoPlaying&&o.triggerPlayed([y.width,y.height]),Promise.resolve(_)})()}getCamera(){const n=this.camera.getCamera();return{deviceId:n.deviceId,label:n.label}}getCameras(){var n=this;return Fe(function*(){const o=(yield n.camera.getAllCameras()).map(h=>({deviceId:h.deviceId,label:h.label}));return Promise.resolve(o)})()}setResolution(n,o){var h=this;return Fe(function*(){const v=h.camera.getCamera();if(!v||""===v.deviceId)return Promise.reject(rt.CAMERA_NOT_EXIST);let y;if($t(n))y=n;else if(Di(n)){const[b,w]=n;y=b,o=w}let _=h.camera.getResolution();return $t(y)&&$t(o)&&(h.loop.closeLoop(),_=yield h.camera.setResolution(y,o).catch(b=>{})),h.camera&&h.isVideoPlaying&&h.triggerPlayed([_.width,_.height]),Promise.resolve(Ke({deviceId:v.deviceId},_))})()}getResolution(){const n=this.camera.getCamera();if(!n||""===n.deviceId)return[0,0];const o=this.camera.getResolution();return[o.width,o.height]}getResolutions(){var n=this;return Fe(function*(){const o=(yield n.camera.getResolutions()).map(h=>[h.width,h.height]);return Promise.resolve(o)})()}turnOnTorch(){const n=this.camera.getCamera();return n&&""!==n.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then(()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve())).catch(o=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),rt.reject(rt.CAMERA_NOT_SUPPORT_TORCH)))):Promise.reject(rt.CAMERA_NO_VIDEO)}turnOffTorch(){const n=this.camera.getCamera();return n&&""!==n.deviceId?this.camera.turnOffTorch().then(()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve())).catch(o=>rt.reject(rt.CAMERA_NOT_SUPPORT_TORCH)):Promise.reject(rt.CAMERA_NO_VIDEO)}resize(){const{canvasEl:n}=this,{width:o,height:h}=n.getBoundingClientRect();n.width=Math.floor(o),n.height=Math.floor(h),this.loop.updateVideoLayout()}dispose(){var n,o;this.stop(),null===(n=this.loop)||void 0===n||n.closeLoop(),null===(o=this.camera)||void 0===o||o.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null}}function dne(p){return!!(Di(p)&&$t(p[0])&&$t(p[1]))}const tRe={install(p){const n=p.getClass("Viewer"),o=(h=n,class extends h{constructor(v){if(super(v),W(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===Ko.CAPTURE){this.cameraContext=new eRe(this);const y=TD;Vn(v.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach(_=>{_ in v.viewerConfig&&(y[_]=v.viewerConfig[_])}),this.cameraContext.config=zt(Ke({},y),{defaultCameraConfig:TD}),this.on("resized",()=>{this.cameraContext.resize()})}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return pn(this.cameraContext.config)}updateCameraConfig(v){Vn(v)&&this.cameraContext.updateCameraConfig(v)}capture(){return this.cameraContext.capture()}play(v){return this.cameraContext.play(v)}stop(){this.isVideoPlaying()?this.cameraContext.stop():rt.warning(rt.CAMERA_NO_VIDEO)}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(v){return this.cameraContext.setCamera(v)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(v,y){return this.cameraContext.setResolution(v,y)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var v;this.cameraContext&&(null===(v=this.cameraContext)||void 0===v||v.dispose()),this.cameraContext=null,super.dispose()}});var h;p.setClass("Viewer",o)}};class nRe{constructor(n){W(this,"uid",void 0),W(this,"areaUid",void 0),W(this,"isRect",!0),W(this,"vertexes",[]),W(this,"midpoints",[]),W(this,"points",[]),W(this,"keepAspectRatio",!1),W(this,"isConvex",!0),W(this,"renderer",void 0),W(this,"area",void 0),W(this,"slopeRatio",[]),W(this,"selectedPart",-1),W(this,"startX",null),W(this,"startY",null),W(this,"lastX",null),W(this,"lastY",null),W(this,"lastAspectRatio",1),W(this,"b1",void 0),W(this,"b2",void 0),W(this,"k1",void 0),W(this,"k2",void 0),this.uid=Ai(),Object.assign(this,n),this.initBox(n.vertexes)}initBox(n){this.vertexes=n,this.midpoints=PL(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=KE(this.vertexes)}getRect(){if(!this.isRect)return null;const{minX:n,maxX:o,minY:h,maxY:v}=this.getBounds();return{left:n,top:h,width:o-n||1,height:v-h||1}}getQuad(){if(this.isRect)return null;const{points:n}=this,o=[];for(let h=0;h<4;h++)o.push([n[2*h],n[2*h+1]]);return o}getActivePartNum(n,o,h){const v=this.getSelectedCtrlPointNum(n,o,h);return v>-1?v:this.isPointOnBox(n,o)?8:-1}getSelectedCtrlPointNum(n,o,h){const{points:v}=this,{width:y,height:_,zoom:b}=this.area,{ctrlWidth:w,ctrlHeight:I,ctrlRadiusMultipleMobile:A}=this.renderer.config.boxStyle;let M=I/2/b,F=w/2/b;h&&(F*=A,M*=A);const V=Ir(F,0,3*F),B=Ir(M,0,3*M);for(let Q=0;Q<8;Q++){const J=v[2*Q],Z=v[2*Q+1];if(n<=J+V&&n>=J-V&&o<=Z+B&&o>=Z-B&&n>=0-V&&n<=y+V&&o>=0-B&&o<=_+B&&(Q<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return Q}return-1}checkOrientation(n){if(n<0||n>7)return null;const{minX:o,maxX:h,minY:v,maxY:y}=this.getBounds(),{points:_}=this,b=_[2*n],w=_[2*n+1];let I="",A="";return b===h?I="e":b===o&&(I="w"),w===y?A="s":w===v&&(A="n"),n<4?A+I:A||I}onStartHandler(n,o,h,v){var y;if(null!==(y=h)&&void 0!==y||(h=this.getActivePartNum(n,o,v)),!(h<0)&&(this.startX=n,this.startY=o,this.lastX=n,this.lastY=o,this.selectedPart=h,!this.isRect&&h>3&&h<8)){const{points:_,slopeRatio:b}=this,w=h-4;this.k1=b[(w+1)%4],this.b1=_[(2*w+3)%8]-this.k1*_[(2*w+2)%8],this.k2=b[(w+3)%4],this.b2=_[(2*w+1)%8]-this.k2*_[(2*w+0)%8]}}onMoveHandler(n,o,h){const{selectedPart:v}=this;if(v<0)return;const y=n-this.lastX,_=o-this.lastY;if(0===y&&0===_)return;const{points:b}=this;let w=b.slice();var I;v<8?(null!==(I=h)&&void 0!==I||(h=v),this.isRect?w=this.moveRectPoint(w,h,n,o):(w=this.moveQuadPoint(w,h,n,o),this.slopeRatio=KE(b).slice(0,4),this.isConvex=JE(w))):8===v&&(w=this.moveBox(w,y,_));const A=PL(w);this.points=w.slice(0,8).concat(A),this.midpoints=A,this.lastX=n,this.lastY=o}onEndHandler(){const{startX:n,startY:o,vertexes:h,midpoints:v,lastX:y,lastY:_,selectedPart:b}=this;if(b<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let w=this.points.slice();const I=JE(w);(n===y&&o===_||!I)&&(w=h.slice().concat(v)),this.isConvex=!0,this.vertexes=w.slice(0,8),this.midpoints=PL(w),this.points=w.slice(0,8).concat(this.midpoints),this.slopeRatio=KE(w).slice(0,4)}getBounds(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return{minX:Math.min(n[0],n[2],n[4],n[6]),maxX:Math.max(n[0],n[2],n[4],n[6]),minY:Math.min(n[1],n[3],n[5],n[7]),maxY:Math.max(n[1],n[3],n[5],n[7])}}moveRectPoint(n,o,h,v){let y=0,_=0;const{enableEditCropBoxMidpoints:b,enableEditCropBoxVertices:w}=this.renderer.config;if(this.keepAspectRatio){const{minX:I,maxX:A,minY:M,maxY:F}=this.getBounds(),V=this.checkOrientation(o);let B=(A-I)/(F-M);0===B||B===1/0||B===-1/0||Number.isNaN(B)?B=this.lastAspectRatio:this.lastAspectRatio=B,y=0,_=0;let Q="w",J=!1;if(o<4){if(w){if(J=!0,y=h-n[2*o],_=v-n[2*o+1],0===y||0===_)return n;Q="w"}}else{const Z=o-4;if(b){J=!0;const re={e:[(Z+1)%4,"w"],s:[Z,"h"],w:[Z,"w"],n:[(Z+1)%4,"h"]};if(["e","s","w","n"].includes(V)&&([o,Q]=re[V]),y=h-n[2*Z],_=v-n[2*Z+1],0===y||0===_)return n}}if(J){const Z=["ne","sw","n","w"];"h"===Q?(y=_*B,Z.includes(V)&&(y=-y)):(_=y/B,Z.includes(V)&&(_=-_));const re=n[2*o]+y,se=n[2*o+1]+_,{width:ce,height:pe}=this.area;re<0?(y=0-n[2*o],_=0):re>ce?(y=ce-n[2*o],_=0):se<0?(_=0-n[2*o+1],y=0):se>pe&&(_=pe-n[2*o+1],y=0),n[2*o]+=y,n[2*o+1]+=_;const Ce=(o+1)%4,Ve=(o+3)%4;o%2?(n[2*Ce]+=y,n[2*Ve+1]+=_):(n[2*Ce+1]+=_,n[2*Ve]+=y)}}else if(o<4){if(w){if(y=h-n[2*o],_=v-n[2*o+1],0===y&&0===_)return n;n[2*o]=h,n[2*o+1]=v;const I=(o+1)%4,A=(o+3)%4;o%2?(n[2*I]=h,n[2*A+1]=v):(n[2*I+1]=v,n[2*A]=h)}}else{const I=o-4;if(b){const A=this.slopeRatio[I%4];0===A?(n[(2*I+3)%8]=v,n[(2*I+1)%8]=v):A!==1/0&&A!==-1/0||(n[(2*I+2)%8]=h,n[(2*I+0)%8]=h)}}return n}moveQuadPoint(n,o,h,v){const y=n.slice();if(o<4){const b=v-n[2*o+1];if(0==h-n[2*o]&&0===b)return n;n[2*o]=h,n[2*o+1]=v}else{const _=o-4,b=this.slopeRatio[_%4],w=v-b*h,I=-w/b,A=w,M=n[(2*_+9)%8]-b*n[(2*_+8)%8],F=-M/b,{k1:V,b1:B,k2:Q,b2:J}=this;0===b?(n[(2*_+3)%8]=v,V!==1/0&&V!==-1/0&&(n[(2*_+2)%8]=(v-B)/V),n[(2*_+1)%8]=v,Q!==1/0&&Q!==-1/0&&(n[(2*_+0)%8]=(v-J)/Q)):b===1/0||b===-1/0?(n[(2*_+2)%8]=h,n[(2*_+3)%8]=V*h+B,n[(2*_+0)%8]=h,n[(2*_+1)%8]=Q*h+J):(0===V?n[(2*_+2)%8]+=I-F:V===1/0||V===-1/0?n[(2*_+3)%8]+=A-M:(n[(2*_+2)%8]=(B-w)/(b-V),n[(2*_+3)%8]=(b*B-V*w)/(b-V)),0===Q?n[(2*_+0)%8]+=I-F:Q===1/0||Q===-1/0?n[(2*_+1)%8]+=A-M:(n[(2*_+0)%8]=(J-w)/(b-Q),n[(2*_+1)%8]=(b*J-Q*w)/(b-Q)));for(let Z=0;Z<4;Z++){const re=n[2*Z],se=n[2*Z+1];if(re<0||re>this.area.width||se<0||se>this.area.height)return y}}return n}moveBox(n,o,h){const{minX:v,maxX:y,minY:_,maxY:b}=this.getBounds(n);o=Ir(o,-v,this.area.width-y),h=Ir(h,-_,this.area.height-b);for(let w=0;w<4;w++)n[2*w]+=o,n[2*w+1]+=h;return n}isPointOnBox(n,o){if(this.isRect){const{minX:_,maxX:b,minY:w,maxY:I}=this.getBounds();return n>=_&&n<=b&&o>=w&&o<=I}const h=[...this.vertexes],v=[...this.midpoints],y=[];for(let _=0;_<4;_++)y.push([h[2*_],h[2*_+1]]),y.push([v[2*_],v[2*_+1]]);return function(_,b){let w,I,A,M,F=0;const V=b.length;for([A]=b,w=1;w<=V;w++)M=b[w%V],_[0]>Math.min(A[0],M[0])&&_[0]<=Math.max(A[0],M[0])&&_[1]<=Math.max(A[1],M[1])&&A[0]!==M[0]&&(I=(_[0]-A[0])*(M[1]-A[1])/(M[0]-A[0])+A[1],(A[1]===M[1]||_[1]<=I)&&(F+=1)),A=M;return F%2!=0}([n,o],y)}}function PL(p){const n=p.slice(0,8).concat(p[0],p[1]),o=[];for(let h=0;h<4;h++)o.push((n[2*h]+n[2*(h+1)])/2,(n[2*h+1]+n[2*(h+1)+1])/2);return o}class iRe{constructor(n,o,h){W(this,"areaUid",void 0),W(this,"left",void 0),W(this,"top",void 0),W(this,"width",void 0),W(this,"height",void 0),W(this,"boxes",void 0),W(this,"isVisible",!0),W(this,"zoom",1),W(this,"oldRect",void 0),W(this,"oldQuad",void 0),W(this,"isModified",!1),W(this,"isDrawNewBox",!1),W(this,"activeBoxUid",void 0),W(this,"activePartNum",-1),W(this,"startX",void 0),W(this,"startY",void 0),W(this,"isMouseDown",!1),W(this,"isDrawing",!1),W(this,"renderer",void 0),this.renderer=n,this.areaUid=o,this.boxes=[],this.updateAreaRect(h)}hasActiveBox(){return!!this.activeBoxUid}getFullVertexes(){return[0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(n){return n.left>=0&&n.left<=this.width&&n.left+n.width<=this.width&&n.top>=0&&n.top<=this.height&&n.top+n.height<=this.height}isContainBox(n){const o=n.getRect();return this.isContainRect(o)}isFullBox(n){const{vertexes:o}=n;return 0===o[0]&&0===o[1]&&o[2].toFixed(2)===this.width.toFixed(2)&&0===o[3]&&o[4].toFixed(2)===this.width.toFixed(2)&&o[5].toFixed(2)===this.height.toFixed(2)&&0===o[6]&&o[7].toFixed(2)===this.height.toFixed(2)}addRectBox(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n=this.handleBoundary(n),this.addBox(n,!0,o)}updateRectBox(n,o){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=n.getRect(),y=n.getQuad();if(o=this.handleBoundary(o),n.initBox(o),h){const _={box:n};n.isRect?(_.oldRect=v,_.newRect=n.getRect()):(_.oldQuad=y,_.newQuad=n.getQuad()),this.renderer.hooks.boxModified.emit(_)}}handleBoundary(n){n=[...n];for(let o=0;o<4;o++){const h=[n[2*o],n[2*o+1]];h[0]=Ir(h[0],0,this.width),h[1]=Ir(h[1],0,this.height),[n[2*o],n[2*o+1]]=h}return n}addQuadBox(n){return this.addBox(n,!1)}addBox(n){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const h=new nRe({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...n],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(h),o&&this.renderer.hooks.boxCreated.emit(h),h}getBoxRects(){return this.boxes.map((n,o)=>Ke({index:o},n.getRect()))}getBoxByUid(n){return this.boxes.find(o=>o.uid===n)}deleteBoxByUid(n){const o=this.boxes.findIndex(h=>h.uid===n);o>-1&&this.boxes.splice(o,1)}clearBoxes(){this.boxes.length=0}updateAreaRect(n){this.left=n.left,this.top=n.top,this.width=n.width,this.height=n.height}setKeepAspectRatio(n){this.isDrawing||this.boxes.forEach(o=>{o.keepAspectRatio=n})}isTouchedPoint(n,o,h){return n=Ir(n,0,this.width),o=Ir(o,0,this.height),this.boxes.some(v=>{const y=v.getActivePartNum(n,o,h);return y>-1&&y<8})}isTouchedBox(n,o,h){return n=Ir(n,0,this.width),o=Ir(o,0,this.height),this.boxes.some(v=>v.getActivePartNum(n,o,h)>-1)}onStartHandler(n,o,h){this.isMouseDown=!0,n=Ir(n,0,this.width),o=Ir(o,0,this.height),this.startX=n,this.startY=o;const v=this.boxes.find(y=>{const _=y.getActivePartNum(n,o,h);return _>-1&&(this.activePartNum=_),_>-1});v&&(this.oldRect=v.getRect(),this.oldQuad=v.getQuad(),this.activeBoxUid=v.uid,v.keepAspectRatio=this.renderer.config.keepAspectRatio,v.onStartHandler(n,o,void 0,h))}onMoveHandler(n,o,h,v){if(!this.isMouseDown)return;let y;if(n=Ir(n,0,this.width),o=Ir(o,0,this.height),this.activeBoxUid){y=this.getBoxByUid(this.activeBoxUid);const{keepAspectRatioWithShift:w,keepAspectRatio:I,enableMoveQuad:A}=this.renderer.config;if(y.isRect)y.keepAspectRatio=!(!h||!w)||I;else if(!A&&8===this.activePartNum)return;return y.onMoveHandler(n,o),void(this.isModified=!0)}const{enableCreateBoxByPointer:_,enableMultiple:b}=this.renderer.config;if((b||!this.boxes.length)&&_){const{startX:w,startY:I}=this;let A=o-I;const M=n-w;let F=-1;const V=2/this.zoom;if(M<-V&&A<-V?F=0:M>V&&A<-V?F=1:M>V&&A>V?F=2:M<-V&&A>V&&(F=3),F>-1){const{aspectRatio:B}=this.renderer.config;B>0&&(A=M/B,F%2&&(A=-M/B));const Q=[],J=F%2?[w,I,w,I+A,n,I+A,n,I]:[n,I+A,w,I+A,w,I,n,I];for(let Z=0;Z<4;Z++)Q.push(J[2*(F+Z)%8]),Q.push(J[(2*(F+Z)+1)%8]);y=this.addRectBox(Q,!1),this.isDrawNewBox=!0,y.keepAspectRatio=B>0,this.isDrawing=!0,this.activeBoxUid=y.uid,y.onStartHandler(this.startX,this.startY,F,v),y.onMoveHandler(n,o,F)}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const n=this.getBoxByUid(this.activeBoxUid);if(n.keepAspectRatio=this.renderer.config.keepAspectRatio,n.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(n);else if(this.isModified){const o={box:n};n.isRect?(o.oldRect=this.oldRect,o.newRect=n.getRect()):(o.oldQuad=this.oldQuad,o.newQuad=n.getQuad()),this.renderer.hooks.boxModified.emit(o)}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1}isPointHover(n){let[o,h]=n;return o>=0&&o<=this.width&&h>=0&&h<=this.height}getCursorInfo(n,o,h){for(let v=this.boxes.length-1;v>=0;v--){const y=this.boxes[v],_=y.getActivePartNum(n,o,h);if(_>-1){let b="move";return _<8&&(b=y.checkOrientation(_)),{part:_,position:b,isRect:y.isRect}}}return null}}const rRe={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class oRe{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};W(this,"areas",void 0),W(this,"scrollTop",0),W(this,"scrollLeft",0),W(this,"zoom",1),W(this,"config",void 0),W(this,"canvasDom",void 0),W(this,"isMousedown",!1),W(this,"isEditing",!1),W(this,"editingCursor","crosshair"),W(this,"hoveredArea",void 0),W(this,"hooks",{boxCreated:Cp(),boxModified:Cp(),boxDeleted:Cp()}),this.areas=new Map,this.zoom=1,this.config=pn(rRe),yo(n,this.config),this.setCanvasDom(n.canvas)}setCanvasDom(n){n&&(this.canvasDom=n)}updateConfig(n){yo(n,this.config)}addArea(n,o){if(this.areas.has(n)){const v=this.areas.get(n);return v.updateAreaRect(o),v}const h=new iRe(this,n,o);return this.areas.set(n,h),h}deleteArea(n){this.areas.has(n)&&(this.areas.get(n).boxes.forEach(o=>{this.hooks.boxDeleted.emit(o)}),this.areas.delete(n))}clearArea(){this.areas.forEach(n=>{n.boxes.forEach(o=>{this.hooks.boxDeleted.emit(o)})}),this.areas.clear()}clearAreaBoxes(n){if(this.areas.has(n)){const o=this.areas.get(n);o.boxes.forEach(h=>{this.hooks.boxDeleted.emit(h)}),o.clearBoxes()}}addRectBox(n,o){return this.areas.get(o).addRectBox(n)}addQuadBox(n,o){return this.areas.get(o).addQuadBox(n)}updateOptions(n){Object.assign(this,n),$t(n.zoom)&&this.areas.forEach(o=>{o.zoom=n.zoom})}getAreaByUid(n){return this.areas.get(n)}deleteAreaByUid(n){this.areas.delete(n)}getHoveredArea(n){const o=this.nativeToCanvas(n);for(const h of this.areas.values()){const v=this.canvasToArea(o,h);if(h.isPointHover(v)&&h.isVisible)return h}return null}getHoveredAreaForCursor(n){const o=D_(n),h=this.nativeToCanvas(n);for(const v of this.areas.values()){const y=this.canvasToArea(h,v),[_,b]=y,w=v.isVisible&&v.boxes.find(I=>I.getActivePartNum(_,b,o)>-1);if(v.isPointHover(y)||w)return v}return null}isControlPointTouched(n){const o=this.getHoveredArea(n);if(!o||!o.isVisible)return!1;const h=this.nativeToCanvas(n),[v,y]=this.canvasToArea(h,o),_=D_(n);return o.isTouchedPoint(v,y,_)}isBoxTouched(n){const o=this.getHoveredArea(n);if(!o||!o.isVisible)return!1;const h=this.nativeToCanvas(n),[v,y]=this.canvasToArea(h,o),_=D_(n);return o.isTouchedBox(v,y,_)}onStartHandler(n){const o=this.getHoveredArea(n);if(!o||!o.isVisible)return;this.hoveredArea=o,this.isMousedown=!0;const h=this.nativeToCanvas(n),[v,y]=this.canvasToArea(h,o),_=D_(n);o.onStartHandler(v,y,_)}onMoveHandler(n){if(!this.canvasDom)return;const{defaultCursor:o}=this.config,h=this.getHoveredArea(n);if(h){if(!h.isVisible)return}else this.canvasDom.style.cursor=o;const v=D_(n),y=this.nativeToCanvas(n);if(this.isMousedown){const[_,b]=this.canvasToArea(y,this.hoveredArea);this.hoveredArea.onMoveHandler(_,b,n.shiftKey,v)}if(this.config.enableCursor&&h){const _="crosshair",b="move",{canvasDom:w}=this;if(this.hasBox()){const[I,A]=this.canvasToArea(y,h),M=h.getCursorInfo(I,A,v);let F;if(null===M)F=this.config.enableMultiple?_:o;else if(M.isRect){const V=M.position===b;this.isMousedown?this.isEditing||(this.editingCursor=V?b:_,this.isEditing=!0):F=V?b:`${M.position}-resize`}else M.part>-1&&M.part<8?this.isMousedown?this.isEditing||(this.editingCursor=_,this.isEditing=!0):F=_:F=o;this.isEditing&&(F=this.editingCursor),w.style.cursor=F}else w.style.cursor!==_&&(w.style.cursor=_)}}hasBox(){for(const n of this.areas.values())if(n.isVisible&&n.boxes.length)return!0;return!1}onEndHandler(n){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null)}render(){if(!this.canvasDom||!this.areas.size)return;const n=this.canvasDom.getContext("2d");n.setTransform(1,0,0,1,0,0),this.areas.forEach(o=>{o.isVisible&&o.boxes.length&&this.renderArea(n,o)})}renderArea(n,o){const{borderStyle:h,borderColor:v,borderWidth:y,ctrlBorderColor:_,ctrlBackground:b,ctrlBorderWidth:w,ctrlBorderStyle:I,background:A,maskColor:M,invalidBorderColor:F,invalidCtrlBorderColor:V,ctrlBorderRadius:B,ctrlWidth:Q,ctrlHeight:J}=this.config.boxStyle,Z=devicePixelRatio,re=Q*Z,se=J*Z,ce=Math.min(B*Z,re/2,se/2),pe=[h[0]*Z,h[1]*Z],Ce=y*Z,Ve=w*Z,te=[I[0]*Z,I[1]*Z];n.save(),n.beginPath(),n.rect(o.left*Z,o.top*Z,o.width*o.zoom*Z,o.height*o.zoom*Z),n.closePath(),n.clip(),this.config.enableMask&&M&&(n.save(),n.beginPath(),n.rect(o.left*Z,o.top*Z,o.width*o.zoom*Z,o.height*o.zoom*Z),o.boxes.forEach(Me=>{let we=this.areaPointsToCanvas(Me.points.slice(0,8),o),Le=this.areaPointsToCanvas(Me.midpoints.slice(0,8),o);1!==Z&&(we=we.map(j=>j*Z),Le=Le.map(j=>j*Z)),n.moveTo(we[0],we[1]);for(let j=1;j<4;j++)n.lineTo(we[2*j],we[2*j+1])}),n.closePath(),n.clip("evenodd"),n.fillStyle=M,n.fill(),n.restore()),o.boxes.forEach(Me=>{let we=this.areaPointsToCanvas(Me.points.slice(0,8),o),Le=this.areaPointsToCanvas(Me.midpoints.slice(0,8),o);1!==Z&&(we=we.map(j=>j*Z),Le=Le.map(j=>j*Z)),n.save(),n.setLineDash(pe),n.strokeStyle=Me.isConvex?v:F,n.fillStyle=""===A?"transparent":A,n.lineWidth=Ce,n.beginPath(),n.moveTo(we[0],we[1]);for(let j=1;j<4;j++)n.lineTo(we[2*j],we[2*j+1]);n.closePath(),n.fill(),n.stroke(),n.setLineDash(te),n.strokeStyle=Me.isConvex?_:V,n.fillStyle=""===b?"transparent":b,n.lineWidth=Ve,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(n,we,re,se,ce,this.config.enableHideEditingCropBoxVertex?Me.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(n,Le,re,se,ce,this.config.enableHideEditingCropBoxMidpoint?Me.selectedPart-4:-1),n.restore()}),n.restore()}drawCtrlPoints(n,o,h,v,y,_){const b=h/2,w=v/2;for(let I=0;I<4;I++){if(I===_)continue;n.beginPath();const A=o[2*I],M=o[2*I+1];if(0===y)n.rect(A-b,M-w,h,v);else{const{PI:F}=Math;n.arc(A-b+y,M-w+y,y,F,3*F/2),n.arc(A+b-y,M-w+y,y,3*F/2,2*F),n.arc(A+b-y,M+w-y,y,0,F/2),n.arc(A-b+y,M+w-y,y,F/2,F)}n.closePath(),n.fill(),n.stroke()}}areaPointsToCanvas(n,o){const h=[];for(let v=0;v<4;v++){const[y,_]=this.areaToCanvas([n[2*v],n[2*v+1]],o);h.push(y,_)}return h}canvasToArea(n,o){let[h,v]=n;const{scrollLeft:y,scrollTop:_,zoom:b}=this;return h=(h-o.left+y)/b,v=(v-o.top+_)/b,[h,v]}areaToCanvas(n,o){let[h,v]=n;const{scrollLeft:y,scrollTop:_,zoom:b}=this;return h=h*b+o.left-y,v=v*b+o.top-_,[h,v]}nativeToCanvas(n){const o=["touchstart","touchend","touchmove"].includes(n.type)?n.targetTouches[0]:n,h=this.canvasDom.getBoundingClientRect(),{scrollX:v,scrollY:y}=window;return[o.pageX-v-h.left,o.pageY-y-h.top]}}class sRe{constructor(n,o){W(this,"context",void 0),W(this,"core",void 0),W(this,"boxRenderer",void 0),W(this,"viewer",void 0),W(this,"isMousedown",!1),this.viewer=n,this.context=n.context,this.core=n.context.core,this.boxRenderer=o}isEditCropBox(n){const o=this.boxRenderer.getHoveredArea(n);return!(!o||!o.isVisible||o.boxes.length&&!this.boxRenderer.isBoxTouched(n))}mousedown(n){const{context:o}=this,h=this.context.getActiveTab();if(null==h||!h.total||"crop"!==this.context.viewerConfig.toolMode)return;const[v]=this.context.formatTouches(n),{page:y}=this.context.getPointerOverPageInfo(v.pageX,v.pageY).pageInfo;if(h&&y&&y.uid!==h.currentUid){const _=h.getPageIndex(y);h.gotoPage(_),this.context.emitPageChangedEvent(h),this.context.core.viewerService.onCurrentChangedByScroll.emit(q2.create(h.uid,o.groupUid,o.uid,_)),this.context.emitPageChangedAfterRenderEvent(h)}this.isMousedown=!0,this.boxRenderer.onStartHandler(n)}mousemove(n){const o=this.context.getActiveTab();null!=o&&o.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&n instanceof TouchEvent&&n.cancelable&&n.preventDefault(),this.boxRenderer.onMoveHandler(n),this.isMousedown&&this.context.render())}mouseup(n){this.isMousedown&&(this.boxRenderer.onEndHandler(n),this.isMousedown=!1,this.context.render())}afterPerspective(n){let{pageUid:o,docUid:h,width:v,height:y}=n;const{context:_}=this,b=_.tabService.getTab(h);if(!b)return;const w=b.getPageByUid(o);if(w&&(w.rWidth=v,w.rHeight=y,_.clearOptimization([w.uid])),b.isActive){if("crop"===_.viewerConfig.toolMode){this.boxRenderer.areas.forEach(F=>{F.clearBoxes()});const A=this.boxRenderer.getAreaByUid(o),M=b.getPageByUid(o).getRect();null==A||A.updateAreaRect(M)}w&&(w.isLoaded=!1),_.scrollByCurrentChanged=!0;let I=!0;this.context.isDefaultViewer?"none"===b.context.fitMode&&(I=!1):this.context.isThumbnailViewer&&(I=!1),this.context.showTab(b,I)}}afterRotatePages(n){const{context:o}=this;if("crop"!==o.viewerConfig.toolMode)return;const h=this.context.getActiveTab();null!=h&&h.total&&h.uid===n.docUid&&(this.boxRenderer.areas.forEach(v=>{v.clearBoxes()}),n.pageUids.forEach(v=>{const y=this.boxRenderer.getAreaByUid(v),_=h.getPageByUid(v).getRect();null==y||y.updateAreaRect(_)}),this.context.render())}afterRender(n){const{context:o}=this;"crop"===o.viewerConfig.toolMode&&(n.pages.forEach(h=>{const v=this.boxRenderer.getAreaByUid(h.uid);if(v){if(h.isVisible){const y=h.getRect();v.updateAreaRect(y)}v.isVisible="current"===this.viewer.cropMode?h.uid===n.currentUid:h.isVisible}}),this.boxRenderer.updateOptions({zoom:n.context.zoom}),this.boxRenderer.render())}toolModeChanged(n){if("crop"!==n.oldToolMode&&"crop"===n.newToolMode){const o=this.context.getActiveTab();if(!o)return;o.pages.forEach(h=>{const v=h.getRect();this.boxRenderer.addArea(h.uid,v).isVisible="current"===this.viewer.cropMode?h.uid===o.currentUid:h.isVisible}),this.boxRenderer.updateOptions({zoom:o.context.zoom})}else"crop"!==n.newToolMode&&"crop"===n.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render())}pageChanged(n){if("crop"===this.context.viewerConfig.toolMode)return this.context.getActiveTab()?0===n.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(n){n.pageUids.forEach(o=>{this.boxRenderer.deleteArea(o)})}updatePage(n){const{context:o}=this;if("crop"!==o.viewerConfig.toolMode)return;const h=o.getActiveTab();if(h&&h.uid===n.docUid&&("current"===this.viewer.cropMode&&n.pageUid===h.currentUid&&this.resetPageCropArea(),"all"===this.viewer.cropMode)){const v=this.boxRenderer.getAreaByUid(n.pageUid),y=h.getPageByUid(n.pageUid).getRect();v.updateAreaRect(y),this.boxRenderer.areas.forEach(_=>{_.clearBoxes()}),o.render()}}addPages(n){const o=this.context.getActiveTab();null!=o&&o.total&&o.uid===n.docUid&&(n.pageUids.forEach(h=>{const v=o.getPageByUid(h),y=v.getRect();this.boxRenderer.addArea(v.uid,y),this.boxRenderer.updateOptions({zoom:o.context.zoom})}),this.boxRenderer.areas.forEach(h=>{h.clearBoxes()}))}resetPageCropArea(){const n=this.context.getActiveTab();this.clearRedundantBoxes();const o=n.getCurrentPage(),h=o.getRect();this.boxRenderer.addArea(o.uid,h),this.boxRenderer.updateOptions({zoom:n.context.zoom}),this.context.render()}clearRedundantBoxes(){const n=this.context.getActiveTab();n&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach(o=>{o.areaUid!==n.currentUid&&this.boxRenderer.clearAreaBoxes(o.areaUid)})}}class aRe{constructor(n,o){W(this,"context",void 0),W(this,"core",void 0),W(this,"boxRenderer",void 0),W(this,"viewer",void 0),W(this,"isMousedown",!1),W(this,"canSlide",!1),W(this,"isStart",!1),W(this,"startX",void 0),W(this,"isSliding",void 0),W(this,"slideDistance",void 0),W(this,"slideDirection",void 0),W(this,"slideRAF",void 0),W(this,"tabX",void 0),W(this,"tabY",void 0),this.viewer=n,this.context=n.context,this.core=n.context.core,this.boxRenderer=o}mousedown(n){const o=this.context.getActiveTab();null==o||!o.total||(this.isMousedown=!0,!this.boxRenderer.isControlPointTouched(n)&&this.context.viewerConfig.enableSlide?(this.canSlide=!0,this.slideStart(n)):this.boxRenderer.onStartHandler(n))}mousemove(n){const o=this.context.getActiveTab();null==o||!o.total||(D_(n)&&n.cancelable&&n.preventDefault(),this.canSlide?this.slideMove(n):(this.boxRenderer.onMoveHandler(n),this.isMousedown&&this.context.render()))}mouseup(n){this.isMousedown&&(this.canSlide?this.slideEnd(n):this.boxRenderer.onEndHandler(n),this.canSlide=!1,this.isMousedown=!1,this.context.render())}reRender(){const{context:n}=this,o=n.getActiveTab();null!=o&&o.total&&"visible"===n.viewerConfig.visibility&&(this.updatePageQuad(o),n.render())}updatePage(n){const{context:o}=this,h=o.getActiveTab();null!=h&&h.total&&"visible"===o.viewerConfig.visibility&&h.currentUid===n.pageUid&&(this.updatePageQuad(h),o.render())}afterRender(n){if(null==n||!n.total)return;const{boxRenderer:o}=this;n.pages.forEach(h=>{const v=o.getAreaByUid(h.uid);if(v&&h.isVisible){const y=h.getRect();v.updateAreaRect(y)}}),o.updateOptions({zoom:n.context.zoom}),o.render()}pageChanged(n){if(-1===n.current&&0===n.total)return void this.boxRenderer.clearArea();const o=this.context.getActiveTab();o&&this.updatePageQuad(o)}updatePageQuad(n){const{context:o}=this,h=n.getCurrentPage();if(!h)return!1;let v=null;const y=this.boxRenderer.getAreaByUid(h.uid);y&&y.boxes[0]&&(v=y.boxes[0].getQuad());const _=o.core.pageService.getPage(n.currentUid);this.boxRenderer.clearArea();const b=h.getRect(),w=this.boxRenderer.addArea(h.uid,b);this.boxRenderer.updateOptions({zoom:n.context.zoom});const I=_.getQuadVertices(),A=w.addQuadBox(I);let M=A.getQuad();o.hooks.perspectiveQuadChanged.emit(K_.create(A.getQuad(),_.isFull)),v&&(v=_.quadToPixelPPI(v)),M&&(M=_.quadToPixelPPI(M)),sm(v),sm(M);let F=!1;return v&&M&&(F=o5(v,M)),F||o.viewer.emit("quadModified",z2.create(v,M)),A}afterRotatePages(n){const o=this.context.getActiveTab();null!=o&&o.total&&n.pageUids.includes(o.currentUid)&&(this.updatePageQuad(o),this.context.render())}afterPerspective(n){let{pageUid:o,docUid:h}=n;const{context:v}=this,y=this.context.getActiveTab();if(null==y||!y.total||y.uid!==h||y.currentUid!==o)return;const _=y.getCurrentPage();_&&(_.isLoaded=!1),this.updatePageQuad(y),v.scrollByCurrentChanged=!0,v.showTab(y,!0)}slideStart(n){if(!this.context.viewerConfig.enableSlide||this.isSliding)return;const o=this.context.getActiveTab();if(null==o||!o.total)return;const{scrollLeft:h,scrollTop:v}=this.context.viewService.getMaxScrollValue();if(h||v)return;const y=this.context.formatTouches(n);if(y.length>1)return;const _=o.getPosition();this.tabX=_.x,this.tabY=_.y,this.startX=y[0].pageX,this.isStart=!0}slideMove(n){if(!this.isStart)return;const{context:o}=this,{viewerConfig:h}=o,v=o.getActiveTab(),y=o.formatTouches(n)[0].pageX-this.startX;if(y>0?this.slideDirection="right":y<0&&(this.slideDirection="left"),this.slideDistance=Math.min(v.context.viewportWidth,Math.abs(y)),this.isSliding)"right"===this.slideDirection?v.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&v.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),o.render();else if("single"===v.context.displayMode&&"crop"===h.toolMode&&h.enableSlide){const{scrollLeft:_,scrollTop:b}=this.context.viewService.getMaxScrollValue();Math.abs(y)>h.startSlideThresholdForPerspective&&!_&&!b&&(this.isSliding=!0,o.configService.updateConfig({displayMode:"slide"}))}}slideEnd(n){if(!this.isStart)return;const{context:o}=this,h=o.getActiveTab(),{displayMode:v}=h.context;"slide"===v&&this.slide(h),this.isStart=!1}slide(n){let o,h=0,v=0,y=0,_=!1;const{viewerConfig:b}=this.context;this.slideDistance>=Math.max(n.context.viewportWidth*b.slideThresholdForPerspective,b.startSlideThresholdForPerspective)?(v=n.context.viewportWidth,o=v-this.slideDistance,"left"===this.slideDirection?n.current!==n.total-1?(y=-this.slideDistance,h=-o/6):(v=0,o=this.slideDistance,_=!0,y=-this.slideDistance,h=o/6):0!==n.current?(y=this.slideDistance,h=o/6):(v=0,o=this.slideDistance,_=!0,y=this.slideDistance,h=-o/6)):(_=!0,v=0,o=this.slideDistance,"left"===this.slideDirection?(y=-this.slideDistance,h=o/6):(y=this.slideDistance,h=-o/6));const I=()=>{y+=h;const A=y>=0;if(Math.abs(y)>=v&&(y=v,A||(y*=-1)),n.setPosition({x:y+this.tabX,y:this.tabY,z:0}),Math.abs(y)===v)return _||(this.context.viewer.gotoPage("right"===this.slideDirection?n.current-1:n.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(I),this.context.render()};this.slideRAF=requestAnimationFrame(I)}}class lRe{constructor(n){W(this,"service",void 0),this.service=n}startHandler(n){this.service.mousedown(n)}moveHandler(n){this.service.mousemove(n)}endHandler(n){this.service.mouseup(n)}isEditCropBox(n){return this.service.isEditCropBox(n)}}class cRe{constructor(n){W(this,"service",void 0),this.service=n}startHandler(n){this.service.mousedown(n)}moveHandler(n){this.service.mousemove(n)}endHandler(n){this.service.mouseup(n)}}function Fw(p,n){return{left:Xh(p.left,n),top:Xh(p.top,n),width:Xh(p.width,n),height:Xh(p.height,n)}}const uRe={install(p){const n=p.getClass("Viewer"),o=(h=n,class extends h{constructor(v){super(v),W(this,"boxRenderer",void 0),W(this,"iCropMode","current"),W(this,"cropRectService",void 0),W(this,"perspectiveQuadService",void 0);const{isDefaultViewer:y,isPerspectiveViewer:_}=this.context;(y||_)&&this.initBoxRenderer(),this.cropRectService=new sRe(this,this.boxRenderer),this.perspectiveQuadService=new aRe(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new lRe(this.cropRectService),this.context.perspectiveQuadEditService=new cRe(this.perspectiveQuadService)}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:v},enableEditCropBoxMidpoints:y,enableEditCropBoxVertices:_,enableHideEditingCropBoxMidpoint:b,enableHideEditingCropBoxVertex:w}=this.context.viewerConfig;this.boxRenderer=new oRe({defaultCursor:v,enableEditCropBoxMidpoints:y,enableEditCropBoxVertices:_,enableHideEditingCropBoxMidpoint:b,enableHideEditingCropBoxVertex:w}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on(()=>{this.updateQuadStyle()},this),this.context.hooks.canvasCursorStyleChanged.on(()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor})},this),this.hooks.resize.on(()=>{this.context.render()});const{hooks:I}=this.boxRenderer;I.boxCreated.on(A=>{const M=this.context.getActiveTab();if(null!=M&&M.total&&(this.context.isDefaultViewer&&A.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach(F=>{F.boxes.length?F.boxes.forEach(V=>{F.isContainBox(A)?F.updateRectBox(V,[...A.vertexes]):F.clearBoxes()}):F.isContainBox(A)&&F.addRectBox([...A.vertexes])}),A.isRect)){let F=A.getRect();F=Kn(F,jn.displayResolution,72),F=Fw(F,2);const V=lF.create(F);this.hooks.cropRectDrawn.emit(V),this.emit("cropRectDrawn",V)}}),I.boxDeleted.on(A=>{const M=this.context.getActiveTab();if(null!=M&&M.total&&A.isRect){let F=A.getRect();F=Kn(F,jn.displayResolution,72),F=Fw(F,2);const V=aF.create(F);this.hooks.cropRectDeleted.emit(V),this.emit("cropRectDeleted",V)}}),I.boxModified.on(A=>{const M=this.context.getActiveTab();if(null==M||!M.total)return;const{box:F}=A;if(this.context.isDefaultViewer&&F.isRect){let{oldRect:V,newRect:B}=A,Q=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach(J=>{J.boxes.length?J.boxes.forEach(Z=>{J.isContainBox(F)?(Q+=1,J.updateRectBox(Z,[...F.vertexes])):J.clearBoxes()}):J.isContainBox(F)&&J.addRectBox([...F.vertexes])}),V&&(V=Kn(V,jn.displayResolution,72),V=Fw(V,2)),B&&(B=Kn(B,jn.displayResolution,72),B=Fw(B,2)),!V||!B||V.left!==B.left||V.top!==B.top||V.width!==B.width||V.height!==B.height){Q=Math.max(1,Q);for(let J=0;J<Q;J++){const Z=cF.create(V,B);this.emit("cropRectModified",Z)}}}if(this.context.isPerspectiveViewer&&!F.isRect){const V=this.context.core.pageService.getPage(F.area.areaUid),B=this.boxRenderer.getAreaByUid(F.area.areaUid).isFullBox(F);V.isFull=B,V.setActiveQuad(F.getQuad());let{oldQuad:Q,newQuad:J}=A;Q&&(Q=V.quadToPixelPPI(Q)),J&&(J=V.quadToPixelPPI(J)),sm(Q),sm(J),this.hooks.perspectiveQuadChanged.emit(K_.create(J,V.isFull));let Z=!1;Q&&J&&(Z=o5(J,Q)),Z||this.emit("quadModified",z2.create(Q,J))}})}updateQuadStyle(){const v=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:v})}get cropMode(){return this.iCropMode}set cropMode(v){if(this.iCropMode===v)return;const y=this.iCropMode;this.iCropMode=v;const _=this.context.getActiveTab();if(null!=_&&_.total){if("current"===y&&"all"===v){const b=this.boxRenderer.getAreaByUid(_.currentUid).boxes[0];b&&this.boxRenderer.areas.forEach(w=>{w.isContainBox(b)?w.boxes.length?w.updateRectBox(w.boxes[0],[...b.vertexes]):w.addRectBox([...b.vertexes]):w.clearBoxes()})}this.cropRectService.clearRedundantBoxes(),this.context.render()}}toggleFullPerspective(){const{context:v}=this;if(!v.isPerspectiveViewer)return;const y=v.getActiveTab();null!=y&&y.total&&v.core.pageService.getPage(y.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(y),v.render())}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on(v=>{this.cropRectService.afterRotatePages(v)},this),this.context.core.onAfterPerspective.on(v=>{this.cropRectService.afterPerspective(v)},this))}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on(v=>{this.perspectiveQuadService.afterRotatePages(v)},this),this.context.core.onAfterPerspective.on(v=>{this.perspectiveQuadService.afterPerspective(v)},this))}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:v}=this;this.hooks.resize.on(()=>{v.reRender()}),this.hooks.visibleChanged.on(()=>{v.reRender()}),this.hooks.updatePage.on(y=>{v.updatePage(y)}),this.hooks.afterRender.on(y=>{v.afterRender(y)}),this.hooks.pageChanged.on(y=>{v.pageChanged(y)})}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:v}=this;this.hooks.updatePage.on(y=>{v.updatePage(y)}),this.hooks.addPagesToDoc.on(y=>{v.addPages(y)}),this.hooks.afterRender.on(y=>{v.afterRender(y)}),this.hooks.toolModeChanged.on(y=>{v.toolModeChanged(y)}),this.hooks.pageChanged.on(y=>{v.pageChanged(y)}),this.hooks.deletePages.on(y=>{v.deletePages(y)}),this.hooks.beforeCropPages.on(()=>{this.clearRectBox()})}setRectBox(v,y){const _=this.context.getActiveTab();return!(!_||!_.total||(gt(y)&&(y=[_.current]),_.indicesToUids(y).forEach(b=>{let w=v;w=Kn(v,jn.dataResolution,jn.displayResolution);const I=(M=>{const{left:F,top:V,width:B,height:Q}=M;return[F,V,F+B,V,F+B,V+Q,F,V+Q]})(w),A=this.boxRenderer.areas.get(b);A.boxes.length?A.updateRectBox(A.boxes[0],I,!0):A.addRectBox(I)}),this.context.render(),0))}getRectBox(){const v=this.context.getActiveTab();if(v&&v.total){let y=null;if(v.pages.find(_=>{const b=this.boxRenderer.getAreaByUid(_.uid);return!(null==b||!b.boxes.length||(y=b,0))}),y){const _=y.boxes[0];if(null!=_&&_.isRect){let b=_.getRect();return b=Kn(b,jn.displayResolution,jn.dataResolution),b=Fw(b,2),b.width=b.width||1,b.height=b.height||1,b}}}return null}getRenderedRectBoxCount(){const v=this.context.getActiveTab();let y=0;return v&&v.total&&this.boxRenderer.areas.forEach(_=>{y+=_.boxes.length}),y}getCropIndices(){const v=this.context.getActiveTab();let y=[];if(v&&v.total)if("all"===this.iCropMode){const _=[];this.boxRenderer.areas.forEach(b=>{b.boxes.length&&_.push(b.areaUid)}),y=v.uidsToIndices(_)}else y=[v.current];return y}clearRectBox(){return this.boxRenderer.areas.forEach(v=>{v.clearBoxes()}),!0}setQuadBox(v){const y=this.context.getActiveTab();if(!y||!y.total)return!1;const _=this.context.core.pageService.getPage(y.currentUid);let b=v;b=v.map(F=>Kn(F,_.resource.resolutionX,jn.displayResolution));const w=this.boxRenderer.getAreaByUid(y.currentUid),{width:I,height:A}=w,M=pee(b,I,A);return _.isFull=M,_.setActiveQuad(b),this.perspectiveQuadService.updatePageQuad(y),this.hooks.perspectiveQuadChanged.emit(K_.create(b,_.isFull)),this.context.render(),!0}getQuadBox(){const v=this.context.getActiveTab();if(v&&v.total){const y=this.boxRenderer.getAreaByUid(v.currentUid).boxes[0];if(!y.isRect){let _=y.getQuad();const b=this.context.core.pageService.getPage(v.currentUid);return _=_.map(w=>Kn(w,jn.displayResolution,b.resource.resolutionX)),sm(_),_}}return null}resetQuadBox(v){const y=this.context.getActiveTab();if(null==y||!y.total)return!1;let _=[];return _=gt(v)?[y.currentUid]:y.indicesToUids(v),_.forEach(b=>{const w=this.context.core.pageService.getPage(b),{quad:I}=w;I?(w.isFull&&(w.isFull=!1),w.setActiveQuad(I),this.perspectiveQuadService.updatePageQuad(y)):w.isFull||(w.isFull=!0,this.perspectiveQuadService.updatePageQuad(y)),w.uid===y.currentUid&&this.hooks.perspectiveQuadChanged.emit(K_.create(I,w.isFull))}),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach(v=>{v.clearBoxes()}),!0}isConvexQuad(v){return JE(v.flat())}});var h;p.setClass("Viewer",o)}};class dRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(h=>{const{pageUids:v}=this.action;v.slice().forEach(y=>{if(h.pageUids.includes(y)){const _=v.indexOf(y);v.splice(_,1)}}),this.isValid=v.length>0},this)}execute(){const{core:n,action:o}=this;o.pageUids.forEach(v=>{n.pageService.getPage(v).addAction(o)});const h=K2.create(o.docUid,o.angle,o.pageUids);return n.editService.onRotatePages.emit(h),n.editService.onAfterRotatePages.emit(h),!0}undo(){const{core:n,action:o}=this;o.pageUids.forEach(v=>{n.pageService.getPage(v).deleteAction(o.actionUid)});const h=K2.create(o.docUid,o.angle,o.pageUids);n.editService.onRotatePages.emit(h),n.editService.onAfterRotatePages.emit(h)}}class hRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on(h=>{const{pageUids:v}=this.action;v.slice().forEach(y=>{if(h.pageUids.includes(y)){const _=v.indexOf(y);v.splice(_,1)}}),this.isValid=v.length>0},this)}execute(){const{core:n,action:o}=this;o.pageUids.forEach(v=>{n.pageService.getPage(v).addAction(this.action)});const h=J2.create(o.docUid,o.rect,o.pageUids);return n.editService.onCropPages.emit(h),!0}undo(){const{core:n,action:o}=this;o.pageUids.forEach(v=>{n.pageService.getPage(v).deleteAction(o.actionUid)});const h=J2.create(o.docUid,o.rect,o.pageUids);n.editService.onCropPages.emit(h)}}class fRe extends or{constructor(n){super(),W(this,"core",void 0),W(this,"onRotatePages",void 0),W(this,"onAfterRotatePages",void 0),W(this,"onCropPages",void 0),W(this,"onAfterCropPages",void 0),this.core=n,this.initEventEmitter()}initEventEmitter(){this.onRotatePages=Dt(this),this.onAfterRotatePages=Dt(this),this.onCropPages=Dt(this),this.onAfterCropPages=Dt(this)}rotatePages(n,o,h,v){const y={actionUid:Ai(),type:"rotate",docUid:n,pageUids:[...o],angle:h,rotationType:v},{core:_}=this,b=new dRe(y,_);return _.commandService.execute(b,n),!0}cropPages(n,o,h){const v={actionUid:Ai(),type:"crop",docUid:n,pageUids:[...o],rect:Ke({},h)},{core:y}=this,_=new hRe(v,y);return y.commandService.execute(_,n),!0}}const pRe={apply(p){p.editService=new fRe(p)},install(p){const n=p.getClass("Viewer"),o=(h=n,class extends h{constructor(v){super(v),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit()}listenGlobalEventsForEdit(){const{context:v}=this,y=_=>{let{docUid:b,pageUids:w}=_;const I=v.tabService.getTab(b);if(null!=I&&I.isActive){v.scrollByCurrentChanged=!0,v.clearOptimization(w);let A=!0;v.isDefaultViewer?"none"===I.context.fitMode&&(A=!1):v.isThumbnailViewer&&(A=!1),v.showTab(I,A)}};v.core.editService.onRotatePages.on(y,this),v.core.editService.onCropPages.on(y,this)}listenViewerEventsForEdit(){this.hooks.beforeLayout.on(v=>{const{core:{pageService:y},isDefaultViewer:_,isThumbnailViewer:b,isPerspectiveViewer:w}=this.context;(_||b||w)&&v.pages.forEach(I=>{let A=null;const M=y.getPage(I.uid);A=_||b?M.getEditResult():M.getEditResultForPerspective(),A&&(I.rWidth=A.rWidth,I.rHeight=A.rHeight,I.cropLeft=A.cropLeft,I.cropTop=A.cropTop,I.cropWidth=A.cropWidth,I.cropHeight=A.cropHeight,I.rotation=A.rotation,I.mediaBoxRect=A.mediaBox,I.cropBoxRect=A.cropBox)})})}rotatePages(v,y){var _;if(v%360==0)return!0;const b=this.context.getActiveTab();if(!b)return!1;null!==(_=y)&&void 0!==_||(y=[b.current]);const w=b.indicesToUids(y);return this.context.core.editService.rotatePages(b.uid,w,v,"contain")}cropPages(v,y){var _;const b=this.context.getActiveTab();if(!b)return!1;null!==(_=y)&&void 0!==_||(y=[b.current]);const w=b.indicesToUids(y);return v=Kn(v,jn.dataResolution,jn.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(b.uid,w,v)}});var h;p.setClass("Viewer",o)}};class ID extends $Ee{static create(n){return new ID(n,n.uid)}constructor(n,o){super(o),W(this,"type",void 0),W(this,"docUid",void 0),W(this,"pageUid",void 0),W(this,"style",void 0),W(this,"transform",void 0),W(this,"flags",void 0),W(this,"comment",void 0),W(this,"layer",void 0),W(this,"creationDate",void 0),W(this,"modified",!1),W(this,"oriIndex",void 0),this.type=n.type,this.docUid=n.docUid,this.pageUid=n.pageUid,this.style=n.style,this.flags=n.flags||["print"],this.transform=n.transform,this.oriIndex=n.oriIndex,gt(null==n?void 0:n.modified)||(this.modified=n.modified)}getConfig(){return{uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:pn(this.style),transform:pn(this.transform),flags:pn(this.flags),comment:pn(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(n,o){const h=ID.create({docUid:this.docUid,pageUid:n,type:this.type,style:pn(this.style),transform:pn(this.transform),flags:this.flags.slice(),comment:this.comment}),v=this.comment.clone(h.uid,o);return h.comment=v,h.layer=this.layer,h}updateStyle(n){Object.assign(this.style,n)}updateComment(n){this.comment.updateComment(n)}addReplies(n){this.comment.replies.push(...n)}deleteReplies(n){const o=this.comment.replies;n.forEach(h=>{if(o.includes(h)){const v=o.findIndex(y=>y.uid===h.uid);o.splice(v,1)}})}updateReply(n){const o=this.comment.replies.findIndex(h=>h.uid===n.uid);this.comment.replies[o]=n}getAllReplies(){return[...this.comment.replies]}deleteReplyReviewSate(n){const o=this.comment.getReply(n);o&&o.deleteReviewState()}setReplyReviewState(n,o){const h=this.comment.getReply(n);h&&h.setReviewState(o)}deleteReplyMarkedSate(n){const o=this.comment.getReply(n);o&&o.deleteMarkedState()}setReplyMarkedState(n,o){const h=this.comment.getReply(n);h&&h.setMarkedState(o)}}class Lw{static create(n){return new Lw(n)}constructor(n){W(this,"uid",void 0),W(this,"author",void 0),W(this,"contents",void 0),W(this,"creationDate",void 0),W(this,"state",void 0),this.uid=n.uid,this.author=n.author,this.contents=n.contents,this.creationDate=n.creationDate,this.state=n.state}}class Nw{static create(n){return new Nw(n)}constructor(n){W(this,"uid",void 0),W(this,"author",void 0),W(this,"contents",void 0),W(this,"creationDate",void 0),W(this,"state",void 0),this.uid=n.uid,this.author=n.author,this.contents=n.contents,this.creationDate=n.creationDate,this.state=n.state}}class l1 extends R_{static create(n,o){return new l1(n,o)}constructor(n,o){var h,v;super(o),W(this,"annotationUid",void 0),W(this,"author",void 0),W(this,"subject",void 0),W(this,"contents",void 0),W(this,"creationDate",void 0),W(this,"modificationDate",void 0),W(this,"markedStates",void 0),W(this,"reviewStates",void 0),this.annotationUid=n.annotationUid,this.author=n.author,this.subject=n.subject,this.contents=n.contents,this.creationDate=n.creationDate,this.modificationDate=n.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(h=n.markedStates)&&void 0!==h&&h.length&&n.markedStates.forEach(y=>{const _=Nw.create(y);this.markedStates.push(_)}),null!==(v=n.reviewStates)&&void 0!==v&&v.length&&n.reviewStates.forEach(y=>{const _=Lw.create(y);this.reviewStates.push(_)})}updateReply(){Object.assign(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setMarkedState(n){const h=this.markedStates[this.markedStates.length-1];if((null==h?void 0:h.state)!==n.state||!h&&"marked"===n.state){const v=Nw.create(n);return this.markedStates.push(v),!0}return!1}deleteMarkedState(){this.markedStates.pop()}setReviewState(n){const o=Lw.create(n);this.reviewStates.push(o)}deleteReviewState(){this.reviewStates.pop()}clone(n,o){const h=l1.create({annotationUid:n,author:this.author,subject:this.subject,contents:this.contents,creationDate:o,modificationDate:o});return this.cloneStates(h),h}cloneStates(n){this.markedStates.forEach(o=>{const h=Nw.create(zt(Ke({},o),{uid:Ai()}));n.markedStates.push(h)}),this.reviewStates.forEach(o=>{const h=Lw.create(zt(Ke({},o),{uid:Ai()}));n.reviewStates.push(h)})}}class ED extends l1{static create(n,o){return new ED(n,o)}constructor(n,o){super(n,o),W(this,"replies",void 0),this.replies=[]}updateComment(n){Object.assign(this,n)}getReply(n){return this.replies.find(o=>o.uid===n.uid)}clone(n,o){const h=ED.create({annotationUid:n,author:this.author,subject:this.subject,contents:this.contents,creationDate:o,modificationDate:o});return this.cloneStates(h),this.replies.forEach(v=>{h.replies.push(v.clone(n,o))}),h}}class DD extends R_{static create(n){return new DD(n)}constructor(n){super(n),W(this,"bottom",void 0),W(this,"top",void 0),W(this,"annotations",void 0),W(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[]}clone(n){const o=DD.create(n);return o.top=this.top,o.bottom=this.bottom,o.annotations=this.annotations.slice(),o.layers=pn(this.layers),o}createTop(){const{top:n}=this;return this.top+=1,n}addAnnotation(n,o){if(!this.annotations.includes(n)){this.annotations.push(n);const h={annotationUid:n,layer:o};return this.layers.push(h),gt(o)?(h.layer=this.top,this.top+=1):this.sortLayers(),h}return null}sortLayers(){this.layers.sort((n,o)=>n.layer-o.layer)}deleteAnnotations(n){n.forEach(o=>{const h=this.annotations.indexOf(o);h>-1&&this.annotations.splice(h,1);const v=this.layers.findIndex(y=>y.annotationUid===o);v>-1&&this.layers.splice(v,1)})}moveAnnotation(n){const o=this.annotations.indexOf(n);if(o<0)return null;const h=this.layers.findIndex(y=>y.annotationUid===n);if(h<0)return null;const v={annotationUid:n,index:o,layerIndex:h,layer:this.layers[h].layer};return this.deleteAnnotations([n]),v}undoMoveAnnotation(n){const{annotationUid:o}=n;this.annotations.includes(o)||this.layers.find(h=>h.annotationUid===o)||(this.annotations.splice(n.index,0,o),this.layers.splice(n.layerIndex,0,{annotationUid:o,layer:n.layer}))}bringForward(n){const o=this.layers.findIndex(y=>y.annotationUid===n);if(o<0)return null;const h=this.layers[o],v=this.layers[o+1];return v&&(this.switchLayer(h,v),this.sortLayers()),{curLayer:h,forward:v}}switchLayer(n,o){const h=n.layer;n.layer=o.layer,o.layer=h}sendBackward(n){const o=this.layers.findIndex(y=>y.annotationUid===n);if(o<0)return null;const h=this.layers[o],v=this.layers[o-1];return v&&(this.switchLayer(h,v),this.sortLayers()),{curLayer:h,backward:v}}bringToFront(n){const o=this.layers.findIndex(v=>v.annotationUid===n);if(o<0)return null;const h=this.layers[o];return o<this.layers.length-1&&(h.layer=this.top,this.top+=1,this.sortLayers()),h}sendToBack(n){const o=this.layers.findIndex(v=>v.annotationUid===n);if(o<0)return null;const h=this.layers[o];return o>0&&(h.layer=this.bottom,this.bottom-=1,this.sortLayers()),h}restoreLayer(n,o){const h=this.layers.findIndex(v=>v.annotationUid===n);return h<0?null:(this.layers[h].layer=o,this.sortLayers(),!0)}getLayerState(n){const o=this.layers.findIndex(v=>v.annotationUid===n);if(o<0)return{back:!1,front:!1,forward:!1,backward:!1};const h={back:!0,front:!0,forward:!0,backward:!0};return 0===o&&(h.back=!1,h.backward=!1),o===this.layers.length-1&&(h.front=!1,h.forward=!1),1===this.layers.length&&(h.front=!1,h.forward=!1,h.back=!1,h.backward=!1),h}getAnnotationUidListByLayer(){return this.layers.slice().sort((n,o)=>n.layer-o.layer).map(n=>n.annotationUid)}}const Ps=new class{constructor(){W(this,"db",void 0),this.db=new Map}findAnnotationByUid(p){return this.db.get(p)}deleteAnnotation(p){return!!this.db.has(p.uid)&&(this.db.delete(p.uid),!0)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},lf=new class{constructor(){W(this,"db",void 0),this.db=new Map}findCommentByUid(p){return this.db.get(p)}deleteComment(p){this.db.has(p.uid)&&this.db.delete(p.uid)}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},mc=new class{constructor(){W(this,"db",void 0),this.db=new Map}findPageByUid(p){return this.db.get(p)}deletePagesByUids(p){p.forEach(n=>{this.db.delete(n)})}has(p){return this.db.has(p.uid)}save(p){this.db.set(p.uid,p)}clear(){this.db.clear()}},Ya=new class extends or{constructor(){super(...arguments),W(this,"annotationCreated",Dt(this)),W(this,"annotationDeleted",Dt(this)),W(this,"annotationUpdated",Dt(this)),W(this,"commentDeleted",Dt(this)),W(this,"commentUpdated",Dt(this)),W(this,"replyToAnnotation",Dt(this)),W(this,"replyDeleted",Dt(this)),W(this,"replyUpdated",Dt(this)),W(this,"setReplyReviewState",Dt(this)),W(this,"deleteReplyReviewState",Dt(this)),W(this,"bringFroward",Dt(this)),W(this,"sendBackward",Dt(this)),W(this,"bringToFront",Dt(this)),W(this,"sendToBack",Dt(this)),W(this,"restoreLayer",Dt(this)),W(this,"annotationPageSwitched",Dt(this))}};class RL extends jl{static create(n){return new RL(n)}constructor(n){super("annotationCreatedDomainEvent"),W(this,"annotations",void 0),this.annotations=n}}const gRe=new class{constructor(p,n,o,h){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"annotationPageRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.annotationPageRepo=o,this.eventHooks=h}execute(p){const n=p.map(h=>{const v=ID.create(Ke({},h)),y=this.annotationPageRepo.findPageByUid(v.pageUid).addAnnotation(v.uid,h.layer);if(y&&(v.layer=y.layer),this.annotationRepo.save(v),h.comment){var _;const b=ED.create(h.comment);v.comment=b,null!==(_=h.comment.replies)&&void 0!==_&&_.length&&h.comment.replies.forEach(w=>{const I=l1.create(w);b.replies.push(I),this.replyRepo.save(I)})}return v}),o=RL.create(n);return this.eventHooks.annotationCreated.emit(o),n}}(Ps,lf,mc,Ya);class kL extends jl{static create(n,o){return new kL(n,o)}constructor(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),W(this,"annotations",void 0),W(this,"emitEvent",void 0),this.annotations=n,this.emitEvent=o}}const mRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"annotationPageRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=n,this.eventHooks=o}execute(p){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const h of p)if(!this.annotationRepo.has(h))return!1;p.forEach(h=>{this.annotationRepo.deleteAnnotation(h),this.annotationPageRepo.findPageByUid(h.pageUid).deleteAnnotations([h.uid])});const o=kL.create(p,n);return this.eventHooks.annotationDeleted.emit(o),!0}}(Ps,mc,Ya),vRe=new class{constructor(p){W(this,"annotationRepo",void 0),this.annotationRepo=p}execute(p){return this.annotationRepo.findAnnotationByUid(p)}}(Ps);class ML extends jl{static create(n){return new ML(n)}constructor(n){super("replyToAnnotationDomainEvent"),W(this,"reply",void 0),this.reply=n}}const yRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.eventHooks=o}execute(p){const n=this.annotationRepo.findAnnotationByUid(p.annotationUid),o=l1.create({annotationUid:p.annotationUid,author:p.author,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,subject:""});n.addReplies([o]),this.replyRepo.save(o);const h=ML.create(o);return this.eventHooks.replyToAnnotation.emit(h),!0}}(Ps,lf,Ya);class OL extends jl{static create(n,o,h){return new OL(n,o,h)}constructor(n,o,h){super("annotationUpdatedDomainEvent"),W(this,"updateDetails",void 0),W(this,"updatedBy",void 0),W(this,"updateActions",void 0),this.updateDetails=n,this.updatedBy=o,this.updateActions=h}}const _Re=new class{constructor(p,n){W(this,"annotationRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=n}execute(p){const n=[],o=p.updateDetails.map(v=>{const y=this.annotationRepo.findAnnotationByUid(v.uid);if(!y)return null;const _=y.getConfig();v.style&&y.updateStyle(v.style),v.transform&&yo(v.transform,y.transform),v.flags&&(y.flags=[...v.flags]),y.modified=v.modified,v.comment&&Object.assign(y.comment,v.comment),this.annotationRepo.save(y);const b=y.getConfig();return n.push({annotationUid:y.uid,from:_,to:b}),y}),h=OL.create(n,p.updatedBy,p.updateActions);return this.eventHooks.annotationUpdated.emit(h),o}}(Ps,Ya);class FL extends jl{static create(n){return new FL(n)}constructor(n){super("replyUpdatedDomainEvent"),W(this,"reply",void 0),this.reply=n}}const CRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.eventHooks=o}execute(p){const n=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!n)return!1;const o=this.replyRepo.findCommentByUid(p.replyUid);if(!o)return!1;o.updateReply({author:p.author,contents:p.contents,modifiedDate:p.modifiedDate}),n.updateReply(o),this.annotationRepo.save(n),this.replyRepo.save(o);const h=FL.create(o);return this.eventHooks.replyUpdated.emit(h),!0}}(Ps,lf,Ya);class LL extends jl{static create(n){return new LL(n)}constructor(n){super("replyDeletedDomainEvent"),W(this,"reply",void 0),this.reply=n}}const bRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.eventHooks=o}execute(p){if(!this.replyRepo.has(p))return!1;const n=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!n)return!1;n.deleteReplies([p]),this.replyRepo.deleteComment(p);const o=LL.create(p);return this.eventHooks.replyDeleted.emit(o),!0}}(Ps,lf,Ya);class NL extends jl{static create(n,o,h){return new NL(n,o,h)}constructor(n,o,h){super("bringToFrontDomainEvent"),W(this,"annotationUid",void 0),W(this,"from",void 0),W(this,"to",void 0),this.annotationUid=n,this.from=o,this.to=h}}const xRe=new class{constructor(p,n,o){W(this,"annotRepo",void 0),W(this,"annotPageRepo",void 0),W(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=n,this.eventHooks=o}execute(p){const n=this.annotRepo.findAnnotationByUid(p);if(!n)return!1;const o=this.annotPageRepo.findPageByUid(n.pageUid),h=o.getAnnotationUidListByLayer(),v=o.bringToFront(p);if(!v)return!1;n.layer=v.layer;const y=o.getAnnotationUidListByLayer(),_=NL.create(p,h,y);return this.eventHooks.bringToFront.emit(_),!0}}(Ps,mc,Ya);class BL extends jl{static create(n,o,h){return new BL(n,o,h)}constructor(n,o,h){super("sendToBackDomainEvent"),W(this,"annotationUid",void 0),W(this,"from",void 0),W(this,"to",void 0),this.annotationUid=n,this.from=o,this.to=h}}const wRe=new class{constructor(p,n,o){W(this,"annotRepo",void 0),W(this,"annotPageRepo",void 0),W(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=n,this.eventHooks=o}execute(p){const n=this.annotRepo.findAnnotationByUid(p);if(!n)return!1;const o=this.annotPageRepo.findPageByUid(n.pageUid),h=o.getAnnotationUidListByLayer(),v=o.sendToBack(p);if(!v)return!1;n.layer=v.layer;const y=o.getAnnotationUidListByLayer(),_=BL.create(p,h,y);return this.eventHooks.sendToBack.emit(_),!0}}(Ps,mc,Ya);class WL extends jl{static create(n,o,h,v){return new WL(n,o,h,v)}constructor(n,o,h,v){super("bringForwardDomainEvent"),W(this,"annotationUid",void 0),W(this,"forwardUid",void 0),W(this,"from",void 0),W(this,"to",void 0),this.annotationUid=n,this.forwardUid=o,this.from=h,this.to=v}}const SRe=new class{constructor(p,n,o){W(this,"annotRepo",void 0),W(this,"annotPageRepo",void 0),W(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=n,this.eventHooks=o}execute(p){const n=this.annotRepo.findAnnotationByUid(p);if(!n)return!1;const o=this.annotPageRepo.findPageByUid(n.pageUid),h=o.getAnnotationUidListByLayer(),v=o.bringForward(p);if(!v)return!1;const{curLayer:y,forward:_}=v;n.layer=y.layer,_&&(this.annotRepo.findAnnotationByUid(_.annotationUid).layer=_.layer);const b=o.getAnnotationUidListByLayer(),w=WL.create(p,null==_?void 0:_.annotationUid,h,b);return this.eventHooks.bringFroward.emit(w),!0}}(Ps,mc,Ya);class UL extends jl{static create(n,o,h,v){return new UL(n,o,h,v)}constructor(n,o,h,v){super("sendBackwardDomainEvent"),W(this,"annotationUid",void 0),W(this,"backwardUid",void 0),W(this,"from",void 0),W(this,"to",void 0),this.annotationUid=n,this.backwardUid=o,this.from=h,this.to=v}}const TRe=new class{constructor(p,n,o){W(this,"annotRepo",void 0),W(this,"annotPageRepo",void 0),W(this,"eventHooks",void 0),this.annotRepo=p,this.annotPageRepo=n,this.eventHooks=o}execute(p){const n=this.annotRepo.findAnnotationByUid(p);if(!n)return!1;const o=this.annotPageRepo.findPageByUid(n.pageUid),h=o.getAnnotationUidListByLayer(),v=o.sendBackward(p);if(!v)return!1;const{curLayer:y,backward:_}=v;n.layer=y.layer,_&&(this.annotRepo.findAnnotationByUid(_.annotationUid).layer=_.layer);const b=o.getAnnotationUidListByLayer(),w=UL.create(p,null==_?void 0:_.annotationUid,h,b);return this.eventHooks.sendBackward.emit(w),!0}}(Ps,mc,Ya);class VL extends jl{static create(n){return new VL(n)}constructor(n){super("commentUpdatedDomainEvent"),W(this,"comment",void 0),this.comment=n}}const IRe=new class{constructor(p,n){W(this,"annotationRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.eventHooks=n}execute(p){const n=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!n)return!1;n.updateComment(p);const o=VL.create(n.comment);return this.eventHooks.commentUpdated.emit(o),!0}}(Ps,Ya);class jL extends jl{static create(n){return new jL(n)}constructor(n){super("deleteReplyReviewStateDomainEvent"),W(this,"replyUid",void 0),this.replyUid=n}}const ERe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.eventHooks=o}execute(p){const n=this.replyRepo.findCommentByUid(p);if(!n)return!1;const o=this.annotationRepo.findAnnotationByUid(n.annotationUid);if(!o)return!1;o.deleteReplyReviewSate(n),this.annotationRepo.save(o);const h=jL.create(p);return this.eventHooks.deleteReplyReviewState.emit(h),!0}}(Ps,lf,Ya);class HL extends jl{static create(n){return new HL(n)}constructor(n){super("setReplyReviewStateDomainEvent"),W(this,"author",void 0),W(this,"creationDate",void 0),W(this,"contents",void 0),W(this,"state",void 0),W(this,"replyUid",void 0),this.author=n.author,this.creationDate=n.creationDate,this.contents=n.contents,this.state=n.state,this.replyUid=n.replyUid}}const DRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.replyRepo=n,this.eventHooks=o}execute(p){const n=this.replyRepo.findCommentByUid(p.replyUid);if(!n)return!1;const o=this.annotationRepo.findAnnotationByUid(n.annotationUid);if(!o)return!1;o.setReplyReviewState(n,p),this.annotationRepo.save(o);const h=HL.create(p);return this.eventHooks.setReplyReviewState.emit(h),!0}}(Ps,lf,Ya),ARe=new class{constructor(p){W(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){let n=this.annotationPageRepo.findPageByUid(p);return n||(n=DD.create(p),this.annotationPageRepo.save(n)),n}}(mc),PRe=new class{constructor(p,n,o){W(this,"annotationPageRepo",void 0),W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=n,this.replyRepo=o}execute(p){const n=this.annotationPageRepo.findPageByUid(p.pageUid);if(!n)return null;const o=n.clone(p.newPageUid),h=new Map;return n.annotations.forEach((v,y)=>{const _=this.annotationRepo.findAnnotationByUid(v).clone(p.newPageUid,"");_.comment.replies.forEach(b=>{this.replyRepo.save(b)}),this.annotationRepo.save(_),o.annotations[y]=_.uid,h.set(v,_.uid)}),o.layers.forEach(v=>{v.annotationUid=h.get(v.annotationUid)}),this.annotationPageRepo.save(o),o}}(mc,Ps,lf),RRe=new class{constructor(p){W(this,"annotationPageRepo",void 0),this.annotationPageRepo=p}execute(p){this.annotationPageRepo.deletePagesByUids(p)}}(mc),kRe=new class{constructor(p,n,o){W(this,"annotationPageRepo",void 0),W(this,"annotationRepo",void 0),W(this,"replyRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=n,this.replyRepo=o}execute(p){const n=this.annotationPageRepo.findPageByUid(p.pageUid);if(!n)return null;const o=this.annotationRepo.findAnnotationByUid(p.annotationUid);if(!o)return null;const h=o.clone(p.pageUid," ");return h.comment.replies.forEach(v=>{this.replyRepo.save(v)}),n.addAnnotation(h.uid),this.annotationRepo.save(h),h}}(mc,Ps,lf);class GL extends jl{static create(n,o,h){return new GL(n,pn(o),pn(h))}constructor(n,o,h){super("annotationPageSwitchedDomainEvent"),W(this,"annotationUid",void 0),W(this,"from",void 0),W(this,"to",void 0),this.annotationUid=n,this.from=o,this.to=h}}const MRe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"annotationPageRepo",void 0),W(this,"eventHook",void 0),this.annotationRepo=p,this.annotationPageRepo=n,this.eventHook=o}execute(p){const{annotationUid:n,pageUid:o,x:h,y:v,layer:y}=p,_=this.annotationRepo.findAnnotationByUid(n);if(!_)return!1;const b=this.annotationPageRepo.findPageByUid(_.pageUid);if(!b)return!1;const w=this.annotationPageRepo.findPageByUid(o);if(!w)return!1;const I={pageUid:_.pageUid,x:_.style.x,y:_.style.y,layer:_.layer};b.deleteAnnotations([n]),w.addAnnotation(n,y),_.updateStyle({x:h,y:v}),_.layer=y,_.pageUid=o;const A=GL.create(_.uid,I,{pageUid:o,x:h,y:v,layer:y});return this.eventHook.annotationPageSwitched.emit(A),!0}}(Ps,mc,Ya);class zL extends jl{static create(n,o){return new zL(n,o)}constructor(n,o){super("restoreLayerDomainEvent"),W(this,"annotationUid",void 0),W(this,"layer",void 0),this.annotationUid=n,this.layer=o}}const ORe=new class{constructor(p,n,o){W(this,"annotationRepo",void 0),W(this,"annotationPageRepo",void 0),W(this,"eventHooks",void 0),this.annotationRepo=p,this.annotationPageRepo=n,this.eventHooks=o}execute(p){let{annotationUid:n,layer:o}=p;const h=this.annotationRepo.findAnnotationByUid(n);if(!h)return!1;this.annotationPageRepo.findPageByUid(h.pageUid).restoreLayer(n,o),h.layer=o;const v=zL.create(n,o);return this.eventHooks.restoreLayer.emit(v),!0}}(Ps,mc,Ya),FRe=new class{constructor(p,n){W(this,"annotationPageRepo",void 0),W(this,"annotationRepo",void 0),this.annotationPageRepo=p,this.annotationRepo=n}execute(p){let n={back:!1,front:!1,forward:!1,backward:!1};const o=this.annotationRepo.findAnnotationByUid(p);if(!o)return n;const h=this.annotationPageRepo.findPageByUid(o.pageUid);return h&&(n=h.getLayerState(p)),n}}(mc,Ps);class LRe extends or{constructor(){super(),W(this,"annotationRepo",Ps),W(this,"annotationReplyRepo",lf),W(this,"annotationPageRepo",mc),W(this,"hooks",Ya),this.register(Ya)}dispose(){this.reset(),this.hooks.dispose(),super.dispose()}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear()}createAnnotationPage(n){return ARe.execute(n)}copyAnnotationPage(n,o){return PRe.execute({pageUid:n,newPageUid:o})}deleteAnnotationPage(n){return RRe.execute(n)}createAnnotations(n){return gRe.execute(n)}copyAnnotation(n,o){return kRe.execute({annotationUid:n,pageUid:o})}deleteAnnotations(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=n.map(v=>(Sn(v)&&(v=Ps.findAnnotationByUid(v)),v));return mRe.execute(h,o)}updateAnnotation(n){return _Re.execute(n)}switchAnnotationPage(n,o){return MRe.execute(Ke({annotationUid:Vn(n)?n.uid:n},o))}getAnnotationByUid(n){return vRe.execute(n)}getAnnotationLayerState(n){return FRe.execute(n)}replyToAnnotation(n){return yRe.execute(n)}deleteReply(n){return Sn(n)&&(n=lf.findCommentByUid(n)),bRe.execute(n)}updateReply(n){return CRe.execute(n)}updateComment(n){return IRe.execute(n)}deleteReplyReviewState(n){return ERe.execute(n)}setReplyReviewState(n){return DRe.execute(n)}bringToFront(n){return xRe.execute(n)}sendToBack(n){return wRe.execute(n)}bringForward(n){return SRe.execute(n)}sendBackward(n){return TRe.execute(n)}restoreLayer(n,o){return ORe.execute({annotationUid:n,layer:o})}}const NRe=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle"];class BRe extends or{constructor(n){super(),W(this,"context",void 0),this.context=n}updateConfig(n){for(const[o,h]of Object.entries(n))NRe.includes(o)&&this[o](h)}defaultStyleConfig(n){if(!Vn(n))return;const{annotationController:o}=this.context,{viewer:h}=this.context;o.setAnnotationInteractiveConfig({defaultStyleConfig:n}),o.updateFreeTextDefaultConfig(),h.hooks.annotationDefaultStyleChanged.emit(h.getAnnotationConfig().defaultStyleConfig),h.emit("annotationDefaultStyleChanged",h.getAnnotationConfig().defaultStyleConfig)}enableContinuousDrawing(n){const{annotationController:o}=this.context;o.interactiveConfig.enableContinuousDrawing=n}controlsStyle(n){if(!Vn(n))return;const{annotationController:o}=this.context;o.setAnnotationInteractiveConfig({controlsStyle:n})}inkCreateDelay(n){const{annotationController:o}=this.context;o.interactiveConfig.inkCreateDelay=n}showOnTopWhenSelected(n){const{annotationController:o}=this.context;o.interactiveConfig.showOnTopWhenSelected=n}}const hne={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},WRe={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class URe extends or{constructor(n){super(),W(this,"viewer",void 0),W(this,"annotationConfigService",void 0),W(this,"annotationController",void 0),W(this,"context",void 0),this.viewer=n,this.context=n.context,this.annotationConfigService=new BRe(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation()}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new MZ).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new pDe(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on(n=>{const o=new Set(n.shapes.map(h=>h.uid));this.context.core.annotationService.deleteAnnotations([...o])},this),this.annotationController.hooks.selectAnnotation.on(n=>{const o=xF.create(n.oldAnnotationsUids,n.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(o),n.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...n.newAnnotationUids],oldAnnotationUids:[...n.oldAnnotationsUids]})},this),this.annotationController.hooks.modifyAnnotation.on(n=>{const o=n.shapes.map(h=>{const v=h.shape.getAnnotationConfig();return{annotationUid:h.uid,options:{transform:pn(v.transform),style:v.style}}});this.context.core.annotationService.updateAnnotations(o,this.context.uid,n.actions)},this),this.annotationController.hooks.addAnnotation.on(n=>{const o=this.context.getActiveTab();if(!o)return;const{annotationService:h}=this.context.core;n.shapes.forEach(v=>{const y=v.shape.getAnnotationConfig(),_=hc(),b=h.createAnnotation(o.uid,{uid:v.uid,docUid:o.uid,pageUid:v.shape.pageUid,type:WRe[y.type],transform:pn(y.transform),style:pn(y.style),flags:["print"],comment:{annotationUid:v.uid,author:"",subject:"",contents:"",creationDate:_,modificationDate:_,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(v.uid,b.layer)})},this),this.annotationController.hooks.annotationModeChanged.on(n=>{"none"===n&&"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"})}),this.annotationController.hooks.beforeAnnotationEdit.on(n=>{this.viewer.hooks.beforeAnnotationEdit.emit(n)}),this.annotationController.hooks.afterAnnotationEdit.on(n=>{this.viewer.hooks.afterAnnotationEdit.emit(n)}),this.annotationController.hooks.beforeAnnotationDraw.on(n=>{this.viewer.hooks.beforeAnnotationDraw.emit(n)}),this.annotationController.hooks.afterAnnotationDraw.on(n=>{this.viewer.hooks.afterAnnotationDraw.emit(n)}),this.annotationController.hooks.renderAnnotation.on(()=>{this.context.render()}),this.annotationController.hooks.selectAnnotationTextChars.on(n=>{this.viewer.hooks.annotationTextCharsSelected.emit(n)}))}listenViewerNativeEventsForAnnotation(){const n=this.context.rendererService.getCanvasDom();$o(n,rr()?"click":"pointerup",this).on(o=>{o.preventDefault(),this.annotationController.clickHandler(o)}),$o(document,"keydown",this).on(o=>{this.annotationController.keyDownHandler(o)}),$o(n,"dblclick",this).on(o=>{this.annotationController.dblClickHandler(o)})}listenViewerEventsForAnnotation(){const{context:n,context:{hooks:o,tabService:h}}=this;(n.isDefaultViewer||n.isThumbnailViewer)&&(o.pageExistenceChanged.on(v=>{0===v.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null)}),o.toolModeChanged.on(v=>{const{annotationMode:y}=n.viewerConfig;if("annotation"!==v.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===v.newToolMode&&this.selectAnnotations([]);else{let _="draw";"select"===y?_="select":"erase"===y&&(_="erase"),this.annotationController.setAnnotationMode(_)}},this),o.annotationModeChanged.on(v=>{const{toolMode:y}=n.viewerConfig;if("select"===v.newAnnotationMode||"erase"===v.newAnnotationMode){const _=v.newAnnotationMode;"annotation"===y&&this.annotationController.setAnnotationMode(_)}else this.annotationController.drawType=hne[v.newAnnotationMode],"annotation"===y&&this.annotationController.setAnnotationMode("draw")},this),o.addPagesToDoc.on(v=>{h.getTab(v.docUid)&&this.addAnnotationByPageUids(v.pageUids)},this),o.openDocument.on(v=>{h.getTab(v.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(v.pages))},this),o.closeDocument.on(v=>{v.pages.forEach(y=>{const _=this.context.core.pageService.getPage(y);this.annotationController.deleteShape(_.annotations,!1,!1)})},this),o.deletePages.on(v=>{v.pageUids.forEach(y=>{const _=this.context.core.pageService.getPage(y);this.annotationController.deleteShape(_.annotations,!1,!1)})},this),o.syncDocument.on(v=>{h.getTab(v.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(v.pages))},this),o.afterRender.on(v=>{if(null==v||!v.total)return;const y=n.annotationEditService.containerPage;if(!y||!v.getPageByUid(y.uid))return;let{x:_,y:b}=y.cropBox.getPosition(),{width:w,height:I}=y.cropBox;const A=(y.rotation%360+360)%360/90;if(1===A?_-=I:2===A?(_-=w,b-=I):3===A&&(b-=w),1===A||3===A){const M=w;w=I,I=M}this.annotationController.eventService.setEventArea({x:_,y:b,width:w,height:I})},this))}disableTextEditMode(){const{eventService:n}=this.annotationController;null!=n&&n.activatedShape&&(null==n?void 0:n.activatedShape)instanceof sr&&null!=n&&n.activatedShape.isEditMode&&(null==n||n.activatedShape.textEditEventHandler.disableEditMode(),this.context.render())}addAnnotationByPageUids(n){n.forEach(o=>{const h=this.context.core.pageService.getPage(o);if(h.annotations.forEach(v=>{const y=this.context.core.annotationService.annotationApp.getAnnotationByUid(v);this.addAnnotationByAnnotationData(y)}),0===h.annotations.length){const v=this.context.tabService.getTab(h.doc.uid);if(!v)return;const y=v.getPageByUid(h.uid);if(!y)return;this.annotationController.setAnnotationContainer(h.uid,y.mediaBox)}})}addAnnotationByAnnotationData(n){if("unknown"===n.type)return!0;const o=this.context.core.pageService.getPage(n.pageUid);if(!o)return!1;const h=this.context.tabService.getTab(o.doc.uid);if(!h)return!1;const v=h.getPageByUid(n.pageUid);if(!v)return!1;const y=n.getConfig();this.annotationController.setAnnotationContainer(n.pageUid,v.mediaBox);const _=this.annotationController.addShape(hne[n.type],{id:n.uid,style:zt(Ke({},y.style),{zIndex:n.layer}),transform:y.transform},!1);if(this.annotationController.setAnnotationFlags(n.uid,{enableControl:!y.flags.includes("readOnly"),isVisible:!y.flags.includes("noView")},!1),_ instanceof iu&&"base"===_.stampType){const b=_.getAnnotationConfig();n.transform.position=b.transform.position,n.transform.scale=b.transform.scale,n.style=b.style}if(_ instanceof sr&&"freeTextWriter"===_.textType){const b=_.getAnnotationConfig();n.style.width=b.style.width}return this.syncAnnotationLayerState(),!0}updateAnnotations(n,o){if(o===this.context.uid)return!0;const h=n.reduce((v,y)=>{const _=this.context.core.annotationService.annotationApp.getAnnotationByUid(y);if(_){const b=this.context.core.pageService.getPage(_.pageUid);if(b&&this.context.tabService.getTab(b.doc.uid)){const w=_.getConfig();v.push({annotationUid:y,config:w})}}return v},[]);return h.length===n.length&&(h.forEach(v=>{var y,_;let{annotationUid:b,config:w}=v;this.annotationController.updateShape(b,{id:b,style:w.style,transform:w.transform},!1);const I=this.annotationController.getShape(b),A=this.context.core.annotationService.annotationApp.getAnnotationByUid(b),M=I.getAnnotationConfig();null!=M&&null!==(y=M.transform)&&void 0!==y&&y.position&&(A.transform.position=M.transform.position),null!=M&&null!==(_=M.transform)&&void 0!==_&&_.scale&&(A.transform.scale=M.transform.scale),I instanceof iu&&"stamp"===I.renderType&&(A.style.stampConfig=M.style.stampConfig),this.annotationController.setAnnotationFlags(b,{enableControl:!w.flags.includes("readOnly"),isVisible:!w.flags.includes("noView")})}),!0)}updateAnnotationPage(n,o){const h=this.context.core.annotationService.getAnnotationByUid(n);if(!h)return;const v=this.context.core.pageService.getPage(h.pageUid);if(!v)return;const y=this.context.tabService.getTab(v.doc.uid);if(!y)return;const _=y.getPageByUid(o);_&&(this.annotationController.moveShape([n],o,_.mediaBox),this.syncAnnotationLayerState())}updateLayer(n){const o=n.reduce((h,v)=>{const y=this.context.core.annotationService.annotationApp.getAnnotationByUid(v);if(y){const _=this.context.core.pageService.getPage(y.pageUid);_&&this.context.tabService.getTab(_.doc.uid)&&h.push(y)}return h},[]);return o.length===n.length&&(o.forEach(h=>{this.annotationController.updateLayer(h.uid,h.layer)}),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let n={back:!1,front:!1,forward:!1,backward:!1};const o=this.annotationController.getSelectedShapeUids();return 1===o.length&&(n=this.context.core.annotationService.getAnnotationLayerState(o[0])),this.viewer.hooks.annotationLayerStateChanged.emit(SF.create(n)),n}deleteAnnotations(n){this.annotationController.deleteShape(n,!1,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.syncAnnotationLayerState()}selectAnnotations(n){return this.annotationController.selectShape(n)}getSelectedAnnotations(){const n=this.annotationController.getSelectedShapeUids();if(!n.length)return[];const o=[];return n.forEach(h=>{const v=this.context.core.annotationService.annotationApp.getAnnotationByUid(h);v&&o.push(v)}),o}duplicateAnnotation(n,o){throw new Error("Method not implemented.")}}class VRe extends or{constructor(n){super(),W(this,"context",void 0),W(this,"containerPage",void 0),this.context=n}isHitAnnotation(n){return this.context.annotationController.isHitShape(n)}startHandler(n,o){this.context.annotationController.startHandler(n,o)}cursorHandler(n,o,h){this.context.annotationController.cursorHandler(n,o,h)}moveHandler(n,o){this.context.annotationController.moveHandler(n,o)}endHandler(n){this.context.annotationController.endHandler(n)}activateAnnotation(n,o){this.context.annotationController.eventService.activateShape(n,o)}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear()}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}moveAnnotationByKeyboard(n){}setAnnotationContainer(n){this.containerPage=n,this.context.annotationController.setAnnotationContainer(n.uid,n.mediaBox)}setAnnotationInteractionArea(n){this.context.annotationController.eventService.setEventArea(n)}copyAnnotations(){const n=this.context.annotationController.getSelectedShapeUids();0===n.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(n)}cutAnnotations(){const n=this.context.annotationController.getSelectedShapeUids();0===n.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(n)}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations()}dispose(){super.dispose(),this.containerPage=null}}class jRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on(h=>{h.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{action:n}=this,{annotationApp:o}=this.core.annotationService,{annotationConfig:h}=this.action;return!!o.createAnnotations([{docUid:n.docUid,uid:h.uid,pageUid:n.pageUid,type:h.type,style:h.style,transform:h.transform,flags:h.flags,comment:h.comment,layer:h.layer}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid])}}class HRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="deleteAnnotation",o.commandService.onBeforeRefreshCommands.on(h=>{n.docUid===h.docUid&&(n.deleteConfigs.slice().forEach(v=>{if(h.pageUids.includes(v.pageUid)){const y=n.deleteConfigs.findIndex(_=>_.pageUid===v.pageUid);n.deleteConfigs.splice(y,1)}}),this.isValid=n.deleteConfigs.length>0)},this)}execute(){const{action:n}=this,o=n.deleteConfigs.map(h=>h.uid);return this.core.annotationService.annotationApp.deleteAnnotations(o),!0}undo(){const{annotationApp:n}=this.core.annotationService,o=this.action.deleteConfigs.map(h=>({docUid:this.action.docUid,uid:h.uid,type:h.type,pageUid:h.pageUid,style:h.style,transform:h.transform,flags:h.flags,comment:h.comment,layer:h.layer,oriIndex:h.oriIndex,modified:h.modified}));n.createAnnotations(o)}}class GRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),W(this,"oldLayer",void 0),W(this,"newLayer",void 0),this.action=n,this.core=o,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on(h=>{h.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:n}=this.core.annotationService,{annotationUid:o}=this.action,h=n.getAnnotationByUid(o);return this.oldLayer||(this.oldLayer=h.layer),this.newLayer?n.restoreLayer(o,this.newLayer):(n.bringToFront(o),this.newLayer=h.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class zRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on(h=>{h.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}}class YRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on(h=>{h.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}}class XRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),W(this,"oldLayer",void 0),W(this,"newLayer",void 0),this.action=n,this.core=o,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on(h=>{h.pageUids.includes(this.action.pageUid)&&(this.isValid=!1)},this)}execute(){const{annotationApp:n}=this.core.annotationService,{annotationUid:o}=this.action,h=n.getAnnotationByUid(o);return this.oldLayer||(this.oldLayer=h.layer),this.newLayer?n.restoreLayer(o,this.newLayer):(n.sendToBack(o),this.newLayer=h.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer)}}class $Re extends rf{constructor(n,o,h){super(),W(this,"action",void 0),W(this,"core",void 0),W(this,"updatedBy",void 0),this.action=n,this.core=o,this.updatedBy=h,this.type="updateAnnotation",o.commandService.onBeforeRefreshCommands.on(v=>{if(n.docUid!==v.docUid)return;const{pageUid:y}=n;v.pageUids.includes(y)&&(this.isValid=!1)},this)}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1)}update(n){const{annotationApp:o}=this.core.annotationService,h=this.action.updateDetails.map(v=>{const y=pn(n?v.to:v.from);return Ke({uid:v.annotationUid},y)});o.updateAnnotation({updateDetails:h,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]})}}class qRe extends rf{constructor(n,o){super(),W(this,"action",void 0),W(this,"core",void 0),this.action=n,this.core=o,this.type="switchAnnotationPage",o.commandService.onBeforeRefreshCommands.on(h=>{n.docUid===h.docUid&&n.moveConfigs.slice().every(v=>((h.pageUids.includes(v.from.pageUid)||h.pageUids.includes(v.to.pageUid))&&(this.isValid=!1),this.isValid))},this)}execute(){const{annotationApp:n}=this.core.annotationService;return this.action.moveConfigs.forEach(o=>{if(gt(o.to.layer)){const h=n.annotationPageRepo.findPageByUid(o.to.pageUid).createTop();o.to.layer=h}n.switchAnnotationPage(o.annotationUid,Ke({},o.to))}),!0}undo(){const{annotationApp:n}=this.core.annotationService;this.action.moveConfigs.forEach(o=>{n.switchAnnotationPage(o.annotationUid,Ke({},o.from))})}}class KRe extends or{constructor(n){super(),W(this,"core",void 0),W(this,"annotationApp",void 0),W(this,"hooks",void 0),W(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),W(this,"clipboard",[]),this.core=n,this.annotationApp=new LRe,this.hooks=this.annotationApp.hooks}reset(){this.annotationApp.reset()}getAnnotationByUid(n){return this.annotationApp.getAnnotationByUid(n)}deleteAnnotationPages(n){const o=n.reduce((h,v)=>{const y=this.core.pageService.getPage(v);return y&&h.push(...y.annotations),h},[]);this.deleteAnnotations(o,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(n)}createAnnotationsByParsedPages(n,o){const h=hc();return o.reduce((v,y)=>{var _;this.annotationApp.createAnnotationPage(y.pageUid);const b=null===(_=y.annotations)||void 0===_?void 0:_.reduce((w,I)=>{var A,M,F,V,B;pne(I);const Q={uid:I.uid,docUid:n,pageUid:y.pageUid,type:I.type,style:I.style,transform:I.transform,flags:I.flags,comment:JRe(I.comment),creationDate:null!==(A=null===(M=I.comment)||void 0===M?void 0:M.creationDate)&&void 0!==A?A:h,modificationDate:null!==(F=null===(V=I.comment)||void 0===V?void 0:V.modifiedDate)&&void 0!==F?F:h,oriIndex:null===(B=I.raw)||void 0===B?void 0:B.oriIndex};return w.push(Q),w},[]);return null!=b&&b.length?(this.annotationApp.createAnnotations(b),v.push(b.map(w=>w.uid))):v.push([]),v},[])}createAnnotation(n,o){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(pne(o),h){const v=new jRe({actionUid:Ai(),type:"createAnnotation",docUid:n,pageUid:o.pageUid,annotationConfig:{uid:o.uid,type:o.type,style:o.style,transform:o.transform,flags:o.flags,comment:o.comment,layer:o.layer,modified:o.modified,oriIndex:o.oriIndex}},this.core);this.core.commandService.execute(v,n)}else this.annotationApp.createAnnotations([o]);return this.annotationApp.getAnnotationByUid(o.uid)}deleteAnnotations(n){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:h,commandService:v}=this.core,y=n.reduce((_,b)=>{const w=this.annotationApp.getAnnotationByUid(b);if(w){const I=h.getPage(w.pageUid),A=_.get(I.doc.uid)||{uid:I.doc.uid,annotationConfigs:[]};_.set(A.uid,A);const M=w.getConfig();M.layer=w.layer,A.annotationConfigs.push(M)}return _},new Map);if(o)for(const[_,b]of y){const w=b.annotationConfigs.map(A=>({uid:A.uid,type:A.type,pageUid:A.pageUid,style:A.style,transform:A.transform,flags:A.flags,comment:A.comment,layer:A.layer,oriIndex:A.oriIndex,modified:A.modified})),I=new HRe({actionUid:Ai(),type:"createAnnotation",docUid:_,deleteConfigs:w},this.core);v.execute(I,b.uid)}else this.annotationApp.deleteAnnotations(n,!1)}updateAnnotations(n,o,h){let v,y;const _=n.reduce((A,M)=>{const{annotationUid:F}=M,V=this.annotationApp.getAnnotationByUid(F);if(V){const B=this.core.pageService.getPage(V.pageUid);B&&(v=B.uid,y=B.doc.uid,A.push({annotation:V,page:B,options:M.options}))}return A},[]);if(null==_||!_.length||_.length!==n.length)return;const b=hc(),w=_.map(A=>{let{annotation:M,options:V}=A;return V.comment||(V.comment={}),V.comment.modificationDate=b,{annotationUid:M.uid,from:zt(Ke({},M.getConfig()),{modified:M.modified}),to:zt(Ke({},V),{modified:!0})}}),I=new $Re({actionUid:Ai(),type:"updateAnnotation",docUid:y,pageUid:v,updateDetails:w,updateActions:h||[]},this.core,o);this.core.commandService.execute(I,y)}switchAnnotationPage(n){const o=n.map(_=>Ke({annotation:this.annotationApp.getAnnotationByUid(_.annotationUid)},_)),h=this.core.pageService.getPage(o[0].annotation.pageUid);if(!h)return;const v=o.map(_=>{let{annotationUid:b,annotation:w,pageUid:I,x:A,y:M}=_;return{annotationUid:b,from:{pageUid:w.pageUid,x:w.style.x,y:w.style.y,layer:w.layer},to:{pageUid:I,x:gt(A)?w.style.x:A,y:gt(M)?w.style.y:M,layer:void 0}}}),y=new qRe({actionUid:Ai(),type:"switchAnnotationPage",docUid:h.doc.uid,moveConfigs:v},this.core);this.core.commandService.execute(y,h.doc.uid)}duplicateAnnotation(n,o){const h=this.annotationApp.getAnnotationByUid(n);if(!h)return null;const v=h.getConfig();return v.uid=Ai(),o&&(v.pageUid=o),v.comment.creationDate=hc(),v.comment.modificationDate=v.comment.creationDate,this.createAnnotation(v.docUid,v)}copyAnnotations(n){n.length&&(this.clipboard=[]),n.forEach(o=>{const h=this.annotationApp.getAnnotationByUid(o);if(h){const v=h.getConfig();this.clipboard.push(v)}})}cutAnnotations(n){this.copyAnnotations(n),this.deleteAnnotations(n)}pasteAnnotations(n,o){this.clipboard.length&&this.clipboard.forEach(h=>{const v=hc(),y=pn(h),_=Ai();Object.assign(y,{uid:_,docUid:n,pageUid:o,creationDate:v,modificationDate:v});const b={annotationUid:_,creationDate:v,modificationDate:v,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(y.comment,b):Object.assign(y.comment,b,{contents:""}),this.createAnnotation(h.docUid,y)})}clearAnnotationClipboard(){this.clipboard=[]}bringToFront(n){return this.handleLayer(n,"f")}bringForward(n){return this.handleLayer(n,"fw")}sendToBack(n){return this.handleLayer(n,"b")}sendBackward(n){return this.handleLayer(n,"bw")}handleLayer(n,o){const h=this.annotationApp.getAnnotationByUid(n);if(!h)return!1;const v=this.core.pageService.getPage(h.pageUid);if(!v)return!1;const y={actionUid:Ai(),type:o,annotationUid:n,docUid:v.doc.uid,pageUid:v.uid},_=this.annotationApp.getAnnotationLayerState(n);let b;return"f"===o&&_.front?b=new GRe(y,this.core):"fw"===o&&_.forward?b=new zRe(y,this.core):"bw"===o&&_.backward?b=new YRe(y,this.core):"b"===o&&_.back&&(b=new XRe(y,this.core)),b&&this.core.commandService.execute(b,v.doc.uid),!0}getAnnotationLayerState(n){return this.annotationApp.getAnnotationLayerState(n)}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(n,o){var h,v;const{type:y,transform:_,style:b}=n.getConfig();let w=b,I=_;if("textTypewriter"===y&&(null===(h=n.transform)||void 0===h||!h.position)){const F=new sr({style:b,transform:_},"freeTextWriter",{}).getAnnotationConfig();w=F.style,I=F.transform}o&&function(F,V){const B=["rx","x","width","borderWidth","fontSize"],Q=["ry","y","height"],J=["startPoint","endPoint"];Object.keys(F).forEach(Z=>{const re=F[Z];if(B.includes(Z)||Q.includes(Z)){const se=ni(re);F[Z]=V.toPixelPPI(se.value,Q.includes(Z))}else J.includes(Z)?F[Z]={x:V.toPixelPPI(re.x,!1),y:V.toPixelPPI(re.y,!0)}:"lineDash"===Z?F[Z]=re.map(se=>V.toPixelPPI(se,!1)):"points"===Z?F[Z]=re.map(se=>({x:V.toPixelPPI(se.x,!1),y:V.toPixelPPI(se.y,!0)})):"segments"===Z?F[Z]=re.map(se=>se.map(ce=>({x:V.toPixelPPI(ce.x,!1),y:V.toPixelPPI(ce.y,!0)}))):"textContents"===Z&&(F[Z]=re.map(se=>zt(Ke({},se),{fontSize:V.toPixelPPI(ni(se.fontSize).value,!1)})))})}(w,o),"ellipse"===y&&(w.x+=w.width/2||0,w.y+=w.height/2||0,w.rx=w.width/2||w.rx,w.ry=w.height/2||w.ry),I&&null!==(v=I)&&void 0!==v&&v.position&&(I.position={x:o.toPixelPPI(I.position.x,!1),y:o.toPixelPPI(I.position.y,!0)});const A={id:n.uid,style:w,transform:I};let M;switch(y){case"rectangle":M=new _2(A);break;case"ellipse":M=new jv(A);break;case"line":M=new uw(A);break;case"ink":M=new Qd(A);break;case"polygon":M=new lw(A);break;case"polyline":M=new cw(A);break;case"textTypewriter":M=new sr(A,"freeTextWriter",{},!1);break;case"textBox":M=new sr(A,"textBox");break;case"stamp":M=new iu(A);break;case"highlight":M=new Kh(A,Zd.HIGHLIGHT);break;case"underline":M=new Kh(A,Zd.UNDERLINE);break;case"strikeout":M=new Kh(A,Zd.STRIKEOUT);break;case"incomplete":M=new F5(A)}if(M instanceof iu&&!M.style.imageData&&M.updateStampStyle({x:w.x,y:w.y,width:w.width,height:w.height}),["highlight","underline","strikeout","incomplete"].includes(y)){const{resolutionX:F,resolutionY:V}=o,{displayResolution:B}=jn,Q=F/B,J=V/B;M.setOrigin(0,0),M.scaleLocal(Q,J)}return M}getAnnotationUidsByLayer(n){const o=this.annotationApp.annotationPageRepo.findPageByUid(n);return null==o?void 0:o.getAnnotationUidListByLayer()}}function JRe(p){return{annotationUid:p.uid,author:p.author,subject:p.subject,contents:p.contents,creationDate:p.creationDate,modificationDate:p.modifiedDate,markedStates:fne(p.markedStates||[]),reviewStates:fne(p.reviewStates||[])}}function fne(p){return p.map(n=>({uid:n.uid,author:n.author,contents:n.contents,creationDate:n.creationDate,state:n.state}))}function pne(p){if("stamp"===p.type){const n=new iu({style:p.style,transform:p.transform}).getAnnotationConfig();p.style=n.style,p.transform=zt(Ke({},p.transform),{position:n.transform.position,scale:n.transform.scale})}}const QRe={install(p){const n=p.getClass("Viewer"),o=(h=n,class extends h{constructor(v){super(v),W(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new URe(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new VRe(this.annotationViewerContext))}listenHooksForAnnotation(){const v=()=>{const y=this.getSelectedAnnotations();if(1!==y.length||!y[0])return;const _=this.getAnnotationObject(y[0].uid);_ instanceof sr&&_.isEditMode&&_.updateCursor()};this.hooks.scroll.on(y=>{this.context.isDefaultViewer&&v()}),this.hooks.resize.on(y=>{this.context.isDefaultViewer&&v()}),this.hooks.zoomChanged.on(y=>{this.context.isDefaultViewer&&v()}),this.hooks.pageChanged.on(y=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const _=this.getActiveTab();if(null!=_&&_.total){const b=_.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(b)}_&&"single"===_.context.displayMode&&this.annotationViewerContext.disableTextEditMode()}},this),this.hooks.currentPageChanged.on(y=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const _=this.getActiveTab();if(null!=_&&_.total){const b=_.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(b)}}},this)}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const v=this.context.core.annotationService.annotationApp.hooks;v.annotationCreated.on(_=>{_.annotations.forEach(b=>{this.annotationViewerContext.addAnnotationByAnnotationData(b)}),this.context.render()},this),v.annotationDeleted.on(_=>{this.annotationViewerContext.deleteAnnotations(_.annotations.map(b=>b.uid),_.emitEvent),this.context.render()},this);let y=null;v.annotationUpdated.on(_=>{const b=_.updateDetails.map(w=>w.annotationUid);this.annotationViewerContext.updateAnnotations(b,_.updatedBy),this.hooks.annotationsUpdated.emit(new YF(b,_.updateActions)),y||(y=setTimeout(()=>{var w;null===(w=this.context)||void 0===w||w.render(),y=null},17))},this),v.bringFroward.on(_=>{this.annotationViewerContext.updateLayer([_.annotationUid,_.forwardUid]),this.context.render()},this),v.bringToFront.on(_=>{this.annotationViewerContext.updateLayer([_.annotationUid]),this.context.render()},this),v.sendBackward.on(_=>{this.annotationViewerContext.updateLayer([_.annotationUid,_.backwardUid]),this.context.render()},this),v.sendToBack.on(_=>{this.annotationViewerContext.updateLayer([_.annotationUid]),this.context.render()},this),v.restoreLayer.on(_=>{this.annotationViewerContext.updateLayer([_.annotationUid]),this.context.render()},this),v.annotationPageSwitched.on(_=>{this.annotationViewerContext.updateAnnotationPage(_.annotationUid,_.to.pageUid),this.context.render()},this)}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&$o(document,"click",this).on(v=>{this.getActiveTab()&&"visible"===this.context.viewerConfig.visibility&&(this.context.viewService.mainContainer.contains(null==v?void 0:v.target)||this.annotationViewerContext.disableTextEditMode())})}getAnnotationConfig(){return pn(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(v){this.annotationViewerContext.annotationConfigService.updateConfig(v)}selectAnnotations(v){return this.annotationViewerContext.selectAnnotations(v)}deleteAnnotations(v){this.context.core.annotationService.deleteAnnotations(v),this.context.render()}updateAnnotation(v,y,_){this.context.core.annotationService.updateAnnotations([{annotationUid:v,options:y}],void 0,_)}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(v){return this.context.core.annotationService.bringForward(v)}bringToFront(v){return this.context.core.annotationService.bringToFront(v)}sendBackward(v){return this.context.core.annotationService.sendBackward(v)}sendToBack(v){return this.context.core.annotationService.sendToBack(v)}getAnnotationObject(v){return this.annotationViewerContext.annotationController.getShape(v)}copyAnnotations(v){v||(v=this.getSelectedAnnotations().map(y=>y.uid)),v.length&&this.context.core.annotationService.copyAnnotations(v)}cutAnnotations(v){v||(v=this.getSelectedAnnotations().map(y=>y.uid)),v.length&&this.context.core.annotationService.cutAnnotations(v)}pasteAnnotations(v,y){const _=this.context.getActiveTab();if(null==_||!_.total)return;const b=_.getCurrentPage();b&&this.context.core.annotationService.pasteAnnotations(v||_.uid,y||b.uid)}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard()}});var h;p.setClass("Viewer",o)},apply(p){const n=new KRe(p);p.annotationService=n;const{pageService:h}=p;n.hooks.annotationCreated.on(v=>{v.annotations.forEach(y=>{const _=h.getPage(y.pageUid);_&&_.annotations.push(y.uid)})},h),n.hooks.annotationDeleted.on(v=>{v.annotations.forEach(y=>{const _=h.getPage(y.pageUid);if(_){const b=_.annotations.indexOf(y.uid);_.annotations.splice(b,1)}})},h),n.hooks.annotationPageSwitched.on(v=>{const y=h.getPage(v.from.pageUid),_=h.getPage(v.to.pageUid);if(y){const b=y.annotations.indexOf(v.annotationUid);y.annotations.splice(b,1)}_&&_.annotations.push(v.annotationUid)},h)}};class ZRe{perspective(n,o,h,v){return Fe(function*(){var y;const _=new Kg,b=yield _.initImage({source:n.data,isRGBA:n.type===Er.RGBA,width:n.width,height:n.height,isBGRA:n.type===Er.BGRA});b.srcBuffer&&(n.data=b.srcBuffer),null!=h&&h.angle&&(yield _.rotate({angle:h.angle})),yield _.perspective(o);const w=yield _.getImage({jpegQuality:null==v?void 0:v.jpegQuality,ifDeleteObject:!0,isRGBA:n.type===Er.RGBA,bitDepth:null==v?void 0:v.bitDepth,xDpi:null==v?void 0:v.xdpi,yDpi:null==v?void 0:v.ydpi,returnBlob:!1,returnType:Kx[null!==(y=null==v?void 0:v.outputType)&&void 0!==y?y:n.type]});yield _.freeReservedData();const I={data:new Blob([w.imageData],{type:w.blobType}),width:w.imageWidth,height:w.imageHeight,resolutionX:w.imageXResolution,resolutionY:w.imageYResolution};return _.terminate(),I})()}}var a0=new WeakMap,AD=new WeakMap,PD=new WeakSet;function eke(p,n,o,h){return(new ZRe).perspective(p,n,o,h)}function tke(p){return Xe(a0,this).push(p),Xe(AD,this)||(Wn(AD,this,!0),lt(PD,this,nke).call(this)),p.promise}function nke(){return YL.apply(this,arguments)}function YL(){return YL=Fe(function*(){do{if(Xe(a0,this).isEmpty())break;const p=Xe(a0,this).pop();try{let n;"perspective"===(null==p?void 0:p.api)&&(n=yield lt(PD,this,eke).apply(this,p.params)),null==p||p.resolve(n)}catch(n){p.retry<1?(p.retry+=1,Xe(a0,this).push(p)):null==p||p.reject(n)}}while(!Xe(a0,this).isEmpty());Wn(AD,this,!1)}),YL.apply(this,arguments)}Qv.registerPlugin(b6e),Qv.registerPlugin(tRe),Qv.registerPlugin(uRe),Qv.registerPlugin(pRe),Qv.registerPlugin(QRe),Qv.registerPlugin(G6e);const Ur=new Qv(new class{constructor(){this.registerParser("image/jpeg",b2),this.registerParser("image/bmp",b2),this.registerParser("image/png",b2),this.registerParser("image/tiff",PDe),this.registerParser("image/jp2",b2),this.registerParser("application/pdf",UDe),this.registerParser("image/rgba",VDe),this.registerParser("application/ddv-blank-image",eAe)}dispose(){this.reset()}reset(){G_.getAllParsers().forEach(p=>p.destroy()),G_.clear(),fw.clear()}freeParserByFileUid(p){HDe.execute(p)}registerParser(p,n){YDe.execute({mime:p,parser:n})}unregisterParser(p){XDe.execute(p)}registerCustomParser(p,n){$De.execute({mime:p,parser:n})}unregisterCustomParser(p){qDe.execute(p)}getDefaultParserOptions(p){return KDe.execute(p)}setDefaultParserOptions(p,n){return JDe.execute({mime:p,options:n})}getCustomParserClasses(p){return QDe.execute(p)}parse(p,n,o,h,v){return Fe(function*(){return zDe.execute({fileData:p,mime:n,fileUid:o,indices:h,parseOptions:v})})()}getPage(p,n,o,h){return Fe(function*(){return GDe.execute({fileData:p,mime:n,fileUid:o,fileIndex:h})})()}cancelGetPage(p,n){jDe.execute({fileUid:p,fileIndex:n})}getParseInfo(p,n,o,h){return Fe(function*(){return ZDe.execute({fileData:p,mime:n,fileUid:o,options:h})})()}},new class{constructor(){this.registerSaver("application/pdf",YEe),this.registerSaver("image/png",MQ),this.registerSaver("image/jpeg",MQ),this.registerSaver("image/tiff",XEe)}registerSaver(p,n){GEe.execute({mime:p,saverConstructor:n})}unregisterSaver(p){zEe.execute(p)}getSaver(p){return HEe.execute(p)}},new class{constructor(){dl(this,PD),bi(this,a0,new RQ),bi(this,AD,!1)}dispose(){throw new Error("Method not implemented.")}perspective(p,n,o,h){return this.createTask("perspective",[p,n,o,h])}createTask(p,n){const o={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const h of n)o.params.push(h);return o.promise=new Promise((h,v)=>{o.resolve=h,o.reject=v}),lt(PD,this,tke).call(this,o)}cancelTask(p,n){const o={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const h of n)o.params.push(h);Xe(a0,this).remove(o)}},new class{constructor(){dl(this,R2),W(this,"filter",void 0),bi(this,qv,new RQ),bi(this,P2,!1)}get enableFilter(){return!!this.filter}applyFilter(p,n,o,h){var v=this;return Fe(function*(){return v.createTask("filter",[p,n,o,h])})()}cancelFilter(p,n){}setImageFilter(p){p?this.filter=p:this.filter&&(this.filter.destroy(),this.filter=null)}getDefaultFilterType(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.defaultFilterType)||Xs.NONE}getSupportedFilters(){var p;return(null===(p=this.filter)||void 0===p?void 0:p.querySupported())||[]}createTask(p,n){const o={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const h of n)o.params.push(h);return o.promise=new Promise((h,v)=>{o.resolve=h,o.reject=v}),lt(R2,this,lAe).call(this,o)}cancelTask(p,n){const o={api:p,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const h of n)o.params.push(h);Xe(qv,this).remove(o)}},new class{constructor(){W(this,"detector",void 0)}get enableDetect(){return this.detector&&this.detector instanceof YZ}detect(p,n){var o;return null===(o=this.detector)||void 0===o?void 0:o.detect(p,n)}setDetector(p){p?this.detector=p:this.detector&&(this.detector.destroy(),this.detector=null)}resetDetector(){this.detector&&this.detector.reset()}reset(){var p;null===(p=this.detector)||void 0===p||p.destroy(),this.detector=null}});function xn(p,n,o,h){return!!gt(p)&&mt.output(n,o,h,void 0,rt.PARAM_MISS,!0)}function c1(p,n,o,h){return!!Vn(p)||mt.output(n,o,h,void 0,rt.PARAM_INVALID)}class Tn{static getTooltip(){return yl.getTooltip()}static setTooltip(n){const o="Elements.setTooltip",h="tooltip";return!(xn(n,1,o,h)||!c1(n,1,o,h)||(yl.setTooltip(n),0))}static getDisplayTextConfig(){return yl.getDisplayTextConfig()}static setDisplayTextConfig(n){const o="Elements.displayTextConfig",h="displayTextConfig";return!(xn(n,1,o,h)||!c1(n,1,o,h)||(yl.setDisplayTextConfig(n),0))}static get Layout(){return"Layout"}static get Button(){return"Button"}static get Capture(){return"Capture"}static get Flashlight(){return"Flashlight"}static get CameraConvert(){return"CameraConvert"}static get CameraResolution(){return"CameraResolution"}static get AutoDetect(){return"AutoDetect"}static get AutoCapture(){return"AutoCapture"}static get ImagePreview(){return"ImagePreview"}static get Rotate(){return"Rotate"}static get RotateLeft(){return"RotateLeft"}static get RotateRight(){return"RotateRight"}static get Delete(){return"Delete"}static get DeleteCurrent(){return"DeleteCurrent"}static get DeleteAll(){return"DeleteAll"}static get Zoom(){return"Zoom"}static get ZoomIn(){return"ZoomIn"}static get ZoomOut(){return"ZoomOut"}static get ZoomByPercentage(){return"ZoomByPercentage"}static get Crop(){return"Crop"}static get CropCurrent(){return"CropCurrent"}static get CropAll(){return"CropAll"}static get FullQuad(){return"FullQuad"}static get PerspectiveAll(){return"PerspectiveAll"}static get Undo(){return"Undo"}static get Redo(){return"Redo"}static get Pan(){return"Pan"}static get CropMode(){return"CropMode"}static get Load(){return"Load"}static get Download(){return"Download"}static get Print(){return"Print"}static get Filter(){return"Filter"}static get Restore(){return"Restore"}static get ThumbnailSwitch(){return"ThumbnailSwitch"}static get Pagination(){return"Pagination"}static get FitMode(){return"FitMode"}static get FitWindow(){return"FitWindow"}static get FitHeight(){return"FitHeight"}static get FitWidth(){return"FitWidth"}static get ActualSize(){return"ActualSize"}static get DisplayMode(){return"DisplayMode"}static get SinglePage(){return"SinglePage"}static get ContinuousPage(){return"ContinuousPage"}static get MainView(){return"MainView"}static get SeparatorLine(){return"SeparatorLine"}static get Done(){return"Done"}static get Back(){return"Back"}static get Blank(){return"Blank"}static get Close(){return"Close"}static get AnnotationSet(){return"AnnotationSet"}static get EllipseAnnotation(){return"EllipseAnnotation"}static get EraseAnnotation(){return"EraseAnnotation"}static get InkAnnotation(){return"InkAnnotation"}static get LineAnnotation(){return"LineAnnotation"}static get PolygonAnnotation(){return"PolygonAnnotation"}static get PolylineAnnotation(){return"PolylineAnnotation"}static get RectAnnotation(){return"RectAnnotation"}static get SelectAnnotation(){return"SelectAnnotation"}static get StampIconAnnotation(){return"StampIconAnnotation"}static get StampImageAnnotation(){return"StampImageAnnotation"}static get TextBoxAnnotation(){return"TextBoxAnnotation"}static get TextTypewriterAnnotation(){return"TextTypewriterAnnotation"}static get BringForward(){return"BringForward"}static get BringToFront(){return"BringToFront"}static get SendBackward(){return"SendBackward"}static get SendToBack(){return"SendToBack"}}const gne={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},Tn.Flashlight]},Tn.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[Tn.AutoDetect,Tn.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},Tn.ImagePreview,Tn.CameraConvert]}]},XL={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[Tn.Blank,Tn.Pagination,Tn.Download]},Tn.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[Tn.DisplayMode,Tn.RotateLeft,Tn.Crop,Tn.Filter,Tn.Undo,Tn.Delete,Tn.Load]}]},mne={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[Tn.Blank,Tn.Pagination,Tn.PerspectiveAll]},Tn.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[Tn.FullQuad,Tn.RotateLeft,Tn.RotateRight,Tn.DeleteCurrent,Tn.DeleteAll]}]},vne={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:Tn.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},Tn.AutoDetect,{type:Tn.Capture,className:"ddv-capture-viewer-capture-desktop"},Tn.AutoCapture]},Tn.MainView,{type:Tn.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},yne={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[Tn.FullQuad,Tn.RotateLeft,Tn.RotateRight,Tn.DeleteCurrent,Tn.DeleteAll,{type:Tn.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:Tn.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},Tn.MainView]},$L={type:Tn.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:Tn.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:Tn.Layout,children:[Tn.ThumbnailSwitch,Tn.Zoom,Tn.FitMode,Tn.DisplayMode,Tn.RotateLeft,Tn.RotateRight,Tn.Crop,Tn.Filter,Tn.Undo,Tn.Redo,Tn.DeleteCurrent,Tn.DeleteAll,Tn.Pan]},{type:Tn.Layout,children:[{type:Tn.Pagination,className:"ddv-edit-viewer-pagination-desktop"},Tn.Load,Tn.Download,Tn.Print]}]},Tn.MainView]},RD={type:Tn.Layout,children:[Tn.MainView]},_ne=pn(XL);_ne.children[0].children=[Tn.Blank,Tn.Blank,Tn.Pagination,Tn.AnnotationSet,Tn.Download];const qL=pn($L);var Ri,ha;qL.children[0].children[0].enableScroll=!0,qL.children[0].children[0].children.push(Tn.SeparatorLine,Tn.AnnotationSet),function(p){p.REJECTED="rejected",p.ACCEPTED="accepted",p.INITIAL_HERE="initialHere",p.SIGN_HERE="signHere",p.WITNESS="witness",p.APPROVED="approved",p.NOT_APPROVED="notApproved",p.DRAFT="draft",p.FINAL="final",p.COMPLETED="completed",p.CONFIDENTIAL="confidential",p.VOID="void"}(Ri||(Ri={})),function(p){p.NONE="none",p.OPEN="open",p.OPEN_REVERSE="openReverse",p.CLOSED="closed",p.CLOSED_REVERSE="closedReverse",p.BUTT="butt",p.SLASH="slash",p.SQUARE="square",p.DIAMOND="diamond",p.CIRCLE="circle"}(ha||(ha={}));const kD={background:"#e2e1de"},Cne={border:"1px solid #707070",background:"#fff"},KL={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},u1={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},JL={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},bne={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};rr()&&(u1.borderWidth=3,JL.fontSize=72);const xne=zt(Ke({},u1),{lineEnding:{start:ha.NONE,end:ha.NONE}}),d1={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:Ke({},u1),ellipse:Ke({},u1),polygon:Ke({},u1),polyline:Ke({},xne),line:Ke({},xne),ink:{opacity:1,borderWidth:rr()?3:1,borderColor:"rgb(0,0,0)"},textBox:zt(Ke({},u1),{textAlign:"left",textContent:Ke({},JL)}),textTypewriter:{opacity:1,textContent:Ke({},JL)},stamp:{opacity:1,stamp:Ri.DRAFT}}},gMe={canvasStyle:Ke({},kD),quadSelectionStyle:Ke({},KL),enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function Zo(p,n){return!!p.getActiveTab()||mt.output(n,void 0,void 0,void 0,rt.DOC_NOT_OPEN)}function vc(p,n,o,h){return!o.getActiveTab().doc.pages.length&&mt.output(h,p,n,void 0,rt.DOC_NO_IMAGE,!0)}function h1(p,n,o,h){return!(!$t(v=p)||$t(v)&&!Number.isInteger(v))||mt.output(h,n,o,void 0,rt.PARAM_INVALID);var v}function wne(p,n,o,h,v){const y=_o.isUiConfigValid(p,h);if(y.length>0)return mt.output(v,o,h,y);const _=Qne(p,n);return!_||mt.output(v,n.charAt(0).toUpperCase()+n.slice(1),_,void 0,rt.ELEMENT_UNSUPPORTED)}function f1(p,n,o,h,v,y){return(p<n||p>o)&&mt.output(h,v,y,void 0,rt.PARAM_OUT_OF_RANGE,!0)}function MD(p,n,o,h){return!!p.includes(n)||mt.output(o,h,void 0,void 0,rt.PAGE_NOT_EXIST)}function cf(p,n,o,h){return!!I_(p)||mt.output(h,n,o,void 0,rt.PARAM_INVALID)}function lr(p,n,o,h,v){const y=mt.formatError(mt.isStringAndNotEmpty(p,v));return!y||mt.output(n,o,h,void 0,y)}function Fp(p,n,o,h,v,y,_){const b=_o.isNumberArrayValid(p,v,y,_);return!b.length||mt.output(n,o,h,b,rt.PARAM_INVALID)}class OD{getIsBoundContainer(n){return n.context.viewService.isBindContainer}bindContainer(n,o,h){xn(o,0,h,"container");const v=_o.isContainerParamValid(o);v&&mt.error(h,"container",void 0,v),n.bindContainer(o)}unbindContainer(n){n.unbindContainer()}getIsVisible(n){return"visible"===n.getViewerConfig().visibility}show(n){n.show()}hide(n){n.hide()}getCurrentDocument(n){var o;const h=null===(o=n.getActiveTab())||void 0===o?void 0:o.uid;return h?lie.getDocument(h):null}openDocument(n,o,h){const v="docUid or doc";var _;xn(n,0,h,v),Sn(_=n)&&0!==_.trim().length||Vn(n)||mt.error(h,v,void 0,rt.PARAM_INVALID);const y=Vn(n)?n.uid:n;(function(_,b,w,I,A){_.getDocument(b)||mt.output(0,I,"docUid or doc",void 0,rt.DOC_NOT_EXIST)})(Ur.documentService,y,0,h),Ur.getViewer(o)||mt.error(h,"viewerUid",void 0,rt.PARAM_INVALID),Ur.openDocument(y,o)}closeDocument(n,o){return!!Zo(n,1)&&(n.closeDocument(),!0)}getStyle(n,o,h,v,y){const _="styleName";if(xn(h,1,y,_)||!lr(h,1,y,_))return null;if(!v.includes(h))return mt.warning(y,_,void 0,rt.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===h)return n.getAnnotationConfig().controlsStyle;const b=n.getViewerConfig();if(h in b){const w=function(I,A){const M=["border","background"],F=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],V={pageStyle:M,selectedPageStyle:M,hoveredPageStyle:M,canvasStyle:[...M,"cursor"],checkboxStyle:[...F,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...F,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(I in V){const B=V[I];return Object.fromEntries(Object.entries(A).filter(Q=>{let[J,Z]=Q;return B.includes(J)}))}return pn(A)}(h,b[h]);return"capture"===o&&"quadSelectionStyle"===h?{border:w.border,background:w.background}:w}return null}updateStyle(n,o,h,v,y){return!(xn(o,1,y,"styleName")||xn(h,1,y,"style")||!lr(o,1,y,"styleName")||!c1(h,1,y,"style")||!function(_,b,w,I,A,M){if(!lr(_,1,I,A))return!1;if(!w.includes(_))return mt.output(1,I,A,void 0,rt.PARAM_NOT_SUPPORT);const F=eie(_,b);return!F.length||mt.output(1,I,"style",F)}(o,h,v,y,"styleName")||("annotationSelectionStyle"===o?(n.updateAnnotationConfig({controlsStyle:h}),0):(n.updateViewerConfig({[o]:h}),0)))}getUiConfig(n){return n.getUiConfig()}updateUiConfig(n,o,h,v){const y="uiConfig";return!(xn(o,1,v,y)||!wne(o,h,v,y,1))&&n.updateUiConfig(o)}indexToUid(n,o,h){const v="index";return xn(o,1,h,v)||!h1(o,h,v,1)||!Zo(n,1)||vc(void 0,void 0,n,1)||f1(o,0,n.getPageCounts()-1,1,h,v)?"":n.indexToUid(o)}uidToIndex(n,o,h){return xn(o,1,h,"uid")||!lr(o,1,h,"uid",!1)||!Zo(n,1)||vc(void 0,void 0,n,1)?-1:MD(this.getCurrentDocument(n).pages,o,1,h)?n.uidToIndex(o):-1}getCurrentPageUid(n){return Zo(n,1)?vc(void 0,void 0,n,1)?"":n.getCurrentPageUid():""}getCurrentPageIndex(n){return Zo(n,1)?vc(void 0,void 0,n,1)?-1:n.getCurrentPageIndex():-1}getPageCount(n){return Zo(n,1)?n.getPageCounts():-1}gotoPage(n,o,h){const v="index";return xn(o,1,h,v)||!h1(o,h,v,1)||!Zo(n,1)||vc(void 0,void 0,n,1)||f1(o,0,n.getPageCounts()-1,1,h,v)?-1:n.gotoPage(o)}rotate(n,o,h,v){return!(xn(o,1,v,"angle")||!h1(o,v,"angle",1)||(y=o,_=v,y%90!=0&&!mt.output(1,_,"angle",void 0,rt.PARAM_NOT_SUPPORT))||!Zo(n,1)||vc(void 0,void 0,n,1)||!gt(h)&&!Fp(h,1,v,"indices",0,this.getPageCount(n)-1))&&n.rotatePages(o,h);var y,_}saveOperation(n){return!!Zo(n,1)&&n.saveOperations()}on(n,o,h,v){!xn(h,1,o,"eventName")&&!xn(v,1,o,"listener")&&lr(h,1,o,"eventName",!1)&&cf(v,o,"listener",1)&&n.on(h,v)}off(n,o,h,v){!xn(h,1,o,"eventName")&&lr(h,1,o,"eventName",!1)&&(gt(v)||cf(v,o,"listener",1))&&n.off(h,v)}destroy(n){n&&n.dispose()}}function QL(p,n,o,h){return!!As(p)||mt.output(h,n,o,void 0,rt.PARAM_INVALID)}function oh(p,n,o,h,v,y){const _=mt.formatError(mt.isNumberAndIsInRange(p,v,y));return!_||mt.output(n,o,h,void 0,_)}function Bw(p,n,o,h,v){if(!Vn(p))return mt.output(o,h,v,void 0,rt.PARAM_INVALID);const y=[],_=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(p).forEach(b=>{const w=p[b];if("container"===b)y.push(..._o.isContainerKeyValid(w,v));else if("uiConfig"===b){const I=_o.isUiConfigValid(w,"option.uiConfig");if(I.length>0)y.push(...I);else{const A=Qne(w,n);if(A){const M=rt.buildError(rt.ELEMENT_UNSUPPORTED,n.charAt(0).toUpperCase()+n.slice(1),A);y.push(`option.uiConfig: ${M.message}`)}}}else"viewerConfig"!==b&&"thumbnailConfig"!==b||Object.keys(w).forEach(I=>{const A=w[I];if(_.includes(I)){const M=eie(I,A);y.push(...M.map(F=>`${b}.${F}`))}})}),!(y.length>0)||mt.output(o,h,v,y)}const Sne=["canvasStyle","quadSelectionStyle"],Yl="CaptureViewer";var Si=new WeakMap,Xa=new WeakMap,Tne=new WeakSet;function vMe(){Xe(Si,this).hooks.destroy.on(()=>{Wn(Si,this,null),Object.setPrototypeOf(this,null)})}const Ine={canvasStyle:Ke({},kD),currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},yMe=zt(Ke({},Ine),{visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}}),_Me={canvasStyle:Ke({},kD),pageStyle:Ke({},Cne),quadSelectionStyle:Ke({},KL),currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1},Ene=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var Dne=new WeakSet;class Ane{constructor(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";dl(this,Dne),W(this,"v",void 0),W(this,"vCommon",new OD),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"postfix",void 0),W(this,"errorPrefix",void 0),this.errorPrefix=o;const h=`new ${this.errorPrefix}`;xi.makeSureCoreLicenseExist(),gt(n)||Bw(n,"browseViewer",0,h,"option");const v=yo((null==n?void 0:n.viewerConfig)||{},pn(zt(Ke({},Ine),{viewerMode:Ko.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0})));this.v=Ur.createViewer(zt(Ke({uiConfig:pn(RD)},n),{viewerConfig:v})),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,lt(Dne,this,CMe).call(this)}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(n){const o="multiselectMode";QL(n,`${this.errorPrefix}.${o}`,o,1)&&this.v.updateViewerConfig({multiselectMode:n})}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v)}hide(){this.vCommon.hide(this.v)}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(n){return this.vCommon.updateUiConfig(this.v,n,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(n){return this.vCommon.getStyle(this.v,"browse",n,Ene,`${this.errorPrefix}.getStyle`)}updateStyle(n,o){return this.vCommon.updateStyle(this.v,n,o,Ene,`${this.errorPrefix}.updateStyle`)}getSelectedPageIndices(){return Zo(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){return Zo(this.v,1)?0===this.v.getPageCounts()?(mt.output(1,`${this.errorPrefix}.selectAllPages`,void 0,void 0,rt.DOC_NO_IMAGE),[]):this.v.selectAllPages():[]}selectPages(n){const o=`${this.errorPrefix}.selectPages`,h="indices";return xn(n,1,o,h)||!Zo(this.v,1)?[]:Fp(n,1,o,h,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(n):[]}setRowAndColumn(n,o){const h=`${this.errorPrefix}.setRowAndColumn`,v="row",y="column",{maxColumns:_,maxRows:b}=this.v.getViewerConfig();return!(xn(n,1,h,v)||xn(o,1,h,y)||!h1(n,h,v,1)||!h1(o,h,y,1)||f1(n,1,b,1,h,v)||f1(o,1,_,1,h,y))&&this.v.setRowAndColumn(n,o)}on(n,o){this.vCommon.on(this.v,`${this.errorPrefix}.on`,n,o)}off(n,o){this.vCommon.off(this.v,`${this.errorPrefix}.off`,n,o)}}function CMe(){this.v.hooks.destroy.on(()=>{this.v=null,Object.setPrototypeOf(this,null)})}function ZL(p,n,o,h,v){const y=_o.isAnnotationOptionsValid(p,h,v);return!y.length||mt.output(n,o,h,y)}const l0={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var p1=new WeakMap;class dm{constructor(n){W(this,"uid",null),W(this,"creationDate",""),W(this,"modificationDate",""),bi(this,p1,void 0),Wn(p1,this,n),this.uid=Ai(),this.creationDate=hc(),this.modificationDate=this.creationDate}get type(){return null}get pageUid(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);return n?n.pageUid:""}getOptions(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);if(n){const o=n.getConfig(),h=Ww(o,this.type);Wn(p1,this,Ke({},h)),this.modificationDate=o.comment.modificationDate}return LD(this.type,Xe(p1,this))}updateOptions(n){const o="Annotation.updateOptions";if(xn(n,1,o,"options")||!c1(n,1,o,"options")||!ZL(n,1,o,"options",this.type))return!1;const h=this.getOptions(),v=Pne(this.type,n,h);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&v.has("rotated")&&v.delete("rotated"),!v.size)return!0;this.getOptions(),yo(n,Xe(p1,this));const y=e8(Ke({},Xe(p1,this)),this.type);return Ur.annotationService.updateAnnotations([{annotationUid:this.uid,options:y}],void 0,[...v]),!0}}function Pne(p,n,o){const h="moved",v="resized",y="startPoint",_="endPoint",b=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),w=pn(n);w.flags=Ke(Ke({},o.flags),(null==w?void 0:w.flags)||{}),["line","polyline"].includes(p)&&n.lineEnding&&(w.lineEnding=Ke(Ke({},o.lineEnding),(null==w?void 0:w.lineEnding)||{}));const I=new Set,A=Object.keys(w);return A.forEach(M=>{if(!s8(o[M],w[M]))if("points"!==M||"ink"!==p&&"polygon"!==p&&"polyline"!==p)if(M!==y&&M!==_||"line"!==p)for(const[F,V]of b)F.includes(M)&&!I.has(V)&&I.add(V);else A.includes(y)&&A.includes(_)&&nie([o[y],o[_]],[w[y],w[_]])?I.add(h):I.add(v);else nie(o[M],w[M])?I.add(h):I.add(v)}),I}function e8(p,n){const o=pn(p),h={style:o,flags:[],transform:{angle:0}},{lineEnding:v,points:y,textContents:_,stamp:b,borderWidth:w,x:I,y:A,width:M,height:F,startPoint:V,endPoint:B,lineDash:Q}=o||{},J=jn.dataResolution,Z=jn.displayResolution;if(y&&("ink"===n?h.style.segments=Mne(y,J,Z):h.style.points=kne(y,J,Z)),v&&(h.style.lineEnding=t8(v,"date")),b&&(h.style.imageData=null,b instanceof Blob||Sn(b)&&qne(b)?h.style.imageData=b:Sn(b)&&(h.style.iconName=FD(b,"date"))),gt(w)||(h.style.borderWidth=Kn(w,J,Z)),gt(I)||(h.style.x=Kn(I,J,Z)),gt(A)||(h.style.y=Kn(A,J,Z)),gt(M)||(h.style.width=Kn(M,J,Z)),gt(F)||(h.style.height=Kn(F,J,Z)),gt(Q)||(h.style.lineDash=Kn(Q,J,Z)),gt(V)||(h.style.startPoint=Kn(V,J,Z)),gt(B)||(h.style.endPoint=Kn(B,J,Z)),_){const re=[];_.forEach(se=>{null!=se&&se.fontSize&&(se.fontSize=Kn(se.fontSize,J,Z)),Sn(se.fontFamily)&&""===(null==se?void 0:se.fontFamily.trim())&&(se.fontFamily="Helvetica"),re.push(Ke(Ke({},bne),se))}),h.style.textContents=re}return $t(p.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(n)&&(h.transform.angle=p.rotation),p.flags&&(p.flags.print&&h.flags.push("print"),p.flags.noView&&h.flags.push("noView"),p.flags.readOnly&&h.flags.push("readOnly")),h}function Ww(p,n){var o,h,v,y,_,b,w;const{lineEnding:I,iconName:A,imageData:M,segments:F,textContents:V,borderWidth:B,x:Q,y:J,width:Z,height:re,startPoint:se,endPoint:ce,lineDash:pe,points:Ce}=(null==p?void 0:p.style)||{},Ve=jn.displayResolution,te=jn.dataResolution;if(Ce&&(p.style.points=kne(Ce,Ve,te)),F&&"ink"===n&&(p.style.points=Mne(F,Ve,te),delete p.style.segments),I&&(p.style.lineEnding=t8(I,"user")),(M||A)&&(p.style.stamp=M||FD(A,"user"),delete p.style.iconName,delete p.style.imageData),gt(B)||(p.style.borderWidth=Kn(B,Ve,te)),gt(Q)||(p.style.x=Kn(Q,Ve,te)),gt(J)||(p.style.y=Kn(J,Ve,te)),gt(Z)||(p.style.width=Kn(Z,Ve,te)),gt(re)||(p.style.height=Kn(re,Ve,te)),gt(se)||(p.style.startPoint=Kn(se,Ve,te)),gt(ce)||(p.style.endPoint=Kn(ce,Ve,te)),gt(pe)||(p.style.lineDash=Kn(pe,Ve,te)),V){const Me=[];V.forEach(we=>{null!=we&&we.fontSize&&(we.fontSize=Kn(we.fontSize,Ve,te)),Sn(we.fontFamily)&&""===(null==we?void 0:we.fontFamily.trim())&&(we.fontFamily="Helvetica"),Me.push(Ke(Ke({},bne),we))}),p.style.textContents=Me}return null===(o=p.style)||void 0===o||delete o.lineJoin,null===(h=p.style)||void 0===h||delete h.lineCap,null===(v=p.style)||void 0===v||delete v.miterLimit,zt(Ke({},p.style),{rotation:(null===(y=p.transform)||void 0===y?void 0:y.angle)||0,flags:{print:!(null===(_=p.flags)||void 0===_||!_.includes("print")),noView:!(null===(b=p.flags)||void 0===b||!b.includes("noView")),readOnly:!(null===(w=p.flags)||void 0===w||!w.includes("readOnly"))}})}function t8(p,n){const o={None:ha.NONE,OpenArrow:ha.OPEN,ROpenArrow:ha.OPEN_REVERSE,ClosedArrow:ha.CLOSED,RClosedArrow:ha.CLOSED_REVERSE,Butt:ha.BUTT,Slash:ha.SLASH,Square:ha.SQUARE,Diamond:ha.DIAMOND,Circle:ha.CIRCLE};if("user"===n){const[h,v]=p;return{start:o[h],end:o[v]}}return[o8(o,p.start)[0]||"None",o8(o,p.end)[0]||"None"]}function FD(p,n){const o={[Ri.REJECTED]:Pi.REJECTED,[Ri.ACCEPTED]:Pi.ACCEPTED,[Ri.INITIAL_HERE]:Pi.INITIAL_HERE,[Ri.SIGN_HERE]:Pi.SIGN_HERE,[Ri.WITNESS]:Pi.WITNESS,[Ri.APPROVED]:Pi.APPROVED,[Ri.NOT_APPROVED]:Pi.NOT_APPROVED,[Ri.DRAFT]:Pi.DRAFT,[Ri.FINAL]:Pi.FINAL,[Ri.COMPLETED]:Pi.COMPLETED,[Ri.CONFIDENTIAL]:Pi.CONFIDENTIAL,[Ri.VOID]:Pi.VOID};return"user"===n?o8(o,p)[0]||p:o[p]||Pi.DRAFT}function LD(p,n){const o=["opacity","flags"],h=["x","y","width","height"],v=["borderColor","borderWidth","lineDash"],y=[...o,...v,...h,"background","rotation"],_=["points","background",...v,...o],b={rectangle:y,ellipse:y,polygon:_,polyline:["lineEnding",..._],stamp:["stamp",...h,...o,"rotation"],ink:["points","borderWidth","borderColor","rotation",...o],line:["startPoint","endPoint","lineEnding","background",...v,...o],textBox:["textContents","textAlign","background","rotation",...o,...v,...h],textTypewriter:["x","y","textContents",...o]}[p];if(!b)return n;const w={};for(const I in n)if(b.includes(I)){let A=n[I];"points"!==I||"ink"!==p&&"polygon"!==p&&"polyline"!==p?"startPoint"!==I&&"endPoint"!==I||"line"!==p?"borderColor"===I||"background"===I?w[I]=Rne(A,2):"opacity"===I?(A>1&&(A=1),A<0&&(A=0),w[I]=uf(A,2)):w[I]="textContents"===I?A.map(M=>(void 0!==M.color&&(M.color=Rne(M.color,2)),void 0!==M.fontSize&&(M.fontSize=uf(M.fontSize,2)),M)):"lineDash"===I?A.map(M=>uf(M,2)):$t(n[I])?uf(A,2):A:w[I]={x:uf(A.x,2),y:uf(A.y,2)}:w[I]=Di(A[0])?A.map(M=>M.map(F=>({x:uf(F.x,2),y:uf(F.y,2)}))):A.map(M=>({x:uf(M.x,2),y:uf(M.y,2)}))}return w}function uf(p,n){return Number.parseFloat(p.toFixed(n))}function Rne(p,n){if(p&&p.startsWith("rgb")){const h=p.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/);if(h){const v=parseInt(h[1],10),y=parseInt(h[2],10),_=parseInt(h[3],10);let b=void 0!==h[4]?parseFloat(h[4]):void 0;return void 0!==b?(b<0&&(b=0),b>1&&(b=1),`rgba(${v},${y},${_},${function(I,A){const M=I.toString();return/^\d+\.\d{3,}$/.test(M)?parseFloat(I.toFixed(A)):I}(b,n)})`):`rgb(${v},${y},${_})`}}return p}function kne(p,n,o){return p.map(h=>({x:Kn(h.x,n,o),y:Kn(h.y,n,o)}))}function Mne(p,n,o){return p.map(h=>h.map(v=>({x:Kn(v.x,n,o),y:Kn(v.y,n,o)})))}const bMe=zt(Ke({},l0),{x:10,y:10,width:100,height:100});class xMe extends dm{constructor(n){super(n=yo(n||{},pn(bMe)))}get type(){return"rectangle"}}const wMe=zt(Ke({},l0),{x:10,y:10,width:100,height:80});class SMe extends dm{constructor(n){super(n=yo(n||{},pn(wMe)))}get type(){return"ellipse"}}const TMe=zt(Ke({},l0),{points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]});class IMe extends dm{constructor(n){super(n=yo(n||{},pn(TMe)))}get type(){return"ink"}}const EMe=zt(Ke({},l0),{startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:ha.NONE,end:ha.NONE}});class DMe extends dm{constructor(n){super(n=yo(n||{},pn(EMe)))}get type(){return"line"}}const AMe=zt(Ke({},l0),{points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]});class PMe extends dm{constructor(n){super(n=yo(n||{},pn(AMe)))}get type(){return"polygon"}}const RMe=zt(Ke({},l0),{points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:ha.NONE,end:ha.NONE}});class kMe extends dm{constructor(n){super(n=yo(n||{},pn(RMe)))}get type(){return"polyline"}}function One(p,n,o,h,v){return n8.apply(this,arguments)}function n8(){return n8=Fe(function*(p,n,o,h,v){const y=[`${v}.${h} is invalid`];let _=!1;if(pl(p)){const b=yield ZE(p);["image/bmp","image/jpeg","image/png"].includes(b)||(_=!0)}else _=!0;return!_||mt.output(n,o,v,y)}),n8.apply(this,arguments)}const MMe={x:10,y:10,stamp:Ri.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},i8={[Ri.REJECTED]:[23.58,23.54],[Ri.ACCEPTED]:[28.39,24.6],[Ri.INITIAL_HERE]:[126.26,33.78],[Ri.SIGN_HERE]:[126.26,33.78],[Ri.WITNESS]:[126.26,33.78],[Ri.APPROVED]:[211.33,59.33],[Ri.NOT_APPROVED]:[284.83,59.33],[Ri.DRAFT]:[144.19,59.66],[Ri.FINAL]:[123.73,59.66],[Ri.COMPLETED]:[227.83,59.33],[Ri.CONFIDENTIAL]:[272.83,59.33],[Ri.VOID]:[114.71,59.66]};var c0=new WeakMap;class OMe{constructor(n){W(this,"uid",null),W(this,"creationDate",""),W(this,"modificationDate",""),bi(this,c0,void 0),n=yo(n||{},pn(MMe)),!Sn(n.stamp)||!i8[n.stamp]||$t(n.width)&&$t(n.height)||(n.width=n.width||i8[n.stamp][0],n.height=n.height||i8[n.stamp][1]),Wn(c0,this,n),this.uid=Ai(),this.creationDate=hc(),this.modificationDate=this.creationDate}get type(){return"stamp"}get pageUid(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);return n?n.pageUid:""}getOptions(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);if(n){const o=n.getConfig(),h=Ww(o,this.type);Wn(c0,this,Ke({},h)),this.modificationDate=o.comment.modificationDate}return LD(this.type,Xe(c0,this))}updateOptions(n){var o=this;return Fe(function*(){const h="Annotation.updateOptions";if(xn(n,0,h,"options")||!c1(n,0,h,"options")||!ZL(n,0,h,"options",o.type)||pl(n.stamp)&&!(yield One(n.stamp,0,h,"stamp","options")))return;const v=o.getOptions(),y=Pne(o.type,n,v);if(!y.size)return;o.getOptions(),yo(n,Xe(c0,o));let _=Xe(c0,o);null!=n&&n.stamp||(_=zt(Ke({},Xe(c0,o)),{stamp:null}));const b=e8(_,o.type);Ur.annotationService.updateAnnotations([{annotationUid:o.uid,options:b}],void 0,[...y])})()}}const FMe=zt(Ke({},l0),{x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]});class LMe extends dm{constructor(n){super(n=yo(n||{},pn(FMe)))}get type(){return"textBox"}}const NMe={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class BMe extends dm{constructor(n){super(n=yo(n||{},pn(NMe)))}get type(){return"textTypewriter"}}function Uw(p,n,o,h,v,y){const _=mt.formatError({isValid:Di(p)});if(_)return mt.output(n,o,h,void 0,_);const b=[];return p.forEach((w,I)=>{const A=mt.formatDetails(bn("Array",v,`[${I}]`,!0),mt.isStringAndNotEmpty(w,y));b.push(...A)}),!b.length||mt.output(n,o,h,b)}function Fne(p,n,o,h,v){const y=[];return n.forEach((_,b)=>{p.has(_)||y.push(`annotationUids[${b}]: The specified annotation(s) do not exist.`)}),!y.length||mt.output(o,h,v,y,rt.ANNOTATION_NOT_EXIST)}function ND(p,n,o,h,v){return!!p.has(n)||mt.output(o,h,v,void 0,rt.ANNOTATION_NOT_EXIST)}class WMe{constructor(){W(this,"uid",null),W(this,"creationDate",""),W(this,"modificationDate",""),this.uid=Ai(),this.creationDate=hc(),this.modificationDate=hc()}get type(){return"unknown"}get pageUid(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);return n?n.pageUid:""}}var r8=new WeakMap;class UMe{constructor(n){bi(this,r8,void 0),W(this,"uid",null),W(this,"creationDate",""),W(this,"modificationDate",""),this.uid=Ai(),this.creationDate=hc(),this.modificationDate=hc(),Wn(r8,this,n)}get type(){return"incomplete"}get pageUid(){const n=Ur.annotationService.annotationApp.getAnnotationByUid(this.uid);return n?n.pageUid:""}get raw(){return Xe(r8,this)}}const Lne=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],hm="AnnotationManager",Nne=new Map;var Xl=new WeakMap,_l=new WeakMap,Vw=new WeakMap,u0=new WeakSet;function Bne(p,n){switch(p){case"rectangle":return new xMe(n);case"ellipse":return new SMe(n);case"polygon":return new PMe(n);case"polyline":return new kMe(n);case"line":return new DMe(n);case"stamp":return new OMe(n);case"ink":return new IMe(n);case"textBox":return new LMe(n);case"textTypewriter":return new BMe(n);case"unknown":return new WMe;case"highlight":case"underline":case"strikeout":case"incomplete":return new UMe((null==n?void 0:n.annotationRaw)||{});default:return null}}function BD(p,n){Xe(Vw,this).emit(p,n)}const Wne=new class{constructor(){dl(this,u0),bi(this,Xl,void 0),bi(this,_l,void 0),bi(this,Vw,void 0),Wn(Xl,this,Ur),Wn(_l,this,Nne),Wn(Vw,this,new Yh);const p=Xe(Xl,this).annotationService.annotationApp.hooks;p.annotationCreated.on(o=>{const h=o.annotations.reduce((v,y)=>{if(!Xe(_l,this).has(y.uid)){const _=y.getConfig(),b=Ww(_),w=lt(u0,this,Bne).call(this,_.type,b);w&&(w.uid=_.uid,w.creationDate=_.comment.creationDate,w.modificationDate=_.comment.modificationDate,Xe(_l,this).set(_.uid,w))}return v.push(y.uid),v},[]);lt(u0,this,BD).call(this,"annotationsAdded",{annotationUids:h})}),p.annotationDeleted.on(o=>{o.annotations.forEach(v=>{Xe(_l,this).has(v.uid)&&(this.getAnnotationsByUids([v.uid])[0].modificationDate="",Xe(_l,this).delete(v.uid))});const h=o.annotations.map(v=>v.uid);o.emitEvent&&lt(u0,this,BD).call(this,"annotationsDeleted",{annotationUids:h})}),p.annotationUpdated.on(o=>{const h={modifiedAnnotations:o.updateDetails.map(v=>{const y=this.getAnnotationsByUids([v.annotationUid])[0],_=y.type,b=Ur.annotationService.annotationApp.getAnnotationByUid(y.uid);return y.modificationDate=b.comment.modificationDate,{uid:v.annotationUid,oldOptions:LD(_,Ww(pn(v.from),_)),newOptions:LD(_,Ww(pn(v.to),_))}}),actions:[...o.updateActions]};lt(u0,this,BD).call(this,"annotationsModified",h)});const n=(o,h)=>{lt(u0,this,BD).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...o.from],newAnnotationUidList:[...o.to]})};p.bringFroward.on(o=>{n(o)}),p.bringToFront.on(o=>{n(o)}),p.sendBackward.on(o=>{n(o)}),p.sendToBack.on(o=>{n(o)})}createAnnotation(p,n,o){const h="AnnotationManager.createAnnotation",v="pageUid",y="type",_="annotationOptions";let b=null;try{xi.makeSureCoreLicenseExist(),xi.makeSureAnnotationLicenseExist(),xn(p,0,h,v),xn(n,0,h,y),lr(p,0,h,v,!1),F=h,V=y,Sn(A=n)?["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(A)||mt.output(0,F,V,void 0,rt.PARAM_NOT_SUPPORT):mt.output(0,F,V,void 0,rt.PARAM_INVALID),b=Xe(Xl,this).pageService.getPage(p),b||mt.error(h,v,void 0,rt.PAGE_NOT_EXIST),gt(o)||(c1(o,0,h,_),ZL(o,0,h,_,n))}catch(A){if("stamp"===n)return Promise.reject(A);throw A}var A,F,V;const w=pn(o||{}),I=()=>{var A,M,F;const V=lt(u0,this,Bne).call(this,n,w);Xe(_l,this).set(V.uid,V);const B=Xe(Xl,this).pageService.getPage(p).doc.uid,Q=e8(V.getOptions(),n);if("textTypewriter"===n){const Z=b.mediaBox.width,re=b.mediaBox.width-Q.style.x;Q.style.width=re<0?Z:re}const J={uid:V.uid,docUid:B,pageUid:p,type:n,style:Q.style,transform:Q.transform,flags:Q.flags,comment:{annotationUid:V.uid,author:(null===(A=Q.comment)||void 0===A?void 0:A.author)||"",subject:(null===(M=Q.comment)||void 0===M?void 0:M.subject)||"",contents:(null===(F=Q.comment)||void 0===F?void 0:F.contents)||"",creationDate:V.creationDate,modificationDate:V.creationDate,markedStates:[],reviewStates:[],replies:[]}};return Xe(Xl,this).annotationService.createAnnotation(B,J),V};if("stamp"===n&&pl(null==w?void 0:w.stamp)){const A=w;return new Promise(function(){var M=Fe(function*(F,V){try{yield One(A.stamp,0,h,"stamp",_)}catch(B){return void V(B)}if(!$t(A.width)||!$t(A.height)){const B=new Lv,Q=yield B.readImageInfo({fileSource:A.stamp}).catch(re=>{V(re)});let J=Q.imageWidth,Z=Q.imageHeight;if(J>400||Z>400){const re=Math.max(J/400,Z/400);J/=re,Z/=re}A.width=J,A.height=Z}F(I())});return function(F,V){return M.apply(this,arguments)}}())}return I()}deleteAnnotations(p){const n=`${hm}.deleteAnnotations`,o="annotationUids";return!(xn(p,1,n,o)||!Uw(p,1,n,o,void 0,!1)||!Fne(Xe(_l,this),p,1,n,o)||(Xe(Xl,this).annotationService.deleteAnnotations(p),0))}getAnnotationsByUids(p){const n=`${hm}.getAnnotationsByUids`,o="annotationUids";return!xn(p,1,n,o)&&Uw(p,1,n,o,void 0,!1)&&Fne(Xe(_l,this),p,1,n,o)?p.map(h=>Xe(_l,this).get(h)):[]}getAnnotationsByPage(p){const n=`${hm}.getAnnotationsByPage`,o="pageUid";if(xn(p,1,n,o)||!lr(p,1,n,o,!1))return[];if(!Xe(Xl,this).pageService.getPage(p))return mt.warning(n,o,void 0,rt.PAGE_NOT_EXIST),[];const h=Xe(Xl,this).annotationService.getAnnotationUidsByLayer(p),v=[];return h.forEach(y=>{const _=Xe(_l,this).get(y);_&&v.push(_)}),v}getAnnotationsByDoc(p){const n=`${hm}.getAnnotationsByDoc`,o="docUid";if(xn(p,1,n,o)||!lr(p,1,n,o,!1))return[];const h=Xe(Xl,this).documentService.getDocument(p);return h?h.pages.reduce((v,y)=>(Xe(Xl,this).annotationService.getAnnotationUidsByLayer(y).forEach(_=>{const b=Xe(_l,this).get(_);b&&v.push(b)}),v),[]):(mt.warning(n,o,void 0,rt.DOC_NOT_EXIST),[])}bringAnnotationForward(p){const n=`${hm}.bringAnnotationForward`,o="annotationUid";return!(xn(p,1,n,o)||!lr(p,1,n,o,!1)||!ND(Xe(_l,this),p,1,n,o))&&Xe(Xl,this).annotationService.bringForward(p)}sendAnnotationBackward(p){const n=`${hm}.sendAnnotationBackward`,o="annotationUid";return!(xn(p,1,n,o)||!lr(p,1,n,o,!1)||!ND(Xe(_l,this),p,1,n,o))&&Xe(Xl,this).annotationService.sendBackward(p)}bringAnnotationToFront(p){const n=`${hm}.bringAnnotationToFront`,o="annotationUid";return!(xn(p,1,n,o)||!lr(p,1,n,o,!1)||!ND(Xe(_l,this),p,1,n,o))&&Xe(Xl,this).annotationService.bringToFront(p)}sendAnnotationToBack(p){const n=`${hm}.sendAnnotationToBack`,o="annotationUid";return!(xn(p,1,n,o)||!lr(p,1,n,o,!1)||!ND(Xe(_l,this),p,1,n,o))&&Xe(Xl,this).annotationService.sendToBack(p)}on(p,n){const o="AnnotationManager.on",h="eventName",v="listener";!xn(p,1,o,h)&&!xn(n,1,o,v)&&lr(p,1,o,h,!1)&&cf(n,o,v,1)&&(Lne.includes(p)?Xe(Vw,this).on(p,n):rt.warning(rt.PARAM_NOT_SUPPORT,o,h))}off(p,n){const o="AnnotationManager.off",h="eventName";!xn(p,1,o,h)&&lr(p,1,o,h,!1)&&(gt(n)||cf(n,o,"listener",1))&&(Lne.includes(p)?Xe(Vw,this).off(p,n):rt.warning(rt.PARAM_NOT_SUPPORT,o,h))}};function Une(p,n,o,h,v,y){const _=[];let b=!1;if(v)v.forEach((w,I)=>{const{width:A,height:M}=o.getRealPageSize(w);Zne(h,A,M)||_.push(`indices[${w}]: ${rt.RECT_EXCEED_PAGE_BOUND.message}`)}),_.length>0&&(b=!0);else{const{width:w,height:I}=o.getRealPageSize();Zne(h,w,I)||(b=!0)}return!!b&&mt.output(y,p,n,_.length?_:void 0,rt.RECT_EXCEED_PAGE_BOUND,!0)}function Vne(p,n,o,h){const v=_o.isRectValid(p);return!!v.length&&mt.output(h,n,o,v,void 0,!0)}const jne=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],es="EditViewer";var dn=new WeakMap,g1=new WeakMap,So=new WeakMap,WD=new WeakSet;class Hne{constructor(n){var o,h;dl(this,WD),bi(this,dn,void 0),bi(this,g1,!0),bi(this,So,new OD),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"postfix",void 0),W(this,"thumbnail",void 0),xi.makeSureCoreLicenseExist(),gt(n)||Bw(n,"editViewer",0,"new EditViewer","option");const v=yo((null==n?void 0:n.viewerConfig)||{},pn(zt(Ke({},_Me),{viewerMode:Ko.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0})));if(v.minZoom>v.maxZoom){rt.warning(rt.MIN_ZOOM_INVALID);const w=v.maxZoom;v.maxZoom=v.minZoom,v.minZoom=w}const{maxZoom:y,minZoom:_}=v;v.maxZoom=y>64||y<.01?64:y,v.minZoom=_>64||_<.01?.01:_,rr()&&(d1.toolbarConfig.style={scale:"0.9"}),Wn(dn,this,Ur.createViewer(zt(Ke({uiConfig:pn(rr()?XL:$L)},n),{viewerConfig:v,annotationToolBarConfig:Ke(Ke({},null==d1?void 0:d1.toolbarConfig),null==n||null===(o=n.annotationConfig)||void 0===o?void 0:o.toolbarConfig),annotationPaletteConfig:Ke(Ke({},d1.paletteConfig),null==n||null===(h=n.annotationConfig)||void 0===h?void 0:h.paletteConfig)}))),this.uid=Xe(dn,this).uid,this.groupUid=Xe(dn,this).groupUid,this.postfix=Xe(dn,this).postfix;const b=yo(pn(null==n?void 0:n.annotationConfig)||{},pn(d1));Xe(dn,this).updateAnnotationConfig(function(w){const{defaultStyleConfig:Q}=w;return Object.keys(Q).forEach(J=>{const Z=Q[J];"object"==typeof Z&&null!==Z&&((J=>{if("lineEnding"in J&&"object"==typeof J.lineEnding&&null!==J.lineEnding){const Z=t8(J.lineEnding,"date");delete J.lineEnding,J.lineEnding=Z}})(Z),(J=>{J.borderWidth="borderWidth"in J&&$t(null==J?void 0:J.borderWidth)?Kn(J.borderWidth,jn.dataResolution,jn.displayResolution):1})(Z),(J=>{var Z,re,se,ce,pe;"textContent"in J&&Vn(J.textContent)&&(J.textContent.fontSize=$t(null==J||null===(Z=J.textContent)||void 0===Z?void 0:Z.fontSize)?Kn(null==J||null===(pe=J.textContent)||void 0===pe?void 0:pe.fontSize,jn.dataResolution,jn.displayResolution):d1.defaultStyleConfig.textBox.textContent.fontSize,["normal","italic"].includes(null==J||null===(re=J.textContent)||void 0===re?void 0:re.fontStyle)||(J.textContent.fontStyle="normal"),["normal","bold"].includes(null==J||null===(se=J.textContent)||void 0===se?void 0:se.fontWeight)||(J.textContent.fontWeight="normal"),""===(null==J||null===(ce=J.textContent)||void 0===ce?void 0:ce.fontFamily)&&(J.textContent.fontFamily="Helvetica"))})(Z),(J=>{"lineDash"in J&&J.lineDash.length&&(J.lineDash=Kn(J.lineDash,jn.dataResolution,jn.displayResolution))})(Z),(J=>{"textAlign"in J&&!["left","right","center","justify"].includes(null==J?void 0:J.textAlign)&&(J.textAlign="left")})(Z),"stamp"===J&&(J=>{J.stamp instanceof Blob&&(J.imageData=J.stamp),Sn(J.stamp)&&(qne(J.stamp)?J.imageData=J.stamp:J.stampIcon=["rejected","accepted","initialHere","signHere","witness","approved","notApproved","draft","final","completed","confidential","void"].includes(J.stamp)?FD(J.stamp,"date"):FD(Ri.DRAFT,"date")),delete J.stamp})(Z))}),zt(Ke({},w),{controlsStyle:w.annotationSelectionStyle})}(b)),Jne(Xe(dn,this).getUiConfig()).includes(Tn.Filter)&&!Xe(dn,this).context.core.filterService.enableFilter&&rt.warning(rt.IMG_FILTER_MISS),n&&!1===n.createThumbnail||lt(WD,this,jMe).call(this,null==n?void 0:n.thumbnailConfig),n&&!gt(null==n?void 0:n.adaptiveIconSize)&&Wn(g1,this,n.adaptiveIconSize),Xe(dn,this).rootDom&&(Xe(dn,this).rootDom.style.fontSize="20px",VD(this,Xe(dn,this).rootDom,Xe(g1,this))),c8.forEach(w=>{Xe(dn,this).addFontToUi(w)}),lt(WD,this,HMe).call(this),lt(WD,this,VMe).call(this)}get isVisible(){return Xe(So,this).getIsVisible(Xe(dn,this))}get isBoundContainer(){return Xe(So,this).getIsBoundContainer(Xe(dn,this))}get currentDocument(){return Xe(So,this).getCurrentDocument(Xe(dn,this))}get zoom(){return parseFloat(Xe(dn,this).getViewerConfig().zoom.toFixed(4))}set zoom(n){const{maxZoom:o,minZoom:h}=Xe(dn,this).getViewerConfig();(function(v,y,_,b,w,I){const A=mt.formatError(mt.isNumberAndIsInRange(v));return A?mt.output(1,_,b,void 0,A):(v<w&&mt.output(1,_,b,void 0,rt.ZOOM_TOO_SMALL),v>I&&mt.output(1,_,b,void 0,rt.ZOOM_TOO_LARGE),!0)})(n,0,`${es}.zoom`,"zoom",h,o)&&Xe(dn,this).updateViewerConfig({zoom:n})}get zoomOrigin(){return Xe(dn,this).getViewerConfig().zoomOrigin}set zoomOrigin(n){(function(o,h,v,y){const _=_o.isZoomOriginValid(o);return!_.length||mt.output(1,h,"zoomOrigin",_)})(n,`${es}.zoomOrigin`)&&Xe(dn,this).updateViewerConfig({zoomOrigin:{x:n.x,y:n.y}})}get displayMode(){const{displayMode:n}=Xe(dn,this).getViewerConfig(),o=Xe(dn,this).getActiveTab();return o?o.context.displayMode:n}set displayMode(n){const o="displayMode",h=`${es}.${o}`;lr(n,1,h,o)&&(["single","continuous"].includes(n)?Xe(dn,this).updateViewerConfig({displayMode:n}):rt.warning(rt.PARAM_NOT_SUPPORT,h,o))}get toolMode(){const{toolMode:n}=Xe(dn,this).getViewerConfig();return n}set toolMode(n){const o="toolMode",h=`${es}.${o}`;var _;lr(n,1,h,o)&&(_=h,["crop","pan","annotation"].includes(n)||mt.output(1,_,"toolMode",void 0,rt.PARAM_NOT_SUPPORT))&&Xe(dn,this).updateViewerConfig({toolMode:n})}get annotationMode(){const{annotationMode:n}=Xe(dn,this).getViewerConfig();return n}set annotationMode(n){const o="annotationMode",h=`${es}.${o}`;var _;lr(n,1,h,o)&&(_=h,["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(n)||mt.output(1,_,"annotationMode",void 0,rt.PARAM_NOT_SUPPORT))&&Xe(dn,this).updateViewerConfig({annotationMode:n})}get fitMode(){const{fitMode:n}=Xe(dn,this).getViewerConfig(),o=Xe(dn,this).getActiveTab();return o?o.context.fitMode:n}set fitMode(n){const o=`${es}.fitMode`;var _;lr(n,1,o,"fitMode")&&(_=o,["width","height","window","actualSize"].includes(n)||mt.output(1,_,"fitMode",void 0,rt.PARAM_NOT_SUPPORT))&&Xe(dn,this).updateViewerConfig({fitMode:n})}bindContainer(n){Xe(So,this).bindContainer(Xe(dn,this),n,`${es}.bindContainer`)}unbindContainer(){Xe(So,this).unbindContainer(Xe(dn,this))}show(){Xe(So,this).show(Xe(dn,this)),VD(this,Xe(dn,this).rootDom,Xe(g1,this))}hide(){Xe(So,this).hide(Xe(dn,this))}getUiConfig(){return Xe(So,this).getUiConfig(Xe(dn,this))}updateUiConfig(n){return Xe(dn,this).selectAnnotations([]),!!Xe(So,this).updateUiConfig(Xe(dn,this),n,"editViewer",`${es}.updateUiConfig`)&&(Xe(dn,this).emit("thumbnailBind",this.thumbnail.uid),VD(this,Xe(dn,this).rootDom,Xe(g1,this)),!0)}openDocument(n){Xe(So,this).openDocument(n,this.uid,`${es}.openDocument`)}closeDocument(){return Xe(So,this).closeDocument(Xe(dn,this),`${es}.closeDocument`)}getStyle(n){return Xe(So,this).getStyle(Xe(dn,this),"edit",n,jne,`${es}.getStyle`)}updateStyle(n,o){const h=`${es}.updateStyle`;return Xe(So,this).updateStyle(Xe(dn,this),n,o,jne,h)}setParallelScrollCount(n){const o=`${es}.setParallelScrollCount`,h="count",{maxColumns:v,maxRows:y}=Xe(dn,this).getViewerConfig();return!(xn(n,1,o,h)||!h1(n,o,h,1)||f1(n,1,y,1,o,h)||f1(n,1,v,1,o,h))&&("continuous"!==this.displayMode?(rt.warning(rt.ROW_COLUMN_CAN_NOT_CHANGE,o),!1):Xe(dn,this).setRowAndColumn(n,n))}setCropRect(n){const o=`${es}.setCropRect`,h="rect";return!(xn(n,1,o,h)||Vne(n,o,h,1)||!Zo(Xe(dn,this),1)||vc(void 0,void 0,Xe(dn,this),1)||Une(o,h,Xe(dn,this),n,void 0,1))&&("crop"!==this.toolMode?(rt.warning(rt.TOOL_MODE_NOT_AVAILABLE,o),!1):Xe(dn,this).setRectBox(n))}getCropRect(){return Zo(Xe(dn,this),1)?Xe(dn,this).getRectBox():null}crop(n,o){const h=`${es}.crop`,v=Xe(dn,this).getPageCounts(),y="rect";if(xn(n,1,h,y)||Vne(n,h,y,1)||!Zo(Xe(dn,this),1)||vc(void 0,void 0,Xe(dn,this),1)||o&&!Fp(o,1,h,"indices",0,v-1)||Une(h,y,Xe(dn,this),n,o,1))return!1;const _=Xe(dn,this).getCurrentPageIndex();return Xe(dn,this).cropPages(n,o||[_])}rotate(n,o){const h=`${es}.rotate`;return Xe(So,this).rotate(Xe(dn,this),n,o,h)}undo(){if(!Zo(Xe(dn,this),1))return!1;const n=Xe(dn,this).undo();return n||rt.warning(rt.UNDO_NOOP),n}redo(){if(!Zo(Xe(dn,this),1))return!1;const n=Xe(dn,this).redo();return n||rt.warning(rt.REDO_NOOP),n}saveOperations(){return Xe(So,this).saveOperation(Xe(dn,this))}indexToUid(n){const o=`${es}.indexToUid`;return Xe(So,this).indexToUid(Xe(dn,this),n,o)}uidToIndex(n){const o=`${es}.uidToIndex`;return Xe(So,this).uidToIndex(Xe(dn,this),n,o)}getCurrentPageUid(){return Xe(So,this).getCurrentPageUid(Xe(dn,this))}getCurrentPageIndex(){return Xe(So,this).getCurrentPageIndex(Xe(dn,this))}getPageCount(){return Xe(So,this).getPageCount(Xe(dn,this))}goToPage(n){const o=`${es}.goToPage`;return Xe(So,this).gotoPage(Xe(dn,this),n,o)}selectAnnotations(n){const o=`${es}.selectAnnotations`,h="annotationUids";if(!Zo(Xe(dn,this),1)||vc(void 0,void 0,Xe(dn,this),1)||xn(n,1,o,h)||!Uw(n,1,o,h,void 0,!1))return!1;if("crop"===this.toolMode)return rt.warning(rt.TOOL_MODE_NOT_AVAILABLE,o),!1;n=[...new Set(n)];const v=[],y=[],_=[],b=this.getCurrentPageUid(),w=n.reduce((A,M,F)=>{const V=Ur.annotationService.getAnnotationByUid(M);return V?V.pageUid!==b?v.push(`${h}[${F}]: The specified annotation is not on the current page.`):"incomplete"===V.type||"unknown"===V.type?y.push(`${h}[${F}]: ${rt.UNSELECTED_UNKNOWN.message}`):V.flags.includes("readOnly")||V.flags.includes("noView")?_.push(`${h}[${F}]: ${rt.UNSELECTED_READONLY.message}`):A.push(M):v.push(`${h}[${F}]: The specified annotation does not exist.`),A},[]);if(v.length){const A=rt.ANNOTATION_SELECT;return A.details=v,rt.warning(A,o,h),!1}if(y.length){const A=rt.UNSELECTED_UNKNOWN;return A.details=y,rt.warning(A,o,h),!1}if(_.length){const A=rt.UNSELECTED_READONLY;return A.details=_,rt.warning(A,o,h),!1}const I=Xe(dn,this).getSelectedAnnotations().map(A=>A.uid);return I.length===w.length&&function(A,M){if(A.length!==M.length)return!1;const F=A.slice().sort(),V=M.slice().sort();for(let B=0;B<F.length;B++)if(F[B]!==V[B])return!1;return!0}(I,w)||Xe(dn,this).selectAnnotations(w),!0}getSelectedAnnotations(){return!Zo(Xe(dn,this),1)||vc(void 0,void 0,Xe(dn,this),1)?[]:Xe(dn,this).getSelectedAnnotations().length?Wne.getAnnotationsByUids(Xe(dn,this).getSelectedAnnotations().map(n=>n.uid)):[]}on(n,o){Xe(So,this).on(Xe(dn,this),`${es}.on`,n,o)}off(n,o){Xe(So,this).off(Xe(dn,this),`${es}.off`,n,o)}destroy(){Xe(So,this).destroy(Xe(dn,this))}}function VMe(){Xe(dn,this).hooks.destroy.on(()=>{var p;null===(p=this.thumbnail)||void 0===p||p.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,Wn(dn,this,null),Object.setPrototypeOf(this,null)})}function jMe(p){const n=p||{},o=pn(yMe);rr()&&(o.size="100%",o.rows=3,o.columns=2,o.canvasStyle.background="#4B4B4B",o.pageNumberStyle.color="white",o.enableOptimizePage=!0),yo(n,o);const{mainAndThbContainer:h,mainContainer:v,thumbnailContainer:y}=Xe(dn,this).context.viewService,{size:_,position:b,visibility:w}=o,I=pn(RD);let A="row",M=_,F="100%",V="left"===b?"-1":"1";"top"!==b&&"bottom"!==b||(A="column",M="100%",F=_,V="top"===b?"-1":"1"),I.className=`ddv-edit-viewer-thumb-${b}`,Object.assign(y.style,{width:M,height:F,order:V,display:"visible"===w?"block":"none"}),h.style.flexDirection=A,h.insertBefore(y,v),Xe(dn,this).context.resize();const Q=new Ane({container:y,viewerConfig:o,groupUid:this.groupUid,uiConfig:I},`${es}.thumbnail`);this.thumbnail=Q,Xe(dn,this).emit("thumbnailBind",Q.uid),Q.on("click",()=>{Xe(dn,this).emit("ui_hidePopup",null)})}function HMe(){this.on("resized",p=>{p.newWidth<1200&&p.newWidth>800&&VD(this,Xe(dn,this).rootDom,Xe(g1,this))})}const GMe={canvasStyle:Ke({},kD),pageStyle:Ke({},Cne),quadSelectionStyle:Ke({},KL),enableSlide:!0};function Gne(p,n,o,h){const v=_o.isQuadValid(p);return v.length?mt.output(n,o,h,v):!!JE(p.flat())||mt.output(n,o,h,void 0,rt.PARAM_INVALID)}function zne(p,n,o,h){return!!function(v,y,_){for(let b=0;b<v.length;b++)if(v[b][0]>y||v[b][1]>_)return!0;return!1}(p,o,h)&&(mt.output(n,void 0,void 0,void 0,rt.QUAD_EXCEED_PAGE_BOUND),!0)}const Yne=["canvasStyle","pageStyle","quadSelectionStyle"],$a="PerspectiveViewer";var ui=new WeakMap,To=new WeakMap,Xne=new WeakSet;function YMe(){Xe(ui,this).hooks.destroy.on(()=>{Wn(ui,this,null),Object.setPrototypeOf(this,null)})}var nd=new WeakMap,d0=new WeakMap,UD=new WeakMap,$ne=new WeakSet;function qMe(){fc.registerComponent({Root:Bee,Layout:Lee,Button:lL,Blank:Ute,SeparatorLine:Wee,Close:pL,Done:mL,Back:gL})}function VD(p,n,o){if(!o||rr()||!p.isVisible)return;const h=n,v=h.clientWidth;if(p instanceof Hne){let y=20;v<1280&&(y=Math.max(13.5,v/1280*20)),h.style.fontSize=`${y}px`}}function qne(p){if(p instanceof Blob)return!0;if(Sn(p)){const n=o=>{try{return new URL(o),!0}catch(h){return!1}};return!(!/^data:image\/([a-zA-Z]*);base64,/.test(p)&&!n(p))}return!1}function Kne(p,n){const o=["Load","Download","Print"],h=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],v=[...h,"MainView"],y=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],_=[...v,...y,...o,"PerspectiveAll","FullQuad"],b=[...v,...y,...o],w=[...v,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],I=[...v,...y,...o,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let A;switch(n){case"captureViewer":A=w;break;case"editViewer":A=I;break;case"perspectiveViewer":A=_;break;case"customViewer":A=h;break;case"browseViewer":A=b}const M=[];return null!=p&&p.type&&!A.includes(null==p?void 0:p.type)&&M.push(p.type),null!=p&&p.children&&p.children.forEach(F=>{Sn(F)&&!A.includes(F)&&M.push(F),Vn(F)&&M.push(...Kne(F,n))}),M}function Jne(p){const n=[];return null!=p&&p.type&&n.push(p.type),null!=p&&p.children&&p.children.forEach(o=>{Sn(o)&&n.push(o),Vn(o)&&n.push(...Jne(o))}),[...new Set(n)]}function Qne(p,n){const o=Kne(p,n);if(o.length>0){let h="";return o.forEach((v,y)=>{h+=y===o.length-1?`${v}`:`${v} `}),h}return!1}function jw(p){if(""===p)return!0;const n=document.createElement("div");n.style.border=p;const o=_=>""===_||"initial"===_,{borderWidth:h,borderColor:v,borderStyle:y}=n.style;return!(o(h)||o(v)||o(y))}function Zne(p,n,o){const{left:h,top:v,width:y,height:_}=p;return!(h>n||h+y>n||v>o||v+_>o)}function o8(p,n){return Object.keys(p).filter(o=>p[o]===n)}function s8(p,n){if(p===n)return!0;if(Vn(p)&&Vn(n)&&Object.keys(p).length===Object.keys(n).length){for(const o in p)if(!Object.prototype.hasOwnProperty.call(n,o)||!s8(p[o],n[o]))return!1}else{if(!Di(p)||!Di(n)||p.length!==n.length)return!1;for(let o=0;o<p.length;o++)if(!s8(p[o],n[o]))return!1}return!0}function eie(p,n){let o;switch(p){case"canvasStyle":o=function(h,v){const y=[];return y.push(...tie(h,{border:(null==v?void 0:v.border)||"",background:(null==v?void 0:v.background)||""})),gt(null==v?void 0:v.cursor)||Sn(v.cursor)||y.push(`${h}.cursor is invalid`),y}(p,n);break;case"pageNumberStyle":o=function(h,v){const y=[],_=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(v).forEach(b=>{-1!==_.indexOf(b)&&(Sn(v[b])||y.push(`${h}.${b} is invalid.`)),"border"===b&&Sn(v[b])&&!jw(v[b])&&y.push(`${h}.border is invalid.`),("onPage"===b&&!As(v[b])||"opacity"===b&&!$t(v[b])||"visibility"===b&&-1===["visible","hidden"].indexOf(v[b]))&&y.push(`${h}.${b} is invalid.`)}),y}(p,n);break;case"checkBoxStyle":o=function(h,v){const y=[],_=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(v).forEach(b=>{-1!==_.indexOf(b)&&(Sn(v[b])||y.push(`${h}.${b} is invalid.`)),"border"===b&&Sn(v[b])&&!jw(v[b])&&y.push(`${h}.border is invalid.`),("opacity"===b&&!$t(v[b])||"visibility"===b&&-1===["visible","hidden"].indexOf(v[b]))&&y.push(`${h}.${b} is invalid.`)}),y}(p,n);break;case"quadSelectionStyle":o=function(h,v){const y=[],_=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(v).forEach(b=>{-1!==_.indexOf(b)&&(Sn(v[b])||y.push(`${h}.${b} is invalid`)),"border"!==b&&"ctrlBorder"!==b||!Sn(v[b])||jw(v[b])||y.push(`${h}.${b} is invalid`)}),y}(p,n);break;case"annotationSelectionStyle":o=function(h,v){const y=[],_=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(v).forEach(b=>{-1!==_.indexOf(b)&&(Sn(v[b])||y.push(`${h}.${b} is invalid.`)),"border"!==b&&"ctrlBorder"!==b||!Sn(v[b])||jw(v[b])||y.push(`${h}.${b} is invalid.`)}),y}(p,n);break;default:o=tie(p,n)}return o}function a8(p){return!!$t(p)&&p>=0}function tie(p,n){const o=[];return Object.keys(n).forEach(h=>{-1!==["background","border"].indexOf(h)&&(Sn(n[h])||o.push(`${p}.${h} is invalid.`),"border"===h&&n[h]&&Sn(n[h])&&!jw(n[h])&&o.push(`${p}.border is invalid.`))}),o}function nie(p,n){const o=p.flat(2),h=n.flat(2);if(o.length!==h.length)return!1;const v=h[0].x-o[0].x,y=h[1].y-o[1].y;for(let _=1;_<o.length;_++)if(h[_].x-o[_].x!==v||h[_].y-o[_].y!==y)return!1;return!0}class _o{static isLicenseValid(n){if(Sn(n)){const o=n.trim();return 0===o.length||o.startsWith("DLS")||(o.startsWith("f")||o.startsWith("t"))&&o.length>50}return!1}static isQuadValid(n,o){const h=[],v=bn("Quad",o);if(gt(n))return h.push(`${v} is missing.`),h;const y=mt.isArrayAndMeetMinLength(n,4),_=mt.formatDetails(v,y);return _.length?(h.push(..._),h):(n.forEach((b,w)=>{const I=bn("Quad",o,`[${w}]`,!0),A=mt.isArrayAndMeetMinLength(b,2),M=mt.formatDetails(bn("Array",I),A);M.length?h.push(...M):b.forEach((F,V)=>{const B=mt.isNumberAndIsInRange(F),Q=mt.formatDetails(bn("Array",I,`[${V}]`,!0),B);Q.length&&h.push(...Q)})}),h)}static isRectValid(n,o){const h=[],v=bn("Rect",o);if(gt(n))return h.push(`${v} is missing.`),h;const y=mt.formatDetails(v,Vn(n));return y.length?(h.push(...y),h):(["left","top","width","height"].forEach(_=>{const b=mt.formatDetails(bn("Rect",o,_),mt.isNumberAndIsInRange(n[_]));b.length&&h.push(...b)}),h)}static isSourceValid(n,o,h){const v=[],y="Source",_=mt.formatDetails(bn(y,o),Vn(n));if(_.length)return v.push(..._),v;const b=mt.formatDetails(bn(y,o,"fileData"),pl(n.fileData));if(b.length)return v.push(...b),v;if(!gt(n.extraPageData)){const w=mt.formatDetails(bn(y,o,"extraPageData"),mt.isArrayAndMeetMinLength(n.extraPageData));if(w.length)return v.push(...w),v;n.extraPageData.forEach((I,A)=>{const M=this.isExtraPageDataValid(I,bn(y,o,`extraPageData[${A}]`,!0),h);M.length&&v.push(...M)})}return v}static isExtraPageDataValid(n,o,h){const v=[],y="ExtraPageData",_=mt.formatDetails(bn(y,o),Vn(n));if(_.length)return v.push(..._),v;const b=mt.formatDetails(bn(y,o,"index"),mt.isNumberAndIsInRange(n.index));if(v.push(...b),!gt(n.rotation)){const w=this.isRotationValid(n.rotation,bn(y,o));v.push(...w)}if(!gt(n.filter)){const w=this.isFilterTypeValid(n.filter,h,bn(y,o));v.push(...w)}return gt(n.perspectiveQuad)||v.push(...this.isQuadValid(n.perspectiveQuad,bn(y,o,"perspectiveQuad"))),v}static isSourcesValid(n,o,h){const v=[],y="Source[]",_=mt.formatDetails(bn(y,o),mt.isArrayAndMeetMinLength(n));return _.length?(v.push(..._),v):(n.forEach((b,w)=>{v.push(...this.isSourceValid(b,bn(y,o,`[${w}]`,!0),h))}),v)}static isLoadSourceOptionsValid(n,o){const h=[],v="LoadSourceOptions",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.insertBeforeIndex)){const _=mt.formatDetails(bn(v,o,"insertBeforeIndex"),mt.isNumberAndIsInRange(n.insertBeforeIndex));h.push(..._)}if(!gt(n.exception)){const _=mt.formatDetails(bn(v,o,"exception"),mt.isStringAndNotEmpty(n.exception,!1));h.push(..._)}return h}static isHandlerTypeValid(n){return{isValid:Sn(n)&&["documentBoundariesDetect","imageFilter"].includes(n)}}static isContainerKeyValid(n,o){const h="container";let v;if(E_(n)&&(v=n),Sn(n)){const _=document.getElementById(n);E_(_)&&(v=_)}const y=[];return v||y.push(`${bn(h,o,h)}: ${rt.CONTAINER_NOT_EXIST.message}`),y}static isContainerParamValid(n){return Sn(n)||E_(n)?this.isContainerKeyValid(n).length>0?rt.CONTAINER_NOT_EXIST:null:rt.PARAM_INVALID}static isUiConfigValid(n,o){const h="UiConfig",v=[],y=mt.formatDetails(bn(h,o),Vn(n));if(y.length)return v.push(...y),v;const _=mt.formatDetails(bn(h,o,"type"),mt.isStringAndNotEmpty(n.type,!1));if(v.push(..._),["id","name","flexDirection","tooltip","className","label"].forEach(b=>{if(!gt(n[b])){const w=mt.formatDetails(bn(h,o,b),mt.isStringAndNotEmpty(n[b]));v.push(...w)}}),["style","events"].forEach(b=>{if(!gt(n[b])){const w=mt.formatDetails(bn(h,o,b),Vn(n[b]));v.push(...w)}}),!gt(n.children)){const b=mt.formatDetails(bn(h,o,"children"),mt.isArrayAndMeetMinLength(n.children));if(b.length)return v.push(...b),v;n.children.forEach((w,I)=>{if(Sn(w)||Vn(w)||v.push(`${h}.children[${I}] is invalid.`),Vn(w)){const A=this.isUiConfigValid(w,bn(h,o,`children[${I}]`));v.push(...A)}})}return v}static isDocOptionsValid(n,o){const h=[],v=o||"CreateDocumentOptions",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.name)){const _=mt.formatDetails(bn(v,o,"name"),mt.isStringAndNotEmpty(n.name,!1));h.push(..._)}if(!gt(n.author)){const _=mt.formatDetails(bn(v,o,"author"),mt.isStringAndNotEmpty(n.author,!1));h.push(..._)}if(!gt(n.creationDate)){const _=mt.formatDetails(bn(v,o,"creationDate"),mt.isPdfDate(n.creationDate));h.push(..._)}if(!gt(n.deleteOriginal)){const _=mt.formatDetails(bn(v,o,"deleteOriginal"),As(n.deleteOriginal));h.push(..._)}return h}static isTransferOptionsValid(n,o,h,v){const y=[],_="TransferOptions",b=mt.formatDetails(bn(_,v),Vn(n));if(b.length)return y.push(...b),y;if(!gt(n.sourceIndices)){const w=this.isNumberArrayValid(n.sourceIndices,o,h,bn(_,v,"sourceIndices"));y.push(...w)}if(!gt(n.insertBeforeIndex)){const w=mt.formatDetails(bn(_,v,"insertBeforeIndex"),mt.isNumberAndIsInRange(n.insertBeforeIndex,0));y.push(...w)}return y}static isNumberArrayValid(n,o,h,v){return this.isTypeArrayValid("number",n,o,h,v)}static isStringArrayValid(n,o){return this.isTypeArrayValid("string",n,void 0,void 0,o)}static isBlobArrayValid(n,o){return this.isTypeArrayValid("blob",n,void 0,void 0,o)}static isTypeArrayValid(n,o,h,v,y){const _=[],b=mt.formatDetails(bn("Array",y),mt.isArrayAndMeetMinLength(o));return b.length?(_.push(...b),_):(o.forEach((w,I)=>{let A=null;"blob"===n?A=pl(w):"number"===n?A=mt.isNumberAndIsInRange(w,h,v):"string"===n&&(A=mt.isStringAndNotEmpty(w));const M=mt.formatDetails(bn("Array",y,`[${I}]`,!0),A);_.push(...M)}),_)}static isUpdatePageOptionsValid(n,o,h){const v=[],y="UpdatePageOptions",_=mt.formatDetails(bn(y,h),Vn(n));if(_.length)return v.push(..._),v;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach(b=>{const w=n[b];if(!gt(w)){const I=mt.formatDetails(bn(y,h,b),mt.isNumberAndIsInRange(w,0));v.push(...I)}}),!gt(n.rotation)){const b=this.isRotationValid(n.rotation,bn(y,h));v.push(...b)}if(!gt(n.filter)){const b=this.isFilterTypeValid(n.filter,o,bn(y,h));v.push(...b)}return v}static isRotationValid(n,o){const h=[],v=bn("",o,"rotation"),y=mt.formatDetails(v,mt.isNumberAndIsInRange(n));return y.length?(h.push(...y),h):(h.length||n%90==0||h.push(`'${v}' is not supported.`),h)}static isFilterTypeValid(n,o,h){const v=[],y=bn("",h,"filter"),_=mt.formatDetails(y,mt.isStringAndNotEmpty(n,!1));return _.length?(v.push(..._),v):(!v.length&&"none"!==n&&Di(o)&&o.length>0&&!o.includes(n)&&v.push(`'${y}' is not supported.`),v)}static isSaveJpegSettingsValid(n,o){const h=[],v="SaveJpegSettings",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.quality)){const _=mt.formatDetails(bn(v,o,"quality"),mt.isNumberAndIsInRange(n.quality,0,100));h.push(..._)}if(!gt(n.saveAnnotation)){const _=mt.formatDetails(bn(v,o,"saveAnnotation"),As(n.saveAnnotation));h.push(..._)}return h}static isSavePngSettingsValid(n,o){const h=[],v="SavePngSettings",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.saveAnnotation)){const _=mt.formatDetails(bn(v,o,"saveAnnotation"),As(n.saveAnnotation));h.push(..._)}return h}static isSavePdfSettingsValid(n,o){const h=[],v="SavePdfSettings",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(["author","creator","keyWords","producer","subject","title"].forEach(_=>{const b=n[_];if(!gt(b)){const w=mt.formatDetails(bn(v,o,_),mt.isStringAndNotEmpty(b,!1));h.push(...w)}}),!gt(n.compression)){const _=mt.formatDetails(bn(v,o,"compression"),u5.has(n.compression));h.push(..._)}if(!gt(n.creationDate)){const _=mt.formatDetails(bn(v,o,"creationDate"),mt.isPdfDate(n.creationDate));h.push(..._)}if(!gt(n.modifiedDate)){const _=mt.formatDetails(bn(v,o,"modifiedDate"),mt.isPdfDate(n.modifiedDate));h.push(..._)}if(!gt(n.pageType)){const _=mt.formatDetails(bn(v,o,"pageType"),c5.has(n.pageType));h.push(..._)}if(!gt(n.version)){const _=mt.formatDetails(bn(v,o,"version"),this.isPdfVersionValid(n.version));h.push(..._)}if(!gt(n.mimeType)){const _=mt.formatDetails(bn(v,o,"mimeType"),mt.isStringAndNotEmpty(n.mimeType));h.push(..._)}if(!gt(n.quality)){const _=mt.formatDetails(bn(v,o,"quality"),mt.isNumberAndIsInRange(n.quality,0,100));h.push(..._)}if(!gt(n.password)){const _=mt.formatDetails(bn(v,o,"password"),mt.isStringAndNotEmpty(n.password));h.push(..._),!_.length&&n.password.length>32&&h.push("The specified password exceeds 32 characters.")}if(!gt(n.saveAnnotation)){const _=mt.formatDetails(bn(v,o,"saveAnnotation"),["none","image","annotation","flatten"].includes(n.saveAnnotation));h.push(..._)}if(!gt(n.imageScaleFactor)){const _=mt.formatDetails(bn(v,o,"imageScaleFactor"),mt.isNumberAndIsInRange(n.imageScaleFactor,Number.MIN_VALUE,1));h.push(..._)}return h}static isPdfVersionValid(n){return!!Sn(n)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(n.trim())}static isSaveTiffSettingsValid(n,o){const h=[],v="SaveTiffSettings",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.compression)){const _=mt.formatDetails(bn(v,o,"compression"),r2.has(n.compression));h.push(..._)}if(!gt(n.customTag)){const _=mt.formatDetails(bn(v,o,"customTag"),mt.isArrayAndMeetMinLength(n.customTag));h.push(..._),_.length||n.customTag.forEach((b,w)=>{const I=this.isTiffCustomTagValid(b,bn(v,o,`customTag[${w}]`));h.push(...I)})}if(!gt(n.quality)){const _=mt.formatDetails(bn(v,o,"quality"),mt.isNumberAndIsInRange(n.quality,0,100));h.push(..._)}return h}static isTiffCustomTagValid(n,o){const h=[],v="CustomTag",y=mt.formatDetails(bn(v,o),Vn(n));if(y.length)return h.push(...y),h;if(!gt(n.content)){const _=mt.formatDetails(bn(v,o,"content"),mt.isStringAndNotEmpty(n.content,!1));h.push(..._)}if(!gt(n.contentIsBase64)){const _=mt.formatDetails(bn(v,o,"contentIsBase64"),As(n.contentIsBase64));h.push(..._)}if(!gt(n.id)){const _=mt.formatDetails(bn(v,o,"id"),mt.isNumberAndIsInRange(n.id));h.push(..._)}return h}static isVideoDeviceInfo(n,o){const h=[],v=mt.formatDetails(o,Vn(n));h.push(...v);const y=mt.formatDetails(bn(o,void 0,"deviceId"),mt.isStringAndNotEmpty(n.deviceId,!1));h.push(...y);const _=mt.formatDetails(bn(o,void 0,"label"),mt.isStringAndNotEmpty(n.label,!1));return h.push(..._),h}static isVideoConfig(n,o){const h=[],v=mt.formatDetails(o,Vn(n));if(v.length)return h.push(...v),h;if(!gt(n.fill)){const y=mt.formatDetails(bn(o,void 0,"fill"),As(n.fill));h.push(...y)}if(!gt(n.resolution)){const y=_o.isNumberArrayValid(n.resolution,0,void 0,bn(o,void 0,"resolution"));h.push(...y)}return h}static isZoomOriginValid(n){const o=[],h=mt.formatDetails("zoomOrigin",Vn(n));return h.length?(o.push(...h),o):(["x","y"].forEach(v=>{const y=n[v];gt(y)?o.push(`ZoomOrigin.${v} is missing.`):["start","center","end"].includes(y)||o.push(`ZoomOrigin.${v} is valid.`)}),o)}static isAnnotationOptionsValid(n,o,h){const v=[],y=["x","y","rotation"],_=["width","height","borderWidth","opacity","miterLimit","fontSize"],b=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],w=["fontWeight"],I=["fontStyle"],A=["points"],M=["textContents"],F=["startPoint","endPoint"],V=["flags"],B=["underline","lineThrough"],Q=["stamp"],J=["lineDash"];if("textTypewriter"===h){const{textContents:se}=n;if(se&&(!Di(se)||!se.length||se.find(ce=>!Vn(ce))||se.every(ce=>""===ce.content||null==ce.content)))return v.push(`${o}.textContents is invalid`),v}const Z=se=>!!Vn(se)&&!!$t(null==se?void 0:se.x)&&!!$t(null==se?void 0:se.y),re=se=>{if(!Di(se)||se.length<2)return!1;for(let ce=0;ce<se.length;ce++)if(!Z(se[ce]))return!1;return!0};return Object.keys(n).forEach(se=>{const ce=n[se];let pe=!0;var Ce;(y.includes(se)&&!$t(ce)||_.includes(se)&&!a8(ce)||b.includes(se)&&!Sn(ce)||M.includes(se)&&!(Ve=>{if(!Di(Ve))return!1;for(let te=0;te<Ve.length;te++){const Me=Ve[te];if(!Vn(Me))return!1;const we=Object.keys(Me);for(let Le=0;Le<we.length;Le++){const j=we[Le],L=Me[j];if(y.includes(j)&&!$t(L)||_.includes(j)&&!a8(L)||b.includes(j)&&!Sn(L)||B.includes(j)&&!As(L)||w.includes(j)&&!["normal","bold"].includes(L)||I.includes(j)&&!["normal","italic"].includes(L))return!1}}return!0})(ce)||F.includes(se)&&!Z(ce)||V.includes(se)&&!Vn(ce)||Q.includes(se)&&![Ri.REJECTED,Ri.ACCEPTED,Ri.INITIAL_HERE,Ri.SIGN_HERE,Ri.WITNESS,Ri.APPROVED,Ri.NOT_APPROVED,Ri.DRAFT,Ri.FINAL,Ri.COMPLETED,Ri.CONFIDENTIAL,Ri.VOID].includes(Ce=ce)&&!pl(Ce)||J.includes(se)&&!(Ve=>{if(!Di(Ve))return!1;for(let te=0;te<Ve.length;te++)if(!a8(Ve[te]))return!1;return!0})(ce))&&(pe=!1),A.includes(se)&&("ink"===h?(Ve=>{if(!Di(Ve)||!Ve.length)return!1;for(let te=0;te<Ve.length;te++)if(!re(Ve[te]))return!1;return!0})(n[se])||(pe=!1):re(n[se])||(pe=!1)),pe||v.push(`${o}.${se} is invalid`)}),v}}var qs=new WeakMap,df=new WeakMap,sh=new WeakSet;class KMe{constructor(n,o){dl(this,sh),bi(this,qs,void 0),bi(this,df,void 0),Wn(qs,this,n),Wn(df,this,o)}get name(){return Xe(df,this).name}get uid(){return Xe(df,this).uid}get pages(){return Xe(df,this).pages.slice()}get creationDate(){return Xe(df,this).creationDate}get author(){return Xe(df,this).author}loadSource(n,o){var h=this;return Fe(function*(){const v="IDocument.loadSource",y="sources";return xi.makeSureLoadLicenseExist(),xn(n,0,v,y),function(_,b,w,I,A){let M=[];Di(_)?M=pl(_[0])?_.reduce((F,V,B)=>{if(!pl(V)){const Q=mt.formatDetails(bn("Array",A,`[${B}]`,!0),!1);F.push(...Q)}return F},[]):_o.isSourcesValid(_,void 0,b):pl(_)||(M=_o.isSourceValid(_,void 0,b)),!M.length||mt.output(0,"IDocument.loadSource",A,M)}(n,Xe(qs,h).filterService.getSupportedFilters().map(_=>_.type),0,0,y),Vn(o)?function(_,b,w,I){const A=_o.isLoadSourceOptionsValid(_,void 0);!A.length||mt.output(0,"IDocument.loadSource","loadSourceOptions",A)}(o):gt(o)||oh(o,0,v,"index",0),Di(n)||(n=[n]),pl(n[0])&&(n=n.map(_=>({fileData:_}))),Xe(qs,h).loadSource(n,h.uid,o).catch(_=>rt.reject(_,v))})()}getPageData(n){var o=this;return Fe(function*(){const h="IDocument.getPageData",v="pageUid";xn(n,0,h,v),lr(n,0,h,v,!1),o.pages.includes(n)||mt.error(h,v,void 0,rt.PAGE_NOT_EXIST);const y=yield Xe(qs,o).getPageData(n);y.raw&&(y.raw={data:y.raw.data,width:y.raw.width,height:y.raw.height}),y.display&&(y.display={data:y.display.data,width:y.display.width,height:y.display.height}),y.thumbnail&&(y.thumbnail={data:y.thumbnail.data,width:y.thumbnail.width,height:y.thumbnail.height}),y.rotation&&(y.rotation%=360);const{displayResolution:_,dataResolution:b}=jn;return y.mediaBox=iie(Kn(y.mediaBox,_,b),2),y.cropBox=iie(Kn(y.cropBox,_,b),2),y})()}updatePage(n,o,h){var v=this;return Fe(function*(){const y="IDocument.updatePage",_="pageUid";return xn(n,0,y,_),xn(o,0,y,"data"),lr(n,0,y,_,!1),MD(v.pages,n,0,y),pl(o)||mt.output(0,"IDocument.updatePage","data",void 0,rt.PARAM_INVALID),!gt(h)&&function(w,I,A,M){const F=_o.isUpdatePageOptionsValid(w,I,"updatePageOptions");!F.length||mt.output(0,"IDocument.updatePage","options",F)}(h,Xe(qs,v).filterService.getSupportedFilters().map(w=>w.type)),Xe(qs,v).updatePage(n,o,h)})()}deletePages(n){const o="IDocument.deletePages",h="indices";if(xn(n,1,o,h)||!Fp(n,1,o,h,0,Hh(sh,this,hf)-1))return!1;const v=n.map(y=>Xe(df,this).pages[y]);return Xe(qs,this).deletePages(this.uid,v)}deleteAllPages(){return Xe(df,this).pages.slice(),Xe(qs,this).deleteAllPages(this.uid)}movePages(n,o){const h="IDocument.movePages",v="indices";xn(n,0,h,v),Fp(n,0,h,v,0,Hh(sh,this,hf)-1),gt(o)||oh(o,0,h,"insertBeforeIndex",0),o=o>Hh(sh,this,hf)-1?void 0:o,Xe(qs,this).movePages(this.uid,n,o)}switchPage(n,o){const h="IDocument.switchPage",v="oneIndex",y="anotherIndex";xn(n,0,h,v),xn(o,0,h,y),oh(n,0,h,v,0,Hh(sh,this,hf)-1),oh(o,0,h,y,0,Hh(sh,this,hf)-1),Xe(qs,this).documentService.swapPages(this.uid,n,o)}rename(n){const o="IDocument.rename",h="name";return!xn(n,1,o,h)&&!!lr(n,1,o,h)&&Xe(qs,this).documentService.renameDocument(this.uid,n)}setPageCustomData(n,o){const h="IDocument.setPageCustomData",v="pageUid";return xn(n,0,h,v),xn(o,0,h,"data"),lr(n,0,h,v,!1),MD(this.pages,n,0,h),Xe(qs,this).setCustomData(n,o)}getPageCustomData(n){const o="IDocument.getPageCustomData",h="pageUid";return xn(n,0,o,h),lr(n,0,o,h,!1),MD(this.pages,n,0,o),Xe(qs,this).getCustomData(n)}saveToJpeg(n,o){var h=this;return Fe(function*(){const v="IDocument.saveToJpeg",y="index";xn(n,0,v,y),oh(n,0,v,y,0,Hh(sh,h,hf)-1),gt(o)||function(b,w,I){const A=_o.isSaveJpegSettingsValid(b);!A.length||mt.output(0,"IDocument.saveToJpeg","saveJpegSettings",A)}(o);const _=h.pages[n];return Xe(qs,h).fileSaveService.saveToJpeg(_,o).catch(b=>rt.reject(b,v))})()}saveToPng(n,o){const h="IDocument.saveToPng",v="index";xn(n,0,h,v),oh(n,0,h,v,0,Hh(sh,this,hf)-1),gt(o)||function(_,b,w){const I=_o.isSavePngSettingsValid(_);I.length&&mt.output(0,"IDocument.saveToPng","savePngSettings",I)}(o);const y=this.pages[n];return Xe(qs,this).fileSaveService.saveToPng(y,o).catch(_=>rt.reject(_,h))}saveToPdf(n,o){const h="IDocument.saveToPdf";0===this.pages.length&&rt.throw(rt.DOC_NO_IMAGE),Di(n)?Fp(n,0,h,"indices",0,Hh(sh,this,hf)-1):(o=n,n=Array.from(Array(this.pages.length).keys())),gt(o)||function(y,_,b){const w=_o.isSavePdfSettingsValid(y);!w.length||mt.output(0,"IDocument.saveToPdf","savePdfSettings",w)}(o);const v=[];n.forEach(y=>{v.push(this.pages[y])});try{!o||"annotation"!==o.saveAnnotation&&"flatten"!==o.saveAnnotation||xi.makeSureAnnotationLicenseExist()}catch(y){return Promise.reject(y)}return Xe(qs,this).fileSaveService.saveToPdf(v,o).catch(y=>rt.reject(y,h))}saveToTiff(n,o){const h="IDocument.saveToTiff";0===this.pages.length&&rt.throw(rt.DOC_NO_IMAGE),Di(n)?Fp(n,0,h,"indices",0,Hh(sh,this,hf)-1):(o=n,n=Array.from(Array(this.pages.length).keys())),gt(o)||function(y,_,b){const w=_o.isSaveTiffSettingsValid(y);!w.length||mt.output(0,"IDocument.saveToTiff","saveTiffSettings",w)}(o);const v=[];return n.forEach(y=>{v.push(this.pages[y])}),Xe(qs,this).fileSaveService.saveToTiff(v,o).catch(y=>rt.reject(y,h))}print(n,o){const h="IDocument.print";let v,y=o;var _;Di(n)?(Fp(n,0,h,"indices",0,Hh(sh,this,hf)-1),v=n):y=n,gt(y)||gt(null===(_=y)||void 0===_?void 0:_.printAnnotation)||As(y.printAnnotation)||mt.error(h,"setting.printAnnotation",void 0,rt.PARAM_INVALID),0===this.pages.length&&rt.throw(rt.DOC_NO_IMAGE),Xe(qs,this).printPages(this.uid,v,y)}insertBlankPage(n,o,h){const v="IDocument.insertBlankPage",y="pageWidth",_="pageHeight";return xi.makeSureLoadLicenseExist(),xn(n,0,v,y),xn(o,0,v,_),oh(n,0,v,y,.72,7200),oh(o,0,v,_,.72,7200),gt(h)||oh(h,0,v,"insertBeforeIndex",0),Xe(qs,this).insertBlankPage(this.uid,Math.floor(Kn(n,jn.dataResolution,72))||1,Math.floor(Kn(o,jn.dataResolution,72))||1,72,72,h)}}function hf(p){return Xe(df,p).pages.length}function iie(p,n){let o=!0;const h=Xh(p.left,n),v=Xh(p.top,n),y=Xh(p.width,n),_=Xh(p.height,n),b=1e-7;return(Math.abs(h-p.left)>b||Math.abs(v-p.top)>b||Math.abs(y-p.width)>b||Math.abs(_-p.height)>b)&&(o=!1),o?{left:h,top:v,width:y,height:_}:p}function rie(p,n,o,h,v){if(!gt(p)){const y="transferOptions",_=_o.isTransferOptionsValid(p,n,o,y);if(_.length)return mt.output(h,v,y,_)}return!0}function oie(p,n,o,h){if(!gt(p)){const v=_o.isDocOptionsValid(p);if(v.length)return mt.output(n,o,h,v)}return!0}function sie(p,n,o,h,v){const y=n.reduce((_,b,w)=>(p.has(b)||_.push(`${v}[${w}]:The specified document(s) do not exist.`),_),[]);return!y.length||mt.output(o,h,v,y,rt.DOC_NOT_EXIST,!0)}const aie=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var ah=new WeakMap,Cl=new WeakMap,ff=new WeakMap;const lie=new class extends or{constructor(){super(),bi(this,ah,void 0),bi(this,Cl,void 0),bi(this,ff,void 0),Wn(ff,this,new Yh),Wn(ah,this,Ur),Wn(Cl,this,new Map),Ur.onUnload.on(()=>{Xe(Cl,this).clear(),Xe(ff,this).removeAllEventListeners()},this);const{documentService:p}=Ur;p.onDocumentCreated.on(n=>{const o=Xe(ah,this).getDocument(n.docUid),h=new KMe(Xe(ah,this),o);Xe(Cl,this).set(h.uid,h),Xe(ff,this).emit("documentCreated",n)},this),p.onDocumentDeleted.on(n=>{Xe(Cl,this).has(n.docUid)&&Xe(Cl,this).delete(n.docUid),Xe(ff,this).emit("documentDeleted",n)},this),p.onPagesAdded.on(n=>{n.indices.length&&n.pageUids.length&&Xe(ff,this).emit("pagesAdded",n)},this),p.onDeletePagesFromDoc.on(n=>{Xe(ff,this).emit("pagesDeleted",n)},this),p.onDeleteAllPagesFromDoc.on(n=>{Xe(ff,this).emit("pagesDeleted",n)},this)}createDocument(p){oie(p,0,"DocumentManager.createDocument","createDocumentOptions");const n=Xe(ah,this).createDocument(p);return Xe(Cl,this).get(n.uid)}getDocument(p){const n="DocumentManager.getDocument",o="docUid";xn(p,0,n,o),lr(p,0,n,o);const h=Xe(Cl,this).get(p);return h||mt.error(n,o,void 0,rt.DOC_NOT_EXIST),h}getAllDocuments(){return Array.from(Xe(Cl,this).values())}deleteDocuments(p){const n="DocumentManager.deleteDocuments",o="docUids";return!(xn(p,1,n,o)||!Uw(p,1,n,o,void 0,!1)||!sie(Xe(Cl,this),p,1,n,o))&&Xe(ah,this).deleteDocuments([...new Set(p)])}deleteAllDocuments(){const p=Xe(ah,this).documentService.getAllDocuments();return Xe(ah,this).deleteDocuments(p.map(n=>n.uid))}copyPagesToDocument(p,n,o){const h="DocumentManager.copyPagesToDocument",v="sourceDocUid",y="targetDocUid";xn(p,0,h,v),xn(n,0,h,y),lr(p,0,h,v),lr(n,0,h,y);const _=Xe(Cl,this).get(p),b=Xe(Cl,this).get(n);return _&&b||rt.throw(rt.DOC_NOT_EXIST,h),rie(o,0,_.pages.length-1,0,h),Xe(ah,this).transferDocument(p,n,zt(Ke({},o),{copy:!0}))}movePagesToDocument(p,n,o){const h="DocumentManager.movePagesToDocument",v="sourceDocUid",y="targetDocUid";xn(p,0,h,v),xn(n,0,h,y),lr(p,0,h,v),lr(n,0,h,y);const _=Xe(Cl,this).get(p),b=Xe(Cl,this).get(n);return _&&b||rt.throw(rt.DOC_NOT_EXIST,h),rie(o,0,_.pages.length-1,0,h),Xe(ah,this).transferDocument(p,n,o)}mergeDocuments(p,n){const o="DocumentManager.mergeDocuments",h="docUids";var y;xn(p,0,o,h),Uw(p,0,o,h,void 0,!1),y=p,new Set(y).size!==y.length&&mt.error(void 0,void 0,void 0,rt.DOC_UID_DUPLICATE),sie(Xe(Cl,this),p,0,o,h),oie(n,0,o,"mergeDocumentOptions");const v=Xe(ah,this).mergeDocuments(p,n);return Xe(Cl,this).get(v.uid)}on(p,n){const o="DocumentManager.on";!xn(p,1,o,"eventName")&&!xn(n,1,o,"listener")&&lr(p,1,o,"eventName",!1)&&cf(n,o,"listener",1)&&(aie.includes(p)?Xe(ff,this).on(p,n):rt.warning(rt.PARAM_NOT_SUPPORT,o,"eventName"))}off(p,n){const o="DocumentManager.off";!xn(p,1,o,"eventName")&&lr(p,1,o,"eventName",!1)&&(gt(n)||cf(n,o,"listener",1))&&(aie.includes(p)?Xe(ff,this).off(p,n):rt.warning(rt.PARAM_NOT_SUPPORT,o,"eventName"))}},cie=`${(()=>{if(!Mv&&document.currentScript){let{src:p}=document.currentScript;const n=p.indexOf("?");if(-1!==n)p=p.substring(0,n);else{const o=p.indexOf("#");-1!==o&&(p=p.substring(0,o))}return p.substring(0,p.lastIndexOf("/")+1)}return"./"})()}engine`;var jD=new WeakMap,HD=new WeakMap,Hw=new WeakMap;const JMe=new class{constructor(){bi(this,jD,""),bi(this,HD,""),bi(this,Hw,cie)}get versionInfo(){return{viewer:"2.0.0",engine:vn.version}}set engineResourcePath(p){Sn(p)?Wn(Hw,this,p):rt.throw(rt.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath")}get engineResourcePath(){return Xe(Hw,this)}set license(p){(function(n,o,h,v){const y=mt.formatError({isValid:_o.isLicenseValid(n)});!y||mt.output(0,"Core.license","license",void 0,y)})(p),Wn(HD,this,p)}get license(){return Xe(HD,this)}set deviceFriendlyName(p){Sn(p)?Wn(jD,this,p):rt.throw(rt.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName")}get deviceFriendlyName(){return Xe(jD,this)}loadWasm(){return function(){var p=Fe(function*(n){let o=n.trim();if(o.endsWith("/")||(o=`${o}/`),vn.resourceDir=o,!(yield vn.isResourceDirValid()))return rt.reject(rt.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");yield vn.preloadModule("core");const h=vn.preloadModule("proc"),v=vn.preloadModule("pdf");yield Promise.all([h,v])});return function(n){return p.apply(this,arguments)}}()(Xe(Hw,this))}init(){return function NAe(p){return nF.apply(this,arguments)}({license:Xe(HD,this),engineResourcePath:Xe(Hw,this),deviceFriendlyName:Xe(jD,this)})}};var l8;!function(p){p.NONE="none",p.BLACK_AND_WHITE="blackAndWhite",p.GRAY="gray",p.REMOVE_SHADOW="removeShadow",p.SAVE_INK="saveInk",p.ENHANCE="enhance",p.INVERT="invert"}(l8||(l8={}));const c8=[],Lp={documentManager:lie,Core:JMe,Elements:Tn,DocumentDetect:YZ,ImageFilter:class{constructor(){dl(this,j5)}get defaultFilterType(){return Xs.NONE}applyFilter(p,n,o,h){var v=this;return Fe(function*(){const y=new Kg,_=lt(j5,v,uAe).call(v,n,o),b=lt(j5,v,dAe).call(v,Ke({outputType:p.type},h||{}));let w;try{const I=yield y.initImage({source:p.data,isRGBA:p.type===Er.RGBA,width:p.width,height:p.height,isBGRA:p.type===Er.BGRA});let A;I.srcBuffer&&(p.data=I.srcBuffer),n===Xs.NONE?(A=yield y.getImage({jpegQuality:b.jpegQuality,ifDeleteObject:!0,isRGBA:p.type===Er.RGBA,bitDepth:b.bitDepth,xDpi:b.xdpi,yDpi:b.ydpi,returnBlob:!1,returnType:Kx[b.outputType]}),y.freeReservedData()):A=yield y.filter($Z.get(n),_,b),w=new Blob([A.imageData],{type:A.blobType})}finally{y.terminate()}return w})()}querySupported(){return[{type:Xs.NONE,label:"Original"},{type:Xs.BLACK_AND_WHITE,label:"B&W"},{type:Xs.GRAY,label:"Grayscale"},{type:Xs.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:class XMe extends Ane{constructor(n){super(n,"BrowseViewer")}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(n){this.vCommon.bindContainer(this.v,n,`${this.errorPrefix}.bindContainer`)}unbindContainer(){this.vCommon.unbindContainer(this.v)}openDocument(n){this.vCommon.openDocument(n,this.uid,`${this.errorPrefix}.openDocument`)}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(n,o){return this.vCommon.rotate(this.v,n,o,`${this.errorPrefix}.rotate`)}indexToUid(n){return this.vCommon.indexToUid(this.v,n,`${this.errorPrefix}.indexToUid`)}uidToIndex(n){return this.vCommon.uidToIndex(this.v,n,`${this.errorPrefix}.uidToIndex`)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(n){return this.vCommon.gotoPage(this.v,n,`${this.errorPrefix}.goToPage`)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v)}},CaptureViewer:class mMe{constructor(n){var o;dl(this,Tne),bi(this,Si,void 0),bi(this,Xa,new OD),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"postfix",void 0);const h=`new ${Yl}`;xi.makeSureCoreLicenseExist(),xi.makeSureCameraLicenseExist(),gt(n)||Bw(n,"captureViewer",0,h,"option");const v=yo((null==n?void 0:n.viewerConfig)||{},pn(zt(Ke({},gMe),{viewerMode:Ko.CAPTURE}))),y=rr()?gne:vne;Wn(Si,this,Ur.createViewer(zt(Ke({uiConfig:pn(y)},n),{viewerConfig:v}))),null!=n&&null!==(o=n.viewerConfig)&&void 0!==o&&o.enableAutoDetect&&!Xe(Si,this).context.core.detectorService.enableDetect&&rt.warning(rt.DOC_DETECT_MISS),this.uid=Xe(Si,this).uid,this.groupUid=Xe(Si,this).groupUid,this.postfix=Xe(Si,this).postfix,lt(Tne,this,vMe).call(this)}get isVisible(){return Xe(Xa,this).getIsVisible(Xe(Si,this))}get isBoundContainer(){return Xe(Xa,this).getIsBoundContainer(Xe(Si,this))}get currentDocument(){return Xe(Xa,this).getCurrentDocument(Xe(Si,this))}get acceptedPolygonConfidence(){return Xe(Si,this).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(n){const o="acceptedPolygonConfidence";oh(n,1,`${Yl}.${o}`,o,0,100)&&Xe(Si,this).updateCameraConfig({acceptedPolygonConfidence:n})}get maxFrameNumber(){return Xe(Si,this).getCameraConfig().maxFrameNumber}set maxFrameNumber(n){const o="maxFrameNumber";oh(n,1,`${Yl}.${o}`,o,1e-6,60)&&Xe(Si,this).updateCameraConfig({maxFrameNumber:n})}get enableAutoDetect(){return Xe(Si,this).getCameraConfig().enableAutoDetect}set enableAutoDetect(n){const o="enableAutoDetect",h=`${Yl}.${o}`;QL(n,h,o,1)&&(n&&!Xe(Si,this).context.core.detectorService.enableDetect&&mt.warning(h,void 0,void 0,rt.DOC_DETECT_MISS),Xe(Si,this).updateCameraConfig({enableAutoDetect:n}))}get enableAutoCapture(){return Xe(Si,this).getCameraConfig().enableAutoCapture}set enableAutoCapture(n){const o="enableAutoCapture";QL(n,`${Yl}.${o}`,o,1)&&Xe(Si,this).updateCameraConfig({enableAutoCapture:n})}bindContainer(n){Xe(Xa,this).bindContainer(Xe(Si,this),n,`${Yl}.bindContainer`)}unbindContainer(){Xe(Xa,this).unbindContainer(Xe(Si,this))}show(){Xe(Xa,this).show(Xe(Si,this))}hide(){Xe(Xa,this).hide(Xe(Si,this))}getUiConfig(){return Xe(Xa,this).getUiConfig(Xe(Si,this))}updateUiConfig(n){return Xe(Xa,this).updateUiConfig(Xe(Si,this),n,"captureViewer",`${Yl}.updateUiConfig`)}openDocument(n){Xe(Xa,this).openDocument(n,this.uid,`${Yl}.openDocument`)}closeDocument(){return Xe(Xa,this).closeDocument(Xe(Si,this),`${Yl}.closeDocument`)}getStyle(n){return Xe(Xa,this).getStyle(Xe(Si,this),"capture",n,Sne,`${Yl}.getStyle`)}updateStyle(n,o){return Xe(Xa,this).updateStyle(Xe(Si,this),n,o,Sne,`${Yl}.updateStyle`)}capture(){return Xe(Si,this).isVideoPlaying()?Xe(Si,this).context.viewService.isBindContainer?Xe(Si,this).capture():rt.reject(rt.CONTAINER_NO_BOUND):rt.reject(rt.CAMERA_NO_VIDEO)}play(n){const o=`${Yl}.play`;if(!gt(n)){const h=function(v,y,_,b){const w=_o.isVideoConfig(v,b);return!w.length||mt.output(2,_,b,w)}(n,0,o,"config");if(!0!==h)return h}return Xe(Si,this).play(n).catch(h=>rt.reject(h,o))}stop(){Xe(Si,this).stop()}getCurrentCamera(){return Xe(Si,this).getCurrentCamera()}getAllCameras(){return Xe(Si,this).getAllCameras()}selectCamera(n){const o=`${Yl}.selectCamera`,h="cameraObjectOrDeviceID",v=xn(n,2,o,h);if(v)return v;if(Sn(n)){const y=lr(n,2,o,h,!1);if(!0!==y)return y}else{const y=function(_,b,w,I){const A=_o.isVideoDeviceInfo(_,I);return!A.length||mt.output(2,w,I,A)}(n,0,o,h);if(!0!==y)return y}return Xe(Si,this).selectCamera(n).catch(y=>rt.reject(y,o,h))}getCurrentResolution(){return Xe(Si,this).getCurrentResolution()}turnOnTorch(){return Xe(Si,this).turnOnTorch().catch(n=>rt.reject(n))}turnOffTorch(){return Xe(Si,this).turnOffTorch().catch(n=>rt.reject(n))}on(n,o){Xe(Xa,this).on(Xe(Si,this),`${Yl}.on`,n,o)}off(n,o){Xe(Xa,this).off(Xe(Si,this),`${Yl}.off`,n,o)}destroy(){Xe(Xa,this).destroy(Xe(Si,this))}},CustomViewer:class $Me{constructor(n){dl(this,$ne),bi(this,nd,void 0),bi(this,d0,void 0),bi(this,UD,!1),W(this,"uid",void 0),W(this,"isDestroyed",!1),W(this,"postfix",void 0),this.uid=Ai(),this.postfix=`-${this.uid}`,Wn(d0,this,new Yh),gt(n)||Bw(n,"customViewer",0,"new CustomViewer","option");let o=null==n?void 0:n.uiConfig;(!o||Vn(o)&&0===Object.keys(o).length)&&(o={type:"Layout"}),lt($ne,this,qMe).call(this),Wn(nd,this,new fc({container:null==n?void 0:n.container,emitter:Xe(d0,this),postfix:this.uid,uiConfig:o,injection:{viewer:{postfix:this.postfix}}})),null!=n&&n.container&&o&&Xe(nd,this).bindContainer(n.container)}get isBoundContainer(){return Xe(UD,this)}get isVisible(){return"none"!==Xe(nd,this).rootDom.style.display}bindContainer(n){const o="CustomViewer.bindContainer";xn(n,0,o,"container");const h=_o.isContainerParamValid(n);h&&mt.error(o,"container",void 0,h),Xe(nd,this).bindContainer(n)&&Wn(UD,this,!0)}unbindContainer(){Xe(nd,this).unbindContainer(),Wn(UD,this,!1)}hide(){Xe(nd,this).rootDom.style.display="none"}show(){Xe(nd,this).rootDom.style.display="flex"}getUiConfig(){return Xe(nd,this).uiConfig}updateUiConfig(n){const o="CustomViewer.updateUiConfig",h="uiConfig";return!(xn(n,1,o,h)||!wne(n,"customViewer",o,h,1))&&Xe(nd,this).updateUiConfig(n)}on(n,o){const h="CustomViewer.on";!xn(n,1,h,"eventName")&&!xn(o,1,h,"listener")&&lr(n,1,h,"eventName",!1)&&cf(o,h,"listener",1)&&Xe(d0,this).on(n,o)}off(n,o){const h="CustomViewer.off";!xn(n,1,h,"eventName")&&lr(n,1,h,"eventName",!1)&&(gt(o)||cf(o,h,"listener",1))&&Xe(d0,this).off(n,o)}destroy(){this.isDestroyed||(Xe(nd,this).dispose(),Xe(d0,this).destroy(),Wn(nd,this,null),Wn(d0,this,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null)}},EditViewer:Hne,PerspectiveViewer:class zMe{constructor(n){dl(this,Xne),bi(this,ui,void 0),bi(this,To,new OD),W(this,"uid",void 0),W(this,"groupUid",void 0),W(this,"postfix",void 0),xi.makeSureCoreLicenseExist(),gt(n)||Bw(n,"perspectiveViewer",0,`new ${$a}`,"option");const o=yo((null==n?void 0:n.viewerConfig)||{},pn(zt(Ke({},GMe),{viewerMode:Ko.PERSPECTIVE,toolMode:"crop"}))),h=rr()?mne:yne;Wn(ui,this,Ur.createViewer(zt(Ke({uiConfig:pn(h)},n),{viewerConfig:o}))),this.uid=Xe(ui,this).uid,this.groupUid=Xe(ui,this).groupUid,this.postfix=Xe(ui,this).postfix,lt(Xne,this,YMe).call(this)}get isVisible(){return Xe(To,this).getIsVisible(Xe(ui,this))}get isBoundContainer(){return Xe(To,this).getIsBoundContainer(Xe(ui,this))}get currentDocument(){return Xe(To,this).getCurrentDocument(Xe(ui,this))}bindContainer(n){Xe(To,this).bindContainer(Xe(ui,this),n,`${$a}.bindContainer`)}unbindContainer(){Xe(To,this).unbindContainer(Xe(ui,this))}show(){Xe(To,this).show(Xe(ui,this))}hide(){Xe(To,this).hide(Xe(ui,this))}getUiConfig(){return Xe(To,this).getUiConfig(Xe(ui,this))}updateUiConfig(n){return Xe(To,this).updateUiConfig(Xe(ui,this),n,"perspectiveViewer",`${$a}.updateUiConfig`)}openDocument(n){Xe(To,this).openDocument(n,this.uid,`${$a}.openDocument`)}closeDocument(){return Xe(To,this).closeDocument(Xe(ui,this),`${$a}.closeDocument`)}getStyle(n){return Xe(To,this).getStyle(Xe(ui,this),"perspective",n,Yne,`${$a}.getStyle`)}updateStyle(n,o){const h=`${$a}.updateStyle`;return Xe(To,this).updateStyle(Xe(ui,this),n,o,Yne,h)}setQuadSelection(n){const o=`${$a}.setQuadSelection`,h="quad";if(xn(n,1,o,h)||!Gne(n,1,o,h)||!Zo(Xe(ui,this),1)||vc(o,void 0,Xe(ui,this),1))return!1;const{width:v,height:y}=Xe(ui,this).getRealPixelSize();return!zne(n,1,v,y)&&Xe(ui,this).setQuadBox(n)}getQuadSelection(){const n=`${$a}.getQuadSelection`;return!Zo(Xe(ui,this),1)||vc(n,void 0,Xe(ui,this),1)?null:Xe(ui,this).getQuadBox()}resetQuadSelection(n){const o=`${$a}.resetQuadSelection`;return!(!Zo(Xe(ui,this),1)||vc(o,void 0,Xe(ui,this),1)||!gt(n)&&!Fp(n,1,o,"indices",0,Xe(ui,this).getPageCounts()-1))&&Xe(ui,this).resetQuadBox(n)}applyPerspective(n){const o=`${$a}.applyPerspective`,h="quad";xn(n,0,o,h),Gne(n,0,o,h),Zo(Xe(ui,this),0),vc(o,void 0,Xe(ui,this),0);const{width:v,height:y}=Xe(ui,this).getRealPixelSize();return zne(n,0,v,y),Xe(ui,this).perspectivePage(n)}rotate(n,o){const h=`${$a}.rotate`;return Xe(To,this).rotate(Xe(ui,this),n,o,h)}saveOperations(){return Xe(To,this).saveOperation(Xe(ui,this))}goToPage(n){const o=`${$a}.goToPage`;return Xe(To,this).gotoPage(Xe(ui,this),n,o)}indexToUid(n){const o=`${$a}.indexToUid`;return Xe(To,this).indexToUid(Xe(ui,this),n,o)}uidToIndex(n){const o=`${$a}.uidToIndex`;return Xe(To,this).uidToIndex(Xe(ui,this),n,o)}getCurrentPageUid(){return Xe(To,this).getCurrentPageUid(Xe(ui,this))}getCurrentPageIndex(){return Xe(To,this).getCurrentPageIndex(Xe(ui,this))}getPageCount(){return Xe(To,this).getPageCount(Xe(ui,this))}on(n,o){Xe(To,this).on(Xe(ui,this),`${$a}.on`,n,o)}off(n,o){Xe(To,this).off(Xe(ui,this),`${$a}.off`,n,o)}destroy(){Xe(To,this).destroy(Xe(ui,this))}},get lastError(){return rt.getLastError()},clearLastError(){rt.lastError=void 0},Experiments:{get(p,n){switch(p){case"WasmEnv":return vn;case"ImageProcess":return new hAe;case"FileParser.Options":return Ur.getFileParserDefaultOptions(n);default:return}},set(p,n){switch(p){case"FileParser.Options":return Ur.setFileParserDefaultOptions(n.type,n.options);case"ClearExternalHandler":return Ur.clearExternalHandler(n.type);default:return}}},addFonts:p=>Fe(function*(){const n="DDV.addFonts";if(!xn(p,2,n,"fonts")&&!function(o,h,v,y,_){const b=mt.formatError({isValid:Di(o)});if(b)return mt.output(2,v,y,void 0,b);const w=[];return o.forEach((I,A)=>{const M=mt.formatDetails(bn("Array","font",`[${A}]`,!0),pl(I));w.push(...M)}),!!w.length&&mt.output(2,v,y,w)}(p,0,n,"fonts"))try{for(let o=0;o<p.length;o++){const h=p[o],v=new PQ,y=yield v.getFontInfo(h).catch(_=>{throw v.terminate(),_});v.terminate();for(let _=0;_<y.fontInfo.length;_++){const b=y.fontInfo[_];c8.includes(b.family)||new FontFace(b.family,y.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then(I=>{document.fonts.add(I),c8.push(b.family),Ur.getViewers().forEach(A=>{A.addFontToUi(b.family),A.context.render()})}),i2.addPdfFont(`${b.family}${b.isBold?"Blob":""}${b.isItalic?"Italic":""}`,y.srcBuffer)}}}catch(o){return rt.reject(rt.PARAM_INVALID,n,"fonts")}})(),getDefaultUiConfig(p,n){const o="DDV.getDefaultUiConfig",h="viewerType";if(xn(p,1,h,o)||!lr(p,1,o,h)||!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(p)&&!mt.output(1,"DDV.getDefaultUiConfig","viewerType",void 0,rt.PARAM_NOT_SUPPORT))return null;let v=null;return rr()?(v={editViewer:XL,perspectiveViewer:mne,captureViewer:gne,browseViewer:RD}[p],"editViewer"===p&&null!=n&&n.includeAnnotationSet&&(v=_ne)):(v={editViewer:$L,perspectiveViewer:yne,captureViewer:vne,browseViewer:RD}[p],"editViewer"===p&&null!=n&&n.includeAnnotationSet&&(v=qL)),pn(v)},setProcessingHandler(p,n){const o="DDV.setProcessingHandler",v="handler";switch(xn(p,0,o,"type"),xn(n,0,o,v),function(_,b,w,I){const A=mt.formatError(_o.isHandlerTypeValid(_));A&&mt.output(0,"DDV.setProcessingHandler","type",void 0,A)}(p),p){case"documentBoundariesDetect":("function"!=typeof(y=n).detect||"function"!=typeof y.destroy)&&mt.error(o,v);break;case"imageFilter":"function"==typeof(_=n).querySupported&&"defaultFilterType"in _&&"function"==typeof _.applyFilter&&"function"==typeof _.destroy||mt.error(o,v)}var _,y;try{switch(p){case"documentBoundariesDetect":Ur.setDetectHandler(p,n);break;case"imageFilter":Ur.setImageFilterHandler(n)}}catch(_){rt.throw(_,o)}},setFileParser(p,n){Ur.setFileParser(p,n)},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=cie,this.Core.license="",Ur.unload(),Ur.onUnload.emit(),Nne.clear()},on(p,n){const o="DDV.on";if(xn(p,1,o,"eventName")||xn(n,1,o,"listener")||!lr(p,1,o,"eventName",!1)||!cf(n,o,"listener",1))return;const h={error:"error",warning:"warning",verbose:"verbose"}[p];h?rt.on(h,n):rt.throw(rt.PARAM_NOT_SUPPORT,o,"eventName")},off(p,n){const o="DDV.off";if(xn(p,1,o,"eventName")||!lr(p,1,o,"eventName",!1)||!gt(n)&&!cf(n,o,"listener",1))return;const h={error:"error",warning:"warning",verbose:"verbose"}[p];h?rt.off(h,n):rt.throw(rt.PARAM_NOT_SUPPORT,o,"eventName")},EnumImageDataType:Er,EnumConvertMode:ml,EnumDocumentDetectionStatus:Ha,EnumImageFilterType:l8,EnumPDFCompressionType:xp,EnumPDFPageType:No,EnumTIFFCompressionType:bp,EnumStampIcon:Ri,EnumLineEnding:ha,EnumAnnotationRenderMode:Jh,annotationManager:Wne};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=Lp;var Ee,id=self||window||{};(function(p){p.DWT||(p.DWT={}),p.DWT.LTS||(p.DWT.LTS={}),p.Lib||(p.Lib={}),p.Lib.UI||(p.Lib.UI={}),p.Lib.html5||(p.Lib.html5={}),id.Dynamsoft=p})(Ee=id.Dynamsoft||{}),function(p){if(!p.WeakSet){let _=function(b){this.name="__st"+(1e9*Math.random()>>>0)+n+++"__",b&&b.forEach&&b.forEach(this.add,this)};p.WeakSet=_;var n=Date.now()%1e9,o=_.prototype;o.add=function(b){var w=this.name;return b[w]||Object.defineProperty(b,w,{value:!0,writable:!0}),this},o.delete=function(b){return!!b[this.name]&&(b[this.name]=void 0,!0)},o.has=function(b){return!!b[this.name]}}if(!p.WeakMap){let _=function(b){return Object(b)===b};var h=Object.prototype.hasOwnProperty,v=Object.defineProperty&&function(){try{return 1===Object.defineProperty({},"x",{value:1}).x}catch(b){}}(),y=function(b,w,I){v?Object.defineProperty(b,w,{configurable:!0,writable:!0,value:I}):b[w]=I};p.WeakMap=function(){function b(){if(void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(y(this,"_id",I("_WeakMap")),arguments.length>0)throw new TypeError("WeakMap iterable is not supported")}function w(M,F){if(!_(M)||!h.call(M,"_id"))throw new TypeError(F+" method called on incompatible receiver "+typeof M)}function I(M){return M+"_"+A()+"."+A()}function A(){return Math.random().toString().substring(2)}return y(b.prototype,"delete",function(M){if(w(this,"delete"),!_(M))return!1;var F=M[this._id];return!(!F||F[0]!==M||(delete M[this._id],0))}),y(b.prototype,"get",function(M){if(w(this,"get"),_(M)){var F=M[this._id];if(F&&F[0]===M)return F[1]}}),y(b.prototype,"has",function(M){if(w(this,"has"),!_(M))return!1;var F=M[this._id];return!(!F||F[0]!==M)}),y(b.prototype,"set",function(M,F){if(w(this,"set"),!_(M))throw new TypeError("Invalid value used as weak map key");var V=M[this._id];return V&&V[0]===M?(V[1]=F,this):(y(M,this._id,[M,F]),this)}),y(b,"_polyfill",!0),b}()}}(void 0!==id?id:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0),!Ee.Lib.jsinited&&(Ee.Lib.jsinited=1,function(p){if("object"==typeof exports)module.exports=p();else if("function"==typeof define&&define.amd)define(p);else{var n;try{n=window}catch(o){n=self}n.SparkMD5=p()}}(function(p){var o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function v(Z,re){var se=Z[0],ce=Z[1],pe=Z[2],Ce=Z[3];ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&pe|~ce&Ce)+re[0]-680876936|0)<<7|se>>>25)+ce|0)&ce|~se&pe)+re[1]-389564586|0)<<12|Ce>>>20)+se|0)&se|~Ce&ce)+re[2]+606105819|0)<<17|pe>>>15)+Ce|0)&Ce|~pe&se)+re[3]-1044525330|0)<<22|ce>>>10)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&pe|~ce&Ce)+re[4]-176418897|0)<<7|se>>>25)+ce|0)&ce|~se&pe)+re[5]+1200080426|0)<<12|Ce>>>20)+se|0)&se|~Ce&ce)+re[6]-1473231341|0)<<17|pe>>>15)+Ce|0)&Ce|~pe&se)+re[7]-45705983|0)<<22|ce>>>10)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&pe|~ce&Ce)+re[8]+1770035416|0)<<7|se>>>25)+ce|0)&ce|~se&pe)+re[9]-1958414417|0)<<12|Ce>>>20)+se|0)&se|~Ce&ce)+re[10]-42063|0)<<17|pe>>>15)+Ce|0)&Ce|~pe&se)+re[11]-1990404162|0)<<22|ce>>>10)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&pe|~ce&Ce)+re[12]+1804603682|0)<<7|se>>>25)+ce|0)&ce|~se&pe)+re[13]-40341101|0)<<12|Ce>>>20)+se|0)&se|~Ce&ce)+re[14]-1502002290|0)<<17|pe>>>15)+Ce|0)&Ce|~pe&se)+re[15]+1236535329|0)<<22|ce>>>10)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&Ce|pe&~Ce)+re[1]-165796510|0)<<5|se>>>27)+ce|0)&pe|ce&~pe)+re[6]-1069501632|0)<<9|Ce>>>23)+se|0)&ce|se&~ce)+re[11]+643717713|0)<<14|pe>>>18)+Ce|0)&se|Ce&~se)+re[0]-373897302|0)<<20|ce>>>12)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&Ce|pe&~Ce)+re[5]-701558691|0)<<5|se>>>27)+ce|0)&pe|ce&~pe)+re[10]+38016083|0)<<9|Ce>>>23)+se|0)&ce|se&~ce)+re[15]-660478335|0)<<14|pe>>>18)+Ce|0)&se|Ce&~se)+re[4]-405537848|0)<<20|ce>>>12)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&Ce|pe&~Ce)+re[9]+568446438|0)<<5|se>>>27)+ce|0)&pe|ce&~pe)+re[14]-1019803690|0)<<9|Ce>>>23)+se|0)&ce|se&~ce)+re[3]-187363961|0)<<14|pe>>>18)+Ce|0)&se|Ce&~se)+re[8]+1163531501|0)<<20|ce>>>12)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce&Ce|pe&~Ce)+re[13]-1444681467|0)<<5|se>>>27)+ce|0)&pe|ce&~pe)+re[2]-51403784|0)<<9|Ce>>>23)+se|0)&ce|se&~ce)+re[7]+1735328473|0)<<14|pe>>>18)+Ce|0)&se|Ce&~se)+re[12]-1926607734|0)<<20|ce>>>12)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce^pe^Ce)+re[5]-378558|0)<<4|se>>>28)+ce|0)^ce^pe)+re[8]-2022574463|0)<<11|Ce>>>21)+se|0)^se^ce)+re[11]+1839030562|0)<<16|pe>>>16)+Ce|0)^Ce^se)+re[14]-35309556|0)<<23|ce>>>9)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce^pe^Ce)+re[1]-1530992060|0)<<4|se>>>28)+ce|0)^ce^pe)+re[4]+1272893353|0)<<11|Ce>>>21)+se|0)^se^ce)+re[7]-155497632|0)<<16|pe>>>16)+Ce|0)^Ce^se)+re[10]-1094730640|0)<<23|ce>>>9)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce^pe^Ce)+re[13]+681279174|0)<<4|se>>>28)+ce|0)^ce^pe)+re[0]-358537222|0)<<11|Ce>>>21)+se|0)^se^ce)+re[3]-722521979|0)<<16|pe>>>16)+Ce|0)^Ce^se)+re[6]+76029189|0)<<23|ce>>>9)+pe|0,ce=((ce+=((pe=((pe+=((Ce=((Ce+=((se=((se+=(ce^pe^Ce)+re[9]-640364487|0)<<4|se>>>28)+ce|0)^ce^pe)+re[12]-421815835|0)<<11|Ce>>>21)+se|0)^se^ce)+re[15]+530742520|0)<<16|pe>>>16)+Ce|0)^Ce^se)+re[2]-995338651|0)<<23|ce>>>9)+pe|0,ce=((ce+=((Ce=((Ce+=(ce^((se=((se+=(pe^(ce|~Ce))+re[0]-198630844|0)<<6|se>>>26)+ce|0)|~pe))+re[7]+1126891415|0)<<10|Ce>>>22)+se|0)^((pe=((pe+=(se^(Ce|~ce))+re[14]-1416354905|0)<<15|pe>>>17)+Ce|0)|~se))+re[5]-57434055|0)<<21|ce>>>11)+pe|0,ce=((ce+=((Ce=((Ce+=(ce^((se=((se+=(pe^(ce|~Ce))+re[12]+1700485571|0)<<6|se>>>26)+ce|0)|~pe))+re[3]-1894986606|0)<<10|Ce>>>22)+se|0)^((pe=((pe+=(se^(Ce|~ce))+re[10]-1051523|0)<<15|pe>>>17)+Ce|0)|~se))+re[1]-2054922799|0)<<21|ce>>>11)+pe|0,ce=((ce+=((Ce=((Ce+=(ce^((se=((se+=(pe^(ce|~Ce))+re[8]+1873313359|0)<<6|se>>>26)+ce|0)|~pe))+re[15]-30611744|0)<<10|Ce>>>22)+se|0)^((pe=((pe+=(se^(Ce|~ce))+re[6]-1560198380|0)<<15|pe>>>17)+Ce|0)|~se))+re[13]+1309151649|0)<<21|ce>>>11)+pe|0,ce=((ce+=((Ce=((Ce+=(ce^((se=((se+=(pe^(ce|~Ce))+re[4]-145523070|0)<<6|se>>>26)+ce|0)|~pe))+re[11]-1120210379|0)<<10|Ce>>>22)+se|0)^((pe=((pe+=(se^(Ce|~ce))+re[2]+718787259|0)<<15|pe>>>17)+Ce|0)|~se))+re[9]-343485551|0)<<21|ce>>>11)+pe|0,Z[0]=se+Z[0]|0,Z[1]=ce+Z[1]|0,Z[2]=pe+Z[2]|0,Z[3]=Ce+Z[3]|0}function y(Z){var se,re=[];for(se=0;se<64;se+=4)re[se>>2]=Z.charCodeAt(se)+(Z.charCodeAt(se+1)<<8)+(Z.charCodeAt(se+2)<<16)+(Z.charCodeAt(se+3)<<24);return re}function _(Z){var se,re=[];for(se=0;se<64;se+=4)re[se>>2]=Z[se]+(Z[se+1]<<8)+(Z[se+2]<<16)+(Z[se+3]<<24);return re}function b(Z){var ce,pe,Ce,Ve,te,Me,re=Z.length,se=[1732584193,-271733879,-1732584194,271733878];for(ce=64;ce<=re;ce+=64)v(se,y(Z.substring(ce-64,ce)));for(pe=(Z=Z.substring(ce-64)).length,Ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ce=0;ce<pe;ce+=1)Ce[ce>>2]|=Z.charCodeAt(ce)<<(ce%4<<3);if(Ce[ce>>2]|=128<<(ce%4<<3),ce>55)for(v(se,Ce),ce=0;ce<16;ce+=1)Ce[ce]=0;return Ve=(Ve=8*re).toString(16).match(/(.*?)(.{0,8})$/),te=parseInt(Ve[2],16),Me=parseInt(Ve[1],16)||0,Ce[14]=te,Ce[15]=Me,v(se,Ce),se}function I(Z){var se,re="";for(se=0;se<4;se+=1)re+=o[Z>>8*se+4&15]+o[Z>>8*se&15];return re}function A(Z){var re;for(re=0;re<Z.length;re+=1)Z[re]=I(Z[re]);return Z.join("")}function M(Z){return/[\u0080-\uFFFF]/.test(Z)&&(Z=unescape(encodeURIComponent(Z))),Z}function Q(Z){var ce,re=[],se=Z.length;for(ce=0;ce<se-1;ce+=2)re.push(parseInt(Z.substr(ce,2),16));return String.fromCharCode.apply(String,re)}function J(){this.reset()}return A(b("hello")),"undefined"!=typeof ArrayBuffer&&!ArrayBuffer.prototype.slice&&function(){function Z(re,se){return(re=0|re||0)<0?Math.max(re+se,0):Math.min(re,se)}ArrayBuffer.prototype.slice=function(re,se){var Ve,te,Me,we,ce=this.byteLength,pe=Z(re,ce),Ce=ce;return se!==p&&(Ce=Z(se,ce)),pe>Ce?new ArrayBuffer(0):(Ve=Ce-pe,te=new ArrayBuffer(Ve),Me=new Uint8Array(te),we=new Uint8Array(this,pe,Ve),Me.set(we),te)}}(),J.prototype.append=function(Z){return this.appendBinary(M(Z)),this},J.prototype.appendBinary=function(Z){this._buff+=Z,this._length+=Z.length;var se,re=this._buff.length;for(se=64;se<=re;se+=64)v(this._hash,y(this._buff.substring(se-64,se)));return this._buff=this._buff.substring(se-64),this},J.prototype.end=function(Z){var ce,Ce,re=this._buff,se=re.length,pe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(ce=0;ce<se;ce+=1)pe[ce>>2]|=re.charCodeAt(ce)<<(ce%4<<3);return this._finish(pe,se),Ce=A(this._hash),Z&&(Ce=Q(Ce)),this.reset(),Ce},J.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},J.prototype.setState=function(Z){return this._buff=Z.buff,this._length=Z.length,this._hash=Z.hash,this},J.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},J.prototype._finish=function(Z,re){var ce,pe,Ce,se=re;if(Z[se>>2]|=128<<(se%4<<3),se>55)for(v(this._hash,Z),se=0;se<16;se+=1)Z[se]=0;ce=(ce=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),pe=parseInt(ce[2],16),Ce=parseInt(ce[1],16)||0,Z[14]=pe,Z[15]=Ce,v(this._hash,Z)},J.hash=function(Z,re){return J.hashBinary(M(Z),re)},J.hashBinary=function(Z,re){var ce=A(b(Z));return re?Q(ce):ce},(J.ArrayBuffer=function(){this.reset()}).prototype.append=function(Z){var ce,re=function B(Z,re,se){var ce=new Uint8Array(Z.byteLength+re.byteLength);return ce.set(new Uint8Array(Z)),ce.set(new Uint8Array(re),Z.byteLength),se?ce:ce.buffer}(this._buff.buffer,Z,!0),se=re.length;for(this._length+=Z.byteLength,ce=64;ce<=se;ce+=64)v(this._hash,_(re.subarray(ce-64,ce)));return this._buff=ce-64<se?new Uint8Array(re.buffer.slice(ce-64)):new Uint8Array(0),this},J.ArrayBuffer.prototype.end=function(Z){var pe,Ce,re=this._buff,se=re.length,ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(pe=0;pe<se;pe+=1)ce[pe>>2]|=re[pe]<<(pe%4<<3);return this._finish(ce,se),Ce=A(this._hash),Z&&(Ce=Q(Ce)),this.reset(),Ce},J.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},J.ArrayBuffer.prototype.getState=function(){var Z=J.prototype.getState.call(this);return Z.buff=function V(Z){return String.fromCharCode.apply(null,new Uint8Array(Z))}(Z.buff),Z},J.ArrayBuffer.prototype.setState=function(Z){return Z.buff=function F(Z,re){var Ce,se=Z.length,ce=new ArrayBuffer(se),pe=new Uint8Array(ce);for(Ce=0;Ce<se;Ce+=1)pe[Ce]=Z.charCodeAt(Ce);return re?pe:ce}(Z.buff,!0),J.prototype.setState.call(this,Z)},J.ArrayBuffer.prototype.destroy=J.prototype.destroy,J.ArrayBuffer.prototype._finish=J.prototype._finish,J.ArrayBuffer.hash=function(Z,re){var se=function w(Z){var ce,pe,Ce,Ve,te,Me,re=Z.length,se=[1732584193,-271733879,-1732584194,271733878];for(ce=64;ce<=re;ce+=64)v(se,_(Z.subarray(ce-64,ce)));for(pe=(Z=ce-64<re?Z.subarray(ce-64):new Uint8Array(0)).length,Ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ce=0;ce<pe;ce+=1)Ce[ce>>2]|=Z[ce]<<(ce%4<<3);if(Ce[ce>>2]|=128<<(ce%4<<3),ce>55)for(v(se,Ce),ce=0;ce<16;ce+=1)Ce[ce]=0;return Ve=(Ve=8*re).toString(16).match(/(.*?)(.{0,8})$/),te=parseInt(Ve[2],16),Me=parseInt(Ve[1],16)||0,Ce[14]=te,Ce[15]=Me,v(se,Ce),se}(new Uint8Array(Z)),ce=A(se);return re?Q(ce):ce},J}),function(){function p(C){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(x){return typeof x}:function(x){return x&&"function"==typeof Symbol&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x})(C)}function n(C,x){if(!(C instanceof x))throw new TypeError("Cannot call a class as a function")}function o(C){var x=function(S,T){if("object"!==p(S)||null===S)return S;var D=S[Symbol.toPrimitive];if(void 0!==D){var R=D.call(S,"string");if("object"!==p(R))return R;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(S)}(C);return"symbol"===p(x)?x:String(x)}function h(C,x){for(var S=0;S<x.length;S++){var T=x[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(C,o(T.key),T)}}function v(C,x,S){return x&&h(C.prototype,x),S&&h(C,S),Object.defineProperty(C,"prototype",{writable:!1}),C}var y=void 0!==id?id:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function _(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var b={exports:{}},w={exports:{}};!function(C){function x(S){return C.exports=x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&"function"==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},C.exports.__esModule=!0,C.exports.default=C.exports,x(S)}C.exports=x,C.exports.__esModule=!0,C.exports.default=C.exports}(w);var I=w.exports;!function(C){var x=I.default;function S(){C.exports=S=function(){return T},C.exports.__esModule=!0,C.exports.default=C.exports;var T={},D=Object.prototype,R=D.hasOwnProperty,P=Object.defineProperty||function(Be,$e,ze){Be[$e]=ze.value},O="function"==typeof Symbol?Symbol:{},U=O.iterator||"@@iterator",G=O.asyncIterator||"@@asyncIterator",X=O.toStringTag||"@@toStringTag";function z(Be,$e,ze){return Object.defineProperty(Be,$e,{value:ze,enumerable:!0,configurable:!0,writable:!0}),Be[$e]}try{z({},"")}catch(Be){z=function($e,ze,Ct){return $e[ze]=Ct}}function K(Be,$e,ze,Ct){var Vt=Object.create(($e&&$e.prototype instanceof ue?$e:ue).prototype),In=new Te(Ct||[]);return P(Vt,"_invoke",{value:de(Be,ze,In)}),Vt}function oe(Be,$e,ze){try{return{type:"normal",arg:Be.call($e,ze)}}catch(Ct){return{type:"throw",arg:Ct}}}T.wrap=K;var ae={};function ue(){}function ye(){}function Ie(){}var Ue={};z(Ue,U,function(){return this});var He=Object.getPrototypeOf,Re=He&&He(He(We([])));Re&&Re!==D&&R.call(Re,U)&&(Ue=Re);var Oe=Ie.prototype=ue.prototype=Object.create(Ue);function Ge(Be){["next","throw","return"].forEach(function($e){z(Be,$e,function(ze){return this._invoke($e,ze)})})}function Se(Be,$e){function ze(bt,Vt,In,yn){var xt=oe(Be[bt],Be,Vt);if("throw"!==xt.type){var Pt=xt.arg,It=Pt.value;return It&&"object"==x(It)&&R.call(It,"__await")?$e.resolve(It.__await).then(function(Wt){ze("next",Wt,In,yn)},function(Wt){ze("throw",Wt,In,yn)}):$e.resolve(It).then(function(Wt){Pt.value=Wt,In(Pt)},function(Wt){return ze("throw",Wt,In,yn)})}yn(xt.arg)}var Ct;P(this,"_invoke",{value:function(bt,Vt){function In(){return new $e(function(yn,xt){ze(bt,Vt,yn,xt)})}return Ct=Ct?Ct.then(In,In):In()}})}function de(Be,$e,ze){var Ct="suspendedStart";return function(bt,Vt){if("executing"===Ct)throw new Error("Generator is already running");if("completed"===Ct){if("throw"===bt)throw Vt;return{value:void 0,done:!0}}for(ze.method=bt,ze.arg=Vt;;){var In=ze.delegate;if(In){var yn=ge(In,ze);if(yn){if(yn===ae)continue;return yn}}if("next"===ze.method)ze.sent=ze._sent=ze.arg;else if("throw"===ze.method){if("suspendedStart"===Ct)throw Ct="completed",ze.arg;ze.dispatchException(ze.arg)}else"return"===ze.method&&ze.abrupt("return",ze.arg);Ct="executing";var xt=oe(Be,$e,ze);if("normal"===xt.type){if(Ct=ze.done?"completed":"suspendedYield",xt.arg===ae)continue;return{value:xt.arg,done:ze.done}}"throw"===xt.type&&(Ct="completed",ze.method="throw",ze.arg=xt.arg)}}}function ge(Be,$e){var ze=$e.method,Ct=Be.iterator[ze];if(void 0===Ct)return $e.delegate=null,"throw"===ze&&Be.iterator.return&&($e.method="return",$e.arg=void 0,ge(Be,$e),"throw"===$e.method)||"return"!==ze&&($e.method="throw",$e.arg=new TypeError("The iterator does not provide a '"+ze+"' method")),ae;var bt=oe(Ct,Be.iterator,$e.arg);if("throw"===bt.type)return $e.method="throw",$e.arg=bt.arg,$e.delegate=null,ae;var Vt=bt.arg;return Vt?Vt.done?($e[Be.resultName]=Vt.value,$e.next=Be.nextLoc,"return"!==$e.method&&($e.method="next",$e.arg=void 0),$e.delegate=null,ae):Vt:($e.method="throw",$e.arg=new TypeError("iterator result is not an object"),$e.delegate=null,ae)}function _e(Be){var $e={tryLoc:Be[0]};1 in Be&&($e.catchLoc=Be[1]),2 in Be&&($e.finallyLoc=Be[2],$e.afterLoc=Be[3]),this.tryEntries.push($e)}function ve(Be){var $e=Be.completion||{};$e.type="normal",delete $e.arg,Be.completion=$e}function Te(Be){this.tryEntries=[{tryLoc:"root"}],Be.forEach(_e,this),this.reset(!0)}function We(Be){if(Be){var $e=Be[U];if($e)return $e.call(Be);if("function"==typeof Be.next)return Be;if(!isNaN(Be.length)){var ze=-1,Ct=function bt(){for(;++ze<Be.length;)if(R.call(Be,ze))return bt.value=Be[ze],bt.done=!1,bt;return bt.value=void 0,bt.done=!0,bt};return Ct.next=Ct}}return{next:Ye}}function Ye(){return{value:void 0,done:!0}}return ye.prototype=Ie,P(Oe,"constructor",{value:Ie,configurable:!0}),P(Ie,"constructor",{value:ye,configurable:!0}),ye.displayName=z(Ie,X,"GeneratorFunction"),T.isGeneratorFunction=function(Be){var $e="function"==typeof Be&&Be.constructor;return!!$e&&($e===ye||"GeneratorFunction"===($e.displayName||$e.name))},T.mark=function(Be){return Object.setPrototypeOf?Object.setPrototypeOf(Be,Ie):(Be.__proto__=Ie,z(Be,X,"GeneratorFunction")),Be.prototype=Object.create(Oe),Be},T.awrap=function(Be){return{__await:Be}},Ge(Se.prototype),z(Se.prototype,G,function(){return this}),T.AsyncIterator=Se,T.async=function(Be,$e,ze,Ct,bt){void 0===bt&&(bt=Promise);var Vt=new Se(K(Be,$e,ze,Ct),bt);return T.isGeneratorFunction($e)?Vt:Vt.next().then(function(In){return In.done?In.value:Vt.next()})},Ge(Oe),z(Oe,X,"Generator"),z(Oe,U,function(){return this}),z(Oe,"toString",function(){return"[object Generator]"}),T.keys=function(Be){var $e=Object(Be),ze=[];for(var Ct in $e)ze.push(Ct);return ze.reverse(),function bt(){for(;ze.length;){var Vt=ze.pop();if(Vt in $e)return bt.value=Vt,bt.done=!1,bt}return bt.done=!0,bt}},T.values=We,Te.prototype={constructor:Te,reset:function(Be){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(ve),!Be)for(var $e in this)"t"===$e.charAt(0)&&R.call(this,$e)&&!isNaN(+$e.slice(1))&&(this[$e]=void 0)},stop:function(){this.done=!0;var Be=this.tryEntries[0].completion;if("throw"===Be.type)throw Be.arg;return this.rval},dispatchException:function(Be){if(this.done)throw Be;var $e=this;function ze(xt,Pt){return Vt.type="throw",Vt.arg=Be,$e.next=xt,Pt&&($e.method="next",$e.arg=void 0),!!Pt}for(var Ct=this.tryEntries.length-1;Ct>=0;--Ct){var bt=this.tryEntries[Ct],Vt=bt.completion;if("root"===bt.tryLoc)return ze("end");if(bt.tryLoc<=this.prev){var In=R.call(bt,"catchLoc"),yn=R.call(bt,"finallyLoc");if(In&&yn){if(this.prev<bt.catchLoc)return ze(bt.catchLoc,!0);if(this.prev<bt.finallyLoc)return ze(bt.finallyLoc)}else if(In){if(this.prev<bt.catchLoc)return ze(bt.catchLoc,!0)}else{if(!yn)throw new Error("try statement without catch or finally");if(this.prev<bt.finallyLoc)return ze(bt.finallyLoc)}}}},abrupt:function(Be,$e){for(var ze=this.tryEntries.length-1;ze>=0;--ze){var Ct=this.tryEntries[ze];if(Ct.tryLoc<=this.prev&&R.call(Ct,"finallyLoc")&&this.prev<Ct.finallyLoc){var bt=Ct;break}}bt&&("break"===Be||"continue"===Be)&&bt.tryLoc<=$e&&$e<=bt.finallyLoc&&(bt=null);var Vt=bt?bt.completion:{};return Vt.type=Be,Vt.arg=$e,bt?(this.method="next",this.next=bt.finallyLoc,ae):this.complete(Vt)},complete:function(Be,$e){if("throw"===Be.type)throw Be.arg;return"break"===Be.type||"continue"===Be.type?this.next=Be.arg:"return"===Be.type?(this.rval=this.arg=Be.arg,this.method="return",this.next="end"):"normal"===Be.type&&$e&&(this.next=$e),ae},finish:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var ze=this.tryEntries[$e];if(ze.finallyLoc===Be)return this.complete(ze.completion,ze.afterLoc),ve(ze),ae}},catch:function(Be){for(var $e=this.tryEntries.length-1;$e>=0;--$e){var ze=this.tryEntries[$e];if(ze.tryLoc===Be){var Ct=ze.completion;if("throw"===Ct.type){var bt=Ct.arg;ve(ze)}return bt}}throw new Error("illegal catch attempt")},delegateYield:function(Be,$e,ze){return this.delegate={iterator:We(Be),resultName:$e,nextLoc:ze},"next"===this.method&&(this.arg=void 0),ae}},T}C.exports=S,C.exports.__esModule=!0,C.exports.default=C.exports}(b);var A=(0,b.exports)(),M=A;try{regeneratorRuntime=A}catch(C){"object"==typeof id?id.regeneratorRuntime=A:Function("r","regeneratorRuntime = r")(A)}var F,V,B=_(M);function Q(C){var x=C?new Date(C):new Date,S="yyyy-MM-dd HH:mm:ss.SSSZ",T={"M+":x.getUTCMonth()+1,"d+":x.getUTCDate(),"H+":x.getUTCHours(),"h+":x.getUTCHours()%12||12,"m+":x.getUTCMinutes(),"s+":x.getUTCSeconds(),"q+":Math.floor((x.getUTCMonth()+3)/3),"S+":x.getUTCMilliseconds()};for(var D in/(y+)/.test(S)&&(S=S.replace(RegExp.$1,(x.getUTCFullYear()+"").substr(4-RegExp.$1.length))),T)new RegExp("("+D+")").test(S)&&(S=S.replace(RegExp.$1,1==RegExp.$1.length?T[D]:("000"+T[D]).substr(("000"+T[D]).length-RegExp.$1.length)));return S}function J(C){return C===V}function Z(C){return C!==V}function re(C){return null===C}F="object"===("undefined"==typeof window?"undefined":p(window))?window:{};var se={"[object Function]":"function","[object AsyncFunction]":"function","[object String]":"string","[object Object]":"object","[object Boolean]":"boolean","[object Number]":"number","[object Array]":"array"};function ce(C){return re(C)||J(C)?String(C):se[{}.toString.call(C)]||"object"}function pe(C){return"function"===ce(C)}function Ce(C){return"string"===ce(C)}function Ve(C){return"object"===ce(C)}function te(C){return"boolean"===ce(C)}function Me(C){return"number"===ce(C)}function we(C){return Array.isArray?Array.isArray(C):"array"===ce(C)}function Le(C){if(null==C)return[];if(we(C))return C;var x=p(C.length),S=p(C);if("number"!==x||C.alert||"string"===S||"function"===S&&(!("item"in C)||"number"!==x))return[C];for(var T=[],D=0,R=C.length;D<R;D++)T[D]=C[D];return T}var j,L,Y={debug:!1,showConsoleError:!1};function q(){return j}function k(C){j=C}function N(C,x,S,T){if(Y.debug&&L&&pe(L.log)){var D=Q((new Date).getTime()),R=Le(arguments);L.log(["[",D,"] ",R].join(""))}}function $(C,x,S,T){if((Y.debug||Y.showConsoleError)&&L&&pe(L.error)){var D=Q((new Date).getTime()),R=Le(arguments);L.error(["[",D,"] ",R].join(""))}}function ie(C,x,S,T){if(Y.debug&&L&&pe(L.warn)){var D=Q((new Date).getTime()),R=Le(arguments);L.warn(["[",D,"] ",R].join(""))}}function ee(C,x,S,T){if(Y.debug&&L&&pe(L.info)){var D=Q((new Date).getTime()),R=Le(arguments);L.info(["[",D,"] ",R].join(""))}}F&&Z(F.console)&&(pe((L=F.console).log)&&pe(L.error)?j={log:N,error:$,info:ee,warn:ie,debug:function(C,x,S,T){if(Y.debug&&L&&pe(L.debug)){var D=Q((new Date).getTime()),R=Le(arguments);L.debug(["[",D,"] ",R].join(""))}}}:(L=!1,j=!1));var ne={queue:[],doNextStarted:!1,timer:null,pushToDo:function(C,x,S){ne.queue.push({obj:C,method:x,args:S})},doNext:function(){if(ne.doNextStarted)if(0!=ne.queue.length){var C=ne.queue[0],x=C.obj,S=C.method,T=C.args;if(ne.queue.splice(0,1),x&&pe(x[S])){var D=!1;if(T.length>2){var R=T[T.length-2],P=T[T.length-1];pe(R)&&pe(P)&&(T[T.length-2]=function(){try{R.apply(x,arguments)}catch(O){}ne.timer=setTimeout(ne.doNext,0)},T[T.length-1]=function(){try{P.apply(x,arguments)}catch(O){}ne.timer=setTimeout(ne.doNext,0)},D=!0)}try{x[S].apply(x,T)}catch(O){}D||(ne.timer=setTimeout(ne.doNext,0))}else if(null===x&&pe(S)){try{S.apply(null,T)}catch(O){}ne.timer=setTimeout(ne.doNext,0)}else N("not invoke a function: "+S),ne.timer=setTimeout(ne.doNext,0)}else ne.stop();else ne.stop()},start:function(){ne.doNextStarted||(ne.doNextStarted=!0,ne.timer=setTimeout(ne.doNext,0))},stop:function(){clearTimeout(ne.timer),ne.timer=null,ne.doNextStarted=!1,ne.queue=[]}},le=!0,fe=!1;function xe(C,x,S){if(C){var T,D,R,P=0,O=C.length;if(S=S||null,J(O)||pe(C))for(R=Object.keys(C);P<R.length&&x.call(S,C[T=R[P]],T,C)!==fe;P++);else for(D=C[0];P<O&&x.call(S,D,P,C)!==fe;D=C[++P]);}return C}var Pe={fire:function(C){var x,S=this;S.exec=S.exec||{},C=C.toLowerCase(),x=Array.prototype.slice.call(arguments,1),xe(S.exec[C]||[],function(T){var D=T.f,R=T.c||S;try{D.apply(R,x)}catch(P){N(P)}})},on:function(C,x,S){var T=this;T.exec=T.exec||{},C=C.toLowerCase(),T.exec[C]=T.exec[C]||[],T.exec[C].push({f:x,c:S})},off:function(C,x,S){var T=this.exec;if(T)if(C)if(C=C.toLowerCase(),x)for(var D=T[C]||[],R=D.length-1;R>=0;R--)D[R]===x&&D.splice(R,1);else T[C]=null;else this.exec=null}};function De(C){return null!=C&&C==C.window}function je(C){C&&/\S/.test(C)&&(F.execScript?F.execScript(C):F.eval.call(F,C))}var ke,he,tt,Ze,nt,et=navigator,Qe=!0;if("userAgentData"in et){var at=et.userAgentData,vt=[];at.platform&&""!=at.platform&&("brands"in at&&Array.isArray(at.brands)&&at.brands.length>0?vt=at.brands:"uaList"in at&&Array.isArray(at.uaList)&&at.uaList.length>0&&(vt=at.uaList),vt.length>0&&(Qe=!1,tt=at.platform.toLowerCase(),he=function(C,x,S){var T,D,R,P,O,U,G,X,z,K=!1,oe=!1,ae=!1,ue=C.mobile,ye=!1,Ie="",Ue=navigator.maxTouchPoints||0;for(D=x.length,T=0;T<D;T++){var He=x[T].brand.toLowerCase();if(He.indexOf("chrome")>=0){ae=!0,Ie=x[T].version;break}if(He.indexOf("edge")>=0){K=!0,Ie=x[T].version;break}if(He.indexOf("opera")>=0){oe=!0,Ie=x[T].version;break}}return ae||K||oe||(ae=!0,Ie="100"),R=/windows/g.test(S),P=/mac/g.test(S),O=/linux/g.test(S),U=/android/g.test(S),G=/harmony/g.test(S),X=/(chromeos|chrome\sos)/g.test(S),z=/iphone/g.test(S),R||U||O||z||(ye=/macintel/g.test(S)&&Ue>1),(U||G||z||ye)&&(ue=!0),{bUseUserAgent:!1,bWin:R,bMac:P,bLinux:O,bAndroid:U,bHarmonyOS:G,bChromeOS:X,bIE:!1,bEdge:K,bUC:!1,bPlaybook:!1,bBlackBerry:!1,bHuaWeiBrowser:!1,bOpera:oe,bFirefox:!1,bChrome:ae,bJSDom:!1,biPhone:z,biPad:ye,bPad:U&&!C.mobile,bSafari:!1,bMobile:ue,strBrowserVersion:Ie,bHTML5Edition:!0,IEVersion:0,IEMode:0}}(at,vt,tt)))}Qe&&(Ze||(Ze=et.userAgent.toLowerCase()),nt||(nt=et.platform.toLowerCase()),he=function(C,x){var S,T=C.toLowerCase(),D=x.toLowerCase(),R=/harmonyos/g.test(T);"linux"==D&&T.indexOf("windows nt")>=0&&(D="harmonyos",R=!0);var P=!R&&/cros/.test(T),O=!R&&/android/g.test(T)||/android/g.test(D),U=/iphone/g.test(T)||/iphone/g.test(D),G=/macintosh/.test(T),X=navigator.maxTouchPoints||0,z=/ipad/g.test(T)||(G||"macintel"==D)&&X>1,K=/ucweb|ucbrowser/g.test(T),oe=!K&&/nexus/g.test(T)&&/version\/[\d.]+.*safari\//g.test(T),ae=/playbook/g.test(T),ue=/hp-tablet/g.test(T),ye=/blackberry|bb10/g.test(T),Ie=/symbian/g.test(T),Ue=/windows phone/g.test(T),He=/mobile/g.test(T),Re=/arm64|aarch64/g.test(T),Oe=/mips64/g.test(T),Ge=/huaweibrowser/g.test(T),Se=/jsdom/g.test(T),de=ae||z||ue,ge=!de&&!P&&(U||oe||ye||Ie||Ue||O||R||He),_e=!ge&&!de&&!P,ve=_e&&/win32|win64|windows/.test(D),Te=ve&&/win64|x64/.test(T),We=_e&&/mac68k|macppc|macintosh|macintel/.test(T),Ye=_e&&/linux/.test(D),Be="win64"==D||/wow64|x86_64|win64|x64/.test(T)||Re||Oe,$e=/wow64/g.test(T),ze=fe,Ct=/opera|opr/g.test(T),bt=/360se/g.test(T),Vt=/maxthon/g.test(T),In=/tencenttraveler|qqbrowser/g.test(T),yn=/the world/g.test(T),xt=/metasr/g.test(T),Pt=/avant/g.test(T),It=/firefox|fxios/g.test(T),Wt=/gecko/g.test(T),en=!(It||Ge)&&/edge\/|edga\/|edgios\/|edg\//g.test(T),Cn=!(ye||ae||K||Ct||en||Ge||Se)&&/chrome|crios/g.test(T),hn=!1,Dr="",Hn=0,di=0,Gt="";if(ve&&!en&&!It&&!Cn){var Ss=T.indexOf("msie "),og=T.indexOf("trident"),Ar=T.indexOf("rv:");hn=-1!=Ss||-1!=og||-1!=Ar}if(!(We||U||z||ve||ye||ae||oe)||K||Ct||en||hn||It||(S=T.match(/version\/([\d.]+).*safari\//))&&(ye||ae||oe||(ze=le,Cn=fe),Gt=S[1]),en){var Mr=T.indexOf("edge/");Mr>-1?Mr+=5:(Mr=T.indexOf("edg/"))>-1?Mr+=4:(Mr=T.indexOf("edga/"))>-1?Mr+=5:(Mr=T.indexOf("edgios/"))>-1&&(Mr+=7),Mr>-1&&(S=(Gt=T.slice(Mr)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S))}else if(It)if((S=T.indexOf("firefox/"))>-1){var Ho=(S=T.slice(S+8)).indexOf(" ");Ho>-1&&(S=S.slice(0,Ho)),Gt=S,(Ho=S.indexOf("."))>-1&&(S=Gt.slice(0,Ho))}else(U||z)&&(S=T.indexOf("fxios/"))>-1&&(Gt=S=(S=T.slice(S+6)).slice(0,S.indexOf(" ")));else if(hn){var Vm=T.indexOf("msie "),il=T.indexOf("trident"),Il=T.indexOf("rv:");-1!=Vm?Dr=S=(S=T.slice(Vm+5)).slice(0,S.indexOf(";")):-1!=Il?Dr=S=(S=(S=T.slice(Il+3)).slice(0,S.indexOf(";"))).slice(0,S.indexOf(")")):-1!=il&&(Dr=S=(S=T.slice(il+7)).slice(0,S.indexOf(";"))),Gt=S}else if(ze)(S=Gt.indexOf("."))>-1&&(S=Gt.slice(0,S));else if(K)(S=T.indexOf("ucweb"))>-1?Gt=T.slice(S+5):(S=T.indexOf("ucbrowser/"))>-1&&(S=(Gt=T.slice(S+10)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S));else if(Ct)(S=T.indexOf("version/"))>-1?Gt=T.slice(S+8):(S=T.indexOf("opr/"))>-1&&(Gt=T.slice(S+4));else if(Ie)(S=T.indexOf("browserng/"))>-1&&(Gt=T.slice(S+10));else if(Ue)(S=T.indexOf("iemobile/"))>-1&&(Gt=T.slice(S+9));else if(Cn){var Da=T.indexOf("chrome/");Da>-1?(S=(Gt=T.slice(Da+7)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S)):(Da=T.indexOf("crios/"))>-1&&(S=(Gt=T.slice(Da+6)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S)),(S=Gt.indexOf("."))>-1&&(S=Gt.slice(0,S))}else if(Ge){var wd=T.indexOf("huaweibrowser");wd>-1&&(S=(Gt=T.slice(wd+14)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S))}else if(Se){var Ts=T.indexOf("jsdom");Ts>-1&&(S=(Gt=T.slice(Ts+6)).indexOf(" "))>-1&&(Gt=Gt.slice(0,S))}if(en||hn){var Aa=window.document;Aa&&Aa.documentMode?Hn=Aa.documentMode:(Hn=5,Aa.compatMode&&"CSS1Compat"==Aa.compatMode&&(Hn=7)),hn&&(di=parseInt(Gt))}(We||Ye)&&(Be=!0,We&&(S=T.match(/mac os x (\d+)(_|\.)(\d+)/))&&S.length>3&&(10==S[1]&&S[3]<14||S[1]<10)&&(Be=!1)),ve||We||Ye||Re||Oe||(ge=!0);var Go=!0;if(hn)if(""===Dr||parseInt(Dr)>=10){var Sd=F.Dynamsoft;Sd&&Sd.DWT&&Sd.DWT.IfUseActiveXForIE10Plus&&(Go=fe)}else Go=fe;return{bUseUserAgent:!0,bWin:ve,bMac:We,bLinux:Ye,bMobile:ge,bPad:de,bChromeOS:P,bHarmonyOS:R,bArm64:Re,bMips64:Oe,bEmbed:Re||Oe,bAndroid:O,biPhone:U,biPad:z,bWin64:Te,bWOW64:$e,bOSx64:Be,bIE:hn,bEdge:en,bChrome:Cn,bFirefox:It,bSafari:ze,bOpera:Ct,bNexus:oe,bUC:K,b360SE:bt,bMaxthon:Vt,bTencentTraveler:In,bTheWorld:yn,bMetaSr:xt,bAvant:Pt,bHuaWeiBrowser:Ge,bJSDom:Se,bGecko:Wt,bHTML5Edition:Go,strBrowserVersion:Gt,IEVersion:di,IEMode:Hn}}(Ze,nt));var dt=null===(ke=null==document?void 0:document.location)||void 0===ke?void 0:ke.protocol;function Je(C){return he.bGecko&&"mousewheel"===C?"DOMMouseScroll":C}function it(C,x,S){var T=Je(x);C&&C.addEventListener(T,S,!1)}function ct(C,x,S){var T=Je(x);C&&C.removeEventListener(T,S,!1)}function wt(C){var x=C||F.event;x.preventDefault&&x.preventDefault(),x.stopPropagation&&x.stopPropagation(),x.returnValue=!1,x.cancelBubble=!0}function ht(C,x){var S=F.document.createEvent("HTMLEvents");S.initEvent(C,le,le),x.dispatchEvent&&x.dispatchEvent(S)}dt||(dt="https:"),he.protocol=dt,he.bSSL="https:"===dt,he.bFileSystem="https:"!==dt&&"http:"!==dt;var At,kt,Bt,Ft,Ht=F.document,Kt=[],an=Kt.push,ln=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,wn=function(){kt()};function ut(C,x,S,T){var D,R,P,O=x&&x.ownerDocument,U=x?x.nodeType:9;if(S=S||[],"string"!=typeof C||!C||1!==U&&9!==U&&11!==U)return S;if(!T&&((x?x.ownerDocument||x:Ht)!==Bt&&kt(x),x=x||Bt,11!==U&&(P=ln.exec(C))))if(D=P[1]){if(9===U){if(!(R=x.getElementById(D)))return S;if(R.id===D)return S.push(R),S}else if(O&&(R=O.getElementById(D))&&Ft(x,R)&&R.id===D)return S.push(R),S}else{if(P[2])return an.apply(S,x.getElementsByTagName(C)),S;if((D=P[3])&&x.getElementsByClassName)return an.apply(S,x.getElementsByClassName(D)),S}return S}an.apply(Kt.slice.call(Ht.childNodes),Ht.childNodes),kt=ut.setDocument=function(C){var x,S=C?C.ownerDocument||C:Ht;return S!==Bt&&9===S.nodeType&&S.documentElement&&(Ht!==(Bt=S)&&(x=Bt.defaultView)&&x.top!==x&&(x.addEventListener?x.addEventListener("unload",wn,!1):x.attachEvent&&x.attachEvent("onunload",wn)),Ft=function(T,D){if(D)for(;D=D.parentNode;)if(D===T)return!0;return!1}),Bt},ut.contains=function(C,x){return(C.ownerDocument||C)!==Bt&&kt(C),Ft(C,x)},ut.error=function(C){throw new Error("Syntax error: "+C)},At=ut.getText=function(C){var x,S="",T=0,D=C.nodeType;if(D){if(1===D||9===D||11===D){if("string"==typeof C.textContent)return C.textContent;for(C=C.firstChild;C;C=C.nextSibling)S+=At(C)}else if(3===D||4===D)return C.nodeValue}else for(;x=C[T++];)S+=At(x);return S},kt();var ft={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]},Lt={UTF16ToUTF8:function(C){for(var x,S,T=[],D=C.length,R=0;R<D;R++){var P=C.charCodeAt(R);if(P>0&&P<=127)T.push(C.charAt(R));else if(P>=128&&P<=2047)x=192|P>>6&31,S=128|63&P,T.push(String.fromCharCode(x),String.fromCharCode(S));else if(P>=2048&&P<=65535){x=224|P>>12&15,S=128|P>>6&63;var O=128|63&P;T.push(String.fromCharCode(x),String.fromCharCode(S),String.fromCharCode(O))}}return T.join("")},UTF8ToUTF16:function(C){var x,S,T,D,R=[],P=C.length;for(x=0;x<P;x++)(S=C.charCodeAt(x))>>7&255?6==(S>>5&255)?(D=(31&S)<<6|63&(T=C.charCodeAt(++x)),R.push(String.fromCharCode(D))):14==(S>>4&255)&&(D=(255&(S<<4|(T=C.charCodeAt(++x))>>2&15))<<8|(3&T)<<6|63&C.charCodeAt(++x),R.push(String.fromCharCode(D))):R.push(C.charAt(x));return R.join("")},encode:function(C){for(var x,S,T,D=this.UTF16ToUTF8(C),R=[],P=0,O=D.length;P<O;){if(x=255&D.charCodeAt(P++),P==O){R.push(ft.encodeChars.charAt(x>>2)),R.push(ft.encodeChars.charAt((3&x)<<4)),R.push("==");break}if(S=D.charCodeAt(P++),P==O){R.push(ft.encodeChars.charAt(x>>2)),R.push(ft.encodeChars.charAt((3&x)<<4|(240&S)>>4)),R.push(ft.encodeChars.charAt((15&S)<<2)),R.push("=");break}T=D.charCodeAt(P++),R.push(ft.encodeChars.charAt(x>>2)),R.push(ft.encodeChars.charAt((3&x)<<4|(240&S)>>4)),R.push(ft.encodeChars.charAt((15&S)<<2|(192&T)>>6)),R.push(ft.encodeChars.charAt(63&T))}return R.join("")},encodeArray:function(C){for(var x,S,T,D=[],R=0,P=C.length;R<P;){if(x=255&C[R++],R==P){D.push(ft.encodeChars.charAt(x>>2)),D.push(ft.encodeChars.charAt((3&x)<<4)),D.push("==");break}if(S=255&C[R++],R==P){D.push(ft.encodeChars.charAt(x>>2)),D.push(ft.encodeChars.charAt((3&x)<<4|(240&S)>>4)),D.push(ft.encodeChars.charAt((15&S)<<2)),D.push("=");break}T=255&C[R++],D.push(ft.encodeChars.charAt(x>>2)),D.push(ft.encodeChars.charAt((3&x)<<4|(240&S)>>4)),D.push(ft.encodeChars.charAt((15&S)<<2|(192&T)>>6)),D.push(ft.encodeChars.charAt(63&T))}return D.join("")},decode:function(C,x){for(var S,T,D,R,P=this,O=[],U=0,G=C.length;U<G;){do{S=ft.decodeChars[255&C.charCodeAt(U++)]}while(U<G&&-1==S);if(-1==S)break;do{T=ft.decodeChars[255&C.charCodeAt(U++)]}while(U<G&&-1==T);if(-1==T)break;O.push(x?S<<2|(48&T)>>4:String.fromCharCode(S<<2|(48&T)>>4));do{if(61==(D=255&C.charCodeAt(U++)))return x?O:P.UTF8ToUTF16(O.join(""));D=ft.decodeChars[D]}while(U<G&&-1==D);if(-1==D)break;O.push(x?(15&T)<<4|(60&D)>>2:String.fromCharCode((15&T)<<4|(60&D)>>2));do{if(61==(R=255&C.charCodeAt(U++)))return x?O:P.UTF8ToUTF16(O.join(""));R=ft.decodeChars[R]}while(U<G&&-1==R);if(-1==R)break;O.push(x?(3&D)<<6|R:String.fromCharCode((3&D)<<6|R))}return x?O:P.UTF8ToUTF16(O.join(""))}},Ut={fromUTF16:function(C){for(var x,S=[],T=0,D=C.length;T<D;)(x=C.charCodeAt(T))>=1&&x<=127?S.push(C.charAt(T)):x>2047?(S.push(String.fromCharCode(224|x>>12&15)),S.push(String.fromCharCode(128|x>>6&63)),S.push(String.fromCharCode(128|63&x))):(S.push(String.fromCharCode(192|x>>6&31)),S.push(String.fromCharCode(128|63&x))),T++;return S.join("")},toUTF16:function(C){for(var x,S,T,D=[],R=0,P=C.length;R<P;)switch((x=C.charCodeAt(R++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:D.push(C.charAt(R-1));break;case 12:case 13:S=C.charCodeAt(R++),D.push(String.fromCharCode((31&x)<<6|63&S));break;case 14:S=C.charCodeAt(R++),T=C.charCodeAt(R++),D.push(String.fromCharCode((15&x)<<12|(63&S)<<6|63&T))}return D.join("")}},sn="undefined"!=typeof self?self:global,Yn=sn.btoa?function(C){return sn.btoa(C)}:function(C){for(var x,S,T=String(C),D=0,R=ft.encodeChars,P="";T.charAt(0|D)||(R="=",D%1);P+=R.charAt(63&x>>8-D%1*8)){if((S=T.charCodeAt(D+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");x=x<<8|S}return P},ki=sn.atob?function(C){return sn.atob(C)}:function(C){var x=String(C).replace(/[=]+$/,"");if(x.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var S,T,D=0,R=0,P="";T=x.charAt(R++);~T&&(S=D%4?64*S+T:T,D++%4)?P+=String.fromCharCode(255&S>>(-2*D&6)):0)T=ft.encodeChars.indexOf(T);return P};function Hi(C){if(null==C||"object"!=p(C))return C;var x,S,T;if(C instanceof Date)return(x=new Date).setTime(C.getTime()),x;if(C instanceof Array){for(x=[],T=C.length,S=0;S<T;S++)x[S]=Hi(C[S]);return x}if(C instanceof Object){for(S in x={},C)C.hasOwnProperty(S)&&(x[S]=Hi(C[S]));return x}return 0}function Qi(C){return Math.random().toString(16).substring(2,2+C)}function Lr(C){var x=[Qi(8),"-",Qi(4),"-",Qi(4),"-",Qi(4),"-",Qi(8)];return C&&x.unshift(C),x.join("")}var qa=Date.now||function(){return+new Date},fa=function(){return""+qa()};function rd(){for(var C,x=qa()%1e4,S=[],T=0;T<5;T++)C=Math.floor(10*Math.random()),0!=T||0!=C?S.push(C):T=-1;return x<10?S.push("000"):x<100?S.push("00"):x<1e3&&S.push("0"),S.push(x),S.join("")}function lh(C,x){var S;for(S in x)x.hasOwnProperty(S)&&(C[S]=x[S]);return C}var fm=!1;"wakeLock"in navigator&&(fm=!0);var v1=null;function F4e(){fm&&(null==v1?function(){!function Gw(C,x,S,T){new(S||(S=Promise))(function(D,R){function P(G){try{U(T.next(G))}catch(X){R(X)}}function O(G){try{U(T.throw(G))}catch(X){R(X)}}function U(G){var X;G.done?D(G.value):(X=G.value,X instanceof S?X:new S(function(z){z(X)})).then(P,O)}U((T=T.apply(C,x||[])).next())})}(this,void 0,void 0,B.mark(function C(){return B.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,x.next=3,navigator.wakeLock.request("screen");case 3:v1=x.sent,x.next=9;break;case 6:x.prev=6,x.t0=x.catch(0),v1=null;case 9:case"end":return x.stop()}},C,null,[[0,6]])}))}():v1.release().then(function(){v1=null}))}function L4e(){return v1}var uie=Array.prototype;function y1(C,x,S){return uie.filter.call(C,x,S||this)}function N4e(C,x){return uie.indexOf.call(x,C)}function B4e(C){var x,S,T=[],D=C.length;for(x=0;x<D;x++){for(S=x+1;S<D;S++)C[x]===C[S]&&(S=++x);T.push(C[x])}return T}var f8=/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/;function die(C,x){var S,T=[];for(S=0;S<C.length;S++){var D=C[S];D&&"."!==D&&(".."===D?T.length&&".."!==T[T.length-1]?T.pop():x&&T.push(".."):T.push(D))}return T}function p8(C){var x="/"===C.charAt(0),S="/"===C.slice(-1);return(C=die(y1(C.split("/"),function(T){return!!T}),!x).join("/"))||x||(C="."),C&&S&&(C+="/"),(x?"/":"")+C}var W4e=function(){function C(){n(this,C)}return v(C,[{key:"resolve",value:function(){var x,S,T="",D=arguments,R=!1;for(x=D.length-1;x>=0&&!R;x--)Ce(S=D[x])&&S&&(T=S+"/"+T,R="/"===S.charAt(0));return(R?"/":"")+die(y1(T.split("/"),function(P){return!!P}),!R).join("/")||"."}},{key:"join",value:function(){return p8(y1(Le(arguments),function(x){return x&&Ce(x)}).join("/"))}},{key:"relative",value:function(x,S){x=p8(x),S=p8(S);var T,D,R=y1(x.split("/"),function(G){return!!G}),P=[],O=y1(S.split("/"),function(G){return!!G}),U=Math.min(R.length,O.length);for(T=0;T<U&&R[T]===O[T];T++);for(D=T;T<R.length;)P.push(".."),T++;return(P=P.concat(O.slice(D))).join("/")}},{key:"basename",value:function(x,S){var T;return T=(x.match(f8)||[])[3]||"",S&&T&&T.slice(-1*S.length)===S&&(T=T.slice(0,-1*S.length)),T}},{key:"dirname",value:function(x){var S=x.match(f8)||[],T=S[1]||"",D=S[2]||"";return T||D?(D&&(D=D.substring(0,D.length-1)),T+D):"."}},{key:"extname",value:function(x){return(x.match(f8)||[])[4]||""}}]),C}(),g8={}.hasOwnProperty;function U4e(C){if(!C||"object"!==ce(C)||C.nodeType||C.window==C)return fe;var x,S;try{if((S=C.constructor)&&!g8(C,"constructor")&&!g8(S.prototype,"isPrototypeOf"))return fe}catch(T){return fe}for(x in C);return J(x)||g8(C,x)}var V4e="object"===("undefined"==typeof HTMLElement?"undefined":p(HTMLElement));function hie(C){return V4e?C instanceof HTMLElement:C&&"object"===p(C)&&(1===C.nodeType||9===C.nodeType)&&"string"==typeof C.nodeName}function j4e(C){var x=C;if(hie(C))for(;!x&&x!=document.body;)x=x.parentNode;else x=0;return!!x}function H4e(C,x){return 0===C.lastIndexOf(x,0)}function G4e(C,x){var S=C.length-x.length;return S>=0&&C.indexOf(x,S)===S}function z4e(C){return null==C?"":String.prototype.trim.call(C)}function Y4e(C){var x;if(C)for(x in C)if(!J(x))return!1;return!0}function X4e(C){return Ce(C)?C.replace(/[^\x20-\x7E]/g,""):C}function $4e(C,x,S){return C.replace(new RegExp(x,"gi"),S)}function q4e(C){return C.charAt(0).toUpperCase()+C.substr(1)}var m8="none",K4e={getOffset:function(C,x,S){var T,D;C=C||F.event;for(var R,P,O=S||C.target,U=0,G=0,X=0,z=0,K=!1,oe=F.document;O&&!isNaN(O.offsetLeft)&&!isNaN(O.offsetTop);)P=O.scrollLeft,R=O.scrollTop,"BODY"===O.tagName?K?(P=0,R=0):(P|=null===(T=oe.documentElement)||void 0===T?void 0:T.scrollLeft,R|=null===(D=oe.documentElement)||void 0===D?void 0:D.scrollTop):"fixed"===O.style.position&&(K=!0),U+=O.offsetLeft-P,G+=O.offsetTop-R,O=O.offsetParent;return x&&(X=x.Left,z=x.Top),{x:U=C.clientX-U-X,y:G=C.clientY-G-z}},getElDimensions:function(C,x){var S,T;return C?(S=C.style.display,C.style.display="",T=x?{offsetTop:C.offsetTop,offsetLeft:C.offsetLeft,offsetWidth:C.offsetWidth,offsetHeight:C.offsetHeight}:{clientTop:C.clientTop,clientLeft:C.clientLeft,clientWidth:C.clientWidth?C.clientWidth:parseInt(C.style.width)?parseInt(C.style.width):0,clientHeight:C.clientHeight?C.clientHeight:parseInt(C.style.height)?parseInt(C.style.height):0},C.style.display=S,T):{offsetTop:0,offsetLeft:0,offsetWidth:0,offsetHeight:0}}};function GD(C){return document.getElementById(C)}function J4e(C){var x=Ce(C)?GD(C):C;x&&(x.length>0&&(x=x[0]),x.style.display=m8)}function Q4e(C){var x=Ce(C)?GD(C):C;x&&(x.length>0&&(x=x[0]),x.style.display="")}function Z4e(C){var x=Ce(C)?GD(C):C;x&&(x.length>0&&(x=x[0]),x.style.display=x.style.display===m8?"":m8)}function eOe(C){if(C)for(;C.firstChild;)C.removeChild(C.firstChild)}function tOe(C){return encodeURIComponent(String(C))}function nOe(C){return decodeURIComponent(C.replace(/\+/g," "))}var _1=document,iOe=_1&&_1.documentElement,C1=_1.getElementsByTagName("head")[0]||iOe,v8=_1.createElement("script").readyState?function(C,x){var S=C.onreadystatechange;C.onreadystatechange=function(){var T=C.readyState;"loaded"===T||"complete"===T?(C.onreadystatechange=null,S&&S(),x.call(this,{type:"load",path:[C]})):"loading"===T||x.call(this,{type:"error",path:[C]})}}:function(C,x){C.addEventListener("load",x,fe),C.addEventListener("error",x,fe)};function rOe(C,x,S){return y8(C,x,!1,S)}function y8(C,x,S,T){var D,R,P=T;if(pe(P)||(P=function(){}),Ce(C)&&""!=C)return D=_1.createElement("script"),R=["",C].join(""),D.src=R,x&&(D.async=!0),D.charset="utf-8",v8(D,P),S?C1.appendChild(D):C1.insertBefore(D,C1.firstChild),D;P()}function oOe(C,x,S){return pie(C,x,!1,S)}function pie(C,x,S,T){var D=T;if(pe(D)||(D=function(){}),he.bJSDom)D("ok");else if(we(C)){var R=C.length,P=function(O){O&&"load"==O.type?R--:(O&&"error"==O.type&&$(["Failed to load resource: ",O.target.src,"."].join("")),D()),R<=0&&D("ok")};R<=0?D("ok"):xe(C,function(O){y8(O,x,S,P)})}else D()}function sOe(C,x){return _8(C,!1,x)}function _8(C,x,S){var T,D=S;if(pe(D)||(D=!1),Ce(C)&&""!=C){if(!he.bJSDom)return(T=_1.createElement("link")).href=C,T.rel="stylesheet",T.async=!0,D&&v8(T,D),x?C1.appendChild(T):C1.insertBefore(T,C1.firstChild),T;D&&D()}else D&&D()}function aOe(C,x){return gie(C,!1,x)}function gie(C,x,S){if(he.bJSDom)S&&S("ok");else if(we(C)){var T=C.length,D=function(R){R&&"load"==R.type&&T--,R&&"load"!=R.type&&(R&&"error"==R.type&&$(["Failed to load resource: ",R.target.href,"."].join("")),S()),T<=0&&S("ok")};xe(C,function(R){_8(R,x,D)})}else S&&S()}function mie(C){var x,S;if(!he.bJSDom){var T=document;if(T&&Ce(S=C.body)&&""!=S){(x=T.createElement("script")).charset="utf-8",he.bIE?x.text=S:x.appendChild(T.createTextNode(S)),x.language=C.language?C.language:"javascript",x.type=C.type?C.type:"text/javascript";var D=T&&T.documentElement,R=T.getElementsByTagName("head")[0]||D;R.insertBefore(x,R.firstChild)}}}function lOe(C){mie({body:C})}function cOe(C){mie({body:C,language:"vbscript",type:"text/vbscript"})}var me,pm,uOe=function(){function C(){n(this,C),this.nil=void 0,this.bNode=!1,this.noop=function(){},this.mix=lh,this.clone=Hi,this.keys=Object.keys,this.now=fa,this.getFormatedNow=Q,this.getRandom=rd,this.guid=Lr,this.get=GD,this.show=Q4e,this.hide=J4e,this.toggle=Z4e,this.empty=eOe,this.stringify=F.JSON.stringify,this.parse=F.JSON.parse,this.isDef=Z,this.isUndef=J,this.isUndefined=J,this.isNull=re,this.isNaN=isNaN,this.isFunction=pe,this.isString=Ce,this.isObject=Ve,this.isBoolean=te,this.isNumber=Me,this.isArray=we,this.type=ce,this.isPlainObject=U4e,this.isDOM=hie,this.isDOMInBody=j4e,this.each=xe,this.getLogger=q,this.setLogger=k,this.log=N,this.error=$,this.warn=ie,this.info=ee,this.filter=y1,this.indexOf=N4e,this.uniq=B4e,this.startsWith=H4e,this.endsWith=G4e,this.replaceAll=$4e,this.upperCaseFirst=q4e,this.removeNonPrintableChar=X4e,this.trim=z4e,this.makeArray=Le,this.isEmptyObject=Y4e,this.Path=new W4e,this.DOM=K4e,this.isWindow=De,this.globalEval=je,this.obj={customEvent:Pe},this.addEventListener=it,this.removeEventListener=ct,this.stopPropagation=wt,this.fireEvent=ht,this.base64=Lt,this.utf8=Ut,this.btoa=Yn,this.atob=ki,this.asyncQueue=ne,this.sizzle=ut,this.toggleWakeLock=F4e,this.getWakeLock=L4e,this.urlEncode=tOe,this.urlDecode=nOe,this.scriptOnload=v8,this.addAllCss=gie,this.getAllCss=aOe,this.addCss=_8,this.getCss=sOe,this.addScripts=pie,this.getScripts=oOe,this.addScript=y8,this.getScript=rOe,this.addJS=lOe,this.addVBS=cOe}return v(C,[{key:"debug",get:function(){return Y.debug},set:function(x){Y.debug=x}},{key:"showConsoleError",get:function(){return Y.debug},set:function(x){Y.showConsoleError=x}}]),C}(),H=new uOe,yie=!!("object"==("undefined"==typeof global?"undefined":p(global))&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),C8=yie?global:self||{},be=C8.Dynamsoft;function Ks(C){return Math.floor(C)}function Eo(C,x){if(!(C instanceof x))throw new TypeError("Cannot call a class as a function")}be?be.Lib||(be.Lib={}):(be={Lib:{},DWT:{}},C8&&(C8.Dynamsoft=be)),me=H.mix(be.Lib,H),(pm=be).DWT||(pm.DWT={}),pm.DWT.LTS||(pm.DWT.LTS={}),pm.Lib.UI||(pm.Lib.UI={}),pm.Lib.html5||(pm.Lib.html5={});var _ie={exports:{}},zw=function(C){return C&&C.Math===Math&&C},Yr=zw("object"==typeof id&&id)||zw("object"==typeof window&&window)||zw("object"==typeof self&&self)||zw("object"==typeof y&&y)||zw("object"==typeof y&&y)||function(){return this}()||Function("return this")(),xr=function(C){try{return!!C()}catch(x){return!0}},Yw=!xr(function(){var C=function(){}.bind();return"function"!=typeof C||C.hasOwnProperty("prototype")}),Cie=Function.prototype,bie=Cie.apply,xie=Cie.call,b1="object"==typeof Reflect&&Reflect.apply||(Yw?xie.bind(bie):function(){return xie.apply(bie,arguments)}),wie=Yw,Sie=Function.prototype,b8=Sie.call,hOe=wie&&Sie.bind.bind(b8,b8),kr=wie?hOe:function(C){return function(){return b8.apply(C,arguments)}},Tie=kr,fOe=Tie({}.toString),pOe=Tie("".slice),Np=function(C){return pOe(fOe(C),8,-1)},gOe=Np,mOe=kr,x1=function(C){if("Function"===gOe(C))return mOe(C)},x8="object"==typeof document&&document.all,_s=void 0===x8&&void 0!==x8?function(C){return"function"==typeof C||C===x8}:function(C){return"function"==typeof C},Bp={},ts=!xr(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),zD=Function.prototype.call,Rs=Yw?zD.bind(zD):function(){return zD.apply(zD,arguments)},Xw={},Iie={}.propertyIsEnumerable,Eie=Object.getOwnPropertyDescriptor,yOe=Eie&&!Iie.call({1:2},1);Xw.f=yOe?function(C){var x=Eie(this,C);return!!x&&x.enumerable}:Iie;var gm,YD,mm=function(C,x){return{enumerable:!(1&C),configurable:!(2&C),writable:!(4&C),value:x}},_Oe=xr,COe=Np,w8=Object,bOe=kr("".split),S8=_Oe(function(){return!w8("z").propertyIsEnumerable(0)})?function(C){return"String"===COe(C)?bOe(C,""):w8(C)}:w8,w1=function(C){return null==C},xOe=w1,wOe=TypeError,vm=function(C){if(xOe(C))throw new wOe("Can't call method on "+C);return C},SOe=S8,TOe=vm,ch=function(C){return SOe(TOe(C))},IOe=_s,Cs=function(C){return"object"==typeof C?null!==C:IOe(C)},Co={},T8=Co,I8=Yr,EOe=_s,Die=function(C){return EOe(C)?C:void 0},Ta=function(C,x){return arguments.length<2?Die(T8[C])||Die(I8[C]):T8[C]&&T8[C][x]||I8[C]&&I8[C][x]},ks=kr({}.isPrototypeOf),$w="undefined"!=typeof navigator&&String(navigator.userAgent)||"",E8=$w,Pie=Yr.process,Rie=Yr.Deno,kie=Pie&&Pie.versions||Rie&&Rie.version,Mie=kie&&kie.v8;Mie&&(YD=(gm=Mie.split("."))[0]>0&&gm[0]<4?1:+(gm[0]+gm[1])),!YD&&E8&&(!(gm=E8.match(/Edge\/(\d+)/))||gm[1]>=74)&&(gm=E8.match(/Chrome\/(\d+)/))&&(YD=+gm[1]);var XD=YD,Oie=XD,AOe=Yr.String,S1=!!Object.getOwnPropertySymbols&&!xr(function(){var C=Symbol("symbol detection");return!AOe(C)||!(Object(C)instanceof Symbol)||!Symbol.sham&&Oie&&Oie<41}),Fie=S1&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,POe=Ta,ROe=_s,kOe=ks,MOe=Object,qw=Fie?function(C){return"symbol"==typeof C}:function(C){var x=POe("Symbol");return ROe(x)&&kOe(x.prototype,MOe(C))},OOe=String,h0=function(C){try{return OOe(C)}catch(x){return"Object"}},FOe=_s,LOe=h0,NOe=TypeError,lu=function(C){if(FOe(C))return C;throw new NOe(LOe(C)+" is not a function")},BOe=lu,WOe=w1,D8=function(C,x){var S=C[x];return WOe(S)?void 0:BOe(S)},A8=Rs,P8=_s,R8=Cs,UOe=TypeError,Lie={exports:{}},Nie=Yr,jOe=Object.defineProperty,Bie="__core-js_shared__",Wie=Lie.exports=Yr[Bie]||function(C,x){try{jOe(Nie,C,{value:x,configurable:!0,writable:!0})}catch(S){Nie[C]=x}return x}(Bie,{});(Wie.versions||(Wie.versions=[])).push({version:"3.37.0",mode:"pure",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"});var k8=Lie.exports,Uie=k8,T1=function(C,x){return Uie[C]||(Uie[C]=x||{})},zOe=vm,YOe=Object,pf=function(C){return YOe(zOe(C))},XOe=pf,$Oe=kr({}.hasOwnProperty),Ms=Object.hasOwn||function(C,x){return $Oe(XOe(C),x)},qOe=kr,KOe=0,JOe=Math.random(),QOe=qOe(1..toString),$D=function(C){return"Symbol("+(void 0===C?"":C)+")_"+QOe(++KOe+JOe,36)},Vie=Ms,e5e=$D,t5e=S1,n5e=Fie,I1=Yr.Symbol,M8=T1("wks"),i5e=n5e?I1.for||I1:I1&&I1.withoutSetter||e5e,bo=function(C){return Vie(M8,C)||(M8[C]=t5e&&Vie(I1,C)?I1[C]:i5e("Symbol."+C)),M8[C]},r5e=Rs,jie=Cs,Hie=qw,o5e=D8,a5e=TypeError,l5e=bo("toPrimitive"),u5e=qw,O8=function(C){var x=function(C,x){if(!jie(C)||Hie(C))return C;var S,T=o5e(C,l5e);if(T){if(void 0===x&&(x="default"),S=r5e(T,C,x),!jie(S)||Hie(S))return S;throw new a5e("Can't convert object to primitive value")}return void 0===x&&(x="number"),function(C,x){var S,T;if("string"===x&&P8(S=C.toString)&&!R8(T=A8(S,C))||P8(S=C.valueOf)&&!R8(T=A8(S,C))||"string"!==x&&P8(S=C.toString)&&!R8(T=A8(S,C)))return T;throw new UOe("Can't convert object to primitive value")}(C,x)}(C,"string");return u5e(x)?x:x+""},Gie=Cs,F8=Yr.document,d5e=Gie(F8)&&Gie(F8.createElement),L8=function(C){return d5e?F8.createElement(C):{}},h5e=L8,zie=!ts&&!xr(function(){return 7!==Object.defineProperty(h5e("div"),"a",{get:function(){return 7}}).a}),p5e=Rs,g5e=Xw,m5e=mm,v5e=ch,y5e=O8,_5e=Ms,C5e=zie,Yie=Object.getOwnPropertyDescriptor;Bp.f=ts?Yie:function(C,x){if(C=v5e(C),x=y5e(x),C5e)try{return Yie(C,x)}catch(S){}if(_5e(C,x))return m5e(!p5e(g5e.f,C,x),C[x])};var b5e=xr,x5e=_s,w5e=/#|\.prototype\./,Kw=function(C,x){var S=T5e[S5e(C)];return S===E5e||S!==I5e&&(x5e(x)?b5e(x):!!x)},S5e=Kw.normalize=function(C){return String(C).replace(w5e,".").toLowerCase()},T5e=Kw.data={},I5e=Kw.NATIVE="N",E5e=Kw.POLYFILL="P",Xie=Kw,D5e=lu,A5e=Yw,P5e=x1(x1.bind),Wp=function(C,x){return D5e(C),void 0===x?C:A5e?P5e(C,x):function(){return C.apply(x,arguments)}},yc={},$ie=ts&&xr(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),R5e=Cs,k5e=String,M5e=TypeError,$l=function(C){if(R5e(C))return C;throw new M5e(k5e(C)+" is not an object")},F5e=zie,qD=$l,qie=O8,N5e=TypeError,N8=Object.defineProperty,B5e=Object.getOwnPropertyDescriptor,B8="enumerable",W8="configurable",U8="writable";yc.f=ts?$ie?function(C,x,S){if(qD(C),x=qie(x),qD(S),"function"==typeof C&&"prototype"===x&&"value"in S&&U8 in S&&!S[U8]){var T=B5e(C,x);T&&T[U8]&&(C[x]=S.value,S={configurable:W8 in S?S[W8]:T[W8],enumerable:B8 in S?S[B8]:T[B8],writable:!1})}return N8(C,x,S)}:N8:function(C,x,S){if(qD(C),x=qie(x),qD(S),F5e)try{return N8(C,x,S)}catch(T){}if("get"in S||"set"in S)throw new N5e("Accessors not supported");return"value"in S&&(C[x]=S.value),C};var W5e=yc,U5e=mm,ym=ts?function(C,x,S){return W5e.f(C,x,U5e(1,S))}:function(C,x,S){return C[x]=S,C},Jw=Yr,V5e=b1,j5e=x1,H5e=_s,G5e=Bp.f,z5e=Xie,E1=Co,Y5e=Wp,D1=ym,Kie=Ms,X5e=function(C){var x=function(S,T,D){if(this instanceof x){switch(arguments.length){case 0:return new C;case 1:return new C(S);case 2:return new C(S,T)}return new C(S,T,D)}return V5e(C,this,arguments)};return x.prototype=C.prototype,x},Pn=function(C,x){var S,T,D,R,P,O,U,G,X,z=C.target,K=C.global,oe=C.stat,ae=C.proto,ue=K?Jw:oe?Jw[z]:Jw[z]&&Jw[z].prototype,ye=K?E1:E1[z]||D1(E1,z,{})[z],Ie=ye.prototype;for(R in x)T=!(S=z5e(K?R:z+(oe?".":"#")+R,C.forced))&&ue&&Kie(ue,R),O=ye[R],T&&(U=C.dontCallGetSet?(X=G5e(ue,R))&&X.value:ue[R]),P=T&&U?U:x[R],(S||ae||typeof O!=typeof P)&&(G=C.bind&&T?Y5e(P,Jw):C.wrap&&T?X5e(P):ae&&H5e(P)?j5e(P):P,(C.sham||P&&P.sham||O&&O.sham)&&D1(G,"sham",!0),D1(ye,R,G),ae&&(Kie(E1,D=z+"Prototype")||D1(E1,D,{}),D1(E1[D],R,P),C.real&&Ie&&(S||!Ie[R])&&D1(Ie,R,P)))},Jie=yc.f;Pn({target:"Object",stat:!0,forced:Object.defineProperty!==Jie,sham:!ts},{defineProperty:Jie});var Qie=Co.Object,K5e=_ie.exports=function(C,x,S){return Qie.defineProperty(C,x,S)};Qie.defineProperty.sham&&(K5e.sham=!0);var Zie=_ie.exports,ere=Zie,KD=_(ere),J5e=Np,f0=Array.isArray||function(C){return"Array"===J5e(C)},Q5e=Math.ceil,Z5e=Math.floor,eFe=Math.trunc||function(C){var x=+C;return(x>0?Z5e:Q5e)(x)},Qw=function(C){var x=+C;return x!=x||0===x?0:eFe(x)},tFe=Qw,nFe=Math.min,V8=function(C){var x=tFe(C);return x>0?nFe(x,9007199254740991):0},iFe=V8,p0=function(C){return iFe(C.length)},rFe=TypeError,tre=function(C){if(C>9007199254740991)throw rFe("Maximum allowed index exceeded");return C},oFe=ts,sFe=yc,aFe=mm,Zw=function(C,x,S){oFe?sFe.f(C,x,aFe(0,S)):C[x]=S},nre={};nre[bo("toStringTag")]="z";var j8="[object z]"===String(nre),lFe=j8,cFe=_s,JD=Np,uFe=bo("toStringTag"),dFe=Object,hFe="Arguments"===JD(function(){return arguments}()),g0=lFe?JD:function(C){var x,S,T;return void 0===C?"Undefined":null===C?"Null":"string"==typeof(S=function(D,R){try{return D[R]}catch(P){}}(x=dFe(C),uFe))?S:hFe?JD(x):"Object"===(T=JD(x))&&cFe(x.callee)?"Arguments":T},fFe=_s,H8=k8,pFe=kr(Function.toString);fFe(H8.inspectSource)||(H8.inspectSource=function(C){return pFe(C)});var ire=H8.inspectSource,gFe=kr,mFe=xr,rre=_s,vFe=g0,yFe=ire,ore=function(){},sre=Ta("Reflect","construct"),G8=/^\s*(?:class|function)\b/,_Fe=gFe(G8.exec),CFe=!G8.test(ore),eS=function(C){if(!rre(C))return!1;try{return sre(ore,[],C),!0}catch(x){return!1}},are=function(C){if(!rre(C))return!1;switch(vFe(C)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return CFe||!!_Fe(G8,yFe(C))}catch(x){return!0}};are.sham=!0;var QD=!sre||mFe(function(){var C;return eS(eS.call)||!eS(Object)||!eS(function(){C=!0})||C})?are:eS,lre=f0,bFe=QD,xFe=Cs,wFe=bo("species"),cre=Array,z8=function(C,x){return new(function(C){var x;return lre(C)&&(bFe(x=C.constructor)&&(x===cre||lre(x.prototype))||xFe(x)&&null===(x=x[wFe]))&&(x=void 0),void 0===x?cre:x}(C))(0===x?0:x)},TFe=xr,IFe=XD,EFe=bo("species"),tS=function(C){return IFe>=51||!TFe(function(){var x=[];return(x.constructor={})[EFe]=function(){return{foo:1}},1!==x[C](Boolean).foo})},DFe=Pn,AFe=xr,PFe=f0,RFe=Cs,kFe=pf,MFe=p0,ure=tre,dre=Zw,OFe=z8,FFe=tS,LFe=XD,hre=bo("isConcatSpreadable"),NFe=LFe>=51||!AFe(function(){var C=[];return C[hre]=!1,C.concat()[0]!==C}),BFe=function(C){if(!RFe(C))return!1;var x=C[hre];return void 0!==x?!!x:PFe(C)};DFe({target:"Array",proto:!0,arity:1,forced:!NFe||!FFe("concat")},{concat:function(C){var x,S,T,D,R,P=kFe(this),O=OFe(P,0),U=0;for(x=-1,T=arguments.length;x<T;x++)if(BFe(R=-1===x?P:arguments[x]))for(D=MFe(R),ure(U+D),S=0;S<D;S++,U++)S in R&&dre(O,U,R[S]);else ure(U+1),dre(O,U++,R);return O.length=U,O}});var WFe=g0,UFe=String,bl=function(C){if("Symbol"===WFe(C))throw new TypeError("Cannot convert a Symbol value to a string");return UFe(C)},ZD={},VFe=Qw,jFe=Math.max,HFe=Math.min,Y8=function(C,x){var S=VFe(C);return S<0?jFe(S+x,0):HFe(S,x)},GFe=ch,zFe=Y8,YFe=p0,fre=function(C){return function(x,S,T){var D=GFe(x),R=YFe(D);if(0===R)return!C&&-1;var P,O=zFe(T,R);if(C&&S!=S){for(;R>O;)if((P=D[O++])!=P)return!0}else for(;R>O;O++)if((C||O in D)&&D[O]===S)return C||O||0;return!C&&-1}},X8={includes:fre(!0),indexOf:fre(!1)},nS={},$8=Ms,XFe=ch,$Fe=X8.indexOf,qFe=nS,pre=kr([].push),gre=function(C,x){var S,T=XFe(C),D=0,R=[];for(S in T)!$8(qFe,S)&&$8(T,S)&&pre(R,S);for(;x.length>D;)$8(T,S=x[D++])&&(~$Fe(R,S)||pre(R,S));return R},q8=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],KFe=gre,JFe=q8,iS=Object.keys||function(C){return KFe(C,JFe)},eLe=yc,tLe=$l,nLe=ch,iLe=iS;ZD.f=ts&&!$ie?Object.defineProperties:function(C,x){tLe(C);for(var S,T=nLe(x),D=iLe(x),R=D.length,P=0;R>P;)eLe.f(C,S=D[P++],T[S]);return C};var eA,mre=Ta("document","documentElement"),rLe=$D,vre=T1("keys"),tA=function(C){return vre[C]||(vre[C]=rLe(C))},oLe=$l,sLe=ZD,yre=q8,aLe=nS,lLe=mre,cLe=L8,K8="prototype",_re=tA("IE_PROTO"),Q8=function(){},Cre=function(C){return"<script>"+C+"<\/script>"},bre=function(C){C.write(Cre("")),C.close();var x=C.parentWindow.Object;return C=null,x},nA=function(){try{eA=new ActiveXObject("htmlfile")}catch(D){}var C,x;nA="undefined"!=typeof document?document.domain&&eA?bre(eA):((x=cLe("iframe")).style.display="none",lLe.appendChild(x),x.src=String("javascript:"),(C=x.contentWindow.document).open(),C.write(Cre("document.F=Object")),C.close(),C.F):bre(eA);for(var T=yre.length;T--;)delete nA[K8][yre[T]];return nA()};aLe[_re]=!0;var _m=Object.create||function(C,x){var S;return null!==C?(Q8[K8]=oLe(C),S=new Q8,Q8[K8]=null,S[_re]=C):S=nA(),void 0===x?S:sLe.f(S,x)},rS={},uLe=gre,dLe=q8.concat("length","prototype");rS.f=Object.getOwnPropertyNames||function(C){return uLe(C,dLe)};var Z8={},Up=kr([].slice),hLe=Np,fLe=ch,xre=rS.f,pLe=Up,wre="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Z8.f=function(C){return wre&&"Window"===hLe(C)?function(x){try{return xre(x)}catch(S){return pLe(wre)}}(C):xre(fLe(C))};var oS={};oS.f=Object.getOwnPropertySymbols;var gLe=ym,Cm=function(C,x,S,T){return T&&T.enumerable?C[x]=S:gLe(C,x,S),C},mLe=yc,sS=function(C,x,S){return mLe.f(C,x,S)},aS={};aS.f=bo;var iA,lS,rA,Sre=Co,yLe=Ms,_Le=aS,CLe=yc.f,ns=function(C){var x=Sre.Symbol||(Sre.Symbol={});yLe(x,C)||CLe(x,C,{value:_Le.f(C)})},bLe=Rs,xLe=Ta,wLe=bo,SLe=Cm,Tre=function(){var C=xLe("Symbol"),x=C&&C.prototype,S=x&&x.valueOf,T=wLe("toPrimitive");x&&!x[T]&&SLe(x,T,function(D){return bLe(S,this)},{arity:1})},TLe=g0,ELe=j8,DLe=yc.f,ALe=ym,PLe=Ms,RLe=j8?{}.toString:function(){return"[object "+TLe(this)+"]"},Ire=bo("toStringTag"),gf=function(C,x,S,T){var D=S?C:C&&C.prototype;D&&(PLe(D,Ire)||DLe(D,Ire,{configurable:!0,value:x}),T&&!ELe&&ALe(D,"toString",RLe))},Ere=Yr.WeakMap,MLe=_s(Ere)&&/native code/.test(String(Ere)),OLe=Cs,FLe=ym,eN=Ms,LLe=tA,NLe=nS,Are="Object already initialized",nN=Yr.TypeError;if(MLe||k8.state){var mf=k8.state||(k8.state=new(0,Yr.WeakMap));mf.get=mf.get,mf.has=mf.has,mf.set=mf.set,iA=function(C,x){if(mf.has(C))throw new nN(Are);return x.facade=C,mf.set(C,x),x},lS=function(C){return mf.get(C)||{}},rA=function(C){return mf.has(C)}}else{var A1=LLe("state");NLe[A1]=!0,iA=function(C,x){if(eN(C,A1))throw new nN(Are);return x.facade=C,FLe(C,A1,x),x},lS=function(C){return eN(C,A1)?C[A1]:{}},rA=function(C){return eN(C,A1)}}var vf={set:iA,get:lS,has:rA,enforce:function(C){return rA(C)?lS(C):iA(C,{})},getterFor:function(C){return function(x){var S;if(!OLe(x)||(S=lS(x)).type!==C)throw new nN("Incompatible receiver, "+C+" required");return S}}},WLe=Wp,ULe=S8,VLe=pf,jLe=p0,HLe=z8,Pre=kr([].push),bm=function(C){var x=1===C,S=2===C,T=3===C,D=4===C,R=6===C,P=7===C,O=5===C||R;return function(U,G,X,z){for(var K,oe,ae=VLe(U),ue=ULe(ae),ye=jLe(ue),Ie=WLe(G,X),Ue=0,He=z||HLe,Re=x?He(U,ye):S||P?He(U,0):void 0;ye>Ue;Ue++)if((O||Ue in ue)&&(oe=Ie(K=ue[Ue],Ue,ae),C))if(x)Re[Ue]=oe;else if(oe)switch(C){case 3:return!0;case 5:return K;case 6:return Ue;case 2:Pre(Re,K)}else switch(C){case 4:return!1;case 7:Pre(Re,K)}return R?-1:T||D?D:Re}},m0={forEach:bm(0),map:bm(1),filter:bm(2),some:bm(3),every:bm(4),find:bm(5),findIndex:bm(6),filterReject:bm(7)},oA=Pn,cS=Yr,iN=Rs,GLe=kr,P1=ts,R1=S1,zLe=xr,Ia=Ms,YLe=ks,rN=$l,sA=ch,oN=O8,XLe=bl,sN=mm,k1=_m,Rre=iS,$Le=rS,kre=Z8,qLe=oS,Mre=Bp,Ore=yc,KLe=ZD,Fre=Xw,Lre=Cm,JLe=sS,aN=T1,Nre=nS,Bre=$D,QLe=bo,ZLe=aS,e8e=ns,t8e=Tre,n8e=gf,Wre=vf,aA=m0.forEach,_c=tA("hidden"),lA="Symbol",uS="prototype",i8e=Wre.set,Ure=Wre.getterFor(lA),uh=Object[uS],v0=cS.Symbol,cA=v0&&v0[uS],r8e=cS.RangeError,o8e=cS.TypeError,lN=cS.QObject,Vre=Mre.f,y0=Ore.f,jre=kre.f,s8e=Fre.f,Hre=GLe([].push),Vp=aN("symbols"),dS=aN("op-symbols"),a8e=aN("wks"),cN=!lN||!lN[uS]||!lN[uS].findChild,Gre=function(C,x,S){var T=Vre(uh,x);T&&delete uh[x],y0(C,x,S),T&&C!==uh&&y0(uh,x,T)},uN=P1&&zLe(function(){return 7!==k1(y0({},"a",{get:function(){return y0(this,"a",{value:7}).a}})).a})?Gre:y0,dN=function(C,x){var S=Vp[C]=k1(cA);return i8e(S,{type:lA,tag:C,description:x}),P1||(S.description=x),S},uA=function(C,x,S){C===uh&&uA(dS,x,S),rN(C);var T=oN(x);return rN(S),Ia(Vp,T)?(S.enumerable?(Ia(C,_c)&&C[_c][T]&&(C[_c][T]=!1),S=k1(S,{enumerable:sN(0,!1)})):(Ia(C,_c)||y0(C,_c,sN(1,k1(null))),C[_c][T]=!0),uN(C,T,S)):y0(C,T,S)},hN=function(C,x){rN(C);var S=sA(x),T=Rre(S).concat($re(S));return aA(T,function(D){P1&&!iN(zre,S,D)||uA(C,D,S[D])}),C},zre=function(C){var x=oN(C),S=iN(s8e,this,x);return!(this===uh&&Ia(Vp,x)&&!Ia(dS,x))&&(!(S||!Ia(this,x)||!Ia(Vp,x)||Ia(this,_c)&&this[_c][x])||S)},Yre=function(C,x){var S=sA(C),T=oN(x);if(S!==uh||!Ia(Vp,T)||Ia(dS,T)){var D=Vre(S,T);return!D||!Ia(Vp,T)||Ia(S,_c)&&S[_c][T]||(D.enumerable=!0),D}},Xre=function(C){var x=jre(sA(C)),S=[];return aA(x,function(T){Ia(Vp,T)||Ia(Nre,T)||Hre(S,T)}),S},$re=function(C){var x=C===uh,S=jre(x?dS:sA(C)),T=[];return aA(S,function(D){!Ia(Vp,D)||x&&!Ia(uh,D)||Hre(T,Vp[D])}),T};R1||(v0=function(){if(YLe(cA,this))throw new o8e("Symbol is not a constructor");var C=arguments.length&&void 0!==arguments[0]?XLe(arguments[0]):void 0,x=Bre(C),S=function(T){var D=void 0===this?cS:this;D===uh&&iN(S,dS,T),Ia(D,_c)&&Ia(D[_c],x)&&(D[_c][x]=!1);var R=sN(1,T);try{uN(D,x,R)}catch(P){if(!(P instanceof r8e))throw P;Gre(D,x,R)}};return P1&&cN&&uN(uh,x,{configurable:!0,set:S}),dN(x,C)},Lre(cA=v0[uS],"toString",function(){return Ure(this).tag}),Lre(v0,"withoutSetter",function(C){return dN(Bre(C),C)}),Fre.f=zre,Ore.f=uA,KLe.f=hN,Mre.f=Yre,$Le.f=kre.f=Xre,qLe.f=$re,ZLe.f=function(C){return dN(QLe(C),C)},P1&&JLe(cA,"description",{configurable:!0,get:function(){return Ure(this).description}})),oA({global:!0,constructor:!0,wrap:!0,forced:!R1,sham:!R1},{Symbol:v0}),aA(Rre(a8e),function(C){e8e(C)}),oA({target:lA,stat:!0,forced:!R1},{useSetter:function(){cN=!0},useSimple:function(){cN=!1}}),oA({target:"Object",stat:!0,forced:!R1,sham:!P1},{create:function(C,x){return void 0===x?k1(C):hN(k1(C),x)},defineProperty:uA,defineProperties:hN,getOwnPropertyDescriptor:Yre}),oA({target:"Object",stat:!0,forced:!R1},{getOwnPropertyNames:Xre}),t8e(),n8e(v0,lA),Nre[_c]=!0;var qre=S1&&!!Symbol.for&&!!Symbol.keyFor,l8e=Pn,c8e=Ta,u8e=Ms,d8e=bl,Kre=T1,h8e=qre,fN=Kre("string-to-symbol-registry"),f8e=Kre("symbol-to-string-registry");l8e({target:"Symbol",stat:!0,forced:!h8e},{for:function(C){var x=d8e(C);if(u8e(fN,x))return fN[x];var S=c8e("Symbol")(x);return fN[x]=S,f8e[S]=x,S}});var p8e=Pn,g8e=Ms,m8e=qw,v8e=h0,y8e=qre,Jre=T1("symbol-to-string-registry");p8e({target:"Symbol",stat:!0,forced:!y8e},{keyFor:function(C){if(!m8e(C))throw new TypeError(v8e(C)+" is not a symbol");if(g8e(Jre,C))return Jre[C]}});var Qre=f0,_8e=_s,Zre=Np,C8e=bl,eoe=kr([].push),b8e=Pn,toe=Ta,noe=b1,x8e=Rs,hS=kr,ioe=xr,roe=_s,ooe=qw,soe=Up,w8e=function(C){if(_8e(C))return C;if(Qre(C)){for(var x=C.length,S=[],T=0;T<x;T++){var D=C[T];"string"==typeof D?eoe(S,D):"number"!=typeof D&&"Number"!==Zre(D)&&"String"!==Zre(D)||eoe(S,C8e(D))}var R=S.length,P=!0;return function(O,U){if(P)return P=!1,U;if(Qre(this))return U;for(var G=0;G<R;G++)if(S[G]===O)return U}}},S8e=S1,T8e=String,xm=toe("JSON","stringify"),dA=hS(/./.exec),aoe=hS("".charAt),I8e=hS("".charCodeAt),E8e=hS("".replace),D8e=hS(1..toString),A8e=/[\uD800-\uDFFF]/g,loe=/^[\uD800-\uDBFF]$/,coe=/^[\uDC00-\uDFFF]$/,uoe=!S8e||ioe(function(){var C=toe("Symbol")("stringify detection");return"[null]"!==xm([C])||"{}"!==xm({a:C})||"{}"!==xm(Object(C))}),doe=ioe(function(){return'"\\udf06\\ud834"'!==xm("\udf06\ud834")||'"\\udead"'!==xm("\udead")}),P8e=function(C,x){var S=soe(arguments),T=w8e(x);if(roe(T)||void 0!==C&&!ooe(C))return S[1]=function(D,R){if(roe(T)&&(R=x8e(T,this,T8e(D),R)),!ooe(R))return R},noe(xm,null,S)},R8e=function(C,x,S){var T=aoe(S,x-1),D=aoe(S,x+1);return dA(loe,C)&&!dA(coe,D)||dA(coe,C)&&!dA(loe,T)?"\\u"+D8e(I8e(C,0),16):C};xm&&b8e({target:"JSON",stat:!0,arity:3,forced:uoe||doe},{stringify:function(C,x,S){var T=soe(arguments),D=noe(uoe?P8e:xm,null,T);return doe&&"string"==typeof D?E8e(D,A8e,R8e):D}});var hoe=oS,k8e=pf;Pn({target:"Object",stat:!0,forced:!S1||xr(function(){hoe.f(1)})},{getOwnPropertySymbols:function(C){var x=hoe.f;return x?x(k8e(C)):[]}}),ns("asyncIterator"),ns("hasInstance"),ns("isConcatSpreadable"),ns("iterator"),ns("match"),ns("matchAll"),ns("replace"),ns("search"),ns("species"),ns("split");var M8e=Tre;ns("toPrimitive"),M8e();var O8e=Ta,F8e=gf;ns("toStringTag"),F8e(O8e("Symbol"),"Symbol"),ns("unscopables"),gf(Yr.JSON,"JSON",!0);var _0,foe,poe,L8e=Co.Symbol,M1={},pN=ts,goe=Function.prototype,B8e=pN&&Object.getOwnPropertyDescriptor,gN=Ms(goe,"name"),moe={EXISTS:gN,PROPER:gN&&"something"===function(){}.name,CONFIGURABLE:gN&&(!pN||pN&&B8e(goe,"name").configurable)},voe=!xr(function(){function C(){}return C.prototype.constructor=null,Object.getPrototypeOf(new C)!==C.prototype}),W8e=Ms,U8e=_s,V8e=pf,j8e=voe,yoe=tA("IE_PROTO"),mN=Object,H8e=mN.prototype,O1=j8e?mN.getPrototypeOf:function(C){var x=V8e(C);if(W8e(x,yoe))return x[yoe];var S=x.constructor;return U8e(S)&&x instanceof S?S.prototype:x instanceof mN?H8e:null},G8e=xr,z8e=_s,Y8e=Cs,X8e=_m,_oe=O1,$8e=Cm,vN=bo("iterator"),Coe=!1;[].keys&&("next"in(poe=[].keys())?(foe=_oe(_oe(poe)))!==Object.prototype&&(_0=foe):Coe=!0);var q8e=!Y8e(_0)||G8e(function(){var C={};return _0[vN].call(C)!==C});z8e((_0=q8e?{}:X8e(_0))[vN])||$8e(_0,vN,function(){return this});var boe={IteratorPrototype:_0,BUGGY_SAFARI_ITERATORS:Coe},K8e=boe.IteratorPrototype,J8e=_m,Q8e=mm,Z8e=gf,eNe=M1,tNe=function(){return this},xoe=function(C,x,S,T){var D=x+" Iterator";return C.prototype=J8e(K8e,{next:Q8e(+!T,S)}),Z8e(C,D,!1,!0),eNe[D]=tNe,C},nNe=kr,iNe=lu,rNe=Cs,sNe=String,aNe=TypeError,cNe=Cs,uNe=vm,woe=Object.setPrototypeOf||("__proto__"in{}?function(){var C,x=!1,S={};try{(C=function(C,x,S){try{return nNe(iNe(Object.getOwnPropertyDescriptor(C,"__proto__").set))}catch(T){}}(Object.prototype))(S,[]),x=S instanceof Array}catch(T){}return function(T,D){return uNe(T),function(C){if(function(C){return rNe(C)||null===C}(C))return C;throw new aNe("Can't set "+sNe(C)+" as a prototype")}(D),cNe(T)&&(x?C(T,D):T.__proto__=D),T}}():void 0),hNe=Pn,fNe=Rs,gNe=xoe,mNe=O1,vNe=gf,Soe=Cm,Toe=M1,_Ne=moe.PROPER,hA=boe.BUGGY_SAFARI_ITERATORS,yN=bo("iterator"),fA="values",CNe=function(){return this},_N=function(C,x,S,T,D,R,P){gNe(S,x,T);var O,U,G,X=function(Ie){if(Ie===D&&ue)return ue;if(!hA&&Ie&&Ie in oe)return oe[Ie];switch(Ie){case"keys":case fA:case"entries":return function(){return new S(this,Ie)}}return function(){return new S(this)}},z=x+" Iterator",K=!1,oe=C.prototype,ae=oe[yN]||oe["@@iterator"]||D&&oe[D],ue=!hA&&ae||X(D),ye="Array"===x&&oe.entries||ae;if(ye&&(O=mNe(ye.call(new C)))!==Object.prototype&&O.next&&(vNe(O,z,!0,!0),Toe[z]=CNe),_Ne&&D===fA&&ae&&ae.name!==fA&&(K=!0,ue=function(){return fNe(ae,this)}),D)if(U={values:X(fA),keys:R?ue:X("keys"),entries:X("entries")},P)for(G in U)(hA||K||!(G in oe))&&Soe(oe,G,U[G]);else hNe({target:x,proto:!0,forced:hA||K},U);return P&&oe[yN]!==ue&&Soe(oe,yN,ue,{name:D}),Toe[x]=ue,U},pA=function(C,x){return{value:C,done:x}},bNe=ch,Doe=M1,xNe=_N,gA=pA,Poe="Array Iterator",wNe=vf.set,SNe=vf.getterFor(Poe);xNe(Array,"Array",function(C,x){wNe(this,{type:Poe,target:bNe(C),index:0,kind:x})},function(){var C=SNe(this),x=C.target,S=C.index++;if(!x||S>=x.length)return C.target=void 0,gA(void 0,!0);switch(C.kind){case"keys":return gA(S,!1);case"values":return gA(x[S],!1)}return gA([S,x[S]],!1)},"values"),Doe.Arguments=Doe.Array;var INe=Yr,ENe=gf,Roe=M1;for(var CN in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})ENe(INe[CN],CN),Roe[CN]=Roe.Array;var DNe=L8e,PNe=yc.f,koe=bo("metadata"),Moe=Function.prototype;void 0===Moe[koe]&&PNe(Moe,koe,{value:null}),ns("asyncDispose"),ns("dispose"),ns("metadata");var RNe=DNe,kNe=kr,bN=Ta("Symbol"),MNe=bN.keyFor,ONe=kNe(bN.prototype.valueOf),Ooe=bN.isRegisteredSymbol||function(C){try{return void 0!==MNe(ONe(C))}catch(x){return!1}};Pn({target:"Symbol",stat:!0},{isRegisteredSymbol:Ooe});for(var FNe=T1,Foe=Ta,LNe=kr,NNe=qw,BNe=bo,mA=Foe("Symbol"),Loe=mA.isWellKnownSymbol,Noe=Foe("Object","getOwnPropertyNames"),WNe=LNe(mA.prototype.valueOf),Boe=FNe("wks"),xN=0,Woe=Noe(mA),UNe=Woe.length;xN<UNe;xN++)try{var Uoe=Woe[xN];NNe(mA[Uoe])&&BNe(Uoe)}catch(C){}var Voe=function(C){if(Loe&&Loe(C))return!0;try{for(var x=WNe(C),S=0,T=Noe(Boe),D=T.length;S<D;S++)if(Boe[T[S]]==x)return!0}catch(R){}return!1};Pn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Voe}),ns("customMatcher"),ns("observable"),Pn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Ooe}),Pn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Voe}),ns("matcher"),ns("metadataKey"),ns("patternMatch"),ns("replaceAll");var wN=RNe,F1=_(wN),SN=kr,VNe=Qw,jNe=bl,HNe=vm,GNe=SN("".charAt),joe=SN("".charCodeAt),zNe=SN("".slice),Hoe=function(C){return function(x,S){var T,D,R=jNe(HNe(x)),P=VNe(S),O=R.length;return P<0||P>=O?C?"":void 0:(T=joe(R,P))<55296||T>56319||P+1===O||(D=joe(R,P+1))<56320||D>57343?C?GNe(R,P):T:C?zNe(R,P,P+2):D-56320+(T-55296<<10)+65536}},Goe={codeAt:Hoe(!1),charAt:Hoe(!0)},YNe=Goe.charAt,XNe=bl,$Ne=_N,Yoe=pA,Xoe="String Iterator",qNe=vf.set,KNe=vf.getterFor(Xoe);$Ne(String,"String",function(C){qNe(this,{type:Xoe,string:XNe(C),index:0})},function(){var C,x=KNe(this),S=x.string,T=x.index;return T>=S.length?Yoe(void 0,!0):(C=YNe(S,T),x.index+=C.length,Yoe(C,!1))});var $oe=aS.f("iterator"),JNe=_($oe);function od(C){return(od="function"==typeof F1&&"symbol"==typeof JNe?function(x){return typeof x}:function(x){return x&&"function"==typeof F1&&x.constructor===F1&&x!==F1.prototype?"symbol":typeof x})(C)}var QNe=_(aS.f("toPrimitive"));function qoe(C){var x=function(S,T){if("object"!==od(S)||null===S)return S;var D=S[QNe];if(void 0!==D){var R=D.call(S,"string");if("object"!==od(R))return R;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(S)}(C);return"symbol"===od(x)?x:String(x)}function Koe(C,x){for(var S=0;S<x.length;S++){var T=x[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),KD(C,qoe(T.key),T)}}function Do(C,x,S){return x&&Koe(C.prototype,x),S&&Koe(C,S),KD(C,"prototype",{writable:!1}),C}var C,vA="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",ZNe=vm,e7e=bl,TN=vA,Joe=kr("".replace),t7e=RegExp("^["+TN+"]+"),n7e=RegExp("(^|[^"+TN+"])["+TN+"]+$"),IN=function(C){return function(x){var S=e7e(ZNe(x));return 1&C&&(S=Joe(S,t7e,"")),2&C&&(S=Joe(S,n7e,"$1")),S}},EN={start:IN(1),end:IN(2),trim:IN(3)},i7e=moe.PROPER,Qoe=vA,o7e=EN.trim;Pn({target:"String",proto:!0,forced:(C="trim",xr(function(){return!!Qoe[C]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[C]()||i7e&&Qoe[C].name!==C}))},{trim:function(){return o7e(this)}});var s7e=Yr,a7e=Co,Ka=function(C,x){var S=a7e[C+"Prototype"],T=S&&S[x];if(T)return T;var D=s7e[C],R=D&&D.prototype;return R&&R[x]},l7e=Ka("String","trim"),c7e=ks,u7e=l7e,DN=String.prototype,fS=_(function(C){var x=C.trim;return"string"==typeof C||C===DN||c7e(DN,C)&&x===DN.trim?u7e:x}),d7e=xr,Zoe=function(C,x){var S=[][C];return!!S&&d7e(function(){S.call(null,x||function(){return 1},1)})},h7e=Pn,f7e=X8.indexOf,p7e=Zoe,AN=x1([].indexOf),ese=!!AN&&1/AN([1],1,-0)<0;h7e({target:"Array",proto:!0,forced:ese||!p7e("indexOf")},{indexOf:function(C){var x=arguments.length>1?arguments[1]:void 0;return ese?AN(this,C,x)||0:f7e(this,C,x)}});var g7e=Ka("Array","indexOf"),m7e=ks,v7e=g7e,PN=Array.prototype,Bo=_(function(C){var x=C.indexOf;return C===PN||m7e(PN,C)&&x===PN.indexOf?v7e:x}),y7e=Ka("Array","keys"),_7e=g0,C7e=Ms,b7e=ks,x7e=y7e,RN=Array.prototype,w7e={DOMTokenList:!0,NodeList:!0},kN=_(function(C){var x=C.keys;return C===RN||b7e(RN,C)&&x===RN.keys||C7e(w7e,_7e(C))?x7e:x}),S7e=Pn,tse=f0,T7e=QD,I7e=Cs,nse=Y8,E7e=p0,D7e=ch,A7e=Zw,P7e=bo,R7e=Up,k7e=tS("slice"),M7e=P7e("species"),MN=Array,O7e=Math.max;S7e({target:"Array",proto:!0,forced:!k7e},{slice:function(C,x){var S,T,D,R=D7e(this),P=E7e(R),O=nse(C,P),U=nse(void 0===x?P:x,P);if(tse(R)&&((T7e(S=R.constructor)&&(S===MN||tse(S.prototype))||I7e(S)&&null===(S=S[M7e]))&&(S=void 0),S===MN||void 0===S))return R7e(R,O,U);for(T=new(void 0===S?MN:S)(O7e(U-O,0)),D=0;O<U;O++,D++)O in R&&A7e(T,D,R[O]);return T.length=D,T}});var F7e=Ka("Array","slice"),L7e=ks,N7e=F7e,ON=Array.prototype,ise=function(C){var x=C.slice;return C===ON||L7e(ON,C)&&x===ON.slice?N7e:x},dh=_(ise),B7e=xr,U7e=bl,V7e=EN.trim,ose=vA,pS=Yr.parseInt,sse=Yr.Symbol,ase=sse&&sse.iterator,lse=/^[+-]?0x/i,j7e=kr(lse.exec),cse=8!==pS(ose+"08")||22!==pS(ose+"0x16")||ase&&!B7e(function(){pS(Object(ase))})?function(C,x){var S=V7e(U7e(C));return pS(S,x>>>0||(j7e(lse,S)?16:10))}:pS;Pn({global:!0,forced:parseInt!==cse},{parseInt:cse});var jp=_(Co.parseInt);Pn({target:"Array",stat:!0},{isArray:f0});var use=Co.Array.isArray,yA=_(use),H7e="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,G7e=TypeError,L1=function(C,x){if(C<x)throw new G7e("Not enough arguments");return C},dse=Yr,z7e=b1,Y7e=_s,X7e=H7e,q7e=Up,K7e=L1,J7e=dse.Function,Q7e=/MSIE .\./.test($w)||X7e&&function(){var C=dse.Bun.version.split(".");return C.length<3||"0"===C[0]&&(C[1]<3||"3"===C[1]&&"0"===C[2])}(),hse=function(C,x){var S=x?2:1;return Q7e?function(T,D){var R=K7e(arguments.length,1)>S,P=Y7e(T)?T:J7e(T),O=R?q7e(arguments,S):[],U=R?function(){z7e(P,this,O)}:P;return x?C(U,D):C(U)}:C},Z7e=Pn,fse=Yr,pse=hse(fse.setInterval,!0);Z7e({global:!0,bind:!0,forced:fse.setInterval!==pse},{setInterval:pse});var eBe=Pn,gse=Yr,mse=hse(gse.setTimeout,!0);eBe({global:!0,bind:!0,forced:gse.setTimeout!==mse},{setTimeout:mse});var tBe=_(Co.setTimeout),iBe=f0,rBe=TypeError,oBe=Object.getOwnPropertyDescriptor,sBe=ts&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(C){return C instanceof TypeError}}(),vse=h0,aBe=TypeError,lBe=Pn,cBe=pf,uBe=Y8,dBe=Qw,hBe=p0,fBe=sBe?function(C,x){if(iBe(C)&&!oBe(C,"length").writable)throw new rBe("Cannot set read only .length");return C.length=x}:function(C,x){return C.length=x},pBe=tre,gBe=z8,mBe=Zw,FN=function(C,x){if(!delete C[x])throw new aBe("Cannot delete property "+vse(x)+" of "+vse(C))},vBe=tS("splice"),yBe=Math.max,_Be=Math.min;lBe({target:"Array",proto:!0,forced:!vBe},{splice:function(C,x){var S,T,D,R,P,O,U=cBe(this),G=hBe(U),X=uBe(C,G),z=arguments.length;for(0===z?S=T=0:1===z?(S=0,T=G-X):(S=z-2,T=_Be(yBe(dBe(x),0),G-X)),pBe(G+S-T),D=gBe(U,T),R=0;R<T;R++)(P=X+R)in U&&mBe(D,R,U[P]);if(D.length=T,S<T){for(R=X;R<G-T;R++)O=R+S,(P=R+T)in U?U[O]=U[P]:FN(U,O);for(R=G;R>G-T+S;R--)FN(U,R-1)}else if(S>T)for(R=G-T;R>X;R--)O=R+S-1,(P=R+T-1)in U?U[O]=U[P]:FN(U,O);for(R=0;R<S;R++)U[R+X]=arguments[R+2];return fBe(U,G-T+S),D}});var CBe=Ka("Array","splice"),bBe=ks,xBe=CBe,LN=Array.prototype,pa=_(function(C){var x=C.splice;return C===LN||bBe(LN,C)&&x===LN.splice?xBe:x}),wBe=Ta,SBe=rS,TBe=oS,IBe=$l,EBe=kr([].concat),yse=wBe("Reflect","ownKeys")||function(C){var x=SBe.f(IBe(C)),S=TBe.f;return S?EBe(x,S(C)):x},_se=Ms,DBe=yse,ABe=Bp,PBe=yc,RBe=Cs,kBe=ym,Cse=Error,MBe=kr("".replace),OBe=String(new Cse("zxcasd").stack),bse=/\n\s*at [^:]*:[^\n]*/,FBe=bse.test(OBe),LBe=mm,NBe=!xr(function(){var C=new Error("a");return!("stack"in C)||(Object.defineProperty(C,"stack",LBe(1,7)),7!==C.stack)}),BBe=ym,UBe=NBe,xse=Error.captureStackTrace,VBe=M1,jBe=bo("iterator"),HBe=Array.prototype,wse=function(C){return void 0!==C&&(VBe.Array===C||HBe[jBe]===C)},GBe=g0,Sse=D8,zBe=w1,YBe=M1,XBe=bo("iterator"),gS=function(C){if(!zBe(C))return Sse(C,XBe)||Sse(C,"@@iterator")||YBe[GBe(C)]},$Be=Rs,qBe=lu,KBe=$l,JBe=h0,QBe=gS,ZBe=TypeError,NN=function(C,x){var S=arguments.length<2?QBe(C):x;if(qBe(S))return KBe($Be(S,C));throw new ZBe(JBe(C)+" is not iterable")},e9e=Rs,Tse=$l,t9e=D8,_A=function(C,x,S){var T,D;Tse(C);try{if(!(T=t9e(C,"return"))){if("throw"===x)throw S;return S}T=e9e(T,C)}catch(R){D=!0,T=R}if("throw"===x)throw S;if(D)throw T;return Tse(T),S},n9e=Wp,i9e=Rs,r9e=$l,o9e=h0,s9e=wse,a9e=p0,Ise=ks,l9e=NN,c9e=gS,Ese=_A,u9e=TypeError,CA=function(C,x){this.stopped=C,this.result=x},Dse=CA.prototype,C0=function(C,x,S){var T,D,R,P,O,U,G,z=!(!S||!S.AS_ENTRIES),K=!(!S||!S.IS_RECORD),oe=!(!S||!S.IS_ITERATOR),ae=!(!S||!S.INTERRUPTED),ue=n9e(x,S&&S.that),ye=function(Ue){return T&&Ese(T,"normal",Ue),new CA(!0,Ue)},Ie=function(Ue){return z?(r9e(Ue),ae?ue(Ue[0],Ue[1],ye):ue(Ue[0],Ue[1])):ae?ue(Ue,ye):ue(Ue)};if(K)T=C.iterator;else if(oe)T=C;else{if(!(D=c9e(C)))throw new u9e(o9e(C)+" is not iterable");if(s9e(D)){for(R=0,P=a9e(C);P>R;R++)if((O=Ie(C[R]))&&Ise(Dse,O))return O;return new CA(!1)}T=l9e(C,D)}for(U=K?C.next:T.next;!(G=i9e(U,T)).done;){try{O=Ie(G.value)}catch(Ue){Ese(T,"throw",Ue)}if("object"==typeof O&&O&&Ise(Dse,O))return O}return new CA(!1)},d9e=bl,h9e=Pn,f9e=ks,p9e=O1,bA=woe,Ase=_m,BN=ym,WN=mm,m9e=function(C,x){RBe(x)&&"cause"in x&&kBe(C,"cause",x.cause)},v9e=function(C,x,S,T){UBe&&(xse?xse(C,x):BBe(C,"stack",function(C,x){if(FBe&&"string"==typeof C&&!Cse.prepareStackTrace)for(;x--;)C=MBe(C,bse,"");return C}(S,T)))},y9e=C0,_9e=function(C,x){return void 0===C?arguments.length<2?"":x:d9e(C)},C9e=bo("toStringTag"),xA=Error,b9e=[].push,N1=function(C,x){var S,T=f9e(UN,this);bA?S=bA(new xA,T?p9e(this):UN):(S=T?this:Ase(UN),BN(S,C9e,"Error")),void 0!==x&&BN(S,"message",_9e(x)),v9e(S,N1,S.stack,1),arguments.length>2&&m9e(S,arguments[2]);var D=[];return y9e(C,b9e,{that:D}),BN(S,"errors",D),S};bA?bA(N1,xA):function(C,x,S){for(var T=DBe(x),D=PBe.f,R=ABe.f,P=0;P<T.length;P++){var O=T[P];_se(C,O)||S&&_se(S,O)||D(C,O,R(x,O))}}(N1,xA,{name:!0});var UN=N1.prototype=Ase(xA.prototype,{constructor:WN(1,N1),message:WN(1,""),name:WN(1,"AggregateError")});h9e({global:!0,constructor:!0,arity:2},{AggregateError:N1});var mS,B1,Pse,VN,wA="process"===Np(Yr.process),x9e=Ta,w9e=sS,S9e=ts,Rse=bo("species"),kse=function(C){var x=x9e(C);S9e&&x&&!x[Rse]&&w9e(x,Rse,{configurable:!0,get:function(){return this}})},T9e=ks,I9e=TypeError,vS=function(C,x){if(T9e(x,C))return C;throw new I9e("Incorrect invocation")},E9e=QD,D9e=h0,A9e=TypeError,Mse=function(C){if(E9e(C))return C;throw new A9e(D9e(C)+" is not a constructor")},Ose=$l,P9e=Mse,R9e=w1,k9e=bo("species"),Fse=function(C,x){var S,T=Ose(C).constructor;return void 0===T||R9e(S=Ose(T)[k9e])?x:P9e(S)},Lse=/(?:ipad|iphone|ipod).*applewebkit/i.test($w),cu=Yr,M9e=b1,O9e=Wp,Nse=_s,F9e=Ms,Bse=xr,Wse=mre,L9e=Up,Use=L8,N9e=L1,B9e=Lse,W9e=wA,jN=cu.setImmediate,HN=cu.clearImmediate,U9e=cu.process,GN=cu.Dispatch,V9e=cu.Function,Vse=cu.MessageChannel,j9e=cu.String,zN=0,yS={},jse="onreadystatechange";Bse(function(){mS=cu.location});var YN=function(C){if(F9e(yS,C)){var x=yS[C];delete yS[C],x()}},XN=function(C){return function(){YN(C)}},Hse=function(C){YN(C.data)},Gse=function(C){cu.postMessage(j9e(C),mS.protocol+"//"+mS.host)};jN&&HN||(jN=function(C){N9e(arguments.length,1);var x=Nse(C)?C:V9e(C),S=L9e(arguments,1);return yS[++zN]=function(){M9e(x,void 0,S)},B1(zN),zN},HN=function(C){delete yS[C]},W9e?B1=function(C){U9e.nextTick(XN(C))}:GN&&GN.now?B1=function(C){GN.now(XN(C))}:Vse&&!B9e?(VN=(Pse=new Vse).port2,Pse.port1.onmessage=Hse,B1=O9e(VN.postMessage,VN)):cu.addEventListener&&Nse(cu.postMessage)&&!cu.importScripts&&mS&&"file:"!==mS.protocol&&!Bse(Gse)?(B1=Gse,cu.addEventListener("message",Hse,!1)):B1=jse in Use("script")?function(C){Wse.appendChild(Use("script"))[jse]=function(){Wse.removeChild(this),YN(C)}}:function(C){setTimeout(XN(C),0)});var zse={set:jN,clear:HN},Yse=Yr,H9e=ts,G9e=Object.getOwnPropertyDescriptor,Xse=function(C){if(!H9e)return Yse[C];var x=G9e(Yse,C);return x&&x.value},$se=function(){this.head=null,this.tail=null};$se.prototype={add:function(C){var x={item:C,next:null},S=this.tail;S?S.next=x:this.head=x,this.tail=x},get:function(){var C=this.head;if(C)return null===(this.head=C.next)&&(this.tail=null),C.item}};var W1,$N,qN,KN,qse,Kse=$se,z9e=/ipad|iphone|ipod/i.test($w)&&"undefined"!=typeof Pebble,Y9e=/web0s(?!.*chrome)/i.test($w),U1=Yr,Jse=Wp,JN=zse.set,$9e=Kse,q9e=Lse,K9e=z9e,J9e=Y9e,QN=wA,Qse=U1.MutationObserver||U1.WebKitMutationObserver,Zse=U1.document,eae=U1.process,SA=U1.Promise,ZN=Xse("queueMicrotask");if(!ZN){var TA=new $9e,IA=function(){var C,x;for(QN&&(C=eae.domain)&&C.exit();x=TA.get();)try{x()}catch(S){throw TA.head&&W1(),S}C&&C.enter()};q9e||QN||J9e||!Qse||!Zse?!K9e&&SA&&SA.resolve?((KN=SA.resolve(void 0)).constructor=SA,qse=Jse(KN.then,KN),W1=function(){qse(IA)}):QN?W1=function(){eae.nextTick(IA)}:(JN=Jse(JN,U1),W1=function(){JN(IA)}):($N=!0,qN=Zse.createTextNode(""),new Qse(IA).observe(qN,{characterData:!0}),W1=function(){qN.data=$N=!$N}),ZN=function(C){TA.head||W1(),TA.add(C)}}var Q9e=ZN,V1=function(C){try{return{error:!1,value:C()}}catch(x){return{error:!0,value:x}}},b0=Yr.Promise,tae="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Z9e=!tae&&!wA&&"object"==typeof window&&"object"==typeof document,eWe=Yr,_S=b0,tWe=_s,nWe=Xie,iWe=ire,oWe=Z9e,sWe=tae,e7=XD,nae=_S&&_S.prototype,aWe=bo("species"),iae=!1,rae=tWe(eWe.PromiseRejectionEvent),lWe=nWe("Promise",function(){var C=iWe(_S),x=C!==String(_S);if(!x&&66===e7||!nae.catch||!nae.finally)return!0;if(!e7||e7<51||!/native code/.test(C)){var S=new _S(function(D){D(1)}),T=function(D){D(function(){},function(){})};if((S.constructor={})[aWe]=T,!(iae=S.then(function(){})instanceof T))return!0}return!x&&(oWe||sWe)&&!rae}),CS={CONSTRUCTOR:lWe,REJECTION_EVENT:rae,SUBCLASSING:iae},yf={},oae=lu,cWe=TypeError,uWe=function(C){var x,S;this.promise=new C(function(T,D){if(void 0!==x||void 0!==S)throw new cWe("Bad Promise constructor");x=T,S=D}),this.resolve=oae(x),this.reject=oae(S)};yf.f=function(C){return new uWe(C)};var t7,sae,dWe=Pn,EA=wA,wm=Yr,bS=Rs,hWe=Cm,fWe=gf,pWe=kse,gWe=lu,n7=_s,mWe=Cs,vWe=vS,yWe=Fse,aae=zse.set,i7=Q9e,CWe=V1,bWe=Kse,lae=vf,r7=b0,uae=yf,DA="Promise",dae=CS.CONSTRUCTOR,xWe=CS.REJECTION_EVENT,o7=lae.getterFor(DA),wWe=lae.set,xS=r7,s7=r7&&r7.prototype,hae=wm.TypeError,a7=wm.document,l7=wm.process,c7=uae.f,TWe=c7,IWe=!!(a7&&a7.createEvent&&wm.dispatchEvent),pae=function(C){var x;return!(!mWe(C)||!n7(x=C.then))&&x},gae=function(C,x){var S,T,D,R=x.value,P=1===x.state,O=P?C.ok:C.fail,U=C.resolve,G=C.reject,X=C.domain;try{O?(P||(2===x.rejection&&DWe(x),x.rejection=1),!0===O?S=R:(X&&X.enter(),S=O(R),X&&(X.exit(),D=!0)),S===C.promise?G(new hae("Promise-chain cycle")):(T=pae(S))?bS(T,S,U,G):U(S)):G(R)}catch(z){X&&!D&&X.exit(),G(z)}},mae=function(C,x){C.notified||(C.notified=!0,i7(function(){for(var S,T=C.reactions;S=T.get();)gae(S,C);C.notified=!1,x&&!C.rejection&&EWe(C)}))},vae=function(C,x,S){var T,D;IWe?((T=a7.createEvent("Event")).promise=x,T.reason=S,T.initEvent(C,!1,!0),wm.dispatchEvent(T)):T={promise:x,reason:S},!xWe&&(D=wm["on"+C])&&D(T)},EWe=function(C){bS(aae,wm,function(){var x,S=C.facade,T=C.value;if(yae(C)&&(x=CWe(function(){EA?l7.emit("unhandledRejection",T,S):vae("unhandledrejection",S,T)}),C.rejection=EA||yae(C)?2:1,x.error))throw x.value})},yae=function(C){return 1!==C.rejection&&!C.parent},DWe=function(C){bS(aae,wm,function(){var x=C.facade;EA?l7.emit("rejectionHandled",x):vae("rejectionhandled",x,C.value)})},j1=function(C,x,S){return function(T){C(x,T,S)}},H1=function(C,x,S){C.done||(C.done=!0,S&&(C=S),C.value=x,C.state=2,mae(C,!0))},u7=function(C,x,S){if(!C.done){C.done=!0,S&&(C=S);try{if(C.facade===x)throw new hae("Promise can't be resolved itself");var T=pae(x);T?i7(function(){var D={done:!1};try{bS(T,x,j1(u7,D,C),j1(H1,D,C))}catch(R){H1(D,R,C)}}):(C.value=x,C.state=1,mae(C,!1))}catch(D){H1({done:!1},D,C)}}};dae&&(s7=(xS=function(C){vWe(this,s7),gWe(C),bS(t7,this);var x=o7(this);try{C(j1(u7,x),j1(H1,x))}catch(S){H1(x,S)}}).prototype,(t7=function(C){wWe(this,{type:DA,done:!1,notified:!1,parent:!1,reactions:new bWe,rejection:!1,state:0,value:void 0})}).prototype=hWe(s7,"then",function(C,x){var S=o7(this),T=c7(yWe(this,xS));return S.parent=!0,T.ok=!n7(C)||C,T.fail=n7(x)&&x,T.domain=EA?l7.domain:void 0,0===S.state?S.reactions.add(T):i7(function(){gae(T,S)}),T.promise}),sae=function(){var C=new t7,x=o7(C);this.promise=C,this.resolve=j1(u7,x),this.reject=j1(H1,x)},uae.f=c7=function(C){return C===xS||void 0===C?new sae(C):TWe(C)}),dWe({global:!0,constructor:!0,wrap:!0,forced:dae},{Promise:xS}),fWe(xS,DA,!1,!0),pWe(DA);var _ae=bo("iterator"),Cae=!1;try{var AWe=0,bae={next:function(){return{done:!!AWe++}},return:function(){Cae=!0}};bae[_ae]=function(){return this},Array.from(bae,function(){throw 2})}catch(C){}var xae=function(C,x){try{if(!x&&!Cae)return!1}catch(D){return!1}var S=!1;try{var T={};T[_ae]=function(){return{next:function(){return{done:S=!0}}}},C(T)}catch(D){}return S},PWe=b0,AA=CS.CONSTRUCTOR||!xae(function(C){PWe.all(C).then(void 0,function(){})}),RWe=Rs,kWe=lu,MWe=yf,OWe=V1,FWe=C0;Pn({target:"Promise",stat:!0,forced:AA},{all:function(C){var x=this,S=MWe.f(x),T=S.resolve,D=S.reject,R=OWe(function(){var P=kWe(x.resolve),O=[],U=0,G=1;FWe(C,function(X){var z=U++,K=!1;G++,RWe(P,x,X).then(function(oe){K||(K=!0,O[z]=oe,--G||T(O))},D)}),--G||T(O)});return R.error&&D(R.value),S.promise}}),Pn({target:"Promise",proto:!0,forced:CS.CONSTRUCTOR,real:!0},{catch:function(C){return this.then(void 0,C)}});var BWe=Rs,WWe=lu,UWe=yf,VWe=V1,jWe=C0;Pn({target:"Promise",stat:!0,forced:AA},{race:function(C){var x=this,S=UWe.f(x),T=S.reject,D=VWe(function(){var R=WWe(x.resolve);jWe(C,function(P){BWe(R,x,P).then(S.resolve,T)})});return D.error&&T(D.value),S.promise}});var HWe=yf;Pn({target:"Promise",stat:!0,forced:CS.CONSTRUCTOR},{reject:function(C){var x=HWe.f(this);return(0,x.reject)(C),x.promise}});var GWe=$l,zWe=Cs,YWe=yf,wae=function(C,x){if(GWe(C),zWe(x)&&x.constructor===C)return x;var S=YWe.f(C);return(0,S.resolve)(x),S.promise},XWe=Pn,$We=b0,qWe=CS.CONSTRUCTOR,KWe=wae,JWe=Ta("Promise"),QWe=!qWe;XWe({target:"Promise",stat:!0,forced:!0},{resolve:function(C){return KWe(QWe&&this===JWe?$We:this,C)}});var ZWe=Rs,eUe=lu,tUe=yf,nUe=V1,iUe=C0;Pn({target:"Promise",stat:!0,forced:AA},{allSettled:function(C){var x=this,S=tUe.f(x),T=S.resolve,D=S.reject,R=nUe(function(){var P=eUe(x.resolve),O=[],U=0,G=1;iUe(C,function(X){var z=U++,K=!1;G++,ZWe(P,x,X).then(function(oe){K||(K=!0,O[z]={status:"fulfilled",value:oe},--G||T(O))},function(oe){K||(K=!0,O[z]={status:"rejected",reason:oe},--G||T(O))})}),--G||T(O)});return R.error&&D(R.value),S.promise}});var rUe=Rs,oUe=lu,sUe=Ta,aUe=yf,lUe=V1,cUe=C0,Sae="No one promise resolved";Pn({target:"Promise",stat:!0,forced:AA},{any:function(C){var x=this,S=sUe("AggregateError"),T=aUe.f(x),D=T.resolve,R=T.reject,P=lUe(function(){var O=oUe(x.resolve),U=[],G=0,X=1,z=!1;cUe(C,function(K){var oe=G++,ae=!1;X++,rUe(O,x,K).then(function(ue){ae||z||(z=!0,D(ue))},function(ue){ae||z||(ae=!0,U[oe]=ue,--X||R(new S(U,Sae)))})}),--X||R(new S(U,Sae))});return P.error&&R(P.value),T.promise}});var uUe=yf;Pn({target:"Promise",stat:!0},{withResolvers:function(){var C=uUe.f(this);return{promise:C.promise,resolve:C.resolve,reject:C.reject}}});var fUe=Ta,pUe=_s,gUe=Fse,Tae=wae,mUe=b0&&b0.prototype;Pn({target:"Promise",proto:!0,real:!0,forced:!!b0&&xr(function(){mUe.finally.call({then:function(){}},function(){})})},{finally:function(C){var x=gUe(this,fUe("Promise")),S=pUe(C);return this.then(S?function(T){return Tae(x,C()).then(function(){return T})}:C,S?function(T){return Tae(x,C()).then(function(){throw T})}:C)}});var Iae=Co.Promise,x0=_(Iae),vUe=Cs,yUe=Np,_Ue=bo("match"),bUe=TypeError,h7=function(C){if(function(C){var x;return vUe(C)&&(void 0!==(x=C[_Ue])?!!x:"RegExp"===yUe(C))}(C))throw new bUe("The method doesn't accept regular expressions");return C},xUe=bo("match"),f7=function(C){var x=/./;try{"/./"[C](x)}catch(S){try{return x[xUe]=!1,"/./"[C](x)}catch(T){}}return!1},wUe=Pn,TUe=V8,Eae=bl,IUe=h7,EUe=vm,DUe=f7,AUe=x1("".slice),PUe=Math.min;wUe({target:"String",proto:!0,forced:!DUe("endsWith")},{endsWith:function(C){var x=Eae(EUe(this));IUe(C);var S=arguments.length>1?arguments[1]:void 0,T=x.length,D=void 0===S?T:PUe(TUe(S),T),R=Eae(C);return AUe(x,D-R.length,D)===R}});var RUe=Ka("String","endsWith"),kUe=ks,MUe=RUe,p7=String.prototype,Dae=_(function(C){var x=C.endsWith;return"string"==typeof C||C===p7||kUe(p7,C)&&x===p7.endsWith?MUe:x}),Aae=kr,OUe=lu,FUe=Cs,LUe=Ms,Pae=Up,NUe=Yw,Rae=Function,BUe=Aae([].concat),WUe=Aae([].join),g7={},kae=NUe?Rae.bind:function(C){var x=OUe(this),S=x.prototype,T=Pae(arguments,1),D=function(){var R=BUe(T,Pae(arguments));return this instanceof D?function(P,O,U){if(!LUe(g7,O)){for(var G=[],X=0;X<O;X++)G[X]="a["+X+"]";g7[O]=Rae("C,a","return new C("+WUe(G,",")+")")}return g7[O](P,U)}(x,R.length,R):x.apply(C,R)};return FUe(S)&&(D.prototype=S),D};Pn({target:"Function",proto:!0,forced:Function.bind!==kae},{bind:kae});var UUe=Ka("Function","bind"),VUe=ks,jUe=UUe,m7=Function.prototype,Oae=function(C){var x=C.bind;return C===m7||VUe(m7,C)&&x===m7.bind?jUe:x},v7=_(Oae),Fae=Yr,HUe=xr,GUe=bl,zUe=EN.trim,XUe=kr("".charAt),PA=Fae.parseFloat,Lae=Fae.Symbol,Nae=Lae&&Lae.iterator,Bae=1/PA("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")!=-1/0||Nae&&!HUe(function(){PA(Object(Nae))})?function(C){var x=zUe(GUe(C)),S=PA(x);return 0===S&&"-"===XUe(x,0)?-0:S}:PA;Pn({global:!0,forced:parseFloat!==Bae},{parseFloat:Bae});var y7=_(Co.parseFloat),$Ue=Pn,KUe=V8,Wae=bl,JUe=h7,QUe=vm,ZUe=f7,eVe=x1("".slice),tVe=Math.min;$Ue({target:"String",proto:!0,forced:!ZUe("startsWith")},{startsWith:function(C){var x=Wae(QUe(this));JUe(C);var S=KUe(tVe(arguments.length>1?arguments[1]:void 0,x.length)),T=Wae(C);return eVe(x,S,S+T.length)===T}});var Uae,nVe=Ka("String","startsWith"),iVe=ks,rVe=nVe,_7=String.prototype,oVe=_(function(C){var x=C.startsWith;return"string"==typeof C||C===_7||iVe(_7,C)&&x===_7.startsWith?rVe:x});function sVe(C){var x,S,T="0x";if(/^(rgb|RGB)/.test(C)){var D=C.replace(/[^\d,.]/g,"").split(",");for(S=0;S<3;++S)1==(x=Number(D[S]).toString(16)).length&&(x="0"+x),T+=x;4==D.length?(1==(x=Math.round(255*Number(D[S])).toString(16)).length&&(x="0"+x),T+=x):T+="ff"}else if("transparent"==C)T+="00000000";else if(/^#[0-9a-fA-f]{6}$/.test(C))T+=C.replace(/#/,"")+"ff";else if(/^#[0-9a-fA-f]{3}$/.test(C)){for(S=0;S<3;++S)T+=C[S]+C[S];T+="ff"}else T="-1";return Number(T)}function aVe(C){if(C>4294967295||C<0)return null;var x;if(he.bHTML5Edition)x="rgba("+Math.floor(C/16777216)+","+Math.floor(C/65536)%256+","+Math.floor(C/256)%256+","+C%256/255+")";else if(C%256==0)x="transparent";else{for(x=Math.floor(C/256).toString(16);6!=x.length;)x="0"+x;x="#"+x}return x}function lVe(C){var x,S=(C=C||window.event).wheelDelta,T=C.detail;return S&&(x=S/120),T&&(x=-(T%3==0?T/3:T)),x}fS(String.prototype)||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Uae={registedClass:[],registedObjs:[]};var w0={LEFT:0,MIDDLE:1,RIGHT:2};function cVe(C){var x=C||window.event;return null==x.which?x.button<2?w0.LEFT:4==x.button?w0.MIDDLE:w0.RIGHT:x.which<2?w0.LEFT:2==x.which?w0.MIDDLE:w0.RIGHT}var C7,b7,uVe=/[\-#$\^*()+\[\]{}|\\,.?\s]/g,x7={"&amp;":"&","&gt;":">","&lt;":"<","&#x60;":"`","&#x2F;":"/","&quot;":'"',"&#x27;":"'"},w7={};function dVe(C){return C.replace(/\\u([a-f\d]{4})/gi,function(x,S){return String.fromCharCode(jp(S,16))})}function hVe(C){return(C+"").replace(function(){if(C7)return C7;var x="";return H.each(x7,function(S){x+=S+"|"}),x=dh(x).call(x,0,-1),C7=new RegExp(x,"g")}(),function(x){return w7[x]})}function fVe(C){return C.replace(uVe,"\\$&")}function pVe(C){return C.replace(function(){if(b7)return b7;var x="";return H.each(w7,function(S){x+=S+"|"}),x+="&#(\\d{1,5});",b7=new RegExp(x,"g")}(),function(x,S){return x7[x]||String.fromCharCode(+S)})}H.each(x7,function(C,x){w7[C]=x});var G1,z1=void 0,Y1=function(C){return"function"==typeof C},Vae=function(C){return yA?yA(C):C instanceof Array},jae=function(C){return!1===C||C===z1||null===C},S7="undefined",gVe=("undefined"==typeof TypeError?"undefined":od(TypeError))===S7?Error:TypeError;if(("undefined"==typeof process?"undefined":od(process))!==S7&&process.nextTick)G1=process.nextTick;else if(("undefined"==typeof MessageChannel?"undefined":od(MessageChannel))!==S7){var Hae=new MessageChannel,T7=[];Hae.port1.onmessage=function(){T7.length&&T7.shift()()},G1=function(C){T7.push(C),Hae.port2.postMessage(0)}}else G1=function(C){tBe(C,0)};function mVe(C){G1(function(){throw C})}function vVe(C){return this.then(C,z1)}function Gae(C){return this.then(z1,C)}function zae(C,x){return this.then(function(S){return Y1(C)?C.apply(null,Vae(S)?S:[S]):Js.onlyFuncs?S:C},x||z1)}function yVe(C){function x(){C()}return this.then(x,x),this}function _Ve(C){return this.then(function(x){return Y1(C)?C.apply(null,Vae(x)?pa(x).call(x,0,0,void 0)&&x:[void 0,x]):Js.onlyFuncs?x:C},function(x){return C(x)})}function CVe(C){return this.then(z1,C?function(x){throw C(x),x}:mVe)}var Js=function(){function C(x){Eo(this,C),this.alwaysAsyncFn=null,this.status=0,this.pendings=[],this.promise={then:function(S,T){var D=new C;return this.pendings.push([function(R){try{jae(S)?D.resolve(R):D.resolve(Y1(S)?S(R):C.onlyFuncs?R:S)}catch(P){D.reject(P)}},function(R){if((jae(T)||!Y1(T)&&C.onlyFuncs)&&D.reject(R),T)try{D.resolve(Y1(T)?T(R):T)}catch(P){D.reject(P)}}]),0!==this.status&&this.alwaysAsyncFn(this.execCallbacks),D.promise},success:vVe,error:Gae,otherwise:Gae,apply:zae,spread:zae,ensure:yVe,nodify:_Ve,rethrow:CVe,isPending:function(){return 0===this.status},getStatus:function(){return this.status}},this.alwaysAsyncFn=(z1!==x?x:C.alwaysAsync)?G1:function(S){S()},this.promise.toSource=this.promise.toString=this.promise.valueOf=function(){return void 0===this.value?this:this.value}}return Do(C,[{key:"resolve",value:function(x){var S,T=!1;function D(P){return function(O){return T?void 0:(T=!0,P(O))}}if(this.status)return this;try{var R=!(!(S=x)||!od(S).match(/function|object/))&&x.then;if(Y1(R)){if(x===this.promise)throw new gVe("Promise can't resolve itself");return R.call(x,D(this.resolve),D(this.reject)),this}}catch(P){return D(this.reject)(P),this}return this.alwaysAsyncFn(function(){this.value=x,this.status=1,this.execCallbacks()}),this}},{key:"reject",value:function(x){return this.status||this.alwaysAsyncFn(function(){try{throw x}catch(S){this.value=S}this.status=-1,this.execCallbacks()}),this}},{key:"execCallbacks",value:function(){if(0!==this.status){var x,S=this.pendings,T=0,D=S.length,R=~this.status?0:1;for(this.pendings=[];T<D;T++)(x=S[T][R])&&x(this.value)}}}]),C}();Js.deferred=Js,Js.defer=Js,Js.nextTick=G1,Js.alwaysAsync=!0,Js.onlyFuncs=!0,Js.resolve=function(C){return new Js(!0).resolve(C).promise},Js.resolved=Js.resolve,Js.fulfilled=Js.resolve,Js.reject=function(C){return new Js(!0).reject(C).promise},Js.rejected=Js.reject;var I7,RA,E7,kA=window;function bVe(C){return C.which=null==(C=C||window.event).which?C.button<2?1:4==C.button?2:3:C.which<2?1:2==C.which?2:3,C}function xVe(C,x){return C.currentStyle?C.currentStyle[x]:window.getComputedStyle?document.defaultView.getComputedStyle(C,null)[x]:null}function Yae(C){var x=od(C);return null==C||"object"!==x&&"function"!==x}function wVe(C,x,S,T){x=x||"&",S=S||"=",H.isUndefined(T)&&(T=le);var D=[];return H.each(C,function(R,P){var O=H.urlEncode(P);Yae(R)?(D.push(O),H.isDef(R)&&D.push(S,H.urlEncode(R+"")),D.push(x)):H.isArray(R)&&R.length&&H.each(R,function(U){Yae(U)&&(D.push(O,T?H.urlEncode("[]"):""),H.isDef(U)&&D.push(S,H.urlEncode(U+"")),D.push(x))})}),D.pop(),D.join("")}function SVe(C,x,S){if(!H.isString(C)||!(C=fS(H).call(H,C)))return{};S=S||"=";for(var T,D,R,P={},O=H.urlDecode,U=C.split(x=x||"&"),G=0,X=U.length;G<X;++G){if(-1===(T=Bo(H).call(H,S,U[G])))D=O(U[G]),R=void 0;else{D=O(U[G].substring(0,T)),R=U[G].substring(T+1);try{R=O(R)}catch(z){H.error("decodeURIComponent error : "+R),H.error(z)}Dae(H).call(H,D,"[]")&&(D=D.substring(0,D.length-2))}D in P?H.isArray(P[D])?P[D].push(R):P[D]=[P[D],R]:P[D]=R}return P}kA&&H.isFunction(kA.__zone_symbol__Promise)&&(RA=kA.__zone_symbol__Promise),I7=self&&x0||kA&&x0?x0:Js,RA||(RA=I7),H.each({"&amp;":"&","&gt;":">","&lt;":"<","&#x60;":"`","&#x2F;":"/","&quot;":'"',"&#x27;":"'"},function(C,x){});var Xae="ds-dwt-loaderBar",D7="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjAiIHdpZHRoPSIxMDBweCIgaGVpZ2h0PSIxMDBweCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjE2IiBmaWxsPSIjZmU4ZTE0Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iMTQuMzQ0IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSg0NSA2NCA2NCkiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjY0IiByPSIxMi41MzEiIGZpbGw9IiNmZThlMTQiIHRyYW5zZm9ybT0icm90YXRlKDkwIDY0IDY0KSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjEwLjc1IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNjQgNjQpIi8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iMTAuMDYzIiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgxODAgNjQgNjQpIi8+PGNpcmNsZSBjeD0iMTYiIGN5PSI2NCIgcj0iOC4wNjMiIGZpbGw9IiNmZThlMTQiIHRyYW5zZm9ybT0icm90YXRlKDIyNSA2NCA2NCkiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjY0IiByPSI2LjQzOCIgZmlsbD0iI2ZlOGUxNCIgdHJhbnNmb3JtPSJyb3RhdGUoMjcwIDY0IDY0KSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iNjQiIHI9IjUuMzc1IiBmaWxsPSIjZmU4ZTE0IiB0cmFuc2Zvcm09InJvdGF0ZSgzMTUgNjQgNjQpIi8+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHZhbHVlcz0iNDUgNjQgNjQ7OTAgNjQgNjQ7MTM1IDY0IDY0OzE4MCA2NCA2NDsyMjUgNjQgNjQ7MjcwIDY0IDY0OzMxNSA2NCA2NDswIDY0IDY0IiBjYWxjTW9kZT0iZGlzY3JldGUiIGR1cj0iNzIwbXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9nPjwvc3ZnPg==";function $ae(C){var x,S,T,D="",R="230px",P="240px",O="",U="";return C&&(C.background&&(D=";background:"+C.background),C.width&&(R=C.width),C.height&&(P=C.height),C.imageSource&&(x=C.imageSource)),x||(x=D7),T=jp(R)/2,H.isNumber(T)&&T>0&&(U=";width:"+T+"px"),S=jp(P)/2,H.isNumber(S)&&S>0&&(O=";height:"+S+"px"),['<div align="center" ','class="',Xae,'" ','style="margin:0 auto;max-width:',R,";max-height:",P,";line-height:",P,D,'"><img style="user-select:none',O,U,';max-width:230px;max-height:240px;vertical-align:middle" src="',x,'" draggable="false" /></div>'].join("")}var uu,wS=window,bs=document;function TVe(C,x){for(var S=0;S<C.length;++S)if(C[S]==x)return le;return fe}function qae(C){var x=bs.createEvent("MouseEvents");return null==x||x.initMouseEvent(C.type,C.bubbles,C.cancelable,wS,C.detail,C.screenX,C.screenY,C.clientX,C.clientY,C.ctrlKey,C.altKey,C.shiftKey,C.metaKey,C.button,C.relatedTarget),x}function Kae(C){var x;null===(x=bs.body)||void 0===x||x.dispatchEvent(qae(C))}function Jae(C,x){if(uu){var S=uu.style;S.backgroundColor=["rgba(",x,",",x,",",x,",",C,")"].join(""),S.filter=["alpha(opacity=",100*C,")"].join(""),S.opacity=S.MozOpacity=C}}var P7,xl,Sm={pendingDialogStack:[],pendingDialogTopmostStack:[],opacity:.1,grayHex:128,_updateStacking:function(C){var x,S;0!=(x=this.pendingDialogStack).length?(1!=C&&function EVe(C,x){uu===E7?function(S,T){if(uu=bs.createElement("div")){var D=uu.style;D.position="fixed",D.display="block",D.left=D.top=D.margin=D.padding=0,Jae(S,T),D.zIndex=5e5,D.width=D.height="100%",he.bIE&&he.IEVersion<10&&(uu.innerHTML='<iframe src="javascript:\'\'" style="background:none;margin:0px auto;border:0;width:100%;height:100%;position:relative;z-index:9999;"></iframe>'),bs.createEvent&&H.addEventListener(uu,"click",Kae)}}(C,x):Jae(C,x),bs.body&&!bs.body.contains(uu)&&bs.body.appendChild(uu)}(Sm.opacity,Sm.grayHex),S=5e5,H.each(x,function(T){S++,T._dlgInfo.mask&&(T._dlgInfo.mask.style.zIndex=S++),T.style.zIndex=S})):uu!==E7&&(H.removeEventListener(uu,"click",Kae),bs&&bs.body&&bs.body.removeChild(uu),uu=E7)},pushDialog:function(C,x){var S,T,D=this;if(C.getBoundingClientRect(),(T=C.bTopmost?D.pendingDialogTopmostStack:D.pendingDialogStack).length>=1e3)H.error("Too many modal dialogs.");else{if((S=bs.createElement("div")).style.zIndex="10000",S.className="dynamsoft-backdrop",1==x?(S.style.left=0,S.style.top=0,S.style.position="absolute"):(S.style.left=0,S.style.top=0,S.style.width="100%",S.style.height="100%",S.style.position="fixed"),bs.createEvent&&H.addEventListener(S,"click",function(P){if(C.dispatchEvent){var O=qae(P);C.dispatchEvent(O)}}),C.parentNode.insertBefore(S,C.nextSibling),C._dlgInfo.mask=S,C.bTopmost){var R=501e3;C._dlgInfo.mask&&(C._dlgInfo.mask.style.zIndex=R),C.style.zIndex=R+1}T.push(C),D._updateStacking(x)}},removeDialog:function(C){var x,S,T,D=this;-1!=(x=H.isArray(T=C.bTopmost?D.pendingDialogTopmostStack:D.pendingDialogStack)?Bo(H).call(H,C,T):-1)&&(pa(T).call(T,x,1),(S=C._dlgInfo.mask).parentNode&&S.parentNode.removeChild(S),C._dlgInfo.mask=null,D._updateStacking())}};function MA(C,x){var S,K,oe,ae,ue,ye,Ie,T=this,D=!0,R=1==x?"absolute":"fixed",P="50%",O="50%",U="",G="",X=null;if(T._dlgInfo&&T._dlgInfo.styleConfig){var z=T._dlgInfo.styleConfig;H.isString(z.style)?(S=z.style,D=!1):(H.isString(z.position)&&(R=z.position,D=!1),(H.isString(z.left)||H.isNumber(z.left))&&(O=z.left,D=!1),(H.isString(z.top)||H.isNumber(z.top))&&(P=z.top,D=!1),(H.isString(z.width)||H.isNumber(z.width))&&(U=z.width,D=!1),(H.isString(z.height)||H.isNumber(z.height))&&(G=z.height,D=!1),H.isString(z.transform)&&(X=z.transform,D=!1))}T.open?H.error("showDialog called on open dialog."):(T.open=le,T.removeAttribute("closed"),T.setAttribute("open","open"),S?T.setAttribute("style",S):(D?K=he.bIE&&"fixed"==R?["display:block;position:fixed;top:35%;margin:0 auto;left:0;right:0"]:["display:block;position:",R,";left:50%;top:50%;transform:translate(-50%,-50%)"]:(K=["display:block;position:",R,";left:",O,";top:",P,";width:",U,";height:",G],X&&(K.push(";transform:"),K.push(X))),K.push("DIALOG"==T.tagName?";margin:0;border-radius:6px;box-shadow:2px 2px 0 0 rgba(0,0,0,.05);-webkit-box-sizing:border-box;box-sizing:border-box;":";border:0;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;"),T.setAttribute("style",K.join(""))),function IVe(C){var x;return wS.getComputedStyle?x=wS.getComputedStyle(C):C.currentStyle&&(x=C.currentStyle),x&&"absolute"!=x.position||"auto"!=C.style.top&&""!=C.style.top||"auto"!=C.style.bottom&&""!=C.style.bottom?fe:!function(S){for(var T=0;T<bs.styleSheets.length;++T){var D=bs.styleSheets[T],R=void 0,P=void 0,O=void 0,U=void 0;try{R=D.cssRules,P=bs.querySelectorAll}catch(K){}if(R&&P)for(var G=0;G<R.length;++G){O=R[G],U=fe;try{U=P(O.selectorText)}catch(K){}if(U&&TVe(U,S)){var X=O.style.getPropertyValue("top"),z=O.style.getPropertyValue("bottom");if(X&&"auto"!=X||z&&"auto"!=z)return le}}}return fe}(C)}(T)&&(Ie=((null===(ae=bs.body)||void 0===ae?void 0:ae.scrollTop)||(null===(ue=bs.documentElement)||void 0===ue?void 0:ue.scrollTop)||0)+((wS.innerHeight?wS.innerHeight:null===(ye=bs.documentElement)||void 0===ye?void 0:ye.clientHeight)-(oe=T).offsetHeight)/2,oe.style.top=Ie+"px",oe._dlgInfo.isTopOverridden=le),C&&(T._dlgInfo.modal=le,Sm.pushDialog(T,x)))}function Qae(C){var x=this;return x.open||H.error("closeDialog called on closed dialog."),x.open=fe,x.removeAttribute("open"),x.setAttribute("closed","closed"),x.style.display="none",void 0!==C&&(x.returnValue=C),x._dlgInfo.isTopOverridden&&(x.style.top="auto"),x._dlgInfo.modal&&Sm.removeDialog(x),x.returnValue}function Zae(C){Sm.opacity=H.isNumber(C.opacity)?C.opacity:.1,Sm.grayHex=H.isNumber(C.grayHex)?C.grayHex:128}function DVe(C){var x,S,T,D,R;if(!xl.dlgMask){var P,O,U,G,X=!1;if(C&&(G={},C.style?G.style=C.style:((H.isString(C.top)||H.isNumber(C.top))&&(G.top=C.top),(H.isString(C.left)||H.isNumber(C.left))&&(G.left=C.left),H.isString(C.position)&&(G.position=C.position)),C.confined&&(document.getElementsByClassName("dwt-viewer-imageEditor-fullScreen")[0]||(X=C.confined)),(H.isString(C.width)||H.isNumber(C.width))&&(S=C.width),(H.isString(C.height)||H.isNumber(C.height))&&(T=C.height),H.isString(C.background)&&(D=C.background),H.isString(C.imageSource)&&(R=C.imageSource),Zae(C),X&&C.wrapperEl&&H.isString(O=C.wrapperEl)&&(O=bs.getElementById(O))),!R){var z;if(window&&window.Dynamsoft){var K=window.Dynamsoft.DWT;K&&K.CustomizableDisplayInfo&&(z=K.CustomizableDisplayInfo)}z?(he.bIE&&H.isString(z.loaderBarSourceIE)&&""!=z.loaderBarSourceIE&&(R=z.loaderBarSourceIE),!R&&H.isString(z.loaderBarSource)&&""!=z.loaderBarSource&&(R=z.loaderBarSource)):R=D7}O&&(U=O.getBoundingClientRect(),O.style.position="relative"),(P=bs.createElement("div"))&&(P.className="dynamsoft-dialog-wrap",P.innerHTML=$ae({width:S,height:T,backgroundColor:D,imageSource:R}),O?(O.appendChild(P),P.style.position="absolute",P.style.top="50%",P.style.left="50%",P.style.transform="translate(-50%, -50%)"):null===(x=bs.body)||void 0===x||x.appendChild(P),X&&U&&(xl.preOnresize=!!window.onresize&&window.onresize,xl.preOnscroll=!!window.onscroll&&window.onscroll),xl.dlgMask=P,P7.setup(P,X),G&&(P._dlgInfo.styleConfig=G),O&&(P._dlgInfo.wrapperEl=O),P.showModal())}}function AVe(){var C,x=xl.dlgMask;x&&(x.close(),x._dlgInfo&&x._dlgInfo.wrapperEl?(x._dlgInfo.wrapperEl.removeChild(x),x._dlgInfo.wrapperEl=null):null===(C=bs.body)||void 0===C||C.removeChild(x),xl.dlgMask=!1),window.onresize=xl.preOnresize?xl.preOnresize:null,xl.preOnresize=!1,window.onscroll=xl.preOnscroll?xl.preOnscroll:null,xl.preOnscroll=!1}P7={setup:function(C,x){C.show=v7(MA).call(MA,C,fe,x),C.showModal=v7(MA).call(MA,C,le,x),C.close=v7(Qae).call(Qae,C),C._dlgInfo={}}},xl={dlgMask:!1,preOnresize:!1,preOnscroll:!1};var X1,OA,PVe=function(){function C(x){Eo(this,C);var S=x.createElement("div"),T=x.createElement("div");T.style&&(this.div=T,this.container=S,this.docElem=x.documentElement,T.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",this.leadingWhitespace=3===T.firstChild.nodeType,this.tbody=!T.getElementsByTagName("tbody").length,this.htmlSerialize=!!T.getElementsByTagName("link").length,T.style.cssText="float:left;opacity:.5",this.opacity="0.5"===T.style.opacity,this.cssFloat=!!T.style.cssFloat,T.style.backgroundClip="content-box",T.cloneNode(!0).style.backgroundClip="",this.clearCloneStyle="content-box"===T.style.backgroundClip,(S=document.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",T.innerHTML="",S.appendChild(T),this.boxSizing=""===T.style.boxSizing||""===T.style.MozBoxSizing||""===T.style.WebkitBoxSizing)}return Do(C,[{key:"reliableHiddenOffsets",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableHiddenOffsetsVal}},{key:"boxSizingReliable",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.boxSizingReliableVal}},{key:"pixelMarginRight",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.pixelMarginRightVal}},{key:"pixelPosition",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.pixelPositionVal}},{key:"reliableMarginRight",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableMarginRightVal}},{key:"reliableMarginLeft",value:function(){return null==this.pixelPositionVal&&this.computeStyleTests(),this.reliableMarginLeftVal}},{key:"computeStyleTests",value:function(){var x,S,T=this.div;this.docElem&&this.docElem.appendChild(this.container),T.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",this.pixelPositionVal=this.boxSizingReliableVal=this.reliableMarginLeftVal=!1,this.pixelMarginRightVal=this.reliableMarginRightVal=!0,window.getComputedStyle&&(S=window.getComputedStyle(T),this.pixelPositionVal="1%"!==(S||{}).top,this.reliableMarginLeftVal="2px"===(S||{}).marginLeft,this.boxSizingReliableVal="4px"===(S||{width:"4px"}).width,T.style.marginRight="50%",this.pixelMarginRightVal="4px"===(S||{marginRight:"4px"}).marginRight,(x=T.appendChild(document.createElement("div"))).style.cssText=T.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",x.style.marginRight=x.style.width="0",T.style.width="1px",this.reliableMarginRightVal=!y7((window.getComputedStyle(x)||{}).marginRight),T&&T.removeChild(x)),T.style.display="none",this.reliableHiddenOffsetsVal=0===T.getClientRects().length,this.reliableHiddenOffsetsVal&&(T.style.display="",T.innerHTML="<table><tr><td></td><td>t</td></tr></table>",T.childNodes[0].style.borderCollapse="separate",(x=T.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",this.reliableHiddenOffsetsVal=0===x[0].offsetHeight,this.reliableHiddenOffsetsVal&&(x[0].style.display="",x[1].style.display="none",this.reliableHiddenOffsetsVal=0===x[0].offsetHeight)),this.docElem&&this.docElem.removeChild(this.container)}}]),C}(),sd=new PVe(document),ele=sd.docElem,tle=H.sizzle,RVe=/^margin/,kVe=/^(top|right|bottom|left)$/,R7=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,k7=new RegExp("^("+R7+")(?!px)[a-z%]+$","i"),MVe=new RegExp("^("+R7+")(.*)$","i");window.getComputedStyle?(X1=function(C){var x,S;return(S=(x=H.isFunction(C.getEL)?C.getEL():C).ownerDocument.defaultView)&&S.opener||(S=window),S.getComputedStyle(x)},OA=function(C,x,S){var T,D,R,P,O=C.style;return""!==(P=(S=S||X1(C))?S.getPropertyValue(x)||S[x]:void 0)&&void 0!==P||tle.contains(C.ownerDocument,C)||(P=TS(C,x)),S&&!sd.pixelMarginRight()&&k7.test(P)&&RVe.test(x)&&(T=O.width,D=O.minWidth,R=O.maxWidth,O.minWidth=O.maxWidth=O.width=P,P=S.width,O.width=T,O.minWidth=D,O.maxWidth=R),void 0===P?P:P+""}):ele&&ele.currentStyle&&(X1=function(C){return C.currentStyle},OA=function(C,x,S){var T,D,R,P,O=C.style;return null==(P=(S=S||X1(C))?S[x]:void 0)&&O&&O[x]&&(P=O[x]),k7.test(P)&&!kVe.test(x)&&(T=O.left,(R=(D=C.runtimeStyle)&&D.left)&&(D.left=C.currentStyle.left),O.left="fontSize"===x?"1em":P,P=O.pixelLeft+"px",O.left=T,R&&(D.left=R)),void 0===P?P:P+""||"auto"});var M7,OVe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,FVe=/<([\w:-]+)/,nle=/^\s+/,LVe=/<|&#?\w+;/,ile=/<tbody/i,NVe=/^-ms-/,BVe=/-([\da-z])/gi,WVe=/^(none|table(?!-c[ea]).+)/,UVe=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,VVe={position:"absolute",visibility:"hidden",display:"block"},rle={letterSpacing:"0",fontWeight:"400"},SS=["Top","Right","Bottom","Left"],ole={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:sd.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sle=["Webkit","O","Moz","ms"],ale=document.createElement("div");M7=ale.style,sd.cssFloat=!!ale.style.cssFloat;var HVe=function(C,x){return x.toUpperCase()},Qs={cssHooks:{},htmlPrefilter:function(C){return C.replace(OVe,"<$1></$2>")},nodeName:function(C,x){return C.nodeName&&C.nodeName.toLowerCase()===x.toLowerCase()},merge:function(C,x){for(var S=+x.length,T=0,D=C.length;T<S;)C[D++]=x[T++];if(S!=S)for(;void 0!==x[T];)C[D++]=x[T++];return C.length=D,C},camelCase:function(C){return C.replace(NVe,"ms-").replace(BVe,HVe)},cssProps:{},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0}},GVe=["flo","at"].join("");function lle(C){if(C in M7)return C;for(var x=C.charAt(0).toUpperCase()+dh(C).call(C,1),S=sle.length;S--;)if((C=sle[S]+x)in M7)return C}function cle(C,x,S,T,D){for(var R=S===(T?"border":"content")?4:"width"===x?1:0,P=0;R<4;R+=2)"margin"===S&&(P+=hh(C,S+SS[R],!0,D)),T?("content"===S&&(P-=hh(C,"padding"+SS[R],!0,D)),"margin"!==S&&(P-=hh(C,"border"+SS[R]+"Width",!0,D))):(P+=hh(C,"padding"+SS[R],!0,D),"padding"!==S&&(P+=hh(C,"border"+SS[R]+"Width",!0,D)));return P}function ule(C,x,S){var T=!0,D="width"===x?C.offsetWidth:C.offsetHeight,R=X1(C),P=sd.boxSizing&&"border-box"===hh(C,"boxSizing",!1,R);if(D<=0||null==D){if(((D=OA(C,x,R))<0||null==D)&&(D=C.style[x]),k7.test(D))return D;T=P&&(sd.boxSizingReliable()||D===C.style[x]),D=y7(D)||0}return D+cle(C,x,S||(P?"border":"content"),T,R)}function dle(C){return new RegExp("^(?:([+-])=|)("+R7+")([a-z%]*)$","i").exec(C)}function TS(C,x,S,T){if(C&&3!==C.nodeType&&8!==C.nodeType&&C.style){var D,R,P,O=Qs.camelCase(x),U=C.style;if(x=Qs.cssProps[O]||(Qs.cssProps[O]=lle(O)||O),P=Qs.cssHooks[x]||Qs.cssHooks[O],void 0===S)return P&&"get"in P&&void 0!==(D=P.get(C,!1,T))?D:U[x]+"";"string"===(R=od(S))&&(D=dle(S))&&D[1]&&(S=function(G,X,z,K){var oe,ae=1,ue=20,ye=function(){return hh(G,X,"")},Ie=ye(),Ue=z&&z[3]||(Qs.cssNumber[X]?"":"px"),He=(Qs.cssNumber[X]||"px"!==Ue&&+Ie)&&dle(hh(G,X));if(He&&He[3]!==Ue){Ue=Ue||He[3],z=z||[],He=+Ie||1;do{TS(G,X,(He/=ae=ae||".5")+Ue)}while(ae!==(ae=ye()/Ie)&&1!==ae&&--ue)}return z&&(He=+He||+Ie||0,oe=z[1]?He+(z[1]+1)*z[2]:+z[2]),oe}(C,x,D),R="number"),null!=S&&S==S&&("number"===R&&(S+=D&&D[3]||(Qs.cssNumber[O]?"":"px")),sd.clearCloneStyle||""!==S||0!==Bo(x).call(x,"background")||(U[x]="inherit"),P&&"set"in P&&void 0===(S=P.set(C,S,T))||(U[x]=S))}}function hh(C,x,S,T){var D,R,P,O=Qs.camelCase(x);return x=Qs.cssProps[O]||(Qs.cssProps[O]=lle(O)||O),(P=Qs.cssHooks[x]||Qs.cssHooks[O])&&"get"in P&&(R=P.get(C,!0,S)),void 0===R&&(R=OA(C,x,T)),"normal"===R&&x in rle&&(R=rle[x]),""===S||S?(D=y7(R),!0===S||isFinite(D)?D||0:R):R}function FA(C,x){if(!C||"string"!=typeof C)return[];"boolean"==typeof x&&(x=!1),x=x||document;var S=UVe.exec(C);return S?[x.createElement(S[1])]:(S=function zVe(C,x){for(var S,T,D,R,P,O,U=C.length,G=function(oe){var ae="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video".split("|"),ue=oe.createDocumentFragment();if(ue.createElement)for(;ae.length;)ue.createElement(ae.pop());return ue}(x),X=[],z=0;z<U;z++)if((T=C[z])||0===T)if("object"===H.type(T))Qs.merge(X,T.nodeType?[T]:T);else if(LVe.test(T)){if(D=D||G.appendChild(x.createElement("div"))){for(R=(FVe.exec(T)||["",""])[1].toLowerCase(),D.innerHTML=(O=ole[R]||ole._default)[1]+Qs.htmlPrefilter(T)+O[2],S=O[0];S--;)D=D.lastChild;if(!sd.leadingWhitespace&&nle.test(T)){var K=nle.exec(T);K&&K.length>0&&X.push(x.createTextNode(K[0]))}if(!sd.tbody&&(S=(T="table"!==R||ile.test(T)?"<table>"!==O[1]||ile.test(T)?0:D:D.firstChild)&&T.childNodes.length,T))for(;S--;)Qs.nodeName(P=T.childNodes[S],"tbody")&&!P.childNodes.length&&T.removeChild(P);for(Qs.merge(X,D.childNodes),D.textContent="";D.firstChild;)D.removeChild(D.firstChild);D=G.lastChild}}else X.push(x.createTextNode(T));for(D&&G&&G.removeChild(D),z=0;T=X[z++];)"SCRIPT"!==T.tagName&&(tle.contains(T.ownerDocument,T),G.appendChild(T));return D=null,G}([C],x),Qs.merge([],S.childNodes))}Qs.cssProps[GVe]=sd.cssFloat?"cssFloat":"styleFloat",H.each(["height","width"],function(C,x){Qs.cssHooks[C]={get:function(S,T,D){if(T)return WVe.test(hh(S,"display"))&&0===S.offsetWidth?(R=S,X={},H.each(P=VVe,function(z,K){X[K]=R.style[K],R.style[K]=P[K]}),G=function(){return ule(S,C,D)}.apply(R,[]),H.each(P,function(z,K){R.style[K]=X[K]}),G):ule(S,C,D);var R,P,G,X},set:function(S,T,D){var O,U,G,R=D&&X1(S);return O=T,U=D?cle(S,C,D,sd.boxSizing&&"border-box"===hh(S,"boxSizing",!1,R),R):0,(G=MVe.exec(O))?Math.max(0,jp(G[1])-(U||0))+(G[2]||"px"):O}}});var hle,fle=dh(Array.prototype),Cc=" ",XVe=he.bIE&&he.IEMode<10,ple=/[\n\t\r\.]/g,O7=function(){function C(x,S,T){Eo(this,C),this.isNodeList=!0,this.length=0;var D=this;return!x||H.isString(x)?D:H.isArray(x)||x.isNodeList?(Array.prototype.push.apply(D,H.makeArray(x)),D):(D[0]=x,D.length=1,D)}return Do(C,[{key:"item",value:function(x){return H.isNumber(x)?x>=this.length?null:new C(this[x]):new C(x)}},{key:"slice",value:function(){return new C(fle.apply(this,arguments))}},{key:"getDOMNodes",value:function(){return fle.call(this)}},{key:"each",value:function(x,S){var T=this;return H.each(T,function(D,R){return D=new C(D),x.call(S||D,D,R,T)}),T}},{key:"getEL",value:function(){return this.length>0?this[0]:void 0}},{key:"all",value:function(x){return this.length>0?B7(x,this):new C}},{key:"one",value:function(x){var S=this.all(x);return S.length?dh(S).call(S,0,1):S}},{key:"attr",value:function(x,S){var T=this.getEL();if(T){if(H.isUndefined(S))return"readonly"===x?T.readOnly?"readonly":"":("style"!==x&&XVe?T=T[x]:(T=T.attributes[x])&&(T=T.value),T);"class"==x?T.className=S:T[x]=S}}},{key:"addClass",value:function(x){var S=this.getEL();S&&function(T,D){var R,P,O,U,G=T.className,X=D.length;if(G){for(R=L7(G),P=G,O=0;O<X;O++)U=N7(D[O]),Bo(R).call(R,Cc+U+Cc)<0&&(P+=Cc+U);P=fS(H).call(H,P)}else P=D.join(" ");T.className=P}(S,x.split(Cc))}},{key:"removeClass",value:function(x){var S=this.getEL();S&&function(T,D){var R,P,O,U=T.className,G=D.length;if(U&&G){for(R=L7(U),P=0;P<G;P++)for(O=Cc+N7(D[P])+Cc;Bo(R).call(R,O)>=0;)R=R.replace(O,Cc);T.className=fS(H).call(H,R)}}(S,x.split(Cc))}},{key:"hasClass",value:function(x){var S=this.getEL();if(S)return function(T,D){var R,P,O,U=T.className,G=D.length;if(U&&G){for(R=L7(U),P=0;P<G;P++)if(O=Cc+N7(D[P])+Cc,Bo(R).call(R,O)<0)return fe;return le}return fe}(S,x.split(Cc))}},{key:"parent",value:function(){var x=this.getEL();return x&&(x=x.parentNode),new C(x)}},{key:"remove",value:function(){var x=this.getEL();x&&x.parentNode&&x.parentNode.removeChild(x)}},{key:"offset",value:function(){var x=this.getEL();return H.DOM.getElDimensions(x,le)}},{key:"before",value:function(x){var S=this.getEL(),T=[x];S&&(F7(x)&&(T=FA(x)),H.each(T,function(D){S.insertBefore(D,S.childNodes[0])}))}},{key:"append",value:function(x){var S=this.getEL(),T=[x];S&&(F7(x)&&(T=FA(x)),H.each(T,function(D){S.appendChild(D)}))}},{key:"html",value:function(x){var D,S=this.getEL();if(S){if(H.isUndefined(x))return D=S.innerHTML,document.all?(D=D.replace(/(\s+\w+)\s*=\s*([^<>"\s]+)(?=[^<>]*\/>)/gi,'$1="$2"').replace(/"'([^'"]*)'"/gi,'"$1"')).replace(/<(\/?)(\w+)([^>]*)>/g,function(O,U,G,X){return U?"</"+G.toLowerCase()+">":("<"+G.toLowerCase()+X+">").replace(/=(("[^"]*?")|('[^']*?')|([\w\-\.]+))([\s>])/g,function(z,K,oe,ae,ue,ye,Ie,Ue){return ue?'="'+ue+'"'+ye:z})}).replace(/<\/?([^>]+)>/g,function(O){return O}):D;S.innerHTML="",H.each(FA(x),function(T){S.appendChild(T)})}}},{key:"style",value:function(x,S){var T=this.getEL();if(T)return TS(T,x,S)}},{key:"css",value:function(x){H.each(this,function(S){H.each(x,function(T,D){TS(S,D,T)})})}}]),C}();function F7(C){return H.isString(C)&&(C=fS(H).call(H,C))&&C.length>=3&&oVe(H).call(H,C,"<")&&Dae(H).call(H,C,">")}function L7(C){return(Cc+C+Cc).replace(ple,Cc)}function N7(C){return C.replace(ple,"")}function B7(C,x){var S=x;return S&&S.isNodeList&&(S=S.getEL()),H.isString(C)?(F7(C)&&H.error("Err 4002."),new O7(H.sizzle(C,S))):C.isNodeList?C:new O7(C)}function $Ve(C,x){var S=B7(C,x);return S.length?dh(S).call(S,0,1):S}function qVe(C){return C instanceof O7}(hle=self||{}).Map||(hle.Map=function(){this.keys=[],this.data={},this.set=function(C,x){var S;null==this.data[C]&&-1==Bo(S=kN(this)).call(S,C)&&kN(this).push(C),this.data[C]=x},this.get=function(C){return this.data[C]}});var pt=new(Do(function C(){Eo(this,C),this.__ver=20230516,this.Events=Uae,this.EnumMouseButton=w0,this.detectButton=cVe,this.getWheelDelta=lVe,this.fromUnicode=dVe,this.escapeHtml=hVe,this.escapeRegExp=fVe,this.unEscapeHtml=pVe,this.param=wVe,this.unparam=SVe,this.colorStrToInt=sVe,this.IntToColorStr=aVe,this.currentStyle=xVe,this.parseHTML=FA,this.css=hh,this.style=TS,this.support=sd,this.all=B7,this.one=$Ve,this.isNodeList=qVe,this.Promise=I7,this.nativePromise=RA,this.loaderBarClassName=Xae,this.loaderBarSource=D7,this.createShowMaskContent=$ae,this.switchEvent=bVe,this.setBackOpacity=Zae,this.showMask=DVe,this.hideMask=AVe,this.dialog=P7,this.mask=xl})),ad={getHex:function(C){var x=Number(C).toString(16).toUpperCase();return 1==x.length&&(x=["0",x].join("")),x},getColor:function(C){var x,S;return S=(65280&C)>>8,x=255&C,["#",ad.getHex(C>>16),ad.getHex(S),ad.getHex(x)].join("")},RGB2BGR:function(C){return(255&C)<<16|65280&C|C>>16}};function An(C,x,S){return(x=o(x))in C?Object.defineProperty(C,x,{value:S,enumerable:!0,configurable:!0,writable:!0}):C[x]=S,C}ad.BGR2RGB=ad.RGB2BGR;var yt=!1,Nt=!0,gle=/[#\/\?@]/g,KVe=/[#\?]/g,mle={scheme:1,userInfo:2,hostname:3,port:4,path:5},JVe=new RegExp("^(?:([\\w\\d+.-]+):)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?(.+)?$");function W7(C,x){return H.isString(C)&&H.isString(x)?C.toLowerCase()===x.toLowerCase():C===x}function U7(C,x){return encodeURI(C).replace(x,function(S){return"%"+(1===(T=S.charCodeAt(0).toString(16)).length?"0"+T:T);var T})}var V7=function(){function C(x){if(n(this,C),An(this,"scheme",""),An(this,"userInfo",""),An(this,"hostname",""),An(this,"port",""),An(this,"path",""),x instanceof C)return H.clone(x);C.getComponents(x,this)}return v(C,[{key:"clone",value:function(){var x=new C,S=this;return H.each(mle,function(T,D){x[D]=S[D]}),x}},{key:"getScheme",value:function(){return this.scheme}},{key:"setScheme",value:function(x){return this.scheme=x,this}},{key:"getHostname",value:function(){return this.hostname}},{key:"setHostname",value:function(x){return this.hostname=x,this}},{key:"setUserInfo",value:function(x){return this.userInfo=x,this}},{key:"getUserInfo",value:function(){return this.userInfo}},{key:"setPort",value:function(x){return this.port=x,this}},{key:"getPort",value:function(){return this.port}},{key:"setPath",value:function(x){return this.path=x,this}},{key:"getPath",value:function(){return this.path}},{key:"isSameOriginAs",value:function(x){var S=this;return W7(S.hostname,x.hostname)&&W7(S.scheme,x.scheme)&&W7(S.port,x.port)}},{key:"toString",value:function(x){var S,T,D,R,P,O=[],U=this;return(S=U.scheme)&&(O.push(U7(S,gle)),O.push(":")),(T=U.hostname)&&(O.push("//"),(P=U.userInfo)&&(O.push(U7(P,gle)),O.push("@")),O.push(encodeURIComponent(T)),(R=U.port)&&(O.push(":"),O.push(R))),(D=U.path)&&(T&&!H.startsWith(D,"/")&&(D="/"+D),O.push(U7(D,KVe))),O.join("")}}],[{key:"getComponents",value:function(x,S){var T=(x=x||"").match(JVe)||[],D=S||{};return H.each(mle,function(R,P){D[P]=T[R]}),D}}])}(),LA=H.each,_f=H.error,j7=H.isFunction,H7=H.isString,G7=he.bIE&&he.IEVersion<=9,QVe=he.bIE&&he.IEVersion<=10,Tm=window,z7=new V7(location.href),yle=z7&&/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(z7.getScheme()),Y7=function(){try{return new Tm.XMLHttpRequest}catch(C){}},_le=function(){try{var C=yt;return LA(["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.3.0","Msxml3.XMLHTTP"],function(x){try{if(!C)return C=new Tm.ActiveXObject(x),yt}catch(S){_f("new xhr error: "+S.message)}}),C}catch(x){}},eje=!(yle||!Tm.XMLHttpRequest)&&"withCredentials"in(Y7()||[]),tje=Tm.ActiveXObject?function(C){return G7?_le():!yle&&Y7()||_le()}:Y7,nje=/^(?:GET|HEAD)$/,ije=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,X7={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},$7=void 0;QVe&&($7=H.noop);var rje=function(){function C(){n(this,C),An(this,"url",!1),An(this,"onSuccess",!1),An(this,"onError",!1),An(this,"onComplete",!1),An(this,"method","GET"),An(this,"async",!0),An(this,"xhrFields",!1),An(this,"mimeType",!1),An(this,"username",!1),An(this,"password",!1),An(this,"data",!1),An(this,"dataType","text"),An(this,"headers",!1),An(this,"contentType","application/x-www-form-urlencoded; charset=UTF-8"),An(this,"beforeSend",!1),An(this,"afterSend",!1),An(this,"timeout",0),An(this,"cache",!0),An(this,"crossDomain",!1),An(this,"retry",0)}return v(C,[{key:"setRequestHeader",value:function(x,S){this.headers[x]=S}},{key:"getAllResponseHeaders",value:function(){return 2===this.state?this.responseHeadersString:null}},{key:"getNativeXhr",value:function(){return this.nativeXhr}},{key:"getResponseHeader",value:function(x){var S,T;if(x=x.toLowerCase(),2===this.state){if(!(T=this.responseHeaders))for(T=this.responseHeaders={};S=ije.exec(this.responseHeadersString);)T[S[1].toLowerCase()]=S[2];S=T[x]}return void 0===S?null:S}},{key:"overrideMimeType",value:function(x){return this.state||(this.mimeType=x),this}},{key:"abort",value:function(x){return this.state=3,this.status=0,this.statusText=null!=x?x:"abort",this.nativeXhr&&this.nativeXhr.abort(),this._callback(),this}},{key:"_ioReady",value:function(x,S){var T=!1,D=this;if(2!==this.state&&3!==this.state){1===this.state&&(this.state=2),this.readyState=4,x>=200&&x<300||304===x?304===x?(S="not modified",T=!0):(S="success",T=!0):x<0&&(x=0);try{x>=200&&this.handleResponseData()}catch(R){_f(R,"error"),S=R.message||"parser error"}return(x<200||!T)&&this.retry>0?(this.retry=this.retry-1,void setTimeout(function(){D.sendInternal()},200)):(this.status=x,this.statusText=S,this._callback(T),T)}}},{key:"_callback",value:function(x){var S=this,T=this.timeoutTimer;T&&(clearTimeout(T),this.timeoutTimer=0),LA([x?this.onSuccess:this.onError,this.onComplete],function(D){j7(D)&&D.apply(S.context,[S.responseData,S.statusText,S])}),this.responseData=null}},{key:"handleResponseData",value:function(){var x,S=this.dataType,T=this.nativeXhr;if("blob"===S||"arraybuffer"===S)if(G7){var D,R,P;if("responseBody"in T)R=Tm.dsVbsBinGetLength(D=T.responseBody),x=new Tm.VBArray(Tm.dsVbsBinGetBytes(D,0,R)).toArray();else for(x=[],R=(D=T.responseText).length,P=0;P<R;++P)x.push(255&D.charCodeAt(P));D=null}else x=Tm.Blob?T.response:"responseBody"in T?T.responseBody:T.responseText;else if("json"==S)x=T.responseType&&"json"==T.responseType.toLowerCase()?T.response:H.parse(T.responseText?T.responseText:T.response);else if("user-defined"===S)x=void 0!==T.response?T.response:T.responseText;else{this.responseText=x=T.responseText||"";try{var O=T.responseXML;O&&O.documentElement&&(this.responseXML=O)}catch(U){}}this.responseData=x}},{key:"sendInternal",value:function(x){var S,T,D,R,P,O,U,G,X,z,K,oe=this;if(T=(S=this._setup(x)).method,H7(T)&&(T=T.toUpperCase()),P=S.contentType,R=S.dataType,G=S.mimeType,H7(D=S.url)&&(this.nativeXhr=O=tje(S.crossDomain),O)){try{if(this.state=1,S.username?O.open(T,D,S.async,S.username,S.password):O.open(T,D,S.async),(S.async||he.bIE)&&R&&"user-defined"!=R&&"responseType"in O)try{O.responseType=R}catch(ae){}}catch(ae){return void(this.state<2?(_f(ae,"error"),this._ioReady(-1,"open error: "+(H.isNumber(ae.number)?"("+ae.number+")":"")+(ae.message||""))):_f(ae))}"withCredentials"in(U=S.xhrFields||{})&&(eje||delete U.withCredentials),LA(U,function(ae,ue){try{O[ue]=ae}catch(ye){_f(ye)}}),G&&O.overrideMimeType&&O.overrideMimeType(G),!1===(X=S.headers||{})["X-Requested-With"]&&delete X["X-Requested-With"],"setRequestHeader"in O&&(P&&O.setRequestHeader("Content-Type",S.contentType),O.setRequestHeader("Accept",R&&X7[R]?X7[R]+("*"===R?"":", */*; q=0.01"):X7["*"]),LA(X,function(ae,ue){O.setRequestHeader(ue,ae)})),"GET"!=T||S.cache||(O.setRequestHeader("If-Modified-Since","0"),O.setRequestHeader("Cache-Control","no-cache")),K=(z=!nje.test(S.method))&&S.data||null,z&&G7&&(K=S.data),S.async&&S.timeout>0&&(S.timeout<300&&(S.timeout=300),this.timeoutTimer=setTimeout(function(){oe.abort("timeout")},S.timeout));try{if(this.state=1,j7(this.beforeSend)&&!1===this.beforeSend(O,oe))return void this.abort("cancel");O.send(K),K=null,S.data=null,j7(this.afterSend)&&this.afterSend(oe)}catch(ae){this.state<2?(_f(ae,"error"),this._ioReady(-1,"send error: "+(ae.message||""))):_f(ae)}if(!S.async||4===O.readyState)return oe._xhrCallback();O.onreadystatechange=function(){oe._xhrCallback()}}}},{key:"_xhrCallback",value:function(x,S){var T,D=this.nativeXhr;try{if(4===D.readyState||S)if(D.onreadystatechange=$7,S)4!==D.readyState&&D.abort();else{this.responseHeadersString=D.getAllResponseHeaders();var R,P=D.status;try{R=D.statusText}catch(O){_f("xhr statusText error: "),_f(O),R=""}T=this._ioReady(P,R)}}catch(O){_f(O,"error"),D.onreadystatechange=$7,S||this._ioReady(-1,O.message||"process error")}return T}},{key:"_setup",value:function(x){var S,T,D,R,P;if(x){for(T in this.context=x.context,delete x.context,x instanceof C&&(x=x.config),this.config=x,H.startsWith(R=x.url,"//")&&(x.url=R="http:"+R),(H.startsWith(R,"http://")||H.startsWith(R,"https://"))&&(P=new V7(R)),S=x.dataType?x.dataType.toLowerCase():"text",x.dataType=S,x.method=x.method?x.method.toUpperCase():"GET",P&&!("crossDomain"in x)&&(x.crossDomain=!P.isSameOriginAs(z7)),D=x.headers)void 0===D[T]&&delete D[T];H.mix(this,x)}return this.state=1,this}},{key:"dispose",value:function(){this.responseHeaders=null,this.responseHeadersString=null,this.responseData=null,this.responseText=null,this.responseXML=null,this.context=null,this.config=null,this.onSuccess=null,this.onError=null,this.onComplete=null,this.xhrFields=null,this.data=null,this.headers=null,this.beforeSend=null,this.afterSend=null}}])}();function du(C){if(C&&H7(C.url)){var x=new rje;return C.async?(C.async=!0,x.sendInternal(C),x):(C.async=!1,x.sendInternal(C))}H.log("the url is error.")}var Cf,Rn,ld="18",NA="5",Im="0312",q7="5",K7="0",BA="".concat(ld,",").concat(NA,",").concat("0",",").concat(Im),sje="".concat(ld,",").concat(q7,",").concat(K7,",").concat("0312"),J7=parseInt(ld),Q7=parseInt(NA),Z7=parseInt("0"),ble=[J7,Q7,Z7,Im],xle=[J7,Q7,Z7,Im],wle=[J7,Q7,Z7,Im],Sle=[1,8,5,Im],Tle=[1,8,5,Im],Ile=[1,8,5,Im];function Ele(){if(!he.bWin){if(he.bMac)return xle;if(he.bLinux)return wle}return ble}function eB(){if(!he.bWin){if(he.bMac)return Tle;if(he.bLinux)return Ile}return Sle}function WA(){return"dcp/dwasm2_"+q1()}function q1(){return Ele().join("")}function IS(){var C=be.DWT.ServiceInstallerLocation;return H.isString(C)&&C.length>0?("/"!=C[C.length-1]&&(C+="/"),C):(H.isString(C=be.DWT.ResourcesPath)&&C.length>0?"/"!=C[C.length-1]&&(C+="/"):C="Resources/",C+"dist/")}(function(C){C.enumUnknown=-1,C.enumChrome=1,C.enumFirefox=2,C.enumEdge=3,C.enumSafari=4,C.enumIE=5,C.enumOpera=6,C.enumHuaWeiBrowser=7})(Cf||(Cf={})),function(C){C.enumUnknown=-1,C.enumWindow=0,C.enumMac=1,C.enumLinux=2,C.enumEmbed=3,C.enumChromeOS=4,C.enumHarmonyOS=5,C.enumAndroid=6,C.enumiOS=7}(Rn||(Rn={}));var hu,ql={getDSPath:function(C){var x=IS(),S=C;return S||(S=he.bWin?".msi":he.bMac?".pkg":be.navInfo.bArm64?"-arm64.deb":be.navInfo.bMips64?"-mips64el.deb":be.navInfo.bAndroid?".apk":he.bLinux||he.bChromeOS||he.bHarmonyOS?".deb":".msi"),[x,"DynamsoftServiceSetup",S].join("")},getLinuxHTML5DebPath:function(){return ql.getDSPath(".deb")},getLinuxHTML5RpmPath:function(){return ql.getDSPath(".rpm")},getEnumPlatform:function(){return he.bAndroid?Rn.enumAndroid:he.bMac?Rn.enumMac:he.bChromeOS?Rn.enumChromeOS:he.bHarmonyOS?Rn.enumHarmonyOS:be.navInfo.bEmbed?Rn.enumEmbed:he.bLinux?Rn.enumLinux:he.biPhone||he.biPad?Rn.enumiOS:Rn.enumWindow},getEnumBrowser:function(){return he.bEdge?Cf.enumEdge:he.bChrome?Cf.enumChrome:he.bFirefox?Cf.enumFirefox:he.bIE?Cf.enumIE:he.bSafari?Cf.enumSafari:he.bHuaWeiBrowser?Cf.enumHuaWeiBrowser:he.bOpera?Cf.enumOpera:Cf.enumUnknown}};!function(C){C.NONE=0,C.TRACE=1,C.DEBUG=2,C.INFO=4,C.WARN=8,C.ERROR=16}(hu||(hu={}));var ES=H.getLogger(),K1=v(function C(){n(this,C)},null,[{key:"LogLevel",get:function(){return this._logLevel},set:function(C){this._logLevel=C}},{key:"LogFunc",set:function(C){this._logFunc=C}},{key:"all",value:function(C,x){if((this._logLevel&C)==C)if(this._logFunc)this._logFunc(x,C);else switch(C){case hu.DEBUG:ES.debug(x);break;case hu.ERROR:ES.error(x);break;case hu.INFO:ES.info(x);break;case hu.WARN:ES.warn(x);break;case hu.TRACE:ES.trace(x)}}},{key:"trace",value:function(C){this.all(hu.TRACE,C)}},{key:"debug",value:function(C){this.all(hu.DEBUG,C)}},{key:"info",value:function(C){this.all(hu.INFO,C)}},{key:"warn",value:function(C){this.all(hu.WARN,C)}},{key:"error",value:function(C){this.all(hu.ERROR,C)}}]);function Nr(C){var x;window.console&&(C instanceof Error||H.isString(C)?(x=C,be.navInfoSync.bIE&&(x=H.stringify(C))):x=H.stringify(C),window.console.error(x))}An(K1,"_logLevel",hu.ERROR),An(K1,"_logFunc",void 0);var Dle,J1="127.0.0.1";he.bIE&&he.bSSL?J1="localhost":he.bAndroid&&(J1="local.dynamsoft.com"),Dle="0"==K7.toLowerCase()?"Dynamic Web TWAIN "+[ld,q7].join("."):"Dynamic Web TWAIN "+[ld,q7,K7].join(".");var fu={JSVersion:sje,ServerVersionInfo:BA,ServerLinuxVersionInfo:BA,ServerMacVersionInfo:BA,ServerAndroidVersionInfo:BA,ActiveXVersion:"18,0,0,1025",ActiveXPdfVersion:"11.5.2.0312",PdfVersion:"11.5.2.0312",PdfLinuxVersion:"11.5.2.0312",PdfMacVersion:"11.5.2.0312"},aje={ProductName:Dle,Containers:void 0,ContainerMap:{},WebTwainIdMap:{},RemoteScanIdMap:{},Trial:!1,ResourcesPath:"Resources",Debug:!1,IfUpdateService:!1,AutoLoad:!0,ReConnectToService:!0,OnWebTwainReady:!1,OnWebTwainError:function(C){Nr(C)},OnWebTwainNotFound:!1,OnWebTwainOldPluginNotAllowed:!1,OnWebTwainNeedUpgrade:!1,OnWebTwainNeedUpgradeWebJavascript:!1,OnWebTwainInitMessage:!1,ViewerJSIntegerited:!0,ActiveXInstallWithCAB:!1,IfUseActiveXForIE10Plus:!1,IfUseEmbeddedDownloadNoticeForActiveX:!1,IfCheckDCP:!1,IfDisableDefaultSettings:!1,OnWebTwainWillInit:!1,IfAddMD5InUploadHeader:!1,IfAlwaysFocusOnPopupWindow:!0,IfConfineMaskWithinTheViewer:!1,fetchOptions:{mode:"cors",credentials:"same-origin"},HideTrialMessage:!1,CheckCertExpired:!0,ConnectWithSocket:!1,SSLPort:18623,Port:18622,showLoadingMsgDialog:!0,licenseServer:void 0,sessionPassword:void 0,organizationID:void 0,handshakeCode:void 0,UseDefaultViewer:!0,Host:J1,DeviceFriendlyName:"",LocalHosts:["127.0.0.1","localhost","local.dynamsoftwebtwain.com","local.dynamsoft.com"],IfCheckCORS:!1,IfCheckCert:!0};function Ja(){var C=be.DWT.Host;return H.isString(C)&&""!=C||(be.DWT.Host=C=J1),C}function lje(){var C=300,x=be.DWT.RemoteScanConfig;return x&&H.isNumber(x.sessionTimeout)&&x.sessionTimeout>0&&(C=x.sessionTimeout),C}var tB={URL:"",UpdateDaysBeforeExpired:30},Em=he.bHTML5Edition,iB=0,VA=!1;he.bIE&&(""===(iB=he.IEVersion)||iB>=10?be.DWT.IfUseActiveXForIE10Plus?(VA=!0,he.bHTML5Edition=Em=!1):Em=!0:(Em=!1,iB>=9&&(VA=!0))),VA||Em||(Em=!0);var Zs,Xn,rB,DS,$n={SSLPort:18626,Port:18625,bEnhancedMode:!1,oldDWASMVerStr:"dwasm_13000404",oldDWASMVer:[13,0,0,"0404"],wsProtocol:"dwt_command",managerVersion:ble,managerVersionMac:xle,managerVersionLinux:wle,serviceVersion:Sle,serviceVersionMac:Tle,serviceVersionLinux:Ile,detect:{dcpStatus:0,ddmPort:0,dwtPort:0,dwtSSLPort:0,bConnected:!1,connectedResult:"",MaxManagerModuleConnectCount:1,EnumDCP_DetectStatus:{Init:0,Connected:1,CheckingManagerVer:15,CheckingServiceVer:16,NotInstalled:17,CheckedService:5,VerifyingZip:6,VerifiedZip:7,UpdatingService:8,UpdateSucceed:9,UpdateFailed:10,UpdateSkipped:11}},strSID:"",b64bit:!0,objEnhancedPorts:{}},Tt={name:"Dynamic Web TWAIN",bHTML5Edition:Em,bActiveXEdition:VA,_iImageCaptureDriverType:3,_iBrokerProcessType:1,getChromeEditionPath:ql.getDSPath,getPKGPath:function(){return IS()+"DynamicWebTWAINMacEdition.pkg"},getMSIPath:function(){return IS()+"DynamicWebTWAINPlugIn.msi"},getActiveXCABx86Path:function(){return IS()+"DynamicWebTWAIN.cab"},getActiveXCABx64Path:function(){return IS()+"DynamicWebTWAINx64.cab"},onlineResources:"https://demo.dynamsoft.com/DWT/Resources/",strMIMEType:"Application/DynamicWebTwain-Plugin",strFullClassID:"E7DA7F8D-27AB-4EE9-8FC0-3FEC9ECFE758",scripts:{},dwtConfigLoaded:!1,dwtConfigLoading:!1,getServerVersionInfo:function(C){var x=fu.ServerVersionInfo;return he.bWin||(he.bMac?x=fu.ServerMacVersionInfo:he.bAndroid?x=fu.ServerAndroidVersionInfo:(he.bLinux||he.bChromeOS||he.bHarmonyOS)&&(x=fu.ServerLinuxVersionInfo)),C?x:H.replaceAll(x,",","")},getDWTPrefix:function(){return!0===be.DWT.CustomMode?"dwtc_":"dwt_"},loadResourcePath:!1,loadingResourcePath:!1,handshakeCode:void 0,organizationID:void 0,licenseServer:void 0,sessionPassword:"",bPublicLTS:!0,refProductKey:void 0,ltsDebug:!1,bDWTLoading:!1,bDWTUnloading:!1,bAndroidConnected:!1,unloadQueue:[],appendBrowserLicenseWhenServiceMode:function(){},bDCPChecked:!1,bDWTChecked:!1,bChromeEdition:Em},xo={bFullEdition:!1,getVersionStrForCheck:function(){return"".concat(ld,"000000")},versionInfoFromServer:"",hostForCheckCert:J1,RemoteReconnectMaxTimes:200,RemoteReconnectTimeSpan:5e3,LocalReconnectMaxTimes:60,LocaleReconnectTimeSpan:3e3},AS=he.bSSL?3e3:1e3,oB=he.bSSL?1e3:600;function Qa(){return H.isString(Tt.handshakeCode)||H.isString(Tt.organizationID)||Tt.bPublicLTS||H.isString(be.DWT.ProductKey)&&H.startsWith(be.DWT.ProductKey,"DLS2")}function bc(C){if(void 0===C)return!0;var x;if(C)for(x=0;x<be.DWT.LocalHosts.length;x++)if(C===be.DWT.LocalHosts[x])return!0;return!1}function St(C,x,S){C._errorCode=x,C._errorString=S}function Ao(C){var x=be.DWT.licenseException;x.code=C._errorCode,x.message=C._errorString,x.fromLTS=!1}function ea(){return be.DWT.bChromeExtension?"":"Please contact the site administrator."}function Jn(C){St(C,-1033,"Invalid index.")}function ga(C){St(C,-1034,"Invalid value.")}function ta(C){St(C,-1035,"There is no image.")}function Ale(C){St(C,-1110,"Unrecognized file extension.")}function Ple(C){St(C,-2007,"The system is busy, some operations are not completed. Please try later.")}function Q1(C,x){var S=x?["[",x,"]"].join(""):"your device";St(C,Xn.MustUpgrade,"The Dynamsoft Service installed on "+S+" is outdated and no longer works with the JavaScript code on the website.")}function PS(C){St(C,-2209,"The HTML5 edition does not support this method or property.")}function sB(C){St(C,-2300,"Http upload error: the HTTP Server name/ip cannot be empty.")}function jA(C){St(C,-2301,"Network error.")}function aB(C){St(C,-2302,"The result format is invalid.")}function lB(C,x,S,T){if(x)gu(C);else if(C._errorCode=-2003,T&&T>0||S){var D=["HTTP process error: "];S&&(S.indexOf("HTTP process error: ")>=0&&(D=[""]),D.push(S)),T&&T>0&&D.push(" ("+T+")");var R=D.toString().lastIndexOf(".");C._errorString=R>=0&&R==D.toString().length-1?D.join(""):D.join("")+"."}else C._errorString="HTTP process error."}function Rle(C){St(C,-2304,"Http download error: the url is invalid.")}function kle(C,x,S,T){if(x)St(C,-2305,"User cancelled the operation.");else if(C._errorCode=-2003,T&&T>0||S){var D=["HTTP put error: "];S&&(S.indexOf("HTTP put error: ")>=0&&(D=[""]),D.push(S));var R=D.toString().lastIndexOf(".");C._errorString=R>=0&&R==D.toString().length-1?D.join(""):D.join("")+"."}else C._errorString="HTTP put error."}function cB(C,x,S,T){if(x)St(C,-2305,"User cancelled the operation.");else if(C._errorCode=-2003,T&&T>0||S){var D=["HTTP process error: "];S&&(S.indexOf("HTTP process error: ")>=0&&(D=[""]),D.push(S));var R=D.toString().lastIndexOf(".");C._errorString=R>=0&&R==D.toString().length-1?D.join(""):D.join("")+"."}else C._errorString="HTTP process error."}function is(C){St(C,-2306,"Upload Error: the upload file cannot be empty.")}function Mle(C){St(C,-2307,"The width or height you entered is invalid.")}function bf(C){St(C,-2313,"The size of the images you are about to upload has exceeded the limit.")}function wl(C){St(C,-2314,"The parameter cannot be empty.")}function S0(C){St(C,-2320,"Invalid file.")}function pu(C){St(C,Zs.LicenseInvalid,Qa()?"The license is invalid.":"The current product key is empty or invalid."),Ao(C)}function Ole(C,x){C._errorCode=Zs.LicenseExpired;var T,D,R,P,S="";x&&""!=x&&(-1==x.indexOf("on")&&(S=" on "+x),C.__licenseInfo&&(C.__licenseInfo.ExpireDate=x)),Qa()?(T=be.DWT.EnumInstance.dwt_desktop,D=C._bRemoteMode&&null!==(R=null===(P=C._dmService)||void 0===P||null===(P=P.attrs)||void 0===P?void 0:P.UUID)&&void 0!==R?R:"",C._errorString="The license has expired"+S+". Please contact the application developer.",be.DWT.lcexp(T,D).then(function(){C._errorString=be.DWT.licenseException.message})):(C._errorString="The current product key has expired"+S+". Please contact the application developer.",Ao(C))}function RS(C,x){Qa()?111==x?(C._errorCode=Zs.LicenseExpiredForDLS,C._errorString="The license for v"+ld+" Service Core Module has expired."):(C._errorCode=Zs.LicenseNoCoreForDLS,C._errorString="The license for v"+ld+" Service Core Module is not found."):(C._errorCode=Zs.LicenseNoCore,C._errorString="The current product key is missing the Service Core license. "+ea()),Ao(C)}function Z1(C){C._errorCode=-2339,C._errorString=Qa()?"The license for the module pdf rasterizer is not found or has expired.":"The current product key does not support pdf rasterizer. "+ea(),Ao(C)}function eC(C){St(C,-2351,"You cannot upload more than one image when the format is BMP, JPG or PNG")}function Fle(C){St(C,-2352,"The indices are out of range.")}function cje(C){St(C,-2353,"The header name being used is a protected keyword and is not allowed.")}function tC(C){St(C,-2358,"The type of the parameter indices must be an Array.")}function Mt(C){St(C,-2359,"The index is out of range.")}function Lle(C){St(C,-2360,"The index is null or undefined.")}function Kl(C){St(C,-2362,"The image type is not supported.")}function Nle(C){St(C,-2363,"The data format is not supported.")}function kS(C){St(C,-2365,"The url is invalid.")}function uB(C){St(C,-2376,"The generate url failed.")}function HA(C){St(C,-2377,"Failed to set Image Capture Driver Type.")}function Ble(C){St(C,-2391,"Invalid event name.")}function Wle(C){St(C,-2393,"Failed to convert the data to blob.")}function Ule(C){St(C,-2399,"Invalid imageId.")}function Bi(C){St(C,-2416,"Invalid parameter.")}function uje(C){St(C,-2426,"You have used a full license with a trial license which is not permitted. Please check and update Dynamsoft.DWT.ProductKey.")}function Vle(C){St(C,-2510,"The callback is not a function.")}function jle(C){St(C,-2513,"The WebTwain instance has been destroyed and can not be used anymore.")}function dB(C){St(C,-2530,"Document name cannot be empty.")}function MS(C){St(C,-2531,"Document name is not a string.")}function GA(C){St(C,-2548,"You cannot call this function when Dynamsoft.DWT.UseDefaultViewer is set to false.")}function hB(C){St(C,-2549,"You cannot call this function when there is no ui binding.")}function rs(C){St(C,0,"")}function Hle(C){var x=C;return x||(x="[]"),{code:-2601,message:"Failed to connect to the Dynamsoft Service on "+x+". Please make sure Dynamsoft Service is running or the certificate is valid."}}function Gle(C){var x;return C._bRemoteMode?Hle(null===(x=C._dmService)||void 0===x||null===(x=x.attrs)||void 0===x?void 0:x.name).message:"The Dynamsoft Service has been stopped."}function zle(C){St(C,-2607,"The device selected was not found under the current service object.")}function fB(C){St(C,-2608,"IfShowFileDialog cannot be set to true when Object is created by CreateRemoteScanObjectAsync.")}function T0(C,x){H.isString(x)&&""!=x?St(C,Xn.RemoteDynamsoftServiceStopped,"The Dynamsoft Service on ["+x+"] has been stopped."):St(C,-2308,"The Dynamsoft Service has been stopped.")}function gu(C){St(C,-2615,"User cancelled the operation.")}function dje(C){St(C,-2616,"Invalid image format type.")}function hje(C){St(C,-2618,"Only single index selection is allowed when enumImageType is set to BMP, JPG or PNG.")}function xc(C){St(C,-2620,"The RemoteScan object has been disposed.")}function Yle(C){St(C,-2621,"Dynamsoft.DWT.Containers was not set.")}function Xle(C){St(C,-2622,'Please do not set enumImageType to "IT_MULTIPAGE_PDF", "IT_MULTIPAGE_TIF" or "IT_ALL".')}function fje(C){St(C,-2624,"The element within Dynamsoft.DWT.Containers should be a valid object.")}function OS(C){St(C,-2800,"Please make sure the Dynamsoft Service has been installed.")}function Jl(C){St(C,Xn.ResponseDataTypeError,"Invalid response data was returned from the Dynamsoft Service.")}function $le(C){return{code:-2807,message:'Error: The element specified by the id "'+C+"\" doesn't exist."}}function pje(C,x){St(C,-2811,x)}function qle(C){St(C,-2812,"Error: Duplicate WebTwainId detected while creating a Dynamic Web TWAIN object.")}function Kle(C){St(C,-2815,"Error: Duplicate ContainerId detected while creating a Dynamic Web TWAIN object.")}function Jle(C,x,S){St(C,-2816,["HTTP process error: ",S," (",x,")."].join(""))}function Qle(){return{code:Xn.HTSTError,message:"The Connection from the insecure (HTTP) web page failed for HTST."}}function pB(){return{code:Xn.DWTPortNotReady,message:"The Dynamsoft Service is not ready, please try again later."}}function gje(C){return{code:-2826,message:"Failed to connect the Dynamsoft Service on ["+C+"]."}}function gB(C){St(C,-2828,"Invalid PDF Convert Mode Value.")}function mje(C){St(C,-2848,"The capability value is out of range.")}function Zle(C){St(C,-2854,"The imageId does not exist.")}function vje(C){St(C,-2855,"The blob cannot be empty.")}function yje(C){St(C,-2856,"Invalid blob value.")}function zA(C){St(C,-2901,"Source document does not exist. Please check the document name or create the document before performing this operation.")}function YA(C){St(C,-2902,"Target document does not exist. Please check the document name or create the document before performing this operation.")}(function(C){C.LicenseInvalid=-2325,C.LicenseExpired=-2326,C.LicenseParseFailed=-2546,C.LicenseExpiredForDLS=-2808,C.LicenseNoCoreForDLS=-2809,C.LicenseNoCore=-2810,C.LicenseIsFuture=-2396,C.LicenseVersionNotCurrent=-2539})(Zs||(Zs={})),be.DWT.EnumDWT_LicenseErrorCode=Zs,function(C){C.UserCancelled=-1032,C.CORSErrorFromService=-2137,C.CommonError=-2201,C.ModuleNotExists=-2371,C.MustUpgrade=-2207,C.RemoteDynamsoftServiceStopped=-2613,C.ResponseDataTypeError=-2801,C.HTSTError=-2817,C.SSLCertExpired=-2818,C.SSLCertInvalid=-2819,C.CORSError=-2820,C.DWTPortNotReady=-2821,C.HTTPRedirected=-2823,C.BboError=-2827}(Xn||(Xn={}));var ece=he.bIE&&he.IEVersion<=9;rB=self&&self.fetch?self.fetch:window.fetch;var XA=0;function mB(C,x){var S,T=!1;return XA=x,rB?S=function(D,R){var P=!1,O="text",U=!1;if(R&&(R.dataType&&(O=R.dataType),R.fetchRaw&&(U=!0),R.timeout)){var G=R.timeout;G<300&&(G=300);var X=new AbortController;R.signal=X.signal,setTimeout(function(){P||X.abort()},G)}T=!1;var z=rB(D,R).then(function(K){if(K.ok){var oe,ae;if(P=!0,!C)return K;if(C.__clickCancel)return C.__clickCancel=!1,C.__cancelBeforObjectCreated=!1,T=!0,K;C.IfShowCancelDialogWhenImageTransfer?(Hp(!0),ae=C.on("cancel",function(){T=!0})):Hp(!1);var ue=K.headers.get("Content-Length"),ye=0;C._onPercent&&XA==x&&C._onPercent({loaded:ye,total:ue});var Ie=null==K||null===(oe=K.body)||void 0===oe?void 0:oe.getReader(),Ue=new ReadableStream({start:function(Oe){Ie?setTimeout(function Ge(){return Ie.read().then(function(Se){if(Se.done||T)return T?Ie.cancel():ae&&C.off("cancel",ae),Oe.close(),void(ae=null);var de=Se.value;ye+=de.length,C._onPercent&&XA==x&&C._onPercent({loaded:ye,total:ue});try{return Oe.enqueue(de),Ge()}catch(ge){H.error(ge)}})},0):Oe.close()}}),He=K.headers.get("Content-Type");return He&&""!=He||(He="application/octet-stream"),new Response(Ue,{headers:{"Content-Type":He}})}if("opaqueredirect"==K.type)throw{code:Xn.HTTPRedirected,message:"The http url redirected."};var Re;throw Jle(Re={},K.status,K.statusText),{code:Re._errorCode,message:Re._errorString,httpCode:K.status}});return U?z:(z=z.then("blob"==O?function(K){var oe=K.headers.get("content-type");return"text/json"==oe?K.json():he.bLinux?K.arrayBuffer().then(function(ae){return new Blob([ae],{type:oe})}):K.blob()}:"json"==O?function(K){return K.json()}:"arraybuffer"==O?function(K){return"text/json"==K.headers.get("content-type")?K.json():K.arrayBuffer()}:function(K){return K.text()})).then(function(K){var oe;if(T)throw gu(oe={}),{code:oe._errorCode,message:oe._errorString};return K})}:(ece&&H.addVBS(["Function dsVbsBinGetAt(strBinary,iOffset)\r\n"," dsVbsBinGetAt=AscB(MidB(strBinary,iOffset+1,1))\r\n","End Function\r\n","Function dsVbsBinGetBytes(strBinary,iOffset,iLength)\r\n"," Dim aBytes()\r\n"," ReDim aBytes(iLength-1)\r\n"," For i=0 To iLength-1\r\n","  aBytes(i)=dsVbsBinGetAt(strBinary,iOffset+i)\r\n"," Next\r\n"," dsVbsBinGetBytes=aBytes\r\n","End Function\r\n","Function dsVbsBinGetLength(strBinary)\r\n"," dsVbsBinGetLength=LenB(strBinary)\r\n","End Function"].join("")),S=function(D,R){return new(me.nativePromise||window.Promise)(function(P,O){var U,G=!1;U={url:D,async:!0,onSuccess:function(z,K,oe){var ae=!1;if(oe.responseHeadersString&&-1!=oe.responseHeadersString.indexOf("text/json")&&(H.isArray(z)||z instanceof ArrayBuffer)&&(ae=!0),ae){var ue=z;z instanceof ArrayBuffer&&(ue=new Uint8Array(z));var ye=String.fromCharCode.apply(null,ue);P(ye)}else P(z)},onError:function(z,K,oe){var ae;Jle(ae={},oe.status,K),O({code:ae._errorCode,message:ae._errorString,httpCode:oe.status})},dataType:"text",method:DS,data:DS,headers:DS,contentType:DS,mimeType:DS},R&&(R.method&&(U.method=R.method),R.body&&(U.data=R.body),R.headers&&(U.headers||(U.headers={}),H.each(R.headers,function(z,K){"content-type"==K.toLowerCase()&&(G=!0),U.headers[K]=z})),R.dataType&&(U.dataType=R.dataType),R.contentType&&(U.contentType=R.contentType),H.isNumber(R.timeout)&&R.timeout>0&&(U.timeout=R.timeout)),G&&(U.contentType=!1),"blob"==U.dataType&&ece&&(U.mimeType="text/plain; charset=x-user-defined"),C&&(C._onPercent&&(U.beforeSend=function(z,K,oe){z.upload.addEventListener("progress",function(ae){C._onPercent&&XA==x&&C._onPercent(ae)},!1)}),Hp(!!C.IfShowCancelDialogWhenImageTransfer));var X=du(U);C&&C.IfShowCancelDialogWhenImageTransfer&&C.on("cancel",function(){X.abort()})})}),S}var nC=mB(null,0);function Hp(C){var x=H.sizzle(".dynamsoft-btnCancel");x.length>0&&(x[0].style.display=C?"":"none")}function tce(C,x,S,T,D,R,P){try{var O=C[R](P),U=O.value}catch(G){return void S(G)}O.done?x(U):Promise.resolve(U).then(T,D)}function _t(C){return function(){var x=this,S=arguments;return new Promise(function(T,D){var R=C.apply(x,S);function P(U){tce(R,T,D,P,O,"next",U)}function O(U){tce(R,T,D,P,O,"throw",U)}P(void 0)})}}String.prototype.startsWith||(String.prototype.startsWith=function(C){return 0==this.indexOf(C)});var mu,I0,nce=function(C){var x,S=C,T=S._license||"",D=JSON.parse(JSON.stringify(S._licenseServer)),R=S._sessionPassword,P=0;if(T.startsWith("t")||T.startsWith("f"))P=0;else if(0===T.length||T.startsWith("P")||T.startsWith("L")||T.startsWith("Y")||T.startsWith("A"))P=1;else{P=2;var O=T.indexOf(":");if(-1!=O&&(T=T.substring(O+1)),T.startsWith("DLS2")){var U;try{var G=T.substring(4);G=Ee.Lib.atob(G),U=JSON.parse(G)}catch(z){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if("number"==typeof(T=U.handshakeCode?U.handshakeCode:U.organizationID?U.organizationID:"")&&(T=JSON.stringify(T)),0===D.length){var X=[];U.mainServerURL&&(X[0]=U.mainServerURL),U.standbyServerURL&&(X[1]=U.standbyServerURL),D=function(z){if(null==z)z=[];else{z instanceof Array||(z=[z]);for(var K=0;K<z.length;++K){if(document&&document.createElement){var oe=document.createElement("a");oe.href=z[K],z[K]=oe.href}z[K].lastIndexOf("/")!=z[K].length-1&&(z[K]+="/")}}return z}(X)}!R&&U.sessionPassword&&(R=U.sessionPassword),x=U.remark}("200001"===T||T.startsWith("200001-"))&&(D&&D.length||(T="")),T||(P=1)}return 1===P&&(T=""),{lt:P,l:T,ls:D,sp:R,rmk:x}},E0=v(function C(x,S,T,D,R){n(this,C),this.server=x,this.port=S,this.ssl=T,this.useWS=D,this.protocol=R});function ice(C,x){return(null==C?void 0:C.port)==(null==x?void 0:x.port)&&(null==C?void 0:C.protocol)==(null==x?void 0:x.protocol)&&(null==C?void 0:C.server)==(null==x?void 0:x.server)&&(null==C?void 0:C.ssl)==(null==x?void 0:x.ssl)&&(null==C?void 0:C.useWS)==(null==x?void 0:x.useWS)}function Za(C,x){if(x&&("object"===p(x)||"function"==typeof x))return x;if(void 0!==x)throw new TypeError("Derived constructors may only return object or undefined");return function(S){if(void 0===S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}(C)}function qn(C){return(qn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(x){return x.__proto__||Object.getPrototypeOf(x)})(C)}function vB(C,x){return(vB=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,T){return S.__proto__=T,S})(C,x)}function el(C,x){if("function"!=typeof x&&null!==x)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(x&&x.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),x&&vB(C,x)}(function(C){C.OK=0,C.Custom=-1,C.NWB=-4200,C.WS_DISCONN=-4201,C.CB=-5e3,C.JSON_REQUIRED=-5001,C.OBJECT_DISPOSED=-5002,C.INVALID_TASK=-5003,C.OBJECT_DISPOSING=-5004})(mu||(mu={})),function(C){C.WS_DISCONN="The Web Socket connection failed.",C.JSON_REQUIRED="The input is not a JSON object or JSON styled string.",C.OBJECT_DISPOSED="The object has been disposed.",C.INVALID_TASK="The task is invalid.",C.OBJECT_DISPOSING="The object need to be disposed."}(I0||(I0={}));var yB=v(function C(){n(this,C)},null,[{key:"message",value:function(C){return this._errorMessage[C]}},{key:"init",value:function(){this._errorMessage[mu.OK]="Successful.",this._errorMessage[mu.WS_DISCONN]=I0.WS_DISCONN,this._errorMessage[mu.JSON_REQUIRED]=I0.JSON_REQUIRED,this._errorMessage[mu.OBJECT_DISPOSED]=I0.OBJECT_DISPOSED,this._errorMessage[mu.INVALID_TASK]=I0.INVALID_TASK,this._errorMessage[mu.OBJECT_DISPOSING]=I0.OBJECT_DISPOSING}}]);An(yB,"_errorMessage",Object.create(null)),yB.init();var Zr,vu=v(function C(x,S){n(this,C),An(this,"_code",mu.OK),this.name="DSError",this.message=null!=S?S:"string"==typeof x?x:yB.message(x),this._code="string"==typeof x?mu.Custom:x},[{key:"code",get:function(){return this._code}}]);function Zi(C){return{code:C._errorCode,message:C._errorString}}function wc(C){return"exception"in C&&"description"in C&&0!=C.exception&&""!=C.description}function rce(C){return-1416==C}!function(C){C.GET_TASKID=0,C.GET_EVENT_TASKID=1,C.ONMESSAGE_PROCESS_DATA=2,C.ONMESSAGE_GET_TASKID=3,C.ONMESSAGE_GET_EVENT_TASKID=4,C.HANDLE_RAW_MESSAGE=5,C.HANDLE_PROCESSED_MESSAGE=6}(Zr||(Zr={}));var oce=function(){return v(function D(R){n(this,D),An(this,"_serverInfo",void 0),An(this,"_disposed",!1),this._serverInfo=R,this._ref=1},[{key:"serverInfo",get:function(){return this._serverInfo}},{key:"requestSync",value:function(D,R){K1.error("requestSync should be implemented in child class")}},{key:"request",value:(D=_t(B.mark(function R(P,O,U,G){return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return K1.error("request should be implemented in child class"),X.abrupt("return",null);case 2:case"end":return X.stop()}},R)})),function(R,P,O,U){return D.apply(this,arguments)})},{key:"send",value:(T=_t(B.mark(function D(R,P,O){return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:K1.error("reqsenduestSync should be implemented in child class");case 1:case"end":return U.stop()}},D)})),function(D,R,P){return T.apply(this,arguments)})},{key:"testConnection",value:(S=_t(B.mark(function D(R,P,O,U){return B.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return K1.error("testConnection should be implemented in child class"),G.abrupt("return");case 2:case"end":return G.stop()}},D)})),function(D,R,P,O){return S.apply(this,arguments)})},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:(x=_t(B.mark(function D(){return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(this._ref--,!(this._ref>0)){R.next=3;break}return R.abrupt("return",!1);case 3:return this._disposed=!0,R.next=6,this._terminate();case 6:case"end":return R.stop()}},D,this)})),function(){return x.apply(this,arguments)})},{key:"_terminate",value:(C=_t(B.mark(function D(){return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:case"end":return R.stop()}},D)})),function(){return C.apply(this,arguments)})},{key:"addRef",value:function(){this._ref++}}]);var D,C,x,S,T}();function sce(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function _B(C,x,S){return x.has(C),S}var $A,ace=H.getLogger(),lce=new WeakSet,CB=new WeakSet,_je=function(C){function x(){var D,U,G,X;n(this,x);for(var R=arguments.length,P=new Array(R),O=0;O<R;O++)P[O]=arguments[O];return U=this,G=x,X=[].concat(P),G=qn(G),sce(D=Za(U,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(z){return!1}}()?Reflect.construct(G,X||[],qn(U).constructor):G.apply(U,X)),CB),sce(D,lce),D}return el(x,C),v(x,[{key:"send",value:(T=_t(B.mark(function D(R,P,O){return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:ace.error("HTTP Client send not supported");case 1:case"end":return U.stop()}},D)})),function(D,R,P){return T.apply(this,arguments)})},{key:"requestSync",value:function(D,R,P){}},{key:"request",value:function(D,R,P,O){return _B(this,CB,cce).call(this,D,R,P,void 0,void 0,O)}},{key:"testConnection",value:(S=_t(B.mark(function D(R,P,O,U){return B.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.abrupt("return",_B(this,CB,cce).call(this,void 0,void 0,R,P,O,U));case 1:case"end":return G.stop()}},D,this)})),function(D,R,P,O){return S.apply(this,arguments)})}]);var S,T}(oce);function Cje(C){var x=this.serverInfo,S="";return S=x.ssl?"https://":"http://",S+=x.server,x.port&&(S+=":",S+=x.port),C&&(H.startsWith(C,"/")||H.endsWith(S,"/")||(S+="/"),H.endsWith(C,"/")?S+=C.slice(0,-1):S+=C),S}function cce(C,x,S,T,D,R){return bB.apply(this,arguments)}function bB(){return bB=_t(B.mark(function C(x,S,T,D,R,P){var O,U;return B.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.prev=0,O=null!=T?T:{},x&&(O.body=x),O.method||(O.method="POST"),P&&(O.timeout=P),U=_B(this,lce,Cje).call(this,S),ace.debug("HTTP URL: "+U),G.next=9,nC(U,O);case 9:return G.abrupt("return",G.sent);case 12:if(G.prev=12,G.t0=G.catch(0),!(G.t0 instanceof vu||G.t0&&G.t0.code&&G.t0.message)){G.next=18;break}throw G.t0;case 18:if(!G.t0.message){G.next=20;break}throw new vu(G.t0.message);case 20:case"end":return G.stop()}},C,this,[[0,12]])})),bB.apply(this,arguments)}function bje(C){try{return"object"===p(C)?C:(C="string"!=typeof C?H.stringify(C):C,H.parse(C))}catch(x){throw x instanceof vu?x:new vu(mu.JSON_REQUIRED)}}function FS(C){return Math.random().toString(16).substring(2,2+C)}function D0(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function xf(C,x,S){return x.has(C),S}var qA,uce,tl=H.getLogger(),dce=new WeakSet,hce=new WeakSet,fce=new WeakSet,pce=new WeakSet,KA=new WeakSet,xB=new WeakSet,gce=new WeakSet,wB=function(C){function x(R){var P,O,U,G;return n(this,x),O=this,G=[R],U=qn(U=x),D0(P=Za(O,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(X){return!1}}()?Reflect.construct(U,G||[],qn(O).constructor):U.apply(O,G)),gce),D0(P,xB),D0(P,KA),D0(P,pce),D0(P,fce),D0(P,hce),D0(P,dce),An(P,"_defaultRetries",1),An(P,"_ws",qA),An(P,"_events",{}),An(P,"_bHeartBeatStarted",!1),An(P,"_heartBeatTicks",6e4),P._ws=qA,P.bUseParentWS=!1,P._tasks=Object.create(null),P.bReady=!1,P._blob_callbacks=[],P._processing_blob=!1,P}return el(x,C),v(x,[{key:"ws",get:function(){return this._ws}},{key:"requestSync",value:function(R,P,O){tl.error("WebSocket Client requestSync not supported")}},{key:"send",value:(D=_t(B.mark(function R(P,O,U){var G,X,z,K;return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(G=U.client,oe.prev=1,void 0!==(X=U.taskId)){oe.next=7;break}return oe.next=6,O(P,Zr.GET_TASKID,G._requestTaskId,U);case 6:X=oe.sent;case 7:if(z=G._tasks[X]){oe.next=11;break}throw tl.error("invalid task id: "+X),new vu(mu.INVALID_TASK);case 11:return oe.next=13,xf(G,KA,IB).call(G,!1);case 13:return oe.next=15,xf(G,xB,mce).call(G,P,O,U,z);case 15:tl.debug("begin to send data "+X),G.disposed||G._ws.send(P),P=null,tl.debug("end to send data "+X),oe.next=27;break;case 21:oe.prev=21,oe.t0=oe.catch(1),tl.debug("failed to send data."),tl.error(oe.t0),delete G._tasks[X],null===(K=z)||void 0===K||null===(K=K.resolver)||void 0===K||K.reject(oe.t0.message);case 27:case"end":return oe.stop()}},R,null,[[1,21]])})),function(R,P,O){return D.apply(this,arguments)})},{key:"request",value:function(R,P,O,U){var G=this._defaultRetries,X=null!=P?P:xf(this,pce,Ije),z=null!=O?O:{client:this,userData:this};return xf(this,gce,Eje).call(this,R,X,z,G,!1,void 0,U)}},{key:"connected",get:function(){var R;return(null===(R=this._ws)||void 0===R?void 0:R.readyState)==WebSocket.OPEN}},{key:"testConnection",value:function(R,P,O,U){return xf(this,KA,IB).call(this,!0,null!=P?P:0,O,U)}},{key:"_terminate",value:(T=_t(B.mark(function R(){var P,O;return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:for(O in tl.debug("terminate WSClient"),this.fireEvent("disposed"),P=!1,this._tasks)void 0!==this._tasks[O]&&this._tasks[O].resolver&&(P=!0);if(this._lic_callback=qA,this._blob_callbacks=[],this._processing_blob=!1,this._ws&&(this._ws.onopen=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.close()),this._ws=qA,this._tasks=Object.create(null),!P){U.next=12;break}throw new vu(mu.OBJECT_DISPOSING);case 12:case"end":return U.stop()}},R,this)})),function(){return T.apply(this,arguments)})},{key:"setRetry",value:function(R){this._defaultRetries=null!=R?R:1}},{key:"addEvent",value:function(R,P,O){var U=this._events[R];U||(this._events[R]={},U=this._events[R]),H.isString(P)&&H.isFunction(O)&&(U[P]=O)}},{key:"removeEvent",value:function(R,P){var O=this._events[R];O&&H.isString(P)&&delete O[P]}},{key:"clearEvent",value:function(R){this._events[R]&&(this._events[R]={})}},{key:"fireEvent",value:function(R){var P,O=this._events[R];if(O){var U=Object.keys(O);for(P=0;P<U.length;P++)H.isFunction(O[U[P]])&&O[U[P]]()}}},{key:"getRequestTaskId",value:function(){return this._requestTaskId?this._requestTaskId:0}}],[{key:"_waitForPreBlob",value:(S=_t(B.mark(function R(P){return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!P._processing_blob){O.next=3;break}return setTimeout(function(){x._waitForPreBlob(P)},500),O.abrupt("return");case 3:x._preBlobResolv&&x._preBlobResolv();case 4:case"end":return O.stop()}},R)})),function(R){return S.apply(this,arguments)})}]);var S,T,D}(oce);function wje(C){var x="";return x=C.ssl?"wss://":"ws://",x+=C.server,C.port&&(x+=":",x+=C.port),x}function Sje(C,x,S,T){var D=this;return new me.Promise(function(R,P){try{var O,U,G=P,X=R;if(T&&(U=setTimeout(function(){var ae=new vu("createWebSocket timed out.");tl.debug(ae.message),G&&(G(ae),G=null,X=null),U&&clearTimeout(U),O&&O.close()},T)),C.bUseParentWS){var z=window,K=parent,oe=z.WebSocket;try{for(;z!=K&&K&&K.WebSocket;)oe=K.WebSocket,z=K.window,K=K.parent}catch(ae){oe=window.WebSocket}O=S?new oe(x,S):new oe(x)}else O=S?new WebSocket(x,S):new WebSocket(x);O.onopen=function(){U&&clearTimeout(U),C._ws=O,X&&(X(O),G=null,X=null)},O.onerror=function(ae){O.close(),C.bReady=!1,U&&clearTimeout(U),D.fireEvent("error"),G&&(G(new vu("websocket error")),G=null,X=null)},O.onmessage=function(ae){xf(C,fce,Tje).call(C,C,ae.data)},O.onclose=function(ae){C.bReady=!1,U&&clearTimeout(U),D.fireEvent("close"),G&&(G(ae&&1006==ae.code?new vu("websocket error"):ae),G=null,X=null)}}catch(ae){if(ae instanceof vu||ae&&ae.code&&ae.message)throw ae;if(ae.message)throw new vu(ae.message)}})}function Tje(C,x){return SB.apply(this,arguments)}function SB(){return SB=_t(B.mark(function C(x,S){var T,D,R,P,O,U,G,X,z;return B.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(T=x,K.prev=1,P={client:T,userData:void 0},"object"!==p(S)){K.next=17;break}if(!(T._blob_callbacks.length>0)){K.next=17;break}if(!T._processing_blob){K.next=9;break}return K.next=8,new me.Promise(function(oe){$A._preBlobResolv=oe,$A._waitForPreBlob(T)});case 8:$A._preBlobResolv=null;case 9:return T._processing_blob=!0,O=T._blob_callbacks.shift(),K.next=13,O(S);case 13:return T._processing_blob=!1,K.abrupt("return");case 17:if(!(T.bReady&&H.isString(S)&&(S.indexOf("Function not found")>0||S.indexOf("Version not found")>0))){K.next=19;break}return K.abrupt("return");case 19:if(T._cbToGetTaskId){K.next=21;break}return K.abrupt("return");case 21:return K.next=23,T._cbToGetTaskId(S,Zr.ONMESSAGE_PROCESS_DATA,T._requestTaskId,P);case 23:return U=K.sent,G=!1,K.next=27,T._cbToGetTaskId(U,Zr.ONMESSAGE_GET_TASKID,T._requestTaskId,P);case 27:if(R=K.sent){K.next=36;break}if(!U.Detail||!U.Domain){K.next=32;break}return T._lic_callback&&T._lic_callback(U),K.abrupt("return");case 32:return K.next=34,T._cbToGetTaskId(U,Zr.ONMESSAGE_GET_EVENT_TASKID,T._requestTaskId,P);case 34:(R=K.sent)&&(G=!0);case 36:if(D=T._tasks[R]){K.next=46;break}if(!G){K.next=42;break}D={},K.next=44;break;case 42:return""!=R&&tl.log("invalid task id: "+R),K.abrupt("return");case 44:K.next=48;break;case 46:if(!D.timedout){K.next=48;break}return K.abrupt("return");case 48:return K.next=50,T._cbToGetTaskId(S,Zr.HANDLE_RAW_MESSAGE,T._requestTaskId,D.ctx);case 50:if(void 0!==(X=K.sent)){K.next=55;break}return K.next=54,T._cbToGetTaskId(U,Zr.HANDLE_PROCESSED_MESSAGE,T._requestTaskId,D.ctx);case 54:X=K.sent;case 55:X&&!G&&(D.tmid&&clearTimeout(D.tmid),delete T._tasks[R],D.resolver&&D.resolver.resolve(X)),K.next=64;break;case 58:K.prev=58,K.t0=K.catch(1),tl.debug("failed to handle message."),K.t0 instanceof Error?tl.error(K.t0):tl.error(H.stringify(K.t0)),delete T._tasks[R],null===(z=D)||void 0===z||null===(z=z.resolver)||void 0===z||z.reject(K.t0.message);case 64:case"end":return K.stop()}},C,null,[[1,58]])})),SB.apply(this,arguments)}function Ije(C,x,S){return TB.apply(this,arguments)}function TB(){return TB=_t(B.mark(function C(x,S,T){var D,R;return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:P.t0=S,P.next=P.t0===Zr.GET_TASKID?3:P.t0===Zr.HANDLE_RAW_MESSAGE?7:9;break;case 3:return(R=bje(x)).cmdId=null!==(D=R.cmdId)&&void 0!==D?D:[FS(8),"-",FS(4),"-",FS(4),"-",FS(4),"-",FS(8)].join(""),me.Promise.resolve(["cmdId"]),P.abrupt("break",9);case 7:return me.Promise.resolve(x),P.abrupt("break",9);case 9:case"end":return P.stop()}},C)})),TB.apply(this,arguments)}function IB(C,x,S,T){return EB.apply(this,arguments)}function EB(){return EB=_t(B.mark(function C(x,S,T,D){var R,P,O,U;return B.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!this.connected&&!this.disposed){G.next=2;break}return G.abrupt("return");case 2:if(!(O=this)._connectPromise){G.next=7;break}return G.next=6,O._connectPromise;case 6:return G.abrupt("return");case 7:return S=null!==(R=S)&&void 0!==R?R:this._defaultRetries,T=null!==(P=T)&&void 0!==P?P:100,U=xf(O,dce,wje).call(O,O.serverInfo),tl.debug("WebSocket URL: "+U+", try to create websocket "+S+"/"+T),O._connectPromise=new me.Promise(function(X,z){var K=function(ae){xf(O,hce,Sje).call(O,O,U,O.serverInfo.protocol,D).then(function(ue){X(ue)}).catch(function(ue){tl.debug("create websocket failed: "+ue.message),ae<S?function oe(ae,ue,ye){setTimeout(function(){K(++ae)},T)}(ae):z(ue)})};K(0)}),G.prev=12,G.next=15,O._connectPromise;case 15:G.next=20;break;case 17:throw G.prev=17,G.t0=G.catch(12),G.t0;case 20:return G.prev=20,O._connectPromise=null,G.finish(20);case 23:case"end":return G.stop()}},C,this,[[12,17,20,23]])})),EB.apply(this,arguments)}function mce(C,x,S,T){return DB.apply(this,arguments)}function DB(){return DB=_t(B.mark(function C(x,S,T,D){var R,P,O,U;return B.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(R=this,O=T.lastEventTaskId,void 0!==(P=T.eventTaskId)){G.next=7;break}return G.next=6,S(x,Zr.GET_EVENT_TASKID,R._requestTaskId,T);case 6:P=G.sent;case 7:P&&(R._tasks[P]?T&&T.userData&&T.userData.command&&((U=R._tasks[P]).ctx=T,O&&((U=R._tasks[O]).ctx=T)):(R._tasks[P]=U={id:D.id,resolver:null,ctx:T,timedout:!1},O&&(R._tasks[O]=U)));case 8:case"end":return G.stop()}},C,this)})),DB.apply(this,arguments)}function Eje(C,x,S,T,D,R,P){return AB.apply(this,arguments)}function AB(){return AB=_t(B.mark(function C(x,S,T,D,R,P,O){var U,G,X,z;return B.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return U=this,K.prev=1,T.client=U,K.next=5,xf(U,KA,IB).call(U,R,D,P,O);case 5:if("0"!=(G=T.taskId)){K.next=12;break}return U.disposed||U._ws.send(x),x=null,K.abrupt("return");case 12:if(void 0!==G){K.next=16;break}return K.next=15,S(x,Zr.GET_TASKID,null,T);case 15:G=K.sent;case 16:return void 0===G&&tl.debug("websocket send: task id is invalid."),(X={}).promise=new me.Promise(function(oe,ae){X.resolve=oe,X.reject=ae}),U._tasks[G]=z={id:G,resolver:X,ctx:T,timedout:!1},U._requestTaskId=G,K.next=24,xf(U,xB,mce).call(U,x,S,T,z);case 24:return U._cbToGetTaskId=S,O&&(z.tmid=setTimeout(function(){tl.debug("ws request time out."),z.timedout=!0,z.resolver.reject("request timed out.")},O)),U.disposed||U._ws.send(x),tl.debug("end to send task "+G),x=null,K.abrupt("return",X.promise);case 32:if(K.prev=32,K.t0=K.catch(1),G&&delete U._tasks[G],!(K.t0 instanceof vu||K.t0&&K.t0.code&&K.t0.message)){K.next=39;break}throw K.t0;case 39:if(!K.t0.message){K.next=41;break}throw new vu(K.t0.message);case 41:return K.prev=41,x=null,K.finish(41);case 44:case"end":return K.stop()}},C,this,[[1,32,41,44]])})),AB.apply(this,arguments)}function vce(C,x){var S="undefined"!=typeof Symbol&&C[Symbol.iterator]||C["@@iterator"];if(!S){if(Array.isArray(C)||(S=function(U,G){if(U){if("string"==typeof U)return yce(U,G);var X=Object.prototype.toString.call(U).slice(8,-1);if("Object"===X&&U.constructor&&(X=U.constructor.name),"Map"===X||"Set"===X)return Array.from(U);if("Arguments"===X||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(X))return yce(U,G)}}(C))||x&&C&&"number"==typeof C.length){S&&(C=S);var T=0,D=function(){};return{s:D,n:function(){return T>=C.length?{done:!0}:{done:!1,value:C[T++]}},e:function(U){throw U},f:D}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var R,P=!0,O=!1;return{s:function(){S=S.call(C)},n:function(){var U=S.next();return P=U.done,U},e:function(U){O=!0,R=U},f:function(){try{P||null==S.return||S.return()}finally{if(O)throw R}}}}function yce(C,x){(null==x||x>C.length)&&(x=C.length);for(var S=0,T=new Array(x);S<x;S++)T[S]=C[S];return T}function _ce(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function Cce(C,x,S){return x.has(C),S}$A=wB;var bce=new WeakSet,xce=new WeakSet,wf=function(){function C(){n(this,C),_ce(this,xce),_ce(this,bce),An(this,"_maxWebSocketCon",10),An(this,"_wsClients",[])}return v(C,[{key:"removeTerminatedWSClient",value:function(){this._wsClients=this._wsClients.filter(function(S){return!S.disposed})}},{key:"getClient",value:function(S,T){return S.useWS?Cce(this,xce,Aje).call(this,S,T):new _je(S)}},{key:"closeClient",value:(x=_t(B.mark(function S(T){var R,P,O;return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:R=vce(this._wsClients),U.prev=2,R.s();case 4:if((P=R.n()).done){U.next=12;break}if(!ice((O=P.value).serverInfo,T)){U.next=10;break}if(O.disposed){U.next=10;break}return U.next=10,O.dispose();case 10:U.next=4;break;case 12:U.next=17;break;case 14:U.prev=14,U.t0=U.catch(2),R.e(U.t0);case 17:return U.prev=17,R.f(),U.finish(17);case 20:this.removeTerminatedWSClient();case 21:case"end":return U.stop()}},S,this,[[2,14,17,20]])})),function(S){return x.apply(this,arguments)})},{key:"terminate",value:function(){var S=this._wsClients.slice();this._wsClients=[],S.forEach(function(T){T.dispose()})}}],[{key:"Instance",get:function(){return this._gClientPool||(this._gClientPool=new C),this._gClientPool}}]);var x}();function Dje(C){this.removeTerminatedWSClient();var x,S=vce(this._wsClients);try{for(S.s();!(x=S.n()).done;){var T=x.value;if(ice(T.serverInfo,C)&&!T.disposed)return T.addRef(),T}}catch(D){S.e(D)}finally{S.f()}return null}function Aje(C,x){var S;return x||(S=Cce(this,bce,Dje).call(this,C)),S||(this._wsClients.length<this._maxWebSocketCon?((S=new wB(C)).addEvent("disposed","1",function(){uce.Instance.removeTerminatedWSClient()}),this._wsClients.push(S),S):null)}uce=wf,An(wf,"_gClientPool",null);var Gp=function(){function C(){n(this,C)}return v(C,null,[{key:"getHttpClientForDcp",value:function(x,S){var T,D=be.dcp,R=me.detect.ssl;if(S||!he.bSSL?(T=D.Port,R=!1):(T=D.SSLPort,R=!0),H.isString(x)){var P=new E0;return H.startsWith(x,"https://")?(P.ssl=!0,P.server=x.substring(8)):H.startsWith(x,"http://")?(P.ssl=!1,P.server=x.substring(7)):(P.ssl=me.detect.ssl,P.server=x),wf.Instance.getClient(P)}return C.getHttpClient(null,T,R)}},{key:"getHttpClient",value:function(x,S,T){var D=T?"https":"http",R=new E0(x||Ja(),S,T,!1,D);return wf.Instance.getClient(R)}},{key:"getWsClient",value:function(x,S,T,D){var R=new E0(x||Ja(),S,T,!0,$n.wsProtocol);return wf.Instance.getClient(R,D)}},{key:"closeWsClient",value:function(x,S,T){var D=new E0(x||Ja(),S,T,!0,$n.wsProtocol);return wf.Instance.closeClient(D)}}])}();me.ClientPool=wf;var LS,Pje=parseInt(ld),Rje=parseInt(NA),kje=parseInt("0"),wce="ddm/",zp="ddm_"+[Pje,Rje,kje,Im].join("");function Sce(){return wce+zp}function Mje(C){return Tce.apply(this,arguments)}function Tce(){return(Tce=_t(B.mark(function C(x){var S,T,D,R;return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return S=AS,T=[Sce(),"/VersionInfo?","ts=",H.now()].join(""),D=['{"id":"',H.guid(),'","method":"VersionInfo"}'].join(""),R=Gp.getHttpClientForDcp(x),P.abrupt("return",R.request(D,T,{dataType:"json"},S));case 4:case"end":return P.stop()}},C)}))).apply(this,arguments)}function PB(){var C=window.Dynamsoft.Lib.Promise;if(LS)return C.resolve(LS);var S,T=navigator;if(T&&"userAgentData"in T){var D=navigator.userAgentData;if(D.platform&&""!=D.platform){var R=[];if("brands"in D&&H.isArray(D.brands)&&D.brands.length>0?R=D.brands:"uaList"in D&&H.isArray(D.uaList)&&D.uaList.length>0&&(R=D.uaList),R.length>0)return(S=function(P){var O=he,U=P.architecture.toLowerCase(),G="64"==P.bitness,X=U.indexOf("arm")>-1,z=U.indexOf("mips")>-1;return{bUseUserAgent:!1,bWin:O.bWin,bMac:O.bMac,bLinux:O.bLinux,bAndroid:O.bAndroid,bMobile:O.bMobile,bPad:O.bPad,bChromeOS:O.bChromeOS,bHarmonyOS:O.bHarmonyOS,bArm64:X,bMips64:z,bEmbed:X||z,bOSx64:G,bIE:!1,bEdge:O.bEdge,bChrome:O.bChrome,bFirefox:O.bFirefox,bSafari:O.bSafari,bOpera:O.bOpera,bGecko:!0,bHuaWeiBrowser:!1,bHTML5Edition:!0,strBrowserVersion:O.strBrowserVersion,IEMode:0}},navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","bitness"]).then(S)).then(function(P){return LS=P,P})}}return C.resolve(LS=he)}me.install={_divDWTNonInstallContainerID:"dwt-NonInstallContainerID",_divDWTemessageContainer:"",_dlgInstall:!1},me.install._strNonInstallDIV=['<div style="text-align:center;" id="',me.install._divDWTNonInstallContainerID,'"></div>'].join("");var RB=0,kB=[],MB=!(!document||!document.addEventListener),Ice="DOMContentLoaded",Ece="readystatechange",OB=MB?function(C,x,S){C.addEventListener(x,S,!1)}:function(C,x,S){C.attachEvent("on"+x,S)},FB=MB?function(C,x,S){C.removeEventListener(x,S,!1)}:function(C,x,S){C.detachEvent("on"+x,S)};function iC(){RB||(RB=1,PB().then(function(){document&&FB(window,"load",iC),function(){for(var C=function(){try{kB[x]()}catch(S){H.log(S,"error"),setTimeout(function(){throw S},0)}},x=0;x<kB.length;x++)C()}()}))}function rC(C){if(RB)try{C()}catch(x){H.log(x,"error"),setTimeout(function(){throw x},0)}else kB.push(C);return this}function lo(C){H.log(C)}rC(function(){var C=document.createElement("style"),x=["dialog[open]{display:block}dialog[closed]{display:none}.dynamsoft-backdrop{position:fixed;background:rgba(128,128,128,0.1);top:0;bottom:0;left:0;right:0;z-index:-99999999;}.dynamsoft-dwt-dialogProgress{width:330px;background:#FFF}.dynamsoft-finalMessage{margin:0;color:#3a3a3a;font:20px Arial,sans-serif}.dynamsoft-desc{margin:7px 0;color:#3a3a3a;font:14px Arial,sans-serif}.dynamsoft-status{color:#555;font:14px/22px Arial,sans-serif;margin-bottom:5px}.dynamsoft-progressBar{-webkit-appearance:none;width:280px;margin-bottom:20px;height:14px}.dynamsoft-progressBar,.dynamsoft-progressBar::-webkit-progress-bar{background-color:#e7e7e7;border-radius:7px}.dynamsoft-progressBar::-webkit-progress-value,.dynamsoft-progressBar::-moz-progress-bar{background-color:#50a8e1;border-radius:7px}.dynamsoft-loadingMsg{width:290px;height:290px;margin:auto;color:#CCC;border-width:1px;background:#FFF}.dynamsoft-loadingMsg-msg{margin:0 0 15px 25px;color:#3a3a3a;font:20px Arial,sans-serif}.dynamsoft-loadingMsg-desc{text-align:center;margin:0 0 15px 0;color:#3a3a3a;font:14px Arial,sans-serif}.ds-dwt-loaderBar-noserver-parent{height:100%;}.ds-dwt-loaderBar-noserver{margin: 0 auto;padding-top: 50px;text-align: center;}.ds-dwt-loaderBar-noserver img{height: 100px}"].join("");C.type="text/css";try{C.appendChild(document.createTextNode(x))}catch(S){C.styleSheet.cssText=x}document.body.appendChild(C)}),me._zdgb_xkz_dhk=function(){var C=me.install._dlgInstall;if(C){var x=H.sizzle(".dynamsoft-dialog-closeTimer",C);if(x.length>0){var S=x[0],T=parseInt(S.style.width);(T-=1)<=0?be.DWT.CloseDialog():(S.style.width=T+"%",setTimeout(me._zdgb_xkz_dhk,100))}}},me.ShowLicenseDialog=be.DWT.ShowMessage,me.createLoadingBarContent=function(){};var mr,Pce="All scripts and css loaded.",Fje="Checking Product Key format...",Lje="Initializing the service...",Nje="Checking the service enhanced module...",Rce="Getting the WebTwain port...",Bje="Checking the WebTwain module...",Wje="Checking the WebTwain version...",Uje="Check the WebTwain version successfully.",kce="The WebTwain version not compatible.",Vje="Getting Machine ID.",jje="Creating WebTwain from Dynamsoft.DWT.Containers...",Mce="Decoding the license...",Oce="Checking the license...";function Yp(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function Sc(C,x,S){return x.has(C),S}!function(C){C.CM_RENDERALL=1,C.CM_IMAGEONLY=2,C.CM_AUTO=3,C.CM_RENDERALLWITHANNOTATION=4}(mr||(mr={}));var Fce=ld+".",Hje=parseInt(ld);function oC(C){return H.isString(C)?H.trim(C):C}var LB=new WeakSet,Lce=new WeakSet,NB=new WeakSet,Nce=new WeakSet,Bce=new WeakSet,Wce=new WeakSet,JA=new WeakSet,Uce=new WeakSet,BB=new WeakSet,Gje=v(function C(){n(this,C),Yp(this,BB),Yp(this,Uce),Yp(this,JA),Yp(this,Wce),Yp(this,Bce),Yp(this,Nce),Yp(this,NB),Yp(this,Lce),Yp(this,LB),An(this,"isLTS",Qa)},[{key:"isLongKey",value:function(C){if(H.isString(C)&&C.length>0){var x=C.charAt(0);if("f"==x||"t"==x)return!0;if(H.startsWith(C,"DLS")||H.isNumber(C))return!1;var S=parseInt(C)+"-";return!H.startsWith(C,S)}return!1}},{key:"isLicenseMixed",value:function(C,x){var S,P,T=!1,D=C||be.DWT.ProductKey;if(be.DWT.lclex(),x&&(oC(be.DWT.organizationID)||oC(be.DWT.handshakeCode))&&D&&(T=!0,St(S={},-2444,"A license can only be specified once and has already been set using the ProductKey API.")),!T&&H.isString(D)&&(D=H.trim(D),!H.startsWith(D,"f")&&!H.startsWith(D,"t"))&&""!=D)if(H.startsWith(D,"DLS2"))try{Sc(this,Lce,zje).call(this,D)}catch(P){T=!0,St(S={},-2440,""),S._errorString=P.message}else Sc(this,LB,Vce).call(this,D).LTS||(T=!0,St(P=S={},Zs.LicenseParseFailed,"The license is invalid."));return T&&S&&(Ao(S),H.error(be.DWT.licenseException.message)),T}},{key:"reparseProductKey",value:function(C){C&&lo("Parsing Product Key...");var x=oC(be.DWT.organizationID),S=oC(be.DWT.handshakeCode),T=x||S,D=H.trim(be.DWT.ProductKey);if(!T){var R=Sc(this,LB,Vce).call(this,D);R.LTS&&(S=oC(R.handshakeCode),T=(x=oC(R.organizationID))||S)}if(T)return this._innerResetLicense(),H.isNumber(D)&&(x=D),Tt.handshakeCode=S,Tt.organizationID=x,Tt.licenseServer=be.DWT.licenseServer,Tt.sessionPassword=be.DWT.sessionPassword,void(Tt.bPublicLTS=Sc(this,NB,jce).call(this,Tt.licenseServer,T));var P=!1;if(Tt.refProductKey!==D&&(this._innerResetLicense(),H.isString(D)&&D.length>0&&(Tt.refProductKey=D,P=!0)),P)if(this.isLongKey(Tt.refProductKey))Tt.bPublicLTS=!1;else{var O,U={_pLoad:{isEmpty:Nt},_license:Tt.refProductKey,_licenseServer:[]};try{O=nce(U)}catch(X){H.error(X),O=!1}if(O&&H.isString(O.l)){var G=H.trim(O.l);""==G?Tt.organizationID=G:-1!=G.indexOf("-")?Tt.handshakeCode=G:Tt.organizationID=G,H.isArray(O.ls)&&O.ls.length>0&&(Tt.licenseServer=O.ls),Tt.bPublicLTS=Sc(this,NB,jce).call(this,Tt.licenseServer,G),Tt.sessionPassword=O.sp}else Tt.bPublicLTS=!1}}},{key:"_innerResetLicense",value:function(){Tt.refProductKey="",Tt.handshakeCode=void 0,Tt.organizationID=void 0,Tt.licenseServer=void 0,Tt.sessionPassword="",Tt.bPublicLTS=!0}},{key:"checkOSForAllowCore",value:function(C,x,S){return Tt.bHTML5Edition?C?Sc(this,BB,Hce).call(this,x):this.isOSOK(x,S._bRemoteMode,S.__serverPlatform):Nt}},{key:"checkLocalPlatformForRemoteService",value:function(C){var x,S,T,O,D=C.__licenseInfo,R=ql.getEnumPlatform(),P=!1;for(x=0;x<D.Detail.length&&(S=D.Detail[x],!((T=Sc(this,JA,WB).call(this,S.EnumLicenseType,S.LicenseType)).Core&&H.isString(S.Version)&&0==S.Version.indexOf(Fce)&&((P=Sc(this,BB,Hce).call(this,S.OS))||(P=this.isOSOK(S.OS,!0,R))||!C._blts&&C._bScanForProxyRemote&&T.RemoteScan)));x++);return P||(R==Rn.enumWindow?(St(O=C,-2344,"The current product key does not support Windows OS. "+ea()),Ao(O)):R==Rn.enumLinux?function(O){St(O,-2346,"The current product key does not support Linux OS. "+ea()),Ao(O)}(C):R==Rn.enumMac?function(O){St(O,-2345,"The current product key does not support MAC OS. "+ea()),Ao(O)}(C):function(O){St(O,-2347,"The current product key does not support your OS. "+ea()),Ao(O)}(C)),P}},{key:"checkProductKey",value:function(C,x,S){var T,D=be.DWT.licenseException;return!x.Camera&&(C.__licenseInfo||(C.__licenseInfo={}),(T=Sc(this,Bce,Xje).call(this,C,C.__licenseInfo,yt,x,S))||(D.code=C._errorCode,D.message=C._getErrorString(),D.fromLTS=!1),T)}},{key:"isBindDomainOK",value:function(C){if(H.isUndefined(C)||null==C||""==C||"*"==C||"*.*"==C)return Nt;var x=location.hostname,S=yt;if(""==x)return Nt;for(var T=x.toLowerCase().split("."),D=T.length,R=C.toLowerCase().split(";"),P=0;P<R.length;P++){var O=R[P];if("*.*"==O){S=Nt;break}var U=O.split("."),G=U.length;if(G>0&&G-1<=D){for(var X=Nt,z=G-1;z>0;z--){if(U[z].indexOf("*")>-1){S=Nt;break}if(z+D-G>=0){if(T[z+D-G]!=U[z]){X=yt;break}}else if("*"!=U[z]){X=yt;break}}if(X&&("*"==U[0]||D>=G&&T[D-G]==U[0])){S=Nt;break}}}return S}},{key:"isExpiredOrFuture",value:function(C,x){if(""==C)return yt;if(!x){var S=C.length;if(S>2&&"/"==C[S-2]&&"0"==C[S-1])return yt}var T=sC(C),D=(new Date).getTime(),R=D+5184e6;return T.getTime()<D||x&&T.getTime()>R?Nt:yt}},{key:"willTrialExpire",value:function(C){if(""==C)return yt;var x=sC(C),S=(new Date).getTime();return x.getTime()<S+432e6&&x.getTime()>S?Nt:yt}},{key:"isOSOK",value:function(C,x,S){var T=!1,D=!1,R=!1,P=!1,O=!1,U=!1,G=!1,X=!1;return""==C||"0"==C?Nt:(x?S==Rn.enumWindow?R=!0:S==Rn.enumLinux?D=!0:S==Rn.enumMac?T=!0:S==Rn.enumEmbed?O=!0:S==Rn.enumChromeOS?U=!0:S==Rn.enumAndroid?G=!0:S==Rn.enumHarmonyOS?X=!0:S==Rn.enumiOS&&(P=!0):(T=he.bMac,D=he.bLinux,R=he.bWin,P=he.biPhone||he.biPad,U=he.bChromeOS,O=be.navInfo.bEmbed,G=he.bAndroid,X=he.bHarmonyOS),(C=C.toLowerCase()).indexOf("windows")>-1&&R||C.indexOf("mac")>-1&&T||C.indexOf("linux")>-1&&(D||U||X)||C.indexOf("android")>-1&&G||C.indexOf("ios")>-1&&P||C.indexOf("embed")>-1&&O?Nt:yt)}},{key:"isBrowserOK",value:function(C){if(H.isString(C)){if(""==C||"0"==C)return Nt;var x=(C=C.toLowerCase()).split(";"),S=yt;return H.each(x,function(T){("chrome"==H.trim(T)&&(he.bChrome||he.bSafari||he.bOpera||he.bEdge)||"ie"==H.trim(T)&&he.bIE||"firefox"==H.trim(T)&&he.bFirefox)&&(S=Nt)}),S}return yt}},{key:"isAllowLicenseType",value:function(C,x){return x.Core?C.Core:x.PDFRasterizer?C.PDFRasterizer:x.Webcam||x.Camera?C.Webcam:x.barcode1D?C.barcode1D:x.QR?C.QR:x.PDF417?C.PDF417:x.DataMatrix?C.DataMatrix:x.OCR?C.OCR:x.OCRPro?C.OCRPro:C.Core}},{key:"setNoAllowedLicenseTypeError",value:function(C,x,S){var T;S.Core?RS(C):S.Webcam||S.Camera?x||S.Camera?((T=C)._errorCode=-2431,Qa()?T._errorString="The license for the Camera Addon is not found or has expired.":St(T,-2431,"The current product key does not support Camera Addon. "+ea()),Ao(T)):function(T){T._errorCode=-2338,T._errorString=Qa()?"The license for the module direct show is not found or has expired.":"The current product key does not support Webcam. "+ea(),Ao(T)}(C):S.PDFRasterizer?x?function(T){T._errorCode=-2370,T._errorString=Qa()?"The license for the module pdf rasterizer is not found or has expired.":"The current product key does not support Pdf Rasterizer Wasm. "+ea(),Ao(T)}(C):Z1(C):S.OCR?function(T){T._errorCode=-2340,T._errorString=Qa()?"The license for the module ocr is not found or has expired.":"The current product key does not support OCR. "+ea(),Ao(T)}(C):S.OCRPro?function(T){T._errorCode=-2341,T._errorString=Qa()?"The license for the module ocr pro is not found or has expired.":"The current product key does not support OCR pro. "+ea(),Ao(T)}(C):pu(C)}},{key:"getLicenseDateString",value:function(C){var x,S=C.getFullYear();return[(x=C.getMonth()+1)>=10?""+x:"0"+x,"/",C.getDate()>=10?""+C.getDate():"0"+C.getDate(),"/",S].join("")}},{key:"hasPDFRProductKey",value:function(C){return!!this.checkProductKey(C,{PDFRasterizer:!0},!0)||(C._resetErr(),!1)}},{key:"checkPDFProductKeyWhenNeeds",value:function(C,x){var S;return x!=be.DWT.EnumDWT_ImageType.IT_PDF&&x!=be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||(Tt.bHTML5Edition?C.__addon&&C.__addon.PDF&&(S=C._getConvertMode()):C.Addon&&C.Addon.PDF&&(S=C._getConvertMode()),S!=mr.CM_RENDERALL&&S!=mr.CM_RENDERALLWITHANNOTATION)?Nt:this.checkProductKey(C,{PDFRasterizer:!0},!0)}},{key:"getPublicLicenseContent",value:function(C){var x=[],S=C;if(!H.isString(S)){if(H.isUndefined(S))return"";S=S instanceof Error||"message"in S?S.message:""+S}var T=S.indexOf("["),D=S.indexOf("]",T),R=S.indexOf("(",D),P=S.indexOf(")",R);if(-1==T||-1==D||-1==R||-1==P)return S;T>0&&x.push(S.substring(0,T));var O=S.substring(T+1,D),U=S.substring(R+1,P);return x.push(['<a href="',U,'" target="_blank" class="dynamsoft-major-color">',O,"</a>"].join("")),x.push(S.substring(P+1)),x.join("")}},{key:"getLTSLicense",value:function(){return Tt.bPublicLTS?"":Tt.handshakeCode||Tt.organizationID}}]);function Vce(C){var x,S,T=C,D=C.indexOf("-"),R=-1!=D;return S={},R&&(T=C.substring(0,D)),x=Number(T),isNaN(x)||String(Number(x))!==T||(R?S.handshakeCode=C:S.organizationID=C,S.LTS=Nt),S}function zje(C){nce({_pLoad:{isEmpty:Nt},_license:C,_licenseServer:[]})}function jce(C,x){var S=!0;if(H.isArray(C)&&C.length>0){var T=C[0];H.isString(T)&&""!=T&&-1==T.indexOf("https://mlts.dynamsoft.com")&&(S=!1)}return S&&(!x||"200001"===x||H.startsWith(x,"200001-"))}function Yje(C,x,S){return this.checkOSForAllowCore(C,x,S)}function Xje(C,x,S,T,D){var R,P=!1;if(Tt.bHTML5Edition&&H.isFunction(C._needCheckProxyRemoteScanLicense)&&(P=C._needCheckProxyRemoteScanLicense()),x&&x.LTS){if(!x||!H.isArray(x.Detail)||0==x.Detail.length)return this.isLTS()?RS(C):pu(C),yt}else if(!x||!H.isArray(x.Detail)||0==x.Detail.length)return this.isLTS()?RS(C):pu(C),yt;var O,U,G,X,Be,z=0,K=0,oe=[],ae=[],ue=yt,ye=yt,Ie=yt,Ue=yt,He=yt;if(!this.isBindDomainOK(x.Domain))return St(Be=C,-2342,"The domain of your current site does not match the domain bound in the current product key. "+ea()),Ao(Be),yt;for(x.Detail.length>0&&(R="FALSE"!=(G=x.Detail[0]).Trial),U=1;U<x.Detail.length;U++)if("FALSE"==(G=x.Detail[U]).Trial&&R||"TRUE"==G.Trial&&!R)return uje(C),yt;if(x.bTrial=R,T.Core||T.Webcam){var Re=[],Oe=!1;for(U=0;U<x.Detail.length;U++)if(G=x.Detail[U],X=Sc(this,JA,WB).call(this,G.EnumLicenseType,G.LicenseType),T.Core&&X.Core&&this.checkOSForAllowCore(S,G.OS,C)||T.Core&&X.Core&&Tt.bActiveXEdition&&X.ActiveX||T.Webcam&&X.Webcam&&!S){if(!(x.LTS||H.isString(G.Version)&&0==G.Version.indexOf(Fce))){Re.push(G);continue}if(Tt.bHTML5Edition){if(X.ActiveX&&!X.Html5||P&&!X.RemoteScan)continue;ae.push(G)}else{if(!X.ActiveX&&X.Html5)continue;ae.push(G)}Oe=!0}if(!Oe&&Re.length>0)return Re.splice(0),function(Be,$e){var ze=ea();St(Be,Zs.LicenseVersionNotCurrent,"The current product key is not for version ".concat($e,". ").concat(ze)),Ao(Be)}(C,[ld,NA].join(".")),!1;Re.splice(0)}else ae=x.Detail;for(U=0;U<ae.length;U++){var Ge=Nt;if(G=ae[U],X=Sc(this,JA,WB).call(this,G.EnumLicenseType,G.LicenseType),T.Core&&X.Core||this.isAllowLicenseType(X,T)){O=G.ExpireDate.replace(/-/g,"/");var Se="FALSE"!=G.Trial;if(this.isExpiredOrFuture(O,Se))oe.push(O);else if(Se&&X.Core&&this.willTrialExpire(O)&&(x.ExpireDate=O),x.LTS||X.Core&&Tt.bHTML5Edition&&parseInt(G.Version)>=Hje||X.Core&&Tt.bActiveXEdition||!X.Core){var de=!1;if(X.Core)(this.checkOSForAllowCore(S,G.OS,C)||Tt.bActiveXEdition&&X.ActiveX)&&(de=!0);else{var ge=S;T.Camera&&(ge=!0),Sc(this,Nce,Yje).call(this,ge,G.OS,C)&&(de=!0)}de?this.isBrowserOK(G.Browser)||D?(z++,Ge=yt):ye=Nt:T.Core?ue=Nt:T.PDFRasterizer?Ue=Nt:(T.Webcam||T.Camera)&&(He=Nt)}else Ie=Nt;Ge&&K++}}if(z>0)return Nt;if(0==K)return this.setNoAllowedLicenseTypeError(C,S,T),yt;if(oe.length>0){var _e,ve=0,Te=1e20,We="",Ye=(new Date).getTime();for(O="",U=0;U<oe.length;U++)(_e=sC(oe[U])).getTime()<Ye&&_e.getTime()>ve?(ve=_e.getTime(),O=oe[U]):_e.getTime()>Ye&&_e.getTime()<Te&&(Te=_e.getTime(),We=oe[U]);return""!=O?(_e=sC(O),Ole(C,O=this.getLicenseDateString(_e))):""!=We?(_e=sC(We),We=this.getLicenseDateString(_e),function(Be,$e){St(Be,Zs.LicenseIsFuture,"The current product key is invalid. "+ea()),Ao(Be)}(C)):Ole(C,""),yt}return Ie?(function(Be){St(Be,-2348,"The current product key is invalid because it's generated with the licenses of a different major version."),Ao(Be)}(C),yt):ye?(he.bEdge?function(Be){St(Be,-2330,"The current product key does not support Edge. "+ea()),Ao(Be)}(C):he.bChrome?function(Be){St(Be,-2327,"The current product key does not support Chrome. "+ea()),Ao(Be)}(C):he.bFirefox?function(Be){St(Be,-2328,"The current product key does not support Firefox. "+ea()),Ao(Be)}(C):he.bIE?function(Be){St(Be,-2329,"The current product key does not support IE. "+ea()),Ao(Be)}(C):he.bSafari?function(Be){St(Be,-2392,"The current product key does not support Safari. "+ea()),Ao(Be)}(C):function(Be){St(Be,-2343,"The current product key does not support your browser. "+ea()),Ao(Be)}(C),yt):ue?(this.setNoAllowedLicenseTypeError(C,S,{Core:!0}),yt):Ue?(this.setNoAllowedLicenseTypeError(C,S,{PDFRasterizer:!0}),yt):He?(this.setNoAllowedLicenseTypeError(C,S,{Webcam:!0}),yt):(pu(C),yt)}function $je(C){var x=yt,S=yt,T=yt,D=yt,R=yt,P=yt,O=yt,U=yt,G=yt;return H.isString(C)&&""!=C&&H.each(C.split(";"),function(X){var z=1*X;2==z||3==z||0==z||1==z?x=Nt:4==z?S=Nt:50==z?T=Nt:51==z?D=Nt:52==z?R=Nt:7==z?P=Nt:8==z?O=Nt:9==z?U=Nt:10==z&&(G=Nt)}),{Core:x,PDFRasterizer:U,Webcam:O,barcode1D:S,QR:T,PDF417:D,DataMatrix:R,OCR:P,OCRPro:G}}function WB(C,x){var S=Sc(this,Wce,$je).call(this,C),T=Sc(this,Uce,qje).call(this,x);return H.each(["Core","Html5","RemoteScan","LocalScan","ActiveX","PDFRasterizer","Webcam","barcode1D","QR","PDF417","DataMatrix","OCR","OCRPro"],function(D){S[D]=S[D]||T[D]}),S}function qje(C){var x=yt,S=yt,T=yt,D=yt,R=yt,P=yt,O=yt,U=yt,G=yt,X=yt,z=yt,K=yt,oe=yt;return C&&""!=C&&((C=C.toLowerCase()).indexOf("html5")>-1||"win=(aph) or mac=(ph) or linux(h)"==C?(x=Nt,C.indexOf("html5;activex;oldie")>-1?D=Nt:C.indexOf("html5;activex")>-1?(S=Nt,oe=Nt,D=Nt):(S=Nt,oe=Nt),C.indexOf(";remotescan")>-1&&(S=Nt,K=Nt,C.indexOf(";onlyremote")>-1&&(oe=yt))):"1d barcode reader"==C?T=Nt:"2d barcode reader(qrcode)"==C?R=Nt:"2d barcode reader(pdf417)"==C?P=Nt:"2d barcode reader(data matrix)"==C?O=Nt:"ocr"==C?U=Nt:"webcam"==C?G=Nt:"pdf rasterizer"==C?X=Nt:"proocr"==C&&(z=Nt)),{Core:x,Html5:S,RemoteScan:K,LocalScan:oe,ActiveX:D,PDFRasterizer:X,Webcam:G,barcode1D:T,QR:R,PDF417:P,DataMatrix:O,OCR:U,OCRPro:z}}function Hce(C){var x=C.toLowerCase();return x.indexOf("wasm")>-1||x.indexOf("mobile")>-1}var mn=new Gje;function Gce(C,x){return zce.apply(this,arguments)}function zce(){return(zce=_t(B.mark(function C(x,S){var T;return B.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Qa()){D.next=2;break}return D.abrupt("return");case 2:if(D.prev=2,be.DWT.li({instanceMode:be.DWT.EnumInstance.dwt_desktop},"")){D.next=17;break}return S&&lo(Vje),D.prev=6,D.next=9,Mje();case 9:return T=D.sent,D.next=12,Kje(T);case 12:D.next=17;break;case 14:D.prev=14,D.t0=D.catch(6),H.log(D.t0);case 17:D.next=22;break;case 19:D.prev=19,D.t1=D.catch(2),H.log(D.t1);case 22:case"end":return D.stop()}},C,null,[[2,19],[6,14]])}))).apply(this,arguments)}function Kje(C){return Yce.apply(this,arguments)}function Yce(){return(Yce=_t(B.mark(function C(x){var S;return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!x){T.next=7;break}if(!(H.isArray(x.result)&&x.result.length>3)){T.next=5;break}S=x.result[3],T.next=7;break;case 5:if(!x.description){T.next=7;break}return T.abrupt("return",{code:x.exception,message:x.description});case 7:H.isString(S)&&""!=S&&(be.DWT.lsmid(S,""),be.DWT.lsmid2b(S));case 8:case"end":return T.stop()}},C)}))).apply(this,arguments)}function sC(C){var x,S=C;return S=S.replace(/-/g,"/"),x=Date.parse(S),isNaN(x)&&(x=0),(x=new Date(x)).setHours(23,59,59,999),x}function Xce(C){if(""==C)return 65536;var x=sC(C),S=(new Date).getTime(),T=(x.getTime()-S)/864e5;return x.getTime()<S?0:Math.ceil(T)}be.DWT.isPublicLicense=function(){return Tt.bPublicLTS};var Sl,$ce=v(function C(){n(this,C),An(this,"_exec",{})},[{key:"fire",value:function(C,x){var S,T=this;C=C.toLowerCase(),S=Array.prototype.slice.call(arguments,1),H.each(T._exec[C]||[],function(D){var R=D.f,P=D.c||T;try{R.apply(P,S)}catch(O){H.error(O)}})}},{key:"on",value:function(C,x,S){C=C.toLowerCase(),this._exec[C]=this._exec[C]||[],this._exec[C].push({f:x,c:S})}},{key:"off",value:function(C,x,S){if(C&&x){C=C.toLowerCase();for(var T=this._exec[C]||[],D=T.length-1;D>=0;D--)T[D]===x&&T.splice(D,1)}else this._exec={}}}]);function Dm(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function Sf(C,x,S){return x.has(C),S}var ud,QA="[bio]: ",qce=window,ZA=qce&&qce.FormData,Kce=new WeakSet,Jce=new WeakSet,UB=new WeakSet,VB=new WeakSet,jB=new WeakSet,Jje=new WeakSet,Qje=new WeakSet,HB=new WeakSet,Xp=function(C){function x(S){var T,D,R;return n(this,x),D=this,R=qn(R=x),Dm(T=Za(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(O){return!1}}()?Reflect.construct(R,[],qn(D).constructor):R.apply(D,undefined)),HB),Dm(T,Qje),Dm(T,Jje),Dm(T,jB),Dm(T,VB),Dm(T,UB),Dm(T,Jce),Dm(T,Kce),An(T,"_attrs",{}),H.mix(T._attrs,{action:"",data:{},bChunkedSendData:Nt,ajaxConfig:{value:{},type:"post",processData:yt,cache:yt,dataType:"text",async:Nt,contentType:yt,retry:0,headers:{"X-Requested-With":yt}},ajax:"",formData:"",CORS:yt,bOnlyResponseEmptyIsOK:Nt}),H.mix(T._attrs,S),Sf(T,Kce,Zje).call(T),T}return el(x,C),v(x,[{key:"get",value:function(S){return S in this._attrs?this._attrs[S]:""}},{key:"set",value:function(S,T){S in this._attrs&&(this._attrs[S]=T)}},{key:"uploadFilesToServer",value:function(S){return Sf(this,Jce,eHe).call(this,S)}},{key:"uploadToServer",value:function(S){var T=this,D=T.get("ajaxConfig");Sf(T,UB,Qce).call(T),S&&S.size>0&&(Sf(T,VB,Zce).call(T,S),T.name=H.isString(S.name)&&""!=S.name?S.name:S.fileName,S=null),H.mix(D,{data:T.get(x.PROP.formData),url:T.get(x.PROP.action),beforeSend:function(O,U,G){O.upload.addEventListener("progress",function(X){T.fire(x.event.PROGRESS,{loaded:X.loaded,total:X.total,name:T.name})},!1)}});var R=T.get("async");if(H.mix(D,{method:"POST",async:R,onSuccess:function(O){eP(T.get(x.PROP.data)),eP(T.get(x.PROP.formData));var U=T.get(x.PROP.ajax);H.isFunction(U.dispose)&&U.dispose(),T.set(x.PROP.data,null),T.set(x.PROP.formData,null),T.set(x.PROP.ajax,null);var G=Sf(T,HB,tue).call(T,O);T.fire(x.event.SUCCESS,G)},onError:function(O,U,G){eP(T.get(x.PROP.data)),eP(T.get(x.PROP.formData));var X,z,K=T.get(x.PROP.ajax);H.isFunction(K.dispose)&&K.dispose(),T.set(x.PROP.data,null),T.set(x.PROP.formData,null),T.set(x.PROP.ajax,null),O&&H.isArray(O)&&O.length>2?(X=O[1],z=O[2]):(X=U,z=G),Sf(T,jB,eue).call(T,z,X)}}),R){var P=du(D);return T.set(x.PROP.ajax,P),!0}return du(D)}},{key:"abort",value:function(){var S=this,T=S.get("ajax");return H.isObject(T)?(T.abort(),S.set("ajax",!1),S):(H.log(QA+"abort(), the value of io invalid!"),S)}},{key:"setRequestHeader",value:function(S,T){var D=this.get("ajaxConfig");return D.headers[S]=T,this.set("ajaxConfig",D),D=null,T}}])}($ce);function Zje(){this.get("CORS");var C=this.get("ajaxConfig");return H.mix(C,{xhrFields:{withCredentials:!1}}),C}function eHe(C){var x=this,S=x.get(Sl.PROP.ajaxConfig),T=[];if(Sf(x,UB,Qce).call(x),H.each(C,function(P){P&&P.size>0?(Sf(x,VB,Zce).call(x,P),H.isString(P.name)&&""!=P.name?T.push(P.name):T.push(P.fileName)):T.push("")}),H.mix(S,{data:x.get(Sl.PROP.formData),url:x.get(Sl.PROP.action),beforeSend:function(P,O,U){P.upload.addEventListener("progress",function(G){x.fire(Sl.event.PROGRESS,{loaded:G.loaded,total:G.total,name:""})},!1)}}),H.mix(S,{method:"POST",async:x.get("async"),onSuccess:function(P){var O="";T=[],P&&(P&&H.isArray(P)&&P.length>1?O=P[0]:H.isString(P)&&(O=P)),O=Sf(x,HB,tue).call(x,O),x.fire(Sl.event.SUCCESS,O)},onError:function(P,O,U){var G,X;T=[],P&&H.isArray(P)&&P.length>2?(G=P[1],X=P[2]):(G=O,X=U),Sf(x,jB,eue).call(x,X,G)}}),x.name="",x.get("async")){var D=du(S);return x.set(Sl.PROP.formData,null),x.set(Sl.PROP.ajax,D),!0}var R=du(S);return x.set(Sl.PROP.formData,null),R}function Qce(){var C,x=this,S=x.get("data");if(ZA)if(S instanceof ZA)x.set(Sl.PROP.formData,S);else{C=new ZA;try{H.each(S,function(T,D){C.append(D,T)}),x.set(Sl.PROP.formData,C)}catch(T){H.log(QA+"something error when reset FormData.")}}else H.log(QA+"the browser does not support ajax.")}function Zce(C){if(!H.isObject(C))return H.log(QA+"_addFileData(), file parameter invalid!"),!1;var x=this.get(Sl.PROP.formData),T=C.remoteFilename;return T||(T="RemoteFile"),x.append(T,C,C.name),this.set(Sl.PROP.formData,x),C=null,x}function eue(C,x){var S=Sl.status.ERROR,T={status:S,msg:x,response:!1,name:this.name};C&&(T.httpStatus=C.status,T.response=C.responseText),this.fire(S,T)}function tue(C){var x,S,T,D=!1,R=this.name,P=Sl.status.SUCCESS,O=Sl.event.ERROR;if(H.log("Response from server: "+C),!this.get("bOnlyResponseEmptyIsOK"))return{status:P,msg:!1,json:!1,response:C,name:R};if(H.isUndefined(C)||""===C)x={status:P,msg:!1,json:!1,response:"",name:R};else if(H.isString(C)){try{for(S=0;S<C.length&&!(S>10);S++){if("{"==(T=C[S])){D=!0;break}if(" "!=T&&"\r"!=T&&"\n"!=T&&"\t"!=T)break}if(D){var U=H.parse(C);x=1==U.status?{status:P,msg:!1,json:U,response:C,name:R}:{status:O,msg:!1,json:U,response:C,name:R}}}catch(X){D=!1,H.log(X)}if(!D){var G=String(C);x=""==(G=G.replace(/( |\t|\r|\n)/g,""))?{status:P,msg:!1,json:!1,response:C,name:R}:{status:O,msg:!1,json:!1,response:C,name:R}}}else x={status:P,msg:!1,json:!1,response:"",name:R};return x}function eP(C){C&&C instanceof ZA&&C.forEach&&C.forEach(function(x,S){S&&C.delete(S)})}function tP(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function NS(C,x,S){return x.has(C),S}Sl=Xp,An(Xp,"event",{SUCCESS:"success",ERROR:"error",PROGRESS:"progress"}),An(Xp,"status",{SUCCESS:"success",ERROR:"error"}),An(Xp,"PROP",{action:"action",data:"data",bChunkedSendData:"bChunkedSendData",ajaxConfig:"ajaxConfig",ajax:"ajax",formData:"formData",CORS:"CORS",bOnlyResponseEmptyIsOK:"bOnlyResponseEmptyIsOK"});var nue=new WeakSet,iue=new WeakSet,rue=new WeakSet,GB=new WeakSet,Am=function(C){function x(S){var T,D,R;return n(this,x),D=this,R=qn(R=x),tP(T=Za(D,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(O){return!1}}()?Reflect.construct(R,[],qn(D).constructor):R.apply(D,undefined)),GB),tP(T,rue),tP(T,iue),tP(T,nue),T._attrs={action:"",retry:0,timeout:0,CORS:yt,async:Nt,dataType:"text",fileStatus:"",data:{},bOnlyResponseEmptyIsOK:Nt},H.mix(T._attrs,S),NS(T,iue,nHe).call(T),T}return el(x,C),v(x,[{key:"get",value:function(S){return S in this._attrs?this._attrs[S]:""}},{key:"set",value:function(S,T){S in this._attrs&&(this._attrs[S]=T)}},{key:"upload",value:function(S){var T;if(S){if(H.isArray(S))return T=this._uploadType.uploadFilesToServer(S),S=null,T;if(H.isObject(S)){var D=S;return D.size?(D.id||(D.id=H.guid("file-")),D.size&&(D.textSize=NS(this,nue,tHe).call(this,D.size))):D.size=0,T=this._uploadType.uploadToServer(D),D=null,S=null,T}}return T=this._uploadType.uploadToServer(S),S=null,T}},{key:"abort",value:function(S){return this._uploadType&&this._uploadType.abort(),!0}},{key:"setRequestHeader",value:function(S,T){this._uploadType.setRequestHeader(S,T)}}])}($ce);function tHe(C){var x=-1;do{C/=1024,x++}while(C>99&&x<4);return Math.max(C,.1).toFixed(1)+["KB","MB","GB","TB"][x]}function nHe(){var C=this,x={async:C.get(ud.PROP.async),action:C.get(ud.PROP.action),data:C.get(ud.PROP.data),CORS:C.get(ud.PROP.CORS),bOnlyResponseEmptyIsOK:C.get(ud.PROP.bOnlyResponseEmptyIsOK)};this._uploadType=new Xp(x);var S=this._uploadType.get(Xp.PROP.ajaxConfig);return S&&(S.dataType=C.get(ud.PROP.dataType),S.async=C.get(ud.PROP.async),S.retry=C.get(ud.PROP.retry)),this._uploadType.on(Xp.event.SUCCESS,NS(C,GB,oue),C),this._uploadType.on(Xp.event.ERROR,NS(C,GB,oue),C),this._uploadType.on(Xp.event.PROGRESS,NS(C,rue,iHe),C),this._uploadType}function iHe(C){this.fire(ud.event.PROGRESS,C)}function oue(C){var x=this,S=C.status,T=C.msg,D=x.get("file");H.mix(C,{file:D}),"success"===S?x.fire(ud.event.SUCCESS,C):(!1===T||("abort"===T?H.mix(C,{canceled:!0}):"timeout"===T&&H.mix(C,{timeout:!0})),x.fire(ud.event.ERROR,C))}ud=Am,An(Am,"event",{SUCCESS:"success",ERROR:"error",PROGRESS:"progress"}),An(Am,"PROP",{action:"action",retry:"retry",timeout:"timeout",CORS:"CORS",async:"async",dataType:"dataType",fileStatus:"fileStatus",data:"data",bOnlyResponseEmptyIsOK:"bOnlyResponseEmptyIsOK"});var Br={Loading:"Processing...",LoadingTiff:"Processing tiff...",LoadingPdf:"Processing pdf...",Encoding:"Processing...",ConvertingToBlob:"Converting to blob...",ConvertingToBase64:"Converting to base64...",SavingPdf:"Saving pdf...",SavingTiff:"Saving tiff...",Downloading:"Downloading...",Uploading:"Uploading...",Transfer:"Transferring...",CanvasLoading:"Loading ...",Err_ServiceModeNotSupportMobile:"Service Mode does not support your Operating System. Please contact the site administrator."};function zB(C,x){me.detect.bMaskShow=!0,be.DWT.ScanDirectly||H.isFunction(be.DWT.OnWebTwainPreExecute)&&be.DWT.OnWebTwainPreExecute(C,x)}function YB(){me.detect.bMaskShow=!1,be.DWT.ScanDirectly||H.isFunction(be.DWT.OnWebTwainPostExecute)&&be.DWT.OnWebTwainPostExecute()}var sue=he.bWin,rHe=he.bMac,oHe=he.bLinux,sHe=he.bSafari,aHe=he.bFirefox,lHe=he.bChrome,cHe=location.hostname,fh=location.pathname,XB=0,nP=he.bMobile,aue=parseFloat(he.strBrowserVersion);if(he.bWin||he.bMac||he.bLinux||he.bChromeOS){if(be.navInfo){var iP=be.navInfo;nP=nP||iP.bAndroid||iP.bPad||iP.biPhone||iP.biPad}}else nP=!0;""===cHe?sue&&fh.lastIndexOf("\\")>1?fh=fh.substring(1,fh.lastIndexOf("\\")).replace(/%20/g," "):(XB=1,fh=fh.substring(1,fh.lastIndexOf("/")).replace(/%20/g," ")):(XB=1,fh=fh.substring(0,fh.lastIndexOf("/")));var Po={bChrome:lHe,bFirefox:aHe,bSafari:sHe,bIE:he.bIE,bEdge:he.bEdge,bWin:sue,bMac:rHe,bLinux:oHe,iPluginLength:0,bFileSystem:he.bFileSystem,bMobile:nP,strIEVersion:he.IEVersion,strChromeVersion:he.bChrome?aue:"",strFirefoxVersion:he.bFirefox?aue:"",basePath:fh,pathType:XB,isDesktopViewer:function(){return he.bWin||he.bLinux||he.bChromeOS||he.bMac},isPadViewer:function(){return he.bPad||he.biPad},isMobileViewer:function(){return he.bMobile||he.biPhone||he.bAndroid||he.bHarmonyOS},WSVersion:"18.5.0",WSSession:(new Date).getTime(),bDiscardBlankImage:yt},cr={getImageUrl:function(C,x,S,T,D){var R,P=[C];if(H.isNumber(x)&&x<0)return"";if(null!=x&&(P.push("&index="),P.push(x)),P.push("&width="),P.push(S),P.push("&height="),P.push(T),Po.bMobile&&P.push("&type=1&quality=85"),P.push("&ticks="),P.push(D||Date.now()),R=P.join(""),he.bFileSystem&&R.indexOf("dwt://")<0){var O=new Image;O.crossOrigin="anonymous",O.src=R,O=null}return R},getUrlByAct:function(C,x,S){var T=[C];return null!=x&&(T.push("&index="),T.push(x)),S&&(T.push("&act="),T.push(S)),T.push("&ticks="),T.push(Date.now()),T.join("")},output:function(C,x){H.debug&&H.log(x)},print:function(C){var S=850,T=1120,D=0,R=0,P=0,O="";for(Tt.bHTML5Edition&&(he.bIE&&(T=1160),he.bFirefox&&(T=1150),be.navInfoSync.bMac&&be.navInfoSync.bSafari&&(T=900)),D=0;D<C.length;D++){var U=T,G=C[D],X=G.Width,z=G.Height,K=G.Url;X<=0&&(X=S),z<=0&&(z=U);var oe=S/X,ae=U/z;oe<ae?U=Math.floor(z*oe):oe>ae&&(S=Math.floor(X*ae)),R+=X,P+=z,O=O+'<div style="width:'+S+"px;height:"+U+'px"><img id="D_img'+D+'" src="'+K+'" style="position:relative;left:0px;top:0px;width: '+S+"px;height: "+U+'px" referrerpolicy="strict-origin-when-cross-origin" /></div>'}var ue,ye=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",R,",height=",P].join(""),Ie=window.open("about:blank","_blank",ye);Ie&&(Ie.document.write('<html><body id="D_body">'+O+"</body></html>"),Ie.document.close(),Ie.focus(),(ue=Ie.document.getElementById("D_body"))?ue.onload=function(){Ie&&Ie.print(),H.log("print image...ok")}:H.log("cannot find image"))}};me.html5.Funs2=cr;var tn,uHe=H.isString,dHe=H.isArray,hHe=H.each;function BS(C,x){if(uHe(x))C.push('"'),C.push(x),C.push('"');else if(dHe(x)){var S=Nt;C.push("["),hHe(x,function(T){S?S=yt:C.push(","),BS(C,T)}),C.push("]")}else C.push(void 0===x?'""':x)}function Et(){for(var C=[],x=arguments.length,S=new Array(x),T=0;T<x;T++)S[T]=arguments[T];if(S.length>0)if(1===S.length){var D=S[0];C.push("["),BS(C,D),C.push("]")}else if(2===S.length){var R=S[0],P=S[1];C.push("["),BS(C,R),C.push(","),BS(C,P),C.push("]")}else BS(C,Array.prototype.slice.call(S));return C.join("")}function $p(C){return C instanceof ArrayBuffer||C instanceof Uint8Array||C instanceof Uint16Array||C instanceof Uint32Array||C instanceof Int8Array||C instanceof Int16Array||C instanceof Int32Array||window.Uint8ClampedArray&&C instanceof window.Uint8ClampedArray||C instanceof Float32Array||C instanceof Float64Array}!function(C){C.TWAINSCANNER=16,C.WIASCANNER=32,C.TWAINX64SCANNER=64,C.ICASCANNER=128,C.SANESCANNER=256,C.ESCLSCANNER=512,C.WIFIDIRECTSCANNER=1024,C.WIATWAINSCANNER=2048}(tn||(tn={}));var fHe=tn.TWAINSCANNER|tn.WIASCANNER|tn.TWAINX64SCANNER|tn.ICASCANNER|tn.SANESCANNER|tn.ESCLSCANNER|tn.WIFIDIRECTSCANNER|tn.WIATWAINSCANNER,WS=tn.TWAINSCANNER|tn.WIASCANNER|tn.TWAINX64SCANNER|tn.ICASCANNER|tn.SANESCANNER,pHe=tn.TWAINSCANNER|tn.WIATWAINSCANNER|tn.TWAINX64SCANNER|tn.ICASCANNER|tn.SANESCANNER,$B=tn.ESCLSCANNER|tn.WIFIDIRECTSCANNER,aC=tn.TWAINSCANNER|tn.WIATWAINSCANNER,gHe=1;function US(){return(++gHe).toString()}function lue(){return["dwt_",H.getRandom()].join("")}var Tf=0;function Wo(C,x,S){if(H.log("showMask:"+C+"--"+Tf),0==Tf)if(x){zB(x);var T=me.mask.dlgMask;if(T){T.style.zIndex="10000";var D=H.sizzle(".dynamsoft-backdrop",T.parentNode);D&&D.length>0&&(D[0].style.zIndex="10000")}}else zB(S||{});Tf++}function Xr(C){H.log("hideMask:"+C+"--"+Tf),Tf>1?Tf--:Tf<=1&&(YB(),Tf=0)}var cue=v(function C(x,S){n(this,C),An(this,"m_server",""),An(this,"m_iUsingTime",0),An(this,"m_countMap",{}),An(this,"m_newConsum",!1),An(this,"m_mapSavedToDb",!1),this.clearData(),this.m_enumInstance=x,x==be.DWT.EnumInstance.dwt_desktop?(this.m_deploymentType="desktop",this.m_server=S):x==be.DWT.EnumInstance.dbr&&(this.m_deploymentType="browser",this.m_server="")},[{key:"clearData",value:function(){this.m_iUsingTime=0,this.m_jvUsingTime=H.nil,this.m_countMap={},this.m_newConsum=!1,this.m_mapSavedToDb=!1,this.m_minExpiredTime=H.nil,this.m_maxExpiredTime=H.nil,this.m_cu=H.nil,this.m_ar=H.nil,this.m_ltsInstance=H.nil}},{key:"set_cu",value:function(C){this.m_cu=C}},{key:"get_cu",value:function(){return this.m_cu}},{key:"set_ar",value:function(C){this.m_ar=C}},{key:"get_ar",value:function(){return this.m_ar}},{key:"get_ltsInstance",value:function(C){return this.m_ltsInstance||(this.m_ltsInstance=C(this.m_enumInstance)),this.m_ltsInstance}},{key:"inited_ltsInstance",value:function(){return!!this.m_ltsInstance}},{key:"set_maxExpiredTime",value:function(C){this.m_maxExpiredTime=C}},{key:"get_maxExpiredTime",value:function(){return this.m_maxExpiredTime}},{key:"set_minExpiredTime",value:function(C){this.m_minExpiredTime=C}},{key:"get_minExpiredTime",value:function(){return this.m_minExpiredTime}},{key:"get_deploymentType",value:function(){return this.m_deploymentType}},{key:"get_enumDeploymentType",value:function(){return this.m_enumInstance}}]),Rt=be.DWT;Rt.LTS=Rt.LTS||{},Rt.licenseException={code:0,message:"",fromLTS:!1},Rt.bLTSOnline=!0,Rt.axInstance=void 0,Rt.lOnUpdateDWObj=[],Rt.EnumInstance={dwt_desktop:0,dwt_browser:1,dbr:2};var qp,Tl=0,ph={},VS=!1,lC=!1,jS=!1,qB=!1,HS=!1;function uue(){var C=Tt.handshakeCode;return H.isString(C)||(C=""),C}function due(){var C=Tt.organizationID;return H.isNumber(C)?C=""+C:H.isString(C)||(C=""),C}function KB(){return H.replaceAll(fu.JSVersion,",",".")}function xs(C,x){var S=C;return S===H.nil&&(S=Rt.EnumInstance.dwt_desktop),S==Rt.EnumInstance.dbr?(Rt._dbrLicense||(Rt._dbrLicense=new cue(S,"")),Rt._dbrLicense):(Rt._dwtDLicense||(Rt._dwtDLicense=new cue(S,"")),Rt._dwtDLicense)}Rt.lupverfy=function(){xs(Rt.EnumInstance.dwt_desktop).get_ltsInstance(If),xs(Rt.EnumInstance.dbr).get_ltsInstance(If)},Rt.lsmid=function(C,x){xs(Rt.EnumInstance.dwt_desktop).set_cu(C)},Rt.lsar=function(C,x){xs(Rt.EnumInstance.dwt_desktop).set_ar(C)},Rt.lsmid2b=function(C){xs(Rt.EnumInstance.dwt_desktop).set_cu(C)},Rt.lgar=function(C,x){xs(C).get_ar()},Rt.laddDWTObj=function(C){var x=!1;H.each(Rt.lOnUpdateDWObj,function(S){if(S==C)return x=!0,!1}),x||Rt.lOnUpdateDWObj.push(C)},Rt.lremoveDWTObj=function(C){H.each(Rt.lOnUpdateDWObj,function(x,S){if(x==C)return Rt.lOnUpdateDWObj.splice(S,1),!1})},Rt.lsendUpdateEvt=function(C,x){var S=[];if(H.each(Rt.lOnUpdateDWObj,function(R){C==Rt.EnumInstance.dwt_desktop&&S.push(R)}),0==S.length)return me.Promise.resolve();var T,D=S[0];return D._bAx?(H.each(S,function(R){R.SetLTSInfo(xs(C).get_ar(),xs(C).get_cu())}),D.GetLicenseInfo().then(function(R){R&&H.isArray(R.Detail)&&R.Detail.length>0&&Rt.lsexp(C,R.Detail[0].ExpireDate,x)})):(T=D.SetLTSLicenseAsync(xs(C).get_ar()).then(function(R){R&&H.isArray(R.Detail)&&R.Detail.length>0&&Rt.lsexp(C,R.Detail[0].ExpireDate,x)}),H.each(S,function(R,P){0!=P&&R.SetLTSLicenseAsync(xs(C).get_ar())}),T)},Rt.lgcb=function(){var C=[];return he.bChrome?C.push("Chrome"):he.bFirefox?C.push("Firefox"):he.bEdge?C.push("Edge"):he.bIE?C.push("IE"):he.bSafari?C.push("Safari"):he.bOpera?C.push("Opera"):he.b360SE?C.push("360SE"):he.bTencentTraveler?C.push("TencentTraveler"):he.bMaxthon?C.push("Maxthon"):he.bMetaSr?C.push("MetaSr"):he.bTheWorld?C.push("TheWorld"):he.bUC?C.push("UC"):he.bHuaWeiBrowser&&C.push("HuaWeiBrowser"),C.push(he.strBrowserVersion),he.bWin?C.push("Windows"):he.bMac?C.push("Mac"):he.bLinux?C.push("Linux"):he.bAndroid?C.push("Android"):he.bChromeOS?C.push("ChromeOS"):he.bHarmonyOS?C.push("HarmonyOS"):Po.bMobile?C.push("Mobile OS"):be.navInfo.bEmbed&&C.push("Embed OS"),C.join(" ")};function If(C){var x,S,T=Tt.licenseServer;if(T&&T.length>0)for(x=0;x<T.length;x++)H.endsWith(S=T[x],"/")||(T[x]=S+"/");var D={dm:location.origin?H.startsWith(location.origin,"http")?location.origin:"https://localhost":H.startsWith(location.href,"http")?location.href:"https://localhost",lf:me.localforage,btoa:H.btoa,atob:H.atob,sutlcb:function(){H.isFunction(Rt.lonsend)&&Rt.lonsend()},fol:Rt.OnFirstOffline,dwt:!0};if(D.feab=C==Rt.EnumInstance.dwt_browser||C==Rt.EnumInstance.dbr?Rt.lfeab_wasm:Rt.lfeab_ax,!he.bIE&&Tt.ltsDebug&&(D.debugLog=console.log),be.LTS&&be.LTS._)return be.LTS._.createLtsInstance(D);var R={},P=function(){return me.Promise.reject({code:-2446,message:"The dynamsoft.lts.js load failed."})};return R.i=P,R.s=P,R.u=P,R.caret=P,R}function rP(C,x){var S=null!=x?x:"",T=xs(C),D=T.get_enumDeploymentType();if(Rt.lclex(),T.get_ar()&&T.get_cu())return me.Promise.resolve({ar:T.get_ar(),cu:T.get_cu()});var R={pd:Rt.lgpd(C),v:KB(),os:Rt.lgcb(),fn:Rt.DeviceFriendlyName||"",ls:Tt.licenseServer,sp:Tt.sessionPassword,l:mn.getLTSLicense(),mnet:function(){return T.get_maxExpiredTime()},mxet:function(){return T.get_minExpiredTime()},fol:Rt.OnFirstOffline};if(R.dt=T.get_deploymentType(),D==Rt.EnumInstance.dwt_desktop){var P;if(""==T.get_cu())return pu(P={}),me.Promise.reject({code:P._errorCode,message:P._errorString});R.lsu=T.get_cu()}else D==Rt.EnumInstance.dbr||(R.dwt=!0,""!=T.get_cu()&&(R.lsu=T.get_cu()),R.updateLicense=function(O){T.set_ar(O.ar),T.get_cu()||T.set_cu(O.cu),Rt.lsendUpdateEvt(D,S)});return T.get_ltsInstance(If).i(R).then(function(O){return T.get_ar()||T.set_ar(O.ar),T.get_cu()||T.set_cu(O.cu),O},function(O){throw T.clearData(),O})}function Pm(){return Date.now()}function P0(C){var x=C?new Date(C):new Date,S="yyyy-MM-ddTHH:mm:ss.SSSZ",T={"M+":x.getUTCMonth()+1,"d+":x.getUTCDate(),"H+":x.getUTCHours(),"h+":x.getUTCHours()%12||12,"m+":x.getUTCMinutes(),"s+":x.getUTCSeconds(),"q+":Math.floor((x.getUTCMonth()+3)/3),"S+":x.getUTCMilliseconds()};for(var D in/(y+)/.test(S)&&(S=S.replace(RegExp.$1,(x.getUTCFullYear()+"").substr(4-RegExp.$1.length))),T)new RegExp("("+D+")").test(S)&&(S=S.replace(RegExp.$1,1==RegExp.$1.length?T[D]:("000"+T[D]).substr(("000"+T[D]).length-RegExp.$1.length)));return S}function JB(C,x){var S;C.__licenseInfo=x,(S=C).__calic||(S.__calic=S.__licenseInfo)}function oP(C){var x=be.DWT.licenseException;x.code=C.code,x.message=C.message,C&&(hue(C),C instanceof Error?H.error(C):H.error(H.stringify(C)))}function hue(C){H.isFunction(be.DWT.OnWebTwainError)?be.DWT.OnWebTwainError(C):H.isFunction(window.Dynamsoft_OnError)&&window.Dynamsoft_OnError(C)}function sP(C){return C==Zs.LicenseExpiredForDLS||C==Zs.LicenseNoCoreForDLS||C==Zs.LicenseNoCore||C==Zs.LicenseInvalid||C==Zs.LicenseExpired||C==Zs.LicenseParseFailed||C==Zs.LicenseIsFuture||C==Zs.LicenseVersionNotCurrent}function fue(C){return C==Zs.LicenseExpired}function QB(C){var T,D,x=0,S=C.message;H.isNumber(C.code)?x=C.code:H.isString(S)&&(x=-1),0!=x&&(T=x,D=S,H.isFunction(be.OnLicenseError)&&be.OnLicenseError(D,T))}function pue(C){QB(Zi(C))}Rt.lgpd=function(C){return he.bWin&&C==Rt.EnumInstance.dwt_desktop?"dwt|dbr":"dwt"},Rt.lglic=rP,Rt.lgbuuid=function(){return""},Rt.lshow=function(){return{t:qp,t2:Tl,m:H.stringify(ph)}},Rt.lgct=function(C){switch(C){case 0:return"3011";case 1:return"3012";case 2:return"3014";case 3:return"3013";case 4:return"3015";case 14:return"3016";case 3001:return"3001";case 3002:return"3002";case 3003:return"3003";case 3004:return"3004";case 3005:return"3005";case 3006:return"3006";case 3007:return"3007";case 3008:return"3008";case 3009:return"3009";case 5001:return"5001";case 4001:return"4001";case 4002:return"4002";case 4003:return"4003"}return""},Rt.lcvrf=function(C){C&&(C._canConsume&&!C._canConsume()||setTimeout(function(){Rt.lcvrf_(C)},1))},Rt.lcvrf_=function(C){var x;x=Rt.EnumInstance.dwt_desktop;var S,T=Rt.DeviceFriendlyName||"",D=Rt.lgcb(),R=xs(x),P={hs:uue(),og:due(),cu:R.get_cu(),fn:T,cw:"",os:D,v:KB(),dt:R.get_deploymentType(),ed:"js"},O=function(z,K){var oe,ae,ue=0;if(H.isString(z)&&""!=z&&"{}"!=z&&K&&H.isArray(K)&&!(K.length<1)){if(ae=xs(K[0]),oe=H.parse(z),Rt.lclex(),0==Tl){var ye=Pm(),Ie="";Tl=ye,qp=P0(ye),ph={},ue=0,H.each(oe,function(Ue,He){(He<ue||0==ue)&&(ue=He,Ie=Ue)}),ue>0&&ae.get_ltsInstance(If).s(Tt.licenseServer,Ie,ue,!0).then(function(){},function(Ue){})}H.each(oe,function(Ue,He){var Re=!1,Oe=parseInt(He);Oe>0&&Oe!=ue&&(Oe+18e4<Pm()&&(Re=!0),ae.get_ltsInstance(If).s(Tt.licenseServer,Ue,He,Re).then(function(){},function(Ge){}))})}};if(P.pd=Rt.lgpd(x),S=H.stringify(P),!C._bAx){var U="GetBuffer",G=Et(H.replaceAll(S,'"','\\"')),X={cmd:U,cmdId:US(),sFun:O,fFun:function(){},params:[x]};return C._innerSendByWS(U,G,X,null,!0)}O(C.GetBuffer(S),[x,""])},Rt.lavrf=function(C,x,S,T){var D=1;if(""!=C){x>1&&(D=x);var R=Pm();if(Tl>0&&Tl+18e4<R){lC?(ph={},Rt.lavrf__unload()):Rt.lavrf__(!0,S,T);var P=Pm()+1;Tl=P,qp=P0(P),ph={}}VS=!0,lC=!1,ph[C]?ph[C]+=D:ph[C]=D,0==Tl&&Rt.lavrf__(!0,S,T)}},Rt.lavrf_=function(C,x,S){if(VS){var T=1;C&&(T=C),setTimeout(function(){Rt.lavrf__(!1,x,S)},T)}},Rt.lavrf__=function(C,x,S){var T,R,P=Pm(),O=!1,U=!!C,G=0,X=x;H.isUndefined(X)&&(X=Rt.EnumInstance.dwt_desktop),R=xs(X),VS=!1,0==Tl&&(O=!0,Tl=P,qp=P0(P)),T=Tl;var z={};z.ut=qp;var K={};if(H.each(ph,function(Ue,He){K[He]=Ue,Ue>0&&G++}),z.cts=K,U||T+18e4<P){U=!0;var oe=Pm()+1;if(Tl=oe,qp=P0(oe),ph={},lC=!1,0==G)return}else{if(0==G)return;lC=!0}z.dur=O?1:180;var ae,ue=Rt.DeviceFriendlyName||"",ye=Rt.lgcb(),Ie={hs:uue(),og:due(),cu:R.get_cu(),fn:ue,cw:"",os:ye,v:KB(),dt:R.get_deploymentType(),ed:"js",rcs:[z]};Ie.product=Rt.lgpd(x),ae=H.stringify(Ie),Tt.ltsDebug&&P0(),Rt.lclex(),R.get_ltsInstance(If).s(Tt.licenseServer,ae,""+T,U).then(function(){},function(Ue){})},Rt.lavrf__unload=_t(B.mark(function C(){var x,S,T,D,R,P,O;return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(x=Pm(),S=!0,D=!1,R=xs(Rt.EnumInstance.dwt_desktop),P=xs(Rt.EnumInstance.dbr),VS=!1,0==Tl&&(Tl=x,qp=P0(x)),T=Tl,O=Pm()+1,Tl=O,qp=P0(O),ph={},lC=!1,T+=1,Rt.lclex(),!R.inited_ltsInstance()){U.next=20;break}return U.prev=13,U.next=16,R.get_ltsInstance(If).s(Tt.licenseServer,D,""+T,S);case 16:U.next=20;break;case 18:U.prev=18,U.t0=U.catch(13);case 20:if(!P.inited_ltsInstance()){U.next=28;break}return U.prev=21,U.next=24,P.get_ltsInstance(If).s(Tt.licenseServer,D,""+T,S);case 24:U.next=28;break;case 26:U.prev=26,U.t1=U.catch(21);case 28:case"end":return U.stop()}},C,null,[[13,18],[21,26]])})),Rt.lclex=function(){var C=Rt.licenseException;C.code=0,C.message="",C.httpResponse="",C.fromLTS=!1},Rt.li=function(C,x){var S;return C.axInstance&&(Rt.axInstance=C.axInstance,Rt.axInstance)?(S=Rt.axInstance.GetUUID(),Tt.ltsDebug&&H.log("ActiveX cu: "+S),xs(C.instanceMode).set_cu(S),S):xs(C.instanceMode).get_cu()},Rt.lfeab_ax=function(C){return new me.Promise(function(x,S){var T="";if(Rt.axInstance)try{T=Rt.axInstance.Encrypt(C,0)}catch(D){}x(T)})},Rt.lfeab_wasm=function(C){return me.Promise.resolve("")},Rt.lwsproc=function(C,x){try{C=H.parse(C)}catch(S){return void(x.fFun&&x.fFun(S))}"GetBuffer"==C.method?x.sFun(x.sFun&&C.result.length>0?C.result[0]:"",x.params):x.sFun&&x.sFun(C)},Rt.lsexp=function(C,x,S){var T,D=x;if(3==(T=(D=H.replaceAll(D,"/","-")).split("-")).length){var R=T[0],P=T[1],O=T[2];P.length<2&&(P=(P="00"+P).substr(P.length-2)),O.length<2&&(O=(O="00"+O).substr(O.length-2)),D=[R,P,O].join("-")}var U=[D,"T23:59:59.999Z"].join("");xs(C).set_minExpiredTime(U),xs(C).set_maxExpiredTime(U)},Rt.lunload=_t(B.mark(function C(){return B.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,Rt.lavrf__unload();case 2:Tl=0,qp=H.nil,ph={},lC=!1,VS=!1,jS=!1,qB=!1,HS=!1,Rt.lclex(),Rt.bLTSOnline=!0,Rt.axInstance=H.nil,Rt.lOnUpdateDWObj=[];case 14:case"end":return x.stop()}},C)})),Rt.lcexp=function(C,x){return xs(C).get_ltsInstance(If).caret().then(function(){return!1},function(S){var T=Rt.licenseException,D="";return S instanceof Error||"message"in S?D=S.message:H.isString(S)&&(D=S),Rt.lsetException(-2445,D,!1),qB||(qB=!0,H.error(D),be.OnLTSLicenseError&&be.OnLTSLicenseError(mn.getPublicLicenseContent(T.message),T.code)),!0})},Rt.OnLicenseException=function(){var C=Rt.licenseException,x=C.message;if(H.isString(x)&&(x.indexOf("Error Code")>-1?x=H.replaceAll(x,"Error Code","error code"):x.indexOf("Error code")>-1&&(x=H.replaceAll(x,"Error code","error code"))),x.indexOf("(https://www.dynamsoft.com/purchase-center/)")>-1&&(x=x.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamic-web-twain/)"),C.message=x),x.indexOf("error code:")>-1){var S=x.substr(0,x.indexOf("message")),T=x.substr(x.indexOf("message"));S.indexOf("{")>-1&&(S=S.substr(S.indexOf("{")+1)),T.indexOf("}")>-1&&(T=T.substr(0,T.indexOf("}"))),S=H.replaceAll(S,"error code:",""),T=H.replaceAll(T,"message: ",""),Rt.lsetException(parseInt(S),T,!0),H.error(T),be.OnLTSLicenseError&&be.OnLTSLicenseError(mn.getPublicLicenseContent(x),C.code)}else{if(!C.code){var D=-2440;x.indexOf("timed out")>-1||x.indexOf("timeout")>-1?D=-2441:(x.indexOf("access-control-allow-origin")>-1||x.indexOf("cors")>-1)&&(D=-2443),Rt.lsetException(D,x,!0)}if(H.error(C.message),-2446==C.code)return;be.OnLTSLicenseError&&be.OnLTSLicenseError(mn.getPublicLicenseContent(C.message),C.code)}},Rt.lol=function(){return Rt.bLTSOnline},Rt.OnFirstOffline=function(C){Rt.bLTSOnline=!1},Rt.lpubdlg=function(C,x){if(H.isString(C)&&""!=C){if(C=H.atob(C),1==x)return jS||(jS=!0,be.OnLTSPublicLicenseWarning&&be.OnLTSPublicLicenseWarning(mn.getPublicLicenseContent(C))),!0;2==x&&(jS||(jS=!0))}return!1},Rt.lcheckLic=function(C,x,S){var T=!1;if(x){if(H.isArray(x.Detail)&&x.Detail.length>0)return Rt.lsexp(C,x.Detail[0].ExpireDate,S),Rt.lcexp(C,S).then(function(R){var P=!1;R?P=!0:1!=x.Trial&&2!=x.Trial||(P=Rt.lpubdlg(x.Message,x.Trial)),P||Rt.bLTSOnline||HS||(HS=!0,be.OnLTSConnectionWarning&&be.OnLTSConnectionWarning())});1!=x.Trial&&2!=x.Trial||(T=Rt.lpubdlg(x.Message,x.Trial))}return T||Rt.bLTSOnline||HS||(HS=!0,be.OnLTSConnectionWarning&&be.OnLTSConnectionWarning()),me.Promise.resolve()},Rt.lisValidID=function(C){if(H.isString(C)&&""!=C)return!0;var S=Rt.licenseException;return Rt.lsetException(-2447,"Failed to generate an ID for your device to license it: not enough permission.",!0),H.error(S.message),be.OnLTSLicenseError&&be.OnLTSLicenseError(S.message,S.code),!1},Rt.lsetException=function(C,x,S){var T=Rt.licenseException;T.code=C,T.message=x,H.isUndefined(S)||(T.fromLTS=S)},Rt.lgcuid=function(C){var x=be.DWT.li({instanceMode:C},"");return x?me.Promise.resolve(x):xs(C).get_ltsInstance(If).u().then(function(S){return be.DWT.lsmid(S,""),be.DWT.lsmid2b(S),S})};var dd,ZB=v(function C(){n(this,C)});function e9(C){var x=new ZB;return x.server=C.server,x.normal=!0,C.attrs&&(x.attrs=H.clone(C.attrs)),x}function t9(C,x,S){if(H.isString(C)&&(C.indexOf("Function not found")>0||C.indexOf("Version not found")>0))x&&x(C);else{var T=C.data;if("object"===p(T))return T=null,C=null,void(S&&S());var D=T.replace(/\0/g,"");try{x&&x(D)}catch(R){H.log(T),S&&S()}T=null,C=null}}function n9(C,x){C&&C.readyState!=dd.CLOSING&&C.readyState!=dd.CLOSED?C.readyState==dd.CONNECTING?(C.onerror=function(S){S&&H.log("websocket error: "+S),C._reject&&(C._reject(S),C._reject=null),C.close()},C.onclose=function(S){C.onclose=null,C.onerror=null,C.onmessage=null,C.onopen=null,C._reject=null},C.onopen=function(){C.readyState==dd.OPEN?(C.onopen=null,C.send(x)):C.readyState==dd.CONNECTING&&(C.onopen?setTimeout(C.onopen,100):C._reject&&(C._reject(),C._reject=null))}):C.readyState==dd.OPEN&&(C.onopen=null,C.send(x)):C._reject&&(C._reject({closed:!0}),C._reject=null)}function gue(C,x,S){var T,D=S;return D||(be.DWT.ConnectWithSocket?H.startsWith(C,"wss://")||H.startsWith(C,"ws://")||(D=he.bSSL?"wss://":"ws://"):H.startsWith(C,"https://")||H.startsWith(C,"http://")||(D=he.bSSL?"https://":"http://")),x?(H.endsWith(C,"/")&&(C=C.substring(0,C.length-1)),T=":"+x+"/"):H.endsWith(C,"/")||(T="/"),[D,C,T].join("")}!function(C){C.CONNECTING=0,C.OPEN=1,C.CLOSING=2,C.CLOSED=3}(dd||(dd={}));var nl,Kp=function(){function C(){n(this,C)}return v(C,null,[{key:"postStringDataByWS",value:function(x,S){return new me.Promise(function(T,D){x.onmessage=function(R){t9(R,function(P){T(P),x.close(),x=null},function(){D(),x.close(),x=null})},x._reject=D,n9(x,S)})}},{key:"postStringDataByWSUrl",value:function(x,S){var T=new me.Promise(function(D,R){var P=C.newWebsocket(x,!1);P.onmessage=function(O){t9(O,function(U){D(U),P.close(),P=null},function(U){R(U),P.close(),P=null})},P._reject=R,n9(P,S)});return he.bEdge&&T.catch(function(){return new me.Promise(function(D,R){var P=C.newWebsocket(x,!0);P.onmessage=function(O){t9(O,function(U){D(U),P.close(),P=null},function(U){R(U),P.close(),P=null})},P._reject=R,n9(P,S)})}),T}},{key:"newWebsocket",value:function(x,S){var T,D=$n.wsProtocol,R=window.MozWebSocket;if(void 0!==R)T=D?new R(x,D):new R(x);else{var P=window.WebSocket;if(S){var O=window,U=parent;try{for(;O!=U&&U.WebSocket;)P=U.WebSocket,O=U.window,U=U.parent}catch(G){P=window.WebSocket}}T=D?new P(x,D):new P(x)}return T}},{key:"getWsUrl",value:function(x,S,T){var D=T;return void 0===D&&(D=he.bSSL),gue(x,S,D?"wss://":"ws://")}},{key:"getDDMUrl",value:function(x,S,T){var D,R,P="/";return H.startsWith(x,"https://")?D=!0:H.startsWith(x,"http://")?D=!1:x=(D=me.detect.ssl)?"https://"+x:"http://"+x,R=D?"18626/":"18625/",H.endsWith(x,"/")&&(P=""),S?[x,P,"ddm/",R,T].join(""):[x,P,T].join("")}},{key:"getModuleUrl",value:function(x){var S;return S=gue(Ja(),he.bSSL?be.DWT.SSLPort:be.DWT.Port),x?S+x:S}}])}();be.DWT.NetManager=Kp,function(C){C.ST_UNKNOWN=0,C.ST_TWAIN_DIRECT=1,C.ST_DYNAMSOFT_SERVICE=2,C.ST_ESCL=3,C.ST_WIFI_DIRECT=4}(nl||(nl={}));var R0,Ti,k0,mHe=v(function C(x){n(this,C);var S=this;if(S._id=x.id,S._clientId=H.getRandom(),S._uuidForActiveUI=null,S._bReady=yt,S._destroy=yt,S._bMustUpgradeService=yt,S._wsClient=null,S._wsRetry=0,S._wsFailedTimes=0,S._bConnecting=yt,S._bNoMask=yt,S._bNotShowMessage=yt,S.__serverPlatform=Rn.enumWindow,S.__productKey="",S.__licenseInfo=null,S._reconnectTimeSpan=xo.RemoteReconnectTimeSpan,S._reconnectShortSpan=300,S._reconnectShortSpanTimes=5,S._bIfShowProgressBar=Nt,S.__IfShowCancelDialogWhenImageTransfer=Nt,S._bLicenseErrorDispose=!0,x.dmService){var T,D,R,P,O,U,G=e9(x.dmService),X="/",z="";D=G.server;var K=new V7(x.dmService.server),oe=K.scheme;oe&&(oe=oe.toLowerCase()),"https"==oe?(T=!0,R=D.substring(8)):"http"==oe?(T=!1,R=D.substring(7)):"wss"==oe?(T=!0,R=D,D=H.replaceAll(D,"wss://","")):"ws"==oe?(T=!1,R=D,D=H.replaceAll(D,"ws://","")):(R=D,D=(T=me.detect.ssl)?"https://"+D:"http://"+D),S._bRemoteMode=bc(K.hostname||K.scheme)?yt:Nt,H.endsWith(D,"/")&&(X="");var ae=G.attrs;if(ae){var ue,ye;P=(null===(ue=ae)||void 0===ue?void 0:ue.UUID)||"";var Ue,Ie=(null===(ye=ae.modules)||void 0===ye?void 0:ye.length)||0;""!=P&&Ie>0&&(T?Ie>1&&Ie>1+(Ue=ae.modules[1])+2&&(O=ae.modules[1+Ue+2]):Ie>2&&(O=ae.modules[2]),H.endsWith(O,"/")&&(X=""),z=[P,"/",O,"/"].join(""))}else ae={UUID:"",service_type:nl.ST_DYNAMSOFT_SERVICE};U=[D,X,z].join(""),ae.url=U,S._serverInfo=new E0([R,X,z].join(""),null,T,!0,$n.wsProtocol),S._httpUrl=U,S._dmService=G}else{var He,Re=me.detect.ssl,Oe=x.port,Ge=x.sslPort;S._bRemoteMode=!bc(He=x.host?x.host:Ja()),Oe||(Oe=be.DWT.Port),Ge||(Ge=be.DWT.SSLPort),S._serverInfo=new E0(He,Re?Ge:Oe,Re,!0,$n.wsProtocol),S._httpUrl=function(Se){var de=Se.server;if(de){if(H.startsWith(de,"wss://")||H.startsWith(de,"ws://"))return de}else de=Ja();return Se.ssl?["https://",de,":",Se.port,"/"].join(""):["http://",de,":",Se.port,"/"].join("")}(S._serverInfo),S._dmService={server:S._httpUrl,attrs:{url:S._httpUrl,UUID:"",service_type:nl.ST_DYNAMSOFT_SERVICE},normal:!0}}},[{key:"_resetErr",value:function(){this._errorCode=0,this._errorString="";var C=be.DWT.licenseException;C.code=0,C.message=""}},{key:"dispose",value:function(){this._bReady=yt,this._destroy=Nt}},{key:"isDestroy",get:function(){return this._destroy}}]),hd=v(function C(){n(this,C)});function mue(C,x){var S,T=[],D=x;if(H.isString(D)&&(D=H.parse(D)),H.isArray(D))for(S=0;S<D.length;S++){var R=_He(D[S]);T.push(R)}for(S=0;S<T.length;S++){var P=T[S],O=P.deviceType;P.name&&(P.name=H.base64.decode(P.name)),O&fHe&&P.deviceInfo&&yHe(P.deviceInfo),P.serviceInfo=null==C?void 0:C._dmService,vHe(P,null==C?void 0:C._dmService),H.isBoolean(P.isSystemDefaultPrinter)||(P.isSystemDefaultPrinter=!1)}return T}function vHe(C,x){var S,T=C.name,D="",R=C.deviceType;R==tn.TWAINSCANNER?S="":R==tn.TWAINX64SCANNER?S="Twain64-":R==tn.WIASCANNER?S="WIA-":R==tn.WIATWAINSCANNER?(T=H.replaceAll(T,"WIA-",""),S="WIATWAIN-"):S=R==tn.ICASCANNER?"ICA-":R==tn.SANESCANNER?"Sane-":R==tn.ESCLSCANNER?"eSCL-":"",x&&x.attrs&&x.attrs.ty&&(D=" on ["+x.attrs.ty+"]"),C.displayName=[S,T,D].join("")}function yHe(C){C.ProductName&&(C.ProductName=H.base64.decode(C.ProductName)),C.ProductFamily&&(C.ProductFamily=H.base64.decode(C.ProductFamily)),C.Manufacturer&&(C.Manufacturer=H.base64.decode(C.Manufacturer)),C.Version&&C.Version.Info&&(C.Version.Info=H.base64.decode(C.Version.Info))}function _He(C){var x=new hd;return x.strDevice=H.stringify(C),C.deviceInfo&&(x.deviceInfo=H.clone(C.deviceInfo)),C.deviceType&&(x.deviceType=H.clone(C.deviceType)),C.displayName&&(x.displayName=H.clone(C.displayName)),C.name&&(x.name=H.clone(C.name)),C.serviceInfo&&(x.serviceInfo=e9(C.serviceInfo)),x.isSystemDefaultPrinter=!!H.isBoolean(C.isSystemDefaultPrinter)&&C.isSystemDefaultPrinter,x}function CHe(C){var x=C||{};x.basePath&&(Po.basePath=x.basePath),x.pathType&&(Po.pathType=x.pathType),H.isUndefined(x.bDiscardBlankImage)||(Po.bDiscardBlankImage=x.bDiscardBlankImage),x.detectType&&(me.detect.detectType=x.detectType),x.tryTimes&&(me.detect.tryTimes=x.tryTimes);var S=be.DWT.RemoteScanConfig;S||(be.DWT.RemoteScanConfig=S={sessionTimeout:300,keepAwake:!0}),void 0===S.keepAwake&&(S.keepAwake=!0)}function vue(){return!!H.getWakeLock()}function aP(C){return yue.apply(this,arguments)}function yue(){return(yue=_t(B.mark(function C(x){var S;return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(S=H.getWakeLock(),!x){T.next=7;break}if(null!=S){T.next=5;break}return T.next=5,H.toggleWakeLock();case 5:T.next=10;break;case 7:if(!S){T.next=10;break}return T.next=10,H.toggleWakeLock();case 10:case"end":return T.stop()}},C)}))).apply(this,arguments)}function bHe(){for(var C,x,S,T=["dynamsoft.webtwain.install.js","dynamsoft.webtwain.viewer.js","dynamsoft.lts.js","dynamsoft.webtwain.viewer.css","dynamsoft.webtwain.css"],D=document.head.childNodes,R=D.length-1;R>=0;R--)if("LINK"==(x=D[R]).tagName?S=x.href:"SCRIPT"==x.tagName&&(S=x.src),S)for(C=0;C<T.length;C++)S.indexOf(T[C])>=0&&x.remove();me.detect.cssLoaded=!1}function _ue(C){return Cue.apply(this,arguments)}function Cue(){return(Cue=_t(B.mark(function C(x){var S;return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:x&&((S=document.createElement("style")).innerHTML=['@import url("',be.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",me.timestamp,'")'].join(""),x.appendChild(S));case 1:case"end":return T.stop()}},C)}))).apply(this,arguments)}function bue(C,x){var S;for(S=0;S<C.length;S++)if(C[S]==x)return!0;return!1}function i9(C){var x="application/octet-stream";switch(C){case Ti.IT_BMP:x="image/bmp";break;case Ti.IT_JPG:x="image/jpeg";break;case Ti.IT_TIF:x="image/tiff";break;case Ti.IT_PNG:x="image/png";break;case Ti.IT_PDF:x="application/pdf";break;case Ti.IT_J2K:x="image/jp2"}return x}(function(C){C.SMF_NAME=1,C.SMF_TWAINVERSION=2,C.SMF_TWAINPROTOCOL=4,C.SMF_ICAUUID=8,C.SMF_ICAMODULEVERSION=16,C.SMF_ICALOCATIONTYPE=32})(R0||(R0={})),function(C){C.IT_BMP=0,C.IT_JPG=1,C.IT_TIF=2,C.IT_PNG=3,C.IT_PDF=4,C.IT_ALL=5,C.IT_MULTIPAGE_PDF=7,C.IT_MULTIPAGE_TIF=8,C.IT_J2K=14}(Ti||(Ti={})),function(C){C.RGBA=15,C.Auto=16}(k0||(k0={}));var fd={isSupportLS:function(){var C=!1;if(!he.bEdge||!he.bFileSystem)try{C=!!window.localStorage}catch(x){}return C},item:function(C,x,S){var T=null;return this.isSupportLS()?(x?(localStorage.setItem(C,x),T=x):T=localStorage.getItem(C),null===T?S:T):S},removeItem:function(C){return!!this.isSupportLS()&&(localStorage.removeItem(C),!0)}};function xHe(C){if(H.isUndefined(C))return!1;var x,S,T,R=(T=C.toString().toLowerCase().toLowerCase().replace(Tt.name.toLowerCase()+" ",""),(T=H.replaceAll(T,"[.]",",")).split(","));x=Tt.bActiveXEdition?fu.ActiveXVersion:Tt.getServerVersionInfo(!0),S=(x=H.replaceAll(String(x),"[.]",",")).split(",");for(var P=R.length>S.length?R.length:S.length,O=0;O<P;O++){if(null==R[O]&&(R[O]=0),null==S[O]&&(S[O]=0),parseInt(R[O])<parseInt(S[O]))return!1;if(parseInt(R[O])>parseInt(S[O]))return!0}return!0}function Sue(C,x){var S=C.split(","),T=x.split(",");return S.length>3&&H.trim(S[0])==T[0]&&(H.trim(S[1])>T[1]||H.trim(S[1])==T[1]&&H.trim(S[2])>T[2]||H.trim(S[1])==T[1]&&H.trim(S[2])==T[2]&&parseInt(H.trim(S[3]))>=parseInt(T[3]))}function Tue(C,x){me.detect.urls.splice(0),me.detect.urls.push({port:C,ssl:he.bSSL}),me.detect.ports=[{port:C,ssl:he.bSSL}],me.detect.cUrlIndex=0,$n.detect.dwtPort=C,$n.detect.dwtSSLPort=x,be.DWT.Port=C,be.DWT.SSLPort=x}function r9(C,x,S){return o9.apply(this,arguments)}function o9(){return o9=_t(B.mark(function C(x,S,T){var D,R,P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!Tt.bDCPChecked){O.next=2;break}return O.abrupt("return",{host:x,port:be.DWT.Port,sslPort:be.DWT.SSLPort});case 2:return lo(Lje),O.prev=3,O.next=6,Iue(x);case 6:D=O.sent,O.next=13;break;case 9:throw O.prev=9,O.t0=O.catch(3),H.log(O.t0),pB();case 13:if(!$n.bEnhancedMode){O.next=27;break}if(lo(Nje),P=500,(R=me.install._dlgInstall)&&R.open||(P=0),!(D.port<=0||D.sslPort<=0)){O.next=25;break}if(!(P>0)){O.next=21;break}return O.next=21,new me.Promise(function(U,G){setTimeout(function(){U()},P)});case 21:return lo(Rce),O.next=24,SHe(x);case 24:D=O.sent;case 25:O.next=28;break;case 27:D={host:x,port:S,sslPort:T};case 28:return Tt.bDCPChecked=!0,O.abrupt("return",D);case 30:case"end":return O.stop()}},C,null,[[3,9]])})),o9.apply(this,arguments)}function SHe(C){return s9.apply(this,arguments)}function s9(){return s9=_t(B.mark(function C(x){var S,T,D,R;return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:T=5,D=1500,R={host:x,port:0,sslPort:0},S=0;case 3:if(!(S<T)){P.next=22;break}return S>2&&(D=3e3),lo(Rce),P.prev=6,P.next=9,THe(x);case 9:R=P.sent,P.next=14;break;case 12:P.prev=12,P.t0=P.catch(6);case 14:if(!(H.isNumber(R.port)&&R.port>0&&H.isNumber(R.sslPort)&&R.sslPort>0)){P.next=17;break}return Tue(R.port,R.sslPort),P.abrupt("return",R);case 17:return P.next=19,new me.Promise(function(O,U){setTimeout(function(){O()},D)});case 19:S++,P.next=3;break;case 22:throw me.detect.dcpStatus=3,pB();case 25:case"end":return P.stop()}},C,null,[[6,12]])})),s9.apply(this,arguments)}function THe(C){return a9.apply(this,arguments)}function a9(){return a9=_t(B.mark(function C(x){var S,T,D,P,O,U,G,X;return B.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return S=Tt.refProductKey,D=H.startsWith(x,"wss://")||H.startsWith(x,"ws://")?x:Kp.getWsUrl(x,he.bSSL?$n.SSLPort:$n.Port,he.bSSL),P={id:H.guid(),method:"GetPorts",version:"dwasm2_"+q1(),parameter:[$n.strSID]},mn.isLongKey(S)&&(P.productKey=S),z.next=6,Kp.postStringDataByWSUrl(D,H.stringify(P));case 6:if(!H.isString(O=z.sent)){z.next=19;break}if(z.prev=8,(U=H.parse(O))&&"result"in U&&(T=U.result),!(H.isArray(T)&&T.length>1&&T[1])){z.next=15;break}if(!(G=T[1]).dwt){z.next=15;break}return z.abrupt("return",{host:x,port:G.dwt.port,sslPort:G.dwt.sslPort});case 15:z.next=19;break;case 17:z.prev=17,z.t0=z.catch(8);case 19:throw Jl(X={}),Zi(X);case 22:case"end":return z.stop()}},C,null,[[8,17]])})),a9.apply(this,arguments)}function Iue(C){return Eue.apply(this,arguments)}function Eue(){return(Eue=_t(B.mark(function C(x){var S,T;return B.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return $n.detect.bConnected=!1,D.prev=1,D.next=4,IHe(x);case 4:return EHe(D.sent),$n.detect.bConnected=!0,D.abrupt("return",{host:x,port:$n.detect.dwtPort,sslPort:$n.detect.dwtSSLPort});case 10:if(D.prev=10,D.t0=D.catch(1),!D.t0){D.next=21;break}if(!H.isNumber(S=D.t0.code)){D.next=21;break}if(S!=Xn.ResponseDataTypeError&&S!=Xn.HTSTError&&S!=Xn.CORSError&&S!=Xn.CORSErrorFromService&&S!=Xn.SSLCertExpired&&S!=Xn.SSLCertInvalid){D.next=19;break}throw D.t0;case 19:if(S!=Xn.MustUpgrade){D.next=21;break}throw D.t0;case 21:throw $n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.NotInstalled,be.dcp._sendStatusEvent(),OS(T={}),{code:T._errorCode,message:T._errorString};case 26:case"end":return D.stop()}},C,null,[[1,10]])}))).apply(this,arguments)}function IHe(C){return l9.apply(this,arguments)}function l9(){return l9=_t(B.mark(function C(x){var S,T,D,P,O,U,G,X;return B.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return S=Tt.refProductKey,D=H.startsWith(x,"wss://")||H.startsWith(x,"ws://")?x:Kp.getWsUrl(x,he.bSSL?$n.SSLPort:$n.Port,he.bSSL),P={id:H.guid(),method:"VersionInfo",version:"dwasm2_"+xo.getVersionStrForCheck(),parameter:[]},mn.isLongKey(S)&&(P.productKey=S),z.next=6,Kp.postStringDataByWSUrl(D,H.stringify(P));case 6:if(H.isString(O=z.sent))try{(U=H.parse(O))&&"result"in U&&(T=U.result)}catch(K){}if(G={},!(H.isArray(T)&&T.length>0&&T[0])){z.next=23;break}if(!H.isString(X=T[0])||""==X){z.next=23;break}if(!Sue(X,Tt.getServerVersionInfo(!0))){z.next=18;break}return $n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.UpdateSkipped,be.dcp._sendStatusEvent(),z.abrupt("return",T);case 18:throw lo(kce),Q1(G),Zi(G);case 21:z.next=23;break;case 23:throw Jl(G),Zi(G);case 25:case"end":return z.stop()}},C)})),l9.apply(this,arguments)}function EHe(C){var x="",S=!1,T=!1,D={};if(C.length>4&&(x=H.isString(C[2])?C[2]:"",S=H.isString(C[3])&&"true"===C[3],T=H.isString(C[4])&&"64"===C[4]),C.length>5&&(D=C[5]),$n.detect.connectedResult=C,$n.strSID=x,$n.bEnhancedMode=S,$n.b64bit=T,$n.objEnhancedPorts=D,S&&D){if(D.dcp){var R=D.dcp;$n.SSLPort=R.sslPort,$n.Port=R.port}if(D.ddm){var P=D.ddm;$n.detect.ddmPort=P?he.bSSL?P.sslPort:P.port:0}if(be.DWT.Port=0,be.DWT.SSLPort=0,D.dwt){var O=D.dwt;O&&O.port>0&&O.sslPort>0&&Tue(O.port,O.sslPort)}}}function Due(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function c9(C,x,S){return x.has(C),S}be.DWT.NetManager.checkModuleManager=function(C,x){Iue(Ja()).then(C,x)};var Aue=new WeakSet,u9=new WeakSet,Ql=function(C){function x(Se){var de,_e,ve;return n(this,x),ve=[Se],_e=qn(_e=x),Due(de=Za(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Te){return!1}}()?Reflect.construct(_e,ve||[],qn(this).constructor):_e.apply(this,ve)),u9),Due(de,Aue),de._acquireDivEL=null,de.__serverId="",de.__bAcquireImageNow=yt,de._blts=Qa(),de._bltsCopyImage=!1,de._b64bit=$n.b64bit,de._logLevel=0,de._bServerAlwaysFocusOnPopupWindow=Nt,de._bPageFocus=Nt,de.__bOpenFileNow=yt,de._bScanForProxyRemote=yt,de}return el(x,C),v(x,[{key:"_isValid",value:function(){return!this._destroy||(jle(this),!1)}},{key:"_connnect",value:(Ge=_t(B.mark(function Se(){var de;return B.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return de=this,ge.abrupt("return",new me.Promise(function(_e,ve){be.DWT.CheckConnectToTheService(de._serverInfo.server,de._serverInfo.port,_e,ve)}));case 2:case"end":return ge.stop()}},Se,this)})),function(){return Ge.apply(this,arguments)})},{key:"_waitForConnect",value:function(){var Se=this;return Se._wsRetry=0,Se._bReady?me.Promise.resolve():new me.Promise(function(de,ge){Se._wsCheckResolve=de,Se._wsCheckReject=ge,kue(Se)})}},{key:"_getWSCallback",value:function(){return AHe}},{key:"_getWSContextData",value:function(){return{}}},{key:"_additionalWSCallback",value:function(Se,de,ge,_e){"ConvertToBlob"==Se&&de._blob_callbacks.push(function(ve){return ge(ve,Zr.HANDLE_RAW_MESSAGE,"0",_e)})}},{key:"_innerSendBlobByWS",value:function(Se,de,ge,_e,ve){var Te={cmd:Se,cmdId:US(),sFun:function(We){H.isFunction(_e)&&_e(We)},fFun:ve,contextData:{document:ge.currentFileName,tag:ge.currentTagName,bNeedClearTag:ge.bNeedClearCurrentTagName,bNeedRefresh:"UpdateImage"==Se},rawData:!0};return this._innerSendByWS(Se,de,Te,ge,!0)}},{key:"_innerSendByWS",value:function(Se,de,ge,_e,ve){var Te,We,Ye,Be,$e=this,ze=this._getWSCallback();ge&&ge.cmdId?(Ye=d9($e._clientId,Te=ge.cmdId),Be=d9($e._clientId,"")):(Te=0,Ye=0,Be=0);var Ct=M0($e._clientId,Se,de,Te,$e._bScanForProxyRemote),bt=$e._wsClient;We={client:bt,userData:{stwain:$e,command:ge},taskId:Te,eventTaskId:Ye,lastEventTaskId:Be};var Vt,In,yn,xt,Pt,It,Wt,en,Cn=0;if(!ve){try{bt.request(Ct,ze,We)}catch(Dr){H.log(Dr)}return yt}for(yn=new ArrayBuffer(12),_e&&(Cn=_e instanceof Blob?_e.size:_e instanceof ArrayBuffer||_e instanceof Uint8Array?_e.byteLength:_e instanceof Array?_e.length:_e.size||_e.byteLength||_e.length),In=(Vt=(Wt=new Blob([Ct])).size)+Cn,xt=new DataView(yn),It=0;It<8&&In;It++)xt.setUint8(It,In%256),In=Math.floor(In/256);for(It=0;It<4&&Vt;It++)xt.setUint8(8+It,Vt%256),Vt=Math.floor(Vt/256);return Pt=new Blob([yn,Wt]),en=bt.request(Pt,ze,We),this._additionalWSCallback(Se,bt,ze,We),Cn>0&&(en=bt.request(_e,ze,We)),yn=null,Wt=null,Pt=null,xt=null,_e=null,en}},{key:"_sendDataConnectWithSocket",value:function(Se,de,ge,_e){var ve=this;return new me.Promise(function(Te,We){ve._sendData(Se,de,!0,function(Ye){var Be=!1;try{Be=H.isString(Ye)?H.parse(Ye):Ye}catch($e){}if(ve._resetErr(),Be){if(Be instanceof Blob||$p(Be))return void Te(Be);wc(Be)&&(ve._errorCode=Be.exception,ve._errorString=Be.description)}Te(_e?Be:Be.result)},function(Ye){We({code:ve._errorCode,message:ve._getErrorString()})})})}},{key:"_sendDataByHttpAsync",value:function(Se,de,ge,_e,ve){var Te,We=this;if(We._resetErr(),!We._isValid())return me.Promise.reject({code:We._errorCode,message:We._getErrorString()});if(x.isServerInvalid(We))return ve?me.Promise.reject({code:We._errorCode,message:We._getErrorString()}):We._waitForConnect().then(function(){return We._sendDataByHttpAsync(Se,de,ge)});if(be.DWT.ConnectWithSocket)return We._sendDataConnectWithSocket(Se,de,ge,_e);Te={method:"post",async:!0,body:M0(We._clientId,Se,de,0,We._bScanForProxyRemote),dataType:null!=ge?ge:"text"};var Ye=null,Be=H.guid();return We._bIfShowProgressBar&&(Ye=me.progressContext),mB(Ye,Be)([We._httpUrl,"fa/",Se].join(""),Te).then(function($e){var ze=!1;try{ze=H.isString($e)?H.parse($e):$e}catch(Ct){}if(ze){if(ze instanceof Blob||$p(ze))return ze;if(!wc(ze))return We._resetErr(),_e?ze:ze.result;We._errorCode=ze.exception,We._errorString=ze.description}else aB(We);throw{code:We._errorCode,message:We._getErrorString()}},function($e){if(We._errorCode=$e.code,We._errorString=$e.message,!me.page.bUnload)throw $e})}},{key:"_sendData",value:function(Se,de,ge,_e,ve){var Te=this,We=null,Ye=null,Be=!1,$e=!0;if(!Te._destroy){if("ActiveUI"==Se?$e=!1:Be=x.isServerInvalid(Te),Be)return Te._waitForConnect().then(function(){Te._sendData(Se,de,ge,_e,ve)}).catch(function(Vt){H.isFunction(ve)&&ve(Vt.code,Vt.message)});var ze;H.isFunction(_e)&&(Ye=_e),H.isFunction(ve)&&(We=ve),ze="ConvertToBlob"==Se||"Heartbeat"==Se?0:US();var Ct=this._getWSContextData();return Te._innerSendByWS(Se,de,{cmd:Se,cmdId:ze,sFun:Ye,fFun:We,contextData:Ct,rawData:null!=ge&&ge},null,$e)}}},{key:"_innerFunV2",value:(Oe=_t(B.mark(function Se(de,ge,_e){var ve,Te,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(ve=this,!(We=_e)&&!H.isUndefined(We)){Ye.next=7;break}return Ye.next=4,ve._sendDataConnectWithSocket(de,ge,"json",!0);case 4:Te=Ye.sent,Ye.next=10;break;case 7:return Ye.next=9,ve._sendDataByHttpAsync(de,ge,"json",!0);case 9:Te=Ye.sent;case 10:if(!(Te&&H.isArray(Te)&&Te.length>0)){Ye.next=12;break}return Ye.abrupt("return",Te[0]);case 12:if(!(Te&&H.isArray(Te.result)&&Te.result.length>0)){Ye.next=14;break}return Ye.abrupt("return",Te.result[0]);case 14:return Ye.abrupt("return",Te);case 15:case"end":return Ye.stop()}},Se,this)})),function(Se,de,ge){return Oe.apply(this,arguments)})},{key:"_OnReady",value:(Re=_t(B.mark(function Se(){var de,ge;return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if((de=this)._wsRetry=0,de._wsFailedTimes=0,me.detect.starting=!1,de._bRemoteMode||(me.detect.bOK=!0),de._bReady=!0,null!==(ge=de._wsClient.ws)){_e.next=9;break}return _e.abrupt("return");case 9:ge.onopen=null,de._wsClient.addEvent("close",de._clientId,function(ve){ve&&H.log("websocket close: "+ve),de.__bAcquireImageNow=!1,de._OnWSClose(ve)}),de._wsClient.addEvent("error",de._clientId,function(ve){ve&&H.log("websocket error: "+ve),de.__bAcquireImageNow=!1,de._OnWSError(ve)}),de._wsClient.addEvent("timeout",de._clientId,function(ve){ve&&H.log("websocket timeout: "+ve),de._OnWSTimeout(ve)});case 13:case"end":return _e.stop()}},Se,this)})),function(){return Re.apply(this,arguments)})},{key:"getServiceInfo",value:function(){return this._dmService}},{key:"_OnWSClose",value:function(Se){var de,ge,_e,ve=this;if(ve._bReady=!1,ve._wsRetry=0,ve._bRemoteMode&&(de=null!==(ge=null===(_e=ve.getServiceInfo())||void 0===_e||null===(_e=_e.attrs)||void 0===_e?void 0:_e.name)&&void 0!==ge?ge:""),T0(ve,de),ve.__closeRemoteScanUI(!0),ve._heartBeatTimer&&(clearTimeout(ve._heartBeatTimer),ve._heartBeatTimer=null),ve._bNoMask||(H.log("hideMask:websocket close--"+Tf),YB(),Tf=0),ve.__OnWSClose&&ve.__OnWSClose(),ve._wsFailedTimes<(ve._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)){var We=ve._reconnectTimeSpan;ve._wsFailedTimes<ve._reconnectShortSpanTimes&&(We=ve._reconnectShortSpan),ve._heartBeatTimer=setTimeout(function(){x.startDWTReconnect(ve)},We)}}},{key:"_OnWSError",value:function(Se){this._bReady=!1,this.__OnWSError&&this.__OnWSError()}},{key:"_OnWSTimeout",value:function(Se){var de,ge,_e,ve=this;if(ve._bReady=!1,ve._wsRetry=0,ve._bRemoteMode&&(de=null!==(ge=null===(_e=ve.getServiceInfo())||void 0===_e||null===(_e=_e.attrs)||void 0===_e?void 0:_e.name)&&void 0!==ge?ge:""),T0(ve,de),ve.__closeRemoteScanUI(!0),ve._heartBeatTimer&&(clearTimeout(ve._heartBeatTimer),ve._heartBeatTimer=null),ve._wsFailedTimes<(ve._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)){var We=ve._reconnectTimeSpan;ve._wsFailedTimes<ve._reconnectShortSpanTimes&&(We=ve._reconnectShortSpan),ve._heartBeatTimer=setTimeout(function(){x.startDWTReconnect(ve)},We)}}},{key:"__OnRecieveMsg",value:function(Se,de){var ge=this;if(Se.event)return ge._handleEvent(Se,de.contextData);if(wc(Se)?(ge._errorCode=Se.exception,ge._errorString=Se.description):(ge._errorCode=0,ge._errorString=""),be.DWT.ConnectWithSocket){var _e=Se,ve=null==de?void 0:de.cmd;return"ActiveUI"==ve||"VersionInfo"==ve||"ConvertToBase64"==ve||"SaveSelectedImagesToBase64Binary"==ve||"ConvertToBlob"==ve?de.sFun&&H.isArray(Se.result)&&Se.result.length>0?(de.sFun(Se.result),!0):(de.fFun&&de.fFun(Se.result),!1):(0!=ge._errorCode&&de.fFun&&de.fFun(ge._errorString),"BeginSaveMem"==ve||"CreateLocalStorage"==ve||"LocalStorageExist"==ve||"SaveToLocalStorage"==ve||"LoadFromLocalStorage"==ve||"RemoveLocalStorage"==ve?de.sFun&&H.isArray(Se.result)&&Se.result.length>0?(de.sFun(Se.result),!0):(de.fFun&&de.fFun(Se.result),!1):(_e=de.rawData?Se:H.isArray(Se.result)&&Se.result.length>0?Se.result[0]:Se.result,de.sFun?de.sFun(_e):de.fFun&&de.fFun(_e),Se=null,!0))}if(0==ge._errorCode)return de.sFun&&H.isArray(Se.result)&&Se.result.length>0?(de.sFun(Se.result),!0):(de.fFun(Se.result),!0);var Te=!1;de.fFun&&(Te=de.fFun(ge._errorString)),!Te&&Se.exception&&Se.exception<0&&-2115!=Se.exception&&H.isFunction(ge.__OnPrintMsg)&&ge.__OnPrintMsg(ge._errorString)}},{key:"_handleOnBitmapChangedEvent",value:function(Se,de){try{var ge,_e,ve,Te,We,Ye,$e,ze,Ct,bt,Vt,In,yn,xt,Pt,It=Se.result[0],Wt=Se.result[1];if(H.isString(Wt)){var en=JSON.parse(Wt);ge=H.isArray(en)?en:[en]}else H.isArray(Wt)&&(ge=Wt);if(H.isArray(ge))for(Pt=de||{},yn=0;yn<ge.length;yn++)if(H.isArray((xt=ge[yn]).images))if(_e=xt.consumeType,ve=xt.curImageId,We=xt.images.length,(Te=xt.type)!=os.enumBCAppend&&Te!=os.enumBCInsert||(!Pt.document&&xt.document&&(Pt.document=xt.document),!Pt.tag&&xt.tag&&(Pt.tag=xt.tag)),Te==os.enumBCRemove){var Cn=[];for(Ye=0;Ye<We;Ye++)Cn.push(xt.images[Ye].id);var hn=[It,Cn.join(","),Te,ve,We,null,null,null,null,null,null,$e];this._OnBitmapChanged(hn,Se,Pt)}else for(Ye=0;Ye<We;Ye++){Ct=xt.images[Ye].width,bt=xt.images[Ye].height,ze=xt.images[Ye].depth,Vt=xt.images[Ye].xdpi,In=xt.images[Ye].ydpi,$e=xt.images[Ye].uid;var Dr=[It,xt.images[Ye].id.toString(),Te,ve,We,Ct,bt,ze,Vt,In,_e,$e];this._OnBitmapChanged(Dr,Se,Pt)}}catch(Hn){Nr(Hn)}return Nt}},{key:"_handleEvent",value:function(Se,de){var ge=this,_e=Se.result[0],ve=yt;return"OnBitmapChanged"==Se.event?ge._handleOnBitmapChangedEvent(Se,de):(H.each(PHe,function(Te,We){if(Se.event===Te){var Ye=["_",Te].join("");return ve=Nt,H.isFunction(ge[Ye])&&ge[Ye](Se.result,Se),yt}}),ve?(H.log("handled event:"+Se.event),H.each(RHe,function(Te,We){if(Se.event===Te)return H.log("sendback event:"+Se.event),ge._innerSendByWS(Se.event,Et(_e),null,null,Nt),yt})):(H.each(me.Addon_Events,function(Te,We){if(Se.event===Te){var Ye=["_",Te].join("");return ve=Nt,H.isFunction(ge[Ye])&&ge[Ye](Se.result),yt}}),ve&&(H.log("handled addon event:"+Se.event),H.each(me.Addon_Sendback_Events,function(Te,We){if(Se.event===Te)return H.log("sendback addon event:"+Se.event),ge._innerSendByWS(Se.event,Et(_e),null,null,Nt),yt}))),ve)}},{key:"_setProductKeyAsync",value:function(Se){var de=this,ge=Se;return de._resetErr(),de._isValid()?H.isString(ge)?mn.isLicenseMixed(ge,!1)?me.Promise.reject(be.DWT.licenseException):mn.isLongKey(ge)?c9(de,Aue,DHe).call(de,ge).then(function(_e){var ve=_e;if(!ve||ve.message)throw pu(de),ve&&ve.message&&(de._errorString=ve.message),{code:de._errorCode,message:de._getErrorString()};return JB(de,ve),ve}):(pu(de),me.Promise.reject({code:de._errorCode,message:de._getErrorString()})):(pu(de),me.Promise.reject({code:de._errorCode,message:de._getErrorString()})):me.Promise.reject({code:de._errorCode,message:de._getErrorString()})}},{key:"_setLTSLic",value:function(Se){var de=this,ge=Se;return de._resetErr(),!!de._isValid()&&(H.isString(ge)?de._sendDataByHttpAsync("LTSLicense",Et(ge),null,!0).then(function(_e){if(_e){if(wc(_e))throw de._errorCode=_e.exception,de._errorString=_e.description,{code:de._errorCode,message:de._getErrorString()};return de._innerFunV2("GetLicenseInfo",Et(0))}throw pu(de),{code:de._errorCode,message:de._getErrorString()}}):(pu(de),me.Promise.reject({code:de._errorCode,message:de._getErrorString()})))}},{key:"_setLTSLicenseAsync",value:function(Se){var de=this;return de._resetErr(),de._isValid()?H.isString(Se)?de._setLTSLic(Se).then(function(ge){var _e=ge;if(!_e||_e.message)throw pu(de),_e&&_e.message&&(de._errorString=_e.message),{code:de._errorCode,message:de._getErrorString()};return JB(de,_e),de.__licenseInfo&&(de.__licenseInfo.LTS=!0),_e}):(pu(de),me.Promise.reject({code:de._errorCode,message:de._getErrorString()})):me.Promise.reject({code:de._errorCode,message:de._getErrorString()})}},{key:"_innerActiveUI",value:(He=_t(B.mark(function Se(de){var ge,_e,ve,Te;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:return ge=this,_e=me.detect.ssl,ve=lje(),ge._bRemoteMode||(ve=5),Te="",ge._blts&&(Te=null!=de?de:""),Ye.next=6,new me.Promise(function(Be,$e){ge._sendData("ActiveUI",Et(Po.WSVersion,Po.WSSession,1,Te,_e,1,ve),!1,Be,$e)});case 6:return ge=null,Ye.abrupt("return",Ye.sent);case 9:case"end":return Ye.stop()}},Se,this)})),function(Se){return He.apply(this,arguments)})},{key:"_reconnected",value:(Ue=_t(B.mark(function Se(de){var ge,_e,ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return(ge=this)._wsFailedTimes=0,ze.next=4,ge._innerActiveUI(ge._uuidForActiveUI);case 4:if(ve=!1,(_e=ze.sent)&&(_e.length>12?(ge.__serverId=_e[1],ve=_e[12]):_e.length>8?(ge.__serverId=_e[1],ve=_e[8]):_e.length>=2&&(ge.__serverId=_e[1])),ge._bReady=!0,ge._bRemoteMode||(me.detect.bOK=!0),me.detect.starting=!1,!ve){ze.next=20;break}return ze.prev=11,ze.next=14,ge._removeAllImagesAsync("ActiveUI",!1);case 14:ze.next=19;break;case 16:ze.prev=16,ze.t0=ze.catch(11),ge._resetErr();case 19:St(ge,-2614,"The Dynamsoft Service has been restarted.");case 20:if(ze.prev=20,!ge._blts){ze.next=30;break}return Te=ge._bRemoteMode&&null!==(We=null===(Ye=ge._dmService)||void 0===Ye||null===(Ye=Ye.attrs)||void 0===Ye?void 0:Ye.UUID)&&void 0!==We?We:"",ze.next=25,rP(be.DWT.EnumInstance.dwt_desktop,Te);case 25:return Be=ze.sent,ze.next=28,ge._setLTSLicenseAsync(Be.ar);case 28:ze.next=33;break;case 30:return $e=Tt.refProductKey,ze.next=33,ge._setProductKeyAsync($e);case 33:return ze.next=35,ge._OnReconnected();case 35:ze.next=41;break;case 37:throw ze.prev=37,ze.t1=ze.catch(20),ge._bRemoteMode&&RS(ge),{code:ge._errorCode,message:ge._errorString};case 41:return ze.prev=41,ge._bRemoteMode&&x.startHeartBeat(ge),ze.finish(41);case 44:case"end":return ze.stop()}},Se,this,[[11,16],[20,37,41,44]])})),function(Se){return Ue.apply(this,arguments)})},{key:"_OnReconnected",value:(Ie=_t(B.mark(function Se(){return B.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:case"end":return de.stop()}},Se)})),function(){return Ie.apply(this,arguments)})},{key:"_initRemoteDiv",value:function(){if(!this._acquireDivEL){var Se=document.createElement("div");Se.style.position="fixed",Se.style.zIndex="510000",Se.style.left="0",Se.style.top="0";var de=document.createElement("img");de.className="ds-img-screen",Se.appendChild(de),document.body.appendChild(Se),this._acquireDivEL=Se}}},{key:"getHeartBeatData",value:function(Se){var de,ge=M0(this._clientId,Se.cmd,null,Se.cmdId,this._bScanForProxyRemote),_e=ge.length,ve=_e,Te=new ArrayBuffer(12+ve),We=new DataView(Te);for(de=0;de<8&&ve;de++)We.setUint8(de,ve%256),ve=Math.floor(ve/256);for(de=0;de<4&&_e;de++)We.setUint8(8+de,_e%256),_e=Math.floor(_e/256);for(de=0;de<ge.length;de++)We.setUint8(12+de,ge.charCodeAt(de));return Te}},{key:"__closeRemoteScanUI",value:function(Se){var de=this;if(de._acquireDivEL){var ge=H.sizzle(".ds-img-screen");de._acquireDivEL.evtFun?(ge&&ge.length>0&&H.removeEventListener(ge[0],"mouseup",de._acquireDivEL.evtFun),de._acquireDivEL.evtFun=null):ge&&ge.length>0&&H.removeEventListener(ge[0],"mouseup"),ge&&ge.length>0&&(ge[0].src=""),Se&&(document.body.removeChild(de._acquireDivEL),de._acquireDivEL=null)}}},{key:"_removeImageByIdAsync",value:(ye=_t(B.mark(function Se(de){var ge;return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if((ge=this)._resetErr(),ge._isValid()){_e.next=4;break}throw{code:ge._errorCode,message:ge._errorString};case 4:return _e.next=6,ge._innerFunV2("RemoveAllImages",Et(de));case 6:return _e.abrupt("return",_e.sent);case 7:case"end":return _e.stop()}},Se,this)})),function(Se){return ye.apply(this,arguments)})},{key:"_removeAllImagesAsync",value:(ue=_t(B.mark(function Se(de,ge){var _e;return B.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if((_e=this)._resetErr(),_e._isValid()){ve.next=4;break}throw{code:_e._errorCode,message:_e._getErrorString()};case 4:return ve.next=6,_e._innerFunV2("RemoveAllImages");case 6:return ve.abrupt("return",ve.sent);case 7:case"end":return ve.stop()}},Se,this)})),function(Se,de){return ue.apply(this,arguments)})},{key:"_LicensePromptExpired",value:function(){}},{key:"_OnActiveUI",value:(ae=_t(B.mark(function Se(de){var ge,_e,ve,Te,We,Ye,Be,$e,ze,Ct,bt,Vt,In,yn,xt,Pt,It;return B.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:if(ge=this,ve=!1,de&&de.length>=6?(_e=de[5],Te=!1,We=!1,Ye=0,de.length>12?(ge._b64bit="64"==de[7],Te=de[9],We=de[10],Ye=de[11]):de.length>8&&(Te=de[6],We=de[7],Ye=de[8]),Te?We&&Ye&&(ge._bRemoteMode=!0):ge._bRemoteMode=!0,H.isString(_e)&&("win"==_e?ge.__serverPlatform=Rn.enumWindow:"linux"==_e?ge.__serverPlatform=Rn.enumLinux:"mac"==_e?ge.__serverPlatform=Rn.enumMac:"embed"==_e?ge.__serverPlatform=Rn.enumEmbed:"chromeos"==_e&&(ge.__serverPlatform=Rn.enumChromeOS))):ve=!0,ge._bMustUpgradeService=ve,ve){Wt.next=67;break}if(lo("Activating the WebTwain instance..."),Be=!1,!ge._blts){Wt.next=44;break}return ze=ge._bRemoteMode&&null!==(Ct=null===(bt=ge._dmService)||void 0===bt||null===(bt=bt.attrs)||void 0===bt?void 0:bt.UUID)&&void 0!==Ct?Ct:"",Wt.prev=10,Wt.next=13,rP(be.DWT.EnumInstance.dwt_desktop,ze);case 13:$e=Wt.sent,Wt.next=27;break;case 16:if(Wt.prev=16,Wt.t0=Wt.catch(10),Mue(ge,Wt.t0),Vt=fue(ge._errorCode),!ge._bLicenseErrorDispose){Wt.next=25;break}throw ge._bRemoteMode||(Vt?this._LicensePromptExpired():pue(ge)),{code:ge._errorCode,message:ge._errorString};case 25:Vt||H.warn(ge._errorString),$e=null;case 27:if(lo(Mce),!$e){Wt.next=41;break}return Wt.next=31,ge._setLTSLicenseAsync($e.ar);case 31:return In=Wt.sent,be.DWT.laddDWTObj(ge),ze="",ge._bRemoteMode&&(ze=null!==(yn=null===(xt=ge._dmService)||void 0===xt||null===(xt=xt.attrs)||void 0===xt?void 0:xt.UUID)&&void 0!==yn?yn:""),lo(Oce),Wt.next=38,be.DWT.lcheckLic(be.DWT.EnumInstance.dwt_desktop,In,ze);case 38:Be=0==be.DWT.licenseException.code,Wt.next=42;break;case 41:Be=!1;case 42:Wt.next=62;break;case 44:return lo(Mce),Pt=Tt.refProductKey,Wt.prev=46,Wt.next=49,ge._setProductKeyAsync(Pt);case 49:Wt.sent&&(Be=!0),Wt.next=62;break;case 53:if(Wt.prev=53,Wt.t1=Wt.catch(46),!ge._bLicenseErrorDispose){Wt.next=60;break}throw ge._bRemoteMode||sP(Wt.t1.code)&&QB(Wt.t1),Wt.t1;case 60:H.warn(Wt.t1.message);case 61:Be=!1;case 62:if(Be&&(lo(Oce),mn.checkProductKey(ge,{Core:!0})||(It={code:ge._errorCode,message:ge._getErrorString()},ge._resetErr(),be.DWT.lclex(),he.bWin&&mn.checkProductKey(ge,{Webcam:!0},!0)||(ge._errorCode=It.code,ge._errorString=It.message))),0==ge._errorCode){Wt.next=67;break}if(ge._bRemoteMode||(fue(ge._errorCode)?this._LicensePromptExpired():pue(ge)),!ge._bLicenseErrorDispose){Wt.next=67;break}throw{code:ge._errorCode,message:ge._getErrorString()};case 67:ge._bRemoteMode&&x.startHeartBeat(ge);case 68:case"end":return Wt.stop()}},Se,this,[[10,16],[46,53]])})),function(Se){return ae.apply(this,arguments)})},{key:"_innerConvertToArrayBufferAsync",value:(oe=_t(B.mark(function Se(de,ge,_e,ve){var Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return Te=this,Ye=null!=ve?ve:"arraybuffer",Be=",",H.isString(We=_e)&&""!=We||(We="",Be=""),$e=["[",de,',"',ge.join(","),'"',Be,We,"]"].join(""),ze.next=6,Te._sendDataByHttpAsync("ConvertToBlob",$e,Ye,!0);case 6:return ze.abrupt("return",ze.sent);case 7:case"end":return ze.stop()}},Se,this)})),function(Se,de,ge,_e){return oe.apply(this,arguments)})},{key:"_getImageByServerId",value:(K=_t(B.mark(function Se(de){var ge,_e,ve;return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return ge=Ti.IT_PNG,Te.next=3,this._innerConvertToArrayBufferAsync(ge,[de],void 0,void 0);case 3:return _e=Te.sent,ve=i9(ge),Te.abrupt("return",new Blob([_e],{type:ve}));case 6:case"end":return Te.stop()}},Se,this)})),function(Se){return K.apply(this,arguments)})},{key:"_getSourcesAsync",value:(z=_t(B.mark(function Se(de,ge,_e){var ve;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return ve=this,We.next=3,ve._innerFunV2("GetSources",Et(de,null!=ge&&ge,null!=_e&&_e));case 3:return We.abrupt("return",mue(this,We.sent));case 5:case"end":return We.stop()}},Se,this)})),function(Se,de,ge){return z.apply(this,arguments)})},{key:"_getDevices",value:(X=_t(B.mark(function Se(de,ge,_e){var ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(Te=[],We="getDevices",Ye=(ve=this)._bRemoteMode?WS:he.bAndroid?$B:WS,Be=null!=de?de:Ye,ve._resetErr(),ve._isValid()){ze.next=5;break}return ze.abrupt("return",me.Promise.reject({code:ve._errorCode,message:ve._getErrorString()}));case 5:return ve._bNoMask||Wo(We,ve),ze.prev=6,ze.next=9,ve._getSourcesAsync(Be,ge,_e);case 9:H.isArray($e=ze.sent)&&$e.length>0&&(Te=Te.concat($e)),ze.next=16;break;case 13:throw ze.prev=13,ze.t0=ze.catch(6),ze.t0;case 16:return ze.prev=16,ve._bNoMask||Xr(We),ze.finish(16);case 19:return ze.abrupt("return",Te);case 20:case"end":return ze.stop()}},Se,this,[[6,13,16,19]])})),function(Se,de,ge){return X.apply(this,arguments)})},{key:"_innerAcquireImageFromService",value:function(Se,de,ge){var _e,ve,Te=this;if(ve=H.clone(Se),!mn.checkProductKey(Te,{Core:!0}))return H.isFunction(ge)&&ge(Te._errorCode,Te._getErrorString()),!1;var We=Te._bRemoteMode?Nt:yt;ve.RemoteScan=We?1:0,Te._bRemoteMode&&(H.isFunction(Te.__OnRemoteScanStatusAsync)||(Te.__OnRemoteScanStatusAsync=function(){}),H.isFunction(Te.__OnSourceUIClose)||(Te.__OnSourceUIClose=function(){}));for(var Be=0,$e=0;$e<lP.length;$e++){var ze=["__",lP[$e]].join("");H.isFunction(Te[ze])&&(Be|=1<<$e)}return ve.EnableEvents=Be,We&&(Te._isBindViewer()||!1)&&Te._initRemoteDiv(),Te._bRemoteMode||(Te._bPageFocus&&be.DWT.IfAlwaysFocusOnPopupWindow?Te._bServerAlwaysFocusOnPopupWindow||Te._OnPageFocus(!0):Te._bServerAlwaysFocusOnPopupWindow&&Te._OnPageBlur(!0)),_e=["[",H.stringify(ve),"]"].join(""),Te._sendData("AcquireImage",_e,!0,function(Ct){de(Ct)},function(Ct){ge(Te._errorCode,Te._getErrorString())}),!0}},{key:"_canConsume",value:function(){return this._blts&&!this._bltsCopyImage}},{key:"_acquireImageFromServiceAsync",value:function(Se){var de=this;return new me.Promise(function(ge,_e){return de._innerAcquireImageFromService(Se,function(){de._canConsume()&&be.DWT.lcvrf(de),ge(!0)},function(ve,Te){_e({code:ve,message:Te})})})}},{key:"_acquireImage",value:(G=_t(B.mark(function Se(de,ge){var _e,ve,Te,We,Ye;return B.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(_e=this,ve=ge?H.clone(ge):{},Te="acuqireImage",_e._resetErr(),_e._isValid()){Be.next=4;break}throw{code:_e._errorCode,message:_e._getErrorString()};case 4:if(mn.checkProductKey(_e,{Core:!0})&&_e._isValid()){Be.next=6;break}throw{code:_e._errorCode,message:_e._getErrorString()};case 6:if(!_e.__bAcquireImageNow){Be.next=9;break}throw Ple(_e),{code:_e._errorCode,message:_e._getErrorString()};case 9:return _e.__bAcquireImageNow=!0,_e._bNoMask||Wo(Te,_e),We=be.DWT.RemoteScanConfig,Ye=vue(),Be.prev=12,Oue(ve),We&&aP(We.keepAwake),null!=de&&(ve.Device=de.strDevice,ve.DeviceMatchField=R0.SMF_NAME),Be.next=18,_e._acquireImageFromServiceAsync(ve);case 18:Be.next=23;break;case 20:throw Be.prev=20,Be.t0=Be.catch(12),Be.t0;case 23:return Be.prev=23,_e.__bAcquireImageNow=!1,_e._bNoMask||Xr(Te),aP(Ye),Be.finish(23);case 28:return Be.abrupt("return",!0);case 29:case"end":return Be.stop()}},Se,this,[[12,20,23,28]])})),function(Se,de){return G.apply(this,arguments)})},{key:"_getCapabilities",value:(U=_t(B.mark(function Se(de,ge,_e){var ve,Te,We,Ye,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return Te=null,c9(ve=this,u9,Pue).call(ve,de),ve._initRemoteDiv(),$e.next=5,ve._innerSelectDeviceAsync(de);case 5:return H.isArray(_e)&&(Te=Et(_e)),$e.next=8,ve._sendDataByHttpAsync("GetCapabilities",Te);case 8:if(We=$e.sent,$e.prev=9,We.length>0&&(Be=We[0]),!H.isString(Be)){$e.next=22;break}if(Be=me.removeNonPrintableChar(Be),Be=H.replaceAll(Be,"\\\\","\\\\"),0!=(Ye=JSON.parse(Be)).errorCode){$e.next=17;break}return $e.abrupt("return",Ye.response);case 17:throw ve._errorCode=Ye.errorCode,ve._errorString=Ye.errorString,{code:ve._errorCode,message:ve._getErrorString()};case 22:throw Jl(ve),{code:ve._errorCode,message:ve._getErrorString()};case 24:$e.next=31;break;case 26:throw $e.prev=26,$e.t0=$e.catch(9),ve._errorCode=-2302,ve._errorString=$e.t0,{code:ve._errorCode,message:ve._getErrorString()};case 31:case"end":return $e.stop()}},Se,this,[[9,26]])})),function(Se,de,ge){return U.apply(this,arguments)})},{key:"_setCapabilities",value:(O=_t(B.mark(function Se(de,ge,_e){var ve,Te;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(c9(ve=this,u9,Pue).call(ve,de),H.isObject(ge)&&!H.isArray(ge)){We.next=5;break}throw Bi(ve),{code:ve._errorCode,message:ve._getErrorString()};case 5:return ve._initRemoteDiv(),We.next=8,ve._innerSelectDeviceAsync(de);case 8:return Te=["[",H.stringify(ge),"]"].join(""),We.next=11,ve._sendDataByHttpAsync("SetCapabilities",Te);case 11:return We.abrupt("return",We.sent);case 12:case"end":return We.stop()}},Se,this)})),function(Se,de,ge){return O.apply(this,arguments)})},{key:"_closeSource",value:(P=_t(B.mark(function Se(){var de;return B.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return de=this,ge.next=3,de._innerFunV2("CloseSource");case 3:case"end":return ge.stop()}},Se,this)})),function(){return P.apply(this,arguments)})},{key:"_innerSelectDeviceAsync",value:(R=_t(B.mark(function Se(de,ge){var _e,ve,Te,We,Ye,Be,ze;return B.wrap(function(Ct){for(;;)switch(Ct.prev=Ct.next){case 0:if(ve=this,de&&de instanceof hd){Ct.next=4;break}throw Bi(ve),{code:ve._errorCode,message:ve._errorString};case 4:if(!(Te=null===(_e=this._dmService.attrs)||void 0===_e?void 0:_e.UUID)){Ct.next=15;break}if((null===(We=de.serviceInfo.attrs)||void 0===We?void 0:We.UUID)!=Te){Ct.next=9;break}Ct.next=15;break;case 9:if(!((Be=(null===(Ye=de.serviceInfo.attrs)||void 0===Ye?void 0:Ye.url)||de.serviceInfo.server)&&Be.indexOf(Te)>-1)){Ct.next=13;break}Ct.next=15;break;case 13:throw zle(ve),{code:ve._errorCode,message:ve._errorString};case 15:return ze=["[",de.strDevice,",",null!=ge?ge:R0.SMF_NAME,"]"].join(""),Ct.next=18,ve._innerFunV2("SelectSourceEx",ze);case 18:return Ct.abrupt("return",Ct.sent);case 19:case"end":return Ct.stop()}},Se,this)})),function(Se,de){return R.apply(this,arguments)})},{key:"registerEvent",value:function(Se,de){return!!this._registerEvent(Se,de)}},{key:"unregisterEvent",value:function(Se,de){return this._unregisterEvent(Se,de)}},{key:"_registerEvent",value:function(Se,de){return this._resetErr(),!!this._isValid()&&(this[["__",Se].join("")]=de,!0)}},{key:"_unregisterEvent",value:function(Se,de){return this._resetErr(),!!this._isValid()&&(this[["__",Se].join("")]=null,Nt)}},{key:"_OnPageFocus",value:function(Se){var de=this;if(de._bPageFocus=!0,de._bReady&&he.bWin&&be.DWT.IfAlwaysFocusOnPopupWindow){var ge=H.stringify({sequence:0,wnds:0,wnd:"0",type:3,x:0,y:0});if(de.__bAcquireImageNow||Se||de.__bOpenFileNow){de._bServerAlwaysFocusOnPopupWindow=!0;try{de._isValid()&&de._sendDataByHttpAsync("SendEventToScannerUI",["[",ge,"]"].join(""))}catch(_e){}}}}},{key:"_OnPageBlur",value:function(Se){var de=this;if(he.bWin&&de._bReady){var ge=H.stringify({sequence:0,wnds:0,wnd:"0",type:4,x:0,y:0});if((0!=de._bPageFocus||Se)&&(de._bPageFocus=!1,de.__bAcquireImageNow||Se||de.__bOpenFileNow)){de._bServerAlwaysFocusOnPopupWindow=!1;try{de._isValid()&&de._sendDataByHttpAsync("SendEventToScannerUI",["[",ge,"]"].join(""))}catch(_e){}}}}},{key:"_OnRemoteScanStatusAsync",value:function(Se){var de,_e,ve,Te,We,Ye,Be=this;if(Se&&Se.length>=2){try{var $e=new String(Se[1]);de=H.parse($e)}catch(Ct){H.error(Ct.message),H.log("parse json failed: "+Se[1])}de||(de={sequence:0,screen:[]})}if(de&&de.sequence)if(de.sequence>0&&de.screen&&de.screen.length>0){if(ve=de.sequence,We=de.wnds,Ye=(_e=de.screen[0]).img,H.isString(Ye)&&""!=Ye&&(Te=_e.wnd),ve&&Te){var ze=H.sizzle(".ds-img-screen");ze&&ze.length>0&&Be._acquireDivEL&&(Be._acquireDivEL.evtFun&&(H.removeEventListener(ze[0],"mouseup",Be._acquireDivEL.evtFun),Be._acquireDivEL.evtFun=null),ze[0].src=Ye,Be._acquireDivEL.evtFun=function(Ct){We||(We="0");var bt=H.stringify({sequence:ve,wnds:We,wnd:Te+"",type:2,x:Ct.offsetX,y:Ct.offsetY});Be._sendDataByHttpAsync("SendEventToScannerUI",["[",bt,"]"].join(""))},H.addEventListener(ze[0],"mouseup",Be._acquireDivEL.evtFun))}}else Be.__closeRemoteScanUI(!1);return H.isFunction(Be.__OnRemoteScanStatusAsync)&&Be.__OnRemoteScanStatusAsync(de),!0}},{key:"_OnBitmapChanged",value:function(Se,de,ge){var _e=this,Be=Se[2],$e=Se[3],ze=-1;if("c1"!=Se[0]&&"c2"!=Se[0]&&"m1"!=Se[0]){if(Se.length>10&&(ze=Se[10]),ze>-1&&_e._canConsume()&&(Be==os.enumBCAppend||Be==os.enumBCInsert)){var Ct=be.DWT.lgct(ze);H.isFunction(_e.__OnLtsverify)&&_e.__OnLtsverify(Ct,1)}Be!=os.enumBCAppend&&Be!=os.enumBCInsert||!H.isFunction(_e.__OnBufferChanged)||_e.__OnBufferChanged({action:"add",currentId:$e,imageIds:[],selectedIds:[]})}}},{key:"_OnPostTransferAsync",value:function(Se,de,ge){var _e;if(Se&&Se.length>=2)try{var Te=String(Se[1]).replace(/\\/g,"\\\\");_e=H.parse(Te)}catch(Ye){H.error(Ye)}_e||(_e={imageId:""});var We=!1;if(H.isFunction(this.__OnPostTransferAsync))try{We=this.__OnPostTransferAsync(_e)}catch(Ye){Nr(Ye)}if(H.isFunction(this.__OnPostTransferAsync2))try{this.__OnPostTransferAsync2(_e)}catch(Ye){Nr(Ye)}return We}},{key:"_getErrorCode",value:function(){return this._errorCode}},{key:"_getErrorString",value:function(){return 0!=this._errorCode?this._errorString:"Successful."}},{key:"_isBindViewer",value:function(){return!1}},{key:"_isNoViewer",value:function(){return!0}},{key:"_isMobileMode",value:function(){return!1}},{key:"_needCheckProxyRemoteScanLicense",value:function(){if(!this._blts&&this._bScanForProxyRemote){if(""==this._strRemoteServiceVer)return!0;if(ge=this._strRemoteServiceVer.split(","),_e=[18,3],H.trim(ge[0])>_e[0]||ge.length>1&&H.trim(ge[0])==_e[0]&&H.trim(ge[1])>=_e[1])return!0}var ge,_e;return!1}}],[{key:"isServerInvalid",value:function(Se){var de,ge,_e,ve,Te;return ge=Se._bMustUpgradeService,(de=!Se._bReady||null===Se._wsClient)?(Se._bRemoteMode&&(_e=null!==(ve=null===(Te=Se._dmService)||void 0===Te||null===(Te=Te.attrs)||void 0===Te?void 0:Te.name)&&void 0!==ve?ve:""),T0(Se,_e)):ge?Q1(Se):Se.isDestroy&&jle(Se),de||ge||-2208==Se._errorCode||Se.isDestroy}},{key:"STwainConnectToServer",value:(D=_t(B.mark(function Se(de){var _e;return B.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(!be.DWT.WebTwainIdMap[de._id]){ve.next=5;break}return ve.next=4,de._OnReady();case 4:return ve.abrupt("return");case 5:if(!de._bReady&&!de._destroy){ve.next=7;break}return ve.abrupt("return");case 7:return de._bConnecting=!0,(_e=wf.Instance.getClient(de._serverInfo)).setRetry(0),de._bNoMask||Wo("",de),ve.prev=11,ve.next=14,Gce(de._bRemoteMode);case 14:return ve.next=17,_e.testConnection(void 0,0,void 0,1e4);case 17:if(de._wsClient=_e,de._wsClient.bReady=!0,me.detect.bFirst&&(kHe(),me.detect.bFirst=!1),de._bReady){ve.next=24;break}return de._bReady=!0,ve.next=24,de._OnReady();case 24:ve.next=30;break;case 26:throw ve.prev=26,ve.t0=ve.catch(11),de._bReady=!1,{code:de._errorCode,message:de._getErrorString()};case 30:return ve.prev=30,de._bConnecting=!1,de._bNoMask||Xr(""),ve.finish(30);case 34:case"end":return ve.stop()}},Se,null,[[11,26,30,34]])})),function(Se){return D.apply(this,arguments)})},{key:"_innerSendHeartBeat",value:(T=_t(B.mark(function Se(de,ge){var _e,ve,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(Ye.prev=0,!de.__bAcquireImageNow){Ye.next=4;break}Ye.next=14;break;case 4:if(_e={client:null,userData:null,taskId:"0",eventTaskId:"0",lastEventTaskId:"0"},ve=US(),We=de.getHeartBeatData({cmd:"Heartbeat",cmdId:ve,sFun:null,fFun:null,contextData:null,rawData:!0}),!de._wsClient){Ye.next=12;break}return de._wsClient.setRetry(0),Ye.next=12,de._wsClient.request(We,null,_e);case 12:We=null;case 14:Ye.next=18;break;case 16:Ye.prev=16,Ye.t0=Ye.catch(0);case 18:de._wsClient&&de._wsClient.connected&&ge&&setTimeout(function(){x._innerSendHeartBeat(de,ge)},de._wsClient._heartBeatTicks);case 19:case"end":return Ye.stop()}},Se,null,[[0,16]])})),function(Se,de){return T.apply(this,arguments)})},{key:"startDWTReconnect",value:(S=_t(B.mark(function Se(de){var ge,_e,Te,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(Ye.prev=0,!de._destroy){Ye.next=3;break}return Ye.abrupt("return");case 3:if(ge=de._serverInfo,!($n.bEnhancedMode&&ge&&ge.port)){Ye.next=24;break}return Tt.bDCPChecked=!1,Ye.prev=6,Ye.next=9,r9(Ja(),be.DWT.Port,be.DWT.SSLPort);case 9:if(!(_e=Ye.sent)){Ye.next=14;break}de._serverInfo.port=he.bSSL?_e.sslPort:_e.port,Ye.next=16;break;case 14:throw Jl(de),Zi(de);case 16:Ye.next=24;break;case 18:return Ye.prev=18,Ye.t0=Ye.catch(6),de._wsFailedTimes++,de._wsFailedTimes<(de._bRemoteMode?xo.RemoteReconnectMaxTimes:xo.LocalReconnectMaxTimes)&&(Te=de._reconnectTimeSpan,de._wsFailedTimes<de._reconnectShortSpanTimes&&(Te=de._reconnectShortSpan),de._heartBeatTimer=setTimeout(function(){x.startDWTReconnect(de)},Te)),Ye.abrupt("return");case 24:return de._bConnecting=!0,(We=wf.Instance.getClient(de._serverInfo)).setRetry(0),Ye.next=30,We.testConnection(void 0,0,void 0,3e4);case 30:return de._wsClient=We,de._wsClient.bReady=!0,de._wsRetry=0,Ye.next=35,de._reconnected(We);case 35:Ye.next=40;break;case 37:Ye.prev=37,Ye.t1=Ye.catch(0),de._wsFailedTimes++;case 40:return Ye.prev=40,de._bConnecting=!1,Ye.finish(40);case 43:case"end":return Ye.stop()}},Se,null,[[0,37,40,43],[6,18]])})),function(Se){return S.apply(this,arguments)})},{key:"startHeartBeat",value:function(Se){var de=Se._wsClient;de&&de.connected&&!de._bHeartBeatStarted&&(de._bHeartBeatStarted=!0,setTimeout(function(){x._innerSendHeartBeat(Se,!0)},de._heartBeatTicks))}},{key:"getServerImageUrlPrefix",value:function(Se){var de,ge=Se._httpUrl;return de=Se._bScanForProxyRemote?xo.getVersionStrForCheck():Tt.getServerVersionInfo(),[ge,"dwt/",Tt.getDWTPrefix(),de,"/img?id=",Se._clientId].join("")}}]);var S,T,D,R,P,O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge}(mHe);function DHe(C){var x,S=this,T=C;return S._resetErr(),S._isValid()?(T=H.isString(T)?H.trim(T):"",x=S._sendDataConnectWithSocket("ProductKey",Et(T),"json",!0),S.__productKey=T,x=x.then(function(D){if(H.isArray(D)&&D.length>0){if(0!=S._errorCode)throw S.__productKey="",{code:S._errorCode,message:S._getErrorString()};return be.DWT.ProductKey=S.__productKey,mn.reparseProductKey(),S._innerFunV2("GetLicenseInfo",Et(0))}throw pu(S),x.context=null,{code:S._errorCode,message:S._getErrorString()}})):me.Promise.reject({code:S._errorCode,message:S._getErrorString()})}function Pue(C){return Rue.apply(this,arguments)}function Rue(){return(Rue=_t(B.mark(function C(x){var S;return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if((S=this)._resetErr(),S._isValid()){T.next=4;break}return T.abrupt("return",me.Promise.reject({code:S._errorCode,message:S._errorString}));case 4:if(x&&x instanceof hd){T.next=7;break}throw Bi(S),{code:S._errorCode,message:S._errorString};case 7:case"end":return T.stop()}},C,this)}))).apply(this,arguments)}function M0(C,x,S,T,D){var R,P=[];return P.push("{"),P.push('"id":"'),P.push(C),P.push('"'),T&&(P.push(',"cmdId":"'),P.push(T),P.push('"')),P.push(',"method":"'),P.push(x),P.push('"'),P.push(',"module":"dwt","version":"'),R=D?[Tt.getDWTPrefix(),xo.getVersionStrForCheck()].join(""):[Tt.getDWTPrefix(),Tt.getServerVersionInfo()].join(""),P.push(R),P.push('"'),null!=S&&(P.push(',"parameter":'),H.isArray(S)?P.push(H.stringify(S)):P.push(S)),P.push("}"),P.join("")}function d9(C,x){return["evt",C,x].join("_")}function kue(C){if(C._bReady)C._wsCheckResolve();else{if(be.DWT.bConnectCanceled)return H.asyncQueue.stop(),gu(C),void C._wsCheckReject({code:C._errorCode,message:C._getErrorString()});if(C._wsRetry>10)return Gle(C),void C._wsCheckReject({code:C._errorCode,message:C._getErrorString()});C._wsRetry++,setTimeout(function(){kue(C)},1100)}}function AHe(C,x,S,T){return h9.apply(this,arguments)}function h9(){return h9=_t(B.mark(function C(x,S,T,D){var R,P,O,U,G,X,z;return B.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(S!=Zr.GET_TASKID){K.next=4;break}return K.abrupt("return",D.taskId);case 4:if(S!=Zr.GET_EVENT_TASKID){K.next=8;break}return K.abrupt("return",D.eventTaskId);case 8:if(S!=Zr.ONMESSAGE_PROCESS_DATA){K.next=17;break}if("object"!==p(x)){K.next=11;break}return K.abrupt("return",x);case 11:if(!((U=x).indexOf("Version not found")>=0||U.indexOf("Function not found")>=0)){K.next=14;break}return K.abrupt("return",{cmdId:null!=T?T:0});case 14:return K.abrupt("return",H.parse(x));case 17:if(S!=Zr.ONMESSAGE_GET_TASKID){K.next=25;break}if(!x){K.next=22;break}if(!x.event){K.next=21;break}return K.abrupt("return",0);case 21:return K.abrupt("return",x.cmdId);case 22:return K.abrupt("return",x);case 25:if(S!=Zr.ONMESSAGE_GET_EVENT_TASKID){K.next=31;break}if(!x||!x.event){K.next=28;break}return K.abrupt("return",d9(x.id,x.cmdId));case 28:return K.abrupt("return",0);case 31:if(S!=Zr.HANDLE_RAW_MESSAGE){K.next=59;break}if(R=null==D?void 0:D.userData){K.next=35;break}return K.abrupt("return",!1);case 35:if(P=R.stwain,O=R.command){K.next=39;break}return K.abrupt("return",!1);case 39:if(P&&H.isFunction(P.__OnWSMessage)&&P.__OnWSMessage(x),"object"!==p(x)){K.next=44;break}if(!be.DWT.ConnectWithSocket){K.next=44;break}return"ConvertToBlob"!=O.cmd&&"GetImageByIndex"!=O.cmd||O.sFun(x),K.abrupt("return",!0);case 44:if(!((G=x.replace(/\0/g,"")).indexOf('"method" : "Heartbeat"')>=0)){K.next=47;break}return K.abrupt("return",!0);case 47:if(!(G.indexOf('"method" : "EnableBuffer"')>=0||G.indexOf('"method" : "GetBuffer"')>=0)){K.next=50;break}return be.DWT.lwsproc(G,O),K.abrupt("return",!0);case 50:if(!(G.indexOf("Exception:")>=0||0==G.indexOf("Error"))){K.next=57;break}return z=!1,H.log((X=x)+"@"+O.cmd),O.fFun&&(z=O.fFun(X)),!z&&P&&H.isFunction(P.__OnPrintMsg)&&P.__OnPrintMsg(X),K.abrupt("return",!0);case 57:K.next=70;break;case 59:if(S!=Zr.HANDLE_PROCESSED_MESSAGE){K.next=70;break}if(R=null==D?void 0:D.userData){K.next=63;break}return K.abrupt("return",!1);case 63:if(P=R.stwain){K.next=66;break}return K.abrupt("return",!1);case 66:if(O=R.command){K.next=69;break}return K.abrupt("return",!1);case 69:return K.abrupt("return",P.__OnRecieveMsg(x,O));case 70:case"end":return K.stop()}},C)})),h9.apply(this,arguments)}function Mue(C,x){if(x){var S=x.code||x.ltsErrorCode,T=x.message;111==S||106==S||108==S?(RS(C,S),C._errorString=T):(C._errorCode=S,C._errorString=T),be.DWT.lsetException(C._errorCode,C._errorString,!0)}}function Oue(C){void 0!==C.Resolution&&(C.Resolution=parseInt(C.Resolution)),void 0!==C.PixelType&&(C.PixelType=parseInt(C.PixelType)),void 0!==C.SelectSourceByIndex&&(C.SelectSourceByIndex=parseInt(C.SelectSourceByIndex))}var os,lP=["OnPreAllTransfers","OnPreTransfer","OnPostTransfer","OnPostTransferAsync"];!function(C){C.enumBCAppend=1,C.enumBCInsert=2,C.enumBCRemove=3,C.enumBCEdit=4,C.enumBCIndexChange=5,C.enumBCUpdate=6}(os||(os={}));var GS,Mi,PHe=["OnPostAllTransfers","OnPostTransfer","OnPostLoad","OnPreTransfer","OnPreAllTransfers","OnResult","OnTransferCancelled","OnTransferError","OnSourceUIClose","OnGetFilePath","OnPercentDone","OnPostTransferAsync","OnPreAllTransfersAsync","OnRemoteScanStatusAsync","OnConsumed","OnDiskExceedLimit"],RHe=["OnPreAllTransfers","OnPreTransfer","OnPostTransfer","OnGetFilePath","OnPostLoad"],f9=H.each;function kHe(){var C,x=fd.item("DWT_port"),S=fd.item("DWT_ssl");if($n.bEnhancedMode)return!0;me.detect.urls.splice(0),me.detect.cUrlIndex=0,x!==GS&&S!==GS&&(C={port:x,ssl:"true"==S});var T=function(D){return!C||!(!D||D.port==C.port&&D.ssl==C.ssl)};1===me.detect.detectType?(C!==GS&&C.ssl&&me.detect.urls.push(C),f9(me.detect.ports,function(D){D.ssl&&T(D)&&me.detect.urls.push(D)})):0===me.detect.detectType?(C===GS||C.ssl||me.detect.urls.push(C),f9(me.detect.ports,function(D){!1===D.ssl&&T(D)&&me.detect.urls.push(D)})):(C!==GS&&me.detect.urls.push(C),f9(me.detect.ports,function(D){T(D)&&me.detect.urls.push(D)}))}!function(C){C.TWAIN=0,C.ICA=3,C.SANE=3,C.TWAIN_AND_ICA=4,C.TWAIN_AND_TWAIN64=4,C.TWAIN64=5}(Mi||(Mi={}));var zn={notSupportProperty:function(C){},notSupportMethod:function(C){},refreshImageAfterInvokeFun:function(C,x,S){return 1==S},loadHttpBlob:function(C,x,S,T,D,R,P,O){var U,G,X=yt;if(G={method:x,dataType:"blob"},O&&(G.headers=O),""!=C.HTTPUserName&&(G.username=C.HTTPUserName,G.password=C.HTTPPassword),C.__HTTPPostResponseString="",T){if("get"==x){var z=H.guid();return me.progressContext&&(me.progressContext._onPercent=P),void mB(me.progressContext,z)(S,G).then(function(ue){var ye=ue.type;if("text/plain"==ye||"text/html"==ye||"text/json"==ye){var Ie=new FileReader;Ie.readAsText(ue),Ie.onload=function(){C.__HTTPPostResponseString=Ie.result,D(ue)},Ie.onerror=function(){D(ue)}}else D(ue)},function(ue){ue&&ue.code?(C._errorCode=ue.code,C._errorString=ue.message):ue&&ue.httpCode?cB(C,!1,ue.message,ue.httpCode):Rle(C),H.isFunction(R)&&R({code:C._errorCode,message:C._errorString})})}G.onSuccess=function(ue,ye,Ie){if((Ie?Ie.getResponseHeader("content-type"):"").indexOf("text/")>=0){var Ue=new FileReader;Ue.readAsText(ue),Ue.onload=function(){C.__HTTPPostResponseString=Ue.result,D(ue)},Ue.onerror=function(){D(ue)}}else D(ue)},H.isFunction(P)&&(G.beforeSend=function(ue){ue.addEventListener("progress",function(ye){!he.bSafari&&ye&&(delete ye.totalSize,delete ye.position),P(ye)},yt)})}else he.bIE?(G.dataType="arraybuffer",G.onSuccess=function(ue,ye,Ie){var Ue,He;(Ue=ue||Ie.responseData)&&(He=new Uint8Array(Ue)),C.__HTTPPostResponseString=Ie.responseText,C._errorCode=0,C._errorString="",D(He),He=null,X=Nt}):(G.dataType="text",G.contentType="text/plain; charset=x-user-defined",G.mimeType="text/plain; charset=x-user-defined",G.onSuccess=function(ue,ye,Ie){var Ue,He,Re;C.__HTTPPostResponseString=Ue=Ie.responseText,He=Ue.length,Re=new Uint8Array(He);for(var Oe=0;Oe<He;Oe++)Re[Oe]=Ue.charCodeAt(Oe);C._errorCode=0,C._errorString="",D(Re),Re=null,X=Nt}),G.headers?H.mix(G.headers,{"X-Requested-With":yt}):G.headers={"X-Requested-With":yt};if("post"==x){var K,oe=C.httpFormFields;if(oe)try{K=new FormData,H.each(oe,function(ue,ye){ue instanceof Blob?K.append(ye,ue,ue.name):K.append(ye,ue)}),H.mix(G,{data:K,processData:yt,contentType:yt})}catch(ue){}}U=function(ue,ye,Ie){var Ue,He;ue&&H.isArray(ue)&&ue.length>2?(Ue=ue[1],He=ue[2]):(Ue=ye,He=Ie),2!=He.state&&3!=He.state||0!=He.status?cB(C,yt,Ue,He.status):"abort"===He.statusText?cB(C,Nt):Rle(C),H.isFunction(R)&&R()},G.url=S,G.async=T,G.onError=U,G.onComplete=function(){C._cancelableObj=null};var ae=du(G);if(!T)return X;me.progressContext&&(me.progressContext._onPercent=P,C.IfShowCancelDialogWhenImageTransfer&&me.progressContext.on("cancel",function(){ae.abort()}))},combineUrl:function(C,x,S){var T=[],D=x;return void 0===D||void 0===S?void 0:(H.isString(D)||(D=String(x)),0==D.indexOf("http://")?(D=D.replace("http://",""),T.push("http://")):0==D.indexOf("https://")?(D=D.replace("https://",""),T.push("https://")):(0==D.indexOf("//")&&(D=D.replace("//","")),T.push(C.IfSSL?"https://":"http://")),T.push(D),D.indexOf(":")<0&&(C.HTTPPort||(C.HTTPPort=me.detect.ssl?443:80),(!me.detect.ssl&&80!=C.HTTPPort||me.detect.ssl&&443!=C.HTTPPort)&&(T.push(":"),T.push(C.HTTPPort))),0!==S.indexOf("/")&&T.push("/"),T.push(S),T.join(""))},httpPutImage:function(C,x,S,T,D,R,P){var O=Nt,U={method:"PUT",url:x,hasContent:Nt,processData:yt,async:T,data:S,onSuccess:D,onError:function(X,z,K){var oe,ae;O=yt,X&&H.isArray(X)&&X.length>2?(oe=X[1],ae=X[2]):(oe=z,ae=K),2!=ae.state&&3!=ae.state||0!=ae.status?kle(C,yt,oe,ae.status):"abort"===ae.statusText?kle(C,Nt):St(C,-2304,"Http put error: the url is invalid."),H.isFunction(R)&&R()},onComplete:function(){C._cancelableObj=null},beforeSend:function(X){H.isFunction(P)&&X.upload.addEventListener("progress",function(z){!he.bSafari&&z&&(delete z.totalSize,delete z.position),P(z)},yt)}};""!=C.HTTPUserName&&(U.username=C.HTTPUserName,U.password=C.HTTPPassword),T||H.mix(U,{headers:{"X-Requested-With":yt}});var G=du(U);return me.progressContext&&(me.progressContext._onPercent=P,me.progressContext._onCancel=function(){G.abort()}),O},GetImageInfo:function(C,x){var S=C._ImgManager.convertClientIndexToServerId(x);return-1==S?(Mt(C),!1):C._innerFun("GetImageInfo",Et(S))},getBlobTypeByImageType:i9,callbacks:[],pushCallback:function(C,x,S){zn.callbacks.push({method:C,callback:x,ticks:S})},refreshUIRef:0,isServerInvalid:function(C){Ql.isServerInvalid(C)},replaceLocalFilename:function(C){var x;return void 0===C?"":(x=(C=String(C)).replace(/\\/g,"\\\\"),he.bFileSystem&&(x=decodeURI(x)),x)},getImageType:function(C){if(void 0===C||C.length<4)return-1;var x=C.lastIndexOf(".");if(-1===x)return-1;var S=C.slice(x).toLowerCase();return".bmp"===S||".dib"===S?be.DWT.EnumDWT_ImageType.IT_BMP:".jpg"===S||".jpe"===S||".jpeg"===S||".jfif"===S?be.DWT.EnumDWT_ImageType.IT_JPG:".tif"===S||".tiff"===S?be.DWT.EnumDWT_ImageType.IT_TIF:".png"===S?be.DWT.EnumDWT_ImageType.IT_PNG:".pdf"===S?be.DWT.EnumDWT_ImageType.IT_PDF:".jp2"===S||".j2k"===S||".j2c"===S?be.DWT.EnumDWT_ImageType.IT_J2K:-1},makeParams:Et,showMask:Wo,hideMask:Xr};function cP(C,x,S,T,D){var R=0;return C==Mi.TWAIN&&(R=aC),C==Mi.TWAIN64?R=tn.TWAINX64SCANNER:C==Mi.ICA?S?R=tn.SANESCANNER:T?R=tn.ICASCANNER:(x||D)&&(R=aC):C==Mi.TWAIN_AND_TWAIN64&&(S?R=aC|tn.SANESCANNER:T?R=aC|tn.ICASCANNER:x?R=aC|tn.TWAINX64SCANNER:D&&(R=aC)),R}function uP(C,x){for(var S=C.HowManyImagesInBuffer,T=0;T<S;T++)x.push(C._ImgManager.convertClientIndexToServerId(T))}function p9(C,x){return 0!=C._ImgManager.count()||(ta(C),H.isFunction(x)&&x(C._errorCode,C._getErrorString()),!1)}function Rm(C,x,S){return!(!p9(C,S)||(isNaN(x)||!H.isNumber(x)||x<0||x>=C._ImgManager.count())&&(Mt(C),H.isFunction(S)&&S(C._errorCode,C._getErrorString()),1))}function cC(C){var x,S,T,D=[];return C._ImgManager.count()<=0||((S=C._ImgManager.getCurrentImageIndex())>=0&&(x=C._ImgManager.convertClientIndexToServerId(S)),T=C._ImgManager.getSelectedClientIndexArray(),H.isArray(T)&&H.each(T,function(R){var P=C._ImgManager.convertClientIndexToServerId(R);-1!=P&&D.push(P)}),-1!=x&&0==D.length&&D.push(x)),D}function Fue(C){var x,S=[];return C._ImgManager.count()<=0||(x=C._ImgManager.getCurrentImageIndex(),S=C._ImgManager.getSelectedClientIndexArray(),-1!=x&&0==S.length&&S.push(x)),S}function na(C,x,S){return C._resetErr(),!!C._isValid()&&(isNaN(x)?(Jn(C),H.isFunction(S)&&S(C._errorCode,C.ErrorString),yt):x<0||x>=C._ImgManager.count()?(Mt(C),H.isFunction(S)&&S(C._errorCode,C.ErrorString),yt):Nt)}function MHe(C){var x,S=[],T=C.HowManyImagesInBuffer;for(x=0;x<T;x++)S.push(x);return C._imageBufferWrapper.convertIndicesToServerIds(S)}function km(C,x){return C._imageBufferWrapper.convertIndicesToServerIds(x)}function ws(C,x,S,T,D){try{C(x,S,T,D)}catch(R){}x=S=T=D=null}function on(C,x,S){try{C(x._errorCode,x._getErrorString(),S)}catch(T){}x=S=null}function ma(C,x,S,T,D,R){try{C(x._errorCode,x._getErrorString(),S,T,D,R)}catch(P){}x=S=T=D=R=null}function va(){return va="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(C,x,S){var T=function(R,P){for(;!Object.prototype.hasOwnProperty.call(R,P)&&null!==(R=qn(R)););return R}(C,x);if(T){var D=Object.getOwnPropertyDescriptor(T,x);return D.get?D.get.call(arguments.length<3?C:S):D.value}},va.apply(this,arguments)}function Lue(C,x){(null==x||x>C.length)&&(x=C.length);for(var S=0,T=new Array(x);S<x;S++)T[S]=C[S];return T}function g9(C,x){return function(S){if(Array.isArray(S))return S}(C)||function(S,T){var D=null==S?null:"undefined"!=typeof Symbol&&S[Symbol.iterator]||S["@@iterator"];if(null!=D){var R,P,O,U,G=[],X=!0,z=!1;try{if(O=(D=D.call(S)).next,0===T){if(Object(D)!==D)return;X=!1}else for(;!(X=(R=O.call(D)).done)&&(G.push(R.value),G.length!==T);X=!0);}catch(K){z=!0,P=K}finally{try{if(!X&&null!=D.return&&(U=D.return(),Object(U)!==U))return}finally{if(z)throw P}}return G}}(C,x)||function(S,T){if(S){if("string"==typeof S)return Lue(S,T);var D=Object.prototype.toString.call(S).slice(8,-1);return"Object"===D&&S.constructor&&(D=S.constructor.name),"Map"===D||"Set"===D?Array.from(S):"Arguments"===D||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D)?Lue(S,T):void 0}}(C,x)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}me.html5.Funs=zn;var dP=v(function C(){n(this,C),An(this,"bIsDirty",!1),An(this,"imageWidth",0),An(this,"imageHeight",0),An(this,"iImageControlWidth",0),An(this,"iImageControlHeight",0),An(this,"imageUrl",""),An(this,"minImageUrl",""),An(this,"uuid",-1),An(this,"serverId",-1),An(this,"uidFromServer",""),An(this,"aryOverlayRectangleData",[]),An(this,"ticks",Date.now())},[{key:"Clear",value:function(){this.imageUrl="",this.minImageUrl="",this.serverId=-1,this.uuid=-1,this.uidFromServer="",this.aryOverlayRectangleData=[]}}]),OHe=Pn,m9=b1,FHe=kae,Nue=Mse,LHe=$l,Bue=Cs,NHe=_m,Wue=xr,v9=Ta("Reflect","construct"),BHe=Object.prototype,WHe=[].push,Uue=Wue(function(){function C(){}return!(v9(function(){},[],C)instanceof C)}),Vue=!Wue(function(){v9(function(){})}),jue=Uue||Vue;OHe({target:"Reflect",stat:!0,forced:jue,sham:jue},{construct:function(C,x){Nue(C),LHe(x);var S=arguments.length<3?C:Nue(arguments[2]);if(Vue&&!Uue)return v9(C,x,S);if(C===S){switch(x.length){case 0:return new C;case 1:return new C(x[0]);case 2:return new C(x[0],x[1]);case 3:return new C(x[0],x[1],x[2]);case 4:return new C(x[0],x[1],x[2],x[3])}var T=[null];return m9(WHe,T,x),new(m9(FHe,C,T))}var D=S.prototype,R=NHe(Bue(D)?D:BHe),P=m9(C,R,x);return Bue(P)?P:R}});var hP=_(Co.Reflect.construct),Hue=_(Co.Object.getOwnPropertySymbols),Gue={exports:{}},jHe=ch,zue=Bp.f,Yue=ts;Pn({target:"Object",stat:!0,forced:!Yue||xr(function(){zue(1)}),sham:!Yue},{getOwnPropertyDescriptor:function(C,x){return zue(jHe(C),x)}});var Xue=Co.Object,HHe=Gue.exports=function(C,x){return Xue.getOwnPropertyDescriptor(C,x)};Xue.getOwnPropertyDescriptor.sham&&(HHe.sham=!0);var $ue=Gue.exports,que=_($ue),GHe=yse,zHe=ch,YHe=Bp,XHe=Zw;Pn({target:"Object",stat:!0,sham:!ts},{getOwnPropertyDescriptors:function(C){for(var x,S,T=zHe(C),D=YHe.f,R=GHe(T),P={},O=0;R.length>O;)void 0!==(S=D(T,x=R[O++]))&&XHe(P,x,S);return P}});var Kue=_(Co.Object.getOwnPropertyDescriptors),Jue={exports:{}},Que=ZD.f;Pn({target:"Object",stat:!0,forced:Object.defineProperties!==Que,sham:!ts},{defineProperties:Que});var Zue=Co.Object,KHe=Jue.exports=function(C,x){return Zue.defineProperties(C,x)};Zue.defineProperties.sham&&(KHe.sham=!0);var JHe=_(Jue.exports),QHe=Iae,ZHe=b1,eGe=Up,tGe=yf,nGe=lu,iGe=V1;Pn({target:"Promise",stat:!0,forced:!0},{try:function(C){var x=eGe(arguments,1),S=tGe.f(this),T=iGe(function(){return ZHe(nGe(C),void 0,x)});return(T.error?S.reject:S.resolve)(T.value),S.promise}});var ede=QHe,tde=_(ede);function nde(C,x,S,T,D,R,P){try{var O=C[R](P),U=O.value}catch(G){return void S(G)}O.done?x(U):tde.resolve(U).then(T,D)}function ide(C){return function(){var x=this,S=arguments;return new tde(function(T,D){var R=C.apply(x,S);function P(U){nde(R,T,D,P,O,"next",U)}function O(U){nde(R,T,D,P,O,"throw",U)}P(void 0)})}}function Uo(C){if(void 0===C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}var rde=Ms,rGe=Rs,oGe=Cs,sGe=$l,aGe=function(C){return void 0!==C&&(rde(C,"value")||rde(C,"writable"))},lGe=Bp,cGe=O1;Pn({target:"Reflect",stat:!0},{get:function C(x,S){var T,D,R=arguments.length<3?x:arguments[2];return sGe(x)===R?x[S]:(T=lGe.f(x,S))?aGe(T)?T.value:void 0===T.get?void 0:rGe(T.get,R):oGe(D=cGe(x))?C(D,S,R):void 0}});var ode=_(Co.Reflect.get),y9=_(Oae),uGe=_($ue);Pn({target:"Object",stat:!0},{setPrototypeOf:woe});var sde=Co.Object.setPrototypeOf,_9=_(sde),dGe=pf,ade=O1,hGe=voe;Pn({target:"Object",stat:!0,forced:xr(function(){ade(1)}),sham:!hGe},{getPrototypeOf:function(C){return ade(dGe(C))}});var lde=Co.Object.getPrototypeOf,cde=_(lde);function uC(C){var x;return(uC=_9?y9(x=cde).call(x):function(S){return S.__proto__||cde(S)})(C)}function fP(){var C;return fP="undefined"!=typeof Reflect&&ode?y9(C=ode).call(C):function(x,S,T){var D=function(P,O){for(;!Object.prototype.hasOwnProperty.call(P,O)&&null!==(P=uC(P)););return P}(x,S);if(D){var R=uGe(D,S);return R.get?R.get.call(arguments.length<3?x:T):R.value}},fP.apply(this,arguments)}Pn({target:"Object",stat:!0,sham:!ts},{create:_m});var fGe=Co.Object,ude=function(C,x){return fGe.create(C,x)},pGe=_(ude);function C9(C,x){var S;return(C9=_9?y9(S=_9).call(S):function(T,D){return T.__proto__=D,T})(C,x)}function pP(C,x){if("function"!=typeof x&&null!==x)throw new TypeError("Super expression must either be null or a function");C.prototype=pGe(x&&x.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),KD(C,"prototype",{writable:!1}),x&&C9(C,x)}var dde=_(use),hde=_(gS),fde=ise,gGe=_(fde),mGe=$l,vGe=_A,yGe=Wp,_Ge=Rs,CGe=pf,bGe=function(C,x,S,T){try{return T?x(mGe(S)[0],S[1]):x(S)}catch(D){vGe(C,"throw",D)}},xGe=wse,wGe=QD,SGe=p0,pde=Zw,TGe=NN,IGe=gS,gde=Array,mde=function(C){var x=CGe(C),S=wGe(this),T=arguments.length,D=T>1?arguments[1]:void 0,R=void 0!==D;R&&(D=yGe(D,T>2?arguments[2]:void 0));var P,O,U,G,X,z,K=IGe(x),oe=0;if(!K||this===gde&&xGe(K))for(P=SGe(x),O=S?new this(P):gde(P);P>oe;oe++)z=R?D(x[oe],oe):x[oe],pde(O,oe,z);else for(O=S?new this:[],X=(G=TGe(x,K)).next;!(U=_Ge(X,G)).done;oe++)z=R?bGe(G,D,[U.value,oe],!0):U.value,pde(O,oe,z);return O.length=oe,O},EGe=mde;Pn({target:"Array",stat:!0,forced:!xae(function(C){Array.from(C)})},{from:EGe});var vde=Co.Array.from,yde=_(vde);function b9(C,x){(null==x||x>C.length)&&(x=C.length);for(var S=0,T=new Array(x);S<x;S++)T[S]=C[S];return T}function _de(C,x){var S;if(C){if("string"==typeof C)return b9(C,x);var T=gGe(S=Object.prototype.toString.call(C)).call(S,8,-1);return"Object"===T&&C.constructor&&(T=C.constructor.name),"Map"===T||"Set"===T?yde(C):"Arguments"===T||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T)?b9(C,x):void 0}}function dC(C,x){return function(S){if(dde(S))return S}(C)||function(S,T){var D=null==S?null:void 0!==F1&&hde(S)||S["@@iterator"];if(null!=D){var R,P,O,U,G=[],X=!0,z=!1;try{if(O=(D=D.call(S)).next,0===T){if(Object(D)!==D)return;X=!1}else for(;!(X=(R=O.call(D)).done)&&(G.push(R.value),G.length!==T);X=!0);}catch(K){z=!0,P=K}finally{try{if(!X&&null!=D.return&&(U=D.return(),Object(U)!==U))return}finally{if(z)throw P}}return G}}(C,x)||_de(C,x)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zS(C){return function(x){if(dde(x))return b9(x)}(C)||function(x){if(void 0!==F1&&null!=hde(x)||null!=x["@@iterator"])return yde(x)}(C)||_de(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rn(C,x,S){return(x=qoe(x))in C?KD(C,x,{value:S,enumerable:!0,configurable:!0,writable:!0}):C[x]=S,C}var Cde={exports:{}},bde={exports:{}};!function(C){var x=wN,S=$oe;function T(D){return C.exports=T="function"==typeof x&&"symbol"==typeof S?function(R){return typeof R}:function(R){return R&&"function"==typeof x&&R.constructor===x&&R!==x.prototype?"symbol":typeof R},C.exports.__esModule=!0,C.exports.default=C.exports,T(D)}C.exports=T,C.exports.__esModule=!0,C.exports.default=C.exports}(bde);var DGe=bde.exports,AGe=m0.forEach,xde=Zoe("forEach")?[].forEach:function(C){return AGe(this,C,arguments.length>1?arguments[1]:void 0)};Pn({target:"Array",proto:!0,forced:[].forEach!==xde},{forEach:xde});var PGe=Ka("Array","forEach"),RGe=g0,kGe=Ms,MGe=ks,OGe=PGe,x9=Array.prototype,FGe={DOMTokenList:!0,NodeList:!0},wde=function(C){var x=C.forEach;return C===x9||MGe(x9,C)&&x===x9.forEach||kGe(FGe,RGe(C))?OGe:x},LGe=wde,NGe=Pn,BGe=f0,WGe=kr([].reverse),Sde=[1,2];NGe({target:"Array",proto:!0,forced:String(Sde)===String(Sde.reverse())},{reverse:function(){return BGe(this)&&(this.length=this.length),WGe(this)}});var UGe=Ka("Array","reverse"),VGe=ks,jGe=UGe,w9=Array.prototype,HGe=function(C){var x=C.reverse;return C===w9||VGe(w9,C)&&x===w9.reverse?jGe:x};!function(C){var x=DGe.default,S=ere,T=wN,D=ude,R=lde,P=LGe,O=sde,U=ede,G=HGe,X=fde;function z(){C.exports=z=function(){return K},C.exports.__esModule=!0,C.exports.default=C.exports;var K={},oe=Object.prototype,ae=oe.hasOwnProperty,ue=S||function(xt,Pt,It){xt[Pt]=It.value},ye="function"==typeof T?T:{},Ie=ye.iterator||"@@iterator",Ue=ye.asyncIterator||"@@asyncIterator",He=ye.toStringTag||"@@toStringTag";function Re(xt,Pt,It){return S(xt,Pt,{value:It,enumerable:!0,configurable:!0,writable:!0}),xt[Pt]}try{Re({},"")}catch(xt){Re=function(Pt,It,Wt){return Pt[It]=Wt}}function Oe(xt,Pt,It,Wt){var Cn=D((Pt&&Pt.prototype instanceof de?Pt:de).prototype),hn=new Vt(Wt||[]);return ue(Cn,"_invoke",{value:$e(xt,It,hn)}),Cn}function Ge(xt,Pt,It){try{return{type:"normal",arg:xt.call(Pt,It)}}catch(Wt){return{type:"throw",arg:Wt}}}K.wrap=Oe;var Se={};function de(){}function ge(){}function _e(){}var ve={};Re(ve,Ie,function(){return this});var Te=R&&R(R(In([])));Te&&Te!==oe&&ae.call(Te,Ie)&&(ve=Te);var We=_e.prototype=de.prototype=D(ve);function Ye(xt){var Pt;P(Pt=["next","throw","return"]).call(Pt,function(It){Re(xt,It,function(Wt){return this._invoke(It,Wt)})})}function Be(xt,Pt){function It(en,Cn,hn,Dr){var Hn=Ge(xt[en],xt,Cn);if("throw"!==Hn.type){var di=Hn.arg,Gt=di.value;return Gt&&"object"==x(Gt)&&ae.call(Gt,"__await")?Pt.resolve(Gt.__await).then(function(Ss){It("next",Ss,hn,Dr)},function(Ss){It("throw",Ss,hn,Dr)}):Pt.resolve(Gt).then(function(Ss){di.value=Ss,hn(di)},function(Ss){return It("throw",Ss,hn,Dr)})}Dr(Hn.arg)}var Wt;ue(this,"_invoke",{value:function(en,Cn){function hn(){return new Pt(function(Dr,Hn){It(en,Cn,Dr,Hn)})}return Wt=Wt?Wt.then(hn,hn):hn()}})}function $e(xt,Pt,It){var Wt="suspendedStart";return function(en,Cn){if("executing"===Wt)throw new Error("Generator is already running");if("completed"===Wt){if("throw"===en)throw Cn;return{value:void 0,done:!0}}for(It.method=en,It.arg=Cn;;){var hn=It.delegate;if(hn){var Dr=ze(hn,It);if(Dr){if(Dr===Se)continue;return Dr}}if("next"===It.method)It.sent=It._sent=It.arg;else if("throw"===It.method){if("suspendedStart"===Wt)throw Wt="completed",It.arg;It.dispatchException(It.arg)}else"return"===It.method&&It.abrupt("return",It.arg);Wt="executing";var Hn=Ge(xt,Pt,It);if("normal"===Hn.type){if(Wt=It.done?"completed":"suspendedYield",Hn.arg===Se)continue;return{value:Hn.arg,done:It.done}}"throw"===Hn.type&&(Wt="completed",It.method="throw",It.arg=Hn.arg)}}}function ze(xt,Pt){var It=Pt.method,Wt=xt.iterator[It];if(void 0===Wt)return Pt.delegate=null,"throw"===It&&xt.iterator.return&&(Pt.method="return",Pt.arg=void 0,ze(xt,Pt),"throw"===Pt.method)||"return"!==It&&(Pt.method="throw",Pt.arg=new TypeError("The iterator does not provide a '"+It+"' method")),Se;var en=Ge(Wt,xt.iterator,Pt.arg);if("throw"===en.type)return Pt.method="throw",Pt.arg=en.arg,Pt.delegate=null,Se;var Cn=en.arg;return Cn?Cn.done?(Pt[xt.resultName]=Cn.value,Pt.next=xt.nextLoc,"return"!==Pt.method&&(Pt.method="next",Pt.arg=void 0),Pt.delegate=null,Se):Cn:(Pt.method="throw",Pt.arg=new TypeError("iterator result is not an object"),Pt.delegate=null,Se)}function Ct(xt){var Pt={tryLoc:xt[0]};1 in xt&&(Pt.catchLoc=xt[1]),2 in xt&&(Pt.finallyLoc=xt[2],Pt.afterLoc=xt[3]),this.tryEntries.push(Pt)}function bt(xt){var Pt=xt.completion||{};Pt.type="normal",delete Pt.arg,xt.completion=Pt}function Vt(xt){this.tryEntries=[{tryLoc:"root"}],P(xt).call(xt,Ct,this),this.reset(!0)}function In(xt){if(xt){var Pt=xt[Ie];if(Pt)return Pt.call(xt);if("function"==typeof xt.next)return xt;if(!isNaN(xt.length)){var It=-1,Wt=function en(){for(;++It<xt.length;)if(ae.call(xt,It))return en.value=xt[It],en.done=!1,en;return en.value=void 0,en.done=!0,en};return Wt.next=Wt}}return{next:yn}}function yn(){return{value:void 0,done:!0}}return ge.prototype=_e,ue(We,"constructor",{value:_e,configurable:!0}),ue(_e,"constructor",{value:ge,configurable:!0}),ge.displayName=Re(_e,He,"GeneratorFunction"),K.isGeneratorFunction=function(xt){var Pt="function"==typeof xt&&xt.constructor;return!!Pt&&(Pt===ge||"GeneratorFunction"===(Pt.displayName||Pt.name))},K.mark=function(xt){return O?O(xt,_e):(xt.__proto__=_e,Re(xt,He,"GeneratorFunction")),xt.prototype=D(We),xt},K.awrap=function(xt){return{__await:xt}},Ye(Be.prototype),Re(Be.prototype,Ue,function(){return this}),K.AsyncIterator=Be,K.async=function(xt,Pt,It,Wt,en){void 0===en&&(en=U);var Cn=new Be(Oe(xt,Pt,It,Wt),en);return K.isGeneratorFunction(Pt)?Cn:Cn.next().then(function(hn){return hn.done?hn.value:Cn.next()})},Ye(We),Re(We,He,"Generator"),Re(We,Ie,function(){return this}),Re(We,"toString",function(){return"[object Generator]"}),K.keys=function(xt){var Pt=Object(xt),It=[];for(var Wt in Pt)It.push(Wt);return G(It).call(It),function en(){for(;It.length;){var Cn=It.pop();if(Cn in Pt)return en.value=Cn,en.done=!1,en}return en.done=!0,en}},K.values=In,Vt.prototype={constructor:Vt,reset:function(xt){var Pt;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,P(Pt=this.tryEntries).call(Pt,bt),!xt)for(var It in this)"t"===It.charAt(0)&&ae.call(this,It)&&!isNaN(+X(It).call(It,1))&&(this[It]=void 0)},stop:function(){this.done=!0;var xt=this.tryEntries[0].completion;if("throw"===xt.type)throw xt.arg;return this.rval},dispatchException:function(xt){if(this.done)throw xt;var Pt=this;function It(Hn,di){return Cn.type="throw",Cn.arg=xt,Pt.next=Hn,di&&(Pt.method="next",Pt.arg=void 0),!!di}for(var Wt=this.tryEntries.length-1;Wt>=0;--Wt){var en=this.tryEntries[Wt],Cn=en.completion;if("root"===en.tryLoc)return It("end");if(en.tryLoc<=this.prev){var hn=ae.call(en,"catchLoc"),Dr=ae.call(en,"finallyLoc");if(hn&&Dr){if(this.prev<en.catchLoc)return It(en.catchLoc,!0);if(this.prev<en.finallyLoc)return It(en.finallyLoc)}else if(hn){if(this.prev<en.catchLoc)return It(en.catchLoc,!0)}else{if(!Dr)throw new Error("try statement without catch or finally");if(this.prev<en.finallyLoc)return It(en.finallyLoc)}}}},abrupt:function(xt,Pt){for(var It=this.tryEntries.length-1;It>=0;--It){var Wt=this.tryEntries[It];if(Wt.tryLoc<=this.prev&&ae.call(Wt,"finallyLoc")&&this.prev<Wt.finallyLoc){var en=Wt;break}}en&&("break"===xt||"continue"===xt)&&en.tryLoc<=Pt&&Pt<=en.finallyLoc&&(en=null);var Cn=en?en.completion:{};return Cn.type=xt,Cn.arg=Pt,en?(this.method="next",this.next=en.finallyLoc,Se):this.complete(Cn)},complete:function(xt,Pt){if("throw"===xt.type)throw xt.arg;return"break"===xt.type||"continue"===xt.type?this.next=xt.arg:"return"===xt.type?(this.rval=this.arg=xt.arg,this.method="return",this.next="end"):"normal"===xt.type&&Pt&&(this.next=Pt),Se},finish:function(xt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var It=this.tryEntries[Pt];if(It.finallyLoc===xt)return this.complete(It.completion,It.afterLoc),bt(It),Se}},catch:function(xt){for(var Pt=this.tryEntries.length-1;Pt>=0;--Pt){var It=this.tryEntries[Pt];if(It.tryLoc===xt){var Wt=It.completion;if("throw"===Wt.type){var en=Wt.arg;bt(It)}return en}}throw new Error("illegal catch attempt")},delegateYield:function(xt,Pt,It){return this.delegate={iterator:In(xt),resultName:Pt,nextLoc:It},"next"===this.method&&(this.arg=void 0),Se}},K}C.exports=z,C.exports.__esModule=!0,C.exports.default=C.exports}(Cde);var gP=(0,Cde.exports)(),GGe=gP;try{regeneratorRuntime=gP}catch(C){"object"==typeof id?id.regeneratorRuntime=gP:Function("r","regeneratorRuntime = r")(gP)}var mP=_(GGe),vi=_(wde),zGe=pf,Tde=iS;Pn({target:"Object",stat:!0,forced:xr(function(){Tde(1)})},{keys:function(C){return Tde(zGe(C))}});var Ide=_(Co.Object.keys);Pn({target:"Number",stat:!0},{isNaN:function(C){return C!=C}});var hC=_(Co.Number.isNaN),YGe=Ka("Array","concat"),XGe=ks,$Ge=YGe,S9=Array.prototype,Mm=_(function(C){var x=C.concat;return C===S9||XGe(S9,C)&&x===S9.concat?$Ge:x}),qGe=xr,JGe=bo("iterator"),T9=!qGe(function(){var C=new URL("b?a=1&b=2&c=3","http://a"),x=C.searchParams,S=new URLSearchParams("a=1&a=2&b=3"),T="";return C.pathname="c%20d",x.forEach(function(D,R){x.delete("b"),T+=R+D}),S.delete("a",2),S.delete("b",void 0),!C.toJSON||!S.has("a",1)||S.has("a",2)||!S.has("a",void 0)||S.has("b")||!x.size&&!0||!x.sort||"http://a/c%20d?a=1&c=3"!==C.href||"3"!==x.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!x[JGe]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==T||"x"!==new URL("http://x",void 0).host}),QGe=Cm,Ede=function(C,x,S){for(var T in x)S&&S.unsafe&&C[T]?C[T]=x[T]:QGe(C,T,x[T],S);return C},Dde=Up,ZGe=Math.floor,I9=function(C,x){var S=C.length;if(S<8)for(var T,D,R=1;R<S;){for(D=R,T=C[R];D&&x(C[D-1],T)>0;)C[D]=C[--D];D!==R++&&(C[D]=T)}else for(var P=ZGe(S/2),O=I9(Dde(C,0,P),x),U=I9(Dde(C,P),x),G=O.length,X=U.length,z=0,K=0;z<G||K<X;)C[z+K]=z<G&&K<X?x(O[z],U[K])<=0?O[z++]:U[K++]:z<G?O[z++]:U[K++];return C},E9=Pn,vP=Yr,D9=Xse,yP=Rs,Ef=kr,YS=ts,Ade=T9,Pde=Cm,eze=sS,tze=Ede,nze=gf,ize=xoe,A9=vf,Rde=vS,P9=_s,rze=Ms,oze=Wp,sze=g0,aze=$l,kde=Cs,Zl=bl,lze=_m,Mde=mm,Ode=NN,cze=gS,_P=pA,fC=L1,uze=I9,dze=bo("iterator"),pC="URLSearchParams",Fde=pC+"Iterator",Lde=A9.set,pd=A9.getterFor(pC),hze=A9.getterFor(Fde),Nde=D9("fetch"),CP=D9("Request"),XS=D9("Headers"),R9=CP&&CP.prototype,Bde=XS&&XS.prototype,fze=vP.RegExp,pze=vP.TypeError,Wde=vP.decodeURIComponent,gze=vP.encodeURIComponent,mze=Ef("".charAt),Ude=Ef([].join),O0=Ef([].push),k9=Ef("".replace),vze=Ef([].shift),Vde=Ef([].splice),jde=Ef("".split),yze=Ef("".slice),_ze=/\+/g,Hde=Array(4),Cze=function(C){return Hde[C-1]||(Hde[C-1]=fze("((?:%[\\da-f]{2}){"+C+"})","gi"))},bze=function(C){try{return Wde(C)}catch(x){return C}},Gde=function(C){var x=k9(C,_ze," "),S=4;try{return Wde(x)}catch(T){for(;S;)x=k9(x,Cze(S--),bze);return x}},xze=/[!'()~]|%20/g,wze={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Sze=function(C){return wze[C]},zde=function(C){return k9(gze(C),xze,Sze)},M9=ize(function(C,x){Lde(this,{type:Fde,target:pd(C).entries,index:0,kind:x})},pC,function(){var C=hze(this),x=C.target,S=C.index++;if(!x||S>=x.length)return C.target=void 0,_P(void 0,!0);var T=x[S];switch(C.kind){case"keys":return _P(T.key,!1);case"values":return _P(T.value,!1)}return _P([T.key,T.value],!1)},!0),Yde=function(C){this.entries=[],this.url=null,void 0!==C&&(kde(C)?this.parseObject(C):this.parseQuery("string"==typeof C?"?"===mze(C,0)?yze(C,1):C:Zl(C)))};Yde.prototype={type:pC,bindURL:function(C){this.url=C,this.update()},parseObject:function(C){var x,S,T,D,R,P,O,U=this.entries,G=cze(C);if(G)for(S=(x=Ode(C,G)).next;!(T=yP(S,x)).done;){if(R=(D=Ode(aze(T.value))).next,(P=yP(R,D)).done||(O=yP(R,D)).done||!yP(R,D).done)throw new pze("Expected sequence with length 2");O0(U,{key:Zl(P.value),value:Zl(O.value)})}else for(var X in C)rze(C,X)&&O0(U,{key:X,value:Zl(C[X])})},parseQuery:function(C){if(C)for(var x,S,T=this.entries,D=jde(C,"&"),R=0;R<D.length;)(x=D[R++]).length&&(S=jde(x,"="),O0(T,{key:Gde(vze(S)),value:Gde(Ude(S,"="))}))},serialize:function(){for(var C,x=this.entries,S=[],T=0;T<x.length;)C=x[T++],O0(S,zde(C.key)+"="+zde(C.value));return Ude(S,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var bP=function(){Rde(this,gC);var C=arguments.length>0?arguments[0]:void 0,x=Lde(this,new Yde(C));YS||(this.size=x.entries.length)},gC=bP.prototype;if(tze(gC,{append:function(C,x){var S=pd(this);fC(arguments.length,2),O0(S.entries,{key:Zl(C),value:Zl(x)}),YS||this.length++,S.updateURL()},delete:function(C){for(var x=pd(this),S=fC(arguments.length,1),T=x.entries,D=Zl(C),R=S<2?void 0:arguments[1],P=void 0===R?R:Zl(R),O=0;O<T.length;){var U=T[O];if(U.key!==D||void 0!==P&&U.value!==P)O++;else if(Vde(T,O,1),void 0!==P)break}YS||(this.size=T.length),x.updateURL()},get:function(C){var x=pd(this).entries;fC(arguments.length,1);for(var S=Zl(C),T=0;T<x.length;T++)if(x[T].key===S)return x[T].value;return null},getAll:function(C){var x=pd(this).entries;fC(arguments.length,1);for(var S=Zl(C),T=[],D=0;D<x.length;D++)x[D].key===S&&O0(T,x[D].value);return T},has:function(C){for(var x=pd(this).entries,S=fC(arguments.length,1),T=Zl(C),D=S<2?void 0:arguments[1],R=void 0===D?D:Zl(D),P=0;P<x.length;){var O=x[P++];if(O.key===T&&(void 0===R||O.value===R))return!0}return!1},set:function(C,x){var S=pd(this);fC(arguments.length,1);for(var T,D=S.entries,R=!1,P=Zl(C),O=Zl(x),U=0;U<D.length;U++)(T=D[U]).key===P&&(R?Vde(D,U--,1):(R=!0,T.value=O));R||O0(D,{key:P,value:O}),YS||(this.size=D.length),S.updateURL()},sort:function(){var C=pd(this);uze(C.entries,function(x,S){return x.key>S.key?1:-1}),C.updateURL()},forEach:function(C){for(var x,S=pd(this).entries,T=oze(C,arguments.length>1?arguments[1]:void 0),D=0;D<S.length;)T((x=S[D++]).value,x.key,this)},keys:function(){return new M9(this,"keys")},values:function(){return new M9(this,"values")},entries:function(){return new M9(this,"entries")}},{enumerable:!0}),Pde(gC,dze,gC.entries,{name:"entries"}),Pde(gC,"toString",function(){return pd(this).serialize()},{enumerable:!0}),YS&&eze(gC,"size",{get:function(){return pd(this).entries.length},configurable:!0,enumerable:!0}),nze(bP,pC),E9({global:!0,constructor:!0,forced:!Ade},{URLSearchParams:bP}),!Ade&&P9(XS)){var Tze=Ef(Bde.has),Ize=Ef(Bde.set),Xde=function(C){if(kde(C)){var x,S=C.body;if(sze(S)===pC)return x=C.headers?new XS(C.headers):new XS,Tze(x,"content-type")||Ize(x,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lze(C,{body:Mde(0,Zl(S)),headers:Mde(0,x)})}return C};if(P9(Nde)&&E9({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(C){return Nde(C,arguments.length>1?Xde(arguments[1]):{})}}),P9(CP)){var O9=function(C){return Rde(this,R9),new CP(C,arguments.length>1?Xde(arguments[1]):{})};R9.constructor=O9,O9.prototype=R9,E9({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:O9})}}var gd,Eze={URLSearchParams:bP,getState:pd},$de=ts,Aze=Rs,Pze=xr,F9=iS,Rze=oS,kze=Xw,Mze=pf,Oze=S8,mC=Object.assign,qde=Object.defineProperty,Fze=kr([].concat),Lze=!mC||Pze(function(){if($de&&1!==mC({b:1},mC(qde({},"a",{enumerable:!0,get:function(){qde(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var C={},x={},S=Symbol("assign detection"),T="abcdefghijklmnopqrst";return C[S]=7,T.split("").forEach(function(D){x[D]=D}),7!==mC({},C)[S]||F9(mC({},x)).join("")!==T})?function(C,x){for(var S=Mze(C),T=arguments.length,D=1,R=Rze.f,P=kze.f;T>D;)for(var O,U=Oze(arguments[D++]),G=R?Fze(F9(U),R(U)):F9(U),X=G.length,z=0;X>z;)O=G[z++],$de&&!Aze(P,U,O)||(S[O]=U[O]);return S}:mC,F0=kr,L9=2147483647,Nze=/[^\0-\u007E]/,Kde=/[.\u3002\uFF0E\uFF61]/g,Jde="Overflow: input needs wider integers to process",Qde=RangeError,Bze=F0(Kde.exec),vC=Math.floor,N9=String.fromCharCode,Zde=F0("".charCodeAt),ehe=F0([].join),Om=F0([].push),Wze=F0("".replace),Uze=F0("".split),Vze=F0("".toLowerCase),the=function(C){return C+22+75*(C<26)},jze=function(C,x,S){var T=0;for(C=S?vC(C/700):C>>1,C+=vC(C/x);C>455;)C=vC(C/35),T+=36;return vC(T+36*C/(C+38))},Hze=function(C){var S,T,x=[],D=(C=function(Ie){for(var Ue=[],He=0,Re=Ie.length;He<Re;){var Oe=Zde(Ie,He++);if(Oe>=55296&&Oe<=56319&&He<Re){var Ge=Zde(Ie,He++);56320==(64512&Ge)?Om(Ue,((1023&Oe)<<10)+(1023&Ge)+65536):(Om(Ue,Oe),He--)}else Om(Ue,Oe)}return Ue}(C)).length,R=128,P=0,O=72;for(S=0;S<C.length;S++)(T=C[S])<128&&Om(x,N9(T));var U=x.length,G=U;for(U&&Om(x,"-");G<D;){var X=L9;for(S=0;S<C.length;S++)(T=C[S])>=R&&T<X&&(X=T);var z=G+1;if(X-R>vC((L9-P)/z))throw new Qde(Jde);for(P+=(X-R)*z,R=X,S=0;S<C.length;S++){if((T=C[S])<R&&++P>L9)throw new Qde(Jde);if(T===R){for(var K=P,oe=36;;){var ae=oe<=O?1:oe>=O+26?26:oe-O;if(K<ae)break;var ue=K-ae,ye=36-ae;Om(x,N9(the(ae+ue%ye))),K=vC(ue/ye),oe+=36}Om(x,N9(the(K))),O=jze(P,z,G===U),P=0,G++}}P++,R++}return ehe(x,"")},Gze=Pn,B9=ts,zze=T9,W9=Yr,nhe=Wp,md=kr,xP=Cm,vd=sS,Yze=vS,U9=Ms,V9=Lze,yC=mde,gh=Up,Xze=Goe.codeAt,Jp=bl,qze=gf,Kze=L1,ihe=Eze,Jze=vf.set,wP=vf.getterFor("URL"),Qze=ihe.URLSearchParams,Zze=ihe.getState,$S=W9.URL,j9=W9.TypeError,SP=W9.parseInt,eYe=Math.floor,ohe=Math.pow,yd=md("".charAt),mh=md(/./.exec),qS=md([].join),tYe=md(1..toString),nYe=md([].pop),_C=md([].push),H9=md("".replace),iYe=md([].shift),rYe=md("".split),KS=md("".slice),TP=md("".toLowerCase),oYe=md([].unshift),G9="Invalid scheme",L0="Invalid host",she="Invalid port",ahe=/[a-z]/i,sYe=/[\d+-.a-z]/i,z9=/\d/,aYe=/^0x/i,lYe=/^[0-7]+$/,cYe=/^\d+$/,lhe=/^[\da-f]+$/i,uYe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,dYe=/[\0\t\n\r #/:<>?@[\\\]^|]/,hYe=/^[\u0000-\u0020]+/,fYe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,pYe=/[\t\n\r]/g,JS=function(C){var x,S,T,D;if("number"==typeof C){for(x=[],S=0;S<4;S++)oYe(x,C%256),C=eYe(C/256);return qS(x,".")}if("object"==typeof C){for(x="",T=function(R){for(var P=null,O=1,U=null,G=0,X=0;X<8;X++)0!==R[X]?(G>O&&(P=U,O=G),U=null,G=0):(null===U&&(U=X),++G);return G>O&&(P=U,O=G),P}(C),S=0;S<8;S++)D&&0===C[S]||(D&&(D=!1),T===S?(x+=S?":":"::",D=!0):(x+=tYe(C[S],16),S<7&&(x+=":")));return"["+x+"]"}return C},IP={},che=V9({},IP,{" ":1,'"':1,"<":1,">":1,"`":1}),uhe=V9({},che,{"#":1,"?":1,"{":1,"}":1}),Y9=V9({},uhe,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Fm=function(C,x){var S=Xze(C,0);return S>32&&S<127&&!U9(x,C)?C:encodeURIComponent(C)},EP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},QS=function(C,x){var S;return 2===C.length&&mh(ahe,yd(C,0))&&(":"===(S=yd(C,1))||!x&&"|"===S)},dhe=function(C){var x;return C.length>1&&QS(KS(C,0,2))&&(2===C.length||"/"===(x=yd(C,2))||"\\"===x||"?"===x||"#"===x)},gYe=function(C){return"."===C||"%2e"===TP(C)},X9={},hhe={},$9={},fhe={},phe={},q9={},ghe={},mhe={},DP={},AP={},K9={},J9={},Q9={},Z9={},vhe={},eW={},CC={},Df={},yhe={},N0={},Qp={},tW=function(C,x,S){var T,D,R,P=Jp(C);if(x){if(D=this.parse(P))throw new j9(D);this.searchParams=null}else{if(void 0!==S&&(T=new tW(S,!0)),D=this.parse(P,null,T))throw new j9(D);(R=Zze(new Qze)).bindURL(this),this.searchParams=R}};tW.prototype={type:"URL",parse:function(C,x,S){var T,D,R,P,O,U=this,G=x||X9,X=0,z="",K=!1,oe=!1,ae=!1;for(C=Jp(C),x||(U.scheme="",U.username="",U.password="",U.host=null,U.port=null,U.path=[],U.query=null,U.fragment=null,U.cannotBeABaseURL=!1,C=H9(C,hYe,""),C=H9(C,fYe,"$1")),C=H9(C,pYe,""),T=yC(C);X<=T.length;){switch(D=T[X],G){case X9:if(!D||!mh(ahe,D)){if(x)return G9;G=$9;continue}z+=TP(D),G=hhe;break;case hhe:if(D&&(mh(sYe,D)||"+"===D||"-"===D||"."===D))z+=TP(D);else{if(":"!==D){if(x)return G9;z="",G=$9,X=0;continue}if(x&&(U.isSpecial()!==U9(EP,z)||"file"===z&&(U.includesCredentials()||null!==U.port)||"file"===U.scheme&&!U.host))return;if(U.scheme=z,x)return void(U.isSpecial()&&EP[U.scheme]===U.port&&(U.port=null));z="","file"===U.scheme?G=Z9:U.isSpecial()&&S&&S.scheme===U.scheme?G=fhe:U.isSpecial()?G=mhe:"/"===T[X+1]?(G=phe,X++):(U.cannotBeABaseURL=!0,_C(U.path,""),G=yhe)}break;case $9:if(!S||S.cannotBeABaseURL&&"#"!==D)return G9;if(S.cannotBeABaseURL&&"#"===D){U.scheme=S.scheme,U.path=gh(S.path),U.query=S.query,U.fragment="",U.cannotBeABaseURL=!0,G=Qp;break}G="file"===S.scheme?Z9:q9;continue;case fhe:if("/"!==D||"/"!==T[X+1]){G=q9;continue}G=DP,X++;break;case phe:if("/"===D){G=AP;break}G=Df;continue;case q9:if(U.scheme=S.scheme,D===gd)U.username=S.username,U.password=S.password,U.host=S.host,U.port=S.port,U.path=gh(S.path),U.query=S.query;else if("/"===D||"\\"===D&&U.isSpecial())G=ghe;else if("?"===D)U.username=S.username,U.password=S.password,U.host=S.host,U.port=S.port,U.path=gh(S.path),U.query="",G=N0;else{if("#"!==D){U.username=S.username,U.password=S.password,U.host=S.host,U.port=S.port,U.path=gh(S.path),U.path.length--,G=Df;continue}U.username=S.username,U.password=S.password,U.host=S.host,U.port=S.port,U.path=gh(S.path),U.query=S.query,U.fragment="",G=Qp}break;case ghe:if(!U.isSpecial()||"/"!==D&&"\\"!==D){if("/"!==D){U.username=S.username,U.password=S.password,U.host=S.host,U.port=S.port,G=Df;continue}G=AP}else G=DP;break;case mhe:if(G=DP,"/"!==D||"/"!==yd(z,X+1))continue;X++;break;case DP:if("/"!==D&&"\\"!==D){G=AP;continue}break;case AP:if("@"===D){K&&(z="%40"+z),K=!0,R=yC(z);for(var ue=0;ue<R.length;ue++){var ye=R[ue];if(":"!==ye||ae){var Ie=Fm(ye,Y9);ae?U.password+=Ie:U.username+=Ie}else ae=!0}z=""}else if(D===gd||"/"===D||"?"===D||"#"===D||"\\"===D&&U.isSpecial()){if(K&&""===z)return"Invalid authority";X-=yC(z).length+1,z="",G=K9}else z+=D;break;case K9:case J9:if(x&&"file"===U.scheme){G=eW;continue}if(":"!==D||oe){if(D===gd||"/"===D||"?"===D||"#"===D||"\\"===D&&U.isSpecial()){if(U.isSpecial()&&""===z)return L0;if(x&&""===z&&(U.includesCredentials()||null!==U.port))return;if(P=U.parseHost(z))return P;if(z="",G=CC,x)return;continue}"["===D?oe=!0:"]"===D&&(oe=!1),z+=D}else{if(""===z)return L0;if(P=U.parseHost(z))return P;if(z="",G=Q9,x===J9)return}break;case Q9:if(!mh(z9,D)){if(D===gd||"/"===D||"?"===D||"#"===D||"\\"===D&&U.isSpecial()||x){if(""!==z){var Ue=SP(z,10);if(Ue>65535)return she;U.port=U.isSpecial()&&Ue===EP[U.scheme]?null:Ue,z=""}if(x)return;G=CC;continue}return she}z+=D;break;case Z9:if(U.scheme="file","/"===D||"\\"===D)G=vhe;else{if(!S||"file"!==S.scheme){G=Df;continue}switch(D){case gd:U.host=S.host,U.path=gh(S.path),U.query=S.query;break;case"?":U.host=S.host,U.path=gh(S.path),U.query="",G=N0;break;case"#":U.host=S.host,U.path=gh(S.path),U.query=S.query,U.fragment="",G=Qp;break;default:dhe(qS(gh(T,X),""))||(U.host=S.host,U.path=gh(S.path),U.shortenPath()),G=Df;continue}}break;case vhe:if("/"===D||"\\"===D){G=eW;break}S&&"file"===S.scheme&&!dhe(qS(gh(T,X),""))&&(QS(S.path[0],!0)?_C(U.path,S.path[0]):U.host=S.host),G=Df;continue;case eW:if(D===gd||"/"===D||"\\"===D||"?"===D||"#"===D){if(!x&&QS(z))G=Df;else if(""===z){if(U.host="",x)return;G=CC}else{if(P=U.parseHost(z))return P;if("localhost"===U.host&&(U.host=""),x)return;z="",G=CC}continue}z+=D;break;case CC:if(U.isSpecial()){if(G=Df,"/"!==D&&"\\"!==D)continue}else if(x||"?"!==D)if(x||"#"!==D){if(D!==gd&&(G=Df,"/"!==D))continue}else U.fragment="",G=Qp;else U.query="",G=N0;break;case Df:if(D===gd||"/"===D||"\\"===D&&U.isSpecial()||!x&&("?"===D||"#"===D)){if(".."===(O=TP(O=z))||"%2e."===O||".%2e"===O||"%2e%2e"===O?(U.shortenPath(),"/"===D||"\\"===D&&U.isSpecial()||_C(U.path,"")):gYe(z)?"/"===D||"\\"===D&&U.isSpecial()||_C(U.path,""):("file"===U.scheme&&!U.path.length&&QS(z)&&(U.host&&(U.host=""),z=yd(z,0)+":"),_C(U.path,z)),z="","file"===U.scheme&&(D===gd||"?"===D||"#"===D))for(;U.path.length>1&&""===U.path[0];)iYe(U.path);"?"===D?(U.query="",G=N0):"#"===D&&(U.fragment="",G=Qp)}else z+=Fm(D,uhe);break;case yhe:"?"===D?(U.query="",G=N0):"#"===D?(U.fragment="",G=Qp):D!==gd&&(U.path[0]+=Fm(D,IP));break;case N0:x||"#"!==D?D!==gd&&("'"===D&&U.isSpecial()?U.query+="%27":U.query+="#"===D?"%23":Fm(D,IP)):(U.fragment="",G=Qp);break;case Qp:D!==gd&&(U.fragment+=Fm(D,che))}X++}},parseHost:function(C){var x,S,T;if("["===yd(C,0)){if("]"!==yd(C,C.length-1)||!(x=function(D){var R,P,O,U,G,X,z,K=[0,0,0,0,0,0,0,0],oe=0,ae=null,ue=0,ye=function(){return yd(D,ue)};if(":"===ye()){if(":"!==yd(D,1))return;ue+=2,ae=++oe}for(;ye();){if(8===oe)return;if(":"!==ye()){for(R=P=0;P<4&&mh(lhe,ye());)R=16*R+SP(ye(),16),ue++,P++;if("."===ye()){if(0===P||(ue-=P,oe>6))return;for(O=0;ye();){if(U=null,O>0){if(!("."===ye()&&O<4))return;ue++}if(!mh(z9,ye()))return;for(;mh(z9,ye());){if(G=SP(ye(),10),null===U)U=G;else{if(0===U)return;U=10*U+G}if(U>255)return;ue++}K[oe]=256*K[oe]+U,2!=++O&&4!==O||oe++}if(4!==O)return;break}if(":"===ye()){if(ue++,!ye())return}else if(ye())return;K[oe++]=R}else{if(null!==ae)return;ue++,ae=++oe}}if(null!==ae)for(X=oe-ae,oe=7;0!==oe&&X>0;)z=K[oe],K[oe--]=K[ae+X-1],K[ae+--X]=z;else if(8!==oe)return;return K}(KS(C,1,-1))))return L0;this.host=x}else if(this.isSpecial()){if(C=function(C){var x,S,T=[],D=Uze(Wze(Vze(C),Kde,"."),".");for(x=0;x<D.length;x++)Om(T,Bze(Nze,S=D[x])?"xn--"+Hze(S):S);return ehe(T,".")}(C),mh(uYe,C)||null===(x=function(D){var R,P,O,U,G,X,z,K=rYe(D,".");if(K.length&&""===K[K.length-1]&&K.length--,(R=K.length)>4)return D;for(P=[],O=0;O<R;O++){if(""===(U=K[O]))return D;if(G=10,U.length>1&&"0"===yd(U,0)&&(G=mh(aYe,U)?16:8,U=KS(U,8===G?1:2)),""===U)X=0;else{if(!mh(10===G?cYe:8===G?lYe:lhe,U))return D;X=SP(U,G)}_C(P,X)}for(O=0;O<R;O++)if(X=P[O],O===R-1){if(X>=ohe(256,5-R))return null}else if(X>255)return null;for(z=nYe(P),O=0;O<P.length;O++)z+=P[O]*ohe(256,3-O);return z}(C)))return L0;this.host=x}else{if(mh(dYe,C))return L0;for(x="",S=yC(C),T=0;T<S.length;T++)x+=Fm(S[T],IP);this.host=x}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return U9(EP,this.scheme)},shortenPath:function(){var C=this.path,x=C.length;!x||"file"===this.scheme&&1===x&&QS(C[0],!0)||C.length--},serialize:function(){var C=this,x=C.scheme,S=C.username,T=C.password,D=C.host,R=C.port,P=C.path,O=C.query,U=C.fragment,G=x+":";return null!==D?(G+="//",C.includesCredentials()&&(G+=S+(T?":"+T:"")+"@"),G+=JS(D),null!==R&&(G+=":"+R)):"file"===x&&(G+="//"),G+=C.cannotBeABaseURL?P[0]:P.length?"/"+qS(P,"/"):"",null!==O&&(G+="?"+O),null!==U&&(G+="#"+U),G},setHref:function(C){var x=this.parse(C);if(x)throw new j9(x);this.searchParams.update()},getOrigin:function(){var C=this.scheme,x=this.port;if("blob"===C)try{return new bC(C.path[0]).origin}catch(S){return"null"}return"file"!==C&&this.isSpecial()?C+"://"+JS(this.host)+(null!==x?":"+x:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(C){this.parse(Jp(C)+":",X9)},getUsername:function(){return this.username},setUsername:function(C){var x=yC(Jp(C));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var S=0;S<x.length;S++)this.username+=Fm(x[S],Y9)}},getPassword:function(){return this.password},setPassword:function(C){var x=yC(Jp(C));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var S=0;S<x.length;S++)this.password+=Fm(x[S],Y9)}},getHost:function(){var C=this.host,x=this.port;return null===C?"":null===x?JS(C):JS(C)+":"+x},setHost:function(C){this.cannotBeABaseURL||this.parse(C,K9)},getHostname:function(){var C=this.host;return null===C?"":JS(C)},setHostname:function(C){this.cannotBeABaseURL||this.parse(C,J9)},getPort:function(){var C=this.port;return null===C?"":Jp(C)},setPort:function(C){this.cannotHaveUsernamePasswordPort()||(""===(C=Jp(C))?this.port=null:this.parse(C,Q9))},getPathname:function(){var C=this.path;return this.cannotBeABaseURL?C[0]:C.length?"/"+qS(C,"/"):""},setPathname:function(C){this.cannotBeABaseURL||(this.path=[],this.parse(C,CC))},getSearch:function(){var C=this.query;return C?"?"+C:""},setSearch:function(C){""===(C=Jp(C))?this.query=null:("?"===yd(C,0)&&(C=KS(C,1)),this.query="",this.parse(C,N0)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var C=this.fragment;return C?"#"+C:""},setHash:function(C){""!==(C=Jp(C))?("#"===yd(C,0)&&(C=KS(C,1)),this.fragment="",this.parse(C,Qp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var bC=function(C){var x=Yze(this,ec),S=Kze(arguments.length,1)>1?arguments[1]:void 0,T=Jze(x,new tW(C,!1,S));B9||(x.href=T.serialize(),x.origin=T.getOrigin(),x.protocol=T.getProtocol(),x.username=T.getUsername(),x.password=T.getPassword(),x.host=T.getHost(),x.hostname=T.getHostname(),x.port=T.getPort(),x.pathname=T.getPathname(),x.search=T.getSearch(),x.searchParams=T.getSearchParams(),x.hash=T.getHash())},ec=bC.prototype,_d=function(C,x){return{get:function(){return wP(this)[C]()},set:x&&function(S){return wP(this)[x](S)},configurable:!0,enumerable:!0}};if(B9&&(vd(ec,"href",_d("serialize","setHref")),vd(ec,"origin",_d("getOrigin")),vd(ec,"protocol",_d("getProtocol","setProtocol")),vd(ec,"username",_d("getUsername","setUsername")),vd(ec,"password",_d("getPassword","setPassword")),vd(ec,"host",_d("getHost","setHost")),vd(ec,"hostname",_d("getHostname","setHostname")),vd(ec,"port",_d("getPort","setPort")),vd(ec,"pathname",_d("getPathname","setPathname")),vd(ec,"search",_d("getSearch","setSearch")),vd(ec,"searchParams",_d("getSearchParams")),vd(ec,"hash",_d("getHash","setHash"))),xP(ec,"toJSON",function(){return wP(this).serialize()},{enumerable:!0}),xP(ec,"toString",function(){return wP(this).serialize()},{enumerable:!0}),$S){var _he=$S.createObjectURL,Che=$S.revokeObjectURL;_he&&xP(bC,"createObjectURL",nhe(_he,$S)),Che&&xP(bC,"revokeObjectURL",nhe(Che,$S))}qze(bC,"URL"),Gze({global:!0,constructor:!0,forced:!zze,sham:!B9},{URL:bC});var mYe=Pn,bhe=xr,vYe=L1,xhe=bl,yYe=T9,nW=Ta("URL"),_Ye=yYe&&bhe(function(){nW.canParse()}),CYe=bhe(function(){return 1!==nW.canParse.length});mYe({target:"URL",stat:!0,forced:!_Ye||CYe},{canParse:function(C){var x=vYe(arguments.length,1),S=xhe(C),T=x<2||void 0===arguments[1]?void 0:xhe(arguments[1]);try{return!!new nW(S,T)}catch(D){return!1}}});var bYe=Pn,xYe=L1,whe=bl,wYe=Ta("URL");bYe({target:"URL",stat:!0},{parse:function(C){var x=xYe(arguments.length,1),S=whe(C),T=x<2||void 0===arguments[1]?void 0:whe(arguments[1]);try{return new wYe(S,T)}catch(D){return null}}});var SYe=_(Co.URL),TYe=Pn,IYe=m0.findIndex,The=!0;"findIndex"in[]&&Array(1).findIndex(function(){The=!1}),TYe({target:"Array",proto:!0,forced:The},{findIndex:function(C){return IYe(this,C,arguments.length>1?arguments[1]:void 0)}});var EYe=Ka("Array","findIndex"),DYe=ks,AYe=EYe,iW=Array.prototype,Ihe=_(function(C){var x=C.findIndex;return C===iW||DYe(iW,C)&&x===iW.findIndex?AYe:x}),Ehe=ts,PYe=xr,Dhe=kr,RYe=O1,kYe=iS,MYe=ch,Ahe=Dhe(Xw.f),OYe=Dhe([].push),FYe=Ehe&&PYe(function(){var C=Object.create(null);return C[2]=2,!Ahe(C,2)}),Phe=function(C){return function(x){for(var S,T=MYe(x),D=kYe(T),R=FYe&&null===RYe(T),P=D.length,O=0,U=[];P>O;)S=D[O++],Ehe&&!(R?S in T:Ahe(T,S))||OYe(U,C?[S,T[S]]:T[S]);return U}},LYe=[Phe(!0),Phe(!1)][0];Pn({target:"Object",stat:!0},{entries:function(C){return LYe(C)}});var PP=_(Co.Object.entries),NYe=Pn,BYe=m0.find,khe=!0;"find"in[]&&Array(1).find(function(){khe=!1}),NYe({target:"Array",proto:!0,forced:khe},{find:function(C){return BYe(this,C,arguments.length>1?arguments[1]:void 0)}});var WYe=Ka("Array","find"),UYe=ks,VYe=WYe,rW=Array.prototype,ZS=_(function(C){var x=C.find;return C===rW||UYe(rW,C)&&x===rW.find?VYe:x}),jYe=m0.filter;Pn({target:"Array",proto:!0,forced:!tS("filter")},{filter:function(C){return jYe(this,C,arguments.length>1?arguments[1]:void 0)}});var HYe=Ka("Array","filter"),GYe=ks,zYe=HYe,oW=Array.prototype,Mhe=_(function(C){var x=C.filter;return C===oW||GYe(oW,C)&&x===oW.filter?zYe:x}),YYe=m0.map;Pn({target:"Array",proto:!0,forced:!tS("map")},{map:function(C){return YYe(this,C,arguments.length>1?arguments[1]:void 0)}});var XYe=Ka("Array","map"),$Ye=ks,qYe=XYe,sW=Array.prototype,e3=_(function(C){var x=C.map;return C===sW||$Ye(sW,C)&&x===sW.map?qYe:x}),KYe=X8.includes;Pn({target:"Array",proto:!0,forced:xr(function(){return!Array(1).includes()})},{includes:function(C){return KYe(this,C,arguments.length>1?arguments[1]:void 0)}});var JYe=Ka("Array","includes"),QYe=Pn,ZYe=h7,eXe=vm,Ohe=bl,tXe=f7,nXe=kr("".indexOf);QYe({target:"String",proto:!0,forced:!tXe("includes")},{includes:function(C){return!!~nXe(Ohe(eXe(this)),Ohe(ZYe(C)),arguments.length>1?arguments[1]:void 0)}});var iXe=Ka("String","includes"),Fhe=ks,rXe=JYe,oXe=iXe,aW=Array.prototype,lW=String.prototype,sXe=_(function(C){var x=C.includes;return C===aW||Fhe(aW,C)&&x===aW.includes?rXe:"string"==typeof C||C===lW||Fhe(lW,C)&&x===lW.includes?oXe:x}),aXe=_(vde),Lhe={exports:{}},lXe=xr(function(){if("function"==typeof ArrayBuffer){var C=new ArrayBuffer(8);Object.isExtensible(C)&&Object.defineProperty(C,"a",{value:8})}}),uXe=Cs,dXe=Np,Nhe=lXe,RP=Object.isExtensible,hXe=xr(function(){RP(1)})||Nhe?function(C){return!!uXe(C)&&(!Nhe||"ArrayBuffer"!==dXe(C))&&(!RP||RP(C))}:RP,fXe=!xr(function(){return Object.isExtensible(Object.preventExtensions({}))}),pXe=Pn,gXe=kr,mXe=nS,vXe=Cs,cW=Ms,yXe=yc.f,Bhe=rS,_Xe=Z8,uW=hXe,CXe=fXe,Whe=!1,Zp=$D("meta"),bXe=0,dW=function(C){yXe(C,Zp,{value:{objectID:"O"+bXe++,weakData:{}}})},xXe=Lhe.exports={enable:function(){xXe.enable=function(){},Whe=!0;var C=Bhe.f,x=gXe([].splice),S={};S[Zp]=1,C(S).length&&(Bhe.f=function(T){for(var D=C(T),R=0,P=D.length;R<P;R++)if(D[R]===Zp){x(D,R,1);break}return D},pXe({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:_Xe.f}))},fastKey:function(C,x){if(!vXe(C))return"symbol"==typeof C?C:("string"==typeof C?"S":"P")+C;if(!cW(C,Zp)){if(!uW(C))return"F";if(!x)return"E";dW(C)}return C[Zp].objectID},getWeakData:function(C,x){if(!cW(C,Zp)){if(!uW(C))return!0;if(!x)return!1;dW(C)}return C[Zp].weakData},onFreeze:function(C){return CXe&&Whe&&uW(C)&&!cW(C,Zp)&&dW(C),C}};mXe[Zp]=!0;var Uhe=Lhe.exports,wXe=Pn,SXe=Yr,TXe=Uhe,IXe=xr,EXe=ym,DXe=C0,AXe=vS,PXe=_s,RXe=Cs,kXe=w1,MXe=gf,OXe=yc.f,FXe=m0.forEach,LXe=ts,NXe=vf.set,BXe=vf.getterFor,Vhe=_m,WXe=sS,jhe=Ede,UXe=Wp,VXe=vS,jXe=w1,HXe=C0,GXe=_N,Hhe=pA,zXe=kse,t3=ts,Ghe=Uhe.fastKey,zhe=vf.set,hW=vf.getterFor,YXe={getConstructor:function(C,x,S,T){var D=C(function(G,X){VXe(G,R),zhe(G,{type:x,index:Vhe(null),first:void 0,last:void 0,size:0}),t3||(G.size=0),jXe(X)||HXe(X,G[T],{that:G,AS_ENTRIES:S})}),R=D.prototype,P=hW(x),O=function(G,X,z){var K,oe,ae=P(G),ue=U(G,X);return ue?ue.value=z:(ae.last=ue={index:oe=Ghe(X,!0),key:X,value:z,previous:K=ae.last,next:void 0,removed:!1},ae.first||(ae.first=ue),K&&(K.next=ue),t3?ae.size++:G.size++,"F"!==oe&&(ae.index[oe]=ue)),G},U=function(G,X){var z,K=P(G),oe=Ghe(X);if("F"!==oe)return K.index[oe];for(z=K.first;z;z=z.next)if(z.key===X)return z};return jhe(R,{clear:function(){for(var G=P(this),X=G.first;X;)X.removed=!0,X.previous&&(X.previous=X.previous.next=void 0),X=X.next;G.first=G.last=void 0,G.index=Vhe(null),t3?G.size=0:this.size=0},delete:function(G){var X=this,z=P(X),K=U(X,G);if(K){var oe=K.next,ae=K.previous;delete z.index[K.index],K.removed=!0,ae&&(ae.next=oe),oe&&(oe.previous=ae),z.first===K&&(z.first=oe),z.last===K&&(z.last=ae),t3?z.size--:X.size--}return!!K},forEach:function(G){for(var X,z=P(this),K=UXe(G,arguments.length>1?arguments[1]:void 0);X=X?X.next:z.first;)for(K(X.value,X.key,this);X&&X.removed;)X=X.previous},has:function(G){return!!U(this,G)}}),jhe(R,S?{get:function(G){var X=U(this,G);return X&&X.value},set:function(G,X){return O(this,0===G?0:G,X)}}:{add:function(G){return O(this,G=0===G?0:G,G)}}),t3&&WXe(R,"size",{configurable:!0,get:function(){return P(this).size}}),D},setStrong:function(C,x,S){var T=x+" Iterator",D=hW(x),R=hW(T);GXe(C,x,function(P,O){zhe(this,{type:T,target:P,state:D(P),kind:O,last:void 0})},function(){for(var P=R(this),O=P.kind,U=P.last;U&&U.removed;)U=U.previous;return P.target&&(P.last=U=U?U.next:P.state.first)?Hhe("keys"===O?U.key:"values"===O?U.value:[U.key,U.value],!1):(P.target=void 0,Hhe(void 0,!0))},S?"entries":"values",!S,!0),zXe(x)}};!function(C,x,S){var T,D=-1!==C.indexOf("Map"),R=-1!==C.indexOf("Weak"),P=D?"set":"add",O=SXe[C],U=O&&O.prototype,G={};if(LXe&&PXe(O)&&(R||U.forEach&&!IXe(function(){(new O).entries().next()}))){var X=(T=x(function(K,oe){NXe(AXe(K,X),{type:C,collection:new O}),kXe(oe)||DXe(oe,K[P],{that:K,AS_ENTRIES:D})})).prototype,z=BXe(C);FXe(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(K){var oe="add"===K||"set"===K;!(K in U)||R&&"clear"===K||EXe(X,K,function(ae,ue){var ye=z(this).collection;if(!oe&&R&&!RXe(ae))return"get"===K&&void 0;var Ie=ye[K](0===ae?0:ae,ue);return oe?this:Ie})}),R||OXe(X,"size",{configurable:!0,get:function(){return z(this).collection.size}})}else T=S.getConstructor(x,C,D,P),TXe.enable();MXe(T,C,!1,!0),G[C]=T,wXe({global:!0,forced:!0},G),R||S.setStrong(T,C,D)}("Set",function(C){return function(){return C(this,arguments.length?arguments[0]:void 0)}},YXe);var $Xe=h0,qXe=TypeError,B0=function(C){if("object"==typeof C&&"size"in C&&"has"in C&&"add"in C&&"delete"in C&&"keys"in C)return C;throw new qXe($Xe(C)+" is not a set")},fW=function(C,x){return 1===x?function(S,T){return S[C](T)}:function(S,T,D){return S[C](T,D)}},Yhe=Ta("Set"),KXe=Yhe.prototype,yu={Set:Yhe,add:fW("add",1),has:fW("has",1),remove:fW("delete",1),proto:KXe},JXe=Rs,W0=function(C,x,S){for(var T,D,R=S?C:C.iterator,P=C.next;!(T=JXe(P,R)).done;)if(void 0!==(D=x(T.value)))return D},QXe=W0,n3=function(C,x,S){return S?QXe(C.keys(),x,!0):C.forEach(x)},ZXe=n3,e$e=yu.Set,t$e=yu.add,pW=function(C){var x=new e$e;return ZXe(C,function(S){t$e(x,S)}),x},i3=function(C){return C.size},Xhe=lu,$he=$l,qhe=Rs,n$e=Qw,Khe="Invalid size",r$e=RangeError,o$e=TypeError,s$e=Math.max,Jhe=function(C,x){this.set=C,this.size=s$e(x,0),this.has=Xhe(C.has),this.keys=Xhe(C.keys)};Jhe.prototype={getIterator:function(){return function(C){return{iterator:C,next:C.next,done:!1}}($he(qhe(this.keys,this.set)))},includes:function(C){return qhe(this.has,this.set,C)}};var U0=function(C){$he(C);var x=+C.size;if(x!=x)throw new o$e(Khe);var S=n$e(x);if(S<0)throw new r$e(Khe);return new Jhe(C,S)},a$e=B0,l$e=pW,c$e=i3,u$e=U0,d$e=n3,h$e=W0,f$e=yu.has,Qhe=yu.remove;Pn({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(C){var x=a$e(this),S=u$e(C),T=l$e(x);return c$e(x)<=S.size?d$e(x,function(D){S.includes(D)&&Qhe(T,D)}):h$e(S.getIterator(),function(D){f$e(x,D)&&Qhe(T,D)}),T}});var g$e=B0,m$e=i3,v$e=U0,y$e=n3,_$e=W0,C$e=yu.Set,Zhe=yu.add,b$e=yu.has;Pn({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(C){var x=g$e(this),S=v$e(C),T=new C$e;return m$e(x)>S.size?_$e(S.getIterator(),function(D){b$e(x,D)&&Zhe(T,D)}):y$e(x,function(D){S.includes(D)&&Zhe(T,D)}),T}});var w$e=B0,S$e=yu.has,T$e=i3,I$e=U0,E$e=n3,D$e=W0,A$e=_A;Pn({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(C){var x=w$e(this),S=I$e(C);if(T$e(x)<=S.size)return!1!==E$e(x,function(D){if(S.includes(D))return!1},!0);var T=S.getIterator();return!1!==D$e(T,function(D){if(S$e(x,D))return A$e(T,"normal",!1)})}});var R$e=B0,k$e=i3,M$e=n3,O$e=U0;Pn({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(C){var x=R$e(this),S=O$e(C);return!(k$e(x)>S.size)&&!1!==M$e(x,function(T){if(!S.includes(T))return!1},!0)}});var L$e=B0,N$e=yu.has,B$e=i3,W$e=U0,U$e=W0,V$e=_A;Pn({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(C){var x=L$e(this),S=W$e(C);if(B$e(x)<S.size)return!1;var T=S.getIterator();return!1!==U$e(T,function(D){if(!N$e(x,D))return V$e(T,"normal",!1)})}});var H$e=B0,G$e=pW,z$e=U0,Y$e=W0,X$e=yu.add,$$e=yu.has,q$e=yu.remove;Pn({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(C){var x=H$e(this),S=z$e(C).getIterator(),T=G$e(x);return Y$e(S,function(D){$$e(x,D)?q$e(T,D):X$e(T,D)}),T}});var J$e=B0,Q$e=yu.add,Z$e=pW,eqe=U0,tqe=W0;Pn({target:"Set",proto:!0,real:!0,forced:!0},{union:function(C){var x=J$e(this),S=eqe(C).getIterator(),T=Z$e(x);return tqe(S,function(D){Q$e(T,D)}),T}});var iqe=_(Co.Set),efe=_(Zie);function tfe(C,x){var S=Ide(C);if(Hue){var T=Hue(C);x&&(T=Mhe(T).call(T,function(D){return que(C,D).enumerable})),S.push.apply(S,T)}return S}function xC(C){for(var x=1;x<arguments.length;x++){var S,T,D=null!=arguments[x]?arguments[x]:{};x%2?vi(S=tfe(Object(D),!0)).call(S,function(R){rn(C,R,D[R])}):Kue?JHe(C,Kue(D)):vi(T=tfe(Object(D))).call(T,function(R){efe(C,R,que(D,R))})}return C}function kP(C){var x=function(){if("undefined"==typeof Reflect||!hP||hP.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(hP(Boolean,[],function(){})),!0}catch(S){return!1}}();return function(){var S,T=uC(C);if(x){var D=uC(this).constructor;S=hP(T,arguments,D)}else S=T.apply(this,arguments);return function(R,P){if(P&&("object"===od(P)||"function"==typeof P))return P;if(void 0!==P)throw new TypeError("Derived constructors may only return object or undefined");return Uo(R)}(this,S)}}var eg=function(C){return yA?yA(C):"[object Array]"===Object.prototype.toString.call(C)},Ea=function(C){return void 0===C},nfe=function(C,x){var S,T;C=null!==(S=C)&&void 0!==S?S:"yyyy-MM-dd hh:mm:ss";var D=Ea(x)?new Date:new Date(x),R={"M+":(D.getMonth()+1).toString(),"d+":D.getDate().toString(),"h+":D.getHours().toString(),"m+":D.getMinutes().toString(),"s+":D.getSeconds().toString(),"q+":Math.floor((D.getMonth()+3)/3).toString(),S:D.getMilliseconds().toString()};return/(y+)/.test(C)&&(C=C.replace(RegExp.$1,"".concat(D.getFullYear()).substring(4-RegExp.$1.length))),vi(T=Ide(R)).call(T,function(P){new RegExp("(".concat(P,")")).test(C)&&(C=C.replace(RegExp.$1,1===RegExp.$1.length?R[P]:"00".concat(R[P]).substring("".concat(R[P]).length)))}),C},Vo=function(C){return"string"==typeof C},Lm=function(C){return"number"==typeof C&&!hC(C)},wC=function(C){return"function"==typeof C},ife=0,Nm=function(){var C;return ife+=1,Mm(C="".concat((new Date).getTime().toString(36))).call(C,ife.toString(36))},MP=function(C){var x=SYe||window.webkitURL;/^blob:/.test(C)&&x.revokeObjectURL(C)},rfe=function(){function C(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Eo(this,C),rn(this,"prefix",void 0),rn(this,"postfix",void 0),rn(this,"isDestroyed",!1),rn(this,"uid",Nm()),rn(this,"cacheEvents",void 0),rn(this,"events",void 0),rn(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=x,this.postfix=S}return Do(C,[{key:"save",value:function(){this.isCached=!0}},{key:"restore",value:function(){var x,S=this;this.isCached=!1,vi(x=this.cacheEvents).call(x,function(T){var D,P=T.param;S.emit.apply(S,Mm(D=[T.eventName]).call(D,zS(P)))}),this.cacheEvents.length=0}},{key:"destroy",value:function(){var x=this;if(!this.isDestroyed){for(var S in this.events)if(Object.prototype.hasOwnProperty.call(this.events,S)){var T,D=this.events[S];D&&vi(T=dh(D).call(D)).call(T,function(R){x.off(R.name,R.fn,R.context,R.once)})}this.events={},this.isDestroyed=!0}}},{key:"on",value:function(x,S,T){var D,R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=this.events,O={name:x=this.format(x),uid:Nm(),context:T,once:R,fn:S};return P[x]||(P[x]=[]),Bo(D=P[x]).call(D,O)<0&&P[x].push(O),O}},{key:"once",value:function(x,S,T){return this.on(x,S,T,!0)}},{key:"emit",value:function(x){for(var S,T,D=this,R=arguments.length,P=new Array(R>1?R-1:0),O=1;O<R;O++)P[O-1]=arguments[O];if(this.isCached)return this.cacheEvents.push({eventName:x,param:P}),!0;var U=this.events[x=this.format(x)];return!(!U||!U.length||(vi(S=dh(U).call(U)).call(S,function(G){var X,z=G.fn;z.call.apply(z,Mm(X=[G.context||null]).call(X,P))}),vi(T=dh(U).call(U)).call(T,function(G){var K=G.once;K&&D.off(x,G.fn,G.context,K)}),0))}},{key:"off",value:function(x,S,T,D){var R=this.events[x=this.format(x)];if(!R)return!1;if(!arguments.length)return R.length=0,!0;for(var P=R.length-1;P>=0;P--){var O=R[P];S&&O.fn!==S||T&&O.context!==T||D&&O.once!==D||pa(R).call(R,P,1)}return!0}},{key:"removeAllEventListeners",value:function(x){if(x){var S,T;x=this.format(x);var D=Ihe(S=this.cacheEvents).call(S,function(R){return R.eventName===x});D>-1&&pa(T=this.cacheEvents).call(T,D,1),this.events[x]&&delete this.events[x]}else this.cacheEvents=[],this.events={}}},{key:"getAllEvents",value:function(){return this.events}},{key:"format",value:function(x){var S,T;return Mm(S=Mm(T="".concat(this.prefix||"")).call(T,x)).call(S,this.postfix||"")}}],[{key:"create",value:function(x,S){return new C(x,S)}}]),C}(),gW="default",vr=function(){function C(){Eo(this,C),rn(this,"emitter",new rfe)}return Do(C,[{key:"on",value:function(x){this.emitter.on(gW,x)}},{key:"emit",value:function(){for(var x,S,T=arguments.length,D=new Array(T),R=0;R<T;R++)D[R]=arguments[R];(x=this.emitter).emit.apply(x,Mm(S=[gW]).call(S,D))}},{key:"off",value:function(x){this.emitter.off(gW,x)}}],[{key:"create",value:function(){return new C}}]),C}(),r3=function(){function C(x){Eo(this,C),rn(this,"uid",void 0),rn(this,"children",void 0),this.uid=x.uid,this.children=x.children||[]}return Do(C,[{key:"append",value:function(x){var S=this.children;return Bo(S).call(S,x)<0&&(S.push(x),!0)}},{key:"insert",value:function(x,S){var T=this.children;return!(S<0||(S>T.length&&(S=T.length),pa(T).call(T,S,0,x),0))}},{key:"remove",value:function(x){var S=this.children,T=Bo(S).call(S,x);return!(T<0||(pa(S).call(S,T,1),0))}},{key:"clear",value:function(){return this.children=[],!0}},{key:"move",value:function(x,S){if(x===S)return!0;var T=this.children,D=dC(pa(T).call(T,x,1),1)[0];return pa(T).call(T,S,0,D),!0}},{key:"switch",value:function(x,S){if(x===S)return!0;var T=this.children,D=T[x];return T[x]=T[S],T[S]=D,!0}},{key:"reorder",value:function(x){var S=this.children,T=x.length,D=[],R=0;if(S.length!==T||0===T)return!1;for(var P=0;P<T;P++)x[P]===P&&(R+=1);if(R===T)return!0;for(var O=0;O<T;O++)D[O]=S[x[O]];for(var U=0;U<T;U++)S[U]=D[U];return!0}}]),C}(),ofe=function(){function C(x,S){Eo(this,C),rn(this,"isDestroyed",!1),rn(this,"data",void 0),rn(this,"table",["database","table","item"]),rn(this,"dbName",void 0),rn(this,"tableName",void 0),this.data={},this.dbName=x,this.tableName=S,this.createDatabase(x,S)}return Do(C,[{key:"destroy",value:function(){if(!this.isDestroyed){for(var x=0,S=PP(this.data);x<S.length;x++){var T=dC(S[x],2);this.data[T[0]]=null}this.data=null,this.isDestroyed=!0}}},{key:"createDatabase",value:function(x,S){this.data[x]={},this.data[x][S]={}}},{key:"set",value:function(x,S){var T=this,D=this.dbName,R=this.tableName;return new x0(function(P,O){T.checkId(x)?O(new Error("The ".concat(x," already exists."))):(T.data[D][R][x]=S,P("Save ".concat(x," to database successful.")))})}},{key:"get",value:function(x){var S=this,T=this.dbName,D=this.tableName;return new x0(function(R,P){S.checkId(x)?R(S.data[T][D][x]):P(S.erMsg(2,x))})}},{key:"remove",value:function(x){var S=this,T=this.dbName,D=this.tableName;return new x0(function(R,P){delete S.data[T][D][x],R("Remove ".concat(x," successful."))})}},{key:"update",value:function(x,S){var T=this,D=this.dbName,R=this.tableName;return new x0(function(P,O){T.checkId(x)?(T.data[D][R][x]=S,P("Update ".concat(x," successful."))):O(T.erMsg(2,x))})}},{key:"checkId",value:function(x){return void 0!==this.data[this.dbName][this.tableName][x]}},{key:"erMsg",value:function(x,S){var T;return Mm(T="The ".concat(this.table[x]," ")).call(T,S," does not exist.")}}]),C}(),OP=function(){function C(){Eo(this,C),rn(this,"isDestroyed",!1),rn(this,"data",void 0),this.data={}}return Do(C,[{key:"destroy",value:function(){if(!this.isDestroyed){for(var x=0,S=PP(this.data);x<S.length;x++){var T,R=dC(S[x],2)[0];null!==(T=this.data[R])&&void 0!==T&&T.destroy(),this.data[R]=null}this.data=null,this.isDestroyed=!0}}},{key:"set",value:function(x,S){return!this.check(x)&&(this.data[x]=S,!0)}},{key:"get",value:function(x){return this.data[x]}},{key:"remove",value:function(x){return!!this.check(x)&&(delete this.data[x],!0)}},{key:"update",value:function(x,S){return!!this.check(x)&&(this.data[x]=S,!0)}},{key:"check",value:function(x){return void 0!==this.data[x]}}]),C}(),sfe=function(C){pP(S,C);var x=kP(S);function S(T){var D;return Eo(this,S),rn(Uo(D=x.call(this,T)),"name",void 0),rn(Uo(D),"type",void 0),rn(Uo(D),"fileType",void 0),rn(Uo(D),"createdDate",void 0),rn(Uo(D),"modifiedDate",void 0),rn(Uo(D),"parent",void 0),rn(Uo(D),"isRoot",!1),D.name=T.name,D.type=T.type,D.fileType=T.fileType,D.parent=T.parent||null,D.isRoot=T.isRoot||!1,D.createdDate=nfe(),D.modifiedDate=D.createdDate,D}return Do(S,[{key:"updateDate",value:function(){this.modifiedDate=nfe()}},{key:"setName",value:function(T){this.name=T}},{key:"reorder",value:function(T){var D=this.type;return("file"===D||"default"===D)&&fP(uC(S.prototype),"reorder",this).call(this,T)}}]),S}(r3),rqe=function(){function C(){Eo(this,C),rn(this,"root",void 0),rn(this,"currentNode",void 0),rn(this,"selectedUid",void 0),rn(this,"defaultNode",void 0),rn(this,"hooks",{fileChanged:vr.create(),beforeRemoveFile:vr.create(),removeFile:vr.create(),afterRemoveFile:vr.create(),afterRenameFile:vr.create(),destroy:vr.create()}),this.root=new sfe({uid:Nm(),children:[],name:"root",type:"file",fileType:"folder",parent:void 0,isRoot:!0}),this.defaultNode=this.root,this.currentNode=this.root}return Do(C,[{key:"appendChildrenToFile",value:function(x,S,T){var D=T,R=afe(this.defaultNode,x);return R||(R=this.createFile(x),this.hooks.fileChanged.emit(this.defaultNode)),vi(S).call(S,function(P){Ea(D)?R.append(P):(R.insert(P,D),D+=1)}),R}},{key:"removeChildFromFile",value:function(x,S){Vo(S)&&(S=[S]);var T=this.getFileByUid(x);T&&vi(S).call(S,function(D){T.remove(D)})}},{key:"findChild",value:function(x,S){var T;return ZS(T=x.children).call(T,function(D){return D.name===S})}},{key:"createFile",value:function(x){var S=this.defaultNode;S||(S=this.root);var T=afe(S,x);return T&&"file"===T.type||(T=new sfe({uid:Nm(),children:[],name:x,type:"file",fileType:"file",parent:S,isRoot:!1}),this.currentNode.append(T),this.hooks.fileChanged.emit(this.currentNode.children)),T}},{key:"removeFile",value:function(x){for(var S=this.defaultNode.children,T=0;T<S.length;T++){var D=S[T];if(D.name===x)return this.hooks.beforeRemoveFile.emit(D),pa(S).call(S,T,1),this.hooks.afterRemoveFile.emit(D),this.hooks.fileChanged.emit(D),!0}return!1}},{key:"renameFile",value:function(x,S){var T=this.findChild(this.defaultNode,x),D=this.findChild(this.defaultNode,S);return!!T&&!D&&(T.name=S,this.hooks.afterRenameFile.emit(T),this.hooks.fileChanged.emit(this.currentNode.children),!0)}},{key:"getFile",value:function(x){return this.findChild(this.defaultNode,x)}},{key:"getFileByUid",value:function(x){return ZS(this).call(this,x,this.root)}},{key:"getCurrentFileList",value:function(){return this.currentNode.children}},{key:"isFileExist",value:function(x){return!!this.findChild(this.defaultNode,x)}},{key:"createFolder",value:function(){}},{key:"find",value:function(x,S){for(var T=S.children,D=T.length,R=0;R<D;R++){if(T[R].uid===x)return T[R];if(T[R].children){var P=ZS(this).call(this,x,T[R]);if(P)return P}}return null}}]),C}();function afe(C,x){var S,T=Mhe(S=C.children).call(S,function(D){return D.name===x});return 0===T.length?null:T[0]}var lfe,FP,cfe=function(C){pP(S,C);var x=kP(S);function S(T){var D;return Eo(this,S),rn(Uo(D=x.call(this,T)),"name",void 0),rn(Uo(D),"type","tag"),D.name=T.name,D.uid=T.uid||Nm(),D.type="tag",D}return Do(S)}(r3),oqe=function(){function C(){Eo(this,C),rn(this,"tags",void 0),rn(this,"defaultName",void 0),rn(this,"defaultUid",void 0),rn(this,"selectedUid",void 0),rn(this,"emptyItem",void 0),rn(this,"hooks",{beforeRemoveTag:vr.create(),afterRenameTag:vr.create(),destroy:vr.create(),load:vr.create()}),this.tags=[],this.defaultName=null,this.defaultUid=null,this.selectedUid=null,this.emptyItem=new cfe({name:"defaultTag",children:[]})}return Do(C,[{key:"appendChildToTag",value:function(x,S){var T=this.createTag(x);Vo(S)&&(S=[S]);var D=!1;return vi(S).call(S,function(R){T.append(R)&&(D=!0)}),D}},{key:"removeChildFromTag",value:function(x,S){var T=this.getTag(x);return!!T&&(Vo(S)&&(S=[S]),vi(S).call(S,function(D){T.remove(D)}),!0)}},{key:"createTag",value:function(x){var S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],T=this.getTag(x);return T||(T=new cfe({name:x,children:S}),this.tags.push(T)),T}},{key:"removeTag",value:function(x){var S,T,D=this.getTag(x);if(!D)return!1;this.hooks.beforeRemoveTag.emit(D);var R=Ihe(S=this.tags).call(S,function(P){return P.name===x});return x===this.defaultName&&(this.defaultName=null,this.selectedUid=null),pa(T=this.tags).call(T,R,1),!0}},{key:"renameTag",value:function(x,S){if(!Vo(x)||!Vo(S))return!1;var T=this.isTagExisted(S),D=this.getTag(x);return!(!D||T||(D.name=S,this.hooks.afterRenameTag.emit(D),0))}},{key:"getTag",value:function(x){var S;return ZS(S=this.tags).call(S,function(T){return T.name===x})}},{key:"getTagByUid",value:function(x){var S;return ZS(S=this.tags).call(S,function(T){return T.uid===x})}},{key:"getTagList",value:function(){var x;return dh(x=this.tags).call(x)}},{key:"setDefaultTag",value:function(x){if(!x)return this.defaultName=null,this.defaultUid=null,!0;var S=this.getTag(x);return!!S&&(this.defaultName=x,this.defaultUid=S.uid,!0)}},{key:"getDefaultTag",value:function(){return this.defaultName}},{key:"isTagExisted",value:function(x){return!!this.getTag(x)}}]),C}(),sqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){var S=x.hooks,T={beforeStatus:null,afterStatus:null,operation:null,docUid:null},D=function(P){T.beforeStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:P.modifiedUid,removedUids:P.removedUids}},R=function(P){T.afterStatus={uids:[],selectedUids:[],currentUid:"",modifiedUid:P.modifiedUid,removedUids:P.removedUids},T.docUid="",T.operation=P.operation,x.emit("bufferChanged",xC({},T)),T={beforeStatus:null,afterStatus:null,operation:null,docUid:null}};S.beforeBufferChanged.on(D),S.afterBufferChanged.on(R),S.destroy.on(function(){S.beforeBufferChanged.off(D),S.afterBufferChanged.off(R)})}}]),C}(),aqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){var S=x.hooks;x.customStore=new OP;var T=function(P){var O=P.data;vi(O).call(O,function(U){var G=U.customData;G||(G={}),x.customStore.set(U.uid,G)})},D=function(P){var O=P.removedUids;vi(O).call(O,function(U){x.customStore.remove(U)})},R=function(P){var O=P.data.customData;O&&x.customStore.update(P.modifiedUid,O)};S.loadSource.on(T),S.removeSource.on(D),S.updateSource.on(R),S.destroy.on(function(){S.loadSource.off(T),S.removeSource.off(D),S.updateSource.off(R)})}}]),C}(),lqe=function(C){pP(S,C);var x=kP(S);function S(){var T;return Eo(this,S),rn(Uo(T=x.call(this,{uid:Nm(),children:[]})),"name","dvs-default"),rn(Uo(T),"isDestroyed",!1),rn(Uo(T),"type",void 0),T}return Do(S,[{key:"destroy",value:function(){this.isDestroyed||(this.isDestroyed=!0)}}]),S}(r3),cqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){x.defaultFile=new lqe;var S=x.hooks,T=function(R){var P,O,U,X=R.index,z=R.data;if(Ea(R.filename)){var K=e3(z).call(z,function(ae){return ae.uid});void 0===X?(P=x.defaultFile.children).push.apply(P,zS(K)):pa(O=x.defaultFile.children).apply(O,Mm(U=[X,0]).call(U,zS(K))),x.hooks.loadToDoc.emit({docUid:x.defaultFile.uid,sourceUids:K,type:"default",index:X})}},D=function(R){var P=R.removedUids,O=[];vi(P).call(P,function(U){var G=x.statusStore.get(U);G&&G.ownerDefaultFile&&(x.defaultFile.remove(U),O.push(U))}),O.length&&x.hooks.removeFromDoc.emit({docUid:x.defaultFile.uid,sourceUids:P,type:"default"})};S.loadSource.on(T),S.removeSource.on(D),S.destroy.on(function(){S.loadSource.off(T),S.removeSource.off(D)})}}]),C}(),uqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){x.dir=new rqe,this.listenDirectoryHooks(x),this.listenSpaceHooks(x)}},{key:"listenDirectoryHooks",value:function(x){var S=x.dir.hooks,T=function(R){var P;vi(P=R.children).call(P,function(O){var U=x.statusStore.get(O);U&&U.ownerFiles.remove(R.uid)}),x.hooks.removeDoc.emit(R)},D=function(R){x.hooks.renameDoc.emit(R)};S.beforeRemoveFile.on(T),S.afterRenameFile.on(D),S.destroy.on(function(){S.beforeRemoveFile.off(T),S.afterRenameFile.off(D)})}},{key:"listenSpaceHooks",value:function(x){var S=x.hooks,T=function(R){var P=R.data,O=R.filename,U=R.index;if(!Ea(O)){var G=e3(P).call(P,function(z){return z.uid}),X={docUid:x.dir.appendChildrenToFile(O,G,U).uid,sourceUids:G,type:"file",index:U};x.hooks.loadToDoc.emit(X)}},D=function(R){var P=R.removedUids,O={};vi(P).call(P,function(oe){var ae,ue,ye=x.statusStore.get(oe);ye&&vi(ae=dh(ue=ye.ownerFiles.children).call(ue)).call(ae,function(Ie){O[Ie]||(O[Ie]=[]),O[Ie].push(oe)})});for(var U=0,G=PP(O);U<G.length;U++){var X=dC(G[U],2),z=X[0],K=X[1];x.dir.removeChildFromFile(z,K),x.hooks.removeFromDoc.emit({docUid:z,sourceUids:K})}};S.loadSource.on(T),S.removeSource.on(D),S.destroy.on(function(){S.loadSource.off(T),S.removeSource.off(D)})}}]),C}(),dqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){var S=x.hooks;x.metadataStore=new OP;var T=function(P){var O=P.data;vi(O).call(O,function(U){var G=U.metadata;G||(G={width:void 0,height:void 0}),x.metadataStore.set(U.uid,G)})},D=function(P){var O=P.removedUids;vi(O).call(O,function(U){x.metadataStore.remove(U)})},R=function(P){var O=P.data.metadata;O&&x.metadataStore.update(P.modifiedUid,O)};S.loadSource.on(T),S.removeSource.on(D),S.updateSource.on(R),S.destroy.on(function(){S.loadSource.off(T),S.removeSource.off(D),S.updateSource.off(R)})}}]),C}(),hqe=function(){function C(x){Eo(this,C),rn(this,"uid",null),rn(this,"minData",null),rn(this,"oriData",null),rn(this,"customData",{}),rn(this,"activeOri",!1),rn(this,"activeMin",!1),rn(this,"minTask",null),rn(this,"oriTask",null),rn(this,"load",!1),rn(this,"preload",[]),rn(this,"visible",[]),rn(this,"overlays",[]),rn(this,"img",null),rn(this,"minImg",null),rn(this,"imageScale",1),rn(this,"owners",[]),rn(this,"oriType",null),rn(this,"minType",null),rn(this,"metadata",null),rn(this,"realTimeWidth",0),rn(this,"realTimeHeight",0),rn(this,"isFromFile",!1),rn(this,"isCached",!1),rn(this,"isDestroyed",!1),rn(this,"isLoading",!1),rn(this,"isMinLoading",!1),rn(this,"isSaving",!1),rn(this,"annotations",void 0),rn(this,"ownerFiles",new r3({children:[]})),rn(this,"ownerTags",new r3({children:[]})),rn(this,"ownerDefaultFile",void 0),rn(this,"operations",[]),rn(this,"useFillColor",!1),this.uid=x.uid,this.metadata=xC({},x.metadata),this.setRealTimeSize(this.metadata.width,this.metadata.height)}return Do(C,[{key:"setRealTimeSize",value:function(x,S){this.realTimeWidth=x,this.realTimeHeight=S}},{key:"destroy",value:function(){this.isDestroyed||(this.customData=null,this.img=null,this.owners=null,this.metadata=null,this.isDestroyed=!0)}},{key:"addOwner",value:function(x){var S=this.owners;Bo(S).call(S,x)<0&&S.push(x)}},{key:"removeOwner",value:function(x){var S=this.owners,T=Bo(S).call(S,x);T>-1&&pa(S).call(S,T,1)}},{key:"removeViewer",value:function(x){var S=this.owners,T=Bo(S).call(S,x);T>-1&&pa(S).call(S,T,1)}},{key:"setVisible",value:function(x){var S;Bo(S=this.visible).call(S,x)<0&&this.visible.push(x)}},{key:"cancelVisible",value:function(x){var S,T,D=Bo(S=this.visible).call(S,x);D>-1&&pa(T=this.visible).call(T,D,1)}},{key:"setPreload",value:function(x){var S;Bo(S=this.preload).call(S,x)<0&&this.preload.push(x)}},{key:"cancelPreload",value:function(x){var S,T,D=Bo(S=this.preload).call(S,x);D>-1&&pa(T=this.preload).call(T,D,1)}},{key:"reset",value:function(){this.minData=null,this.oriData=null,this.img=null,this.activeOri=!1,this.activeMin=!1,this.minTask=null,this.oriTask=null,this.operations=[]}}]),C}(),fqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){var S=x.hooks;x.statusStore=new OP;var T=function(G){var X=G.data;vi(X).call(X,function(z){var K=new hqe(z);x.statusStore.set(z.uid,K)})},D=function(G){var X=G.removedUids;vi(X).call(X,function(z){var K,oe,ae=x.statusStore.get(z);ae&&(MP(ae.minData),MP(ae.oriData),ae.ownerFiles.clear(),ae.ownerTags.clear(),ae.ownerDefaultFile=!1,null!==(K=ae.img)&&void 0!==K&&K.src&&(ae.img.src=""),null!==(oe=ae.minImg)&&void 0!==oe&&oe.src&&(ae.minImg.src=""),ae.img=null,ae.minImg=null),x.statusStore.remove(z)})},R=function(G){var X=G.modifiedUid,z=G.data,K=G.revoke,oe=x.statusStore.get(X);if(oe){oe.img=null,oe.minImg=null;var ae=z.metadata;ae&&(oe.metadata=xC({},ae),oe.setRealTimeSize(ae.width,ae.height)),K&&(MP(oe.oriData),MP(oe.minData)),oe.reset(),x.statusStore.update(X,oe)}},P=function(G){var X;vi(X=G.children).call(X,function(z){var K=x.statusStore.get(z);K&&("file"===G.type?K.ownerFiles.remove(G.uid):"tag"===G.type&&K.ownerTags.remove(G.uid))})},O=function(G){var X=G.docUid,z=G.sourceUids,K=G.type;vi(z).call(z,function(oe){var ae=x.statusStore.get(oe);ae&&("file"===K?ae.ownerFiles.append(X):"tag"===K?ae.ownerTags.append(X):"default"===K&&(ae.ownerDefaultFile=!0))})},U=function(G){var X=G.docUid,z=G.sourceUids,K=G.type;vi(z).call(z,function(oe){var ae=x.statusStore.get(oe);ae&&("file"===K?ae.ownerFiles.remove(X):"tag"===K?ae.ownerTags.remove(X):"default"===K&&(ae.ownerDefaultFile=!0))})};S.loadSource.on(T),S.afterRemoveSource.on(D),S.updateSource.on(R),S.removeDoc.on(P),S.loadToDoc.on(O),S.removeFromDoc.on(U),S.destroy.on(function(){S.loadSource.off(T),S.afterRemoveSource.off(D),S.updateSource.off(R),S.removeDoc.off(P),S.loadToDoc.off(O),S.removeFromDoc.off(U)})}}]),C}(),pqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){var S=x.hooks;x.store=new ofe("space_db","space_doc");var T=function(P){var O=P.data;O&&vi(O).call(O,function(U){x.store.set(U.uid,U)})},D=function(P){var O;vi(O=P.removedUids).call(O,function(U){x.store.remove(U)})},R=function(P){x.store.update(P.modifiedUid,P.data)};S.loadSource.on(T),S.removeSource.on(D),S.updateSource.on(R),S.destroy.on(function(){S.loadSource.off(T),S.removeSource.off(D),S.updateSource.off(R)})}}]),C}(),gqe=function(){function C(){Eo(this,C)}return Do(C,[{key:"apply",value:function(x){x.tag=new oqe,this.listenSpaceHooks(x),this.listenTagHooks(x)}},{key:"listenTagHooks",value:function(x){var S=x.tag.hooks,T=function(R){var P;vi(P=R.children).call(P,function(O){var U=x.statusStore.get(O);U&&U.ownerFiles.remove(R.uid)}),x.hooks.removeDoc.emit(R)},D=function(R){x.hooks.renameDoc.emit(R)};S.beforeRemoveTag.on(T),S.afterRenameTag.on(D),S.destroy.on(function(){S.beforeRemoveTag.off(T),S.afterRenameTag.off(D)})}},{key:"listenSpaceHooks",value:function(x){var S=x.hooks,T=function(G){var X=G.data,z=x.tag.defaultName;vi(X).call(X,function(K){var oe;K.tags||(K.tags=[]),z&&Bo(oe=K.tags).call(oe,z)<0&&K.tags.push(z)})},D=function(G){var X=G.data;vi(X).call(X,function(z){var K;null!==(K=z.tags)&&void 0!==K&&vi(K).call(K,function(oe){x.tag.appendChildToTag(oe,z.uid);var ae={docUid:x.tag.getTag(oe).uid,sourceUids:[z.uid],type:"tag"};x.hooks.loadToDoc.emit(ae)}),z.tags.length=0})},R=function(G){var X=G.removedUids,z={};vi(X).call(X,function(Ue){var He,Re,Oe=x.statusStore.get(Ue);Oe&&vi(He=dh(Re=Oe.ownerTags.children).call(Re)).call(He,function(Ge){z[Ge]||(z[Ge]=[]),z[Ge].push(Ue)})});for(var K=0,oe=PP(z);K<oe.length;K++){var ae=dC(oe[K],2),ue=ae[0],ye=ae[1],Ie=x.tag.getTagByUid(ue);Ie&&x.tag.removeChildFromTag(Ie.name,ye),x.hooks.removeFromDoc.emit({docUid:ue,sourceUids:ye,type:"tag"})}},P=function(G){"tag"!==G.type&&R({removedUids:G.children})},O=function(G){var oe,z=G.sourceUids;if("tag"===G.type){var K=x.tag.getTagByUid(G.docUid);K&&vi(z).call(z,(oe=ide(mP.mark(function ae(ue){var ye,Ie;return mP.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return Ue.prev=0,Ue.next=3,x.store.get(ue);case 3:if(Ue.t0=(Ie=Ue.sent)&&Bo(ye=Ie.tags).call(ye,K.name)<0,!Ue.t0){Ue.next=9;break}return Ie.tags.push(K.name),Ue.next=9,x.store.update(ue,Ie);case 9:Ue.next=14;break;case 11:Ue.prev=11,Ue.t1=Ue.catch(0);case 14:case"end":return Ue.stop()}},ae,null,[[0,11]])})),function(ae){return oe.apply(this,arguments)}))}},U=function(G){var oe,z=G.sourceUids;if("tag"===G.type){var K=x.tag.getTagByUid(G.docUid);K&&vi(z).call(z,(oe=ide(mP.mark(function ae(ue){var ye,Ie,Ue,He;return mP.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Re.prev=0,Re.next=3,x.store.get(ue);case 3:if(!(ye=Re.sent)){Re.next=9;break}return(He=Bo(Ie=ye.tags).call(Ie,K.name))>-1&&pa(Ue=ye.tags).call(Ue,He,1),Re.next=9,x.store.update(ue,ye);case 9:Re.next=14;break;case 11:Re.prev=11,Re.t0=Re.catch(0);case 14:case"end":return Re.stop()}},ae,null,[[0,11]])})),function(ae){return oe.apply(this,arguments)}))}};S.beforeLoadSource.on(T),S.loadSource.on(D),S.removeSource.on(R),S.removeDoc.on(P),S.loadToDoc.on(O),S.removeFromDoc.on(U),S.destroy.on(function(){S.beforeLoadSource.off(T),S.loadSource.off(D),S.removeSource.off(R),S.removeDoc.off(P),S.loadToDoc.off(O),S.removeFromDoc.off(U)})}}]),C}(),mqe=function(C){pP(S,C);var x=kP(S);function S(){var T;return Eo(this,S),rn(Uo(T=x.call(this)),"uid",Nm()),rn(Uo(T),"hooks",{init:vr.create(),destroy:vr.create(),beforeLoadSource:vr.create(),loadSource:vr.create(),afterLoadSource:vr.create(),beforeRemoveSource:vr.create(),removeSource:vr.create(),afterRemoveSource:vr.create(),beforeUpdateSource:vr.create(),updateSource:vr.create(),afterUpdateSource:vr.create(),beforeBufferChanged:vr.create(),afterBufferChanged:vr.create(),directoryChanged:vr.create(),tagChanged:vr.create(),openDoc:vr.create(),loadToDoc:vr.create(),removeFromDoc:vr.create(),removeDoc:vr.create(),renameDoc:vr.create(),move:vr.create(),afterMove:vr.create(),switch:vr.create(),afterSwitch:vr.create(),reorder:vr.create(),afterReorder:vr.create()}),rn(Uo(T),"dir",void 0),rn(Uo(T),"tag",void 0),rn(Uo(T),"store",void 0),rn(Uo(T),"customStore",void 0),rn(Uo(T),"metadataStore",void 0),rn(Uo(T),"statusStore",void 0),rn(Uo(T),"defaultFile",void 0),rn(Uo(T),"plugins",[]),rn(Uo(T),"imageLoader",void 0),T.initPlugins(),T.hooks.init.emit(),T}return Do(S,[{key:"destroy",value:function(){this.hooks.destroy.emit()}},{key:"initPlugins",value:function(){(new pqe).apply(this),(new fqe).apply(this),(new aqe).apply(this),(new dqe).apply(this),(new sqe).apply(this),(new cqe).apply(this),(new uqe).apply(this),(new gqe).apply(this)}},{key:"setImageLoader",value:function(T){this.imageLoader=T}},{key:"getCustomData",value:function(T){return this.customStore.get(T)}},{key:"setCustomData",value:function(T,D){return this.customStore.set(T,D)}},{key:"getMetadata",value:function(T){return this.metadataStore.get(T)}},{key:"setMetadata",value:function(T,D){return this.metadataStore.set(T,D)}},{key:"createStore",value:function(T){var D=T.type,P=T.tableName,O=T.dbName;return"sync"===(void 0===D?"sync":D)?new OP:O&&P?new ofe(O,P):null}},{key:"loadSource",value:function(T,D){if(Ea(T))return[];var R=T.data;if(!eg(R))return[];var P=[];return vi(R).call(R,function(O){O.uid=Nm(),P.push(O.uid)}),wC(D)&&D(P),this.hooks.beforeBufferChanged.emit(T),this.hooks.beforeLoadSource.emit(T),this.hooks.loadSource.emit(T),this.hooks.afterLoadSource.emit(T),this.hooks.afterBufferChanged.emit(T),P}},{key:"removeSource",value:function(T){var D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Vo(T)&&(T=[T]);var R={removedUids:T,docUid:"",trigger:this.uid,operation:"remove"};return this.hooks.beforeRemoveSource.emit(R),this.hooks.beforeBufferChanged.emit(R),this.hooks.removeSource.emit(R),D&&this.hooks.afterRemoveSource.emit(R),this.hooks.afterBufferChanged.emit(R),!0}},{key:"updateSource",value:function(T,D){var R={modifiedUid:T,data:D,revoke:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],operation:"modify"};return this.hooks.beforeUpdateSource.emit(R),this.hooks.beforeBufferChanged.emit(R),this.hooks.updateSource.emit(R),this.hooks.afterUpdateSource.emit(R),this.hooks.afterBufferChanged.emit(R),!0}},{key:"getSource",value:function(T){return this.store.get(T)}},{key:"openDefault",value:function(T){this.hooks.openDoc.emit({node:this.defaultFile,type:"default",config:T})}},{key:"createFile",value:function(T){return this.dir.createFile(T)}},{key:"removeFile",value:function(T){return this.dir.removeFile(T)}},{key:"renameFile",value:function(T,D){return this.dir.renameFile(T,D)}},{key:"openFile",value:function(T,D){var R=this.getFile(T);return!!R&&(this.hooks.openDoc.emit({node:R,type:"file",config:D}),!0)}},{key:"movePagesToFile",value:function(T,D,R,P){var O=this,U=this.getFile(T),G=this.getFile(R);if(!U||!G)return!1;for(var X=0;X<D.length;X++)if(D[X]<0||D[X]>=U.children.length)return!1;if(P<0)return!1;var z=e3(D).call(D,function(ae){return U.children[ae]});vi(z).call(z,function(ae){var ue=O.statusStore.get(ae);ue&&ue.ownerFiles.remove(U.uid)}),this.dir.removeChildFromFile(U.uid,z),this.hooks.removeFromDoc.emit({docUid:U.uid,sourceUids:z}),P>G.children.length&&(P=G.children.length);var K=this.dir.appendChildrenToFile(R,z,P),oe={docUid:K.uid,sourceUids:z,type:"file",index:P};return vi(z).call(z,function(ae){var ue=O.statusStore.get(ae);ue&&ue.ownerFiles.append(K.uid)}),this.hooks.loadToDoc.emit(oe),!0}},{key:"getFile",value:function(T){return this.dir.getFile(T)}},{key:"getFileList",value:function(){return this.dir.getCurrentFileList()}},{key:"isFileExisted",value:function(T){return this.dir.isFileExist(T)}},{key:"createTag",value:function(T){return this.tag.createTag(T)}},{key:"removeTag",value:function(T){for(var D=this.getTag(T).children||[],R=0;R<D.length;R++)this.store.get(D[R]).then(function(P){var O,U,G=Bo(O=(null==P?void 0:P.tags)||[]).call(O,T);-1!==G&&pa(U=P.tags).call(U,G,1)});return this.tag.removeTag(T)}},{key:"renameTag",value:function(T,D){var R=this.getTag(T).children||[],P=this.tag.renameTag(T,D);if(P)for(var O=0;O<R.length;O++)this.store.get(R[O]).then(function(U){var G,X,z=Bo(G=(null==U?void 0:U.tags)||[]).call(G,T);-1!==z&&pa(X=U.tags).call(X,z,1,D)});return P}},{key:"openTag",value:function(T,D){var R=this.getTag(T);return!!R&&(this.hooks.openDoc.emit({node:R,type:"tag",config:D}),!0)}},{key:"getTag",value:function(T){return this.tag.getTag(T)}},{key:"getTagList",value:function(){return this.tag.getTagList()}},{key:"setDefaultTag",value:function(T){return this.tag.setDefaultTag(T)}},{key:"getDefaultTag",value:function(){return this.tag.getDefaultTag()}},{key:"isTagExisted",value:function(T){return this.tag.isTagExisted(T)}},{key:"addTagToSource",value:function(T,D){if(this.statusStore.get(T)){Vo(D)&&(D=[D]);for(var R=0;R<D.length;R++)if(!this.addSourceToTag(D[R],T))return!1;return!0}return!1}},{key:"removeTagFromSource",value:function(T,D){if(this.statusStore.get(T)){var R;Ea(D)?D=e3(R=this.tag.tags).call(R,function(O){return O.name}):Vo(D)&&(D=[D]);for(var P=0;P<D.length;P++)if(!this.removeSourceFromTag(D[P],T))return!1;return!0}return!1}},{key:"addSourceToTag",value:function(T,D){var R=this.tag.getTag(T);if(R&&this.tag.appendChildToTag(T,D)){Vo(D)&&(D=[D]);for(var P=0;P<D.length;P++)this.store.get(D[P]).then(function(U){var G;U&&(eg(U.tags)||(U.tags=[]),sXe(G=U.tags).call(G,T)||U.tags.push(T))});return this.hooks.loadToDoc.emit({sourceUids:D,docUid:R.uid,type:"tag"}),!0}return!1}},{key:"removeSourceFromTag",value:function(T,D){var R=this.tag.getTag(T);if(R){this.tag.removeChildFromTag(T,D),Vo(D)&&(D=[D]);for(var P=0;P<D.length;P++)this.store.get(D[P]).then(function(U){var G,X,z=Bo(G=(null==U?void 0:U.tags)||[]).call(G,T);-1!==z&&pa(X=U.tags).call(X,z,1)});return this.hooks.removeFromDoc.emit({docUid:R.uid,sourceUids:D,type:"tag"}),!0}return!1}},{key:"getSourceTags",value:function(T){var D,R=this,P=this.statusStore.get(T);return P?e3(D=P.ownerTags.children).call(D,function(O){return R.tag.getTagByUid(O).name}):[]}},{key:"switch",value:function(T){var D=T.one,R=T.other,O=T.docUid,U=T.emit,G=this.getDocNode(O,T.type);return!!G&&(G.switch(D,R),(U||Ea(U))&&this.hooks.switch.emit({one:D,other:R,docUid:O,type:G.type,trigger:this.uid,operation:"shift"}),!0)}},{key:"move",value:function(T){var D=T.from,R=T.to,O=T.docUid,U=T.emit,G=this.getDocNode(O,T.type);return!!G&&(G.move(D,R),(U||Ea(U))&&this.hooks.move.emit({from:D,to:R,docUid:O,type:G.type,trigger:this.uid,operation:"shift"}),!0)}},{key:"reorder",value:function(T){var D=T.indexes,P=T.docUid,O=T.emit,U=this.getDocNode(P,T.type);U&&(U.reorder(D),O||Ea(O))&&this.hooks.move.emit({indexes:D,docUid:P,type:U.type,trigger:this.uid,operation:"shift"})}},{key:"getDocNode",value:function(T,D){switch(D){case"default":return this.defaultFile;case"file":return this.dir.getFileByUid(T);case"tag":return this.tag.getTagByUid(T);default:return T===this.defaultFile.uid?this.defaultFile:this.tag.getTagByUid(T)||this.dir.getFileByUid(T)||null}}}]),S}(rfe),vqe={Successful:{errorCode:0,errorString:"Successful."},InvalidIndex:{errorCode:-1033,errorString:"Invalid index."},InvalidValue:{errorCode:-1034,errorString:"Invalid value."},NoImage:{errorCode:-1035,errorString:"There is no image."},UnBindViewer:{errorCode:-2210,errorString:"You cannot call this method on this WebTwain instance because it does not use the default viewer."},AlReadyBindViewer:{errorCode:-2211,errorString:"The element is already bound to the viewer."},ParameterCannotEmpty:{errorCode:-2314,errorString:"The parameter cannot be empty."},IndicesNotArray:{errorCode:-2358,errorString:"The type of the parameter indices must be an Array."},IndexOutOfRange:{errorCode:-2359,errorString:"The index is out of range."},InvalidTagName:{errorCode:-2394,errorString:"Invalid tag name."},InvalidLeftOrTopOrRightOrBottom:{errorCode:-2417,errorString:"The left or top or right or bottom you entered is invalid."},InvalidWidth:{errorCode:-2418,errorString:"The width you entered is invalid."},InvalidHeight:{errorCode:-2419,errorString:"The height you entered is invalid."},WidthOrHeightOutOfImageSize:{errorCode:-2420,errorString:"The width or height is out of image size."},MobileServer_InvalidIndex:{errorCode:-2423,errorString:"The index is invalid."},ImageEditorExist:{errorCode:-2500,errorString:"An ImageEditor already exists."},ThumbnailViewerExist:{errorCode:-2501,errorString:"A ThumbnailViewer already exists."},CustomElementExist:{errorCode:-2502,errorString:"A CustomElement already exists."},ImageEditorDispose:{errorCode:-2504,errorString:"The ImageEditor object has been disposed."},ThumbnailViewerNotExist:{errorCode:-2505,errorString:"This ThumbnailViewer doesn't exist."},ThumbnailViewerDispose:{errorCode:-2506,errorString:"The ThumbnailViewer object has been disposed."},CallbackNotAFunction:{errorCode:-2510,errorString:"The callback is not a function."},ElementRequired:{errorCode:-2511,errorString:"Parameter 'element' is required."},ElementNotExist:{errorCode:-2512,errorString:"Parameter 'element' doesn't instanceof HTMLDivElement."},InvalidPropertyValue:{errorCode:-2514,errorString:"Invalid property value."},CursorInvalidMode:{errorCode:-2519,errorString:"The current mode does not support setting the cursor to zoom."},OldTagNameRequired:{errorCode:-2517,errorString:"Old tag name is required."},NewTagNameRequired:{errorCode:-2518,errorString:"New tag name is required."},FileNameCannotEmpty:{errorCode:-2530,errorString:"Document name cannot be empty."},FileNameNotString:{errorCode:-2531,errorString:"Document name is not a string."},FileNotExist:{errorCode:-2540,errorString:"The document does not exist."},FileExist:{errorCode:-2541,errorString:"The document already exists."},CustomElementDispose:{errorCode:-2508,errorString:"The CustomElement object has been disposed."},CustomElementNotExist:{errorCode:-2507,errorString:"This CustomElement doesn't exist."},ParameterOutRange:{errorCode:80002,errorString:"The parameter is out of range."},TagNotExist:{errorCode:80009,errorString:"Tag does not exist."},TagExist:{errorCode:80010,errorString:"The tag already exists."},OperationError:{errorCode:80022,errorString:"The operation mode is wrong."}};(FP=lfe||(lfe={}))[FP.Normal=0]="Normal",FP[FP.Balance=1]="Balance";var yqe=function(){function C(x){Eo(this,C),rn(this,"space",void 0),rn(this,"webViewer",void 0),rn(this,"isActiveFile",!1),rn(this,"isActiveTag",!1),rn(this,"currentFileName",""),rn(this,"currentTagName",""),rn(this,"bufferConfig",null),rn(this,"currentSelected",[]),this.space=new mqe,x&&(this.bufferConfig=x)}return Do(C,[{key:"e",value:function(){this.setError("Successful")}},{key:"IsFileNameExist",value:function(x){var S=this.space.getFileList();if("dynamsoft-default-document"===x)return!0;if(S)for(var T=0;T<S.length;T++)if(S[T].name===x)return!0;return!1}},{key:"getCurrentDataSet",value:function(){if(this.webViewer){var x=this.webViewer.myViewer.getCurrentTab();if(void 0===x)return!1;var S=x.type;this.isActiveFile="file"===S,this.isActiveTag="tag"===S}if(this.isActiveFile){var T=this.getCurrentFileName(),D=this.space.getFile(T);if(D)return D}if(this.isActiveTag){var R=this.space.getTag(this.currentTagName);if(R)return R}return!1}},{key:"setError",value:function(x){var S;if("Default"!==x){if(this.webViewer)this.webViewer.setError(x);else if(this.bufferConfig&&this.bufferConfig.viewerError){var T=vqe[x];this.bufferConfig.viewerError.setError(T.errorCode,T.errorString)}}else null==this||null===(S=this.webViewer)||void 0===S||S.setDefaultError()}},{key:"emitViewerEvent",value:function(){var x,S;this.webViewer&&0===this.getHowManyImagesInBuffer()&&(null===(x=this.webViewer)||void 0===x||null===(S=x.myViewer)||void 0===S||S.emit("pageRendered",-1))}},{key:"bindViewer",value:function(x){this.webViewer=x}},{key:"getCurrentTag",value:function(){return this.currentTagName}},{key:"getCurrentDocument",value:function(){return this.currentFileName}},{key:"getCurrentFileName",value:function(){var x=this,S=this.space.getFileList(),T="";return S&&vi(S).call(S,function(D){D.name===x.currentFileName&&(T=x.currentFileName)}),T}},{key:"getCurrentIndex",value:function(){if(this.webViewer)return this.webViewer.getCurrentIndex();var x=this.getSelectedImagesIndices().length;if(x<=0){var S=this.getCurrentDataSet();return!!S&&S.children.length-1}return this.getSelectedImagesIndices()[x-1]}},{key:"getHowManyImagesInBuffer",value:function(){if(this.webViewer)return this.webViewer.getHowManyImagesInBuffer();var x=this.getCurrentDataSet();return x?x.children.length:0}},{key:"getSelectedImagesIndices",value:function(){return this.webViewer?this.webViewer.getSelectedImagesIndices():this.currentSelected}},{key:"getIndexByUid",value:function(x){if(!Vo(x)||!x)return this.setError("InvalidValue"),!1;if(this.webViewer)return this.webViewer.myViewer.getIndexByUid(x);var S=this.getCurrentDataSet(),T=S.children;return!!(S&&T&&eg(T))&&Bo(T).call(T,x)}},{key:"getUidByIndex",value:function(x){if(x<0||x>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;if(this.webViewer)return this.webViewer.myViewer.getUidByIndex(x);var S=this.getCurrentDataSet().children;return!(S&&S.length<x)&&S[x]}},{key:"getDataByUid",value:function(x){return this.space.getSource(x)}},{key:"updateDataByUid",value:function(x,S){return this.space.store.set(x,S)}},{key:"setCustomDataByUid",value:function(x,S){return Vo(x)&&""!==x?this.space.setCustomData(x,S):(this.setError("InvalidValue"),!1)}},{key:"getCustomDataByUid",value:function(x){return this.space.getCustomData(x)}},{key:"setMetadataByUid",value:function(x,S){return Vo(x)&&""!==x?this.space.setMetadata(x,S):(this.setError("InvalidValue"),!1)}},{key:"getMetadataByUid",value:function(x){return this.space.getMetadata(x)}},{key:"addImage",value:function(x,S,T){var D,R,P={},O=this.currentFileName,U="";!Ea(T)&&Vo(T)?(this.IsFileNameExist(T)||this.createDocument(T),U=T):Ea(O)||""===O?(this.space.isFileExisted("dynamsoft-default-document")||this.createDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!1),this.openDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!0),U="dynamsoft-default-document"):U=O,S&&(delete(R=xC({},S)).oriBlobData,S.oriBlobData&&(D=S.oriBlobData));var G=x.imageUrl,X=x.minImageUrl,z=x.imageId,K=x.serverId,oe=x.uidFromServer,ae=x.index;if(D&&(P=xC({},D)),z&&(P.imageId=z),K&&(P.serverId=K),oe&&(P.uidFromServer=oe),!Ea(ae)&&Lm(ae)){var ue=this.getDocumentContents(U).length;ae>=ue&&(ae=ue)}var ye=this.space.loadSource({data:[{oriData:G,minData:X,metadata:R,customData:P}],filename:U,index:ae},function(Ue){var He=dC(Ue,1)[0];x.uuid=He});if(this.isActiveTag){var Ie=this.getHowManyImagesInBuffer();this.currentSelected=Ie>0?[Ie-1]:[]}else this.currentSelected=!Ea(ae)&&Lm(ae)?[ae]:[];return ye}},{key:"insertImage",value:function(x,S,T){var D;return T&&T>=0?(D=this.space.loadSource({data:[x],filename:S,index:T}))[0]&&(this.currentSelected=[T]):(D=this.space.loadSource({data:[x],filename:S}),this.currentSelected=[]),D[0]}},{key:"updateImage",value:function(x,S){var T=x.imageUrl,D=x.minImageUrl,R=x.imageId,P=x.serverId,O=x.uidFromServer,U=x.uuid,G=xC({},S);return U&&""!==U&&-1!==U?(this.space.updateSource(U,{oriData:T,minData:D,metadata:G,customData:{imageId:R,serverId:P,uidFromServer:O}}),U):(this.setError("IndexOutOfRange"),!1)}},{key:"removeImageByUid",value:function(x){if(this.e(),this.webViewer){var S=this.webViewer.removePageByUid(x);return this.webViewer.resized(),this.emitViewerEvent(),S}return this.space.removeSource(x)}},{key:"removeImageByIndex",value:function(x){if(this.e(),x<0||x>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var S=this.getCurrentIndex(),T=!1;if(this.webViewer)T=this.webViewer.removePageByIndexes(x),this.webViewer.resized(),this.emitViewerEvent();else{var D=this.getCurrentDataSet();if(!D)return!1;T=this.space.removeSource(D.children[x])}return T||this.setError("Default"),this.currentSelected=x===S&&0===x?this.getHowManyImagesInBuffer()>0?[0]:[]:x<=S?[S-1]:[S],T}},{key:"removeSelectedImages",value:function(x){this.e();var S=this.getSelectedImagesIndices();eg(x)&&x.length>0&&(S=x);var T=!1;if(this.webViewer)T=this.webViewer.removePageByIndexes(S),this.webViewer.resized(),this.emitViewerEvent();else{var D=[],R=this.getCurrentDataSet();if(!R)return!1;vi(S).call(S,function(P){R.children[P]&&R.children[P]&&D.push(R.children[P])}),T=this.space.removeSource(D)}return T||this.setError("Default"),T}},{key:"removeImageByIndexArr",value:function(x){if(this.e(),!eg(x))return!1;var S=this.getCurrentDataSet();if(!S)return!1;var T,D=[];return vi(x).call(x,function(R){var P=S.children[R];P&&D.push(P)}),(T=this.space.removeSource(D))||this.setError("Default"),this.webViewer&&(this.webViewer.resized(),this.emitViewerEvent()),this.currentSelected=[],T}},{key:"removeAllImages",value:function(){this.e();var x=!1;if(this.webViewer)x=this.webViewer.removeAllPages(),this.webViewer.resized(),this.emitViewerEvent();else{var S=this.getCurrentDataSet();S&&(x=this.space.removeSource(zS(S.children)))}return x||this.setError("Default"),this.currentSelected=[],x}},{key:"tagImages",value:function(x,S){this.e();var T=this.getHowManyImagesInBuffer();if(!eg(x))return this.setError("IndicesNotArray"),!1;if(!Vo(S)||""===S)return this.setError("InvalidTagName"),!1;for(var D=0;D<T;D++){var R=x[D];if(hC(R)||R<0||R>=T)return this.setError("IndexOutOfRange"),!1}this.space.createTag(S);for(var P=0;P<x.length;P++){var O=x[P];if(O>=0){var U=this.getUidByIndex(O);U&&""!==U&&-1!==jp(U,10)&&this.space.addTagToSource(U,S)}}return!0}},{key:"removeImageTag",value:function(x,S){if(this.e(),!Lm(x))return this.setError("InvalidValue"),!1;if(x<0||x>this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var T=this.getUidByIndex(x),D=!1;return T&&""!==T&&-1!==T&&(D=this.space.removeTagFromSource(T,S)),D||this.setError("Default"),D}},{key:"getDefaultTag",value:function(){return this.space.getDefaultTag()}},{key:"setDefaultTag",value:function(x){return this.e(),Vo(x)?""===x?(this.space.setDefaultTag(null),!0):(this.space.createTag(x),(S=this.space.setDefaultTag(x))||this.setError("Default"),S):(this.setError("InvalidValue"),!1);var S}},{key:"removeTag",value:function(x,S){var T=this;if(this.e(),!Vo(x))return this.setError("InvalidValue"),!1;if(!Ea(S)&&!eg(S))return this.setError("IndicesNotArray"),!1;if(!this.space.isTagExisted(x))return this.setError("TagNotExist"),!1;var D=this.currentTagName,R=!1,P=!1;if(D&&(R=D===x),Ea(S))P=this.space.removeTag(x),R&&this.clearFilter();else{var O=[];vi(S).call(S,function(G){var X=T.getUidByIndex(G);-1!==X&&O.push(X)});for(var U=0;U<(null==O?void 0:O.length);U++)if(!(P=this.space.removeTagFromSource(O[U],x)))return!1}return P||this.webViewer.setDefaultError(),P}},{key:"renameTag",value:function(x,S){return this.e(),Ea(x)||""===x?(this.setError("OldTagNameRequired"),!1):Ea(S)||""===S?(this.setError("NewTagNameRequired"),!1):this.space.isTagExisted(x)?this.space.isTagExisted(S)?(this.setError("TagExist"),!1):(x===this.currentTagName&&(this.currentTagName=S),(T=this.space.renameTag(x,S))?this.space.setDefaultTag(S):this.setError("Default"),T):(this.setError("TagNotExist"),!1);var T}},{key:"getTagContents",value:function(x){return this.e(),x&&Vo(x)&&""!==x?this.space.getTag(x).children:[]}},{key:"getTagList",value:function(){var x=this;this.e();var S=this.space.getTagList(),T=[];return S?vi(S).call(S,function(D){var R,P=[];vi(R=D.children).call(R,function(O){var U=x.getCustomDataByUid(O);U&&P.push(U.uidFromServer)}),T.push({name:D.name,imageIds:P})}):T=[],T}},{key:"getTagListByIndex",value:function(x){if(!Lm(x))return!1;var S=this.getUidByIndex(x);return this.space.getSourceTags(S)}},{key:"clearFilter",value:function(){this.e(),this.currentTagName="",this.space.setDefaultTag(null);var x,S=this.getCurrentFileName();return""===S&&(S="dynamsoft-default-document"),(x=this.openDocument(S))||this.setError("Default"),x}},{key:"filterImagesByTag",value:function(x,S,T){this.e();var D=!1;if(Ea(x)||null===x||""===x){this.currentTagName="";var R=this.getCurrentFileName();""===R&&(R="dynamsoft-default-document"),(D=this.openDocument(R))?wC(S)&&S():(this.setError("Default"),wC(T)&&T())}else{var P,O;if(!this.space.isTagExisted(x))return this.setError("TagNotExist"),wC(T)&&T(),!1;if(this.isActiveTag=!0,this.isActiveFile=!1,this.currentTagName=x,this.setDefaultTag(x),D=this.space.openTag(x,null==this||null===(P=this.webViewer)||void 0===P||null===(O=P.myViewer)||void 0===O?void 0:O.uid)){var U=this.space.getTag(x);if(U){var G,X=(null==U||null===(G=U.children)||void 0===G?void 0:G.length)||0;this.currentSelected=X>0?[X-1]:[]}wC(S)&&S()}else this.setError("Default"),wC(T)&&T()}return this.webViewer&&this.webViewer.render(),D}},{key:"createDocument",value:function(x){if(this.e(),!x||""===x){var S=Lm(x)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(S),!1}return Vo(x)?this.space.isFileExisted(x)?(this.setError("FileExist"),!1):!!this.space.createFile(x)||(this.setError("Default"),!1):(this.setError("FileNameNotString"),!1)}},{key:"openDocument",value:function(x,S){var T,D;if(this.e(),!x||""===x){var R=Lm(x)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(R),!1}if(!Vo(x))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(x))return this.setError("FileNotExist"),!1;var P=S&&""!==S?S:null==this||null===(T=this.webViewer)||void 0===T||null===(D=T.myViewer)||void 0===D?void 0:D.uid;if(!this.space.openFile(x,{viewerUid:P}))return this.setError("Default"),!1;this.currentFileName=x,this.isActiveFile=!0,this.isActiveTag=!1;var O=this.space.getFile(x);if(O){var U,G=null==O||null===(U=O.children)||void 0===U?void 0:U.length;this.currentSelected=G>0?[G-1]:[]}return!0}},{key:"getDocumentContents",value:function(x){return this.e(),x&&Vo(x)&&""!==x?this.space.getFile(x).children:[]}},{key:"renameDocument",value:function(x,S){return this.e(),Vo(x)&&Vo(S)?(x&&""!==x&&S&&""!==S||this.setError("FileNameCannotEmpty"),this.space.isFileExisted(x)?this.space.isFileExisted(S)?(this.setError("FileExist"),!1):this.space.renameFile(x,S)?(this.currentFileName===x&&(this.currentFileName=S),!0):(this.setError("Default"),!1):(this.setError("FileNotExist"),!1)):(this.setError("FileNameNotString"),!1)}},{key:"removeDocument",value:function(x){if(this.e(),!x||!Vo(x))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(x))return this.setError("FileNotExist"),!1;var S=this.space.removeFile(x);return S?(S&&this.webViewer&&this.webViewer.resized(),this.currentFileName===x&&(this.currentFileName=""),!0):(this.setError("Default"),!1)}},{key:"getDocumentInfoList",value:function(){var x=this;this.e();var S=this.space.getFileList(),T=[];return S?(vi(S).call(S,function(D){if(D.children){for(var R=[],P=0;P<D.children.length;P++){var U=x.getCustomDataByUid(D.children[P]);U&&R.push(U.uidFromServer)}T.push({imageIds:R,name:D.name})}}),T):[]}},{key:"getDocumentInfo",value:function(x){this.e();var S=this.space.getFile(x);if(!S)return{imageIds:[],length:0};for(var T=[],D=0;D<S.children.length;D++){var P=this.getCustomDataByUid(S.children[D]);P&&T.push(P.uidFromServer)}return{imageIds:T,length:T.length}}},{key:"selectImages",value:function(x){this.e();var S=!0;if(!x||!eg(x))return!1;if(this.webViewer){var T=this.webViewer.getIfAutoScroll();!1===T&&this.webViewer.setIfAutoScroll(!0),S=this.webViewer.selectPages(x),!1===T&&this.webViewer.setIfAutoScroll(!1)}else{for(var D=this.getHowManyImagesInBuffer(),R=0;R<x.length;R++)if(!Lm(x[R])||x[R]<0||x[R]>=D)return this.setError("ParameterOutRange"),!1;S=!0}return S?this.currentSelected=x:this.setError("Default"),S}},{key:"selectAllImages",value:function(){this.e();var x=!0;if(this.webViewer)x=this.webViewer.myViewer.selectAll(),this.currentSelected=this.webViewer.getSelectedImagesIndices();else{var S,T=this.getCurrentDataSet();this.currentSelected=aXe(kN(S=new Array(T.children.length)).call(S))}return x||this.setError("Default"),x}},{key:"moveImage",value:function(x,S){this.e();var T=jp(x,10),D=jp(S,10);if(hC(x)||hC(S))return this.setError("InvalidIndex"),!1;var R=this.getHowManyImagesInBuffer();if(T<0||T>=R||D<0||D>R)return this.setError("IndexOutOfRange"),!1;var P=!1;if(this.webViewer)P=this.webViewer.myViewer.movePage(x,S);else{var O=this.getCurrentDataSet();if(!O)return!1;P=this.space.move({docUid:O.uid,type:O.type,from:x,to:S})}return P||this.setError("Default"),this.currentSelected=[S],P}},{key:"switchImage",value:function(x,S){this.e();var T=jp(x,10),D=jp(S,10);if(hC(x)||hC(S))return this.setError("InvalidIndex"),!1;var R=this.getHowManyImagesInBuffer(),P=this.getCurrentIndex();if(T<0||T>=R||D<0||D>R)return this.setError("IndexOutOfRange"),!1;var O=!1;if(this.webViewer)O=this.webViewer.myViewer.switchPage(x,S);else{var U=this.getCurrentDataSet();if(!U)return!1;O=this.space.switch({docUid:U.uid,type:U.type,one:x,other:S})}O||this.setError("Default");var G=P;return T===P?G=D:D===P&&(G=T),this.currentSelected=[G],O}},{key:"moveImageToFile",value:function(x,S,T,D){if(!this.space.isFileExisted(x)||!this.space.isFileExisted(T))return this.setError("FileNotExist"),!1;S=zS(new iqe(S));var R=this.getDocumentInfo(x).length;if(!eg(S)||S.length>R)return this.setError("ParameterOutRange"),!1;var P=this.getDocumentInfo(T).length,O=this.space.movePagesToFile(x,S,T,D);if(!this.webViewer&&this.isActiveFile){var U=this.getHowManyImagesInBuffer();x===this.currentFileName&&(this.currentSelected=U>0?[U-1]:[]),T===this.currentFileName&&(this.currentSelected=Lm(D)&&D<P&&D>=0?[D+S.length-1]:U>0?[U-1]:[])}return O}}]),C}();HTMLCanvasElement.prototype.toBlob||efe(HTMLCanvasElement.prototype,"toBlob",{value:function(C,x,S){for(var T=atob(this.toDataURL(x,S).split(",")[1]),D=T.length,R=new Uint8Array(D),P=0;P<D;P++)R[P]=T.charCodeAt(P);C(new Blob([R],{type:x||"image/png"}))}});var _u,Zn,SC=v(function C(x){if(n(this,C),x)this._baseUrl=x._baseUrl,this._buffer=x._buffer,this._serverIdMap=x._serverIdMap,this._uidMap=x._uidMap;else{var S={viewerError:{setError:function(T,D){H.log(T,D),this._error={code:T,message:D}}}};this._baseUrl="",this._buffer=new yqe(S),this._serverIdMap={},this._uidMap={}}},[{key:"getError",value:function(){return this._error}},{key:"BaseUrl",get:function(){return this._baseUrl}},{key:"getImageUrl",value:function(C){var x=this.convertClientIndexToServerId(C),S=Date.now();return cr.getImageUrl(this._baseUrl,x,-1,-1,S)}},{key:"getMinImageUrl",value:function(C,x,S){var T=this.convertClientIndexToServerId(C),D=Date.now();return T&&x&&S?cr.getImageUrl(this._baseUrl,T,parseInt(x),parseInt(S),D):""}},{key:"append",value:function(C,x,S,T,D){var R,P,O,U,G=Date.now(),X=x,z=S;if(R={imageId:X,serverId:x,uidFromServer:z,imageUrl:O=cr.getImageUrl(this._baseUrl,X,-1,-1,G),minImageUrl:P=T&&T.controlWidth&&T.controlWidth>0&&T.controlHeight&&T.controlHeight>0?be.navInfoSync.bMobile?cr.getImageUrl(this._baseUrl,X,Math.round(T.controlWidth*devicePixelRatio),Math.round(T.controlHeight*devicePixelRatio),G):cr.getImageUrl(this._baseUrl,X,parseInt(T.controlWidth),parseInt(T.controlHeight),G):O},U=T.currentFileName.length>0?this._buffer.addImage(R,T,T.currentFileName):this._buffer.addImage(R,T)){var K=g9(U,1)[0],oe=this._buffer.getCustomDataByUid(K);return oe.serverId=X,oe.uidFromServer=z,this._innerInsertModel(X,z,K,O,P),K}return!1}},{key:"insertBefore",value:function(C,x,S,T,D){var R,P,O,U=Date.now(),G=S,X=T;R={index:C,imageId:G,serverId:G,uidFromServer:X,imageUrl:O=cr.getImageUrl(this._baseUrl,G,-1,-1,U),minImageUrl:P=D&&D.controlWidth&&D.controlWidth>0&&D.controlHeight&&D.controlHeight>0?be.navInfoSync.bMobile?cr.getImageUrl(this._baseUrl,G,Math.round(D.controlWidth*devicePixelRatio),Math.round(D.controlHeight*devicePixelRatio),U):cr.getImageUrl(this._baseUrl,G,parseInt(D.controlWidth),parseInt(D.controlHeight),U):O};var z=this._buffer.addImage(R);if(z){var K=g9(z,1)[0],oe=this._buffer.getCustomDataByUid(K);return oe.serverId=G,oe.uidFromServer=X,this._innerInsertModel(G,X,K,O,P),this._buffer.openDocument(this.getCurrentFileName()),K}return!1}},{key:"_innerInsertModel",value:function(C,x,S,T,D){var R=new dP;R.serverId=C,R.uidFromServer=x,R.uuid=S,R.imageUrl=T,R.minImageUrl=D,this._serverIdMap[C]=R,this._uidMap[x]=R}},{key:"refresh",value:function(C,x,S,T){var D=1*C;if(S){var R=this.count();if(D<0||D>R)return!1;this._setDataImageControl(D,T)}return!0}},{key:"refreshByImageId",value:function(C,x,S){return x&&this._setDataImageControl(C,S,!0),!0}},{key:"_setDataImageControl",value:function(C,x,S){var T,D,R,P,O,U,G=this,X=G._baseUrl;if(S)O=C;else if(O=(P=G.getCustomDataByIndex(C)).serverId,U=P.uidFromServer,O<=0)return!1;if((T=G.getImageIdMap(O))||((T=new dP).serverId=O,T.uidFromServer=U,G._serverIdMap[O]=T,G._uidMap[U]=T),X){null!=T&&(T.ticks=Date.now()),D=cr.getImageUrl(X,O,-1,-1,T.ticks),R=x&&x.controlWidth&&x.controlWidth>0&&x.controlHeight&&x.controlHeight>0?be.navInfoSync.bMobile?cr.getImageUrl(X,O,Math.round(x.controlWidth*devicePixelRatio),Math.round(x.controlHeight*devicePixelRatio),T.ticks):cr.getImageUrl(X,O,parseInt(x.controlWidth),parseInt(x.controlHeight),T.ticks):D,T.imageUrl=D,T.minImageUrl=R;var z=H.clone(T);z.imageId=O,G._buffer.updateImage(z,x)}return!0}},{key:"convertIndicesToServerIds",value:function(C){var x,S=C.length,T=[];for(x=0;x<S;x++){var D=this.convertClientIndexToServerId(C[x]);-1!=D&&T.push(D)}return T}},{key:"removeImagesByServerId",value:function(C,x){var S=this,T=null!=x?x:this._buffer.getCurrentDocument(),D=[];return H.each(C,function(R,P){var U,O=parseInt(R);return S._removeMapModelImageControlByServerId(O),U=S._buffer.isActiveFile?S._convertServerIdToIndexInFile(T,O):S._convertServerIdToIndex(O),!isNaN(U)&&!(U<0||U>=S.count())&&void D.push(U)}),D.length>0&&S._buffer.removeImageByIndexArr(D)}},{key:"removeByServerId",value:function(C,x,S){var R,T=this,D=null!=S?S:this._buffer.getCurrentDocument();return T._removeMapModelImageControlByServerId(C),R=this._buffer.isActiveFile?this._convertServerIdToIndexInFile(D,C):x,!isNaN(R)&&!(R<0||R>=T.count())&&T._buffer.removeImageByIndex(R)}},{key:"exists",value:function(C){if(this._serverIdMap[C])return!0;var x=-1;if(this._buffer.isActiveFile){var S=this.getCurrentFileName();x=this._convertServerIdToIndexInFile(S,C)}else x=this._convertServerIdToIndex(C);return x>-1}},{key:"removeImages",value:function(C){var x,S,T;for(T=C.length,x=0;x<T;x++)S=this.convertClientIndexToServerId(C[x]),this._removeMapModelImageControlByServerId(S);return this._buffer.removeSelectedImages(C)}},{key:"clear",value:function(){var C,x,S,T=this;for(S=T.count(),C=0;C<S;C++)x=T.convertClientIndexToServerId(C),this._removeMapModelImageControlByServerId(x);return S==Object.keys(T._serverIdMap).length&&(T._serverIdMap={},T._uidMap={}),T._buffer.removeAllImages()}},{key:"_uidFromServer2index",value:function(C){var x,S,T,D=this;if((T=D._uidMap[C])&&(S=T.uuid),S&&-1!=S)x=D._buffer.getIndexByUid(S);else if(D._buffer.isActiveFile){var R=this.getCurrentFileName();x=this._convertUidFromServerToIndexInFile(R,C)}else x=this._convertUidFromServerToIndex(C);return H.isNumber(x)||(x=-1),x}},{key:"_serverId2uidFromServer",value:function(C){if(C&&C>0){var x,S,T;if((T=this._serverIdMap[C])&&(S=T.uidFromServer))return S;if((x=this.convertServerIdToClientIndex(C))>=0)return this._index2uidFromServer(x)}return-1}},{key:"_uidFromServer2ServerId",value:function(C){if(C){var x,S,T;if((T=this._uidMap[C])&&(S=T.serverId))return S;if((x=this._uidFromServer2index(C))>=0)return this.convertClientIndexToServerId(x)}return-1}},{key:"_index2uidFromServer",value:function(C){var x=this.getCustomDataByIndex(C);return x?x.uidFromServer:-1}},{key:"convertServerIdToClientIndex",value:function(C){var x,S,T,D=this;if((T=D._serverIdMap[C])&&(S=T.uuid),S&&-1!=S)x=D._buffer.getIndexByUid(S);else if(D._buffer.isActiveFile){var R=this.getCurrentFileName();x=this._convertServerIdToIndexInFile(R,C)}else x=this._convertServerIdToIndex(C);return H.isNumber(x)||(x=-1),x}},{key:"getIndexByUid",value:function(C){var x;return!1===(x=this._buffer.getIndexByUid(C))?-1:x}},{key:"getUidByIndex",value:function(C){return this._buffer.getUidByIndex(C)}},{key:"convertClientIndexToServerId",value:function(C){var x=this.getCustomDataByIndex(C);return x?x.serverId:-1}},{key:"getCurrentImageIndex",value:function(){return this._buffer.getCurrentIndex()}},{key:"setCurrentImageIndex",value:function(C){return this._buffer.selectImages([C])}},{key:"getCurrentFileName",value:function(){return this._buffer.getCurrentFileName()}},{key:"setDefaultTag",value:function(C){return this._buffer.setDefaultTag(C)}},{key:"getDefaultTag",value:function(){return this._buffer.getDefaultTag()}},{key:"count",value:function(){return this._buffer.getHowManyImagesInBuffer()}},{key:"getCountByDocumentName",value:function(C){return this._buffer.getDocumentInfo(C).length}},{key:"dispose",value:function(){this.clear()}},{key:"getImageData",value:function(C){var x=this._buffer.getUidByIndex(C);return x?this._buffer.getDataByUid(x):me.Promise.resolve(null)}},{key:"getCustomDataByIndex",value:function(C){return this._buffer.getCustomDataByUid(this._buffer.getUidByIndex(C))}},{key:"getMetadataByIndex",value:function(C){return this._buffer.getMetadataByUid(this._buffer.getUidByIndex(C))}},{key:"setCustomData",value:function(C,x){var S=this._buffer.getUidByIndex(C);return!(!S||!x)&&this._buffer.setCustomDataByUid(S,x)}},{key:"openDocument",value:function(C){return this._buffer.openDocument(C)}},{key:"createDocument",value:function(C){return this._buffer.createDocument(C)}},{key:"getImageIdMap",value:function(C){return this._serverIdMap[C]}},{key:"_removeMapModelImageControlByServerId",value:function(C){var x=this;if(C>0&&x._serverIdMap[C]){var S=x._serverIdMap[C],T=S.uidFromServer;S.Clear(),delete x._serverIdMap[C],delete x._uidMap[T]}}},{key:"_convertServerIdToIndexInFile",value:function(C,x){var S,T,D=-1;for(S=this._buffer.getDocumentContents(C),T=0;T<S.length;T++){var R=S[T];if(R){var P=this._buffer.getCustomDataByUid(R);if(P&&P.serverId==x){D=T;break}}}return D}},{key:"_convertServerIdToIndex",value:function(C){var x,S=-1;for(x=0;x<this.count();x++){var T=this._buffer.getUidByIndex(x);if(T){var D=this._buffer.getCustomDataByUid(T);if(D&&D.serverId==C){S=x;break}}}return S}},{key:"_convertUidFromServerToIndexInFile",value:function(C,x){var S,T,D=-1;for(S=this._buffer.getDocumentContents(C),T=0;T<S.length;T++){var R=S[T];if(R){var P=this._buffer.getCustomDataByUid(R);if(P&&P.uidFromServer==x){D=T;break}}}return D}},{key:"_convertUidFromServerToIndex",value:function(C){var x,S=-1;for(x=0;x<this.count();x++){var T=this._buffer.getUidByIndex(x);if(T){var D=this._buffer.getCustomDataByUid(T);if(D&&D.uidFromServer==C){S=x;break}}}return S}},{key:"convertUUIDToServerId",value:function(C){var x=this._buffer.getCustomDataByUid(C);return x&&-1!=x.serverId?x.serverId:-1}},{key:"UpdateImage",value:function(C,x){return this._buffer.updateImage(C,x),!0}}],[{key:"_setBaseUrl",value:function(C,x){C._baseUrl=x}},{key:"_getBuffer",value:function(C){return C._buffer}}]),_qe=function(C){function x(D){var R,P,O,U;n(this,x),P=this,U=[D],O=qn(O=x),(R=Za(P,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(X){return!1}}()?Reflect.construct(O,U||[],qn(P).constructor):O.apply(P,U))).__IfAppendImage=Nt,R.__maxImagesInBuffer=32767,R.__insertingIndex=-1,R._aryBitmapCache=[],R._imageBufferWrapper=new SC;var G=Ql.getServerImageUrlPrefix(R);return SC._setBaseUrl(R._imageBufferWrapper,G),R}return el(x,C),v(x,[{key:"_registerMultiEvent",value:function(D,R){var P=this;if(P._resetErr(),!P._isValid())return!1;var O=["_$",D].join("");P[O]||(P[O]={});var U=P[O],G=H.guid();return U[G]=R,G}},{key:"_unregisterMultiEvent",value:function(D,R){var P=this;if(P._resetErr(),!P._isValid())return!1;var O=["_$",D].join(""),U=P[O];if(R){var G;if(H.isString(R))return delete U[R],Nt;if(H.isFunction(R))for(G=0;G<U.length;G++)if(R==U[G])return U.splice(G,1),Nt}return P[O]=null,Nt}},{key:"_getMetadata",value:function(D){return this._imageBufferWrapper.getMetadataByIndex(D)}},{key:"_updateImage",value:function(D,R,P){var O,U,G,X,z=k0.Auto,K=this;return P&&(null!=P.width&&(G=parseInt(P.width)),null!=P.height&&(X=parseInt(P.height)),z=H.isNumber(G)&&H.isNumber(X)&&R.byteLength===G*X*4?k0.RGBA:k0.Auto),O={imageId:D,serverId:D,bufferLen:R.byteLength,imageType:z},P&&z==k0.RGBA&&(O.width=G,O.height=X,null!=P.bitDepth&&(O.bit=P.bitDepth),null!=P.resolutionX&&(O.xres=parseInt(P.resolutionX)),null!=P.resolutionY&&(O.yres=parseInt(P.resolutionY)),null!=P.uid&&(O.uidFromServer=P.uid)),U=H.stringify([H.stringify(O)]),new me.Promise(function(oe,ae){K._innerSendBlobByWS("UpdateImage",U,R,function(ue){H.log("UpdateImage success."),oe(ue)},function(ue){H.log("UpdateImage failed."),H.error(ue),ae({code:K._errorCode,message:K._errorString})})})}},{key:"_removeImages",value:function(D){return this._imageBufferWrapper.removeImages(D)}},{key:"_getCurrentDocumentName",value:function(){var D="";return this._imageBufferWrapper&&(D=this._imageBufferWrapper.getCurrentFileName()),D}},{key:"_getCurrentDefaultTagName",value:function(){var D="";return this._imageBufferWrapper&&(D=this._imageBufferWrapper.getDefaultTag()||""),D}},{key:"_innerRefreshUI",value:function(D,R,P,O,U){var G=this;return P&&G._imageBufferWrapper.refresh(D,G._imageBufferWrapper.count(),!0,O),H.isFunction(G.__OnRefreshUI)&&G.__OnRefreshUI(G._imageBufferWrapper.getCurrentImageIndex(),G._imageBufferWrapper.count()),!0}},{key:"_innerRefreshUIByImageId",value:function(D,R,P,O){var U=this;return R&&U._imageBufferWrapper.refreshByImageId(D,!0,P),H.isFunction(U.__OnRefreshUI)&&U.__OnRefreshUI(U._imageBufferWrapper.getCurrentImageIndex(),U._imageBufferWrapper.count()),!0}},{key:"_getHowManyImagesInBuffer",value:function(){return this._isValid()?this._imageBufferWrapper.count():0}},{key:"_OnBitmapChanged",value:function(D,R,P){var O,U,G,X=this,z="m1"==D[0],oe="c2"==D[0],ae="c1"==D[0]||oe||z,ue=D[1].split(","),ye=D[2],Ie=D[3],Ue=X.__maxImagesInBuffer,He=-1,Re=!1,Oe=[];if(P&&(O=P.document,U=P.tag,P.bNeedClearTag&&(G=P.bNeedClearTag)),H.log("_OnBitmapChanged.currentFileName="+O+", tag="+U),O?O!=X._getCurrentDocumentName()&&(Re=!0):O=X._getCurrentDocumentName(),X._imageBufferWrapper&&(U?(X._imageBufferWrapper.setDefaultTag(U),H.log("metaDataObj.currentTag="+U)):G&&(X._imageBufferWrapper.setDefaultTag(""),H.log("metaDataObj.currentTag=''"))),!z)if(oe)D.length>5&&(Oe=D[5]),H.isArray(Oe)||(Oe=[]);else{var Ge={};if(D.length>5&&(Ge.width=D[5]),D.length>6&&(Ge.height=D[6]),D.length>7&&(Ge.bitDepth=D[7]),D.length>8&&(Ge.resolutionX=D[8]),D.length>9&&(Ge.resolutionY=D[9]),D.length>10&&(He=D[10]),D.length>11&&H.isString(D[11])&&(Ge.uidFromServer=D[11]),Oe.push(Ge),He>-1&&X._canConsume()&&(ye==os.enumBCAppend||ye==os.enumBCInsert)){var Se=be.DWT.lgct(He);H.isFunction(X.__OnLtsverify)&&X.__OnLtsverify(Se,1)}}if(H.log("OnBitmapChanged:"+D),ye==os.enumBCInsert||ye==os.enumBCAppend&&!X.__IfAppendImage)H.each(ue,function(Ye,Be){var $e,ze,Ct=parseInt(Ye),bt=X._imageBufferWrapper.getCurrentImageIndex();if(Be<Oe.length&&Oe[Be]?($e=(ze=Oe[Be]).uidFromServer,delete ze.uidFromServer):ze={},ze.currentFileName=O,isNaN(Ct)||Ct<0)return!0;if(ae)X._aryBitmapCache.push(Ct);else for(var Vt=0;Vt<X._aryBitmapCache.length;Vt++)if(X._aryBitmapCache[Vt]==Ct)return X._aryBitmapCache.splice(Vt,1),!0;if(X._imageBufferWrapper.exists(Ct))return!0;X.__insertingIndex>-1&&(bt=X.__insertingIndex),ze.controlWidth=400,ze.controlHeight=400,X._controlWidth&&X._controlWidth>400&&(ze.controlWidth=X._controlWidth),X._controlHeight&&X._controlHeight>400&&(ze.controlHeight=X._controlHeight),-1==bt&&(bt=0),X._imageBufferWrapper.insertBefore(bt,Ue,Ct,$e,ze),X.__insertingIndex>-1&&(X.__insertingIndex=X.__insertingIndex+1)}),H.isFunction(X.__OnRefreshUI)&&X.__OnRefreshUI(X._imageBufferWrapper.getCurrentImageIndex(),X._imageBufferWrapper.count());else if(ye==os.enumBCAppend&&X.__IfAppendImage)H.each(ue,function(Ye,Be){var $e,ze,Ct=parseInt(Ye);if(isNaN(Ct)||Ct<0)return!0;if(Be<Oe.length&&Oe[Be]?($e=(ze=Oe[Be]).uidFromServer,delete ze.uidFromServer):ze={},ze.currentFileName=O,H.log("metaDataObj.currentFileName="+O),ae)X._aryBitmapCache.push(Ct);else for(var bt=0;bt<X._aryBitmapCache.length;bt++)if(X._aryBitmapCache[bt]==Ct)return X._aryBitmapCache.splice(bt,1),!0;if(X._imageBufferWrapper.exists(Ct))return!0;ze.controlWidth=400,ze.controlHeight=400,X._controlWidth&&X._controlWidth>400&&(ze.controlWidth=X._controlWidth),X._controlHeight&&X._controlHeight>400&&(ze.controlHeight=X._controlHeight),Re?X._imageBufferWrapper.append(Ue,Ct,$e,ze,O):X._imageBufferWrapper.append(Ue,Ct,$e,ze)}),H.isFunction(X.__OnRefreshUI)&&X.__OnRefreshUI(X._imageBufferWrapper.getCurrentImageIndex(),X._imageBufferWrapper.count());else if(ye==os.enumBCRemove&&ae){var de=!1;if(1==ue.length&&-1==ue[0]&&(de=!0),de)X._imageBufferWrapper.clear();else{var ge=[];H.each(ue,function(Ye,Be){var $e=parseInt(Ye);if(isNaN($e)||$e<0)return!0;ge.push($e)}),X._imageBufferWrapper.removeImagesByServerId(ge,O)}H.isFunction(X.__OnRefreshUI)&&X.__OnRefreshUI(X._imageBufferWrapper.getCurrentImageIndex(),X._imageBufferWrapper.count())}else if(ye==os.enumBCEdit||ye==os.enumBCUpdate)H.each(ue,function(Ye,Be){var $e,ze=parseInt(Ye);if(isNaN(ze)||ze<0)return!0;if(Be<Oe.length&&Oe[Be]?delete($e=Oe[Be]).uidFromServer:$e={},$e.currentFileName=O,ze>=0&&!X.__bLoadingImage){var Ct=X._imageBufferWrapper.convertServerIdToClientIndex(ze);Ct>-1?X._innerRefreshUI(Ct,X._imageBufferWrapper.count(),!0,$e,ye):P.bNeedRefresh&&X._innerRefreshUIByImageId(ze,!0,$e,ye)}});else if(ye==os.enumBCIndexChange){var _e;Ie>=0&&!X.__bLoadingImage&&((_e=0<Oe.length&&Oe[0]?Oe[0]:{}).currentFileName=O,0==X.__IfAppendImage&&X._innerRefreshUI(Ie,X._imageBufferWrapper.count(),!0,_e,ye),X._imageBufferWrapper.refresh(Ie,X._imageBufferWrapper.count(),!1,_e))}if(H.isFunction(X.__OnBitmapChanged)){if(!z)if(ae){if(ye!=os.enumBCRemove&&!he.bFirefox&&ae)return!0}else if(ye==os.enumBCRemove||he.bFirefox&&!ae)return!0;var ve=[];H.each(ue,function(Ye){var Be,$e=parseInt(Ye);if(isNaN($e)||$e<0)return!0;(Be=X._imageBufferWrapper.convertServerIdToClientIndex($e))>-1&&ve.push(Be)});var Te=X._imageBufferWrapper.getCurrentImageIndex(),We=ye;ye==os.enumBCAppend&&(We=X.__IfAppendImage?os.enumBCAppend:os.enumBCInsert),X.__OnBitmapChanged(ve,We,Te,X._imageBufferWrapper.count())}}},{key:"_removeImageAsync",value:(T=_t(B.mark(function D(R,P){var O,U,G;return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(O=this,U=parseInt(P),na(O,U)){X.next=4;break}return X.abrupt("return",!1);case 4:return G=O._imageBufferWrapper.convertClientIndexToServerId(U),X.next=7,O._removeImageByIdAsync(G);case 7:return X.abrupt("return",X.sent);case 8:case"end":return X.stop()}},D,this)})),function(D,R){return T.apply(this,arguments)})},{key:"_removeImageByIdAsync",value:(S=_t(B.mark(function D(R){var P,O;return B.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(P=this,-1!=R){U.next=4;break}return Mt(P),U.abrupt("return",!1);case 4:return U.next=6,P._innerFunV2("RemoveImage",Et(R));case 6:return((O=U.sent)||-1033==P._errorCode)&&P._OnBitmapChanged(["c1",""+R,3,P._imageBufferWrapper.getCurrentImageIndex(),P._imageBufferWrapper.count()]),U.abrupt("return",O);case 9:case"end":return U.stop()}},D,this)})),function(D){return S.apply(this,arguments)})}]);var S,T}(Ql);(function(C){C.Text=0,C.Blob=1,C.ArrayBuffer=2,C.XML=3,C.JSON=4,C.UserDefined=5})(_u||(_u={})),function(C){C.Other=0,C.HTTPUpload=1,C.HTTPDownload=2,C.FTPUpload=3,C.FTPDownload=4,C.Scan=5,C.LoadImage=6,C.ConvertToBlob=7,C.HTTPPut=8}(Zn||(Zn={}));var Cu={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function Cqe(C,x){if(H.isFunction("_".repeat))return C.repeat(x);for(var S=0,T=[];S<x;S++)T.push(C);return T.join("")}var ufe,mW=Object.create?Object.create(null):{};function vW(C,x,S,T){return function(D,R){var P,O,U,G,X,z,K,oe,ae,ue=1,ye=D.length,Ie="";for(O=0;O<ye;O++)if("string"==typeof D[O])Ie+=D[O];else if("object"===p(D[O])){if((G=D[O]).keys)for(P=R[ue],U=0;U<G.keys.length;U++){if(null==P)throw new Error(vW('[sprintf] Cannot access property "%s" of undefined value "%s"',G.keys[U],G.keys[U-1]));P=P[G.keys[U]]}else P=G.param_no?R[G.param_no]:R[ue++];if(Cu.not_type.test(G.type)&&Cu.not_primitive.test(G.type)&&P instanceof Function&&(P=P()),Cu.numeric_arg.test(G.type)&&"number"!=typeof P&&isNaN(P))throw new TypeError(vW("[sprintf] expecting number but found %T",P));switch(Cu.number.test(G.type)&&(oe=P>=0),G.type){case"b":P=parseInt(P,10).toString(2);break;case"c":P=String.fromCharCode(parseInt(P,10));break;case"d":case"i":P=parseInt(P,10);break;case"j":P=H.stringify(P,null,G.width?parseInt(G.width):0);break;case"e":P=G.precision?parseFloat(P).toExponential(G.precision):parseFloat(P).toExponential();break;case"f":P=G.precision?parseFloat(P).toFixed(G.precision):parseFloat(P);break;case"g":P=G.precision?String(Number(P.toPrecision(G.precision))):parseFloat(P);break;case"o":P=(parseInt(P,10)>>>0).toString(8);break;case"s":P=String(P),P=G.precision?P.substring(0,G.precision):P;break;case"t":P=String(!!P),P=G.precision?P.substring(0,G.precision):P;break;case"T":P=Object.prototype.toString.call(P).slice(8,-1).toLowerCase(),P=G.precision?P.substring(0,G.precision):P;break;case"u":P=parseInt(P,10)>>>0;break;case"v":P=P.valueOf(),P=G.precision?P.substring(0,G.precision):P;break;case"x":P=(parseInt(P,10)>>>0).toString(16);break;case"X":P=(parseInt(P,10)>>>0).toString(16).toUpperCase()}Cu.json.test(G.type)?Ie+=P:(!Cu.number.test(G.type)||oe&&!G.sign?ae="":(ae=oe?"+":"-",P=P.toString().replace(Cu.sign,"")),z=G.pad_char?"0"===G.pad_char?"0":G.pad_char.charAt(1):" ",K=G.width-(ae+P).length,X=G.width&&K>0?Cqe(z,K):"",Ie+=G.align?ae+P+X:"0"===z?ae+X+P:X+ae+P)}return Ie}(function(D){if(mW[D])return mW[D];for(var R,P=D,O=[],U=0;P;){if(null!==(R=Cu.text.exec(P)))O.push(R[0]);else if(null!==(R=Cu.modulo.exec(P)))O.push("%");else{if(null===(R=Cu.placeholder.exec(P)))throw new SyntaxError("[sprintf] unexpected placeholder");if(R[2]){U|=1;var G=[],X=R[2],z=[];if(null===(z=Cu.key.exec(X)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(G.push(z[1]);""!==(X=X.substring(z[0].length));)if(null!==(z=Cu.key_access.exec(X)))G.push(z[1]);else{if(null===(z=Cu.index_access.exec(X)))throw new SyntaxError("[sprintf] failed to parse named argument key");G.push(z[1])}R[2]=G}else U|=2;if(3===U)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");O.push({placeholder:R[0],param_no:R[1],keys:R[2],sign:R[3],pad_char:R[4],align:R[5],width:R[6],precision:R[7],type:R[8]})}P=P.substring(R[0].length)}return mW[D]=O,O}(C),arguments)}function Tc(C,x){if(H.isString(C)){var S,T,D,R,P,O=C.indexOf("<%");if(-1==O||(T=C.substring(0,O),!(O+2<(S=C.indexOf(">",T)))))return C;D=C.substring(O+1,S),R=C.substring(S+1);try{P=vW(D,x)}catch(U){P=""}return[T,P,R].join("")}return""}function LP(C,x){var S,T=C.substring(C.lastIndexOf(".")).toLowerCase();if(x==be.DWT.EnumDWT_ImageType.IT_BMP){if(".bmp"==T||".dib"==T)return C;S=[C,".bmp"].join("")}else if(x==be.DWT.EnumDWT_ImageType.IT_JPG){if(".jpg"==T||".jpe"==T||".jpeg"==T||".jfif"==T)return C;S=[C,".jpg"].join("")}else if(x==be.DWT.EnumDWT_ImageType.IT_PNG){if(".png"==T)return C;S=[C,".png"].join("")}else if(x==be.DWT.EnumDWT_ImageType.IT_TIF){if(".tif"==T||".tiff"==T)return C;S=[C,".tif"].join("")}else if(x==be.DWT.EnumDWT_ImageType.IT_PDF){if(".pdf"==T)return C;S=[C,".pdf"].join("")}else if(x==be.DWT.EnumDWT_ImageType.IT_J2K){if(".jp2"==T)return C;S=[C,".jp2"].join("")}return S}function dfe(C,x,S,T){var D,R,P,O,U=x.url,G=x.headers,X=x.retry,z=x.httpFormData,K=x.bOnlyResponseEmptyIsOK,oe=x.bAsync,ae=(R=x.responseType)==_u.Text?"text":R==_u.JSON?"json":R==_u.Blob?"blob":R==_u.ArrayBuffer?"arraybuffer":R==_u.XML?"xml":5==R?"user-defined":"text",ue=C.IfShowProgressBar,ye=C.IfShowCancelDialogWhenImageTransfer,Ie=C.objUploadStatus;(D=x.content)&&(D.remoteFilename||(D.remoteFilename=x.remoteFilename),D.fileName||(D.fileName=x.fileName||D.name),D.name||(D.name=x.fileName||D.fileName));var Ue,He=new Am({action:U,data:z,async:oe,retry:X,bOnlyResponseEmptyIsOK:K,dataType:ae});if(ye&&me.progressContext&&(Ue=me.progressContext.on("cancel",function(){He.abort(),He=null})),(P=He._uploadType)&&(O=P.get("ajaxConfig"),G&&O&&O.headers&&G&&H.mix(O.headers,G),C.HTTPRequestswithCredentials&&H.mix(O.xhrFields,{withCredentials:!0}),O=null),He.on(Am.event.SUCCESS,function(Se){x.content=null,He=null,Ue&&me.progressContext.off("cancel",Ue),C.HTTPPostResponse=Se?Se.response:x.responseType==_u.ArrayBuffer?[]:x.responseType==_u.Blob?new Blob([]):x.responseType==_u.JSON?{}:"",H.isFunction(C.onHttpUploadStatus)&&C.onHttpUploadStatus({fileName:Se.name,percentage:100,statusCode:200,responseString:C.HTTPPostResponse}),H.isFunction(S)&&S(C.HTTPPostResponse)}),He.on(Am.event.ERROR,function(Se){x.content=null,He=null;var de=Se&&Se.canceled,ge="",_e=0;Ue&&me.progressContext.off("cancel",Ue),C.HTTPPostResponse=Se&&H.isString(Se.response)?Se.response:"",de||(Se&&Se.msg&&(ge=Se.msg),Se&&Se.httpStatus&&(_e=Se.httpStatus));var Te={};lB(Te,de,ge,_e),H.isFunction(C.onHttpUploadStatus)&&C.onHttpUploadStatus({fileName:Se.name,percentage:100,statusCode:_e,responseString:C.HTTPPostResponse}),H.isFunction(T)&&T(Te._errorCode,Te._errorString,C.HTTPPostResponse)}),(ue||H.isFunction(C.onHttpUploadStatus))&&(He.on(Am.event.PROGRESS,function(Se){!he.bSafari&&Se&&(delete Se.totalSize,delete Se.position);var de=0===Se.total?100:Math.round(100*Se.loaded/Se.total);[Se.loaded," / ",Se.total].join(""),H.isFunction(C.onHttpUploadStatus)&&C.onHttpUploadStatus({fileName:Se.name,percentage:de,statusCode:0,responseString:""}),C.onPercent([0,de,"","http",Se.name])}),C.onPercent([0,-1,Br.Uploading,"http"]),H.isFunction(C.onHttpUploadStatus))){var Re="";H.isArray(D)&&D.length>0||(D&&D.name&&""!=D.name?Re=D.name:D&&D.fileName&&(Re=D.fileName)),!Re&&x.fileName&&(Re=x.fileName),C.onHttpUploadStatus({fileName:Re,percentage:0,statusCode:0,responseString:""})}if(Ie&&Ie.bCancel){Ie.st=2;var Oe={};return gu(Oe),x.content=null,H.isFunction(T)&&T(Oe._errorCode,Oe._errorString),!1}var Ge=He.upload(D);return D=null,Ge}function hfe(C,x,S,T){var D,R,P=C.MaxUploadImageSize,O=0,U=x.content;if(!U||!H.isArray(U)||U.length<=0){x.content=null;var G={};return is(G),H.isFunction(T)&&T(G._errorCode,G._errorString),yt}for(D=0;D<U.length;D++){var X=U[D];if(!X||X.size<=0){var z={};return is(z),H.isFunction(T)&&T(z._errorCode,z._errorString),yt}var K=X.size,oe=X.type;if(O+=K,""===oe||oe&&oe!=x.contentType){var ue=X.name,ye=(X.slice||X.webkitSlice||X.mozSlice).call(X,0,K,x.contentType);H.isString(ue)&&""!=ue||(ue=X.fileName),ye.name=Tc(ue,D+1),U[D]=ye}U[D].remoteFilename=Tc(x.remoteFilename,D+1),X=null}if(O>P&&-1!=P){var Ie={};return bf(Ie),H.isFunction(T)&&T(Ie._errorCode,Ie._errorString),yt}for(me.cancelFrom=Zn.HTTPUpload,R=dfe(C,x,S,T),x=null,D=0;D<U.length;D++)U[D]=null;return U=null,R}function tg(C){me.dlgRef<=0||0==me.dialogShowStatus||Hp(C)}(function(C){C.Init=-1,C.OK=0,C.Failed=1,C.Cancelled=2})(ufe||(ufe={})),me.setBtnCancelVisibleForProgress=Hp;var Af,Pf=v(function C(){n(this,C)},[{key:"_onProgress",value:function(C,x,S){var T=0===S.total?100:Math.round(100*S.loaded/S.total);[S.loaded," / ",S.total].join(""),C.onPercent([0,T,"","http",x])}},{key:"_uploadBlobFragment",value:function(C,x,S,T){var O,U,G,D=x.fileName,R=x.blockSize,P=0,X=x.offset,z=this,K=function(Ue,He){x.content=null,H.isFunction(T)&&T(Ue,He)};if((O=x.content).size<=0){var oe={};return is(oe),K(oe._errorCode,oe._errorString),yt}if((U=(P=O.size)-X)>0){var ae;if(U>=R&&R>0?(U-=R,G=R):(G=U,U=0),!(ae=0==X&&G==P?O:O.slice(X,X+G))){var ue={};is(ue),K(ue._errorCode,ue._errorString)}if(!C.IfShowProgressBar||C.IfShowProgressBar&&me.dlgRef>0){ae.name=D,tg(C.IfShowCancelDialogWhenImageTransfer),x.headers["Content-Range"]=["bytes ",X,"-",X+ae.size-1,"/",P].join(""),z._onProgress(C,D,{total:P,loaded:X});var ye=H.clone(x);return ye.content=ae,ye.offset=0,z.httpPostUpload(C,ye,function(Ue){0==U&&(me.needShowTwiceShowDialog=!1),z._onProgress(C,D,{total:P,loaded:X+G}),0==U?(x.content=null,H.isFunction(S)&&ws(S,Ue)):(x.offset=x.offset+G,setTimeout(function(){z._uploadBlobFragment(C,x,S,K)},100))},K),!0}var Ie={};return gu(Ie),K(Ie._errorCode,Ie._errorString),!1}return me.needShowTwiceShowDialog=!1,x.content=null,H.isFunction(S)&&S(""),!0}},{key:"httpPostUploadFragment",value:function(C,x,S,T){var D;if(!(D=x.content)){var R={};return is(R),H.isFunction(T)&&T(R._errorCode,R._errorString),yt}if(H.isString(D)){if(""==D){var P={};return is(P),H.isFunction(T)&&T(P._errorCode,P._errorString),yt}var O=new Blob([D],{type:"text/plain"});O.name=x.fileName,x.content=O,O=null}return me.cancelFrom=Zn.HTTPUpload,this._uploadBlobFragment(C,x,S,T)}},{key:"httpPostUpload",value:function(C,x,S,T){var D,R,P=x.bAsync,O=function(Oe,Ge){var Se;return x.content=null,x=null,H.isFunction(T)&&T(Oe,Ge,null!==(Se=null==C?void 0:C.HTTPPostResponse)&&void 0!==Se?Se:""),!1};if(!(D=x.content)){var U={};return is(U),O(U._errorCode,U._errorString),!!P&&void 0}if(H.isString(D)){var G,X=x.fileName;if(""==D){var z={};return is(z),O(z._errorCode,z._errorString),!!P&&void 0}if(D.length>(G=C.MaxUploadImageSize)&&-1!=G){var K={};return bf(K),O(K._errorCode,K._errorString),!!P&&void 0}(R=new Blob([D],{type:"text/plain"})).name=X,D=null}else if(D instanceof Blob&&(R=D,D=null,R.size<=0)){var oe={};return is(oe),O(oe._errorCode,oe._errorString),!!P&&void 0}if(R){var ae,ye=C.MaxUploadImageSize,Ie=R.size,Ue=R.type;if(Ie>ye&&-1!=ye){var He={};return bf(He),O(He._errorCode,He._errorString),!!P&&void 0}""===Ue||Ue&&Ue!=x.contentType?ae.name=(ae=(R.slice||R.webkitSlice||R.mozSlice).call(R,0,Ie,x.contentType))instanceof File?ae.fileName:R.name||R.fileName:ae=R,R=null,ae&&(x.content=ae),ae=null}tg(C.IfShowCancelDialogWhenImageTransfer),me.cancelFrom=Zn.HTTPUpload;var Re=dfe(C,x,function(Oe){return x.content=null,x=null,H.isFunction(S)&&S(Oe),Oe=null,!0},O);return P?void 0:!!Re}}]),Cd=v(function C(){n(this,C),this.method="",this.httpMethod="POST",this.contentType="application/octet-stream",this.remoteFilename="RemoteFile",this.blockSize=0,this.offset=0,this.retry=0,this.bOnlyResponseEmptyIsOK=!0,this.bAsync=!0,this.responseType=_u.Text}),ffe=v(function C(){n(this,C),this.IfShowProgressBar=!1,this.IfShowCancelDialogWhenImageTransfer=!0});!function(C){C.URL=0,C.Blob=1,C.Base64=2}(Af||(Af={}));var NP=window.SparkMD5,yW=v(function C(x,S,T,D){n(this,C);var R=this;R._md5=T,R._length=S,R._content=D},[{key:"getLength",value:function(){return this._length}},{key:"getMD5",value:function(){return this._md5}},{key:"getData",value:function(C,x){var S=this,T=x;return H.isNumber(C)&&H.isNumber(x)?C<0||x<=0?"":0==C&&T==S._length?S._content:(C+T>S._length&&(T=S._length-C),S._content.substr(C,T)):""}}]);me.html5.Base64Result=yW;var pfe=function(C){function x(Re){var Oe,Se,de;return n(this,x),de=[Re],Se=qn(Se=x),(Oe=Za(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(ge){return!1}}()?Reflect.construct(Se,de||[],qn(this).constructor):Se.apply(this,de))).__maxUploadImageSize=-1,Oe._strHttpContentTypeFieldValue="application/octet-stream",Oe}return el(x,C),v(x,[{key:"_saveBlob",value:(He=_t(B.mark(function Re(Oe,Ge){var Se,de;return B.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(Se=this,!be.navInfo.bIE){ge.next=7;break}return ge.next=5,Se._innerSaveLocal(Oe,Ge);case 5:ge.next=11;break;case 7:return de=URL.createObjectURL(Oe),ge.next=10,Se._innerSaveLocal(de,Ge);case 10:URL.revokeObjectURL(de);case 11:Oe=null;case 12:case"end":return ge.stop()}},Re,this)})),function(Re,Oe){return He.apply(this,arguments)})},{key:"_saveImages",value:(Ue=_t(B.mark(function Re(Oe,Ge,Se,de){var ge,_e,ve,Te,We,Ye;return B.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return ge=this,_e=LP(Ge,de),ve=km(ge,Se),me.cancelFrom=Zn.Other,Be.next=5,ge._innerConvertToArrayBufferWithUIAsync(Oe,de,ve);case 5:return Te=Be.sent,We=zn.getBlobTypeByImageType(de),Ye=new Blob([Te],{type:We}),Be.next=10,ge._saveBlob(Ye,_e);case 10:Ye=null;case 11:case"end":return Be.stop()}},Re,this)})),function(Re,Oe,Ge,Se){return Ue.apply(this,arguments)})},{key:"_innerSaveLocal",value:(Ie=_t(B.mark(function Re(Oe,Ge){return B.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.abrupt("return",new me.Promise(function(de,ge){var _e=window,ve=be.navInfo;if(!ve.biPad&&!ve.biPhone||_e.requestFileSystem||_e.webkitRequestFileSystem||_e.mozRequestFileSystem||!(he.bSafari&&parseFloat(he.strBrowserVersion)<13)&&he.bSafari){var We=document.createElementNS("http://www.w3.org/1999/xhtml","a");if(We.href=Oe,We.download=Ge,We.target="_blank",document.body.appendChild(We),ve.bEdge)We.click(),Oe=null,We.href=null;else if(ve.bIE){var Ye;(Ye=window.navigator)&&"msSaveOrOpenBlob"in Ye&&Ye.msSaveOrOpenBlob(Oe,Ge)}else{var Be=document.createEvent("MouseEvents");Be.initMouseEvent("click",!0,!1),We.dispatchEvent(Be)}setTimeout(function(){document.body.removeChild(We),We=null,de()},6e3)}else{var $e=_e.open(Oe,"","",!1);setTimeout(function(){$e.document.title=Ge,de()},6e3)}}));case 2:case"end":return Se.stop()}},Re,this)})),function(Re,Oe){return Ie.apply(this,arguments)})},{key:"_OnPostTransferAsync",value:function(Re,Oe,Ge){var Se,de=this;if(Re&&Re.length>=2)try{var ge=String(Re[1]).replace(/\\/g,"\\\\");Se=H.parse(ge),!Ge&&Se.imageId&&(Se.imageId=de._serverId2uidFromServer(Se.imageId))}catch(ve){H.log(Re)}Se||(Se={imageId:""});var _e=!1;if(H.isFunction(de.__OnPostTransferAsync))try{_e=de.__OnPostTransferAsync(Se)}catch(ve){Nr(ve)}if(H.isFunction(de.__OnPostTransferAsync2))try{de.__OnPostTransferAsync2(Se)}catch(ve){Nr(ve)}return _e}},{key:"_checkIndices",value:function(Re,Oe){return mfe(Re,!H.isUndefined(Oe)&&Oe>=0?Oe:this._imageBufferWrapper.count(),this)}},{key:"_acquireImageForSendTo",value:(ye=_t(B.mark(function Re(Oe,Ge,Se,de){var ge,_e,ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(ge=this,_e=Se?H.clone(Se):{},Te=ve=de,ge._resetErr(),ge._isValid()){ze.next=4;break}throw{code:ge._errorCode,message:ge._errorString};case 4:if(H.isString(ve._id)){ze.next=6;break}throw{code:-2602,message:'The parameter "SendTo" is invalid.'};case 6:if(!ge.__bAcquireImageNow){ze.next=9;break}throw Ple(ge),{code:ge._errorCode,message:ge._getErrorString()};case 9:if(ge.__bAcquireImageNow=!0,Wo(Oe,Te),We=me.Promise.resolve(),Ye=be.DWT.RemoteScanConfig,Be=vue(),ze.prev=13,Oue(_e),Ye&&aP(Ye.keepAwake),mn.checkProductKey(ge,{Core:!0})&&ge._isValid()){ze.next=18;break}throw{code:ge._errorCode,message:ge._errorString};case 18:return Ql._innerSendHeartBeat(ve,!1),$e=function(){var Ct=_t(B.mark(function bt(Vt){return B.wrap(function(In){for(;;)switch(In.prev=In.next){case 0:We=We.then(function(){return new me.Promise(function(yn,xt){var Pt=[ge._uidFromServer2ServerId(Vt.imageId)],It=be.DWT.EnumDWT_ImageType.IT_PNG;me.cancelFrom=Zn.Scan,ge._innerConvertToArrayBufferAsync(It,Pt).then(function(Wt){var en;ve._bltsCopyImage=!0,ve.__LoadImageFromBytesV2(Wt,It,"",!0,0,0,!1,0,(en=_t(B.mark(function Cn(hn,Dr){var Hn;return B.wrap(function(di){for(;;)switch(di.prev=di.next){case 0:return Hn=ge._uidFromServer2ServerId(Vt.imageId),Dr?(H.log("LoadImageFromBinary success"),ve._bltsCopyImage=!1,Vt.imageId=ve._uidFromServer2ServerId(Dr.ids),H.isFunction(ve._OnPostTransferAsync)&&ve._OnPostTransferAsync([!0,H.stringify(Vt)],null,!0)):H.log("LoadImageFromBinary return null."),yn(),di.next=5,ge._removeImageByIdAsync(Hn);case 5:case"end":return di.stop()}},Cn)})),function(Cn,hn){return en.apply(this,arguments)}),function(en,Cn){H.log(Cn),ve._bltsCopyImage=!1,xt({code:en,message:Cn})})},function(Wt){Wt&&Wt.message&&H.log(Wt.message),xt(Wt)})})});case 1:case"end":return In.stop()}},bt)}));return function(bt){return Ct.apply(this,arguments)}}(),ge._registerEvent("OnPostTransferAsync2",$e),null!=Ge&&(_e.Device=Ge.strDevice,_e.DeviceMatchField=R0.SMF_NAME),ze.next=24,ge._acquireImageFromServiceAsync(_e);case 24:ze.next=29;break;case 26:throw ze.prev=26,ze.t0=ze.catch(13),ze.t0;case 29:return ze.prev=29,ze.prev=30,ze.next=33,We;case 33:ze.next=37;break;case 35:ze.prev=35,ze.t1=ze.catch(30);case 37:return ge._unregisterEvent("OnPostTransferAsync2"),ge.__bAcquireImageNow=!1,Xr(Oe),aP(Be),ze.finish(29);case 42:case"end":return ze.stop()}},Re,this,[[13,26,29,42],[30,35]])})),function(Re,Oe,Ge,Se){return ye.apply(this,arguments)})},{key:"_uidFromServer2index",value:function(Re){var Oe,Ge=this;return Ge._resetErr(),!!Ge._isValid()&&(H.isString(Re)?(-1==(Oe=Ge._imageBufferWrapper._uidFromServer2index(Re))&&Zle(Ge),Oe):(Ule(Ge),-1))}},{key:"_index2uidFromServer",value:function(Re){var Oe=this;if(Oe._resetErr(),!Oe._isValid())return!1;var Ge=parseInt(Re);return isNaN(Ge)?(Jn(Oe),""):Ge<0||Ge>=this._imageBufferWrapper.count()?(Mt(Oe),""):Oe._imageBufferWrapper._index2uidFromServer(Re)}},{key:"__LoadImageFromBytesV2",value:function(Re,Oe,Ge,Se,de,ge,_e,ve,Te,We){var Ye,Be=this,$e=Oe||3,ze=0,Ct=Re.name,bt=!0,Vt=1;Re&&(ze=Re instanceof Blob?Re.size:$p(Re)?Re.byteLength:Re instanceof Array?Re.length:Re.size||Re.byteLength||Re.length),!isNaN(de)&&de>=0&&!isNaN(ge)&&ge>0?Vt=0:(de=0,ge=0),Ye=["[",ze,",",0,",",$e,',"',Ge,'",',de,",",ge,",",ve,",",Vt,",",_e?"true":"false","]"].join("");var yn=function(){if(Be.__bLoadingImage=!1,bt){var xt=Be._imageBufferWrapper.getCurrentImageIndex();xt>=0&&Be._innerRefreshUI(xt)}return H.isFunction(We)&&We(Be._errorCode,Be._getErrorString(),Ct),!1};return mn.checkProductKey(Be,{Core:!0})||he.bWin&&mn.checkProductKey(Be,{Webcam:!0},!0)?mn.checkPDFProductKeyWhenNeeds(Be,Oe)?0===ze?(St(Be,-2312,"The file length is empty."),bt=!1,yn()):this._innerSendBlob("LoadImageFromBytes",Ye,Re,Se,Vt,function(xt){if(Be.__bLoadingImage=!1,Be._isBindViewer()){var Pt=Be._imageBufferWrapper.getCurrentImageIndex();Se&&Pt>=0&&Be._innerRefreshUI(Pt)}if(H.isFunction(Te)){var It=xt;if(H.isArray(It)&&(It=It.length>0?It[0]:{}),Se)setTimeout(function(){Te(Ct,It)},30);else try{Te(Ct,It)}catch(Wt){H.error(Wt.message)}}return Be._canConsume()&&be.DWT.lcvrf(Be),!0},yn):(bt=!1,yn()):(mn.checkProductKey(Be,{Core:!0},!1),bt=!1,yn())}},{key:"_innerSendBlob",value:function(Re,Oe,Ge,Se,de,ge,_e){var Te,We,Ye,Be,ve=this;return Ql.isServerInvalid(ve)?ve._waitForConnect().then(function(){ve._innerSendBlob(Re,Oe,Ge,Se,de,ge,_e)}):Se?(ve._innerSendBlobByWS(Re,Oe,Ge,ge,_e),!0):(ve._resetErr(),!!ve._isValid()&&(We=[ve._httpUrl,"f/",Re].join(""),Ye=M0(ve._clientId,Re,Oe,0,ve._bScanForProxyRemote),Ye+="\r\n\r\n",Be={method:"POST",url:We,processData:!1,data:Ye+=H.base64.encodeArray(Ge),async:!1,onSuccess:function($e,ze,Ct){var bt=!1,Vt=!1;try{bt=H.isString($e)&&"text/json"===Ct.getResponseHeader("content-type")?H.parse($e):$e}catch(Pt){}if(null!=bt&&(wc(bt)?(ve._errorCode=bt.exception,ve._errorString=bt.description):ve._resetErr(),(Te=bt.result)&&H.isArray(Te)&&Te.length>=1))if(de){var In,yn=Te[0];yn&&H.isObject(yn)&&(In=yn.imageInfos,0==ve._errorCode&&H.isString(In)&&ve._handleOnBitmapChangedEvent({result:["c1",In]},{document:Ge.currentFileName,tag:Ge.currentTagName}),Vt=!0)}else{var xt=Te.join(",");0==ve._errorCode&&xt.length>0&&ve._OnBitmapChanged(["c1",xt,1,ve._imageBufferWrapper.getCurrentImageIndex(),ve._imageBufferWrapper.count()],null,{document:Ge.currentFileName,tag:Ge.currentTagName}),Vt=!0}Vt||(aB(ve),Te="")},onError:function(){jA(ve),Te=""}},H.mix(Be,{headers:{"X-Requested-With":!1}}),he.bFileSystem&&(Be.crossDomain=!1),du(Be),0==ve._errorCode?H.isFunction(ge)&&ge():H.isFunction(_e)&&_e(),Te))}},{key:"_convertToBase64ByServerIdsWithUI",value:function(Re,Oe,Ge,Se,de,ge,_e){this._convertToBase64ByServerIdsWithUIAsync(Re,Ge,Oe,Se).then(function(ve){H.isFunction(ge)&&ws(ge,ve)},function(){H.isFunction(_e)&&_e()})}},{key:"_OnPercentDone",value:function(Re){var Oe,Ge,Se,de,ge,_e=this,ve=!1,Te=!1,We=0;H.isArray(Re)&&Re.length>2&&(Ge=Re[0],Se=Re[2],Re.length>3&&(de=Re[3]),Re.length>4&&(ge=Re[4]),Oe=We=Re[1],We<0?Oe=0:We>100&&(Oe=100),Oe=Math.floor(Oe),me.cancelFrom!=Zn.HTTPUpload&&me.cancelFrom!=Zn.HTTPDownload&&me.cancelFrom!=Zn.Scan&&me.cancelFrom!=Zn.HTTPPut||(Te=ge)),(_e._bServerPercentDone||0==Ge)&&((We>0||0==We)&&(me.cancelFrom!=Zn.HTTPUpload&&me.cancelFrom!=Zn.HTTPDownload&&me.cancelFrom!=Zn.FTPUpload&&me.cancelFrom!=Zn.FTPDownload&&me.cancelFrom!=Zn.HTTPPut||(ve=!0)),_e.IfShowProgressBar&&me.progressBarOnPercentDone(We,Se,de,Oe,Te,this._containerElement),1==ve&&(H.isFunction(_e.__OnInternetTransferPercentage)&&_e.__OnInternetTransferPercentage(Oe,!1),H.isFunction(_e.__OnInternetTransferPercentageEx)&&_e.__OnInternetTransferPercentageEx(Oe,!1)),H.isFunction(_e.__OnPercentDone)&&_e.__OnPercentDone())}},{key:"IfShowProgressBar",get:function(){return this._bIfShowProgressBar},set:function(Re){this._resetErr(),H.isBoolean(Re)?this._bIfShowProgressBar=Re:ga(this)}},{key:"IfShowCancelDialogWhenImageTransfer",get:function(){return this.__IfShowCancelDialogWhenImageTransfer},set:function(Re){this._resetErr(),H.isBoolean(Re)?this.__IfShowCancelDialogWhenImageTransfer=Re:ga(this)}},{key:"_getLogLevel",value:function(){return this._logLevel}},{key:"_setLogLevel",value:(ue=_t(B.mark(function Re(Oe){return B.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return this._logLevel=Oe,Ge.next=3,this._innerFunV2("LogLevel",Et(Oe));case 3:case"end":return Ge.stop()}},Re,this)})),function(Re){return ue.apply(this,arguments)})},{key:"MaxUploadImageSize",get:function(){return this.__maxUploadImageSize},set:function(Re){this._resetErr();var Ge=1*Re;!H.isNumber(Ge)||isNaN(Ge)?ga(this):this.__maxUploadImageSize=Ge}},{key:"HTTPRequestswithCredentials",get:function(){return this._resetErr(),this._bWithCredentials},set:function(Re){this._resetErr(),H.isBoolean(Re)?this._bWithCredentials=Re:ga(this)}},{key:"cancelableObj",get:function(){return this._cancelableObj},set:function(Re){this._cancelableObj=Re}},{key:"_getProfile",value:(ae=_t(B.mark(function Re(Oe){var Ge,Se;return B.wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if((Ge=this)._resetErr(),Ge._isValid()){de.next=4;break}throw{code:Ge._errorCode,message:Ge._errorString};case 4:return Oe&&(Se=H.stringify([Oe.strDevice])),de.abrupt("return",Ge._innerFunV2("GetCustomDSDataEx",Se));case 6:case"end":return de.stop()}},Re,this)})),function(Re){return ae.apply(this,arguments)})},{key:"_setProfile",value:(oe=_t(B.mark(function Re(Oe,Ge){var Se,de;return B.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if((Se=this)._resetErr(),Se._isValid()){ge.next=4;break}throw{code:Se._errorCode,message:Se._errorString};case 4:return de=Oe?H.stringify([Ge,Oe.strDevice]):Et(Ge),ge.abrupt("return",this._innerFunV2("SetCustomDSDataEx",de));case 6:case"end":return ge.stop()}},Re,this)})),function(Re,Oe){return oe.apply(this,arguments)})},{key:"_removeAllImagesAsync",value:(K=_t(B.mark(function Re(Oe,Ge){var Se,de,ge,_e,ve,Te;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if((Se=this)._resetErr(),Se._isValid()){We.next=4;break}throw{code:Se._errorCode,message:Se._errorString};case 4:for(ge=[],ve=Se._getHowManyImagesInBuffer(),_e=ve-1;_e>=0;_e--)(Te=Se._imageBufferWrapper.convertClientIndexToServerId(_e))>-1&&ge.push(Te);if(0!=ge.length){We.next=13;break}return We.next=10,Se._innerFunV2("RemoveAllImages");case 10:de=We.sent,We.next=23;break;case 13:if(!Ge){We.next=19;break}return We.next=16,Se._innerFunV2("RemoveAllImages",Et(ge.join(",")));case 16:de=We.sent,We.next=22;break;case 19:return We.next=21,Se._innerFunV2("RemoveAllImages");case 21:de=We.sent;case 22:(de||-1033==Se._errorCode)&&Se._OnBitmapChanged(["c1",ge.join(","),3,Se._imageBufferWrapper.getCurrentImageIndex(),Se._imageBufferWrapper.count()]);case 23:return We.abrupt("return",de);case 24:case"end":return We.stop()}},Re,this)})),function(Re,Oe){return K.apply(this,arguments)})},{key:"__OnRecieveMsg",value:function(Re,Oe){var Ge=this,Se=null==Oe?void 0:Oe.cmd;if(Re.event)return va(qn(x.prototype),"__OnRecieveMsg",this).call(this,Re,Oe);if(wc(Re)?(Ge._errorCode=Re.exception,Ge._errorString=Re.description):"StartScan"!=Se&&"GetAddOnVersion"!=Se&&(Ge._errorCode=0,Ge._errorString=""),"ReadBarcode"==Se||"OCRRecognize"==Se||Re.request&&"OCRProRecognize"==Re.request.method)return Oe.sFun?(Oe.sFun(Re),!0):(Oe.fFun&&Oe.fFun(Re),!0);if("SetCapabilities"==Se||"GetSkewAngleFromBinary"==Se||"UpdateImage"==Se)return"exception"in Re&&"0"!=Re.exception?(Re.result.errorCode&&Re.result.errorString?(Ge._errorCode=Re.result.errorCode,Ge._errorString=Re.result.errorString):(Ge._errorCode=Re.exception,Ge._errorString=Re.description),Oe.fFun&&Oe.fFun(Re.result),Re=null,!0):(Oe.sFun&&Oe.sFun(Re.result),Re=null,!0);if(Re.result&&Re.result.length&&("1"==Re.result[0]||1==Re.result[0]||"ok"==Re.result[0]))return(Oe.sFun||Oe.sFun)&&Oe.sFun(Re.result),!0;if(!Re.exception)return Oe.sFun&&Oe.sFun(Re.result),Re=null,!0;var de=!1;return Oe.fFun&&(de=Oe.fFun(Ge._errorString)),!de&&Re.exception&&Re.exception<0&&-2115!=Re.exception&&H.isFunction(Ge.__OnPrintMsg)&&Ge.__OnPrintMsg(Ge._errorString),!0}},{key:"_convertServerIdToGuid",value:function(Re){return this._serverId2uidFromServer(Re)}},{key:"_convertGuidToServerId",value:function(Re){return this._uidFromServer2ServerId(Re)}},{key:"_serverId2uidFromServer",value:function(Re){return this._imageBufferWrapper._serverId2uidFromServer(Re)}},{key:"_uidFromServer2ServerId",value:function(Re){return this._imageBufferWrapper._uidFromServer2ServerId(Re)}},{key:"_innerConvertToBlobWithUI",value:function(Re,Oe,Ge,Se,de,ge){var _e=this,ve=arguments,Te=function(We){if(me.needShowTwiceShowDialog=!1,H.isFunction(ge)){var Ye=[];H.isArray(Ge)&&H.each(Ge,function(Be){var $e=_e._imageBufferWrapper.convertServerIdToClientIndex(Be);$e>-1&&Ye.push($e)}),We&&(_e._errorCode=We.code,_e._errorString=We.message),ge(Ye)}return!1};_e._innerConvertToArrayBufferWithUIAsync(Re,Oe,Ge,Se).then(function(We){if(!We||We.byteLength<=0)return Wle(_e),Te();var Ye=_e.__maxUploadImageSize;if(We.byteLength>Ye&&-1!=Ye)return bf(_e),Te();if(me.needShowTwiceShowDialog=!1,H.isFunction(de)){var Be=[];H.isArray(Ge)&&H.each(Ge,function(Ct){var bt=_e._imageBufferWrapper.convertServerIdToClientIndex(Ct);bt>-1&&Be.push(bt)});var $e=zn.getBlobTypeByImageType(Oe),ze=new Blob([We],{type:$e});try{de(ze,Be,ve)}catch(Ct){}ze=null}return!0},Te)}},{key:"convertToBlob",value:(z=_t(B.mark(function Re(Oe,Ge,Se){var de,ge,_e,ve;return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return ge=km(de=this,Ge),me.cancelFrom=Zn.ConvertToBlob,Te.next=4,de._innerConvertToArrayBufferWithUIAsync("convertToBlob",Oe,ge,Se);case 4:return _e=Te.sent,ve=zn.getBlobTypeByImageType(Oe),Te.abrupt("return",new Blob([_e],{type:ve}));case 7:case"end":return Te.stop()}},Re,this)})),function(Re,Oe,Ge){return z.apply(this,arguments)})},{key:"_innerConvertToArrayBufferWithUIAsync",value:(X=_t(B.mark(function Re(Oe,Ge,Se,de,ge){var _e,ve,Te,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:return ve=this,We=null===(_e=me.progressContext)||void 0===_e?void 0:_e.IfShowCancelDialogWhenImageTransfer,Ye.prev=2,ve.IfShowProgressBar?me.showProgress(ve,Oe,!1):me.hideProgress(),ve._OnPercentDone([0,-1,Br.Encoding]),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1),Ye.next=8,this._innerConvertToArrayBufferAsync(Ge,Se,de,ge);case 8:Te=Ye.sent;case 9:return Ye.prev=9,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=We),ve.IfShowProgressBar&&me.closeProgress(null,Oe),Ye.finish(9);case 13:return Ye.abrupt("return",Te);case 14:case"end":return Ye.stop()}},Re,this,[[2,,9,13]])})),function(Re,Oe,Ge,Se,de){return X.apply(this,arguments)})},{key:"_innerConvertToBase64Async",value:(G=_t(B.mark(function Re(Oe,Ge,Se){var de,ge,_e,ve,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return de=this,H.isString(ge=Se)&&""!=ge||(ge="{}"),_e=["[",Oe,',"',Ge.join(","),'",',ge,",1]"].join(""),ze.next=5,de._sendDataByHttpAsync("ConvertToBase64",_e,"text",!0);case 5:if(Be=(ve=ze.sent)&&ve.result,0==de._errorCode){ze.next=9;break}throw{code:de._errorCode,message:de._errorString};case 9:if(!Be||!H.isArray(Be)||3!=Be.length){ze.next=17;break}return $e=new yW(null,Be[1],Be[2],Be[0]),ze.abrupt("return",$e);case 17:throw St(de,-2366,"Converting images to a base64 string failed."),{code:de._errorCode,message:de._errorString};case 19:case"end":return ze.stop()}},Re,this)})),function(Re,Oe,Ge){return G.apply(this,arguments)})},{key:"_convertToBase64ByServerIdsWithUIAsync",value:(U=_t(B.mark(function Re(Oe,Ge,Se,de){var ge,_e,ve;return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return _e=this,ve=null===(ge=me.progressContext)||void 0===ge?void 0:ge.IfShowCancelDialogWhenImageTransfer,Te.prev=2,_e.IfShowProgressBar?me.showProgress(_e,Oe,!1):me.hideProgress(),_e._OnPercentDone([0,-1,Br.Encoding]),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=_e.IfShowCancelDialogWhenImageTransfer),Te.next=8,this._innerConvertToBase64Async(Ge,Se,de);case 8:return Te.abrupt("return",Te.sent);case 9:return Te.prev=9,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ve),_e.IfShowProgressBar&&me.closeProgress(null,Oe),Te.finish(9);case 13:case"end":return Te.stop()}},Re,this,[[2,,9,13]])})),function(Re,Oe,Ge,Se){return U.apply(this,arguments)})},{key:"_convertToBlobForUpload",value:function(Re,Oe,Ge,Se,de,ge,_e){var ve=this,Te=arguments;if(be.DWT.ConnectWithSocket){var We=Ge,Ye=",";H.isString(We)&&""!=We||(We="",Ye="");var Be=["[",Re,',"',Oe.join(","),'"',Ye,We,"]"].join("");return me.cancelFrom=Zn.ConvertToBlob,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1),ve._sendData("ConvertToBlob",Be,!0,function($e){ve._resetErr();var ze=$e;if(ze){if(ze instanceof Blob||$p(ze))return void de(ze,"",Te);wc(ze)&&(ve._errorCode=ze.exception,ve._errorString=ze.description)}},function($e){ve._errorCode=$e.code,ve._errorString=$e.message,ge($e)}),!0}ve._innerConvertToArrayBufferAsync(Re,Oe,Ge,"arraybuffer").then(function($e){var Ct=new Blob([$e],{type:ve._strHttpContentTypeFieldValue});if(be.DWT.IfAddMD5InUploadHeader){var bt=new NP.ArrayBuffer;bt.append($e),H.isFunction(de)&&de(Ct,bt.end(),Te)}else H.isFunction(de)&&de(Ct,"",Te);Ct=null},function($e){ge($e.code,$e.message)})}},{key:"dispose",value:function(){return this.__unload()}},{key:"_innerDisposeWSClient",value:function(){return this._isValid()?this._sendData("dispose",null,!0,function(){},function(){}):me.Promise.reject()}},{key:"__unload",value:(O=_t(B.mark(function Re(){var Oe,Ge;return B.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(!(Oe=this)._bReady||me.page.bUnload){Se.next=10;break}if(!Oe._wsClient){Se.next=10;break}return Se.prev=3,Se.next=6,Oe._innerDisposeWSClient();case 6:Se.next=10;break;case 8:Se.prev=8,Se.t0=Se.catch(3);case 10:if(!Oe._wsClient){Se.next=24;break}return Oe._wsClient.removeEvent("close",Oe._clientId),Oe._wsClient.removeEvent("error",Oe._clientId),Oe._wsClient.removeEvent("timeout",Oe._clientId),Se.prev=14,Se.next=17,Oe._wsClient.dispose();case 17:Se.next=22;break;case 19:Se.prev=19,Se.t1=Se.catch(14),Ge=Se.t1;case 22:delete Oe._wsClient,Oe._wsClient=null;case 24:if(this._imageBufferWrapper.dispose(),this._bReady=yt,this._destroy=Nt,!Ge){Se.next=29;break}throw Ge;case 29:case"end":return Se.stop()}},Re,this,[[3,8],[14,19]])})),function(){return O.apply(this,arguments)})},{key:"_getImages",value:(P=_t(B.mark(function Re(Oe,Ge,Se,de){var ge,_e,ve,Te;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if((ge=this)._checkIndices(Ge)){We.next=3;break}throw{code:this._errorCode,message:this._errorString};case 3:if(de!=Af.URL){We.next=9;break}if(!(Ge.length>1)){We.next=7;break}throw St(this,-2619,"Only single index selection is allowed when enumImageFormatType is set to url."),{code:this._errorCode,message:this._errorString};case 7:We.next=13;break;case 9:if(Se!=be.DWT.EnumDWT_ImageType.IT_BMP&&Se!=be.DWT.EnumDWT_ImageType.IT_JPG&&Se!=be.DWT.EnumDWT_ImageType.IT_PNG){We.next=13;break}if(!(Ge.length>1)){We.next=13;break}throw hje(this),{code:this._errorCode,message:this._errorString};case 13:if(de!=Af.URL){We.next=17;break}return We.abrupt("return",this._imageBufferWrapper.getImageUrl(Ge[0]));case 17:if(me.cancelFrom=Zn.Other,_e=km(ge,Ge),de!=Af.Blob){We.next=27;break}return We.next=22,this._innerConvertToArrayBufferWithUIAsync(Oe,Se,_e);case 22:return ve=We.sent,Te=zn.getBlobTypeByImageType(Se),We.abrupt("return",new Blob([ve],{type:Te}));case 27:if(de!=Af.Base64){We.next=31;break}return We.next=30,this._convertToBase64ByServerIdsWithUIAsync(Oe,Se,_e);case 30:return We.abrupt("return",We.sent);case 31:throw dje(this),{code:this._errorCode,message:this._errorString};case 33:case"end":return We.stop()}},Re,this)})),function(Re,Oe,Ge,Se){return P.apply(this,arguments)})},{key:"_LicensePromptExpired",value:function(){var Re=this,Oe=Re.__licenseInfo.bTrial,Ge="";Re.__licenseInfo&&Re.__licenseInfo.ExpireDate&&(Ge=Re.__licenseInfo.ExpireDate);var Se=Xce(Ge);Se<=0&&(Oe||Nr(Re._getErrorString()),H.isFunction(be.OnLicenseExpiredWarning)&&be.OnLicenseExpiredWarning(Ge,Se,Oe))}},{key:"__saveToViewerAfterUpdate",value:function(Re,Oe){var Ge=this,Se=this._imageBufferWrapper.getIndexByUid(Re),de=this._imageBufferWrapper.convertClientIndexToServerId(Se),ge=cr.getUrlByAct(this._imageBufferWrapper.BaseUrl,de,2);return new me.Promise(function(_e,ve){du({method:"GET",xhrFields:{withCredentials:!0},url:ge,onSuccess:function(Te){var We,Ye=Ge._imageBufferWrapper.getMetadataByIndex(Se);Ye||(Ye={}),Ye.width=Oe.width,Ye.height=Oe.height,We=be.navInfoSync.bMobile?Ge._imageBufferWrapper.getMinImageUrl(Se,Math.round(Ye.controlWidth*devicePixelRatio),Math.round(Ye.controlHeight*devicePixelRatio)):Ge._imageBufferWrapper.getMinImageUrl(Se,Ye.controlWidth,Ye.controlHeight);var Be=Ge._imageBufferWrapper.getImageIdMap(de);if(Be){Be.ticks=Date.now(),Be.imageUrl=Ge._imageBufferWrapper.getImageUrl(Se),Be.minImageUrl=We,Be.width=Oe.width,Be.height=Oe.height;var $e=H.clone(Be);$e.imageId=de,Ge._imageBufferWrapper.UpdateImage($e,Ye)}_e()},onError:function(){_e(),Xr("save")}})})}},{key:"RunCommandAsync",value:(R=_t(B.mark(function Re(Oe){var Ge,Se,de,ge,_e;return B.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(Ge=this,Oe&&H.isString(Oe.command)&&Oe.parameter){ve.next=4;break}throw Bi(Ge),{code:Ge._errorCode,message:Ge._errorString};case 4:if("Invert"!=Oe.command){ve.next=6;break}return ve.abrupt("return",Ge._invert(Oe.parameter.index));case 6:if(!H.isNumber(Se=Oe.parameter.index)){ve.next=13;break}if(!(isNaN(Se)||!H.isNumber(Se)||Se<0||Se>=Ge._imageBufferWrapper.count())){ve.next=11;break}throw Mt(Ge),{code:Ge._errorCode,message:Ge._errorString};case 11:ve.next=15;break;case 13:throw Jn(Ge),{code:Ge._errorCode,message:Ge._errorString};case 15:return de=Ge._imageBufferWrapper.convertClientIndexToServerId(Se),Oe.parameter.index=de,ge=["[",H.stringify(Oe),"]"].join(""),ve.next=20,Ge._innerFunRawV3("runCommand",ge);case 20:if(_e=ve.sent,!he.bIE){ve.next=25;break}if(!H.isString(_e)){ve.next=24;break}return ve.abrupt("return",H.parse(_e));case 24:return ve.abrupt("return",_e);case 25:return ve.next=27,_e.json();case 27:return ve.abrupt("return",ve.sent);case 28:case"end":return ve.stop()}},Re,this)})),function(Re){return R.apply(this,arguments)})},{key:"_innerFunRawV3",value:(D=_t(B.mark(function Re(Oe,Ge){var Se,de,ge;return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(ge="fa/",(Se=this)._resetErr(),Se._isValid()){_e.next=4;break}throw{code:Se._errorCode,message:Se._errorString};case 4:if(!Ql.isServerInvalid(Se)){_e.next=7;break}return _e.abrupt("return",Se._waitForConnect().then(function(){return Se._innerFunRawV3(Oe,Ge)}));case 7:return de={method:"post",body:M0(Se._clientId,Oe,Ge,0,Se._bScanForProxyRemote),fetchRaw:!0},_e.next=10,nC([Se._httpUrl,ge,Oe].join(""),de);case 10:return _e.abrupt("return",_e.sent);case 11:case"end":return _e.stop()}},Re,this)})),function(Re,Oe){return D.apply(this,arguments)})},{key:"_invert",value:(T=_t(B.mark(function Re(Oe){var Ge,Se,de,_e;return B.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(Ge=this,Se=parseInt(Oe),Ge._resetErr(),Ge._isValid()){ve.next=4;break}throw{code:Ge._errorCode,message:Ge._errorString};case 4:if(!isNaN(Se)){ve.next=7;break}throw Jn(Ge),{code:Ge._errorCode,message:Ge._errorString};case 7:if(!(Se<0||Se>=Ge._imageBufferWrapper.count())){ve.next=10;break}throw Mt(Ge),{code:Ge._errorCode,message:Ge._errorString};case 10:if(-1!=(de=Ge._imageBufferWrapper.convertClientIndexToServerId(Se))){ve.next=14;break}throw Mt(Ge),{code:Ge._errorCode,message:Ge._errorString};case 14:return ve.next=16,Ge._innerFunV2("Invert",Et(de),!0);case 16:if(!(_e=1==ve.sent)){ve.next=22;break}zn.refreshImageAfterInvokeFun(Ge,Se),ve.next=23;break;case 22:throw{code:Ge._errorCode,message:Ge._errorString};case 23:return ve.abrupt("return",_e);case 24:case"end":return ve.stop()}},Re,this)})),function(Re){return T.apply(this,arguments)})}],[{key:"create",value:(S=_t(B.mark(function Re(Oe){var Ge;return B.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Ge=new x(Oe),Se.next=3,Ql.STwainConnectToServer(Ge);case 3:return Se.abrupt("return",Ge);case 4:case"end":return Se.stop()}},Re)})),function(Re){return S.apply(this,arguments)})}]);var S,T,D,R,P,O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He}(_qe);function gfe(C){var S="",T=!1;if(C.__licenseInfo&&(C.__licenseInfo.ExpireDate&&(S=C.__licenseInfo.ExpireDate),T=C.__licenseInfo.bTrial),T&&!be.DWT.HideTrialMessage){var D=Xce(S);D<=5&&(H.isFunction(be.OnLicenseExpiredWarning)&&be.OnLicenseExpiredWarning(S,D,!0),be.DWT.HideTrialMessage=!0)}}function mfe(C,x,S){var T;if(!H.isArray(C))return tC(S),!1;if(0==C.length)return St(S,-2350,"The indices cannot be empty."),!1;if(be.DWT.ConnectWithSocket)return!0;for(T=0;T<C.length;T++){var D=C[T];if(H.isUndefined(D)||null===D)return Lle(S),!1;if(D=parseInt(D),isNaN(D))return Jn(S),!1;if(D<0||D>=x)return Fle(S),!1}return!0}var vh={changeImageUISize:function(C,x,S){var T,D,R,P,O=x,U=S,G=yt;T=pt.one(C._containerElement),H.isString(x)&&x.indexOf("%")>=0?(0==(R=pt.css(T,"width"))&&(T[0].style.width="100%"),R=pt.css(T,"width")*parseInt(x)/100,G=Nt):O=[(R=parseInt(x))+2,"px"].join(""),H.isString(S)&&S.indexOf("%")>=0?(0==(P=pt.css(T,"height"))&&(T[0].style.height="100%"),P=pt.css(T,"height")*parseInt(S)/100,G=Nt):U=[(P=parseInt(S))+2,"px"].join(""),T&&(D=pt.one(".dynamsoft-dwt-container-box",T))&&D.getEL()&&(D.style("width",O),D.style("height",U)),G?(C.__funResize||(C.__funResize=function(){if(C._ImgManager&&C._containerElement){var z=vh.__innerGetUIViewRealSize(C._containerElement,C._width,C._height);return C._UIView.ChangeSize(z.width,z.height)}return Nt}),H.removeEventListener(window,"resize",C.__funResize),H.addEventListener(window,"resize",C.__funResize)):C.__funResize&&(H.removeEventListener(window,"resize",C.__funResize),C.__funResize=yt);var X=vh.__innerGetUIViewRealSize(C._containerElement,R,P);return C._ImgManager?C._UIView.ChangeSize(X.width,X.height):Nt},__innerGetUIViewRealSize:function(C,x,S){var T,D=-1,R=-1;return T=pt.one(C),H.isString(x)&&x.indexOf("%")>=0&&(D=pt.css(T,"width")*parseInt(x)/100),D<0&&x&&(D=parseInt(x)),H.isString(S)&&S.indexOf("%")>=0&&(R=pt.css(T,"height")*parseInt(S)/100),R<0&&S&&(R=parseInt(S)),{width:D,height:R}},bindUIViewEvents:function(C,x){var S=C;x.onSelected=function(T){if(!S._isNoViewer()){var D,R=T.length;R>0&&(S._ImgManager.SetSelectedImageCount(R),D=T[R-1],H.isFunction(S.__OnRefreshUI)&&S.__OnRefreshUI(D))}},x.onRefreshUI=function(T){S._isNoViewer()||vh.__innerRefreshFromUIView(S,T)},x.onResetCurrentIndex=function(T){if(!S._isNoViewer()){var D=S._ImgManager.getCurrentImageIndex();if(T>=0&&T<S._ImgManager.count()&&D!=T&&H.isFunction(S.__OnIndexChangeDuringDragDrop))try{S.__OnIndexChangeDuringDragDrop(D,T)}catch(R){Nr(R)}}},x.onMouseMove=function(T){if(!S._isNoViewer()){var D=T.index;if(T){var P=T.y;S.__MouseX=T.x,S.__MouseY=P}if(H.isFunction(S.__OnMouseMove))try{S.__OnMouseMove(D)}catch(O){Nr(O)}}},x.onMouseClick=function(T){if(!S._isNoViewer()){var D=T.index;if(T){var P=T.y;S.__MouseX=T.x,S.__MouseY=P}if(H.isFunction(S.__OnMouseClick))try{S.__OnMouseClick(D)}catch(O){Nr(O)}}},x.onMouseDoubleClick=function(T){if(!S._isNoViewer()){var D=T.index;if(H.isFunction(S.__OnMouseDoubleClick))try{S.__OnMouseDoubleClick(D)}catch(R){Nr(R)}}},x.onMouseRightClick=function(T){if(!S._isNoViewer()){var D=T.index;if(T){var P=T.y;S.__MouseX=T.x,S.__MouseY=P}if(H.isFunction(S.__OnMouseRightClick))try{return S.__OnMouseRightClick(D)}catch(O){Nr(O)}return Nt}},x.onImageAreaSelected=function(T){if(!S._isNoViewer()&&H.isFunction(S.__OnImageAreaSelected))try{S.__OnImageAreaSelected(T.index,T.left,T.top,T.right,T.bottom,T.areaIndex)}catch(D){Nr(D)}},x.onImageAreaDeSelected=function(T){if(!S._isNoViewer()&&H.isFunction(S.__OnImageAreaDeSelected))try{S.__OnImageAreaDeSelected(T)}catch(D){Nr(D)}},x.onBufferChanged=function(T){if(H.isFunction(S.__OnBufferChanged))try{S.__OnBufferChanged(T)}catch(D){Nr(D)}}},__innerRefreshFromUIView:function(C,x){var S=C;H.isFunction(S.__OnRefreshUI)&&S.__OnRefreshUI(x)}};function Wi(C,x,S){x in C||Object.defineProperty(C,x,S)}var bqe=v(function C(x){n(this,C);var S=this;S._parent=x,Wi(S,"width",{get:function(){return this._parent._width},set:function(T){this.SetSize(T,!1)}}),Wi(S,"height",{get:function(){return this._parent._height},set:function(T){this.SetSize(!1,T)}})},[{key:"SetSize",value:function(C,x){var S,T=this._parent,D=!1,R=!1;return!!T._isBindViewer()&&(H.isString(C)&&C.length>0&&"%"===C.charAt(C.length-1)&&(D=C),!D&&C&&(S=parseInt(C))&&(D=S+"px"),H.isString(x)&&x.length>0&&"%"===x.charAt(x.length-1)&&(R=x),!R&&x&&(S=parseInt(x))&&(R=S+"px"),D&&(T._width=D),R&&(T._height=R),vh.changeImageUISize(T,D,R))}}]);function vfe(C){var x,S,D,R=C._config;me.dlgProgress||me.initProgress(C),R.bNoViewer?C._containerElement=null:(R.container?C._containerElement=R.container:R.containerId&&(C._containerElement=H.get(R.containerId)),C._width=R.width,C._height=R.height,x=pt.one(C._containerElement)),function(P,O){var U={Stwain:P},G=yt;if(O){var X,z=P._width,K=P._height;X=pt.one(P._containerElement),H.isString(z)&&z.indexOf("%")>=0?(z=pt.css(X,"width")*parseInt(z)/100,G=Nt):z=parseInt(z),H.isString(K)&&K.indexOf("%")>=0?(K=pt.css(X,"height")*parseInt(K)/100,G=Nt):K=parseInt(K),U={Stwain:P,Container:O,Width:z,Height:K}}vh.bindUIViewEvents(P,U),P._UIView?P._UIView._Init(U):P._UIView=new me.UI.ImageUIView(P,U),P.Width<=0&&(P.Width=270),P.Height<=0&&(P.Height=350),G&&vh.changeImageUISize(P,P._width,P._height)}(C,x),C._isBindViewer()&&((S=C).__OnImageAreaDeSelected=(D=C._config||{}).onImageAreaDeSelected||"",S.__OnImageAreaSelected=D.onImageAreaSelected||"",S.__OnMouseClick=D.onMouseClick||"",S.__OnMouseDoubleClick=D.onMouseDoubleClick||"",S.__OnMouseMove=D.onMouseMove||"",S.__OnMouseRightClick=D.onMouseRightClick||"",S.__OnTopImageInTheViewChanged=D.onTopImageInTheViewChanged||"",S.__OnBufferChanged=D.onBufferChanged||"",C.__OnMouseClick=R.onMouseClick||"",C.__OnThumbnailMouseClick="",C.__OnKeyDown=R.onKeyDown||"",C.__OnMouseWheel=R.onMouseWheel||"",C.__OnMouseDoubleClick=R.onMouseDoubleClick||"",C.__OnMouseRightClick=R.onMouseRightClick||"",C.__OnMouseMove=R.onMouseMove||"",C.__OnImageAreaSelected=R.onImageAreaSelected||"",C.__OnImageAreaDeSelected=R.onImageAreaDeSelected||"",C.__OnRefreshUI=R.onRefreshUI||"",C.__OnBufferChanged=R.onBufferChanged||"",C.__MouseX=0,C.__MouseY=0,C.__style=new bqe(C),C.__fSelectionRectAspectRatio=0)}function BP(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function o3(C,x,S){return x.has(C),S}var yfe=new WeakSet,xqe=new WeakSet,_W=new WeakSet,CW=new WeakSet,wqe=function(C){function x(z){var K,ae,ue;return n(this,x),ue=[z],ae=qn(ae=x),BP(K=Za(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(ye){return!1}}()?Reflect.construct(ae,ue||[],qn(this).constructor):ae.apply(this,ue)),CW),BP(K,_W),BP(K,xqe),BP(K,yfe),K}return el(x,C),v(x,[{key:"_getWSContextData",value:function(){return{document:this._getCurrentDocumentName(),tag:this._getCurrentDefaultTagName(),bNeedClearTag:!1}}},{key:"_getErrorString",value:function(){var z=this;return-2207==z._errorCode&&z._bMustUpgradeService&&Q1(z),0!=z._errorCode?z._errorString:"Successful."}},{key:"_getWebTwainId",value:function(){return this._id}},{key:"_isTwainServiceType",value:function(){return!0}},{key:"_isPC",value:function(){return he.bWin||he.bMac||he.bLinux}},{key:"_serviceSyncMethodNotSupport",value:function(z){var K=this;return St(K,-2605,'The synchronized method "'+z+'" is not supported under the current settings.'),{code:K._errorCode,message:K._getErrorString()}}},{key:"_serviceAsyncMethodNotSupport",value:function(z){var K=this;return St(K,-2606,'The asynchronized method "'+z+'" is not supported under the current settings.'),{code:K._errorCode,message:K._getErrorString()}}},{key:"_serviceNotSupportAsync",value:function(z){var K=this;return St(K,-2397,z+" doesn't work under current settings."),pt.Promise.reject({code:K._errorCode,message:K._getErrorString()})}},{key:"_nouiNotSupport",value:function(z,K){return St(this,-2210,"You cannot call this method on this WebTwain instance because it does not use the default viewer."),H.isFunction(K)&&K(this._errorCode,this._getErrorString()),!1}},{key:"_innerFunRaw",value:function(z,K,oe,ae,ue,ye,Ie){var Ue,He,Re,Oe,Ge=this,Se="f/",de=oe;if(de&&(Se="fa/"),be.DWT.ConnectWithSocket)this._sendData(z,K,!1,ye,Ie);else{if(Ge._resetErr(),!Ge._isValid())return!!de&&void 0;var ge=Ql.isServerInvalid(Ge);if(de&&ge)return Ge._waitForConnect().then(function(){return Ge._innerFunRaw(z,K,de,ae,ue,ye,Ie)});if(!de&&ge)return Gle(Ge),!1;if(Re={method:"POST",url:Ue=[Ge._httpUrl,Se,z].join(""),data:He=M0(Ge._clientId,z,K,0,Ge._bScanForProxyRemote),async:de,onSuccess:function(ve,Te,We){var Ye=!1;try{Ye=H.isString(ve)&&"text/json"===We.getResponseHeader("content-type")?H.parse(ve):ve}catch(Be){}Ye?(wc(Ye)?(Ge._errorCode=Ye.exception,Ge._errorString=Ye.description):Ge._resetErr(),Oe=ue?Ye:Ye.result):(aB(Ge),Oe=""),H.isFunction(ye)&&ye(Oe),de&&(Oe=null)},onError:function(){jA(Ge),Oe="",!me.page.bUnload&&H.isFunction(Ie)&&Ie()}},!de&&ae)he.bIE?(Re.dataType="arraybuffer",Re.onSuccess=function(ve,Te,We){var Ye,Be,$e,ze=!1;if(We.responseHeadersString&&-1!=We.responseHeadersString.indexOf("text/json")&&(ze=!0),Ye=We.responseData,Ge._resetErr(),Oe=!1,Ye&&(Be=new Uint8Array(Ye),ze?Ye=String.fromCharCode.apply(null,Be):(Oe=new Blob([Be],{type:Ge._strHttpContentTypeFieldValue}),($e=new NP.ArrayBuffer).append(Be),Oe.md5=$e.end())),!Ye||ze){var Ct,bt=!1;if((Ct=ze?Ye:We.responseText).length>0){if("{"==Ct.charAt(0))try{bt=H.parse(Ct),ze=!0}catch(Vt){H.log(Ct)}ze?wc(bt)?(Ge._errorCode=bt.exception,Ge._errorString=bt.description,Oe=!1):Oe=!0:(Be=new Uint8Array(Ct),Oe=new Blob([Be],{type:Ge._strHttpContentTypeFieldValue}),($e=new NP.ArrayBuffer).append(Be),Oe.md5=$e.end())}}H.isFunction(ye)&&ye(Oe)}):(de||(Re.dataType="text",Re.contentType="text/plain; charset=x-user-defined",Re.mimeType="text/plain; charset=x-user-defined"),Re.onSuccess=function(ve,Te,We){var Ye,Be,$e;if(Ge._resetErr(),(Be=(Ye=We.responseText).length)>0){var ze,Ct=!1;if("{"==Ye.charAt(0))try{ze=H.parse(Ye),Ct=!0}catch(In){H.log(Ye)}if(Ct)wc(ze)?(Ge._errorCode=ze.exception,Ge._errorString=ze.description,Oe=!1):Oe=!0;else{$e=new Uint8Array(Be);for(var bt=0;bt<Be;bt++)$e[bt]=Ye.charCodeAt(bt);Oe=new Blob([$e],{type:Ge._strHttpContentTypeFieldValue});var Vt=new NP.ArrayBuffer;Vt.append($e),Oe.md5=Vt.end()}}else Oe="";H.isFunction(ye)&&ye(Oe)});else if(de&&ae){Re={method:"POST",body:He},he.bIE?Re.dataType="arraybuffer":Re.fetchRaw=!0;var _e=nC(Ue,Re);return he.bIE||(_e=_e.then(function(ve){var Te=ve.headers.get("content-type");return Te.indexOf("image/")>=0||Te.indexOf("application/octet-stream")>=0?ve.arrayBuffer():ve.json()})),_e=_e.then(function(ve){if(Ge._resetErr(),$p(ve))return H.isFunction(ye)&&ye(ve),void(ve=null);if(H.isObject(ve)){var Te=ve;if(wc(Te))Ge._errorCode=Te.exception,Ge._errorString=Te.description,H.isFunction(Ie)&&Ie();else{var We="";Te.result&&(We=Te.result),H.isFunction(ye)&&ye(We)}}else jA(Ge),!me.page.bUnload&&H.isFunction(Ie)&&Ie()},function(ve){jA(Ge),!me.page.bUnload&&H.isFunction(Ie)&&Ie()}),!0}if(de||H.mix(Re,{headers:{"X-Requested-With":!1}}),he.bFileSystem&&(Re.crossDomain=!1),du(Re),!de)return Oe}}},{key:"_innerSendCmd",value:function(z,K){this._innerFunRaw(z,K,!0,!1,!0)}},{key:"_innerFun",value:function(z,K){var oe;return oe=this._innerFunRaw(z,K,!1,!1,!1),H.isArray(oe)?oe[0]:oe}},{key:"__OnRecieveMsg",value:function(z,K){var oe=this,ae=null==K?void 0:K.cmd;if(z.event)return va(qn(x.prototype),"__OnRecieveMsg",this).call(this,z,K);if(be.DWT.ConnectWithSocket)return va(qn(x.prototype),"__OnRecieveMsg",this).call(this,z,K);if(wc(z)?(oe._errorCode=z.exception,oe._errorString=z.description):"StartScan"!=ae&&"GetAddOnVersion"!=ae&&(oe._errorCode=0,oe._errorString=""),"ReadBarcode"==ae||"OCRRecognize"==ae||z.request&&"OCRProRecognize"==z.request.method)return K.sFun?K.sFun(z):K.fFun&&K.fFun(z),!0;if("ActiveUI"==ae||"VersionInfo"==ae||"ConvertToBase64"==ae||"SaveSelectedImagesToBase64Binary"==ae||"ConvertToBlob"==ae||"BeginSaveMem"==ae)return K.sFun&&H.isArray(z.result)&&z.result.length>0?K.sFun(z.result):K.fFun&&K.fFun(z.result),!0;if("ShowFileDialog"==ae||"SplitTiff"==ae||"SplitPDF"==ae||"EncodeAsBase64"==ae||"ProductKey"==ae||"GetSourceNames"==ae||"GetSkewAngle"==ae||"GetImageInfo"==ae||"GetSkewAngleFromBinary"==ae)return K.sFun?K.sFun(z.result):K.fFun&&K.fFun(z.result),!0;if("SetCapabilities"==ae)return va(qn(x.prototype),"__OnRecieveMsg",this).call(this,z,K);if(z.result&&z.result.length&&("1"==z.result[0]||1==z.result[0]||"ok"==z.result[0]))(K.sFun||K.sFun)&&K.sFun(K.rawData?z:z.result);else{if(!z.exception)return K.sFun&&K.sFun(z.result),z=null,!0;var ue=!1;K.fFun&&(ue=K.fFun(oe._errorString)),!ue&&z.exception&&z.exception<0&&-2115!=z.exception&&H.isFunction(oe.__OnPrintMsg)&&oe.__OnPrintMsg(oe._errorString)}return!0}},{key:"OnRefreshUI",value:function(z,K,oe,ae){return this._innerRefreshUI(z,K,oe,ae)}},{key:"GetCurrentDocumentName",value:function(){return this._resetErr(),!!this._isValid()&&this._getCurrentDocumentName()}},{key:"RegisterEvent",value:function(z,K){return!!this.registerEvent(z,K)}},{key:"UnregisterEvent",value:function(z,K){return this.unregisterEvent(z,K)}},{key:"onEvent",value:function(z,K){this.registerEvent(z,K)}},{key:"on",value:function(z,K){this.registerEvent(z,K)}},{key:"_OnConsumed",value:function(z){}},{key:"_OnPostLoad",value:function(z,K){var oe,ae,ue,ye,Ie=this;void 0!==K&&void 0!==K.exception&&void 0!==K.description&&(Ie._errorCode=K.exception,Ie._errorString=K.description),H.log("OnPostLoad Results:"),ae=z[1].split(","),oe=H.base64.decode(ae[0]),ue=H.base64.decode(ae[1]),H.log(oe),H.log(ue),H.log(ae[2]),bfe(Ie,"On PostLoad"),(ye=Ie._ImgManager.getCurrentImageIndex())>=0&&Ie._innerRefreshUI(ye),H.isFunction(Ie.__OnPostLoad)&&Ie.__OnPostLoad(oe,ue,ae[2])}},{key:"_OnPostTransfer",value:function(z){var K=this;if(H.log("On PostTransfer Results:"+z),bfe(K,"On PostTransfer"),H.isFunction(K.__OnPostTransfer))try{K.__OnPostTransfer()}catch(oe){Nr(oe)}}},{key:"_OnPreAllTransfersAsync",value:function(z){var K=this;if(H.isFunction(K.__OnPreAllTransfersAsync)){var oe={event:"beforeAcquire",result:{}};try{H.isArray(z)&&z.length>1&&(oe=H.parse(z[1]))}catch(ae){}setTimeout(function(){try{K.__OnPreAllTransfersAsync(oe)}catch(ae){Nr(ae)}},10)}}},{key:"_OnPostAllTransfers",value:function(z){var K=this;if(z.length>=2&&0==K._errorCode&&(K._errorCode=z[1],K._errorString=z[2]),H.log("On PostAllTransfers Results:"+z),K.__bLoadingImage=!1,K.__bAcquireImageNow=!1,K.__closeRemoteScanUI(!0),H.isFunction(K.__OnPostAllTransfers))try{K.__OnPostAllTransfers()}catch(oe){Nr(oe)}}},{key:"_OnResult",value:function(z){var K=z[1];if(H.isFunction(this.__OnResult))try{this.__OnResult(K)}catch(oe){Nr(oe)}}},{key:"_OnTransferCancelled",value:function(z){var K=this;if(K._ImgManager.getCurrentImageIndex(),K._ImgManager.count(),K.__bLoadingImage=!1,K.__bAcquireImageNow=!1,H.isFunction(K.__OnTransferCancelled))try{K.__OnTransferCancelled()}catch(oe){Nr(oe)}}},{key:"_OnTransferError",value:function(z){if(H.isFunction(this.__OnTransferError))try{this.__OnTransferError()}catch(K){Nr(K)}}},{key:"_OnSourceUIClose",value:function(z){var K=this;if(K.__closeRemoteScanUI(!0),H.isFunction(K.__OnSourceUIClose))try{K.__OnSourceUIClose()}catch(oe){Nr(oe)}}},{key:"_OnPreTransfer",value:function(z){if(H.isFunction(this.__OnPreTransfer))try{this.__OnPreTransfer()}catch(K){Nr(K)}}},{key:"_OnPreAllTransfers",value:function(z){if(H.isFunction(this.__OnPreAllTransfers))try{this.__OnPreAllTransfers()}catch(K){Nr(K)}}},{key:"_OnGetFilePath",value:function(z){var K,oe,ae;if(K=z[1].split(","),H.log("On GetFilePath Results:"+z),oe=H.base64.decode(K[3]),ae=H.base64.decode(K[4]),"-1032"==K[2]&&(K[2]="-1",oe=ae=""),H.isFunction(this.__OnGetFilePath))try{this.__OnGetFilePath(1*K[0]>0,1*K[1],1*K[2],oe,ae)}catch(ye){Nr(ye)}this.__bOpenFileNow=!1}},{key:"_OnDiskExceedLimit",value:function(){H.isFunction(this.__OnDiskExceedLimit)&&this.__OnDiskExceedLimit()}},{key:"__GetLoadEventsNum",value:function(){var z=0;return H.isFunction(this.__OnPostLoad)&&(z|=1),H.isFunction(this.__OnGetFilePath)&&(z|=2),z}},{key:"_innerSend",value:function(z,K,oe,ae,ue){if(be.DWT.ConnectWithSocket||"SaveSelectedImagesToBytes"!=z&&"ConvertToBlob"!=z)return this._sendData(z,K,oe,ae,ue);var Ie=US(),Ue=M0(this._clientId,z,K,Ie,this._bScanForProxyRemote);return this._innerFunRaw(z,Ue,!0,!0,!0,ae,ue),pt.Promise.resolve(!0)}},{key:"_convertToBlobByIndices",value:function(z,K,oe,ae,ue,ye){var Ie=this,Ue=!1,He=function(Ge){H.isFunction(ye)&&ma(ye,Ie,Ge,K,ae),Ge=null};if(H.isFunction(ue)&&(Ue=!0),Ie._resetErr(),!Ie._isValid())return He(z),!!Ue&&void 0;var Re=parseInt(K);if(!mn.checkProductKey(Ie,{Core:!0})||!Ie._checkIndices(z))return He(z),!!Ue&&void 0;if(Re==be.DWT.EnumDWT_ImageType.IT_BMP||Re==be.DWT.EnumDWT_ImageType.IT_JPG||Re==be.DWT.EnumDWT_ImageType.IT_PNG||Re==be.DWT.EnumDWT_ImageType.IT_J2K){if(z.length>1)return St(Ie,-2372,"You cannot convert more than one image to binary when the format is BMP, JPG or PNG."),He(z),!!Ue&&void 0}else if(Re!=be.DWT.EnumDWT_ImageType.IT_TIF&&Re!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(Ie),He(z),!!Ue&&void 0;var Oe=km(Ie,z);return 0==Oe.length?(Jn(Ie),He(z),!!Ue&&void 0):Ue?(me.cancelFrom=Zn.ConvertToBlob,void Ie._innerConvertToBlobWithUI("ConvertToBlob",Re,Oe,oe,function(Ge,Se){H.isFunction(ue)&&ws(ue,Ge,Se,K,ae),Ge=Se=null},He)):o3(Ie,yfe,Sqe).call(Ie,Oe,Re,oe)}},{key:"_getDefaultDevice",value:function(){var z=this;if(z._resetErr(),!z._isValid())return null;var K="",oe=tn.TWAINSCANNER,ae=z._innerFun("GetDefaultSourceName");if(ae.length>0)try{var ue=JSON.parse(ae);oe=ue.type,K=H.base64.decode(ue.ProductName)}catch(Ie){K=""}var ye=new hd;return ye.name=K,ye.deviceType=oe,ye.isSystemDefaultPrinter=!1,ye.displayName=oe==tn.TWAINX64SCANNER&&K.length>0?"Twain64-"+K:oe==tn.WIASCANNER&&K.length>0?"WIA-"+K:oe==tn.ESCLSCANNER&&K.length>0?"ESCL-"+K:oe==tn.ICASCANNER&&z.__serverPlatform==Rn.enumMac&&K.length>0?"ICA-"+K:K,ye}},{key:"_getDefaultDeviceAsync",value:(X=_t(B.mark(function z(){var K,oe,ae,ue,ye,Ie;return B.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if((K=this)._resetErr(),K._isValid()){Ue.next=4;break}return Ue.abrupt("return",null);case 4:return oe="",ae=tn.TWAINSCANNER,Ue.next=8,K._sendDataByHttpAsync("GetDefaultSourceName");case 8:if((ue=Ue.sent).length>0)try{ye=JSON.parse(ue),ae=ye.type,oe=H.base64.decode(ye.ProductName)}catch(He){oe=""}return(Ie=new hd).name=oe,Ie.deviceType=ae,Ie.isSystemDefaultPrinter=!1,Ie.displayName=ae==tn.TWAINX64SCANNER&&oe.length>0?"Twain64-"+oe:ae==tn.ICASCANNER&&K.__serverPlatform==Rn.enumMac&&oe.length>0?"ICA-"+oe:oe,Ue.abrupt("return",Ie);case 16:case"end":return Ue.stop()}},z,this)})),function(){return X.apply(this,arguments)})},{key:"_getSources",value:function(z,K,oe){return mue(this,this._innerFun("GetSources",Et(z,null!=K&&K,null!=oe&&oe)))}},{key:"_getSourceCountAsync",value:(G=_t(B.mark(function z(K){var oe,ae,ue,ye,Ie,Ue,He;return B.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if((oe=this)._resetErr(),oe._isValid()){Oe.next=4;break}return Oe.abrupt("return",pt.Promise.reject({code:oe._errorCode,message:oe._errorString}));case 4:return o3(oe,_W,_fe).call(oe),Wo("GetSourceCountAsync",oe),ae=[],Oe.prev=7,K&&(oe._driverType=K),ue=yt,ye=yt,Ie=yt,Ue=yt,oe._bRemoteMode?oe.__serverPlatform==Rn.enumWindow?Ie=!0:oe.__serverPlatform==Rn.enumLinux?ye=!0:oe.__serverPlatform==Rn.enumMac?ue=!0:oe.__serverPlatform==Rn.enumAndroid&&(Ue=!0):(ue=he.bMac,ye=he.bLinux,Ie=he.bWin,Ue=he.bAndroid),He=cP(oe._driverType,Ie,ye,ue,Ue),Oe.next=15,this._getDevices(He,!0,void 0);case 15:ae=Oe.sent,Oe.next=21;break;case 18:throw Oe.prev=18,Oe.t0=Oe.catch(7),Oe.t0;case 21:return Oe.prev=21,Xr("GetSourceCountAsync"),Oe.finish(21);case 24:return Oe.abrupt("return",oe._setDevices(ae));case 25:case"end":return Oe.stop()}},z,this,[[7,18,21,24]])})),function(z){return G.apply(this,arguments)})},{key:"_setDevices",value:function(z){var K;return this.__devices=z,this.__sourceCount=K=z.length,K<=0?(this.__defaultSourceName="",this.__sourceCount=0,0):K}},{key:"_getSourceNameByIndex",value:function(z){return z<0||z>=this.__devices.length?"":this.__devices[z].displayName}},{key:"_dwtConvertToBlobSync",value:function(z,K,oe,ae,ue,ye){var Ue=oe,He=",";H.isString(Ue)&&""!=Ue||(Ue="",He="");var Re=["[",z,',"',K.join(","),'"',He,Ue,"]"].join(""),Oe=this._innerFunRaw("ConvertToBlob",Re,!1,!0,!1),Ge="";if(0==this._errorCode){Oe&&"md5"in Oe&&(Ge=Oe.md5);var Se=!0;return H.isFunction(ae)&&(Se=ae(Oe,Ge,ye)),Se}return H.isFunction(ue)&&on(ue,this),!1}},{key:"_getSourceCountSync",value:function(){var z,K=this,oe=yt,ae=yt,ue=yt,ye=yt;if(K._bRemoteMode?K.__serverPlatform==Rn.enumWindow?ue=!0:K.__serverPlatform==Rn.enumLinux?ae=!0:K.__serverPlatform==Rn.enumMac?oe=!0:K.__serverPlatform==Rn.enumAndroid&&(ye=!0):(oe=he.bMac,ae=he.bLinux,ue=he.bWin,ye=he.bAndroid),z=cP(this._driverType,ue,ae,oe,ye),K._resetErr(),!K._isValid()||!mn.checkProductKey(K,{Core:!0}))return 0;o3(K,_W,_fe).call(K);var Ue=K._getSources(z,!0,void 0);return K._setDevices(Ue)}},{key:"_OnActiveUI",value:(U=_t(B.mark(function z(K){var oe;return B.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return oe=this,K&&K.length>2&&(oe.__strProductName=K[2]),ae.next=4,va(qn(x.prototype),"_OnActiveUI",this).call(this,K);case 4:return ae.next=6,oe._setConvertModeAsync(oe._pdfConvertMode).catch(function(){});case 6:case"end":return ae.stop()}},z,this)})),function(z){return U.apply(this,arguments)})},{key:"_OnReady",value:(O=_t(B.mark(function z(){var K,ae,ue,ye;return B.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return bc((K=this)._serverInfo.server)&&(fd.item("DWT_port",K._serverInfo.port),fd.item("DWT_ssl",K._serverInfo.ssl?"true":"false")),K._bNoMask||Wo("OnReady",K),Ie.prev=3,Ie.next=6,va(qn(x.prototype),"_OnReady",this).call(this);case 6:if(!Qa()){Ie.next=12;break}if(K._uuidForActiveUI){Ie.next=12;break}return Ie.next=10,be.DWT.lgcuid(be.DWT.EnumInstance.dwt_desktop,"");case 10:K._uuidForActiveUI=Ie.sent;case 12:return Ie.next=14,K._innerActiveUI(K._uuidForActiveUI);case 14:return ae=Ie.sent,Ie.next=17,K._OnActiveUI(ae);case 17:if(lo("Changing Map..."),(ue=K._id)&&!be.DWT.WebTwainIdMap[ue]&&(be.DWT.WebTwainIdMap[ue]=K),vfe(K),ye=!1,K._bRemoteMode||(ye=me.attachAddon(K)),be.DWT.IfDisableDefaultSettings){Ie.next=29;break}return lo("Configuring the WebTwain instance..."),Ie.next=27,Tqe(K);case 27:Ie.next=32;break;case 29:if(!ye){Ie.next=32;break}return Ie.next=32,new pt.Promise(function(Ue){setTimeout(Ue,300)});case 32:Ie.next=39;break;case 34:throw Ie.prev=34,Ie.t0=Ie.catch(3),Ie.t0&&(K._errorCode=Ie.t0.code,K._errorString=Ie.t0.message),K.dispose(),Ie.t0;case 39:return Ie.prev=39,K._bNoMask||Xr("OnReady"),Ie.finish(39);case 42:case"end":return Ie.stop()}},z,this,[[3,34,39,42]])})),function(){return O.apply(this,arguments)})},{key:"_OnWSClose",value:function(z){va(qn(x.prototype),"_OnWSClose",this).call(this,z),me.detect.bOK=!1,this.__bAcquireImageNow=!1}},{key:"_OnWSTimeout",value:function(z){va(qn(x.prototype),"_OnWSTimeout",this).call(this,z),me.detect.bOK=!1}},{key:"_setConvertModeAsync",value:function(z){var K,oe=this,ae=1*z;return isNaN(ae)?(gB(oe),pt.Promise.reject({code:oe._errorCode,message:oe._errorString})):oe._checkConvertModeInner(ae)?(K=this._mixSavedPdfReaderOptions({convertMode:ae,renderOptions:{renderAnnotations:!!oe._pdfOptions.renderOptions.renderAnnotations}}),oe._resetPdfOptionsWhenSetConvertMode(K),o3(oe,CW,Cfe).call(oe,K,ae)):pt.Promise.reject({code:oe._errorCode,message:oe._errorString})}},{key:"_OnReconnected",value:(P=_t(B.mark(function z(){var K;return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return K=this,oe.next=3,o3(K,CW,Cfe).call(K,K._pdfOptions);case 3:case"end":return oe.stop()}},z,this)})),function(){return P.apply(this,arguments)})},{key:"_getConvertMode",value:function(){return this._pdfConvertMode}},{key:"_setConvertMode",value:function(z){var K,oe=this,ae=1*z;if(isNaN(ae))return gB(oe),!1;if(!oe._checkConvertModeInner(ae))return!1;K=this._mixSavedPdfReaderOptions({convertMode:ae,renderOptions:{renderAnnotations:!!oe._pdfOptions.renderOptions.renderAnnotations}}),oe._resetPdfOptionsWhenSetConvertMode(K);var ue=oe._setReaderOptions(K,!1);return ue&&(oe._pdfConvertMode=ae,oe._pdfOptions.convertMode=K.convertMode,oe._pdfOptions.renderOptions.renderAnnotations=K.renderOptions.renderAnnotations,oe._pdfOptions.convertMode==mr.CM_IMAGEONLY&&oe._pdfConvertMode==mr.CM_RENDERALL||oe._pdfOptions.convertMode==mr.CM_IMAGEONLY&&oe._pdfConvertMode==mr.CM_RENDERALLWITHANNOTATION)?(oe._pdfConvertMode=mr.CM_IMAGEONLY,Z1(oe),!1):ue}},{key:"_checkConvertModeInner",value:function(z){var K=this;return!(!mn.checkProductKey(K,{Core:!0})||(K._resetErr(),!K._isValid()||z!=mr.CM_RENDERALL&&z!=mr.CM_IMAGEONLY&&z!=mr.CM_AUTO&&z!=mr.CM_RENDERALLWITHANNOTATION&&(gB(K),1)))}},{key:"_resetPdfOptionsWhenSetConvertMode",value:function(z){var K=z.convertMode;z.convertMode=K==mr.CM_IMAGEONLY||mn.hasPDFRProductKey(this)?K:mr.CM_IMAGEONLY,z.convertMode==mr.CM_IMAGEONLY||z.convertMode==mr.CM_RENDERALL?z.renderOptions.renderAnnotations=!1:z.convertMode==mr.CM_RENDERALLWITHANNOTATION&&(z.renderOptions.renderAnnotations=!0)}},{key:"_checkPDFPasswordValue",value:function(z){if(!H.isUndefined(z)){if(!H.isString(z))return St(this,-2852,"The password is not a string."),!1;if(z.length>32)return St(this,-2851,"The password must not exceed 32 characters in length."),!1}return!0}},{key:"_mixSavedPdfReaderOptions",value:function(z){var K;return K=H.clone(this._pdfOptions),z||(z={}),z.convertMode&&(K.convertMode=z.convertMode),H.isString(z.password)?K.password=z.password:H.isNumber(z.password)&&(K.password=""+z.password),z.renderOptions&&(K.renderOptions=H.mix(this._pdfOptions.renderOptions,z.renderOptions)),K}},{key:"_setReaderOptions",value:function(z,K){var oe,ae,ue=this,ye=-1;if(ue._resetErr(),z&&z.renderOptions){var Ie=z.renderOptions.resolution,Ue=z.renderOptions.maxWidth,He=z.renderOptions.maxHeight,Re=z.renderOptions.renderGrayscale;if(!H.isUndefined(Ie)&&(!be.Lib.isNumber(Ie)||Ie<=0))return St(ue,-2830,"The PDF resolution must be a positive number."),!1;if(!H.isUndefined(Ue)&&(!be.Lib.isNumber(Ue)||Ue<0))return St(ue,-2831,"The PDF max width must be a positive number."),!1;if(!H.isUndefined(He)&&(!be.Lib.isNumber(He)||He<0))return St(ue,-2832,"The PDF max height must be a positive number."),!1;if(!H.isUndefined(Re)&&!be.Lib.isBoolean(Re))return function(ge){St(ge,-2833,"The PDF render grayscale must be a boolean.")}(ue),!1}if(K){z||(z={}),(oe={}).convertMode=z.convertMode?z.convertMode:mr.CM_AUTO,ye=oe.convertMode,oe.password=H.isString(z.password)?z.password:H.isNumber(z.password)?""+z.password:"",oe.renderOptions=H.mix({renderAnnotations:!1,resolution:200,maxWidth:0,maxHeight:0,renderGrayscale:!1},z.renderOptions);var Oe=oe.renderOptions.renderAnnotations;H.isBoolean(Oe)||H.isString(Oe)&&(oe.renderOptions.renderAnnotations="true"==Oe.toLowerCase());var Ge=oe.renderOptions.renderGrayscale;if(H.isBoolean(Ge)||H.isString(Ge)&&(oe.renderOptions.renderGrayscale="true"==Ge.toLowerCase()),H.isNumber(oe.convertMode)){if(!ue._checkConvertModeInner(oe.convertMode))return!1;mn.hasPDFRProductKey(ue)||(oe.convertMode=mr.CM_IMAGEONLY),oe.convertMode==mr.CM_IMAGEONLY?oe.renderOptions.renderAnnotations=!1:oe.convertMode==mr.CM_RENDERALLWITHANNOTATION&&(oe.renderOptions.renderAnnotations=!0)}}else{if(H.isUndefined(z))return function(ge){St(ge,-2834,"The PDF reader options is invalid.")}(ue),!1;if(oe=z,!H.isString(z.password)&&!H.isUndefined(z.password)){if(!H.isNumber(z.password))return function(ge){St(ge,-2829,"The type of the PDF password must be a string.")}(ue),!1;z.password=""+z.password}}var Se=ue._getPdfDllname();ae=["[",H.stringify(oe),',"',Se,'"',"]"].join("");var de=ue._innerFun("SetPDFReaderOptions",ae);return de&&K&&(ue._pdfOptions=H.clone(oe),H.isNumber(oe.convertMode)&&(oe.convertMode==mr.CM_RENDERALL&&oe.renderOptions.renderAnnotations&&(oe.convertMode=mr.CM_RENDERALLWITHANNOTATION),ue._pdfConvertMode=oe.convertMode,ue._pdfOptions.convertMode==mr.CM_IMAGEONLY&&ye==mr.CM_RENDERALL||ue._pdfOptions.convertMode==mr.CM_IMAGEONLY&&ye==mr.CM_RENDERALLWITHANNOTATION))?(ue._pdfConvertMode=mr.CM_IMAGEONLY,Z1(ue),!1):de}},{key:"_getPdfDllname",value:function(){var z=this,K=!1,oe=!1;return z._bRemoteMode?z.__serverPlatform==Rn.enumWindow||(z.__serverPlatform==Rn.enumLinux?oe=!0:z.__serverPlatform==Rn.enumMac&&(K=!0)):(K=he.bMac,oe=he.bLinux),K?z._b64bit?"libDynamicPdfCorex64_"+fu.PdfVersion+".dylib":"libDynamicPdfCore_"+fu.PdfVersion+".dylib":oe?"libDynamicPdfCore_"+fu.PdfVersion+".so":z._b64bit?"DynamicPdfCorex64_"+fu.PdfVersion+".dll":"DynamicPdfCore_"+fu.PdfVersion+".dll"}},{key:"_unload_viewer",value:function(){}},{key:"__innerDeleteInMap",value:function(){return delete be.DWT.WebTwainIdMap[this._id],Nt}},{key:"__unload",value:(R=_t(B.mark(function z(){var K,oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(K=this,oe=H.clone(be.DWT.licenseException),K.__closeRemoteScanUI(!0),!K._destroy&&!K._destroying){ye.next=5;break}return ye.abrupt("return");case 5:if(K._destroying=!0,this.__innerDeleteInMap(),K.__addon&&K.__addon.Camera&&K.__addon.Camera._viewer&&(""!=K.__addon.Camera.getStatus()&&K.__addon.Camera.closeSource().catch(function(){}),K.__addon.Camera._viewer.dispose(),K.__addon.Camera._viewer=null),K._unload_viewer(),K._containerElement=null,K._ImgManager&&K._ImgManager.clear(),!K._bReady||me.page.bUnload){ye.next=20;break}if(!K._wsClient){ye.next=20;break}return ye.prev=13,ye.next=16,K._innerDisposeWSClient();case 16:ye.next=20;break;case 18:ye.prev=18,ye.t0=ye.catch(13);case 20:if(!K._wsClient){ye.next=34;break}return K._wsClient.removeEvent("close",K._clientId),K._wsClient.removeEvent("error",K._clientId),K._wsClient.removeEvent("timeout",K._clientId),ye.prev=24,ye.next=27,K._wsClient.dispose();case 27:ye.next=32;break;case 29:ye.prev=29,ye.t1=ye.catch(24),ae=ye.t1;case 32:delete K._wsClient,K._wsClient=null;case 34:if(K._bReady=!1,be.DWT.lremoveDWTObj(K),K.__bAcquireImageNow=!1,K._destroying=!1,K._destroy=!0,(ue=be.DWT.licenseException).code=oe.code,ue.message=oe.message,ue.fromLTS=oe.fromLTS,!ae){ye.next=45;break}throw ae;case 45:case"end":return ye.stop()}},z,this,[[13,18],[24,29]])})),function(){return R.apply(this,arguments)})},{key:"_setIfShowUI",value:function(z){this._resetErr(),this._isValid()&&(H.isBoolean(z)?this._innerFun("IfShowUI",Et(z)):ga(self))}},{key:"_setIfShowFileDialog",value:function(z){this._resetErr(),this._isValid()&&(H.isBoolean(z)?this._innerFun("IfShowFileDialog",Et(z)):ga(self))}},{key:"_getDevicesAsync",value:(D=_t(B.mark(function z(K,oe,ae,ue){var ye,Ie,Ue,He,Re;return B.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if(ye=this,Ie=[],!oe||H.isNumber(oe)){Oe.next=4;break}return Bi(ye),Oe.abrupt("return",pt.Promise.reject({code:ye._errorCode,message:ye._errorString}));case 4:if(Ue=ye._bRemoteMode?WS:he.bAndroid?$B:WS,He=null!=oe?oe:Ue,ye._resetErr(),ye._isValid()){Oe.next=8;break}return Oe.abrupt("return",pt.Promise.reject({code:ye._errorCode,message:ye._errorString}));case 8:return Wo(K,ye),Oe.prev=9,Oe.next=12,ye._getDevices(He,ae,ue);case 12:H.isArray(Re=Oe.sent)&&Re.length>0&&(Ie=Ie.concat(Re)),Oe.next=19;break;case 16:throw Oe.prev=16,Oe.t0=Oe.catch(9),Oe.t0;case 19:return Oe.prev=19,Xr(K),Oe.finish(19);case 22:return Ie.length>0&&this._setDevices(Ie),Oe.abrupt("return",Ie);case 24:case"end":return Oe.stop()}},z,this,[[9,16,19,22]])})),function(z,K,oe,ae){return D.apply(this,arguments)})},{key:"_openSourceAsync",value:function(z){var K=this;return K._resetErr(),K._isValid()?(K._bRemoteMode&&K._initRemoteDiv(),K._innerFunV2("OpenSource").then(function(oe){return K.__closeRemoteScanUI(!0),oe},function(oe){return K.__closeRemoteScanUI(!0),pt.Promise.reject(oe)})):pt.Promise.reject({code:K._errorCode,message:K._errorString})}},{key:"_closeSourceAsync",value:function(z){var K=this;return K._resetErr(),K._isValid()?K._innerFunV2("CloseSource").then(function(){return K._curDevice=null,!0}):pt.Promise.reject({code:K._errorCode,message:K._errorString})}},{key:"_selectSourceAsync",value:function(z,K,oe){var ae=this;return ae._resetErr(),ae._isValid()?ae._getDevicesAsync(z,K).then(function(ue){var ye,Ie,Ue=document,He=ue?ue.length:0;pt.dialog.selectsourcedlg&&(pt.dialog.selectsourcedlg.close(),document.body.removeChild(pt.dialog.selectsourcedlg),pt.dialog.selectsourcedlg=!1);var Re,Oe,Ge,Se,de=-1;for((Ie=Ue.createElement("dialog")).className="dynamsoft-dialog-selectsource",he.bIE&&(Ie.style.width="300px"),Ie.setAttribute("closed","closed"),(Re=[]).push('<ul id="dynamsoft-dialog-selectsource-sourcelist-ul">'),ye=0;ye<He;ye++){var ge="",_e=ae._getSourceNameByIndex(ye);(""==ae.__defaultSourceName&&0==ye||ae.__defaultSourceName==_e)&&(ge=" dynamsoft-dialog-selectsource-sourcelist-li-selected",de=ye),Re.push('<li class="dynamsoft-dialog-selectsource-item'+ge+'" sourceindex='+ye+">"+_e+"</li>")}Re.push("</ul>"),Re=Re.join(""),H.isArray(oe)&&oe.length>=3?(Oe=oe[0],Ge=oe[1],Se=oe[2]):(Oe="Select Source:",Ge="Select",Se="Cancel");var ve=["<p>",Oe,"</p>",'<div id="dynamsoft-dialog-selectsource-sourcelist">',Re,"</div>",'<div><input type="button" value="',Ge,'" class="dynamsoft-dialog-selectsource-button-select">','<input type="button" value="',Se,'" class="dynamsoft-dialog-selectsource-button-cancel"></div>'].join("");return Ie.innerHTML=ve,pt.dialog.selectsourcedlg=Ie,Ue.body.appendChild(pt.dialog.selectsourcedlg),H.each(H.sizzle(".dynamsoft-dialog-selectsource-item"),function(Te,We){H.addEventListener(Te,"click",function(Ye){for(var Be=Ye.target,$e=Be.attributes.sourceindex.value,ze=Be.parentElement.children,Ct=0;Ct<ze.length;Ct++)ze[Ct].className="dynamsoft-dialog-selectsource-item";Be.className="dynamsoft-dialog-selectsource-item dynamsoft-dialog-selectsource-sourcelist-li-selected",H.get("dynamsoft-dialog-selectsource-sourcelist-ul").setAttribute("selectedSourceIndex",$e)})}),H.get("dynamsoft-dialog-selectsource-sourcelist-ul").setAttribute("selectedSourceIndex",de.toString()),pt.dialog.setup(pt.dialog.selectsourcedlg),pt.dialog.selectsourcedlg&&pt.dialog.selectsourcedlg.showModal(),new pt.Promise(function(Te,We){H.removeEventListener(pt.one(".dynamsoft-dialog-selectsource-button-select")[0],"click"),H.removeEventListener(pt.one(".dynamsoft-dialog-selectsource-button-cancel")[0],"click"),He>0&&H.addEventListener(pt.one(".dynamsoft-dialog-selectsource-button-select")[0],"click",function(){var Ye=parseInt(H.get("dynamsoft-dialog-selectsource-sourcelist-ul").getAttribute("selectedSourceIndex"));Ye<0||ae._selectSourceByIndexAsync(z,Ye).then(function(){pt.dialog.selectsourcedlg&&(pt.dialog.selectsourcedlg.close(),document.body.removeChild(pt.dialog.selectsourcedlg),pt.dialog.selectsourcedlg=!1),Te(Ye)})}),H.addEventListener(pt.one(".dynamsoft-dialog-selectsource-button-cancel")[0],"click",function(){pt.dialog.selectsourcedlg&&(pt.dialog.selectsourcedlg.close(),document.body.removeChild(pt.dialog.selectsourcedlg),pt.dialog.selectsourcedlg=!1);var Ye={};gu(Ye),We({code:Ye._errorCode,message:Ye._errorString})})})}):pt.Promise.reject({code:ae._errorCode,message:ae._errorString})}},{key:"_dwtGetCapabilities",value:function(z,K,oe){var ae=this,ue=null,ye=function(){H.isFunction(oe)&&oe(ae._errorCode,ae._errorString)};if(z){if(!H.isArray(z))return Bi(ae),void ye();if(0==z.length)return void(H.isFunction(K)&&K([]));if(!1===function(Ie,Ue){var He,Re,Oe,Ge;for(Ge=0;Ge<Ue.length;Ge++){if(Re=!1,Oe=!1,H.isString(He=Ue[Ge])){var Se=He;He=parseInt(He),(H.isNaN(He)||He!=Se)&&(Re=!0)}if(0==Re&&H.isNumber(He)?(He<1||He>65535)&&(Oe=!0):Re=!0,Re)return Bi(Ie),!1;if(Oe)return mje(Ie),!1}return!0}(ae,z))return void ye();ue=Et(z)}ae._sendDataByHttpAsync("GetCapabilities",ue).then(function(Ie){try{var Ue,He;Ie.length>0&&(He=Ie[0]),H.isString(He)?(He=me.removeNonPrintableChar(He),He=H.replaceAll(He,"\\\\","\\\\"),0==(Ue=JSON.parse(He)).errorCode?H.isFunction(K)&&K(Ue.response):(ae._errorCode=Ue.errorCode,ae._errorString=Ue.errorString,ye())):(Jl(ae),ye())}catch(Re){ae._errorCode=-2302,ae._errorString=Re,ye()}},ye)}},{key:"_dwtSetCapabilities",value:function(z,K,oe){if(!H.isObject(z)||H.isArray(z))return Bi(this),H.isFunction(oe)&&oe(this._errorCode,this._getErrorString()),!1;var ue=["[",H.stringify(z),"]"].join("");return this._innerSend("SetCapabilities",ue,0,function(ye){H.isFunction(K)&&K(ye)},oe),!0}},{key:"_selectDeviceAsync",value:(T=_t(B.mark(function z(K,oe,ae){var ue,ye;return B.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return ue=this,Wo(K,this),Ie.prev=2,Ie.next=5,va(qn(x.prototype),"_innerSelectDeviceAsync",this).call(this,oe,ae);case 5:(ye=Ie.sent)&&(ue._curDevice=oe,ue._bSelectedSourceByServer=!1),Ie.next=12;break;case 9:throw Ie.prev=9,Ie.t0=Ie.catch(2),Ie.t0;case 12:return Ie.prev=12,Xr(K),Ie.finish(12);case 15:return Ie.abrupt("return",ye);case 16:case"end":return Ie.stop()}},z,this,[[2,9,12,15]])})),function(z,K,oe){return T.apply(this,arguments)})},{key:"_selectSourceByIndexAsync",value:(S=_t(B.mark(function z(K,oe){var ae,ue;return B.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ue=1*oe,(ae=this)._resetErr(),ae._isValid()){Ie.next=4;break}return Ie.abrupt("return",pt.Promise.reject({code:ae._errorCode,message:ae._errorString}));case 4:if(!H.isNaN(ue)){Ie.next=7;break}return Jn(ae),Ie.abrupt("return",pt.Promise.reject({code:ae._errorCode,message:ae._errorString}));case 7:if(ae.__devices){Ie.next=10;break}return Ie.next=10,ae._getDevicesAsync(K,null);case 10:if(!(ue<0||ue>=ae.__devices.length)){Ie.next=13;break}return Mt(ae),Ie.abrupt("return",pt.Promise.reject({code:ae._errorCode,message:ae._errorString}));case 13:return Ie.abrupt("return",ae._selectDeviceAsync(K,ae.__devices[ue]));case 15:case"end":return Ie.stop()}},z,this)})),function(z,K){return S.apply(this,arguments)})},{key:"_removeAllImages",value:function(z){var K=this,oe=!0;if(K._resetErr(),!K._isValid())return!1;var ae,ue=[];for(ae=K._getHowManyImagesInBuffer()-1;ae>=0;ae--){var ye=K._imageBufferWrapper.convertClientIndexToServerId(ae);ye>-1&&ue.push(ye)}if(ue.length>0){if(K._OnBitmapChanged(["c1",ue.join(","),3,K._ImgManager.getCurrentImageIndex(),K._ImgManager.count()]),oe=K._innerFunRaw("RemoveAllImages",Et(ue.join(",")),!1,!1,!1,function(){},function(){}),H.isArray(oe))return oe[0]}else oe=!0;return oe}},{key:"_removeImage",value:function(z,K){var oe,ae=this,ue=parseInt(K);if(!na(ae,ue))return!1;var ye=ae._ImgManager.convertClientIndexToServerId(ue);return-1==ye?(Mt(ae),!1):(((oe=ae._innerFun("RemoveImage",Et(ye)))||-1033==ae._errorCode)&&ae._OnBitmapChanged(["c1",""+ye,3,ae._ImgManager.getCurrentImageIndex(),ae._ImgManager.count()]),oe)}},{key:"__innerAcquireOrLoadImageAsync",value:function(z,K,oe,ae){var ue=this;return new pt.Promise(function(ye,Ie){var Ue="LoadImage"==z||"LoadImageEx"==z||"GenerateURLForUploadData"==z,He=Ue||"LoadDibFromClipboard"==z;Ue?me.showProgress(ue,z,!1):Wo(z,ue),ue._innerSend(z,K,!0,function(Re){if(ue.__bLoadingImage=!1,ue.__bOpenFileNow=!1,ue.__closeRemoteScanUI(!0),Ue){if(me.closeProgress(null,z),ue._isBindViewer()){var Oe=ue._ImgManager.getCurrentImageIndex();Oe>=0&&ue._innerRefreshUI(Oe)}}else Xr(z);He&&ue._canConsume()&&be.DWT.lcvrf(ue),H.isFunction(ye)&&ye(Re)},function(Re){Ue?me.closeProgress(null,""):Xr(z),ue.__bLoadingImage=!1,ue.__bAcquireImageNow=!1,ue.__bOpenFileNow=!1,ue.__closeRemoteScanUI(!0);var Oe=ue._ImgManager.getCurrentImageIndex();Oe>=0&&ue._innerRefreshUI(Oe),rce(ue._errorCode)&&Z1(ue),H.isFunction(Ie)&&Ie({code:ue._errorCode,message:ue._getErrorString()}),Ue?me.closeProgress(null,z):Xr(z),Re&&H.error(Re)})})}},{key:"_innerLoadImageFromBinary",value:function(z,K,oe,ae,ue,ye){var Ie,Ue,He=this,Re=K;if(!mn.checkProductKey(He,{Core:!0}))return H.isFunction(ye)&&ye(He._errorCode,He._getErrorString()),!1;if(!z||""==z)return wl(He),H.isFunction(ye)&&ye(He._errorCode,He._getErrorString()),!1;if(H.isString(z))return Bi(He),H.isFunction(ye)&&ye(He._errorCode,He._getErrorString()),!1;if(!(Ue=z instanceof Blob?z.size:$p(z)?z.byteLength:z instanceof Array?z.length:z.size||z.byteLength||z.length)||""==Ue)return Bi(He),H.isFunction(ye)&&ye(He._errorCode,He._getErrorString()),!1;var Ge=z.currentFileName;Ge||(Ge=He._getCurrentDocumentName());var Se,de=z.currentTagName;if(de||!H.isUndefined(z.bNeedClearCurrentTagName)&&z.bNeedClearCurrentTagName||(de=He._getCurrentDefaultTagName()),z instanceof FileList){if(1==z.length)return z[0].currentFileName=Ge,z[0].currentTagName=de,He._innerLoadImageFromBinary(z[0],Re,oe,ue,ye);if(z.length>1){var ge;for(H.asyncQueue.stop(),ge=0;ge<z.length;ge++)z[ge].currentFileName=Ge,z[ge].currentTagName=de,H.asyncQueue.pushToDo(He,"_innerLoadImageFromBinary",ge==z.length-1?[z[ge],Re,oe,ue,ye]:[z[ge],Re,oe,null,ye]);return H.asyncQueue.start(),!0}return wl(He),H.isFunction(ye)&&ye(He._errorCode,He._getErrorString()),!1}if(window.ReadableStream&&z instanceof ReadableStream?Ie=new Response(z):window.Response&&z instanceof Response&&(Ie=z),Ie)Ie.arrayBuffer().then(function(Be){var $e;($e=new Blob([Be])).currentFileName=z.currentFileName,$e.currentTagName=z.currentTagName;var ze=ae,Ct=0;oe&&(Ct=He.__GetLoadEventsNum()),He.__LoadImageFromBytesV1($e,-1,"",Ct,ze,ue,ye)});else{var _e=z;ae&&$p(_e)&&((_e=new Blob([z])).currentFileName=z.currentFileName,_e.currentTagName=z.currentTagName);var ve=-1,Te=ae,We=be.DWT.EnumDWT_ImageType;H.isString(_e.type)&&("application/pdf"==_e.type?ve=We.IT_PDF:"image/png"==_e.type?ve=We.IT_PNG:"image/jpeg"==_e.type||"image/jpg"==_e.type?ve=We.IT_JPG:"image/bmp"==_e.type?ve=We.IT_BMP:"image/tiff"==_e.type||"image/tif"==_e.type?ve=We.IT_TIF:"image/jp2"==_e.type&&(ve=We.IT_J2K));var Ye=0;oe&&(Ye=He.__GetLoadEventsNum()),Se=He.__LoadImageFromBytesV1(_e,ve,"",Ye,Te,ue,ye)}return!!ae||Se}},{key:"__LoadImageFromBytes",value:function(z,K,oe,ae,ue,ye,Ie,Ue){var He=this.__LoadImageFromBytesV2(z,K,oe,ae,Ie,Ue,!1,0,ue,ye);return ae?He:0==this._errorCode}},{key:"__LoadImageFromBytesV1",value:function(z,K,oe,ae,ue,ye,Ie){var Ue=this.__LoadImageFromBytesV2(z,K,oe,ue,0,0,!1,ae,ye,Ie);return ue?Ue:0==this._errorCode}},{key:"_isMobileMode",value:function(){return!1}},{key:"ErrorCode",get:function(){return this._errorCode}},{key:"ErrorString",get:function(){return this._getErrorString()}},{key:"HowManyImagesInBuffer",get:function(){return this._getHowManyImagesInBuffer()}}]);var S,T,D,R,P,O,U,G,X}(pfe);function Sqe(C,x,S){var T=this;return T._dwtConvertToBlobSync(x,C,S,function(D){if(!D||D.size<=0)return Wle(T),!1;var R=T.__maxUploadImageSize;return D.size>R&&-1!=R?(bf(T),!1):D},function(D){return!1})}function _fe(){this.__defaultSourceName="",this.__sourceCount=0}function Cfe(C,x){var S=this,T=S._getPdfDllname(),D=["[",H.stringify(C),',"',T,'"',"]"].join("");return S._innerFunV2("SetPDFReaderOptions",D).then(function(){if(H.isNumber(x)&&(S._pdfConvertMode=x),S._pdfOptions.convertMode=C.convertMode,S._pdfOptions.renderOptions.renderAnnotations=C.renderOptions.renderAnnotations,S._pdfOptions.convertMode==mr.CM_IMAGEONLY&&S._pdfConvertMode==mr.CM_RENDERALL||S._pdfOptions.convertMode==mr.CM_IMAGEONLY&&S._pdfConvertMode==mr.CM_RENDERALLWITHANNOTATION)throw S._pdfConvertMode=mr.CM_IMAGEONLY,Z1(S),{code:S._errorCode,message:S._errorString};return!0})}var bfe=function(C,x){if(Po.bDiscardBlankImage){var S=C._ImgManager.getCurrentImageIndex();C.IsBlankImage(S)&&C.RemoveImage(S);var T=["Blank Discard (",x,"): ",C.ErrorString].join("");H.isFunction(C.__OnPrintMsg)&&C.__OnPrintMsg(T)}};function Tqe(C){return xfe.apply(this,arguments)}function xfe(){return(xfe=_t(B.mark(function C(x){var S,T,D,R;return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(S=x,!be.DWT.ConnectWithSocket){P.next=6;break}return P.next=4,new pt.Promise(function(O,U){S._sendData("IfDisableSourceAfterAcquire","[1]",!1,O,U)});case 4:P.next=8;break;case 6:return P.next=8,x._innerFunV2("IfDisableSourceAfterAcquire","[1]");case 8:T=Mi.TWAIN,D=!1,R=!1,S._bRemoteMode?S.__serverPlatform==Rn.enumWindow||(S.__serverPlatform==Rn.enumLinux?R=!0:S.__serverPlatform==Rn.enumMac&&(D=!0)):(D=he.bMac,R=he.bLinux),D?T=Mi.TWAIN_AND_ICA:R&&(T=Mi.SANE),x._driverType=T,x._bRemoteMode&&(x._setIfShowUI(!1),x._setIfShowFileDialog(!1));case 13:case"end":return P.stop()}},C)}))).apply(this,arguments)}function s3(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function bu(C,x,S){return x.has(C),S}var j0=new WeakSet,bW=new WeakSet,wfe=new WeakSet,xW=new WeakSet,wW=new WeakSet,Iqe=function(C){function x(){var T,O,U,G;n(this,x);for(var D=arguments.length,R=new Array(D),P=0;P<D;P++)R[P]=arguments[P];return O=this,U=x,G=[].concat(R),U=qn(U),s3(T=Za(O,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(X){return!1}}()?Reflect.construct(U,G||[],qn(O).constructor):U.apply(O,G)),wW),s3(T,xW),s3(T,wfe),s3(T,bW),s3(T,j0),T}return el(x,C),v(x,[{key:"SaveAsGIF",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&P(O._errorCode,O._getErrorString()),!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(!Rm(O,D,P))return!!U&&void 0;if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var z=O.__GetLoadEventsNum(),K=O.__innerSaveImage("SaveAsGIF",Et(X,G,z),R,P);return U?void 0:K}},{key:"SaveSelectedImagesToBase64Binary",value:function(T,D){var R=this,P=!1;if(H.isFunction(T)&&(P=!0),R._resetErr(),!R._isValid())return H.isFunction(D)&&on(D,R),!!P&&void 0;if(!(mn.checkProductKey(R,{Core:!0})||he.bWin&&mn.checkProductKey(R,{Webcam:!0},!0)))return mn.checkProductKey(R,{Core:!0},!1),H.isFunction(D)&&D(R._errorCode,R._getErrorString()),!!P&&void 0;var O=cC(R);return 0==O.length?(ta(R),H.isFunction(D)&&on(D,R),!!P&&void 0):P?void R._innerSend("SaveSelectedImagesToBase64Binary",Et(O.join(",")),!0,T,D):R._innerFun("SaveSelectedImagesToBase64Binary",Et(O.join(",")))}},{key:"ShowFileDialog",value:function(T,D,R,P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return!1;var K,oe=zn.replaceLocalFilename(O);return K=z.__GetLoadEventsNum(),z._innerSend("ShowFileDialog",Et(T,D,R,P,oe,U,G,X,K),!0),!0}},{key:"FTPDownload",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!T)return Bi(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var G=zn.getImageType(D);return bu(O,wW,Ife).call(O,"FTPDownload",Et(T,D),G,R,P)}},{key:"FTPDownloadEx",value:function(T,D,R,P,O){var U=this,G=!1;return H.isFunction(P)&&(G=!0),U._resetErr(),U._isValid()?T?bu(U,wW,Ife).call(U,"FTPDownloadEx",Et(T,D,R),R,P,O):(Bi(U),H.isFunction(O)&&on(O,U),!!G&&void 0):(H.isFunction(O)&&on(O,U),!!G&&void 0)}},{key:"FTPUpload",value:function(T,D,R,P,O){var U=this,G=!1;if(H.isFunction(P)&&(G=!0),U._resetErr(),!U._isValid())return H.isFunction(O)&&on(O,U),!!G&&void 0;var X=U._ImgManager.convertClientIndexToServerId(D);if(!Rm(U,D,O))return!!G&&void 0;if(-1==X)return Mt(U),H.isFunction(O)&&on(O,U),!!G&&void 0;var z=U.__innerFTPUpload("FTPUpload",Et(T,X,R),P,O);return G?void 0:z}},{key:"FTPUploadEx",value:function(T,D,R,P,O,U){var G,X=this,z=!1;if(H.isFunction(O)&&(z=!0),X._resetErr(),!X._isValid())return H.isFunction(U)&&on(U,X),!!z&&void 0;if(!Rm(X,D,U))return!!z&&void 0;if(-1==(G=X._ImgManager.convertClientIndexToServerId(D)))return Mt(X),H.isFunction(U)&&on(U,X),!!z&&void 0;var K=X.__innerFTPUpload("FTPUploadEx",Et(T,G,R,P),O,U);return z?void 0:K}},{key:"FTPUploadAllAsMultiPageTIFF",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G=[];uP(O,G);var X=O.__innerFTPUpload("FTPUploadAsMultiPageTIFF",Et(T,D,G.join(",")),R,P);return U?void 0:X}},{key:"FTPUploadAllAsPDF",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G=[];uP(O,G);var X=O.__innerFTPUpload("FTPUploadAsMultiPagePDF",Et(T,D,G.join(",")),R,P);return U?void 0:X}},{key:"FTPUploadAsMultiPagePDF",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G=cC(O),X=O.__innerFTPUpload("FTPUploadAsMultiPagePDF",Et(T,D,G.join(",")),R,P);return U?void 0:X}},{key:"FTPUploadAsMultiPageTIFF",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G=cC(O),X=O.__innerFTPUpload("FTPUploadAsMultiPageTIFF",Et(T,D,G.join(",")),R,P);return U?void 0:X}},{key:"HTTPDownloadDirectly",value:function(T,D,R,P,O){var U,G=this,X=!1;if(H.isFunction(P)&&(X=!0),G._resetErr(),!G._isValid()||!mn.checkProductKey(G,{Core:!0}))return H.isFunction(O)&&on(O,G),!!X&&void 0;var z,K,oe=G._GetHttpHeadersAndClear(),ae=zn.combineUrl(G,T,D);if(void 0===ae)return wl(G),H.isFunction(O)&&on(O,G),!!X&&void 0;if(!R||""==R)return St(G,-2309,"The LocalFile is empty in the name HTTPDownloadDirectly Function."),H.isFunction(O)&&on(O,G),!!X&&void 0;if(z=zn.getImageType(R),!mn.checkPDFProductKeyWhenNeeds(G,z))return H.isFunction(O)&&on(O,G),!!X&&void 0;me.cancelFrom=Zn.HTTPDownload,K=zn.replaceLocalFilename(R),G.IfShowProgressBar?me.showProgress(G,"HTTPDownloadDirectly",!1):me.hideProgress();var ue=null===(U=me.progressContext)||void 0===U?void 0:U.IfShowCancelDialogWhenImageTransfer,ye=function(){return G.IfShowProgressBar&&me.closeProgress(null,"HTTPDownloadDirectly"),H.isFunction(P)&&P(),!0},Ie=function(){return me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ue),G.IfShowProgressBar&&me.closeProgress(null,"HTTPDownloadDirectly"),H.isFunction(O)&&on(O,G),!1};G._OnPercentDone([0,-1,Br.Downloading,"http"]),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!0);var Ue=zn.loadHttpBlob(G,"get",ae,X,function(He){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ue),G._OnPercentDone([0,-1,Br.Loading]);var Re=G.__GetLoadEventsNum();return G.__LoadImageFromBytesV1(He,3,K,Re,X,ye,Ie)},Ie,function(He){var Re=0===He.total?100:Math.round(100*He.loaded/He.total);[He.loaded," / ",He.total].join(""),Re>=100&&He.loaded<He.total&&(Re=99),G._OnPercentDone([0,Re,"","http"])},oe);return X?void 0:!!Ue}},{key:"HTTPUploadThroughPostDirectly",value:function(T,D,R,P,O,U){var G=this,X=!1,z=function(){H.isFunction(U)&&on(U,G,G.__HTTPPostResponseString)};if(H.isFunction(O)&&(X=!0),G._resetErr(),G.__HTTPPostResponseString="",!G._isValid())return z(),!!X&&void 0;var K=zn.combineUrl(G,T,R);return D?T?G._innerUploadDirectly(K,D,P,this.IfShowProgressBar,!1,0,!0,!1,O,z):(sB(G),z(),!!X&&void 0):(S0(G),z(),!!X&&void 0)}},{key:"_innerUploadDirectly",value:function(T,D,R,P,O,U,G,X,z,K){var oe,ae,ue=this,ye=ue._GetHttpHeadersAndClear(),Ie="HTTPUploadThroughPostDirectly",Ue=!1;if(H.isFunction(z)&&(Ue=!0),void 0===T||!1===T||""===T)return wl(ue),H.isFunction(K)&&on(K,ue),!!Ue&&void 0;if(!mn.checkProductKey(ue,{Core:!0}))return H.isFunction(K)&&on(K,ue),!!Ue&&void 0;me.cancelFrom=Zn.HTTPUpload;var He=function(Re,Oe,Ge){return 0!=Re&&Oe&&(ue._errorCode=Re,ue._errorString=Oe),Ge&&(ue.__HTTPPostResponseString=Ge),me.needShowTwiceShowDialog=!1,P&&me.closeProgress(null,Ie),H.isFunction(K)&&on(K,ue),!1};return me.needShowTwiceShowDialog=!0,P?me.showProgress(ue,Ie,!1):me.hideProgress(),(oe=zn.replaceLocalFilename(D))&&""!=oe?X&&X.bCancel?(X.st=2,gu(ue),He(ue._errorCode,ue._errorString),!!Ue&&void 0):(ae=bu(ue,bW,Sfe).call(ue,oe,Ue,O,function(Re){if(me.needShowTwiceShowDialog=!1,X&&X.bCancel)return X.st=2,gu(ue),He(ue._errorCode,ue._errorString),!1;if(Re&&(!P||P&&me.dlgRef>0||0==Ue)){Re instanceof File?Re.fileName=R:Re.name=R,P&&tg(ue.__IfShowCancelDialogWhenImageTransfer);var Oe=new Pf,Ge=ue._createHttpUploaderConfig(),Se=new Cd;return ue.__remoteFilename&&""!=ue.__remoteFilename&&(Se.remoteFilename=ue.__remoteFilename),Ge.objUploadStatus=X,Se.url=T,Se.method=Ie,Se.content=Re,Re=null,Se.contentType=ue._strHttpContentTypeFieldValue,Se.headers=ye,Se.bAsync=Ue,Se.httpFormData=Bm(ue.httpFormFields),Se.retry=U,Se.bOnlyResponseEmptyIsOK=G,Se.blockSize=ue._moduleSize,Oe.httpPostUpload(Ge,Se,function(de){return P&&me.closeProgress(null,Ie),H.isFunction(z)&&ws(z,de),!0},He)}return S0(ue),He(ue._errorCode,ue._errorString),!1},He),Ue?void 0:!!ae):(S0(ue),He(ue._errorCode,ue._errorString),!!Ue&&void 0)}},{key:"_innerUploadFilesDirectly",value:function(T,D,R,P,O,U,G,X,z){var K,oe=this,ae=oe._GetHttpHeadersAndClear(),ue="HTTPUploadThroughPostDirectly",ye=!1,Ie=[];if(H.isFunction(X)&&(ye=!0),!1===T||""===T)return wl(oe),H.isFunction(z)&&z({code:oe._errorCode,message:oe._getErrorString(),files:D}),!1;if(!mn.checkProductKey(oe,{Core:!0}))return H.isFunction(z)&&z({code:oe._errorCode,message:oe._getErrorString(),files:D}),!1;me.cancelFrom=Zn.HTTPUpload;var Ue=function(Ge,Se,de){return 0!=Ge&&Se&&(oe._errorCode=Ge,oe._errorString=Se),de&&(oe.__HTTPPostResponseString=de),me.needShowTwiceShowDialog=!1,P&&me.closeProgress(null,ue),H.isFunction(z)&&z({code:oe._errorCode,message:oe._errorString,response:de,files:D}),!1};me.needShowTwiceShowDialog=!0,P?me.showProgress(oe,ue,!1):me.hideProgress(),H.each(D,function(Ge){var Se=zn.replaceLocalFilename(Ge);if(!Se||""==Se)return S0(oe),Ue(oe._errorCode,oe._errorString),!1;Ie.push(Se)});var He=[],Re=Ie.length,Oe=0;return H.each(Ie,function(Ge,Se){K=bu(oe,bW,Sfe).call(oe,Ge,ye,O,function(de){if(me.needShowTwiceShowDialog=!1,!de||P&&!(P&&me.dlgRef>0)&&0!=ye)return P&&me.closeProgress(null,ue),lB(oe),H.isFunction(Ue)&&Ue(oe._errorCode,oe._errorString),!1;var ge=Tc(R,Se+1);if(de instanceof File?de.fileName=ge:de.name=ge,He[Se]=de,de=null,++Oe==Re){P&&tg(oe.__IfShowCancelDialogWhenImageTransfer);var _e=oe._createHttpUploaderConfig(),ve=new Cd;oe.__remoteFilename&&""!=oe.__remoteFilename&&(ve.remoteFilename=oe.__remoteFilename),ve.url=T,ve.method=ue,ve.content=He,He=null,ve.contentType=oe._strHttpContentTypeFieldValue,ve.headers=ae,ve.bAsync=ye,ve.httpFormData=Bm(oe.httpFormFields),ve.retry=U,ve.bOnlyResponseEmptyIsOK=G,ve.blockSize=oe._moduleSize;var Te=hfe(_e,ve,function(We){return P&&me.closeProgress(null,ue),H.isFunction(X)&&ws(X,We),!0},function(We,Ye,Be){return P&&me.closeProgress(null,ue),H.isFunction(Ue)&&Ue(We,Ye,Be),!1});return ye?void 0:Te}},function(){return P&&me.closeProgress(null,ue),H.isFunction(Ue)&&Ue(),!1})}),ye?void 0:!!K}},{key:"_createHttpUploaderConfig",value:function(){var T=this,D=new ffe;return D.IfShowProgressBar=T.IfShowProgressBar,D.IfShowCancelDialogWhenImageTransfer=T.__IfShowCancelDialogWhenImageTransfer,D.MaxUploadImageSize=T.MaxUploadImageSize,D.HTTPRequestswithCredentials=T.HTTPRequestswithCredentials,D.onPercent=function(R){T._OnPercentDone(R)},D.onHttpUploadStatus=function(R){H.isFunction(T.__OnHttpUploadStatus)&&T.__OnHttpUploadStatus(R)},D}},{key:"SetUploadSegment",value:function(T,D){var P,R=this;return R._resetErr(),!(!R._isValid()||(!H.isNumber(T)||T<0?(St(R,-2367,"Invalid value for the parameter segmentUploadThreshold."),1):!H.isNumber(D)||D<=0?(P=R,St(P,-2368,"Invalid value for the parameter moduleSize."),1):(R._segementUploadThreshold=1024*T*1024,R._moduleSize=1024*D,0)))}},{key:"ConvertToBase64",value:function(T,D,R,P){var O,U=this,G=arguments,X=!1;if(H.isFunction(R)&&(X=!0),U._resetErr(),!U._isValid())return H.isFunction(P)&&ma(P,U,T,D,G),!!X&&void 0;var z=parseInt(D);if(!mn.checkProductKey(U,{Core:!0})||!U._checkIndices(T))return H.isFunction(P)&&ma(P,U,T,D,G),!!X&&void 0;if(z==be.DWT.EnumDWT_ImageType.IT_BMP||z==be.DWT.EnumDWT_ImageType.IT_JPG||z==be.DWT.EnumDWT_ImageType.IT_PNG){if(T.length>1)return St(U,-2361,"You cannot convert more than one image to base64 string when the format is BMP, JPG or PNG."),H.isFunction(P)&&ma(P,U,T,D,G),!!X&&void 0}else if(z!=be.DWT.EnumDWT_ImageType.IT_TIF&&z!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(U),H.isFunction(P)&&ma(P,U,T,D,G),!!X&&void 0;if(0==(O=km(U,T)).length)return Jn(U),H.isFunction(P)&&ma(P,U,T,D,G),!!X&&void 0;me.cancelFrom=Zn.ConvertToBlob,U._convertToBase64ByServerIdsWithUI("ConvertToBase64",O,z,!1,3,function(K){var oe=[];H.isArray(O)&&H.each(O,function(ae){var ue=U._ImgManager.convertServerIdToClientIndex(ae);ue>-1&&oe.push(ue)}),H.isFunction(R)&&ws(R,K,oe,D,G)},function(){var K=[];H.isArray(O)&&H.each(O,function(oe){var ae=U._ImgManager.convertServerIdToClientIndex(oe);ae>-1&&K.push(ae)}),H.isFunction(P)&&ma(P,U,K,D,G)})}},{key:"ClearAllHTTPFormField",value:function(){var T=this;return T._resetErr(),!!T._isValid()&&(T.httpFormFields={},!0)}},{key:"SetHTTPFormField",value:function(T,D,R){var P=this;if(P._resetErr(),!P._isValid())return!1;var O=T;return H.isString(O)||(O=""+O),D instanceof Blob&&(D.name=R),P.httpFormFields[O]=D,!0}},{key:"HTTPDownloadThroughPost",value:function(T,D,R,P,O,U){var G,X,z=this,K=z._GetHttpHeadersAndClear(),oe=zn.combineUrl(z,T,D),ae=!1;if(H.isFunction(P)&&(ae=!0),void 0===oe)return wl(z),H.isFunction(O)&&on(O,z,""),!!ae&&void 0;if(!mn.checkProductKey(z,{Core:!0})||!mn.checkPDFProductKeyWhenNeeds(z,R))return H.isFunction(O)&&on(O,z,""),!!ae&&void 0;me.cancelFrom=Zn.HTTPDownload,z.IfShowProgressBar?me.showProgress(z,"HttpDownloadThroughPost",!1):me.hideProgress(),z._OnPercentDone([0,-1,Br.Downloading,"http"]);var ue=null===(G=me.progressContext)||void 0===G?void 0:G.IfShowCancelDialogWhenImageTransfer,ye=function(){return z.IfShowProgressBar&&me.closeProgress(null,"HttpDownloadThroughPost"),H.isFunction(P)&&P(),!0},Ie=function(){return me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ue),z.IfShowProgressBar&&me.closeProgress(null,"HttpDownloadThroughPost"),H.isFunction(O)&&on(O,z,z.__HTTPPostResponseString),!1};return me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!0),X=zn.loadHttpBlob(z,"post",oe,ae,function(Ue){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ue),z._OnPercentDone([0,-1,Br.Loading]);var He=R;He!=be.DWT.EnumDWT_ImageType.IT_BMP&&He!=be.DWT.EnumDWT_ImageType.IT_JPG&&He!=be.DWT.EnumDWT_ImageType.IT_TIF&&He!=be.DWT.EnumDWT_ImageType.IT_PNG&&He!=be.DWT.EnumDWT_ImageType.IT_PDF&&He!=be.DWT.EnumDWT_ImageType.IT_J2K&&(He=-1);var Re=z.__GetLoadEventsNum();return z.__LoadImageFromBytesV1(Ue,He,"",Re,ae,ye,Ie)},Ie,function(Ue){var He=0===Ue.total?100:Math.round(100*Ue.loaded/Ue.total);[Ue.loaded," / ",Ue.total].join(""),He>=100&&Ue.loaded<Ue.total&&(He=99),z._OnPercentDone([0,He,"","http"])},K),ae?void 0:!!X}},{key:"HTTPDownloadThroughGet",value:function(T,D,R,P,O){return this._innerHTTPDownloadThroughGet("HTTPDownload",T,D,R,P,O)}},{key:"HTTPUploadThroughPut",value:function(T,D,R,P,O){var U=zn.getImageType(R);return this.HTTPUploadThroughPutEx(T,D,R,U,P,O)}},{key:"HTTPUploadThroughPutEx",value:function(T,D,R,P,O,U){var G=this,X=G._GetHttpHeadersAndClear(),z="HTTPUploadThroughPutEx",K=zn.combineUrl(G,T,R),oe=!1,ae=[],ue=!1,ye=this.IfShowProgressBar;if(H.isFunction(O)&&(oe=!0),void 0===K)return wl(G),H.isFunction(U)&&ma(U,G,"",[D],R,P),!!oe&&void 0;me.cancelFrom=Zn.HTTPPut;var Ie,Ue=function(){me.needShowTwiceShowDialog=!1,ye&&me.closeProgress(null,z),H.isFunction(U)&&ma(U,G,G.__HTTPPostResponseString,ae,R,P)};switch(me.needShowTwiceShowDialog=!0,ye?me.showProgress(G,z,!1):me.hideProgress(),D){case-1:for(var He=0;He<G._ImgManager.count();He++)ae.push(He);break;case-2:ae=G._ImgManager.getSelectedClientIndexArray();break;default:if(ae.push(D),!(D>=0))return Mt(G),Ue(),!!oe&&void 0}if(""===T)return sB(G),Ue(),!!oe&&void 0;var Re=[];H.isArray(ae)&&H.each(ae,function(Se){var de=G._ImgManager.convertClientIndexToServerId(Se);-1!=de&&Re.push(de)}),G._OnPercentDone([0,-1,Br.Encoding,"http"]);var Ge=function(Se,de,ge){if(be.DWT.IfAddMD5InUploadHeader&&de&&""!=de&&(X["dwt-md5"]=de),me.needShowTwiceShowDialog=!1,Se&&(!ye||ye&&me.dlgRef>0||0==oe)){var _e=G.__maxUploadImageSize;return Se.size>_e&&-1!=_e?(bf(G),Ue(),!!oe&&void 0):(Ie=function(ve){var Te=0===ve.total?100:Math.round(100*ve.loaded/ve.total);[ve.loaded," / ",ve.total].join(""),Te>=100&&ve.loaded<ve.total&&(Te=99),G._OnPercentDone([0,Te,"","http"])},G._OnPercentDone([0,-1,Br.Uploading,"http"]),ye&&tg(G.__IfShowCancelDialogWhenImageTransfer),me.cancelFrom=Zn.HTTPPut,ue=zn.httpPutImage(G,K,Se,oe,function(ve){if(ve&&(G.__HTTPPostResponseString=ve),ye&&me.closeProgress(null,z),H.isFunction(O)){var Te=[];H.isArray(Re)&&H.each(Re,function(We){var Ye=G._ImgManager.convertServerIdToClientIndex(We);Ye>-1&&Te.push(Ye)}),ws(O,G.__HTTPPostResponseString,Te,R,P)}return!0},Ue,Ie),Se=null,oe?void 0:!!ue)}return Se=null,ye&&me.closeProgress(null,z),!!oe&&void 0};if(!oe)return G._dwtConvertToBlobSync(P,Re,!1,Ge,Ue);G._convertToBlobForUpload(P,Re,!1,4,Ge,Ue)}},{key:"HTTPUploadAllThroughPutAsMultiPageTIFF",value:function(T,D,R,P){return this.HTTPUploadThroughPutEx(T,-1,D,2,R,P)}},{key:"HTTPUploadThroughPutAsMultiPageTIFF",value:function(T,D,R,P){return this.HTTPUploadThroughPutEx(T,-2,D,2,R,P)}},{key:"HTTPUploadAllThroughPutAsPDF",value:function(T,D,R,P){return this.HTTPUploadThroughPutEx(T,-1,D,4,R,P)}},{key:"HTTPUploadThroughPutAsMultiPagePDF",value:function(T,D,R,P){return this.HTTPUploadThroughPutEx(T,-2,D,4,R,P)}},{key:"GetSelectedImagesSize",value:function(T){var D=this;if(D._resetErr(),!D._isValid())return!1;var R=cC(D);return D._innerFun("GetSelectedImagesSize",Et(T,R.join(",")))}},{key:"SetHTTPHeader",value:function(T,D){var R=this;if(R._resetErr(),!R._isValid())return!1;var P,O,U=T;if(R.__httpHeaderMap||(R.__httpHeaderMap={}),!U||!H.isString(U))return H.isUndefined(U)?St(R,-2356,"The header name cannot be undefined."):""===U?St(R,-2354,"The header name cannot be empty."):null===U?St(R,-2355,"The header name cannot be null."):function(G){St(G,-2357,"The header name you entered is invalid.")}(R),!1;for(P=["if-none-match","if-range","range","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],U=U.toLowerCase(),O=0;O<P.length;O++)if(P[O]==U)return cje(R),!1;return H.isUndefined(D)||null===D||""===D?(T in R.__httpHeaderMap&&delete R.__httpHeaderMap[T],!0):(H.isNumber(D)&&(D=""+D),R.__httpHeaderMap[T]=D,!0)}},{key:"ConvertToBlob",value:function(T,D,R,P,O){var U=arguments;return this._convertToBlobByIndices(T,D,!1,U,R,P)}},{key:"_asyncUploadFilesCmd",value:function(T,D,R,P,O,U,G,X,z,K,oe,ae){var ue=this,ye=parseInt(O),Ie="HTTPUpload",Ue=T,He=[];ue.__HTTPPostResponseString="",me.cancelFrom=Zn.HTTPUpload;var Re=function(ge,_e,ve){var Te=[];if(H.isArray(D)&&H.each(D,function(We){var Ye=ue._ImgManager.convertServerIdToClientIndex(We);Ye>-1&&Te.push(Ye)}),0!=ge&&_e&&(ue._errorCode=ge,ue._errorString=_e),ve&&(ue.__HTTPPostResponseString=ve),ue._bServerPercentDone=!0,me.needShowTwiceShowDialog=!1,X&&me.closeProgress(null,Ie),He.slice(0),He=null,H.isFunction(ae))try{ae({code:ue._errorCode,message:ue._errorString,response:ve,indices:Te})}catch(We){}};me.needShowTwiceShowDialog=!0,X?me.showProgress(ue,Ie,!1):me.hideProgress();var Oe=D.length,Ge=0,Se=0,de="";ue._bServerPercentDone=!1,ue._OnPercentDone([0,-1,Br.Encoding,"http"]),H.each(D,function(ge,_e){ue._convertToBlobForUpload(ye,[ge],G,4,function(ve,Te,We){if(!ve||ve.size<=0)return is(ue),Re(ue._errorCode,ue._errorString);var Ye=ue.__maxUploadImageSize;if(ve.size>Ye&&-1!=Ye)return bf(ue),Re(ue._errorCode,ue._errorString);var Be=Tc(U,_e+1);if(Se=(Ge+1)/Oe*100,de=[Ge+1,"/",Oe].join(""),ue._OnPercentDone([0,Se,de,"http",Be]),ve.name=Be,He.push(ve),++Ge>=Oe){be.DWT.IfAddMD5InUploadHeader&&Te&&""!=Te&&(R["dwt-md5"]=Te);var $e=ue._createHttpUploaderConfig(),ze=new Cd;ue.__remoteFilename&&""!=ue.__remoteFilename&&(ze.remoteFilename=ue.__remoteFilename),ze.url=Ue,ze.method=Ie,ze.content=He,ze.contentType=ue._strHttpContentTypeFieldValue,ze.headers=R,ze.httpFormData=P,ze.retry=z,ze.bOnlyResponseEmptyIsOK=K,ze.blockSize=ue._moduleSize,hfe($e,ze,function(Ct){ue.__HTTPPostResponseString=$e.HTTPPostResponse,function(bt){if(ue._bServerPercentDone=!0,me.needShowTwiceShowDialog=!1,X&&me.closeProgress(null,Ie),He.slice(0),He=null,H.isFunction(oe)){var Vt=[];H.isArray(D)&&H.each(D,function(In){var yn=ue._ImgManager.convertServerIdToClientIndex(In);yn>-1&&Vt.push(yn)}),ws(oe,bt,Vt)}}(Ct)},Re)}ve=null},Re,[ge,_e])})}},{key:"_getVersionInfoAsync",value:function(){return xo.versionInfoFromServer?pt.Promise.resolve(xo.versionInfoFromServer):this._innerFunV2("VersionInfo")}},{key:"__innerLoadImage",value:function(T,D,R,P,O,U,G){var X=this,z=!1;if((H.isFunction(U)||be.DWT.ConnectWithSocket)&&(z=!0),!mn.checkProductKey(X,{Core:!0}))return H.isFunction(G)&&G({code:X._errorCode,message:X._getErrorString()}),!!z&&void 0;if(!mn.checkPDFProductKeyWhenNeeds(X,R))return H.isFunction(G)&&G({code:X._errorCode,message:X._getErrorString()}),!!z&&void 0;if(z){if(X._bRemoteMode&&X._getIfShowFileDialog())return fB(X),void(H.isFunction(G)&&G({code:X._errorCode,message:X._getErrorString()}));var K=X.IfShowCancelDialogWhenImageTransfer;return X.IfShowCancelDialogWhenImageTransfer=!1,void X.__innerAcquireOrLoadImageAsync(T,D,P,!0).then(function(){X.IfShowCancelDialogWhenImageTransfer=K,H.isFunction(U)&&U()},function(ue){X.IfShowCancelDialogWhenImageTransfer=K,X._errorCode=ue.code,X._errorString=ue.message,H.isFunction(G)&&G(ue)})}if(X._bRemoteMode&&X._getIfShowFileDialog())return fB(X),!1;var oe=X._getCurrentDocumentName(),ae=X._getCurrentDefaultTagName();return X.__innerLoadImageFun(T,D,O,oe,ae)}},{key:"__innerLoadImageFun",value:function(T,D,R,P,O){var U,G=this,X=!0;if(U=G._innerFunRaw(T,D,!1,!1,!0),G.__bOpenFileNow=!1,0!=G._errorCode)return!1;if(H.isArray(U.result)&&U.result.length>0){if(R){var z;if("FTPDownload"==T||"FTPDownloadEx"==T)z=JSON.stringify(U.result);else{var K=U.result[0];H.isObject(K)?z=K.imageInfos:-1!=K||"LoadImage"!=T&&"LoadImageEx"!=T&&"LoadImageFromBase64Binary"!=T&&"LoadDibFromClipboard"!=T||(X=!1)}H.isString(z)&&G._handleOnBitmapChangedEvent({result:["c1",z]},{document:P,tag:O})}else{var oe=U.result.join(",");G._OnBitmapChanged(["c1",oe,1,G._ImgManager.getCurrentImageIndex(),G._ImgManager.count()],null,{document:P,tag:O})}if(X)return G._canConsume()&&be.DWT.lcvrf(G),!0}return rce(G._errorCode)&&Z1(G),!1}},{key:"__innerSaveImage",value:function(T,D,R,P){var O,U=this,G=!1;if(H.isFunction(R)&&(G=!0),G&&U._OnPercentDone([0,-1,Br.Encoding]),U._bRemoteMode||(be.DWT.IfAlwaysFocusOnPopupWindow?U._OnPageFocus(!0):U._OnPageBlur(!0)),0==G)return U._bRemoteMode?U._serviceSyncMethodNotSupport(T):this._innerFun(T,D);if(U._bRemoteMode&&U._getIfShowFileDialog())return fB(U),void(H.isFunction(P)&&P(U._errorCode,U._getErrorString()));var X=null===(O=me.progressContext)||void 0===O?void 0:O.IfShowCancelDialogWhenImageTransfer;U.IfShowProgressBar?me.showProgress(U,T,!1):me.hideProgress(),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1),U._innerSend(T,D,!0,function(){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=X),me.closeProgress(null,T),H.isFunction(R)&&R()},function(z){return me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=X),H.isFunction(P)&&P(U._errorCode,U._getErrorString()),me.closeProgress(null,T),z&&H.error(z),!1})}},{key:"__captureImage",value:function(T,D,R,P){var O=this.__GetLoadEventsNum();return this.__LoadImageFromBytesV2(T,D,"",!0,0,0,!0,O,R,P)}},{key:"_getIfShowFileDialog",value:function(){return this._resetErr(),this._isValid()?this._innerFun("IfShowFileDialog"):yt}},{key:"SaveAsBMP",value:function(T,D,R,P){var O=this,U=!1;if((H.isFunction(R)||he.bAndroid)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&on(P,O),!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(!Rm(O,D,P))return!!U&&void 0;if(he.bAndroid){if(0==O._ImgManager.count())return ta(O),void(H.isFunction(P)&&on(P,O));var z=[];return z.push(D),void O._saveImages("SaveAsBMP",X,z,Ti.IT_BMP).then(function(){H.isFunction(R)&&R()}).catch(function(ae){H.isFunction(P)&&P(ae.code,ae.message)})}if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var K=O.__GetLoadEventsNum(),oe=O.__innerSaveImage("SaveAsBMP",Et(X,G,K),R,P);return U?void 0:oe}},{key:"SaveAsJPEG",value:function(T,D,R,P){var O=this,U=!1;if((H.isFunction(R)||he.bAndroid)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&on(P,O),!!U&&void 0;if(!Rm(O,D,P))return!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(he.bAndroid){if(0==O._ImgManager.count())return ta(O),void(H.isFunction(P)&&on(P,O));var z=[];return z.push(D),void O._saveImages("SaveAsJPEG",X,z,Ti.IT_JPG).then(function(){H.isFunction(R)&&R()}).catch(function(ae){H.isFunction(P)&&P(ae.code,ae.message)})}if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var K=O.__GetLoadEventsNum(),oe=O.__innerSaveImage("SaveAsJPEG",Et(X,G,K),R,P);return U?void 0:oe}},{key:"SaveAsPDF",value:function(T,D,R,P){var O=this,U=!1;if((H.isFunction(R)||he.bAndroid)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&on(P,O),!!U&&void 0;if(!Rm(O,D,P))return!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(he.bAndroid){if(0==O._ImgManager.count())return ta(O),void(H.isFunction(P)&&on(P,O));var z=[];return z.push(D),void O._saveImages("SaveAsPDF",X,z,Ti.IT_PDF).then(function(){H.isFunction(R)&&R()}).catch(function(ae){H.isFunction(P)&&P(ae.code,ae.message)})}if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var K=O.__GetLoadEventsNum(),oe=O.__innerSaveImage("SaveAsPDF",Et(X,G,K),R,P);return U?void 0:oe}},{key:"SaveAsPNG",value:function(T,D,R,P){var O=this,U=!1;if((H.isFunction(R)||he.bAndroid)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&on(P,O),!!U&&void 0;if(!Rm(O,D,P))return!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(he.bAndroid){if(0==O._ImgManager.count())return ta(O),void(H.isFunction(P)&&on(P,O));var z=[];return z.push(D),void O._saveImages("SaveAsPNG",X,z,Ti.IT_PNG).then(function(){H.isFunction(R)&&R()}).catch(function(ae){H.isFunction(P)&&P(ae.code,ae.message)})}if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var K=O.__GetLoadEventsNum(),oe=O.__innerSaveImage("SaveAsPNG",Et(X,G,K),R,P);return U?void 0:oe}},{key:"SaveAsTIFF",value:function(T,D,R,P){var O=this,U=!1;if((H.isFunction(R)||he.bAndroid)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;if(!(mn.checkProductKey(O,{Core:!0})||he.bWin&&mn.checkProductKey(O,{Webcam:!0},!0)))return mn.checkProductKey(O,{Core:!0},!1),H.isFunction(P)&&on(P,O),!!U&&void 0;if(!Rm(O,D,P))return!!U&&void 0;var G,X=zn.replaceLocalFilename(T);if(he.bAndroid){if(0==O._ImgManager.count())return ta(O),void(H.isFunction(P)&&on(P,O));var z=[];return z.push(D),void O._saveImages("SaveAsTIFF",X,z,Ti.IT_TIF).then(function(){H.isFunction(R)&&R()}).catch(function(ae){H.isFunction(P)&&P(ae.code,ae.message)})}if(-1==(G=O._ImgManager.convertClientIndexToServerId(D)))return Mt(O),H.isFunction(P)&&on(P,O),!!U&&void 0;var K=O.__GetLoadEventsNum(),oe=O.__innerSaveImage("SaveAsTIFF",Et(X,G,K),R,P);return U?void 0:oe}},{key:"SaveSelectedImagesAsMultiPagePDF",value:function(T,D,R){var P=this,O=!1;if((H.isFunction(D)||he.bAndroid)&&(O=!0),P._resetErr(),!P._isValid())return H.isFunction(R)&&on(R,P),!!O&&void 0;if(!(mn.checkProductKey(P,{Core:!0})||he.bWin&&mn.checkProductKey(P,{Webcam:!0},!0)))return mn.checkProductKey(P,{Core:!0},!1),H.isFunction(R)&&on(R,P),!!O&&void 0;var U=zn.replaceLocalFilename(T);if(!he.bAndroid){var G=cC(P);if(0==G.length)return ta(P),H.isFunction(R)&&on(R,P),!!O&&void 0;var X=P.__GetLoadEventsNum(),z=P.__innerSaveImage("SaveSelectedImagesAsMultiPagePDF",Et(U,G.join(","),X),D,R);return O?void 0:z}if(0==P._ImgManager.count())return ta(P),void(H.isFunction(R)&&on(R,P));var K=Fue(P);P._saveImages("SaveSelectedImagesAsMultiPagePDF",U,K,Ti.IT_PDF).then(function(){H.isFunction(D)&&D()}).catch(function(oe){H.isFunction(R)&&R(oe.code,oe.message)})}},{key:"SaveSelectedImagesAsMultiPageTIFF",value:function(T,D,R){var P=this,O=!1;if((H.isFunction(D)||he.bAndroid)&&(O=!0),P._resetErr(),!P._isValid())return H.isFunction(R)&&on(R,P),!!O&&void 0;if(!(mn.checkProductKey(P,{Core:!0})||he.bWin&&mn.checkProductKey(P,{Webcam:!0},!0)))return mn.checkProductKey(P,{Core:!0},!1),H.isFunction(R)&&on(R,P),!!O&&void 0;var U=zn.replaceLocalFilename(T);if(!he.bAndroid){var G=cC(P);if(0==G.length)return ta(P),H.isFunction(R)&&on(R,P),!!O&&void 0;var X=P.__GetLoadEventsNum(),z=P.__innerSaveImage("SaveSelectedImagesAsMultiPageTIFF",Et(U,G.join(","),X),D,R);return O?void 0:z}if(0==P._ImgManager.count())return ta(P),void(H.isFunction(R)&&on(R,P));var K=Fue(P);P._saveImages("SaveSelectedImagesAsMultiPageTIFF",U,K,Ti.IT_TIF).then(function(){H.isFunction(D)&&D()}).catch(function(oe){H.isFunction(R)&&R(oe.code,oe.message)})}},{key:"SaveAllAsMultiPageTIFF",value:function(T,D,R){var P=this,O=!1;if((H.isFunction(D)||he.bAndroid)&&(O=!0),P._resetErr(),!P._isValid())return H.isFunction(R)&&on(R,P),!!O&&void 0;if(!(mn.checkProductKey(P,{Core:!0})||he.bWin&&mn.checkProductKey(P,{Webcam:!0},!0)))return mn.checkProductKey(P,{Core:!0},!1),H.isFunction(R)&&on(R,P),!!O&&void 0;if(!p9(P,R))return!!O&&void 0;var U=[],G=zn.replaceLocalFilename(T);if(!he.bAndroid){if(uP(P,U),0==U.length)return ta(P),H.isFunction(R)&&on(R,P),!!O&&void 0;var X=P.__GetLoadEventsNum(),z=P.__innerSaveImage("SaveSelectedImagesAsMultiPageTIFF",Et(G,U.join(","),X),D,R);return O?void 0:z}if(0==P._ImgManager.count())return ta(P),void(H.isFunction(R)&&on(R,P));for(var K=[],oe=0;oe<this._ImgManager.count();oe++)K.push(oe);P._saveImages("SaveAllAsMultiPageTIFF",G,K,Ti.IT_TIF).then(function(){H.isFunction(D)&&D()}).catch(function(ae){H.isFunction(R)&&R(ae.code,ae.message)})}},{key:"SaveAllAsPDF",value:function(T,D,R){var P=this,O=!1;if((H.isFunction(D)||he.bAndroid)&&(O=!0),P._resetErr(),!P._isValid())return H.isFunction(R)&&on(R,P),!!O&&void 0;if(!(mn.checkProductKey(P,{Core:!0})||he.bWin&&mn.checkProductKey(P,{Webcam:!0},!0)))return mn.checkProductKey(P,{Core:!0},!1),H.isFunction(R)&&on(R,P),!!O&&void 0;if(!p9(P,R))return!!O&&void 0;var U=[],G=zn.replaceLocalFilename(T);if(!he.bAndroid){if(uP(P,U),0==U.length)return ta(P),H.isFunction(R)&&on(R,P),!!O&&void 0;var X=P.__GetLoadEventsNum(),z=P.__innerSaveImage("SaveSelectedImagesAsMultiPagePDF",Et(G,U.join(","),X),D,R);return O?void 0:z}if(0==P._ImgManager.count())return ta(P),void(H.isFunction(R)&&on(R,P));for(var K=[],oe=0;oe<this._ImgManager.count();oe++)K.push(oe);P._saveImages("SaveAllAsPDF",G,K,Ti.IT_PDF).then(function(){H.isFunction(D)&&D()}).catch(function(ae){H.isFunction(R)&&R(ae.code,ae.message)})}},{key:"HTTPUpload",value:function(T,D,R,P,O,U,G){var X=this,z=null!=O?O:"RemoteFile",K=X._GetHttpHeadersAndClear(),oe=U,ae=G;if(X._resetErr(),arguments.length<=3)this._innerFormFieldHTTPUpload(T,K,oe=D,ae=R);else if(H.isFunction(arguments[4])&&H.isFunction(arguments[5])&&(z="RemoteFile",oe=arguments[4],arguments.length>5&&(ae=arguments[5])),X._isValid()){var ue,ye=arguments,Ie=function(He){H.isFunction(ae)&&ma(ae,X,X.__HTTPPostResponseString,He,ye)};if(H.isUndefined(T)||""===T)return wl(X),void(Ie&&Ie(D));if(!H.isString(T))return kS(X),void(Ie&&Ie(D));if(X._checkIndices(D)){var Ue=km(X,D);if(0==Ue.length)return Jn(X),void(Ie&&Ie(D));if(H.isUndefined(R))return Kl(X),void(Ie&&Ie(D));if(R==be.DWT.EnumDWT_ImageType.IT_BMP||R==be.DWT.EnumDWT_ImageType.IT_JPG||R==be.DWT.EnumDWT_ImageType.IT_PNG){if(Ue.length>1)return eC(X),void Ie(D)}else if(R!=be.DWT.EnumDWT_ImageType.IT_TIF&&R!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(X),void Ie(D);if(H.isUndefined(P)||P!=be.DWT.EnumDWT_UploadDataFormat.Binary&&P!=be.DWT.EnumDWT_UploadDataFormat.Base64)return Nle(X),void Ie(D);ue={method:"HTTPUpload",url:T,serverIds:Ue,headers:K,formData:Bm(X.httpFormFields),enumImageType:R,saveSetup:!1,dataFormat:P,fileName:z,retry:0,bOnlyResponseEmptyIsOK:!0,objUploadFileStatus:!1,asyncSuccessFunc:function(He,Re){H.isFunction(oe)&&ws(oe,X.__HTTPPostResponseString,Re,ye)},asyncFailureFunc:Ie},this._asyncUploadCmd(ue)}else Ie&&Ie(D)}else H.isFunction(ae)&&on(ae,X,"")}},{key:"_innerFormFieldHTTPUpload",value:function(T,D,R,P){var O,U=this,G="HTTPUpload",X=T,z=U.IfShowProgressBar;if(U._isValid()){if(H.isUndefined(X)||""===X)return wl(U),void(H.isFunction(P)&&on(P,U,""));if(!H.isString(X))return kS(U),void(H.isFunction(P)&&on(P,U,""));0!=X.indexOf("http://")&&0!=X.indexOf("https://")&&(X=me.detect.ssl?"https://"+X:"http://"+X),U.__HTTPPostResponseString="",me.cancelFrom=Zn.HTTPUpload,O=function(ae,ue,ye){0!=ae&&ue&&(U._errorCode=ae,U._errorString=ue),ye&&(U.__HTTPPostResponseString=ye),me.needShowTwiceShowDialog=!1,me.closeProgress(null,G),H.isFunction(P)&&on(P,U,U.__HTTPPostResponseString)},z?me.showProgress(U,G,!1):me.hideProgress(),me.needShowTwiceShowDialog=!0,U._OnPercentDone([0,-1,Br.Uploading,"http"]);var K=U._createHttpUploaderConfig(),oe=new Cd;U.__remoteFilename&&""!=U.__remoteFilename&&(oe.remoteFilename=U.__remoteFilename),oe.url=X,oe.method=G,oe.content=[],oe.headers=D,oe.httpFormData=Bm(U.httpFormFields),oe.blockSize=U._moduleSize,(new Pf).httpPostUpload(K,oe,function(ae){me.needShowTwiceShowDialog=!1,me.closeProgress(null,G),H.isFunction(R)&&ws(R,ae,T,[T,R,P])},O)}else H.isFunction(P)&&on(P,U,"")}},{key:"HTTPUploadThroughPost",value:function(T,D,R,P,O,U,G){var X=this,z=!1;if(H.isFunction(O)&&(z=!0),X._resetErr(),!X._isValid())return!!z&&void 0;var K=zn.getImageType(P),oe=arguments,ae=!1,ue=function(ye){return H.isFunction(U)&&ma(U,X,X.__HTTPPostResponseString,ye,oe),!1};return H.isString(P)&&""!=P?(O&&H.isFunction(O)&&(ae=function(ye,Ie){return ws(O,X.__HTTPPostResponseString,Ie,oe),!0}),Efe(X,D,K,ue)?bu(X,j0,TC).call(X,T,D,R,P,K,ae,ue,G):!!z&&void 0):(is(X),ue(),!!z&&void 0)}},{key:"HTTPUploadThroughPostEx",value:function(T,D,R,P,O,U,G,X){var z=this,K=!1;if(H.isFunction(U)&&(K=!0),z._resetErr(),!z._isValid())return H.isFunction(G)&&ma(G,z,""),!!K&&void 0;var oe=arguments,ae=!1,ue=function(ye){H.isFunction(G)&&ma(G,z,z.__HTTPPostResponseString,ye,oe)};return H.isString(P)&&""!=P?(U&&H.isFunction(U)&&(ae=function(ye,Ie){ws(U,z.__HTTPPostResponseString,Ie,oe)}),Efe(z,D,O,ue)?bu(z,j0,TC).call(z,T,D,R,P,O,ae,ue,X):!!K&&void 0):(is(z),ue(),!!K&&void 0)}},{key:"HTTPUploadAllThroughPostAsMultiPageTIFF",value:function(T,D,R,P,O,U){var G=this,X=!1;if(H.isFunction(P)&&(X=!0),G._resetErr(),!G._isValid())return H.isFunction(O)&&ma(O,G,""),!!X&&void 0;var z=arguments,K=!1,oe=function(ae){H.isFunction(O)&&ma(O,G,G.__HTTPPostResponseString,ae,z)};return H.isString(R)&&""!=R?(X&&(K=function(ae,ue){ws(P,G.__HTTPPostResponseString,ue,z)}),bu(G,j0,TC).call(G,T,-1,D,R,2,K,oe,U)):(is(G),oe(),!!X&&void 0)}},{key:"HTTPUploadAllThroughPostAsPDF",value:function(T,D,R,P,O,U){var G=this,X=!1;if(H.isFunction(P)&&(X=!0),G._resetErr(),!G._isValid())return H.isFunction(O)&&on(O,G,""),!!X&&void 0;var z=arguments,K=!1,oe=function(ae){return H.isFunction(O)&&ma(O,G,G.__HTTPPostResponseString,ae,z),!1};return H.isString(R)&&""!=R?(X&&(K=function(ae,ue){ws(P,G.__HTTPPostResponseString,ue,z)}),bu(G,j0,TC).call(G,T,-1,D,R,4,K,oe,U)):(is(G),oe())}},{key:"HTTPUploadThroughPostAsMultiPagePDF",value:function(T,D,R,P,O,U){var G=this,X=!1;if(H.isFunction(P)&&(X=!0),G._resetErr(),!G._isValid())return H.isFunction(O)&&on(O,G,""),!!X&&void 0;var z=arguments,K=!1,oe=function(ae){H.isFunction(O)&&ma(O,G,G.__HTTPPostResponseString,ae,z)};return H.isString(R)&&""!=R?(X&&(K=function(ae,ue){ws(P,G.__HTTPPostResponseString,ue,z)}),bu(G,j0,TC).call(G,T,-2,D,R,4,K,oe,U)):(is(G),oe(),!!X&&void 0)}},{key:"HTTPUploadThroughPostAsMultiPageTIFF",value:function(T,D,R,P,O,U){var G=this,X=!1;if(H.isFunction(P)&&(X=!0),G._resetErr(),!G._isValid())return H.isFunction(O)&&on(O,G,""),!!X&&void 0;var z=arguments,K=!1,oe=function(ae){H.isFunction(O)&&ma(O,G,G.__HTTPPostResponseString,ae,z)};return H.isString(R)&&""!=R?(X&&(K=function(ae,ue){ws(P,G.__HTTPPostResponseString,ue,z)}),bu(G,j0,TC).call(G,T,-2,D,R,2,K,oe,U)):(is(G),oe(),!!X&&void 0)}},{key:"_innerHTTPDownloadThroughGet",value:function(T,D,R,P,O,U){var G,X,z=this,K=z._GetHttpHeadersAndClear(),oe=z.IfShowProgressBar,ae=zn.combineUrl(z,D,R),ue=!1;if(H.isFunction(O)&&(ue=!0),void 0===ae)return wl(z),H.isFunction(U)&&on(U,z),!!ue&&void 0;if(!mn.checkProductKey(z,{Core:!0})||!mn.checkPDFProductKeyWhenNeeds(z,P))return H.isFunction(U)&&on(U,z),!!ue&&void 0;me.cancelFrom=Zn.HTTPDownload;var ye=null===(G=me.progressContext)||void 0===G?void 0:G.IfShowCancelDialogWhenImageTransfer,Ie=z._getCurrentDocumentName(),Ue=z._getCurrentDefaultTagName();return H.log("_innerHTTPDownloadThroughGet.currentFileName:"+Ie+", tag="+Ue),oe&&ue?(z.__IfShowCancelDialogWhenImageTransfer&&(me.progressContext.__cancelBeforObjectCreated=!0),me.showProgress(z,T,z.__IfShowCancelDialogWhenImageTransfer)):ue&&me.hideProgress(),z._OnPercentDone([0,-1,Br.Downloading,"http"]),X=zn.loadHttpBlob(z,"get",ae,ue,function(He){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ye),oe&&ue&&tg(!1),z._OnPercentDone([0,-1,Br.Loading]);var Re=P;Re!=be.DWT.EnumDWT_ImageType.IT_BMP&&Re!=be.DWT.EnumDWT_ImageType.IT_JPG&&Re!=be.DWT.EnumDWT_ImageType.IT_TIF&&Re!=be.DWT.EnumDWT_ImageType.IT_PNG&&Re!=be.DWT.EnumDWT_ImageType.IT_PDF&&Re!=be.DWT.EnumDWT_ImageType.IT_J2K&&(Re=-1),He.currentFileName=Ie,He.currentTagName=Ue;var Oe=z.__GetLoadEventsNum();return z.__LoadImageFromBytesV1(He,Re,"",Oe,ue,function(){return oe&&ue&&me.closeProgress(null,T),H.isFunction(O)&&O(),!0},function(){return oe&&ue&&me.closeProgress(null,T),H.isFunction(U)&&on(U,z),!1})},function(){return me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=ye),oe&&ue&&me.closeProgress(null,T),H.isFunction(U)&&on(U,z),!1},function(He){var Re=0===He.total?100:Math.round(100*He.loaded/He.total);[He.loaded," / ",He.total].join(""),Re>=100&&He.loaded<He.total&&(Re=99),z._OnPercentDone([0,Re,"","http"])},K),ue?void 0:!!X}},{key:"LoadImage",value:function(T,D,R){var P=this,O=!1;if(H.isFunction(D)&&(O=!0),P._resetErr(),!P._isValid())return H.isFunction(R)&&on(R,P),!!O&&void 0;var U,G,X,z=zn.replaceLocalFilename(T),K=zn.getImageType(z);D&&H.isFunction(D)&&(G=function(ue){D()}),R&&H.isFunction(R)&&(X=function(ue){R(ue.code,ue.message)}),U=P.__GetLoadEventsNum(),""==z&&(P.__bOpenFileNow=!0);var oe=P._getCurrentDocumentName(),ae=P._getCurrentDefaultTagName();return P.__innerLoadImage("LoadImage",Et(z,U,1,oe,ae),K,!0,1,G,X)}},{key:"LoadImageEx",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G,X,z,K=zn.replaceLocalFilename(T),oe=D;if(R&&H.isFunction(R)&&(X=function(Ue){R()}),P&&H.isFunction(P)&&(z=function(Ue){P(Ue.code,Ue.message)}),!he.bAndroid){oe==be.DWT.EnumDWT_ImageType.IT_ALL&&(oe=-1),G=O.__GetLoadEventsNum(),""==K&&(O.__bOpenFileNow=!0);var ae=O._getCurrentDocumentName(),ue=O._getCurrentDefaultTagName();return O.__innerLoadImage("LoadImageEx",Et(K,oe,G,1,ae,ue),oe,!0,1,X,z)}var ye=pt.one(".d-loadImage");if(0==ye.length){var Ie=document.createElement("input");Ie._stwain=O,Ie.setAttribute("type","file"),Ie.setAttribute("multiple","multiple"),Ie.style="position:absolute;top:-2px;left:-2px;width:1px;height:1px;",Ie.className="d-loadImage",Ie.setAttribute("accept",D==be.DWT.EnumDWT_ImageType.IT_BMP?"image/bmp":D==be.DWT.EnumDWT_ImageType.IT_JPG?"image/jpeg":D==be.DWT.EnumDWT_ImageType.IT_TIF?"image/tiff":D==be.DWT.EnumDWT_ImageType.IT_PNG?"image/png":D==be.DWT.EnumDWT_ImageType.IT_PDF?".pdf":D==be.DWT.EnumDWT_ImageType.IT_J2K?".jp2,.j2k,.j2c":Po.bMobile?"image/jpeg,image/png,image/tiff,image/tif":"image/*,.pdf,.jp2,.j2k,.j2c"),Ie.ondoubleclick=function(){this.files.length>0&&this._stwain.LoadImageFromBinary(this.files,X,z),this.value="",this._stwain=null,Ie&&Ie.parentElement.removeChild(Ie)},Ie.onchange=function(){this.files.length>0&&this._stwain.LoadImageFromBinary(this.files,X,z),this.value="",this._stwain=null,Ie&&Ie.parentElement.removeChild(Ie)},document.body.appendChild(Ie),Ie.click()}else ye[0].setAttribute("accept",D==be.DWT.EnumDWT_ImageType.IT_BMP?"image/bmp":D==be.DWT.EnumDWT_ImageType.IT_JPG?"image/jpeg":D==be.DWT.EnumDWT_ImageType.IT_TIF?"image/tiff":D==be.DWT.EnumDWT_ImageType.IT_PNG?"image/png":D==be.DWT.EnumDWT_ImageType.IT_PDF?".pdf":D==be.DWT.EnumDWT_ImageType.IT_J2K?".jp2,.j2k,.j2c":Po.bMobile?"image/jpeg,image/png,image/tiff,image/tif":"image/*,.pdf,.jp2,.j2k,.j2c"),ye[0].value="",ye[0]._stwain=O,ye[0].click()}},{key:"HTTPDownload",value:function(T,D,R,P){var O=this,U=!1;if(H.isFunction(R)&&(U=!0),O._resetErr(),!O._isValid())return H.isFunction(P)&&on(P,O),!!U&&void 0;var G=zn.getImageType(D);return O._innerHTTPDownloadThroughGet("HTTPDownload",T,D,G,R,P)}},{key:"HTTPDownloadEx",value:function(T,D,R,P,O){var U=this,G=!1;return H.isFunction(P)&&(G=!0),U._resetErr(),U._isValid()?U._innerHTTPDownloadThroughGet("HTTPDownloadEx",T,D,R,P,O):(H.isFunction(O)&&on(O,U),!!G&&void 0)}},{key:"getFormateDate",value:function(){var T=new Date,D=T.getFullYear(),R=T.getMonth()+1,P=T.getDate(),O=T.getHours(),U=T.getMinutes(),G=T.getSeconds();return R<=9&&(R="0"+R),P<=9&&(P="0"+P),O<=9&&(O="0"+O),U<=9&&(U="0"+U),G<=9&&(G="0"+G),{currentTime_title:D+"-"+R+"-"+P+" "+O+":"+U+":"+G,currentTime_info:R+"/"+P+"/"+D+" "+O+":"+U+":"+G}}},{key:"__shareImagesInner",value:function(T,D,R,P){var O=navigator;O.canShare&&O.canShare({files:T})&&O.share({files:T,title:D,text:this.getFormateDate().currentTime_info}).then(function(){H.isFunction(R)&&R()}).catch(function(U){H.isFunction(P)&&P(U)})}},{key:"ShareImages",value:(S=_t(B.mark(function T(D,R,P){var O,U,G,X,z,K,oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(O=this,!he.bAndroid){ye.next=39;break}if(P!=Ti.IT_ALL&&P!=Ti.IT_MULTIPAGE_PDF&&P!=Ti.IT_MULTIPAGE_TIF){ye.next=5;break}throw Xle(O),{code:O._errorCode,message:O._errorString};case 5:if(!((U=R.sort(function(Ie,Ue){return Ie-Ue})).length>0)){ye.next=37;break}if(G="IMAGE File",P==Ti.IT_PDF&&(G="PDF File"),X=LP(D,P),H.isUndefined(X)&&(X=D),P!=Ti.IT_PDF&&P!=Ti.IT_TIF){ye.next=15;break}return ye.abrupt("return",new pt.Promise(function(Ie,Ue){O.ConvertToBlob(U,P,function(He,Re,Oe){var Ge=[new File([He],X,{type:He.type})];O.__shareImagesInner(Ge,G,function(){Ie()},function(Se){Ue({code:0!=Se.code?Se.code:2201,message:Se.message})})},function(){Ue({code:O._errorCode,message:O._errorString})})}));case 15:z=[],K=X,ye.t0=P,ye.next=ye.t0===Ti.IT_BMP?20:ye.t0===Ti.IT_JPG?22:ye.t0===Ti.IT_PNG?24:26;break;case 20:return oe=".bmp",ye.abrupt("break",27);case 22:return oe=".jpg",ye.abrupt("break",27);case 24:return oe=".png",ye.abrupt("break",27);case 26:oe=".jpg";case 27:X&&X.lastIndexOf(".")>0&&(K=X.substring(0,X.lastIndexOf(".")),oe=X.substring(X.lastIndexOf("."),X.length)),ae=B.mark(function Ie(Ue){return B.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return He.next=2,new pt.Promise(function(Re,Oe){O.ConvertToBlob([U[Ue]],P,function(Ge,Se,de){z.push(0==Ue?new File([Ge],K+oe,{type:Ge.type}):new File([Ge],K+Ue+oe,{type:Ge.type})),Re()},function(){Oe({code:O._errorCode,message:O._errorString})})});case 2:case"end":return He.stop()}},Ie)}),ue=0;case 31:if(!(ue<U.length)){ye.next=36;break}return ye.delegateYield(ae(ue),"t1",33);case 33:ue++,ye.next=31;break;case 36:O.__shareImagesInner(z,G);case 37:ye.next=41;break;case 39:throw St(O,-2617,"ShareImages is only supported on Android devices."),{code:O._errorCode,message:O._errorString};case 41:case"end":return ye.stop()}},T,this)})),function(T,D,R){return S.apply(this,arguments)})},{key:"Addon",get:function(){return this.__addon}},{key:"LoadDibFromClipboard",value:function(T,D){var R,P,G,O=this,U=!1;return H.isFunction(T)&&(U=!0),O._resetErr(),O._isValid()?O._bRemoteMode?(St(O,-2609,"LoadDibFromClipboard is not supported when Object is created by CreateRemoteScanObjectAsync."),H.isFunction(D)&&on(D,O),!!U&&void 0):(T&&H.isFunction(T)&&(R=function(X){T()}),D&&H.isFunction(D)&&(P=function(X){D(X.code,X.message)}),G=O.__GetLoadEventsNum(),O.__innerLoadImage("LoadDibFromClipboard",Et(G,1),-1,!0,1,R,P)):(H.isFunction(D)&&on(D,O),!!U&&void 0)}},{key:"__innerGetBarcodeResultAsyncFunction",value:function(T){var D=me.NewBarcodeResult();return T&&(D._errorCode=T.exception,D._errorString=T.description,D._resultlist=T.result,D._Count=T.result.length),D}},{key:"__innerGetOCRResultAsyncFunction",value:function(T){var D=me.NewOCRResult(this);return T&&(D._errorCode=T.exception,D._errorString=T.description,D._resultlist=T.result),D}},{key:"__innerFTPUpload",value:function(T,D,R,P){return me.cancelFrom=Zn.FTPUpload,bu(this,xW,Tfe).call(this,T,D,!0,R,P)}},{key:"_GetHttpHeadersAndClear",value:function(){var T=this.__httpHeaderMap;return this.__httpHeaderMap={},T||(T={}),T}},{key:"_asyncUploadCmd",value:function(T){var D,R=this,P=T.url,O=T.asyncSuccessFunc,U=T.asyncFailureFunc,G=R.IfShowCancelDialogWhenImageTransfer,X=null===(D=me.progressContext)||void 0===D?void 0:D.IfShowCancelDialogWhenImageTransfer,z=T.method,K=T.serverIds,oe=T.headers,ae=T.formData,ue=T.enumImageType,ye=T.dataFormat,Ie=T.fileName,Ue=T.saveSetup,He=T.retry,Re=T.bOnlyResponseEmptyIsOK,Oe=T.objUploadFileStatus,Ge=function(Se,de,ge){R.IfShowCancelDialogWhenImageTransfer=G,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=X);var _e=[];if(H.isArray(K)&&H.each(K,function(ve){var Te=R._ImgManager.convertServerIdToClientIndex(ve);Te>-1&&_e.push(Te)}),0!=Se&&de&&(R._errorCode=Se,R._errorString=de),ge&&(R.__HTTPPostResponseString=ge),H.isFunction(U))try{U(_e)}catch(ve){}return!1};return H.isNumber(He)&&He>0||(He=0),0!=R._errorCode?Ge(R._errorCode,R._errorString,R.__HTTPPostResponseString):(R.__HTTPPostResponseString="",R.IfShowCancelDialogWhenImageTransfer=!0,me.progressContext.IfShowCancelDialogWhenImageTransfer=R.IfShowCancelDialogWhenImageTransfer,x._innerHTTPUpload(R,z,P,oe,ae,K,ue,ye,Ie,Ue,He,Re,Oe,function(Se){if(R.IfShowCancelDialogWhenImageTransfer=G,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=X),H.isFunction(O)){var de=[];H.isArray(K)&&H.each(K,function(ge){var _e=R._ImgManager.convertServerIdToClientIndex(ge);_e>-1&&de.push(_e)});try{ws(O,Se,de)}catch(ge){}Se=null}return!0},Ge))}}],[{key:"_innerHTTPUpload",value:function(T,D,R,P,O,U,G,X,z,K,oe,ae,ue,ye,Ie){var Ue=parseInt(G),He=parseInt(X),Re=z,Oe=R,Ge=T._segementUploadThreshold;if(H.isUndefined(G))return Kl(T),H.isFunction(Ie)&&Ie(T._errorCode,T._errorString,""),!1;T._resetErr(),me.cancelFrom=Zn.HTTPUpload;var Se,de=function(_e,ve,Te){return 0!=_e&&ve&&(T._errorCode=_e,T._errorString=ve),Te&&(T.__HTTPPostResponseString=Te),me.needShowTwiceShowDialog=!1,T.IfShowProgressBar&&me.closeProgress(null,D),H.isFunction(Ie)&&Ie(T._errorCode,T._errorString,T.__HTTPPostResponseString),!1},ge=T._createHttpUploaderConfig();if(ge.objUploadStatus=ue,Re=LP(Re,Ue),me.needShowTwiceShowDialog=!0,T.IfShowProgressBar?(me.showProgress(T,D,!1),me.progressContext&&(me.progressContext._onPercent=function(_e){var ve=0;_e&&(ve=Math.floor(_e.loaded/_e.total*100))>100&&(ve=100),me.progressBarOnPercentDone(-1,"Transferring...","",ve,"")})):me.hideProgress(),He==be.DWT.EnumDWT_UploadDataFormat.Binary){if(ue&&ue.bCancel)return ue.st=2,gu(T),de(T._errorCode,T._errorString);T._OnPercentDone([0,-1,Br.Encoding,"http"]),T._convertToBlobForUpload(Ue,U,K,4,function(_e,ve,Te){if(Se=function(Ct){return me.needShowTwiceShowDialog=!1,T.IfShowProgressBar&&me.closeProgress(null,D),H.isFunction(ye)&&ws(ye,Ct),!0},ue&&ue.bCancel)return ue.st=2,gu(T),de(T._errorCode,T._errorString);if(!_e||_e.size<=0)return is(T),de(T._errorCode,T._errorString);var We=T.__maxUploadImageSize;if(_e.size>We&&-1!=We)return bf(T),de(T._errorCode,T._errorString);if(0!=T._errorCode)return de(T._errorCode,T._errorString);if(be.DWT.IfAddMD5InUploadHeader&&ve&&""!=ve&&(P["dwt-md5"]=ve),Ge>0&&_e.size>Ge){T._OnPercentDone([0,-1,Br.Uploading,"http",Re]);var Ye=new Pf,Be=new Cd;return T.__remoteFilename&&""!=T.__remoteFilename&&(Be.remoteFilename=T.__remoteFilename),Be.url=Oe,Be.method=D,Be.content=_e,_e=null,Be.contentType=T._strHttpContentTypeFieldValue,Be.headers=P,Be.fileName=Re,Be.httpFormData=O,Be.retry=oe,Be.bOnlyResponseEmptyIsOK=ae,Be.blockSize=T._moduleSize,Ye.httpPostUploadFragment(ge,Be,Se,de)}var $e=new Pf,ze=new Cd;T.__remoteFilename&&""!=T.__remoteFilename&&(ze.remoteFilename=T.__remoteFilename),ze.url=Oe,ze.method=D,ze.content=_e,_e=null,ze.contentType=T._strHttpContentTypeFieldValue,ze.headers=P,ze.fileName=Re,ze.httpFormData=O,ze.retry=oe,ze.bOnlyResponseEmptyIsOK=ae,ze.blockSize=T._moduleSize,ge.objUploadStatus=ue,$e.httpPostUpload(ge,ze,Se,de)},de)}else He==be.DWT.EnumDWT_UploadDataFormat.Base64&&T._convertToBase64ByServerIdsWithUI(D,U,Ue,K,4,function(_e){var ve;if(!_e||_e.getLength()<=0)return is(T),de(T._errorCode,T._errorString);if(Se=function(){return me.needShowTwiceShowDialog=!1,T.IfShowProgressBar&&me.closeProgress(null,D),H.isFunction(ye)&&ws(ye,_e),!0},Ge>0&&_e.getLength()>Ge){ve=_e.getMD5(),be.DWT.IfAddMD5InUploadHeader&&(P["dwt-md5"]=ve),T._OnPercentDone([0,-1,Br.Uploading,"http"]);var Te=new Cd;T.__remoteFilename&&""!=T.__remoteFilename&&(Te.remoteFilename=T.__remoteFilename),Te.url=Oe,Te.method=D,Te.content=_e.getData(0,_e.getLength()),Te.headers=P,Te.fileName=Re,Te.httpFormData=O,Te.retry=oe,Te.bOnlyResponseEmptyIsOK=ae,Te.blockSize=T._moduleSize,Te.offset=0,(new Pf).httpPostUploadFragment(ge,Te,Se,de)}else{var We;if(ve=_e.getMD5(),be.DWT.IfAddMD5InUploadHeader&&(P["dwt-md5"]=ve),!(We=_e.getData(0,_e.getLength()))||""==We)return is(T),de(T._errorCode,T._errorString);var Ye=new Cd;T.__remoteFilename&&""!=T.__remoteFilename&&(Ye.remoteFilename=T.__remoteFilename),Ye.url=Oe,Ye.method=D,Ye.content=We,Ye.headers=P,Ye.fileName=Re,Ye.httpFormData=O,Ye.retry=oe,Ye.bOnlyResponseEmptyIsOK=ae,Ye.blockSize=T._moduleSize,(new Pf).httpPostUpload(ge,Ye,Se,de)}},de)}}]);var S}(wqe);function TC(C,x,S,T,D,R,P,O){var U,G,X=this,z="HTTPUploadThroughPostEx",K=X._GetHttpHeadersAndClear(),oe=zn.combineUrl(X,C,S),ae=[],ue=function(Oe){H.isFunction(P)&&P(Oe)},Ie=!1;if(H.isFunction(R)&&(Ie=!0),X.__HTTPPostResponseString="",H.isNumber(x)){if(x<-2)return Mt(X),ue(x),!!Ie&&void 0}else if(!H.isArray(x))return Mt(X),ue(x),!!Ie&&void 0;if(!H.isString(T)||""==T)return is(X),ue(),!!Ie&&void 0;if(H.isUndefined(D))return Kl(X),ue(x),!!Ie&&void 0;if(D==be.DWT.EnumDWT_ImageType.IT_BMP||D==be.DWT.EnumDWT_ImageType.IT_JPG||D==be.DWT.EnumDWT_ImageType.IT_PNG||D==be.DWT.EnumDWT_ImageType.IT_J2K){if(-1==x&&X._ImgManager.count()>1||H.isArray(x)&&x.length>1)return eC(X),ue(x),!!Ie&&void 0;H.isArray(x)?ae.push(x[0]):ae.push(-1==x?0:x)}else{if(D!=be.DWT.EnumDWT_ImageType.IT_TIF&&D!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(X),ue(x),!!Ie&&void 0;if(-1==x){if(0==X._ImgManager.count())return ta(X),ue(),!!Ie&&void 0;for(G=0;G<X._ImgManager.count();G++)ae.push(G)}else if(-2==x)ae=X._ImgManager.getSelectedClientIndexArray();else if(H.isArray(x))for(G=0;G<x.length;G++)ae.push(x[G]);else ae.push(x)}if(""===C)return sB(X),ue(ae),!!Ie&&void 0;if(H.isUndefined(oe)||""===oe)return wl(X),ue(ae),!!Ie&&void 0;if(!H.isString(oe))return kS(X),ue(ae),!!Ie&&void 0;if(0!=oe.indexOf("http://")&&0!=oe.indexOf("https://")&&(oe=me.detect.ssl?"https://"+oe:"http://"+oe),!X._checkIndices(ae)&&-1!=ae)return ue(ae),!!Ie&&void 0;var Ue=[];if(H.isArray(ae)&&H.each(ae,function(Oe){var Ge=X._ImgManager.convertClientIndexToServerId(Oe);-1!=Ge&&Ue.push(Ge)}),X._resetErr(),!X._isValid())return ue(ae),!!Ie&&void 0;if(!Ie){me.cancelFrom=Zn.HTTPUpload;var He=this.IfShowProgressBar,Re=function(Oe,Ge,Se){return 0!=Oe&&Ge&&(X._errorCode=Oe,X._errorString=Ge),Se&&(X.__HTTPPostResponseString=Se),me.needShowTwiceShowDialog=!1,He&&me.closeProgress(null,z),ue(ae),!1};return me.needShowTwiceShowDialog=!0,He?me.showProgress(X,z,!1):me.hideProgress(),X._OnPercentDone([0,-1,Br.Encoding,"http"]),X._dwtConvertToBlobSync(D,Ue,!1,function(Oe,Ge){if(me.needShowTwiceShowDialog=!1,Oe){var Se=X.__maxUploadImageSize;if(Oe.size>Se&&-1!=Se)return bf(X),Re(X._errorCode,X._errorString),!1;be.DWT.IfAddMD5InUploadHeader&&Ge&&""!=Ge&&(K["dwt-md5"]=Ge),Oe instanceof File?Oe.fileName=T:Oe.name=T,He&&tg(X.__IfShowCancelDialogWhenImageTransfer);var de=X._createHttpUploaderConfig(),ge=new Cd;return X.__remoteFilename&&""!=X.__remoteFilename&&(ge.remoteFilename=X.__remoteFilename),ge.url=oe,ge.method=z,ge.content=Oe,ge.contentType=X._strHttpContentTypeFieldValue,ge.headers=K,ge.bAsync=!1,ge.httpFormData=Bm(X.httpFormFields),ge.blockSize=X._moduleSize,(new Pf).httpPostUpload(de,ge,function(ve){return He&&me.closeProgress(null,z),ve},Re)}var _e={};return lB(_e),Re(_e._errorCode,_e._errorString),!1},Re)}U={method:"HTTPUploadThroughPostEx",url:oe,serverIds:Ue,headers:K,formData:Bm(X.httpFormFields),enumImageType:D,saveSetup:!1,fileName:T,retry:0,bOnlyResponseEmptyIsOK:!0,objUploadFileStatus:!1,dataFormat:be.DWT.EnumDWT_UploadDataFormat.Binary,asyncSuccessFunc:R,asyncFailureFunc:ue},this._asyncUploadCmd(U)}function Sfe(C,x,S,T,D){var R=this;if(x)return R._innerFunRaw("SaveSelectedImagesToBytes",Et(0,0,C,S),x,!0,!0,function(G){if(H.isFunction(T)){var X=new Blob([G],{type:R._strHttpContentTypeFieldValue});T(X),X=null}},D),!0;var O=R._innerFunRaw("SaveSelectedImagesToBytes",Et(0,0,C,S),x,!0,!1);if(0==R._errorCode){var U=T(O);return O=null,U}return O=null,D(),!1}function Eqe(){return this._resetErr(),!!this._isValid()&&(this._innerSend("SetCancel",null,!0),!0)}function Tfe(C,x,S,T,D){var R=this;if(!H.isFunction(T))return this._innerFun(C,x);R.IfShowProgressBar?(me.showProgress(R,C,S),S&&me.progressContext&&me.progressContext.on("cancel",function(){bu(R,wfe,Eqe).call(R)})):me.hideProgress(),this._innerSend(C,x,!0,function(){me.closeProgress(null,C),H.isFunction(T)&&T()},function(P){H.isFunction(D)&&D(R._errorCode,R._getErrorString()),me.closeProgress(null,C),P&&H.error(P)})}function Ife(C,x,S,T,D){var R,P=this,O=!1;if(H.isFunction(T)&&(O=!0),!mn.checkProductKey(P,{Core:!0})||!mn.checkPDFProductKeyWhenNeeds(P,S))return H.isFunction(D)&&on(D,P),!!O&&void 0;if(me.cancelFrom=Zn.FTPDownload,!O){var U=P._getCurrentDocumentName(),G=P._getCurrentDefaultTagName();(R=P.__innerLoadImageFun(C,x,1,U,G))&&P._canConsume()&&be.DWT.lcvrf(P);var X=P._ImgManager.getCurrentImageIndex();return X>=0&&P._innerRefreshUI(X),R}bu(P,xW,Tfe).call(P,C,x,!0,function(){var z=P._ImgManager.getCurrentImageIndex();z>=0&&P._innerRefreshUI(z),P._canConsume()&&be.DWT.lcvrf(P),H.isFunction(T)&&T()},D)}function Efe(C,x,S,T){if(0==C._ImgManager.count())return ta(C),H.isFunction(T)&&T(x),!1;if(H.isNumber(x)){if(isNaN(x)||x<-2||x>=C._ImgManager.count())return Mt(C),H.isFunction(T)&&T(x),!1}else{if(!H.isArray(x))return Mt(C),H.isFunction(T)&&T(x),!1;var D;for(D=0;D<x.length;D++){var R=x[D];if(isNaN(R)||!H.isNumber(R)||R<0||R>=C._ImgManager.count())return Fle(C),H.isFunction(T)&&T(x),!1}}if(S==be.DWT.EnumDWT_ImageType.IT_BMP||S==be.DWT.EnumDWT_ImageType.IT_JPG||S==be.DWT.EnumDWT_ImageType.IT_PNG||S==be.DWT.EnumDWT_ImageType.IT_J2K)(-1==x&&C._ImgManager.count()>1||H.isArray(x)&&x.length>1)&&(eC(C),H.isFunction(T)&&T(x));else if(S!=be.DWT.EnumDWT_ImageType.IT_TIF&&S!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(C),H.isFunction(T)&&T(x),!1;return!0}function Bm(C){var x;return C&&(x=new FormData,H.each(C,function(S,T){S instanceof Blob?x.append(T,S,S.name):x.append(T,S)})),x}var WP,Rf=function(C){function x(){return n(this,x),P=this,U=arguments,O=qn(O=x),Za(P,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(G){return!1}}()?Reflect.construct(O,U||[],qn(P).constructor):O.apply(P,U));var P,O,U}return el(x,C),v(x,[{key:"Viewer",get:function(){return this._viewer}},{key:"BindViewer",value:function(P){var O=this,U=P;return be.DWT.UseDefaultViewer?(H.isString(P)&&(U=H.get(P),H.show(U)),O._config.container!=U&&(O._config.container=U,vfe(O)),O._UIView.BindView(P)):(St(O,-2439,"You cannot call the method bindViewer() when Dynamsoft.DWT.UseDefaultViewer is set to false."),!1)}},{key:"UnbindViewer",value:function(){return this._innerUnbindViewer(!1)}},{key:"AddText",value:function(P,O,U,G,X,z,K,oe){var ue=parseInt(P);if(!na(this,ue))return!1;var ye=ad.RGB2BGR(X),Ie=ad.RGB2BGR(z),Ue=this._ImgManager.convertClientIndexToServerId(ue);return-1==Ue?(Mt(this),!1):this._innerFun("AddText",Et(Ue,O,U,G,ye,Ie,K,oe))}},{key:"CreateTextFont",value:function(P,O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He){return this._resetErr(),!!this._isValid()&&this._innerFun("CreateTextFont",Et(P,O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He))}},{key:"CopyToClipboard",value:function(P){var O=parseInt(P);return!!na(this,O)&&a3(this,"CopyToClipboard",O,null,null,!1,!1)}},{key:"CopyToClipboardAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var G,K,U=parseInt(P);return isNaN(U)?(Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):U<0||U>=O._ImgManager.count()?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):-1==(K=(G=O)._ImgManager.convertClientIndexToServerId(U))?(Mt(G),pt.Promise.reject({code:G._errorCode,message:G._errorString})):G._innerFunV2("CopyToClipboard",Et(K))}},{key:"getView",value:function(){return this._UIView}},{key:"Erase",value:function(P,O,U,G,X,z,K){var oe=this;if(!H.isFunction(z)){var ae,ue=parseInt(P);if(!na(oe,ue,K))return!1;var ye=oe._ImgManager.convertClientIndexToServerId(ue);return-1==ye?(Mt(oe),H.isFunction(K)&&K(oe._errorCode,oe._getErrorString()),!1):(oe.getView().ClearSelectedAreas(),(ae=1==oe._innerFun("Erase",Et(ye,O,U,G,X)))?H.isFunction(z)&&z():H.isFunction(K)&&K(oe._errorCode,oe._getErrorString()),ae)}oe.EraseAsync(P,O,U,G,X).then(z,function(Ie){oe._wrappeAsyncFailed(oe,Ie,K)})}},{key:"EraseAsync",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return pt.Promise.reject({code:z._errorCode,message:z._errorString});var K=parseInt(P);if(isNaN(K))return Jn(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});if(K<0||K>=z._ImgManager.count())return Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});var oe=z._ImgManager.convertClientIndexToServerId(K);return-1==oe?(Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString})):(z.getView().ClearSelectedAreas(),z._innerFunV2("Erase",Et(oe,O,U,G,X),!0).then(function(ae){if(1!=ae)throw{code:z._errorCode,message:z._errorString}}))}},{key:"GetImageBitDepth",value:function(P){var O=this,U=parseInt(P);if(!na(O,U))return!1;var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),!1):O._innerFun("GetImageBitDepth",Et(G))}},{key:"GetImageWidth",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return!1;var U=parseInt(P);if(isNaN(U))return Jn(O),-1;if(U<0||U>=O._ImgManager.count())return Mt(O),-1;var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),-1):O._innerFun("GetImageWidth",Et(G))}},{key:"GetImageHeight",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return!1;var U=parseInt(P);if(isNaN(U))return Jn(O),-1;if(U<0||U>=O._ImgManager.count())return Mt(O),-1;var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),-1):O._innerFun("GetImageHeight",Et(G))}},{key:"GetImageSize",value:function(P,O,U){var G=this;if(G._resetErr(),!G._isValid())return!1;var X=parseInt(P);if(isNaN(X))return Jn(G),-1;if(X<0||X>=G._ImgManager.count())return Mt(G),-1;var z=G._ImgManager.convertClientIndexToServerId(X);return-1==z?(Mt(G),-1):G._innerFun("GetImageSize",Et(z,O,U))}},{key:"GetImageSizeWithSpecifiedType",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return!1;var G=parseInt(P);if(isNaN(G))return Jn(U),-1;if(G<0||G>=U._ImgManager.count())return Mt(U),-1;var X=U._ImgManager.convertClientIndexToServerId(G);return-1==X?(Mt(U),-1):U._innerFun("GetImageSizeWithSpecifiedType",Et(X,O))}},{key:"GetImageXResolution",value:function(P){var O=this,U=parseInt(P);if(!na(O,U))return!1;var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),!1):O._innerFun("GetImageXResolution",Et(G))}},{key:"GetImageYResolution",value:function(P){var O=this,U=parseInt(P);if(!na(O,U))return!1;var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),!1):O._innerFun("GetImageYResolution",Et(G))}},{key:"SelectAllImages",value:function(){var P,O=this,U=O._getHowManyImagesInBuffer(),G=[];if(O._resetErr(),!O._isValid())return!1;for(P=0;P<U;P++)G.push(P);return O._ImgManager.setSelectedClientIndexArray(G),G}},{key:"SelectImages",value:function(P){var O=this;return O._resetErr(),!!O._isValid()&&O._ImgManager.setSelectedClientIndexArray(P)}},{key:"GetSkewAngle",value:function(P,O,U){var G,X=this;if(!H.isFunction(O)){var z=parseInt(P);return!!na(X,z,U)&&(G=a3(X,"GetSkewAngle",z,O,U,!0,!1),0==X._errorCode?(zn.refreshImageAfterInvokeFun(X,z),G):0)}X.GetSkewAngleAsync(P).then(O,function(K){X._wrappeAsyncFailed(X,K,U)})}},{key:"GetSkewAngleAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetSkewAngle",Et(G),!0).then(function(X){var z=X;return H.isArray(X)&&(z=X.length>0?X[0]:0),zn.refreshImageAfterInvokeFun(O,U),z})}},{key:"GetSkewAngleEx",value:function(P,O,U,G,X){var z=this,K=parseInt(P);if(!na(z,K))return!1;var oe=z._ImgManager.convertClientIndexToServerId(K);return-1==oe?(Mt(z),!1):z._innerFun("GetSkewAngleEx",Et(oe,O,U,G,X))}},{key:"GetSkewAngleFromBinaryAsync",value:function(P,O,U,G){var X=this;if(X._resetErr(),!X._isValid())return pt.Promise.reject({code:X._errorCode,message:X._errorString});var z=this._imageBufferWrapper.getCustomDataByIndex(P),K=this._imageBufferWrapper.getMetadataByIndex(P),oe=this._ImgManager.convertClientIndexToServerId(P),ue=H.stringify([H.stringify({imageId:oe,serverId:oe,bufferLen:O.size,imageType:Ti.IT_BMP,width:K.width,height:K.height,bit:K.bitDepth,xres:K.resolutionX,yres:K.resolutionY,uidFromServer:z.uidFromServer})]);return this._innerSendBlob("GetSkewAngleFromBinary",ue,O,!0,!0,U,G)}},{key:"IsBlankImageEx",value:function(P,O,U,G,X,z){var K;if(!na(this,K=parseInt(P)))return!1;var ae=this._ImgManager.convertClientIndexToServerId(K);return-1==ae?(Mt(this),!1):this._innerFun("IsBlankImageEx",Et(ae,O,U,G,X,z))}},{key:"MirrorAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("Mirror",Et(G),!0).then(function(X){if(1!=X)throw{code:O._errorCode,message:O._errorString};zn.refreshImageAfterInvokeFun(O,U),O.getView().ClearSelectedAreas()})}},{key:"Mirror",value:function(P,O,U){var G=this;if(!H.isFunction(O)){var X=parseInt(P);return!!na(G,X,U)&&a3(G,"Mirror",X,O,U,!1,!0)}G.MirrorAsync(P).then(O,function(z){G._wrappeAsyncFailed(G,z,U)})}},{key:"RemoveAllImages",value:function(){return this._removeAllImages("RemoveAllImages")}},{key:"RemoveAllImagesAsync",value:function(){return this._removeAllImagesAsync("RemoveAllImagesAsync",!0)}},{key:"RemoveImageAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("RemoveImage",Et(G),!0).then(function(X){return!(!X&&-1033!=O._errorCode||(O._OnBitmapChanged(["c1",""+G,3,O._ImgManager.getCurrentImageIndex(),O._ImgManager.count()]),0))})}},{key:"Rotate",value:function(P,O,U,G,X){return this.RotateEx(P,O,U,-1,G,X)}},{key:"_wrappeAsyncFailed",value:function(P,O,U){O&&(P._errorCode=O.code,P._errorString=O.message),H.isFunction(U)&&U(P._errorCode,P._getErrorString())}},{key:"RotateEx",value:function(P,O,U,G,X,z){var K=this;if(!H.isFunction(X)){if(K._resetErr(),!K._isValid())return!1;var oe,ae=parseInt(P);if(isNaN(ae))return Jn(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!1;if(ae<0||ae>=K._ImgManager.count())return Mt(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!1;var ue=K._ImgManager.convertClientIndexToServerId(ae);return-1==ue?(Mt(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!1):((oe=1==K._innerFun("RotateEx",Et(ue,O,U,G)))?(zn.refreshImageAfterInvokeFun(K,ae),K.getView().ClearSelectedAreas(),H.isFunction(X)&&X()):H.isFunction(z)&&z(K._errorCode,K._getErrorString()),oe)}K.RotateExAsync(P,O,U,G).then(X,function(ye){K._wrappeAsyncFailed(K,ye,z)})}},{key:"RotateLeft",value:function(P,O,U){return this.RotateEx(P,-90,!0,-1,O,U)}},{key:"RotateRight",value:function(P,O,U){return this.RotateEx(P,90,!0,-1,O,U)}},{key:"RotateAsync",value:function(P,O,U){return this.RotateExAsync(P,O,U,-1)}},{key:"RotateExAsync",value:function(P,O,U,G){var X=this;if(X._resetErr(),!X._isValid())return pt.Promise.reject({code:X._errorCode,message:X._errorString});var z=parseInt(P);if(isNaN(z))return Jn(X),pt.Promise.reject({code:X._errorCode,message:X._errorString});if(z<0||z>=X._ImgManager.count())return Mt(X),pt.Promise.reject({code:X._errorCode,message:X._errorString});var K=X._ImgManager.convertClientIndexToServerId(z);return-1==K?(Mt(X),pt.Promise.reject({code:X._errorCode,message:X._errorString})):X._innerFunV2("RotateEx",Et(K,O,U,G),!0).then(function(oe){if(1!=oe&&1!=oe)throw{code:X._errorCode,message:X._errorString};zn.refreshImageAfterInvokeFun(X,z),X.getView().ClearSelectedAreas()})}},{key:"RotateLeftAsync",value:function(P){return this.RotateExAsync(P,-90,!0,-1)}},{key:"RotateRightAsync",value:function(P){return this.RotateExAsync(P,90,!0,-1)}},{key:"ChangeImageSize",value:function(P,O,U,G,X,z){var K=this;if(!H.isFunction(X)){var oe,ae=parseInt(P),ue=1*O,ye=1*U;if(!na(K,ae,z))return!1;if(ue<=0||ye<=0)return Mle(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!1;var Ie=K._ImgManager.convertClientIndexToServerId(ae);return-1==Ie?(Mt(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!1):((oe=1==K._innerFun("ChangeImageSize",Et(Ie,ue,ye,G)))?(zn.refreshImageAfterInvokeFun(K,ae),H.isFunction(X)&&X()):H.isFunction(z)&&z(K._errorCode,K._getErrorString()),oe)}K.ChangeImageSizeAsync(P,O,U,G).then(X,function(Ue){K._wrappeAsyncFailed(K,Ue,z)})}},{key:"ChangeImageSizeAsync",value:function(P,O,U,G){var X=this,z=parseInt(P),K=1*O,oe=1*U;if(X._resetErr(),!X._isValid())return pt.Promise.reject({code:X._errorCode,message:X._errorString});if(isNaN(z))return Jn(X),pt.Promise.reject({code:X._errorCode,message:X._errorString});if(z<0||z>=X._ImgManager.count())return Mt(X),pt.Promise.reject({code:X._errorCode,message:X._errorString});if(K<=0||oe<=0)return Mle(X),pt.Promise.reject({code:X._errorCode,message:X._errorString});var ae=X._ImgManager.convertClientIndexToServerId(z);return-1==ae?(Mt(X),pt.Promise.reject({code:X._errorCode,message:X._errorString})):X._innerFunV2("ChangeImageSize",Et(ae,K,oe,G),!0).then(function(ue){if(1!=ue)throw{code:X._errorCode,message:X._errorString};zn.refreshImageAfterInvokeFun(X,z)})}},{key:"Flip",value:function(P,O,U){var G=this;if(!H.isFunction(O)){var X=parseInt(P);return!!na(G,X,U)&&a3(G,"Flip",X,O,U,!1,!0)}G.FlipAsync(P).then(O,function(z){G._wrappeAsyncFailed(G,z,U)})}},{key:"FlipAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("Flip",Et(G),!0).then(function(X){if(1!=X)throw{code:O._errorCode,message:O._errorString};zn.refreshImageAfterInvokeFun(O,U),O.getView().ClearSelectedAreas()})}},{key:"OutputSelectedAreaAsync",value:(R=_t(B.mark(function P(O,U,G,X){var z,K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge,Se,de;return B.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(oe="OutputSelectedArea",(K=this)._resetErr(),K._isValid()){ge.next=4;break}throw{code:K._errorCode,message:K._errorString};case 4:if(ae=0,ue=0,ye=0,Ie=0,!isNaN(O)){ge.next=8;break}throw Jn(K),{code:K._errorCode,message:K._errorString};case 8:if(G==Ti.IT_BMP||G==Ti.IT_JPG||G==Ti.IT_TIF||G==Ti.IT_PNG||G==Ti.IT_PDF){ge.next=11;break}throw Bi(K),{code:K._errorCode,message:K._errorString};case 11:if(X==Af.Blob||X==Af.Base64){ge.next=14;break}throw Bi(K),{code:K._errorCode,message:K._errorString};case 14:if(!(O<0||O>=K._ImgManager.count())){ge.next=17;break}throw Mt(K),{code:K._errorCode,message:K._errorString};case 17:if(-1!=(Ue=K._ImgManager.convertClientIndexToServerId(O))){ge.next=21;break}throw Mt(K),{code:K._errorCode,message:K._errorString};case 21:return Re=(He=X==Af.Base64)?"text":"arraybuffer",U&&(me.isNumber(U.x)&&(ae=U.x),me.isNumber(U.y)&&(ue=U.y),me.isNumber(U.width)&&(ye=U.width),me.isNumber(U.height)&&(Ie=U.height)),Ge=H.stringify([{index:Ue,left:ae,top:ue,width:ye,height:Ie}]),Se="["+Ge+","+G+","+X+"]",de=null===(z=me.progressContext)||void 0===z?void 0:z.IfShowCancelDialogWhenImageTransfer,ge.prev=27,K.IfShowProgressBar?me.showProgress(K,oe,!1):me.hideProgress(),K._OnPercentDone(He?[0,-1,Br.ConvertingToBase64]:[0,-1,Br.ConvertingToBlob]),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1),ge.next=33,K._sendDataByHttpAsync(oe,Se,Re,!0);case 33:Oe=ge.sent;case 34:return ge.prev=34,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=de),K.IfShowProgressBar&&me.closeProgress(null,oe),ge.finish(34);case 38:if(!He){ge.next=51;break}if(!Oe){ge.next=48;break}if(!wc(Oe)){ge.next=44;break}return K._errorCode=Oe.exception,K._errorString=Oe.description,ge.abrupt("return","");case 44:if(!(H.isArray(Oe.result)&&Oe.result.length>0&&H.isString(Oe.result[0]))){ge.next=46;break}return ge.abrupt("return",Oe.result[0]);case 46:ge.next=49;break;case 48:return ge.abrupt("return","");case 49:ge.next=52;break;case 51:return ge.abrupt("return",new Blob([Oe],{type:i9(G)}));case 52:case"end":return ge.stop()}},P,this,[[27,,34,38]])})),function(P,O,U,G){return R.apply(this,arguments)})},{key:"Crop",value:function(P,O,U,G,X,z,K){var oe=this;if(!H.isFunction(z)){var ae,ue=parseInt(P);if(!na(oe,ue,K))return!1;var ye,Ie,Ue=oe._ImgManager.convertClientIndexToServerId(ue);return-1==Ue?(Mt(oe),H.isFunction(K)&&K(oe._errorCode,oe._getErrorString()),!1):(ae=1==oe._innerFun("Crop",Et(Ue,O,U,G,X)),ye=oe._errorCode,Ie=oe._getErrorString(),oe.getView().ClearSelectedAreas(),oe._errorCode=ye,oe._errorString=Ie,ae?(zn.refreshImageAfterInvokeFun(oe,ue),H.isFunction(z)&&z()):H.isFunction(K)&&K(ye,Ie),ae)}oe.CropAsync(P,O,U,G,X).then(z,function(He){oe._wrappeAsyncFailed(oe,He,K)})}},{key:"CropAsync",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return pt.Promise.reject({code:z._errorCode,message:z._errorString});var K=parseInt(P);if(isNaN(K))return Jn(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});if(K<0||K>=z._ImgManager.count())return Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});var oe=z._ImgManager.convertClientIndexToServerId(K);return-1==oe?(Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString})):z._innerFunV2("Crop",Et(oe,O,U,G,X),!0).then(function(ae){var ue,ye;if(ue=z._errorCode,ye=z._getErrorString(),z.getView().ClearSelectedAreas(),z._errorCode=ue,z._errorString=ye,1!=ae)throw{code:z._errorCode,message:z._errorString};return zn.refreshImageAfterInvokeFun(z,K),!0})}},{key:"CropToClipboard",value:function(P,O,U,G,X){var z,K=this,oe=parseInt(P);if(!na(K,oe))return!1;var ae=K._ImgManager.convertClientIndexToServerId(oe);return-1==ae?(Mt(K),!1):(K.getView().ClearSelectedAreas(),(z=1==K._innerFun("CropToClipboard",Et(ae,O,U,G,X)))&&zn.refreshImageAfterInvokeFun(K,oe),z)}},{key:"CutFrameToClipboard",value:function(P,O,U,G,X){var z,K=this,oe=parseInt(P);if(!na(K,oe))return!1;var ae=K._ImgManager.convertClientIndexToServerId(oe);return-1==ae?(Mt(K),!1):(K.getView().ClearSelectedAreas(),(z=1==K._innerFun("CutFrameToClipboard",Et(ae,O,U,G,X)))&&zn.refreshImageAfterInvokeFun(K,oe),z)}},{key:"CutToClipboard",value:function(P){var O,U=this,G=parseInt(P);if(!na(U,G))return!1;var X=U._ImgManager.convertClientIndexToServerId(G);return-1==X?(Mt(U),!1):((O=1==U._innerFun("CutToClipboard",Et(X)))&&U._OnBitmapChanged(["c1",""+X,3,U._ImgManager.getCurrentImageIndex(),U._ImgManager.count()]),O)}},{key:"CutFrameToClipboardAsync",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return pt.Promise.reject({code:z._errorCode,message:z._errorString});var K=parseInt(P);if(isNaN(K))return Jn(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});if(K<0||K>=z._ImgManager.count())return Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});var oe=z._ImgManager.convertClientIndexToServerId(K);return-1==oe?(Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString})):z._innerFunV2("CutFrameToClipboard",Et(oe,O,U,G,X)).then(function(ae){var ue=1==ae;if(!ue)throw{code:z._errorCode,message:z._errorString};return zn.refreshImageAfterInvokeFun(z,K),ue})}},{key:"CropToClipboardAsync",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return pt.Promise.reject({code:z._errorCode,message:z._errorString});var K=parseInt(P);if(isNaN(K))return Jn(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});if(K<0||K>=z._ImgManager.count())return Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});var oe=z._ImgManager.convertClientIndexToServerId(K);return-1==oe?(Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString})):z._innerFunV2("CropToClipboard",Et(oe,O,U,G,X)).then(function(ae){var ue=1==ae;if(!ue)throw{code:z._errorCode,message:z._errorString};return zn.refreshImageAfterInvokeFun(z,K),ue})}},{key:"CutToClipboardAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("CutToClipboard",Et(G)).then(function(X){var z=1==X;if(!z)throw{code:O._errorCode,message:O._errorString};return O._OnBitmapChanged(["c1",""+G,3,O._ImgManager.getCurrentImageIndex(),O._ImgManager.count()]),z})}},{key:"SetDPI",value:function(P,O,U,G,X,z,K){var oe,ae=this,ue=!1;H.isFunction(z)&&(ue=!0);var ye=parseInt(P);if(!na(ae,ye,K))return!!ue&&void 0;var Ie=ae._ImgManager.convertClientIndexToServerId(ye);return-1==Ie?(Mt(ae),H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),!!ue&&void 0):((oe=1==ae._innerFun("SetDPI",Et(Ie,O,U,G,X)))?H.isFunction(z)&&z():H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),ue?void 0:oe)}},{key:"MoveImage",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return!1;var G=parseInt(P),X=parseInt(O);return isNaN(G)||isNaN(X)?(Jn(U),!1):G<0||G>=U._ImgManager.count()||X<0||X>=U._ImgManager.count()?(Mt(U),!1):U._ImgManager.moveImage(G,X)}},{key:"SwitchImage",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return!1;var G=parseInt(P),X=parseInt(O);return isNaN(G)||isNaN(X)?(Jn(U),!1):G<0||G>=U._ImgManager.count()||X<0||X>=U._ImgManager.count()?(Mt(U),!1):U._ImgManager.switchImage(G,X)}},{key:"CloseWorkingProcess",value:function(){var P=this;return P._resetErr(),!!P._isValid()&&P._innerFun("CloseWorkerProcess")}},{key:"RemoveAllSelectedImages",value:function(){var P=this;if(P._resetErr(),!P._isValid())return!1;var O=!0,U=P._ImgManager.getCurrentImageIndex(),G=P._ImgManager.getSelectedClientIndexArray(),X=[];if(H.isArray(G)&&H.each(G,function(K){var oe=P._ImgManager.convertClientIndexToServerId(K);-1!=oe&&X.push(oe)}),0==X.length&&U>=0){var z=P._ImgManager.convertClientIndexToServerId(U);X.push(z)}return X.length>0&&(O=P._innerFun("RemoveAllSelectedImages",Et(X.join(",")))),O&&H.each(X,function(K){P._OnBitmapChanged(["c1",""+K,3,P._ImgManager.getCurrentImageIndex(),P._ImgManager.count()])}),O}},{key:"RemoveAllSelectedImagesAsync",value:function(){var P=this;if(P._resetErr(),!P._isValid())return pt.Promise.reject({code:P._errorCode,message:P._errorString});var O=P._ImgManager.getCurrentImageIndex(),U=P._ImgManager.getSelectedClientIndexArray(),G=[];if(H.isArray(U)&&H.each(U,function(z){var K=P._ImgManager.convertClientIndexToServerId(z);-1!=K&&G.push(K)}),0==G.length&&O>=0){var X=P._ImgManager.convertClientIndexToServerId(O);G.push(X)}return G.length>0?P._innerFunV2("RemoveAllSelectedImages",Et(G.join(","),!0)).then(function(z){z&&H.each(G,function(K){P._OnBitmapChanged(["c1",""+K,3,P._ImgManager.getCurrentImageIndex(),P._ImgManager.count()])})}):pt.Promise.resolve()}},{key:"TagImages",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return!1;var G=!0,X=U._ImgManager.count();return H.isArray(P)?H.isString(O)&&""!=O?(H.each(P,function(z){if(isNaN(z)||z<0||z>=X)return Mt(U),G=!1}),G&&U._ImgManager.addImageTag(P,O)):(St(U,-2394,"Invalid tag name."),!1):(tC(U),!1)}},{key:"ClearImageTags",value:function(P){var O=this;return O._resetErr(),!!O._isValid()&&(-1==P||P>=O._getHowManyImagesInBuffer()?(Mt(O),!1):O._ImgManager.removeImageTag(P))}},{key:"SetDefaultTag",value:function(P){var O=this;return O._resetErr(),!!O._isValid()&&O._ImgManager.setDefaultTag(P)}},{key:"FilterImagesByTag",value:function(P,O,U){var G,X=this,z=!1;if(H.isFunction(O)&&(z=!0),X._resetErr(),!X._isValid())return!!z&&void 0;H.isFunction(U)&&(G=function(){U({code:X._errorCode,message:X._errorString})});var K=X._ImgManager.showImagesByFilter(P,O,G);return z?void 0:K}},{key:"ClearFilter",value:function(){var P=this;return P._resetErr(),!!P._isValid()&&P._ImgManager.clearFilter()}},{key:"CreateDocument",value:function(P){var O=this;return O._resetErr(),!!O._isValid()&&(P&&""!=P?H.isString(P)?O._ImgManager.CreateFile(P):(MS(O),!1):(H.isNumber(P)?MS(O):dB(O),!1))}},{key:"OpenDocument",value:function(P){var O=this;return O._resetErr(),!!O._isValid()&&(P&&""!=P?H.isString(P)?O._ImgManager.OpenFile(P):(MS(O),!1):(H.isNumber(P)?MS(O):dB(O),!1))}},{key:"RemoveDocument",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return!1;var U=O._ImgManager.GetServerIdsByFileName(P);return U.length>0&&O._innerFun("RemoveAllSelectedImages",Et(U.join(","))),O._ImgManager.RemoveFile(P)}},{key:"RenameDocument",value:function(P,O){var U=this;return U._resetErr(),!!U._isValid()&&(H.isString(P)&&H.isString(O)?P&&""!=P&&O&&""!=O?U._ImgManager.RenameFile(P,O):(dB(U),!1):(MS(U),!1))}},{key:"GetDocumentInfoList",value:function(){var P=this;return P._resetErr(),!!P._isValid()&&P._ImgManager.GetFileInfoList()}},{key:"MoveToDocumentAsync",value:(D=_t(B.mark(function P(O,U,G,X){var z,K,oe,ae,ue,ye,Ie,Ue,He,Re;return B.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:if((z=this)._resetErr(),z._isValid()){Oe.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(!H.isUndefined(O)&&0!=O.length){Oe.next=7;break}throw zA(z),{code:z._errorCode,message:z._errorString};case 7:if(!H.isUndefined(U)&&0!=U.length){Oe.next=10;break}throw YA(z),{code:z._errorCode,message:z._errorString};case 10:K=z._ImgManager.GetFileInfoList(),ue=0;case 12:if(!(ue<K.length)){Oe.next=20;break}if(K[ue].name!=O){Oe.next=17;break}return oe=K[ue],Oe.abrupt("break",20);case 17:ue++,Oe.next=12;break;case 20:ye=0;case 21:if(!(ye<K.length)){Oe.next=29;break}if(K[ye].name!=U){Oe.next=26;break}return ae=K[ye],Oe.abrupt("break",29);case 26:ye++,Oe.next=21;break;case 29:if(!H.isUndefined(oe)){Oe.next=32;break}throw zA(z),{code:z._errorCode,message:z._errorString};case 32:if(!H.isUndefined(ae)){Oe.next=35;break}throw YA(z),{code:z._errorCode,message:z._errorString};case 35:if(Ie=[],!H.isUndefined(G)){Oe.next=40;break}if(oe.imageIds.length>0)for(He=0;He<oe.imageIds.length;He++)Ie.push(He);Oe.next=60;break;case 40:if(!H.isArray(G)){Oe.next=53;break}if(z._checkIndices(G,oe.imageIds.length)){Oe.next=43;break}throw{code:z._errorCode,message:z._errorString};case 43:if(Ie=G,H.isUndefined(X)){Oe.next=51;break}if(!H.isNumber(X)){Oe.next=49;break}X<0?Ue=0:ae.imageIds.length>X&&(Ue=X),Oe.next=51;break;case 49:throw Bi(z),{code:z._errorCode,message:z._errorString};case 51:Oe.next=60;break;case 53:if(!H.isNumber(G)){Oe.next=58;break}if(oe.imageIds.length>0)for(Re=0;Re<oe.imageIds.length;Re++)Ie.push(Re);G<0?Ue=0:ae.imageIds.length>G&&(Ue=G),Oe.next=60;break;case 58:throw Bi(z),{code:z._errorCode,message:z._errorString};case 60:return Oe.abrupt("return",new pt.Promise(function(Ge,Se){0==Ie.length||z._ImgManager.MoveImageToFile(O,Ie,U,Ue)?Ge():Se({code:z._errorCode,message:z._errorString})}));case 61:case"end":return Oe.stop()}},P,this)})),function(P,O,U,G){return D.apply(this,arguments)})},{key:"CopyToDocumentAsync",value:(T=_t(B.mark(function P(O,U,G,X){var z,K,oe,ae,ue,ye,Ie,Ue;return B.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:if((z=this)._resetErr(),z._isValid()){He.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(!H.isUndefined(O)&&0!=O.length){He.next=7;break}throw zA(z),{code:z._errorCode,message:z._errorString};case 7:if(!H.isUndefined(U)&&0!=U.length){He.next=10;break}throw YA(z),{code:z._errorCode,message:z._errorString};case 10:K=z._ImgManager.GetFileInfoList(),ue=0;case 12:if(!(ue<K.length)){He.next=20;break}if(K[ue].name!=O){He.next=17;break}return oe=K[ue],He.abrupt("break",20);case 17:ue++,He.next=12;break;case 20:ye=0;case 21:if(!(ye<K.length)){He.next=29;break}if(K[ye].name!=U){He.next=26;break}return ae=K[ye],He.abrupt("break",29);case 26:ye++,He.next=21;break;case 29:if(!H.isUndefined(oe)){He.next=32;break}throw zA(z),{code:z._errorCode,message:z._errorString};case 32:if(!H.isUndefined(ae)){He.next=35;break}throw YA(z),{code:z._errorCode,message:z._errorString};case 35:if(Ie=[],!H.isUndefined(G)){He.next=40;break}oe.imageIds.length>0&&H.isArray(oe.imageIds)&&H.each(oe.imageIds,function(Re){var Oe=z._uidFromServer2ServerId(Re);-1!=Oe&&Ie.push(Oe)}),He.next=60;break;case 40:if(!H.isArray(G)){He.next=53;break}if(z._checkIndices(G,oe.imageIds.length)){He.next=43;break}throw{code:z._errorCode,message:z._errorString};case 43:if(H.each(G,function(Re){var Oe=z._uidFromServer2ServerId(oe.imageIds[Re]);-1!=Oe&&Ie.push(Oe)}),H.isUndefined(X)){He.next=51;break}if(!H.isNumber(X)){He.next=49;break}X<0?Ue=0:ae.imageIds.length>X&&(Ue=X),He.next=51;break;case 49:throw Bi(z),{code:z._errorCode,message:z._errorString};case 51:He.next=60;break;case 53:if(!H.isNumber(G)){He.next=58;break}oe.imageIds.length>0&&H.isArray(oe.imageIds)&&H.each(oe.imageIds,function(Re){var Oe=z._uidFromServer2ServerId(Re);-1!=Oe&&Ie.push(Oe)}),G<0?Ue=0:ae.imageIds.length>G&&(Ue=G),He.next=60;break;case 58:throw Bi(z),{code:z._errorCode,message:z._errorString};case 60:return He.abrupt("return",new pt.Promise(function(Re,Oe){var Ge="copyToDocument",Se=ae.imageIds.length;if(0==Ie.length)Re();else{z.IfShowProgressBar?Hp(!1):me.hideProgress();var de=z.IfShowCancelDialogWhenImageTransfer;me.cancelFrom=Zn.LoadImage,z.IfShowCancelDialogWhenImageTransfer=!1,me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1),me.cancelFrom=Zn.Other,z._innerConvertToBlobWithUI(Ge,be.DWT.EnumDWT_ImageType.IT_PDF,Ie,!1,function(ge,_e){var ve;ge.currentFileName=U,ge.currentTagName="",ge.bNeedClearCurrentTagName=!0,z.IfShowProgressBar?(Hp(!1),me.showProgress(z,Ge,!1),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1)):me.hideProgress(),me.cancelFrom=Zn.LoadImage,z.Addon&&z.Addon.PDF&&(ve=z.Addon.PDF.GetReaderOptions(),z.Addon.PDF.SetReaderOptions({convertMode:be.DWT.EnumDWT_ConvertMode.CM_IMAGEONLY})),z._innerLoadImageFromBinary(ge,0,!0,!0,function(){if(z.Addon&&z.Addon.PDF&&ve&&z.Addon.PDF.SetReaderOptions(ve),z.IfShowCancelDialogWhenImageTransfer=de,z.IfShowProgressBar&&me.closeProgress(null,Ge),H.isUndefined(Ue))Re();else{for(var Te=[],We=0;We<Ie.length;We++)Te.push(Se+We);0==Te.length||z._ImgManager.MoveImageToFile(U,Te,U,Ue)?Re():Oe({code:z._errorCode,message:z._errorString})}},function(){z.Addon&&z.Addon.PDF&&ve&&z.Addon.PDF.SetReaderOptions(ve),z.IfShowCancelDialogWhenImageTransfer=de,z.IfShowProgressBar&&me.closeProgress(null,Ge),Oe({code:z._errorCode,message:z._errorString})})},function(){z.IfShowCancelDialogWhenImageTransfer=de,Oe({code:z._errorCode,message:z._errorString})})}}));case 61:case"end":return He.stop()}},P,this)})),function(P,O,U,G){return T.apply(this,arguments)})},{key:"Invert",value:function(P,O,U){var G=this,X=!1;if(H.isFunction(O)&&(X=!0),!X){var z=parseInt(P);return!!na(G,z,U)&&a3(G,"Invert",z,O,U,!1,!0)}G.InvertAsync(P).then(O,function(K){G._wrappeAsyncFailed(G,K,U)})}},{key:"InvertAsync",value:function(P){return this._invert(P)}},{key:"RenameTag",value:function(P,O){var U=this;return U._resetErr(),!!U._isValid()&&(H.isUndefined(P)?(wl(U),!1):0==P.length?(St(U,-2517,"Old tag name is required."),!1):H.isUndefined(O)||0==O.length?(St(U,-2518,"New tag name is required."),!1):U._ImgManager.renameTag(P,O))}},{key:"RemoveTag",value:function(P,O){var U=this;return U._resetErr(),!!U._isValid()&&(H.isUndefined(P)||0==P.length?(wl(U),!1):H.isUndefined(O)||H.isArray(O)?U._ImgManager.removeTag(P,O):(tC(U),!1))}},{key:"GetTagList",value:function(){var P=this;return P._resetErr(),!!P._isValid()&&P._ImgManager.getTagList()}},{key:"GetTagListByIndex",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return[];var U=parseInt(P);return isNaN(U)?(Jn(O),[]):U<0||U>=O._ImgManager.count()||-1==O._ImgManager.convertClientIndexToServerId(U)?(Mt(O),[]):O._ImgManager.getTagListByIndex(U)}},{key:"GetImageBitDepthAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageBitDepth",Et(G))}},{key:"GetImageWidthAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageWidth",Et(G))}},{key:"GetImageHeightAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageHeight",Et(G))}},{key:"GetImageSizeAsync",value:function(P,O,U){var G=this;if(G._resetErr(),!G._isValid())return pt.Promise.reject({code:G._errorCode,message:G._errorString});var X=parseInt(P);if(isNaN(X))return Jn(G),pt.Promise.reject({code:G._errorCode,message:G._errorString});if(X<0||X>=G._ImgManager.count())return Mt(G),pt.Promise.reject({code:G._errorCode,message:G._errorString});var z=G._ImgManager.convertClientIndexToServerId(X);return-1==z?(Mt(G),pt.Promise.reject({code:G._errorCode,message:G._errorString})):G._innerFunV2("GetImageSize",Et(z,O,U))}},{key:"GetImageSizeWithSpecifiedTypeAsync",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return pt.Promise.reject({code:U._errorCode,message:U._errorString});var G=parseInt(P);if(isNaN(G))return Jn(U),pt.Promise.reject({code:U._errorCode,message:U._errorString});if(G<0||G>=U._ImgManager.count())return Mt(U),pt.Promise.reject({code:U._errorCode,message:U._errorString});var X=U._ImgManager.convertClientIndexToServerId(G);return-1==X?(Mt(U),pt.Promise.reject({code:U._errorCode,message:U._errorString})):U._innerFunV2("GetImageSizeWithSpecifiedType",Et(X,O))}},{key:"GetImageXResolutionAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageXResolution",Et(G))}},{key:"GetImageYResolutionAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageYResolution",Et(G))}},{key:"ChangeBrightnessAsync",value:function(P,O){var U=this,G=parseInt(P);if(!U._isValid())return pt.Promise.reject({code:U._errorCode,message:U._errorString});if(O<-1e3||O>1e3)return ga(U),pt.Promise.reject({code:U._errorCode,message:U._errorString});var X=U._ImgManager.convertClientIndexToServerId(G);return-1==X?(Mt(U),pt.Promise.reject({code:U._errorCode,message:U._errorString})):U._innerFunV2("ChangeBrightness",Et(X,O))}},{key:"ChangeContrastAsnyc",value:function(P,O){var U=this,G=parseInt(P);if(!U._isValid())return pt.Promise.reject({code:U._errorCode,message:U._errorString});if(O<-1e3||O>1e3)return ga(U),pt.Promise.reject({code:U._errorCode,message:U._errorString});var X=U._ImgManager.convertClientIndexToServerId(G);return-1==X?(Mt(U),pt.Promise.reject({code:U._errorCode,message:U._errorString})):U._innerFunV2("ChangeContrast",Et(X,O))}},{key:"GetImageAsync",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return pt.Promise.reject({code:z._errorCode,message:z._errorString});var K=parseInt(P);if(isNaN(K))return Jn(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});if(K<0||K>=z._ImgManager.count())return Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString});var oe,ae=z._ImgManager.convertClientIndexToServerId(K);return-1==ae?(Mt(z),pt.Promise.reject({code:z._errorCode,message:z._errorString})):(H.isNumber(O)?oe=Et(ae,O):H.isNumber(U)&&H.isNumber(G)?oe=Et(ae,U,G):H.isNumber(X)&&(oe=Et(ae,-1,-1,X)),z._sendDataByHttpAsync("GetImageByIndex",oe,"blob"))}},{key:"GetImageInfoAsync",value:function(P){var O=this;if(O._resetErr(),!O._isValid())return pt.Promise.reject({code:O._errorCode,message:O._errorString});var U=parseInt(P);if(isNaN(U))return Jn(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});if(U<0||U>=O._ImgManager.count())return Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString});var G=O._ImgManager.convertClientIndexToServerId(U);return-1==G?(Mt(O),pt.Promise.reject({code:O._errorCode,message:O._errorString})):O._innerFunV2("GetImageInfo",Et(G)).then(function(X){var z=0,K=0,oe=X;if(H.isArray(X)&&1==X.length&&(oe=X[0]),H.isString(oe)){var ae=oe.split(",");z=parseInt(ae[0]),K=parseInt(ae[1])}return{width:z,height:K}})}},{key:"IfShowUI",get:function(){return this._resetErr(),this._isValid()?this._innerFun("IfShowUI"):yt},set:function(P){this._setIfShowUI(P)}},{key:"IfShowFileDialog",get:function(){return this._getIfShowFileDialog()},set:function(P){this._setIfShowFileDialog(P)}},{key:"checkErrorString",value:function(){var P=this._errorCode;if(-2115===P)return!0;if(-2003===P&&!be.DWT.IfHttpPostErrorNoWindow){var O=window.open("","ErrorMessage","height=500,width=750,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no");null==O||O.document.writeln(this.__HTTPPostResponseString)}return 0===P}},{key:"OverlayRectangle",value:function(P,O,U,G,X,z,K){var oe,ae=this;return ae._resetErr(),!!ae._isValid()&&(ae._isNoViewer()?ae._nouiNotSupport("OverlayRectangle"):O>G||U>X||O==G&&U==X?(St(ae,-2375,"The left or top or right or bottom you entered is invalid."),!1):(oe=H.isNumber(z)?ad.getColor(z):z,ae._UIView.OverlayRectangle(P,O,U,G,X,oe,K)))}},{key:"SetViewMode",value:function(P,O){var U=this;if(U._resetErr(),!U._isValid())return!1;if(U._isNoViewer())return U._nouiNotSupport("SetViewMode");if(H.isString(P)||H.isString(O)||P<-1&&O<-1)return ga(U),yt;var G=Math.floor(P),X=Math.floor(O);return U._UIView.SetViewMode(G,X),!0}},{key:"ShowImageEditor",value:function(P,O,U,G){var X=this;return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("ShowImageEditor"):Ql.isServerInvalid(X)?yt:X._UIView.GetWebViewer().webViewer.imageEditor?X.ShowImageEditorEx(-1,-1,-1,-1,3):P&&O&&U?X.ShowImageEditorEx(-1,-1,O,U,0,!0,P,G):X.ShowImageEditorEx(-1,-1,-1,-1,0,!1))}},{key:"ShowImageEditorEx",value:function(P,O,U,G,X,z,K,oe){var ae=this;return ae._resetErr(),!!ae._isValid()&&(ae._isNoViewer()?ae._nouiNotSupport("ShowImageEditorEx"):ae._UIView.ShowImageEditorEx(P,O,U,G,X,z,K,oe))}},{key:"SetSelectedImageArea",value:function(P,O,U,G,X){var z=this;if(z._resetErr(),!z._isValid())return!1;if(z._isNoViewer())return z._nouiNotSupport("SetSelectedImageArea");var K=parseInt(P);return isNaN(K)||K<0||K>=z._ImgManager.count()?(Mt(z),!1):!Ql.isServerInvalid(z)&&z._UIView.SetSelectedImageArea(O,U,G,X)}},{key:"first",value:function(){var P=this,O=P._ImgManager.count();return P._resetErr(),!!P._isValid()&&(P._isNoViewer()?P._nouiNotSupport("first"):(O>0&&(P._UIView.Go(0),vh.__innerRefreshFromUIView(P,P._ImgManager.getCurrentImageIndex())),Nt))}},{key:"previous",value:function(){var P=this,O=P._ImgManager.count();return P._resetErr(),!!P._isValid()&&(P._isNoViewer()?P._nouiNotSupport("previous"):(O>0&&(P._UIView.__Previous(),vh.__innerRefreshFromUIView(P,P._ImgManager.getCurrentImageIndex())),Nt))}},{key:"next",value:function(){var P=this,O=P._ImgManager.count();return P._resetErr(),!!P._isValid()&&(P._isNoViewer()?P._nouiNotSupport("next"):(O>0&&(P._UIView.__Next(),vh.__innerRefreshFromUIView(P,P._ImgManager.getCurrentImageIndex())),Nt))}},{key:"last",value:function(){var P=this,O=P._ImgManager.count();return P._resetErr(),!!P._isValid()&&(P._isNoViewer()?P._nouiNotSupport("last"):(O>0&&(P._UIView.Go(O-1),vh.__innerRefreshFromUIView(P,P._ImgManager.getCurrentImageIndex())),Nt))}},{key:"_isBindViewer",value:function(){return!(!this._viewer||!this._viewer.webViewer)&&this._viewer.webViewer.bindViewUI}},{key:"_isNoViewer",value:function(){return!this._isBindViewer()}},{key:"_innerUnbindViewer",value:function(P){var O=this;O.__funResize&&(H.removeEventListener(window,"resize",O.__funResize),O.__funResize=yt),O._viewer&&(P?O._viewer.webViewer.dispose():O._viewer.unbind()),O._config.container=null}},{key:"_unload_viewer",value:function(){var P=this;if(P._isBindViewer())P._innerUnbindViewer(!0);else{var O,U=null===(O=P._containerElement)||void 0===O?void 0:O.id;U&&delete be.DWT.ContainerMap[U]}P._ImgManager&&(P._ImgManager.dispose(),P._ImgManager=null),P._UIView&&(P._UIView.dispose(),P._UIView=null),P._viewer=null}},{key:"_innerRefreshUI",value:function(P,O,U,G,X){var z=this;return 4==X&&z._isBindViewer()&&(0==z._ImgManager.bImageJustChangedInEditor?z._ImgManager.bImageChangedInViewer=!0:(z._ImgManager.bImageJustChangedInEditor=!1,z._ImgManager.bImageChangedInViewer=!1)),U&&z._ImgManager.refresh(P,z._ImgManager.count(),!0,G),H.isFunction(z.__OnRefreshUI)&&z.__OnRefreshUI(z._ImgManager.getCurrentImageIndex(),z._ImgManager.count()),!0}},{key:"updateImage",value:(S=_t(B.mark(function P(O,U){var G,X,z,K;return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(X=this,!H.isUndefined(O)&&0!=O.length){oe.next=6;break}throw St(X,-2853,"The imageId cannot be empty."),{code:X._errorCode,message:X._errorString};case 6:if(H.isString(O)){oe.next=9;break}throw Ule(X),{code:X._errorCode,message:X._errorString};case 9:if(-1!=(z=X._uidFromServer2ServerId(O))){oe.next=13;break}throw Zle(X),{code:X._errorCode,message:X._errorString};case 13:if(!H.isUndefined(U)){oe.next=18;break}throw vje(X),{code:X._errorCode,message:X._errorString};case 18:if(U instanceof Blob){oe.next=21;break}throw yje(X),{code:X._errorCode,message:X._errorString};case 21:return oe.next=23,Dfe(U);case 23:return K=oe.sent,oe.next=26,X._updateImage(z,K);case 26:null===(G=X._UIView.GetWebViewer())||void 0===G||null===(G=G.webViewer)||void 0===G||G.resetImageEditorButton();case 27:case"end":return oe.stop()}},P,this)})),function(P,O){return S.apply(this,arguments)})}],[{key:"ProcessGetBlobByQueue",value:function(){if(x._getblob_queue.length>0&&!x._processing_getblob_queue){x._processing_getblob_queue=!0;var P=x._getblob_queue.shift(),O=P[0],G=P[2];O._convertToBlobForUpload(be.DWT.EnumDWT_ImageType.IT_PNG,[P[1]],!1,4,function(X,z,K){var oe=K[1][0],ae=O._ImgManager.getImageIdMap(oe);if(ae){var ue={imageId:oe,serverId:oe,uidFromServer:ae.uidFromServer,uuid:ae.uuid,imageUrl:URL.createObjectURL(X),minImageUrl:URL.createObjectURL(X)};X=null,O._ImgManager.UpdateImage(ue,G)}x._processing_getblob_queue=!1,setTimeout(x.ProcessGetBlobByQueue,0)},function(X){x._processing_getblob_queue=!1,setTimeout(x.ProcessGetBlobByQueue,0)})}}},{key:"_getContainer",value:function(P){return P._containerElement}},{key:"_setContainer",value:function(P,O){return P._containerElement=O}},{key:"_closeImageEditorUI",value:function(P){if(H.isFunction(P.__CloseImageEditorUI))try{P.__CloseImageEditorUI()}catch(O){Nr(O)}}}]);var S,T,D,R}(Iqe);function a3(C,x,S,T,D,R,P){var O,U=C._ImgManager.convertClientIndexToServerId(S);if(-1==U)return Mt(C),H.isFunction(D)&&D(C._errorCode,C._errorString),!1;if(O=C._innerFun(x,Et(U)),R)return O;var G=1==O;return G?(P&&(zn.refreshImageAfterInvokeFun(C,S),C.getView().ClearSelectedAreas()),H.isFunction(T)&&T()):H.isFunction(D)&&D(C._errorCode,C._errorString),G}function Dfe(C){return H.isFunction(C.arrayBuffer)?C.arrayBuffer():new me.Promise(function(x,S){if(be.navInfoSync.bIE||be.navInfoSync.bSafari){var T=new FileReader;T.onload=function(){x(T.result)},T.onerror=function(R){S(R)},T.readAsArrayBuffer(C)}else{var D;St(D={},-2856,"Cannot convert blob to array buffer."),S({code:D._errorCode,message:D._errorString})}})}An(Rf,"_processing_getblob_queue",!1),An(Rf,"_getblob_queue",[]),function(C){C.normal=0,C.balance=1}(WP||(WP={}));var Afe="data:image/gif;base64,R0lGODlhZABkAKUAAPyOFPzKjPyuVPzmxPy+dPyeNPzarPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/PzWrPy6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAxACwAAAAAZABkAAAG/sCYcEgsGo/IpHLJbDqf0Kh0Sq1ar9hslXI4aEwHFUVLLicpjUBrBACMFKTG2Ewne1Khtl4fSnnqgFYUFSJ7hgAiFXOBjE8mDIeHIyaNlUweGZGRGX+WnkYTL5qHIhOfp0MubKN7Iy6oUhQwDSYmDTBPHiyshyydsEwUJgslCiIFCgkPcpcJvIYJv8BJBy4okW8r0kceIM97LIvTRw0Cq5ojBNtGqt9uC08qGisnBA9g4loHAt8jESpKJhT6VqqJMALn3AiYsE7QAneIFCVRkelbiYZFKDhooanAinxWHFyDKABXEhMJ0VFiAkMBqwITQE6hEAGinhRKBg3UlEim/pENzwQcyAKDn00AJ3wKucMxUogKGIsc2DlqhIMsGjgcBRBC6dI0Cla9IaHBKxEHKTWRyGKCqjsUZpeqOFArTFwiK9JGIsDW7TcOd7FU0HuIL5asWwVELfPo2wOiELYuCHzFQ4FnIzRkoYCBsCYGVz3lZZVuMRQNLiGyGOrpQORRClZuHv2tgAPKWNBA0KvgdhkPJzzrYfDBNB0uKwowYDCCQYETMHA78RDB7x6P42J4MFFhhQPWgA4YKJGWAQgHxrObkdXhhAAOHDK4wKd+GgUKHu5Lr8+/v///AAYo4IAEAgODBhNoYFKBdVCgAQkKMDdCcwq40EB6DDoBAwbW/rUhwgMLZlhFA7vxMkICmolIxQEhCLeHUCpK4YEzNvkiIhomOGACDKYNdhQDFWR4wAMCiMKAAA+AZ8QBFR2VgZIBwsACJHswwEKIRAi0FSKmDEjBLtiEYwQFJGzZBgb7eWICabIN4QEBZiKFISxAsRLBkmBumQCU/pXASwZL0rjlagMaNQqgRbwZpzoDnsDLnRmVaSYJaVoygGeTHKHlVgV5mWcvMjG5JQR8/icllcOBgCURKaDqDgM4MXgAAgJAciQCpbopqDs2ZugBDDnaYhwMF7jYxggwxihFAxm4OAIEKSq77AMdIoJBA9JW4UEDLkQ4IYUWzpmtEgcmuOq4/uimq+66/qHhwAQfVDABGOxGodECFyjnBgMoZBAAM/UuAcMJl6HDAQniZiuMVt9AAHDAQ1AwAcPuCIAtxENo0JRNECTs664QjUApxg7EycHFp/x64XpNbjVCAJVS4cAGJQhggR9kaFCtRecCsqmHk2mxgqtbFdAmIw5Y94EWNcUJAKyWeFDnISF4fIQFTrcRZCUw+BmJCNFagXXWWzdSFE9HUzG1mQwYYIkKYx+iQK5RPGAsKyKEVkkK1r2SRdJOh4ByIx48ZEgJdEfhwcYuJ/UJBSu0UIAIEriQuBQVxFnAALBsR68ZBzBuEwExC0hBBzt31LMRKqRAAAEpAESgYgfU2sSB3kscsOueBXqQnDshxOTECocsXeDpokeCImWv7QFBhlxUEIIIEx7LgAgQoBeF13sgeqMJD7gAAgEurPAwFHYb8hjGT4iqB6nsPyELkSWAWHr8+Oev//789+8/u0EAACH5BAkJADEALAAAAABkAGQAAAb+wJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+0uPY1JJ+XQeLxob2OhYAAAjNaika5fKYPL6M0HjC4DFHaDUSYofYgAKCaEjUweAomJAmeOlkYOe5J9Iw6Xn0MEm4kEoJ8UCqOICoKmUB4aJiYNrU4UHKp9HLWuSwcBAhwoBQolFZVMFC25fC28vUceFQWSIyEOz0gWzG8W0EoeLm6jIilNmdyeUBQNsg3IXhXjqhyMX5G5lK8uF8IKJ3S8HKDGjQU8JA5wjeKgzkmDEprejECBrYsLbm/KJXOgJ9Gfik5g4EtUwJ4WSBjfLDiIpEGENm8YKIgQ0NaKiKRYVtGgEGP+Ahi2NExIkWKChmy+QKgKUROLA4IYBTQddCCEqpJbBhxKKQCoowMXVC3aokFCSgAsDljycELVhalWUKZ0gTQNBQPzEI2IUJdKBZxiB3xSsQHwm65dPFhlNmKDzkEwXIjowwAC3CxPmbXwCspDCgICLrBYoRYNhRRQPba4bImChwMHPPTVYoLFZEQcInD+tjbFAgglSrAgYeIxb0KvYcA4MPu48+fQo0ufTr269evYs1t3DaOBdxiytXOB8VnBixEiJJwwsFt8lQEl8vJhUEKweyoUKvTcxMFA8/tG5HdbLiJU8B+AQzSwXy4csDYdBTBoAMOBF521gHYutcBBCBv+OCgEDANiVEB70lHgQAs4tRBIEvKcBUcF1x1QgiQllHbEAi6+EcF16HjUkBHb5OiNdRiMgkESSgl5HQmjkJAEji7uxaNhfvxYRItnMQCjdQeM1IcANhoBoosjXodHKn2oOBuUKV2YXQMnhCBBCAAxoWBKDYoHoYQHCshNgQciKER+CybCgYGCRuFAfJLQZ2WiIVVAgAQijPCCBARUQCKktnjQ3XfhcSrqqKSWauqpqBbhqSwTppqMCScoUIAIBRTQAgm0uGqEBw5AQCUcAAWaKAUPpLaJAiClSsEKL2AkwaOknmZsLkyl2oCXGFkgrHb5/aoKAx7aQcG2T3gwY47+ALgAigoYXCBHuFIc4G0urDThGmyhTqHCYm+gYJ8WDqD7RgHhHjABBhFYAEIEGEwQ5hMBJFICuUoYIDAAIpi06wolTFtACSsYF80yej1sRQUXZ3wEOyHIhwgDTAXqAZqImFzFBBcTvOsEhW6CwgSBioIbxUnAcLEEB5loFp7JKqHBVhkhelLP3IAgJrbcXGDzEb3uEUIKIktBAQnzbjLCv0NEIPCOnXqQ7xYN0JwSBM+Mia4Im4JCrMtXPfpA2aOM8IBzB5wAeEYrPENBAhcDkADRaHhAAN+IFBCymCQLvNlzKjygwK8jCJACUnderAC8l7CDweecQKBpXWU1zoFdBiWCYUIFKZgQ22xxN346qR6EdbEAKpQqtMCllDrB4dVMYCoF/LoYAuTVpUD5t+acKnmOJ4QtKAwgMD8CC3mPWvj180WwdakeIICi2S0g4P2o7KwgAE6hr5ArKEEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPyeNPzarPy+dPz27PzSnPymRPy2ZPzGhPyWJPzu3PzixPzOnPyiRPzevPzChPz+/PzWrPyqVPy6dPzOlPyyXPzq1PyiPPzetPzCfPz69PzWpPyqTPy6bPyaLPySHPzKlPyuXPzmzPyePPzatPy+fPz29PzSpPymTPy2bPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweAydRCyVjyUyIbujkwYGQK9jGu23Xtkg1f8AJA17hEYdLSKAdSItHYWPMA0Jin8Jg5CEA4mUdCIlmIQRnH8OoGUvJSUHeVAlm5yepkwTLyMaIrgMCQWrT5KjAJaySh0OK5QiGBmsS4evgCIBjsNHZhrAApdNfZyCVRPTYS/HwAAszEq0JM8iguhNcQYrGiwO71oj5XQMEWURIAIqrLk36wSDPyIWhNsy4Zo+ACgIisngEGG/Lg0OPqxwoFCAZ3a8OAA5StieDhY4aViYxdXDYNreTDDACQJLLC806hPQkdD+A5IAQHiZ8OGhCAkSxZFDmOELBaCAQjR91KCCRhEJ2Hw5oKAcI1AHEKBA8QAPmAkZKowSAaInqAlJtcRhobNOiBYvqOkxY0FAghUCUMTUK/NAhgYp4hJezLix48eQI0ueTLmy5cuYM397kaFEhheKNS+Z4ICDAA0mNAjgYE/0lA4oQigSEQLFTdd8BJTLhrvJCxZQF7HI2zvJBA/B/zBQEVov3OYHILwM5jZyBw8QQkDwcLuIg+l0SklOseBVwhRL8oEfMdmB7D8ELiahCd6A5AkXKD1IigI8APuRTfCAfkkF4B97kkXwnl3yIfEdeOJFdoAE5klQ3REHTPJSAhf+PnZddtt1R8QEKtQ1ynLNUQNOir8lB4AIwxW3RAO6YTOYjEd0YMCCf9QmIo5EFCOBABBoAIEAEjjwI5BF0JJKCaAxKeWUVFZp5ZVYPgHOCy8kluURL5yAAgYkCICBAWWN8VwHHcAFSgoPJGDiiyZIEGUXHTSgAgYmMMCABiBEcKceHZSgITAhULBkFAdcIN1sHyi61wmP6sPAA4s68ducPbaQ4hUlVPRQCB58ikQHfujDSKZXZOgfAARESEUHC0yXqKlwGPgqABiwikQJJoAnAHFgvFCpf7HMKgGyJ4hBAacvcVBFA0X5ZwGuTsy0ax0QYAtDCTy+tBIYB8yxLaz+Nzox0qsMZFqMCi20oIKSS7yg1rkhfDLFusj+SIstDOCSiwYjDFoEjecCkC8VA7jwKgESdUCBqIpowB2GqW4bQrrbHDqdAgR18AC0yu1nSErnjjvFASC8ylw1Jb7kQqlGjOAiMBhYcUK45ZjUpAPBTmdCa0RkQMC5DUrRQcsvMXDBPSnQVx9L2u66gq9INHAsMCx0KEQGPOvjwo0NhF0OAxR4S4ShXmFArBEIbIuAESTejBAKXk/RAAhhi0CABOglwcK2LOT4gNmzWZA3FSkUYEECIYjAQAgfJLlkta9WcKoKR59t4Rd5luCAAyWYxcRS/q1g3AAKBFfBCVi7kbFpfyQ0U0ILkIcQAgH0OODlYhxsK20THXAGZeyhbJt0cS9Q/JAGb8sooN2LmCzlC+a+pED0QJaw9SgQTEVlHB8kJ8IKplv5ggS3zKaBnV/CUOgICiRAAAEJKDBCCcj3NsEBDThMA3qBiSAAACH5BAkJAC8ALAAAAABkAGQAhfyOFPzKjPyuVPzmxPyeNPy+dPzarPz27PzSnPymRPy2ZPzGhPyWJPzu3PzOnPyiRPzChPzixPz+/PzWrPyqVPy6dPzOlPyyXPzq1PyiPPzCfPzevPz69PzWpPyqTPy6bPyaLPySHPzKlPyuXPzmzPyePPy+fPzatPz29PzSpPymTPy2bPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+wJdwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum4sS1yYg2rgk53gzIgDYQ5SIfI9sJOyAAAkNfIVCEgWBgSZwhnsNKoqAKoSOchh/koIYlnKQmoKVnU4SHByNUoghmoyjTRwRDiwBKSSoUA0PkoOuTC4VBKsAIRkWKFN0gHh6vUouI5ohEAepaiIBbreppdpeHB+gww7dcQ0LCSUFtmERBOEAKtSFB3WADwNgEg7vw5yFKZJWkMPCYQE/ABsMXZAEYuAVDiwOJiwETlEJh1YkpBAGKoSoPScktfpCIsM7AfL4cFgRiMLHLhJEMAAFYgNGMhIiFKgwISX+GBQaOAICkYJDszIHHCQQFmLEBqNHy0g4QGJDhAYHbkbdyrWr169gw4odS7as2bNow3BwgcEF1LRVOJwoQCHBgwQUCpx4C7fJ1BPBopXoqRWuBAwrhEZbgaEw1QEkfH5t4EFxRw8v0TQokAGE5wcFGhR2hKLeQUAjJA9BkcKdJAIpVPfiUMAyvxAF+AopaPvOAt29NoA4zXDiEAkTZr5r0WF0HBQmeh80wZfyacxRG5gkLimDKAknpAcKccK5mQjcoxmXYJD4AvNlEKTXlGLISu4rgFuKOF9RAPsVnfaBfo6I0J8iLBwHAXcQEGgIQAcCUt8h4Z1GHnxkoBfhMMz+CGHdQS5lt92B3hGBXAv8MIchGSgkEqEJkvEWTgi/cSXcgQQYRwRrrikC2zFc0dZfCBUQKMFmnXmWQWgrxnEABfN5IFsRLpAQAQkujPXhQSF44E9fSByW2G2MNSmWBChMUIJtIQyWFZhOyEVXAhngpZeDcCpxAFsuTJnnn4AGKuigUJRyAgsfrLDABG+MUYoLDTTgliMSkGCCcoooEAGQXhyQQgEjJKDCBRA8pVIKI2oCwjQwRTACpoAQ8EFmY3AgAoq3KYBnFBykMFw4GXSIkwOwvhMCdVqcUKwmJdBKUgnpMdAcFgek+s6AZHBgQn8jZHmFBdzVRMYBy3Kp4xT+B0TCHbJiTPCimS+Q0ONp3Y6x4IEe7LrEjdzxIkaA82WgrxIn/Eqcv0uU0kAEKaRw1SlMsHRgCQMn0U56FHjrzAkCCBWCACf4KcS2+FaMhAuZEFeByC808EG5ADAwqxIQ9odtFYhwx0AKGLmggnjwaGxEAxFOAG/LBvOTmp6m8YNSmAvNl8CXVlgANAAgCGuErVffIcJA/BIXgggmKwGdeAwggNGW1zl7NncXCH3FASIkrUwGey1RIXfkJeGCAl2X2EUDJqhQAggElOCBBXIfAVF/LDhIG8x2MHCBs1hMNcAGG5DA6RLf9FekEr2+KkkICYjQeCcoSJzeCiynsYFdBgJkUIIABUzQQNlnCDkfu0yUYoopR4uhT3/jDBqB3fxkTegBUROnAMtwXXxajoQe4sDVISSf/QsQUR5z5N/bd4IKyzKgQt7lE+GpAnXhpUBs7YcJKQYH8F6/IUEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPyeNPzarPz27Py2ZPymRPzSnPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/Py6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69Py6bPyqTPzWrPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29Py2bPymTPzSpPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum5EUynkd7Uwuo0mHTVemTCEAIGRK1f9FFyJ6eiIjUhQdBygBJgQLIA0daoBPFAWEhCeUTm4qDJmFJCAHnJVKBy6hAAwHTwcLeauEDCoNp0yXq5tOLxWDs6EfGbhLI8CFh00HHsHBw6bFRAd4enyuuQHOzirYXB0ZICgN0VEHb3FzTS+y26sMIOVWvgUMLgUt8lBpUC3uzgLUZWmAKRQGb2QObPjn7FaWDghmGdLnxUE7hqFYaMlwMROJF2ZAgMK4SoMWFKpmJSBW5gEykoRUaOEwctVKMw9qwtTjQQv+wWAQEIoRuTPTAi0UTMxiwIJilxIdYYLY0gGCThcBnHbp8KGoHgYgtxx4IGBDAggG6LDwCkCFQKQvSmQoRUdh0RATtErbR5SkiAhv92LpkBOjiApCBWMZqzPY4bCKvxk4sS1EgMSRs1AYKyCECwagQyRoQS6zGAoZULB4AKKEH9OwY8ueTbu27duyOzRAYQJDAgwmxgXGHYVCgxYFQ+ErTbz4BAHuBOS1xM82BQ7JtxWYroTCCwcXTDxw8EJvsRIpGYYo0X0CBmQMMHCH3YHETgzDh6DITqgAB9koNPYPAyggwY4zIUAWGUReITAcBRq4o4F5dWQggVc3FXHACu7+rIBZMRNEpd4ERmSw0DYbsBSZAenB5EJaRZjozgkqKhagVwzAOE0C7iTwIS4heoWXERC6YwKFdGTAY1EZFnFgMAnSB0GD+cGw3ywFFBjbjTDBkwQF7tUU33ymHWAfTCRUKYR3DoygwQjkIVlJCQIiyF4TaciJC5j8BbOdnriBacFLoYhgAZnN4dnAAn0CsBygicKgGwe9/RbcC2pGqummnHbq6aeghlpcnqJa8p0CLWjwwASSkKFbBhmUd8oLCghA6AYBZAApniAgkIAEG6ygwp11NGCVYxY4sOuXDRBA6B6XLUtFA0tWxoG0RVDgQLWzfLTGC2f+E4JDWbxgwT/+BGBrSWEYEZApFC7944IDZrwAHUknDPBQo7OooG4TEzzrTj5YZCCwSgqCQcEDRXnwmhUoHLzKBsSGQUEERXl7RcQYUYyInEllnPAUJUgcSgLkMnFACRMowAIHJfxIBAUjFNXNYiLOAsG7QnTggAonIHOCB3IwEfBOC/DcRAUMiaAREx2MwO8JF7wrI0khaInFT9Hp1UEEJgMAWHcthJ3JzkiBwK8eTSrBsTsi/KdEBueO+A0HXa0iggoD6HVA3v98IDOYOWcyURfe4SHC4gwUwAJdTIDQ4jYvLsFnZSMoTYXPE0xQApJFkjSh5RlU0GcIGCibWQcqwORWEz4HUAFdBhioAMnDkaUQEUkOWpLCCy8coDkgFDBNUgX/mnaMYQGUOgRUGK3n/JqtM+TB8IkesDYhG4wsKpjc2oSo8xSUAMGzIkBQAvabJsIB0CGEcIIKciTf3AHeT69/qUEAACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPzarPyeNPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPzevPyiRPz+/PzWrPy6dPzOlPyyXPzq1PzCfPzetPyiPPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPzatPyePPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj0gk5dDYPBaRx6ZxoCSv2Kx2yx2mThYDYExGfU6prnrN5r5WIbKcHFq92vg8m1ICzf9kLCVWeoWGRnwTgIsACoOHkIYHAoyMAgeRmXgPlZUPmqBdL3GdiyF3oalXDyKliyKfqrJFFBiujBiEs7MvLLeLLKhYFMS6u2olHL+AHCVXFC8lJw8PFQ4NxsdZJSjLfyjOSC8qGKRjDCAB2Npayd5zzUgZAgyvCifZ7EYvCu9yCsKGUHAgphODB/n0CbTlbwyEbIluicCnEAmnhrCMHFjR6haLBqAodMjQoEPCfea8nTIiod4vEQE6ZDrQwqUBFSeLXPSWkVb+gncfI1Fo0fGcBC0HSLy7ZKSDi3cMHERK4VIOiZwCSyj6pcBBvgYNcUIqwQxkFj5+SolwlJCsvxFY1WRgFhDLm5R/6tQl4vbdhbhdOhSUswIwkQMbLCiDZ+EEpiQvGlYwvIWCh6IAGJjtsiSDhCcLpGSogkXwuxBShUrAwGHChwwKKUR4h2HvoRePKw7AaxBhxVkdZv8SYPu3phckMDMyANv4rgYClP/hcNT5sQYmeJ9b8cj6sQ4lIgwGECKBBNLe2RE7kCHDC5Pp48ufT7++/fv48+vfn17kAfj8aQKNBAGY8IEJI2zwAmUBnlWBAE/J4QIJHsjUYB4paFDVHwz+RJDbhWq88FMpdmxxgAMbOFCcfR0Q5YoILViYBAUFgGBACAYIQNF+DWhnymZHdPBAhGQcJCN+wv2iwRUlaBdCOPh10M0yKBxZRAuMtKBfBj4yEkJzRyi1CAn6ObChK1ElwRAgGJR5ZilpIoHlIlrmx6VKYBrRJCBP6ielN1UmISSRY7jwgJX2aeDNks8UIMCNKAhQAIPO9fhLCEBC5oAEKjbYonSAwIgoiFgckACocohQIqlqZPhmkRp8yCoXFKgA4RwuCCDWrHu8sMEIBByY4IK86uEfgMUmq+yyzDbr7LPQRqveqNIicYAEF0SgwQgnZFotER2sFkJRISiAQBr+qXQQzQMqjEZpJiks8CoAqq6jyQEBTDnGPejq08ECpdR2nAWAMDCCrLtsMO8cdULy6SIM7HjMAWt2shIkBFWiAMKqnNDlHw0XQsEIpUA5y8ioAvLQIR0QUEoF2gS3DAj96tEBwZ2oELOiv4DAMRsdBFBKaruMvMxVkLRUiQErItGBA9kucIEE1B5RwcJ/RBDJARBUMkLVR5RQTkciGICByVc00M+LaBfSQFpziGBB00V04IGPIagA9hCsuFKYJhlAkJIBC9BNBAUeLy2xoCuUokCeW//6gQUPOLB33WtrfDkMDVT8R1fvqtFBCshyccItJ2gBTQvjxv1a6No07ndgFw2MgAEIIJCwQHf3UZB5JwqEnsLP9VGwWCkcwH4hJa6Q+S0Mc5YSsrQZpEyGCJBHS8EHpVigPIgvQICqCBAY3mwDFrzJgAXZP39ABQmQUkcFxH/r3wH4l/78/vz3T0QQACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPzarPyeNPz27PzSnPy2ZPymRPzGhPyWJPzu3PzixPzOnPyyZPzChPzevPz+/PzWrPy6dPyqVPzOlPyyXPzq1PzCfPzetPyiPPz69PzWpPy6bPyqTPyaLPySHPzKlPyuXPzmzPy+fPzatPyePPz29PzSpPy2bPymTPzGjPyWLPzy5P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp9QZad08lBOpUN0y+1CDyoMx8UQhVAYldbLbnMnDpAIQK/TRSDJxM3vIzsUDHaDdQwUHX6JfRMUIYSPACEUe4qVXSUKkJAKJZaeUB0EmpoEiJ+nShkuo5AMGahsGRQBEREXFGtLCKyaKrBREx0nJCFlcyIMKCslpkgQvJAQv09wAnOaIgQNlEYc0I8c003CBt8CA9xEjt+DBuMlFA8PHg4pihMn5ewsr0Yo7IPCKZlQYgUHYwwMWDiRjg0cfQBZ5BqCAaAdDEoORBD0SESCbW5SWLBYR0NDFSTp+EJyQBQrCw3cFEhJx0AnIhk4AnSFZML+iGusEjR7I4AmABER0nWoQJKAvSMlvEETcYJNiXU0BcTEKfUbpz8RAIKYGEWFzpQoBhRhhJWVpIZDGoAAaMCBlwVAUzLYYATQ2VaHkmRoy4vBSi4mjN6hcGSCBBZ57YhgoUdJicisRIzwklixiAJJwGBAYcwFBxJqmJT4m3lzlwCYAbqQsOQAFQoeTgx4yiQDRGiGvARSzOGmpRdF2RX30uA3SQxkE/mMDWnFUGAJjIp4ADdRAxbfGKhl44A6Lw5bP00owPpR0jYdVqTc3l1Rhwft62SLzqVBcnYirFBfJcIoEBsHI/DWBhzgfSMCBun9MkEDD5BgAAMJWRBBCQP+vpFBJrwECJI4QkzwQgYllJDBiJUcsAAK1DHAgQodkojKBBksIMAYyITAQQIPsGjjkEO8UIIEJ5wgQQkKEunkk1BGKeWUVFZp5ZVYZvlGCjVq6UcHDrTwAQQftODAdV76QRAGIQBlBgYcpplIBwWYZwiacr5xAmGEhFBAlyUaKWSe30HDQoQ9NbAChgysMKiWEwTAzgg1vlDRRS/kCcMBXZ3X5FoqRCYCjXm+YB4hImSaRAedDWICnleWYJFxR4TySCl5ZmBRPz2ZNYhhgEZpKoCqJvECCYOQUGyaKYAIjQL8EWFiBYxW8EKwUU7QwqSATujAtZrG1SArh4brxXr+fA7iJ6zmjjMcYOy228SabZkBQZzytpFCmBWQ2YIEn+br0AHxCmzwwQgnrPDCDDfs8MMQRywxlPhoAAEGBKQ28R8SyCGZASoU7EYHDaQI7pMdqJDuURFEy0cDC4DAAQcCjCDyJxKsTAcDNltygMf6vUrkBHOxYgCifMTXEaVDnnBqHRFUchUkAiw7jQlP06FAJe8SshyJE1xaGLZO+PqITTaGHR7ZTTiwMghIw8IUNAIlcsB/kkVwsyIUZA0AAZasRgjcRB7gXEd2VUKQAMUwEEICLg/UwAgGiqDACI8qEeooIgjtyb5WMPOGA+PWwYID2HawESQiQBC3lRkUTQhgP1+MwGfnr1fJ6iieO0FyBCxgyIEJZ+b6jyYo8LoxDOVxnvjyzPPy/PKCa8IArRsjN0rV0AtxX34McNe9EAd8gJkIH0QesbYw3oFCC2wzjOMDC0TwQAbxj6///vz3v38QACH5BAkJADAALAAAAABkAGQAhfyOFPzKjPyuVPzmxPy+dPyeNPzarPz27Py2ZPymRPzSpPzGhPyWJPzu3PzixPzOnPyyZPzChPyiRPzevPz+/Py6dPyqVPzOlPyyXPzq1PzCfPyiPPzetPz69Py6bPyqTPzWpPyaLPySHPzKlPyuXPzmzPy+fPyePPzatPz29Py2bPymTPzGjPyWLPzy5PzWrP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJhwSCwaj8ikcslsOp/QqHRKrUI7pcmk1LF6v9ZOxlNgmBmFSqYLbruRjQgDQK/TGZrGe/92YeyAdCIkLnyGYRWBigAVbIePThQXc4uADBcUkJpLDR+Vih96m6NGKJSfdgwopFMUHQcZEw4NBx2ZSx0LqIoLjqxMFA0KAiKpHigut0gHCLuBCAe/TR0vFsWKDBgOSgckzoAk0dJKFAstuxsoykXM33bQTi4vASwKa3wdLNe7IS/rQx0iuKvTawmFEipEFFMoIsEEX14ogDjnbkMJJKYGqsKloMAiBgsKgWmwYiAdBP+EdBoYasmLEJ9EsIDY6sE+dyIyHKEw4ub+JwYjUhJx4REVgwlfOpQ0SccEkg4evnmgSYSCiW8JhEI54NPdCqowXJDoameQyCQulu4ScdFKCaZ1Cpw10kDDKUsmRClxUHTtAy8c4NIpoDOJGBVlzhTwUEJrkZfuFniZIBgA4SYHsmwR5wQFTGcyvWSofGKuoRInvolQ4OXAXZaO2xzwBFovlQ7N4F4YZdOZii8UXrx2xsD2oxS0PxVo60UsUw2x3zhIXamFArBRKPAdKMA4JAoZMAwHcOIF9ikGPu/6wJxVBwUWToQIUWCFBtNggm/YJaDxOCEHDIACCrNEV8VBHpAFQAgRePcfKeAtsMIJBRRwwgcKNGDgg5r+UOBCA7RsyOGIJJZoIoQUiHjiHh5OcMECESwwwgTJrDiKCyYkEMI+IoSQgAn42ejGARf0pUiPF3AmZBsuRAVaBUEuOcUBEJgEj5RhaKBgJSJocJ6JWJiwwgYrmOAAWMGpN1AL/mB5kDeAiNBfSgf8IRgGStpYwn6LWGTEBFuuhdSSDViASndFEFAZHQQsmU+gAIiwwDrUVbYBoQk4s4JtkK6lIikTUGTUNkMsWkeeJaLgziqlmgoAqiSq+g2rQnSKighfjuPAeIGEQKoQfJJGqFqfJGBbIos2KuSjt7KwDqCViTCokA0IcKhxdVaGJ5YDBBvIBgMYkSZc/Xz6y0H+xMQ55xEB2VpWBLmS2IEDJnywwQdmntfOQCrAimUUDSQImgcO/ivFASMYGUiPI/hr8BQuaLBCCKcwEEKZDj9MhYccPMDCAiw8gIy5GkORIsklp6zyyiy37PLLMMcs88wcvvKhC7bQLAV4ERQVQgUToCyFGA3E26EDxNIRggJCR4KCAAVsgEFhHGaQHCAFcPAIBQrcxADV43SgwScCRPlFCgoDgIDRfBxQqSIhTLvHW98WvEkDkL5wCGWBXPZfA7uwZohrgQjA9h4uqBkIA1obUk6cckvTAbKLtHTIASxQUgDTHFIwgeJ1iBDUdwfIckDTQlBwwOkbd7S4CaifW0JlACp4EIB/Oz/9GQMfjJ7yC2+XV4ULE7wAAgpFq7wdICG0pzMuuT1z+MwNZKqIsc83kYEEi0gAdvbLXG2HBRmDL4Q+C7NgPhPOAVL2+kwEzEAxDBAMfzxamH3//vz37///AFxREAAAO2l6MlNnMjJPaEJTY1lvVkpORFI0dmF6ek1tK1ZrditmL1VXWmxseUxSc0NPYk4vVU5kVVRWeThHRmlpUWNqNWQ=",kf={loaderBarClassName:"ds-dwt-loaderBar",loaderBarBackgroundColor:"",loaderBarSource:he.bIE?Afe:me.loaderBarSource,loaderBarSourceIE:Afe,loaderBarWidth:120,loaderBarHeight:120,errorMessages:{limitReachedForZoomIn:"Error: You have reached the limit for zooming in",limitReachedForZoomOut:"Error: You have reached the limit for zooming out",insufficientParas:"Error: Not enough parameters.",invalidAngle:"Error: The angle you entered is invalid.",invalidIndex:"Error: The index you entered is invalid.",invalidHeightOrWidth:"Error: The height or width you entered is invalid.",imageNotChanged:"Error: You have not changed the current image."},generalMessages:{checkingDWTVersion:"Checking WebTwain version ...",updatingDService:"Dynamsoft Service is updating ...",downloadingDWTModule:"Downloading the Dynamic Web TWAIN module.",refreshNeeded:"Please REFRESH your browser.",downloadNeeded:"Please download and install the Dynamic Web TWAIN.",DWTmoduleLoaded:"The Dynamic Web TWAIN module is loaded."},customProgressText:{upload:"Uploading...",download:"Downloading...",load:"Loading...",decode:"Processing...",decodeTIFF:"Processing tiff...",decodePDF:"Processing pdf...",encode:"Processing...",encodeTIFF:"Processing tiff...",encodePDF:"Processing pdf...",transfer:"Transferring...",canvasLoading:"Loading ..."},buttons:{titles:{previous:"Previous Image",next:"Next Image",print:"Print Image",scan:"Acquire new Image(s)",load:"Load local Image(s)",rotateleft:"Rotate Left",rotate:"Rotate",rotateright:"Rotate Right",deskew:"Deskew",crop:"Crop Selected Area",cut:"Cut Selected Area",changeimagesize:"Change Image Size",flip:"Flip Image",mirror:"Mirror Image",zoomin:"Zoom In",originalsize:"Show Original Size",zoomout:"Zoom Out",stretch:"Stretch Mode",fit:"Fit Window",fitw:"Fit Horizontally",fith:"Fit Vertically",hand:"Hand Mode",rectselect:"Select Mode",zoom:"Click to Zoom In",restore:"Restore Original Image",save:"Save Changes",close:"Close the Editor",removeall:"Remove All Images",removeselected:"Remove All Selected Images"},bShowAllButtons:!0,visibility:{scan:!0,load:!0,print:!0,removeall:!0,removeselected:!0,rotateleft:!0,rotate:!0,rotateright:!0,deskew:!0,crop:!0,cut:!0,changeimagesize:!0,flip:!0,mirror:!0,zoomin:!0,originalsize:!0,zoomout:!0,stretch:!0,fit:!0,fitw:!0,fith:!0,hand:!0,rectselect:!0,zoom:!0,restore:!0,save:!0,close:!0}},dialogText:{dlgRotateAnyAngle:["Angle :","Interpolation:","Keep size","  OK  ","Cancel"],dlgChangeImageSize:["New Height :","New Width :","Interpolation:","  OK  ","Cancel"],saveChangedImage:["You have changed the image, do you want to keep the change(s)?","  Yes  ","  No  "],selectSource:["Select Source:","Select","Cancel","There is no source available!"]}},Os=H.mix({},kf);function Pfe(){var C;be.DWT&&(C=be.DWT.CustomizableDisplayInfo),C&&(H.isString(C.loaderBarSource)&&""!=C.loaderBarSource?me.loaderBarSource=C.loaderBarSource:he.bIE?(me.loaderBarSource=kf.loaderBarSourceIE,me.loaderBarSourceIE=kf.loaderBarSourceIE):me.loaderBarSource=kf.loaderBarSource,me.loaderBarClassName=H.isString(C.loaderBarClassName)&&""!=C.loaderBarClassName?C.loaderBarClassName:kf.loaderBarClassName,me.loaderBarBackgroundColor=H.isString(C.loaderBarBackgroundColor)?C.loaderBarBackgroundColor:kf.loaderBarBackgroundColor,me.loaderBarWidth=C.loaderBarWidth?C.loaderBarWidth:kf.loaderBarWidth,me.loaderBarHeight=C.loaderBarHeight?C.loaderBarHeight:kf.loaderBarHeight)}var Rfe=!0;function SW(C){var x=C,S=window;if(S.ShadowRoot)for(;x;){if(x instanceof S.ShadowRoot)return x;x=x.parentNode}return null}function TW(C){var x=window;return!!(x.ShadowRoot&&C instanceof x.ShadowRoot)}me._funsAfterConfigLoaded=[],me._safePromptCustomMsg=function(C){C&&C()};var bd,IW,EW,DW,AW,PW,RW,kW,MW,OW,FW,LW,NW,BW,WW,UW,VW,jW,HW,GW,zW,YW,kfe,ng,l3,XW,$W,Ic=cr,yh={background:"#434246",topMenuBorder:"",innerBorder:"",promptToSaveChange:!0,buttons:Os.buttons,dialogText:Os.dialogText},Aqe=function(){return v(function x(S,T){n(this,x);var D=this;D._stwain=S,D._ImgManager=S._ImgManager,D.zoomInStep=1.2,D.zoomOutStep=.8,D.MIN_ZOOM=.02,D.MAX_ZOOM=65,D.MAX_ROWS=128,D.MAX_COLUMNS=128,D.__MousewheelValue=0,this._Init(T)},[{key:"_Init",value:function(x){var S=this;if(S.borderWidth=H.isUndefined(x.borderWidth)?1:x.borderWidth,S.BackgroundColorByDefault=x.BackgroundColor?x.BackgroundColor:"#FFFFFF",x.BackgroundColor=S.BackgroundColorByDefault,S.BackgroundFillColor=S.BackgroundColorByDefault,x.onTopImageInTheViewChanged=function(D){H.isFunction(S._stwain.__OnTopImageInTheViewChanged)&&S._stwain.__OnTopImageInTheViewChanged(D.index,D.bByScrollBar)},x.onGetImageInfo=function(D){return{width:S._stwain.GetImageWidth(D),height:-1}},!S._stwain._viewer&&be.DWT.UseDefaultViewer){var T={viewerContainer:{},viewerEvents:{topPageChanged:function(D,R){S.__topPageChanged(D,R,S)},click:function(D){S.__click(D,S)},rightclick:function(D){S.__rightclick(D,S)},dblclick:function(D){S.__dblclick(D,S)},mousemove:function(D){S.__mousemove(D,S)},pageAreaSelected:function(D,R){S.__pageAreaSelected(D,R,S)},pageAreaUnselected:function(D){S.__pageAreaUnselected(D,S)},dragdone:function(D){S.__dragdone(D,S)},onDrop:function(D){S.__onDrop(D,S)},pageChange:function(D){S.__pageChange(D,S)},bufferChanged:function(D,R){S.__bufferChanged(S,D,R)},onBind:function(D){S.__onBindViewer(D)},onUnBind:function(D){S.__onUnBindViewer(D)},save:function(D,R,P,O){return S.__save(S,D,R,P,O)}},viewerError:{setError:function(D,R){S.__setError(D,R,S)}},imageEditorEvents:{acquire:function(D){S.__acquire(S,D)},loadImage:function(){S.__loadImage(S)},deskew:function(D,R){S.__deskew(S,D,R)},removeImage:function(){S.__remove(S)},removeAllImage:function(){S.__removeAll(S)},close:function(){S.__close(S)}},imageEditorServerCallback:{rotateRight:function(){S.__rotateRightForServer(S)},rotate:function(D,R,P){S.__rotateForServer(S,D,R,P)},rotateLeft:function(){S.__rotateLeftForServer(S)},deskew:function(D){S.__deskewForServer(S)},crop:function(D){S.__cropForServer(S,D)},erase:function(D){S.__eraseForServer(S,D)},changeImageSize:function(D,R,P){S.__changeImageSizeForServer(S,D,R,P)},flip:function(){S.__flipForServer(S)},mirror:function(){S.__mirrorForServer(S)},restore:function(D){S.__restoreForServer(S,D)},save:function(D){return S.__saveForServer(S,D)}},beforeImageEditorCreated:function(D){S.__beforeImageEditorCreated(D)}};x.Container&&(pt.isNodeList(x.Container)||H.isArray(x.Container)&&x.Container.length>0)&&(T.viewerContainer={container:x.Container[0],width:Ks(x.Width),height:Ks(x.Height)}),S._stwain._viewer=new be.DWTViewer(SC._getBuffer(S._ImgManager),T)}else x.Container&&(pt.isNodeList(x.Container)||H.isArray(x.Container)&&x.Container.length>0)&&S.__onBindViewer(x.Container[0]);S.__InitEvents(x)}},{key:"dispose",value:function(){}},{key:"__InitEvents",value:function(x){var S=this;H.isFunction(x.onTopImageInTheViewChanged)&&(S.onTopImageInTheViewChanged=x.onTopImageInTheViewChanged),H.isFunction(x.onGetImageInfo)&&(S.onGetImageInfo=x.onGetImageInfo),H.isFunction(x.onZoomChanged)&&(S.onZoomChanged=x.onZoomChanged),H.isFunction(x.onMouseMove)&&(S.onMouseMove=x.onMouseMove),H.isFunction(x.onMouseClick)&&(S.onMouseClick=x.onMouseClick),H.isFunction(x.onMouseRightClick)&&(S.onMouseRightClick=x.onMouseRightClick),H.isFunction(x.onMouseDoubleClick)&&(S.onMouseDoubleClick=x.onMouseDoubleClick),H.isFunction(x.onImageAreaDeSelected)&&(S.onImageAreaDeSelected=x.onImageAreaDeSelected),H.isFunction(x.onImageAreaSelected)&&(S.onImageAreaSelected=x.onImageAreaSelected),H.isFunction(x.onBufferChanged)&&(S.onBufferChanged=x.onBufferChanged),H.isFunction(x.onSelected)&&(S.onSelected=x.onSelected),H.isFunction(x.onRefreshUI)&&(S.onRefreshUI=x.onRefreshUI),H.isFunction(x.onResetCurrentIndex)&&(S.onResetCurrentIndex=x.onResetCurrentIndex)}},{key:"GetWebViewer",value:function(){return this._stwain._viewer}},{key:"SetSelectedImageArea",value:function(x,S,T,D){if(null!=this.GetWebViewer()){var R=[],P={};return P.left=x,P.top=S,P.right=T,P.bottom=D,R.push(P),this.GetWebViewer().setSelectedAreas(R)}return!1}},{key:"OverlayRectangle",value:function(x,S,T,D,R,P,O){var U=this;return!!U._stwain._isNoViewer()||null!=U.GetWebViewer()&&U.GetWebViewer().webViewer.overlayRectangle(x,S,T,D,R,P,O)}},{key:"ChangeImageViewSize",value:function(x,S){var T=this;return x>=0&&(T.GetWebViewer(),T.GetWebViewer().width=x),S>=0&&(T.GetWebViewer(),T.GetWebViewer().height=S),!0}},{key:"ChangeSize",value:function(x,S){var T=this;return T.GetWidth()!=x&&T.SetWidth(x),T.GetHeight()!=S&&T.SetHeight(S),!0}},{key:"GetWidth",value:function(){return this.GetWebViewer().width}},{key:"SetWidth",value:function(x){var S=x;return this._stwain._isNoViewer()||(this.GetWebViewer().width=S),!0}},{key:"GetHeight",value:function(){return this.GetWebViewer().height}},{key:"SetHeight",value:function(x){var S=x;return this._stwain._isNoViewer()||(this.GetWebViewer().height=S),!0}},{key:"SetViewMode",value:function(x,S){var T=this;return T._stwain._isNoViewer()?T._stwain._nouiNotSupport("SetViewMode"):T.GetWebViewer().setViewMode(x,S)}},{key:"SetIfFitWindowAndType",value:function(x){var S;if(null!=this.GetWebViewer()){switch(x){case 1:S="height";break;case 2:S="width";break;default:S="window"}this.GetWebViewer().fitWindow(S)}return!0}},{key:"GetAllowMultiSelect",value:function(){return!this._stwain._isNoViewer()&&this.GetWebViewer().selectionMode}},{key:"SetAllowMultiSelect",value:function(x){return this._stwain._isNoViewer()||(this.GetWebViewer().selectionMode=x?1:0),!0}},{key:"GetFitWindowType",value:function(){return this._stwain._isNoViewer(),0}},{key:"SetSelectionRectAspectRatio",value:function(x){return this.GetWebViewer().selectionRectAspectRatio=x,!0}},{key:"GetSelectionRectAspectRatio",value:function(){return this.GetWebViewer().selectionRectAspectRatio}},{key:"SetFitWindowType",value:function(x){return this._stwain._isNoViewer()||this.SetIfFitWindowAndType(x),!0}},{key:"GetIfFitWindow",value:function(){return this._stwain._isNoViewer(),!0}},{key:"SetIfFitWindow",value:function(x){var S=this;return S._stwain._isNoViewer()||(x?S.GetWebViewer().fitWindow("window"):S.GetWebViewer().zoom=1),!0}},{key:"GetImageMargin",value:function(){return this._stwain._isNoViewer()?0:this.GetWebViewer().pageMargin}},{key:"SetImageMargin",value:function(x){return this._stwain._isNoViewer()||(this.GetWebViewer().pageMargin=x),!0}},{key:"GetSelectionImageBorderColor",value:function(){return this.GetWebViewer().selectedPageBorder}},{key:"SetSelectionImageBorderColor",value:function(x){var S=x;return H.isNumber(S)&&(S=ad.getColor(S)),-1==S.indexOf("1px solid")&&(S="1px solid "+S),this.GetWebViewer().selectedPageBorder=S,!0}},{key:"GetZoom",value:function(){return this.GetWebViewer().zoom}},{key:"SetZoom",value:function(x,S,T){var D=this;return x<D.MIN_ZOOM&&(x=D.MIN_ZOOM),x>D.MAX_ZOOM&&(x=D.MAX_ZOOM),null!=D.GetWebViewer()&&(D.GetWebViewer().zoom=x),!0}},{key:"ZoomIn",value:function(x,S){var T=this,D=T._ImgManager.getImageIdMap(T._ImgManager.convertClientIndexToServerId(T._ImgManager.getCurrentImageIndex()));if(!D)return!1;var R=T.GetWebViewer().zoom,P=Math.floor(100*R*T.zoomInStep)+1;return 1<P&&P<2501?Ks(D.imageWidth*R)>15e3||Ks(D.imageHeight*R)>15e3?(cr.output(T,Os.errorMessages.limitReachedForZoomIn),alert(Os.errorMessages.limitReachedForZoomIn),!1):(T.SetZoom(P/100,x,S),!0):(cr.output(T,Os.errorMessages.limitReachedForZoomIn),alert(Os.errorMessages.limitReachedForZoomIn),!1)}},{key:"ZoomOut",value:function(){var x=this,S=x.GetWebViewer().zoom,T=Math.floor(100*S*x.zoomOutStep)-1;return 1<T&&T<6501?(x.SetZoom(T/100),!0):(cr.output(x,Os.errorMessages.limitReachedForZoomOut),alert(Os.errorMessages.limitReachedForZoomOut),!1)}},{key:"GetMouseShape",value:function(){return this._stwain._isNoViewer()?0:"crosshair"!=this.GetWebViewer().cursor}},{key:"SetMouseShape",value:function(x){return this._stwain._isNoViewer()||(this.GetWebViewer().cursor=x?"pointer":"crosshair"),!0}},{key:"GetShowPageNumber",value:function(){return!this._stwain._isNoViewer()&&this.GetWebViewer().showPageNumber}},{key:"SetShowPageNumber",value:function(x){return this._stwain._isNoViewer()||(this.GetWebViewer().showPageNumber=x),!0}},{key:"SetBackgroundFillColor",value:function(x){return this.BackgroundFillColor=x,!0}},{key:"GetBackgroundColor",value:function(){return this.GetWebViewer().background}},{key:"SetBackgroundColor",value:function(x){var S=x;return this._stwain._isNoViewer()||(this.GetWebViewer().background=S),!0}},{key:"Go",value:function(x){return this.GetWebViewer().gotoPage(x)}},{key:"__Previous",value:function(){return this.Go(this._ImgManager.getCurrentImageIndex()-1),!0}},{key:"__Next",value:function(){return this.Go(this._ImgManager.getCurrentImageIndex()+1),!0}},{key:"__fireEvent",value:function(x,S){if(H.isFunction(this[x]))try{return this[x](S)}catch(T){Nr(T)}return!0}},{key:"GetIfAutoScroll",value:function(){return this.GetWebViewer().ifAutoScroll}},{key:"SetIfAutoScroll",value:function(x){return this.GetWebViewer().ifAutoScroll=x,!0}},{key:"BindView",value:function(x){var S,T=x;return H.isString(x)?T=H.get(x):H.isDOM(T)&&(T.id&&""!=T.id||(T.id=["dwt_",H.getRandom()].join(""))),(S=this.GetWebViewer().bind(T))&&this.GetWebViewer().show(),S}},{key:"GetIfShowVideoContainer",value:function(){var x=this,S=x.GetWebViewer();return H.isUndefined(S)?(be.DWT.UseDefaultViewer?hB(x._stwain):GA(x._stwain),!1):S.webViewer.getIfShowVideoContainer()}},{key:"ShowVideoContainer",value:function(x){var S=this,T=S.GetWebViewer();return H.isUndefined(T)?(be.DWT.UseDefaultViewer?hB(S._stwain):GA(S._stwain),!1):T.webViewer.showVideoContainer(x)}},{key:"UpdateVideoContainer",value:function(x){var S=this,T=S.GetWebViewer();return H.isUndefined(T)?(be.DWT.UseDefaultViewer?hB(S._stwain):GA(S._stwain),!1):T.webViewer.updateVideoImage(x)}},{key:"ClearSelectedAreas",value:function(){var x=this.GetWebViewer();if(x)return x.clearSelectedAreas()}},{key:"OnCloseImageEditor",value:function(){return!!this.GetWebViewer().webViewer.imageEditor&&(this.GetWebViewer().createImageEditor().dispose(),!0)}},{key:"ShowImageEditorEx",value:function(x,S,T,D,R,P,O,U){var G=this;if(this._stwain._isNoViewer())return G._stwain._nouiNotSupport("ShowImageEditorEx");switch(R){case 0:case 1:case 2:break;case 3:if(G.OnCloseImageEditor())return!0}var X,z=document;if(Rf._getContainer(G._stwain)==O&&(P=!1),O){var K=be.DWT.ContainerMap;if(K){var oe,ae=Object.keys(K);for(oe=0;oe<ae.length;oe++)if(ae[oe]==O.id){P=!1;break}}}if(P&&O&&(H.isDOM(O)?X=O:TW(O)?(X=document.createElement("div"),O.appendChild(X)):(X=z.getElementById(O))&&"DIV"!=X.nodeName&&(P=!1)),P&&O&&H.isDOM(O)){var ue=SW(O);if(ue){var ye,Ie,Ue=me.timestamp;return(ye=z.createElement("link")).href=[be.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",Ue].join(""),ye.rel="stylesheet",ye.async=!0,(Ie=z.createElement("link")).href=[be.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",Ue].join(""),Ie.rel="stylesheet",Ie.async=!0,H.scriptOnload(ye,function(){H.scriptOnload(Ie,function(){return G.ShowImageEditor(X,P,T,D)}),ue.appendChild(Ie)}),ue.appendChild(ye),!0}}return G.ShowImageEditor(X,P,T,D)}},{key:"ShowImageEditor",value:function(x,S,T,D){var R=this;return x&&T&&D?(yh.element=x,yh.width=T,yh.height=D):(yh.element=void 0,yh.width=void 0,yh.height=void 0),yh.border=R.GetWebViewer().border,yh.selectionRectAspectRatio=R.GetWebViewer().selectionRectAspectRatio,yh.workMode=WP.normal,R.GetWebViewer().createImageEditor(yh),0!=R._stwain.ErrorCode&&(R.GetWebViewer().webViewer.imageEditor&&R.GetWebViewer().webViewer.imageEditor.dispose(),R.GetWebViewer().createImageEditor(yh)),R.GetWebViewer().webViewer.imageEditor&&R.GetWebViewer().webViewer.imageEditor.show(),!0}},{key:"__beforeImageEditorCreated",value:function(x){var S=be.DWT.CustomizableDisplayInfo;if(!H.isUndefined(S)){if(!H.isUndefined(S.buttons)){var T=S.buttons.titles;H.isUndefined(T)||(H.isUndefined(T.previous)||(x.buttons.titles.previous=T.previous),H.isUndefined(T.next)||(x.buttons.titles.next=T.next),H.isUndefined(T.print)||(x.buttons.titles.print=T.print),H.isUndefined(T.scan)||(x.buttons.titles.scan=T.scan),H.isUndefined(T.load)||(x.buttons.titles.load=T.load),H.isUndefined(T.rotateleft)||(x.buttons.titles.rotateleft=T.rotateleft),H.isUndefined(T.rotate)||(x.buttons.titles.rotate=T.rotate),H.isUndefined(T.rotateright)||(x.buttons.titles.rotateright=T.rotateright),H.isUndefined(T.deskew)||(x.buttons.titles.deskew=T.deskew),H.isUndefined(T.crop)||(x.buttons.titles.crop=T.crop),H.isUndefined(T.cut)||(x.buttons.titles.cut=T.cut),H.isUndefined(T.changeimagesize)||(x.buttons.titles.changeimagesize=T.changeimagesize),H.isUndefined(T.flip)||(x.buttons.titles.flip=T.flip),H.isUndefined(T.mirror)||(x.buttons.titles.mirror=T.mirror),H.isUndefined(T.zoomin)||(x.buttons.titles.zoomin=T.zoomin),H.isUndefined(T.originalsize)||(x.buttons.titles.originalsize=T.originalsize),H.isUndefined(T.zoomout)||(x.buttons.titles.zoomout=T.zoomout),H.isUndefined(T.stretch)||(x.buttons.titles.stretch=T.stretch),H.isUndefined(T.fit)||(x.buttons.titles.fit=T.fit),H.isUndefined(T.fitw)||(x.buttons.titles.fitw=T.fitw),H.isUndefined(T.fith)||(x.buttons.titles.fith=T.fith),H.isUndefined(T.hand)||(x.buttons.titles.hand=T.hand),H.isUndefined(T.rectselect)||(x.buttons.titles.rectselect=T.rectselect),H.isUndefined(T.zoom)||(x.buttons.titles.zoom=T.zoom),H.isUndefined(T.restore)||(x.buttons.titles.restore=T.restore),H.isUndefined(T.save)||(x.buttons.titles.save=T.save),H.isUndefined(T.close)||(x.buttons.titles.close=T.close),H.isUndefined(T.removeall)||(x.buttons.titles.removeall=T.removeall),H.isUndefined(T.removeselected)||(x.buttons.titles.removeselected=T.removeselected));var D=S.buttons.bShowAllButtons;H.isUndefined(D)||(x.buttons.bShowAllButtons=D);var R=S.buttons.visibility;H.isUndefined(R)||(H.isUndefined(R.scan)||(x.buttons.visibility.scan=R.scan),H.isUndefined(R.load)||(x.buttons.visibility.load=R.load),H.isUndefined(R.print)||(x.buttons.visibility.print=R.print),H.isUndefined(R.removeall)||(x.buttons.visibility.removeall=R.removeall),H.isUndefined(R.removeselected)||(x.buttons.visibility.removeselected=R.removeselected),H.isUndefined(R.rotateleft)||(x.buttons.visibility.rotateleft=R.rotateleft),H.isUndefined(R.rotate)||(x.buttons.visibility.rotate=R.rotate),H.isUndefined(R.rotateright)||(x.buttons.visibility.rotateright=R.rotateright),H.isUndefined(R.deskew)||(x.buttons.visibility.deskew=R.deskew),H.isUndefined(R.crop)||(x.buttons.visibility.crop=R.crop),H.isUndefined(R.cut)||(x.buttons.visibility.cut=R.cut),H.isUndefined(R.changeimagesize)||(x.buttons.visibility.changeimagesize=R.changeimagesize),H.isUndefined(R.flip)||(x.buttons.visibility.flip=R.flip),H.isUndefined(R.mirror)||(x.buttons.visibility.mirror=R.mirror),H.isUndefined(R.zoomin)||(x.buttons.visibility.zoomin=R.zoomin),H.isUndefined(R.originalsize)||(x.buttons.visibility.originalsize=R.originalsize),H.isUndefined(R.zoomout)||(x.buttons.visibility.zoomout=R.zoomout),H.isUndefined(R.stretch)||(x.buttons.visibility.stretch=R.stretch),H.isUndefined(R.fit)||(x.buttons.visibility.fit=R.fit),H.isUndefined(R.fitw)||(x.buttons.visibility.fitw=R.fitw),H.isUndefined(R.fith)||(x.buttons.visibility.fith=R.fith),H.isUndefined(R.hand)||(x.buttons.visibility.hand=R.hand),H.isUndefined(R.rectselect)||(x.buttons.visibility.rectselect=R.rectselect),H.isUndefined(R.zoom)||(x.buttons.visibility.zoom=R.zoom))}var P=S.dialogText;H.isUndefined(P)||(H.isUndefined(P.dlgRotateAnyAngle)||(x.dialogText.dlgRotateAnyAngle=P.dlgRotateAnyAngle),H.isUndefined(P.dlgChangeImageSize)||(x.dialogText.dlgChangeImageSize=P.dlgChangeImageSize),H.isUndefined(P.saveChangedImage)||(x.dialogText.saveChangedImage=P.saveChangedImage),H.isUndefined(P.selectSource)||(x.dialogText.selectSource=P.selectSource))}}},{key:"__topPageChanged",value:function(x,S,T){T.__fireEvent("onTopImageInTheViewChanged",{index:x,bByScrollBar:S})}},{key:"__click",value:function(x,S){S.__fireEvent("onMouseClick",{e:x,x:x.imageX,y:x.imageY,index:S._ImgManager.getCurrentImageIndex()})}},{key:"__rightclick",value:function(x,S){S.__fireEvent("onMouseRightClick",{e:x,x:x.imageX,y:x.imageY,index:S._ImgManager.getCurrentImageIndex()})}},{key:"__dblclick",value:function(x,S){S.__fireEvent("onMouseDoubleClick",{e:x,x:x.imageX,y:x.imageY,index:S._ImgManager.getCurrentImageIndex()})}},{key:"__mousemove",value:function(x,S){S.__fireEvent("onMouseMove",{e:x,x:x.imageX,y:x.imageY,index:S._ImgManager.getCurrentImageIndex()})}},{key:"__pageAreaSelected",value:function(x,S,T){var D=T,R=1;if(S&&S.length>0){var P=S[S.length-1];P.index&&(R=Ks(P.index)+1),D.__fireEvent("onImageAreaSelected",{index:x,left:Ks(P.x),top:Ks(P.y),right:Ks(P.x+P.width),bottom:Ks(P.y+P.height),areaIndex:R})}}},{key:"__pageAreaUnselected",value:function(x,S){S.__fireEvent("onImageAreaDeSelected",x)}},{key:"__dragdone",value:function(x,S){var T=S;H.isFunction(T._stwain.__OnIndexChangeDragDropDone)&&T._stwain.__OnIndexChangeDragDropDone(x)}},{key:"__onDrop",value:function(x,S){var T=S;T.GetWebViewer().webViewer.acceptDrop&&T.__dropEvent(x,T)}},{key:"__dropEvent",value:function(x,S){var T,D,R=S,P=function(K){R._stwain._bIfShowProgressBar&&me.closeProgress(null),K&&cr.output(null,K+" was loaded successfully!")},O=function(K,oe,ae){R._stwain._bIfShowProgressBar&&me.closeProgress(null),R._stwain._errorCode=K,R._stwain._errorString=oe,hue({code:K,message:oe}),ae&&cr.output(null,ae+" failed to load. Error code: "+K+"Error String: "+oe)};try{for(var U=x.dataTransfer.files,G=0;G<U.length;G++){if(0==(T=U[G]).type.length){var X=void 0,z=T.name.indexOf(".");switch(z>0&&(X=T.name.substring(z+1)),X){case"bmp":D=be.DWT.EnumDWT_ImageType.IT_BMP;break;case"jpg":case"jpeg":D=be.DWT.EnumDWT_ImageType.IT_JPG;break;case"tif":case"tiff":D=be.DWT.EnumDWT_ImageType.IT_TIF;break;case"png":D=be.DWT.EnumDWT_ImageType.IT_PNG;break;case"pdf":D=be.DWT.EnumDWT_ImageType.IT_PDF;break;case"jp2":case"j2k":case"j2c":D=be.DWT.EnumDWT_ImageType.IT_J2K;break;default:cr.output(null,T.name+" failed to load because the file type is not supported!"),D=-1,Ale(R._stwain)}}else switch(T.type){case"image/bmp":D=be.DWT.EnumDWT_ImageType.IT_BMP;break;case"image/jpg":case"image/jpeg":D=be.DWT.EnumDWT_ImageType.IT_JPG;break;case"image/tif":case"image/tiff":D=be.DWT.EnumDWT_ImageType.IT_TIF;break;case"image/png":D=be.DWT.EnumDWT_ImageType.IT_PNG;break;case"application/pdf":D=be.DWT.EnumDWT_ImageType.IT_PDF;break;case"image/jp2":D=be.DWT.EnumDWT_ImageType.IT_J2K;break;default:cr.output(null,T.name+" failed to load because the file type is not supported!"),D=-1,Ale(R._stwain)}-1!=D&&(R._stwain._bIfShowProgressBar?me.showProgress(R._stwain,"DropLoading",R._stwain.IfShowCancelDialogWhenImageTransfer):me.hideProgress(),R._stwain._OnPercentDone([0,-1,Br.Loading]),R._stwain.Addon&&R._stwain.Addon.PDF&&mn.checkProductKey(R._stwain,{PDFRasterizer:!0},!0),function(K){var oe=new FileReader;oe.readAsDataURL(K),oe.onload=function(){var ae=R._stwain.__GetLoadEventsNum();R._stwain.__LoadImageFromBytesV2(K,D,"",!0,0,K.size,!1,ae,P,O)},oe.onerror=function(ae){S0(R._stwain),R._stwain._errorString=this.error,O(R._stwain._errorCode,R._stwain._getErrorString())}}(U[G]))}}catch(K){H.error(K.stack||K,"error"),setTimeout(function(){throw K},0)}}},{key:"__pageChange",value:function(x,S){var T,D=S,R=D._ImgManager.count();H.log("OnPagination"),R<=0?ta(D._stwain):1!=R&&(!/^\d+$/.test(x)||x<=0?alert(Os.errorMessages.invalidIndex):((T=Ks(x)-1)<0?T=0:T>=R&&(T=R-1),T!=D._ImgManager.getCurrentImageIndex()&&D.GetWebViewer().gotoPage(T)))}},{key:"__bufferChanged",value:function(x,S,T){var D,R=x,P=[],O=-1,U=[];S.operation&&(S.action=S.operation);for(var G=0;G<R._ImgManager.count();G++)(D=R._ImgManager.getCustomDataByIndex(G))&&D.serverId&&P.push(this._ImgManager._serverId2uidFromServer(D.serverId));if(S.imageIds=P,S.curIndex>=0&&(D=R._ImgManager.getCustomDataByIndex(S.curIndex))&&D.serverId&&(O=this._ImgManager._serverId2uidFromServer(D.serverId)),S.currentId=O,"modify"==S.operation&&""!=S.afterStatus.modifiedUid){var X=R._ImgManager.getIndexByUid(S.afterStatus.modifiedUid);X>=0&&(D=R._ImgManager.getCustomDataByIndex(X))&&D.serverId&&(S.modifiedId=this._ImgManager._serverId2uidFromServer(D.serverId))}if(S.afterStatus.selectedUids)for(var z=0;z<S.afterStatus.selectedUids.length;z++){var K=S.afterStatus.selectedUids[z];if(K&&-1!=K){var oe=R._ImgManager.getIndexByUid(S.afterStatus.selectedUids[z]);oe>=0&&(D=R._ImgManager.getCustomDataByIndex(oe))&&D.serverId&&U.push(this._ImgManager._serverId2uidFromServer(D.serverId))}}S.selectedIds=U,H.mix(S,{}),delete S.uids,delete S.currentUid,delete S.selectedUids,delete S.afterStatus,delete S.beforeStatus,delete S.operation,delete S.curIndex,delete S.docUid,R.__fireEvent("onBufferChanged",S)}},{key:"__setError",value:function(x,S,T){var D=T;D._stwain._errorCode=x,D._stwain._errorString=S}},{key:"__acquire",value:function(x,S){var T=x;try{var R,D=!1;1==be.DWT.IfConfineMaskWithinTheViewer&&(be.DWT.IfConfineMaskWithinTheViewer=!1,D=!0),R=H.isArray(S)&&S.length>=3?S:Os.dialogText.selectSource,T._stwain._selectSourceAsync("SelectSourceAsync",null,R).then(function(){return T._stwain.AcquireImageAsync({IfShowUI:!0,IfCloseSourceAfterAcquire:!0})}).then(function(){D&&(be.DWT.IfConfineMaskWithinTheViewer=!0)}).catch(function(P){H.log("User did not select a source"),D&&(be.DWT.IfConfineMaskWithinTheViewer=!0)})}catch(P){}}},{key:"__loadImage",value:function(x){try{var S=x,T=null;be.DWT.IfConfineMaskWithinTheViewer&&(T=!0,be.DWT.IfConfineMaskWithinTheViewer=!1),S._stwain._containerElement=void 0,S._stwain.IfShowFileDialog=!0,S._stwain.Addon&&S._stwain.Addon.PDF&&mn.checkProductKey(S._stwain,{PDFRasterizer:!0},!0),S._stwain.LoadImageEx("",5,function(){H.log("Loaded an image successfully."),null!=T&&(be.DWT.IfConfineMaskWithinTheViewer=T)},function(D,R){H.log("Loading failed with the error: "+R),null!=T&&(be.DWT.IfConfineMaskWithinTheViewer=T)})}catch(D){}}},{key:"__print",value:function(x){var S=x;rs(S._stwain),S._ImgManager.getCurrentImageIndex()<0||S._ImgManager.PrintCurrentImage()}},{key:"__save",value:(C=_t(B.mark(function x(S,T,D,R,P){var O,U,G,X,z;return B.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(U="save",rs((O=S)._stwain),!(O._ImgManager.count()<=0||O._ImgManager.getCurrentImageIndex()<0)){K.next=4;break}return K.abrupt("return");case 4:return O._stwain._containerElement=void 0,G=O.__getViewerElement(O,P),Wo(U,G),K.prev=7,X=this._ImgManager.getIndexByUid(T),z=this._ImgManager.convertClientIndexToServerId(X),K.next=12,O._stwain._updateImage(z,D,R);case 12:if(!K.sent){K.next=19;break}return K.next=16,O._stwain.__saveToViewerAfterUpdate(T,R);case 16:K.next=20;break;case 19:case 20:K.next=24;break;case 22:K.prev=22,K.t0=K.catch(7);case 24:return K.prev=24,D=null,Xr(U),K.finish(24);case 28:return K.abrupt("return",void 0);case 29:case"end":return K.stop()}},x,this,[[7,22,24,28]])})),function(x,S,T,D,R){return C.apply(this,arguments)})},{key:"__getViewerElement",value:function(x,S){var T,D=x;if(S)if(D.GetWebViewer().webViewer.imageEditor){var R=D.GetWebViewer().createImageEditor();T="dwt-viewer-imageEditor-fullScreen"==R.inner.containerElement.className?{_containerElement:document.body}:{_containerElement:R.inner.containerElement}}else T=D._stwain;else T=D._stwain;return T}},{key:"__deskew",value:function(x,S,T){var D=this,R="deskew";rs(D._stwain);var P=D._ImgManager.getCurrentImageIndex();if(D._ImgManager.count()<=0||P<0)Ic.output(D,"No image in Buffer");else{var O=D.__getViewerElement(D,!0);Wo(R,O),D._stwain.GetSkewAngleFromBinaryAsync(P,S,function(U){T(U[0]),Xr(R)},function(){Xr(R)})}}},{key:"__remove",value:function(x){var S=this;rs(S._stwain),S._ImgManager.count()<=0||S._ImgManager.getCurrentImageIndex()<0?Ic.output(S,"No image in Buffer"):S._stwain.RemoveAllSelectedImages()}},{key:"__removeAll",value:function(x){var S=this;rs(S._stwain),S._ImgManager.count()<=0||S._ImgManager.getCurrentImageIndex()<0?Ic.output(S,"No image in Buffer"):S._stwain.RemoveAllImages()}},{key:"__onBindViewer",value:function(x){x&&(Rf._setContainer(this._stwain,x),x.id&&(be.DWT.ContainerMap[x.id]=this._stwain))}},{key:"__onUnBindViewer",value:function(x){if(x){var S=Rf._getContainer(this._stwain);S&&(S.innerHTML=""),Rf._setContainer(this._stwain,null),x.id&&x.id in be.DWT.ContainerMap&&delete be.DWT.ContainerMap[x.id]}}},{key:"__close",value:function(x){rs(this._stwain),Rf._closeImageEditorUI(this._stwain)}},{key:"__rotateRightForServer",value:function(x){var S=this;rs(S._stwain);var T=S._ImgManager.getCurrentImageIndex();S._ImgManager.count()<=0||T<0?Ic.output(S,"No image in Buffer"):S._stwain.RotateRight(T)}},{key:"__rotateForServer",value:function(x,S,T,D){var R=this;rs(R._stwain);var P=R._ImgManager.getCurrentImageIndex();R._ImgManager.count()<=0||P<0?Ic.output(R,"No image in Buffer"):R._stwain.RotateEx(P,S,D,T)}},{key:"__rotateLeftForServer",value:function(x){var S=this;rs(S._stwain);var T=S._ImgManager.getCurrentImageIndex();S._ImgManager.count()<=0||T<0?Ic.output(S,"No image in Buffer"):S._stwain.RotateLeft(T)}},{key:"__deskewForServer",value:function(x){var S=this;rs(S._stwain);var T=S._ImgManager.getCurrentImageIndex();S._ImgManager.count()<=0||T<0?Ic.output(S,"No image in Buffer"):S._stwain.GetSkewAngleAsync(T).then(function(D){S._stwain.RotateEx(T,D,!0,5,function(){},function(){})})}},{key:"__cropForServer",value:function(x,S){var T=this;rs(T._stwain);var D=T._ImgManager.getCurrentImageIndex();if(T._ImgManager.count()<=0||D<0)Ic.output(T,"No image in Buffer");else{var R=S.left,P=S.top,O=R+S.width,U=P+S.height;T._stwain.Crop(D,Ks(R),Ks(P),Ks(O),Ks(U))}}},{key:"__eraseForServer",value:function(x,S){var T=this;rs(T._stwain);var D=T._ImgManager.getCurrentImageIndex();if(T._ImgManager.count()<=0||D<0)Ic.output(T,"No image in Buffer");else{var R=S.left,P=S.top,O=R+S.width,U=P+S.height;T._stwain.CutFrameToClipboard(D,Ks(R),Ks(P),Ks(O),Ks(U))}}},{key:"__changeImageSizeForServer",value:function(x,S,T,D){var R=this;rs(R._stwain);var P=R._ImgManager.getCurrentImageIndex();R._ImgManager.count()<=0||P<0?Ic.output(R,"No image in Buffer"):R._stwain.ChangeImageSize(P,S,T,D)}},{key:"__flipForServer",value:function(x){var S=this;rs(S._stwain);var T=S._ImgManager.getCurrentImageIndex();S._ImgManager.count()<=0||T<0?Ic.output(S,"No image in Buffer"):S._stwain.Flip(T)}},{key:"__mirrorForServer",value:function(x){var S=this;rs(S._stwain);var T=S._ImgManager.getCurrentImageIndex();S._ImgManager.count()<=0||T<0?Ic.output(S,"No image in Buffer"):S._stwain.Mirror(T)}},{key:"__restoreForServer",value:function(x,S){var T=x;if(rs(T._stwain),T._ImgManager.count()<=0||T._ImgManager.getCurrentImageIndex()<0)Ic.output(T,"No image in Buffer");else{var D=T._ImgManager.getIndexByUid(S);D>=0&&T.__RestoreImageInner(T,D)}}},{key:"__saveForServer",value:function(x,S){var T=x;return new pt.Promise(function(D,R){rs(T._stwain),(T._ImgManager.count()<=0||T._ImgManager.getCurrentImageIndex()<0)&&(Ic.output(T,"No image in Buffer"),D());var P=T._ImgManager.getIndexByUid(S);P>=0?T.__SaveImageInner(T,P,!0,function(){D()}):D()})}},{key:"__RestoreImageInner",value:function(x,S,T){var D=x,R=D._ImgManager.getImageIdMap(D._ImgManager.convertClientIndexToServerId(S));R&&D.__OnGetImageFromServerForEdit(R,S,1,function(P,O,U){if(P){H.log("__RestoreImageInner: "+[P.uuid].join(","));var G=H.clone(P);G.imageId=P.serverId,D._ImgManager.UpdateImage(G,U)}if(-1==(P&&P.serverId))return T&&T(),!1;T&&T()})}},{key:"__SaveImageInner",value:function(x,S,T,D){var R=x,P=R._ImgManager.getImageIdMap(R._ImgManager.convertClientIndexToServerId(S));return P&&R.__OnGetImageFromServerForEdit(P,S,2,function(O,U,G){if(O){if(1==T&&(H.log("__SaveImageInner: "+[O.uuid].join(",")),R._ImgManager.getCurrentImageIndex()==U)){var X=H.clone(O);X.imageId=O.serverId,R._ImgManager.UpdateImage(X,G)}if(-1==O.serverId)return D&&D(),!1}return D&&D(),!0}),!0}},{key:"__OnGetImageFromServerForEdit",value:function(x,S,T,D){var R=this;if(D&&R._ImgManager.getBaseUrl){var P=R._ImgManager.convertClientIndexToServerId(S);if(-1==P)return!1;be.DWT.ConnectWithSocket?D():du({method:"GET",xhrFields:{withCredentials:!0},url:cr.getUrlByAct(R._ImgManager.getBaseUrl,P,T),onSuccess:function(O){var U;x.ticks=Date.now(),U=be.navInfoSync.bMobile?cr.getImageUrl(R._ImgManager.getBaseUrl,P,Math.round(x.iImageControlWidth*devicePixelRatio),Math.round(x.iImageControlHeight*devicePixelRatio),x.ticks):cr.getImageUrl(R._ImgManager.getBaseUrl,P,Ks(x.iImageControlWidth),Ks(x.iImageControlHeight),x.ticks),x.imageUrl=cr.getImageUrl(R._ImgManager.getBaseUrl,P,-1,-1,x.ticks),x.minImageUrl=U;var G=R._ImgManager.GetMetaDataByIndex(S);if(G){var X=R._ImgManager.getImageIdMap(P);G.width=X&&X.width?X.width:R._stwain.GetImageWidth(S),G.height=X&&X.height?X.height:R._stwain.GetImageHeight(S)}D(x,S,G)},onError:function(){}})}return!0}}]);var C}(),Mfe=function(C){function x(S,T){var D,P,O,U;n(this,x),P=this,U=[T],O=qn(O=x);var R=D=Za(P,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(G){return!1}}()?Reflect.construct(O,U||[],qn(P).constructor):O.apply(P,U));return R._stwain=S,R.bImageJustChangedInEditor=!1,R.bImageChangedInViewer=!1,D}return el(x,C),v(x,[{key:"getUidByIndex",value:function(S){return this._buffer.getUidByIndex(S)}},{key:"dispose",value:function(){return!0}},{key:"append",value:function(S,T,D,R,P){var O,U,G,X,z,K=this;(this._buffer.isActiveFile||!H.isUndefined(P))&&R.currentFileName&&R.currentFileName.length>0?z=U=K.getCountByDocumentName(R.currentFileName):(U=K.count(),z=K.getCountByDocumentName(K.GetCurrentFileName())),G=K.getCurrentImageIndex();for(var oe=U-1;oe>=S;oe--)X=K.convertClientIndexToServerId(oe),K.removeByServerId(X,oe);return U<S?K._updateUIAfterAdd(O=z,T,D,R,!0):(X=K.convertClientIndexToServerId(O=G>=U-1?0:G+1),K.removeByServerId(X,O),K._updateUIAfterAdd(O,T,D,R,O==S-1))}},{key:"insertBefore",value:function(S,T,D,R,P){var O,U=1*S;return(U<0||U>T)&&(U=-1),U>=(O=this.count())&&(U=O),this._updateUIAfterAdd(U,D,R,P,!1)}},{key:"exists",value:function(S){return!H.isUndefined(this.getImageIdMap(S))}},{key:"insert",value:function(S,T,D,R,P){var O,U=1*S;return(U<0||U>T)&&(U=-1),U>=(O=this.count())&&(U=O),this._updateUIAfterAdd(U,D,R,P,!1)}},{key:"moveImage",value:function(S,T,D){return this._buffer.moveImage(S,T)}},{key:"switchImage",value:function(S,T){return this._buffer.switchImage(S,T)}},{key:"setSelectedClientIndexArray",value:function(S){return this._buffer.selectImages(S)}},{key:"getSelectedClientIndexArray",value:function(S){return this._buffer.getSelectedImagesIndices()}},{key:"showImagesByFilter",value:function(S,T,D){return this._buffer.filterImagesByTag(S,T,D)}},{key:"clearFilter",value:function(){return this._buffer.clearFilter()}},{key:"removeImageTag",value:function(S){return this._buffer.removeImageTag(S)}},{key:"addImageTag",value:function(S,T){return this._buffer.tagImages(S,T)}},{key:"getCurrentTag",value:function(){var S;return 0==(S=this._buffer.getCurrentTag())?"":S}},{key:"renameTag",value:function(S,T){return this._buffer.renameTag(S,T)}},{key:"removeTag",value:function(S,T){return this._buffer.removeTag(S,T)}},{key:"getTagList",value:function(){return this._buffer.getTagList()}},{key:"getTagListByIndex",value:function(S){return this._buffer.getTagListByIndex(S)}},{key:"OpenFile",value:function(S){return this._buffer.openDocument(S)}},{key:"CreateFile",value:function(S){return this._buffer.createDocument(S)}},{key:"GetCurrentFileName",value:function(){return this._buffer.getCurrentFileName()}},{key:"RemoveFile",value:function(S){return this._buffer.removeDocument(S)}},{key:"RenameFile",value:function(S,T){return this._buffer.renameDocument(S,T)}},{key:"GetFileInfoList",value:function(){return this._buffer.getDocumentInfoList()}},{key:"MoveImageToFile",value:function(S,T,D,R){return this._buffer.moveImageToFile(S,T,D,R)}},{key:"GetServerIdsByFileName",value:function(S){var T,D=this,R=[];return(T=D.GetFileInfoList())?H.each(T,function(P){if(S==P.name){if(P.imageIds)for(var O=0;O<P.imageIds.length;O++){var U=P.imageIds[O];if(U&&-1!=U){var G=D._stwain._uidFromServer2ServerId(U);G>0&&R.push(G)}}return!1}}):R=[],R}},{key:"insertImage",value:function(S,T,D){this._buffer.insertImage(T,S,D)}},{key:"GetMetaDataByIndex",value:function(S){return this._buffer.getMetadataByUid(this._buffer.getUidByIndex(S))}},{key:"RefreshAllImages",value:function(S,T){for(var D,R,P,O=this,U=0;U<O.count();U++){D=O.convertClientIndexToServerId(U);var G=O.getImageIdMap(D);if(G){P=O.GetMetaDataByIndex(U),R=be.navInfoSync.bMobile?cr.getImageUrl(O._baseUrl,D,Math.round(S*devicePixelRatio),Math.round(T*devicePixelRatio),Date.now()):cr.getImageUrl(O._baseUrl,D,S,T,Date.now());var X=H.clone(G);X.imageId=D,X.minImageUrl=R,O._buffer.updateImage(X,P)}}}},{key:"UpdateData",value:function(S,T){var R=this.getImageIdMap(S);if(R){var P=H.clone(R);P.imageId=S,this._buffer.updateImage(P,T)}return!0}},{key:"UpdateImage",value:function(S,T){return this._buffer.updateImage(S,T),!0}},{key:"_setDataImageControl",value:function(S,T,D){var R,P,O,U,G=this;if(D)O=S;else if(O=(P=G.getCustomDataByIndex(S)).serverId,U=P.uidFromServer,O<=0)return!1;return(R=G.getImageIdMap(O))||((R=new dP).serverId=O,R.uidFromServer=U,G._serverIdMap[O]=R,G._uidMap[U]=R),null!=R&&(R.bIsDirty=!0),G.__GetImageAndAttach(R,O,!0,!1,!1,S,T),!0}},{key:"__AttachImages",value:function(){var S,T,D,R=this;T=R.count();for(var P=0;P<T;P++)(S=R.convertClientIndexToServerId(P))>=0&&(D=R.getImageIdMap(S))&&R.__GetImageAndAttach(D,S,!0,!1,!1,0)}},{key:"AddImage",value:function(S,T,D,R,P){var O,U=this,G=1*S;return!(T<=0||((O=new dP).bIsDirty=!0,O.serverId=T,O.uidFromServer=D,U._serverIdMap[T]=O,U._uidMap[D]=O,T>=0&&U.__GetImageAndAttach(O,T,!1,!0,P,G,R),0))}},{key:"OnGetImageByURL",value:function(S,T,D,R,P,O,U,G){return T.imageUrl&&""!=T.imageUrl?(T.iImageControlWidth=D,T.iImageControlHeight=R,T.bAddImage=P,T.bAppendImage=O,T.index=U,this._attachImagesForControl(T,G),!0):this.OnGetImageFromServer(S,T,D,R,P,O,U,G)}},{key:"OnGetImageFromServer",value:function(S,T,D,R,P,O,U,G){var X,z,K=this,oe=K._baseUrl;if(oe){if(S<=0)return!1;T.bIsDirty&&(T.ticks=Date.now()),H.isUndefined(D)&&(D=-1),H.isUndefined(R)&&(R=-1),T.iImageControlWidth=D,T.iImageControlHeight=R,T.bAddImage=P,T.bAppendImage=O,T.index=U,be.DWT.ConnectWithSocket&&K._stwain._isBindViewer()?(K._attachImagesForControl(T,G),Rf._getblob_queue.push([K._stwain,S,G]),Rf.ProcessGetBlobByQueue()):(X=cr.getImageUrl(oe,S,-1,-1,T.ticks),z=be.navInfoSync.bMobile?cr.getImageUrl(oe,S,Math.round(D*devicePixelRatio),Math.round(R*devicePixelRatio),T.ticks):cr.getImageUrl(oe,S,D,R,T.ticks),T.imageUrl=X,T.minImageUrl=z,K._attachImagesForControl(T,G))}return!0}},{key:"getBaseUrl",get:function(){return this._baseUrl}},{key:"_attachImagesForControl",value:function(S,T){var D,R,P=this;if((R=H.clone(S)).imageId=R.serverId,R.bAddImage){if(D=T.currentFileName.length>0?P._buffer.addImage(R,T,T.currentFileName):P._buffer.addImage(R,T)){var O=g9(D,1)[0],U=this.getImageIdMap(R.serverId);U&&(U.uuid=O);var G=this._buffer.getCustomDataByUid(O);G&&(G.serverId&&R&&R.serverId&&(G.serverId=R.serverId),G.uidFromServer&&(G.uidFromServer=R.uidFromServer))}}else P._buffer.updateImage(R,T);return!0}},{key:"_updateUIAfterAdd",value:function(S,T,D,R,P){return!(T<0)&&this.AddImage(S,T,D,R,P)}},{key:"__GetImageAndAttach",value:function(S,T,D,R,P,O,U){var G,X,z,oe,K=this;K._stwain._isBindViewer()?(z=K._stwain.Viewer.height>=400?K._stwain.Viewer.height:400,X=K._stwain.Viewer.width>=400?K._stwain.Viewer.width:400):(X=-1,z=-1),oe=!!D||1==S.bIsDirty;var ae=null===(G=K.getImageIdMap(T))||void 0===G?void 0:G.uuid;ae&&-1!=ae&&S.iImageControlWidth==X&&S.iImageControlHeight==z&&0==S.bIsDirty||K.__SetArrayControlLoadImage(T,S,X,z,oe,R,P,O,U)}},{key:"__SetArrayControlLoadImage",value:function(S,T,D,R,P,O,U,G,X){P?this.OnGetImageFromServer(S,T,D,R,O,U,G,X):this.OnGetImageByURL(S,T,D,R,O,U,G,X)}},{key:"GetServerIdList",value:function(){var S,T,D,R=this,P=[];if(S=R._buffer.getDocumentContents(R._buffer.getCurrentDocument()))for(var O=0;O<S.length;O++)(T=S[O])&&-1!=T&&(D=R._buffer.getCustomDataByUid(T))&&P.push(D.serverId);return P}}])}(SC),Pqe=function(C){var x=C||window.event,S=!0;return H.each(pt.Events.registedObjs,function(T){H.each(pt.Events.registedClass,function(D){if(T instanceof D&&T.bFocus&&T.handlerKeyDown&&!(S=T.handlerKeyDown(x)))return!1})}),S};function qW(C,x){for(var S in x)x.hasOwnProperty(S)&&!H.isUndefined(x[S])&&(C.hasOwnProperty(S)&&!H.isUndefined(C[S])||(C[S]=x[S]));return C}rC(function(){H.addEventListener(document.documentElement,"keydown",Pqe)}),qW(be.DWT,fu),qW(be.DWT,aje),be.DWT.CertificateConfig?qW(be.DWT.CertificateConfig,tB):be.DWT.CertificateConfig=tB,be.DWT.RegisterEvent=function(C,x){return H.isFunction(x)&&(be.DWT[C]=x),!0},function(C){C.CAP_NONE=0,C.CAP_XFERCOUNT=1,C.ICAP_COMPRESSION=256,C.ICAP_PIXELTYPE=257,C.ICAP_UNITS=258,C.ICAP_XFERMECH=259,C.CAP_AUTHOR=4096,C.CAP_CAPTION=4097,C.CAP_FEEDERENABLED=4098,C.CAP_FEEDERLOADED=4099,C.CAP_TIMEDATE=4100,C.CAP_SUPPORTEDCAPS=4101,C.CAP_EXTENDEDCAPS=4102,C.CAP_AUTOFEED=4103,C.CAP_CLEARPAGE=4104,C.CAP_FEEDPAGE=4105,C.CAP_REWINDPAGE=4106,C.CAP_INDICATORS=4107,C.CAP_SUPPORTEDCAPSEXT=4108,C.CAP_PAPERDETECTABLE=4109,C.CAP_UICONTROLLABLE=4110,C.CAP_DEVICEONLINE=4111,C.CAP_AUTOSCAN=4112,C.CAP_THUMBNAILSENABLED=4113,C.CAP_DUPLEX=4114,C.CAP_DUPLEXENABLED=4115,C.CAP_ENABLEDSUIONLY=4116,C.CAP_CUSTOMDSDATA=4117,C.CAP_ENDORSER=4118,C.CAP_ALARMS=4120,C.CAP_ALARMVOLUME=4121,C.CAP_AUTOMATICCAPTURE=4122,C.CAP_TIMEBEFOREFIRSTCAPTURE=4123,C.CAP_TIMEBETWEENCAPTURES=4124,C.CAP_CLEARBUFFERS=4125,C.CAP_MAXBATCHBUFFERS=4126,C.CAP_DEVICETIMEDATE=4127,C.CAP_POWERSUPPLY=4128,C.CAP_CAMERAPREVIEWUI=4129,C.CAP_SERIALNUMBER=4132,C.CAP_PRINTER=4134,C.CAP_PRINTERENABLED=4135,C.CAP_PRINTERINDEX=4136,C.CAP_PRINTERMODE=4137,C.CAP_PRINTERSTRING=4138,C.CAP_PRINTERSUFFIX=4139,C.CAP_LANGUAGE=4140,C.CAP_FEEDERALIGNMENT=4141,C.CAP_FEEDERORDER=4142,C.CAP_REACQUIREALLOWED=4144,C.CAP_BATTERYMINUTES=4146,C.CAP_BATTERYPERCENTAGE=4147,C.CAP_CAMERASIDE=4148,C.CAP_SEGMENTED=4149,C.CAP_CAMERAENABLED=4150,C.CAP_CAMERAORDER=4151,C.CAP_MICRENABLED=4152,C.CAP_FEEDERPREP=4153,C.CAP_FEEDERPOCKET=4154,C.CAP_AUTOMATICSENSEMEDIUM=4155,C.CAP_CUSTOMINTERFACEGUID=4156,C.ICAP_AUTOBRIGHT=4352,C.ICAP_BRIGHTNESS=4353,C.ICAP_CONTRAST=4355,C.ICAP_CUSTHALFTONE=4356,C.ICAP_EXPOSURETIME=4357,C.ICAP_FILTER=4358,C.ICAP_FLASHUSED=4359,C.ICAP_GAMMA=4360,C.ICAP_HALFTONES=4361,C.ICAP_HIGHLIGHT=4362,C.ICAP_IMAGEFILEFORMAT=4364,C.ICAP_LAMPSTATE=4365,C.ICAP_LIGHTSOURCE=4366,C.ICAP_ORIENTATION=4368,C.ICAP_PHYSICALWIDTH=4369,C.ICAP_PHYSICALHEIGHT=4370,C.ICAP_SHADOW=4371,C.ICAP_FRAMES=4372,C.ICAP_XNATIVERESOLUTION=4374,C.ICAP_YNATIVERESOLUTION=4375,C.ICAP_XRESOLUTION=4376,C.ICAP_YRESOLUTION=4377,C.ICAP_MAXFRAMES=4378,C.ICAP_TILES=4379,C.ICAP_BITORDER=4380,C.ICAP_CCITTKFACTOR=4381,C.ICAP_LIGHTPATH=4382,C.ICAP_PIXELFLAVOR=4383,C.ICAP_PLANARCHUNKY=4384,C.ICAP_ROTATION=4385,C.ICAP_SUPPORTEDSIZES=4386,C.ICAP_THRESHOLD=4387,C.ICAP_XSCALING=4388,C.ICAP_YSCALING=4389,C.ICAP_BITORDERCODES=4390,C.ICAP_PIXELFLAVORCODES=4391,C.ICAP_JPEGPIXELTYPE=4392,C.ICAP_TIMEFILL=4394,C.ICAP_BITDEPTH=4395,C.ICAP_BITDEPTHREDUCTION=4396,C.ICAP_UNDEFINEDIMAGESIZE=4397,C.ICAP_EXTIMAGEINFO=4399,C.ICAP_MINIMUMHEIGHT=4400,C.ICAP_MINIMUMWIDTH=4401,C.ICAP_AUTODISCARDBLANKPAGES=4404,C.ICAP_FLIPROTATION=4406,C.ICAP_BARCODEDETECTIONENABLED=4407,C.ICAP_SUPPORTEDBARCODETYPES=4408,C.ICAP_BARCODEMAXSEARCHPRIORITIES=4409,C.ICAP_BARCODESEARCHPRIORITIES=4410,C.ICAP_BARCODESEARCHMODE=4411,C.ICAP_BARCODEMAXRETRIES=4412,C.ICAP_BARCODETIMEOUT=4413,C.ICAP_ZOOMFACTOR=4414,C.ICAP_PATCHCODEDETECTIONENABLED=4415,C.ICAP_SUPPORTEDPATCHCODETYPES=4416,C.ICAP_PATCHCODEMAXSEARCHPRIORITIES=4417,C.ICAP_PATCHCODESEARCHPRIORITIES=4418,C.ICAP_PATCHCODESEARCHMODE=4419,C.ICAP_PATCHCODEMAXRETRIES=4420,C.ICAP_PATCHCODETIMEOUT=4421,C.ICAP_FLASHUSED2=4422,C.ICAP_IMAGEFILTER=4423,C.ICAP_NOISEFILTER=4424,C.ICAP_OVERSCAN=4425,C.ICAP_AUTOMATICBORDERDETECTION=4432,C.ICAP_AUTOMATICDESKEW=4433,C.ICAP_AUTOMATICROTATE=4434,C.ICAP_JPEGQUALITY=4435,C.ICAP_FEEDERTYPE=4436,C.ICAP_ICCPROFILE=4437,C.ICAP_AUTOSIZE=4438,C.ICAP_AUTOMATICCROPUSESFRAME=4439,C.ICAP_AUTOMATICLENGTHDETECTION=4440,C.ICAP_AUTOMATICCOLORENABLED=4441,C.ICAP_AUTOMATICCOLORNONCOLORPIXELTYPE=4442,C.ICAP_COLORMANAGEMENTENABLED=4443,C.ICAP_IMAGEMERGE=4444,C.ICAP_IMAGEMERGEHEIGHTTHRESHOLD=4445,C.ICAP_SUPPORTEDEXTIMAGEINFO=4446}(bd||(bd={})),function(C){C.TWLG_DAN=0,C.TWLG_DUT=1,C.TWLG_ENG=2,C.TWLG_FCF=3,C.TWLG_FIN=4,C.TWLG_FRN=5,C.TWLG_GER=6,C.TWLG_ICE=7,C.TWLG_ITN=8,C.TWLG_NOR=9,C.TWLG_POR=10,C.TWLG_SPA=11,C.TWLG_SWE=12,C.TWLG_USA=13,C.TWLG_USERLOCALE=-1,C.TWLG_AFRIKAANS=14,C.TWLG_ALBANIA=15,C.TWLG_ARABIC=16,C.TWLG_ARABIC_ALGERIA=17,C.TWLG_ARABIC_BAHRAIN=18,C.TWLG_ARABIC_EGYPT=19,C.TWLG_ARABIC_IRAQ=20,C.TWLG_ARABIC_JORDAN=21,C.TWLG_ARABIC_KUWAIT=22,C.TWLG_ARABIC_LEBANON=23,C.TWLG_ARABIC_LIBYA=24,C.TWLG_ARABIC_MOROCCO=25,C.TWLG_ARABIC_OMAN=26,C.TWLG_ARABIC_QATAR=27,C.TWLG_ARABIC_SAUDIARABIA=28,C.TWLG_ARABIC_SYRIA=29,C.TWLG_ARABIC_TUNISIA=30,C.TWLG_ARABIC_UAE=31,C.TWLG_ARABIC_YEMEN=32,C.TWLG_BASQUE=33,C.TWLG_BYELORUSSIAN=34,C.TWLG_BULGARIAN=35,C.TWLG_CATALAN=36,C.TWLG_CHINESE=37,C.TWLG_CHINESE_HONGKONG=38,C.TWLG_CHINESE_PRC=39,C.TWLG_CHINESE_SINGAPORE=40,C.TWLG_CHINESE_SIMPLIFIED=41,C.TWLG_CHINESE_TAIWAN=42,C.TWLG_CHINESE_TRADITIONAL=43,C.TWLG_CROATIA=44,C.TWLG_CZECH=45,C.TWLG_DANISH=0,C.TWLG_DUTCH=1,C.TWLG_DUTCH_BELGIAN=46,C.TWLG_ENGLISH=2,C.TWLG_ENGLISH_AUSTRALIAN=47,C.TWLG_ENGLISH_CANADIAN=48,C.TWLG_ENGLISH_IRELAND=49,C.TWLG_ENGLISH_NEWZEALAND=50,C.TWLG_ENGLISH_SOUTHAFRICA=51,C.TWLG_ENGLISH_UK=52,C.TWLG_ENGLISH_USA=13,C.TWLG_ESTONIAN=53,C.TWLG_FAEROESE=54,C.TWLG_FARSI=55,C.TWLG_FINNISH=4,C.TWLG_FRENCH=5,C.TWLG_FRENCH_BELGIAN=56,C.TWLG_FRENCH_CANADIAN=3,C.TWLG_FRENCH_LUXEMBOURG=57,C.TWLG_FRENCH_SWISS=58,C.TWLG_GERMAN=6,C.TWLG_GERMAN_AUSTRIAN=59,C.TWLG_GERMAN_LUXEMBOURG=60,C.TWLG_GERMAN_LIECHTENSTEIN=61,C.TWLG_GERMAN_SWISS=62,C.TWLG_GREEK=63,C.TWLG_HEBREW=64,C.TWLG_HUNGARIAN=65,C.TWLG_ICELANDIC=7,C.TWLG_INDONESIAN=66,C.TWLG_ITALIAN=8,C.TWLG_ITALIAN_SWISS=67,C.TWLG_JAPANESE=68,C.TWLG_KOREAN=69,C.TWLG_KOREAN_JOHAB=70,C.TWLG_LATVIAN=71,C.TWLG_LITHUANIAN=72,C.TWLG_NORWEGIAN=9,C.TWLG_NORWEGIAN_BOKMAL=73,C.TWLG_NORWEGIAN_NYNORSK=74,C.TWLG_POLISH=75,C.TWLG_PORTUGUESE=10,C.TWLG_PORTUGUESE_BRAZIL=76,C.TWLG_ROMANIAN=77,C.TWLG_RUSSIAN=78,C.TWLG_SERBIAN_LATIN=79,C.TWLG_SLOVAK=80,C.TWLG_SLOVENIAN=81,C.TWLG_SPANISH=11,C.TWLG_SPANISH_MEXICAN=82,C.TWLG_SPANISH_MODERN=83,C.TWLG_SWEDISH=12,C.TWLG_THAI=84,C.TWLG_TURKISH=85,C.TWLG_UKRANIAN=86,C.TWLG_ASSAMESE=87,C.TWLG_BENGALI=88,C.TWLG_BIHARI=89,C.TWLG_BODO=90,C.TWLG_DOGRI=91,C.TWLG_GUJARATI=92,C.TWLG_HARYANVI=93,C.TWLG_HINDI=94,C.TWLG_KANNADA=95,C.TWLG_KASHMIRI=96,C.TWLG_MALAYALAM=97,C.TWLG_MARATHI=98,C.TWLG_MARWARI=99,C.TWLG_MEGHALAYAN=100,C.TWLG_MIZO=101,C.TWLG_NAGA=102,C.TWLG_ORISSI=103,C.TWLG_PUNJABI=104,C.TWLG_PUSHTU=105,C.TWLG_SERBIAN_CYRILLIC=106,C.TWLG_SIKKIMI=107,C.TWLG_SWEDISH_FINLAND=108,C.TWLG_TAMIL=109,C.TWLG_TELUGU=110,C.TWLG_TRIPURI=111,C.TWLG_URDU=112,C.TWLG_VIETNAMESE=113}(IW||(IW={})),function(C){C.TWSS_NONE=0,C.TWSS_A4LETTER=1,C.TWSS_B5LETTER=2,C.TWSS_USLETTER=3,C.TWSS_USLEGAL=4,C.TWSS_A5=5,C.TWSS_B4=6,C.TWSS_B6=7,C.TWSS_USLEDGER=9,C.TWSS_USEXECUTIVE=10,C.TWSS_A3=11,C.TWSS_B3=12,C.TWSS_A6=13,C.TWSS_C4=14,C.TWSS_C5=15,C.TWSS_C6=16,C.TWSS_4A0=17,C.TWSS_2A0=18,C.TWSS_A0=19,C.TWSS_A1=20,C.TWSS_A2=21,C.TWSS_A4=1,C.TWSS_A7=22,C.TWSS_A8=23,C.TWSS_A9=24,C.TWSS_A10=25,C.TWSS_ISOB0=26,C.TWSS_ISOB1=27,C.TWSS_ISOB2=28,C.TWSS_ISOB3=12,C.TWSS_ISOB4=6,C.TWSS_ISOB5=29,C.TWSS_ISOB6=7,C.TWSS_ISOB7=30,C.TWSS_ISOB8=31,C.TWSS_ISOB9=32,C.TWSS_ISOB10=33,C.TWSS_JISB0=34,C.TWSS_JISB1=35,C.TWSS_JISB2=36,C.TWSS_JISB3=37,C.TWSS_JISB4=38,C.TWSS_JISB5=2,C.TWSS_JISB6=39,C.TWSS_JISB7=40,C.TWSS_JISB8=41,C.TWSS_JISB9=42,C.TWSS_JISB10=43,C.TWSS_C0=44,C.TWSS_C1=45,C.TWSS_C2=46,C.TWSS_C3=47,C.TWSS_C7=48,C.TWSS_C8=49,C.TWSS_C9=50,C.TWSS_C10=51,C.TWSS_USSTATEMENT=52,C.TWSS_BUSINESSCARD=53,C.TWSS_MAXSIZE=54}(EW||(EW={})),function(C){C.TWON_NONE=0,C.TWON_ARRAY=3,C.TWON_ENUMERATION=4,C.TWON_ONEVALUE=5,C.TWON_RANGE=6}(DW||(DW={})),function(C){C.TWTY_INT8=0,C.TWTY_INT16=1,C.TWTY_INT32=2,C.TWTY_UINT8=3,C.TWTY_UINT16=4,C.TWTY_int=5,C.TWTY_BOOL=6,C.TWTY_FIX32=7,C.TWTY_FRAME=8,C.TWTY_STR32=9,C.TWTY_STR64=10,C.TWTY_STR128=11,C.TWTY_STR255=12}(AW||(AW={})),function(C){C.TWFA_NONE=0,C.TWFA_LEFT=1,C.TWFA_CENTER=2,C.TWFA_RIGHT=3}(PW||(PW={})),function(C){C.TWFO_FIRSTPAGEFIRST=0,C.TWFO_LASTPAGEFIRST=1}(RW||(RW={})),function(C){C.TWPR_IMPRINTERTOPBEFORE=0,C.TWPR_IMPRINTERTOPAFTER=1,C.TWPR_IMPRINTERBOTTOMBEFORE=2,C.TWPR_IMPRINTERBOTTOMAFTER=3,C.TWPR_ENDORSERTOPBEFORE=4,C.TWPR_ENDORSERTOPAFTER=5,C.TWPR_ENDORSERBOTTOMBEFORE=6,C.TWPR_ENDORSERBOTTOMAFTER=7}(kW||(kW={})),function(C){C.TWPM_SINGLESTRING=0,C.TWPM_MULTISTRING=1,C.TWPM_COMPOUNDSTRING=2}(MW||(MW={})),function(C){C.TWBR_THRESHOLD=0,C.TWBR_HALFTONE=1,C.TWBR_CUSTHALFTONE=2,C.TWBR_DIFFUSION=3}(OW||(OW={})),function(C){C.TWBO_LSBFIRST=0,C.TWBO_MSBFIRST=1}(FW||(FW={})),function(C){C.TWFT_RED=0,C.TWFT_GREEN=1,C.TWFT_BLUE=2,C.TWFT_NONE=3,C.TWFT_WHITE=4,C.TWFT_CYAN=5,C.TWFT_MAGENTA=6,C.TWFT_YELLOW=7,C.TWFT_BLACK=8}(LW||(LW={})),function(C){C.TWFL_NONE=0,C.TWFL_OFF=1,C.TWFL_ON=2,C.TWFL_AUTO=3,C.TWFL_REDEYE=4}(NW||(NW={})),function(C){C.TWFR_BOOK=0,C.TWFR_FANFOLD=1}(BW||(BW={})),function(C){C.TWIF_NONE=0,C.TWIF_AUTO=1,C.TWIF_LOWPASS=2,C.TWIF_BANDPASS=3,C.TWIF_HIGHPASS=4,C.TWIF_TEXT=3,C.TWIF_FINELINE=4}(WW||(WW={})),function(C){C.TWLP_REFLECTIVE=0,C.TWLP_TRANSMISSIVE=1}(UW||(UW={})),function(C){C.TWLS_RED=0,C.TWLS_GREEN=1,C.TWLS_BLUE=2,C.TWLS_NONE=3,C.TWLS_WHITE=4,C.TWLS_UV=5,C.TWLS_IR=6}(VW||(VW={})),function(C){C.TWNF_NONE=0,C.TWNF_AUTO=1,C.TWNF_LONEPIXEL=2,C.TWNF_MAJORITYRULE=3}(jW||(jW={})),function(C){C.TWOR_ROT0=0,C.TWOR_ROT90=1,C.TWOR_ROT180=2,C.TWOR_ROT270=3,C.TWOR_PORTRAIT=0,C.TWOR_LANDSCAPE=3,C.TWOR_AUTO=4,C.TWOR_AUTOTEXT=5,C.TWOR_AUTOPICTURE=6}(HW||(HW={})),function(C){C.TWOV_NONE=0,C.TWOV_AUTO=1,C.TWOV_TOPBOTTOM=2,C.TWOV_LEFTRIGHT=3,C.TWOV_ALL=4}(GW||(GW={})),function(C){C.TWPF_CHOCOLATE=0,C.TWPF_VANILLA=1}(zW||(zW={})),function(C){C.TWPC_CHUNKY=0,C.TWPC_PLANAR=1}(YW||(YW={})),function(C){C.TWBP_DISABLE=-2,C.TWBP_AUTO=-1}(kfe||(kfe={})),function(C){C.Info=1,C.Error=2,C.NotInstalledError=3}(ng||(ng={})),function(C){C.Binary=0,C.Base64=1}(l3||(l3={})),function(C){C.TWPT_BW=0,C.TWPT_GRAY=1,C.TWPT_RGB=2,C.TWPT_PALLETE=3,C.TWPT_CMY=4,C.TWPT_CMYK=5,C.TWPT_YUV=6,C.TWPT_YUVK=7,C.TWPT_CIEXYZ=8,C.TWPT_LAB=9,C.TWPT_SRGB=10,C.TWPT_SCRGB=11,C.TWPT_INFRARED=16}(XW||(XW={})),function(C){C.TWUN_INCHES=0,C.TWUN_CENTIMETERS=1,C.TWUN_PICAS=2,C.TWUN_POINTS=3,C.TWUN_TWIPS=4,C.TWUN_PIXELS=5,C.TWUN_MILLIMETERS=6}($W||($W={})),H.mix(be.DWT,{EnumDWT_DeviceType:tn,EnumDWT_Cap:bd,EnumDWT_CapLanguage:IW,EnumDWT_CapSupportedSizes:EW,EnumDWT_CapType:DW,EnumDWT_CapValueType:AW,EnumDWT_CapFeederAlignment:PW,EnumDWT_CapFeederOrder:RW,EnumDWT_CapPrinter:kW,EnumDWT_CapPrinterMode:MW,EnumDWT_CapBitdepthReduction:OW,EnumDWT_CapBitOrder:FW,EnumDWT_CapFilterType:LW,EnumDWT_CapFlash:NW,EnumDWT_CapFlipRotation:BW,EnumDWT_CapImageFilter:WW,EnumDWT_CapLightPath:UW,EnumDWT_CapLightSource:VW,EnumDWT_CapNoiseFilter:jW,EnumDWT_CapORientation:HW,EnumDWT_CapOverscan:GW,EnumDWT_CapPixelFlavor:zW,EnumDWT_CapPlanarChunky:YW,EnumDWT_ImageType:Ti,EnumDWT_ImageFormatType:Af,EnumDWT_ResponseType:_u,EnumDWT_SourceMatchField:R0,EnumDWT_UploadDataFormat:l3,EnumDWT_WorkMode:WP,EnumDWT_ConvertMode:mr,EnumDWT_PixelType:XW,EnumDWT_UnitType:$W});var c3,_h,UP,VP,u3,jP,jo=be.DWT;jo.EnumPDF_Page={Page_Default:0,Page_Custom:1,Page_A4:2,Page_A4_Reverse:3,Page_A3:4,Page_A3_Reverse:5,Page_Letter:6,Page_Letter_Reverse:7,Page_Legal:8,Page_Legal_Reverse:9},jo.EnumDWT_BorderStyle={TWBS_NONE:0,TWBS_SINGLEFLAT:1,TWBS_SINGLE3D:2},jo.EnumDWT_MessageType={TWQC_GET:1,TWQC_SET:2,TWQC_GETDEFAULT:4,TWQC_GETCURRENT:8,TWQC_RESET:16},jo.EnumDWT_TransferMode={TWSX_NATIVE:0,TWSX_FILE:1,TWSX_MEMORY:2},jo.EnumDWT_FileFormat={TWFF_TIFF:0,TWFF_PICT:1,TWFF_BMP:2,TWFF_XBM:3,TWFF_JFIF:4,TWFF_FPX:5,TWFF_TIFFMULTI:6,TWFF_PNG:7,TWFF_SPIFF:8,TWFF_EXIF:9,TWFF_PDF:10,TWFF_JP2:11,TWFF_JPN:12,TWFF_JPX:13,TWFF_DEJAVU:14,TWFF_PDFA:15,TWFF_PDFA2:16},jo.EnumDWT_TIFFCompressionType={TIFF_AUTO:0,TIFF_NONE:1,TIFF_RLE:2,TIFF_FAX3:3,TIFF_T4:3,TIFF_FAX4:4,TIFF_T6:4,TIFF_LZW:5,TIFF_JPEG:7,TIFF_PACKBITS:32773},jo.EnumDWT_InterpolationMethod={IM_NEARESTNEIGHBOUR:1,IM_BILINEAR:2,IM_BICUBIC:3,IM_BESTQUALITY:5},jo.EnumDWT_PDFCompressionType={PDF_AUTO:0,PDF_FAX3:1,PDF_FAX4:2,PDF_LZW:3,PDF_RLE:4,PDF_JPEG:5,PDF_JP2000:6,PDF_JBIG2:7},jo.EnumDWT_ShowMode={SW_ACTIVE:0,SW_MAX:1,SW_MIN:2,SW_CLOSE:3,SW_IFLIVE:4},jo.EnumDWT_DUPLEX={TWDX_NONE:0,TWDX_1PASSDUPLEX:1,TWDX_2PASSDUPLEX:2},jo.EnumDWT_MagType={TWMD_MICR:0,TWMD_RAW:1,TWMD_INVALID:2},jo.EnumDWT_DataSourceStatus={TWDSS_CLOSED:0,TWDSS_OPENED:1,TWDSS_ENABLED:2,TWDSS_ACQUIRING:3},function(C){C.enumFitWindow=0,C.enumFitWindowHeight=1,C.enumFitWindowWidth=2}(c3||(c3={})),jo.EnumDWT_FitWindowType={enumFitWindow:c3.enumFitWindow,enumFitWindowHeight:c3.enumFitWindowHeight,enumFitWindowWidth:c3.enumFitWindowWidth},jo.EnumDWT_PlatformType={enumUnknown:Rn.enumUnknown,enumWindow:Rn.enumWindow,enumMac:Rn.enumMac,enumLinux:Rn.enumLinux,enumEmbed:Rn.enumEmbed,enumChromeOS:Rn.enumChromeOS,enumHarmonyOS:Rn.enumHarmonyOS,enumAndroid:Rn.enumAndroid,enumiOS:Rn.enumiOS},function(C){C.Default=0,C.Hand=1,C.Crosshair=2,C.Zoom=3,C.NWResize=4,C.EResize=5,C.NResize=6,C.Resize=7,C.Move=8}(_h||(_h={})),jo.EnumDWT_MouseShape={Default:_h.Default,Hand:_h.Hand,Crosshair:_h.Crosshair,Zoom:_h.Zoom,NWResize:_h.NWResize,EResize:_h.EResize,NResize:_h.NResize,Resize:_h.Resize,Move:_h.Move},jo.EnumDWT_Language={English:0,French:1,Arabic:2,Spanish:3,Portuguese:4,German:5,Italian:6,Russian:7,Chinese:8},jo.EnumDWT_InitMsg={Info:ng.Info,Error:ng.Error,NotInstalledError:ng.NotInstalledError},jo.EnumDWT_Driver={TWAIN:Mi.TWAIN,ICA:Mi.ICA,SANE:Mi.SANE,TWAIN_AND_ICA:Mi.TWAIN_AND_ICA,TWAIN_AND_TWAIN64:Mi.TWAIN_AND_TWAIN64,TWAIN64:Mi.TWAIN64},jo.EnumDWT_CompressionType={TWCP_NONE:0,TWCP_PACKBITS:1,TWCP_GROUP31D:2,TWCP_GROUP31DEOL:3,TWCP_GROUP32D:4,TWCP_GROUP4:5,TWCP_JPEG:6,TWCP_LZW:7,TWCP_JBIG:8,TWCP_PNG:9,TWCP_RLE4:10,TWCP_RLE8:11,TWCP_BITFIELDS:12,TWCP_ZIP:13,TWCP_JPEG2000:14},function(C){C.Single=0,C.Multiple=1}(UP||(UP={})),jo.EnumDWT_SelectionMode={Single:UP.Single,Multiple:UP.Multiple},jo.EnumDWT_ConfirmExitType={Cancel:0,Exit:1,SaveAndExit:2},jo.EnumDWT_WebsocketReadyState={CONNECTING:dd.CONNECTING,OPEN:dd.OPEN,CLOSING:dd.CLOSING,CLOSED:dd.CLOSED},function(C){C.TwainService=1}(VP||(VP={})),jo.EnumDWT_ServiceType={TwainService:VP.TwainService},function(C){C.default=0,C.standard=1,C.supported=2}(u3||(u3={})),jo.EnumDWT_ExtImageInfo={default:u3.default,standard:u3.standard,supported:u3.supported};var HP=20230506,KW=function(){if(be.dcp){var C=be.dcp.dcpJSVer;if(H.isNumber(C))return C>=HP}return!1};if(KW())KW=jP,HP=jP;else{var ss=$n.detect,IC={_checkService:function(C,x){ss.dcpStatus=ss.EnumDCP_DetectStatus.CheckingServiceVer,JW(null,"DSVersion").then(C,x)},_checkUpdateFile:function(C,x){JW(null,"CheckUpdateFile").then(C,x)},_updateService:function(C,x){JW(null,"UpdateService").then(C,x)},_getDSUpdateZipUrl:function(){var C,x,S="";return C="Win",he.bMac?C="Mac":he.bLinux&&(C="Linux"),x=he.bFileSystem?"":"?t="+H.now(),he.bWin&&$n.b64bit&&(S="_x64"),[be.DWT.ResourcesPath,"/dist/serviceupdate/",C,"DSUpdate_",Ele().join("."),S,".zip",x].join("")},getPorts:function(C,x){var S="GetPorts",T="dwasm2_"+q1();return Ofe(C,S,{id:H.guid(),method:S,version:T,parameter:[x]},AS)},_getStatusString:function(C,x){var S,T,D="";return C==ss.EnumDCP_DetectStatus.Init?"Getting manager version":C==ss.EnumDCP_DetectStatus.Connected?(x&&(D=x),"Getting manager version succeeded and the version is "+D):C==ss.EnumDCP_DetectStatus.CheckingManagerVer?"Getting manager version":C==ss.EnumDCP_DetectStatus.CheckingServiceVer?"Getting service version":C==ss.EnumDCP_DetectStatus.NotInstalled?"Dynamsoft Service Not Installed":C==ss.EnumDCP_DetectStatus.UpdateSkipped?"Update skipped":C==ss.EnumDCP_DetectStatus.CheckedService?(x&&(D=x),"Getting service version succeeded and the version is "+D):C==ss.EnumDCP_DetectStatus.VerifyingZip?"Verifying the update package":C==ss.EnumDCP_DetectStatus.VerifiedZip?"Update package verified":C==ss.EnumDCP_DetectStatus.UpdatingService?"Updating the service":C==ss.EnumDCP_DetectStatus.UpdateSucceed?"Update succeeded":C==ss.EnumDCP_DetectStatus.UpdateFailed?(T=".",x&&x.length>0?("."==x.slice(x.length-1)&&(T=""),S=" with the error: "+x):S="","The update failed"+S+T):""},_sendStatusEvent:function(C,x){var S=!!C,T=window;H.isFunction(T.OnGetServiceUpdateStatus)&&T.OnGetServiceUpdateStatus(S,ss.dcpStatus,IC._getStatusString(ss.dcpStatus,x))},_getErr:function(C){var x,S="";try{H.isString(C)?(x=C.replace(/\0/g,""),x=H.parse(x)):C&&(x=C),"description"in x&&(S=x.description)}catch(T){}return S},_funShowUpgradeDialogWhenUpdateFailed:function(C,x){return ss.bConnected=!0,ss.dcpStatus=ss.EnumDCP_DetectStatus.UpdateFailed,C&&C(),x&&x(),IC._sendStatusEvent(!0),!0},_funUpdateFailed:function(C,x,S,T){var D,R;return ss.bConnected=!0,ss.dcpStatus=ss.EnumDCP_DetectStatus.UpdateFailed,C&&C(),200==T?(D="The update failed.",R=IC._getStatusString(ss.dcpStatus,IC._getErr(S))):R=D="The update failed. The error code is "+T,x&&x(!0,D),IC._sendStatusEvent(!0,R),!0},getDSPath:function(C,x){return ql.getDSPath(x)},getLinuxHTML5DebPath:function(){return ql.getDSPath(".deb")},getLinuxHTML5RpmPath:function(){return ql.getDSPath(".rpm")},getBinaryFileInfo:function(C,x){var S="GetBinaryFileInfo",T={id:H.guid(),method:S,version:"dwasm2_"+q1(),parameter:[]},D=H.stringify(T),R=function(U,G,X){var z;U&&(z=H.parse(U)),z?C(z):x(U,G,X)};if(be.DWT.ConnectWithSocket&&he.bHTML5Edition){var P=Kp.getWsUrl(be.DWT.Host,he.bSSL?$n.SSLPort:$n.Port);return Kp.postStringDataByWSUrl(P,D).then(R,x),!0}var O=[WA(),"/",S,"?type=1&dsver=",eB().join(""),"&ts=",H.now()].join("");Gp.getHttpClientForDcp().request(D,O,{},500).then(R,x)}};H.mix($n,IC),be.dcp=$n,be.dcp.dcpJSVer=HP,KW=jP,HP=jP}function JW(C,x,S,T){var D;return D={id:H.guid(),method:x,version:"dwasm2_"+q1(),parameter:[]},"VersionInfo"==x&&(D.version="dwasm2_"+xo.getVersionStrForCheck()),mn.isLongKey(S)&&(D.productKey=S),Ofe(C,x,D,AS,T)}function Ofe(C,x,S,T,D){return QW.apply(this,arguments)}function QW(){return QW=_t(B.mark(function C(x,S,T,D,R){var P,O,U,G,z,K,oe,ae;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return P=H.stringify(T),$n.detect.bConnected=!1,O=[WA(),"/",S,"?type=1&dsver=",eB().join(""),"&ts=",H.now()].join(""),U=Gp.getHttpClient(x,(G=he.bSSL)?$n.SSLPort:$n.Port,G),z={},R&&!he.bSSL&&(z.redirect="manual"),ue.prev=8,ue.next=11,U.request(P,O,z,D);case 11:K=ue.sent,ue.next=21;break;case 14:if(ue.prev=14,ue.t0=ue.catch(8),!R||he.bSSL){ue.next=20;break}if((ue.t0&&ue.t0.code)!=Xn.HTTPRedirected){ue.next=20;break}throw Qle();case 20:throw ue.t0;case 21:if(K&&(oe=H.parse(K)),!(oe&&"exception"in oe&&"description"in oe)){ue.next=24;break}throw{code:oe.exception,message:oe.description};case 24:if(!oe||!("result"in oe)){ue.next=30;break}if(!$n.detect.bConnected){ue.next=27;break}return ue.abrupt("return",oe.result);case 27:return $n.detect.bConnected=!0,$n.detect.dcpStatus=$n.detect.EnumDCP_DetectStatus.Connected,ue.abrupt("return",oe.result);case 30:throw Jl(ae={}),Zi(ae);case 33:case"end":return ue.stop()}},C,null,[[8,14]])})),QW.apply(this,arguments)}function Ffe(C){var x=Date.parse(C+"T00:00:00");return""!=C&&!isNaN(x)&&!!be.DWT.CheckCertExpired&&(new Date).getTime()>=x-864e5*be.DWT.CertificateConfig.UpdateDaysBeforeExpired}be.DWT.__innerCheckCertDate=function(C){Ffe(C)&&(H.isFunction(be.OnCertExpired)&&be.OnCertExpired(C),setTimeout(function(){be.DWT.UpdateCert(be.DWT.CertificateConfig.URL,be.OnUpdateCertSuccess,be.OnUpdateCertFailure)},5e3))},be.DWT.__innerUpdateCert=function(C,x,S,T){var D=[WA(),"/LoadZipFromBytes?type=",4,"&dsver=",eB().join(""),"&ts=",H.now()].join("");Gp.getHttpClientForDcp(null,x).request(C,D,{},3e4).then(S,function(R){H.isFunction(T)&&T(R)})},be.DWT.__innerReboot=function(C,x){var S=[WA(),"/admin?ts=",H.now()].join(""),T='{"id":"'+(new Date).getTime().toString()+'","method":"Reboot","parameter":[],"version":"dwasm2_'+q1()+'"}';Gp.getHttpClientForDcp().request(T,S,{},3e4).then(C,x)},be.DWT.UpdateCert=function(C,x,S){H.isString(C)&&""!=C?nC(C,{mode:"cors",dataType:"arraybuffer"}).then(function(T){be.DWT.__innerUpdateCert(T,!1,function(D){var R;try{var P=me.parse(D);P.description&&(R={code:P.exception,message:P.description})}catch(U){var O;Jl(O={}),O=Zi(O)}R?me.isFunction(S)&&S(R):(be.DWT.CheckCertExpired=!1,H.isFunction(x)&&x())},function(D){he.bSSL?be.DWT.__innerUpdateCert(T,!0,x,S):H.isFunction(S)&&S(D)})},S):H.isFunction(S)&&S()};var ZW={Errors:{FilePathSyntaxIncorrect:function(C){C._errorCode=-3123,C._errorString="The filename, directory name, or volume label syntax is incorrect."}},checkFilePath:function(C,x){return H.isString(x)&&0!=x.length?H.startsWith(x,"http://")||H.startsWith(x,"https://")||H.startsWith(x,"ftp://")?(me.File.Errors.FilePathSyntaxIncorrect(C),yt):Nt:(S0(C),yt)}};ZW.checkFolder=ZW.checkFilePath,me.File=ZW,me.showProgress=function(){},me.closeProgress=function(){};var d3,Rqe=document.location.protocol,kqe=location.hostname,Lfe=he.bSSL;function Nfe(){var C=tB;if(be.DWT.CertificateConfig){var x=be.DWT.CertificateConfig;H.isString(x.URL)||(x.URL=C.URL),(!H.isNumber(x.UpdateDaysBeforeExpired)||x.UpdateDaysBeforeExpired<=0)&&(x.UpdateDaysBeforeExpired=C.UpdateDaysBeforeExpired)}else be.DWT.CertificateConfig=C;(function Dqe(){var C;Rfe&&(Os=H.mix({},kf),be.DWT&&(C=be.DWT.CustomizableDisplayInfo),C&&(C.errorMessages&&H.mix(Os.errorMessages,C.errorMessages),C.generalMessages&&H.mix(Os.generalMessages,C.generalMessages),C.customProgressText&&H.mix(Os.customProgressText,C.customProgressText),C.buttons&&(C.buttons.titles&&H.mix(Os.buttons.titles,C.buttons.titles),C.buttons.bShowAllButtons&&H.mix(Os.buttons.bShowAllButtons,C.buttons.bShowAllButtons),C.buttons.visibility&&H.mix(Os.buttons.visibility,C.buttons.visibility)),C.dialogText&&H.mix(Os.dialogText,C.dialogText)),Pfe(),Rfe=!1)})(),H.isString(be.DWT.ProductKey)&&(be.DWT.ProductKey=H.trim(be.DWT.ProductKey)),be.navInfo&&(he.bMac||he.bWin)&&(be.navInfo.bEmbed=!1,be.navInfo.bArm64=!1,be.navInfo.bMips64=!1),be.DWT.Debug&&(H.debug=!0)}function Bfe(){return eU.apply(this,arguments)}function eU(){return eU=_t(B.mark(function C(){var x,S,T;return B.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!me.detect.cssLoaded){D.next=2;break}return D.abrupt("return",me.Promise.resolve());case 2:if(S="",he.bFileSystem||(S=me.timestamp),T=[[x=be.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",S].join("")],Tt.bHTML5Edition&&be.DWT.UseDefaultViewer&&T.push([x,"/src/dynamsoft.webtwain.viewer.css",S].join("")),!Tt.bHTML5Edition||he.bFileSystem){D.next=9;break}return D.next=9,Oqe(T);case 9:return D.abrupt("return",new me.Promise(function(R,P){var O=!0;he.bSafari?(H.addAllCss(T,!1,function(U){U||O&&(P({code:-2804,message:"Loading the WebTwain css files failed."}),O=!1)}),me.detect.cssLoaded=Nt,R()):H.addAllCss(T,!1,function(U){if(U)return me.detect.cssLoaded=Nt,void R();O&&(O=!1,P({code:-2804,message:"Loading the WebTwain css files failed."}))})}));case 10:case"end":return D.stop()}},C)})),eU.apply(this,arguments)}function Oqe(C){return tU.apply(this,arguments)}function tU(){return tU=_t(B.mark(function C(x){var S,T;return B.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:S=!0,D.prev=1,T=0,T=0;case 4:if(!(T<x.length)){D.next=15;break}return D.next=7,me.fetch(x[T]);case 7:if(!(D.sent.indexOf("* Author: Dynamsoft Support Team")>0)){D.next=10;break}return D.abrupt("continue",12);case 10:return S=!1,D.abrupt("break",15);case 12:T++,D.next=4;break;case 15:D.next=20;break;case 17:D.prev=17,D.t0=D.catch(1),S=!1;case 20:if(S){D.next=22;break}throw{code:-2804,message:"Loading the WebTwain css files failed."};case 22:return D.abrupt("return",S);case 23:case"end":return D.stop()}},C,null,[[1,17]])})),tU.apply(this,arguments)}function Wfe(){if(Tt.loadResourcePath||!Tt.loadingResourcePath)return d3&&d3(),void(d3=null);setTimeout(Wfe,100)}function EC(C){if(lo("Loading css..."),Nfe(),Tt.loadResourcePath||Tt.loadingResourcePath)return Tt.loadResourcePath?Bfe():Tt.loadResourcePath||!Tt.loadingResourcePath?me.Promise.resolve():(d3=null,new me.Promise(function(O){d3=O,setTimeout(Wfe,100)}));Tt.loadingResourcePath=!0,(be.DWT.Port>0||be.DWT.SSLPort>0)&&(me.detect.ports=[{port:be.DWT.Port,ssl:!1},{port:be.DWT.SSLPort,ssl:!0}],fd.removeItem("DWT_port"),fd.removeItem("DWT_ssl")),H.each(me._funsAfterConfigLoaded,function(O){try{H.isFunction(O)&&O()}catch(U){}});var x=H.sizzle(".dynamsoft_waiting");if(x&&x.length>0){var S=x[0];S.parentNode&&S.parentNode.removeChild(S)}var T=be.DWT.ResourcesPath,D="";he.bFileSystem||(D=me.timestamp);var R=Nt,P=[];return he.bSafari&&(R=yt),P.push([T,"/dynamsoft.webtwain.install.js",D].join("")),be.DWT.bNpm&&(P=[]),Tt.bHTML5Edition&&be.DWT.UseDefaultViewer&&(lo("Loading the viewer script..."),P.push([T,"/src/dynamsoft.webtwain.viewer.js",D].join(""))),be.DWT.bChromeExtension&&(P=[]),Bfe().then(function(){return 0==P.length?(Ufe(),Tt.loadResourcePath=!0,void(Tt.loadingResourcePath=!1)):new me.Promise(function(O,U){H.addScripts(P,R,!1,function(G){var X=G;if(Tt.bHTML5Edition&&be.DWT.UseDefaultViewer&&!H.isFunction(be.DWTViewer)&&(X=!1),he.bIE&&Tt.bActiveXEdition&&(H.isFunction(be.DWT._innerLoad)||(X=!1)),!X)return Tt.loadingResourcePath=!1,void U({code:-2803,message:"Loading the WebTwain JavaScript source files failed."});Ufe(),Tt.loadResourcePath=!0,Tt.loadingResourcePath=!1,be.DWT.OnWebTwainWillInit&&be.DWT.OnWebTwainWillInit(),O()})})})}function Ufe(){if(!me.bNode&&!he.bJSDom&&H.isArray(be.aryAddonReadyFun)){for(var C=0,x=function(){var S=be.aryAddonReadyFun[C];if(H.isFunction(S))try{S(me)}catch(T){H.log(T.stack||T,"error"),setTimeout(function(){throw T},0)}};C<be.aryAddonReadyFun.length;C++)x();be.aryAddonReadyFun=[]}}H.mix(me,{detect:{ssl:Lfe,dcpStatus:0,dcpCallbackType:0,arySTwains:[],bFirst:Nt,bOK:yt,__dialog:yt,cssLoaded:yt,viewerScriptLoaded:yt,bNoControlEvent:yt,bNeedUpgradeEvent:yt,bPromptJSOrServerOutdated:yt,detectType:Lfe?1:"http:"===Rqe||""===kqe?0:-1,tryTimes:0,ports:[{port:be.DWT.SSLPort,ssl:Nt},{port:be.DWT.Port,ssl:yt}],cUrlIndex:0,urls:[],onNoControl:yt,needUpgrade:yt,OnDetectNext:yt,OnCreatWS:yt,bMaskShow:yt},page:{bUnload:yt}}),me.Addon_Events=[],me.Addon_Sendback_Events=[];var h3=[],f3=[];function nU(){var C,x=h3.length;for(C=0;C<x;C++)h3[C]();h3.splice(0),f3.splice(0),p3=0}function Vfe(){if(p3>0&&(new Date).getTime()-p3>iU){var C,x={code:-2802,message:"The file dynamsoft.webtwain.config.js timed out while loading."},S=be.DWT.Containers;S&&0!==S.length||(Yle(C={}),x={code:C._errorCode,message:C._errorString}),function(G){var X,z=f3.length;for(X=0;X<z;X++)f3[X](G);h3.splice(0),f3.splice(0),p3=0}(x)}else if(be.DWT.Containers||be.DWT.ProductKey||be.DWT.licenseServer||be.DWT.organizationID||be.DWT.handshakeCode||be.DWT.bNpm||0==be.DWT.AutoLoad){if(Tt.dwtConfigLoading)return;if(Tt.dwtConfigLoaded)return void nU();Tt.dwtConfigLoading=!0;var T=he.bFileSystem,D=Po.basePath,R=be.DWT.ResourcesPath,P="";if(H.isArray(be.DWT.Containers)||(be.DWT.Containers=[]),!T&&(void 0!==R&&""!=R||(R=D),R.length>0&&"/"==R.charAt(R.length-1)&&(R=R.substr(0,R.length-1)),P=me.timestamp,be.DWT.ResourcesPath=R),he.bIE){var O=he.IEVersion;if((""===O||O>=10)&&be.DWT.IfUseActiveXForIE10Plus){he.bHTML5Edition=false,Tt.bHTML5Edition=false,Tt.bActiveXEdition=!0,Tt.bChromeEdition=Tt.bHTML5Edition}}Tt.bActiveXEdition?H.addScript([R,"/src/dynamsoft.webtwain.activex.js",P].join(""),!0,!1,function(){Tt.dwtConfigLoaded=!0,Tt.dwtConfigLoading=!1,nU()}):(Tt.dwtConfigLoaded=!0,Tt.dwtConfigLoading=!1,nU())}else setTimeout(Vfe,100)}var jfe,iU=3e3,p3=0;function GP(C){return lo("Loading the config script..."),Tt.dwtConfigLoaded?me.Promise.resolve():(C&&(iU=1e3*parseInt(C))<1&&(iU=1),new me.Promise(function(x,S){h3.push(x),f3.push(S),rC(function(){p3=(new Date).getTime(),setTimeout(Vfe,100)})}))}function Hfe(){var C;(C=be.DWT.WebTwainIdMap)&&H.each(C,function(x,S){x&&x._OnPageBlur&&x._OnPageBlur()})}if(Tt.bActiveXEdition){var Gfe=function(){var C,x,S,T,D;if(be.DWT.lunload(),me.closeAll&&me.closeAll(),T=be.DWT.ContainerMap)for(D=Object.keys(T),C=0;C<D.length;C++)(S=D[C])&&S in T&&(x=T[S])&&(x.__unload(),delete T[S]);if(T=be.DWT.WebTwainIdMap)for(D=Object.keys(T),C=0;C<D.length;C++)(S=D[C])&&S in T&&(x=T[S])&&(x.__unload(),delete T[S]);for(C=0;C<me.product.unloadQueue.length;C++){var R=me.product.unloadQueue[C];me.isFunction(R)&&R()}return me.product.unloadQueue.splice(0),me.detect.arySTwains.splice(0),me.Promise.resolve()};be.DWT.Unload=function(){Gfe();try{be.DWT.CloseDialog(),me._zdgb_xkz_dhk(),me.closeProgress(null,""),me.hideMask()}catch(C){}},be.DWT.Load=function(){if(!me.product.bDWTLoading)return me.product.bDWTLoading=!0,me.detect.axAutoLoadDone=!1,GP().then(EC).then(Gfe).then(function(){return be.DWT._innerLoad()}).then(function(){me.product.bDWTLoading=!1,me.detect.axAutoLoadDone=!0},function(C){me.product.bDWTLoading=!1,me.detect.axAutoLoadDone=!1,oP(C)})},be.DWT.ConnectToTheService=be.DWT.Load,be.DWT.CheckConnectToTheService=function(C,x,S,T){me.product.bActiveXEdition?me.isFunction(T)&&T():me.isFunction(S)&&S()},be.DWT.CreateDWTObject=function(C,x,S,T,D,R){return me._safePromptCustomMsg(function(){R&&R("Error: This browser is currently not supported.")}),!1},be.DWT.CreateDWTObjectEx=function(C,x,S){return me._safePromptCustomMsg(function(){S&&S("Error: This browser is currently not supported.")}),!1},be.DWT.CreateRemoteScanObjectAsync=function(){var C={};return St(C,-2433,"The ActiveX edition does not support this method or property."),me.Promise.reject({code:C._errorCode,message:C._errorString})},be.DWT.DeleteDWTObject=function(C){return!1}}function oU(){return!(function(C){if(H.isString(C)){if("localhost"==C||"127.0.0.1"==C)return!0;var x=C.split(".");if(4==x.length&&/^(([1-9]?\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}([1-9]?\d|1\d{2}|2[0-4]\d|25[0-5])$/.test(C)){var S=parseInt(x[0]),T=parseInt(x[1]);if(127==S||10==S||169==S&&254==T||172==S&&T>=16&&T<=31||192==S&&168==T)return!0}}return!1}(location.hostname)||he.bSSL||he.bFileSystem||!((he.bChrome||he.bEdge)&&parseInt(he.strBrowserVersion)>=94))}function zfe(C,x,S,T){return sU.apply(this,arguments)}function sU(){return sU=_t(B.mark(function C(x,S,T,D){var R,P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(S!=Zr.GET_TASKID){O.next=4;break}return O.abrupt("return",D.taskId);case 4:if(S!=Zr.ONMESSAGE_PROCESS_DATA){O.next=8;break}return O.abrupt("return",H.parse(x));case 8:if(S!=Zr.ONMESSAGE_GET_TASKID){O.next=13;break}if(!D||!D.client){O.next=11;break}return O.abrupt("return",D.client.getRequestTaskId());case 11:O.next=20;break;case 13:if(S!=Zr.HANDLE_RAW_MESSAGE){O.next=20;break}if(R=null==D?void 0:D.userData){O.next=17;break}return O.abrupt("return",!1);case 17:return(P=x).indexOf("Version not found")>=0||P.indexOf("Function not found")>=0?H.isFunction(R.fFun)&&R.fFun():H.isFunction(R.sFun)&&R.sFun(P),O.abrupt("return",P);case 20:case"end":return O.stop()}},C)})),sU.apply(this,arguments)}function Yfe(){Tt.loadResourcePath?(lo(Pce),jfe()):setTimeout(Yfe,100)}function zP(){return Tt.loadResourcePath?(lo(Pce),me.Promise.resolve()):new me.Promise(function(C,x){jfe=C,setTimeout(Yfe,100)})}function Xfe(C){var x,S,T=C.WebTwainId,D=C.Host,R=C.Port,P=C.SSLPort;return(S={}).id=H.isString(T)&&""!==T?T:T=lue(),H.isDOM(C.Container)?(H.isString((x=C.Container).id)&&""!==x.id||(x.id=["dwt_node_",H.getRandom()].join("")),S.container=x,S.bNoViewer=!1):S.bNoViewer=!0,S.bNoViewer?(S.width=0,S.height=0):(S.width=H.isUndefined(C.Width)?x.style.width?x.style.width:300:C.Width,S.height=H.isUndefined(C.Height)?x.style.height?x.style.height:300:C.Height),S.dmService=C.dmService,H.isString(D)&&""!=D||(D=Ja()),S.host=D,R||(R=be.DWT.Port),S.port=R,P||(P=be.DWT.SSLPort),S.sslPort=P,S}function $fe(C,x,S){if(C){var T=null!=x?x:270,D=null!=S?S:350;T<=0&&(T=270),D<=0&&(D=350),pt.one(C).before(me.install._strNonInstallDIV);var R=H.get(me.install._divDWTNonInstallContainerID);R&&(R.style.width=T,R.style.height=D),H.show(me.install._divDWTNonInstallContainerID)}}function ig(C){var x=ql.getDSPath();if(""!=me.install._divDWTemessageContainer&&H.hide(me.install._divDWTemessageContainer),he.bMac)C?H.isFunction(be.OnWebTwainNeedUpgradeCallback)&&be.OnWebTwainNeedUpgradeCallback(Tt.name,{default:x},Tt.bHTML5Edition,Rn.enumMac,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion):H.isFunction(be.OnWebTwainNotFoundOnMacCallback)&&be.OnWebTwainNotFoundOnMacCallback(Tt.name,x,Tt.bHTML5Edition,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion);else if(he.bLinux||be.navInfo.bEmbed||he.bChromeOS||Po.bMobile){var S,T,D=ql.getEnumPlatform();if(be.navInfo.bEmbed||he.bAndroid||he.bChromeOS||he.bHarmonyOS?S=x:(S=ql.getLinuxHTML5DebPath(),T=ql.getLinuxHTML5RpmPath()),C){if(he.bAndroid)H.isFunction(be.OnWebTwainNeedUpgradeOnAndroidCallback)&&be.OnWebTwainNeedUpgradeOnAndroidCallback(Tt.name,x,me.detect.ssl);else if(H.isFunction(be.OnWebTwainNeedUpgradeCallback)){var R={default:S};he.bLinux&&(R.deb=S,R.rpm=T),be.OnWebTwainNeedUpgradeCallback(Tt.name,R,Tt.bHTML5Edition,D,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion)}}else he.bAndroid?H.isFunction(be.OnWebTwainNotFoundOnAndroidCallback)&&be.OnWebTwainNotFoundOnAndroidCallback(Tt.name,x,me.detect.ssl,!1):H.isFunction(be.OnWebTwainNotFoundOnLinuxCallback)&&be.OnWebTwainNotFoundOnLinuxCallback(Tt.name,S,T,Tt.bHTML5Edition,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion,D)}else(he.bChrome||he.bSafari||he.bFirefox||he.bOpera||be.DWT.IfUseActiveXForIE10Plus==fe||!be.DWT.ActiveXInstallWithCAB&&he.bIE)&&(C?H.isFunction(be.OnWebTwainNeedUpgradeCallback)&&be.OnWebTwainNeedUpgradeCallback(Tt.name,{default:x},Tt.bHTML5Edition,Rn.enumWindow,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion):H.isFunction(be.OnWebTwainNotFoundOnWindowsCallback)&&be.OnWebTwainNotFoundOnWindowsCallback(Tt.name,x,Tt.bHTML5Edition,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion))}be.DWT.GetWebTwain=be.DWT.GetWebTwainEx=function(C){var x=C,S=be.DWT.WebTwainIdMap;if(!x){var T=Object.keys(S);return T.length>0?S[x=T[0]]:void 0}if(x in S)return S[x];var D=be.DWT.ContainerMap;return x in D?D[x]:void 0},be.DWT.NeedCheckWebTwainBySocket=oU,be.DWT.CheckWebTwainBySocket=function(C,x,S){var T,D,R,U,G,X,z,K,oe,ae,ue,ye,Ie,P=me.detect.urls;if(P&&P.length>0){var O=P[0];T=O.host||Ja(),D=O.port,R=O.ssl}else bc(T=Ja())?(R=!(!he.bSSL||!he.bSafari),T=xo.hostForCheckCert):R=he.bSSL,D=R?be.DWT.SSLPort:be.DWT.Port;U=Gp.getWsClient(T,D,R,!0),G=C,X=x,z=S,oe=H.now(),ue={id:ae=H.guid(),method:"VersionInfo",version:[Tt.getDWTPrefix(),xo.getVersionStrForCheck()].join("")},ye=zfe,Ie=oB,K={client:U,userData:{cmdId:ae,cmd:null,sFun:G,fFun:X,rawData:!0},taskId:oe},U.setRetry(0),U.request(H.stringify(ue),ye,K,Ie).then(function(Ue){return U.dispose(),Ue},function(){H.isFunction(z)&&z(),U.dispose()})},be.DWT.IsLocalServiceConnected=function(){return new me.Promise(function(C,x){var S,T=Ja();H.each(me.detect.ports,function(D){he.bSSL?D.ssl&&(S=D.port):D.ssl||(S=D.port)}),be.DWT.CheckConnectToTheService(T,S,function(D,R,P){C(!0)},function(){x(!1)})})},me.detect.onNoControl=function(C,x,S,T){T&&T._bRemoteMode&&!T._bNotShowMessage?H.isFunction(be.OnRemoteWebTwainNotFoundCallback)&&be.OnRemoteWebTwainNotFoundCallback(Tt.name,T._serverInfo.server,T._serverInfo.port,T._serverInfo.ssl,Po.bMobile):($fe(C,x,S),ig(!1))};var qfe,Kfe=!1;function Nqe(C,x){bc(C)&&(fd.item("DWT_port",x),fd.item("DWT_ssl",he.bSSL?"true":"false"))}function aU(C,x,S,T,D){return Jfe.apply(this,arguments)}function Jfe(){return(Jfe=_t(B.mark(function C(x,S,T,D,R){var O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge,Se,de,ge,_e,ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(be.DWT.OnWebTwainInitMessage&&be.DWT.OnWebTwainInitMessage("Checking WebTwain version ...",ng.Info),U=!1,G=!1,X=!1,z=be.DWT.ConnectWithSocket,R&&(R.bRemoteServer&&(X=!0),R.bConnectWithSocket&&(z=!0),R.bCheckCert&&(G=!0)),K=H.now(),oe=['{"id":"',H.guid(),'","method":"VersionInfo","version":"',Tt.getDWTPrefix(),xo.getVersionStrForCheck(),'"}'].join(""),ae=!z&&!he.bSSL,ze.prev=6,!z){ze.next=18;break}return ye=H.now(),Ie=zfe,Ue={client:ue,userData:{cmdId:ye,cmd:null,sFun:null,fFun:null,rawData:!0},taskId:ye},(ue=Gp.getWsClient(x,S,T)).setRetry(0),ze.next=14,ue.request(oe,Ie,Ue,D);case 14:O=ze.sent,U=!0,ze.next=25;break;case 18:return He="fa/VersionInfo?v=1&ts="+K,Re=Gp.getHttpClient(x,S,T),Oe={},ae&&(Oe.redirect="manual"),ze.next=24,Re.request(oe,He,Oe,D);case 24:O=ze.sent;case 25:ze.next=43;break;case 27:if(ze.prev=27,ze.t0=ze.catch(6),H.log(["check DWT Version failed",H.stringify(ze.t0)]),!U){ze.next=33;break}ze.next=43;break;case 33:if(!ae){ze.next=37;break}if((ze.t0&&ze.t0.code)!=Xn.HTTPRedirected){ze.next=37;break}throw Qle();case 37:throw OS(Ge={}),be.DWT.OnWebTwainInitMessage&&be.DWT.OnWebTwainInitMessage(Ge._errorString,ng.Error),{code:Ge._errorCode,message:Ge._errorString};case 43:if(Se="",de="",ge={},_e=!1,O&&(ve=H.parse(O)),!ve||!("exception"in ve)){ze.next=50;break}wc(ve)?(ge._errorCode=ve.exception,ge._errorString=ve.description):ge._errorCode=Xn.CommonError,ze.next=92;break;case 50:if(!ve||!("result"in ve)){ze.next=91;break}if(!(H.isArray(ve=ve.result)&&ve.length>0)){ze.next=88;break}if(Te=ve[0],We=ve.length>2?ve[2]:0,Ye=ve.length>3?ve[3]:"",de=ve.length>4?ve[4]:"",""!==(Se=ve.length>1?ve[1]:"")){ze.next=85;break}if(Be="The WebTwain version is: "+Te,be.DWT.OnWebTwainInitMessage&&be.DWT.OnWebTwainInitMessage(Be,ng.Info),"32"==We&&bc(x)&&($n.b64bit=!1),bc(x)&&(be.DWT.li({instanceMode:be.DWT.EnumInstance.dwt_desktop},"")||""!=Ye&&(be.DWT.lsmid(Ye,""),be.DWT.lsmid2b(Ye))),(H.isFunction(be.DWT.OnSSLCertInfo)||H.isFunction(be.OnSSLCertInfo))&&(""!=de&&($e=Date.parse(de+"T00:00:00"),$e=isNaN($e)?null:new Date($e)),Kfe||(H.isFunction(be.DWT.OnSSLCertInfo)?be.DWT.OnSSLCertInfo($e):H.isFunction(be.OnSSLCertInfo)&&be.OnSSLCertInfo($e)),Kfe=!0),!G){ze.next=72;break}if(""!=de){ze.next=69;break}throw{code:Xn.SSLCertInvalid,message:"The Dynamsoft Service SSL certificate is invalid."};case 69:if(!Ffe(de)){ze.next=72;break}throw{code:Xn.SSLCertExpired,message:"The Dynamsoft Service SSL certificate has expired."};case 72:if(!H.isString(Te)||""==Te){ze.next=82;break}if(lo(Wje),!X&&!Sue(Te,Tt.getServerVersionInfo(!0))){ze.next=78;break}return ze.abrupt("return",{host:x,port:S,bSSL:T,version:Te,certExpiredDate:$e});case 78:lo(kce),Q1(ge);case 80:ze.next=83;break;case 82:_e=!0;case 83:ze.next=86;break;case 85:"Version not found"===Se?Q1(ge):pje(ge,Se);case 86:ze.next=89;break;case 88:_e=!0;case 89:ze.next=92;break;case 91:_e=!0;case 92:throw _e&&Jl(ge),be.DWT.OnWebTwainInitMessage&&be.DWT.OnWebTwainInitMessage(ge._errorString,ng.Error),{code:ge._errorCode,message:ge._errorString};case 95:case"end":return ze.stop()}},C,null,[[6,27]])}))).apply(this,arguments)}function Qfe(C,x,S){return lU.apply(this,arguments)}function lU(){return lU=_t(B.mark(function C(x,S,T){var D,R,P,O,U,G;return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!Tt.bDWTChecked){X.next=2;break}return X.abrupt("return");case 2:return P=he.bSSL?T:S,D=he.bSSL?T:S,R=he.bSSL,X.prev=5,X.next=8,Zfe(x,D,R,Nt);case 8:O=X.sent,X.next=18;break;case 11:if(X.prev=11,X.t0=X.catch(5),X.t0.code!=Xn.MustUpgrade){X.next=16;break}throw ig(!0),X.t0;case 16:return X.next=18,Wqe(x,S,T);case 18:if(!oU()||be.DWT.ConnectWithSocket){X.next=21;break}return X.next=21,Uqe(x,P);case 21:return U=O.host,G=O.port,me.detect.dcpStatus=2,Nqe(U,G),X.next=26,Gce(!1,!0);case 26:if(!Qa()||!bc(x)){X.next=30;break}if(be.DWT.li({instanceMode:be.DWT.EnumInstance.dwt_desktop},"")){X.next=30;break}throw{code:-2827,message:"Failed to get Machine ID."};case 30:Tt.bDWTChecked=!0;case 31:case"end":return X.stop()}},C,null,[[5,11]])})),lU.apply(this,arguments)}function Zfe(C,x,S,T){return epe.apply(this,arguments)}function epe(){return(epe=_t(B.mark(function C(x,S,T,D){var R;return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return lo(Bje),S||H.each(me.detect.ports,function(O){he.bSSL?O.ssl&&(S=O.port):O.ssl||(S=O.port)}),P.prev=2,P.next=5,aU(x,S,T,D?oB:AS,{bConnectWithSocket:D});case 5:R=P.sent,P.next=12;break;case 8:throw P.prev=8,P.t0=P.catch(2),me.detect.dcpStatus=3,P.t0;case 12:return lo(Uje),!xo.versionInfoFromServer&&bc(R.host)&&(xo.versionInfoFromServer=R.version),P.abrupt("return",R);case 15:case"end":return P.stop()}},C,null,[[2,8]])}))).apply(this,arguments)}function Bqe(C,x,S,T,D){tpe(C,x,{bRemoteServer:!0,bConnectWithSocket:S},T,D)}function tpe(C,x,S,T,D){var R=0,P=C,O=x,U=me.detect.ssl,G=T,X=D;if(H.isFunction(P)&&H.isFunction(O))for(G=P,X=O,P=Ja(),R=0;R<me.detect.ports.length;R++)if(he.bSSL&&me.detect.ports[R].ssl||!he.bSSL&&!me.detect.ports[R].ssl){O=me.detect.ports[R].port,U=he.bSSL;break}P||(P=Ja()),aU(P,O,U,AS,S).then(function(z){var K=z.host,oe=z.port,ae=z.version;H.isFunction(G)&&G(K,oe,ae)},function(z){H.isFunction(X)&&X(z)})}function Wqe(C,x,S){return cU.apply(this,arguments)}function cU(){return cU=_t(B.mark(function C(x,S,T){var D,R,P,O,U,G,X;return B.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(D=he.bSSL?T:S,!he.bSSL||he.bSafari||he.bMobile||he.bAndroid){z.next=45;break}if(z.prev=2,!be.DWT.ConnectWithSocket&&1==be.DWT.IfCheckCORS){z.next=7;break}throw OS(R={}),{code:R._errorCode,message:R._errorString};case 7:return z.next=9,uU(x,D,!1);case 9:case 28:z.next=43;break;case 11:if(z.prev=11,z.t0=z.catch(2),(P=z.t0.code)!=Xn.CORSErrorFromService&&P!=Xn.SSLCertExpired&&P!=Xn.SSLCertInvalid){z.next=18;break}throw z.t0;case 18:if(P!=Xn.MustUpgrade){z.next=21;break}throw ig(!0),z.t0;case 21:if(z.prev=21,1==be.DWT.IfCheckCert){z.next=26;break}throw OS(O={}),{code:O._errorCode,message:O._errorString};case 26:return z.next=28,aU(J1,S,!1,oB,{bConnectWithSocket:!0,bCheckCert:!0});case 31:if(z.prev=31,z.t1=z.catch(21),(U=z.t1.code)!=Xn.CORSErrorFromService&&U!=Xn.SSLCertExpired&&U!=Xn.SSLCertInvalid){z.next=38;break}throw z.t1;case 38:if(U!=Xn.MustUpgrade){z.next=41;break}throw ig(!0),z.t1;case 41:throw bc(x)?ig(!1):H.isFunction(be.OnRemoteWebTwainNotFoundCallback)&&be.OnRemoteWebTwainNotFoundCallback(Tt.name,x,D,he.bSSL,Po.bMobile),z.t1;case 43:case 52:z.next=66;break;case 45:if(z.prev=45,!be.DWT.ConnectWithSocket&&0!=be.DWT.IfCheckCORS){z.next=50;break}throw OS(G={}),{code:G._errorCode,message:G._errorString};case 50:return z.next=52,uU(x,D,!1);case 54:if(z.prev=54,z.t2=z.catch(45),(X=z.t2.code)!=Xn.CORSErrorFromService&&X!=Xn.SSLCertExpired&&X!=Xn.SSLCertInvalid){z.next=61;break}throw z.t2;case 61:if(X!=Xn.MustUpgrade){z.next=64;break}throw ig(!0),z.t2;case 64:throw bc(x)?ig(!1):H.isFunction(be.OnRemoteWebTwainNotFoundCallback)&&be.OnRemoteWebTwainNotFoundCallback(Tt.name,x,D,he.bSSL,Po.bMobile),z.t2;case 66:throw pB();case 67:case"end":return z.stop()}},C,null,[[2,11],[21,31],[45,54]])})),cU.apply(this,arguments)}function Uqe(C,x){return npe.apply(this,arguments)}function npe(){return(npe=_t(B.mark(function C(x,S){return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.abrupt("return",uU(x,S,!0));case 1:case"end":return T.stop()}},C)}))).apply(this,arguments)}function uU(C,x,S){return ipe.apply(this,arguments)}function ipe(){return(ipe=_t(B.mark(function C(x,S,T){var D,R,P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(O.prev=0,be.DWT.ConnectWithSocket){O.next=5;break}return O.next=4,Zfe(x,S,he.bSSL,yt);case 4:D=O.sent;case 5:O.next=14;break;case 7:throw O.prev=7,O.t0=O.catch(0),R=O.t0,(P=O.t0.code)==Xn.ResponseDataTypeError||P==Xn.HTSTError||P==Xn.CORSError||P==Xn.SSLCertExpired||P==Xn.SSLCertInvalid||P==Xn.MustUpgrade||(P==Xn.CORSErrorFromService?H.isFunction(be.OnCorsConfigError)&&be.OnCorsConfigError(O.t0.message):bc(x)&&T&&oU()&&(P=(R={code:Xn.CORSError,message:'The Connection from the insecure (HTTP) web page to the local "Dynamsoft Service" failed!'}).code)),P==Xn.CORSError&&H.isFunction(be.OnHTTPCorsError)&&be.OnHTTPCorsError(R.message),R;case 14:return O.abrupt("return",D);case 15:case"end":return O.stop()}},C,null,[[0,7]])}))).apply(this,arguments)}function dU(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function Wm(C,x,S){return x.has(C),S}!function(C){C.DoNotCheck=0,C.Check127=1,C.CheckLocalDynamsoftCert=2}(qfe||(qfe={}));var Vqe=new WeakSet,g3=new WeakSet,m3=new WeakSet,jqe=function(C){function x(){var G,oe,ae,ue;n(this,x);for(var X=arguments.length,z=new Array(X),K=0;K<X;K++)z[K]=arguments[K];return oe=this,ae=x,ue=[].concat(z),ae=qn(ae),dU(G=Za(oe,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(ye){return!1}}()?Reflect.construct(ae,ue||[],qn(oe).constructor):ae.apply(oe,ue)),m3),dU(G,g3),dU(G,Vqe),G}return el(x,C),v(x,[{key:"SetCookie",value:function(G){return this._cookie=G,document.cookie=G,Nt}},{key:"LoadImageFromBase64Binary",value:function(G,X,z,K){var oe=this,ae=!1;if(H.isFunction(z)&&(ae=!0),oe._resetErr(),!oe._isValid())return H.isFunction(K)&&on(K,oe),!!ae&&void 0;if(!G)return Bi(oe),H.isFunction(K)&&on(K,oe),!!ae&&void 0;var ue,ye,Ie,Ue,He,Te,Re=G,Oe="LoadImageFromBase64Binary",Ge=X,Se=1;if(Re instanceof yW&&H.isFunction(Re.getLength)&&H.isFunction(Re.getData)&&(Re=Re.getData(0,Re.getLength())),H.isString(Re))if(-1!=Re.indexOf("data:image/bmp"))Ge=0;else if(-1!=Re.indexOf("data:image/jpeg"))Ge=1;else if(-1!=Re.indexOf("data:image/tif"))Ge=2;else if(-1!=Re.indexOf("data:image/png"))Ge=3;else if(-1!=Re.indexOf("data:application/pdf"))Ge=4;else if(-1!=Re.indexOf("data:image/jp2"))Ge=14;else{var de=Re.substr(0,64),ge=H.base64.decode(de,!0);Ue=be.DWT.EnumDWT_ImageType,He=Ie=ge,(Ie instanceof ArrayBuffer||Ie instanceof Array)&&(He=new Uint8Array(Ie.slice(0,12))),Ge=37==(Te=He)[0]&&80==Te[1]&&68==Te[2]&&70==Te[3]?Ue.IT_PDF:function(Te){return 73==Te[0]&&73==Te[1]&&42==Te[2]&&0==Te[3]||77==Te[0]&&77==Te[1]&&0==Te[2]&&42==Te[3]}(He)?Ue.IT_TIF:function(Te){return 137==Te[0]&&80==Te[1]&&78==Te[2]&&71==Te[3]}(He)?Ue.IT_PNG:function(Te){return 255==Te[0]&&216==Te[1]}(He)?Ue.IT_JPG:function(Te){return 66==Te[0]&&77==Te[1]}(He)?Ue.IT_BMP:function(Te){return 0==Te[0]&&0==Te[1]&&0==Te[2]&&12==Te[3]&&106==Te[4]&&80==Te[5]&&32==Te[6]&&32==Te[7]||255==Te[0]&&79==Te[1]&&255==Te[2]&&81==Te[3]}(He)?Ue.IT_J2K:Ue.IT_PNG}if(Ge!=be.DWT.EnumDWT_ImageType.IT_BMP&&Ge!=be.DWT.EnumDWT_ImageType.IT_JPG&&Ge!=be.DWT.EnumDWT_ImageType.IT_TIF&&Ge!=be.DWT.EnumDWT_ImageType.IT_PNG&&Ge!=be.DWT.EnumDWT_ImageType.IT_PDF&&Ge!=be.DWT.EnumDWT_ImageType.IT_J2K&&(Ge=-1),!mn.checkProductKey(oe,{Core:!0})||!mn.checkPDFProductKeyWhenNeeds(oe,Ge))return H.isFunction(K)&&on(K,oe),!!ae&&void 0;if(H.isString(Re)&&-1!=Re.indexOf("base64,")&&(Re=Re.substr(Re.indexOf("base64,")+7)),ye=oe.__GetLoadEventsNum(),!ae){var _e=oe._getCurrentDocumentName(),ve=oe._getCurrentDefaultTagName();return(ue=oe.__innerLoadImageFun(Oe,Et(Re,Ge,ye,Se),Se,_e,ve))&&oe._canConsume()&&be.DWT.lcvrf(oe),ue}me.cancelFrom=Zn.LoadImage,oe.IfShowProgressBar?me.showProgress(oe,Oe,oe.__IfShowCancelDialogWhenImageTransfer):me.hideProgress(),oe.__bLoadingImage=!0,oe._innerSend(Oe,Et(Re,Ge,ye,Se=0),!0,function(){if(me.closeProgress(null,Oe),oe.__bLoadingImage=!1,oe._isBindViewer()){var Te=oe._ImgManager.getCurrentImageIndex();Te>=0&&oe._innerRefreshUI(Te)}oe._canConsume()&&be.DWT.lcvrf(oe),z&&z(Re,X)},function(){me.closeProgress(null,Oe),oe.__bLoadingImage=!1,H.isFunction(K)&&K(oe._errorCode,oe._getErrorString(),Re,X)})}},{key:"SaveSelectedImagesToBytes",value:function(G,X){return PS(this),yt}},{key:"LoadImageFromBytes",value:function(G,X,z){return PS(this),yt}},{key:"SetImageWidth",value:function(G,X,z,K){var oe,ae=this,ue=!1;if(H.isFunction(z)&&(ue=!0),ae._resetErr(),!ae._isValid())return!!ue&&void 0;var ye=parseInt(G);if(isNaN(ye))return Jn(ae),H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),!!ue&&void 0;if(ye<0||ye>=ae._ImgManager.count())return Mt(ae),H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),!!ue&&void 0;if(H.isUndefined(X))return Bi(ae),H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),!!ue&&void 0;var Ie=ae._ImgManager.convertClientIndexToServerId(ye);return-1==Ie?(Mt(ae),H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),!!ue&&void 0):((oe=1==ae._innerFun("SetImageWidth",Et(Ie,X)))?H.isFunction(z)&&z():H.isFunction(K)&&K(ae._errorCode,ae._getErrorString()),ue?void 0:oe)}},{key:"HTTPDownloadStreamThroughPost",value:function(G,X){return PS(this),yt}},{key:"HTTPUploadStreamThroughPost",value:function(G,X,z,K,oe){return PS(this),yt}},{key:"HTTPUploadThroughPutDirectly",value:function(G,X,z,K,oe){return PS(this),!1}},{key:"SetCustomDSDataEx",value:function(G){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCustomDSDataEx",Et(G))}},{key:"SetCustomDSData",value:function(G){if(this._resetErr(),!this._isValid())return!1;var X=zn.replaceLocalFilename(G);return this._innerFun("SetCustomDSData",Et(X))}},{key:"GetCustomDSDataEx",value:function(){var G=this;return G._resetErr(),!!G._isValid()&&G._innerFun("GetCustomDSDataEx")}},{key:"GetCustomDSData",value:function(G){var X=this;if(X._resetErr(),!X._isValid())return!1;var z=zn.replaceLocalFilename(G);return X._innerFun("GetCustomDSData",Et(z))}},{key:"on",value:function(G,X){return this.registerEvent(G,X)}},{key:"off",value:function(G,X){return this.unregisterEvent(G,X)}},{key:"ConvertToBW",value:function(G,X,z){var K=this,oe=!1;if(H.isFunction(X)&&(oe=!0),K._resetErr(),!K._isValid())return!!oe&&void 0;if(!mn.checkProductKey(K,{Core:!0}))return H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!!oe&&void 0;var ae=parseInt(G);if(isNaN(ae))return Jn(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!!oe&&void 0;if(ae<0||ae>=K._ImgManager.count())return Mt(K),H.isFunction(z)&&z(K._errorCode,K._getErrorString()),!!oe&&void 0;var ue=K.ChangeBitDepth(G,1,!0);return ue?H.isFunction(X)&&X():H.isFunction(z)&&z(K._errorCode,K._getErrorString()),oe?void 0:ue}},{key:"LoadImageFromBinary",value:function(G,X,z){var K,oe,ae=this,ue="LoadImageFromBinary",ye=!1;H.isFunction(X)&&(ye=!0);var Ie=null===(K=me.progressContext)||void 0===K?void 0:K.IfShowCancelDialogWhenImageTransfer;return ye&&(ae.IfShowProgressBar?(me.showProgress(ae,ue,!1),me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=!1)):me.hideProgress()),oe=ae._innerLoadImageFromBinary(G,0,!0,ye,function(){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=Ie),H.isFunction(X)&&(ae.IfShowProgressBar&&me.closeProgress(null,ue),X())},function(Ue,He){me.progressContext&&(me.progressContext.IfShowCancelDialogWhenImageTransfer=Ie),H.isFunction(X)&&ae.IfShowProgressBar&&me.closeProgress(null,ue),H.isFunction(z)&&z(Ue,He)}),ye?void 0:oe}},{key:"EnableSourceUI",value:function(G,X){var z=this;return z._resetErr(),!!z._isValid()&&(z._innerSend("EnableSourceUI",null,!0,G,X),!0)}},{key:"GetIfShowVideoContainer",value:function(){return this._UIView.GetIfShowVideoContainer()}},{key:"ShowVideoContainer",value:function(G){return this._UIView.ShowVideoContainer(G)}},{key:"UpdateVideoContainer",value:function(G){return this._UIView.UpdateVideoContainer(G)}},{key:"ChangeBitDepth",value:function(G,X,z){var K,oe=this;if(oe._resetErr(),!oe._isValid())return!1;if(K=parseInt(G),isNaN(K))return Jn(oe),!1;if(K<0||K>=oe._ImgManager.count())return Mt(oe),!1;var ae=oe._ImgManager.convertClientIndexToServerId(K);return-1==ae?(Mt(oe),!1):oe._innerFun("ChangeBitDepth",Et(ae,X,z))}},{key:"ConvertToGrayScale",value:function(G,X,z){var K,oe=this,ae=!1;if(H.isFunction(X)&&(ae=!0),oe._resetErr(),!oe._isValid())return!!ae&&void 0;var ue=parseInt(G);if(isNaN(ue))return Jn(oe),H.isFunction(z)&&z(oe._errorCode,oe._getErrorString()),!!ae&&void 0;if(ue<0||ue>=oe._ImgManager.count())return Mt(oe),H.isFunction(z)&&z(oe._errorCode,oe._getErrorString()),!!ae&&void 0;var ye=oe._ImgManager.convertClientIndexToServerId(ue);return-1==ye?(Mt(oe),H.isFunction(z)&&z(oe._errorCode,oe._getErrorString()),!!ae&&void 0):((K=1==oe._innerFun("ConvertToGrayScale",Et(ye)))?(zn.refreshImageAfterInvokeFun(oe,ue),H.isFunction(X)&&X()):H.isFunction(z)&&z(oe._errorCode,oe._getErrorString()),ae?void 0:K)}},{key:"ClearTiffCustomTag",value:function(){var G=this;return G._resetErr(),!!G._isValid()&&(G._aryTiffTag.splice(0,G._aryTiffTag.length),G._innerFun("ClearTiffCustomTag"))}},{key:"SetTiffCustomTag",value:function(G,X,z){var K=this;if(K._resetErr(),!K._isValid())return!1;if(H.isUndefined(G)||H.isUndefined(X))return Bi(K),!1;var oe,ae=1*G;if(oe=H.isString(X)?H.replaceAll(X,'"','\\"'):X,ae<=0||ae>2147483647)return St(K,-2378,"Invalid value for the tiff tag code."),!1;var ue,ye=0,Ie=!1,Ue=K._aryTiffTag.length;for(ye=0;ye<Ue;ye++)(ue=K._aryTiffTag[ye]).tag==ae&&(ue.Content=X,ue.UseBase64Encoding=z,Ie=!0);return!Ie&&Ue>=32?(St(K,-2428,"Tiff tag count has exceeded the limit."),!1):K._innerFun("SetTiffCustomTag",Et(ae,oe,z))}},{key:"IsBlankImage",value:function(G){var X,z=this;if(z._resetErr(),!z._isValid())return!1;if(X=parseInt(G),isNaN(X))return Jn(z),!1;if(X<0||X>=z._ImgManager.count())return Mt(z),!1;var K=z._ImgManager.convertClientIndexToServerId(X);return-1==K?(Mt(z),!1):z._innerFun("IsBlankImage",Et(K,yt))}},{key:"IsBlankImageExpress",value:function(G){var X=this;if(X._resetErr(),!X._isValid())return!1;var z=parseInt(G);if(isNaN(z))return Jn(X),!1;if(z<0||z>=X._ImgManager.count())return Mt(X),!1;var K=X._ImgManager.convertClientIndexToServerId(z);return-1==K?(Mt(X),!1):X._innerFun("IsBlankImage",Et(K,Nt))}},{key:"SetOpenSourceTimeout",value:function(G){var X=this;return X._resetErr(),!!X._isValid()&&X._innerFun("SetOpenSourceTimeout",Et(G))}},{key:"GetImageURL",value:function(G,X,z,K,oe){var ae=this;if(ae._resetErr(),!ae._isValid())return!1;var ue,ye,Ie,Ue,He=G,Re=parseInt(X),Oe=parseInt(z);if(K?(ue="",ye="dwt://"):(ue=ae._httpUrl,ye="dwt/"),Ue=ae._bScanForProxyRemote?xo.getVersionStrForCheck():Tt.getServerVersionInfo(),Ie=[ue,ye,Tt.getDWTPrefix(),Ue,"/img?id=",ae._clientId],H.isUndefined(He)||null===He)return Lle(ae),"";if(oe)Ie.push("&index=-1&width=-1&height=-1&webcam="),Ie.push(oe);else{if(He=parseInt(He),isNaN(He))return Jn(ae),"";if(He<-1||He>=ae._ImgManager.count())return Mt(ae),"";var Ge=ae._ImgManager.convertClientIndexToServerId(He);if(-1==Ge)return"";Ie.push("&index="),Ie.push(Ge),Re>0&&Oe>0?(Ie.push("&width="),Ie.push(Re),Ie.push("&height="),Ie.push(Oe)):Ie.push("&width=-1&height=-1"),Po.bMobile&&Ie.push("&type=1&quality=85")}if(Ie.push("&t="),Ie.push((new Date).getTime()),Ie=Ie.join(""),he.bFileSystem&&Ie.indexOf("dwt://")<0){var Se=new Image;Se.crossOrigin="anonymous",Se.src=Ie,Se=null}return Ie}},{key:"GetImagePartURL",value:function(G,X,z){var K=this;if(K._resetErr(),!K._isValid())return!1;var oe=parseInt(G);return isNaN(oe)?(Jn(K),""):oe<0||oe>=K._ImgManager.count()?(Mt(K),""):this.GetImageURL(oe,X,z,!0)}},{key:"SetLanguage",value:function(G){var X=this;return X._resetErr(),!!X._isValid()&&X._innerFun("SetLanguageForSecurity",Et(G))}},{key:"GetLicenseInfo",value:function(G,X){var z=this;z.__licenseInfo?H.isFunction(G)&&G(z.__licenseInfo):z._innerFunRaw("GetLicenseInfo",Et(0),Nt,yt,Nt,function(K){K?K.exception?H.isFunction(X)&&X(K.exception):(H.isArray(K.result)&&K.result.length>0&&JB(z,K.result[0]),H.isFunction(G)&&G(z.__licenseInfo)):H.isFunction(X)&&X()},X)}},{key:"SetProductKeyAsync",value:function(G){return this._setProductKeyAsync(G)}},{key:"GetVersionInfoAsync",value:function(){return pt.Promise.resolve(xo.versionInfoFromServer)}},{key:"isUsingActiveX",value:function(){return!1}},{key:"SetLTSLicenseAsync",value:function(G){return this._setLTSLicenseAsync(G)}},{key:"Print",value:function(G){var X=this;return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("Print"):G?(X._innerSend("PrintEx",Et(!0),!0,function(){},function(){}),!0):(X._ImagePrint.Print(),!0))}},{key:"PrintEx",value:function(G){var X=this;return X._resetErr(),!!X._isValid()&&!!X._checkIndices(G)&&(X._isNoViewer()?X._nouiNotSupport("Print"):(X._ImagePrint.PrintEx(G),!0))}},{key:"IsBlankImageAsync",value:(U=_t(B.mark(function G(X,z){var K,oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(K=this,ql.getEnumPlatform()==Rn.enumWindow){ye.next=5;break}throw St(K,-2905,"This API is not supported on the current operating system. Please contact your system administrator."),{code:this._errorCode,message:this._getErrorString()};case 5:return ae={minBlockHeight:20,maxBlockHeight:30},z&&(H.isNumber(z.minBlockHeight)&&z.minBlockHeight>=0&&(ae.minBlockHeight=z.minBlockHeight),H.isNumber(z.maxBlockHeight)&&z.maxBlockHeight>=0&&(ae.maxBlockHeight=z.maxBlockHeight)),oe={command:"isBlankImage",parameter:{index:X,minHeight:ae.minBlockHeight,maxHeight:ae.maxBlockHeight}},ye.next=10,K.RunCommandAsync(oe);case 10:if(!((ue=ye.sent)&&me.isArray(ue.result)&&ue.result.length>0)){ye.next=13;break}return ye.abrupt("return",ue.result[0]);case 13:return ye.abrupt("return",!1);case 14:case"end":return ye.stop()}},G,this)})),function(G,X){return U.apply(this,arguments)})},{key:"httpUploadBlob",value:function(G,X,z,K){var oe=this,ae="httpUploadBlob",ue=X,ye=z,Ie=null,Ue=null,He=_u.Text;if(oe._resetErr(),!oe._isValid())return me.Promise.reject({code:oe._errorCode,message:oe._errorString});if(H.isUndefined(G)||""===G)return wl(oe),me.Promise.reject({code:oe._errorCode,message:oe._errorString});if(!H.isString(G))return kS(oe),me.Promise.reject({code:oe._errorCode,message:oe._errorString});if(!(ue instanceof Blob))return Bi(oe),me.Promise.reject({code:oe._errorCode,message:oe._errorString});var Re=ue.type.toLocaleLowerCase();if("image/jpeg"!=Re&&"image/jpg"!=Re&&"image/png"!=Re&&"image/bmp"!=Re&&"application/pdf"!=Re&&"image/tiff"!=Re&&"image/tif"!=Re)return St(oe,-2845,"Only Blob of JPEG, PNG, BMP, TIFF and PDF image types can be uploaded."),me.Promise.reject({code:oe._errorCode,message:oe._errorString});K&&(Ie=new FormData,H.each(K.formFields,function(de,ge){var _e=de.name,ve=de.value;H.isString(_e)&&(ve instanceof Blob?Ie.append(_e,ve,de.fileName):Ie.append(_e,ve))}),Ue={},H.each(K.headers,function(de,ge){H.isString(de.name)&&(Ue[de.name]=de.value)}),K.responseType&&(He=K.responseType));var Oe=oe._createHttpUploaderConfig(),Ge=new Pf,Se=new Cd;return Se.url=G,Se.method=ae,Se.content=ue,ue=null,Se.contentType=oe._strHttpContentTypeFieldValue,Se.headers=Ue,Se.fileName=ye,Se.httpFormData=Ie,oe.__remoteFilename&&""!=oe.__remoteFilename&&(Se.remoteFilename=oe.__remoteFilename),Se.retry=1,Se.bOnlyResponseEmptyIsOK=!1,Se.responseType=He,Oe.objUploadStatus=void 0,oe.IfShowProgressBar&&me.showProgress(oe,ae,!1),new me.Promise(function(de,ge){Ge.httpPostUpload(Oe,Se,function(_e){oe.IfShowProgressBar&&me.closeProgress(oe,ae,!1),de(_e)},function(_e,ve){oe.IfShowProgressBar&&me.closeProgress(oe,ae,!1),ge({code:_e,message:ve})})})}},{key:"saveBlob",value:(O=_t(B.mark(function G(X,z){var K,oe,ae,ue,ye;return B.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:if(ae=X,(K=this)._resetErr(),K._isValid()){Ie.next=4;break}throw{code:K._errorCode,message:K._errorString};case 4:if(!H.isString(X)&&null!=X){Ie.next=7;break}Ie.next=9;break;case 7:case 21:throw Bi(K),{code:K._errorCode,message:K._errorString};case 9:if(!(z instanceof Blob)){Ie.next=21;break}if("image/jpeg"!=(ye=z.type.toLocaleLowerCase())&&"image/jpg"!=ye&&"image/png"!=ye&&"image/bmp"!=ye&&"application/pdf"!=ye&&"image/tiff"!=ye&&"image/tif"!=ye){Ie.next=14;break}Ie.next=16;break;case 14:throw St(K,-2844,"Only Blob of JPEG, PNG, BMP, TIFF and PDF image types can be saved."),{code:K._errorCode,message:K._errorString};case 16:return Ie.next=18,Dfe(z);case 18:ue=Ie.sent,Ie.next=23;break;case 23:return ae||(ae=""),ae=zn.replaceLocalFilename(ae),oe=Et(ae),Ie.next=28,new me.Promise(function(Ue,He){K._innerSendBlobByWS("SaveBlobToFile",oe,ue,function(Re){Ue(Re)},function(Re){He({code:K._errorCode,message:K._errorString})})});case 28:case"end":return Ie.stop()}},G,this)})),function(G,X){return O.apply(this,arguments)})},{key:"createLocalStorage",value:(P=_t(B.mark(function G(X){var z,oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if((z=this)._resetErr(),z._isValid()){ye.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(oe="CreateLocalStorage",ae=null,!X){ye.next=12;break}if(ue=X.password,!1!==Wm(this,g3,YP).call(this,ue)){ye.next=9;break}throw{code:z._errorCode,message:z._errorString};case 9:ae=JSON.stringify([JSON.stringify(X)]),ye.next=13;break;case 12:ae='["{}"]';case 13:return ye.next=15,new me.Promise(function(Ie,Ue){z._innerSend(oe,ae,!1,function(He){if(H.isArray(He)&&He.length>0){var Re=He[0];Re&&H.isString(Re.uid)&&Ie(Re.uid)}else Jl(z),Ue({code:z._errorCode,message:z._errorString})},function(){Ue({code:z._errorCode,message:z._errorString})})});case 15:return ye.abrupt("return",ye.sent);case 17:case"end":return ye.stop()}},G,this)})),function(G){return P.apply(this,arguments)})},{key:"localStorageExist",value:(R=_t(B.mark(function G(X){var z,K;return B.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(K="LocalStorageExist",(z=this)._resetErr(),z._isValid()){ae.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(0!=Wm(z,m3,XP).call(z,X)){ae.next=6;break}throw{code:z._errorCode,message:z._errorString};case 6:return ae.next=8,new me.Promise(function(ue,ye){z._innerSend(K,Et(X),!1,function(Ie){if(H.isArray(Ie)&&Ie.length>0){var Ue=Ie[0];(H.isBoolean(Ue)||H.isNumber(Ue))&&ue(!!Ue)}else Jl(z),ye({code:z._errorCode,message:z._errorString})},function(){ye({code:z._errorCode,message:z._errorString})})});case 8:return ae.abrupt("return",ae.sent);case 10:case"end":return ae.stop()}},G,this)})),function(G){return R.apply(this,arguments)})},{key:"saveToLocalStorage",value:(D=_t(B.mark(function G(X){var z,K,oe;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(K="SaveToLocalStorage",oe=null,(z=this)._resetErr(),z._isValid()){ue.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(H.isObject(X)){ue.next=7;break}throw Bi(z),{code:z._errorCode,message:z._errorString};case 7:if(!1!==Wm(z,m3,XP).call(z,X.uid)&&!1!==Wm(this,g3,YP).call(this,X.password)){ue.next=9;break}throw{code:z._errorCode,message:z._errorString};case 9:if(!H.isUndefined(X.indices)){ue.next=13;break}X.indices=MHe(z),ue.next=19;break;case 13:if(!H.isArray(X.indices)||0!=X.indices.length){ue.next=16;break}ue.next=19;break;case 16:if(z._checkIndices(X.indices)){ue.next=18;break}throw{code:z._errorCode,message:z._errorString};case 18:X.indices=km(z,X.indices);case 19:return oe=JSON.stringify([JSON.stringify(X)]),ue.next=22,new me.Promise(function(ye,Ie){z._innerSend(K,oe,!1,function(Ue){if(H.isArray(Ue)&&Ue.length>0){var He=Ue[0];He&&He.imageIds&&ye(He.imageIds)}else Jl(z),Ie({code:z._errorCode,message:z._errorString})},function(){Ie({code:z._errorCode,message:z._errorString})})});case 22:return ue.abrupt("return",ue.sent);case 24:case"end":return ue.stop()}},G,this)})),function(G){return D.apply(this,arguments)})},{key:"loadFromLocalStorage",value:(T=_t(B.mark(function G(X){var z,K,oe,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(K="LoadFromLocalStorage",oe=null,(z=this)._resetErr(),z._isValid()){ye.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(H.isObject(X)){ye.next=7;break}throw Bi(z),{code:z._errorCode,message:z._errorString};case 7:if(!1!==Wm(z,m3,XP).call(z,X.uid)&&!1!==Wm(this,g3,YP).call(this,X.password)){ye.next=9;break}throw{code:z._errorCode,message:z._errorString};case 9:return(ue=H.clone(X)).documentName=z._getCurrentDocumentName(),ue.tagName=z._getCurrentDefaultTagName(),oe=JSON.stringify([JSON.stringify(ue)]),me.showProgress(z,K,!1),me.progressBarOnPercentDone(-1,"Processing...","",0,""),ye.next=17,new me.Promise(function(Ie,Ue){z._innerSend(K,oe,!1,function(He){var Re;me.closeProgress(null,K),H.isArray(He)&&He.length>0?(Re=He[0])&&Re.mapImageIds&&Ie(Re.mapImageIds):(!1===Re&&0!=z._errorCode||Jl(z),Ue({code:z._errorCode,message:z._errorString}))},function(){me.closeProgress(null,K),Ue({code:z._errorCode,message:z._errorString})})});case 17:return ye.abrupt("return",ye.sent);case 19:case"end":return ye.stop()}},G,this)})),function(G){return T.apply(this,arguments)})},{key:"removeLocalStorage",value:(S=_t(B.mark(function G(X){var z,K,oe;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(K="RemoveLocalStorage",oe=null,(z=this)._resetErr(),z._isValid()){ue.next=4;break}throw{code:z._errorCode,message:z._errorString};case 4:if(H.isObject(X)){ue.next=7;break}throw Bi(z),{code:z._errorCode,message:z._errorString};case 7:if(!1!==Wm(z,m3,XP).call(z,X.uid)&&!1!==Wm(this,g3,YP).call(this,X.password)){ue.next=9;break}throw{code:z._errorCode,message:z._errorString};case 9:return X&&(oe=JSON.stringify([JSON.stringify(X)])),ue.next=12,new me.Promise(function(ye,Ie){z._innerSend(K,oe,!1,function(Ue){if(H.isArray(Ue)&&Ue.length>0){var He=Ue[0];(H.isBoolean(He)||H.isNumber(He))&&ye(!!He)}else Jl(z),Ie({code:z._errorCode,message:z._errorString})},function(){Ie({code:z._errorCode,message:z._errorString})})});case 12:return ue.abrupt("return",ue.sent);case 14:case"end":return ue.stop()}},G,this)})),function(G){return S.apply(this,arguments)})}]);var S,T,D,R,P,O,U}(Rf);function YP(C){if(!H.isUndefined(C)){if(!H.isString(C))return St(this,-2850,"The password is not a string."),!1;if(C.length>32)return St(this,-2849,"The password must not exceed 32 characters in length."),!1}return!0}function XP(C){return H.isUndefined(C)||""==C?(St(this,-2846,"The uid cannot be empty."),!1):!!H.isString(C)||(St(this,-2847,"The uid is invalid."),!1)}function G0(C,x,S,T){var D;0!==S&&1!==S?D=S:(D={},S&&(D.set=1==T?function(R){var P=1*R;return!H.isNumber(P)||isNaN(P)?(ga(C),yt):(C._resetErr(),!!C._isValid()&&C._innerFun(x,Et(P)))}:2==T?function(R){return H.isBoolean(R)?(C._resetErr(),!!C._isValid()&&C._innerFun(x,Et(R))):(ga(C),yt)}:function(R){return H.isString(R)?(C._resetErr(),!!C._isValid()&&C._innerFun(x,Et(R))):(ga(C),yt)})),D.get||(D.get=function(){return C._resetErr(),!!C._isValid()&&C._innerFun(x)}),x in C||Object.defineProperty(C,x,D)}function Hqe(C,x){var S="undefined"!=typeof Symbol&&C[Symbol.iterator]||C["@@iterator"];if(!S){if(Array.isArray(C)||(S=function(U,G){if(U){if("string"==typeof U)return ope(U,G);var X=Object.prototype.toString.call(U).slice(8,-1);if("Object"===X&&U.constructor&&(X=U.constructor.name),"Map"===X||"Set"===X)return Array.from(U);if("Arguments"===X||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(X))return ope(U,G)}}(C))||x&&C&&"number"==typeof C.length){S&&(C=S);var T=0,D=function(){};return{s:D,n:function(){return T>=C.length?{done:!0}:{done:!1,value:C[T++]}},e:function(U){throw U},f:D}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var R,P=!0,O=!1;return{s:function(){S=S.call(C)},n:function(){var U=S.next();return P=U.done,U},e:function(U){O=!0,R=U},f:function(){try{P||null==S.return||S.return()}finally{if(O)throw R}}}}function ope(C,x){(null==x||x>C.length)&&(x=C.length);for(var S=0,T=new Array(x);S<x;S++)T[S]=C[S];return T}function zqe(C,x,S){return x.has(C),S}var spe=new WeakSet,ape=function(){return v(function S(T,D,R,P){n(this,S),function Gqe(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}(this,spe),An(this,"serverUrl",void 0),this.serverUrl=T,this.bLocal=bc(T),this.clientId=null!=R?R:H.guid(),this.bGlobal=D,this.serverName=P,this.bLicenseOK=!1},[{key:"checkSource",value:function(S){if(!S)throw{code:-1003,message:"Source Manager unable to find the specified Source"}}},{key:"parseResultDefault",value:function(S){var T;if(H.isObject(S)&&S.exception&&0!=S.exception)throw{code:S.exception,message:null!==(T=S.description)&&void 0!==T?T:"general error"};if(S&&H.isArray(S.result)&&S.result.length>0){var D=S.result[S.result.length-1];try{return JSON.parse(D)}catch(R){return D}}throw S}},{key:"_requestAsync",value:(x=_t(B.mark(function S(T,D,R){var P,O,U,G,X,z,K,oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!be.DWT.ConnectWithSocket){ye.next=12;break}return ye.next=3,zqe(this,spe,Yqe).call(this);case 3:return O=0,T&&(O=T.cmdId),U={client:P=ye.sent,userData:{command:T},taskId:O},G=$qe,ye.next=9,P.request(H.stringify(T),G,U);case 9:return H.isString(X=ye.sent)&&(X=H.parse(X)),ye.abrupt("return",X);case 12:return z=[Sce(),"/",T.method].join(""),D&&(oe=D),ae=(ue=this).serverUrl?Kp.getDDMUrl(ue.serverUrl,ue.bGlobal,[wce,T.method].join("")):Kp.getModuleUrl(z),ye.prev=16,ye.next=19,nC(ae,{method:"post",dataType:"json",body:H.stringify(T),fetchRaw:null!=R&&R,timeout:oe});case 19:K=ye.sent,ye.next=25;break;case 22:throw ye.prev=22,ye.t0=ye.catch(16),ye.t0;case 25:return ye.abrupt("return",K);case 26:case"end":return ye.stop()}},S,this,[[16,22]])})),function(S,T,D){return x.apply(this,arguments)})},{key:"_resetLicense",value:(C=_t(B.mark(function S(T,D,R){return B.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:case"end":return P.stop()}},S)})),function(S,T,D){return C.apply(this,arguments)})}]);var C,x}();function Yqe(){return lpe.apply(this,arguments)}function lpe(){return(lpe=_t(B.mark(function C(){var x,S,T,R,P,O,U,G;return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if((x=this)._wsClient){X.next=10;break}return S=new E0,(T=this.serverUrl)?(P="/",R=me.detect.ssl?"ddm/18626/":"ddm/18625/",H.endsWith(T,"/")&&(P=""),H.startsWith(T,"https://")||H.startsWith(T,"wss://")?(S.ssl=!0,O=H.startsWith(T,"https://")?H.replaceAll(T,"https://",""):H.replaceAll(T,"wss://",""),T=O+P+R):H.startsWith(T,"http://")||H.startsWith(T,"ws://")?(S.ssl=!1,U=H.startsWith(T,"http://")?H.replaceAll(T,"http://",""):H.replaceAll(T,"ws://",""),T=U+P+R):(S.ssl=me.detect.ssl,S.port=S.ssl?$n.SSLPort:$n.Port),S.server=T):(S.ssl=me.detect.ssl,S.server=Ja(),S.port=S.ssl?$n.SSLPort:$n.Port),S.useWS=!0,S.protocol=$n.wsProtocol,G=wf.Instance.getClient(S),X.next=9,G.testConnection();case 9:x._wsClient=G;case 10:return X.abrupt("return",x._wsClient);case 11:case"end":return X.stop()}},C,this)}))).apply(this,arguments)}An(ape,"logLevel",-1);var cpe,Xqe=function(C){function x(){var T,O,U,G;n(this,x);for(var D=arguments.length,R=new Array(D),P=0;P<D;P++)R[P]=arguments[P];return O=this,U=x,G=[].concat(R),U=qn(U),An(T=Za(O,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(X){return!1}}()?Reflect.construct(U,G||[],qn(O).constructor):U.apply(O,G)),"_bInited",!1),T}return el(x,C),v(x,[{key:"getDynamsoftService",value:(S=_t(B.mark(function T(D,R,P,O){var U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge;return B.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return P=null!==(U=P)&&void 0!==U&&U,O=null!==(G=O)&&void 0!==G?G:30,X={id:this.clientId,cmdId:H.guid(),method:"SearchScanner",parameter:[1,"_privet._tcp.local.",!1,!0,P,O,D,R],version:zp},Se.prev=5,Se.next=8,this._requestAsync(X,3e4,!1);case 8:z=Se.sent,this._bInited=!0,Se.next=19;break;case 12:if(Se.prev=12,Se.t0=Se.catch(5),!this.bLocal){Se.next=18;break}throw T0(K={}),{code:K._errorCode,message:K._errorString};case 18:throw{code:-2604,message:"Failed to connect to the Proxy Service. Please make sure the Proxy Service is configured successfully, Dynamsoft Service is running, or the certificate is valid."};case 19:oe=[],ae=this.parseResultDefault(z),ue=Hqe(ae),Se.prev=22,ue.s();case 24:if((ye=ue.n()).done){Se.next=40;break}if(!((Ie=ye.value).service_type&&Ie.service_type==nl.ST_UNKNOWN||Ie.type&&"dynamsoft_private_cloud_scan"!=Ie.type&&"twaindirect"!=Ie.type)){Se.next=30;break}return Se.abrupt("continue",38);case 30:if(!Ie.service_type){Se.next=38;break}Se.t1=Ie.service_type,Se.next=Se.t1===nl.ST_DYNAMSOFT_SERVICE?34:38;break;case 34:return(Ue=Ie.modules)&&H.isArray(Ue)&&H.isString(Ue[0])&&(He=Ue[0].split(",")).length>=3&&He[0]>=1&&He[1]>=8&&He[2]>0&&(Ie.bGlobalFind=!0,Re=upe(this.serverUrl,Ie),oe.push(Re)),Ie.bGlobalFind||(Ge=null!==(Oe=null==Ie?void 0:Ie.ty)&&void 0!==Oe?Oe:"",H.warn(["The Dynamsoft Service on [",Ge,"] is old version."].join(""))),Se.abrupt("break",38);case 38:Se.next=24;break;case 40:Se.next=45;break;case 42:Se.prev=42,Se.t2=Se.catch(22),ue.e(Se.t2);case 45:return Se.prev=45,ue.f(),Se.finish(45);case 48:return Se.abrupt("return",oe);case 49:case"end":return Se.stop()}},T,this,[[5,12],[22,42,45,48]])})),function(T,D,R,P){return S.apply(this,arguments)})},{key:"dispose",value:function(){var T={id:this.clientId,cmdId:H.guid(),method:"dispose",version:zp};this._requestAsync(T,500)}}]);var S}(ape);function upe(C,x){var S=new ZB;return S.server=C,S.attrs=x,S}function $qe(C,x,S,T){return hU.apply(this,arguments)}function hU(){return hU=_t(B.mark(function C(x,S,T,D){var R,P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(S!=Zr.GET_TASKID){O.next=4;break}return O.abrupt("return",D.taskId);case 4:if(S!=Zr.ONMESSAGE_PROCESS_DATA){O.next=8;break}return O.abrupt("return",H.parse(x));case 8:if(S!=Zr.ONMESSAGE_GET_TASKID){O.next=13;break}if(!D||!D.client){O.next=11;break}return O.abrupt("return",D.client.getRequestTaskId());case 11:O.next=20;break;case 13:if(S!=Zr.HANDLE_RAW_MESSAGE){O.next=20;break}if(R=null==D?void 0:D.userData){O.next=17;break}return O.abrupt("return",!1);case 17:return(P=x).indexOf("Version not found")>=0||P.indexOf("Function not found")>=0?H.isFunction(R.fFun)&&R.fFun():H.isFunction(R.sFun)&&R.sFun(P),O.abrupt("return",P);case 20:case"end":return O.stop()}},C)})),hU.apply(this,arguments)}function qqe(C,x){var S="undefined"!=typeof Symbol&&C[Symbol.iterator]||C["@@iterator"];if(!S){if(Array.isArray(C)||(S=function(U,G){if(U){if("string"==typeof U)return dpe(U,G);var X=Object.prototype.toString.call(U).slice(8,-1);if("Object"===X&&U.constructor&&(X=U.constructor.name),"Map"===X||"Set"===X)return Array.from(U);if("Arguments"===X||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(X))return dpe(U,G)}}(C))||x&&C&&"number"==typeof C.length){S&&(C=S);var T=0,D=function(){};return{s:D,n:function(){return T>=C.length?{done:!0}:{done:!1,value:C[T++]}},e:function(U){throw U},f:D}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var R,P=!0,O=!1;return{s:function(){S=S.call(C)},n:function(){var U=S.next();return P=U.done,U},e:function(U){O=!0,R=U},f:function(){try{P||null==S.return||S.return()}finally{if(O)throw R}}}}function dpe(C,x){(null==x||x>C.length)&&(x=C.length);for(var S=0,T=new Array(x);S<x;S++)T[S]=C[S];return T}function hpe(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function fU(C,x,S){return x.has(C),S}function fpe(C){var x,S=nl.ST_UNKNOWN;return C==tn.ESCLSCANNER?S=nl.ST_ESCL:C==tn.WIFIDIRECTSCANNER?S=nl.ST_WIFI_DIRECT:((x=C)==tn.TWAINSCANNER||x==tn.WIATWAINSCANNER||x==tn.TWAINX64SCANNER||x==tn.ICASCANNER||x==tn.SANESCANNER)&&(S=nl.ST_DYNAMSOFT_SERVICE),S}!function(C){C.SAM_ANONYMOUS=0,C.SAM_PWD=1}(cpe||(cpe={}));var pU=new WeakSet,ppe=new WeakSet,qP=function(C){function x(){var X,ae,ue,ye;n(this,x);for(var z=arguments.length,K=new Array(z),oe=0;oe<z;oe++)K[oe]=arguments[oe];return ae=this,ue=x,ye=[].concat(K),ue=qn(ue),hpe(X=Za(ae,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Ie){return!1}}()?Reflect.construct(ue,ye||[],qn(ae).constructor):ue.apply(ae,ye)),ppe),hpe(X,pU),An(X,"_bInited",!1),An(X,"_currentDevice",void 0),X}return el(x,C),v(x,[{key:"getSources",value:(G=_t(B.mark(function X(z,K,oe){var ae,ue,ye,Ie,Ue,He,Re,Oe,Ge,Se,de,ge,_e,ve;return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(ye="",Ie=!1,Ue=[],He=!1,((Re=null!=z?z:$B)&tn.ESCLSCANNER)==tn.ESCLSCANNER&&(ye="_uscan._tcp.local."),(Re&tn.WIFIDIRECTSCANNER)==tn.WIFIDIRECTSCANNER&&(Ie=!0),0!=ye.length||Ie){Te.next=9;break}return Te.abrupt("return",[]);case 9:return K=null!==(ae=K)&&void 0!==ae&&ae,oe=null!==(ue=oe)&&void 0!==ue?ue:30,Oe={id:this.clientId,cmdId:H.guid(),method:"SearchScanner",parameter:[1,ye,Ie,He,K,oe],version:zp},Te.next=14,this._requestAsync(Oe,3e4,!1);case 14:if(Ge=Te.sent,this._bInited=!0,Se=this.parseResultDefault(Ge),H.isArray(Se)){Te.next=19;break}throw{code:-2612,message:"The devices must be an Array."};case 19:de=qqe(Se),Te.prev=20,de.s();case 22:if((ge=de.n()).done){Te.next=48;break}if(!((_e=ge.value).service_type&&_e.service_type==nl.ST_UNKNOWN||_e.type&&"dynamsoft_private_cloud_scan"!=_e.type&&"twaindirect"!=_e.type)){Te.next=28;break}return Te.abrupt("continue",46);case 28:if(!_e.service_type){Te.next=46;break}Te.t0=_e.service_type,Te.next=Te.t0===nl.ST_DYNAMSOFT_SERVICE?32:Te.t0===nl.ST_ESCL||Te.t0===nl.ST_WIFI_DIRECT?33:46;break;case 32:return Te.abrupt("break",46);case 33:return(ve=new hd).name="",ve.displayName="",ve.deviceType=0,ve.isSystemDefaultPrinter=!1,_e.service_type==nl.ST_ESCL?ve.deviceType=tn.ESCLSCANNER:_e.service_type==nl.ST_WIFI_DIRECT&&(ve.deviceType=tn.WIFIDIRECTSCANNER),ve.name=_e.ty,_e.hostname&&_e.hostname.length>_e.ty.length&&(ve.name=_e.hostname),ve.displayName=(_e.service_type==nl.ST_ESCL?"eSCL-":"")+ve.name,this.bGlobal||(_e.url=this.serverUrl,this.serverName&&(ve.displayName=ve.displayName+" on ["+this.serverName+"]")),ve.serviceInfo=upe(this.serverUrl,_e),Ue.push(ve),Te.abrupt("break",46);case 46:Te.next=22;break;case 48:Te.next=53;break;case 50:Te.prev=50,Te.t1=Te.catch(20),de.e(Te.t1);case 53:return Te.prev=53,de.f(),Te.finish(53);case 56:return Te.abrupt("return",Ue);case 57:case"end":return Te.stop()}},X,this,[[20,50,53,56]])})),function(X,z,K){return G.apply(this,arguments)})},{key:"getCapabilitiesAsync",value:(U=_t(B.mark(function X(z){var K,oe;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return this.checkSource(z),(z.deviceType&tn.ESCLSCANNER)!=tn.ESCLSCANNER&&(z.deviceType&tn.WIFIDIRECTSCANNER)!=tn.WIFIDIRECTSCANNER||(this._currentDevice=z),K=fpe(z.deviceType),oe={id:this.clientId,cmdId:H.guid(),method:"SendRequestToScanner",parameter:["getCapabilities",H.stringify({UUID:z.serviceInfo.attrs.UUID,service_type:K,ty:z.name})],version:zp},ue.next=6,this._requestAsync(oe,0);case 6:return ue.abrupt("return",this.parseResultDefault(ue.sent));case 8:case"end":return ue.stop()}},X,this)})),function(X){return U.apply(this,arguments)})},{key:"selectSourceAsync",value:(O=_t(B.mark(function X(z){var K;return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,this.getCapabilitiesAsync(z);case 2:if(!(K=oe.sent)&&""!=K){oe.next=5;break}return oe.abrupt("return",!0);case 5:case"end":return oe.stop()}},X,this)})),function(X){return O.apply(this,arguments)})},{key:"versionInfo",value:(P=_t(B.mark(function X(){var z,K;return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return z={id:this.clientId,cmdId:H.guid(),method:"VersionInfo",version:zp},oe.next=3,this._requestAsync(z,5e3);case 3:return K=oe.sent,this._bInited=!0,oe.abrupt("return",K);case 6:case"end":return oe.stop()}},X,this)})),function(){return P.apply(this,arguments)})},{key:"getLicenseInfo",value:function(X,z,K){return this._resetLicense(X,z,K)}},{key:"getImageAsArrayBuffer",value:(R=_t(B.mark(function X(z,K){return B.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.abrupt("return",fU(this,pU,gpe).call(this,z,K));case 1:case"end":return oe.stop()}},X,this)})),function(X,z){return R.apply(this,arguments)})},{key:"getImageToDWT",value:(D=_t(B.mark(function X(z,K,oe){return B.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.abrupt("return",fU(this,pU,gpe).call(this,z,K,oe));case 1:case"end":return ae.stop()}},X,this)})),function(X,z,K){return D.apply(this,arguments)})},{key:"acquireImage",value:(T=_t(B.mark(function X(z,K,oe){var ae,ue,ye,Ie,Ue,He,Re;return B.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:z=null!==(ae=z)&&void 0!==ae?ae:this._currentDevice,this.checkSource(z),this._currentDevice=z,ue=fpe(z.deviceType),ye=["scan",H.stringify({UUID:z.serviceInfo.attrs.UUID,service_type:ue})],Ie=fU(this,ppe,Kqe).call(this,K),ye[2]=H.stringify(Ie),Ue={id:this.clientId,cmdId:H.guid(),method:"SendRequestToScanner",parameter:ye,version:zp},He=0;case 10:if(!(He<5)){Ge.next=33;break}return Ge.prev=11,Ge.next=14,this._requestAsync(Ue,0);case 14:return Re=this.parseResultDefault(Ge.sent),H.isObject(Re)&&(Re.device=z,Re.scanOptions=Ie),Ge.abrupt("break",33);case 20:if(Ge.prev=20,Ge.t0=Ge.catch(11),-1004!=Ge.t0.code&&-1001!=Ge.t0.code){Ge.next=29;break}if(!(He>=4)){Ge.next=25;break}throw Ge.t0;case 25:return Ge.next=27,new me.Promise(function(Se,de){setTimeout(Se,2e3)});case 27:Ge.next=30;break;case 29:throw Ge.t0;case 30:He++,Ge.next=10;break;case 33:return Ge.abrupt("return",Re);case 34:case"end":return Ge.stop()}},X,this,[[11,20]])})),function(X,z,K){return T.apply(this,arguments)})},{key:"_resetLicense",value:(S=_t(B.mark(function X(z,K,oe){var ae,ue,ye,Ie;return B.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return this.longKeyOrShortkey=z,this.cu=K,H.isNumber(qP.logLevel)||(qP.logLevel=-1),ae=null!=K?K:"",ue={id:this.clientId,cmdId:H.guid(),method:"GetLicenseInfo",parameter:[z,x.logLevel,ae,oe],version:zp},Ue.prev=5,Ue.next=8,this._requestAsync(ue,1e4);case 8:return ye=Ue.sent,this._bInited=!0,Ue.abrupt("return",this.parseResultDefault(ye));case 13:if(Ue.prev=13,Ue.t0=Ue.catch(5),!this.bLocal){Ue.next=19;break}throw T0(Ie={}),{code:Ie._errorCode,message:Ie._errorString};case 19:throw{code:-2604,message:"Failed to connect to the Proxy Service. Please make sure the Proxy Service is configured successfully, Dynamsoft Service is running, or the certificate is valid."};case 20:case"end":return Ue.stop()}},X,this,[[5,13]])})),function(X,z,K){return S.apply(this,arguments)})}]);var S,T,D,R,P,O,U,G}(Xqe);function gpe(C,x,S){return mpe.apply(this,arguments)}function mpe(){return(mpe=_t(B.mark(function C(x,S,T){var D,R,P,O,G;return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(null!=x&&x.device){X.next=2;break}throw{code:-1011,message:"Operation out of expected sequence"};case 2:return T=null!==(D=T)&&void 0!==D?D:{ver:"",clientId:""},(R=["getImage",H.stringify({UUID:x.device.serviceInfo.attrs.UUID,service_type:S})])[2]=H.stringify(x.scanOptions),R[3]=x.scanJobs,R[4]=x.scanId,R[5]=T._clientId,R[6]=T._ver,P={id:this.clientId,cmdId:H.guid(),method:"SendRequestToScanner",parameter:R,version:zp},X.next=12,this._requestAsync(P,0,!0);case 12:if(!((O=X.sent).headers.get("content-type").indexOf("image/")>=0)){X.next=20;break}return X.next=17,O.arrayBuffer();case 17:return X.abrupt("return",X.sent);case 20:return X.next=22,O.json();case 22:if("boolean"!=typeof(G=this.parseResultDefault(X.sent))){X.next=28;break}return X.abrupt("return",null);case 28:return X.abrupt("return",G);case 29:case"end":return X.stop()}},C,this)}))).apply(this,arguments)}function Kqe(C){var x=[];if(C){H.isNumber(C.PixelType)&&(x.push({capability:bd.ICAP_PIXELTYPE,curValue:C.PixelType}),be.DWT.EnumDWT_PixelType.TWPT_BW==C.PixelType&&(x.push({capability:32771,curValue:"application/octet-stream"}),x.push({capability:32772,curValue:"application/octet-stream"})));var S=C.Resolution;S||(S=300),x.push({capability:bd.ICAP_XRESOLUTION,curValue:S}),x.push({capability:bd.ICAP_YRESOLUTION,curValue:S}),void 0!==C.Brightness&&x.push({capability:bd.ICAP_BRIGHTNESS,curValue:C.Brightness}),void 0!==C.XferCount&&x.push({capability:bd.CAP_XFERCOUNT,curValue:C.XferCount}),void 0!==C.Contrast&&x.push({capability:bd.ICAP_CONTRAST,curValue:C.Contrast}),void 0!==C.TransferMode&&x.push({capability:bd.ICAP_XFERMECH,curValue:C.TransferMode}),void 0!==C.IfFeederEnabled&&x.push({capability:bd.CAP_FEEDERENABLED,curValue:C.IfFeederEnabled?1:0}),void 0!==C.IfDuplexEnabled&&x.push({capability:bd.CAP_DUPLEXENABLED,curValue:C.IfDuplexEnabled?1:0})}return x}var vpe=function(C,x,S){2==S&&H.each(x,function(T,D){Wi(C,T,{get:function(){return C._resetErr(),C._isValid()?Nt:yt},set:function(R){return C._resetErr(),C._isValid()?Nt:yt}})})},ype=function(C,x){H.each(x,function(S,T){G0(C,S,1,2)})},_pe=function(C,x){H.each(x,function(S,T){G0(C,S,1,1)})},Cpe=function(C,x){H.each(x,function(S,T){G0(C,S,0)})},bpe=function(C,x){H.each(x,function(S,T){G0(C,S,1)})};me.DynamicLoadAddonFuns=[],me.attachAddon=function(C){var x=!1;return H.each(me.DynamicLoadAddonFuns,function(S){H.isFunction(S)&&(S(C),x=!0)}),!xo.bFullEdition&&C.__addon&&delete C.__addon.Camera,x};var xpe=v(function C(x,S,T){n(this,C),this.Url=x,this.Width=S,this.Height=T}),Zqe=function(){return v(function x(S){n(this,x),this._stwain=S,this._ImgManager=S._ImgManager},[{key:"Print",value:function(){var x=this;if(x.count()<=0)return!1;var S,T=[];for(S=0;S<x.count();S++)T.push(S);return x.PrintEx(T)}},{key:"PrintCurrentImage",value:function(){var x,S,T,D=this;if(!((x=D._ImgManager.getCurrentImageIndex())<0))return-1==(T=D._ImgManager.convertClientIndexToServerId(x))?(Mt(D),!1):(S=cr.getImageUrl(D._ImgManager.getBaseUrl,T,-1,-1),D.__PrintInner(S,T,x))}},{key:"PrintEx",value:function(x){var S=this;if(!(S.count()<=0)){var T=[];return be.DWT.ConnectWithSocket?S.__GetPrintUrlforSocket(x,T):S.__GetPrintUrlforHttp(x,T),!0}}},{key:"__PrintInner",value:function(x,S,T){var D=this,R=D._ImgManager.getImageIdMap(S),P=[];if(!R)return!1;var O=H.clone(R),U=O.width;(H.isUndefined(O.width)||O.width<=0)&&(O.width=D.getImageWidthFromServer(T));var G=O.height;(H.isUndefined(O.height)||O.height<=0)&&(O.height=D.getImageHeightFromServer(T));var X=new xpe(x,O.width,O.height);return P.push(X),O.width=U,O.height=G,cr.print(P),!0}},{key:"__GetPrintUrl",value:function(x,S,T){var D,R,P=this,O=0,U=0;return(D=P._ImgManager.getImageIdMap(S))&&(!D.width||D.width<=0?D.width=P.getImageWidthFromServer(T):O=D.width,!D.height||D.height<=0?D.height=P.getImageHeightFromServer(T):U=D.height,R=new xpe(x,D.width,D.height),D.width=O,D.height=U),R}},{key:"__GetPrintUrlforHttp",value:(C=_t(B.mark(function x(S,T){var D,R,P,O,U,G,X,K,oe;return B.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:D=this,R=0;case 2:if(!(R<S.length)){ae.next=23;break}if(-1==(O=D._ImgManager.convertClientIndexToServerId(P=S[R]))){ae.next=20;break}if(U=void 0,!(be.navInfoSync.bMac&&be.navInfoSync.bSafari||be.navInfoSync.bFirefox)){ae.next=17;break}if(!(G=D._stwain._ImgManager.getImageIdMap(O))){ae.next=17;break}if(!(X=G.uuid)||-1==X){ae.next=17;break}return ae.next=14,D._stwain.Viewer.webViewer.myDvs.getImageData(X,{type:"blob"});case 14:K=window.URL||window.webkitURL,U=K.createObjectURL(ae.sent);case 17:U||(U=cr.getImageUrl(D._ImgManager.getBaseUrl,O,-1,-1)),oe=D.__GetPrintUrl(U,O,P),T.push(oe);case 20:R++,ae.next=2;break;case 23:cr.print(T);case 24:case"end":return ae.stop()}},x,this)})),function(x,S){return C.apply(this,arguments)})},{key:"__GetPrintUrlforSocket",value:function(x,S){var T,D=this,R=pt.Promise.resolve(0),P=0;return H.each(x,function(O){R=R.then(function(){var U=D._ImgManager.convertClientIndexToServerId(O);-1!=U&&D._ImgManager.getImageData(O).then(function(G){if(P++,!G){var X={};return Jn(X),void Nr(X._errorString)}T=$p(G.oriData)?URL.createObjectURL(new Blob([G.oriData])):G.oriData instanceof Blob?URL.createObjectURL(G.oriData):G.oriData;var z=D.__GetPrintUrl(T,U,O);S.push(z),x.length==P&&cr.print(S)})})}),!0}},{key:"__GetPrintUrlforMobileEx",value:function(x,S){var T,D=this,R=pt.Promise.resolve(0),P=0;return H.each(x,function(O){R=R.then(function(){var U=D._ImgManager.convertClientIndexToServerId(O);-1!=U&&D._ImgManager.getImageData(O).then(function(G){if(P++,!G){var X={};return Jn(X),void Nr(X._errorString)}T=$p(G.oriData)?URL.createObjectURL(new Blob([G.oriData])):G.oriData instanceof Blob?URL.createObjectURL(G.oriData):G.oriData;var z=D.__GetPrintUrl(T,U,O);S.push(z),x.length==P&&cr.print(S)})})}),!0}},{key:"count",value:function(){return this._ImgManager.count()}},{key:"getImageHeightFromServer",value:function(x){var S,T,D,R=this,P=1*x;return S=R.count(),P<0||P>S?0:(D=R._ImgManager.convertClientIndexToServerId(P),(T=R._ImgManager.getImageIdMap(D))&&T.imageHeight?T.imageHeight:R._stwain.GetImageHeight(P))}},{key:"getImageWidthFromServer",value:function(x){var S,T,D,R=this,P=1*x;return S=R.count(),P<0||P>S?0:(D=R._ImgManager.convertClientIndexToServerId(P),(T=R._ImgManager.getImageIdMap(D))&&T.imageWidth?T.imageWidth:R._stwain.GetImageWidth(P))}}]);var C}();function z0(C,x){(function(S,T){if(T.has(S))throw new TypeError("Cannot initialize the same private elements twice on an object")})(C,x),x.add(C)}function Fs(C,x,S){return x.has(C),S}me.detect.viewerScriptLoaded=Nt;var gU=new WeakSet,mU=new WeakSet,wpe=new WeakSet,Spe=new WeakSet,eKe=new WeakSet,xu=new WeakSet,KP=new WeakSet,Tpe=function(C){function x(D){var R,P,O,U,G,X;return n(this,x),P=this,U=[D],O=qn(O=x),z0(R=Za(P,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(X){return!1}}()?Reflect.construct(O,U||[],qn(P).constructor):O.apply(P,U)),KP),z0(R,xu),z0(R,eKe),z0(R,Spe),z0(R,wpe),z0(R,mU),z0(R,gU),R._ImgManager=new Mfe(R,R._imageBufferWrapper),R._imageBufferWrapper=R._ImgManager,R._ImagePrint=new Zqe(R),R._config=G=D||{},R._destroying=yt,R._iServiceType=VP.TwainService,R.__addon={},R._bNoMask=yt,R._bNotShowMessage=yt,R._bSelectedSourceByServer=yt,R._bKeepAwake=yt,R._bAx=yt,G.container&&(R._containerElement=G.container),R.__IfShowCancelDialogWhenImageTransfer=Nt,R._errorCode=0,R._errorString="",R.__bLoadingImage=yt,R.__bAcquireImageNow=yt,R.__bOpenFileNow=yt,R.__defaultSourceName="",R.__sourceCount=0,R._bConnecting=yt,R.__licenseInfo=void 0,R.__strProductName=be.DWT.ProductName,R.__productKey="",R._moduleSize=1048576,R._driverType=Mi.TWAIN,R.__maxUploadImageSize=-1,R._bServerPercentDone=Nt,R._bSSL=he.bSSL,R._bRegistedLoad=!1,R._logLevel=0,R._scaleDownThreshold=0,R._pdfWriteSetting={},R.__serverPlatform=Rn.enumUnknown,R._reconnectTimeSpan=xo.LocaleReconnectTimeSpan,R._bRemoteMode||(R.httpFormFields={},R.HTTPPassword="",R.HTTPPort=me.detect.ssl?443:80,R.HTTPUserName="",R.__HTTPPostResponseString="",R.__remoteFilename="RemoteFile",R.__httpHeaderMap=yt,R._segementUploadThreshold=R._b64bit?4294967296:524288e3,R._aryTiffTag=[],R._tiffCompressionType=be.DWT.EnumDWT_TIFFCompressionType.TIFF_AUTO,R._jpgQuality=80,R._pdfConvertMode=3,R._pdfOptions={convertMode:mr.CM_AUTO,password:"",renderOptions:{renderAnnotations:!1,resolution:200,maxWidth:0,maxHeight:0,renderGrayscale:!1}}),function Qqe(C){var x=C;x._bRemoteMode||(Wi(x,"ProductKey",{get:function(){return be.DWT.ProductKey},set:function(S){return H.isString(S)?(x._resetErr(),!!x._isValid()&&x._setProductKey(S,!1)):(ga(x),yt)}}),Wi(x,"ProductName",{get:function(){return x.__strProductName}}),Wi(x,"VersionInfo",{get:function(){return fu.JSVersion}}),Wi(x,"DefaultSourceName",{get:function(){var S=x._getDefaultDevice();return S?S.displayName:""}}),Wi(x,"ImageCaptureDriverType",{get:function(){return x._resetErr(),x._isValid()?x._driverType:0},set:function(S){var T=!1,D=!1,R=!1;if(x._bRemoteMode?x.__serverPlatform==Rn.enumWindow?R=!0:x.__serverPlatform==Rn.enumLinux?D=!0:x.__serverPlatform==Rn.enumMac&&(T=!0):(T=he.bMac,D=he.bLinux,R=he.bWin),x._resetErr(),!x._isValid())return!1;if(""!==S){var P=1*S,O=!1;if(P<Mi.TWAIN||P>Mi.TWAIN64)return HA(x),yt;if(R){if(P===Mi.TWAIN_AND_TWAIN64)x._b64bit&&(x._driverType=P);else if(P!=Mi.TWAIN&&P!=Mi.TWAIN64)return HA(x),yt;x._b64bit||(P=Mi.TWAIN),x._driverType=P,O=!0}else if(D)x._driverType=P=Mi.SANE,O=!0;else if(T){if(P!==Mi.TWAIN_AND_ICA&&P!=Mi.ICA&&P!=Mi.TWAIN&&P!=Mi.TWAIN64)return HA(x),yt;x._driverType=P,O=!0}return O&&(x._curDevice=null,x.__devices=null),!0}return HA(x),yt}}),Wi(x,"HTTPPostResponseString",{get:function(){return x._resetErr(),x._isValid()&&x.__HTTPPostResponseString?x.__HTTPPostResponseString:""}}),Wi(x,"IfAppendImage",{get:function(){return x._resetErr(),!!x._isValid()&&x.__IfAppendImage},set:function(S){return x._resetErr(),!!x._isValid()&&(H.isBoolean(S)?x.__IfAppendImage=S:(ga(x),yt))}}),Wi(x,"FTPPort",{get:function(){return x._resetErr(),x._isValid()?x._innerFun("FTPPort"):0},set:function(S){return x._resetErr(),!!x._isValid()&&(""!==S?x._innerFun("FTPPort",Et(1*S)):void 0)}}),Wi(x,"JPEGQuality",{get:function(){return x._resetErr(),x._isValid()?x._innerFun("JPEGQuality"):0},set:function(S){var T=1*S;return T>=100?T=100:T<0&&(T=0),x._resetErr(),!!x._isValid()&&x._innerFun("JPEGQuality",Et(T))}}),G0(x,"TIFFCompressionType",1,1),G0(x,"BufferMemoryLimit",1,1),Wi(x,"LogLevel",{get:function(){return x._resetErr(),x._isValid()?x._innerFun("LogLevel"):0},set:function(S){if(x._resetErr(),!x._isValid())return!1;var T=1*S;return x._logLevel=T,qP.logLevel=x._logLevel,x._innerFun("LogLevel",Et(T))}}),Wi(x,"HttpContentTypeFieldValue",{get:function(){return x._resetErr(),x._isValid()?x._strHttpContentTypeFieldValue:""},set:function(S){return x._resetErr(),!!x._isValid()&&(x._strHttpContentTypeFieldValue=S,S)}}),Wi(x,"BrokerProcessType",{get:function(){return x._resetErr(),x._isValid()?1:0},set:function(S){return x._resetErr(),!!x._isValid()}}),Wi(x,"BorderStyle",{get:function(){return x._resetErr(),!!x._isValid()&&0},set:function(S){return x._resetErr(),x._isValid(),!1}}),Wi(x,"HttpFieldNameOfUploadedImage",{get:function(){return x._resetErr(),x._isValid()?x.__remoteFilename:""},set:function(S){return x._resetErr(),x._isValid()?x.__remoteFilename=S:""}}),Wi(x,"style",{get:function(){return x._isValid()?x.__style:""}}),Wi(x,"ScaleDownThreshold",{get:function(){return x._resetErr(),x._isValid()?x._scaleDownThreshold:0},set:function(S){var T=1*S;return!H.isNumber(T)||isNaN(T)?(ga(self),yt):(x._resetErr(),!!x._isValid()&&(x._scaleDownThreshold=S))}}),Wi(x,"CurrentImageIndexInBuffer",{get:function(){return x._isValid()&&x._ImgManager?x._ImgManager.getCurrentImageIndex():0},set:function(S){var T=1*S;return x._resetErr(),!!x._isValid()&&(T>=0&&T<x._ImgManager.count()&&(x._ImgManager.setSelectedClientIndexArray([T]),x._isBindViewer()&&vh.__innerRefreshFromUIView(x,x._ImgManager.getCurrentImageIndex())),!0)}}),Wi(x,"SelectedImagesIndices",{get:function(){return x._resetErr(),x._isValid()?x._ImgManager.count()<=0?[]:x._ImgManager.getSelectedClientIndexArray():[]}}),Wi(x,"MaxImagesInBuffer",{get:function(){return x._resetErr(),x._isValid()?x.__maxImagesInBuffer:0},set:function(S){var T=1*S;return x._resetErr(),!!x._isValid()&&(T>0&&T<32768?x.__maxImagesInBuffer=T:St(x,-1010,"Data parameter out of supported range."),x.__maxImagesInBuffer)}}),Wi(x,"IfSSL",{get:function(){return x._bSSL},set:function(S){return x._bSSL=S,x._innerFun("IfSSL",Et(S)),!0}}),G0(x,"IfAllowLocalCache",1,2),Wi(x,"UseLocalService",{get:function(){return!0}}),Wi(x,"PDFCompressionType",{get:function(){return x._resetErr(),!!x._isValid()&&x._innerFun("PDFCompressionType")},set:function(S){var T=1*S;return T==be.DWT.EnumDWT_PDFCompressionType.PDF_FAX3&&(T=be.DWT.EnumDWT_PDFCompressionType.PDF_FAX4),x._resetErr(),!!x._isValid()&&x._innerFun("PDFCompressionType",Et(T))}}),x._setProductKey=function(S,T,D,R){var P=!0,O=S,U=function(X){X||(x.__licenseInfo=void 0);var z=!0;return R||(z=mn.checkProductKey(x,{Core:!0})),H.isFunction(D)&&D(),z};if(x._resetErr(),!x._isValid())return!1;if(O=H.isString(O)?H.trim(O):"",be.DWT.ProductKey=O,""==O)P=!1,U();else{mn.reparseProductKey();var G=be.DWT.licenseException;if(0!=G.code)return x.__licenseInfo=void 0,x._errorCode=G.code,x._errorString=G.message,H.isFunction(D)&&D(),!1;x._innerFunRaw("ProductKey",Et(O),T,!1,!1,function(X){var z;z=H.isArray(X)?X[0]:X,H.isArray(X)&&X.length>=3&&"1"===X[1]&&H.isFunction(be.DWT.ShowMessage)&&be.DWT.ShowMessage(X[2],{width:510,height:272,headerStyle:1,seconds:10}),T||(P=z),x.__licenseInfo=void 0,x.GetLicenseInfo(function(){x._setConvertMode(x._pdfConvertMode),U(!0)},U)},function(){T||(P=!1),U()})}return P},bpe(x,["ProxyServer"]),bpe(x,["CapValueString","CapDescription","FTPPassword","FTPUserName","PDFAuthor","PDFCreationDate","PDFCreator","PDFKeywords","PDFModifiedDate","PDFProducer","PDFSubject","PDFTitle","PDFVersion"]),Cpe(x,["Manufacturer","ProductFamily","ImageBitsPerPixel","ImageLength","ImageWidth","ImageXResolution","ImageYResolution"]),Cpe(x,["BlankImageCurrentStdDev","CapDefaultIndex","CapDefaultValue","DataSourceStatus","Duplex","PendingXfers","ImageLayoutDocumentNumber","ImageLayoutFrameBottom","ImageLayoutFrameLeft","ImageLayoutFrameNumber","ImageLayoutFrameRight","ImageLayoutFrameTop","ImageLayoutPageNumber","ImagePixelType","MagData","MagType","IfFeederLoaded","IfPaperDetectable","IfUIControllable"]),ype(x,["AllowPluginAuthentication","IfModalUI","IfScanInNewThread","_AutoCropMethod","IfSortBySelectionOrder"]),ype(x,["IfDisableSourceAfterAcquire","IfDuplexEnabled","IfFeederEnabled","IfPASVMode","IfAutoBright","IfAutoDiscardBlankpages","IfAutoFeed","IfAutomaticBorderDetection","IfAutomaticDeskew","IfAutoScan","IfShowIndicator","IfUseTwainDSM","IfTiffMultiPage"]),_pe(x,["MaxInternetTransferThreads"]),_pe(x,["BlankImageMaxStdDev","BlankImageThreshold","BitDepth","Brightness","PageSize","PixelType","Resolution","Capability","CapCurrentIndex","CapCurrentValue","CapMaxValue","CapMinValue","CapNumItems","CapStepSize","CapType","CapValue","CapValueType","Contrast","PixelFlavor","TransferMode","Unit","XferCount"]),vpe(x,["AsyncMode","EnableInteractiveZoom","IfThrowException","ImageEditorIfEnableEnumerator","ImageEditorIfReadonly","ImageEditorIfModal","ImageEditorWindowTitle","IfShowPrintUI","VScrollBar"],2),vpe(x,["IfOpenImageWithGDIPlus"]))}(R),Wi(X=R,"Width",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("Width"),""):X._UIView.GetWidth():""},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("Width"):X._UIView.SetWidth(z))}}),Wi(X,"Height",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("Height"),""):X._UIView.GetHeight():""},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("Height"):X._UIView.SetHeight(z))}}),Wi(X,"AllowMultiSelect",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?X._nouiNotSupport("AllowMultiSelect"):X._UIView.GetAllowMultiSelect():""},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("AllowMultiSelect"):void X._UIView.SetAllowMultiSelect(z))}}),Wi(X,"BackgroundColor",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("BackgroundColor"),""):X._UIView.GetBackgroundColor():""},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("BackgroundColor"):X._UIView.SetBackgroundColor(z))}}),Wi(X,"BackgroundFillColor",{get:function(){if(X._resetErr(),!X._isValid())return"";if(X._isNoViewer())return X._nouiNotSupport("BackgroundFillColor"),"";var z=X._innerFun("BackgroundFillColor");return ad.BGR2RGB(z)},set:function(z){if(X._resetErr(),!X._isValid())return!1;if(X._isNoViewer())return X._nouiNotSupport("BackgroundFillColor");var K,oe=1*z;return!H.isNumber(oe)||H.isNaN(oe)?(ga(X),yt):(K=ad.RGB2BGR(oe),X._innerFun("BackgroundFillColor",Et(K)))}}),Wi(X,"FitWindowType",{get:function(){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?(X._nouiNotSupport("FitWindowType"),0):X._UIView.GetFitWindowType())},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("FitWindowType"):X._UIView.SetFitWindowType(1*z))}}),Wi(X,"IfFitWindow",{get:function(){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("IfFitWindow"):X._UIView.GetIfFitWindow())},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("IfFitWindow"):X._UIView.SetIfFitWindow(!!z))}}),Wi(X,"ImageMargin",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("ImageMargin"),0):X._UIView.GetImageMargin():0},set:function(z){if(X._resetErr(),!X._isValid())return!1;if(X._isNoViewer())return X._nouiNotSupport("ImageMargin");var K=parseInt(z);return!isNaN(K)&&X._UIView.SetImageMargin(K)}}),Wi(X,"MouseX",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("MouseX"),0):X.__MouseX:0}}),Wi(X,"MouseY",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("MouseY"),0):X.__MouseY:0}}),Wi(X,"SelectionImageBorderColor",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("SelectionImageBorderColor"),""):X._UIView.GetSelectionImageBorderColor():""},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("SelectionImageBorderColor"):X._UIView.SetSelectionImageBorderColor(z))}}),Wi(X,"Zoom",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("Zoom"),0):X._UIView.GetZoom():0},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("Zoom"):X._UIView.SetZoom(z))}}),Wi(X,"MouseShape",{get:function(){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("MouseShape"):X._UIView.GetMouseShape())},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("MouseShape"):X._UIView.SetMouseShape(z))}}),Wi(X,"SelectionRectAspectRatio",{get:function(){return X._resetErr(),X._isValid()?X._isNoViewer()?(X._nouiNotSupport("SelectionRectAspectRatio"),0):X._UIView.GetSelectionRectAspectRatio():0},set:function(z){if(X._resetErr(),!X._isValid())return!1;if(X._isNoViewer())return X._nouiNotSupport("SelectionRectAspectRatio");var K=parseFloat(z);return K>=0&&(X._UIView.SetSelectionRectAspectRatio(K),!0)}}),Wi(X,"ShowPageNumber",{get:function(){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("ShowPageNumber"):X._UIView.GetShowPageNumber())},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("ShowPageNumber"):X._UIView.SetShowPageNumber(z))}}),Wi(X,"IfAutoScroll",{get:function(){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("IfAutoScroll"):X._UIView.GetIfAutoScroll())},set:function(z){return X._resetErr(),!!X._isValid()&&(X._isNoViewer()?X._nouiNotSupport("IfAutoScroll"):X._UIView.SetIfAutoScroll(z))}}),R._innerInitEvents(G),R}return el(x,C),v(x,[{key:"GetImageDataAsync",value:function(D){return this._ImgManager.getImageData(D)}},{key:"SetCustomDataAsync",value:function(D,R){return this._ImgManager.setCustomData(D,R)}},{key:"style",get:function(){return this.__style}},{key:"GetSourceNamesAsync",value:(T=_t(B.mark(function D(R){var P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if((P=this)._resetErr(),P._isValid()){O.next=4;break}throw{code:P._errorCode,message:P._errorString};case 4:return Wo("GetSourceNamesAsync",P),O.prev=5,O.next=8,P._getSourceCountAsync(P._driverType);case 8:O.next=13;break;case 10:throw O.prev=10,O.t0=O.catch(5),O.t0;case 13:return O.prev=13,Xr("GetSourceNamesAsync"),O.finish(13);case 16:if(!R){O.next=20;break}return O.abrupt("return",Fs(P,gU,Ipe).call(P));case 20:return O.abrupt("return",Fs(P,mU,Epe).call(P));case 21:case"end":return O.stop()}},D,this,[[5,10,13,16]])})),function(D){return T.apply(this,arguments)})},{key:"SelectSourceAsync",value:function(D){return this._selectSourceAsync("SelectSourceAsync",D,Os.dialogText.selectSource)}},{key:"SelectSourceByIndexAsync",value:function(D){return this._selectSourceByIndexAsync("SelectSourceByIndex",D)}},{key:"OpenSourceAsync",value:function(){return this._openSourceAsync("OpenSourceAsync")}},{key:"CloseSourceAsync",value:function(){return this._closeSourceAsync("CloseSourceAsync")}},{key:"OpenSourceManagerAsync",value:function(){var D=this;return D._resetErr(),D._isValid()?D._innerFunV2("OpenSourceManager"):me.Promise.reject({code:D._errorCode,message:D._errorString})}},{key:"CloseSourceManagerAsync",value:function(){var D=this;return D._resetErr(),D._isValid()?D._innerFunV2("CloseSourceManager"):me.Promise.reject({code:D._errorCode,message:D._errorString})}},{key:"AcquireImage",value:function(D,R,P){var O,U=this,G=null,X=null;return U._resetErr(),!!U._isValid()&&(H.isUndefined(P)&&(H.isFunction(D)&&H.isFunction(R)||H.isFunction(D)&&H.isUndefined(R)||H.isFunction(D)&&null==R||null==D&&H.isFunction(R))?(O={},H.isFunction(D)&&(G=D),H.isFunction(R)&&(X=function(z){z&&z.code&&(U._errorCode=z.code,U._errorString=z.message),R(U._errorCode,U._errorString)})):(O=H.isUndefined(D)||null==D?{}:H.clone(D),H.isFunction(R)&&(G=function(){R(O)}),H.isFunction(P)&&(X=function(z){z&&z.code&&(U._errorCode=z.code,U._errorString=z.message),P(O,U._errorCode,U._errorString)})),G||(G=function(){}),X||(X=function(z){z&&z.code&&(U._errorCode=z.code,U._errorString=z.message)}),U.AcquireImageAsync(O).then(G,X),!Ql.isServerInvalid(U))}},{key:"GetDevicesAsync",value:function(D,R,P){return this._getDevicesAsync("GetDevicesAsync",D,R,P)}},{key:"SelectDeviceAsync",value:function(D,R){var P=this;return P._resetErr(),P._isValid()?this._selectDeviceAsync("SelectDeviceAsync",D,R):me.Promise.reject({code:P._errorCode,message:P._errorString})}},{key:"AcquireImageAsync",value:function(D){return va(qn(x.prototype),"_acquireImage",this).call(this,this._curDevice,D)}},{key:"ImageIDToIndex",value:function(D){return this._uidFromServer2index(D)}},{key:"IndexToImageID",value:function(D){return this._index2uidFromServer(D)}},{key:"RemoveImage",value:function(D){return this._removeImage("RemoveImage",D)}},{key:"_innerGetSourceNamesSync",value:function(D){var R=this;return R._getSourceCountSync(),D?Fs(R,gU,Ipe).call(R):Fs(R,mU,Epe).call(R)}},{key:"getCapabilities",value:function(D,R,P){var O,U,G,X=this;return me.isFunction(D)?(U=D,G=R):(O=D,U=R,G=P),!H.isUndefined(O)&&(!H.isArray(O)||H.isArray(O)&&O.indexOf(null)>=0||H.isString(O)&&0==O.trim().length)?(Bi(X),void(H.isFunction(G)&&G(X._errorCode,X._getErrorString()))):this._dwtGetCapabilities(O,U,G)}},{key:"setCapabilities",value:function(D,R,P){return this._dwtSetCapabilities(D,R,P)}},{key:"CancelAllPendingTransfers",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CancelAllPendingTransfers")}},{key:"CloseSource",value:function(){var D=this;if(D._resetErr(),!D._isValid())return!1;var R=D._innerFun("CloseSource");return R&&(D._curDevice=null),R}},{key:"CloseSourceManager",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("CloseSourceManager")}},{key:"SelectDevice",value:function(D,R){var P,O=this;if(O._resetErr(),be.DWT.ConnectWithSocket)return St(O,-2400,"SelectDevice doesn't work under current settings."),!1;var U,G=null===(P=this._dmService.attrs)||void 0===P?void 0:P.UUID;if(G&&(null===(U=D.serviceInfo.attrs)||void 0===U?void 0:U.UUID)!=G){var X,z=(null===(X=D.serviceInfo.attrs)||void 0===X?void 0:X.url)||D.serviceInfo.server;if(!(z&&z.indexOf(G)>-1))return zle(O),!1}var K=!1;try{(K=Fs(this,wpe,tKe).call(this,D.strDevice,R))&&(this._curDevice=D,this._bSelectedSourceByServer=!1)}catch(oe){K=!1,this._errorCode=Xn.CommonError,oe&&oe.message&&(this._errorString=oe.message)}return K}},{key:"DisableSource",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("DisableSource")}},{key:"FeedPage",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("FeedPage")}},{key:"GetDeviceType",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("GetDeviceType")}},{key:"GetSourceNameItems",value:function(D){var R=this;return R._resetErr(),!!R._isValid()&&(R.__sourceCount<0&&(R.__sourceCount=0),D<R.__sourceCount&&D>=0?R._getSourceNameByIndex(D):"")}},{key:"SourceNameItems",value:function(D){var R=this;return R._resetErr(),!!R._isValid()&&R.GetSourceNameItems(D)}},{key:"GetSourceNames",value:function(D){return this._innerGetSourceNamesSync(D)}},{key:"getSourceCount",value:function(D){return this._getSourceCountAsync(D)}},{key:"GetSourceCountAsync",value:function(D){return this._getSourceCountAsync(D)}},{key:"GetSourceType",value:function(D){var U,G,R=this,P=parseInt(D);return R._resetErr(),isNaN(P)?(Bi(R),!1):(null==R.__devices&&R.GetSourceNames(!1),P>=R.__devices.length||P<0?(Mt(R),!1):(U=Mi.TWAIN,(G=R.__devices[P].deviceType&pHe)==tn.TWAINSCANNER||G==tn.WIATWAINSCANNER||(G==tn.TWAINX64SCANNER?U=Mi.TWAIN64:G==tn.ICASCANNER?U=Mi.ICA:G==tn.SANESCANNER?U=Mi.SANE:(G&tn.TWAINX64SCANNER)==tn.TWAINX64SCANNER?(G&tn.TWAINSCANNER)!=tn.TWAINSCANNER&&(G&tn.WIATWAINSCANNER)!=tn.WIATWAINSCANNER||(U=Mi.TWAIN_AND_TWAIN64):(G&tn.ICASCANNER)==tn.ICASCANNER&&((G&tn.TWAINSCANNER)!=tn.TWAINSCANNER&&(G&tn.WIATWAINSCANNER)!=tn.WIATWAINSCANNER||(U=Mi.TWAIN_AND_ICA))),U))}},{key:"OpenSource",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&(D._bRemoteMode?(St(D,-2610,"OpenSource is not supported when Object is created by CreateRemoteScanObjectAsync. Please use OpenSourceAsync instead."),!1):D._innerFun("OpenSource"))}},{key:"OpenSourceManager",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("OpenSourceManager")}},{key:"ResetImageLayout",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("ResetImageLayout")}},{key:"RewindPage",value:function(){var D=this;return D._resetErr(),!!D._isValid()&&D._innerFun("RewindPage")}},{key:"SelectSource",value:function(D,R){var P=this,O=!1;if(H.isFunction(D)&&(O=!0),P._resetErr(),!P._isValid())return!!O&&void 0;var U=Mi.TWAIN;if(!O){if(P._bRemoteMode)return St(P,-2438,"SelectSource cannot be used synchronously when Object is created by CreateRemoteScanObjectAsync. Please use SelectSourceAsync instead."),!1;if(P._driverType==Mi.TWAIN_AND_TWAIN64)return St(P,-2429,"The method SelectSource() must be invoked asynchronously (i.e. with callback functions) when ImageCaptureDriverType is set to TWAIN_AND_ICA or TWAIN_AND_TWAIN64."),!1;P._driverType!=Mi.ICA&&P._driverType!=Mi.SANE&&P._driverType!=Mi.TWAIN64||(U=P._driverType);var z=cP(U,he.bWin,he.bLinux,he.bMac,he.bAndroid);return P._bSelectedSourceByServer=!0,P._curDevice=null,P._innerFun("SelectSource",Et(z))}P._driverType!=Mi.ICA&&P._driverType!=Mi.SANE&&P._driverType!=Mi.TWAIN64&&P._driverType!=Mi.TWAIN_AND_TWAIN64||(U=P._driverType);var ae=cP(U,he.bWin,he.bLinux,he.bMac,he.bAndroid);P.SelectSourceAsync(ae).then(function(){H.isFunction(D)&&D()},function(ue){ue&&ue.code&&(P._errorCode=ue.code,P._errorString=ue.message),H.isFunction(R)&&R(P._errorCode,P._getErrorString())})}},{key:"GetSourceTypeAsync",value:function(D){var R=this,P=1*D;return R._resetErr(),R._isValid()?me.Promise.resolve(R.GetSourceType(P)):me.Promise.reject({code:R._errorCode,message:R._errorString})}},{key:"SetFileXferInfo",value:function(D,R){var P,O,U=this;return U._resetErr(),!!U._isValid()&&(P=he.bFileSystem?D.replace(/<%/g,"<%25"):D,O=zn.replaceLocalFilename(P),U._innerFun("SetFileXferInfo",Et(O,R)))}},{key:"SetImageLayout",value:function(D,R,P,O){var U=this;return U._resetErr(),!!U._isValid()&&U._innerFun("SetImageLayout",Et(D,R,P,O))}},{key:"CapGet",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGet")}},{key:"CapGetCurrent",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetCurrent")}},{key:"CapGetDefault",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetDefault")}},{key:"CapGetFrameBottom",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameBottom",Et(D))}},{key:"CapGetFrameLeft",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameLeft",Et(D))}},{key:"CapGetFrameRight",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameRight",Et(D))}},{key:"CapGetFrameTop",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetFrameTop",Et(D))}},{key:"CapGetHelp",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetHelp")}},{key:"CapGetLabel",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetLabel")}},{key:"CapGetLabels",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapGetLabels")}},{key:"CapIfSupported",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("CapIfSupported",Et(D))}},{key:"CapReset",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapReset")}},{key:"CapSet",value:function(){return this._resetErr(),!!this._isValid()&&this._innerFun("CapSet")}},{key:"CapSetFrame",value:function(D,R,P,O,U){return this._resetErr(),!!this._isValid()&&this._innerFun("CapSetFrame",Et(D,R,P,O,U))}},{key:"GetCapItems",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("GetCapItems",Et(D))}},{key:"GetCapItemsString",value:function(D){return this._resetErr(),!!this._isValid()&&this._innerFun("GetCapItemsString",Et(D))}},{key:"SetCapItems",value:function(D,R){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCapItems",Et(D,R))}},{key:"SetCapItemsString",value:function(D,R){return this._resetErr(),!!this._isValid()&&this._innerFun("SetCapItemsString",Et(D,R))}},{key:"GenerateURLForUploadData",value:function(D,R,P,O,U){var G=this,X=[];if(R==be.DWT.EnumDWT_ImageType.IT_BMP||R==be.DWT.EnumDWT_ImageType.IT_JPG||R==be.DWT.EnumDWT_ImageType.IT_PNG){if(!H.isArray(D))return tC(G),H.isFunction(O)&&O(G._errorCode,G._getErrorString(),"",D,R),"";if(D.length>1)return eC(G),H.isFunction(O)&&O(G._errorCode,G._getErrorString(),"",D,R),"";if(!G._checkIndices(D))return O(G._errorCode,G._getErrorString(),"",D,R),!1;var z=G._ImgManager.convertClientIndexToServerId(D[0]);-1!=z&&X.push(z)}else{if(R!=be.DWT.EnumDWT_ImageType.IT_TIF&&R!=be.DWT.EnumDWT_ImageType.IT_PDF)return H.isArray(D)?Kl(G):tC(G),H.isFunction(O)&&O(G._errorCode,G._getErrorString(),G.__HTTPPostResponseString,D,R),"";var K,oe;if(H.isArray(D)){if(!G._checkIndices(D))return O(G._errorCode,G._getErrorString(),"",D,R),!1;K=D}else{if(-1!=D)return tC(G),H.isFunction(O)&&O(G._errorCode,G._getErrorString(),G.__HTTPPostResponseString,D,R),"";for(K=[],oe=0;oe<G._ImgManager.count();oe++)K.push(oe)}H.each(K,function(ae){var ue=G._ImgManager.convertClientIndexToServerId(ae);-1!=ue&&X.push(ue)})}return H.isFunction(P)&&H.isFunction(O)?(G._asyncGenerateURLForUploadData(X,R,U,P,function(ae){O(G._errorCode,G._getErrorString(),G.__HTTPPostResponseString,ae,R)}),!0):this._syncGenerateURLForUploadData(X,R,U)}},{key:"_syncGenerateURLForUploadData",value:function(D,R,P){var O,U=this,G=!1,X=$n.managerVersion.join(""),z=P,K=",";H.isString(z)&&""!=z||(z="",K="");var oe=["[",'"dcp","dwasm_'+X,'",',R,',"',D.join(","),'"',K,z,"]"].join("");return(O=this._innerFunRaw("GenerateURLForUploadData",oe,!1,!1,!0))&&H.isArray(O.result)&&O.result.length>1&&1==O.result[0]&&(G=["dcp://dwasm_",X,"/file/",O.result[1]].join("")),H.isArray(D)&&H.each(D,function(ye){U._ImgManager.convertServerIdToClientIndex(ye)}),0==G?(uB(U),""):G}},{key:"_asyncGenerateURLForUploadData",value:function(D,R,P,O,U){var G=this,X=R,z=function(){if(H.isFunction(U)){var Ie=[];H.isArray(D)&&H.each(D,function(Ue){var He=G._ImgManager.convertServerIdToClientIndex(Ue);He>-1&&Ie.push(He)}),U(Ie)}return""},K=",";if(X==be.DWT.EnumDWT_ImageType.IT_BMP||X==be.DWT.EnumDWT_ImageType.IT_JPG||X==be.DWT.EnumDWT_ImageType.IT_PNG){if(D.length>1)return eC(G),z(),""}else if(X!=be.DWT.EnumDWT_ImageType.IT_TIF&&X!=be.DWT.EnumDWT_ImageType.IT_PDF)return Kl(G),z(),"";var oe=!1,ae=$n.managerVersion.join(""),ue=P;H.isString(ue)&&""!=ue||(ue="",K="");var ye=["[",'"dcp","dwasm_'+ae,'",',X,',"',D.join(","),'"',K,ue,"]"].join("");return this._innerFunRaw("GenerateURLForUploadData",ye,!0,!1,!0,function(Ie){if(Ie&&H.isArray(Ie.result)&&Ie.result.length>0?1==Ie.result[0]&&Ie.result.length>1?oe=["dcp://dwasm_",ae,"/file/",Ie.result[1]].join(""):void 0!==Ie.exception&&void 0!==Ie.description?(G._errorCode=Ie.exception,G._errorString=Ie.description):uB(G):uB(G),0==oe)return z(),"";if(H.isFunction(O)){var He=[];H.isArray(D)&&H.each(D,function(Re){var Oe=G._ImgManager.convertServerIdToClientIndex(Re);Oe>-1&&He.push(Oe)}),O(oe,He,R)}return oe},z)}},{key:"SelectSourceByIndex",value:function(D){var R=this,P=parseInt(D);return R._resetErr(),isNaN(P)?(Bi(R),!1):(null==R.__devices&&R.GetSourceNames(!1),P>=R.__devices.length||P<0?(Mt(R),!1):R.SelectDevice(R.__devices[P]))}},{key:"EnableSource",value:function(D,R,P){var O=this;return O._resetErr(),!!O._isValid()&&O.AcquireImage(D,R,P)}},{key:"SourceCount",get:function(){return this._getSourceCountSync()}},{key:"CurrentSourceName",get:function(){return this._curDevice?this._curDevice.displayName:""}},{key:"checkStartScanParams",value:function(D,R){var P=this;if(!D)return St(P,-2381,"scanSetup is invalid."),!1;if(!H.isUndefined(R.transferMode)&&0!=D.transferMode&&1!=D.transferMode&&2!=D.transferMode)return St(P,-2382,"Scanner setup error: Invalid Transfer Mode."),!1;if(D.transferMode==be.DWT.EnumDWT_TransferMode.TWSX_FILE){if(!D.fileXfer)return St(P,-2383,"Scanner setup error: fileXfer is invalid."),!1;if(!H.isString(D.fileXfer.fileName)||""==D.fileXfer.fileName)return function(O){St(O,-2384,"Scanner setup error: Invalid fileName in fileXfer.")}(P),!1;if(!H.isNumber(D.fileXfer.fileFormat)||D.fileXfer.fileFormat<0||D.fileXfer.fileFormat>16)return function(O){St(O,-2385,"Scanner setup error: Invalid fileFormat in fileXfer.")}(P),!1}if(R){if(!H.isString(R.type)||""==R.type)return function(O){St(O,-2387,"Output setup error: Invalid type in outputSetup.")}(P),!1;if(!R.httpParams)return function(O){St(O,-2386,"Output setup error: Invalid httpParams in outputSetup.")}(P),!1;if(D.transferMode!=be.DWT.EnumDWT_TransferMode.TWSX_FILE&&H.isUndefined(R.format))return function(O){St(O,-2390,"Output setup error: Invalid format in outputSetup.")}(P),!1;if(!H.isString(R.httpParams.url)||""==R.httpParams.url)return function(O){St(O,-2388,"Output setup error: Invalid url in outputSetup.httpParams.")}(P),!1;if(!H.isString(R.httpParams.fileName)||""==R.httpParams.fileName)return function(O){St(O,-2389,"Output setup error: Invalid fileName in outputSetup.httpParams.")}(P),!1}return!0}},{key:"startScan",value:function(D){var R,P=this,O=D;if(P._resetErr(),!P._isValid())return!1;if(1==P._startScanFlag)return St(R={},-2432,"Operation in progress, please try again when the current operation has finished."),me.Promise.reject({code:R._errorCode,message:R._errorString});P._startScanFlag=!0,H.isObject(O)||(O={});var U,G,X,z=!1,K=!1,oe=!0,ae=!0,ue=!0,ye=!1,Ie=O.onFinally,Ue=[],He=[],Re=0,Oe=1,Ge=[],Se={type:"http",format:be.DWT.EnumDWT_ImageType.IT_PDF,reTries:3,useUploader:!1,singlePost:!0,showProgressBar:!0,removeAfterOutput:!0,httpParams:{url:"",headers:{},formFields:{},remoteName:"RemoteFile",fileName:""}},de=H.clone(O),ge=O;if(X=de.funcScanStatus,delete de.funcScanStatus,de.bfuncScanStatus=!!H.isFunction(X),de.outputSetup){var _e={pdfSetup:{},tiffSetup:{}};iKe(de.outputSetup,Se),G=de.outputSetup,delete de.outputSetup,G.pdfSetup&&(G.format!=be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF&&G.format!=be.DWT.EnumDWT_ImageType.IT_PDF||H.mix(_e.pdfSetup,G.pdfSetup)),G.tiffSetup&&(G.format!=be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&G.format!=be.DWT.EnumDWT_ImageType.IT_TIF||H.mix(_e.tiffSetup,G.tiffSetup)),G.format!=be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF&&G.format!=be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF||(G.singlePost=!0),G.httpParams&&H.isNumber(G.httpParams.threads)&&(Oe=G.httpParams.threads),z=H.stringify(_e),K=P.checkStartScanParams(de,G)}else(G=Se).type="",K=P.checkStartScanParams(de,!1);if(!K)return new me.Promise(function(Hn,di){oe&&(di({code:P._errorCode,message:P._getErrorString(),response:""}),oe=!1,P._startScanFlag=!1)});G.funcHttpUploadStatus&&(ye=G.funcHttpUploadStatus);var ve,Te,We,Ye,Be,$e,ze=P.__remoteFilename,Ct=P.MaxUploadImageSize,bt=P.IfShowProgressBar,Vt=P.__OnPostTransferAsync,In=P.__OnPostAllTransfers,yn=P.__OnHttpUploadStatus,xt=P.__insertingIndex,Pt=P.__IfAppendImage,It=P.httpFormFields,Wt=P._tiffCompressionType,en=!1,Cn=G.showProgressBar;if(ve=function(Hn){var di=!0;H.each(Ge,function(Gt,Ss){-1==Gt.st&&(di=!1)}),di?Te(Hn):setTimeout(function(){ve(Hn)},200)},Te=function(Hn){Hn.__OnPostTransferAsync=Vt,Hn.__OnPostAllTransfers=In,Hn.__OnHttpUploadStatus=yn,Hn.__remoteFilename=ze,Hn.__maxUploadImageSize=Ct,Hn.IfShowProgressBar=bt,Hn.__insertingIndex=xt,Hn.__IfAppendImage=Pt,Hn.httpFormFields=It,Hn._tiffCompressionType=Wt,be.FileUploader&&(be.FileUploader.nextLoopTime=600),Hn._startScanFlag=!1},We=function(Hn,di,Gt){ae?(di(Gt),ve(Hn)):setTimeout(function(){We(Hn,di,Gt)},200)},Ye=function(Hn,di){en=!0,oe&&(oe=!1,ae||P._innerSendCmd("CancelAllPendingTransfers"),We(P,Hn,di))},Be=function(Hn,di,Gt,Ss){if(H.isFunction(ye)){var og,Ar=di,Mr=0;H.isNumber(Ss)&&Ss>0&&(Mr=Ss),og={fileName:Ar,percentage:Gt,statusCode:Mr,responseString:Hn.__HTTPPostResponseString},setTimeout(function(){ye(og)},10)}},P.__HTTPPostResponseString="",P.IfShowProgressBar=Cn,H.isNumber(de.insertingIndex)&&de.insertingIndex>-1&&(P.__insertingIndex=de.insertingIndex,P.__IfAppendImage=!1),P.__OnHttpUploadStatus=!!H.isFunction(ye)&&ye,G.useUploader&&!be.FileUploader)return new me.Promise(function(Hn,di){St(P,-2380,"Please make sure the Uploader Module has been installed.");var Gt={code:P._errorCode,message:P._getErrorString(),response:""};ae=!0,Ye(di,Gt)});if(U=G.reTries,G.useUploader){if(G.httpParams&&($e=G.httpParams.url),!H.startsWith($e,"http://")&&!H.startsWith($e,"https://")){var hn=window.location.href,Dr=hn.lastIndexOf("/");hn=hn.substring(0,Dr+1),G.httpParams.url=hn+$e}}else G.httpParams&&(H.each(G.httpParams.headers,function(Hn,di){P.SetHTTPHeader(di,Hn)}),H.each(G.httpParams.formFields,function(Hn,di){P.SetHTTPFormField(di,Hn)}));return G.httpParams&&""!==G.httpParams.remoteName&&(P.__remoteFilename=G.httpParams.remoteName),new me.Promise(function(Hn,di){G.useUploader?be.FileUploader.Init(0,function(Gt){Hn({uploadManager:Gt})},function(Gt,Ss){P._errorCode=Gt,P._errorString=Ss,ae=!0,Ye(di,{code:Gt,message:Ss,response:P.__HTTPPostResponseString})}):Hn({})}).then(function(Hn){return new me.Promise(function(di,Gt){var Ss=function Ar(){(de.transferMode==be.DWT.EnumDWT_TransferMode.TWSX_FILE?Re==He.length:Re==Ue.length)?(me.closeProgress(null,"Scan Upload"),en=!0,di(ge),Te(P)):setTimeout(Ar,100)};X&&H.isFunction(X)&&(P.__OnPreAllTransfersAsync=function(Ar){X(Ar)}),P.registerEvent("OnPostTransferAsync",function(Ar){var Mr,Ho,Vm,il,Il,Da,wd=G.httpParams&&G.httpParams.url,Ts=P._uidFromServer2ServerId(Ar.imageId),Aa=G.singlePost,Go=de.transferMode==be.DWT.EnumDWT_TransferMode.TWSX_FILE,Sd=G.removeAfterOutput,ya=0;if(ue&&(ae=!1,ue=!1),Go?(ya=He.length,He.push(Ar.path)):(ya=Ue.length,Ue.push(Ts)),X&&H.isFunction(X)){var C3={event:"postTransfer",bScanCompleted:!1,result:{currentPageNum:ya+1}};setTimeout(function(){X(C3)},10)}if(en)return!1;if("http"==G.type)if(G.httpParams&&(Ho=Tc(G.httpParams.fileName,ya+1),Vm=Tc(G.httpParams.remoteName,ya+1)),Aa||"http"!=G.type);else if(G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(P.__maxUploadImageSize=G.httpParams.maxSizeLimit),G.useUploader){Cn?(be.FileUploader.nextLoopTime=300,me.showProgress(P,"Scan Upload",P.__IfShowCancelDialogWhenImageTransfer)):me.hideProgress(),il=function(zo,Oi){return P.__HTTPPostResponseString=Oi,Be(P,zo._fileName,100,200),P._OnPercentDone([0,100,"","http",zo._fileName]),Cn&&me.closeProgress(null,"Scan Upload"),!Go&&G.removeAfterOutput?setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1?Fs(P,xu,xd).call(P,Ts,function(){Re++},function(){Re++}):Re++},100):Re++,!0};var jm,yi=Hn.uploadManager;if(Il=function(){var zo,Oi;if(Cn)for(Oi=Go?He.length:Ue.length,zo=0;zo<Oi;zo++)me.closeProgress(null,"Scan Upload");!Go&&G.removeAfterOutput&&setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1&&Fs(P,xu,xd).call(P,Ts)},100),yi.CancelAllUpload();var Td={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return Ye(Gt,Td),!1},Da=function(zo,Oi,Td,Ch){var ur=303;Oi==DC.TRANS_SERVICE_ERROR_404?ur=404:Oi==DC.TRANS_SERVICE_ERROR_500?ur=500:Oi==DC.TRANS_SERVICE_ERROR_503&&(ur=503),P._errorCode=Oi,P._errorString=Td,P.__HTTPPostResponseString=Ch,Be(P,Ho,100,ur),Il()},jm=function(){P.__HTTPPostResponseString="",Be(P,Ho,100,303),Il()},Go){var Pa=yi.CreateJob(),b3=Pa.FormField;G.httpParams&&(H.each(G.httpParams.headers,function(zo,Oi){Pa.HttpHeader[Oi]=zo}),H.each(G.httpParams.formFields,function(zo,Oi){b3.Add(Oi,zo)})),Pa.ServerUrl=wd,Pa.bDeleteFile=Sd,Pa.reTries=U,G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(Pa.maxSizeLimit=G.httpParams.maxSizeLimit),Pa._fileName=Ho,Pa.SourceValue.Add(Ar.path,Ho,Vm),Pa.ImageType=de.fileXfer.fileFormat,Pa.ThreadNum=Oe,Pa.OnRunSuccess=il,Pa.OnRunFailure=Da,(Cn||H.isFunction(ye))&&(Pa.OnUploadTransferPercentage=function(zo,Oi){Oi>0&&Oi<=100&&(P._OnPercentDone([0,Oi,"","http",zo._fileName]),H.isFunction(ye)&&Be(P,zo._fileName,Oi,0))},me.cancelFrom=Zn.Scan,Cn&&Fs(P,KP,vU).call(P,Il),P._OnPercentDone([0,-1,Br.Uploading,"http",Ho]),Be(P,Ho,0,0)),yi.Run(Pa)}else(Mr=G.format)==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Mr=be.DWT.EnumDWT_ImageType.IT_PDF:Mr==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Mr=be.DWT.EnumDWT_ImageType.IT_TIF),me.cancelFrom=Zn.Scan,Cn&&Fs(P,KP,vU).call(P,Il),P._OnPercentDone([0,-1,Br.Encoding,"http",Ho]),P._asyncGenerateURLForUploadData([Ts],Mr,z,function(zo){var Oi=yi.CreateJob(),Td=Oi.FormField;G.httpParams&&(H.each(G.httpParams.headers,function(Ch,ur){Oi.HttpHeader[ur]=Ch}),H.each(G.httpParams.formFields,function(Ch,ur){Td.Add(ur,Ch)})),Oi.ServerUrl=wd,Oi.bDeleteFile=Sd,Oi.reTries=U,G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(Oi.maxSizeLimit=G.httpParams.maxSizeLimit),Oi._fileName=Ho,Oi.SourceValue.Add(zo,Ho,Vm),Oi.ImageType=Mr,Oi.ThreadNum=Oe,Oi.OnRunSuccess=il,Oi.OnRunFailure=Da,(Cn||H.isFunction(ye))&&(Oi.OnUploadTransferPercentage=function(Ch,ur){ur>0&&ur<=100&&(P._OnPercentDone([0,ur,"","http",Ch._fileName]),H.isFunction(ye)&&Be(P,Ch._fileName,ur,0))},P._OnPercentDone([0,-1,Br.Uploading,"http",Ho]),Be(P,Ho,0,0)),yi.Run(Oi)},jm)}else{var wu={id:Ts,st:-1,bCancel:!1};if(Ge.push(wu),0==ya&&(Cn?me.showProgress(P,"Scan Upload",P.__IfShowCancelDialogWhenImageTransfer):me.hideProgress()),Go)il=function(zo){return wu.st=0,!Go&&G.removeAfterOutput?setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1?Fs(P,xu,xd).call(P,Ts,function(){Re++},function(){Re++}):Re++},100):Re++,!0},Il=function(){!Go&&G.removeAfterOutput&&setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1&&Fs(P,xu,xd).call(P,Ts)},100);var zo={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return me.closeProgress(null,"Scan Upload"),2==wu.st||(wu.st=1,H.each(Ge,function(Oi,Td){-1==Oi.st&&(Oi.bCancel=!0)}),Ye(Gt,zo)),!1},P._innerUploadDirectly(wd,Ar.path,Ho,Cn,Sd,U,!1,wu,il,Il);else{if(il=function(zo,Oi){return wu.st=0,!Go&&G.removeAfterOutput?setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1?Fs(P,xu,xd).call(P,Ts,function(){Re++},function(){Re++}):Re++},100):Re++,!0},Il=function(zo){!Go&&G.removeAfterOutput&&setTimeout(function(){P._ImgManager.convertServerIdToClientIndex(Ts)>-1&&Fs(P,xu,xd).call(P,Ts)},100);var Oi={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return me.closeProgress(null,"Scan Upload"),2==wu.st||(wu.st=1,H.each(Ge,function(Td,Ch){-1==Td.st&&(Td.bCancel=!0)}),Ye(Gt,Oi)),!1},H.isUndefined(Mr=G.format)){var QP=P._ImgManager.convertServerIdToClientIndex(Ts);return Kl(P),Il([QP]),!1}Mr==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Mr=be.DWT.EnumDWT_ImageType.IT_PDF:Mr==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Mr=be.DWT.EnumDWT_ImageType.IT_TIF);var ZP={method:"startScan",url:wd,serverIds:[Ts],headers:P._GetHttpHeadersAndClear(),formData:Bm(P.httpFormFields),enumImageType:Mr,saveSetup:z,fileName:Ho,dataFormat:l3.Binary,retry:U,bOnlyResponseEmptyIsOK:!1,objUploadFileStatus:wu,asyncSuccessFunc:il,asyncFailureFunc:Il};P._asyncUploadCmd(ZP)}}}),P.__OnPostAllTransfers=function(){var Ar,Mr,Ho=-1,Vm=l3.Binary,il=G.httpParams.url,Il=G.singlePost,Da=de.transferMode==be.DWT.EnumDWT_TransferMode.TWSX_FILE,wd=G.removeAfterOutput;if(X&&H.isFunction(X)&&(Mr={event:"postTransfer",bScanCompleted:!0,result:{currentPageNum:Ho=Da?He.length:Ue.length}},setTimeout(function(){X(Mr)},10)),0==Ho)return St(P,-1029,"Source has nothing to capture."),void setTimeout(function(){ae=!0,Ie&&H.isFunction(Ie)&&Ie();var ur={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};Ye(Gt,ur)},1e3);if(Ho>0&&-1029==P._errorCode)P._errorCode=0;else if(0!=P._errorCode){ae=!0,Ie&&H.isFunction(Ie)&&Ie();var Ts={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return void Ye(Gt,Ts)}if("http"==G.type&&Il&&"http"==G.type){var Aa,Go,Sd,ya=Ue;if(G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(P.__maxUploadImageSize=G.httpParams.maxSizeLimit),G.useUploader){var C3,jm=Hn.uploadManager,yi=jm.CreateJob(),Pa=yi.FormField;if(Cn?(be.FileUploader.nextLoopTime=300,me.showProgress(P,"Scan Upload",P.__IfShowCancelDialogWhenImageTransfer)):me.hideProgress(),Aa=function(ur,Gi){var as=ur._fileName;return as||(as=""),P._bServerPercentDone=!0,P.__HTTPPostResponseString=Gi,Be(P,as,100,200),P._OnPercentDone([0,100,"","http"]),Cn&&me.closeProgress(null,"Scan Upload"),!Da&&G.removeAfterOutput?setTimeout(function(){Re=0,H.each(ya,function(tc){P._ImgManager.convertServerIdToClientIndex(tc)>-1?Fs(P,xu,xd).call(P,tc,function(){Re++},function(){Re++}):Re++}),setTimeout(Ss,100)},100):(en=!0,di(ge),Te(P)),!0},Go=function(){Cn&&me.closeProgress(null,"Scan Upload"),jm.CancelAllUpload(),P._bServerPercentDone=!0;var ur={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return Ye(Gt,ur),!Da&&G.removeAfterOutput&&setTimeout(function(){H.each(ya,function(Gi){P._ImgManager.convertServerIdToClientIndex(Gi)>-1&&Fs(P,xu,xd).call(P,Gi)})},100),!1},Sd=function(ur,Gi,as,tc){var nc=303;Gi==DC.TRANS_SERVICE_ERROR_404?nc=404:Gi==DC.TRANS_SERVICE_ERROR_500?nc=500:Gi==DC.TRANS_SERVICE_ERROR_503&&(nc=503),P._errorCode=Gi,P._errorString=as,P.__HTTPPostResponseString=tc,Be(P,"",100,nc),Go()},C3=function(){P.__HTTPPostResponseString="",Be(P,"",100,303),Go()},Cn&&(me.cancelFrom=Zn.Scan,Fs(P,KP,vU).call(P,Go)),Da)G.httpParams&&(H.each(G.httpParams.headers,function(ur,Gi){yi.HttpHeader[Gi]=ur}),H.each(G.httpParams.formFields,function(ur,Gi){Pa.Add(Gi,ur)})),yi.ServerUrl=il,yi.bDeleteFile=wd,yi.reTries=U,G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(yi.maxSizeLimit=G.httpParams.maxSizeLimit),H.each(He,function(ur,Gi){var as,tc;G.httpParams&&(as=Tc(G.httpParams.fileName,Gi+1),tc=Tc(G.httpParams.remoteName,Gi+1)),yi.SourceValue.Add(ur,as,tc)}),yi.ImageType=de.fileXfer.fileFormat,yi.ThreadNum=Oe,yi.OnRunSuccess=Aa,yi.OnRunFailure=Sd,(Cn||H.isFunction(ye))&&(yi.OnUploadTransferPercentage=function(ur,Gi){Gi>0&&Gi<=100&&(P._OnPercentDone([0,Gi,"","http"]),H.isFunction(ye)&&Be(P,"",Gi,0))},P._OnPercentDone([0,-1,Br.Uploading,"http"]),Be(P,"",0,0)),jm.Run(yi);else if((Ar=G.format)==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF)Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Ar=be.DWT.EnumDWT_ImageType.IT_PDF:Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Ar=be.DWT.EnumDWT_ImageType.IT_TIF),P._OnPercentDone([0,-1,Br.Encoding,"http"]),P._asyncGenerateURLForUploadData(ya,Ar,z,function(ur){var Gi,as;G.httpParams&&(H.each(G.httpParams.headers,function(tc,nc){yi.HttpHeader[nc]=tc}),H.each(G.httpParams.formFields,function(tc,nc){Pa.Add(nc,tc)})),yi.ServerUrl=il,yi.bDeleteFile=wd,yi.reTries=U,G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(yi.maxSizeLimit=G.httpParams.maxSizeLimit),G.httpParams&&(Gi=Tc(G.httpParams.fileName,1),as=Tc(G.httpParams.remoteName,1)),yi._fileName=Gi,yi.SourceValue.Add(ur,Gi,as),yi.ImageType=Ar,yi.ThreadNum=Oe,yi.OnRunSuccess=Aa,yi.OnRunFailure=Sd,(Cn||H.isFunction(ye))&&(yi.OnUploadTransferPercentage=function(tc,nc){nc>0&&nc<=100&&(P._OnPercentDone([0,nc,"","http",Gi]),H.isFunction(ye)&&Be(P,Gi,nc,0))},P._OnPercentDone([0,-1,Br.Uploading,"http",Gi])),jm.Run(yi)},C3);else{var b3=ya.length,wu=0,QP=0,ZP="";Cn&&(P._bServerPercentDone=!1),P._OnPercentDone([0,-1,Br.Encoding,"http"]),H.each(ya,function(ur,Gi){var as,tc;G.httpParams&&(as=Tc(G.httpParams.fileName,Gi+1),tc=Tc(G.httpParams.remoteName,Gi+1)),P._asyncGenerateURLForUploadData([ur],Ar,z,function(nc){QP=(wu+1)/b3*100,ZP=[wu+1,"/",b3].join(""),P._OnPercentDone([0,QP,ZP,"http"]),yi.SourceValue.Add(nc,as,tc),++wu>=b3&&(Cn&&(P._bServerPercentDone=!0),G.httpParams&&(H.each(G.httpParams.headers,function(e6,Hm){yi.HttpHeader[Hm]=e6}),H.each(G.httpParams.formFields,function(e6,Hm){Pa.Add(Hm,e6)})),yi.ServerUrl=il,yi.bDeleteFile=wd,yi.reTries=U,G.httpParams&&H.isNumber(G.httpParams.maxSizeLimit)&&(yi.maxSizeLimit=G.httpParams.maxSizeLimit),yi.ImageType=Ar,yi.ThreadNum=Oe,yi.OnRunSuccess=Aa,yi.OnRunFailure=Sd,(Cn||H.isFunction(ye))&&(yi.OnUploadTransferPercentage=function(e6,Hm){Hm>0&&Hm<=100&&(P._OnPercentDone([0,Hm,"","http"]),H.isFunction(ye)&&Be(P,"",Hm,0))},P._OnPercentDone([0,-1,Br.Uploading,"http"])),jm.Run(yi))},C3)})}}else if(Da)Aa=function(ur){return P._bServerPercentDone=!0,!Da&&G.removeAfterOutput?setTimeout(function(){Re=0,H.each(ya,function(Gi){P._ImgManager.convertServerIdToClientIndex(Gi)>-1?Fs(P,xu,xd).call(P,Gi,function(){Re++},function(){Re++}):Re++}),setTimeout(Ss,100)},100):(en=!0,di(ge),Te(P)),!0},Go=function(ur){P._bServerPercentDone=!0;var Gi={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return Ye(Gt,Gi),!Da&&G.removeAfterOutput&&setTimeout(function(){H.each(ya,function(as){P._ImgManager.convertServerIdToClientIndex(as)>-1&&Fs(P,xu,xd).call(P,as)})},100),!1},P._innerUploadFilesDirectly(il,He,G.httpParams&&G.httpParams.fileName,Cn,wd,U,!1,Aa,Go);else{Aa=function(ur,Gi){return P._bServerPercentDone=!0,!Da&&G.removeAfterOutput?setTimeout(function(){Re=0,H.each(ya,function(as){P._ImgManager.convertServerIdToClientIndex(as)>-1?Fs(P,xu,xd).call(P,as,function(){Re++},function(){Re++}):Re++}),setTimeout(Ss,100)},100):(en=!0,di(ge),Te(P)),!0},Go=function(ur){P._bServerPercentDone=!0;var Gi={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};return Ye(Gt,Gi),!Da&&G.removeAfterOutput&&setTimeout(function(){H.each(ya,function(as){P._ImgManager.convertServerIdToClientIndex(as)>-1&&Fs(P,xu,xd).call(P,as)})},100),!1},Ar=G.format;var Td,zo=P._GetHttpHeadersAndClear(),Oi=Bm(P.httpFormFields);Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF||Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF?(Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_PDF?Ar=be.DWT.EnumDWT_ImageType.IT_PDF:Ar==be.DWT.EnumDWT_ImageType.IT_MULTIPAGE_TIF&&(Ar=be.DWT.EnumDWT_ImageType.IT_TIF),G.httpParams&&(Td=Tc(G.httpParams.fileName,1),Tc(G.httpParams.remoteName,1)),P._asyncUploadCmd({method:"startScan",url:il,headers:zo,formData:Oi,serverIds:ya,enumImageType:Ar,saveSetup:z,fileName:Td,dataFormat:Vm,retry:U,bOnlyResponseEmptyIsOK:!1,objUploadFileStatus:!1,asyncSuccessFunc:Aa,asyncFailureFunc:Go})):ya.length>0&&P._asyncUploadFilesCmd(il,ya,zo,Oi,Ar,G.httpParams&&G.httpParams.fileName,z,Cn,U,!1,Aa,Go)}}ae=!0,Ie&&H.isFunction(Ie)&&Ie()};var og=function(){if("http"!=G.type)return en=!0,di(ge),void Te(P);G.singlePost?setTimeout(function(){if(!ae&&P._startScanFlag)return en=!0,di(ge),void Te(P)},300):setTimeout(Ss,100)};Fs(P,Spe,nKe).call(P,de,og,function(Ar){if(-1029==P._errorCode&&(de.transferMode==be.DWT.EnumDWT_TransferMode.TWSX_FILE?He.length>0:Ue.length>0))return P._errorCode=0,og();var Mr={code:P._errorCode,message:P._getErrorString(),response:P.__HTTPPostResponseString};Ye(Gt,Mr)})})})}},{key:"_innerInitEvents",value:function(D){this.__OnWSReconnect=D.onWSReconnect||null,this.__OnWSClose=D.onWSClose||null,this.__OnWSMessage=D.onWSMessage||null,this.__OnWSError=D.onWSError||null,this.__OnPercentDone=D.onPercentDone||"",this.__OnPrintMsg=D.onPrintMsg||"",this.__OnResult=D.onResult||"",this.__OnAfterOperate=D.onAfterOperate||"",this.__OnBeforeOperate=D.onBeforeOperate||"",this.__OnOperateStatus=D.onOperateStatus||"",this.__OnBitmapChanged=D.onBitmapChanged||"",this.__OnGetFilePath=D.onGetFilePath||"",this.__OnPreAllTransfers=D.onPreAllTransfers||"",this.__OnPreTransfer=D.onPreTransfer||"",this.__OnPostLoad=D.onPostLoad||"",this.__OnPostTransfer=D.onPostTransfer||"",this.__OnPostAllTransfers=D.onPostAllTransfers||"",this.__OnSourceUIClose=D.onSourceUIClose||"",this.__OnTransferCancelled=D.onTransferCancelled||"",this.__OnTransferError=D.onTransferError||"",this.__OnInternetTransferPercentage=D.onInternetTransferPercentage||"",this.__OnInternetTransferPercentageEx=D.onInternetTransferPercentageEx||"",this.__OnRemoteScanStatusAsync=D.onRemoteScanStatusAsync||""}}],[{key:"create",value:(S=_t(B.mark(function D(R){var P;return B.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return P=new x(R),O.next=3,Ql.STwainConnectToServer(P);case 3:return O.abrupt("return",P);case 4:case"end":return O.stop()}},D)})),function(D){return S.apply(this,arguments)})}]);var S,T}(jqe);function Ipe(){var C,x,S=[],T=this.__devices.length;for(C=0;C<T;C++){var D=this.__devices[C],R=D.deviceType,P={ProductName:"",DeviceInfo:{},DriverType:"",IsCurrentSource:!1,IsDefaultSource:!1,Manufacturer:"",ProductFamily:"",ProtocolMajor:0,ProtocolMinor:0,SupportedGroups:0,Version:{Country:0,Info:"",Language:0,MajorNum:0,MinorNum:0}},O=void 0,U=H.clone(D.deviceInfo);(x=R)==tn.TWAINSCANNER||x==tn.WIATWAINSCANNER||x==tn.TWAINX64SCANNER?(R==tn.TWAINSCANNER?O="TWAIN":R==tn.WIATWAINSCANNER?O="WIATWAIN":R==tn.TWAINX64SCANNER&&(O="TWAIN64"),P.Manufacturer=U.Manufacturer,P.ProductFamily=U.ProductFamily,P.ProtocolMajor=U.ProtocolMajor,P.ProtocolMinor=U.ProtocolMinor,P.SupportedGroups=U.SupportedGroups,P.Version=U.Version):R==tn.SANESCANNER?(O="SANE",P.DeviceInfo=U):R==tn.ICASCANNER?(O="ICA",P.DeviceInfo=U):R==tn.ESCLSCANNER?(O="eSCL",P.DeviceInfo=U):R==tn.WIFIDIRECTSCANNER?(O="WiFiScanner",P.DeviceInfo=U):R==tn.WIASCANNER&&(O="WIA",P.DeviceInfo=U),P.ProductName=D.displayName,P.DriverType=O,S.push(P)}return S}function Epe(){var C,x=this,S=[],T=0;for(x.__devices&&(T=x.__devices.length),C=0;C<T;C++)S.push(x.__devices[C].displayName);return S}function tKe(C,x){var S=["[",C,",",null!=x?x:R0.SMF_NAME,"]"].join("");return this._innerFun("SelectSourceEx",S)}function nKe(C,x,S){var T,D,R=this,P=null,O=null;if(D=H.isUndefined(C)||null==C?{}:C,R._resetErr(),!R._isValid())return!1;if(H.isFunction(x)&&(P=function(){x(D)}),H.isFunction(S)&&(O=function(K,oe){S(K,oe,D)}),!mn.checkProductKey(R,{Core:!0}))return H.isFunction(O)&&O(R._errorCode,R._errorString),!1;for(var U=0,G=0;G<lP.length;G++){var X=["__",lP[G]].join("");H.isFunction(R[X])&&(U|=1<<G)}if(D.EnableEvents=U,D.scanner){var z=D.scanner;H.isString(z)||H.isString(z.strDevice)&&(D.device=z.strDevice,delete D.scanner)}return T=["[",H.stringify(D),"]"].join(""),R.__bAcquireImageNow=!0,R.__innerAcquireOrLoadImageAsync("StartScan",T,!1,!0).then(P,function(K){R._errorCode=K.code,R._errorString=K.message,H.isFunction(O)&&O(K.code,K.message)}),!0}function xd(C,x,S){var T=this;return T._innerFunRaw("RemoveImage",Et(C),!0,!1,!0,function(){T._OnBitmapChanged(["c1",""+C,3,T._ImgManager.getCurrentImageIndex(),T._ImgManager.count()]),H.isFunction(x)&&x()},S)}function vU(C){var x=this;x.IfShowCancelDialogWhenImageTransfer?(me.progressContext&&me.progressContext.on("cancel",function(){gu(x),C()}),tg(!0)):tg(!1)}var DC={TRANS_SERVICE_ERROR_404:12,TRANS_SERVICE_ERROR_500:13,TRANS_SERVICE_ERROR_503:14},iKe=function C(x,S){if(!H.isUndefined(x)&&!H.isUndefined(S)&&null!=x&&null!=S){for(var T in S)x.hasOwnProperty(T)?"object"===p(x[T])&&C(x[T],S[T]):x[T]=S[T];return x}};function rKe(C){return yU.apply(this,arguments)}function yU(){return yU=_t(B.mark(function C(x){var S,T,D,P,O,U,G,X;return B.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(P=null===(S=x.container)||void 0===S?void 0:S.id,O=window,!(T=be.DWT.GetWebTwain(x.id))&&P&&(D=be.DWT.GetWebTwain(P)),!T&&!D){z.next=8;break}throw U={},T?qle(U):Kle(U),{code:U._errorCode,message:U._errorString};case 8:return be.DWT.UseDefaultViewer||(x.container=null),x.bNoViewer=!((K=x.container)&&!H.isString(K)?Nt:yt),z.prev=10,z.next=13,Tpe.create(x);case 13:G=z.sent,z.next=22;break;case 16:throw z.prev=16,z.t0=z.catch(10),(X=z.t0&&z.t0.code)==Xn.ResponseDataTypeError||X==Xn.HTSTError||X==Xn.CORSError||X==Xn.CORSErrorFromService||X==Xn.SSLCertExpired||X==Xn.SSLCertInvalid||(X==Xn.MustUpgrade?ig(!0):X==Xn.ModuleNotExists&&sKe(G)),G&&G.dispose(),z.t0;case 22:return z.prev=22,O.DCP_DWT_OnClickCloseInstall&&O.DCP_DWT_OnClickCloseInstall(!1,!0),z.finish(22);case 25:return Dpe(G),z.abrupt("return",G);case 27:case"end":return z.stop()}var K},C,null,[[10,16,22,25]])})),yU.apply(this,arguments)}function oKe(C,x){if(H.isFunction(be.OnWebTwainNeedUpgradeCallback)){var S,T,D={};if(T=ql.getDSPath(),he.bWin)S=Rn.enumWindow;else if(be.navInfo.bEmbed||he.bAndroid||he.bChromeOS||he.bHarmonyOS||he.biPhone||he.biPad)he.bAndroid?S=Rn.enumAndroid:(D.deb=T,S=he.biPhone||he.biPad?Rn.enumiOS:he.bChromeOS?Rn.enumChromeOS:he.bHarmonyOS?Rn.enumHarmonyOS:Rn.enumEmbed);else if(he.bLinux){var R=ql.getLinuxHTML5DebPath(),P=ql.getLinuxHTML5RpmPath();T=R,D.deb=R,D.rpm=P,S=Rn.enumLinux}else S=Rn.enumMac;D.default=T;var O=pt.one(".dynamsoft-dialog-license");O&&O.getEL()&&(O.getEL().style.display="none"),me.detect.needUpgrade=Nt,be.OnWebTwainNeedUpgradeCallback(Tt.name,D,Tt.bHTML5Edition,S,he.bIE,he.bSafari,me.detect.ssl,Po.strIEVersion,me.detect.bPromptJSOrServerOutdated,C,x)}}function Dpe(C){return _U.apply(this,arguments)}function _U(){return _U=_t(B.mark(function C(x){var S,D;return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(x&&!x._blts){R.next=2;break}return R.abrupt("return");case 2:if(-2207==x.ErrorCode&&(me.detect.bPromptJSOrServerOutdated=Nt,H.isFunction(be.DWT.OnWebTwainNeedUpgradeWebJavascript)&&be.DWT.OnWebTwainNeedUpgradeWebJavascript(x.ErrorString)),!xo.versionInfoFromServer){R.next=7;break}S=xo.versionInfoFromServer,R.next=10;break;case 7:return R.next=9,x._getVersionInfoAsync();case 9:S=R.sent;case 10:if(me.detect.bNeedUpgradeEvent||xHe(S)){R.next=19;break}if(me.detect.bNeedUpgradeEvent=Nt,!H.isFunction(be.DWT.OnWebTwainNeedUpgrade)){R.next=15;break}if(!be.DWT.OnWebTwainNeedUpgrade()){R.next=15;break}return R.abrupt("return");case 15:if(!x._bRemoteMode){R.next=18;break}return H.isFunction(be.OnRemoteWebTwainNeedUpgradeCallback)&&be.OnRemoteWebTwainNeedUpgradeCallback(Tt.name,x._serverInfo.server,x._serverInfo.port,x._serverInfo.ssl),R.abrupt("return");case 18:(Tt.bHTML5Edition&&x._isBindViewer()||!Tt.bHTML5Edition)&&((D=x._containerElement)&&(pt.one(D).before(me.install._strNonInstallDIV),H.show(me.install._divDWTNonInstallContainerID)),""!=me.install._divDWTemessageContainer&&H.hide(me.install._divDWTemessageContainer),oKe());case 19:case"end":return R.stop()}},C)})),_U.apply(this,arguments)}function sKe(C){if(!me.detect.bNoControlEvent){var x,S=0,T=0;C&&(S=C._width,T=C._height,x=C._containerElement),C&&C._bRemoteMode?C._bNotShowMessage||H.isFunction(be.OnRemoteWebTwainNotFoundCallback)&&be.OnRemoteWebTwainNotFoundCallback(Tt.name,C._serverInfo.server,C._serverInfo.port,C._serverInfo.ssl,Po.bMobile):($fe(x,S,T),ig(!1)),me.detect.bNoControlEvent=!0}}var rg=function(C){function x(K){var oe,ue,ye;n(this,x),ye=[K],ue=qn(ue=x),(oe=Za(this,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(Ue){return!1}}()?Reflect.construct(ue,ye||[],qn(this).constructor):ue.apply(this,ye)))._bServerPercentDone=!0,oe._bScanForProxyRemote=Nt;var Ie=Ql.getServerImageUrlPrefix(oe);return SC._setBaseUrl(oe._imageBufferWrapper,Ie),oe}return el(x,C),v(x,[{key:"getDevices",value:function(K,oe,ae){return this._getDevices(K,oe,ae)}},{key:"_connnect",value:(z=_t(B.mark(function K(){var oe;return B.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return oe=this,ae.abrupt("return",new me.Promise(function(ue,ye){Bqe(oe._serverInfo.server,oe._serverInfo.port,void 0,function(Ie,Ue,He){oe._strRemoteServiceVer=He,ue()},ye)}));case 2:case"end":return ae.stop()}},K,this)})),function(){return z.apply(this,arguments)})},{key:"acquireImage",value:function(K,oe){return va(qn(x.prototype),"_acquireImage",this).call(this,K,oe)}},{key:"_acquireImageForSendTo",value:function(K,oe,ae,ue){return va(qn(x.prototype),"_acquireImageForSendTo",this).call(this,K,oe,ae,ue)}},{key:"getCapabilities",value:function(K,oe,ae){return this._getCapabilities(K,oe,ae)}},{key:"setCapabilities",value:function(K,oe,ae){return this._setCapabilities(K,oe,ae)}},{key:"closeSource",value:function(){return this._closeSource()}},{key:"setBufferMemoryLimit",value:(X=_t(B.mark(function K(oe){var ae;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(ae=this,H.isNumber(oe)&&!isNaN(oe)){ye.next=4;break}throw ga(ae),{code:ae._errorCode,message:ae._errorString};case 4:if(ae._resetErr(),ae._isValid()){ye.next=7;break}throw{code:ae._errorCode,message:ae._errorString};case 7:return ye.next=9,ae._innerFunV2("BufferMemoryLimit",Et(oe));case 9:return ye.abrupt("return",ye.sent);case 11:case"end":return ye.stop()}},K,this)})),function(K){return X.apply(this,arguments)})},{key:"setIfAllowLocalCache",value:(G=_t(B.mark(function K(oe){var ae;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(ae=this,H.isBoolean(oe)){ye.next=4;break}throw ga(self),{code:ae._errorCode,message:ae._errorString};case 4:if(ae._resetErr(),ae._isValid()){ye.next=7;break}throw{code:ae._errorCode,message:ae._errorString};case 7:return ye.next=9,ae._innerFunV2("IfAllowLocalCache",Et(oe));case 9:return ye.abrupt("return",ye.sent);case 11:case"end":return ye.stop()}},K,this)})),function(K){return G.apply(this,arguments)})},{key:"howManyImagesInBuffer",get:function(){return this._imageBufferWrapper.count()}},{key:"currentImageIndexInBuffer",get:function(){return this._imageBufferWrapper.getCurrentImageIndex()},set:function(K){this._imageBufferWrapper.setCurrentImageIndex(K)}},{key:"saveImages",value:(U=_t(B.mark(function K(oe,ae,ue,ye){var Ie;return B.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if(Ie="saveImages",this._checkIndices(ae)){Ue.next=3;break}throw{code:this._errorCode,message:this._getErrorString()};case 3:return this._containerElement=ye,Ue.next=6,this._saveImages(Ie,oe,ae,ue);case 6:case"end":return Ue.stop()}},K,this)})),function(K,oe,ae,ue){return U.apply(this,arguments)})},{key:"getImages",value:function(K,oe,ae,ue){if(!this._checkIndices(K))throw{code:this._errorCode,message:this._getErrorString()};return this._containerElement=ue,this._getImages("getImages",K,oe,ae)}},{key:"removeImages",value:(O=_t(B.mark(function K(oe){var ae,ue,ye,Ue;return B.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:if(this._checkIndices(oe)){He.next=2;break}throw{code:this._errorCode,message:this._getErrorString()};case 2:for(ae=oe.sort(function(Re,Oe){return Oe-Re}),ue=[],ye=0;ye<ae.length;ye++)(Ue=this._imageBufferWrapper.convertClientIndexToServerId(ae[ye]))>0&&ue.push(Ue);if(0!=ue.length){He.next=7;break}return He.abrupt("return");case 7:return He.next=9,this._innerFunV2("RemoveAllImages",Et(ue.join(",")));case 9:if(!He.sent&&-1033!=this._errorCode){He.next=16;break}if(this._imageBufferWrapper.removeImages(ae)){He.next=14;break}throw this._imageBufferWrapper.getError();case 14:He.next=17;break;case 16:throw{code:this._errorCode,message:this._errorString};case 17:case"end":return He.stop()}},K,this)})),function(K){return O.apply(this,arguments)})},{key:"updateImage",value:function(K,oe,ae){var ue=this._imageBufferWrapper.getIndexByUid(K),ye=this._imageBufferWrapper.convertClientIndexToServerId(ue);return va(qn(x.prototype),"_updateImage",this).call(this,ye,oe,ae)}},{key:"getSkewAngleFromBinaryAsync",value:function(K,oe,ae,ue){if(this._resetErr(),!this._isValid())return me.Promise.reject({code:this._errorCode,message:this._errorString});var Ie=this._imageBufferWrapper.getCustomDataByIndex(K),Ue=this._imageBufferWrapper.getMetadataByIndex(K),He=this._imageBufferWrapper.convertClientIndexToServerId(K),Oe=H.stringify([H.stringify({imageId:He,serverId:He,bufferLen:oe.size,imageType:Ti.IT_BMP,width:Ue.width,height:Ue.height,bit:Ue.bitDepth,xres:Ue.resolutionX,yres:Ue.resolutionY,uidFromServer:Ie.uidFromServer})]);return this._innerSendBlob("GetSkewAngleFromBinary",Oe,oe,!0,!0,ae,ue)}},{key:"httpUpload",value:(P=_t(B.mark(function K(oe,ae,ue,ye,Ie,Ue,He){var Re,Oe;return B.wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if((Re=this)._resetErr(),Re._isValid()){Ge.next=4;break}throw{code:Re._errorCode,message:Re._errorString};case 4:if(!H.isUndefined(oe)&&""!==oe){Ge.next=9;break}throw wl(Re),{code:Re._errorCode,message:Re._errorString};case 9:if(H.isString(oe)){Ge.next=12;break}throw kS(Re),{code:Re._errorCode,message:Re._errorString};case 12:if(Re._checkIndices(ae)){Ge.next=14;break}throw{code:Re._errorCode,message:Re._errorString};case 14:if(0!=(Oe=km(Re,ae)).length){Ge.next=18;break}throw Jn(Re),{code:Re._errorCode,message:Re._errorString};case 18:if(!H.isUndefined(ue)){Ge.next=21;break}throw Kl(Re),{code:Re._errorCode,message:Re._errorString};case 21:if(ue!=be.DWT.EnumDWT_ImageType.IT_BMP&&ue!=be.DWT.EnumDWT_ImageType.IT_JPG&&ue!=be.DWT.EnumDWT_ImageType.IT_PNG){Ge.next=27;break}if(!(Oe.length>1)){Ge.next=25;break}throw eC(Re),{code:Re._errorCode,message:Re._errorString};case 25:Ge.next=32;break;case 27:if(ue!=be.DWT.EnumDWT_ImageType.IT_TIF&&ue!=be.DWT.EnumDWT_ImageType.IT_PDF){Ge.next=30;break}Ge.next=32;break;case 30:throw Kl(Re),{code:Re._errorCode,message:Re._errorString};case 32:if(!(H.isUndefined(ye)||ye!=be.DWT.EnumDWT_UploadDataFormat.Binary&&ye!=be.DWT.EnumDWT_UploadDataFormat.Base64)){Ge.next=35;break}throw Nle(Re),{code:Re._errorCode,message:Re._errorString};case 35:return Ge.next=37,new me.Promise(function(Se,de){var ge,_e,ve=parseInt(ue),Te=parseInt(ye);null!=Ue&&Ue.formFields&&(ge=new FormData,H.each(null==Ue?void 0:Ue.formFields,function(We,Ye){var Be=We.name,$e=We.value;H.isString(Be)&&($e instanceof Blob?ge.append(Be,$e,We.fileName):ge.append(Be,$e))})),null!=Ue&&Ue.headers&&(_e={},H.each(null==Ue?void 0:Ue.headers,function(We,Ye){H.isString(We.name)&&(_e[We.name]=We.value)})),Re._containerElement=He,x._innerHTTPUpload(Re,"httpUpload",oe,null==Ue?void 0:Ue.responseType,_e,ge,Oe,ve,Te,Ie,void 0,0,!1,void 0,function(We){if(H.isFunction(Se)){var Ye=[];H.isArray(Oe)&&H.each(Oe,function(Be){var $e=Re._imageBufferWrapper.convertServerIdToClientIndex(Be);$e>-1&&Ye.push($e)});try{ws(Se,We,Ye)}catch(Be){}}return We=null,!0},function(We){if(H.isFunction(de))try{de(We)}catch(Ye){}return!1})});case 37:return Ge.abrupt("return",Ge.sent);case 38:case"end":return Ge.stop()}},K,this)})),function(K,oe,ae,ue,ye,Ie,Ue){return P.apply(this,arguments)})},{key:"getCustomDataByIndex",value:function(K){return this._imageBufferWrapper.getCustomDataByIndex(K)}},{key:"getIndexByUid",value:function(K){return this._imageBufferWrapper.getIndexByUid(K)}},{key:"getProfile",value:function(K){return va(qn(x.prototype),"_getProfile",this).call(this,K)}},{key:"setProfile",value:function(K,oe){return va(qn(x.prototype),"_setProfile",this).call(this,K,oe)}},{key:"imageIDToIndex",value:function(K){return this._uidFromServer2index(K)}},{key:"indexToImageID",value:function(K){return this._index2uidFromServer(K)}},{key:"rotate",value:function(K,oe,ae,ue){var ye=this;if(ye._resetErr(),!ye._isValid())return me.Promise.reject({code:ye._errorCode,message:ye._errorString});var Ie=parseInt(K);if(isNaN(Ie))return Jn(ye),me.Promise.reject({code:ye._errorCode,message:ye._errorString});if(Ie<0||Ie>=ye.howManyImagesInBuffer)return Mt(ye),me.Promise.reject({code:ye._errorCode,message:ye._errorString});var Ue=ye._imageBufferWrapper.convertClientIndexToServerId(Ie);return-1==Ue?(Mt(ye),me.Promise.reject({code:ye._errorCode,message:ye._errorString})):ye._innerFunV2("RotateEx",Et(Ue,oe,ae,ue),!0).then(function(He){})}},{key:"crop",value:function(K,oe){var ae=this;if(ae._resetErr(),!ae._isValid())return me.Promise.reject({code:ae._errorCode,message:ae._errorString});var ue=parseInt(K);if(isNaN(ue))return Jn(ae),me.Promise.reject({code:ae._errorCode,message:ae._errorString});if(ue<0||ue>=ae.howManyImagesInBuffer)return Mt(ae),me.Promise.reject({code:ae._errorCode,message:ae._errorString});var ye=ae._imageBufferWrapper.convertClientIndexToServerId(ue);return-1==ye?(Mt(ae),me.Promise.reject({code:ae._errorCode,message:ae._errorString})):ae._innerFunV2("Crop",Et(ye,oe.x,oe.y,oe.x+oe.width,oe.y+oe.height),!0).then(function(Oe){})}},{key:"_createHttpUploaderConfig",value:function(){var K=this,oe=new ffe;return oe.IfShowProgressBar=K.IfShowProgressBar,oe.IfShowCancelDialogWhenImageTransfer=K.IfShowCancelDialogWhenImageTransfer,oe.MaxUploadImageSize=K.MaxUploadImageSize,oe.HTTPRequestswithCredentials=K.HTTPRequestswithCredentials,oe.onPercent=function(ae){K._OnPercentDone(ae)},oe.onHttpUploadStatus=function(ae){},oe}},{key:"_OnReady",value:(R=_t(B.mark(function K(){var oe,ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return bc((oe=this)._serverInfo.server)&&(fd.item("DWT_port",oe._serverInfo.port),fd.item("DWT_ssl",oe._serverInfo.ssl?"true":"false")),oe._bNoMask||Wo("OnReady",oe),ye.prev=3,ye.next=6,va(qn(x.prototype),"_OnReady",this).call(this);case 6:return ye.next=8,oe._innerActiveUI(oe._uuidForActiveUI);case 8:return ae=ye.sent,ye.next=11,oe._OnActiveUI(ae);case 11:(ue=oe._id)&&!be.DWT.WebTwainIdMap[ue]&&(be.DWT.WebTwainIdMap[ue]=oe),ye.next=20;break;case 15:throw ye.prev=15,ye.t0=ye.catch(3),ye.t0&&(oe._errorCode=ye.t0.code,oe._errorString=ye.t0.message),oe.dispose(),ye.t0;case 20:return ye.prev=20,oe._bNoMask||Xr("OnReady"),ye.finish(20);case 23:case"end":return ye.stop()}},K,this,[[3,15,20,23]])})),function(){return R.apply(this,arguments)})},{key:"_isBindViewer",value:function(){return this._bBindViewer}},{key:"_isNoViewer",value:function(){return!this._isBindViewer()}},{key:"getServiceInfo",value:function(){return va(qn(x.prototype),"getServiceInfo",this).call(this)}},{key:"setViewerInfo",value:function(K){this._bBindViewer=K}},{key:"setViewerControlInfo",value:function(K){this._controlWidth=K.width,this._controlHeight=K.height}}],[{key:"create",value:(D=_t(B.mark(function K(oe){var ae;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return ae=new x(oe),ue.next=3,Ql.STwainConnectToServer(ae);case 3:return ue.abrupt("return",ae);case 4:case"end":return ue.stop()}},K)})),function(K){return D.apply(this,arguments)})},{key:"_getBuffer",value:function(K){return SC._getBuffer(K._imageBufferWrapper)}},{key:"_setError",value:function(K,oe,ae){K._errorCode=oe,K._errorString=ae}},{key:"createByServiceInfo",value:(T=_t(B.mark(function K(oe,ae,ue){var ye,Ie,Ue;return B.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return Ie={id:H.guid(),dmService:ae,bNoViewer:!0,bNoMask:null==ae||null===(ye=ae.attrs)||void 0===ye?void 0:ye.bNoMask,bNotShowMessage:!0},(Ue=new x(Ie))._uuidForActiveUI=oe,Ue._bLicenseErrorDispose=!1,ue&&(Ue._containerElement=ue),He.next=7,Ue._connnect();case 7:return He.next=9,Ql.STwainConnectToServer(Ue);case 9:return He.abrupt("return",Ue);case 10:case"end":return He.stop()}},K)})),function(K,oe,ae){return T.apply(this,arguments)})},{key:"checkOnlineByServiceInfo",value:(S=_t(B.mark(function K(oe){var ae,ue;return B.wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ae={id:H.guid(),dmService:oe,bNoViewer:!0,bNoMask:!0,bNotShowMessage:!0},ye.prev=1,ue=new x(ae),ye.next=5,ue._connnect();case 5:return ue._bReady=!0,ue._wsClient||(ue._wsClient=new wB(null)),ue.dispose(),ye.abrupt("return",!0);case 11:return ye.prev=11,ye.t0=ye.catch(1),H.warn(ye.t0),ye.abrupt("return",!1);case 15:case"end":return ye.stop()}},K,null,[[1,11]])})),function(K){return S.apply(this,arguments)})},{key:"_isReady",value:function(K){return K._bReady}},{key:"_innerHTTPUpload",value:function(K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge,Se,de,ge,_e,ve){var Te=Oe,We=ae;if(H.isUndefined(He))return Kl(K),void(H.isFunction(ve)&&ve({code:K._errorCode,message:K._errorString}));me.cancelFrom=Zn.HTTPUpload;var Ye,Be=function(ze,Ct,bt){me.needShowTwiceShowDialog=!1,K.IfShowProgressBar&&me.closeProgress(null,oe),H.isFunction(ve)&&ve({code:ze,message:Ct,response:bt})},$e=K._createHttpUploaderConfig();if($e.objUploadStatus=ge,Te=LP(Te,He),me.needShowTwiceShowDialog=!0,K.IfShowProgressBar?(me.showProgress(K,oe,!1),me.progressContext&&(me.progressContext._onPercent=function(ze){var Ct=0;ze&&(Ct=Math.floor(ze.loaded/ze.total*100))>100&&(Ct=100),me.progressBarOnPercentDone(-1,"Transferring...","",Ct,"")})):me.hideProgress(),Re==be.DWT.EnumDWT_UploadDataFormat.Binary){if(ge&&ge.bCancel)return ge.st=2,gu(K),void Be(K._errorCode,K._errorString);$e.onPercent([0,-1,Br.Encoding,"http"]),K._convertToBlobForUpload(He,Ue,Ge,4,function(ze,Ct,bt){if(Ye=function(xt){return me.needShowTwiceShowDialog=!1,K.IfShowProgressBar&&me.closeProgress(null,oe),H.isFunction(_e)&&ws(_e,xt),xt=null,!0},ge&&ge.bCancel)return ge.st=2,gu(K),Be(K._errorCode,K._errorString);if(!ze||ze.size<=0)return is(K),Be(K._errorCode,K._errorString);var Vt=K.__maxUploadImageSize;if(ze.size>Vt&&-1!=Vt)return bf(K),Be(K._errorCode,K._errorString);if(0!=K._errorCode)return Be(K._errorCode,K._errorString);be.DWT.IfAddMD5InUploadHeader&&Ct&&""!=Ct&&(ye["dwt-md5"]=Ct);var In=new Pf,yn=new Cd;yn.url=We,yn.method=oe,yn.content=ze,ze=null,yn.contentType=K._strHttpContentTypeFieldValue,yn.headers=ye,yn.fileName=Te,yn.httpFormData=Ie,yn.retry=Se,yn.bOnlyResponseEmptyIsOK=de,yn.responseType=ue,$e.objUploadStatus=ge,In.httpPostUpload($e,yn,Ye,Be)},Be)}else Re==be.DWT.EnumDWT_UploadDataFormat.Base64&&K._convertToBase64ByServerIdsWithUI(oe,Ue,He,Ge,4,function(ze){var Ct,bt;if(!ze||ze.getLength()<=0||(Ye=function(In){return me.needShowTwiceShowDialog=!1,K.IfShowProgressBar&&me.closeProgress(null,oe),H.isFunction(_e)&&ws(_e,In),!0},Ct=ze.getMD5(),be.DWT.IfAddMD5InUploadHeader&&(ye["dwt-md5"]=Ct),!(bt=ze.getData(0,ze.getLength()))||""==bt))return is(K),Be(K._errorCode,K._errorString);var Vt=new Cd;Vt.url=We,Vt.method=oe,Vt.content=bt,bt=null,Vt.headers=ye,Vt.fileName=Te,Vt.httpFormData=Ie,Vt.retry=Se,Vt.bOnlyResponseEmptyIsOK=de,Vt.responseType=ue,(new Pf).httpPostUpload($e,Vt,Ye,Be)},Be)}}]);var S,T,D,R,P,O,U,G,X,z}(pfe),CU=cr,aKe=function(){return v(function de(ge){var _e=this;n(this,de),this._serverUrl=ge,this._defaultDSScanClient=null,this._dsScanClientsMap={},this._serviceInfos=null,this._id=H.guid(),this.onBufferChanged=null,this.onPostTransferAsync=null,this._errorCode=0,this._errorString="",this._bDispose=!1,this._needSetLogLevel=!1,this._logLevel=-1,this._showProgressBar=!0,this._checkServerUrl(),this._id&&!be.DWT.RemoteScanIdMap[this._id]&&(be.DWT.RemoteScanIdMap[this._id]=this),this._uuidForRemoteScanObject="",me.dlgProgress||me.initProgress(null),this._viewer=be.DWT.UseDefaultViewer?new be.DWTViewerEx(null,{viewerEvents:{bufferChanged:function(Te,We){_e.__bufferChanged(_e,Te,We)},save:function(Te,We,Ye,Be){return _e.__save(Te,We,Ye,Be)},rotate:function(Te,We,Ye){return _e.__rotate(Te,We,Ye)},crop:function(Te,We,Ye,Be,$e){return _e.__crop(Te,{x:We,y:Ye,width:Be,height:$e})}},viewerError:{setError:function(Te,We){_e._defaultDSScanClient?rg._setError(_e._defaultDSScanClient,Te,We):0==Te&&""==We||(_e._errorCode=Te,_e._errorString=We)}},imageEditorEvents:{deskew:function(Te,We){_e.__deskew(_e,Te,We)},removeImage:function(){_e.__remove(_e)},removeAllImage:function(){_e.__removeAll(_e)},close:function(){_e.__close(_e)}},imageEditorUiConfig:{buttons:{visibility:{scan:!1,load:!1}}},beforeImageEditorCreated:function(Te){_e.__beforeImageEditorCreated(Te)}}):null},[{key:"Viewer",get:function(){return this._viewer}},{key:"_disposeDSClientByKey",value:(Se=_t(B.mark(function de(ge){var _e;return B.wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(!(_e=this._dsScanClientsMap[ge])){ve.next=10;break}if(_e.isDestroy){ve.next=9;break}if(!_e.__unload){ve.next=8;break}return ve.next=6,_e.__unload();case 6:ve.next=9;break;case 8:_e.dispose();case 9:delete this._dsScanClientsMap[ge];case 10:case"end":return ve.stop()}},de,this)})),function(de){return Se.apply(this,arguments)})},{key:"_checkServerUrl",value:function(){var de=this._serverUrl;if(de&&H.isString(de)&&H.startsWith(location.href,"https://")&&H.startsWith(de,"http://")){var ge={};throw St(ge,-2436,'Mixed Content: The page at "'+location.href+'" was loaded over HTTPS, but requested an insecure resource "'+de+'/ddm/18625/ddm/SearchScanner". This request has been blocked; the content must be served over HTTPS.'),Zi(ge)}if(!H.isString(de)||""==de){var _e={};throw St(_e,-2545,"The  proxy server URL is invalid."),Zi(_e)}}},{key:"getDynamsoftService",value:(Ge=_t(B.mark(function de(ge){var _e,ve,Te,We,Ye,Be,$e,ze,Ct,bt,Vt,In,yn,xt,Pt,It,Wt,en,Cn;return B.wrap(function(hn){for(;;)switch(hn.prev=hn.next){case 0:if(!this._bDispose){hn.next=4;break}throw xc(_e={}),Zi(_e);case 4:if(ve=this._serverUrl,this._checkServerUrl(),Te=new qP(ve,!0),Wo("getDynamsoftService",this.getViewerElement()),hn.prev=8,!ge&&this._serviceInfos){hn.next=68;break}if(We=null,Ye=this._serviceInfos,this._serviceInfos=[],Be="",$e="",!Qa()){hn.next=30;break}return hn.next=16,this._setRemoteUuid();case 16:return hn.prev=16,hn.next=19,rP(be.DWT.EnumInstance.dwt_desktop,"");case 19:(ze=hn.sent)&&(Be=ze.ar,$e=this._uuidForRemoteScanObject),hn.next=28;break;case 23:throw hn.prev=23,hn.t0=hn.catch(16),Mue(Ct={},hn.t0),{code:Ct._errorCode,message:Ct._errorString};case 28:hn.next=31;break;case 30:Be=Tt.refProductKey;case 31:return hn.next=33,Te.getDynamsoftService(Be,$e,ge);case 33:if(!(We=hn.sent)){hn.next=68;break}Vt=[],bt=0;case 37:if(!(bt<We.length)){hn.next=65;break}return xt=e9(We[bt]),Pt=null!==(In=null==xt||null===(yn=xt.attrs)||void 0===yn?void 0:yn.ty)&&void 0!==In?In:"",hn.next=42,rg.checkOnlineByServiceInfo(xt);case 42:if(!hn.sent){hn.next=60;break}if(xt.attrs=xt.attrs||{},xt.attrs.bNoMask=!0,xt.attrs.bNotShowMessage=!0,!Ye){hn.next=57;break}It=void 0,It=0;case 50:if(!(It<Ye.length)){hn.next=57;break}if(!this.isSameService(xt,Ye[It])){hn.next=54;break}return Ye.splice(It,1),hn.abrupt("break",57);case 54:It++,hn.next=50;break;case 57:this._serviceInfos.push(xt),hn.next=61;break;case 60:Pt+="(x)";case 61:Vt.push(Pt);case 62:bt++,hn.next=37;break;case 65:if(H.log("Find Dynamsoft Services:"),H.log(Vt.join(", ")),Ye)for(Wt=0;Wt<Ye.length;Wt++)(Cn=null===(en=Ye[Wt])||void 0===en||null===(en=en.attrs)||void 0===en?void 0:en.UUID)&&this._disposeDSClientByKey(Cn);case 68:this._needSetLogLevel&&-1!=this._logLevel&&this.setLogLevel(this._logLevel),hn.next=74;break;case 71:throw hn.prev=71,hn.t1=hn.catch(8),hn.t1;case 74:hn.prev=74,Xr("getDynamsoftService");try{Te._bInited&&Te.dispose()}catch(Dr){}return hn.finish(74);case 78:return hn.abrupt("return",this._serviceInfos);case 79:case"end":return hn.stop()}},de,this,[[8,71,74,78],[16,23]])})),function(de){return Ge.apply(this,arguments)})},{key:"getDefaultDynamsoftService",value:function(){if(this._bDispose){var de={};throw xc(de),Zi(de)}return this._defaultDSScanClient?this._defaultDSScanClient.getServiceInfo():null}},{key:"setDefaultDynamsoftService",value:(Oe=_t(B.mark(function de(ge){var _e,ve,Te,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(!this._bDispose){Ye.next=4;break}throw xc(_e={}),Zi(_e);case 4:if(null!==ge){Ye.next=7;break}return this._defaultDSScanClient=null,Ye.abrupt("return");case 7:if(ge&&ge instanceof ZB){Ye.next=11;break}throw Bi(ve={}),{code:ve._errorCode,message:ve._errorString};case 11:return Te=this.getViewerElement(),Ye.next=14,this._createDSClientByServiceInfo(ge,!0,Te._containerElement);case 14:if(!(We=Ye.sent)){Ye.next=18;break}return Ye.next=18,this._innerSetDefault(We);case 18:case"end":return Ye.stop()}},de,this)})),function(de){return Oe.apply(this,arguments)})},{key:"_innerSetDefault",value:(Re=_t(B.mark(function de(ge){var _e,ve,Te;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(!ge){We.next=11;break}if(rg._isReady(ge)){We.next=5;break}throw Te=null!==(_e=null===(ve=ge.getServiceInfo())||void 0===ve||null===(ve=ve.attrs)||void 0===ve?void 0:ve.name)&&void 0!==_e?_e:"",T0(ge,Te),{code:ge._getErrorCode(),message:ge._getErrorString()};case 5:this._defaultDSScanClient=ge,this._defaultDSScanClient.IfShowProgressBar=this._showProgressBar,this.Viewer&&this.Viewer.webViewer&&this.Viewer.webViewer.bindViewUI&&this._defaultDSScanClient.setViewerInfo(this.Viewer.webViewer.bindViewUI),this.__setViewerControlInfo(),this._registEventToDefaultDS(),this._viewer&&this._viewer.webViewer.setBufferService(rg._getBuffer(this._defaultDSScanClient));case 11:case"end":return We.stop()}},de,this)})),function(de){return Re.apply(this,arguments)})},{key:"__setViewerControlInfo",value:function(){this.Viewer.webViewer.bindViewUI&&this.Viewer.width&&this.Viewer.width>0&&this.Viewer.height&&this.Viewer.height>0&&this._defaultDSScanClient.setViewerControlInfo({width:this.Viewer.width,height:this.Viewer.height})}},{key:"__beforeImageEditorCreated",value:function(de){var ge=be.DWT.CustomizableDisplayInfo;if(!H.isUndefined(ge)){if(!H.isUndefined(ge.buttons)){var _e=ge.buttons.titles;H.isUndefined(_e)||(H.isUndefined(_e.previous)||(de.buttons.titles.previous=_e.previous),H.isUndefined(_e.next)||(de.buttons.titles.next=_e.next),H.isUndefined(_e.print)||(de.buttons.titles.print=_e.print),H.isUndefined(_e.scan)||(de.buttons.titles.scan=_e.scan),H.isUndefined(_e.load)||(de.buttons.titles.load=_e.load),H.isUndefined(_e.rotateleft)||(de.buttons.titles.rotateleft=_e.rotateleft),H.isUndefined(_e.rotate)||(de.buttons.titles.rotate=_e.rotate),H.isUndefined(_e.rotateright)||(de.buttons.titles.rotateright=_e.rotateright),H.isUndefined(_e.deskew)||(de.buttons.titles.deskew=_e.deskew),H.isUndefined(_e.crop)||(de.buttons.titles.crop=_e.crop),H.isUndefined(_e.cut)||(de.buttons.titles.cut=_e.cut),H.isUndefined(_e.changeimagesize)||(de.buttons.titles.changeimagesize=_e.changeimagesize),H.isUndefined(_e.flip)||(de.buttons.titles.flip=_e.flip),H.isUndefined(_e.mirror)||(de.buttons.titles.mirror=_e.mirror),H.isUndefined(_e.zoomin)||(de.buttons.titles.zoomin=_e.zoomin),H.isUndefined(_e.originalsize)||(de.buttons.titles.originalsize=_e.originalsize),H.isUndefined(_e.zoomout)||(de.buttons.titles.zoomout=_e.zoomout),H.isUndefined(_e.stretch)||(de.buttons.titles.stretch=_e.stretch),H.isUndefined(_e.fit)||(de.buttons.titles.fit=_e.fit),H.isUndefined(_e.fitw)||(de.buttons.titles.fitw=_e.fitw),H.isUndefined(_e.fith)||(de.buttons.titles.fith=_e.fith),H.isUndefined(_e.hand)||(de.buttons.titles.hand=_e.hand),H.isUndefined(_e.rectselect)||(de.buttons.titles.rectselect=_e.rectselect),H.isUndefined(_e.zoom)||(de.buttons.titles.zoom=_e.zoom),H.isUndefined(_e.restore)||(de.buttons.titles.restore=_e.restore),H.isUndefined(_e.save)||(de.buttons.titles.save=_e.save),H.isUndefined(_e.close)||(de.buttons.titles.close=_e.close),H.isUndefined(_e.removeall)||(de.buttons.titles.removeall=_e.removeall),H.isUndefined(_e.removeselected)||(de.buttons.titles.removeselected=_e.removeselected));var ve=ge.buttons.bShowAllButtons;H.isUndefined(ve)||(de.buttons.bShowAllButtons=ve);var Te=ge.buttons.visibility;H.isUndefined(Te)||(H.isUndefined(Te.scan)||(de.buttons.visibility.scan=Te.scan),H.isUndefined(Te.load)||(de.buttons.visibility.load=Te.load),H.isUndefined(Te.print)||(de.buttons.visibility.print=Te.print),H.isUndefined(Te.removeall)||(de.buttons.visibility.removeall=Te.removeall),H.isUndefined(Te.removeselected)||(de.buttons.visibility.removeselected=Te.removeselected),H.isUndefined(Te.rotateleft)||(de.buttons.visibility.rotateleft=Te.rotateleft),H.isUndefined(Te.rotate)||(de.buttons.visibility.rotate=Te.rotate),H.isUndefined(Te.rotateright)||(de.buttons.visibility.rotateright=Te.rotateright),H.isUndefined(Te.deskew)||(de.buttons.visibility.deskew=Te.deskew),H.isUndefined(Te.crop)||(de.buttons.visibility.crop=Te.crop),H.isUndefined(Te.cut)||(de.buttons.visibility.cut=Te.cut),H.isUndefined(Te.changeimagesize)||(de.buttons.visibility.changeimagesize=Te.changeimagesize),H.isUndefined(Te.flip)||(de.buttons.visibility.flip=Te.flip),H.isUndefined(Te.mirror)||(de.buttons.visibility.mirror=Te.mirror),H.isUndefined(Te.zoomin)||(de.buttons.visibility.zoomin=Te.zoomin),H.isUndefined(Te.originalsize)||(de.buttons.visibility.originalsize=Te.originalsize),H.isUndefined(Te.zoomout)||(de.buttons.visibility.zoomout=Te.zoomout),H.isUndefined(Te.stretch)||(de.buttons.visibility.stretch=Te.stretch),H.isUndefined(Te.fit)||(de.buttons.visibility.fit=Te.fit),H.isUndefined(Te.fitw)||(de.buttons.visibility.fitw=Te.fitw),H.isUndefined(Te.fith)||(de.buttons.visibility.fith=Te.fith),H.isUndefined(Te.hand)||(de.buttons.visibility.hand=Te.hand),H.isUndefined(Te.rectselect)||(de.buttons.visibility.rectselect=Te.rectselect),H.isUndefined(Te.zoom)||(de.buttons.visibility.zoom=Te.zoom))}var We=ge.dialogText;H.isUndefined(We)||(H.isUndefined(We.dlgRotateAnyAngle)||(de.dialogText.dlgRotateAnyAngle=We.dlgRotateAnyAngle),H.isUndefined(We.dlgChangeImageSize)||(de.dialogText.dlgChangeImageSize=We.dlgChangeImageSize),H.isUndefined(We.saveChangedImage)||(de.dialogText.saveChangedImage=We.saveChangedImage),H.isUndefined(We.selectSource)||(de.dialogText.selectSource=We.selectSource))}}},{key:"__bufferChanged",value:function(de,ge,_e){var ve,Te=de,We=[],Ye=-1,Be=[];ge.operation&&(ge.action=ge.operation);for(var $e=0;$e<Te.howManyImagesInBuffer;$e++)(ve=Te._defaultDSScanClient.getCustomDataByIndex($e))&&ve.uidFromServer&&We.push(ve.uidFromServer);if(ge.imageIds=We,ge.curIndex>=0&&(ve=Te._defaultDSScanClient.getCustomDataByIndex(ge.curIndex))&&ve.uidFromServer&&(Ye=ve.uidFromServer),ge.currentId=Ye,ge.afterStatus.selectedUids)for(var ze=0;ze<ge.afterStatus.selectedUids.length;ze++){var Ct=ge.afterStatus.selectedUids[ze];if(Ct&&-1!=Ct){var bt=Te._defaultDSScanClient.getIndexByUid(ge.afterStatus.selectedUids[ze]);bt>=0&&(ve=Te._defaultDSScanClient.getCustomDataByIndex(bt))&&ve.serverId&&Be.push(ve.uidFromServer)}}ge.selectedIds=Be,H.mix(ge,{}),delete ge.uids,delete ge.currentUid,delete ge.selectedUids,delete ge.afterStatus,delete ge.beforeStatus,delete ge.operation,delete ge.curIndex,delete ge.docUid,Te.__fireEvent("onBufferChanged",ge)}},{key:"__acquire",value:function(de,ge){var _e=de;_e._stwain.SelectSource(function(){_e._stwain.CloseSource(),_e._stwain.OpenSource(),_e._stwain.IfShowUI=!0,1==be.DWT.IfConfineMaskWithinTheViewer?(be.DWT.IfConfineMaskWithinTheViewer=!1,_e._stwain.AcquireImage({},function(){be.DWT.IfConfineMaskWithinTheViewer=!0},function(){})):_e._stwain.AcquireImage()},function(){H.log("User did not select a source")})}},{key:"__remove",value:(He=_t(B.mark(function de(ge){var _e,ve;return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(_e=this,!this._defaultDSScanClient){Te.next=10;break}if(rs(this._defaultDSScanClient),!(_e.howManyImagesInBuffer<=0||_e.currentImageIndexInBuffer<0)){Te.next=6;break}return CU.output(_e,"No image in Buffer"),Te.abrupt("return",!0);case 6:return ve=rg._getBuffer(this._defaultDSScanClient),Te.next=9,this._defaultDSScanClient.removeImages(ve.getSelectedImagesIndices());case 9:return Te.abrupt("return",Te.sent);case 10:return Te.abrupt("return",!1);case 11:case"end":return Te.stop()}},de,this)})),function(de){return He.apply(this,arguments)})},{key:"__removeAll",value:(Ue=_t(B.mark(function de(ge){return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(!this._defaultDSScanClient){_e.next=4;break}return rs(this._defaultDSScanClient),_e.next=4,this._defaultDSScanClient._removeAllImagesAsync("removeAllImages",!0);case 4:return _e.abrupt("return",!1);case 5:case"end":return _e.stop()}},de,this)})),function(de){return Ue.apply(this,arguments)})},{key:"__save",value:(Ie=_t(B.mark(function de(ge,_e,ve,Te){var We,Ye,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(Ye="save",Be=(We=this).__getViewerElementForViewer(We,Te),Wo(Ye,Be),$e.prev=3,rs(We._defaultDSScanClient),!(We.howManyImagesInBuffer<=0||We.currentImageIndexInBuffer<0)){$e.next=8;break}return CU.output(We,"No image in Buffer"),$e.abrupt("return");case 8:return $e.next=10,We._defaultDSScanClient.updateImage(ge,_e,ve);case 10:return $e.next=13,We._defaultDSScanClient.__saveToViewerAfterUpdate(ge,ve);case 13:$e.next=17;break;case 15:$e.prev=15,$e.t0=$e.catch(3);case 17:return $e.prev=17,Xr(Ye),$e.finish(17);case 20:case"end":return $e.stop()}},de,this,[[3,15,17,20]])})),function(de,ge,_e,ve){return Ie.apply(this,arguments)})},{key:"__getViewerElementForViewer",value:function(de,ge){var _e,ve=de;if(ge)if(ve._viewer.webViewer.imageEditor){var Te=ve._viewer.createImageEditor();_e="dwt-viewer-imageEditor-fullScreen"==Te.inner.containerElement.className?{_containerElement:document.body}:{_containerElement:Te.inner.containerElement}}else _e=ve.getViewerElement();else _e=ve.getViewerElement();return _e}},{key:"__close",value:function(de){var ge=de;if(H.isFunction(ge.__CloseImageEditorUI))try{ge.__CloseImageEditorUI()}catch(_e){Nr(_e)}}},{key:"__deskew",value:function(de,ge,_e){var ve=this,Te="deskew";if(rs(ve._defaultDSScanClient),ve.howManyImagesInBuffer<=0||ve.currentImageIndexInBuffer<0)CU.output(ve,"No image in Buffer");else{var We=ve.__getViewerElementForViewer(ve,!0);Wo(Te,We),ve._defaultDSScanClient.getSkewAngleFromBinaryAsync(ve.currentImageIndexInBuffer,ge,function(Ye){_e(Ye[0]),Xr(Te)},function(){Xr(Te)})}}},{key:"__rotate",value:(ye=_t(B.mark(function de(ge,_e,ve){return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return rs(this._defaultDSScanClient),We.next=4,this._makeSureDefaultServiceInfo();case 4:if(this._defaultDSScanClient){We.next=6;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 6:return We.next=8,this._defaultDSScanClient.rotate(ge,_e,ve,-1);case 8:return We.abrupt("return",We.sent);case 10:case"end":return We.stop()}},de,this)})),function(de,ge,_e){return ye.apply(this,arguments)})},{key:"__crop",value:(ue=_t(B.mark(function de(ge,_e){return B.wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return rs(this._defaultDSScanClient),Te.next=4,this._makeSureDefaultServiceInfo();case 4:if(this._defaultDSScanClient){Te.next=6;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 6:return Te.next=8,this._defaultDSScanClient.crop(ge,_e);case 8:return Te.abrupt("return",Te.sent);case 10:case"end":return Te.stop()}},de,this)})),function(de,ge){return ue.apply(this,arguments)})},{key:"__fireEvent",value:function(de,ge){return!H.isFunction(this[de])||this[de](ge)}},{key:"getDevices",value:(ae=_t(B.mark(function de(ge){var _e,ve,Te,We,Ye,Be,$e,ze,Ct,bt,Vt,In,yn,xt,Pt,It,Wt,en,Cn,hn,Dr,Hn,di;return B.wrap(function(Gt){for(;;)switch(Gt.prev=Gt.next){case 0:if(!this._bDispose){Gt.next=4;break}throw xc(ve={}),Zi(ve);case 4:if(Te=[],We="getDevices",Ye=this.getViewerElement(),Be=!1,ze=null==ge?void 0:ge.serviceInfo,Ct=null!==(_e=null==ge?void 0:ge.deviceType)&&void 0!==_e?_e:WS,Wo(We,Ye),Gt.prev=6,Vt=!1,In=[],this._serviceInfos){Gt.next=12;break}return Gt.next=12,this.getDynamsoftService();case 12:if(!ze){Gt.next=25;break}return Gt.next=15,this._createDSClientByServiceInfo(ze,!0);case 15:if(!(xt=Gt.sent)){Gt.next=21;break}In.push(xt),Vt=!1,Gt.next=23;break;case 21:throw gje(null==ze||null===(Pt=ze.attrs)||void 0===Pt?void 0:Pt.ty);case 23:Gt.next=37;break;case 25:if(!this._serviceInfos){Gt.next=37;break}yn=0;case 27:if(!(yn<this._serviceInfos.length)){Gt.next=36;break}return It=this._serviceInfos[yn],Gt.next=31,this._createDSClientByServiceInfo(It);case 31:(Wt=Gt.sent)&&In.push(Wt);case 33:yn++,Gt.next=27;break;case 36:Vt=!0;case 37:yn=0;case 38:if(!(yn<In.length)){Gt.next=60;break}return en=void 0,Gt.prev=40,Gt.next=43,In[yn].getDevices(Ct,null==ge?void 0:ge.refresh,Be);case 43:if(H.isArray(en=Gt.sent)&&en.length>0)for($e=0;$e<en.length;$e++)Te.push(en[$e]);Gt.next=52;break;case 47:if(Gt.prev=47,Gt.t0=Gt.catch(40),!Be){Gt.next=51;break}throw Gt.t0;case 51:bt=Gt.t0;case 52:return Gt.prev=52,Cn=null,this._defaultDSScanClient&&(Cn=null===(hn=this._defaultDSScanClient.getServiceInfo())||void 0===hn||null===(hn=hn.attrs)||void 0===hn?void 0:hn.UUID,this._defaultDSScanClient.isDestroy&&(this._disposeDSClientByKey(Cn),this._defaultDSScanClient=null,Cn=null)),Vt&&(Hn=In[yn].getServiceInfo(),(di=null==Hn||null===(Dr=Hn.attrs)||void 0===Dr?void 0:Dr.UUID)&&di!=Cn&&this._disposeDSClientByKey(di)),Gt.finish(52);case 57:yn++,Gt.next=38;break;case 60:Gt.next=65;break;case 62:throw Gt.prev=62,Gt.t1=Gt.catch(6),Gt.t1;case 65:return Gt.prev=65,Xr(We),bt&&be.DWT.lsetException(bt.code,bt.message),Gt.finish(65);case 69:return Gt.abrupt("return",Te);case 70:case"end":return Gt.stop()}},de,this,[[6,62,65,69],[40,47,52,57]])})),function(de){return ae.apply(this,arguments)})},{key:"acquireImage",value:(oe=_t(B.mark(function de(ge,_e){var ve,Te,We,Ye,Be,$e,ze,Ct,bt,Vt,In,yn,xt,Pt;return B.wrap(function(It){for(;;)switch(It.prev=It.next){case 0:if(!(ve=this)._bDispose){It.next=5;break}throw xc(Te={}),Zi(Te);case 5:if(ge&&ge instanceof hd){It.next=9;break}throw Bi(We={}),{code:We._errorCode,message:We._errorString};case 9:return Be="acquireImage",$e=ve.getViewerElement(),ze=[],Wo(Be,$e),It.prev=12,H.isUndefined(_e)&&(_e={}),H.isUndefined(_e.IfShowUI)&&(_e.IfShowUI=!1),H.isUndefined(_e.IfCloseSourceAfterAcquire)&&(_e.IfCloseSourceAfterAcquire=!0),Ct=ge.serviceInfo,It.next=19,this._createDSClientByServiceInfo(Ct,!0);case 19:if(!(Ye=It.sent)){It.next=47;break}if(ve._defaultDSScanClient){It.next=24;break}return It.next=24,ve._innerSetDefault(Ye);case 24:ze.push(Ye),Ye!=ve._defaultDSScanClient&&ze.push(ve._defaultDSScanClient),bt=0;case 27:if(!(bt<ze.length)){It.next=36;break}if(rg._isReady(Vt=ze[bt])){It.next=33;break}throw xt=null!==(In=null===(yn=Vt.getServiceInfo())||void 0===yn||null===(yn=yn.attrs)||void 0===yn?void 0:yn.name)&&void 0!==In?In:"",T0(Vt,xt),{code:Vt._getErrorCode(),message:Vt._getErrorString()};case 33:bt++,It.next=27;break;case 36:if(ve.onPostTransferAsync?Ye.registerEvent("OnPostTransferAsync",ve.onPostTransferAsync):Ye.unregisterEvent("OnPostTransferAsync"),this.__setViewerControlInfo(),Ye!=ve._defaultDSScanClient){It.next=43;break}return It.next=41,Ye.acquireImage(ge,_e);case 41:It.next=45;break;case 43:return It.next=45,Ye._acquireImageForSendTo(Be,ge,_e,ve._defaultDSScanClient);case 45:It.next=49;break;case 47:throw Hle(null==Ct||null===(Pt=Ct.attrs)||void 0===Pt?void 0:Pt.name);case 49:It.next=54;break;case 51:throw It.prev=51,It.t0=It.catch(12),It.t0;case 54:return It.prev=54,Ye&&Ye.__closeRemoteScanUI(!0),Xr(Be),It.finish(54);case 58:case"end":return It.stop()}},de,this,[[12,51,54,58]])})),function(de,ge){return oe.apply(this,arguments)})},{key:"_waitForDSValid",value:function(de,ge){for(var _e=0,ve=de.length,Te=this;_e<ve;_e++)if(!rg._isReady(de[_e]))return void setTimeout(function(){Te._waitForDSValid(de,ge)},xo.RemoteReconnectTimeSpan);H.isFunction(Te[ge.command])&&Te[ge.command].apply(Te,ge.parmas)}},{key:"getCapabilities",value:(K=_t(B.mark(function de(ge){var _e,ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(!this._bDispose){ze.next=4;break}throw xc(_e={}),Zi(_e);case 4:if(ge&&ge instanceof hd){ze.next=8;break}throw Bi(ve={}),Zi(ve);case 8:return We="getCapabilities",Ye=[],Be=this.getViewerElement(),Wo(We,Be),ze.prev=10,$e=ge.serviceInfo,ze.next=14,this._createDSClientByServiceInfo($e,!0);case 14:if(Te=ze.sent,!(Te=this._findDSClientByServiceInfo($e))){ze.next=20;break}return ze.next=19,Te.getCapabilities(ge);case 19:Ye=ze.sent;case 20:ze.next=25;break;case 22:throw ze.prev=22,ze.t0=ze.catch(10),ze.t0;case 25:return ze.prev=25,Te&&Te.__closeRemoteScanUI(!0),Xr(We),ze.finish(25);case 29:return ze.abrupt("return",Ye);case 30:case"end":return ze.stop()}},de,this,[[10,22,25,29]])})),function(de){return K.apply(this,arguments)})},{key:"setCapabilities",value:(z=_t(B.mark(function de(ge,_e){var ve,Te,We,Ye,Be,$e;return B.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(!this._bDispose){ze.next=4;break}throw xc(ve={}),Zi(ve);case 4:if(ge&&ge instanceof hd){ze.next=8;break}throw Bi(Te={}),Zi(Te);case 8:return Ye="setCapabilities",Be=this.getViewerElement(),Wo(Ye,Be),ze.prev=10,$e=ge.serviceInfo,ze.next=14,this._createDSClientByServiceInfo($e,!0);case 14:if(!(We=ze.sent)){ze.next=18;break}return ze.next=18,We.setCapabilities(ge,_e);case 18:ze.next=23;break;case 20:throw ze.prev=20,ze.t0=ze.catch(10),ze.t0;case 23:return ze.prev=23,We&&We.__closeRemoteScanUI(!0),Xr(Ye),ze.finish(23);case 27:case"end":return ze.stop()}},de,this,[[10,20,23,27]])})),function(de,ge){return z.apply(this,arguments)})},{key:"closeSource",value:(X=_t(B.mark(function de(ge){var _e,ve,Te,We,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(!this._bDispose){$e.next=4;break}throw xc(_e={}),Zi(_e);case 4:if(ge&&ge instanceof hd){$e.next=8;break}throw Bi(ve={}),Zi(ve);case 8:return Te="closeSource",We=this.getViewerElement(),Wo(Te,We),$e.prev=10,Be=this._findDSClientByServiceInfo(ge.serviceInfo),$e.next=15,Be.closeSource();case 15:$e.next=20;break;case 17:throw $e.prev=17,$e.t0=$e.catch(10),$e.t0;case 20:return $e.prev=20,Xr(Te),$e.finish(20);case 23:case"end":return $e.stop()}},de,this,[[10,17,20,23]])})),function(de){return X.apply(this,arguments)})},{key:"_putDSClientToMap",value:function(de,ge){var _e,ve=null==de||null===(_e=de.attrs)||void 0===_e?void 0:_e.UUID;ve&&(this._dsScanClientsMap[ve]=ge)}},{key:"_getDSClientFromMap",value:function(de){var ge,_e=null==de||null===(ge=de.attrs)||void 0===ge?void 0:ge.UUID;return _e?this._dsScanClientsMap[_e]:null}},{key:"_createDSClientByServiceInfo",value:(G=_t(B.mark(function de(ge,_e,ve){var Te,We,Ye,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(this._serviceInfos){$e.next=3;break}return $e.next=3,this.getDynamsoftService();case 3:if(Te=this._findDSClientByServiceInfo(ge)){$e.next=20;break}return $e.next=7,this._setRemoteUuid();case 7:return $e.prev=7,$e.next=10,rg.createByServiceInfo(this._uuidForRemoteScanObject,ge,ve);case 10:(Te=$e.sent)&&this._putDSClientToMap(ge,Te),$e.next=20;break;case 14:if($e.prev=14,$e.t0=$e.catch(7),$e.t0.code==Xn.MustUpgrade&&(Ye=null==ge||null===(We=ge.attrs)||void 0===We?void 0:We.ty)&&(Q1(Be={},Ye),$e.t0.message=Be._errorString),!_e){$e.next=19;break}throw $e.t0;case 19:H.warn($e.t0);case 20:return $e.abrupt("return",Te);case 21:case"end":return $e.stop()}},de,this,[[7,14]])})),function(de,ge,_e){return G.apply(this,arguments)})},{key:"_makeSureDefaultServiceInfo",value:(U=_t(B.mark(function de(){var ge;return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(this._serviceInfos){_e.next=3;break}return _e.next=3,this.getDynamsoftService();case 3:if(!(this._serviceInfos&&this._serviceInfos.length>0)){_e.next=8;break}return ge=this._serviceInfos[0],_e.next=7,this._createDSClientByServiceInfo(ge);case 7:return _e.abrupt("return",_e.sent);case 8:return _e.abrupt("return",null);case 9:case"end":return _e.stop()}},de,this)})),function(){return U.apply(this,arguments)})},{key:"httpUpload",value:(O=_t(B.mark(function de(ge,_e,ve,Te,We,Ye){var Be,ze,Ct;return B.wrap(function(bt){for(;;)switch(bt.prev=bt.next){case 0:if(!this._bDispose){bt.next=4;break}return xc(Be={}),bt.abrupt("return",me.Promise.reject(Zi(Be)));case 4:return ze=this.getViewerElement(),Ct=ze._containerElement,bt.next=7,this._makeSureDefaultServiceInfo();case 7:if(this._defaultDSScanClient){bt.next=9;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 9:return bt.next=11,this._defaultDSScanClient.httpUpload(ge,_e,ve,Te,We,Ye,Ct);case 11:return bt.abrupt("return",bt.sent);case 13:case"end":return bt.stop()}},de,this)})),function(de,ge,_e,ve,Te,We){return O.apply(this,arguments)})},{key:"runCommand",value:function(de){return this._defaultDSScanClient.RunCommandAsync(de)}},{key:"removeImages",value:(P=_t(B.mark(function de(ge){var _e,ve,Te,We,Ye;return B.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(!this._bDispose){Be.next=4;break}return xc(_e={}),Be.abrupt("return",me.Promise.reject(Zi(_e)));case 4:return ve="removeImages",We=this.getViewerElement(),Wo(ve,We),Be.prev=6,Be.next=9,this._makeSureDefaultServiceInfo();case 9:if(this._defaultDSScanClient){Be.next=11;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 11:if(!this._defaultDSScanClient){Be.next=17;break}return Be.next=14,this._defaultDSScanClient.removeImages(ge);case 14:Te=Be.sent,Be.next=21;break;case 17:if(0!=this.howManyImagesInBuffer){Be.next=21;break}if(mfe(ge,this.howManyImagesInBuffer,Ye={})){Be.next=21;break}throw{code:Ye._errorCode,message:Ye._errorString};case 21:Be.next=26;break;case 23:throw Be.prev=23,Be.t0=Be.catch(6),Be.t0;case 26:return Be.prev=26,Xr(ve),Be.finish(26);case 29:return Be.abrupt("return",Te);case 30:case"end":return Be.stop()}},de,this,[[6,23,26,29]])})),function(de){return P.apply(this,arguments)})},{key:"saveImages",value:(R=_t(B.mark(function de(ge,_e,ve){var Te,Ye,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(Te={},!this._bDispose){$e.next=4;break}return xc(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 4:if(0!=this.howManyImagesInBuffer){$e.next=7;break}return ta(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 7:if(H.isNumber(ve)){$e.next=10;break}return Bi(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 10:if(ve!=Ti.IT_BMP&&ve!=Ti.IT_JPG&&ve!=Ti.IT_PNG){$e.next=16;break}if(!(_e.length>1)){$e.next=14;break}return St(Te,-2623,"Saving multiple images is not allowable when the selected output format is BMP, JPG or PNG."),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 14:$e.next=26;break;case 16:if(ve!=Ti.IT_TIF&&ve!=Ti.IT_PDF){$e.next=19;break}$e.next=26;break;case 19:if(ve!=Ti.IT_ALL&&ve!=Ti.IT_MULTIPAGE_PDF&&ve!=Ti.IT_MULTIPAGE_TIF){$e.next=24;break}return Xle(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 24:return Kl(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 26:return Ye=this.getViewerElement(),Be=Ye._containerElement,$e.next=29,this._makeSureDefaultServiceInfo();case 29:if(this._defaultDSScanClient){$e.next=31;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 31:return $e.next=33,this._defaultDSScanClient.saveImages(ge,_e,ve,Be);case 33:return $e.abrupt("return",$e.sent);case 35:case"end":return $e.stop()}},de,this)})),function(de,ge,_e){return R.apply(this,arguments)})},{key:"getImages",value:(D=_t(B.mark(function de(ge,_e,ve){var Te,Ye,Be;return B.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(Te={},!this._bDispose){$e.next=4;break}return xc(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 4:if(0!=this.howManyImagesInBuffer){$e.next=7;break}return ta(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 7:if(H.isNumber(_e)&&H.isNumber(ve)){$e.next=10;break}return Bi(Te),$e.abrupt("return",me.Promise.reject(Zi(Te)));case 10:return Ye=this.getViewerElement(),Be=Ye._containerElement,$e.next=13,this._makeSureDefaultServiceInfo();case 13:if(this._defaultDSScanClient){$e.next=15;break}throw{code:-2825,message:"Failed to setup the Default Dynamsoft Service."};case 15:return $e.next=17,this._defaultDSScanClient.getImages(ge,_e,ve,Be);case 17:return $e.abrupt("return",$e.sent);case 19:case"end":return $e.stop()}},de,this)})),function(de,ge,_e){return D.apply(this,arguments)})},{key:"__unload",value:(T=_t(B.mark(function de(){var ge,ve,Te;return B.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(this._viewer&&this._viewer.unbind(),!this._dsScanClientsMap){We.next=12;break}ve=Object.keys(this._dsScanClientsMap),ge=0;case 5:if(!(ge<ve.length)){We.next=12;break}return Te=ve[ge],We.next=9,this._disposeDSClientByKey(Te);case 9:ge++,We.next=5;break;case 12:this._dsScanClientsMap=null,this._bDispose=!0;case 14:case"end":return We.stop()}},de,this)})),function(){return T.apply(this,arguments)})},{key:"dispose",value:function(){return this.__unload()}},{key:"setLogLevel",value:function(de){var ge,_e=this._dsScanClientsMap;if(_e){var ve=Object.keys(_e);for(ge=0;ge<ve.length;ge++)_e[ve[ge]]._setLogLevel(de);this._needSetLogLevel=!1,this._logLevel=-1}else this._needSetLogLevel=!0,this._logLevel=de;return!0}},{key:"getProfile",value:(S=_t(B.mark(function de(ge){var _e,ve,Te,We;return B.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(_e="",ge&&ge instanceof hd){Ye.next=5;break}throw Bi(ve={}),{code:ve._errorCode,message:ve._errorString};case 5:return Ye.prev=5,Te=ge.serviceInfo,Ye.next=9,this._createDSClientByServiceInfo(Te,!0);case 9:if(!(We=Ye.sent)){Ye.next=14;break}return Ye.next=13,We.getProfile(ge);case 13:_e=Ye.sent;case 14:Ye.next=19;break;case 16:throw Ye.prev=16,Ye.t0=Ye.catch(5),Ye.t0;case 19:return Ye.abrupt("return",_e);case 20:case"end":return Ye.stop()}},de,this,[[5,16]])})),function(de){return S.apply(this,arguments)})},{key:"setProfile",value:(x=_t(B.mark(function de(ge,_e){var ve,Te,We,Ye;return B.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(ve="",ge&&ge instanceof hd){Be.next=5;break}throw Bi(Te={}),{code:Te._errorCode,message:Te._errorString};case 5:return Be.prev=5,We=ge.serviceInfo,Be.next=9,this._createDSClientByServiceInfo(We,!0);case 9:if(!(Ye=Be.sent)){Be.next=14;break}return Be.next=13,Ye.setProfile(ge,_e);case 13:ve=Be.sent;case 14:Be.next=19;break;case 16:throw Be.prev=16,Be.t0=Be.catch(5),Be.t0;case 19:return Be.abrupt("return",ve);case 20:case"end":return Be.stop()}},de,this,[[5,16]])})),function(de,ge){return x.apply(this,arguments)})},{key:"imageIDToIndex",value:function(de){return this._defaultDSScanClient?this._defaultDSScanClient.imageIDToIndex(de):0}},{key:"indexToImageID",value:function(de){return this._defaultDSScanClient?this._defaultDSScanClient.indexToImageID(de):""}},{key:"howManyImagesInBuffer",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.howManyImagesInBuffer:0}},{key:"currentImageIndexInBuffer",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.currentImageIndexInBuffer:-1},set:function(de){this._defaultDSScanClient&&(this._defaultDSScanClient.currentImageIndexInBuffer=de)}},{key:"showProgressBar",get:function(){return this._defaultDSScanClient?this._defaultDSScanClient.IfShowProgressBar:this._showProgressBar},set:function(de){this._defaultDSScanClient&&(this._showProgressBar=de,this._defaultDSScanClient.IfShowProgressBar=de)}},{key:"registerEvent",value:function(de,ge){if(this._bDispose){var _e={};return xc(_e),me.Promise.reject(Zi(_e))}if(!H.isFunction(ge)){var ve={};return Vle(ve),me.Promise.reject(Zi(ve))}if("onBufferChanged"==de||"OnBufferChanged"==de)this.onBufferChanged=ge;else{if("onPostTransferAsync"!=de&&"OnPostTransferAsync"!=de){var Te={};return Ble(Te),me.Promise.reject(Zi(Te))}this.onPostTransferAsync=ge}return this._registEventToDefaultDS(),!0}},{key:"unregisterEvent",value:function(de,ge){if(this._bDispose){var _e={};return xc(_e),me.Promise.reject(Zi(_e))}if("onBufferChanged"==de||"OnBufferChanged"==de){if(this.onBufferChanged=null,this._defaultDSScanClient)return this._defaultDSScanClient.unregisterEvent("OnBufferChanged",ge)}else{if("onPostTransferAsync"!=de&&"OnPostTransferAsync"!=de){var ve={};return Ble(ve),me.Promise.reject(Zi(ve))}if(this.onPostTransferAsync=null,this._defaultDSScanClient)return this._defaultDSScanClient.unregisterEvent("OnPostTransferAsync",ge)}}},{key:"getViewerElement",value:function(){return this.Viewer&&this.Viewer.webViewer&&this.Viewer.webViewer.containerElement?{_containerElement:this.Viewer.webViewer.containerElement}:{_containerElement:document.body}}},{key:"isSameService",value:function(de,ge){return!(!de||!ge)&&de.server==ge.server&&de.attrs.UUID==ge.attrs.UUID&&de.attrs.accessmode==ge.attrs.accessmode&&de.attrs.name==ge.attrs.name&&de.attrs.os==ge.attrs.os&&de.attrs.service_type==ge.attrs.service_type&&de.attrs.tags==ge.attrs.tags&&de.attrs.ty==ge.attrs.ty&&de.attrs.type==ge.attrs.type&&de.attrs.txtvers==ge.attrs.txtvers}},{key:"_findDSClientByServiceInfo",value:function(de){var ge,_e=this._serviceInfos;if(_e)for(ge=0;ge<_e.length;ge++){var ve=_e[ge];if(this.isSameService(de,ve)){var Te=this._getDSClientFromMap(ve);if(Te){var We;if(rg._isReady(Te))return Te;Te.isDestroy||Te.dispose();var Ye=null==ve||null===(We=ve.attrs)||void 0===We?void 0:We.UUID;Ye&&delete this._dsScanClientsMap[Ye]}break}}return null}},{key:"_setRemoteUuid",value:(C=_t(B.mark(function de(){return B.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(!Qa()){_e.next=8;break}if(this._uuidForRemoteScanObject){_e.next=6;break}return _e.next=4,be.DWT.lgcuid(be.DWT.EnumInstance.dwt_desktop,"");case 4:this._uuidForRemoteScanObject=_e.sent;case 6:_e.next=8;break;case 8:case"end":return _e.stop()}},de,this)})),function(){return C.apply(this,arguments)})},{key:"_registEventToDefaultDS",value:function(){this._defaultDSScanClient&&(this.onBufferChanged&&this._defaultDSScanClient.registerEvent("OnBufferChanged",this.onBufferChanged),this.onPostTransferAsync&&this._defaultDSScanClient.registerEvent("OnPostTransferAsync",this.onPostTransferAsync))}}]);var C,x,S,T,D,R,P,O,U,G,X,z,K,oe,ae,ue,ye,Ie,Ue,He,Re,Oe,Ge,Se}(),JP=!1;function bU(C,x){return xU.apply(this,arguments)}function xU(){return xU=_t(B.mark(function C(x,S){var T,D;return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(S&&lo(Fje),mn.isLicenseMixed(null,!0)||mn.reparseProductKey(S),0==(T=be.DWT.licenseException).code){R.next=6;break}throw x&&QB(T),{code:T.code,message:T.message};case 6:if(JP){R.next=14;break}if(D=!1,he.bIE&&(D=he.IEVersion<=7),D||!Qa()){R.next=14;break}if(!be.DWT.bChromeExtension){R.next=13;break}return JP=!0,R.abrupt("return");case 13:return R.abrupt("return",new me.Promise(function(P,O){var G="";he.bFileSystem||(G=me.timestamp),H.addScript([be.DWT.ResourcesPath,"/src/dynamsoft.lts.js",G].join(""),!0,!1,function(X){if(be.LTS&&be.LTS._)return JP=!0,void P();if(X){if(he.bIE)return void O({code:-2822,message:"The WebTwain JavaScript lts.js load failed."});if("error"==X.type)return void O({code:-2822,message:"The WebTwain JavaScript lts.js load failed."})}JP=!0,P()})}));case 14:case"end":return R.stop()}},C)})),xU.apply(this,arguments)}function lKe(C,x,S){return wU.apply(this,arguments)}function wU(){return wU=_t(B.mark(function C(x,S,T){var D,R,P,O,U,G,X,z,K,oe,ae;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:D=be.DWT.Containers,R=0;case 2:if(!(R<D.length)){ue.next=52;break}if(!(P=H.clone(D[R])).ContainerId){ue.next=8;break}if(!be.DWT.ContainerMap[P.ContainerId]){ue.next=8;break}return ue.abrupt("continue",49);case 8:if(!P.WebTwainId){ue.next=12;break}if(!be.DWT.WebTwainIdMap[P.WebTwainId]){ue.next=12;break}return ue.abrupt("continue",49);case 12:if(P.Host=x,P.SSLPort=T,P.Port=S,!H.isDOM(P.Container)){ue.next=18;break}ue.next=25;break;case 18:if(!P.ContainerId){ue.next=25;break}if(H.isString(G=P.ContainerId)){ue.next=22;break}throw{code:-2806,message:'Error: The argument passed to the parameter "conatinerId" is not a string.'};case 22:if(P.Container=H.get(G),P.Container){ue.next=25;break}throw $le(G);case 25:if(!TW(P.Container)){ue.next=32;break}return X=document.createElement("div"),P.Container.appendChild(X),P.Container=X,z=SW(X),ue.next=32,_ue(z);case 32:return CHe(K=Xfe(P)),oe=void 0,ue.prev=35,ue.next=38,Tpe.create(K);case 38:oe=ue.sent,ue.next=45;break;case 41:throw ue.prev=41,ue.t0=ue.catch(35),oe&&oe.dispose(),ue.t0;case 45:if(0===(U=be.DWT.licenseException).code){ue.next=48;break}throw{code:U.code,message:U.message};case 48:O=oe;case 49:R++,ue.next=2;break;case 52:ae=window,O&&(ae.DCP_DWT_OnClickCloseInstall&&ae.DCP_DWT_OnClickCloseInstall(!1,!0),Dpe(O),gfe(O)),setTimeout(function(){try{H.isFunction(be.DWT.OnWebTwainReady)?be.DWT.OnWebTwainReady():H.isFunction(ae.Dynamsoft_OnReady)&&ae.Dynamsoft_OnReady()}catch(ye){Nr(ye)}},100);case 55:case"end":return ue.stop()}},C,null,[[35,41]])})),wU.apply(this,arguments)}function Ape(){return SU.apply(this,arguments)}function SU(){return SU=_t(B.mark(function C(){var x,S,T,D,R,P,O,U,G,X,z,K,oe,ae;return B.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return me.page.bUnload=yt,ue.next=3,bU(!0,!0);case 3:if(Tt.bHTML5Edition){ue.next=5;break}return ue.abrupt("return",be.DWT._innerLoad());case 5:if((x=be.DWT.Containers)&&0!==x.length){ue.next=10;break}throw Yle(S={}),{code:S._errorCode,message:S._errorString};case 10:R=!1,P=[],O=[],T=0;case 12:if(!(T<x.length)){ue.next=37;break}if(!(D=x[T])){ue.next=32;break}if(H.isObject(D)){ue.next=18;break}return R=!0,ue.abrupt("break",37);case 18:if(!H.isString(D.WebTwainId)||""==D.WebTwainId){ue.next=24;break}if(!bue(P,D.WebTwainId)){ue.next=23;break}throw qle(S={}),{code:S._errorCode,message:S._errorString};case 23:P.push(D.WebTwainId);case 24:if(!H.isString(D.ContainerId)||""==D.ContainerId){ue.next=30;break}if(!bue(O,D.ContainerId)){ue.next=29;break}throw Kle(S={}),{code:S._errorCode,message:S._errorString};case 29:O.push(D.ContainerId);case 30:ue.next=34;break;case 32:return R=!0,ue.abrupt("break",37);case 34:T++,ue.next=12;break;case 37:if(!R){ue.next=41;break}throw fje(U={}),{code:U._errorCode,message:U._errorString};case 41:return G=Ja(),X=be.DWT.Port,z=be.DWT.SSLPort,ue.next=44,Qfe(G,X,z);case 44:if(!be.DWT.IfCheckDCP){ue.next=65;break}return K=he.bSSL?z:X,ue.next=48,r9(G,X,z);case 48:if(!(oe=ue.sent)){ue.next=54;break}X=oe.port,z=oe.sslPort,ue.next=57;break;case 54:throw Jl(ae={}),Zi(ae);case 57:if(!be.dcp.bEnhancedMode){ue.next=65;break}return ue.prev=58,ue.next=61,Gp.closeWsClient(G,K,he.bSSL);case 61:ue.next=65;break;case 63:ue.prev=63,ue.t0=ue.catch(58);case 65:return lo(jje),ue.next=68,lKe(G,X,z);case 68:case"end":return ue.stop()}},C,null,[[58,63]])})),SU.apply(this,arguments)}var cKe=new(v(function C(){n(this,C)},[{key:"InvalidValue",value:function(C){ga(C)}},{key:"ParameterCannotEmpty",value:function(C){wl(C)}},{key:"Webcam_InvalidIndex",value:function(C,x){St(C,-2315,"The index is out of range.")}},{key:"Webcam_InvalidRemoteFilename",value:function(C){St(C,-2316,"The RemoteFile field is empty in the Webcam Download Function.")}},{key:"InvalidDestination",value:function(C){St(C,-2318,"Invalid destination file.")}},{key:"InvalidSourceFile",value:function(C){St(C,-2319,"Invalid source file.")}},{key:"InvalidFile",value:function(C){S0(C)}},{key:"OCR_InvalidIndex",value:function(C,x){St(C,-2321,"The index is out of range.")}},{key:"OCR_InvalidLeftOrTopOrRightOrBottom",value:function(C){St(C,-2322,"The left or top or right or bottom you entered is invalid.")}},{key:"OCR_InvalidOutputFormat",value:function(C){St(C,-2323,"The OCR output format is not supported.")}},{key:"OCR_InvalidPageSetMode",value:function(C){St(C,-2324,"The OCR page set mode is not supported.")}},{key:"IndexOutOfRange",value:function(C){Mt(C)}},{key:"OCR_InvalidRemoteFilename",value:function(C){St(C,-2379,"The RemoteFile field is empty in the OCR Download Function.")}},{key:"ImageEditorOpenCannotPlayVideo",value:function(C){St(C,-2437,"The video can not be played while the Image Editor is open.")}},{key:"EventNotExist",value:function(C){St(C,-2509,"The specified event doesn't exist.")}},{key:"CallbackNotAFunction",value:function(C){Vle(C)}},{key:"WasmNotLoaded",value:function(C){St(C,-2537,"The wasm not loaded.")}},{key:"WasmNotLoaded_UseWasmFalse",value:function(C){St(C,-2538,"The wasm not loaded when Dynamsoft.DWT.UseCameraAddonWasm is set to false.")}},{key:"CannotDoWhenNoViewerJS",value:function(C){GA(C)}},{key:"LicenseNoDbr",value:function(C){St(C,-2611,"The license for the Barcode module is invalid."),Ao(C)}}]));if(Tt.bHTML5Edition){var uKe=function(){var C=_t(B.mark(function x(S){var T,D,R,P,O,U,G;return B.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return Nfe(),z.next=3,bU(!0,!1);case 3:if(be.DWT.UseDefaultViewer||(S.Container=null),!TW(S.Container)){z.next=11;break}return D=document.createElement("div"),S.Container.appendChild(D),S.Container=D,R=SW(D),z.next=11,_ue(R);case 11:return T=Xfe(S),z.next=14,EC();case 14:return z.next=16,zP();case 16:P=3,O=0;case 18:if(!(O<P)){z.next=35;break}return z.prev=19,z.next=22,Qfe(T.host,T.port,T.sslPort);case 22:return z.abrupt("break",35);case 25:if(z.prev=25,z.t0=z.catch(19),!(O<P-1&&z.t0.code==Xn.DWTPortNotReady)){z.next=31;break}return z.next=30,new me.Promise(function(K,oe){setTimeout(function(){K()},300)});case 30:return z.abrupt("continue",32);case 31:throw z.t0;case 32:O++,z.next=18;break;case 35:if(!be.DWT.IfCheckDCP){z.next=47;break}return z.next=38,r9(T.host,T.port,T.sslPort);case 38:if(!(U=z.sent)){z.next=44;break}T.port=U.port,T.sslPort=U.sslPort,z.next=47;break;case 44:throw Jl(G={}),Zi(G);case 47:return lo("Creating a WebTwain instance..."),z.next=50,rKe(T);case 50:return z.abrupt("return",z.sent);case 52:case"end":return z.stop()}},x,null,[[19,25]])}));return function(x){return C.apply(this,arguments)}}(),dKe=window;be.DWT.OnBeforeUnload=function(C){},dKe.addEventListener("beforeunload",function(C){if(me.isFunction(be.DWT.OnBeforeUnload))return be.DWT.OnBeforeUnload(C)}),be.DWT.Unload=_t(B.mark(function C(){var x;return B.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!Tt.bDWTLoading&&!Tt.bDWTUnloading){S.next=2;break}return S.abrupt("return");case 2:return Tt.bDWTUnloading=!0,S.prev=3,S.next=6,y3(!1,!0);case 6:S.next=11;break;case 8:S.prev=8,S.t0=S.catch(3),x=S.t0;case 11:try{Um(),be.DWT.CloseDialog(),me._zdgb_xkz_dhk(),me.closeProgress(null,""),me.hideMask(),bHe()}catch(T){}if(Tt.bDWTLoading=!1,Tt.bDWTUnloading=!1,!x){S.next=16;break}throw x;case 16:case"end":return S.stop()}},C,null,[[3,8]])})),be.DWT.Load=_t(B.mark(function C(){var x,S;return B.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Tt.bDWTLoading){T.next=2;break}return T.abrupt("return");case 2:if(!Tt.bDWTUnloading){T.next=5;break}return setTimeout(be.DWT.Load,500),T.abrupt("return");case 5:return Tt.bDWTLoading=!0,_3(),T.prev=7,T.prev=8,T.next=11,GP();case 11:return T.next=13,EC();case 13:return T.next=15,zP();case 15:T.next=21;break;case 17:throw T.prev=17,T.t0=T.catch(8),oP(T.t0),T.t0;case 21:return T.prev=21,be.Lib.closeProgress(),T.next=25,y3(!0,!0);case 25:T.next=31;break;case 27:return T.prev=27,T.t1=T.catch(21),T.next=31,y3();case 31:T.prev=31,be.DWT.CloseDialog(),x=3,S=0;case 35:if(!(S<x)){T.next=52;break}return T.prev=36,T.next=39,Ape();case 39:return T.abrupt("break",52);case 42:if(T.prev=42,T.t2=T.catch(36),!(S<x-1&&T.t2.code==Xn.DWTPortNotReady)){T.next=48;break}return T.next=47,new me.Promise(function(D,R){setTimeout(function(){D()},300)});case 47:return T.abrupt("continue",49);case 48:throw T.t2;case 49:S++,T.next=35;break;case 52:T.next=66;break;case 54:return T.prev=54,T.t3=T.catch(31),sP(T.t3.code)||me.detect.bOK||H.asyncQueue.pushToDo(null,be.DWT.Load),oP(T.t3),T.prev=59,T.next=62,y3();case 62:T.next=66;break;case 64:T.prev=64,T.t4=T.catch(59);case 66:return T.prev=66,Tt.bDWTLoading=!1,Um(),T.finish(66);case 70:case"end":return T.stop()}},C,null,[[7,,66,70],[8,17],[21,27],[31,54],[36,42],[59,64]])})),be.DWT.CheckConnectToTheService=function(C,x,S,T){tpe(C,x,null,S,T)},be.DWT.ConnectToTheService=function(){H.asyncQueue.start()},be.DWT.CreateDWTObject=function(C,x,S,T,D,R){var P,O=D,U=R;H.isFunction(x)&&H.isFunction(S)?(O=x,U=S,P={}):P={Host:x,Port:S,SSLPort:T};var G,X=C;if(H.isString(X)&&!(X=H.get(X)))return St(G={},-2813,"Error: The ID of the target DIV for the new DWT object is invalid."),U&&U({code:G._errorCode,message:G._errorString}),yt;if(H.isDOM(X))P.Container=X;else{if(!H.isString(C))return H.isFunction(U)&&U({code:-2806,message:'Error: The argument passed to the parameter "conatinerId" is not a string.'}),yt;if(!H.get(C)){var K=$le(C);return H.isFunction(U)&&U(K),yt}}return P.WebTwainId=lue(),be.DWT.CreateDWTObjectEx(P,O,U)},be.DWT.CreateDWTObjectEx=function(C,x,S){var T=arguments,D=!!C.bLoadingDialogOpened;return Tt.loadResourcePath?H.isString(C.WebTwainId)?(D||_3(),delete C.bLoadingDialogOpened,uKe(C).then(function(R){Um(),gfe(R),H.isFunction(x)&&x(R)},function(R){if(Um(),!me.detect.bOK){var P=R&&R.code,O=be.DWT.licenseException;(P&&!sP(P)||0==O.code)&&(H.asyncQueue.stop(),H.asyncQueue.pushToDo(null,be.DWT.CreateDWTObjectEx,T))}H.isFunction(S)&&S(R)}),!0):(D&&Um(),S&&S({code:-2805,message:'Error: The "WebTwainId" is not a string.'}),yt):(D||(_3(),C.bLoadingDialogOpened=!0),void GP().then(EC).then(function(){setTimeout(function(){be.DWT.CreateDWTObjectEx(C,x,S)},100)},function(R){Um(),S(R)}))},be.DWT.CreateRemoteScanObjectAsync=function(){var C=_t(B.mark(function x(S){var T,D;return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(T=null,S){R.next=5;break}throw Bi(D={}),{code:D._errorCode,message:D._errorString};case 5:return Tt.bDWTLoading=!0,_3(),R.prev=7,R.next=10,EC();case 10:return R.next=12,zP();case 12:return R.next=14,bU(!1,!1);case 14:T=new aKe(S),Object.preventExtensions(T);case 16:return R.prev=16,Tt.bDWTLoading=!1,Um(),R.finish(16);case 20:return R.abrupt("return",T);case 21:case"end":return R.stop()}},x,null,[[7,,16,20]])}));return function(x){return C.apply(this,arguments)}}(),be.DWT.DeleteDWTObject=function(C){var x,S=C;return Tt.bHTML5Edition&&S?!!(x=H.isString(S)?be.DWT.GetWebTwain(S):S)&&(x.dispose(),!0):yt}}function y3(C,x){return TU.apply(this,arguments)}function TU(){return TU=_t(B.mark(function C(x,S){var T,D,R,P,O,U,G;return B.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(x&&lo("Unload..."),!S){X.next=4;break}return X.next=4,be.DWT.lunload();case 4:if(me.dlgProgress=!1,me.detect.bOK=!1,me.detect.bFirst=!0,!(P=be.DWT.WebTwainIdMap)){X.next=32;break}O=Object.keys(P),T=0;case 11:if(!(T<O.length)){X.next=32;break}if(!(R=O[T])||!(R in P)){X.next=29;break}if(!(D=P[R])){X.next=29;break}if(X.prev=16,!D.__unload){X.next=22;break}return X.next=20,D.__unload();case 20:X.next=24;break;case 22:return X.next=24,D.dispose();case 24:X.next=29;break;case 26:X.prev=26,X.t0=X.catch(16),U=X.t0;case 29:T++,X.next=11;break;case 32:if(!(P=be.DWT.ContainerMap)){X.next=57;break}O=Object.keys(P),T=0;case 36:if(!(T<O.length)){X.next=57;break}if(!(R=O[T])||!(R in P)){X.next=54;break}if(!(D=P[R])){X.next=54;break}if(X.prev=41,!D.__unload){X.next=47;break}return X.next=45,D.__unload();case 45:X.next=49;break;case 47:return X.next=49,D.dispose();case 49:X.next=54;break;case 51:X.prev=51,X.t1=X.catch(41),U=X.t1;case 54:T++,X.next=36;break;case 57:if(!(P=be.DWT.RemoteScanIdMap)){X.next=82;break}O=Object.keys(P),T=0;case 61:if(!(T<O.length)){X.next=82;break}if(!(R=O[T])||!(R in P)){X.next=79;break}if(!(D=P[R])){X.next=79;break}if(X.prev=66,!D.__unload){X.next=72;break}return X.next=70,D.__unload();case 70:X.next=74;break;case 72:return X.next=74,D.dispose();case 74:X.next=79;break;case 76:X.prev=76,X.t2=X.catch(66),U=X.t2;case 79:T++,X.next=61;break;case 82:for(T=0;T<Tt.unloadQueue.length;T++)H.isFunction(G=Tt.unloadQueue[T])&&G();if(Tt.unloadQueue.splice(0),!U){X.next=86;break}throw U;case 86:case"end":return X.stop()}},C,null,[[16,26],[41,51],[66,76]])})),TU.apply(this,arguments)}function _3(){Tt.bHTML5Edition&&(Pfe(),Wo("openLoadingMsg",null,{width:me.loaderBarWidth+"px"}))}function Um(){Tt.bHTML5Edition&&Xr("closeLoadingMsg:")}function Zt(C,x){var S,T=this,D=0;S=H.isString(C)?document.getElementById(C):C,T.isLoaded=!1,T.displayType=0,T.progress=0,T.progressPosition=0,T.borderWidth={left:0,right:0,top:0,bottom:0},T.orientation=x.orientation||Zt.Orientation.Horizontal,T.direction=x.direction||Zt.Direction.LeftToRight,T.creationType=x.creationType||Zt.CreationType.Replace,T.value=0,T.initialValue=x.value||0,T.minValue=x.minValue||0,T.maxValue=x.maxValue||100,T.showLabel=void 0===x.showLabel||x.showLabel,T.labelText=x.labelText||"",T.width=x.width||280,T.height=x.height||20,T.borderRadius=x.borderRadius||10,T.orientation==Zt.Orientation.Horizontal&&T.borderRadius>T.height/2&&(T.borderRadius=Math.round(T.height/2)),T.orientation==Zt.Orientation.Vertical&&T.borderRadius>T.width/2&&(T.borderRadius=Math.round(T.width/2)),T.backColor=x.backColor||"",T.color=x.color||"#50a8e1",T.animationStyle=0,T.animationInterval=x.animationInterval||100;var R=["parent","background","wrapper","left","middle","right","horizontalText","verticalText","marker"];for(T.extraClassName={},D=0;D<R.length;D++)T.extraClassName[R[D]]=x.extraClassName?"string"==typeof x.extraClassName?x.extraClassName:x.extraClassName[R[D]]||"":"";T.onLoad=x.onLoad||null,T.onValueChanged=x.onValueChanged||null,T.onAnimate=x.onAnimate||null,T.creationType==Zt.CreationType.Replace?T.parentElement=S:(T.parentElement=document.createElement("DIV"),S.appendChild(T.parentElement)),T.finishLoading()}me.Errors=cKe,rC(_t(B.mark(function C(){var x,S,T,D;return B.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if((x=window)&&(H.addEventListener(x,"focus",function(){var P;(P=be.DWT.WebTwainIdMap)&&H.each(P,function(O,U){O&&O._OnPageFocus&&O._OnPageFocus()})}),H.addEventListener(x,"blur",function(){he.bWin&&Hfe()}),H.addEventListener(S=x.document,"visibilitychange",function(){he.bWin&&"hidden"==S.visibilityState&&Hfe()})),be.navInfo){R.next=11;break}return R.prev=3,R.next=6,PB();case 6:be.navInfo=R.sent,R.next=11;break;case 9:R.prev=9,R.t0=R.catch(3);case 11:if(!1!==be.DWT.AutoLoad&&!Tt.bDWTLoading){R.next=13;break}return R.abrupt("return");case 13:return R.prev=13,R.next=16,GP();case 16:if(!(be.DWT.Containers&&be.DWT.Containers.length>0&&be.DWT.AutoLoad)||Tt.bDWTLoading){R.next=48;break}return Tt.bDWTLoading=!0,_3(),R.prev=20,R.next=23,EC();case 23:return R.next=25,zP();case 25:T=3,D=0;case 27:if(!(D<T)){R.next=44;break}return R.prev=28,R.next=31,Ape();case 31:return R.abrupt("break",44);case 34:if(R.prev=34,R.t1=R.catch(28),!(D<T-1&&R.t1.code==Xn.DWTPortNotReady)){R.next=40;break}return R.next=39,new me.Promise(function(P,O){setTimeout(function(){P()},300)});case 39:return R.abrupt("continue",41);case 40:throw R.t1;case 41:D++,R.next=27;break;case 44:return R.prev=44,Tt.bDWTLoading=!1,Um(),R.finish(44);case 48:R.next=62;break;case 50:return R.prev=50,R.t2=R.catch(13),sP(R.t2.code)||me.detect.bOK||H.asyncQueue.pushToDo(null,be.DWT.Load),oP(R.t2),R.prev=55,R.next=58,y3();case 58:R.next=62;break;case 60:R.prev=60,R.t3=R.catch(55);case 62:case"end":return R.stop()}},C,null,[[3,9],[13,50],[20,,44,48],[28,34],[55,60]])}))),Zt.Orientation={Horizontal:0,Vertical:1},Zt.Direction={LeftToRight:0,RightToLeft:1,TopToBottom:0,BottomToTop:1},Zt.CreationType={Replace:0,AppendChild:1},Zt.AnimationStyle={None:0,Static:1,StaticFull:2,Custom:3,CustomFull:4,Flickering1:10,Flickering2:11,Flickering3:12,LeftToRight1:20,LeftToRight2:21,RightToLeft1:22,RightToLeft2:23,TwoWay:24},Zt.prototype.finishLoading=function(){var C,x=this;x.wrapperElement=null,x.backgroundElement=null,x.valueElement=null,x.leftElement=null,x.middleElement=null,x.rightElement=null,x.backgroundElement=document.createElement("DIV"),x.backgroundElement.className="progressbar_background"+(x.extraClassName.background?" ":"")+x.extraClassName.background,x.backgroundElement.style.cssText=x.backgroundElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius),x.parentElement.appendChild(x.backgroundElement);var S=["border-radius","border-bottom-right-radius","-moz-border-radius-bottomright","-webkit-border-bottom-right-radius","-khtml-border-radius-bottomright","-khtml-border-bottom-right-radius"],T=0,D="";for(T=0;T<S.length&&!(D=Zt._elementCurrentStyle(x.backgroundElement,S[T]))&&"string"!=typeof D;T++);""!=D&&Zt._parseInt(D)!=x.borderRadius&&(x.borderRadius=Zt._parseInt(D)),x.displayType=x.orientation==Zt.Orientation.Horizontal||x.orientation==Zt.Orientation.Vertical?0:1,x.parentElement.className=(""!=x.parentElement.className?" ":"")+"progressbar_parent dynamsoft-progressBar"+(x.extraClassName.parent?" ":"")+x.extraClassName.parent,0==x.displayType?((C=x.wrapperElement=document.createElement("DIV")).style.border="1px solid #A0A0A0",C.style.cssFloat="left",C.style.display="inline-block",C.style.width=x.width+"px",C.style.height=x.height+"px",C.style.left="0px",C.style.top=-x.height+"px",C.style.backgroundColor=x.backColor,C.style.backgroundRepeat="no-repeat",C.style.position="relative",C.style.cssText=C.style.cssText+Zt._createBorderRadiusCss(x.borderRadius),x.parentElement.appendChild(C),x.borderWidth={left:Zt._parseInt(Zt._elementCurrentStyle(C,"border-left-width")),right:Zt._parseInt(Zt._elementCurrentStyle(C,"border-right-width")),top:Zt._parseInt(Zt._elementCurrentStyle(C,"border-top-width")),bottom:Zt._parseInt(Zt._elementCurrentStyle(C,"border-bottom-width"))}):1==x.displayType&&(x.orientation==Zt.Orientation.Horizontal?x.borderRadius>x.width/2&&(x.borderRadius=x.width):x.orientation==Zt.Orientation.Vertical&&x.borderRadius>x.height/2&&(x.borderRadius=x.height),x.valueElement=document.createElement("DIV"),x.valueElement.className="",x.leftElement=document.createElement("DIV"),x.middleElement=document.createElement("DIV"),x.rightElement=document.createElement("DIV"),x.leftElement.style.border="1px solid #A0A0A0",x.leftElement.style.cssFloat="left",x.leftElement.style.display="inline-block",x.leftElement.style.backgroundColor=x.backColor,x.leftElement.style.backgroundRepeat="no-repeat",x.leftElement.style.position="relative",x.rightElement.style.border="1px solid #A0A0A0",x.rightElement.style.cssFloat="left",x.rightElement.style.display="inline-block",x.rightElement.style.backgroundColor=x.backColor,x.rightElement.style.backgroundRepeat="no-repeat",x.rightElement.style.position="relative",x.middleElement.style.border="1px solid #A0A0A0",x.middleElement.style.cssFloat="left",x.middleElement.style.display="inline-block",x.middleElement.style.overflow="hidden",x.middleElement.style.position="relative",x.valueElement.style.backgroundColor=x.backColor,x.valueElement.style.position="relative",x.orientation==Zt.Orientation.Horizontal?(x.leftElement.style.width=x.borderRadius+"px",x.leftElement.style.height=x.height+"px",x.leftElement.style.top=-x.height+"px",x.leftElement.style.left="0px",x.leftElement.style.borderRight="none",x.leftElement.style.cssText=x.leftElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,0,0,x.borderRadius),x.rightElement.style.width=x.borderRadius+"px",x.rightElement.style.height=x.height+"px",x.rightElement.style.top=-x.height+"px",x.rightElement.style.borderLeft="none",x.rightElement.style.cssText=x.rightElement.style.cssText+Zt._createBorderRadiusCss(0,x.borderRadius,x.borderRadius,0),x.middleElement.style.width=x.width-2*x.borderRadius+"px",x.middleElement.style.height=x.height+"px",x.middleElement.style.top=-x.height+"px",x.middleElement.style.borderLeft="none",x.middleElement.style.borderRight="none",x.valueElement.style.width="0px",x.valueElement.style.height=x.height+"px"):x.orientation==Zt.Orientation.Vertical&&(x.leftElement.style.width=x.width+"px",x.leftElement.style.height=x.borderRadius+"px",x.leftElement.style.top=-x.height+"px",x.leftElement.style.left="0px",x.leftElement.style.borderBottom="none",x.leftElement.style.cssText=x.leftElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,x.borderRadius,0,0),x.rightElement.style.width=x.width+"px",x.rightElement.style.height=x.borderRadius+"px",x.rightElement.style.top=-x.height+"px",x.rightElement.style.left="0px",x.rightElement.style.borderTop="none",x.rightElement.style.cssText=x.rightElement.style.cssText+Zt._createBorderRadiusCss(0,0,x.borderRadius,x.borderRadius),x.middleElement.style.width=x.width+"px",x.middleElement.style.height=x.height-2*x.borderRadius+"px",x.middleElement.style.top=-x.height+"px",x.middleElement.style.left="0px",x.middleElement.style.borderTop="none",x.middleElement.style.borderBottom="none",x.valueElement.style.width=x.width+"px",x.valueElement.style.height="0px"),x.middleElement.appendChild(x.valueElement),x.parentElement.appendChild(x.leftElement),x.parentElement.appendChild(x.middleElement),x.parentElement.appendChild(x.rightElement),x.orientation==Zt.Orientation.Horizontal?x.borderWidth={left:Zt._parseInt(Zt._elementCurrentStyle(x.leftElement,"border-left-width")),right:Zt._parseInt(Zt._elementCurrentStyle(x.rightElement,"border-right-width")),top:Zt._parseInt(Zt._elementCurrentStyle(x.middleElement,"border-top-width")),bottom:Zt._parseInt(Zt._elementCurrentStyle(x.middleElement,"border-bottom-width"))}:x.orientation==Zt.Orientation.Vertical&&(x.borderWidth={left:Zt._parseInt(Zt._elementCurrentStyle(x.middleElement,"border-left-width")),right:Zt._parseInt(Zt._elementCurrentStyle(x.middleElement,"border-right-width")),top:Zt._parseInt(Zt._elementCurrentStyle(x.leftElement,"border-top-width")),bottom:Zt._parseInt(Zt._elementCurrentStyle(x.rightElement,"border-bottom-width"))})),x.parentElement.style.width=x.width+x.borderWidth.left+x.borderWidth.right+"px",x.parentElement.style.height=x.height+x.borderWidth.top+x.borderWidth.bottom+"px",x.backgroundElement.style.cssFloat="left",x.backgroundElement.style.display="inline-block",x.backgroundElement.style.width=x.width+x.borderWidth.left+x.borderWidth.right+"px",x.backgroundElement.style.height=x.height+"px",x.backgroundElement.style.backgroundColor="#FFFFFF",x.backgroundElement.style.position="relative",0==x.displayType&&(x.backgroundElement.style.width=x.width+x.borderWidth.left+x.borderWidth.right+"px"),x.backgroundElement.style.top=x.borderWidth.top+"px",x.markerElement=document.createElement("DIV"),x.markerElement.style.display="inline-block",x.markerElement.style.zoom="1.0",x.markerElement.style.width=x.width+"px",x.markerElement.style.height=x.height+"px",x.markerElement.style.top=2*-x.height-x.borderWidth.top+"px",x.markerElement.style.left=x.borderWidth.left+"px",x.markerElement.style.backgroundColor=x.color,x.markerElement.style.lineHeight=x.height+"px",x.markerElement.style.position="relative",x.parentElement.appendChild(x.markerElement),x.isLoaded=!0,x.setValue(x.initialValue),null!=x.onLoad&&x.onLoad()},Zt.prototype.setValue=function(C){var x=this;if(null!==C&&C<x.minValue&&(C=x.minValue),null!==C&&C>x.maxValue&&(C=x.maxValue),null===C||(x.value=C),x.isLoaded){var S,T=0;if(x.orientation==Zt.Orientation.Horizontal){x.progressPosition=T=x.value/x.maxValue*x.width,0==x.displayType||1==x.displayType&&(x.direction==Zt.Direction.LeftToRight?x.valueElement.style.width=T<=x.borderRadius?"0px":T>=x.width-x.borderRadius?x.middleElement.style.width:T-x.borderRadius+"px":T<=x.borderRadius?x.valueElement.style.width="0px":T>=x.width-x.borderRadius?(x.valueElement.style.left="0px",x.valueElement.style.width=x.middleElement.style.width):(x.valueElement.style.left=x.width-T-x.borderRadius+"px",x.valueElement.style.width=T-x.borderRadius+"px")),T>0?(x.markerElement.style.width=x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull?T+"px":x.width+"px",x.markerElement.style.visibility="visible"):(x.markerElement.style.width=x.width+"px",x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull&&(x.markerElement.style.visibility="hidden")),x.markerElement.style.left=x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull?x.direction==Zt.Direction.LeftToRight?x.borderWidth.left+"px":x.width-T+x.borderWidth.left+"px":x.borderWidth.left+"px";var D=2*-x.height-x.borderWidth.top;if(0==T||x.width==T)x.markerElement.style.top=D+"px",x.markerElement.style.height=x.height+"px",x.markerElement.style.cssText=x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius);else if(T<x.borderRadius){var R=x.height-2.25*(x.borderRadius-Math.sqrt(Math.pow(x.borderRadius,2)-Math.pow(x.borderRadius-T,2)));x.markerElement.style.top=D+x.height/2-R/2+"px",x.markerElement.style.height=R+"px",x.markerElement.style.cssText=x.direction==Zt.Direction.LeftToRight?x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,0,0,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(0,x.borderRadius,x.borderRadius,0)}else x.width-T<x.borderRadius?(S=(2*(x.borderRadius-(x.width-T))+(x.borderRadius-Math.sqrt(Math.pow(x.borderRadius,2)-Math.pow(x.borderRadius-(x.width-T),2))))/3,x.markerElement.style.cssText=x.direction==Zt.Direction.LeftToRight?x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,S,S,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(S,x.borderRadius,x.borderRadius,S)):(x.markerElement.style.top=D+"px",x.markerElement.style.height=x.height+"px",x.markerElement.style.cssText=x.direction==Zt.Direction.LeftToRight?x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,0,0,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(0,x.borderRadius,x.borderRadius,0))}else if(x.orientation==Zt.Orientation.Vertical){x.progressPosition=T=x.value/x.maxValue*x.height,0==x.displayType||1==x.displayType&&(x.direction==Zt.Direction.TopToBottom?x.valueElement.style.height=T<=x.borderRadius?"0px":T>=x.height-x.borderRadius?x.middleElement.style.height:T-x.borderRadius+"px":T<=x.borderRadius?x.valueElement.style.height="0px":T>=x.height-x.borderRadius?(x.valueElement.style.top="0px",x.valueElement.style.height=x.middleElement.style.height):(x.valueElement.style.top=x.height-T-x.borderRadius+"px",x.valueElement.style.height=T+2*x.borderRadius+"px")),T>0?(x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull?x.markerElement.style.height=T+"px":(x.markerElement.style.height=x.height+"px",x.markerElement.style.cssText=x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius)),x.markerElement.style.visibility="visible"):(x.markerElement.style.height="0px",x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull&&(x.markerElement.style.visibility="hidden"));var O=x.borderWidth.left;if(0==T||x.height==T)x.markerElement.style.left=O+"px",x.markerElement.style.width=x.width+"px",x.markerElement.style.cssText=x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius);else if(T<x.borderRadius){var U=2.5*T;U>x.width&&(U=x.width),x.markerElement.style.left=O+x.width/2-U/2+"px",x.markerElement.style.width=U+"px",x.markerElement.style.cssText=x.direction==Zt.Direction.BottomToTop?x.markerElement.style.cssText+Zt._createBorderRadiusCss(0,0,x.borderRadius,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,x.borderRadius,0,0)}else x.height-T<x.borderRadius?(S=(2*(x.borderRadius-(x.height-T))+(x.borderRadius-Math.sqrt(Math.pow(x.borderRadius,2)-Math.pow(x.borderRadius-(x.height-T),2))))/3,x.markerElement.style.cssText=x.direction==Zt.Direction.BottomToTop?x.markerElement.style.cssText+Zt._createBorderRadiusCss(S,S,x.borderRadius,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,x.borderRadius,S,S)):(x.markerElement.style.left=O+"px",x.markerElement.style.width=x.width+"px",x.markerElement.style.cssText=x.direction==Zt.Direction.BottomToTop?x.markerElement.style.cssText+Zt._createBorderRadiusCss(0,0,x.borderRadius,x.borderRadius):x.markerElement.style.cssText+Zt._createBorderRadiusCss(x.borderRadius,x.borderRadius,0,0));x.markerElement.style.top=x.animationStyle!=Zt.AnimationStyle.StaticFull&&x.animationStyle!=Zt.AnimationStyle.CustomFull?x.direction==Zt.Direction.TopToBottom?2*-x.height-x.borderWidth.top+"px":-x.height-T-x.borderWidth.top+"px":2*-x.height-x.borderWidth.top+"px"}x.progress=x.value/x.maxValue}null!=x.onValueChanged&&x.onValueChanged()},Zt._elementCurrentStyle=function(C,x){if(C.currentStyle){var S=0,T="",D=!1;for(S=0;S<x.length;S++)"-"!=x[S].toString()?(T+=D?x[S].toString().toUpperCase():x[S].toString(),D=!1):D=!0;return C.currentStyle[x=T]}return getComputedStyle(C,null).getPropertyValue(x)},Zt._parseInt=function(C){var x=parseInt(C);return isNaN(x)&&(x=0),x},Zt._createBorderRadiusCss=function(C,x,S,T){return null!=C&&null==x&&null==S&&null==T?"; -moz-border-radius: "+C+"px; -ms-border-radius: "+C+"px; -o-border-radius: "+C+"px; -webkit-border-radius: "+C+"px; -khtml-border-radius: "+C+"px; border-radius: "+C+"px;":"; -moz-border-radius: "+(C=C||0)+"px "+(x=x||0)+"px "+(S=S||0)+"px "+(T=T||0)+"px; -ms-border-radius: "+C+"px "+x+"px "+S+"px "+T+"px; -o-border-radius: "+C+"px "+x+"px "+S+"px "+T+"px; -webkit-border-radius: "+C+"px "+x+"px "+S+"px "+T+"px; -khtml-border-radius: "+C+"px "+x+"px "+S+"px "+T+"px; border-radius: "+C+"px "+x+"px "+S+"px "+T+"px;"};var hKe=v(function C(){n(this,C),An(this,"handlers",{})},[{key:"on",value:function(C,x){var S=H.guid();return this.handlers[C]||(this.handlers[C]=[]),this.handlers[C].push({id:S,handler:x}),S}},{key:"off",value:function(C,x){if(this.handlers[C]){var S,T=this.handlers[C];if(x){for(S=0;S<T.length;S++)if(T[S].id==x){T.splice(S,1);break}}else T.splice(0)}}},{key:"fire",value:function(C){if(this.handlers[C]){var x,S=this.handlers[C];for(x=0;x<S.length;x++)S[x].handler();return S.length}return 0}},{key:"clear",value:function(){this.handlers={}}}]),fKe=be.DWT;me.ProgressBar=Zt,me.progressMessage="",me.dialogShowStatus=!1,me.needShowTwiceShowDialog=!1,me.dlgProgress=!1,me.cancelFrom=Zn.Other,me.dlgRef=0,me.initProgress=function(C){var x,S;if(!me.dlgProgress){(S=[]).push('<dialog class="dynamsoft-dwt-dialogProgress" closed="closed" style="top:30%"><div class="ds-dwt-progressWrap">'),S.push('<h3 class="dynamsoft-finalMessage"> </h3>'),S.push('<p class="dynamsoft-desc"> </p><p class="dynamsoft-status">0%</p>'),S.push(he.bIE?'<div class="dynamsoft-progressBar" value="" max="100"></div>':'<progress class="dynamsoft-progressBar" value="" max="100"></progress>'),S.push('<br /><div style="width:100%;text-align:center"><button class="dynamsoft-btnCancel" value="cancel" autofcus>cancel</button></div>'),S.push("</div></dialog>"),(x=pt.one(".dynamsoft-dwt-dialogProgress"))&&x.getEL()&&x.remove();var T=me.parseHTML(S.join(""));if(T&&T.length>0&&document.body.appendChild(T[0]),he.bIE){var D=pt.one(".dynamsoft-progressBar"),R=D&&D.getEL();R&&(R.objProgressBar=new Zt(R,{width:280,height:20}))}(x=pt.one(".dynamsoft-dwt-dialogProgress"))&&x.getEL()&&(me.dlgProgress=x[0],pt.dialog.setup(me.dlgProgress)),me.dlgRef=0,me.dialogShowStatus=!1,me.cancelFrom=Zn.Other}},me.showProgressMsg=function(){};var pKe=function(C){function x(){return n(this,x),S=this,D=arguments,T=qn(T=x),Za(S,function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(R){return!1}}()?Reflect.construct(T,D||[],qn(S).constructor):T.apply(S,D));var S,T,D}return el(x,C),v(x)}(hKe);me.progressContext=new pKe;var Ppe=function(){var C=me.progressContext;if(C){var x,S=C.fire("cancel");if(S>=1)for(x=0;x<S;x++)me.closeProgress(null,"");else C.__cancelBeforObjectCreated&&(me.closeProgress(null,""),C.__clickCancel=!0)}};me.hideProgress=function(){var C=me.progressContext;C&&(C.IfShowProgressBar=!1,C.IfShowCancelDialogWhenImageTransfer=!1,C.off("cancel"),C._onPercent=null)},me.showProgress=function(C,x,S){var T,D=C;if(D.IfShowProgressBar)if(me.progressContext&&(me.progressContext.IfShowProgressBar=!0,me.progressContext.IfShowCancelDialogWhenImageTransfer=D.IfShowCancelDialogWhenImageTransfer),me.dlgRef>0)me.dlgRef++;else{var R;if((T=be.DWT.IfConfineMaskWithinTheViewer)?D._isNoViewer&&D._isNoViewer()?R=document.body:D._containerElement?R=D._containerElement:be.DWT.Containers&&be.DWT.Containers.length>0&&be.DWT.Containers[0].ContainerId&&(R=H.get(be.DWT.Containers[0].ContainerId))||(R=document.body):R=document.body,R&&R!==document.body){var P=!1,O=R.firstElementChild;if(O&&O!==me.dlgProgress&&"dvs-root dvs-web-viewer"==O.className&&(R=O,P=!0),0==P)for(var U=0;U<R.children.length;U++)if((O=R.children[U])&&O!==me.dlgProgress&&"dvs-root dvs-web-viewer"==O.className){R=O;break}var G=me.progressContext;""!==R.style.position&&"static"!==R.style.position||(R.style.position="relative",G.progressContainer={el:R})}H.log("showProgress:"+x+",bCancel:"+S),me.dlgProgress&&R.appendChild(me.dlgProgress),Hp(S);var X=pt.one(".dynamsoft-btnCancel");if(X&&X.getEL()&&(H.removeEventListener(X[0],"click",Ppe),H.addEventListener(X[0],"click",Ppe)),0==me.dialogShowStatus){me.dlgProgress&&(T&&R&&R!==document.body?pt.dialog.setup(me.dlgProgress,!0):pt.dialog.setup(me.dlgProgress),me.dlgProgress.showModal()),me.dialogShowStatus=!0;var z=pt.one(".dynamsoft-finalMessage"),K=pt.one(".dynamsoft-progressBar"),oe=K&&K.getEL(),ae=pt.one(".dynamsoft-status");z&&z.getEL()&&z.html(""),ae&&ae.getEL()&&ae.html("0%"),oe&&(he.bIE&&oe.objProgressBar?oe.objProgressBar.setValue(0):oe.value=0)}me.dlgRef++}else me.hideProgress()},me.closeProgress=function(C,x){var S=me.progressContext;H.log("closeProgress:"+x),S&&S.IfShowProgressBar?(me.dlgRef--,me.dlgRef<=0&&(me.dlgRef=0)):me.dlgRef=0,0==me.dlgRef&&(S.off("cancel"),S._onPercent=null,1==me.dialogShowStatus&&(me.dlgProgress&&(me.dlgProgress.close(),me.dlgProgress&&document.body.appendChild(me.dlgProgress),S&&S.progressContainer&&S.progressContainer.el&&(S.progressContainer.el.style.position="",S.progressContainer=null)),me.dialogShowStatus=!1),me.cancelFrom=Zn.Other)},fKe.RemoveAllAuthorizations=function(){var C=fd.item("DWT_port"),x="http://";return"true"==fd.item("DWT_ssl")&&(x="https://"),du({method:"GET",xhrFields:{withCredentials:!0},url:[x,Ja(),":",C,"/dwt/",Tt.getDWTPrefix(),Tt.getServerVersionInfo(),"/RemoveAllAuthorizations?t=",H.now()].join(""),async:!0}),!0};var gKe={upload:"Uploading...",download:"Downloading...",load:"Processing...",decode:"Processing...",decodeTIFF:"Processing tiff...",decodePDF:"Processing pdf...",encodeTIFF:"Processing tiff...",encodePDF:"Processing pdf...",encode:"Processing...",transfer:"Transferring..."};me.progressBarOnPercentDone=function(C,x,S,T,D,R){var P,O=pt.one(".dynamsoft-progressBar"),U=pt.one(".dynamsoft-status"),G=pt.one(".dynamsoft-finalMessage"),X=pt.one(".dynamsoft-desc");if(be.DWT.UseDefaultViewer&&be.DWT.IfConfineMaskWithinTheViewer&&R&&(O=pt.one(".dynamsoft-progressBar",R),U=pt.one(".dynamsoft-status",R),G=pt.one(".dynamsoft-finalMessage",R),X=pt.one(".dynamsoft-desc",R)),me.cancelFrom==Zn.FTPUpload||me.cancelFrom==Zn.FTPDownload){var z=S;0==z?me.setBtnCancelVisibleForProgress(!1):1==z&&me.setBtnCancelVisibleForProgress(!0)}else me.cancelFrom==Zn.HTTPUpload||me.cancelFrom==Zn.LoadImage||me.cancelFrom==Zn.HTTPPut?"Processing..."==x&&me.setBtnCancelVisibleForProgress(!1):me.cancelFrom==Zn.ConvertToBlob&&(-1==C||me.setBtnCancelVisibleForProgress(!1),100==T&&(x="",me.progressMessage="Processing..."));if(C<0?(me.progressMessage=x,P=me.progressMessage):P=""!=x&&"1/1"!=x?me.progressMessage+"("+x+")":me.progressMessage,G&&G.getEL()){var K="",oe="";P.indexOf(" ...")&&(P=P.replace(" ...","...")),-1!=P.indexOf("(")?(K=P.substr(0,P.indexOf("(")),oe=P.substr(P.indexOf("("))):K=P,H.each(gKe,function(ue,ye){-1!=ue.indexOf(K)&&(P=Os.customProgressText[ye]+oe)}),""==P&&(P="&nbsp;"),G.html(P)}if(D?(""==D||H.isUndefined(D)?D="&nbsp;":H.isString(D)&&D.length>30&&(D=D.substring(0,30)+"..."),X.html(D)):X.html("&nbsp;"),(T||0===T)&&(U&&U.getEL()&&U.html(T+"%"),O&&O.getEL())){var ae=T;ae>99&&(ae=99),he.bIE?O[0].objProgressBar?O[0].objProgressBar.setValue(ae):O[0].value=ae:(he.bEdge&&(O[0].style.display=""),O[0].value=ae)}me.dlgRef<=0&&setTimeout(function(){O&&O.getEL()&&(he.bIE?O[0].objProgressBar?O[0].objProgressBar.setValue(0):O[0].value=0:(he.bEdge&&(O[0].style.display="none"),O[0].value=0))},1e3)};var Mf=be.DWT;Mf.CloseDialog=function(){var C=me.install._dlgInstall;if(C){var x=H.sizzle(".dynamsoft-dialog-close");H.each(x,function(S,T){H.removeEventListener(S,"click",Mf.CloseDialog)}),C.open&&C.close(),document.body.removeChild(C),me.install._dlgInstall=!1}},Mf.ShowDialog=function(C,x,S,T,D){if(!1!==S){var R,P={width:C,height:x,position:"absolute"};T?(R=['<div class="dynamsoft-dwt-dialog-body">',S,"</div>"].join(""),P.closeButton=!1):R=['<div class="ds-dwt-ui-showdlg">','<div class="dynamsoft-dwt-dialog-body">','<div class="dynamsoft-dwt-dlg-header">',D?"":'<div class="dynamsoft-dialog-close"></div>',"</div>",S,"</div>","</div>"].join(""),D&&(P.closeButton=!1),Mf.ShowMessage(R,P)}},Mf.ShowMessage=function(C,x){var S,T,D,R,P,O=me.install,U="ds-dwt-ui-dlg",G="ds-dwt-ui-dlg-wrap",X=screen.width,z=!0,K=0,oe=!0,ae=!0,ue=0,ye="fixed",Ie="Error",Ue=Tt.bActiveXEdition,He=!1,Re=null;if(x&&(S=x.width,T=x.height,x.seconds&&(K=x.seconds),x.headerStyle&&(ue=x.headerStyle),1==x.backgroundStyle&&(He=!0),!1===x.closeButton&&(oe=!1),x.bAutoClose&&(D=x.bAutoClose,oe=!0),0==x.bReadyClosed&&(z=!1),x.position&&(ye=x.position),x.caption&&(Ie=x.caption),H.isFunction(x.onClose)&&(Re=x.onClose)),S?S>X-10&&(S=X-10):S=X>600?600:X-10,T||(T="100%"),1==ue?C=['<div class="dynamsoft-dialog">','<div class="dynamsoft-dwt-dialog-body">','<div class="dynamsoft-dwt-dlg-header">',oe?'<div class="dynamsoft-dialog-close"></div>':"","</div>",C,"</div></div>"].join(""):2==ue&&(C=['<div class="dynamsoft-dialog">','<div class="dynamsoft-dwt-ltsdlg-header"><span style="color:#FFF;line-height:35px;margin-left:15px">',Ie,"</span>",oe?'<div class="dynamsoft-dialog-close"></div>':"","</div>",'<div class="dynamsoft-dwt-ltsdlg-body" style="padding:25px 40px 20px 40px;">',C,"</div></div>"].join("")),0==H.sizzle("."+U).length){var Oe=document.createElement("div"),Ge=document.createElement("div"),Se=document.createElement("div");if(Oe.className=U,Ge.className=G,Ge.style.margin="auto",Ge.style.zIndex="9999",Ge.style.position="relative",Ge.style.border="0",D&&((R=document.createElement("div")).className="dynamsoft-dialog-close",Ge.insertBefore(R,Ge.firstElementChild),(P=document.createElement("div")).className="dynamsoft-dialog-closeTimer",P.style.width="100%",P.style.height="2px",P.style.marginTop="-2px",P.style.backgroundColor="#fe8e14",Ge.insertBefore(P,Ge.firstElementChild)),Ge.appendChild(Se),Se.innerHTML=C,Oe.appendChild(Ge),document.body.appendChild(Oe),Re){var de=pt.one(".dynamsoft-dialog-close",pt.one(Oe));de&&((de=de[0]).onClose=function(){H.removeEventListener(de,"click",de.onClose),de.onClose=null,Re()},H.addEventListener(de,"click",de.onClose))}if(pt.setBackOpacity(He?{opacity:.4,grayHex:0}:{}),Oe.bTopmost=!0,O._dlgInstall=Oe,pt.dialog.setup(O._dlgInstall,!1),he.bIE){var ge=document.createElement("iframe");ge.frameborder="0",ge.marginheight="0",ge.marginwidth="0",ge.style.border="0",ge.style.backgroundColor="transparent",ge.style.position="absolute",ge.style.left=0,ge.style.top=0,ge.style.width="100%",ge.style.height=document.body.clientHeight+"px",ge.style.margin="0 auto",ge.style.zIndex="10000",ge.src=["javas","cript:",'""'].join("");var _e=pt.one(".dynamsoft-backdrop");_e&&_e.length>0&&(_e[0].innerHTML="",_e[0].style.zIndex="10000",_e[0].appendChild(ge))}}else ae=!1;var ve=pt.one("."+G);if(ve&&ve.getEL()&&(ve[0].style.width=S+"px",ve[0].style.height=H.isNumber(T)&&T>0?T+"px":"100%",ae||H.each(ve[0].childNodes,function(Ye){if("DIV"==Ye.tagName&&"dynamsoft-dialog-close"!=Ye.className&&"dynamsoft-dialog-closeTimer"!=Ye.className)return Ye.innerHTML=C,!1})),Ue){var Te=pt.one(".dynamsoft-dialog");Te&&Te.getEL()&&(Te.getEL().style.border="1px solid #999")}if(O._dlgInstall.open&&O._dlgInstall.close(),O._dlgInstall.showModal({position:ye}),O._dlgInstall.bReadyClosed=z,He&&pt.setBackOpacity({}),oe){var We=H.sizzle(".dynamsoft-dialog-close");H.each(We,function(Ye,Be){H.addEventListener(Ye,"click",Mf.CloseDialog)}),We.length>0&&D&&K>0&&setTimeout(me._zdgb_xkz_dhk,100)}},Mf.OnWebTwainPreExecute||(Mf.OnWebTwainPreExecute=function(C,x){var S,T,D=be.DWT.IfConfineMaskWithinTheViewer;if(D&&(C&&(T=C._containerElement),T||be.DWT.Containers&&be.DWT.Containers.length>0&&be.DWT.Containers[0].ContainerId&&(T=H.get(be.DWT.Containers[0].ContainerId)),T)){S=T.getBoundingClientRect();for(var R=0;R<T.children.length;R++){var P=T.children[R];if(P&&"dvs-root dvs-web-viewer"==P.className){for(P=P.firstElementChild;P;){if(H.isFunction(P.getBoundingClientRect)){S=P.getBoundingClientRect();break}P=P.nextSibling}T=P;break}}}(T===document.body||null==S||be.DWT.Containers&&be.DWT.Containers.length>1||be.DWT.Containers&&1==be.DWT.Containers.length&&(0==S.width||0==S.height))&&(D=!1,T=null);var O=null!=x?x:{};D&&(O={confined:D,wrapperEl:T}),me.showMask(O)}),Mf.OnWebTwainPostExecute||(Mf.OnWebTwainPostExecute=function(){pt.hideMask()}),window.DCP_DWT_OnClickCloseInstall=function(C,x){x||be.DWT.CloseDialog();var S=H.get(me.install._divDWTNonInstallContainerID);if(S&&S.parentNode&&S.parentNode.removeChild(S),C&&H.isDOM(C)&&H.show(C),C&&H.isString(C))H.show(C);else{var T=be.DWT.WebTwainIdMap;if(T){var D,R,P=Object.keys(T);for(D=0;D<P.length;D++)T[R=P[D]]._containerElement&&H.show(T[R]._containerElement)}}""!=me.install._divDWTemessageContainer&&H.show(me.install._divDWTemessageContainer)},(me.__ver||0)<20230515&&(H.mix(me,pt),me.__ver=20230515),me.bNode=yie,me._defaultAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",me._defaultPlatform="Win64",me.timestamp="?t=20240509141451",H.mix(me,ad),me.ajax=du,me.fetch=nC,me.detect.showMask=zB,me.detect.hideMask=YB,me.env=Po,me.product=Tt,me.scannerInfo=xo,me.License=mn,me.BIO=Am,me.UI.ImageUIView=Aqe,me.UI.ImageManager=Mfe,be.MSG=Br,be.navInfoSync=he,me.domReady=rC,function C(){if(!window||document&&document.body){var x=document;if("complete"!==x.readyState)if(OB(window,"load",iC),MB)OB(x,Ice,function R(){FB(x,Ice,R),iC()});else{var S,T,D;OB(x,Ece,function R(){"complete"===x.readyState&&(FB(x,Ece,R),iC())}),D=(T=x&&x.documentElement)&&T.doScroll;try{S=null===window.frameElement}catch(R){S=!1}D&&S&&function R(){try{D("left"),setTimeout(iC,30)}catch(P){setTimeout(R,40)}}()}else iC()}else setTimeout(C,100)}(),rC(function(){if(be.DWT.CustomizableDisplayInfo||(be.DWT.CustomizableDisplayInfo=Os),he.bIE){be.DWT.CustomizableDisplayInfo.loaderBarSourceIE||(be.DWT.CustomizableDisplayInfo.loaderBarSourceIE=kf.loaderBarSourceIE);try{document.execCommand("BackgroundImageCache",!1,!0)}catch(C){}}}),be.Ready=function(C){if(!be.navInfo)return PB().then(function(x){be.navInfo=x;try{C()}catch(S){throw H.log(S.stack||S,"error"),S}});try{C()}catch(x){throw H.log(x.stack||x,"error"),x}}}(),Ee.navInfoSync.bIE)&&(function(p){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=p();else if("function"==typeof define&&define.amd)define([],p);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.Promise=p()}}(function(){return function h(v,y,_){function b(A,M){if(!y[A]){if(!v[A]){var F="function"==typeof _dereq_&&_dereq_;if(!M&&F)return F(A,!0);if(w)return w(A,!0);var V=new Error("Cannot find module '"+A+"'");throw V.code="MODULE_NOT_FOUND",V}var B=y[A]={exports:{}};v[A][0].call(B.exports,function(Q){return b(v[A][1][Q]||Q)},B,B.exports,h,v,y,_)}return y[A].exports}for(var w="function"==typeof _dereq_&&_dereq_,I=0;I<_.length;I++)b(_[I]);return b}({1:[function(h,v,y){v.exports=function(_){function b(I){var A=new w(I),M=A.promise();return A.setHowMany(1),A.setUnwrap(),A.init(),M}var w=_._SomePromiseArray;_.any=function(I){return b(I)},_.prototype.any=function(){return b(this)}}},{}],2:[function(h,v,y){function _(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new B(16),this._normalQueue=new B(16),this._haveDrainedQueues=!1;var Q=this;this.drainQueues=function(){Q._drainQueues()},this._schedule=V}function A(Q){for(;Q.length()>0;)M(Q)}function M(Q){var J=Q.shift();if("function"!=typeof J)J._settlePromises();else{var Z=Q.shift(),re=Q.shift();J.call(Z,re)}}var F;try{throw new Error}catch(Q){F=Q}var V=h("./schedule"),B=h("./queue");_.prototype.setScheduler=function(Q){var J=this._schedule;return this._schedule=Q,this._customScheduler=!0,J},_.prototype.hasCustomScheduler=function(){return this._customScheduler},_.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},_.prototype.fatalError=function(Q,J){J?(process.stderr.write("Fatal "+(Q instanceof Error?Q.stack:Q)+"\n"),process.exit(2)):this.throwLater(Q)},_.prototype.throwLater=function(Q,J){if(1===arguments.length&&(J=Q,Q=function(){throw J}),"undefined"!=typeof setTimeout)setTimeout(function(){Q(J)},0);else try{this._schedule(function(){Q(J)})}catch(Z){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},_.prototype.invokeLater=function b(Q,J,Z){this._lateQueue.push(Q,J,Z),this._queueTick()},_.prototype.invoke=function w(Q,J,Z){this._normalQueue.push(Q,J,Z),this._queueTick()},_.prototype.settlePromises=function I(Q){this._normalQueue._pushOne(Q),this._queueTick()},_.prototype._drainQueues=function(){A(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,A(this._lateQueue)},_.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},_.prototype._reset=function(){this._isTickUsed=!1},v.exports=_,v.exports.firstLineError=F},{"./queue":26,"./schedule":29}],3:[function(h,v,y){v.exports=function(_,b,w,I){var A=!1,M=function(Q,J){this._reject(J)},F=function(Q,J){J.promiseRejectionQueued=!0,J.bindingPromise._then(M,M,null,this,Q)},V=function(Q,J){0==(50397184&this._bitField)&&this._resolveCallback(J.target)},B=function(Q,J){J.promiseRejectionQueued||this._reject(Q)};_.prototype.bind=function(Q){A||(A=!0,_.prototype._propagateFrom=I.propagateFromFunction(),_.prototype._boundValue=I.boundValueFunction());var J=w(Q),Z=new _(b);Z._propagateFrom(this,1);var re=this._target();if(Z._setBoundTo(J),J instanceof _){var se={promiseRejectionQueued:!1,promise:Z,target:re,bindingPromise:J};re._then(b,F,void 0,Z,se),J._then(V,B,void 0,Z,se),Z._setOnCancel(J)}else Z._resolveCallback(re);return Z},_.prototype._setBoundTo=function(Q){void 0!==Q?(this._bitField=2097152|this._bitField,this._boundTo=Q):this._bitField=-2097153&this._bitField},_.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},_.bind=function(Q,J){return _.resolve(J).bind(Q)}}},{}],4:[function(h,v,y){var b;"undefined"!=typeof Promise&&(b=Promise);var w=h("./promise")();w.noConflict=function _(){try{Promise===w&&(Promise=b)}catch(I){}return w},v.exports=w},{"./promise":22}],5:[function(h,v,y){var _=Object.create;if(_){var b=_(null),w=_(null);b[" size"]=w[" size"]=0}v.exports=function(I){function M(Z){var se=function A(Z,re){var se;if(null!=Z&&(se=Z[re]),"function"!=typeof se){var ce="Object "+Q.classString(Z)+" has no method '"+Q.toString(re)+"'";throw new I.TypeError(ce)}return se}(Z,this.pop());return se.apply(Z,this)}function F(Z){return Z[this]}function V(Z){var re=+this;return 0>re&&(re=Math.max(0,re+Z.length)),Z[re]}var Q=h("./util"),J=Q.canEvaluate;I.prototype.call=function(Z){var re=[].slice.call(arguments,1);return re.push(Z),this._then(M,void 0,void 0,re,void 0)},I.prototype.get=function(Z){var re;if("number"==typeof Z)re=V;else if(J){var ce=(void 0)(Z);re=null!==ce?ce:F}else re=F;return this._then(re,void 0,void 0,Z,void 0)}}},{"./util":36}],6:[function(h,v,y){v.exports=function(_,b,w,I){var A=h("./util"),M=A.tryCatch,F=A.errorObj,V=_._async;_.prototype.break=_.prototype.cancel=function(){if(!I.cancellation())return this._warn("cancellation is disabled");for(var B=this,Q=B;B._isCancellable();){if(!B._cancelBy(Q)){Q._isFollowing()?Q._followee().cancel():Q._cancelBranched();break}var J=B._cancellationParent;if(null==J||!J._isCancellable()){B._isFollowing()?B._followee().cancel():B._cancelBranched();break}B._isFollowing()&&B._followee().cancel(),B._setWillBeCancelled(),Q=B,B=J}},_.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},_.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},_.prototype._cancelBy=function(B){return B===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},_.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},_.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),V.invoke(this._cancelPromises,this,void 0))},_.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},_.prototype._unsetOnCancel=function(){this._onCancelField=void 0},_.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},_.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},_.prototype._doInvokeOnCancel=function(B,Q){if(A.isArray(B))for(var J=0;J<B.length;++J)this._doInvokeOnCancel(B[J],Q);else if(void 0!==B)if("function"==typeof B){if(!Q){var Z=M(B).call(this._boundValue());Z===F&&(this._attachExtraTrace(Z.e),V.throwLater(Z.e))}}else B._resultCancelled(this)},_.prototype._invokeOnCancel=function(){var B=this._onCancel();this._unsetOnCancel(),V.invoke(this._doInvokeOnCancel,this,B)},_.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},_.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(h,v,y){v.exports=function(_){var w=h("./util"),I=h("./es5").keys,A=w.tryCatch,M=w.errorObj;return function b(F,V,B){return function(Q){var J=B._boundValue();e:for(var Z=0;Z<F.length;++Z){var re=F[Z];if(re===Error||null!=re&&re.prototype instanceof Error){if(Q instanceof re)return A(V).call(J,Q)}else if("function"==typeof re){var se=A(re).call(J,Q);if(se===M)return se;if(se)return A(V).call(J,Q)}else if(w.isObject(Q)){for(var ce=I(re),pe=0;pe<ce.length;++pe){var Ce=ce[pe];if(re[Ce]!=Q[Ce])continue e}return A(V).call(J,Q)}}return _}}}},{"./es5":13,"./util":36}],8:[function(h,v,y){v.exports=function(_){function b(){this._trace=new b.CapturedTrace(I())}function I(){var F=M.length-1;return F>=0?M[F]:void 0}var A=!1,M=[];return _.prototype._promiseCreated=function(){},_.prototype._pushContext=function(){},_.prototype._popContext=function(){return null},_._peekContext=_.prototype._peekContext=function(){},b.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,M.push(this._trace))},b.prototype._popContext=function(){if(void 0!==this._trace){var F=M.pop(),V=F._promiseCreated;return F._promiseCreated=null,V}return null},b.CapturedTrace=null,b.create=function w(){return A?new b:void 0},b.deactivateLongStackTraces=function(){},b.activateLongStackTraces=function(){var F=_.prototype._pushContext,V=_.prototype._popContext,B=_._peekContext,Q=_.prototype._peekContext,J=_.prototype._promiseCreated;b.deactivateLongStackTraces=function(){_.prototype._pushContext=F,_.prototype._popContext=V,_._peekContext=B,_.prototype._peekContext=Q,_.prototype._promiseCreated=J,A=!1},A=!0,_.prototype._pushContext=b.prototype._pushContext,_.prototype._popContext=b.prototype._popContext,_._peekContext=_.prototype._peekContext=I,_.prototype._promiseCreated=function(){var Z=this._peekContext();Z&&null==Z._promiseCreated&&(Z._promiseCreated=this)}},b}},{}],9:[function(h,v,y){v.exports=function(_,b,w,I){function A(ut,ft){return{promise:ft}}function M(){return!1}function F(ut,ft,Lt){var Ut=this;try{ut(ft,Lt,function(sn){if("function"!=typeof sn)throw new TypeError("onCancel must be a function, got: "+he.toString(sn));Ut._attachCancellationCallback(sn)})}catch(sn){return sn}}function V(ut){if(!this._isCancellable())return this;var ft=this._onCancel();void 0!==ft?he.isArray(ft)?ft.push(ut):this._setOnCancel([ft,ut]):this._setOnCancel(ut)}function B(){return this._onCancelField}function Q(ut){this._onCancelField=ut}function J(){this._cancellationParent=void 0,this._onCancelField=void 0}function Z(ut,ft){if(0!=(1&ft)){this._cancellationParent=ut;var Lt=ut._branchesRemainingToCancel;void 0===Lt&&(Lt=0),ut._branchesRemainingToCancel=Lt+1}0!=(2&ft)&&ut._isBound()&&this._setBoundTo(ut._boundTo)}function se(){var ut=this._boundTo;return void 0!==ut&&ut instanceof _?ut.isFulfilled()?ut.value():void 0:ut}function ce(){this._trace=new fe(this._peekContext())}function pe(ut,ft){if(Ze(ut)){var Lt=this._trace;if(void 0!==Lt&&ft&&(Lt=Lt._parent),void 0!==Lt)Lt.attachExtraTrace(ut);else if(!ut.__stackCleaned__){var Ut=q(ut);he.notEnumerableProp(ut,"stack",Ut.message+"\n"+Ut.stack.join("\n")),he.notEnumerableProp(ut,"__stackCleaned__",!0)}}}function Ce(){this._trace=void 0}function Me(ut,ft,Lt){if(wn.warnings){var Ut,sn=new Ae(ut);if(ft)Lt._attachExtraTrace(sn);else if(wn.longStackTraces&&(Ut=_._peekContext()))Ut.attachExtraTrace(sn);else{var Yn=q(sn);sn.stack=Yn.message+"\n"+Yn.stack.join("\n")}Ht("warning",sn)||k(sn,"",!0)}}function L(ut){for(var ft=[],Lt=0;Lt<ut.length;++Lt){var Ut=ut[Lt],sn="    (No stack trace)"===Ut||at.test(Ut),Yn=sn&&an(Ut);sn&&!Yn&&(dt&&" "!==Ut.charAt(0)&&(Ut="    "+Ut),ft.push(Ut))}return ft}function q(ut){var ft=ut.stack,Lt=ut.toString();return ft="string"==typeof ft&&ft.length>0?function Y(ut){for(var ft=ut.stack.replace(/\s+$/g,"").split("\n"),Lt=0;Lt<ft.length;++Lt){var Ut=ft[Lt];if("    (No stack trace)"===Ut||at.test(Ut))break}return Lt>0&&"SyntaxError"!=ut.name&&(ft=ft.slice(Lt)),ft}(ut):["    (No stack trace)"],{message:Lt,stack:"SyntaxError"==ut.name?ft:L(ft)}}function k(ut,ft,Lt){var Ut;"undefined"!=typeof console&&(Ut=he.isObject(ut)?ft+vt(ut.stack,ut):ft+String(ut),"function"==typeof De?De(Ut,Lt):("function"==typeof console.log||"object"==typeof console.log)&&console.log(Ut))}function N(ut,ft,Lt,Ut){var sn=!1;try{"function"==typeof ft&&(sn=!0,"rejectionHandled"===ut?ft(Ut):ft(Lt,Ut))}catch(Yn){ke.throwLater(Yn)}"unhandledRejection"===ut?Ht(ut,Lt,Ut)||sn||k(Lt,"Unhandled rejection "):Ht(ut,Ut)}function $(ut){var ft;if("function"==typeof ut)ft="[function "+(ut.name||"anonymous")+"]";else{if(ft=ut&&"function"==typeof ut.toString?ut.toString():he.toString(ut),/\[object [a-zA-Z0-9$_]+\]/.test(ft))try{ft=JSON.stringify(ut)}catch(sn){}0===ft.length&&(ft="(empty array)")}return"(<"+function ie(ut){return ut.length<41?ut:ut.substr(0,38)+"..."}(ft)+">, no stack trace)"}function ee(){return"function"==typeof ln}function ne(ut){var ft=ut.match(fn);return ft?{fileName:ft[1],line:parseInt(ft[2],10)}:void 0}function fe(ut){this._parent=ut,this._promisesCreated=0;var ft=this._length=1+(void 0===ut?0:ut._length);ln(this,fe),ft>32&&this.uncycle()}var xe,Pe,De,je,ke=_._async,Ae=h("./errors").Warning,he=h("./util"),tt=h("./es5"),Ze=he.canAttachTrace,nt=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,et=/\((?:timers\.js):\d+:\d+\)/,Qe=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,at=null,vt=null,dt=!1,Je=!(0==he.env("BLUEBIRD_DEBUG")||!he.env("BLUEBIRD_DEBUG")&&"development"!==he.env("NODE_ENV")),it=!(0==he.env("BLUEBIRD_WARNINGS")||!Je&&!he.env("BLUEBIRD_WARNINGS")),ct=!(0==he.env("BLUEBIRD_LONG_STACK_TRACES")||!Je&&!he.env("BLUEBIRD_LONG_STACK_TRACES")),wt=0!=he.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(it||!!he.env("BLUEBIRD_W_FORGOTTEN_RETURN"));(function(){function ut(){for(var Ut=0;Ut<Lt.length;++Ut)Lt[Ut]._notifyUnhandledRejection();ft()}function ft(){Lt.length=0}var Lt=[];je=function(Ut){Lt.push(Ut),setTimeout(ut,1)},tt.defineProperty(_,"_unhandledRejectionCheck",{value:ut}),tt.defineProperty(_,"_unhandledRejectionClear",{value:ft})})(),_.prototype.suppressUnhandledRejections=function(){var ut=this._target();ut._bitField=-1048577&ut._bitField|524288},_.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),je(this))},_.prototype._notifyUnhandledRejectionIsHandled=function(){N("rejectionHandled",xe,void 0,this)},_.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},_.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},_.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var ut=this._settledValue();this._setUnhandledRejectionIsNotified(),N("unhandledRejection",Pe,ut,this)}},_.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},_.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},_.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},_.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},_.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},_.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},_.prototype._warn=function(ut,ft,Lt){return Me(ut,ft,Lt||this)},_.onPossiblyUnhandledRejection=function(ut){var ft=_._getContext();Pe=he.contextBind(ft,ut)},_.onUnhandledRejectionHandled=function(ut){var ft=_._getContext();xe=he.contextBind(ft,ut)};var ht=function(){};_.longStackTraces=function(){if(ke.haveItemsQueued()&&!wn.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!wn.longStackTraces&&ee()){var ut=_.prototype._captureStackTrace,ft=_.prototype._attachExtraTrace,Lt=_.prototype._dereferenceTrace;wn.longStackTraces=!0,ht=function(){if(ke.haveItemsQueued()&&!wn.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");_.prototype._captureStackTrace=ut,_.prototype._attachExtraTrace=ft,_.prototype._dereferenceTrace=Lt,b.deactivateLongStackTraces(),wn.longStackTraces=!1},_.prototype._captureStackTrace=ce,_.prototype._attachExtraTrace=pe,_.prototype._dereferenceTrace=Ce,b.activateLongStackTraces()}},_.hasLongStackTraces=function(){return wn.longStackTraces&&ee()};var At={unhandledrejection:{before:function(){var ut=he.global.onunhandledrejection;return he.global.onunhandledrejection=null,ut},after:function(ut){he.global.onunhandledrejection=ut}},rejectionhandled:{before:function(){var ut=he.global.onrejectionhandled;return he.global.onrejectionhandled=null,ut},after:function(ut){he.global.onrejectionhandled=ut}}},kt=function(){var ut=function(Lt,Ut){if(!Lt)return!he.global.dispatchEvent(Ut);var sn;try{return sn=Lt.before(),!he.global.dispatchEvent(Ut)}finally{Lt.after(sn)}};try{if("function"==typeof CustomEvent){var ft=new CustomEvent("CustomEvent");return he.global.dispatchEvent(ft),function(Ut,sn){Ut=Ut.toLowerCase();var ki=new CustomEvent(Ut,{detail:sn,cancelable:!0});return tt.defineProperty(ki,"promise",{value:sn.promise}),tt.defineProperty(ki,"reason",{value:sn.reason}),ut(At[Ut],ki)}}return"function"==typeof Event?(ft=new Event("CustomEvent"),he.global.dispatchEvent(ft),function(Ut,sn){Ut=Ut.toLowerCase();var Yn=new Event(Ut,{cancelable:!0});return Yn.detail=sn,tt.defineProperty(Yn,"promise",{value:sn.promise}),tt.defineProperty(Yn,"reason",{value:sn.reason}),ut(At[Ut],Yn)}):((ft=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),he.global.dispatchEvent(ft),function(Lt,Ut){Lt=Lt.toLowerCase();var sn=document.createEvent("CustomEvent");return sn.initCustomEvent(Lt,!1,!0,Ut),ut(At[Lt],sn)})}catch(Lt){}return function(){return!1}}(),Bt=he.isNode?function(){return process.emit.apply(process,arguments)}:he.global?function(ut){var ft="on"+ut.toLowerCase(),Lt=he.global[ft];return!!Lt&&(Lt.apply(he.global,[].slice.call(arguments,1)),!0)}:function(){return!1},Ft={promiseCreated:A,promiseFulfilled:A,promiseRejected:A,promiseResolved:A,promiseCancelled:A,promiseChained:function(ut,ft,Lt){return{promise:ft,child:Lt}},warning:function(ut,ft){return{warning:ft}},unhandledRejection:function(ut,ft,Lt){return{reason:ft,promise:Lt}},rejectionHandled:A},Ht=function(ut){var ft=!1;try{ft=Bt.apply(null,arguments)}catch(Ut){ke.throwLater(Ut),ft=!0}var Lt=!1;try{Lt=kt(ut,Ft[ut].apply(null,arguments))}catch(Ut){ke.throwLater(Ut),Lt=!0}return Lt||ft};_.config=function(ut){if("longStackTraces"in(ut=Object(ut))&&(ut.longStackTraces?_.longStackTraces():!ut.longStackTraces&&_.hasLongStackTraces()&&ht()),"warnings"in ut){var ft=ut.warnings;wn.warnings=!!ft,wt=wn.warnings,he.isObject(ft)&&"wForgottenReturn"in ft&&(wt=!!ft.wForgottenReturn)}if("cancellation"in ut&&ut.cancellation&&!wn.cancellation){if(ke.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");_.prototype._clearCancellationData=J,_.prototype._propagateFrom=Z,_.prototype._onCancel=B,_.prototype._setOnCancel=Q,_.prototype._attachCancellationCallback=V,_.prototype._execute=F,Kt=Z,wn.cancellation=!0}if("monitoring"in ut&&(ut.monitoring&&!wn.monitoring?(wn.monitoring=!0,_.prototype._fireEvent=Ht):!ut.monitoring&&wn.monitoring&&(wn.monitoring=!1,_.prototype._fireEvent=M)),"asyncHooks"in ut&&he.nodeSupportsAsyncResource){var Ut=!!ut.asyncHooks;wn.asyncHooks!==Ut&&(wn.asyncHooks=Ut,Ut?w():I())}return _},_.prototype._fireEvent=M,_.prototype._execute=function(ut,ft,Lt){try{ut(ft,Lt)}catch(Ut){return Ut}},_.prototype._onCancel=function(){},_.prototype._setOnCancel=function(ut){},_.prototype._attachCancellationCallback=function(ut){},_.prototype._captureStackTrace=function(){},_.prototype._attachExtraTrace=function(){},_.prototype._dereferenceTrace=function(){},_.prototype._clearCancellationData=function(){},_.prototype._propagateFrom=function(ut,ft){};var Kt=function re(ut,ft){0!=(2&ft)&&ut._isBound()&&this._setBoundTo(ut._boundTo)},an=function(){return!1},fn=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;he.inherits(fe,Error),b.CapturedTrace=fe,fe.prototype.uncycle=function(){var ut=this._length;if(!(2>ut)){for(var ft=[],Lt={},Ut=0,sn=this;void 0!==sn;++Ut)ft.push(sn),sn=sn._parent;for(Ut=(ut=this._length=Ut)-1;Ut>=0;--Ut){var Yn=ft[Ut].stack;void 0===Lt[Yn]&&(Lt[Yn]=Ut)}for(Ut=0;ut>Ut;++Ut){var Hi=Lt[ft[Ut].stack];if(void 0!==Hi&&Hi!==Ut){Hi>0&&(ft[Hi-1]._parent=void 0,ft[Hi-1]._length=1),ft[Ut]._parent=void 0,ft[Ut]._length=1;var Qi=Ut>0?ft[Ut-1]:this;ut-1>Hi?(Qi._parent=ft[Hi+1],Qi._parent.uncycle(),Qi._length=Qi._parent._length+1):(Qi._parent=void 0,Qi._length=1);for(var Lr=Qi._length+1,qa=Ut-2;qa>=0;--qa)ft[qa]._length=Lr,Lr++;return}}}},fe.prototype.attachExtraTrace=function(ut){if(!ut.__stackCleaned__){this.uncycle();for(var ft=q(ut),Lt=ft.message,Ut=[ft.stack],sn=this;void 0!==sn;)Ut.push(L(sn.stack.split("\n"))),sn=sn._parent;(function j(ut){for(var ft=ut[0],Lt=1;Lt<ut.length;++Lt){for(var Ut=ut[Lt],sn=ft.length-1,Yn=ft[sn],ki=-1,Hi=Ut.length-1;Hi>=0;--Hi)if(Ut[Hi]===Yn){ki=Hi;break}for(Hi=ki;Hi>=0&&ft[sn]===Ut[Hi];--Hi)ft.pop(),sn--;ft=Ut}})(Ut),function Le(ut){for(var ft=0;ft<ut.length;++ft)(0===ut[ft].length||ft+1<ut.length&&ut[ft][0]===ut[ft+1][0])&&(ut.splice(ft,1),ft--)}(Ut),he.notEnumerableProp(ut,"stack",function we(ut,ft){for(var Lt=0;Lt<ft.length-1;++Lt)ft[Lt].push("From previous event:"),ft[Lt]=ft[Lt].join("\n");return Lt<ft.length&&(ft[Lt]=ft[Lt].join("\n")),ut+"\n"+ft.join("\n")}(Lt,Ut)),he.notEnumerableProp(ut,"__stackCleaned__",!0)}};var ln=function(){var ut=/^\s*at\s*/,ft=function(Yn,ki){return"string"==typeof Yn?Yn:void 0!==ki.name&&void 0!==ki.message?ki.toString():$(ki)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,at=ut,vt=ft;var Lt=Error.captureStackTrace;return an=function(Yn){return nt.test(Yn)},function(Yn,ki){Error.stackTraceLimit+=6,Lt(Yn,ki),Error.stackTraceLimit-=6}}var sn,Ut=new Error;if("string"==typeof Ut.stack&&Ut.stack.split("\n")[0].indexOf("stackDetection@")>=0)return at=/@/,vt=ft,dt=!0,function(Yn){Yn.stack=(new Error).stack};try{throw new Error}catch(Yn){sn="stack"in Yn}return"stack"in Ut||!sn||"number"!=typeof Error.stackTraceLimit?(vt=function(Yn,ki){return"string"==typeof Yn?Yn:"object"!=typeof ki&&"function"!=typeof ki||void 0===ki.name||void 0===ki.message?$(ki):ki.toString()},null):(at=ut,vt=ft,function(Yn){Error.stackTraceLimit+=6;try{throw new Error}catch(ki){Yn.stack=ki.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(De=function(ut){console.warn(ut)},he.isNode&&process.stderr.isTTY?De=function(ut,ft){console.warn((ft?"\x1b[33m":"\x1b[31m")+ut+"\x1b[0m\n")}:he.isNode||"string"!=typeof(new Error).stack||(De=function(ut,ft){console.warn("%c"+ut,ft?"color: darkorange":"color: red")}));var wn={warnings:it,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return ct&&_.longStackTraces(),{asyncHooks:function(){return wn.asyncHooks},longStackTraces:function(){return wn.longStackTraces},warnings:function(){return wn.warnings},cancellation:function(){return wn.cancellation},monitoring:function(){return wn.monitoring},propagateFromFunction:function(){return Kt},boundValueFunction:function(){return se},checkForgottenReturns:function Ve(ut,ft,Lt,Ut,sn){if(void 0===ut&&null!==ft&&wt){if(void 0!==sn&&sn._returnedNonUndefined()||0==(65535&Ut._bitField))return;Lt&&(Lt+=" ");var Yn="",ki="";if(ft._trace){for(var Hi=ft._trace.stack.split("\n"),Qi=L(Hi),Lr=Qi.length-1;Lr>=0;--Lr){var qa=Qi[Lr];if(!et.test(qa)){var fa=qa.match(Qe);fa&&(Yn="at "+fa[1]+":"+fa[2]+":"+fa[3]+" ");break}}if(Qi.length>0){var rd=Qi[0];for(Lr=0;Lr<Hi.length;++Lr)if(Hi[Lr]===rd){Lr>0&&(ki="\n"+Hi[Lr-1]);break}}}Ut._warn("a promise was created in a "+Lt+"handler "+Yn+"but was not returned from it, see http://goo.gl/rRqMUw"+ki,!0,ft)}},setBounds:function le(ut,ft){if(ee()){for(var Lt,Ut,sn=(ut.stack||"").split("\n"),Yn=(ft.stack||"").split("\n"),ki=-1,Hi=-1,Qi=0;Qi<sn.length;++Qi)if(Lr=ne(sn[Qi])){Lt=Lr.fileName,ki=Lr.line;break}for(Qi=0;Qi<Yn.length;++Qi){var Lr;if(Lr=ne(Yn[Qi])){Ut=Lr.fileName,Hi=Lr.line;break}}0>ki||0>Hi||!Lt||!Ut||Lt!==Ut||ki>=Hi||(an=function(qa){if(nt.test(qa))return!0;var fa=ne(qa);return!!(fa&&fa.fileName===Lt&&ki<=fa.line&&fa.line<=Hi)})}},warn:Me,deprecated:function te(ut,ft){var Lt=ut+" is deprecated and will be removed in a future version.";return ft&&(Lt+=" Use "+ft+" instead."),Me(Lt)},CapturedTrace:fe,fireDomEvent:kt,fireGlobalEvent:Bt}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(h,v,y){v.exports=function(_){function b(){return this.value}function w(){throw this.reason}_.prototype.return=_.prototype.thenReturn=function(I){return I instanceof _&&I.suppressUnhandledRejections(),this._then(b,void 0,void 0,{value:I},void 0)},_.prototype.throw=_.prototype.thenThrow=function(I){return this._then(w,void 0,void 0,{reason:I},void 0)},_.prototype.catchThrow=function(I){if(arguments.length<=1)return this._then(void 0,w,void 0,{reason:I},void 0);var A=arguments[1],M=function(){throw A};return this.caught(I,M)},_.prototype.catchReturn=function(I){if(arguments.length<=1)return I instanceof _&&I.suppressUnhandledRejections(),this._then(void 0,b,void 0,{value:I},void 0);var A=arguments[1];A instanceof _&&A.suppressUnhandledRejections();var M=function(){return A};return this.caught(I,M)}}},{}],11:[function(h,v,y){v.exports=function(_,b){function w(){return M(this)}var A=_.reduce,M=_.all;_.prototype.each=function(F){return A(this,F,b,0)._then(w,void 0,void 0,this,void 0)},_.prototype.mapSeries=function(F){return A(this,F,b,b)},_.each=function(F,V){return A(F,V,b,0)._then(w,void 0,void 0,F,void 0)},_.mapSeries=function I(F,V){return A(F,V,b,b)}}},{}],12:[function(h,v,y){function _(Ve,te){function Me(we){return this instanceof Me?(B(this,"message","string"==typeof we?we:te),B(this,"name",Ve),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new Me(we)}return V(Me,Error),Me}function b(Ve){return this instanceof b?(B(this,"name","OperationalError"),B(this,"message",Ve),this.cause=Ve,this.isOperational=!0,void(Ve instanceof Error?(B(this,"message",Ve.message),B(this,"stack",Ve.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new b(Ve)}var w,I,A=h("./es5"),M=A.freeze,F=h("./util"),V=F.inherits,B=F.notEnumerableProp,Q=_("Warning","warning"),J=_("CancellationError","cancellation error"),Z=_("TimeoutError","timeout error"),re=_("AggregateError","aggregate error");try{w=TypeError,I=RangeError}catch(Ve){w=_("TypeError","type error"),I=_("RangeError","range error")}for(var se="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),ce=0;ce<se.length;++ce)"function"==typeof Array.prototype[se[ce]]&&(re.prototype[se[ce]]=Array.prototype[se[ce]]);A.defineProperty(re.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),re.prototype.isOperational=!0;var pe=0;re.prototype.toString=function(){var Ve=Array(4*pe+1).join(" "),te="\n"+Ve+"AggregateError of:\n";pe++,Ve=Array(4*pe+1).join(" ");for(var Me=0;Me<this.length;++Me){for(var we=this[Me]===this?"[Circular AggregateError]":this[Me]+"",Le=we.split("\n"),j=0;j<Le.length;++j)Le[j]=Ve+Le[j];te+=(we=Le.join("\n"))+"\n"}return pe--,te},V(b,Error);var Ce=Error.__BluebirdErrorTypes__;Ce||(Ce=M({CancellationError:J,TimeoutError:Z,OperationalError:b,RejectionError:b,AggregateError:re}),A.defineProperty(Error,"__BluebirdErrorTypes__",{value:Ce,writable:!1,enumerable:!1,configurable:!1})),v.exports={Error,TypeError:w,RangeError:I,CancellationError:Ce.CancellationError,OperationalError:Ce.OperationalError,TimeoutError:Ce.TimeoutError,AggregateError:Ce.AggregateError,Warning:Q}},{"./es5":13,"./util":36}],13:[function(h,v,y){var _=function(){return void 0===this}();if(_)v.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:_,propertyIsWritable:function(J,Z){var re=Object.getOwnPropertyDescriptor(J,Z);return!(re&&!re.writable&&!re.set)}};else{var b={}.hasOwnProperty,w={}.toString,I={}.constructor.prototype,A=function(J){var Z=[];for(var re in J)b.call(J,re)&&Z.push(re);return Z};v.exports={isArray:function(J){try{return"[object Array]"===w.call(J)}catch(Z){return!1}},keys:A,names:A,defineProperty:function(J,Z,re){return J[Z]=re.value,J},getDescriptor:function(J,Z){return{value:J[Z]}},freeze:function(J){return J},getPrototypeOf:function(J){try{return Object(J).constructor.prototype}catch(Z){return I}},isES5:_,propertyIsWritable:function(){return!0}}}},{}],14:[function(h,v,y){v.exports=function(_,b){var w=_.map;_.prototype.filter=function(I,A){return w(this,I,A,b)},_.filter=function(I,A,M){return w(I,A,M,b)}}},{}],15:[function(h,v,y){v.exports=function(_,b,w){function I(se,ce,pe){this.promise=se,this.type=ce,this.handler=pe,this.called=!1,this.cancelPromise=null}function A(se){this.finallyHandler=se}function M(se,ce){return null!=se.cancelPromise&&(arguments.length>1?se.cancelPromise._reject(ce):se.cancelPromise._cancel(),se.cancelPromise=null,!0)}function F(){return B.call(this,this.promise._target()._settledValue())}function V(se){return M(this,se)?void 0:(Z.e=se,Z)}function B(se){var ce=this.promise,pe=this.handler;if(!this.called){this.called=!0;var Ce=this.isFinallyHandler()?pe.call(ce._boundValue()):pe.call(ce._boundValue(),se);if(Ce===w)return Ce;if(void 0!==Ce){ce._setReturnedNonUndefined();var Ve=b(Ce,ce);if(Ve instanceof _){if(null!=this.cancelPromise){if(Ve._isCancelled()){var te=new J("late cancellation observer");return ce._attachExtraTrace(te),Z.e=te,Z}Ve.isPending()&&Ve._attachCancellationCallback(new A(this))}return Ve._then(F,V,void 0,this,void 0)}}}return ce.isRejected()?(M(this),Z.e=se,Z):(M(this),se)}var Q=h("./util"),J=_.CancellationError,Z=Q.errorObj,re=h("./catch_filter")(w);return I.prototype.isFinallyHandler=function(){return 0===this.type},A.prototype._resultCancelled=function(){M(this.finallyHandler)},_.prototype._passThrough=function(se,ce,pe,Ce){return"function"!=typeof se?this.then():this._then(pe,Ce,void 0,new I(this,ce,se),void 0)},_.prototype.lastly=_.prototype.finally=function(se){return this._passThrough(se,0,B,B)},_.prototype.tap=function(se){return this._passThrough(se,1,B)},_.prototype.tapCatch=function(se){var ce=arguments.length;if(1===ce)return this._passThrough(se,1,void 0,B);var pe,Ce=new Array(ce-1),Ve=0;for(pe=0;ce-1>pe;++pe){var te=arguments[pe];if(!Q.isObject(te))return _.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+Q.classString(te)));Ce[Ve++]=te}Ce.length=Ve;var Me=arguments[pe];return this._passThrough(re(Ce,Me,this),1,void 0,B)},I}},{"./catch_filter":7,"./util":36}],16:[function(h,v,y){v.exports=function(_,b,w,I,A,M){function V(ce,pe,Ce,Ve){if(M.cancellation()){var te=new _(w),Me=this._finallyPromise=new _(w);this._promise=te.lastly(function(){return Me}),te._captureStackTrace(),te._setOnCancel(this)}else(this._promise=new _(w))._captureStackTrace();this._stack=Ve,this._generatorFunction=ce,this._receiver=pe,this._generator=void 0,this._yieldHandlers="function"==typeof Ce?[Ce].concat(se):se,this._yieldedPromise=null,this._cancellationPhase=!1}var Q=h("./errors").TypeError,J=h("./util"),Z=J.errorObj,re=J.tryCatch,se=[];J.inherits(V,A),V.prototype._isResolved=function(){return null===this._promise},V.prototype._cleanup=function(){this._promise=this._generator=null,M.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},V.prototype._promiseCancelled=function(){if(!this._isResolved()){var ce;if(void 0!==this._generator.return)this._promise._pushContext(),ce=re(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var Ce=new _.CancellationError("generator .return() sentinel");_.coroutine.returnSentinel=Ce,this._promise._attachExtraTrace(Ce),this._promise._pushContext(),ce=re(this._generator.throw).call(this._generator,Ce),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(ce)}},V.prototype._promiseFulfilled=function(ce){this._yieldedPromise=null,this._promise._pushContext();var pe=re(this._generator.next).call(this._generator,ce);this._promise._popContext(),this._continue(pe)},V.prototype._promiseRejected=function(ce){this._yieldedPromise=null,this._promise._attachExtraTrace(ce),this._promise._pushContext();var pe=re(this._generator.throw).call(this._generator,ce);this._promise._popContext(),this._continue(pe)},V.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof _){var ce=this._yieldedPromise;this._yieldedPromise=null,ce.cancel()}},V.prototype.promise=function(){return this._promise},V.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},V.prototype._continue=function(ce){var pe=this._promise;if(ce===Z)return this._cleanup(),this._cancellationPhase?pe.cancel():pe._rejectCallback(ce.e,!1);var Ce=ce.value;if(!0===ce.done)return this._cleanup(),this._cancellationPhase?pe.cancel():pe._resolveCallback(Ce);var Ve=I(Ce,this._promise);if(Ve instanceof _||(Ve=function F(ce,pe,Ce){for(var Ve=0;Ve<pe.length;++Ve){Ce._pushContext();var te=re(pe[Ve])(ce);if(Ce._popContext(),te===Z){Ce._pushContext();var Me=_.reject(Z.e);return Ce._popContext(),Me}var we=I(te,Ce);if(we instanceof _)return we}return null}(Ve,this._yieldHandlers,this._promise),null!==Ve)){var te=(Ve=Ve._target())._bitField;0==(50397184&te)?(this._yieldedPromise=Ve,Ve._proxy(this,null)):0!=(33554432&te)?_._async.invoke(this._promiseFulfilled,this,Ve._value()):0!=(16777216&te)?_._async.invoke(this._promiseRejected,this,Ve._reason()):this._promiseCancelled()}else this._promiseRejected(new Q("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(Ce))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},_.coroutine=function(ce,pe){if("function"!=typeof ce)throw new Q("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var Ce=Object(pe).yieldHandler,Ve=V,te=(new Error).stack;return function(){var Me=ce.apply(this,arguments),we=new Ve(void 0,void 0,Ce,te),Le=we.promise();return we._generator=Me,we._promiseFulfilled(void 0),Le}},_.coroutine.addYieldHandler=function(ce){if("function"!=typeof ce)throw new Q("expecting a function but got "+J.classString(ce));se.push(ce)},_.spawn=function(ce){if(M.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof ce)return b("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var pe=new V(ce,this),Ce=pe.promise();return pe._run(_.spawn),Ce}}},{"./errors":12,"./util":36}],17:[function(h,v,y){v.exports=function(_,b,w,I,A){h("./util"),_.join=function(){var F,V=arguments.length-1;V>0&&"function"==typeof arguments[V]&&(F=arguments[V]);var B=[].slice.call(arguments);F&&B.pop();var Q=new b(B).promise();return void 0!==F?Q.spread(F):Q}}},{"./util":36}],18:[function(h,v,y){v.exports=function(_,b,w,I,A,M){function F(re,se,ce,pe){this.constructor$(re),this._promise._captureStackTrace();var Ce=_._getContext();if(this._callback=B.contextBind(Ce,se),this._preservedValues=pe===A?new Array(this.length()):null,this._limit=ce,this._inFlight=0,this._queue=[],Z.invoke(this._asyncInit,this,void 0),B.isArray(re))for(var Ve=0;Ve<re.length;++Ve){var te=re[Ve];te instanceof _&&te.suppressUnhandledRejections()}}function V(re,se,ce,pe){if("function"!=typeof se)return w("expecting a function but got "+B.classString(se));var Ce=0;if(void 0!==ce){if("object"!=typeof ce||null===ce)return _.reject(new TypeError("options argument must be an object but it is "+B.classString(ce)));if("number"!=typeof ce.concurrency)return _.reject(new TypeError("'concurrency' must be a number but it is "+B.classString(ce.concurrency)));Ce=ce.concurrency}return new F(re,se,Ce="number"==typeof Ce&&isFinite(Ce)&&Ce>=1?Ce:0,pe).promise()}var B=h("./util"),Q=B.tryCatch,J=B.errorObj,Z=_._async;B.inherits(F,b),F.prototype._asyncInit=function(){this._init$(void 0,-2)},F.prototype._init=function(){},F.prototype._promiseFulfilled=function(re,se){var ce=this._values,pe=this.length(),Ce=this._preservedValues,Ve=this._limit;if(0>se){if(ce[se=-1*se-1]=re,Ve>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(Ve>=1&&this._inFlight>=Ve)return ce[se]=re,this._queue.push(se),!1;null!==Ce&&(Ce[se]=re);var te=this._promise,Me=this._callback,we=te._boundValue();te._pushContext();var Le=Q(Me).call(we,re,se,pe),j=te._popContext();if(M.checkForgottenReturns(Le,j,null!==Ce?"Promise.filter":"Promise.map",te),Le===J)return this._reject(Le.e),!0;var L=I(Le,this._promise);if(L instanceof _){var Y=(L=L._target())._bitField;if(0==(50397184&Y))return Ve>=1&&this._inFlight++,ce[se]=L,L._proxy(this,-1*(se+1)),!1;if(0==(33554432&Y))return 0!=(16777216&Y)?(this._reject(L._reason()),!0):(this._cancel(),!0);Le=L._value()}ce[se]=Le}return++this._totalResolved>=pe&&(null!==Ce?this._filter(ce,Ce):this._resolve(ce),!0)},F.prototype._drainQueue=function(){for(var re=this._queue,se=this._limit,ce=this._values;re.length>0&&this._inFlight<se;){if(this._isResolved())return;var pe=re.pop();this._promiseFulfilled(ce[pe],pe)}},F.prototype._filter=function(re,se){for(var ce=se.length,pe=new Array(ce),Ce=0,Ve=0;ce>Ve;++Ve)re[Ve]&&(pe[Ce++]=se[Ve]);pe.length=Ce,this._resolve(pe)},F.prototype.preservedValues=function(){return this._preservedValues},_.prototype.map=function(re,se){return V(this,re,se,null)},_.map=function(re,se,ce,pe){return V(re,se,ce,pe)}}},{"./util":36}],19:[function(h,v,y){v.exports=function(_,b,w,I,A){var M=h("./util"),F=M.tryCatch;_.method=function(V){if("function"!=typeof V)throw new _.TypeError("expecting a function but got "+M.classString(V));return function(){var B=new _(b);B._captureStackTrace(),B._pushContext();var Q=F(V).apply(this,arguments),J=B._popContext();return A.checkForgottenReturns(Q,J,"Promise.method",B),B._resolveFromSyncValue(Q),B}},_.attempt=_.try=function(V){if("function"!=typeof V)return I("expecting a function but got "+M.classString(V));var Q,B=new _(b);if(B._captureStackTrace(),B._pushContext(),arguments.length>1){A.deprecated("calling Promise.try with more than 1 argument");var J=arguments[1],Z=arguments[2];Q=M.isArray(J)?F(V).apply(Z,J):F(V).call(Z,J)}else Q=F(V)();var re=B._popContext();return A.checkForgottenReturns(Q,re,"Promise.try",B),B._resolveFromSyncValue(Q),B},_.prototype._resolveFromSyncValue=function(V){V===M.errorObj?this._rejectCallback(V.e,!1):this._resolveCallback(V,!0)}}},{"./util":36}],20:[function(h,v,y){function b(Q){var J;if(function _(Q){return Q instanceof Error&&V.getPrototypeOf(Q)===Error.prototype}(Q)){(J=new F(Q)).name=Q.name,J.message=Q.message,J.stack=Q.stack;for(var Z=V.keys(Q),re=0;re<Z.length;++re){var se=Z[re];B.test(se)||(J[se]=Q[se])}return J}return I.markAsOriginatingFromRejection(Q),Q}var I=h("./util"),A=I.maybeWrapAsError,F=h("./errors").OperationalError,V=h("./es5"),B=/^(?:name|message|stack|cause)$/;v.exports=function w(Q,J){return function(Z,re){if(null!==Q){if(Z){var se=b(A(Z));Q._attachExtraTrace(se),Q._reject(se)}else if(J){var ce=[].slice.call(arguments,1);Q._fulfill(ce)}else Q._fulfill(re);Q=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(h,v,y){v.exports=function(_){function b(B,Q){if(!A.isArray(B))return w.call(this,B,Q);var Z=F(Q).apply(this._boundValue(),[null].concat(B));Z===V&&M.throwLater(Z.e)}function w(B,Q){var Z=this._boundValue(),re=void 0===B?F(Q).call(Z,null):F(Q).call(Z,null,B);re===V&&M.throwLater(re.e)}function I(B,Q){if(!B){var Z=new Error(B+"");Z.cause=B,B=Z}var re=F(Q).call(this._boundValue(),B);re===V&&M.throwLater(re.e)}var A=h("./util"),M=_._async,F=A.tryCatch,V=A.errorObj;_.prototype.asCallback=_.prototype.nodeify=function(B,Q){if("function"==typeof B){var J=w;void 0!==Q&&Object(Q).spread&&(J=b),this._then(J,I,void 0,this,B)}return this}}},{"./util":36}],22:[function(h,v,y){v.exports=function(){function _(){}function w(ke){ke!==q&&function b(ke,Ae){if(null==ke||ke.constructor!==w&&"undefined"!=typeof Promise&&ke.constructor!==Promise)throw new L("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof Ae)throw new L("expecting a function but got "+J.classString(Ae))}(this,ke),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(ke),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function I(ke){this.promise._resolveCallback(ke)}function A(ke){this.promise._rejectCallback(ke,!1)}function M(ke){var Ae=new w(q);Ae._fulfillmentHandler0=ke,Ae._rejectionHandler0=ke,Ae._promise0=ke,Ae._receiver0=ke}var F=function(){return new L("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},V=function(){return new w.PromiseInspection(this._target())},B=function(ke){return w.reject(new L(ke))},Q={},J=h("./util");J.setReflectHandler(V);var Z=function(){var ke=process.domain;return void 0===ke?null:ke},se=function(){return{domain:Z(),async:null}},ce=J.isNode&&J.nodeSupportsAsyncResource?h("async_hooks").AsyncResource:null,pe=function(){return{domain:Z(),async:new ce("Bluebird::Promise")}},Ce=J.isNode?se:function(){return null};J.notEnumerableProp(w,"_getContext",Ce);var Me=h("./es5"),we=h("./async"),Le=new we;Me.defineProperty(w,"_async",{value:Le});var j=h("./errors"),L=w.TypeError=j.TypeError;w.RangeError=j.RangeError;var Y=w.CancellationError=j.CancellationError;w.TimeoutError=j.TimeoutError,w.OperationalError=j.OperationalError,w.RejectionError=j.OperationalError,w.AggregateError=j.AggregateError;var q=function(){},k={},N={},$=h("./thenables")(w,q),ie=h("./promise_array")(w,q,$,B,_),ee=h("./context")(w),ne=ee.create,le=h("./debuggability")(w,ee,function(){Ce=pe,J.notEnumerableProp(w,"_getContext",pe)},function(){Ce=se,J.notEnumerableProp(w,"_getContext",se)}),fe=h("./finally")(w,$,N),xe=h("./catch_filter")(N),Pe=h("./nodeback"),De=J.errorObj,je=J.tryCatch;return w.prototype.toString=function(){return"[object Promise]"},w.prototype.caught=w.prototype.catch=function(ke){var Ae=arguments.length;if(Ae>1){var he,tt=new Array(Ae-1),Ze=0;for(he=0;Ae-1>he;++he){var nt=arguments[he];if(!J.isObject(nt))return B("Catch statement predicate: expecting an object but got "+J.classString(nt));tt[Ze++]=nt}if(tt.length=Ze,"function"!=typeof(ke=arguments[he]))throw new L("The last argument to .catch() must be a function, got "+J.toString(ke));return this.then(void 0,xe(tt,ke,this))}return this.then(void 0,ke)},w.prototype.reflect=function(){return this._then(V,V,void 0,this,void 0)},w.prototype.then=function(ke,Ae){if(le.warnings()&&arguments.length>0&&"function"!=typeof ke&&"function"!=typeof Ae){var he=".then() only accepts functions but was passed: "+J.classString(ke);arguments.length>1&&(he+=", "+J.classString(Ae)),this._warn(he)}return this._then(ke,Ae,void 0,void 0,void 0)},w.prototype.done=function(ke,Ae){this._then(ke,Ae,void 0,void 0,void 0)._setIsFinal()},w.prototype.spread=function(ke){return"function"!=typeof ke?B("expecting a function but got "+J.classString(ke)):this.all()._then(ke,void 0,void 0,k,void 0)},w.prototype.toJSON=function(){var ke={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ke.fulfillmentValue=this.value(),ke.isFulfilled=!0):this.isRejected()&&(ke.rejectionReason=this.reason(),ke.isRejected=!0),ke},w.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new ie(this).promise()},w.prototype.error=function(ke){return this.caught(J.originatesFromRejection,ke)},w.getNewLibraryCopy=v.exports,w.is=function(ke){return ke instanceof w},w.fromNode=w.fromCallback=function(ke){var Ae=new w(q);Ae._captureStackTrace();var he=arguments.length>1&&!!Object(arguments[1]).multiArgs,tt=je(ke)(Pe(Ae,he));return tt===De&&Ae._rejectCallback(tt.e,!0),Ae._isFateSealed()||Ae._setAsyncGuaranteed(),Ae},w.all=function(ke){return new ie(ke).promise()},w.cast=function(ke){var Ae=$(ke);return Ae instanceof w||((Ae=new w(q))._captureStackTrace(),Ae._setFulfilled(),Ae._rejectionHandler0=ke),Ae},w.resolve=w.fulfilled=w.cast,w.reject=w.rejected=function(ke){var Ae=new w(q);return Ae._captureStackTrace(),Ae._rejectCallback(ke,!0),Ae},w.setScheduler=function(ke){if("function"!=typeof ke)throw new L("expecting a function but got "+J.classString(ke));return Le.setScheduler(ke)},w.prototype._then=function(ke,Ae,he,tt,Ze){var nt=void 0!==Ze,et=nt?Ze:new w(q),Qe=this._target(),at=Qe._bitField;nt||(et._propagateFrom(this,3),et._captureStackTrace(),void 0===tt&&0!=(2097152&this._bitField)&&(tt=0!=(50397184&at)?this._boundValue():Qe===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,et));var vt=Ce();if(0!=(50397184&at)){var dt,Je,it=Qe._settlePromiseCtx;0!=(33554432&at)?(Je=Qe._rejectionHandler0,dt=ke):0!=(16777216&at)?(Je=Qe._fulfillmentHandler0,dt=Ae,Qe._unsetRejectionIsUnhandled()):(it=Qe._settlePromiseLateCancellationObserver,Je=new Y("late cancellation observer"),Qe._attachExtraTrace(Je),dt=Ae),Le.invoke(it,Qe,{handler:J.contextBind(vt,dt),promise:et,receiver:tt,value:Je})}else Qe._addCallbacks(ke,Ae,et,tt,vt);return et},w.prototype._length=function(){return 65535&this._bitField},w.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},w.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},w.prototype._setLength=function(ke){this._bitField=-65536&this._bitField|65535&ke},w.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},w.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},w.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},w.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},w.prototype._isFinal=function(){return(4194304&this._bitField)>0},w.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},w.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},w.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},w.prototype._setAsyncGuaranteed=function(){if(!Le.hasCustomScheduler()){var ke=this._bitField;this._bitField=ke|(536870912&ke)>>2^134217728}},w.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},w.prototype._receiverAt=function(ke){var Ae=0===ke?this._receiver0:this[4*ke-4+3];return Ae===Q?void 0:void 0===Ae&&this._isBound()?this._boundValue():Ae},w.prototype._promiseAt=function(ke){return this[4*ke-4+2]},w.prototype._fulfillmentHandlerAt=function(ke){return this[4*ke-4+0]},w.prototype._rejectionHandlerAt=function(ke){return this[4*ke-4+1]},w.prototype._boundValue=function(){},w.prototype._migrateCallback0=function(ke){var Ae=ke._fulfillmentHandler0,he=ke._rejectionHandler0,tt=ke._promise0,Ze=ke._receiverAt(0);void 0===Ze&&(Ze=Q),this._addCallbacks(Ae,he,tt,Ze,null)},w.prototype._migrateCallbackAt=function(ke,Ae){var he=ke._fulfillmentHandlerAt(Ae),tt=ke._rejectionHandlerAt(Ae),Ze=ke._promiseAt(Ae),nt=ke._receiverAt(Ae);void 0===nt&&(nt=Q),this._addCallbacks(he,tt,Ze,nt,null)},w.prototype._addCallbacks=function(ke,Ae,he,tt,Ze){var nt=this._length();if(nt>=65531&&(nt=0,this._setLength(0)),0===nt)this._promise0=he,this._receiver0=tt,"function"==typeof ke&&(this._fulfillmentHandler0=J.contextBind(Ze,ke)),"function"==typeof Ae&&(this._rejectionHandler0=J.contextBind(Ze,Ae));else{var et=4*nt-4;this[et+2]=he,this[et+3]=tt,"function"==typeof ke&&(this[et+0]=J.contextBind(Ze,ke)),"function"==typeof Ae&&(this[et+1]=J.contextBind(Ze,Ae))}return this._setLength(nt+1),nt},w.prototype._proxy=function(ke,Ae){this._addCallbacks(void 0,void 0,Ae,ke,null)},w.prototype._resolveCallback=function(ke,Ae){if(0==(117506048&this._bitField)){if(ke===this)return this._rejectCallback(F(),!1);var he=$(ke,this);if(!(he instanceof w))return this._fulfill(ke);Ae&&this._propagateFrom(he,2);var tt=he._target();if(tt===this)return void this._reject(F());var Ze=tt._bitField;if(0==(50397184&Ze)){var nt=this._length();nt>0&&tt._migrateCallback0(this);for(var et=1;nt>et;++et)tt._migrateCallbackAt(this,et);this._setFollowing(),this._setLength(0),this._setFollowee(he)}else if(0!=(33554432&Ze))this._fulfill(tt._value());else if(0!=(16777216&Ze))this._reject(tt._reason());else{var Qe=new Y("late cancellation observer");tt._attachExtraTrace(Qe),this._reject(Qe)}}},w.prototype._rejectCallback=function(ke,Ae,he){var tt=J.ensureErrorObject(ke),Ze=tt===ke;if(!Ze&&!he&&le.warnings()){var nt="a promise was rejected with a non-error: "+J.classString(ke);this._warn(nt,!0)}this._attachExtraTrace(tt,!!Ae&&Ze),this._reject(ke)},w.prototype._resolveFromExecutor=function(ke){if(ke!==q){var Ae=this;this._captureStackTrace(),this._pushContext();var he=!0,tt=this._execute(ke,function(Ze){Ae._resolveCallback(Ze)},function(Ze){Ae._rejectCallback(Ze,he)});he=!1,this._popContext(),void 0!==tt&&Ae._rejectCallback(tt,!0)}},w.prototype._settlePromiseFromHandler=function(ke,Ae,he,tt){var Ze=tt._bitField;if(0==(65536&Ze)){var nt;tt._pushContext(),Ae===k?he&&"number"==typeof he.length?nt=je(ke).apply(this._boundValue(),he):(nt=De).e=new L("cannot .spread() a non-array: "+J.classString(he)):nt=je(ke).call(Ae,he);var et=tt._popContext();0==(65536&(Ze=tt._bitField))&&(nt===N?tt._reject(he):nt===De?tt._rejectCallback(nt.e,!1):(le.checkForgottenReturns(nt,et,"",tt,this),tt._resolveCallback(nt)))}},w.prototype._target=function(){for(var ke=this;ke._isFollowing();)ke=ke._followee();return ke},w.prototype._followee=function(){return this._rejectionHandler0},w.prototype._setFollowee=function(ke){this._rejectionHandler0=ke},w.prototype._settlePromise=function(ke,Ae,he,tt){var Ze=ke instanceof w,nt=this._bitField,et=0!=(134217728&nt);0!=(65536&nt)?(Ze&&ke._invokeInternalOnCancel(),he instanceof fe&&he.isFinallyHandler()?(he.cancelPromise=ke,je(Ae).call(he,tt)===De&&ke._reject(De.e)):Ae===V?ke._fulfill(V.call(he)):he instanceof _?he._promiseCancelled(ke):Ze||ke instanceof ie?ke._cancel():he.cancel()):"function"==typeof Ae?Ze?(et&&ke._setAsyncGuaranteed(),this._settlePromiseFromHandler(Ae,he,tt,ke)):Ae.call(he,tt,ke):he instanceof _?he._isResolved()||(0!=(33554432&nt)?he._promiseFulfilled(tt,ke):he._promiseRejected(tt,ke)):Ze&&(et&&ke._setAsyncGuaranteed(),0!=(33554432&nt)?ke._fulfill(tt):ke._reject(tt))},w.prototype._settlePromiseLateCancellationObserver=function(ke){var Ae=ke.handler,he=ke.promise,tt=ke.receiver,Ze=ke.value;"function"==typeof Ae?he instanceof w?this._settlePromiseFromHandler(Ae,tt,Ze,he):Ae.call(tt,Ze,he):he instanceof w&&he._reject(Ze)},w.prototype._settlePromiseCtx=function(ke){this._settlePromise(ke.promise,ke.handler,ke.receiver,ke.value)},w.prototype._settlePromise0=function(ke,Ae,he){var tt=this._promise0,Ze=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(tt,ke,Ze,Ae)},w.prototype._clearCallbackDataAtIndex=function(ke){var Ae=4*ke-4;this[Ae+2]=this[Ae+3]=this[Ae+0]=this[Ae+1]=void 0},w.prototype._fulfill=function(ke){var Ae=this._bitField;if(!((117506048&Ae)>>>16)){if(ke===this){var he=F();return this._attachExtraTrace(he),this._reject(he)}this._setFulfilled(),this._rejectionHandler0=ke,(65535&Ae)>0&&(0!=(134217728&Ae)?this._settlePromises():Le.settlePromises(this),this._dereferenceTrace())}},w.prototype._reject=function(ke){var Ae=this._bitField;if(!((117506048&Ae)>>>16))return this._setRejected(),this._fulfillmentHandler0=ke,this._isFinal()?Le.fatalError(ke,J.isNode):void((65535&Ae)>0?Le.settlePromises(this):this._ensurePossibleRejectionHandled())},w.prototype._fulfillPromises=function(ke,Ae){for(var he=1;ke>he;he++){var tt=this._fulfillmentHandlerAt(he),Ze=this._promiseAt(he),nt=this._receiverAt(he);this._clearCallbackDataAtIndex(he),this._settlePromise(Ze,tt,nt,Ae)}},w.prototype._rejectPromises=function(ke,Ae){for(var he=1;ke>he;he++){var tt=this._rejectionHandlerAt(he),Ze=this._promiseAt(he),nt=this._receiverAt(he);this._clearCallbackDataAtIndex(he),this._settlePromise(Ze,tt,nt,Ae)}},w.prototype._settlePromises=function(){var ke=this._bitField,Ae=65535&ke;if(Ae>0){if(0!=(16842752&ke)){var he=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,he,ke),this._rejectPromises(Ae,he)}else{var tt=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,tt,ke),this._fulfillPromises(Ae,tt)}this._setLength(0)}this._clearCancellationData()},w.prototype._settledValue=function(){var ke=this._bitField;return 0!=(33554432&ke)?this._rejectionHandler0:0!=(16777216&ke)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&Me.defineProperty(w.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),w.defer=w.pending=function(){return le.deprecated("Promise.defer","new Promise"),{promise:new w(q),resolve:I,reject:A}},J.notEnumerableProp(w,"_makeSelfResolutionError",F),h("./method")(w,q,$,B,le),h("./bind")(w,q,$,le),h("./cancel")(w,ie,B,le),h("./direct_resolve")(w),h("./synchronous_inspection")(w),h("./join")(w,ie,$,q,Le),w.Promise=w,w.version="3.7.2",h("./call_get.js")(w),h("./generators.js")(w,B,q,$,_,le),h("./map.js")(w,ie,B,$,q,le),h("./nodeify.js")(w),h("./promisify.js")(w,q),h("./props.js")(w,ie,$,B),h("./race.js")(w,q,$,B),h("./reduce.js")(w,ie,B,$,q,le),h("./settle.js")(w,ie,le),h("./some.js")(w,ie,B),h("./timers.js")(w,q,le),h("./using.js")(w,B,$,ne,q,le),h("./any.js")(w),h("./each.js")(w,q),h("./filter.js")(w,q),J.toFastProperties(w),J.toFastProperties(w.prototype),M({a:1}),M({b:2}),M({c:3}),M(1),M(function(){}),M(void 0),M(!1),M(new w(q)),le.setBounds(we.firstLineError,J.lastLineError),w}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(h,v,y){v.exports=function(_,b,w,I,A){function F(B){var Q=this._promise=new _(b);B instanceof _&&(Q._propagateFrom(B,3),B.suppressUnhandledRejections()),Q._setOnCancel(this),this._values=B,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var V=h("./util");return V.inherits(F,A),F.prototype.length=function(){return this._length},F.prototype.promise=function(){return this._promise},F.prototype._init=function B(Q,J){var Z=w(this._values,this._promise);if(Z instanceof _){var re=(Z=Z._target())._bitField;if(this._values=Z,0==(50397184&re))return this._promise._setAsyncGuaranteed(),Z._then(B,this._reject,void 0,this,J);if(0==(33554432&re))return 0!=(16777216&re)?this._reject(Z._reason()):this._cancel();Z=Z._value()}if(null!==(Z=V.asArray(Z)))return 0===Z.length?void(-5===J?this._resolveEmptyArray():this._resolve(function M(B){switch(B){case-2:return[];case-3:return{};case-6:return new Map}}(J))):void this._iterate(Z);var se=I("expecting an array or an iterable object but got "+V.classString(Z)).reason();this._promise._rejectCallback(se,!1)},F.prototype._iterate=function(B){var Q=this.getActualLength(B.length);this._length=Q,this._values=this.shouldCopyValues()?new Array(Q):this._values;for(var J=this._promise,Z=!1,re=null,se=0;Q>se;++se){var ce=w(B[se],J);re=ce instanceof _?(ce=ce._target())._bitField:null,Z?null!==re&&ce.suppressUnhandledRejections():null!==re?0==(50397184&re)?(ce._proxy(this,se),this._values[se]=ce):Z=0!=(33554432&re)?this._promiseFulfilled(ce._value(),se):0!=(16777216&re)?this._promiseRejected(ce._reason(),se):this._promiseCancelled(se):Z=this._promiseFulfilled(ce,se)}Z||J._setAsyncGuaranteed()},F.prototype._isResolved=function(){return null===this._values},F.prototype._resolve=function(B){this._values=null,this._promise._fulfill(B)},F.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},F.prototype._reject=function(B){this._values=null,this._promise._rejectCallback(B,!1)},F.prototype._promiseFulfilled=function(B,Q){return this._values[Q]=B,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},F.prototype._promiseCancelled=function(){return this._cancel(),!0},F.prototype._promiseRejected=function(B){return this._totalResolved++,this._reject(B),!0},F.prototype._resultCancelled=function(){if(!this._isResolved()){var B=this._values;if(this._cancel(),B instanceof _)B.cancel();else for(var Q=0;Q<B.length;++Q)B[Q]instanceof _&&B[Q].cancel()}},F.prototype.shouldCopyValues=function(){return!0},F.prototype.getActualLength=function(B){return B},F}},{"./util":36}],24:[function(h,v,y){v.exports=function(_,b){function w(q){return!Le.test(q)}function I(q){try{return!0===q.__isPromisified__}catch(k){return!1}}function A(q,k,N){var $=re.getDataPropertyOrDefault(q,k+N,Me);return!!$&&I($)}function B(q,k,N,$,ie){for(var ee=new RegExp(L(k)+"$"),ne=function F(q,k,N,$){for(var ie=re.inheritedDataKeys(q),ee=[],ne=0;ne<ie.length;++ne){var le=ie[ne],fe=q[le],xe=$===j||j(le,fe,q);"function"!=typeof fe||I(fe)||A(q,le,k)||!$(le,fe,q,xe)||ee.push(le,fe)}return function M(q,k,N){for(var $=0;$<q.length;$+=2){var ie=q[$];if(N.test(ie))for(var ee=ie.replace(N,""),ne=0;ne<q.length;ne+=2)if(q[ne]===ee)throw new Ve("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",k))}}(ee,k,N),ee}(q,k,ee,N),le=0,fe=ne.length;fe>le;le+=2){var xe=ne[le],Pe=ne[le+1],De=xe+k;if($===Y)q[De]=Y(xe,Z,xe,Pe,k,ie);else{var je=$(Pe,function(){return Y(xe,Z,xe,Pe,k,ie)});re.notEnumerableProp(je,"__isPromisified__",!0),q[De]=je}}return re.toFastProperties(q),q}var Z={},re=h("./util"),se=h("./nodeback"),ce=re.withAppended,pe=re.maybeWrapAsError,Ce=re.canEvaluate,Ve=h("./errors").TypeError,Me={__isPromisified__:!0},Le=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),j=function(q){return re.isIdentifier(q)&&"_"!==q.charAt(0)&&"constructor"!==q},L=function(q){return q.replace(/([$])/,"\\$")},Y=Ce?void 0:function V(q,k,N,$,ie,ee){function ne(){var xe=k;k===Z&&(xe=this);var Pe=new _(b);Pe._captureStackTrace();var De="string"==typeof fe&&this!==le?this[fe]:q,je=se(Pe,ee);try{De.apply(xe,ce(arguments,je))}catch(ke){Pe._rejectCallback(pe(ke),!0,!0)}return Pe._isFateSealed()||Pe._setAsyncGuaranteed(),Pe}var le=function(){return this}(),fe=q;return"string"==typeof fe&&(q=$),re.notEnumerableProp(ne,"__isPromisified__",!0),ne};_.promisify=function(q,k){if("function"!=typeof q)throw new Ve("expecting a function but got "+re.classString(q));if(I(q))return q;var ie=function Q(q,k,N){return Y(q,k,void 0,q,null,N)}(q,void 0===(k=Object(k)).context?Z:k.context,!!k.multiArgs);return re.copyDescriptors(q,ie,w),ie},_.promisifyAll=function(q,k){if("function"!=typeof q&&"object"!=typeof q)throw new Ve("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var N=!!(k=Object(k)).multiArgs,$=k.suffix;"string"!=typeof $&&($="Async");var ie=k.filter;"function"!=typeof ie&&(ie=j);var ee=k.promisifier;if("function"!=typeof ee&&(ee=Y),!re.isIdentifier($))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var ne=re.inheritedDataKeys(q),le=0;le<ne.length;++le){var fe=q[ne[le]];"constructor"!==ne[le]&&re.isClass(fe)&&(B(fe.prototype,$,ie,ee,N),B(fe,$,ie,ee,N))}return B(q,$,ie,ee,N)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(h,v,y){v.exports=function(_,b,w,I){function A(re){var se,ce=!1;if(void 0!==F&&re instanceof F)se=J(re),ce=!0;else{var pe=Q.keys(re),Ce=pe.length;se=new Array(2*Ce);for(var Ve=0;Ce>Ve;++Ve){var te=pe[Ve];se[Ve]=re[te],se[Ve+Ce]=te}}this.constructor$(se),this._isMap=ce,this._init$(void 0,ce?-6:-3)}function M(re){var se,ce=w(re);return B(ce)?(se=ce instanceof _?ce._then(_.props,void 0,void 0,void 0,void 0):new A(ce).promise(),ce instanceof _&&se._propagateFrom(ce,2),se):I("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var F,V=h("./util"),B=V.isObject,Q=h("./es5");"function"==typeof Map&&(F=Map);var J=function(){function re(pe,Ce){this[se]=pe,this[se+ce]=Ce,se++}var se=0,ce=0;return function(pe){ce=pe.size,se=0;var Ce=new Array(2*pe.size);return pe.forEach(re,Ce),Ce}}();V.inherits(A,b),A.prototype._init=function(){},A.prototype._promiseFulfilled=function(re,se){if(this._values[se]=re,++this._totalResolved>=this._length){var pe;if(this._isMap)pe=function(re){for(var se=new F,ce=re.length/2|0,pe=0;ce>pe;++pe)se.set(re[ce+pe],re[pe]);return se}(this._values);else{pe={};for(var Ce=this.length(),Ve=0,te=this.length();te>Ve;++Ve)pe[this._values[Ve+Ce]]=this._values[Ve]}return this._resolve(pe),!0}return!1},A.prototype.shouldCopyValues=function(){return!1},A.prototype.getActualLength=function(re){return re>>1},_.prototype.props=function(){return M(this)},_.props=function(re){return M(re)}}},{"./es5":13,"./util":36}],26:[function(h,v,y){function b(w){this._capacity=w,this._length=0,this._front=0}b.prototype._willBeOverCapacity=function(w){return this._capacity<w},b.prototype._pushOne=function(w){var I=this.length();this._checkCapacity(I+1),this[this._front+I&this._capacity-1]=w,this._length=I+1},b.prototype.push=function(w,I,A){var M=this.length()+3;if(this._willBeOverCapacity(M))return this._pushOne(w),this._pushOne(I),void this._pushOne(A);var F=this._front+M-3;this._checkCapacity(M);var V=this._capacity-1;this[F+0&V]=w,this[F+1&V]=I,this[F+2&V]=A,this._length=M},b.prototype.shift=function(){var w=this._front,I=this[w];return this[w]=void 0,this._front=w+1&this._capacity-1,this._length--,I},b.prototype.length=function(){return this._length},b.prototype._checkCapacity=function(w){this._capacity<w&&this._resizeTo(this._capacity<<1)},b.prototype._resizeTo=function(w){var I=this._capacity;this._capacity=w,function _(w,I,A,M,F){for(var V=0;F>V;++V)A[V+M]=w[V+I],w[V+I]=void 0}(this,0,this,I,this._front+this._length&I-1)},v.exports=b},{}],27:[function(h,v,y){v.exports=function(_,b,w,I){function A(V,B){var Q=w(V);if(Q instanceof _)return F(Q);if(null===(V=M.asArray(V)))return I("expecting an array or an iterable object but got "+M.classString(V));var J=new _(b);void 0!==B&&J._propagateFrom(B,3);for(var Z=J._fulfill,re=J._reject,se=0,ce=V.length;ce>se;++se){var pe=V[se];(void 0!==pe||se in V)&&_.cast(pe)._then(Z,re,void 0,J,null)}return J}var M=h("./util"),F=function(V){return V.then(function(B){return A(B,V)})};_.race=function(V){return A(V,void 0)},_.prototype.race=function(){return A(this,void 0)}}},{"./util":36}],28:[function(h,v,y){v.exports=function(_,b,w,I,A,M){function F(se,ce,pe,Ce){this.constructor$(se);var Ve=_._getContext();this._fn=Z.contextBind(Ve,ce),void 0!==pe&&(pe=_.resolve(pe))._attachCancellationCallback(this),this._initialValue=pe,this._currentCancellable=null,this._eachValues=Ce===A?Array(this._length):0===Ce?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function V(se,ce){this.isFulfilled()?ce._resolve(se):ce._reject(se)}function B(se,ce,pe,Ce){return"function"!=typeof ce?w("expecting a function but got "+Z.classString(ce)):new F(se,ce,pe,Ce).promise()}function Q(se){this.accum=se,this.array._gotAccum(se);var ce=I(this.value,this.array._promise);return ce instanceof _?(this.array._currentCancellable=ce,ce._then(J,void 0,void 0,this,void 0)):J.call(this,ce)}function J(se){var Ve,ce=this.array,pe=ce._promise,Ce=re(ce._fn);pe._pushContext(),(Ve=void 0!==ce._eachValues?Ce.call(pe._boundValue(),se,this.index,this.length):Ce.call(pe._boundValue(),this.accum,se,this.index,this.length))instanceof _&&(ce._currentCancellable=Ve);var te=pe._popContext();return M.checkForgottenReturns(Ve,te,void 0!==ce._eachValues?"Promise.each":"Promise.reduce",pe),Ve}var Z=h("./util"),re=Z.tryCatch;Z.inherits(F,b),F.prototype._gotAccum=function(se){null!=this._eachValues&&se!==A&&this._eachValues.push(se)},F.prototype._eachComplete=function(se){return null!==this._eachValues&&this._eachValues.push(se),this._eachValues},F.prototype._init=function(){},F.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},F.prototype.shouldCopyValues=function(){return!1},F.prototype._resolve=function(se){this._promise._resolveCallback(se),this._values=null},F.prototype._resultCancelled=function(se){return se===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof _&&this._currentCancellable.cancel(),this._initialValue instanceof _&&this._initialValue.cancel()))},F.prototype._iterate=function(se){this._values=se;var ce,pe,Ce=se.length;void 0!==this._initialValue?(ce=this._initialValue,pe=0):(ce=_.resolve(se[0]),pe=1),this._currentCancellable=ce;for(var Ve=pe;Ce>Ve;++Ve){var te=se[Ve];te instanceof _&&te.suppressUnhandledRejections()}if(!ce.isRejected())for(;Ce>pe;++pe)ce=ce._then(Q,void 0,void 0,{accum:null,value:se[pe],index:pe,length:Ce,array:this},void 0),0==(127&pe)&&ce._setNoAsyncGuarantee();void 0!==this._eachValues&&(ce=ce._then(this._eachComplete,void 0,void 0,this,void 0)),ce._then(V,V,void 0,ce,this)},_.prototype.reduce=function(se,ce){return B(this,se,ce,null)},_.reduce=function(se,ce,pe,Ce){return B(se,ce,pe,Ce)}}},{"./util":36}],29:[function(h,v,y){var _,V,B,Q,J,b=h("./util"),I=b.getNativePromise();if(b.isNode&&"undefined"==typeof MutationObserver){var A=global.setImmediate,M=process.nextTick;_=b.isRecentNode?function(V){A.call(global,V)}:function(V){M.call(process,V)}}else if("function"==typeof I&&"function"==typeof I.resolve){var F=I.resolve();_=function(V){F.then(V)}}else _="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)||!("classList"in document.documentElement)?"undefined"!=typeof setImmediate?function(V){setImmediate(V)}:"undefined"!=typeof setTimeout?function(V){setTimeout(V,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(V=document.createElement("div"),B={attributes:!0},Q=!1,J=document.createElement("div"),new MutationObserver(function(){V.classList.toggle("foo"),Q=!1}).observe(J,B),function(se){var ce=new MutationObserver(function(){ce.disconnect(),se()});ce.observe(V,B),Q||(Q=!0,J.classList.toggle("foo"))});v.exports=_},{"./util":36}],30:[function(h,v,y){v.exports=function(_,b,w){function I(F){this.constructor$(F)}var A=_.PromiseInspection;h("./util").inherits(I,b),I.prototype._promiseResolved=function(F,V){return this._values[F]=V,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},I.prototype._promiseFulfilled=function(F,V){var B=new A;return B._bitField=33554432,B._settledValueField=F,this._promiseResolved(V,B)},I.prototype._promiseRejected=function(F,V){var B=new A;return B._bitField=16777216,B._settledValueField=F,this._promiseResolved(V,B)},_.settle=function(F){return w.deprecated(".settle()",".reflect()"),new I(F).promise()},_.allSettled=function(F){return new I(F).promise()},_.prototype.settle=function(){return _.settle(this)}}},{"./util":36}],31:[function(h,v,y){v.exports=function(_,b,w){function I(J){this.constructor$(J),this._howMany=0,this._unwrap=!1,this._initialized=!1}function A(J,Z){if((0|Z)!==Z||0>Z)return w("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var re=new I(J),se=re.promise();return re.setHowMany(Z),re.init(),se}var M=h("./util"),F=h("./errors").RangeError,V=h("./errors").AggregateError,B=M.isArray,Q={};M.inherits(I,b),I.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var J=B(this._values);!this._isResolved()&&J&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},I.prototype.init=function(){this._initialized=!0,this._init()},I.prototype.setUnwrap=function(){this._unwrap=!0},I.prototype.howMany=function(){return this._howMany},I.prototype.setHowMany=function(J){this._howMany=J},I.prototype._promiseFulfilled=function(J){return this._addFulfilled(J),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},I.prototype._promiseRejected=function(J){return this._addRejected(J),this._checkOutcome()},I.prototype._promiseCancelled=function(){return this._values instanceof _||null==this._values?this._cancel():(this._addRejected(Q),this._checkOutcome())},I.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var J=new V,Z=this.length();Z<this._values.length;++Z)this._values[Z]!==Q&&J.push(this._values[Z]);return J.length>0?this._reject(J):this._cancel(),!0}return!1},I.prototype._fulfilled=function(){return this._totalResolved},I.prototype._rejected=function(){return this._values.length-this.length()},I.prototype._addRejected=function(J){this._values.push(J)},I.prototype._addFulfilled=function(J){this._values[this._totalResolved++]=J},I.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},I.prototype._getRangeError=function(J){return new F("Input array must contain at least "+this._howMany+" items but contains only "+J+" items")},I.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},_.some=function(J,Z){return A(J,Z)},_.prototype.some=function(J){return A(this,J)},_._SomePromiseArray=I}},{"./errors":12,"./util":36}],32:[function(h,v,y){v.exports=function(_){function b(B){void 0!==B?(B=B._target(),this._bitField=B._bitField,this._settledValueField=B._isFateSealed()?B._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}b.prototype._settledValue=function(){return this._settledValueField};var w=b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},I=b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},A=b.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},M=b.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},F=b.prototype.isPending=function(){return 0==(50397184&this._bitField)},V=b.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};b.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},_.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},_.prototype._isCancelled=function(){return this._target().__isCancelled()},_.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},_.prototype.isPending=function(){return F.call(this._target())},_.prototype.isRejected=function(){return M.call(this._target())},_.prototype.isFulfilled=function(){return A.call(this._target())},_.prototype.isResolved=function(){return V.call(this._target())},_.prototype.value=function(){return w.call(this._target())},_.prototype.reason=function(){var B=this._target();return B._unsetRejectionIsUnhandled(),I.call(B)},_.prototype._value=function(){return this._settledValue()},_.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},_.PromiseInspection=b}},{}],33:[function(h,v,y){v.exports=function(_,b){var V=h("./util"),B=V.errorObj,Q=V.isObject,J={}.hasOwnProperty;return function w(Z,re){if(Q(Z)){if(Z instanceof _)return Z;var se=function A(Z){try{return function I(Z){return Z.then}(Z)}catch(re){return B.e=re,B}}(Z);if(se===B){re&&re._pushContext();var ce=_.reject(se.e);return re&&re._popContext(),ce}if("function"==typeof se)return function M(Z){try{return J.call(Z,"_promise0")}catch(re){return!1}}(Z)?(ce=new _(b),Z._then(ce._fulfill,ce._reject,void 0,ce,null),ce):function F(Z,re,se){var Ce=new _(b),Ve=Ce;se&&se._pushContext(),Ce._captureStackTrace(),se&&se._popContext();var te=!0,Me=V.tryCatch(re).call(Z,function ce(we){Ce&&(Ce._resolveCallback(we),Ce=null)},function pe(we){Ce&&(Ce._rejectCallback(we,te,!0),Ce=null)});return te=!1,Ce&&Me===B&&(Ce._rejectCallback(Me.e,!0,!0),Ce=null),Ve}(Z,se,re)}return Z}}},{"./util":36}],34:[function(h,v,y){v.exports=function(_,b,w){function I(Z){this.handle=Z}function A(Z){return clearTimeout(this.handle),Z}function M(Z){throw clearTimeout(this.handle),Z}var F=h("./util"),V=_.TimeoutError;I.prototype._resultCancelled=function(){clearTimeout(this.handle)};var B=function(Z){return Q(+this).thenReturn(Z)},Q=_.delay=function(Z,re){var se,ce;return void 0!==re?(se=_.resolve(re)._then(B,null,null,Z,void 0),w.cancellation()&&re instanceof _&&se._setOnCancel(re)):(se=new _(b),ce=setTimeout(function(){se._fulfill()},+Z),w.cancellation()&&se._setOnCancel(new I(ce)),se._captureStackTrace()),se._setAsyncGuaranteed(),se};_.prototype.delay=function(Z){return Q(Z,this)},_.prototype.timeout=function(Z,re){Z=+Z;var se,ce,pe=new I(setTimeout(function(){se.isPending()&&function(Z,re,se){var ce;ce="string"!=typeof re?re instanceof Error?re:new V("operation timed out"):new V(re),F.markAsOriginatingFromRejection(ce),Z._attachExtraTrace(ce),Z._reject(ce),null!=se&&se.cancel()}(se,re,ce)},Z));return w.cancellation()?(ce=this.then(),(se=ce._then(A,M,void 0,pe,void 0))._setOnCancel(pe)):se=this._then(A,M,void 0,pe,void 0),se}}},{"./util":36}],35:[function(h,v,y){v.exports=function(_,b,w,I,A,M){function F(Me){setTimeout(function(){throw Me},0)}function B(Me,we){var j=0,L=Me.length,Y=new _(A);return function Le(){if(j>=L)return Y._fulfill();var q=function V(Me){var we=w(Me);return we!==Me&&"function"==typeof Me._isDisposable&&"function"==typeof Me._getDisposer&&Me._isDisposable()&&we._setDisposable(Me._getDisposer()),we}(Me[j++]);if(q instanceof _&&q._isDisposable()){try{q=w(q._getDisposer().tryDispose(we),Me.promise)}catch(k){return F(k)}if(q instanceof _)return q._then(Le,F,null,null,null)}Le()}(),Y}function Q(Me,we,Le){this._data=Me,this._promise=we,this._context=Le}function J(Me,we,Le){this.constructor$(Me,we,Le)}function Z(Me){return Q.isDisposer(Me)?(this.resources[this.index]._setDisposable(Me),Me.promise()):Me}function re(Me){this.length=Me,this.promise=null,this[Me-1]=null}var se=h("./util"),ce=h("./errors").TypeError,pe=h("./util").inherits,Ce=se.errorObj,Ve=se.tryCatch,te={};Q.prototype.data=function(){return this._data},Q.prototype.promise=function(){return this._promise},Q.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():te},Q.prototype.tryDispose=function(Me){var we=this.resource(),Le=this._context;void 0!==Le&&Le._pushContext();var j=we!==te?this.doDispose(we,Me):null;return void 0!==Le&&Le._popContext(),this._promise._unsetDisposable(),this._data=null,j},Q.isDisposer=function(Me){return null!=Me&&"function"==typeof Me.resource&&"function"==typeof Me.tryDispose},pe(J,Q),J.prototype.doDispose=function(Me,we){return this.data().call(Me,Me,we)},re.prototype._resultCancelled=function(){for(var Me=this.length,we=0;Me>we;++we){var Le=this[we];Le instanceof _&&Le.cancel()}},_.using=function(){var Me=arguments.length;if(2>Me)return b("you must pass at least 2 arguments to Promise.using");var we=arguments[Me-1];if("function"!=typeof we)return b("expecting a function but got "+se.classString(we));var Le,j=!0;2===Me&&Array.isArray(arguments[0])?(Me=(Le=arguments[0]).length,j=!1):(Le=arguments,Me--);for(var L=new re(Me),Y=0;Me>Y;++Y){var q=Le[Y];if(Q.isDisposer(q)){var k=q;(q=q.promise())._setDisposable(k)}else{var N=w(q);N instanceof _&&(q=N._then(Z,null,null,{resources:L,index:Y},void 0))}L[Y]=q}var $=new Array(L.length);for(Y=0;Y<$.length;++Y)$[Y]=_.resolve(L[Y]).reflect();var ie=_.all($).then(function(ne){for(var le=0;le<ne.length;++le){var fe=ne[le];if(fe.isRejected())return Ce.e=fe.error(),Ce;if(!fe.isFulfilled())return void ie.cancel();ne[le]=fe.value()}ee._pushContext(),we=Ve(we);var xe=j?we.apply(void 0,ne):we(ne),Pe=ee._popContext();return M.checkForgottenReturns(xe,Pe,"Promise.using",ee),xe}),ee=ie.lastly(function(){var ne=new _.PromiseInspection(ie);return B(L,ne)});return L.promise=ee,ee._setOnCancel(L),ee},_.prototype._setDisposable=function(Me){this._bitField=131072|this._bitField,this._disposer=Me},_.prototype._isDisposable=function(){return(131072&this._bitField)>0},_.prototype._getDisposer=function(){return this._disposer},_.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},_.prototype.disposer=function(Me){if("function"==typeof Me)return new J(Me,this,I());throw new ce}}},{"./errors":12,"./util":36}],36:[function(h,v,y){function _(){try{var Ae=k;return k=null,Ae.apply(this,arguments)}catch(he){return q.e=he,q}}function w(Ae){return null==Ae||!0===Ae||!1===Ae||"string"==typeof Ae||"number"==typeof Ae}function V(Ae,he,tt){return w(Ae)||L.defineProperty(Ae,he,{value:tt,configurable:!0,enumerable:!1,writable:!0}),Ae}function se(Ae){try{return Ae+""}catch(he){return"[no string representation]"}}function ce(Ae){return Ae instanceof Error||null!==Ae&&"object"==typeof Ae&&"string"==typeof Ae.message&&"string"==typeof Ae.name}function Ve(Ae){return ce(Ae)&&L.propertyIsWritable(Ae,"stack")}function te(Ae){return{}.toString.call(Ae)}var k,L=h("./es5"),Y="undefined"==typeof navigator,q={e:{}},N="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,ie=function(){var Ae=[Array.prototype,Object.prototype,Function.prototype],he=function(nt){for(var et=0;et<Ae.length;++et)if(Ae[et]===nt)return!0;return!1};if(L.isES5){var tt=Object.getOwnPropertyNames;return function(nt){for(var et=[],Qe=Object.create(null);null!=nt&&!he(nt);){var at;try{at=tt(nt)}catch(it){return et}for(var vt=0;vt<at.length;++vt){var dt=at[vt];if(!Qe[dt]){Qe[dt]=!0;var Je=Object.getOwnPropertyDescriptor(nt,dt);null!=Je&&null==Je.get&&null==Je.set&&et.push(dt)}}nt=L.getPrototypeOf(nt)}return et}}var Ze={}.hasOwnProperty;return function(nt){if(he(nt))return[];var et=[];e:for(var Qe in nt)if(Ze.call(nt,Qe))et.push(Qe);else{for(var at=0;at<Ae.length;++at)if(Ze.call(Ae[at],Qe))continue e;et.push(Qe)}return et}}(),ee=/this\s*\.\s*\S+\s*=/,ne=/^[a-z$_][a-z$_0-9]*$/i,le="stack"in new Error?function(Ae){return Ve(Ae)?Ae:new Error(se(Ae))}:function(Ae){if(Ve(Ae))return Ae;try{throw new Error(se(Ae))}catch(he){return he}},fe=function(Ae){return L.isArray(Ae)?Ae:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var xe="function"==typeof Array.from?function(Ae){return Array.from(Ae)}:function(Ae){for(var he,tt=[],Ze=Ae[Symbol.iterator]();!(he=Ze.next()).done;)tt.push(he.value);return tt};fe=function(Ae){return L.isArray(Ae)?Ae:null!=Ae&&"function"==typeof Ae[Symbol.iterator]?xe(Ae):null}}var je,Ae,Pe="undefined"!=typeof process&&"[object process]"===te(process).toLowerCase(),De="undefined"!=typeof process&&void 0!==process.env,ke={setReflectHandler:function(Ae){je=Ae},isClass:function Q(Ae){try{if("function"==typeof Ae){var he=L.names(Ae.prototype),tt=L.isES5&&he.length>1,Ze=he.length>0&&!(1===he.length&&"constructor"===he[0]),nt=ee.test(Ae+"")&&L.names(Ae).length>0;if(tt||Ze||nt)return!0}return!1}catch(et){return!1}},isIdentifier:function Z(Ae){return ne.test(Ae)},inheritedDataKeys:ie,getDataPropertyOrDefault:function F(Ae,he,tt){if(!L.isES5)return{}.hasOwnProperty.call(Ae,he)?Ae[he]:void 0;var Ze=Object.getOwnPropertyDescriptor(Ae,he);return null!=Ze?null==Ze.get&&null==Ze.set?Ze.value:tt:void 0},thrower:function B(Ae){throw Ae},isArray:L.isArray,asArray:fe,notEnumerableProp:V,isPrimitive:w,isObject:function I(Ae){return"function"==typeof Ae||"object"==typeof Ae&&null!==Ae},isError:ce,canEvaluate:Y,errorObj:q,tryCatch:function b(Ae){return k=Ae,_},inherits:function(Ae,he){function tt(){for(var nt in this.constructor=Ae,this.constructor$=he,he.prototype)Ze.call(he.prototype,nt)&&"$"!==nt.charAt(nt.length-1)&&(this[nt+"$"]=he.prototype[nt])}var Ze={}.hasOwnProperty;return tt.prototype=he.prototype,Ae.prototype=new tt,Ae.prototype},withAppended:function M(Ae,he){var tt,Ze=Ae.length,nt=new Array(Ze+1);for(tt=0;Ze>tt;++tt)nt[tt]=Ae[tt];return nt[tt]=he,nt},maybeWrapAsError:function A(Ae){return w(Ae)?new Error(se(Ae)):Ae},toFastProperties:function J(Ae){function he(){}function tt(){return typeof Ze.foo}he.prototype=Ae;var Ze=new he;return tt(),tt(),Ae},filledRange:function re(Ae,he,tt){for(var Ze=new Array(Ae),nt=0;Ae>nt;++nt)Ze[nt]=he+nt+tt;return Ze},toString:se,canAttachTrace:Ve,ensureErrorObject:le,originatesFromRejection:function Ce(Ae){return null!=Ae&&(Ae instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===Ae.isOperational)},markAsOriginatingFromRejection:function pe(Ae){try{V(Ae,"isOperational",!0)}catch(he){}},classString:te,copyDescriptors:function Me(Ae,he,tt){for(var Ze=L.names(Ae),nt=0;nt<Ze.length;++nt){var et=Ze[nt];if(tt(et))try{L.defineProperty(he,et,L.getDescriptor(Ae,et))}catch(Qe){}}},isNode:Pe,hasEnvVariables:De,env:function we(Ae){return De?process.env[Ae]:void 0},global:N,getNativePromise:function Le(){if("function"==typeof Promise)try{if("[object Promise]"===te(new Promise(function(){})))return Promise}catch(he){}},contextBind:function j(Ae,he){if(null===Ae||"function"!=typeof he||he===je)return he;null!==Ae.domain&&(he=Ae.domain.bind(he));var tt=Ae.async;if(null!==tt){var Ze=he;he=function(){var nt=new Array(2).concat([].slice.call(arguments));return nt[0]=Ze,nt[1]=this,tt.runInAsyncScope.apply(tt,nt)}}return he}};ke.isRecentNode=ke.isNode&&(process.versions&&process.versions.node?Ae=process.versions.node.split(".").map(Number):process.version&&(Ae=process.version.split(".").map(Number)),0===Ae[0]&&Ae[1]>10||Ae[0]>0),ke.nodeSupportsAsyncResource=ke.isNode&&function(){var Ae=!1;try{Ae="function"==typeof h("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(tt){Ae=!1}return Ae}(),ke.isNode&&ke.toFastProperties(process);try{throw new Error}catch(Ae){ke.lastLineError=Ae}v.exports=ke},{"./es5":13,async_hooks:void 0}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)),Ee.DWT.bNpm=!0,Ee.DWT.dbrCanvasMaxWH=4096,Ee.aryAddonReadyFun=[],Ee.AddonReady=function(p){Ee.aryAddonReadyFun.push(p)},(Ee=self.Dynamsoft||{}).DWT=Ee.DWT||{},Ee.DBR=Ee.DBR||{},Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},function(){Ee.BarcodeReaderAddon=Ee.BarcodeReaderAddon||{};var p=Ee.BarcodeReaderAddon;p.Version="9.6.1.0312",p._decoding=!1,p._decodeQueue=[],p._decodeNext=function(){var n,o;0==p._decodeQueue.length?p._decoding=!1:(n=(o=p._decodeQueue[0]).method,o=o.args,p._decodeQueue.splice(0,1),n.apply(null,o))},p._defaultRuntimeSettingsStr="",p._defaultTemplateStr="",p._activeXInstance=!1,p.BarcodeReaderException=function(){var o,n=Ee.DBR.EnumErrorCode.DBR_UNKNOWN;return(o="number"==typeof(o=arguments[0])?(n=o,new Error(arguments[1])):new Error(o)).code=n,o},p.RemoveNonPrintableChar=function(n){return Ee.Lib.isString(n)?n.replace(/[^\x20-\x7E]|(\\")/g,""):n},p.errors={webcamNotInstalled:"The Webcam add-on not installed.",nonServiceNotSupportWebcamDecode:"The BarcodeReader add-on does not support reading barcodes from video streams.",decodeResultEmpty:"decode result is empty.",ServiceEditionNotSupportDbr:"The BarcodeReader add-on does not support your Operating System.",ServiceEditionNotSupportWasmMode:"You cannot call this method on this WebTwain instance."},p._activeXMaxIEVersion=9,p.logLevel=3,Ee.DBR.EnumAccompanyingTextRecognitionMode={ATRM_GENERAL:1,ATRM_SKIP:0},Ee.DBR.EnumBarcodeColourMode={BICM_DARK_ON_LIGHT:1,BICM_LIGHT_ON_DARK:2,BICM_DARK_ON_DARK:4,BICM_LIGHT_ON_LIGHT:8,BICM_DARK_LIGHT_MIXED:16,BICM_DARK_ON_LIGHT_DARK_SURROUNDING:32,BICM_SKIP:0},Ee.DBR.EnumBarcodeComplementMode={BCM_AUTO:1,BCM_GENERAL:2,BCM_SKIP:0},Ee.DBR.EnumBarcodeFormat={BF_ALL:-32505857,BF_ONED:2047,BF_GS1_DATABAR:260096,BF_CODE_39:1,BF_CODE_128:2,BF_CODE_93:4,BF_CODABAR:8,BF_ITF:16,BF_EAN_13:32,BF_EAN_8:64,BF_UPC_A:128,BF_UPC_E:256,BF_INDUSTRIAL_25:512,BF_CODE_39_EXTENDED:1024,BF_GS1_DATABAR_OMNIDIRECTIONAL:2048,BF_GS1_DATABAR_TRUNCATED:4096,BF_GS1_DATABAR_STACKED:8192,BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:16384,BF_GS1_DATABAR_EXPANDED:32768,BF_GS1_DATABAR_EXPANDED_STACKED:65536,BF_GS1_DATABAR_LIMITED:131072,BF_PATCHCODE:262144,BF_PDF417:33554432,BF_QR_CODE:67108864,BF_DATAMATRIX:134217728,BF_AZTEC:268435456,BF_MAXICODE:536870912,BF_MICRO_QR:1073741824,BF_MICRO_PDF417:524288,BF_GS1_COMPOSITE:-2147483648,BF_NULL:0},Ee.DBR.EnumBarcodeFormat_2={BF2_NULL:0,BF2_POSTALCODE:32505856,BF2_NONSTANDARD_BARCODE:1,BF2_USPSINTELLIGENTMAIL:1048576,BF2_POSTNET:2097152,BF2_PLANET:4194304,BF2_AUSTRALIANPOST:8388608,BF2_RM4SCC:16777216,BF2_DOTCODE:2},Ee.DBR.EnumBinarizationMode={BM_AUTO:1,BM_LOCAL_BLOCK:2,BM_SKIP:0},Ee.DBR.EnumClarityCalculationMethod={ECCM_CONTRAST:1},Ee.DBR.EnumClarityFilterMode={CFM_GENERAL:1},Ee.DBR.EnumColourClusteringMode={CCM_AUTO:1,CCM_GENERAL_HSV:2,CCM_SKIP:0},Ee.DBR.EnumColourConversionMode={CICM_GENERAL:1,CICM_SKIP:0},Ee.DBR.EnumConflictMode={CM_IGNORE:1,CM_OVERWRITE:2},Ee.DBR.EnumDeformationResistingMode={DRM_AUTO:1,DRM_GENERAL:2,DRM_SKIP:0},Ee.DBR.EnumDPMCodeReadingMode={DPMCRM_AUTO:1,DPMCRM_GENERAL:2,DPMCRM_SKIP:0},Ee.DBR.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1e4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_AZTEC_LICENSE_INVALID:-10041,DBR_LICENSE_DLL_MISSING:-10042,DBR_LICENSEKEY_NOT_MATCHED:-10043,DBR_REQUESTED_FAILED:-10044,DBR_LICENSE_INIT_FAILED:-10045,DBR_PATCHCODE_LICENSE_INVALID:-10046,DBR_POSTALCODE_LICENSE_INVALID:-10047,DBR_DPM_LICENSE_INVALID:-10048,DBR_FRAME_DECODING_THREAD_EXISTS:-10049,DBR_STOP_DECODING_THREAD_FAILED:-10050,DBR_SET_MODE_ARGUMENT_ERROR:-10051,DBR_LICENSE_CONTENT_INVALID:-10052,DBR_LICENSE_KEY_INVALID:-10053,DBR_LICENSE_DEVICE_RUNS_OUT:-10054,DBR_GET_MODE_ARGUMENT_ERROR:-10055,DBR_IRT_LICENSE_INVALID:-10056,DBR_MAXICODE_LICENSE_INVALID:-10057,DBR_GS1_DATABAR_LICENSE_INVALID:-10058,DBR_GS1_COMPOSITE_LICENSE_INVALID:-10059,DBR_DOTCODE_LICENSE_INVALID:-10061,DMERR_FAILED_TO_REACH_LTS:-20200},Ee.DBR.EnumGrayscaleTransformationMode={GTM_INVERTED:1,GTM_ORIGINAL:2,GTM_SKIP:0},Ee.DBR.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9,IPF_ABGR_8888:10,IPF_ABGR_16161616:11,IPF_BGR_888:12},Ee.DBR.EnumImagePreprocessingMode={IPM_AUTO:1,IPM_GENERAL:2,IPM_GRAY_EQUALIZE:4,IPM_GRAY_SMOOTH:8,IPM_SHARPEN_SMOOTH:16,IPM_MORPHOLOGY:32,IPM_SKIP:0},Ee.DBR.EnumIMResultDataType={IMRDT_IMAGE:1,IMRDT_CONTOUR:2,IMRDT_LINESEGMENT:4,IMRDT_LOCALIZATIONRESULT:8,IMRDT_REGIONOFINTEREST:16,IMRDT_QUADRILATERAL:32},Ee.DBR.EnumIntermediateResultSavingMode={IRSM_MEMORY:1,IRSM_FILESYSTEM:2,IRSM_BOTH:4},Ee.DBR.EnumIntermediateResultType={IRT_NO_RESULT:0,IRT_ORIGINAL_IMAGE:1,IRT_COLOUR_CLUSTERED_IMAGE:2,IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE:4,IRT_TRANSFORMED_GRAYSCALE_IMAGE:8,IRT_PREDETECTED_REGION:16,IRT_PREPROCESSED_IMAGE:32,IRT_BINARIZED_IMAGE:64,IRT_TEXT_ZONE:128,IRT_CONTOUR:256,IRT_LINE_SEGMENT:512,IRT_FORM:1024,IRT_SEGMENTATION_BLOCK:2048,IRT_TYPED_BARCODE_ZONE:4096,IRT_PREDETECTED_QUADRILATERAL:8192},Ee.DBR.EnumLocalizationMode={LM_SKIP:0,LM_AUTO:1,LM_CONNECTED_BLOCKS:2,LM_LINES:8,LM_STATISTICS:4,LM_SCAN_DIRECTLY:16,LM_STATISTICS_MARKS:32,LM_STATISTICS_POSTAL_CODE:64},Ee.DBR.EnumPDFReadingMode={PDFRM_RASTER:1,PDFRM_AUTO:2,PDFRM_VECTOR:4},Ee.DBR.EnumQRCodeErrorCorrectionLevel={QRECL_ERROR_CORRECTION_H:0,QRECL_ERROR_CORRECTION_L:1,QRECL_ERROR_CORRECTION_M:2,QRECL_ERROR_CORRECTION_Q:3},Ee.DBR.EnumRegionPredetectionMode={RPM_AUTO:1,RPM_GENERAL:2,RPM_GENERAL_RGB_CONTRAST:4,RPM_GENERAL_GRAY_CONTRAST:8,RPM_GENERAL_HSV_CONTRAST:16,RPM_SKIP:0},Ee.DBR.EnumResultCoordinateType={RCT_PIXEL:1,RCT_PERCENTAGE:2},Ee.DBR.EnumResultType={RT_STANDARD_TEXT:0,RT_RAW_TEXT:1,RT_CANDIDATE_TEXT:2,RT_PARTIAL_TEXT:3},Ee.DBR.EnumScaleUpMode={SUM_AUTO:1,SUM_LINEAR_INTERPOLATION:2,SUM_NEAREST_NEIGHBOUR_INTERPOLATION:4,SUM_SKIP:0},Ee.DBR.EnumTerminatePhase={TP_REGION_PREDETECTED:1,TP_IMAGE_PREPROCESSED:2,TP_IMAGE_BINARIZED:4,TP_BARCODE_LOCALIZED:8,TP_BARCODE_TYPE_DETERMINED:16,TP_BARCODE_RECOGNIZED:32},Ee.DBR.EnumTextAssistedCorrectionMode={TACM_AUTO:1,TACM_VERIFYING:2,TACM_VERIFYING_PATCHING:4,TACM_SKIP:0},Ee.DBR.EnumTextFilterMode={TFM_AUTO:1,TFM_GENERAL_CONTOUR:2,TFM_SKIP:0},Ee.DBR.EnumTextResultOrderMode={TROM_CONFIDENCE:1,TROM_POSITION:2,TROM_FORMAT:4,TROM_SKIP:0},Ee.DBR.EnumTextureDetectionMode={TDM_AUTO:1,TDM_GENERAL_WIDTH_CONCENTRATION:2,TDM_SKIP:0}}(),Ee.AddonReady(function(p,n){var o,h=Ee.BarcodeReaderAddon;function v(y){return y&&y instanceof ArrayBuffer}h.Class=function(){function y(b){this._runtimeSettings=null,this._initSettingsContent=null,this._tplContentArr=[],this._stwain=b}var _;return y.prototype._decodeBlob=function(b,w){var I=this;return new p.Promise(function(A){if(!(b instanceof Blob))throw TypeError("'_decodeBlob(blob, templateName)': Type of 'blob' should be 'Blob'.");A()}).then(function(){return I._innerDecode(0,b,w)})},y.prototype._decodeArrayBuffer=function(b,w){var I=this;return new p.Promise(function(A){if(!(b instanceof ArrayBuffer))throw TypeError("'_decodeBlob(arrayBuffer, templateName)': Type of 'arrayBuffer' should be 'ArrayBuffer'.");A()}).then(function(){return I._innerDecode(0,b,w)})},y.prototype._decodeUint8Array=function(b,w){var I=this;return new p.Promise(function(A){if(!(b instanceof Uint8Array||self.Uint8ClampedArray&&b instanceof Uint8ClampedArray))throw TypeError("'_decodeBlob(uint8Array, templateName)': Type of 'uint8Array' should be 'Uint8Array'.");A()}).then(function(){return I._innerDecode(0,b,w)})},y.prototype._decodeImage=function(b,w){var I=this;return new p.Promise(function(A){if(!(b instanceof HTMLImageElement))throw TypeError("'_decodeImage(image, templateName)': Type of 'image' should be 'HTMLImageElement'.");if(b.crossOrigin&&"anonymous"!=b.crossOrigin)throw"cors";w=w||"",A()}).then(function(){return"data:image/"==b.src.substring(0,11)?I._decodeBase64(b.src,w):I._decodeUrl(b.src,w).catch(function(A){return 3<=h.logLevel&&console&&console.warn&&(console.warn("'_decodeImage(image, templateName)': Image src not available. Use '_decodeCanvas' instead."),console.warn(A)),self.HTMLCanvasElement?((A=document.createElement("canvas")).width=b.naturalWidth,A.height=b.naturalHeight,A.getContext("2d").drawImage(b,0,0),I._decodeCanvas(A,w)):p.Promise.reject(Error("'_decodeImage(image, templateName)': Browser not support HTMLCanvasElement."))})})},y.prototype._decodeCanvas=function(b,w){var I=this;return new p.Promise(function(A){if(!(b instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, templateName)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(b.crossOrigin&&"anonymous"!=b.crossOrigin)throw"cors";w=w||"",b.toBlob?b.toBlob(function(M){A(M)}):b.msToBlob?b.msToBlob(function(M){A(M)}):A(b.toDataURL())}).then(function(A){return b.toBlob||b.msToBlob?I._decodeBlob(A,w):I._decodeBase64(A,w)})},y.prototype._decodeVideo=function(b){var w,I=this,A=arguments;return new p.Promise(function(M){if(!(b instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [ [, sx, sy, sWidth, sHeight], dWidth, dHeight] [, templateName] )': Type of 'video' should be 'HTMLVideoElement'.");if(b.crossOrigin&&"anonymous"!=b.crossOrigin)throw"cors";A.length<=2?(F=V=0,B=J=b.videoWidth,Q=Z=b.videoHeight):Z=A.length<=4?(F=V=0,B=b.videoWidth,Q=b.videoHeight,J=A[1],A[2]):(F=A[1],V=A[2],B=A[3],Q=A[4],J=A[5],A[6]),w="string"==typeof A[A.length-1]?A[A.length-1]:"";var F,V,B,Q,J,Z,re=document.createElement("canvas");re.width=J,re.height=Z,re.getContext("2d").drawImage(b,F,V,B,Q,0,0,J,Z),M(re)}).then(function(M){return I._decodeCanvas(M,w)})},y.prototype._decodeBase64=y.prototype.decodeBase64String=function(b,w){var I=this;return new p.Promise(function(A){if(!("string"==typeof b||"object"==typeof b&&b instanceof String))throw TypeError("'decodeBase64(base64Str, templateName)': Type of 'base64Str' should be 'String'.");"data:image/"==b.substring(0,11)&&(b=b.substring(b.indexOf(",")+1)),A()}).then(function(){return I._innerDecode(1,b,w)})},y.prototype._decodeUrl=function(b,w){var I=this;return b&&b.indexOf&&(0==b.indexOf("dwt://")||0==b.indexOf("dcs://"))?I._decodeDynamsoftServiceInnerUrl(b,w):new p.Promise(function(A,M){var F;if(!("string"==typeof b||"object"==typeof b&&b instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'url' should be 'String'.");w=w||"",h._activeXInstance?((F=new ActiveXObject("MSXML2.XMLHTTP")).open("GET",b,!0),F.overrideMimeType?F.overrideMimeType("text/plain; charset=x-user-defined"):F.setRequestHeader("Accept-Charset","x-user-defined"),F.onreadystatechange=function(){4==F.readyState&&A(new VBArray(F.responseBody).toArray())},F.send("")):((F=new XMLHttpRequest).open("GET",b,!0),F.responseType="arraybuffer",F.send(),F.onloadend=function(){A(this.response)},F.onerror=function(){M(Error(F.error))})}).then(function(A){return h._activeXInstance?I._activeXDecodeArray(A,w):I._decodeArrayBuffer(A,w)})},y.prototype._decodeDynamsoftServiceInnerUrl=function(b,w){var I=this;return new p.Promise(function(A){if(!("string"==typeof b||"object"==typeof b&&b instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'innerUrl' should be 'String'.");if(0!=b.indexOf("dwt://")&&0!=b.indexOf("dcs://"))throw TypeError("'_decodeDynamsoftServiceInnerUrl(innerUrl, templateName)': 'innerUrl' should start with 'dwt://' or 'dcs://'.");A()}).then(function(){return I._innerDecode(4e3,b,w)})},y.prototype._activeXDecodeArray=function(b,w){var I=this;return new p.Promise(function(A,M){if(!(b instanceof Array))throw TypeError("'_activeXDecodeArray(array, templateName)': Type of 'array' should be 'Array'.");w=w||"";try{A(Ee.Lib.btoa(String.fromCharCode.apply(String,b)))}catch(F){M(F)}}).then(function(A){return I._decodeBase64(A,w)})},y.prototype._activeXDecodeHandle=function(b,w){var I=this;return new p.Promise(function(A){w=w||"",A()}).then(function(){return I._innerDecode(4001,b,w)})},y.prototype._decode=y.prototype.decode=function(b,w){return h._activeXInstance?"string"==typeof b||b instanceof String?this._activeXDecodeHandle(b,w):p.Promise.reject(TypeError("'_decode(source, templateName)' in activeX: Type of 'source' should be 'String(partUrl)'.")):self.Blob&&b instanceof Blob?this._decodeBlob(b,w):self.ArrayBuffer&&b instanceof ArrayBuffer?this._decodeArrayBuffer(b,w):self.Uint8Array&&b instanceof Uint8Array||self.Uint8ClampedArray&&b instanceof Uint8ClampedArray?this._decodeUint8Array(b,w):b instanceof Array?this._activeXDecodeArray(b,w):self.HTMLImageElement&&b instanceof HTMLImageElement?this._decodeImage(b,w):self.HTMLCanvasElement&&b instanceof HTMLCanvasElement?this._decodeCanvas(b,w):self.HTMLVideoElement&&b instanceof HTMLVideoElement?this._decodeVideo(b,w):isNaN(b)?"string"==typeof b||b instanceof String?"data:image/"==b.substring(0,11)?this._decodeBase64(b,w):this._decodeUrl(b,w):p.Promise.reject(TypeError("'_decode(source, templateName)' in H5: Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'.")):this._activeXDecodeHandle(b,w)},y.prototype._innerServiceCmd=function(b,w){var I=this._stwain;return new p.Promise(function(A,M){var F,V={method:"ReadBarcode",parameter:[Ee.Lib.product.refProductKey,4002,"",""],updateSettings:b,initSettingsContent:w};h._activeXInstance?A(h._activeXInstance.Process(p.stringify(V),location.protocol+"//"+location.host)):(I._blts?(F="",I&&I._bRemoteMode&&I._dmService&&I._dmService.attrs&&I._dmService.attrs.UUID&&(F=I._dmService.attrs.UUID),Ee.DWT.lglic(Ee.DWT.EnumInstance.dwt_desktop,F).then(function(B){return V.parameter.push(B.ar),V.parameter.push(B.cu),V.parameter.push(0),V.parameter.push(""),p.stringify(V)})):p.Promise.resolve(p.stringify(V))).then(function(B){return p.fetch(I._dbrUrlRoot+"ReadBarcode",{mode:"cors",method:"post",body:B,dataType:"arrayBuffer"})}).then(function(B){v(B)?A(String.fromCharCode.apply(null,new Uint8Array(B))):A(B)},function(B){var Q="Init template & runtimeSettings failed.";B&&(Q=[Q," Http info: ",B.errorString," (",B.httpCode,")"].join("")),M(Q)})})},y.prototype._innerDecode=function(b,w,I,A){var M=this;return M._runtimeSettings&&0==M._runtimeSettings.expectedBarcodesCount&&(M._runtimeSettings.expectedBarcodesCount=512),new p.Promise(function(F,V){function B(se,ce,pe){try{var Ce,Ve,te,Me,we=_&&_(se);for(we&&we.textResults||V(new h.BarcodeReaderException(we.exception,we.description)),p.product.bHTML5Edition&&pe&&pe.config.data&&(Ce=p.parse(pe.config.data),p.isArray(Ce.parameter))&&2<Ce.parameter.length&&4e3==Ce.parameter[1]&&(4<Ce.parameter.length&&Ce.parameter[4]?we.textResults.imageid=Ce.parameter[4]:0<=(Me=(te=Ce.parameter[2]).indexOf("&index="))&&(we.textResults.imageid=te.substring(Me+7,te.indexOf("&t=")))),Ve=0;Ve<we.textResults.length;Ve++){var Le=we.textResults[Ve];Le.BarcodeText=Le.barcodeText,we.exception!=Ee.DBR.EnumErrorCode.DBR_SUCCESS&&(Le.exception=we.exception)}we.exception!=Ee.DBR.EnumErrorCode.DBR_SUCCESS&&(we.textResults.exception=we.exception,we.textResults.description=we.description),h._activeXInstance&&we.records&&(Ee.Lib.each(we.records,function(j,L){Ee.DWT.lavrf(L,j,Ee.DWT.EnumInstance.dwt_desktop)}),Ee.DWT.lavrf_(1,Ee.DWT.EnumInstance.dwt_desktop)),F(we.textResults)}catch(j){V(j)}}var Q,J,Z={method:"ReadBarcode",parameter:[Ee.Lib.product.refProductKey,b,0!=b?w:null,I||""],updateSettings:M._runtimeSettings,conflictMode:1==M.conflictMode?"ignore":"overwrite",initSettingsContent:M._initSettingsContent,tplContent:function(){if(I)for(var se=0;se<M._tplContentArr.length;++se)if(I==M._tplContentArr[se].ImageParameter.Name)return p.stringify(M._tplContentArr[se]);return null}()},re=M._stwain;h._activeXInstance?re._blts?Ee.DWT.lglic(Ee.DWT.EnumInstance.dwt_desktop,"").then(function(se){Z.parameter.push(se.ar),Z.parameter.push(se.cu),Z.parameter.push(0),Z.parameter.push(""),B(h._activeXInstance.Process(p.stringify(Z),location.protocol+"//"+location.host))}):B(h._activeXInstance.Process(p.stringify(Z),location.protocol+"//"+location.host)):(Q=re._dbrUrlRoot+"ReadBarcode",0==b&&(Q+="/LoadZipFromBytes?cmd="+encodeURIComponent(p.stringify(Z))),(0==b?p.Promise.resolve(w):re._blts?(J="",re&&re._bRemoteMode&&re._dmService&&re._dmService.attrs&&re._dmService.attrs.UUID&&(J=re._dmService.attrs.UUID),Ee.DWT.lglic(Ee.DWT.EnumInstance.dwt_desktop,J).then(function(se){return Z.parameter.push(se.ar),Z.parameter.push(se.cu),Z.parameter.push(0),Z.parameter.push([p.product.getDWTPrefix(),p.product.getServerVersionInfo(),"/verify?id=",A,"&t=",p.getRandom()].join("")),p.stringify(Z)})):p.Promise.resolve(p.stringify(Z))).then(function(se){return p.fetch(Q,{mode:"cors",method:"post",body:se,dataType:"arrayBuffer"})}).then(function(se,ce,pe){v(se)?B(String.fromCharCode.apply(null,new Uint8Array(se)),0,pe):B(se,0,pe)},function(se){var ce="ReadBarcode request fail.";se&&(ce=[ce," Http info: ",se.errorString," (",se.httpCode,")"].join("")),V(Error(ce))}))})},_=h._handleRetJsonString=function(b){var w;if("string"==typeof b||"object"==typeof b&&b instanceof String)try{w=p.parse(b)}catch(I){w=p.parse(h.RemoveNonPrintableChar(b))}else w=b;if(!w)throw h.BarcodeReaderException(Ee.DBR.EnumErrorCode.DBR_UNKNOWN,h.errors.decodeResultEmpty);if("textResults"in w&&p.isArray(w.textResults)||w.exception==Ee.DBR.EnumErrorCode.DBR_SUCCESS)return w;throw h.BarcodeReaderException(w.exception,w.description)},y.prototype.getAllParameterTemplateNames=function(){for(var b=[],w=0;w<this._tplContentArr.length;++w)b.push(this._tplContentArr[w].ImageParameter.Name);return b},y.prototype.getRuntimeSettings=function(){return this._runtimeSettings||(this._runtimeSettings=p.parse(h._defaultRuntimeSettingsStr)),p.Promise.resolve(this._runtimeSettings)},y.prototype.updateRuntimeSettings=function(b){var w,I=this;if("string"==typeof b||"object"==typeof b&&b instanceof String){if("speed"==b||"balance"==b||"coverage"==b||"default"==b)return I.initRuntimeSettingsWithString("speed"==b?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":3,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"bestSpeed","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"Mode":"TFM_SKIP"}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':"balance"==b?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":5,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_STATISTICS"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"balance","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':"coverage"==b?'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":["BF2_POSTALCODE","BF2_DOTCODE"],"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"},{"Mode":"GTM_INVERTED"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"},{"Mode":"LM_STATISTICS_MARKS"},{"Mode":"LM_STATISTICS_POSTAL_CODE"}],"MaxAlgorithmThreadCount":4,"Name":"coverage","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":214748347,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}':'{"ImageParameter":{"AccompanyingTextRecognitionModes":[{"Mode":"ATRM_SKIP"}],"BarcodeColourModes":[{"LightReflection":1,"Mode":"BICM_DARK_ON_LIGHT"}],"BarcodeComplementModes":[{"Mode":"BCM_SKIP"}],"BarcodeFormatIds":["BF_ALL"],"BarcodeFormatIds_2":null,"BinarizationModes":[{"BlockSizeX":0,"BlockSizeY":0,"EnableFillBinaryVacancy":1,"ImagePreprocessingModesIndex":-1,"Mode":"BM_LOCAL_BLOCK","ThreshValueCoefficient":10}],"ColourClusteringModes":[{"Mode":"CCM_SKIP"}],"ColourConversionModes":[{"BlueChannelWeight":-1,"GreenChannelWeight":-1,"Mode":"CICM_GENERAL","RedChannelWeight":-1}],"DPMCodeReadingModes":[{"Mode":"DPMCRM_SKIP"}],"DeblurLevel":9,"DeformationResistingModes":[{"Mode":"DRM_SKIP"}],"Description":"","ExpectedBarcodesCount":512,"FormatSpecificationNameArray":null,"GrayscaleTransformationModes":[{"Mode":"GTM_ORIGINAL"}],"ImagePreprocessingModes":[{"Mode":"IPM_GENERAL"}],"IntermediateResultSavingMode":{"Mode":"IRSM_MEMORY"},"IntermediateResultTypes":["IRT_NO_RESULT"],"LocalizationModes":[{"Mode":"LM_CONNECTED_BLOCKS"},{"Mode":"LM_SCAN_DIRECTLY","ScanDirection":0,"ScanStride":0},{"Mode":"LM_STATISTICS"},{"Mode":"LM_LINES"}],"MaxAlgorithmThreadCount":4,"Name":"default","PDFRasterDPI":300,"PDFReadingMode":{"Mode":"PDFRM_AUTO"},"Pages":"","RegionDefinitionNameArray":null,"RegionPredetectionModes":[{"Mode":"RPM_GENERAL"}],"ResultCoordinateType":"RCT_PIXEL","ReturnBarcodeZoneClarity":0,"ScaleDownThreshold":2300,"ScaleUpModes":[{"Mode":"SUM_AUTO"}],"TerminatePhase":"TP_BARCODE_RECOGNIZED","TextAssistedCorrectionMode":{"BottomTextPercentageSize":0,"LeftTextPercentageSize":0,"Mode":"TACM_VERIFYING","RightTextPercentageSize":0,"TopTextPercentageSize":0},"TextFilterModes":[{"MinImageDimension":65536,"Mode":"TFM_GENERAL_CONTOUR","Sensitivity":0}],"TextResultOrderModes":[{"Mode":"TROM_CONFIDENCE"},{"Mode":"TROM_POSITION"},{"Mode":"TROM_FORMAT"}],"TextureDetectionModes":[{"Mode":"TDM_GENERAL_WIDTH_CONCENTRATION","Sensitivity":5}],"Timeout":10000},"Version":"3.0"}');w=b}else{if("object"!=typeof b)throw TypeError("'setTemplateSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");w=p.stringify(b)}return b=p.parse(w),I._runtimeSettings=b,I._initSettingsContent=null,I._innerServiceCmd(I._runtimeSettings,null).then(function(A){return A=h._handleRetJsonString(A),I._runtimeSettings=A.settings,I._runtimeSettings||(I._runtimeSettings=p.parse(h._defaultRuntimeSettingsStr)),A.settings})},y.prototype.resetRuntimeSettings=function(){var b=this;return b._runtimeSettings=p.parse(h._defaultRuntimeSettingsStr),b._initSettingsContent=null,b._innerServiceCmd(b._runtimeSettings,null).then(function(w){return w=h._handleRetJsonString(w),b._runtimeSettings=w.settings,b._runtimeSettings||(b._runtimeSettings=p.parse(h._defaultRuntimeSettingsStr)),w.settings})},y.prototype.outputSettingsToString=function(b){if(!b)return h._defaultTemplateStr;for(var w=0;w<this._tplContentArr.length;++w)if(b==this._tplContentArr[w].ImageParameter.Name)return p.stringify(this._tplContentArr[w])},y.prototype.initRuntimeSettingsWithString=function(b){var w=this;if(p.isString(b))return w._runtimeSettings=null,w._initSettingsContent=p.parse(b),w._innerServiceCmd(null,w._initSettingsContent).then(function(I){return I=h._handleRetJsonString(I),w._runtimeSettings=I.settings,w._runtimeSettings||(w._runtimeSettings=p.parse(h._defaultRuntimeSettingsStr)),I.settings});throw TypeError("'initRuntimeSettingsWithString(settings)': Type of 'settings' should be 'String'.")},y}(),h._dbr_ax=!1,h._dbr=!1,h._initH5=function(y,_,b){return new p.Promise(function(w,I){y._bRemoteMode&&y._dmService&&y._dmService.attrs&&y._dmService.attrs.url&&(y._dbrUrlRoot=y._dmService.attrs.url+"dcp/dbr_"+h.Version.replace(/\./g,"")+"/"),y._dbrUrlRoot||(y._dbrUrlRoot=Ee.DWT.NetManager.getModuleUrl("dcp/dbr_"+h.Version.replace(/\./g,"")+"/"));var A=5,M={method:"POST",url:y._dbrUrlRoot+"VersionInfo?t="+p.getRandom(),data:'{"method":"VersionInfo"}',onSuccess:function(){w()},onError:function(){if(--A<=0)return I("Failed to connect to the Barcode Reader Add-on, the library may be missing in the Dynamsoft Service directory.");setTimeout(function(){p.ajax(M)},300)},dataType:"json",async:!0,timeout:800};p.ajax(M)}).then(function(){return h._dbr=new h.Class(y),h._dbr._innerServiceCmd(null,null)}).then(function(w){try{var I=h._handleRetJsonString(w);h._dbr._runtimeSettings=I.settings,h._defaultRuntimeSettingsStr=p.stringify(I.settings),h._defaultTemplateStr=p.stringify(I.outputSettings),_(h._dbr)}catch(A){b(Error("Init template & runtimeSettings failed: "+A.message)||A)}},function(w){b(w)})},h.dbrInitPromiseFun=function(y){return new p.Promise(function(_,b){h.innerDbrInit(y,_,b)})},h.innerDbrInit=function(y,_,b){var w=!1,I=!1,A=(p.product.bHTML5Edition?w=!0:I=!0,Ee.BarcodeReaderAddon);if(w){if(A._dbr)return void _(A._dbr)}else if(I&&A._dbr_ax)return void _(A._dbr_ax);if(w&&A._initH5(y,_,b),I){if(I={method:"ReadBarcode",parameter:[Ee.Lib.product.refProductKey,4002,"",""]},!(w=Ee.navInfoSync).bIE)return b(Error("The DBR init error."));try{A._activeXInstance=new ActiveXObject("DBRModule.AtlDBR");var F=A._activeXInstance.Process(p.stringify(I),location.protocol+"//"+location.host),V=p.parse(F);return V?"settings"in V?(A._dbr_ax=new A.Class(y),A._dbr_ax._runtimeSettings=V.settings,A._defaultRuntimeSettingsStr=p.stringify(V.settings),"outputSettings"in V&&(A._defaultTemplateStr=p.stringify(V.outputSettings)),void _(A._dbr_ax)):b(Error(V.description||"The DBR init error.")):b(Error("The DBR init error."))}catch(B){return b(Error("The DBR .dll is missing or not accessible: "+(B.message||B)))}}},p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(y){if(o=y._b64bit?"dbrx64_"+Ee.BarcodeReaderAddon.Version+".dll":"dbr_"+Ee.BarcodeReaderAddon.Version+".dll",p.product.bHTML5Edition)try{y._innerSend("GetAddOnVersion",p.html5.Funs.makeParams("barcodereader",o),!0,!1,!1).catch(function(){})}catch(w){}function _(w){return!p.License.checkProductKey(w,{Core:!0})||!!(Ee.navInfoSync.bMac||Ee.navInfoSync.bLinux||Ee.Lib.env.bMobile)&&(w._errorCode=Ee.DBR.EnumErrorCode.DBR_UNKNOWN,w._errorString=h.errors.ServiceEditionNotSupportDbr,!0)}var b={BarcodeReader:{decode:function(w){return _(y)?p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString)):!p.isNumber(w)||w<0||w>=y.HowManyImagesInBuffer?(p.Errors.IndexOutOfRange(y),p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString))):new p.Promise(function(I){h._decoding?h._decodeQueue.push({method:I,args:[w]}):(h._decoding=!0,I(w))}).then(function(I){var A;if(p.product.bHTML5Edition){if(-1==(A=y._ImgManager.convertClientIndexToServerId(I)))throw p.Errors.IndexOutOfRange(y),setTimeout(h._decodeNext,0),h.BarcodeReaderException(y._errorCode,y._errorString)}else A=I;return new p.Promise(function(M,F){h.dbrInitPromiseFun(y).then(function(V){var B;if(!p.product.bHTML5Edition)return Q=y.GetImagePartURL(B=A,-1,-1),V._innerDecode(4001,Q,"").then(function(J){J.imageid=y.IndexToImageID(B),setTimeout(h._decodeNext,0),M(J)},function(J){setTimeout(h._decodeNext,0),F(J)});B=y._ImgManager.convertServerIdToClientIndex(A);var Q=y.GetImagePartURL(B,-1,-1);return V._innerDecode(4e3,Q,"",y._clientId).then(function(J){J.imageid=y.IndexToImageID(B),setTimeout(h._decodeNext,0),M(J),y._blts&&Ee.DWT.lcvrf(y)},function(J){setTimeout(h._decodeNext,0),F(J)})},function(V){setTimeout(h._decodeNext,0),F(V)})})})},resetRuntimeSettings:function(){return _(y)?p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString)):h.dbrInitPromiseFun(y).then(function(w){return w.resetRuntimeSettings()})},getRuntimeSettings:function(w){return _(y)?p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString)):!p.isString(w)||"speed"!=w&&"balance"!=w&&"coverage"!=w&&"default"!=w?h.dbrInitPromiseFun(y).then(function(I){return I.getRuntimeSettings()}):this.updateRuntimeSettings(w)},updateRuntimeSettings:function(w){return _(y)?p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString)):h.dbrInitPromiseFun(y).then(function(I){return I.updateRuntimeSettings(w)})},initRuntimeSettingsWithString:function(w){return _(y)?p.Promise.reject(h.BarcodeReaderException(y._errorCode,y._errorString)):h.dbrInitPromiseFun(y).then(function(I){return I.initRuntimeSettingsWithString(w)})}}};p.product.bHTML5Edition?(y.__addon=y.__addon||{},p.mix(y.__addon,b)):(y.Addon=y.Addon||{},p.mix(y.Addon,b))})}),(Ee=self.Dynamsoft||{}).DWT=Ee.DWT||{},Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},Ee.DWT.EnumDWT_ConvertMode={CM_RENDERALL:1,CM_IMAGEONLY:2,CM_AUTO:3,CM_RENDERALLWITHANNOTATION:4},Ee.DWT.EnumDWT_PDFCompressionType={PDF_AUTO:0,PDF_FAX3:1,PDF_FAX4:2,PDF_LZW:3,PDF_RLE:4,PDF_JPEG:5,PDF_JP2000:6,PDF_JBIG2:7},Ee.AddonReady(function(p,n){var o,h;p.product.bHTML5Edition&&(o={code:-2830,message:"The PDF resolution must be a positive number."},p.DynamicLoadAddonFuns)&&p.DynamicLoadAddonFuns.push(function(v){var y,_=p.html5.Funs;h=v.__serverPlatform==Ee.DWT.EnumDWT_PlatformType.enumMac?v._b64bit?"libDynamicPdfCorex64_"+Ee.DWT.PdfVersion+".dylib":"libDynamicPdfCore_"+Ee.DWT.PdfVersion+".dylib":v.__serverPlatform==Ee.DWT.EnumDWT_PlatformType.enumLinux||v.__serverPlatform==Ee.DWT.EnumDWT_PlatformType.enumEmbed||v.__serverPlatform==Ee.DWT.EnumDWT_PlatformType.enumChromeOS?"libDynamicPdfCore_"+Ee.DWT.PdfVersion+".so":v._b64bit?"DynamicPdfCorex64_"+Ee.DWT.PdfVersion+".dll":"DynamicPdfCore_"+Ee.DWT.PdfVersion+".dll";try{v._innerSend("GetAddOnVersion",_.makeParams("pdf",h),!0,!1,!1).catch(function(){})}catch(b){}y={PDF:{IsModuleInstalled:function(){var b=v;return b._resetErr(),""!=b._innerFun("GetAddOnVersion",_.makeParams("pdf",h))},IsModuleInstalledAsync:function(){var b=v;return b._resetErr(),b._innerFunV2("GetAddOnVersion",_.makeParams("pdf",h)).then(function(w){return""!=w})},ConvertToImage:function(M,w,I,A){M=_.replaceLocalFilename(M);var F="ConvertPDFToImage",V=v;return V._resetErr(),_.showMask(F),V._innerSend(F,_.makeParams(M,w),!0,function(B){return _.hideMask(F),I&&I(),!0},function(B){return _.hideMask(F),A&&A(),!1}),!0},SetPassword:function(b){var w=v,I=b||"";return w._resetErr(),!!w._checkPDFPasswordValue(I)&&(I=w._mixSavedPdfReaderOptions({password:I}),(I=w._setReaderOptions(I,!1))&&(w._pdfOptions.password=b),I)},SetConvertMode:function(b){return v._setConvertMode(b)},SetConvertModeAsync:function(b){return v._setConvertModeAsync(b)},GetConvertMode:function(){var b=v;return b._resetErr(),b._pdfConvertMode},SetResolution:function(b){var w=v,I=b;return w._resetErr(),I=w._mixSavedPdfReaderOptions({renderOptions:{resolution:I}}),(I=w._setReaderOptions(I,!1))&&(w._pdfOptions.renderOptions.resolution=b),I},SetResolutionAsync:function(b){var w=v;return w._resetErr(),!Ee.Lib.isNumber(b)||b<=0?Ee.Lib.Promise.reject(o):w._innerFunV2("SetPDFResolution",_.makeParams(b)).then(function(I){I&&(w._pdfOptions.renderOptions.resolution=b)})},SetReaderOptions:function(b){return v._setReaderOptions(b,!0)},GetReaderOptions:function(){var b,w=v;return w._resetErr(),b=v._innerFun("GetPDFReaderOptions"),b=Ee.Lib.parse(b),w._pdfOptions=w._mixSavedPdfReaderOptions(b),Ee.Lib.clone(w._pdfOptions)},IsTextBasedPDF:function(M,w,I){var A=v;return A._resetErr(),M=_.replaceLocalFilename(M),M=v._innerFun("IsTextBasedPDF",_.makeParams(M)),0==A.ErrorCode?p.isFunction(w)&&w(M):p.isFunction(I)&&I(A.ErrorCode,A.ErrorString),M},Write:{Setup:function(w){var I=(2<p.stringify(w=w||{version:15}).length&&(p.isNumber(w.version)?1<=w.version&&w.version<2&&(w.version=parseInt(10*w.version)):w.version=15),p.isNumber(w.compression)&&w.compression==Ee.DWT.EnumDWT_PDFCompressionType.PDF_FAX3&&(w.compression=Ee.DWT.EnumDWT_PDFCompressionType.PDF_FAX4),v);return I._resetErr(),!(w.password&&(p.isNumber(w.password)&&(w.password=w.password.toString()),!I._checkPDFPasswordValue(w.password)))&&(w=p.stringify(w),w=p.replaceAll(w,'"','\\"'),I._innerFun("SetPDFSettings",['["',w,'"]'].join("")))}}}},v.__addon=v.__addon||{},p.mix(v.__addon,y)})}),Ee.AddonReady(function(p,n){p.product.bActiveXEdition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(o){var h,v,y;if(!o.getSWebTwain()||!o.getSWebTwain().Addon)return!1;Ee.navInfoSync.bWin&&(y=!Ee.navInfo.bOSx64||Ee.navInfo.bWOW64?"DynamicPdfCore_"+Ee.DWT.PdfVersion+".dll":"DynamicPdfCorex64_"+Ee.DWT.PdfVersion+".dll"),v=o.getSWebTwain(),h={PDF:{IsModuleInstalled:function(){var _=v.GetAddOnVersion("pdf",y);return p.setErrorString(o),""!=_},IsModuleInstalledAsync:function(){var _=v.GetAddOnVersion("pdf",y);return p.setErrorString(o),p.Promise.resolve(""!=_)},ConvertToImage:function(_,b,w,I){return _=v.ConvertPDFToImage(_,b),p.wrapperRet(o,_,w,I)},SetPassword:function(_){return _=v.SetPDFPassword(_),p.wrapperRet(o,_)},SetConvertMode:function(_){return o._setConvertMode(_)},SetConvertModeAsync:function(_){return Promise.resolve(o._setConvertMode(_))},GetConvertMode:function(){return o._resetErr(),o._pdfConvertMode},SetResolution:function(_){return _=v.SetPDFResolution(_),p.wrapperRet(o,_)},SetResolutionAsync:function(_){return _=v.SetPDFResolution(_),p.Promise.resolve(p.wrapperRet(o,_))},SetReaderOptions:function(){return!1},GetReaderOptions:function(){return{}},IsTextBasedPDF:function(_){return _=v.IsTextBasedPDF(_),p.wrapperRet(o,_)}}},o.Addon=o.Addon||{},p.mix(o.Addon,h)})}),(Ee=self.Dynamsoft||{}).DWT=Ee.DWT||{},Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},Ee.DWT.OCRVerInName="10.0.0.0618",function(){for(var p=[Ee.DWT],n=0;n<1;n++){var o=p[n];o.EnumDWT_OCRLanguage={OCRL_ENG:"eng",OCRL_ARA:"ara",OCRL_CHI_SIM:"chi_sim",OCRL_CHI_TRA:"chi_tra",OCRL_HIN:"hin",OCRL_URD:"urd",OCRL_SPA:"spa",OCRL_FRA:"fra",OCRL_MSA:"msa",OCRL_IND:"ind",OCRL_RUS:"rus",OCRL_BEN:"ben",OCRL_POR:"por",OCRL_PAN:"pan",OCRL_DEU:"deu",OCRL_JPN:"jpn",OCRL_FAS:"fas",OCRL_SWA:"swa",OCRL_JAV:"jav",OCRL_TEL:"tel",OCRL_TUR:"tur",OCRL_KOR:"kor",OCRL_MAR:"mar",OCRL_TAM:"tam",OCRL_VIE:"vie",OCRL_ITA:"ita",OCRL_THA:"tha"},o.EnumDWT_OCRPageSetMode={OCRPSM_OSD_ONLY:0,PSM_AUTO_OSD:1,PSM_AUTO_ONLY:2,PSM_AUTO:3,PSM_SINGLE_COLUMN:4,PSM_SINGLE_BLOCK_VERT_TEXT:5,PSM_SINGLE_BLOCK:6,PSM_SINGLE_LINE:7,PSM_SINGLE_WORD:8,PSM_CIRCLE_WORD:9,PSM_SINGLE_CHAR:10},o.EnumDWT_OCROutputFormat={OCROF_TEXT:0,OCROF_PDFPLAINTEXT:1,OCROF_PDFIMAGEOVERTEXT:2,OCROF_PDFPLAINTEXT_PDFX:3,OCROF_PDFIMAGEOVERTEXT_PDFX:4},o.EnumDWT_OCRDownloadType={OCRDT_Dll:0,OCRDT_LANGUAGE:1}}}(),Ee.DWT.OCRLanguageData_eng="4113088",Ee.DWT.OCRLanguageData_ara="1432056",Ee.DWT.OCRLanguageData_chi_sim="2469156",Ee.DWT.OCRLanguageData_chi_tra="2366642",Ee.DWT.OCRLanguageData_hin="1122751",Ee.DWT.OCRLanguageData_urd="1398718",Ee.DWT.OCRLanguageData_spa="2294433",Ee.DWT.OCRLanguageData_fra="1130365",Ee.DWT.OCRLanguageData_msa="1747801",Ee.DWT.OCRLanguageData_ind="1122661",Ee.DWT.OCRLanguageData_rus="3861738",Ee.DWT.OCRLanguageData_ben="855841",Ee.DWT.OCRLanguageData_por="1982756",Ee.DWT.OCRLanguageData_pan="497721",Ee.DWT.OCRLanguageData_deu="1525436",Ee.DWT.OCRLanguageData_jpn="2471260",Ee.DWT.OCRLanguageData_fas="431500",Ee.DWT.OCRLanguageData_swa="2167651",Ee.DWT.OCRLanguageData_jav="2982741",Ee.DWT.OCRLanguageData_tel="2769654",Ee.DWT.OCRLanguageData_tur="4550554",Ee.DWT.OCRLanguageData_kor="1677415",Ee.DWT.OCRLanguageData_mar="2118233",Ee.DWT.OCRLanguageData_tam="3237963",Ee.DWT.OCRLanguageData_vie="531275",Ee.DWT.OCRLanguageData_ita="2701314",Ee.DWT.OCRLanguageData_tha="1072600",Ee.DWT.OCRLanguageData={},Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_ENG]=Ee.DWT.OCRLanguageData_eng,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_ARA]=Ee.DWT.OCRLanguageData_ara,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_CHI_TRA]=Ee.DWT.OCRLanguageData_chi_tra,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_CHI_SIM]=Ee.DWT.OCRLanguageData_chi_sim,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_HIN]=Ee.DWT.OCRLanguageData_hin,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_URD]=Ee.DWT.OCRLanguageData_urd,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_SPA]=Ee.DWT.OCRLanguageData_spa,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_FRA]=Ee.DWT.OCRLanguageData_fra,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_MSA]=Ee.DWT.OCRLanguageData_msa,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_IND]=Ee.DWT.OCRLanguageData_ind,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_RUS]=Ee.DWT.OCRLanguageData_rus,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_BEN]=Ee.DWT.OCRLanguageData_ben,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_POR]=Ee.DWT.OCRLanguageData_por,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_PAN]=Ee.DWT.OCRLanguageData_pan,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_DEU]=Ee.DWT.OCRLanguageData_deu,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_JPN]=Ee.DWT.OCRLanguageData_jpn,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_FAS]=Ee.DWT.OCRLanguageData_fas,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_SWA]=Ee.DWT.OCRLanguageData_swa,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_JAV]=Ee.DWT.OCRLanguageData_jav,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_TEL]=Ee.DWT.OCRLanguageData_tel,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_TUR]=Ee.DWT.OCRLanguageData_tur,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_KOR]=Ee.DWT.OCRLanguageData_kor,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_MAR]=Ee.DWT.OCRLanguageData_mar,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_TAM]=Ee.DWT.OCRLanguageData_tam,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_VIE]=Ee.DWT.OCRLanguageData_vie,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_ITA]=Ee.DWT.OCRLanguageData_ita,Ee.DWT.OCRLanguageData[Ee.DWT.EnumDWT_OCRLanguage.OCRL_THA]=Ee.DWT.OCRLanguageData_tha,function(p){function n(){var o=this;o._text="",o._fontName="",o._fontSize="",o._left=0,o._top=0,o._right=0,o._bottom=0}n.prototype.GetText=function(){return this._text},n.prototype.GetFontName=function(){return this._fontName},n.prototype.GetFontSize=function(){return this._fontSize},n.prototype.GetWordRect=function(){var o=this;return o._left+","+o._top+","+o._right+","+o._bottom},p.NewWordBasicResult=function(){return new n}}(Ee.Lib),function(p){function n(){var o=this;o._count=0,o._left=0,o._top=0,o._right=0,o._bottom=0,o._wordlist=[]}n.prototype.GetWordCount=function(){return this._count},n.prototype.GetLineRect=function(){var o=this;return o._left+","+o._top+","+o._right+","+o._bottom},n.prototype.GetWordContent=function(o){var h=this,v=h._wordlist.length;return h._errorCode<0?"":null==o||v<=o||o<0?(Ee.Lib.Errors.OCR_InvalidIndex(h,"GetWordContent"),""):((v=Ee.Lib.NewWordBasicResult())._text=h._wordlist[o].text,v._fontName=h._wordlist[o].fontname,v._fontSize=h._wordlist[o].fontsize,v._left=h._wordlist[o].rect[0],v._top=h._wordlist[o].rect[1],v._right=h._wordlist[o].rect[2],v._bottom=h._wordlist[o].rect[3],v)},p.NewLineBasicResult=function(){return new n}}(Ee.Lib),function(p){function n(){this._count=0,this._linelist=[]}n.prototype.GetLineCount=function(){return this._count},n.prototype.GetLineContent=function(o){var h=this,v=h._linelist.length;return h._errorCode<0?"":null==o||v<=o||o<0?(Ee.Lib.Errors.OCR_InvalidIndex(h,"GetLineContent"),""):((v=Ee.Lib.NewLineBasicResult())._count=h._linelist[o].words.length,v._left=h._linelist[o].rect[0],v._top=h._linelist[o].rect[1],v._right=h._linelist[o].rect[2],v._bottom=h._linelist[o].rect[3],v._wordlist=h._linelist[o].words,v)},p.NewPageBasicResult=function(){return new n}}(Ee.Lib),function(p){function n(){this._count=0,this._pagelist=[]}n.prototype.GetPageCount=function(){return this._count},n.prototype.GetPageContent=function(o){var h=this,v=h._pagelist.length;return h._errorCode<0?"":null==o||v<=o||o<0?(Ee.Lib.Errors.OCR_InvalidIndex(h,"GetPageContent"),""):((v=Ee.Lib.NewPageBasicResult())._count=h._pagelist[o].lines.length,v._linelist=h._pagelist[o].lines,v)},p.NewPageSetBasicResult=function(){return new n}}(Ee.Lib),function(p){function n(o){var h=this;h._errorCode=0,h._errorString="",h._resultlist=[],h._stwain=o}n.prototype.GetErrorCode=function(){return this._errorCode},n.prototype.GetErrorString=function(){return this._errorString},n.prototype.GetFormat=function(){return this._resultlist[0].format},n.prototype.GetInput=function(){var o=this._resultlist[0].input;if(o){var h=Number(o);if(!isNaN(h))return this._stwain._ImgManager.convertServerIdToClientIndex(h)}return o},n.prototype.GetPageSetCount=function(){return this._resultlist[0].pagesets.length},n.prototype.GetPageSetContent=function(o){var h=this,v=h._resultlist[0].pagesets.length;return h._errorCode<0?"":null==o||v<=o||o<0?(Ee.Lib.Errors.OCR_InvalidIndex(h,"GetPageSetContent"),""):((v=Ee.Lib.NewPageSetBasicResult())._count=h._resultlist[0].pagesets[o].pages.length,v._pagelist=h._resultlist[0].pagesets[o].pages,v)},n.prototype.Get=function(){return this._stwain._innerFun("GetOCRRestult")},n.prototype.Save=function(o){return o=p.html5.Funs.replaceLocalFilename(o),this._stwain._innerFun("SaveOCRRestult",p.html5.Funs.makeParams(o))},p.NewOCRBasicResult=function(o){return new n(o)}}(Ee.Lib),function(p){function n(){var o=this;o.UnicodeFontName="",o.UseDetectedFont=!0,o.MinFontSizeforMoreAccurateResult=0,o.OCRLanguage=Ee.DWT.EnumDWT_OCRLanguage.OCRL_ENG,o.PageSetMode=Ee.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO,o.OutputFormat=Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT}n.prototype.GetUnicodeFontName=function(){return this.UnicodeFontName},n.prototype.SetUnicodeFontName=function(o){return p.isString(o)||(o=""),this.UnicodeFontName=o,!0},n.prototype.GetUseDetectedFont=function(){return!!this.UseDetectedFont},n.prototype.SetUseDetectedFont=function(o){return this.UseDetectedFont=!!o,!0},n.prototype.GetMinFontSizeforMoreAccurateResult=function(){return this.MinFontSizeforMoreAccurateResult},n.prototype.SetMinFontSizeforMoreAccurateResult=function(o){return this.MinFontSizeforMoreAccurateResult=o=(o=+o)<0?0:o,!0},n.prototype.GetOCRLanguage=function(){return this.OCRLanguage},n.prototype.SetOCRLanguage=function(o){return p.isString(o)||(o=""),this.OCRLanguage=o,!0},n.prototype.GetPageSetMode=function(){return this.PageSetMode},n.prototype.SetPageSetMode=function(o){return((o=+o)<0||o>Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_CHAR)&&(o=Ee.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO),this.PageSetMode=o,!0},n.prototype.GetOutputFormat=function(){return this.OutputFormat},n.prototype.SetOutputFormat=function(o){return((o=+o)<0||o>Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT_PDFX)&&(o=Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT),this.OutputFormat=o,!0},p.NewOptions=function(){return new n}}(Ee.Lib),Ee.AddonReady(function(p,n){var o;p.product.bHTML5Edition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(h){var v,y,_,b=p.html5.Funs,w=p.NewOptions();_=p.html5.Funs,o=p.env.bMac?"DynamicOCR_"+Ee.DWT.OCRVerInName+".dylib":p.env.bLinux?"DynamicOCR_"+Ee.DWT.OCRVerInName+".so":Ee.dcp.b64bit?"DynamicOCRx64_"+Ee.DWT.OCRVerInName+".dll":"DynamicOCR_"+Ee.DWT.OCRVerInName+".dll",(y=h)._isMobileMode()||y._innerSend("GetAddOnVersion",_.makeParams("ocr",o),!0,!1,!1),y.__innerOCRBasicReadFunction=function(I,A,M,F,V,B,Q,J,Z,re,se){return p.isFunction(re)?this.__innerOCRBasicAsyncReadFunction(I,A,M,F,V,B,Q,J,Z,re,se):this.__innerOCRSyncReadFunction(I,Z)},y.__innerGetOCRBasicResultAsyncFunction=function(I){var A=Ee.Lib.NewOCRBasicResult(this);return I&&(A._errorCode=I.exception,A._errorString=I.description,A._resultlist=I.result),A},y.__innerOCRBasicAsyncReadFunction=function(I,A,M,F,V,B,Q,J,Z,re,se){var ce=this;return _.showMask(I),ce._innerSend(I,Z,!0,function(pe){var Ce;0==pe.exception?(p.isFunction(re)&&(-1!=A?(Ce=ce._convertServerIdToGuid(A),1==F?re(Ce,V,B,Q,J,ce.__innerGetOCRBasicResultAsyncFunction(pe)):re(Ce,ce.__innerGetOCRBasicResultAsyncFunction(pe))):""!=M?re(M,ce.__innerGetOCRBasicResultAsyncFunction(pe)):re(ce.__innerGetOCRBasicResultAsyncFunction(pe))),p.License.isLTS()&&Ee.DWT.lcvrf(y)):p.isFunction(se)&&se(pe.exception,pe.description),_.hideMask(I)},function(pe){_.hideMask(I)}),!0},y.__innerOCRSyncReadFunction=function(I,A){return I=this._innerFunRaw(I,A,!1,!1),(A=p.NewOCRBasicResult())._errorCode=this._errorCode,A._errorString=this._errorString,I&&p.isArray(I)&&(A._resultlist=I,A._Count=I.length,p.License.isLTS())&&Ee.DWT.lcvrf(y),A},y.__IsOCRBasicModuleInstalled=function(){return""!=y._innerFun("GetAddOnVersion",_.makeParams("ocr",o)).split("|")[0]},y.__innerBasicDownload=function(I,A,M,F,V){function B(){return J.IfShowProgressBar&&p.closeProgress(null,"Download"),p.isFunction(F)&&F(),!0}function Q(){return J.IfShowProgressBar&&p.closeProgress(null,"Download"),p.isFunction(V)&&V(J.ErrorCode,J.ErrorString),!1}var J=y;if(p.cancelFrome=2,I=I.toString(),!p.License.checkProductKey(J,{Core:!0})||!p.License.checkProductKey(J,{OCR:!0},!0))return Q();A!=Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll&&J._innerFun("SetOCRLanguage",_.makeParams(M));var Z=J._innerFun("GetAddOnVersion",_.makeParams("ocr",o)).split("|");if(A==Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll){if(""!=Z[0])return B(),!0}else if((M=Ee.DWT.OCRLanguageData[M])&&Z[1]==M)return B(),!0;if(!I||""==I)return p.Errors.OCR_InvalidRemoteFilename(J),Q(),!1;if(_.isServerInvalid(J))return Q(),!1;J.IfShowProgressBar&&p.showProgress(J,"Download",!0);var re=!0;J._OnPercentDone(A==Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll?[0,-1,"Downloading OCR Module...","http"]:[0,-1,"Downloading OCR Language Data...","http"]),p.isFunction(F)||(re=!1),_.loadHttpBlob(J,"get",I,re,function(se){J._OnPercentDone([0,-1,"Loading..."]);var ce=100;A==Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_LANGUAGE&&(ce=101),J.__LoadImageFromBytes(se,ce,"",re,B,Q)},function(){J.IfShowProgressBar&&p.closeProgress(null,"Download"),Q()},function(se){var ce=0===se.total?100:Math.round(100*se.loaded/se.total);[se.loaded," / ",se.total].join(""),J._OnPercentDone([0,ce,"","http"])})},v={OCR:{SetUnicodeFontName:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetUnicodeFontName"):w.SetUnicodeFontName(I)},GetUnicodeFontName:function(){var I=h;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.GetUnicodeFontName"):w.GetUnicodeFontName()},SetIfUseDetectedFont:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetIfUseDetectedFont"):w.SetUseDetectedFont(I)},GetIfUseDetectedFont:function(){var I=h;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.GetIfUseDetectedFont"):w.GetUseDetectedFont()},SetMinFontSizeforMoreAccurateResult:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetMinFontSizeforMoreAccurateResult"):w.SetMinFontSizeforMoreAccurateResult(I)},GetMinFontSizeforMoreAccurateResult:function(){var I=h;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.GetMinFontSizeforMoreAccurateResult"):w.GetMinFontSizeforMoreAccurateResult()},SetLanguage:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetLanguage"):w.SetOCRLanguage(I)},IsModuleInstalled:function(){var I=h;return I._resetErr(),I._isMobileMode()?I._mobileNotSupport("Addon.OCR.IsModuleInstalled"):I.__IsOCRBasicModuleInstalled()},SetPageSetMode:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetPageSetMode"):(I=+I)==Ee.DWT.EnumDWT_OCRPageSetMode.OCRPSM_OSD_ONLY||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO_OSD||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO_ONLY||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_AUTO||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_COLUMN||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK_VERT_TEXT||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_BLOCK||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_LINE||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_WORD||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_CIRCLE_WORD||I==Ee.DWT.EnumDWT_OCRPageSetMode.PSM_SINGLE_CHAR?w.SetPageSetMode(I):(Ee.Lib.Errors.OCR_InvalidPageSetMode(A),!1)},SetOutputFormat:function(I){var A=h;return A._resetErr(),A._isMobileMode()?A._mobileNotSupport("Addon.OCR.SetOutputFormat"):(I=+I)==Ee.DWT.EnumDWT_OCROutputFormat.OCROF_TEXT||I==Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT||I==Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT||I==Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFPLAINTEXT_PDFX||I==Ee.DWT.EnumDWT_OCROutputFormat.OCROF_PDFIMAGEOVERTEXT_PDFX?w.SetOutputFormat(I):(Ee.Lib.Errors.OCR_InvalidOutputFormat(A),!1)},Recognize:function(I,A,M){var F=h;return F._resetErr(),F._isMobileMode()?F._mobileNotSupport("Addon.OCR.Recognize"):p.License.checkProductKey(F,{OCR:!0},!0)?(I=F._ImgManager.convertClientIndexToServerId(I),F.__innerOCRBasicReadFunction("OCRRecognize",I,"",0,0,0,0,0,b.makeParams(0,I,"",0,0,0,0,w.GetUnicodeFontName(),w.GetUseDetectedFont(),w.GetMinFontSizeforMoreAccurateResult(),w.GetOCRLanguage(),w.GetPageSetMode(),w.GetOutputFormat(),""),A,M)):(p.isFunction(M)&&M(F._errorCode,F._errorString),!1)},RecognizeRect:function(I,A,M,F,V,B,Q){var J,Z=h;return Z._resetErr(),Z._isMobileMode()?Z._mobileNotSupport("Addon.OCR.RecognizeRect"):!A&&0!=A||!M&&0!=M||!F&&0!=F||!V&&0!=V?(J=Ee.Lib.NewOCRBasicResult(Z),Ee.Lib.Errors.OCR_InvalidLeftOrTopOrRightOrBottom(J,"RecognizeRect"),void Q(J.GetErrorCode(),J.GetErrorString())):p.License.checkProductKey(Z,{OCR:!0},!0)?(J=Z._ImgManager.convertClientIndexToServerId(I),Z.__innerOCRBasicReadFunction("OCRRecognize",J,"",1,A,M,F,V,b.makeParams(0,J,"",A,M,F,V,w.GetUnicodeFontName(),w.GetUseDetectedFont(),w.GetMinFontSizeforMoreAccurateResult(),w.GetOCRLanguage(),w.GetPageSetMode(),w.GetOutputFormat(),""),B,Q)):(p.isFunction(Q)&&Q(Z._errorCode,Z._errorString),!1)},RecognizeFile:function(I,A,M){var F=h;return F._resetErr(),F._isMobileMode()?F._mobileNotSupport("Addon.OCR.RecognizeFile"):(I=b.replaceLocalFilename(I),p.License.checkProductKey(F,{OCR:!0},!0)?F.__innerOCRBasicReadFunction("OCRRecognize",-1,I,0,0,0,0,0,b.makeParams(1,-1,I,0,0,0,0,w.GetUnicodeFontName(),w.GetUseDetectedFont(),w.GetMinFontSizeforMoreAccurateResult(),w.GetOCRLanguage(),w.GetPageSetMode(),w.GetOutputFormat(),""),A,M):(p.isFunction(M)&&M(F._errorCode,F._errorString),!1))},RecognizeSelectedImages:function(I,A){var M,F,V,B=h;return B._resetErr(),B._isMobileMode()?B._mobileNotSupport("Addon.OCR.RecognizeSelectedImages"):p.License.checkProductKey(B,{OCR:!0},!0)?(V=[],(M=B)._ImgManager.count()<=0||(F=M._ImgManager.getCurrentImageIndex(),M._ImgManager.convertClientIndexToServerId(F),F=M._ImgManager.getSelectedClientIndexArray(),p.isArray(F)&&p.each(F,function(Q){Q=M._ImgManager.convertClientIndexToServerId(Q),V.push(Q)})),F=V,B.__innerOCRBasicReadFunction("OCRRecognize",-1,"",0,0,0,0,0,b.makeParams(2,-1,"",0,0,0,0,w.GetUnicodeFontName(),w.GetUseDetectedFont(),w.GetMinFontSizeforMoreAccurateResult(),w.GetOCRLanguage(),w.GetPageSetMode(),w.GetOutputFormat(),F.join(",")),I,A)):(p.isFunction(A)&&A(B._errorCode,B._errorString),!1)},Download:function(I,A,M){var F=h;return F._resetErr(),F._isMobileMode()?F._mobileNotSupport("Addon.OCR.Download"):F.__innerBasicDownload(I,Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_Dll,w.GetOCRLanguage(),A,M)},DownloadLangData:function(I,A,M){var F=h;return F._resetErr(),F._isMobileMode()?F._mobileNotSupport("Addon.OCR.DownloadLangData"):F.__innerBasicDownload(I,Ee.DWT.EnumDWT_OCRDownloadType.OCRDT_LANGUAGE,w.GetOCRLanguage(),A,M)}}},h.__addon=h.__addon||{},p.mix(h.__addon,v)})}),(Ee=self.Dynamsoft||{}).DWT=Ee.DWT||{},Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},Ee.ProOCRVerInName="1.2.0.0806",function(p){function n(){var o=this;o._text="",o._left=0,o._top=0,o._right=0,o._bottom=0}n.prototype.GetText=function(){return this._text},n.prototype.GetLetterRect=function(){var o=this;return o._left+","+o._top+","+o._right+","+o._bottom},p.NewLetterResult=function(){return new n}}(Ee.Lib),function(p){function n(){var o=this;o._count=0,o._letterlist=[],o._zoneCount=0,o._zoneWords=[]}n.prototype.GetLettersCount=function(){return this._count},n.prototype.GetZoneCount=function(){return this._zoneCount},n.prototype.GetLetterContent=function(o){var h=this;if(h._errorCode<0)return"";if(null==o||o>=h._count||o<0)return Ee.Lib.Errors.OCR_InvalidIndex(h,"GetLetterContent"),"";var y=Ee.Lib.NewLetterResult();return y._text=h._letterlist[o].letter,y._left=h._letterlist[o].boundary[0],y._top=h._letterlist[o].boundary[1],y._right=h._letterlist[o].boundary[2],y._bottom=h._letterlist[o].boundary[3],y},n.prototype.GetZoneContent=function(o){var h=this;return h._errorCode<0?"":null==o||o>=h._zoneCount||o<0?(Ee.Lib.Errors.OCR_InvalidIndex(h,"GetZoneContent"),""):h._zoneWords[o]},p.NewPageResult=function(){return new n}}(Ee.Lib),function(p){function n(){var o=this;o._input=0,o._message="",o._page=-1}n.prototype.GetInput=function(){return this._input},n.prototype.GetMessage=function(){return this._message},n.prototype.GetPage=function(){return this._page},p.NewErrorInfo=function(){return new n}}(Ee.Lib),function(p){function n(o){var h=this;h._errorCode=0,h._errorString="",h._errorlist=[],h._request="",h._ocrTotalCount=0,h._alreadyOCRCount=0,h._resultlist=[],h._resultZoneDetail=[],h._stwain=o}n.prototype.GetErrorCode=function(){return this._errorCode},n.prototype.GetErrorString=function(){return this._errorString},n.prototype.GetInput=function(){var o=this;if(o._request&&o._request.input){var h=o._request.input;if(h){var v=Number(h);if(!isNaN(v))return o._stwain._ImgManager.convertServerIdToClientIndex(v)}return h}return""},n.prototype.GetErrorDetailList=function(){var o=this,h=0;o._errorlist&&(h=o._errorlist.length);for(var v=[],y=0;y<h;y++){var _=Ee.Lib.NewErrorInfo();_._input=o._errorlist[y].input,_._message=o._errorlist[y].message,_._page=o._errorlist[y].page,v.push(_)}return v},n.prototype.GetOCRTotalCount=function(){return this._ocrTotalCount?this._ocrTotalCount:0},n.prototype.GetAlreadyOCRCount=function(){return this._alreadyOCRCount?this._alreadyOCRCount:0},n.prototype.GetPageCount=function(){var o=this;return o._resultlist&&o._resultlist.length?o._resultlist.length:0},n.prototype.GetPageContent=function(o){var h=this,v=0;if(h._resultlist&&(v=h._resultlist.length),null==o||o>=v||o<0)return Ee.Lib.Errors.OCR_InvalidIndex(h,"GetPageContent"),"";var y=Ee.Lib.NewPageResult();return h._resultlist?(y._count=h._resultlist[o].length,y._letterlist=h._resultlist[o]):y._count=0,h._resultZoneDetail?(y._zoneCount=h._resultZoneDetail[o].length,y._zoneWords=h._resultZoneDetail[o]):y._zoneCount=0,y},n.prototype.Get=function(){return this._stwain._innerFun("GetOCRRestult")},n.prototype.Save=function(o){var v=p.html5.Funs.replaceLocalFilename(o);return this._stwain._innerFun("SaveOCRRestult",p.html5.Funs.makeParams(v))},p.NewOCRProResult=function(o){return new n(o)}}(Ee.Lib),function(p){for(var n=[Ee.DWT],o=0;o<1;o++){var h=n[o];h.EnumDWT_OCRProRecognitionModule={OCRPM_AUTO:"AUTO",OCRPM_MOSTACCURATE:"MOSTACCURATE",OCRPM_BALANCED:"BALANCED",OCRPM_FASTEST:"FASTEST"},h.EnumDWT_OCRProOutputFormat={OCRPFT_TXTS:"TXTS",OCRPFT_TXTCSV:"TXTCSV",OCRPFT_TXTF:"TXTF",OCRPFT_XML:"XML",OCRPFT_IOTPDF:"IOTPDF",OCRPFT_IOTPDF_MRC:"IOTPDF_MRC"},h.EnumDWT_OCRProPDFVersion={OCRPPDFV_0:"1.0",OCRPPDFV_1:"1.1",OCRPPDFV_2:"1.2",OCRPPDFV_3:"1.3",OCRPPDFV_4:"1.4",OCRPPDFV_5:"1.5",OCRPPDFV_6:"1.6",OCRPPDFV_7:"1.7"},h.EnumDWT_OCRProPDFAVersion={OCRPPDFAV_1A:"pdf/a-1a",OCRPPDFAV_1B:"pdf/a-1b",OCRPPDFAV_2A:"pdf/a-2a",OCRPPDFAV_2B:"pdf/a-2b",OCRPPDFAV_2U:"pdf/a-2u",OCRPPDFAV_3A:"pdf/a-3a",OCRPPDFAV_3B:"pdf/a-3b",OCRPPDFAV_3U:"pdf/a-3u"},h.EnumDWT_OCRProType={OCRDT_File:0,OCRDT_Index:1},h.EnumDWT_OCRFindTextFlags={OCRFT_WHOLEWORD:1,OCRFT_MATCHCASE:2,OCRFT_FUZZYMATCH:4},h.EnumDWT_OCRFindTextAction={OCRFT_HIGHLIGHT:0,OCRFT_STRIKEOUT:1,OCRFT_MARKFORREDACT:2}}}("undefined"!=typeof window&&window),function(p){function n(){var o=this;o.FindText="",o.FindTextFlags=Ee.DWT.EnumDWT_OCRFindTextFlags.OCRFT_WHOLEWORD,o.FindTextAction=Ee.DWT.EnumDWT_OCRFindTextAction.OCRFT_MARKFORREDACT}p.NewRedaction=function(){return new n}}(Ee.Lib),Ee.WebTwain={Addon:{OCRPro:{}}},function(p){function n(){var o=this;o.RecognitionModule="",o.Languages="eng",o.OutputFormat="",o.PDFVersion="",o.PDFAVersion="",o.LicenseChecker="",o.Redaction=Ee.Lib.NewRedaction()}p.NewSettings=function(){return new n}}(Ee.WebTwain.Addon.OCRPro),function(){function p(n,o,h,v){var y=this;y.left=n,y.top=o,y.right=h,y.bottom=v}Ee.WebTwain.Addon.OCRPro.NewOCRZone=function(n,o,h,v){return new p(n,o,h,v)}}(),Ee.AddonReady(function(p,n){if(p.product.bHTML5Edition){var _=function(te,Me,we,Le){var j=p.NewOCRProResult(te);j._errorCode=Me,j._errorString=we;var L=p.NewErrorInfo();return L.input=Le,L.message=j._errorString,L.page=0,j._errorlist=[L],j};p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(te){var we,Le,Me=p.html5.Funs;Le=p.env.bMac?"DynamicOCRPro_"+Ee.ProOCRVerInName+".dylib":p.env.bLinux?"DynamicOCRPro_"+Ee.ProOCRVerInName+".so":Ee.dcp.b64bit?"DynamicOCRProx64_"+Ee.ProOCRVerInName+".dll":"DynamicOCRPro_"+Ee.ProOCRVerInName+".dll",function v(te){var Me=p.html5.Funs;te.__innerGetOCRProResultAsyncFunction=function(we){var Le=Ee.Lib.NewOCRProResult(this);return we&&(Le._errorCode=we.code,Le._errorString=we.message,Le._request=we.request,Le._errorlist=we.errorList,Le._ocrTotalCount=we.ocrTotalCount,Le._alreadyOCRCount=we.alreadyOCRCount,Le._resultlist=we.resultDetail,Le._resultZoneDetail=we.resultZoneDetail),Le},te.__innerIsOCRTrial=function(we,Le){var j=this,L=function(){var Y=!1;if(j.__licenseInfo.Detail)for(var q=0;q<j.__licenseInfo.Detail.length;q++)"10"==j.__licenseInfo.Detail[q].EnumLicenseType&&"TRUE"==j.__licenseInfo.Detail[q].Trial&&(Y=!0);return we(Y)};return j.__licenseInfo&&j.__licenseInfo.Detail?L():j.GetLicenseInfo(L,Le)},te.__innerOCRReadFunction=function(we,Le,j,L,Y,q,k,N){return this.__innerOCRAsyncReadFunction(we,Le,j,L,Y,q,k,N)},te.__innerOCRAsyncReadFunction=function(we,Le,j,L,Y,q,k,N){var $=this;return Me.showMask(we),$._innerSend(we,q,!0,function(ne){0==ne.code?(p.isFunction(k)&&(-1!=Le?1==L?k(Le,Y,$.__innerGetOCRProResultAsyncFunction(ne)):k(Le,$.__innerGetOCRProResultAsyncFunction(ne)):""!=j?k(j,$.__innerGetOCRProResultAsyncFunction(ne)):k($.__innerGetOCRProResultAsyncFunction(ne))),p.License.isLTS()&&Ee.DWT.lcvrf(te)):p.isFunction(N)&&N(ne.code,ne.message,$.__innerGetOCRProResultAsyncFunction(ne)),Me.hideMask(we)},function(ne){Me.hideMask(we)}),!0},te.__innerGetRequestJson=function(we,Le,j,L,Y){var k,N="[{";for(N+='"id":"'+te.clientId+'",',N+='"method":"OCRProRecognize",',N+='"dllName":"'+Y+'",',N+='"productkey":"'+Ee.DWT.ProductKey+'",',N+=we==Ee.DWT.EnumDWT_OCRProType.OCRDT_File?'"inputType":"file",':'"inputType":"index",',N+='"input":[',k=0;k<Le.length;k++)N+=we==Ee.DWT.EnumDWT_OCRProType.OCRDT_File?'"'+Le[k]+'"':Le[k],k+1<Le.length&&(N+="|");if(N+="],",N+='"settings":{',N+='"recognitionMethod": "Page"',j&&(j.RecognitionModule&&j.RecognitionModule.length>0&&(N+=',"recognitionModule":"'+j.RecognitionModule+'"'),j.Languages&&j.Languages.length>0&&(N+=',"languages":"'+j.Languages+'"'),j.OutputFormat&&j.OutputFormat.length>0&&(N+=',"outputFormat":"'+j.OutputFormat+'"'),j.PDFVersion&&j.PDFVersion.length>0&&(N+=',"pdfVersion":"'+j.PDFVersion+'"'),j.PDFAVersion&&j.PDFAVersion.length>0&&(N+=',"pdfAVersion":"'+j.PDFAVersion+'"'),j.Redaction&&j.Redaction.FindText&&j.Redaction.FindText.length>0)){var $=parseInt(j.Redaction.FindTextFlags),ie=parseInt(j.Redaction.FindTextAction);if(!isNaN($)&&!isNaN(ie)){N+=',"redaction":{';var ee=j.Redaction.FindText;N+='"findText":"'+(ee=ee.replace(/\"/g,'\\"'))+'"',N+=',"findTextFlags":'+$,N+=',"findTextAction":'+ie,N+="}"}}for(N+="},",N+='"zones":[',k=0;k<L.length;k++)N+="["+L[k].left+","+L[k].top+","+L[k].right+","+L[k].bottom+"]",k+1<L.length&&(N+=",");return N+="],",(N+='"outputFile":""')+"}]"},te.__LoadImageFromBytesForDownloadInner=function(we,Le,j,L,Y,q,k,N,$){var ee,le,ie=te;le=we>=L?Le.slice(ee=q*L,Y):Le.slice(ee=we*q,(we+1)*q),ie.__LoadImageFromBytes(le,j,"",k,function(){we>=L?Ee.Lib.isFunction(N)&&N():ie.__LoadImageFromBytesForDownloadInner(we+=1,Le,j,L,Y,q,k,N,$)},function(){Ee.Lib.isFunction($)&&$()},ee,Y)},te.__LoadImageFromBytesForDownload=function(we,Le,j,L,Y,q){var k=te,N=2e6,$=we.size||we.length,ie=parseInt($/N);0==$%N&&(ie-=1),k.__LoadImageFromBytesForDownloadInner(0,we,Le,ie,$,N,L,Y,q)}}(te),we={OCRPro:{Settings:!1,Recognize:function(j,L,Y){var k,N,q=[],ee=te;if(ee._resetErr(),ee._isMobileMode())return ee._mobileNotSupport("Addon.OCRPro.Recognize");if(k=parseInt(j),p.isNaN(k)||!p.isNumber(k))return N=_(te,-2201,"Invalid parameter type.",j),p.isFunction(Y)?Y(N._errorCode,N._errorString,N):p.Errors.WebviewerError(te,N._errorString,N._errorCode),!1;var ne=te._ImgManager.convertClientIndexToServerId(k);if(-1==ne)return p.isFunction(Y)&&(p.Errors.IndexOutOfRange(te),N=_(te,te._errorCode,te._errorString,j),Y(N._errorCode,N._errorString,N)),!1;if(!p.License.checkProductKey(te,{OCRPro:!0},!0))return p.isFunction(Y)&&(N=_(te,te._errorCode,te._errorString,j),Y(N._errorCode,N._errorString,N)),!1;q.push(ne);var le=[],fe=this.Settings,xe=te.__innerGetRequestJson(Ee.DWT.EnumDWT_OCRProType.OCRDT_Index,q,fe,le,Le);return te.__innerIsOCRTrial(function(Pe){return Pe||p.License.isLTS()?te.__innerOCRReadFunction("OCRProRecognize",j,"",0,le,xe,L,Y):A(fe.LicenseChecker,te,"OCRProRecognize",j,"",0,le,xe,L,Y)},Y)},RecognizeRect:function(j,L,Y,q){var N,$,k=[],ne=te;if(ne._resetErr(),ne._isMobileMode())return ne._mobileNotSupport("Addon.OCRPro.RecognizeRect");if(N=parseInt(j),p.isNaN(N)||!p.isNumber(N))return $=_(te,-2201,"Invalid parameter type.",j),p.isFunction(q)?q($._errorCode,$._errorString,$):p.Errors.WebviewerError(te,$._errorString,$._errorCode),!1;var le=te._ImgManager.convertClientIndexToServerId(N),fe=te._ImgManager.GetImageWidth(N),xe=te.GetImageHeight(N);if(-1==le)return p.isFunction(q)&&(p.Errors.IndexOutOfRange(te),$=_(te,te._errorCode,te._errorString,j),q($._errorCode,$._errorString,$)),!1;if(!p.License.checkProductKey(te,{OCRPro:!0},!0))return p.isFunction(q)&&($=_(te,te._errorCode,te._errorString,j),q($._errorCode,$._errorString,$)),!1;if(fe>0&&xe>0)for(var Pe,De,je,ke,Ae,he,tt=0;tt<L.length;tt++)(De=(Pe=L[tt]).left)<0&&(De=0),(je=Pe.top)<0&&(je=0),(ke=Pe.right)<0&&(ke=0),(Ae=Pe.bottom)<0&&(Ae=0),De>ke&&(he=De,De=ke,ke=he),je>Ae&&(he=je,je=Ae,Ae=he),ke>fe&&(ke=fe),Ae>xe&&(Ae=xe),Pe.left=De,Pe.top=je,Pe.right=ke,Pe.bottom=Ae;k.push(le);var Ze=this.Settings,nt=te.__innerGetRequestJson(Ee.DWT.EnumDWT_OCRProType.OCRDT_Index,k,Ze,L,Le);return te.__innerIsOCRTrial(function(et){return et||p.License.isLTS()?te.__innerOCRReadFunction("OCRProRecognize",j,"",1,L,nt,Y,q):A(Ze.LicenseChecker,te,"OCRProRecognize",j,"",1,L,nt,Y,q)},q)},RecognizeFile:function(j,L,Y){var k,N,$,q=te;if(q._resetErr(),q._isMobileMode())return q._mobileNotSupport("Addon.OCRPro.RecognizeFile");if(0==j.length)return p.isFunction(Y)&&((k=Ee.Lib.NewOCRProResult(te))._errorCode=-2201,k._errorString="File name cannot be empty.",$=[],(N=Ee.Lib.NewErrorInfo()).input=j,N.message=k._errorString,N.page=0,$.push(N),k._errorlist=$,Y(k._errorCode,k._errorString,k)),!1;if(!p.License.checkProductKey(te,{OCRPro:!0},!0))return p.isFunction(Y)&&((k=Ee.Lib.NewOCRProResult(te))._errorCode=te._errorCode,k._errorString=te._errorString,$=[],(N=Ee.Lib.NewErrorInfo()).input=j,N.message=k._errorString,N.page=0,$.push(N),k._errorlist=$,Y(k._errorCode,k._errorString,k)),!1;var ie=Me.replaceLocalFilename(j),ee=[];ie.indexOf("|")>0?ee=ie.split("|"):ie.indexOf(";")>0?ee=ie.split(";"):ie.indexOf(",")>0&&(ee=ie.split(","));var ne=[];if(ee.length>0)for(var le=0;le<ee.length;le++)ne.push(ee[le]);else ne.push(ie);var fe=[],xe=this.Settings,Pe=te.__innerGetRequestJson(Ee.DWT.EnumDWT_OCRProType.OCRDT_File,ne,xe,fe,Le);te.__innerIsOCRTrial(function(De){return De||p.License.isLTS()?te.__innerOCRReadFunction("OCRProRecognize",-1,j,0,fe,Pe,L,Y):A(xe.LicenseChecker,te,"OCRProRecognize",-1,j,0,fe,Pe,L,Y)},Y)},RecognizeSelectedImages:function(j,L){var Y,q,k,N=te;if(N._resetErr(),N._isMobileMode())return N._mobileNotSupport("Addon.OCRPro.RecognizeSelectedImages");if(!p.License.checkProductKey(te,{OCRPro:!0},!0)){if(p.isFunction(L)){var $=Ee.Lib.NewOCRProResult(te);$._errorCode=te._errorCode,$._errorString=te._errorString,q=[],(k=Ee.Lib.NewErrorInfo()).input="",k.message=$._errorString,k.page=0,q.push(k),$._errorlist=q,L($._errorCode,$._errorString,$)}return!1}var ie=[],ee=this.Settings,ne=function(te){var Le,j,Me=[];return te._ImgManager.count()<=0||(Le=te._ImgManager.getCurrentImageIndex(),te._ImgManager.convertClientIndexToServerId(Le),j=te._ImgManager.getSelectedClientIndexArray(),p.isArray(j)&&p.each(j,function(L){var Y=te._ImgManager.convertClientIndexToServerId(L);Me.push(Y)})),Me}(te),le=te.__innerGetRequestJson(Ee.DWT.EnumDWT_OCRProType.OCRDT_Index,ne,ee,ie,Le);return te.__innerIsOCRTrial(function(fe){Y=fe||p.License.isLTS()?te.__innerOCRReadFunction("OCRProRecognize",-1,"",0,ie,le,j,L):A(ee.LicenseChecker,te,"OCRProRecognize",-1,"",0,ie,le,j,L)},L),Y},IsModuleInstalled:function(){var j=te;return j._resetErr(),j._isMobileMode()?j._mobileNotSupport("Addon.OCRPro.IsModuleInstalled"):""!=j._innerFun("GetAddOnVersion",Me.makeParams("proocr",Le))},Download:function(j,L,Y){var q=te;if(q._resetErr(),q._isMobileMode())return q._mobileNotSupport("Addon.OCRPro.Download");var N=function(){return p.isFunction(L)&&L(),!0},$=function(){return p.isFunction(Y)&&Y(q.ErrorCode,q.ErrorString),!1};if(!p.License.checkProductKey(q,{Core:!0})||!p.License.checkProductKey(q,{OCRPro:!0},!0))return $();if(this.IsModuleInstalled())return N(),!0;if(!j||""==j||!p.isString(j))return p.Errors.OCR_InvalidRemoteFilename(q),$(),!1;if(Me.isServerInvalid(q))return $(),!1;p.cancelFrome=2,p.showProgress(q,"Download",!0);var ee=!0;return q._OnPercentDone([0,-1,"Downloading OCR Resources...","http"]),p.isFunction(L)||(ee=!1),Me.loadHttpBlob(q,"get",j,ee,function(ne){q._OnPercentDone([0,-1,"Loading..."]),q.__LoadImageFromBytesForDownload(ne,102,"",ee,N,$)},function(){p.closeProgress("Download"),$()},function(ne){var le=0===ne.total?100:Math.round(100*ne.loaded/ne.total);[ne.loaded," / ",ne.total].join(""),q._OnPercentDone([0,le,"","http"])})}}},te.__addon=te.__addon||{},p.mix(te.__addon,we)}),Ee.WebTwain.Addon.OCRPro.NewOCRReadPara=function(te,Me,we,Le,j,L,Y,q,k,N){return new w(te,Me,we,Le,j,L,Y,q,k,N)},Ee.WebTwain.Addon.OCRPro.NewOCRError=function(){return new V},Ee.Lib.mix(Ee.Lib.Errors,{OCR_LicenseCheckerEmpty:function(te){var we="LicenseChecker cannot be empty.";te.errorString=we,te.responseText=Ce("false;-2601;"+we+";")},OCR_LicenseCheckerNotConnect:function(te){var we="Cannot connect to the LicenseChecker, please check and make sure it's set correctly.";te.errorString=we,te.responseText=Ce("false;-2602;"+we+";")},OCR_AccessDenied:function(te){var we="Access denied.";te.errorString=we,te.responseText=Ce("false;-2603;"+we+";")},OCR_LicenseCheckerError:function(te,Me){var Le="Error occured in '"+Me+"'.";te.errorString=Le,te.responseText=Ce("false;-2604;"+Le+";")},OCR_HTTPError:function(te,Me){var Le="HTTP Error "+Me+".";te.errorString=Le,te.responseText=Ce("false;-2605;"+Le+";")},OCR_LicenseCheckerUnauthorized:function(te,Me){var Le="You do not have permission to view this directory or page using the credentials you supplied (access denied due to Access Control Lists). Ask the Web server's administrator to give you access to '"+Me+"'.";te.errorString=Le,te.responseText=Ce("false;-2606;"+Le+";")},__last:!1});var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1)}function w(te,Me,we,Le,j,L,Y,q,k,N){var $=this;$.STWAIN=Me,$.AjaxFunctionUrl=te,$.FunctionName=we,$.ImageIndex=Le,$.FileNames=j,$.Type=L,$.AryZone=Y,$.JsonString=q,$.OnSuccess=k,$.OnFailure=N}function I(te,Me){var we="",Le=te.responseText;if(0==Le.length){var j=Ee.WebTwain.Addon.OCRPro.NewOCRError();Ee.Lib.Errors.OCR_LicenseCheckerError(j,Me.AjaxFunctionUrl),Le=j.responseText}we=function Ve(te){return function pe(te){var Me,we,Le,j,L,Y;for(Me="",Le=te.length,we=0;we<Le;)switch(j=te.charCodeAt(we++),j>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Me+=te.charAt(we-1);break;case 12:case 13:L=te.charCodeAt(we++),Me+=String.fromCharCode((31&j)<<6|63&L);break;case 14:L=te.charCodeAt(we++),Y=te.charCodeAt(we++),Me+=String.fromCharCode((15&j)<<12|(63&L)<<6|(63&Y)<<0)}return Me}(function se(te){var Me,we,Le,j,L,Y,q;for(Y=te.length,L=0,q="";L<Y;){do{Me=Z[255&te.charCodeAt(L++)]}while(L<Y&&-1==Me);if(-1==Me)break;do{we=Z[255&te.charCodeAt(L++)]}while(L<Y&&-1==we);if(-1==we)break;q+=String.fromCharCode(Me<<2|(48&we)>>4);do{if(61==(Le=255&te.charCodeAt(L++)))return q;Le=Z[Le]}while(L<Y&&-1==Le);if(-1==Le)break;q+=String.fromCharCode((15&we)<<4|(60&Le)>>2);do{if(61==(j=255&te.charCodeAt(L++)))return q;j=Z[j]}while(L<Y&&-1==j);if(-1==j)break;q+=String.fromCharCode((3&Le)<<6|j)}return q}(te))}(Le);var L=we.split(";");1==L.length?Me.OnFailure(-1,Le,Ee.Lib.NewOCRProResult()):"true"==L[0]?Me.STWAIN.__innerOCRReadFunction(Me.FunctionName,Me.ImageIndex,Me.FileNames,Me.Type,Me.AryZone,Me.JsonString,function(q,k,N){Ee.Lib.isUndefined(N)?Ee.Lib.isUndefined(k)?(Me.OnSuccess(q),M(Me.AjaxFunctionUrl,q.GetPageCount())):(Me.OnSuccess(q,k),M(Me.AjaxFunctionUrl,k.GetPageCount())):(Me.OnSuccess(q,k,N),M(Me.AjaxFunctionUrl,N.GetPageCount()))},Me.OnFailure):Me.OnFailure(L[1],L[2],Ee.Lib.NewOCRProResult())}function A(te,Me,we,Le,j,L,Y,q,k,N){return Q(te,"DTW_AjaxMethod=CheckLicense&Productkey="+Ce(Ee.DWT.ProductKey),I,Ee.WebTwain.Addon.OCRPro.NewOCRReadPara(te,Me,we,Le,j,L,Y,q,k,N))}function M(te,Me){Q(te,"DTW_AjaxMethod=WriteOCRCount&OCRCount="+Ce(Me+""),F,null)}function F(te,Me){}function V(){this.responseText="",this.errorString=""}function Q(te,Me,we,Le){var j=Ee.WebTwain.Addon.OCRPro.NewOCRError();if(""==te)return Ee.Lib.Errors.OCR_LicenseCheckerEmpty(j),alert(j.errorString),we(j,Le),!1;var L=function B(){var te=null,Me=window;try{te=new Me.ActiveXObject("Msxml2.XMLHTTP")}catch(we){try{te=new Me.ActiveXObject("Microsoft.XMLHTTP")}catch(Le){te=new XMLHttpRequest}}return te}();return L.open("POST",te,!0),L.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),L.onreadystatechange=function(){if(4==L.readyState){if(200!=L.status)return 401==L.status?(Ee.Lib.Errors.OCR_LicenseCheckerUnauthorized(j,Le.AjaxFunctionUrl),we(j,Le),!1):404==L.status?(Ee.Lib.Errors.OCR_LicenseCheckerNotConnect(j),alert(j.errorString),we(j,Le),!1):403==L.status?(Ee.Lib.Errors.OCR_AccessDenied(j),we(j,Le),!1):(Ee.Lib.Errors.OCR_HTTPError(j,L.status),we(j,Le),!1);null!=we&&"function"==typeof we&&we(L,Le)}},L&&Me&&L.send(Me),!0}function Ce(te){return function re(te){var Me,we,Le,j,L,Y;for(Le=te.length,we=0,Me="";we<Le;){if(j=255&te.charCodeAt(we++),we==Le){Me+=J.charAt(j>>2),Me+=J.charAt((3&j)<<4),Me+="==";break}if(L=te.charCodeAt(we++),we==Le){Me+=J.charAt(j>>2),Me+=J.charAt((3&j)<<4|(240&L)>>4),Me+=J.charAt((15&L)<<2),Me+="=";break}Y=te.charCodeAt(we++),Me+=J.charAt(j>>2),Me+=J.charAt((3&j)<<4|(240&L)>>4),Me+=J.charAt((15&L)<<2|(192&Y)>>6),Me+=J.charAt(63&Y)}return Me}(function ce(te){var Me,we,Le,j;for(Me="",Le=te.length,we=0;we<Le;we++)(j=te.charCodeAt(we))>=1&&j<=127?Me+=te.charAt(we):j>2047?(Me+=String.fromCharCode(224|j>>12&15),Me+=String.fromCharCode(128|j>>6&63),Me+=String.fromCharCode(128|j>>0&63)):(Me+=String.fromCharCode(192|j>>6&31),Me+=String.fromCharCode(128|j>>0&63));return Me}(te))}}),(Ee=self.Dynamsoft||{}).DWT=Ee.DWT||{},Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},Ee.WebcamVerForActiveX="15.0.0.0625",Ee.WebcamVerInName="15.0.0.0625",function(){for(var p=[Ee.DWT],n=0;n<1;n++){var o=p[n];o.EnumDWT_VideoRotateMode={VRM_NONE:0,VRM_90_DEGREES_CLOCKWISE:1,VRM_180_DEGREES_CLOCKWISE:2,VRM_270_DEGREES_CLOCKWISE:3,VRM_FLIP_VERTICAL:4,VRM_FLIP_HORIZONTAL:5},o.EnumDWT_VideoProperty={VP_BRIGHTNESS:0,VP_CONTRAST:1,VP_HUE:2,VP_SATURATION:3,VP_SHARPNESS:4,VP_GAMMA:5,VP_COLORENABLE:6,VP_WHITEBALANCE:7,VP_BACKLIGHTCOMPENSATION:8,VP_GAIN:9},o.EnumDWT_CameraControlProperty={CCP_PAN:0,CCP_TILT:1,CCP_ROLL:2,CCP_ZOOM:3,CCP_EXPOSURE:4,CCP_IRIS:5,CCP_FOCUS:6}}}(),Ee.Lib.WebcamErrors={InvalidParameter:function(p){p._errorCode=-10001,p._errorString="The parameter is invalid."},VideoNotPlayingWhenCapture:function(p){p._errorCode=-10002,p._errorString="To capture an image, the video must be playing."},VideoNotPlayingWhenGetURL:function(p){p._errorCode=-10003,p._errorString="To get the url for the current frame, the video must be playing."},Success:function(p){p._errorCode=0,p._errorString="Successful."}},function(p){function n(o){var h=this;h._Count=0,h._resultlist=[],h._stwain=o}n.prototype.GetCount=function(){return p.WebcamErrors.Success(this._stwain),this._Count-1},n.prototype.Get=function(o){var h=this;return h._resultlist.length-1<=o||o<0?(Ee.Lib.Errors.Webcam_InvalidIndex(h._stwain,"Get"),""):(p.WebcamErrors.Success(h._stwain),h._resultlist[o])},n.prototype.GetCurrent=function(){var o=this,h=o._resultlist.length;return 0==h?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,"GetCurrent"),""):(p.WebcamErrors.Success(o._stwain),o._resultlist[h-1])},p.NewWebcamValue=function(o){return new n(o)}}(Ee.Lib),function(p){function n(o){var h=this;h._Count=0,h._resultlist=[],h._stwain=o}n.prototype.GetValue=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),""):(p.WebcamErrors.Success(o._stwain),o._resultlist[0].current)},n.prototype.GetIfAuto=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),!1):(p.WebcamErrors.Success(o._stwain),"true"==o._resultlist[0].auto)},p.NewWebcamSetting=function(o){return new n(o)}}(Ee.Lib),function(p){function n(o){var h=this;h._Count=0,h._resultlist=[],h._stwain=o}n.prototype.GetMinValue=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),""):o._resultlist[0].min},n.prototype.GetMaxValue=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),""):o._resultlist[0].max},n.prototype.GetSteppingDelta=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),0):o._resultlist[0].step},n.prototype.GetDefaultValue=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),0):o._resultlist[0].defaultValue},n.prototype.GetIfAuto=function(){var o=this;return 0==o._resultlist.length?(Ee.Lib.Errors.Webcam_InvalidIndex(o._stwain,""),!1):"true"==o._resultlist[0].auto},p.NewWebcamMoreSetting=function(o){return new n(o)}}(Ee.Lib),Ee.AddonReady(function(p,n){p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(o){o._innerSetWebcamValue=function(h){var v=p.NewWebcamValue(o);return h&&p.isArray(h)&&(v._resultlist=h,v._Count=h.length),v},o._innerSetWebcamSetting=function(h){var v=p.NewWebcamSetting(o);return h&&p.isArray(h)&&(v._resultlist=h,v._Count=h.length),v},o._innerSetWebcamMoreSetting=function(h){var v=p.NewWebcamMoreSetting(o);return h&&p.isArray(h)&&(v._resultlist=h,v._Count=h.length),v}}),p.Addon_Events.push("OnFrameCaptured"),p.Addon_Events.push("OnCaptureSuccess"),p.Addon_Events.push("OnCaptureError")}),Ee.AddonReady(function(p,n){p.product.bHTML5Edition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(o){var h,v=p.html5.Funs,y=p.env.bMac?"DynamicWebcam_"+Ee.WebcamVerInName+".dylib":p.env.bLinux?"DynamicWebcam_"+Ee.WebcamVerInName+".so":o._b64bit?"DynamicWebcamx64_"+Ee.WebcamVerInName+".dll":"DynamicWebcam_"+Ee.WebcamVerInName+".dll";try{o._innerSend("GetAddOnVersion",v.makeParams("webcam",y),!0,!1,!1)}catch(_){}(h=o)._innerWebcamValueFunction=function(_,b){return _=this._innerFunRaw(_,b,!1,!1),this._innerSetWebcamValue(_)},h._innerWebcamSettingFunction=function(_,b){return _=this._innerFunRaw(_,b,!1,!1),this._innerSetWebcamSetting(_)},h._innerWebcamMoreSettingFunction=function(_,b){return _=this._innerFunRaw(_,b,!1,!1),this._innerSetWebcamMoreSetting(_)},h._OnCaptureSuccess=function(_){Ee.Lib.isFunction(this.__OnCaptureSuccess)&&this.__OnCaptureSuccess()},h._OnCaptureError=function(w){var b=w[1];w=w[2],Ee.Lib.isFunction(this.__OnCaptureError)&&this.__OnCaptureError(b,w)},h._OnFrameCaptured=function(_){var b,w=this,I=Ee.Lib;w.__videoPause||(b=(b=w.__videoQuality)||60,w.__videoDest&&w.__videoDest.UpdateVideoContainer(w.GetImageURL(-1,-1,-1,0,b))),I.isFunction(w.__OnFrameCaptured)&&w.__OnFrameCaptured(_)},h={Webcam:{IsModuleInstalled:function(){var _=o;return _._resetErr(),""!=_._innerFun("GetAddOnVersion",v.makeParams("webcam",y))},Download:function(_,b,w){function I(){return o.IfShowProgressBar&&p.closeProgress(null,"Download"),Ee.Lib.isFunction(b)&&b(),!0}function A(){return o.IfShowProgressBar&&p.closeProgress(null,"Download"),Ee.Lib.isFunction(w)&&w(o._errorCode,o._errorString),!1}var M=o;if(M._resetErr(),Ee.Lib.cancelFrome=2,!p.License.checkProductKey(o,{Webcam:!0},!0))return A();if(this.IsModuleInstalled())return I();if(!_||""==_)return Ee.Lib.Errors.Webcam_InvalidRemoteFilename(M),A();if(v.isServerInvalid(M))return A(),!1;o.IfShowProgressBar&&p.showProgress(M,"Download",!0);var F=!0;return M._OnPercentDone([0,-1,"Downloading Webcam Module...","http"]),Ee.Lib.isFunction(b)||(F=!1),v.loadHttpBlob(M,"get",_,F,function(V){M._OnPercentDone([0,-1,"Loading..."]),M.__LoadImageFromBytesV1(V,100,"",0,F,I,A)},function(){A()},function(V){var B=0===V.total?100:Math.round(100*V.loaded/V.total);[V.loaded," / ",V.total].join(""),M._OnPercentDone([0,B,"","http"])})},GetSourceList:function(){var _,b=o;return b._resetErr(),p.License.checkProductKey(b,{Webcam:!0},!0)?(_=b._innerFunRaw("GetWebcamSourceList"),0==b.ErrorCode&&_&&1<_.length&&_.splice(_.length-1,1),_):[]},SelectSource:function(_){var b=o;return b._resetErr(),!!p.License.checkProductKey(b,{Webcam:!0},!0)&&b._innerFun("SelectWebcam",v.makeParams(_))},CloseSource:function(){var _=o;return _._resetErr(),this._clear(),_._innerFun("StopCapture")},GetFramePartURL:function(){var _=o;return _._resetErr(),this._isPlaying()?_.GetImageURL(-1,-1,-1,!0,_.__videoQuality):(p.WebcamErrors.VideoNotPlayingWhenGetURL(_),"")},GetFrameURL:function(){var _=o;return _._resetErr(),this._isPlaying()?_.GetImageURL(-1,-1,-1,0,_.__videoQuality):(p.WebcamErrors.VideoNotPlayingWhenGetURL(_),"")},PlayVideo:function(_,b,w,I,A){function M(){return B._clear(),Ee.Lib.isFunction(A)&&A(o._errorCode,o._errorString),!1}var F=o,V=(F._resetErr(),60),B=this;return Ee.DWT.UseDefaultViewer?_?p.License.checkProductKey(o,{Webcam:!0},!0)?(F.__videoDest=_,F.__videoDest.ShowVideoContainer(!0),Ee.Lib.isFunction(w)&&(o.__OnFrameCaptured=w),o.__videoPause?(o.__videoPause=!1,p.isFunction(I)&&I()):(o.__videoPause=!1,o.__videoQuality=b?V=(V=+b)<1?60:V:V,o._innerSend("PlayVideo",v.makeParams(!0),!0,I,M)),!0):M():(Ee.Lib.Errors.ParameterCannotEmpty(o),M()):(Ee.Lib.Errors.CannotDoWhenNoViewerJS(o),!1)},PauseVideo:function(){var _=o;return _._resetErr(),this._isPlaying()&&(_.__videoPause=!0),!0},_clear:function(){var _=o;_.__videoPause=!1,_.__OnFrameCaptured=!1,_.__videoQuality=60,_.__videoDest&&_.__videoDest.ShowVideoContainer(!1),_.__videoDest=!1},_isPlaying:function(){return o.GetIfShowVideoContainer()},StopVideo:function(){var _=o,b=(_._resetErr(),this._clear(),_._innerFun("PlayVideo",v.makeParams(!1,0)));return _._innerFun("StopCapture"),b},CaptureImage:function(_,b){var w=o;if(w._resetErr(),!p.License.checkProductKey(w,{Webcam:!0},!0))return p.isFunction(b)&&b(w._errorCode,w._errorString),!1;function I(){v.hideMask(A),p.isFunction(b)&&b(w._errorCode,w._errorString)}var A="CaptureImage";v.showMask(A),w.__OnCaptureError=I,w._innerSend(A,v.makeParams(!1),!0,function(){v.hideMask(),0==w.ErrorCode?(v.hideMask(A),p.isFunction(_)&&setTimeout(_,0),p.License.isLTS()&&Ee.DWT.lcvrf(o)):I()},I)},GetMediaType:function(){var _=o;return _._resetErr(),_._innerWebcamValueFunction("GetMediaType")},SetMediaType:function(_){var b=o;return b._resetErr(),p.isString(_)?b._innerFun("SetMediaType",v.makeParams(_)):(p.Errors.InvalidValue(b),!1)},GetResolution:function(){var _;if((_=o)._resetErr(),(_=_._innerWebcamValueFunction("GetResolution"))&&_._resultlist){var b,w,I=_._resultlist,A=[],M=[];for(""==(w=0<I.length?I[I.length-1]:w)&&0<I.length&&(w=I[0]),b=0;b<I.length-1;b++){for(var F,V=(F=I[b]).toLowerCase().split("x"),B=(J=Q=B=void 0,{value:F,p1:parseInt(V[0]),p2:parseInt(V[1])}),Q=A,J=Q.length-1;0<=J&&Q[J].p1>=B.p1&&!(Q[J].p1==B.p1&&Q[J].p2<B.p2);)Q[J+1]=Q[J],J--;Q[J+1]=B}for(b=0;b<A.length;b++)M.push(F=A[b].value);w&&M.push(w),_._resultlist=M,M=A=null}return _},SetResolution:function(_){var b=o;return b._resetErr(),p.isNumber(_)||p.isString(_)?b._innerFun("SetResolution",v.makeParams(_)):(p.Errors.InvalidValue(b),!1)},GetFrameRate:function(){var _=o;return _._resetErr(),_._innerWebcamValueFunction("GetFrameRate")},SetFrameRate:function(_){var b=o;return b._resetErr(),p.isNumber(_)?o._innerFun("SetFrameRate",v.makeParams(_)):(p.Errors.InvalidValue(b),!1)},GetVideoPropertySetting:function(_){var b=o;return b._resetErr(),b._innerWebcamSettingFunction("GetWebcamVideoPropertySetting",v.makeParams(_))},GetVideoPropertyMoreSetting:function(_){var b=o;return b._resetErr(),b._innerWebcamMoreSettingFunction("GetWebcamVideoPropertyMoreSetting",v.makeParams(_))},SetVideoPropertySetting:function(_,b,w){var I=o;return I._resetErr(),I._innerFun("SetWebcamVideoPropertySetting",v.makeParams(_,b,w))},SetVideoRotateMode:function(_){var b=o;return b._resetErr(),b._innerFun("SetVideoRotateMode",v.makeParams(_))},GetCameraControlPropertySetting:function(_){var b=o;return b._resetErr(),b._innerWebcamSettingFunction("GetWebcamCameraControlSetting",v.makeParams(_))},GetCameraControlPropertyMoreSetting:function(_){var b=o;return b._resetErr(),b._innerWebcamMoreSettingFunction("GetWebcamCameraControlMoreSetting",v.makeParams(_))},SetCameraControlPropertySetting:function(_,b,w){var I=o;return I._resetErr(),I._innerFun("SetWebcamCameraControlPropertySetting",v.makeParams(_,b,w))}}},o.__addon=o.__addon||{},p.mix(o.__addon,h)})}),Ee.AddonReady(function(p,n){var o;p.product.bActiveXEdition&&p.DynamicLoadAddonFuns&&p.DynamicLoadAddonFuns.push(function(h){var v,y,_;if(!h.getSWebTwain()||!h.getSWebTwain().Addon)return!1;Ee.navInfoSync.bWin&&(o=(_=!Ee.navInfo.bOSx64||Ee.navInfo.bWOW64)?"DynamicWebcam_"+Ee.WebcamVerForActiveX+".dll":"DynamicWebcamx64_"+Ee.WebcamVerForActiveX+".dll"),v=h.getSWebTwain();try{v.GetAddOnVersion("webcam",o)}catch(b){}(_=h)._innerRead=function(b){var w;try{w=Ee.Lib.parse(b)}catch(I){}return w.result},_._innerWebcamValueFunctionPlugin=function(b){return b=this._innerRead(b),this._innerSetWebcamValue(b)},_._innerWebcamSettingFunctionPlugin=function(b){return b=this._innerRead(b),this._innerSetWebcamSetting(b)},_._innerWebcamMoreSettingFunctionPlugin=function(b){return b=this._innerRead(b),this._innerSetWebcamMoreSetting(b)},y={Webcam:{IsModuleInstalled:function(){var b=v.GetAddOnVersion("webcam",o);return p.setErrorString(h),""!=b},Download:function(b,w,I){function A(){return Ee.Lib.isFunction(w)&&w(),!0}function M(){return Ee.Lib.isFunction(I)&&I(h._errorCode,h._errorString),!1}return p.License.checkProductKey(h,{Webcam:!0},!0)?this.IsModuleInstalled()?A():b&&""!=b?(b=v.DownloadAddon(b),p.wrapperRet(h,b,A,M)):(Ee.Lib.Errors.Webcam_InvalidRemoteFilename(h),M()):M()},GetSourceList:function(){var b,w;return p.License.checkProductKey(h,{Webcam:!0},!0)?(b=v.GetWebcamSourceList(),w=[],p.setErrorString(h),0==h._errorCode&&(w=h._innerRead(b))&&1<w.length&&w.splice(w.length-1,1),w):[]},SelectSource:function(b){return!!p.License.checkProductKey(h,{Webcam:!0},!0)&&(b=v.SelectWebcam(b),p.setErrorString(h),b)},CloseSource:function(){h._playVideoDWT=null;var b=v.StopCapture();return p.setErrorString(h),b},GetFramePartURL:function(){var b;return this._isPlaying()?(b=v.GetDIB(-1),p.setErrorString(h),b):(p.WebcamErrors.VideoNotPlayingWhenGetURL(h),"")},GetFrameURL:function(){return""},PlayVideo:function(b,w,I,A,M){function F(){return h._playVideoDWT=null,Ee.Lib.isFunction(M)&&M(h.ErrorCode,h.ErrorString),!1}var V;return b&&b.getSWebTwain()?p.License.checkProductKey(h,{Webcam:!0},!0)?(V=b.getSWebTwain().CurrentHWND)?(h._playVideoDWT=b,setTimeout(function(){var B=v.RunWebcamCmd("PlayVideo",V,null,null,I);p.wrapperRet(h,B,A,F)},0),!0):(p.WebcamErrors.InvalidParameter(h),F()):F():(Ee.Lib.WebcamErrors.InvalidParameter(h),F())},PauseVideo:function(){return!0},StopVideo:function(){h._playVideoDWT=null;var b=v.RunWebcamCmd("StopVideo",0,null,null,null);return p.setErrorString(h),v.StopCapture(),b},CaptureImage:function(b,w){function I(){return Ee.Lib.isFunction(w)&&w(h.ErrorCode,h.ErrorString),!1}var A;return p.License.checkProductKey(h,{Webcam:!0},!0)?(A=v.RunWebcamCmd("Capture",0,function(){p.isFunction(b)&&setTimeout(b,0),p.License.isLTS()&&Ee.DWT.lcvrf(h)},I,null),p.setErrorString(h),A):I()},GetMediaType:function(){var b=h._innerWebcamValueFunctionPlugin(v.GetMediaType());return p.setErrorString(h),b},SetMediaType:function(b){return p.isString(b)?(b=v.SetMediaType(b),p.setErrorString(h),b):(p.Errors.InvalidValue(h),!1)},GetResolution:function(){var b=h._innerWebcamValueFunctionPlugin(v.GetResolution());if(p.setErrorString(h),b&&b._resultlist){var w,I,A=b._resultlist,M=[],F=[];for(0<A.length&&(I=A[A.length-1]),w=0;w<A.length-1;w++){for(var V,B=(V=A[w]).toLowerCase().split("x"),Q=(Z=J=Q=void 0,{value:V,p1:parseInt(B[0]),p2:parseInt(B[1])}),J=M,Z=J.length-1;0<=Z&&J[Z].p1>=Q.p1&&!(J[Z].p1==Q.p1&&J[Z].p2<Q.p2);)J[Z+1]=J[Z],Z--;J[Z+1]=Q}for(w=0;w<M.length;w++)F.push(V=M[w].value);I&&F.push(I),b._resultlist=F,F=M=null}return b},SetResolution:function(b){return p.isNumber(b)||p.isString(b)?(b=v.SetResolution(b),p.setErrorString(h),b):(p.Errors.InvalidValue(h),!1)},GetFrameRate:function(){var b=h._innerWebcamValueFunctionPlugin(v.GetFrameRate());return p.setErrorString(h),b},SetFrameRate:function(b){return p.isNumber(b)?(b=v.SetFrameRate(b),p.setErrorString(h),b):(p.Errors.InvalidValue(h),!1)},GetVideoPropertySetting:function(b){return b=v.GetWebcamVideoPropertySetting(b),p.setErrorString(h),h._innerWebcamSettingFunctionPlugin(b)},GetVideoPropertyMoreSetting:function(b){return b=v.GetWebcamVideoPropertyMoreSetting(b),p.setErrorString(h),h._innerWebcamMoreSettingFunctionPlugin(b)},SetVideoPropertySetting:function(b,w,I){return b=v.SetWebcamVideoPropertySetting(b,w,I),p.setErrorString(h),b},SetVideoRotateMode:function(b){return b=v.SetVideoRotateMode(b),p.setErrorString(h),b},GetCameraControlPropertySetting:function(b){return b=v.GetWebcamCameraControlSetting(b),p.setErrorString(h),h._innerWebcamSettingFunctionPlugin(b)},GetCameraControlPropertyMoreSetting:function(b){return b=v.GetWebcamCameraControlMoreSetting(b),p.setErrorString(h),h._innerWebcamMoreSettingFunctionPlugin(b)},SetCameraControlPropertySetting:function(b,w,I){return b=v.SetWebcamCameraControlPropertySetting(b,w,I),p.setErrorString(h),b},_isPlaying:function(){return!!h._playVideoDWT}}},h.Addon=h.Addon||{},p.mix(h.Addon,y)})}),function(p){p.DWT||(p.DWT={}),p.Lib||(p.Lib={})}(Ee=window.Dynamsoft||{}),Ee.aryAddonReadyFun=Ee.aryAddonReadyFun||[],Ee.AddonReady=Ee.AddonReady||function(p){Ee.aryAddonReadyFun.push(p)},Ee.AddonReady(function(p,n){Ee.DWT.EnumTransferErrorCode={TRANS_OK:0,TRANS_URL_MALFFORMAT:1,TRANS_FAILED_RESOLVE_PROXY:2,TRANS_FAILED_RESOLVE_HOST:3,TRANS_FAILED_CONNECT:4,TRANS_REMOTE_ACCESS_DENIED:5,TRANS_PARTIAL_FILE:6,TRANS_UPLOAD_FAILED:7,TRANS_READ_FAILED:8,TRANS_OUT_OF_MEMORY:9,TRANS_REMOTE_FULL_DISK:10,TRANS_OPERATION_TIMEOUT:11,TRANS_SERVICE_ERROR_404:12,TRANS_SERVICE_ERROR_500:13,TRANS_SERVICE_ERROR_503:14,TRANS_SERVICE_ERROR:15,TRANS_NOT_SEND:16,TRANS_WAITFOR_SEND:17,TRANS_SENDING:18,TRANS_PAUSE:19,TRANS_FINISHED:20,TRANS_NULL_POINTER:21,TRANS_INVALID_ID:22,TRANS_Failed:23,TRANS_SERVICE_ERROR_MORE_THAN_500:24,TRANS_SERVICE_ERROR_LESS_THAN_200:25,TRANS_SERVICE_ERROR_MORE_THAN_300:26,TRANS_CANNOT_FINDFILE:27,TRANS_ABORT:28,TRANS_NOT_FINISHED:29,TRANS_TASK_PREPARE_INIT:30,TRANS_TASK_INIT:31,TRANS_BEYOND_MAXSIZE:32};var o=Ee,h=p.guid(),v=5,y=Ee.dcp,_=[1,8,4,"0926"],b="upload_"+_.join(""),w={Version:"1.0",HttpVersion:"1.1",ServerUrl:"",FileName:"",VERIFYPEER:!1,VERIFYHOST:!1,BlockSize:10240,ThreadNum:1,OnUploadTransferPercentage:function(we,Le){},OnRunSuccess:function(we){},OnRunFailure:function(we,Le,j){}},I=0,A="",F=function(){I=-2,A="Upload failed because the url to upload to is invalid."},V=function(we,Le,j){I=-3,we?A="Upload cancelled.":(A=Le&&""!=Le?"Upload failed with error: "+Le:"Upload failed.",Le&&""!=Le&&(A=A+"("+j+")"))},Z=function(){I=-7,A="The file name is incorrect in the upload job."},ce=function(){I=0,A=""};function pe(){}function Ce(we){this.job=we}function Ve(we){this.job=we}pe.prototype={runWaiting:0,CreateJob:function(){var we={HttpHeader:{},documents:[],formFields:[],bEvent:!1};return p.mix(we,w),we.SourceValue=new Ce(we),we.FormField=new Ve(we),we},Run:function(we){var Le,j=this,L='""',Y=we.ServerUrl,q="";if(!p.isString(Y)||""==Y)return we.id=-1,F(),!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1),!1;if(!we.documents||!p.isArray(we.documents)||we.documents.length<=0)return we.id=-1,I=-4,A="Upload failed because the file to upload has invalid content.",!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1),!1;if(!we.ar||!we.cu){if(Ee.Lib.License.isLicenseMixed(null,!0)||Ee.Lib.License.reparseProductKey(),0!=(N=Ee.DWT.licenseException).code)return we.id=-1,I=N.code,A=N.message,!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1),!1;if(Ee.Lib.License.isLTS())return Ee.DWT.lglic(Ee.DWT.EnumInstance.dwt_desktop,"").then(function(ne){we.ar=ne.ar,we.cu=ne.cu,j.Run(we)}),!0;p.product.refProductKey&&(L='"'+p.product.refProductKey+'"')}for(we.Url=Y,delete we.ServerUrl,Le=0;Le<we.documents;Le++){var k=we.documents[Le];if(!p.isString(k.files)||""==k.files)return we.id=-1,Z(),!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1),!1;p.isString(k.remoteName)&&""!=k.remoteName||(k.remoteName="RemoteFile")}var N=we.SourceValue,$=(delete we.SourceValue,we.FormField),ie=(delete we.FormField,p.stringify(we));return ie=p.replaceAll(ie,'"',"'"),we.ServerUrl=Y,delete we.Url,we.SourceValue=N,we.FormField=$,Y=['{"id":"',h,'","method":"RunUploadFile","version":"',b,'","parameter":[',L,',"',ie,'"'],we.ar&&we.cu?(q=[',"',we.ar,'","',we.cu,'",0]}'].join(""),delete we.ar,delete we.cu,Y.push(q)):Y.push("]}"),N=Y.join(""),j.runWaiting++,Ee.FileUploader._sendCmd("RunUploadFile",N,function(ee){var ne;j.runWaiting--,ee&&((ne=ee.UploadId)&&0<ne?(we.id=ne,o.FileUploader.map[we.id]=we,o.FileUploader.ids.push(ee.UploadId),we.OnUploadTransferPercentage&&we.OnUploadTransferPercentage(we,0)):(ne=ee.errorcode,ee=ee.errorstring,ne&&ee?(I=ne,A=ee):(I=-6,A="Cannot create an upload job."),!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1)))},function(ee,ne,le){j.runWaiting--,o.FileUploader.parseHttpErrors(ee,ne,le),!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1)}),!0},Cancel:function(we){return!we.id||we.id<0?(I=-5,A="Invalid upload job id.",!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1),!1):(Ee.FileUploader._sendCmd("DeleteUploadTask",'{"id":"'+h+'","method":"DeleteUploadTask","version":"'+b+'","parameter":["'+we.id+'"]}',function(j){o.FileUploader.deleteJobById(we.id)},function(j,L,Y){o.FileUploader.parseHttpErrors(j,L,Y),!we.bEvent&&p.isFunction(we.OnRunFailure)&&(we.bEvent=!0,we.OnRunFailure(we,I,A),we.bEvent=!1)}),!0)},CancelAllUpload:function(){var we=o.FileUploader.ids,Le='{"id":"'+h+'","method":"DeleteUploadTask","version":"'+b+'","parameter":["'+we.join(",")+'"]}';return 0<this.runWaiting?(I=-8,A="Can not cancel all jobs when at least one job is still being created.",!1):(this.runWaiting<0&&(this.runWaiting=0),we.length<=0||Ee.FileUploader._sendCmd("DeleteUploadTask",Le,function(j){for(var L=0;L<we.length;L++)o.FileUploader.deleteJobById(we[L]);o.FileUploader.ids=[],o.FileUploader.map=[]},function(j,L,Y){o.FileUploader.parseHttpErrors(j,L,Y)}),!0)},OnUploadTransferPercentage:function(we,Le){},OnRunSuccess:function(we){},OnRunFailure:function(we,Le,j){}},(o.SourceValue=Ce).prototype.Add=function(we,Le,j){var L=this.job;p.isString(we)&&""!=we?(j=j||"RemoteFile",we=Ee.Lib.replaceAll(we,"\\\\","\\\\"),L.documents.push({files:[we],fileName:Le,remoteName:j})):(Z(),!L.bEvent&&p.isFunction(L.OnRunFailure)&&(L.bEvent=!0,L.OnRunFailure(L,I,A),L.bEvent=!1))},o.FormField=Ve,o.FileUploader={ids:[],map:{},port:18625,protocol:"https://",ip:"127.0.0.1",wsUrl:"",running:!(Ve.prototype.Add=function(we,Le){var j,L,Y=Le,q=we;if(null==Y&&(Y=""),!p.isString(q)||""==q||!p.isString(Y)||(Y=encodeURI(Y),-1<(q=encodeURI(q)).indexOf("'")||-1<Y.indexOf("'")))return!1;for(j=0;j<this.job.formFields.length;j++)if((L=this.job.formFields[j]).name==q)return L.value=Y,!0;return this.job.formFields.push({name:q,value:Y}),!0}),ws:null,nextLoopTime:600,deleteJobById:function(we){var Le;if(ce(),we){for(Le=0;Le<o.FileUploader.ids.length;Le++)if(we==o.FileUploader.ids[Le]){o.FileUploader.ids.splice(Le,1);break}var j=o.FileUploader.map[we];for(j.SourceValue.job=null,delete j.SourceValue,j.FormField.job=null,delete j.FormField,delete o.FileUploader.map[we],Le=j.documents.length-1;0<=Le;Le--)j.documents.splice(Le,1);for(Le=j.formFields.length-1;0<=Le;Le--)j.formFields.splice(Le,1);Ee.FileUploader._sendCmd("DeleteUploadTask",'{"id":"'+h+'","method":"DeleteUploadTask","version":"'+b+'","parameter":["'+we+'"]}')}},_sendCmdByWS:function(we,Le,j){var L=o.FileUploader.ws;return L&&L.readyState!=Ee.DWT.EnumDWT_WebsocketReadyState.CLOSING&&L.readyState!=Ee.DWT.EnumDWT_WebsocketReadyState.CLOSED||(L=Ee.DWT.NetManager.newWebsocket(o.FileUploader.wsUrl),o.FileUploader.ws=L),Ee.DWT.NetManager.postStringDataByWS(L,we).then(function(Y){(Y=p.parse(Y))&&"result"in Y?p.isFunction(Le)&&Le(Y.result):p.isFunction(j)&&j()},j),!0},_sendCmd:function(we,Le,j,L){return Ee.DWT.ConnectWithSocket?o.FileUploader._sendCmdByWS(Le,j,L):(we=[o.FileUploader.protocol,o.FileUploader.ip,":",o.FileUploader.port,"/dcp/",b,"/",we,"?type=1&dsver=",_.join(""),"&ts=",p.now()].join(""),p.ajax({url:we,method:"post",dataType:"json",processData:!1,data:Le,onSuccess:j,onError:L}))},parseHttpErrors:function(Y,Le,j){var L;2==(Y=Y&&p.isArray(Y)&&2<Y.length?(L=Y[1],Y[2]):(L=Le,j)).state&&0==Y.status?"abort"===Y.statusText?V(!0):F():V(!1,L,Y.status)},loadHttpBlob:function(we,Le,j,L,Y,q,k){we={method:we,url:Le,dataType:"blob",async:j,onSuccess:L,onError:function(N,$,ie){o.FileUploader.parseHttpErrors(N,$,ie),p.isFunction(Y)&&Y()}},p.isFunction(q)&&(we.beforeSend=function(N){N.addEventListener("progress",function($){delete $.totalSize,delete $.position,q($)},!1)}),p.ajax(we)},_OnPercentDone:function(){},Download:function(we,Le,j){var L;return p.isString(we)?o.FileUploader.loadHttpBlob("get",we,!!(L=function(){return I=-9,A="The zip file that contains the upload library (.dll) download failed.",p.isFunction(j)&&j(I,A),!1}),function(Y){y.loadZip(Y,100,Le,L)},L,!1):(I=-1,A="The zip file that contains the upload library (.dll) is invalid.",p.isFunction(j)&&j(I,A),!1)},Init:function(we,Le,j){if(ce(),!Ee.Lib.detect.bOK)return--v<=0?(p.isFunction(j)&&j(),void(v=5)):void setTimeout(function(){Ee.FileUploader.Init(we,Le,j)},300);function L(){var Y,q=Ee.navInfoSync.bSSL?(Y="https://",Ee.dcp.SSLPort):(Y="http://",Ee.dcp.Port);o.FileUploader.port=q,o.FileUploader.protocol=Y,o.FileUploader.ip=Ee.DWT.Host,o.FileUploader.wsUrl=Ee.DWT.NetManager.getWsUrl(Ee.DWT.Host,q),o.FileUploader.running=!0,p.isFunction(Le)&&Le(new pe),setTimeout(o.FileUploader.StatusLoop,500)}Ee.dcp.detect.bConnected?L():Ee.DWT.NetManager.checkModuleManager(L,function(){--v<=0?(p.isFunction(j)&&j(),v=5):setTimeout(function(){Ee.FileUploader.Init(we,Le,j)},500)})},Close:function(){var we;Ee.DWT.ConnectWithSocket&&(we=Ee.FileUploader.ws)&&(we.readyState!=Ee.DWT.EnumDWT_WebsocketReadyState.CLOSED&&we.readyState!=Ee.DWT.EnumDWT_WebsocketReadyState.CLOSING&&we.close(),Ee.FileUploader.ws=null),Ee.FileUploader.running=!1},VersionInfo:function(we,Le){return ce(),Ee.FileUploader._sendCmd("VersionInfo",'{"id":"'+h+'","method":"VersionInfo","version":"'+b+'","parameter":[]}',we,function(L,Y,q){o.FileUploader.parseHttpErrors(L,Y,q),p.isFunction(Le)&&Le(I,A)}),!0},StatusLoop:function(){return ce(),o.FileUploader.GetUploadStatus(),o.FileUploader.running&&setTimeout(o.FileUploader.StatusLoop,o.FileUploader.nextLoopTime),!0},GetUploadStatus:function(){var we;return ce(),o.FileUploader.ids.length<=0||(we='{"id":"'+h+'","method":"GetUploadStatus","version":"'+b+'","parameter":["'+o.FileUploader.ids.join(",")+'"]}',Ee.FileUploader._sendCmd("GetUploadStatus",we,function(Le){if(p.isArray(Le))for(var j=0;j<Le.length;j++){var L=($=Le[j]).id,Y=o.FileUploader.map[L],q=$.percentage,k=$.errorcode,N=$.response,$=$.errorstring;Y&&(k==Ee.DWT.EnumTransferErrorCode.TRANS_FINISHED?(Y.OnUploadTransferPercentage(Y,100,Me(N)),!Y.bEvent&&p.isFunction(Y.OnRunSuccess)&&(Y.bEvent=!0,Y.OnRunSuccess(Y,Me(N)),Y.bEvent=!1),o.FileUploader.deleteJobById(L)):k==Ee.DWT.EnumTransferErrorCode.TRANS_OK||k==Ee.DWT.EnumTransferErrorCode.TRANS_NOT_SEND||k==Ee.DWT.EnumTransferErrorCode.TRANS_WAITFOR_SEND||k==Ee.DWT.EnumTransferErrorCode.TRANS_SENDING||k==Ee.DWT.EnumTransferErrorCode.TRANS_PAUSE||k==Ee.DWT.EnumTransferErrorCode.TRANS_TASK_PREPARE_INIT||k==Ee.DWT.EnumTransferErrorCode.TRANS_TASK_INIT?Y.OnUploadTransferPercentage(Y,q,Me(N)):(!Y.bEvent&&p.isFunction(Y.OnRunFailure)&&(Y.bEvent=!0,Y.OnRunFailure(Y,k,$,Me(N)),Y.bEvent=!1),o.FileUploader.deleteJobById(L)))}},function(Le,j,L){})),!0}};var te=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function Me(we){for(var Le,j,L,Y,q=we.length,k=0,N="";k<q;){for(;Le=te[255&we.charCodeAt(k++)],k<q&&-1==Le;);if(-1==Le)break;for(;j=te[255&we.charCodeAt(k++)],k<q&&-1==j;);if(-1==j)break;N+=String.fromCharCode(Le<<2|(48&j)>>4);do{if(61==(L=255&we.charCodeAt(k++)))return N}while(L=te[L],k<q&&-1==L);if(-1==L)break;N+=String.fromCharCode((15&j)<<4|(60&L)>>2);do{if(61==(Y=255&we.charCodeAt(k++)))return N}while(Y=te[Y],k<q&&-1==Y);if(-1==Y)break;N+=String.fromCharCode((3&L)<<6|Y)}return N}}),function(){var n=620;Ee.OnWebTwainNotFoundOnWindowsCallback=function(h,v,y,_,b,w,I){Ee._show_install_dialog(h,{default:v},y,Ee.DWT.EnumDWT_PlatformType.enumWindow,_,b,w,I,!1)},Ee.OnWebTwainNotFoundOnLinuxCallback=function(h,v,y,_,b,w,I,A,M){M||(M=Ee.DWT.EnumDWT_PlatformType.enumLinux),Ee._show_install_dialog(h,{default:v,deb:v,rpm:y},_,M,b,w,I,A,!1)},Ee.OnWebTwainNotFoundOnMacCallback=function(h,v,y,_,b,w,I){Ee._show_install_dialog(h,{default:v},y,Ee.DWT.EnumDWT_PlatformType.enumMac,_,b,w,I,!1)},Ee.OnWebTwainNotFoundOnAndroidCallback=function(h,v,y,_){var b={default:"https://demo.dynamsoft.com/DWT/Resources/dist/DynamsoftServiceSetup.apk"},w=Math.random(),I=Ee.DWT.ServiceInstallerLocation;if(Ee.Lib.isString(I)&&I.length>0){var A="";"/"!=I[I.length-1]&&(A="/"),b.default=[I,A,"DynamsoftServiceSetup.apk"].join("")}b.openService="intent://dynamsoft.com/#Intent;scheme=http;package=com.dynamsoft.mobilescan;S.timestamp="+w+";end",Ee.DWT.Host="local.dynamsoft.com",Ee._show_android_install_dialog(b,_)},Ee.OnMobileNotSupportCallback=function(){var h=[];Ee.DWT?(h.push('<div class="ds-dwt-ui-dlg-android" style="padding-bottom:30px">'),h.push("Service Mode does not support your Operating System, please contact the site administrator."),h.push("</div>"),Ee.DWT.ShowMessage(h.join(""),{width:335,headerStyle:1,backgroundStyle:1})):console.log("The Dynamsoft namespace is missing")},Ee.OnHTTPCorsError=function(h){var v=["<div>",h,"</div>",'<div style="margin-top:10px">To fix the issue, please update your website to HTTPS or refer to <br /><a target="_blank" href="https://www.dynamsoft.com/web-twain/docs/faq/http-insecure-websites-in-chromium-browser.html?ver=latest">this article</a> for other workarounds.</div>'].join("");Ee.DWT.ShowMessage(v,{width:n,headerStyle:2})},Ee._show_install_dialog=function(h,v,y,_,b,w,I,A,M){var V,Q,F=Ee,J=Ee.DWT.EnumDWT_PlatformType,Z=_==J.enumLinux||_==J.enumEmbed||_==J.enumChromeOS||_==J.enumHarmonyOS;V=['<div class="dynamsoft-dwt-dlg-title">',M?"Please update your document scanning service":"Please download and install the Dynamic Web TWAIN service",'</div><div class="dynamsoft-dwt-dlg-title-error" style="display:none"></div>'],F.DWT?(Q=Z||Ee.navInfoSync.bFirefox?"RESTART":"REFRESH",V.push('<div class="dynamsoft-dwt-installdlg-iconholder"> '),V.push('<div class="dynamsoft-dwt-installdlg-splitline" style="left: 134px"></div>'),V.push('<div class="dynamsoft-dwt-installdlg-splitline" style="left: 328px"></div>'),V.push('<img style="margin: 0px 133px 0px 0px" src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAABqxJREFUaEPlm01y2zYUxwHJe6cniHMCU7K7tnoCK8uuYp+gzglsn8DOCapuuo1ygsjr2hKz6jLKtpvY61pA/g8ARZDiBwiCnMyYM5omKQnih/fw8L7I2Qu7eNe8o9GvJ/QOKUU0GPBX+s9swrl8ZIzH9Hch5JrzwVrK/59iXF3OKThwFEUHjA1PBgM21WAa0vWSkuDZQgg+Z+z5DvxYmHBXMOAoOnoHuAtMNrKnB4AvkOQjJArJcTV5IdgCcn4Fiat7cQ8WieMnDzDG6yyenAP+Qxzf45n2V2tggE4BeYOJYsL6AsAn/CAhsYCE1k2mCQ2B6g8mUvIzjHmYjskWUj6/b6vy3sBRdAx1ZZf4TQzkN0BexfFy1gSw6l6wQwv2LrCE+PF9s5wzITbXTRcyeY8X8Hh8fIMBMAmF+gSjcxESNL8IKTi7NIv7iMWFtJsvbiNg/eLhn1jtqZnUtRDPt6ENS5nUySByPryFqp+ae66Wy/vrJhrlDKxftvdRGyWSKp+GMiRNJkz3jsdjaNeAtIw0jFSc9raTNXcCJkOClf1MRwxZXSk3Z22NR1PIXTU/muLog73g+zj+Yhi031yga4GNGq00LLvDwJCs22q2hap73ghiTkcZQa9W96O6ZyqBac9CjSFZFhEsBlQW+We6jF1ZaysuZ8vlw3nV/CqBx+Ojj2SgjBpPfhbJFlhxnN3DhYYW75fL5W0ZdCkwYPEQ/0MbqA3BdurjttWaKBqfwWHBCaJ887dx/ADHZ/cqBCanAgbhs36YwRiEcevaQtU9D//gCvdcQiNxTm/eFGlkIfBodEz7lvbrNc45GiToNRodxRQgYL8Z5yXc8Jj7AmNThFY49x1g8o3h1GPvKlU+6GLfQhKSELGYtadE06VItNNIeZR3QXdeiNX/SoGAEOLcx3VzmWCXwPR+MMzA8A7Qf61WD2f2nDLAycbHjd9w44HL5H3u6RqYfAcEHV+1DXqmvbxO5pkBhv7DwWBRl9KlF3cNbEsZW/ODbSu2wPaqdLG3bE3oAzjdy1kPzALW5xgF71DnJBry0djaZ/oA1pp0RHmzfVutt8DY6OSTnnatzn2pdFatU+/LBv5OAUJ+k9eKy+OGviRsGeGt1ipg6+z6AnXOJOE8eGof6Q9YpYi+22d+DrifiKgv4KLto4DTDELWhNeKyvOGPoG1G8sPsVXJ64oNsHa68evEd86vS7/A2rdOgqCXCZxEGH2Fgn1KOAkZE+1VEk7P4PLA2XO7Fj7WL3CSyNBn8ctU6bzYfaSpffHhjSmDVKaDXCWsHQd+UpeYq5pvfruac3jrR+/Ej67wydFmAm/KEZdCuwBnc1T6SHGdi31fGt/rMDGo42EF3pRTKoWuA87CtktE5N9lgKlEubeiYjRcyzc+K5k84wJdBRwSNg155RO2hSrM28EDKu/8deKRdAldBhwS1vYg7VSPDazyQHWJbNeFqJJ0EXBo2Oxxm24LKwGgs5WuNRoX8DLoPHAXsKamrCIlaO0vSfbVTvFsQyn7Bhew6mNhm0HcGjIbuAtYmk+SbqYykR3y5pJ4OusROojIS5oMpF55cZ6WR9pZ4/yip8WEbK0pl6bVJZaqUoWvxG1ojKEtJsKYBDxkDjwtFe0WEwoS8dWlCl9gY0SUYYRkGSTbCax+T3mpqKDUos9ks9kzSew2sNY5/Tegf+9Csnrvbr1GdBVtonypqKSYpg0NkthzHNhvQ4DaY4xG4/+wbf6N45VqSwx16QL+kLoVSktFhcAmEKDOudoCc6jJhhjHLuCXJSNLq3euBeYQEw0xhmsBvxSYJpErMFdGQCEm7TtGVjjVBfxKYNuyNmkN8p24z3N2S5VL1aQW2BgCZP74oUus6zNp32dsyRbVgovGrQXWpl5ZPwvar8/RF6zoObvf0xWWxnECts5Qc1ypf2nc5xgCON/v6aLG9nsbAWtDlvY5Yl+jh5mhlbefLh/dhM6udG+2X79nY2Ct4mmfo1491eDp3cNcJ/mC3mzvfk8v4GRfFzVvSzmYrVb/3NVB1P1/Ul3G9k4gUfqsYKKWFb0nbZvQvYGTCZvmU1IzuKJG3mgMwyTxrQJ927D55Nr6ZD4QOUVcAcBtTzahPuHvtyF6s1sD2+DIS19gT+MbiPyHGurTHUqzqp5makrDf6g719Si1ccd2JfZi4J3fByC7SJmrotWpznBgO0XaV98gKZUTp/xJN3rdXNRksQizAGKBRHzUJD2izsBLiIjjwh7UgX+WmXFoxADk1x/Xvt+tOGwiplbegNuOrGu7v8BEbL8eSr8LDEAAAAASUVORK5CYII= alt="download">'),V.push('<img style="margin: 2px 133px 2px 0px" src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAB51JREFUaEPtW91V20gU1sje5yQVhK0AY3iPUwGkgiUVhFQQqCBQQZwKAhXEvIPtrSDeCgLPizX7ffPjGY1lz0iWDQ+rc3zg6Gd0v/s/916JbItHr3d0nOdZj6+QMhuYV70WYnFuinMPPI9zI/4timw6nd7dbIss0ebCvV5vL8s67wDyBBDw2+SQ1wB/nWXzW3BgtslK/rOtAIYkB5DQF/ysFNU7pJR/CyFAtJKckmCWPT0AACWbgUGQfvc1/weT1LN45gTP7PtEQjtG+F1A8maN5vA3ArwMVD5q4iRAFtfApdS17gE+gAk5geNHRohXmhlc++mzZVjddXl/I8BU3TzvfMHjp/ql8hH/X47Hd+dNiIg90+8fYV15ZoHj/2FRzCHx+qpeG3Cvd0iufwP3IQUNtCieLptKMwbWXqfU87wL0BkYrVT/ARL/OJ3eK5NJPWoBBthPeS4uzQtvpJyfNeFyKnFV91G7hOhcguHHvF4UEjTcX6WumQy43z/85lS4+DwejxXw5zr6/T6knX81JjUcj+8/ptASBUxVEqL7U8dO+Qhve1pXjVIIaXIPzQvefUjbhnpP4dDex0xrLWAfLGzmH6jwySYesgmo2DMMbVDxa6j4W4KeTO4O1j2zFrBVYwO2F+NejLhtXdeC6UwJmh58nXqvBOxshGo8H7w0yYbMo6QRKkc6dK32MZWAtW2IH8YLfngpNhvTkBS6lwAbtz/RcXb33thmb1BN2CZpsBmWHILx32OgrWbqOD0/CMPmEuCDg8MhXvQXHriZTO433ADEyHPXdWLRYehb+U7E3CRtAwY6sWNg+A4Mpz4VJcDkLtz8Tx1+5nRSs3SSm98Zhj68/7woCmZQDzYkciMCidGXRPNznfp2f2mTfKKU1WaFRwnwwcER4+0A5y+2lRdXscXTKoJi6JsFIXEBlnaKNd7Gsiudf2dfuOFAqHq/BDiQ7l4KJ5vLtKTKldIA8+FHsp4v2V6vf5rnOdR+WXIhLcZEoKHiFZIlJCR6a7mQ8HNJ10mibG84Lw2wN2S+D5bnq+wzBF0lZQXY6bx8RNBWnnFXh1XnMCJYwDAt4YM1RYV9qOotVJXmt/ZA8gSbp5Sf/qSpGMBaVXbtmUmpBQwnha3eeGipt4B9NJSqlGJIx5qSRpr1lce26yvA1o2HL41xr43rVu2wVslRwsRGsOF37h3yCtp3ZpMLShohBxua9YfVDitMBTi0l9gibV03iT8iQ3qSAxVFBshYnZYUmcLBb9JM84B96DQylWPbAJvigPheZ8sqT0iOJNBgbiz2mbiIVSrVFrCqdXzJpoIFnSztnHO9uqbnY/QAp6nIpoyIgXUpJt8kkCFJxOKMefVeE7DGZMkoMuxCWOfgB+dNQa16PgWsq66EqzTfptqkiqFsZ4DrgNXZlbxEqNyD+s6gxKNN8voA8OEvqosNzNuQbn2waZuEVFp1caA7YeymDasUji47dYE69z03WEurxblVwC8FrHFcSrCw4cMZi19tq/RLAutUGs29Nrw0Nx+mTToAE7H5EKgRyzNmUFVxdtVet46p1Lm3VS8N22D1nz2fpeMlgCVRJcDITdEyEZ9Sc1OLKqxBMTkXQo6KQsx0r1c8hFWTXUvWc1gu8WiaWrokPi0heC6wxmE5wG7zEG9TOOnaunVase85wZJmWy5SmwffZcNTq3JKzCHY/XOqGXhl0+TKY4yG1OtL20PNAV3HTd2F+PtnFdsW3UVNRlgpdJEgra6cCiblvsoCQHgytpAPeFWy72duTf1EjI6U66EwS0U8tidQNnkTW8gCVrlpUEqtSlWbRoIYHSnXAfg384FSEc8Ytq0hRYvwzob1aJLtCPjVRV/CuN9sUFx9OIXYTe/xyrSLCudiw+CCs2pCsaS50nl5JlAJFmxQBTftEPVoAnvM0J69TUGkPq8jQ4eMhnQrCvF1pUwgcHLo6JWL5H52Ve4U7NZhVUlXOVifY16SXdlqrOKua9Eo78w5iw+YrtuHbSOX1tN1qd4/VXqx+5KbaVrKul0K8q+hliB+/VGepgnvZWLCsSJXYI+t18Z1mwVG26V8meZOB8Wz9aMDZc3grKU8xTOYoWLRTcB7FxgO1SrfBojUNYJRjaWW7/8jD5aTwegA558WTeVUbu/yvtQuxto6lteonpl5iZ2qZyrDTAjiXMperLAfLdzZNgUWImjMWLwsSRvJ/jBgow22KGDDPWRhAj3ZZhOsqZKqe58/2Zs6AxIFbIlw4ar+BGtdICn3B5O9S9M6q9ZIBswFgglWhJ05p9NnKQS2dY8Jm6ij2fGmej2xWoB1nHYTrAYERoyerrYdb81GHrU33UFsOtlbG7BNTpCYn+uMTE+n439+AnDRliT9ddgqtWVf8z6MPszPm2hXI8CWGO0hu5hO16MJGniGyqX6/OamqdQpTdS5+c3TCb938kYQb5GrI1VtHik2AuyAq894IHF/JkNvJnBOfZOAdHOk//77aAnWDPtDfbGClHSgr2f8pqI0u8E2J36Q6DN/xhOqr+5A5JQIP8FR3yQ0PVjnxg/M2qxVGr6/FQmvAmVKwEpa7lM8iY25/hCLsZMFey1h+ymehALU+1KlDlP/Axl/TQ2HYDZNAAAAAElFTkSuQmCC alt="install">'),V.push('<img src=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAACBBJREFUaEPNW7tuG0cU3VkynQHbVdJF/gJTtLsEsIw06SQB7i0XqW1/gekuqSL3AUx/gaUvMAUknUXRboRUpj8gsNQEBkLu5Jx57ItLzswO9ViAEMXdmbln7p37XpFc4NXr3d9O06THJaRMtsxSt4TIf5vgtzP+jt9G/JtlyWQyeX94UWSJdU7c6/U2kqTzACB3AAGfmEseAPxBksyPsAPTmJnKY9cCGJzcAode4GO5qNaQUn4QQoBoxTnFwSSZnQEAOZtgg8D97i1+xyapsRizgzF3y0RCOkb4vATnzRzt4UcBXgQqzzVxEiCzA+BS4hp6YR+wCSmB48ONEDf1ZnDu2XO7YaHz8vlWgCm6adp5geF7elF5ju/74/H7QRsiXGP6/fuYVz6zwPF9mGVzcDxc1IMB93r3uOuvsfvgggaaZbP9ttx0gbX3yfU07QJ0go1Won8Gjj+ZTI7VkfG9ggAD7NM0FftmwUMp58/a7LIvcU3PUbqE6Oxjw7d5P8skaDh+5TunN+B+/97rQoSz5+PxWAG/qqvf74Pb6e/mSA3H4+MnPrQ4AVOUhOi+07ZTnkPb7oWKkQ8hbZ7h8YJ2H/JsQ7wnUGgPXUdrJeAyWJyZzxDhnRgN2QaUawxNG0T8ACL+PUGfnLzfXDVmJWArxgZsz7V7LuIu6r5mTGdC0NTgq8R7KeDijFCM51vXjbP1zSOnYSpH2nQt1zGNgPXZEG+NFty9LmfWJSE+dC8ANmr/RNvZMG1sRItjN1zE2fs4LvmjUIzwn+ewre08NE5kJVPb6flm3WwuAN7cvDcEwY8x4PDk5DgoAKCrCa35zhds03O+2nbVGsBAJbYNDG+AYa/8bAVwQbA6t1RS0xDi7XgQfQRtueUzVruNyQsQ9xv+/szAIRa0dn27n/SRnJHLKljhVQG8uXmf9paEvmzjF8cA5pp0UaFtR+sAXWxkMsLmP1wAXOPuRptzFAuYm2z0QA7aZVeXSZH2vTuQUHETzhIcEh1a5hyO5S4niwMsh1KmQ84jZXYDkvYHvn4npciJ9Tki5WeauKwAFzIvz2G0VUDe5tK2sHsSdobLPvHiqrPZ7JePHycE3+qC84SYnFye3aFOMoD7e2mavm6jmetUYAGEi8nI13YbMzgAURvVuSQ3/sbXr//+dHp6+rkVWgyyGjvLMpi78VABrv/oM7nOSnSZv1JJusu6mORDmuiDrwXp9arMVIAh68r6g+23fZRVNQlwWVCLdbRTIZHqGQ9dq5vEwRc+B6UohHXHmHCDkfbiFiTiE70pBhX0jiCOrXJXLmIX78tb0A/MdSEyUp4Uz6VzbdDLwOIukgW7wmoyTO5le61iYmxMBWcU3mMjIW98RS0cbDECAKYEXTY3q+YrYywB9vOby6YHATd2u0NuK80esusxgKkYIVVPfX39CmDYXxj55IHvblUBZ0Ot3ZMjwEWuyX/X4wBrd9RfKrWPTzpFHGC5zzCSnCUAcrruu8YAWzY2/BhWAGsFZA2zi8C6N2WjKz1OvsK5Zir1Qq9wwLlDNOEZViaJKtuHyib3UdeUElbBpj5zxD4TCpjrWZxrARwLIHR8FOBCxWtf07W4K0AwGQdVC4q9YDdReFtMsocCLnx8FPdilFY9yC9sdCzUYnyT9QgHvCYtvQjYTkwPTAxjYEPz7y0zc1GAQ414IdJyClf0ThmUS9xDNmCV5OEeEoVJz9d3WOJp+bmWWuPpGFOXLQUTZsoOI3BHPMxqovwLZ+9HXRX4Jug8S/nfOXNQ8PH/xFw/sFgmRKpyUuA6shgSiUVdpvU1pRXARfDgLlNYDpUmqDCNGVfsPAn7B5mKR20zmIxdUSj7FeO/tXMuSoe/zS8kAsFD2Ub5hocco8VX7gBYHmFpDqio5G/0ZiAD2aHPG5hBUVEQuKrqRZyLbRN5RCSEnAQmGFhXLsJDEt8mAdB0Hi/rDIfogsYEQP3HkAmvQmmF0NeY4rFJPAYB0Ly3QyZcBhihI8USee4wkdYhptiFLhiERHHLaAbgLyaoKZJ4Wqx1mIivXokAl0gTcFHNC9lCVj1U90404FKaNq+E5AFDyb56p07qMK7TGTYJfZWcaEzEr4PL1wlwE3eJsVZMs3Fjc6nRJZjXBbB3Mc2YKFUuhftwgGB+1wWyqrR01Q6KZwrHYS9k7OKzGelgYqJS/fOZE54givkCPoKjXKodCtVlB1dudevACq2oUqI+hLmeYRoYVmPD9Vz5fq1VY6Hku/aWB71hKXY3DSqm10EJkaEbQPVrQlr8rlYtD3bqWusA+5/yorLf8pf7lGlfMnY/sKnFklpqf5iafglnlv9yYerVyr0lTee2TJMzcWfLFFREAI2OnuvFacPZt6b04ywXOQFXK/LtOlgviuvloh5rY2AI+8lWSqETcF28+X9oB+tFAK519i506yxb0xswJ6h1sLKnit3p3lp0HcCN2UQXrX2nwq8mZtcOAqwVRNHBaiYZwDl45RKlWLCmzosCWjLQc7Xr7A0GbLQim7QRzdAj01VDfOcrAC9jgTWNh1/MPi6Em3mV8g3O66CNdLUCbInSGrKL3ioVVhrgyci8fnPYluu6naLDd57gwCR4Y8YCTY4YdsZYiijABXD1Go+KX8scYked7hDgZoiR/quzkkZS8qwmclVb+j4r/NW+EZY58QFHr/g1nrr46aJaSo6wLUG9k9D2YkcRPtisDB1B61OMa+HwMlDGt1VZzeJVPIlmbh1c0Hba/pDiVTwJfGFvqoRs6v/IOTkNXX2kbQAAAABJRU5ErkJggg== alt="scan">'),V.push('<div><span class="dynamsoft-dwt-installdlg-text" style="right: 160px">Download</span>'),V.push('<span class="dynamsoft-dwt-installdlg-text" style="right: 18px">Install</span>'),V.push('<span class="dynamsoft-dwt-installdlg-text" style="left: 140px">Scan</span>'),V.push("</div>"),V.push("</div>"),y&&Z&&(V.push('<div style="margin:10px 0 0 60px;">'),V.push('<div id="dwt-install-url-div">'),Ee.navInfo.bArm64||Ee.navInfo.bMips64||Ee.navInfoSync.bChromeOS||Ee.navInfoSync.bHarmonyOS||(V.push('<div><input id="dwt-install-url-deb" name="dwt-install-url" type="radio" onclick="Dynamsoft._dwt_change_install_url(\''+v.deb+'\')" checked="checked" /><label for="dwt-install-url-deb">64 bit .deb (For Ubuntu/Debian)</label></div>'),V.push('<div><input id="dwt-install-url-rpm" name="dwt-install-url" type="radio" onclick="Dynamsoft._dwt_change_install_url(\''+v.rpm+'\')" /><label for="dwt-install-url-rpm">64 bit .rpm (For Fedora)</label></div>')),V.push("</div></div>")),V.push('<div><a id="dwt-btn-install" target="_blank" href="'),V.push(v.default),V.push('"'),V.push(y?' html5="1"':' html5="0"'),V.push(' onclick="Dynamsoft._dcp_dwt_onclickDownloadButton()"><div class="dynamsoft-dwt-dlg-button">Download</div></a></div>'),y?b?(V.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left; padding-left: 80px">'),V.push("If you still see the dialog after installing the Dynamsoft Service, please<br />"),V.push("1. Add the website to the zone of trusted sites.<br />"),V.push("IE | Tools | Internet Options | Security | Trusted Sites.<br />"),V.push("2. Refresh your browser."),V.push("</div>")):Z?(V.push('<div class="dynamsoft-dwt-dlg-tail">'),V.push('<div class="dynamsoft-dwt-dlg-red">After the installation, please <strong>'+Q+"</strong>  your browser.</div>"),V.push("</div>")):V.push("<div><br /></div>"):(V.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left; padding-left: 80px">'),V.push("After the installation, please<br />"),V.push("1. Restart the browser<br />"),V.push('2. Allow "DynamicWebTWAIN" add-on to run by right clicking on the Information Bar in the browser.'),V.push("</div>")),F.DWT.ShowMessage(V.join(""),{width:620,headerStyle:1})):console.log("The Dynamsoft namespace is missing"),Ee.DWT&&Ee.DWT.OnWebTwainNotFound&&Ee.DWT.OnWebTwainNotFound()},Ee._dwt_change_install_url=function(h){var v=document.getElementById("dwt-btn-install");v&&(v.href=h)};var o=0;Ee._dcp_dwt_onclickDownloadButton=function(){var h=document.getElementById("dwt-install-url-div");h&&(h.style.display="none");var v=document.getElementById("dwt-btn-install");if(v)if("1"==v.getAttribute("html5")){var y=v.parentNode,_=document.createElement("div");_.id="dwt-btn-install",_.style.textAlign="center",_.style.paddingBottom="15px",_.style.fontSize="14px",_.innerHTML='Please proceed with the installation. Once done, <a href="javascript:void(0)" onclick="Dynamsoft._dcp_dwt_onclickInstallButton()">click here to verify completion.</a>',_.setAttribute("html5","1"),y.removeChild(v),y.appendChild(_)}else(y=v.parentNode).removeChild(v);return!0},Ee._dcp_dwt_onclickInstallButton=function(){var h=document.getElementById("dwt-install-url-div");h&&(h.style.display="none");var v=Ee.Lib.one(".dynamsoft-dwt-dlg-title");v&&v.style("display","");var y=Ee.Lib.one(".dynamsoft-dwt-dlg-title-error");y&&y.style("display","none");var _=document.getElementById("dwt-btn-install");return _&&setTimeout(function(){if("1"==_.getAttribute("html5")){var b=_.parentNode,w=document.createElement("div");w.id="dwt-btn-install",w.style.textAlign="center",w.style.paddingBottom="15px",w.style.fontSize="14px",w.innerHTML="Connecting to the service...",w.setAttribute("html5","1"),b.removeChild(_),b.appendChild(w),o=new Date,setTimeout(Ee._dwt_Reconnect,10)}else(b=_.parentNode).removeChild(_)},10),!0},Ee._dwt_Reconnect=function(){var h=Ee;if((new Date-o)/1e3>10){var v=document.getElementById("dwt-btn-install");v&&(v.innerHTML='Please make sure your installation is successful. <a href="javascript:void(0)" onclick="Dynamsoft._dcp_dwt_onclickInstallButton()">Click here to try reconnecting</a>.');var y=Ee.Lib.one(".dynamsoft-dwt-dlg-title");y&&y.style("display","none");var _=Ee.Lib.one(".dynamsoft-dwt-dlg-title-error");_&&(_.html("Failed to connect to the service!"),_.style("display",""))}else if(h.DWT){var b=500;navigator.userAgent.indexOf("Safari")>-1&&(b=2e3),h.DWT.CheckConnectToTheService(function(){Ee.DWT.CloseDialog(),Ee.DWT.ConnectToTheService()},function(){Ee.DWT.NeedCheckWebTwainBySocket()?Ee.DWT.CheckWebTwainBySocket(function(){Ee.OnHTTPCorsError()},function(){setTimeout(Ee._dwt_Reconnect,b)},function(){setTimeout(Ee._dwt_Reconnect,b)}):setTimeout(Ee._dwt_Reconnect,b)})}else console.log("The Dynamsoft namespace is missing")},Ee._show_android_install_dialog=function(h,v){var y;if(Ee.DWT.bNpm&&Ee.navInfoSync.bFileSystem)return Ee._show_online_download_dialog(h,bHTML5,iPlatform);y=[],Ee.DWT?(y.push('<div class="ds-dwt-ui-dlg-android">'),y.push("<div>Please download and "),y.push(v?"update":"install"),y.push(" the <strong>DYNAMSOFT SERVICE</strong> app via the </div>"),y.push('<div><a target="_blank" href="'),y.push(h.default),y.push('" onclick="Dynamsoft._dwt_ReconnectForAndroid()">direct APK download link</a>.</div>'),y.push("</div>"),y.push('<div class="dynamsoft-dwt-dlg-tail" style="text-align:left">'),y.push("If you have "),y.push(v?"updated":"installed"),y.push(" it, please click on the button below to initiate the connection."),y.push('<a target="_blank" href="'),y.push(h.openService),y.push('" onclick="Dynamsoft._dwt_ReconnectForAndroid()"><div class="dynamsoft-dwt-dlg-button-android">Open Service</div></a>'),y.push("</div>"),y.push("</div>"),Ee.DWT.ShowMessage(y.join(""),{width:335,headerStyle:1,backgroundStyle:1})):console.log("The Dynamsoft namespace is missing"),Ee.DWT&&Ee.DWT.OnWebTwainNotFound&&Ee.DWT.OnWebTwainNotFound()},Ee._dwt_ReconnectForAndroid=function(){Ee.DWT.CheckConnectToTheService(function(h){h?(Ee.DWT.CloseDialog(),Ee.DWT.ConnectToTheService()):setTimeout(Ee._dwt_ReconnectForAndroid,500)},function(){setTimeout(Ee._dwt_ReconnectForAndroid,500)})},Ee.OnWebTwainNeedUpgradeCallback=function(h,v,y,_,b,w,I,A){Ee._show_install_dialog(h,v,y,_,b,w,I,A,!0,!0)},Ee.OnWebTwainNeedUpgradeOnAndroidCallback=function(h,v,y){Ee.OnWebTwainNotFoundOnAndroidCallback(h,v,y,!0)},Ee.OnLTSLicenseError=function(h,v){var y="";(-2440==v||-2441==v||-2443==v||-2446==v||h.indexOf("Internet connection")>-1||h.indexOf("Storage")>-1)&&(y='<div>You can register for a free 30-day trial <a href="https://www.dynamsoft.com/customer/license/trialLicense?product=dwt&deploymenttype=js" target="_blank" class="dynamsoft-major-color">here</a>. Make sure to select the product Dynamic Web TWAIN.</div>'),Ee.DWT.ShowMessage([h,y].join(""),{width:n,headerStyle:2})},Ee.OnLTSConnectionWarning=function(){var h=["Warning: You are seeing this dialog because Dynamic Web TWAIN has failed to connect to the License Tracking Server. ","A cached authorization is being used, and you can continue to use the software as usual. ","Please get connected to the network as soon as possible. ",Ee.DWT.isPublicLicense()?'<a class="dynamsoft-major-color" href="https://www.dynamsoft.com/company/contact/">Contact Dynamsoft</a> ':"Contact the site administrator ","for more information."].join("");Ee.DWT.ShowMessage(h,{width:n,caption:"Warning",headerStyle:2})},Ee.OnLTSPublicLicenseWarning=function(h){Ee.DWT.ShowMessage(h,{width:n,caption:"Warning",headerStyle:2})},Ee.OnLicenseExpiredWarning=function(h,v,y){var _,b,w='<a target="_blank" href="https://www.dynamsoft.com/store/dynamic-web-twain/#DynamicWebTWAIN">online store</a>',I="https://www.dynamsoft.com/customer/license/trialLicense?product=dwt&utm_source=in-product";v>5||!y||(v>0?(b="Warning",_=['<div style="padding:0 0 10px 0">Kindly note your trial key is expiring in ',v<=1?"1 day":parseInt(v)+" days",". Two quick steps to extend your trial:</div>",'<div style="margin:0 0 0 10px">1. <a target="_blank" href="',I,'">Request a new trial key</a> and follow the instructions to set the new key</div>','<div style="margin:0 0 0 10px">2. Refresh your scan page and try again</div>','<div style="padding:0">If you are ready to purchase a full license, please go to the ',w,".</div>"].join("")):_=['<div style="padding:0">Sorry. Your product key has expired on ',h,". You can purchase a full license at the ",w,".</div>",'<div style="padding:0">Or, you can try requesting a new product key at <a target="_blank" href="',I,'">this page</a>.</div>'].join(""),_&&Ee.DWT.ShowMessage(_,{width:n,caption:b,headerStyle:2}))},Ee.OnLicenseError=Ee.OnLicenseError||function(h,v){Ee.DWT.ShowMessage(h,{width:n,headerStyle:2})},Ee.OnCorsConfigError=function(h){var v=[h," Please contact the Administrator to configure 'Access-Control-Allow-Origin'."].join("");Ee.DWT.ShowMessage(v,{width:n,headerStyle:2})},Ee._show_online_download_dialog=function(h,v,y){var A,M,F,b=Ee.DWT.JSVersion.split(","),w=b[0]+"."+b[1],I=location.pathname;I=I.substring(0,I.lastIndexOf("/")+1),y==Ee.DWT.EnumDWT_PlatformType.enumLinux&&(arm64||mips64)&&(arm64?h.default=getDebPath("arm64"):mips64&&(h.default=getDebPath("mips64el"))),A=["https://www.dynamsoft.com/web-twain/install-dynamsoft-service/?productId=1000001","&downloadLink=https://demo.dynamsoft.com/DWT/Resources/dist/DynamsoftServiceSetup_",w,".",F=h.default.substr(h.default.length-3)].join(""),M=Ee.Lib.Path.normalize([I,h.default].join("")),y==Ee.DWT.EnumDWT_PlatformType.enumWindow&&0==M.indexOf("/")&&(M=M.substr(1)),Ee.DWT.ShowMessage(['<div class="dynamsoft-dwt-ltsdlg-body" style="padding:0 20px 20px 20px">',"<div>To support document scanning, please complete one-time installation of the DynamsoftServiceSetup.",F," on this machine.</div>","<div>You can download the file via this trust site:</div>",'<div><a id="dwt-btn-install" target="_blank" href="',A,'"><div class="dynamsoft-dwt-dlg-button">Open Site</div></a></div>','<div style="word-break: break-word;">Or, go to <br />',M," if the file exists.</div>","<div>After the installation, please <strong>REFRESH</strong>  your browser.<br /></div>","</div>"].join(""),{width:620,headerStyle:1,closeButton:!1})}}(),Ee.DWT.AutoLoad=!1,Ee.DWT.IfAddMD5InUploadHeader=!1,Ee.DWT.IfConfineMaskWithinTheViewer=!1;const Io=Ee;let QMe=(()=>{class p{constructor(){this.showDiv=!1}getShowDiv(){return this.showDiv}setShowDiv(o){this.showDiv=o}toggleShowDiv(){this.showDiv=!this.showDiv}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275prov=dr({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function ZMe(p,n){1&p&&(Qt(0,"div",5),hr(1,"div",6),Yt())}const e4e=function(){return["/barcode-reader"]};function t4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,e4e)),no(1),Fc("> ",o.name," ")}}const n4e=function(){return["/barcode-scanner"]};function i4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,n4e)),no(1),Fc("> ",o.name," ")}}const r4e=function(){return["/file-detection"]};function o4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,r4e)),no(1),Fc("> ",o.name," ")}}const s4e=function(){return["/camera-detection"]};function a4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,s4e)),no(1),Fc("> ",o.name," ")}}const l4e=function(){return["/mrz-reader"]};function c4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,l4e)),no(1),Fc("> ",o.name," ")}}const u4e=function(){return["/mrz-scanner"]};function d4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,u4e)),no(1),Fc("> ",o.name," ")}}const h4e=function(){return["/document-viewer"]};function f4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,h4e)),no(1),Fc("> ",o.name," ")}}const p4e=function(){return["/acquire-image"]};function g4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,p4e)),no(1),Fc("> ",o.name," ")}}const m4e=function(){return["/image-editor"]};function v4e(p,n){if(1&p&&(Qt(0,"a",9),Bn(1),Yt()),2&p){const o=Ru().$implicit;Pr("title",o.name+" details")("routerLink",Nd(3,m4e)),no(1),Fc("> ",o.name," ")}}function y4e(p,n){if(1&p&&(Qt(0,"p"),Bn(1),Yt()),2&p){const o=Ru().$implicit;no(1),Fc("Description: ",o.description,"")}}function _4e(p,n){if(1&p&&(Qt(0,"div")(1,"h3")(2,"div"),ll(3,t4e,2,4,"ng-template",8),Yt(),Qt(4,"div"),ll(5,i4e,2,4,"ng-template",8),Yt(),Qt(6,"div"),ll(7,o4e,2,4,"ng-template",8),Yt(),Qt(8,"div"),ll(9,a4e,2,4,"ng-template",8),Yt(),Qt(10,"div"),ll(11,c4e,2,4,"ng-template",8),Yt(),Qt(12,"div"),ll(13,d4e,2,4,"ng-template",8),Yt(),Qt(14,"div"),ll(15,f4e,2,4,"ng-template",8),Yt(),Qt(16,"div"),ll(17,g4e,2,4,"ng-template",8),Yt(),Qt(18,"div"),ll(19,v4e,2,4,"ng-template",8),Yt()(),ll(20,y4e,2,1,"p",4),Yt()),2&p){const o=n.$implicit;no(3),Pr("ngIf","reader"===o.id),no(2),Pr("ngIf","scanner"===o.id),no(2),Pr("ngIf","file-detection"===o.id),no(2),Pr("ngIf","camera-detection"===o.id),no(2),Pr("ngIf","mrz-reader"===o.id),no(2),Pr("ngIf","mrz-scanner"===o.id),no(2),Pr("ngIf","document-viewer"===o.id),no(2),Pr("ngIf","acquire-image"===o.id),no(2),Pr("ngIf","image-editor"===o.id),no(1),Pr("ngIf",o.description)}}function C4e(p,n){if(1&p&&(Qt(0,"div")(1,"h2"),Bn(2,"Examples"),Yt(),ll(3,_4e,21,10,"div",7),Yt()),2&p){const o=Ru();no(3),Pr("ngForOf",o.products)}}let b4e=(()=>{class p{constructor(o){this.sharedService=o,this.isLoading=!1,this.products=WIe,this.inputText="",this.processedText="",this.placeholderText="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ=="}activate(){var o=this;return Fe(function*(){o.isLoading=!0,o.processedText=o.inputText.toUpperCase(),Mo.engineResourcePaths={std:qc("assets/dynamsoft-capture-vision-std/"),dip:qc("assets/dynamsoft-image-processing/"),core:qc("assets/dynamsoft-core/"),license:qc("assets/dynamsoft-license/"),cvr:qc("assets/dynamsoft-capture-vision-router/"),dbr:qc("assets/dynamsoft-barcode-reader/"),dce:qc("assets/dynamsoft-camera-enhancer/"),ddn:qc("assets/dynamsoft-document-normalizer/"),dlr:qc("assets/dynamsoft-label-recognizer/"),dcp:qc("assets/dynamsoft-code-parser/"),dnn:qc("assets/dynamsoft-capture-vision-dnn/"),dlrData:qc("assets/dynamsoft-label-recognizer-data/")};try{let h=""===o.inputText?o.placeholderText:o.inputText;yield ro.initLicense(h,{executeNow:!0}),Lp.Core.engineResourcePath=qc("assets/dynamsoft-document-viewer/engine/"),yield Lp.Core.init(),Lp.setProcessingHandler("imageFilter",new Lp.ImageFilter),o.sharedService.setShowDiv(!0),Io.DWT.ProductKey=h,Io.DWT.ResourcesPath="assets/dynamic-web-twain",Io.DWT.UseLocalService=!0}catch(h){console.log(h)}o.isLoading=!1})()}get showDiv(){return this.sharedService.getShowDiv()}}return p.\u0275fac=function(o){return new(o||p)(Jt(QMe))},p.\u0275cmp=Dl({type:p,selectors:[["app-product-list"]],decls:10,vars:4,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["href","https://www.dynamsoft.com/customer/license/trialLicense/?product=dcv&package=cross-platform","target","_blank"],["type","text",3,"ngModel","placeholder","ngModelChange"],[3,"click"],[4,"ngIf"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"],[4,"ngFor","ngForOf"],[3,"ngIf"],[3,"title","routerLink"]],template:function(o,h){1&o&&(ll(0,ZMe,2,0,"div",0),Qt(1,"div")(2,"div"),Bn(3," Get a License key from "),Qt(4,"a",1),Bn(5,"here"),Yt()(),Qt(6,"input",2),oi("ngModelChange",function(y){return h.inputText=y}),Yt(),Qt(7,"button",3),oi("click",function(){return h.activate()}),Bn(8,"Activate SDK"),Yt()(),ll(9,C4e,4,1,"div",4)),2&o&&(Pr("ngIf",h.isLoading),no(6),Pr("ngModel",h.inputText)("placeholder",h.placeholderText),no(3),Pr("ngIf",h.showDiv))},directives:[WT,GT,BX,OM,zY,Hb],styles:[""]}),p})();class m1{initOverlay(n){this.overlay=n,this.context=this.overlay.getContext("2d")}updateOverlay(n,o){this.overlay&&(this.overlay.width=n,this.overlay.height=o,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(n,o){if(this.context){let h=n.points;this.globalPoints=h,this.context.beginPath(),this.context.moveTo(h[0].x,h[0].y),this.context.lineTo(h[1].x,h[1].y),this.context.lineTo(h[2].x,h[2].y),this.context.lineTo(h[3].x,h[3].y),this.context.lineTo(h[0].x,h[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let v=[h[0].x,h[1].x,h[2].x,h[3].x],y=[h[0].y,h[1].y,h[2].y,h[3].y];v.sort(function(w,I){return w-I}),y.sort(function(w,I){return I-w}),this.context.fillText(o,v[0],y[0]+50)}}setPoints(n){this.globalPoints=n,this.overlay.addEventListener("mousedown",o=>this.updatePoint(o,this.context,this.overlay)),this.overlay.addEventListener("touchstart",o=>this.updatePoint(o,this.context,this.overlay)),this.drawQuad(this.context,this.overlay)}updatePoint(n,o,h){if(!this.globalPoints)return;let v=this.globalPoints;function y(I){let A=h.getBoundingClientRect(),M=h.clientWidth/h.width,F=h.clientHeight/h.height,V=I instanceof MouseEvent?I.clientX:I.touches[0].clientX,B=I instanceof MouseEvent?I.clientY:I.touches[0].clientY;return M<F?(V-=A.left,B=B-A.top-(h.clientHeight-h.height*M)/2,V/=M,B/=M):(V=V-A.left-(h.clientWidth-h.width*F)/2,B-=A.top,V/=F,B/=F),{x:Math.round(V),y:Math.round(B)}}let b=y(n),w=this;for(let I=0;I<v.length;I++)if(Math.abs(v[I].x-b.x)<10&&Math.abs(v[I].y-b.y)<10){let A=function(F){b=y(F),v[I].x=b.x,v[I].y=b.y,w.drawQuad(o,h)},M=function(){h.removeEventListener("mousemove",A),h.removeEventListener("mouseup",M),h.removeEventListener("touchmove",A),h.removeEventListener("touchend",M)};h.addEventListener("mousemove",A),h.addEventListener("mouseup",M),h.addEventListener("touchmove",A),h.addEventListener("touchend",M);break}}drawQuad(n,o){let h=this.globalPoints;if(h&&!(h.length<4)){n.clearRect(0,0,o.width,o.height),n.strokeStyle="#00ff00",n.lineWidth=2;for(let v=0;v<h.length;v++)n.beginPath(),n.arc(h[v].x,h[v].y,5,0,2*Math.PI),n.stroke();n.beginPath(),n.moveTo(h[0].x,h[0].y),n.lineTo(h[1].x,h[1].y),n.lineTo(h[2].x,h[2].y),n.lineTo(h[3].x,h[3].y),n.lineTo(h[0].x,h[0].y),n.stroke()}}}let x4e=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new m1}ngOnInit(){var o=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){o.cvr=yield gr.createInstance(),o.isLoaded=!0})()}ngOnDestroy(){var o;try{null===(o=this.cvr)||void 0===o||o.dispose()}catch(h){}}onChange(o){let v=o.currentTarget.files;if(v){let y=v.item(0);if(y){let _=new FileReader;_.onload=b=>{let w=document.getElementById("image");if(w){w.src=b.target.result;const I=new Image;I.onload=A=>{this.overlayManager.updateOverlay(I.width,I.height),this.cvr&&this.cvr.capture(y,"ReadBarcodes_Balance").then(M=>{console.log(M);let F=[],V=document.getElementById("result");try{let Q,J=M.items;if(J.length>0){for(var B=0;B<J.length;++B){if(J[B].type!==pr.CRIT_BARCODE)continue;let Z=J[B];F.push(Z.text),Q=Z.location,console.log(Q),this.overlayManager.drawOverlay(Q,Z.text)}V&&(V.innerHTML=F.join(", "))}else V&&(V.innerHTML=F.join(", "))}catch(Q){alert(Q)}})},I.src=b.target.result}},_.readAsDataURL(y)}}}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-barcode-reader"]],decls:6,vars:0,consts:[["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(o,h){1&o&&(Qt(0,"input",0),oi("change",function(y){return h.onChange(y)}),Yt(),Qt(1,"div"),hr(2,"a",1),Yt(),Qt(3,"div",2),hr(4,"img",3)(5,"canvas",4),Yt())},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),p})(),w4e=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new m1}ngOnInit(){var o=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){yield o.initBarcodeScanner()})()}ngOnDestroy(){var o,h;this.isDestroyed=!0;try{null===(o=this.cvr)||void 0===o||o.dispose(),null===(h=this.cameraEnhancer)||void 0===h||h.dispose()}catch(v){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let o=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(o.width,o.height)}}initBarcodeScanner(){var o=this;return Fe(function*(){var h,v,y,_;const b=yield js.createInstance();o.cameraEnhancer=yield Ci.createInstance(b),o.isLoaded=!0;let w=document.getElementById("videoContainer");if(w){w.append(b.getUIElement()),null===(v=null===(h=b.getUIElement().shadowRoot)||void 0===h?void 0:h.querySelector(".dce-sel-camera"))||void 0===v||v.setAttribute("style","display: none"),null===(_=null===(y=b.getUIElement().shadowRoot)||void 0===y?void 0:y.querySelector(".dce-sel-resolution"))||void 0===_||_.setAttribute("style","display: none");let I=yield o.cameraEnhancer.getAllCameras();if(o.listCameras(I),o.cvr=yield gr.createInstance(),o.isDestroyed||(o.cvr.setInput(o.cameraEnhancer),o.cvr.addResultReceiver({onCapturedResultReceived:A=>{o.overlayManager.clearOverlay();let M=[],F=document.getElementById("result");try{let B,Q=A.items;if(Q.length>0){for(var V=0;V<Q.length;++V){if(Q[V].type!==pr.CRIT_BARCODE)continue;let J=Q[V];M.push(J.text),B=J.location,console.log(B),o.overlayManager.drawOverlay(B,J.text)}F&&(F.innerHTML=M.join(", "))}}catch(B){alert(B)}}}),o.cvr.addResultReceiver({onDecodedBarcodesReceived:A=>{!A.barcodeResultItems.length||console.log(A)}}),o.cameraEnhancer.on("played",()=>{o.updateResolution()}),yield o.openCamera(),o.isDestroyed)||(yield o.cvr.startCapturing("ReadSingleBarcode"),o.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var o=this;return Fe(function*(){if(o.overlayManager.clearOverlay(),o.videoSelect){let h=o.videoSelect.value;o.cameraEnhancer&&(yield o.cameraEnhancer.selectCamera(h),yield o.cameraEnhancer.open())}})()}listCameras(o){for(var h=0;h<o.length;++h){var v=o[h],y=document.createElement("option");y.value=v.deviceId,y.text=v.label,this.cameraInfo[v.deviceId]=v,this.videoSelect&&this.videoSelect.appendChild(y)}}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-barcode-scanner"]],decls:8,vars:0,consts:[[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"]],template:function(o,h){1&o&&(Qt(0,"div",0)(1,"label",1),Bn(2,"Video source: "),Yt(),Qt(3,"select",2),oi("change",function(){return h.openCamera()}),Yt()(),Qt(4,"div",3),hr(5,"div",4)(6,"canvas",5),Yt(),hr(7,"div",6))},styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),p})(),S4e=(()=>{class p{constructor(){this.isLoaded=!1,this.points=[],this.overlayManager=new m1}ngOnDestroy(){var o;try{null===(o=this.cvr)||void 0===o||o.dispose()}catch(h){}}ngOnInit(){var o=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){o.cvr=yield gr.createInstance(),o.isLoaded=!0})()}onRadioChange(o){var h=this;if(!this.cvr)return;let v=o.target,y=jh.ICM_COLOUR;"binary"===v.value?y=jh.ICM_BINARY:"grayscale"===v.value?y=jh.ICM_GRAYSCALE:"color"===v.value&&(y=jh.ICM_COLOUR);let _=this.cvr;Fe(function*(){let b=yield _.getSimplifiedSettings("NormalizeDocument_Default");b.documentSettings.colourMode=y,yield h.cvr.updateSettings("NormalizeDocument_Default",b),h.normalize(h.currentFile,h.points)})()}normalize(o,h){var v=this;return Fe(function*(){if(v.cvr){let y=yield v.cvr.getSimplifiedSettings("NormalizeDocument_Default");y.roi.points=h,y.roiMeasuredInPercentage=!1,yield v.cvr.updateSettings("NormalizeDocument_Default",y),v.cvr.capture(o,"NormalizeDocument_Default").then(_=>{if(0===_.items.length)return;let b=_.items[0];document.getElementById("normalizedImage").src=b.toImage("image/jpeg").src})}})()}onChange(o){var h=this;let y=o.currentTarget.files;if(y){let _=y.item(0);if(_){this.currentFile=_;let b=new FileReader;b.onload=w=>{let I=document.getElementById("image");if(I){I.src=w.target.result;const A=new Image;A.onload=function(){var M=Fe(function*(F){if(h.overlayManager.updateOverlay(A.width,A.height),h.cvr){let V=yield h.cvr.capture(_,"DetectDocumentBoundaries_Default");V.items.length>0&&(h.points=V.items[0].location.points,h.overlayManager.setPoints(h.points))}});return function(F){return M.apply(this,arguments)}}(),A.src=w.target.result}},b.readAsDataURL(_)}}}rectify(){var o=this;return Fe(function*(){yield o.normalize(o.currentFile,o.points)})()}save(){return Fe(function*(){let h=document.getElementById("normalizedImage").src;const v=document.createElement("a");v.href=h,v.download=Date.now()+"",document.body.appendChild(v),v.click(),document.body.removeChild(v)})()}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-file-detection"]],decls:24,vars:2,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["type","file","title","file","id","file","accept","image/*",3,"change"],[3,"click"],[1,"container"],["id","imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","resultview",1,"imageview"],["id","normalizedImage","alt",""]],template:function(o,h){1&o&&(Qt(0,"span",0),Bn(1,"Loading Library..."),Yt(),hr(2,"br"),Qt(3,"div",1)(4,"label",2)(5,"input",3),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(6,"Black & White "),Yt(),Qt(7,"label",4)(8,"input",5),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(9," Grayscale "),Yt(),Qt(10,"label",6)(11,"input",7),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(12," Color "),Yt()(),Qt(13,"input",8),oi("change",function(y){return h.onChange(y)}),Yt(),Qt(14,"button",9),oi("click",function(){return h.rectify()}),Bn(15,"Rectify"),Yt(),Qt(16,"button",9),oi("click",function(){return h.save()}),Bn(17,"Save"),Yt(),Qt(18,"div",10)(19,"div",11),hr(20,"img",12)(21,"canvas",13),Yt(),Qt(22,"div",14),hr(23,"img",15),Yt()()),2&o&&(Pr("hidden",h.isLoaded),no(11),Pr("checked",!0))},styles:["#imageview[_ngcontent-%COMP%]{position:relative;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}.container[_ngcontent-%COMP%]{align-items:center;border:3px solid rgb(255,255,255)}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();const d8="VideoCapture Component Destroyed";let T4e=(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isNormalized=!0,this.captured=[],this.isDestroyed=!1,this.points=[],this.isDetecting=!1,this.overlayManager=new m1}ngOnDestroy(){var o,h;this.isDestroyed=!0;try{null===(o=this.cvr)||void 0===o||o.dispose(),null===(h=this.cameraEnhancer)||void 0===h||h.dispose()}catch(v){}}ngOnInit(){var o=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){var h,v,y,_;o.cameraView=yield js.createInstance(),o.cameraEnhancer=yield Ci.createInstance(o.cameraView),o.isLoaded=!0;let b=document.getElementById("videoContainer");if(b){b.append(o.cameraView.getUIElement()),null===(v=null===(h=o.cameraView.getUIElement().shadowRoot)||void 0===h?void 0:h.querySelector(".dce-sel-camera"))||void 0===v||v.setAttribute("style","display: none"),null===(_=null===(y=o.cameraView.getUIElement().shadowRoot)||void 0===y?void 0:y.querySelector(".dce-sel-resolution"))||void 0===_||_.setAttribute("style","display: none");let w=yield o.cameraEnhancer.getAllCameras();if(o.listCameras(w),o.cvr=yield gr.createInstance(),o.isDestroyed)throw Error(d8);o.cvr.setInput(o.cameraEnhancer);let I=yield o.cvr.getSimplifiedSettings("DetectDocumentBoundaries_Default");if(I.capturedResultItemTypes|=pr.CRIT_ORIGINAL_IMAGE,yield o.cvr.updateSettings("DetectDocumentBoundaries_Default",I),o.cvr.addResultReceiver({onCapturedResultReceived:A=>{o.overlayManager.clearOverlay();try{let V=A.items;if(V.length>0)for(var F=0;F<V.length;++F)if(V[F].type===pr.CRIT_DETECTED_QUAD)o.detectedResult=V[F],o.points=o.detectedResult.location.points,o.overlayManager.drawOverlay(o.detectedResult.location,"");else if(V[F].type===pr.CRIT_ORIGINAL_IMAGE&&!o.isNormalized){o.isNormalized=!0;let B=V[F];o.currentData=B.imageData,o.normalize(B.imageData,o.points),o.toggleDetection();break}}catch(V){throw V}}}),o.cameraEnhancer.on("played",()=>{o.updateResolution()}),yield o.openCamera(),o.isDestroyed||o.isDestroyed)throw Error(d8)}})()}openCamera(){var o=this;return Fe(function*(){if(o.overlayManager.clearOverlay(),o.videoSelect){let h=o.videoSelect.value;o.cameraEnhancer&&(yield o.cameraEnhancer.selectCamera(o.cameraInfo[h]),yield o.cameraEnhancer.open())}})()}listCameras(o){for(var h=0;h<o.length;++h){var v=o[h],y=document.createElement("option");y.value=v.deviceId,y.text=v.label,this.cameraInfo[v.deviceId]=v,this.videoSelect&&this.videoSelect.appendChild(y)}}onRadioChange(o){var h=this;if(!this.cvr)return;let v=o.target,y=jh.ICM_COLOUR;"binary"===v.value?y=jh.ICM_BINARY:"grayscale"===v.value?y=jh.ICM_GRAYSCALE:"color"===v.value&&(y=jh.ICM_COLOUR);let _=this.cvr;Fe(function*(){let b=yield _.getSimplifiedSettings("NormalizeDocument_Default");b.documentSettings.colourMode=y,yield h.cvr.updateSettings("NormalizeDocument_Default",b),h.normalize(h.currentData,h.points)})()}normalize(o,h){var v=this;return Fe(function*(){if(v.cvr){let y=yield v.cvr.getSimplifiedSettings("NormalizeDocument_Default");y.roi.points=h,y.roiMeasuredInPercentage=!1,yield v.cvr.updateSettings("NormalizeDocument_Default",y),v.cvr.capture(o,"NormalizeDocument_Default").then(_=>{if(0===_.items.length)return;let b=_.items[0],w=document.getElementById("normalizedImage");w.width=b.imageData.width,w.height=b.imageData.height;const I=w.getContext("2d");null==I||I.drawImage(b.toCanvas(),0,0)})}})()}captureDocument(){this.isNormalized=!1}toggleDetection(){var o,h,v;this.isDetecting?(this.isDetecting=!1,null===(o=this.cvr)||void 0===o||o.stopCapturing(),null===(h=this.cameraView)||void 0===h||h.clearAllInnerDrawingItems(),this.overlayManager.clearOverlay(),document.getElementById("detectButton").textContent="Start Detection"):(this.isDetecting=!0,document.getElementById("detectButton").textContent="Stop Detection",null===(v=this.cvr)||void 0===v||v.startCapturing("DetectDocumentBoundaries_Default"))}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let o=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(o.width,o.height)}}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-camera-detection"]],decls:28,vars:2,consts:[["id","document-scanner"],["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["for","videoSource"],["id","videoSource",3,"change"],["id","detectButton",3,"click"],["id","captureButton",3,"click"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],[1,"container"],["id","resultview"],["id","normalizedImage"]],template:function(o,h){1&o&&(Qt(0,"div",0)(1,"span",1),Bn(2,"Loading Library..."),Yt(),hr(3,"br"),Qt(4,"div",2)(5,"label",3)(6,"input",4),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(7,"Black & White "),Yt(),Qt(8,"label",5)(9,"input",6),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(10," Grayscale "),Yt(),Qt(11,"label",7)(12,"input",8),oi("change",function(y){return h.onRadioChange(y)}),Yt(),Bn(13," Color "),Yt()(),Qt(14,"div")(15,"label",9),Bn(16,"Video Source: "),Qt(17,"select",10),oi("change",function(){return h.openCamera()}),Yt()(),Qt(18,"button",11),oi("click",function(){return h.toggleDetection()}),Bn(19,"Start Detection"),Yt(),Qt(20,"button",12),oi("click",function(){return h.captureDocument()}),Bn(21,"Capture Document"),Yt()(),Qt(22,"div",13),hr(23,"div",14)(24,"canvas",15),Yt(),Qt(25,"div",16)(26,"div",17),hr(27,"canvas",18),Yt()()()),2&o&&(no(1),Pr("hidden",h.isLoaded),no(11),Pr("checked",!0))},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}#normalizedImage[_ngcontent-%COMP%]{width:20vw;top:60%;position:absolute;z-index:2}button[_ngcontent-%COMP%]{margin:4px}"]}),p})();function I4e(p,n){1&p&&(Qt(0,"div",8),hr(1,"div",9),Yt())}let E4e=(()=>{class p{constructor(){this.isLoaded=!1,this.overlayManager=new m1}ngOnInit(){var o=this;this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){try{yield Hu.loadSpec("MRTD_TD1_ID"),yield Hu.loadSpec("MRTD_TD2_FRENCH_ID"),yield Hu.loadSpec("MRTD_TD2_ID"),yield Hu.loadSpec("MRTD_TD2_VISA"),yield Hu.loadSpec("MRTD_TD3_PASSPORT"),yield Hu.loadSpec("MRTD_TD3_VISA"),yield Ex.loadRecognitionData("MRZ"),o.cvr=yield gr.createInstance(),o.parser=yield cE.createInstance();let h=yield o.cvr.initSettings("assets/template.json");console.log(h)}catch(h){alert(h)}o.isLoaded=!0})()}ngOnDestroy(){var o;try{null===(o=this.cvr)||void 0===o||o.dispose()}catch(h){}}onChange(o){var h=this;let v=this.parser;const y=o.currentTarget;let _=document.getElementById("detection_result"),b=y.files;if(b){let w=b.item(0);if(w){let I=new FileReader;I.onload=A=>{let M=document.getElementById("image");if(M){M.src=A.target.result;const F=new Image;_.value="",F.onload=V=>{this.overlayManager.updateOverlay(F.width,F.height),this.cvr&&this.cvr.capture(w,"ReadMRZ").then(function(){var B=Fe(function*(Q){let J=[];try{let re=Q.items;if(re.length>0)for(var Z=0;Z<re.length;++Z){if(re[Z].type!==pr.CRIT_TEXT_LINE)continue;let se=re[Z];h.overlayManager.drawOverlay(se.location,""),J.push(se.text),_.value=J.join("")+"\n";let pe=yield null==v?void 0:v.parse(se.text);_.value+=JSON.stringify(nJ(pe))+"\n";break}}catch(re){alert(re)}0===J.length&&(_.value="No MRZ detected.")});return function(Q){return B.apply(this,arguments)}}())},F.src=A.target.result}},I.readAsDataURL(w)}}}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-mrz-reader"]],decls:10,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["type","file","title","file","id","file","accept","image/*",3,"change"],["id","file_container",1,"container"],[1,"row"],["id","imageview",1,"imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","detection_result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(o,h){1&o&&(ll(0,I4e,2,0,"div",0),Qt(1,"div")(2,"input",1),oi("change",function(y){return h.onChange(y)}),Yt()(),Qt(3,"div",2)(4,"div",3)(5,"div",4),hr(6,"img",5)(7,"canvas",6),Yt()()(),Qt(8,"div"),hr(9,"textarea",7),Yt()),2&o&&Pr("ngIf",!h.isLoaded)},directives:[WT],styles:[".imageview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}.imageview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%;height:100%;object-fit:contain}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"]}),p})();function D4e(p,n){1&p&&(Qt(0,"div",9),hr(1,"div",10),Yt())}const A4e=[{path:"",component:b4e},{path:"barcode-reader",component:x4e},{path:"barcode-scanner",component:w4e},{path:"file-detection",component:S4e},{path:"camera-detection",component:T4e},{path:"mrz-reader",component:E4e},{path:"mrz-scanner",component:(()=>{class p{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new m1}ngOnInit(){var o=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),Fe(function*(){yield Hu.loadSpec("MRTD_TD1_ID"),yield Hu.loadSpec("MRTD_TD2_FRENCH_ID"),yield Hu.loadSpec("MRTD_TD2_ID"),yield Hu.loadSpec("MRTD_TD2_VISA"),yield Hu.loadSpec("MRTD_TD3_PASSPORT"),yield Hu.loadSpec("MRTD_TD3_VISA"),yield Ex.loadRecognitionData("MRZ"),o.cvr=yield gr.createInstance(),o.parser=yield cE.createInstance();let h=yield o.cvr.initSettings("assets/template.json");console.log(h),yield o.initBarcodeScanner()})()}ngOnDestroy(){var o,h;this.isDestroyed=!0;try{null===(o=this.cvr)||void 0===o||o.dispose(),null===(h=this.cameraEnhancer)||void 0===h||h.dispose()}catch(v){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let o=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(o.width,o.height)}}initBarcodeScanner(){var o=this;return Fe(function*(){var h,v,y,_,b,w,I;const A=yield js.createInstance();o.cameraEnhancer=yield Ci.createInstance(A);let M=document.getElementById("videoContainer");if(M){M.append(A.getUIElement()),null===(v=null===(h=A.getUIElement().shadowRoot)||void 0===h?void 0:h.querySelector(".dce-sel-camera"))||void 0===v||v.setAttribute("style","display: none"),null===(_=null===(y=A.getUIElement().shadowRoot)||void 0===y?void 0:y.querySelector(".dce-sel-resolution"))||void 0===_||_.setAttribute("style","display: none");let F=yield o.cameraEnhancer.getAllCameras();if(o.listCameras(F),o.isDestroyed||(null===(b=o.cvr)||void 0===b||b.setInput(o.cameraEnhancer),null===(w=o.cvr)||void 0===w||w.addResultReceiver({onCapturedResultReceived:(V=Fe(function*(B){var Q;o.overlayManager.clearOverlay();let J=[],Z=document.getElementById("result");try{let se,ce=B.items;if(ce.length>0)for(var re=0;re<ce.length;++re){if(ce[re].type!==pr.CRIT_TEXT_LINE)continue;let pe=ce[re];J.push(pe.text),se=pe.location,o.overlayManager.drawOverlay(se,"");let Ce=yield null===(Q=o.parser)||void 0===Q?void 0:Q.parse(pe.text);Z&&(Z.innerHTML=JSON.stringify(nJ(Ce))+"\n");break}}catch(se){alert(se)}}),function(Q){return V.apply(this,arguments)})}),o.cameraEnhancer.on("played",()=>{o.updateResolution()}),yield o.openCamera(),o.isDestroyed)||(yield null===(I=o.cvr)||void 0===I?void 0:I.startCapturing("ReadMRZ"),o.isDestroyed))throw Error("VideoCapture Component Destroyed");o.isLoaded=!0}var V})()}openCamera(){var o=this;return Fe(function*(){if(o.overlayManager.clearOverlay(),o.videoSelect){let h=o.videoSelect.value;o.cameraEnhancer&&(yield o.cameraEnhancer.selectCamera(h),yield o.cameraEnhancer.open())}})()}listCameras(o){for(var h=0;h<o.length;++h){var v=o[h],y=document.createElement("option");y.value=v.deviceId,y.text=v.label,this.cameraInfo[v.deviceId]=v,this.videoSelect&&this.videoSelect.appendChild(y)}}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-mrz-scanner"]],decls:11,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],[1,"container"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],["id","result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(o,h){1&o&&(ll(0,D4e,2,0,"div",0),Qt(1,"div",1)(2,"label",2),Bn(3,"Video source: "),Yt(),Qt(4,"select",3),oi("change",function(){return h.openCamera()}),Yt()(),Qt(5,"div",4)(6,"div",5),hr(7,"div",6)(8,"canvas",7),Yt()(),Qt(9,"div"),hr(10,"textarea",8),Yt()),2&o&&Pr("ngIf",!h.isLoaded)},directives:[WT],styles:["#videoview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:200px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loading-indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #fff;border-radius:50%;animation:spin 1s linear infinite;background:linear-gradient(to right,#FF0000 0%,#FF8000 17%,#FFFF00 33%,#00FF00 50%,#00FFFF 67%,#0080FF 83%,#0000FF 100%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),p})()},{path:"document-viewer",component:(()=>{class p{constructor(){}ngOnInit(){const o=Lp.Elements.getTooltip();o.DisplayMode="Display Mode",o.AnnotationSet="Add Annotation",Lp.Elements.setTooltip(o);let h=Lp.getDefaultUiConfig("editViewer",{includeAnnotationSet:!0});this.editViewer=new Lp.EditViewer({container:"document_container",uiConfig:h})}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-document-viewer"]],decls:1,vars:0,consts:[["id","document_container"]],template:function(o,h){1&o&&hr(0,"div",0)},styles:["#document_container[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;left:0}"]}),p})()},{path:"acquire-image",component:(()=>{class p{constructor(){this.sourceList=[],this.containerId="dwtcontrolContainer",this.width="600px",this.height="600px"}ngOnDestroy(){Io.DWT.Unload()}ngOnInit(){Io.DWT.Containers=[{ContainerId:this.containerId,Width:this.width,Height:this.height}],Io.DWT.Load(),Io.DWT.RegisterEvent("OnWebTwainReady",()=>{this.onReady()})}onReady(){this.dwtObject=Io.DWT.GetWebTwain(this.containerId),this.dwtObject.IfShowUI=!1,this.dwtObject.GetDevicesAsync(Io.DWT.EnumDWT_DeviceType.TWAINSCANNER|Io.DWT.EnumDWT_DeviceType.TWAINX64SCANNER|Io.DWT.EnumDWT_DeviceType.ESCLSCANNER).then(o=>{this.sourceList=o,this.selectSources=document.getElementById("sources"),this.selectSources.options.length=0;for(let h=0;h<o.length;h++)this.selectSources.options.add(new Option(o[h].displayName,h.toString()))})}acquireImage(){if(this.dwtObject)if(this.dwtObject.SourceCount>0&&this.selectSources&&this.dwtObject.SelectSourceByIndex(this.selectSources.selectedIndex)){let v=this.dwtObject,y="2";for(var o=document.getElementsByName("PixelType"),h=0;h<o.length;h++)if(o[h].checked){y=o[h].value;break}v.SelectDeviceAsync(this.sourceList[this.selectSources.selectedIndex]).then(()=>v.OpenSourceAsync()).then(()=>v.AcquireImageAsync({IfFeederEnabled:document.getElementById("ADF").checked,PixelType:y,Resolution:parseInt(document.getElementById("Resolution").value),IfDisableSourceAfterAcquire:!0})).then(()=>{v&&v.CloseSource()}).catch(_=>{console.error(_)})}else alert("No Source Available!")}openImage(){this.dwtObject||(this.dwtObject=Io.DWT.GetWebTwain("dwtcontrolContainer")),this.dwtObject.Addon.PDF.SetConvertMode(Io.DWT.EnumDWT_ConvertMode.CM_RENDERALL),this.dwtObject.LoadImageEx("",Io.DWT.EnumDWT_ImageType.IT_ALL,()=>{},()=>{})}downloadDocument(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&(this.dwtObject.IfShowFileDialog=!0,1==document.getElementById("imgTypejpeg").checked?(1==this.dwtObject.GetImageBitDepth(this.dwtObject.CurrentImageIndexInBuffer)&&this.dwtObject.ConvertToGrayScale(this.dwtObject.CurrentImageIndexInBuffer),this.dwtObject.SaveAsJPEG("DynamicWebTWAIN.jpg",this.dwtObject.CurrentImageIndexInBuffer)):1==document.getElementById("imgTypetiff").checked?this.dwtObject.SaveAllAsMultiPageTIFF("DynamicWebTWAIN.tiff",()=>{},()=>{}):1==document.getElementById("imgTypepdf").checked&&this.dwtObject.SaveAllAsPDF("DynamicWebTWAIN.pdf",()=>{},()=>{}))}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-acquire-image"]],decls:43,vars:0,consts:[[1,"row"],["for","BW"],["type","radio","value","0","name","PixelType"],["for","Gray"],["type","radio","value","1","name","PixelType"],["for","RGB"],["type","radio","value","2","name","PixelType","checked","checked"],["type","checkbox","id","ADF","checked","checked"],["id","Resolution"],["value","100"],["value","150"],["value","200"],["value","300"],["id","sources"],[3,"click"],["id","dwtcontrolContainer"],[2,"font-size","x-large"],["type","radio","value","jpg","name","ImageType","id","imgTypejpeg"],["type","radio","value","tif","name","ImageType","id","imgTypetiff"],["type","radio","value","pdf","name","ImageType","id","imgTypepdf","checked","checked"]],template:function(o,h){1&o&&(Qt(0,"div",0)(1,"label",1),hr(2,"input",2),Bn(3,"B&W "),Yt(),Qt(4,"label",3),hr(5,"input",4),Bn(6,"Gray"),Yt(),Qt(7,"label",5),hr(8,"input",6),Bn(9,"Color"),Yt(),Qt(10,"label"),hr(11,"input",7),Bn(12,"Auto Feeder"),Yt(),Qt(13,"div"),Bn(14,"\xa0\xa0"),Yt(),Qt(15,"select",8)(16,"option",9),Bn(17,"100"),Yt(),Qt(18,"option",10),Bn(19,"150"),Yt(),Qt(20,"option",11),Bn(21,"200"),Yt(),Qt(22,"option",12),Bn(23,"300"),Yt()()(),hr(24,"select",13)(25,"br"),Qt(26,"button",14),oi("click",function(){return h.acquireImage()}),Bn(27,"Scan Documents"),Yt(),Qt(28,"button",14),oi("click",function(){return h.openImage()}),Bn(29,"Load Documents"),Yt(),hr(30,"div",15),Qt(31,"div",0)(32,"label",16),hr(33,"input",17),Bn(34,"JPEG"),Yt(),Qt(35,"label",16),hr(36,"input",18),Bn(37,"TIFF"),Yt(),Qt(38,"label",16),hr(39,"input",19),Bn(40,"PDF"),Yt()(),Qt(41,"button",14),oi("click",function(){return h.downloadDocument()}),Bn(42,"Download Documents"),Yt())},directives:[WM,VM],styles:[".row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:left}select[_ngcontent-%COMP%]{border-radius:10px;height:30px}"]}),p})()},{path:"image-editor",component:(()=>{class p{constructor(){this.containerId="dwtcontrolContainer",this.width="600px",this.height="800px",this.isHidden=!1,this.sourceList=[]}ngOnDestroy(){Io.DWT.Unload()}ngOnInit(){Io.DWT.Containers=[{ContainerId:this.containerId,Width:this.width,Height:this.height}],Io.DWT.Load(),Io.DWT.RegisterEvent("OnWebTwainReady",()=>{this.onReady()})}onReady(){this.dwtObject=Io.DWT.GetWebTwain(this.containerId),this.dwtObject.IfShowUI=!1,this.createImageEditor(),this.dwtObject.GetDevicesAsync(Io.DWT.EnumDWT_DeviceType.TWAINSCANNER|Io.DWT.EnumDWT_DeviceType.TWAINX64SCANNER|Io.DWT.EnumDWT_DeviceType.ESCLSCANNER).then(o=>{this.sourceList=o,this.selectSources=document.getElementById("sources"),this.selectSources.options.length=0;for(let h=0;h<o.length;h++)this.selectSources.options.add(new Option(o[h].displayName,h.toString()))}),this.dwtObject.Viewer.autoChangeIndex=!0,this.dwtObject.RegisterEvent("OnBufferChanged",o=>{this.onBufferChanged(o.currentId)})}acquireImage(){if(this.dwtObject)if(this.dwtObject.SourceCount>0&&this.selectSources&&this.dwtObject.SelectSourceByIndex(this.selectSources.selectedIndex)){let o=this.dwtObject;o.SelectDeviceAsync(this.sourceList[this.selectSources.selectedIndex]).then(()=>o.OpenSourceAsync()).then(()=>o.AcquireImageAsync({})).then(()=>{o&&o.CloseSource()}).catch(h=>{console.error(h)})}else alert("No Source Available!")}createImageEditor(){this.dwtObject&&(this.imageEditor=this.dwtObject.Viewer.createImageEditor({element:document.getElementById("dwtcontrolContainerLargeViewer"),width:750,height:800,buttons:{visibility:{close:!1}}}),this.imageEditor.show())}openImage(){this.dwtObject||(this.dwtObject=Io.DWT.GetWebTwain("dwtcontrolContainer")),this.dwtObject.Addon.PDF.SetConvertMode(Io.DWT.EnumDWT_ConvertMode.CM_RENDERALL),this.dwtObject.LoadImageEx("",Io.DWT.EnumDWT_ImageType.IT_ALL,()=>{this.updatePageInfo()},()=>{})}rotateLeft(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.RotateLeft(this.dwtObject.CurrentImageIndexInBuffer)}rotateRight(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.RotateRight(this.dwtObject.CurrentImageIndexInBuffer)}mirror(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.Mirror(this.dwtObject.CurrentImageIndexInBuffer)}flip(){this.dwtObject&&this.dwtObject.HowManyImagesInBuffer>0&&this.dwtObject.Flip(this.dwtObject.CurrentImageIndexInBuffer)}showImageEditor(){if(this.dwtObject)if(0==this.dwtObject.HowManyImagesInBuffer)alert("There is no image in buffer.");else{let o=document.getElementById("imageEditor");if(!o)return;this.isHidden?(o.textContent="Hide Editor",this.imageEditor.show(),this.isHidden=!1):(o.textContent="Show Editor",this.isHidden=!0,this.imageEditor.hide())}}firstImage(){this.dwtObject&&(this.dwtObject.Viewer.first(),this.updatePageInfo())}updatePageInfo(){this.dwtObject&&document.getElementById("DW_TotalImage")&&document.getElementById("DW_CurrentImage")&&(document.getElementById("DW_TotalImage").value=this.dwtObject.HowManyImagesInBuffer.toString(),document.getElementById("DW_CurrentImage").value=(this.dwtObject.CurrentImageIndexInBuffer+1).toString())}onBufferChanged(o){this.dwtObject&&(this.dwtObject.CurrentImageIndexInBuffer=o,this.updatePageInfo())}preImage(){this.dwtObject&&(this.dwtObject.Viewer.previous(),this.updatePageInfo())}nextImage(){this.dwtObject&&(this.dwtObject.Viewer.next(),this.updatePageInfo())}lastImage(){this.dwtObject&&(this.dwtObject.Viewer.last(),this.updatePageInfo())}setMode(){if(this.dwtObject){let h=document.getElementById("DW_PreviewMode").selectedIndex;var o=h+1;this.dwtObject.Viewer.setViewMode(o,o),this.dwtObject.Viewer.cursor=0!=h?"pointer":"crosshair"}}removeSelected(){this.dwtObject&&(this.dwtObject.RemoveAllSelectedImages(),0==this.dwtObject.HowManyImagesInBuffer?(document.getElementById("DW_CurrentImage").value="0",document.getElementById("DW_TotalImage").value="0"):this.updatePageInfo())}removeAll(){this.dwtObject&&(this.dwtObject.RemoveAllImages(),document.getElementById("DW_TotalImage").value="0",document.getElementById("DW_CurrentImage").value="0")}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-image-editor"]],decls:45,vars:0,consts:[["id","sources"],[1,"row"],[3,"click"],["id","dwtcontrolContainer"],["id","dwtcontrolContainerLargeViewer"],[2,"width","800px"],["type","button","value"," |< ",2,"font-size","x-large",3,"click"],["type","button","value"," < ",2,"font-size","x-large",3,"click"],["type","text","size","2","id","DW_CurrentImage","readonly","readonly","value","0",2,"font-size","x-large"],["type","text","size","2","id","DW_TotalImage","readonly","readonly","value","0",2,"font-size","x-large"],["type","button","value"," > ",2,"font-size","x-large",3,"click"],["type","button","value"," >| ",2,"font-size","x-large",3,"click"],["size","1","id","DW_PreviewMode",2,"font-size","x-large",3,"change"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["id","imageEditor",3,"click"]],template:function(o,h){1&o&&(hr(0,"select",0)(1,"br"),Qt(2,"div",1)(3,"button",2),oi("click",function(){return h.acquireImage()}),Bn(4,"Scan"),Yt(),Qt(5,"button",2),oi("click",function(){return h.openImage()}),Bn(6,"Load"),Yt()(),Qt(7,"div",1),hr(8,"div",3)(9,"div",4),Yt(),Qt(10,"div",5)(11,"input",6),oi("click",function(){return h.firstImage()}),Yt(),Qt(12,"input",7),oi("click",function(){return h.preImage()}),Yt(),hr(13,"input",8),Bn(14," / "),hr(15,"input",9),Qt(16,"input",10),oi("click",function(){return h.nextImage()}),Yt(),Qt(17,"input",11),oi("click",function(){return h.lastImage()}),Yt(),Bn(18," Preview Mode: "),Qt(19,"select",12),oi("change",function(){return h.setMode()}),Qt(20,"option",13),Bn(21,"1X1"),Yt(),Qt(22,"option",14),Bn(23,"2X2"),Yt(),Qt(24,"option",15),Bn(25,"3X3"),Yt(),Qt(26,"option",16),Bn(27,"4X4"),Yt(),Qt(28,"option",17),Bn(29,"5X5"),Yt()()(),Qt(30,"div",1)(31,"button",2),oi("click",function(){return h.removeSelected()}),Bn(32,"Remove Selected"),Yt(),Qt(33,"button",2),oi("click",function(){return h.removeAll()}),Bn(34,"Remove All"),Yt(),Qt(35,"button",2),oi("click",function(){return h.rotateLeft()}),Bn(36,"Rotate Left"),Yt(),Qt(37,"button",2),oi("click",function(){return h.rotateRight()}),Bn(38,"Rotate Right"),Yt(),Qt(39,"button",2),oi("click",function(){return h.mirror()}),Bn(40,"Mirror"),Yt(),Qt(41,"button",2),oi("click",function(){return h.flip()}),Bn(42,"Flip"),Yt(),Qt(43,"button",18),oi("click",function(){return h.showImageEditor()}),Bn(44,"Hide Editor"),Yt()())},directives:[WM,VM],styles:[".row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:left}select[_ngcontent-%COMP%]{border-radius:10px;height:30px}"]}),p})()}];let P4e=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p}),p.\u0275inj=Ed({imports:[[wq.forRoot(A4e)],wq]}),p})();const R4e=function(){return["/"]};let k4e=(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(o,h){1&o&&(Qt(0,"a",0)(1,"h1"),Bn(2,"Dynamsoft Capture Vision SDK"),Yt()()),2&o&&Pr("routerLink",Nd(1,R4e))},directives:[Hb],styles:[""]}),p})(),M4e=(()=>{class p{constructor(){this.title="angular-barcode-mrz-document-scanner"}}return p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=Dl({type:p,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(o,h){1&o&&(hr(0,"app-top-bar"),Qt(1,"div",0),hr(2,"router-outlet"),Yt())},directives:[k4e,r4],styles:[""]}),p})(),O4e=(()=>{class p{}return p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=xh({type:p,bootstrap:[M4e]}),p.\u0275inj=Ed({providers:[],imports:[[uSe,P4e,T3e]]}),p})();(function Ybe(){bY=!1})(),lSe().bootstrapModule(O4e).catch(p=>console.error(p))}},hi=>{hi(hi.s=269)}]);