/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Label Recognizer JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 3.4.20
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dlr JS: https://www.dynamsoft.com/label-recognition/docs/web/programming/javascript/
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("dynamsoft-core")):"function"==typeof define&&define.amd?define(["exports","dynamsoft-core"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).Dynamsoft=t.Dynamsoft||{},t.Dynamsoft.DLR={}),t.Dynamsoft.Core)}(this,(function(t,e){"use strict";const r="undefined"==typeof self,s=(()=>{if(!r&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),a=t=>{if(null==t&&(t="./"),r);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};e.autoDiscoveryPaths.dlr={version:"3.4.20",path:s},null==e.autoDiscoveryPaths.dlrData&&(e.autoDiscoveryPaths.dlrData={version:"1.0.11",path:a(s+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")}),e.workerAutoResources.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},e.workerAutoResources.dnn={wasm:!0,deps:["dip"]};const c="1.4.10";"string"!=typeof e.autoDiscoveryPaths.std&&e.compareVersion(e.autoDiscoveryPaths.std.version,c)<0&&(e.autoDiscoveryPaths.std={version:c,path:a(s+`../../dynamsoft-capture-vision-std@${c}/dist/`)});const n="2.4.20";(!e.autoDiscoveryPaths.dip||"string"!=typeof e.autoDiscoveryPaths.dip&&e.compareVersion(e.autoDiscoveryPaths.dip.version,n)<0)&&(e.autoDiscoveryPaths.dip={version:n,path:a(s+`../../dynamsoft-image-processing@${n}/dist/`)});const o="1.0.20";(!e.autoDiscoveryPaths.dnn||"string"!=typeof e.autoDiscoveryPaths.dnn&&e.compareVersion(e.autoDiscoveryPaths.dnn.version,o)<0)&&(e.autoDiscoveryPaths.dnn={version:o,path:a(s+`../../dynamsoft-capture-vision-dnn@${o}/dist/`)});let i=!1;class l{static getVersion(){const t=e.innerVersions.dlr&&e.innerVersions.dlr.wasm,r=e.innerVersions.dlr&&e.innerVersions.dlr.worker;return`3.4.20(Worker: ${r||"Not Loaded"}, Wasm: ${t||"Not Loaded"})`}static async loadRecognitionData(t,r){return await e.loadWasm("dlr"),await new Promise(((s,a)=>{let c=e.getNextTaskID();e.mapTaskCallBack[c]=async t=>{if(t.success){const e=t.result;if(0!==e.exception){let t=new Error(e.description);return t.errorCode=e.exception,a(t)}return e.bModel||(i=!0),s(e)}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,a(e)}},r&&!r.endsWith("/")&&(r+="/");const n=e.handleEngineResourcePaths(e.CoreModule.engineResourcePaths,e.autoDiscoveryPaths);r||"ConfusableChars"!==t||(r=n.dlr),e.worker.postMessage({type:"dlr_loadData",id:c,body:{dataName:t,dataPath:r||n.dlrData}})}))}}e.mapPackageRegister.dlr={loadRecognitionData:l.loadRecognitionData,get bLoadConfusableCharsData(){return i}};const u={filterVINResult:function(t){let e="";if(18===t.characterResults.length){let e=t.characterResults[9].location.points[0].x-t.characterResults[8].location.points[1].x;e<2&&(e=2);let r=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,s=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,a=2===e?3:e;if(r-e>=a&&s-e<a)t.characterResults.shift();else if(s-e>=a&&r-e<a)t.characterResults.pop();else{t.characterResults[0].characterHConfidence>t.characterResults[17].characterHConfidence?t.characterResults.pop():t.characterResults.shift()}}else if(19===t.characterResults.length){let e=t.characterResults[10].location.points[0].x-t.characterResults[9].location.points[1].x;e<2&&(e=2);let r,s,a,c=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,n=t.characterResults[18].location.points[0].x-t.characterResults[17].location.points[1].x,o=t.characterResults[2].location.points[0].x-t.characterResults[1].location.points[1].x,i=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,l=2===e?3:e;if("1"===t.characterResults[1].characterH||"1"===t.characterResults[2].characterH||"1"===t.characterResults[16].characterH||"1"===t.characterResults[17].characterH){for(let e=9;e<t.characterResults.length;e++)if("1"!==t.characterResults[e].characterH){a=t.characterResults[e].location.points[1].x-t.characterResults[e].location.points[0].x;break}"1"===t.characterResults[1].characterH&&(r=a-(t.characterResults[1].location.points[1].x-t.characterResults[1].location.points[0].x)+3),"1"===t.characterResults[2].characterH&&(r=a-(t.characterResults[2].location.points[1].x-t.characterResults[2].location.points[0].x)+3),"1"===t.characterResults[16].characterH&&(s=a-(t.characterResults[16].location.points[1].x-t.characterResults[16].location.points[0].x)+3),"1"===t.characterResults[17].characterH&&(s=a-(t.characterResults[17].location.points[1].x-t.characterResults[17].location.points[0].x)+3)}if(o-e>=(r||l)&&i-e<(s||l))t.characterResults.splice(0,2);else if(i-e>=(s||l)&&o-e<(r||l))t.characterResults.splice(17,2);else if(c>e&&n>e)t.characterResults.pop(),t.characterResults.shift();else{let e=t.characterResults[0].characterHConfidence+t.characterResults[1].characterHConfidence,r=t.characterResults[17].characterHConfidence+t.characterResults[18].characterHConfidence,s=t.characterResults[0].characterHConfidence+t.characterResults[18].characterHConfidence,a=Math.min(e,r,s);a===e?t.characterResults.splice(0,2):a===r?t.characterResults.splice(17,2):a===s&&(t.characterResults.pop(),t.characterResults.shift())}}for(let r of t.characterResults)e+=r.characterH;return e},checkValidVIN:function(t){if(!t||17!=t.length)return!1;return(t=>{const e=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),r=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let s=0;for(let a=0;a<t.length;a++){let c=e.get(t[a]);c&&(s+=c*r[a])}return s%11})(t).toString()===t[8]},checkValidMRP:function(t){if(!t||44!=t.length)return!1;const e=(t,e,r)=>{const s=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),a=[7,3,1];let c=0;for(let n=e,o=0;n<=r;n++){let e=s.get(t[n]);e&&(c+=e*a[o%3]),o++}return c%10},r=t.slice(0,10)+t.slice(13,20)+t.slice(21,43),s=e(t,0,8).toString(),a=e(t,13,18).toString(),c=e(t,21,26).toString(),n=e(t,28,41).toString(),o=e(r,0,r.length).toString();return s===t[9]&&a===t[19]&&c===t[27]&&n===t[42]&&o===t[43]},checkValidMRV:function(t){if(!t||44!=t.length&&36!=t.length)return!1;const e=(t,e,r)=>{const s=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),a=[7,3,1];let c=0;for(let n=e,o=0;n<=r;n++){let e=s.get(t[n]);e&&(c+=e*a[o%3]),o++}return c%10},r=e(t,0,8).toString(),s=e(t,13,18).toString(),a=e(t,21,26).toString();return r===t[9]&&s===t[19]&&a===t[27]},checkValidIDCard:function(t,e){if(!t||30!=t.length&&36!=t.length)return!1;const r=(t,e,r)=>{const s=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),a=[7,3,1];let c=0;for(let n=e,o=0;n<=r;n++){let e=s.get(t[n]);e&&(c+=e*a[o%3]),o++}return c%10};if(30===t.length){if(e&&t===e){return r(t,5,13).toString()===t[14]}if(e&&t!==e){const s=`${e.substring(5,30)}${t.substring(0,7)}${t.substring(8,15)}${t.substring(18,29)}`;return r(s,0,s.length-1).toString()===t[29]}}else if(36===t.length){const e=r(t,0,8).toString(),s=r(t,13,18).toString(),a=r(t,21,26).toString(),c=`${t.substring(0,10)}${t.substring(13,20)}${t.substring(21,28)}`,n=r(c,0,c.length-1).toString();return e===t[9]&&s===t[19]&&a===t[27]&&n===t[35]}}};var h;t.EnumRawTextLineStatus=void 0,(h=t.EnumRawTextLineStatus||(t.EnumRawTextLineStatus={}))[h.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",h[h.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",h[h.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED",e.mapTaskCallBack[-1]=async t=>{l.onDataLoadProgressChanged&&l.onDataLoadProgressChanged(t.resourcesPath,t.tag,{loaded:t.loaded,total:t.total})},t.LabelRecognizerModule=l,t.utilsFuncs=u}));
