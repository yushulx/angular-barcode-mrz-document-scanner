/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Label Recognizer JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 3.2.30
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dlr JS: https://www.dynamsoft.com/label-recognition/docs/web/programming/javascript/
*/
import{engineResourcePaths as t,workerAutoResources as e,compareVersion as a,mapPackageRegister as r,innerVersions as s,loadWasm as c,getNextTaskID as o,mapTaskCallBack as n,CoreModule as l,worker as i}from"dynamsoft-core";const h="undefined"==typeof self,u=(()=>{if(!h&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let e=t.indexOf("#");-1!=e&&(t=t.substring(0,e))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),d=t=>{if(null==t&&(t="./"),h);else{let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};null==t.dlr&&(t.dlr=u),null==t.dlrData&&(t.dlrData=d(u+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")),e.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},e.dnn={wasm:!0};const R="1.2.10";"string"!=typeof t.std&&a(t.std.version,R)<0&&(t.std={version:R,path:d(u+`../../dynamsoft-capture-vision-std@${R}/dist/`)});const p="2.2.30";(!t.dip||"string"!=typeof t.dip&&a(t.dip.version,p)<0)&&(t.dip={version:p,path:d(u+`../../dynamsoft-image-processing@${p}/dist/`)});const f="1.0.20";(!t.dnn||"string"!=typeof t.dnn&&a(t.dnn.version,f)<0)&&(t.dnn={version:f,path:d(u+`../../dynamsoft-capture-vision-dnn@${f}/dist/`)});let x=!1;class g{static getVersion(){const t=s.dlr&&s.dlr.wasm,e=s.dlr&&s.dlr.worker;return`3.2.30(Worker: ${e||"Not Loaded"}, Wasm: ${t||"Not Loaded"})`}static async loadRecognitionData(t,e){return await c("dlr"),await new Promise(((a,r)=>{let s=o();n[s]=async t=>{if(t.success){const e=t.result;if(0!==e.exception){let t=new Error(e.description);return t.errorCode=e.exception,r(t)}return e.bModel||(x=!0),a(e)}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,r(e)}},e&&!e.endsWith("/")&&(e+="/"),e||"ConfusableChars"!==t||(e=l.engineResourcePaths.dlr);let c=l.engineResourcePaths.dlrData;l.engineResourcePaths.rootDirectory&&(c.startsWith("http://")||c.startsWith("https://")||(c=l.engineResourcePaths.rootDirectory+"/"+c)),l.engineResourcePaths.dlrData=d(c),i.postMessage({type:"dlr_loadData",id:s,body:{dataName:t,dataPath:e||l.engineResourcePaths.dlrData}})}))}}r.dlr={filterVINResult:function(t){let e="";if(18===t.characterResults.length){let e=t.characterResults[9].location.points[0].x-t.characterResults[8].location.points[1].x;e<2&&(e=2);let a=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,r=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,s=2===e?3:e;if(a-e>=s&&r-e<s)t.characterResults.shift();else if(r-e>=s&&a-e<s)t.characterResults.pop();else{t.characterResults[0].characterHConfidence>t.characterResults[17].characterHConfidence?t.characterResults.pop():t.characterResults.shift()}}else if(19===t.characterResults.length){let e=t.characterResults[10].location.points[0].x-t.characterResults[9].location.points[1].x;e<2&&(e=2);let a,r,s,c=t.characterResults[1].location.points[0].x-t.characterResults[0].location.points[1].x,o=t.characterResults[18].location.points[0].x-t.characterResults[17].location.points[1].x,n=t.characterResults[2].location.points[0].x-t.characterResults[1].location.points[1].x,l=t.characterResults[17].location.points[0].x-t.characterResults[16].location.points[1].x,i=2===e?3:e;if("1"===t.characterResults[1].characterH||"1"===t.characterResults[2].characterH||"1"===t.characterResults[16].characterH||"1"===t.characterResults[17].characterH){for(let e=9;e<t.characterResults.length;e++)if("1"!==t.characterResults[e].characterH){s=t.characterResults[e].location.points[1].x-t.characterResults[e].location.points[0].x;break}"1"===t.characterResults[1].characterH&&(a=s-(t.characterResults[1].location.points[1].x-t.characterResults[1].location.points[0].x)+3),"1"===t.characterResults[2].characterH&&(a=s-(t.characterResults[2].location.points[1].x-t.characterResults[2].location.points[0].x)+3),"1"===t.characterResults[16].characterH&&(r=s-(t.characterResults[16].location.points[1].x-t.characterResults[16].location.points[0].x)+3),"1"===t.characterResults[17].characterH&&(r=s-(t.characterResults[17].location.points[1].x-t.characterResults[17].location.points[0].x)+3)}if(n-e>=(a||i)&&l-e<(r||i))t.characterResults.splice(0,2);else if(l-e>=(r||i)&&n-e<(a||i))t.characterResults.splice(17,2);else if(c>e&&o>e)t.characterResults.pop(),t.characterResults.shift();else{let e=t.characterResults[0].characterHConfidence+t.characterResults[1].characterHConfidence,a=t.characterResults[17].characterHConfidence+t.characterResults[18].characterHConfidence,r=t.characterResults[0].characterHConfidence+t.characterResults[18].characterHConfidence,s=Math.min(e,a,r);s===e?t.characterResults.splice(0,2):s===a?t.characterResults.splice(17,2):s===r&&(t.characterResults.pop(),t.characterResults.shift())}}for(let a of t.characterResults)e+=a.characterH;return e},loadRecognitionData:g.loadRecognitionData,get bLoadConfusableCharsData(){return x}},n[-1]=async t=>{g.onDataLoadProgressChanged&&g.onDataLoadProgressChanged(t.resourcesPath,t.tag,{loaded:t.loaded,total:t.total})};export{g as LabelRecognizerModule};
