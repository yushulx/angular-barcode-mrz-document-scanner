"use strict";(self.webpackChunkangular_barcode_qr_code_scanner=self.webpackChunkangular_barcode_qr_code_scanner||[]).push([[179],{4:()=>{function Lt(u){return"function"==typeof u}function Ra(u){const l=u(f=>{Error.call(f),f.stack=(new Error).stack});return l.prototype=Object.create(Error.prototype),l.prototype.constructor=l,l}const Ec=Ra(u=>function(l){u(this),this.message=l?`${l.length} errors occurred during unsubscription:\n${l.map((f,g)=>`${g+1}) ${f.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=l});function Oa(u,a){if(u){const l=u.indexOf(a);0<=l&&u.splice(l,1)}}class li{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;const{_parentage:l}=this;if(l)if(this._parentage=null,Array.isArray(l))for(const p of l)p.remove(this);else l.remove(this);const{initialTeardown:f}=this;if(Lt(f))try{f()}catch(p){a=p instanceof Ec?p.errors:[p]}const{_finalizers:g}=this;if(g){this._finalizers=null;for(const p of g)try{Ym(p)}catch(_){a=null!=a?a:[],_ instanceof Ec?a=[...a,..._.errors]:a.push(_)}}if(a)throw new Ec(a)}}add(a){var l;if(a&&a!==this)if(this.closed)Ym(a);else{if(a instanceof li){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=null!==(l=this._finalizers)&&void 0!==l?l:[]).push(a)}}_hasParent(a){const{_parentage:l}=this;return l===a||Array.isArray(l)&&l.includes(a)}_addParent(a){const{_parentage:l}=this;this._parentage=Array.isArray(l)?(l.push(a),l):l?[l,a]:a}_removeParent(a){const{_parentage:l}=this;l===a?this._parentage=null:Array.isArray(l)&&Oa(l,a)}remove(a){const{_finalizers:l}=this;l&&Oa(l,a),a instanceof li&&a._removeParent(this)}}li.EMPTY=(()=>{const u=new li;return u.closed=!0,u})();const Wm=li.EMPTY;function zm(u){return u instanceof li||u&&"closed"in u&&Lt(u.remove)&&Lt(u.add)&&Lt(u.unsubscribe)}function Ym(u){Lt(u)?u():u.unsubscribe()}const ws={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},bc={setTimeout(u,a,...l){const{delegate:f}=bc;return(null==f?void 0:f.setTimeout)?f.setTimeout(u,a,...l):setTimeout(u,a,...l)},clearTimeout(u){const{delegate:a}=bc;return((null==a?void 0:a.clearTimeout)||clearTimeout)(u)},delegate:void 0};function $m(u){bc.setTimeout(()=>{const{onUnhandledError:a}=ws;if(!a)throw u;a(u)})}function Xm(){}const oT=rd("C",void 0,void 0);function rd(u,a,l){return{kind:u,value:a,error:l}}let Es=null;function Dc(u){if(ws.useDeprecatedSynchronousErrorHandling){const a=!Es;if(a&&(Es={errorThrown:!1,error:null}),u(),a){const{errorThrown:l,error:f}=Es;if(Es=null,l)throw f}}else u()}class sd extends li{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,zm(a)&&a.add(this)):this.destination=fT}static create(a,l,f){return new Tc(a,l,f)}next(a){this.isStopped?ad(function lT(u){return rd("N",u,void 0)}(a),this):this._next(a)}error(a){this.isStopped?ad(function aT(u){return rd("E",void 0,u)}(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?ad(oT,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const uT=Function.prototype.bind;function od(u,a){return uT.call(u,a)}class hT{constructor(a){this.partialObserver=a}next(a){const{partialObserver:l}=this;if(l.next)try{l.next(a)}catch(f){Ic(f)}}error(a){const{partialObserver:l}=this;if(l.error)try{l.error(a)}catch(f){Ic(f)}else Ic(a)}complete(){const{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(l){Ic(l)}}}class Tc extends sd{constructor(a,l,f){let g;if(super(),Lt(a)||!a)g={next:null!=a?a:void 0,error:null!=l?l:void 0,complete:null!=f?f:void 0};else{let p;this&&ws.useDeprecatedNextContext?(p=Object.create(a),p.unsubscribe=()=>this.unsubscribe(),g={next:a.next&&od(a.next,p),error:a.error&&od(a.error,p),complete:a.complete&&od(a.complete,p)}):g=a}this.destination=new hT(g)}}function Ic(u){ws.useDeprecatedSynchronousErrorHandling?function cT(u){ws.useDeprecatedSynchronousErrorHandling&&Es&&(Es.errorThrown=!0,Es.error=u)}(u):$m(u)}function ad(u,a){const{onStoppedNotification:l}=ws;l&&bc.setTimeout(()=>l(u,a))}const fT={closed:!0,next:Xm,error:function dT(u){throw u},complete:Xm},ld="function"==typeof Symbol&&Symbol.observable||"@@observable";function bs(u){return u}let an=(()=>{class u{constructor(l){l&&(this._subscribe=l)}lift(l){const f=new u;return f.source=this,f.operator=l,f}subscribe(l,f,g){const p=function pT(u){return u&&u instanceof sd||function gT(u){return u&&Lt(u.next)&&Lt(u.error)&&Lt(u.complete)}(u)&&zm(u)}(l)?l:new Tc(l,f,g);return Dc(()=>{const{operator:_,source:C}=this;p.add(_?_.call(p,C):C?this._subscribe(p):this._trySubscribe(p))}),p}_trySubscribe(l){try{return this._subscribe(l)}catch(f){l.error(f)}}forEach(l,f){return new(f=Zm(f))((g,p)=>{const _=new Tc({next:C=>{try{l(C)}catch(b){p(b),_.unsubscribe()}},error:p,complete:g});this.subscribe(_)})}_subscribe(l){var f;return null===(f=this.source)||void 0===f?void 0:f.subscribe(l)}[ld](){return this}pipe(...l){return function qm(u){return 0===u.length?bs:1===u.length?u[0]:function(l){return u.reduce((f,g)=>g(f),l)}}(l)(this)}toPromise(l){return new(l=Zm(l))((f,g)=>{let p;this.subscribe(_=>p=_,_=>g(_),()=>f(p))})}}return u.create=a=>new u(a),u})();function Zm(u){var a;return null!==(a=null!=u?u:ws.Promise)&&void 0!==a?a:Promise}const mT=Ra(u=>function(){u(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let cr=(()=>{class u extends an{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(l){const f=new Km(this,this);return f.operator=l,f}_throwIfClosed(){if(this.closed)throw new mT}next(l){Dc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const f of this.currentObservers)f.next(l)}})}error(l){Dc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=l;const{observers:f}=this;for(;f.length;)f.shift().error(l)}})}complete(){Dc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:l}=this;for(;l.length;)l.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var l;return(null===(l=this.observers)||void 0===l?void 0:l.length)>0}_trySubscribe(l){return this._throwIfClosed(),super._trySubscribe(l)}_subscribe(l){return this._throwIfClosed(),this._checkFinalizedStatuses(l),this._innerSubscribe(l)}_innerSubscribe(l){const{hasError:f,isStopped:g,observers:p}=this;return f||g?Wm:(this.currentObservers=null,p.push(l),new li(()=>{this.currentObservers=null,Oa(p,l)}))}_checkFinalizedStatuses(l){const{hasError:f,thrownError:g,isStopped:p}=this;f?l.error(g):p&&l.complete()}asObservable(){const l=new an;return l.source=this,l}}return u.create=(a,l)=>new Km(a,l),u})();class Km extends cr{constructor(a,l){super(),this.destination=a,this.source=l}next(a){var l,f;null===(f=null===(l=this.destination)||void 0===l?void 0:l.next)||void 0===f||f.call(l,a)}error(a){var l,f;null===(f=null===(l=this.destination)||void 0===l?void 0:l.error)||void 0===f||f.call(l,a)}complete(){var a,l;null===(l=null===(a=this.destination)||void 0===a?void 0:a.complete)||void 0===l||l.call(a)}_subscribe(a){var l,f;return null!==(f=null===(l=this.source)||void 0===l?void 0:l.subscribe(a))&&void 0!==f?f:Wm}}function Qm(u){return Lt(null==u?void 0:u.lift)}function _n(u){return a=>{if(Qm(a))return a.lift(function(l){try{return u(l,this)}catch(f){this.error(f)}});throw new TypeError("Unable to lift unknown Observable type")}}function vn(u,a,l,f,g){return new _T(u,a,l,f,g)}class _T extends sd{constructor(a,l,f,g,p,_){super(a),this.onFinalize=p,this.shouldUnsubscribe=_,this._next=l?function(C){try{l(C)}catch(b){a.error(b)}}:super._next,this._error=g?function(C){try{g(C)}catch(b){a.error(b)}finally{this.unsubscribe()}}:super._error,this._complete=f?function(){try{f()}catch(C){a.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:l}=this;super.unsubscribe(),!l&&(null===(a=this.onFinalize)||void 0===a||a.call(this))}}}function Bt(u,a){return _n((l,f)=>{let g=0;l.subscribe(vn(f,p=>{f.next(u.call(a,p,g++))}))})}function Ds(u){return this instanceof Ds?(this.v=u,this):new Ds(u)}function CT(u,a,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g,f=l.apply(u,a||[]),p=[];return g={},_("next"),_("throw"),_("return"),g[Symbol.asyncIterator]=function(){return this},g;function _(k){f[k]&&(g[k]=function(j){return new Promise(function(G,z){p.push([k,j,G,z])>1||C(k,j)})})}function C(k,j){try{!function b(k){k.value instanceof Ds?Promise.resolve(k.value.v).then(O,M):P(p[0][2],k)}(f[k](j))}catch(G){P(p[0][3],G)}}function O(k){C("next",k)}function M(k){C("throw",k)}function P(k,j){k(j),p.shift(),p.length&&C(p[0][0],p[0][1])}}function wT(u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,a=u[Symbol.asyncIterator];return a?a.call(u):(u=function t_(u){var a="function"==typeof Symbol&&Symbol.iterator,l=a&&u[a],f=0;if(l)return l.call(u);if(u&&"number"==typeof u.length)return{next:function(){return u&&f>=u.length&&(u=void 0),{value:u&&u[f++],done:!u}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}(u),l={},f("next"),f("throw"),f("return"),l[Symbol.asyncIterator]=function(){return this},l);function f(p){l[p]=u[p]&&function(_){return new Promise(function(C,b){!function g(p,_,C,b){Promise.resolve(b).then(function(O){p({value:O,done:C})},_)}(C,b,(_=u[p](_)).done,_.value)})}}}const n_=u=>u&&"number"==typeof u.length&&"function"!=typeof u;function i_(u){return Lt(null==u?void 0:u.then)}function r_(u){return Lt(u[ld])}function s_(u){return Symbol.asyncIterator&&Lt(null==u?void 0:u[Symbol.asyncIterator])}function o_(u){return new TypeError(`You provided ${null!==u&&"object"==typeof u?"an invalid object":`'${u}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const a_=function bT(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function l_(u){return Lt(null==u?void 0:u[a_])}function c_(u){return CT(this,arguments,function*(){const l=u.getReader();try{for(;;){const{value:f,done:g}=yield Ds(l.read());if(g)return yield Ds(void 0);yield yield Ds(f)}}finally{l.releaseLock()}})}function u_(u){return Lt(null==u?void 0:u.getReader)}function ur(u){if(u instanceof an)return u;if(null!=u){if(r_(u))return function DT(u){return new an(a=>{const l=u[ld]();if(Lt(l.subscribe))return l.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(u);if(n_(u))return function TT(u){return new an(a=>{for(let l=0;l<u.length&&!a.closed;l++)a.next(u[l]);a.complete()})}(u);if(i_(u))return function IT(u){return new an(a=>{u.then(l=>{a.closed||(a.next(l),a.complete())},l=>a.error(l)).then(null,$m)})}(u);if(s_(u))return h_(u);if(l_(u))return function ST(u){return new an(a=>{for(const l of u)if(a.next(l),a.closed)return;a.complete()})}(u);if(u_(u))return function xT(u){return h_(c_(u))}(u)}throw o_(u)}function h_(u){return new an(a=>{(function AT(u,a){var l,f,g,p;return function vT(u,a,l,f){return new(l||(l=Promise))(function(p,_){function C(M){try{O(f.next(M))}catch(P){_(P)}}function b(M){try{O(f.throw(M))}catch(P){_(P)}}function O(M){M.done?p(M.value):function g(p){return p instanceof l?p:new l(function(_){_(p)})}(M.value).then(C,b)}O((f=f.apply(u,a||[])).next())})}(this,void 0,void 0,function*(){try{for(l=wT(u);!(f=yield l.next()).done;)if(a.next(f.value),a.closed)return}catch(_){g={error:_}}finally{try{f&&!f.done&&(p=l.return)&&(yield p.call(l))}finally{if(g)throw g.error}}a.complete()})})(u,a).catch(l=>a.error(l))})}function hr(u,a,l,f=0,g=!1){const p=a.schedule(function(){l(),g?u.add(this.schedule(null,f)):this.unsubscribe()},f);if(u.add(p),!g)return p}function gn(u,a,l=1/0){return Lt(a)?gn((f,g)=>Bt((p,_)=>a(f,p,g,_))(ur(u(f,g))),l):("number"==typeof a&&(l=a),_n((f,g)=>function RT(u,a,l,f,g,p,_,C){const b=[];let O=0,M=0,P=!1;const k=()=>{P&&!b.length&&!O&&a.complete()},j=z=>O<f?G(z):b.push(z),G=z=>{p&&a.next(z),O++;let Y=!1;ur(l(z,M++)).subscribe(vn(a,X=>{null==g||g(X),p?j(X):a.next(X)},()=>{Y=!0},void 0,()=>{if(Y)try{for(O--;b.length&&O<f;){const X=b.shift();_?hr(a,_,()=>G(X)):G(X)}k()}catch(X){a.error(X)}}))};return u.subscribe(vn(a,j,()=>{P=!0,k()})),()=>{null==C||C()}}(f,g,u,l)))}function Ma(u=1/0){return gn(bs,u)}const dr=new an(u=>u.complete());function ud(u){return u[u.length-1]}function La(u){return function MT(u){return u&&Lt(u.schedule)}(ud(u))?u.pop():void 0}function d_(u,a=0){return _n((l,f)=>{l.subscribe(vn(f,g=>hr(f,u,()=>f.next(g),a),()=>hr(f,u,()=>f.complete(),a),g=>hr(f,u,()=>f.error(g),a)))})}function f_(u,a=0){return _n((l,f)=>{f.add(u.schedule(()=>l.subscribe(f),a))})}function g_(u,a){if(!u)throw new Error("Iterable cannot be null");return new an(l=>{hr(l,a,()=>{const f=u[Symbol.asyncIterator]();hr(l,a,()=>{f.next().then(g=>{g.done?l.complete():l.next(g.value)})},0,!0)})})}function yn(u,a){return a?function UT(u,a){if(null!=u){if(r_(u))return function PT(u,a){return ur(u).pipe(f_(a),d_(a))}(u,a);if(n_(u))return function kT(u,a){return new an(l=>{let f=0;return a.schedule(function(){f===u.length?l.complete():(l.next(u[f++]),l.closed||this.schedule())})})}(u,a);if(i_(u))return function NT(u,a){return ur(u).pipe(f_(a),d_(a))}(u,a);if(s_(u))return g_(u,a);if(l_(u))return function BT(u,a){return new an(l=>{let f;return hr(l,a,()=>{f=u[a_](),hr(l,a,()=>{let g,p;try{({value:g,done:p}=f.next())}catch(_){return void l.error(_)}p?l.complete():l.next(g)},0,!0)}),()=>Lt(null==f?void 0:f.return)&&f.return()})}(u,a);if(u_(u))return function jT(u,a){return g_(c_(u),a)}(u,a)}throw o_(u)}(u,a):ur(u)}function Sc(u){return u<=0?()=>dr:_n((a,l)=>{let f=0;a.subscribe(vn(l,g=>{++f<=u&&(l.next(g),u<=f&&l.complete())}))})}function hd(u,a,...l){return!0===a?(u(),null):!1===a?null:a(...l).pipe(Sc(1)).subscribe(()=>u())}function At(u){for(let a in u)if(u[a]===At)return a;throw Error("Could not find renamed property on target object.")}function bt(u){if("string"==typeof u)return u;if(Array.isArray(u))return"["+u.map(bt).join(", ")+"]";if(null==u)return""+u;if(u.overriddenName)return`${u.overriddenName}`;if(u.name)return`${u.name}`;const a=u.toString();if(null==a)return""+a;const l=a.indexOf("\n");return-1===l?a:a.substring(0,l)}function fd(u,a){return null==u||""===u?null===a?"":a:null==a||""===a?u:u+" "+a}const GT=At({__forward_ref__:At});function gd(u){return u.__forward_ref__=gd,u.toString=function(){return bt(this())},u}function Je(u){return function p_(u){return"function"==typeof u&&u.hasOwnProperty(GT)&&u.__forward_ref__===gd}(u)?u():u}class wt extends Error{constructor(a,l){super(function pd(u,a){return`NG0${Math.abs(u)}${a?": "+a:""}`}(a,l)),this.code=a}}function $e(u){return"string"==typeof u?u:null==u?"":String(u)}function Cn(u){return"function"==typeof u?u.name||u.toString():"object"==typeof u&&null!=u&&"function"==typeof u.type?u.type.name||u.type.toString():$e(u)}function xc(u,a){const l=a?` in ${a}`:"";throw new wt(-201,`No provider for ${Cn(u)} found${l}`)}function Yn(u,a){null==u&&function Rt(u,a,l,f){throw new Error(`ASSERTION ERROR: ${u}`+(null==f?"":` [Expected=> ${l} ${f} ${a} <=Actual]`))}(a,u,null,"!=")}function mt(u){return{token:u.token,providedIn:u.providedIn||null,factory:u.factory,value:void 0}}function Gr(u){return{providers:u.providers||[],imports:u.imports||[]}}function md(u){return m_(u,Ac)||m_(u,v_)}function m_(u,a){return u.hasOwnProperty(a)?u[a]:null}function __(u){return u&&(u.hasOwnProperty(_d)||u.hasOwnProperty(ZT))?u[_d]:null}const Ac=At({\u0275prov:At}),_d=At({\u0275inj:At}),v_=At({ngInjectableDef:At}),ZT=At({ngInjectorDef:At});var We=(()=>((We=We||{})[We.Default=0]="Default",We[We.Host=1]="Host",We[We.Self=2]="Self",We[We.SkipSelf=4]="SkipSelf",We[We.Optional=8]="Optional",We))();let vd;function Wr(u){const a=vd;return vd=u,a}function y_(u,a,l){const f=md(u);return f&&"root"==f.providedIn?void 0===f.value?f.value=f.factory():f.value:l&We.Optional?null:void 0!==a?a:void xc(bt(u),"Injector")}function zr(u){return{toString:u}.toString()}var Ii=(()=>((Ii=Ii||{})[Ii.OnPush=0]="OnPush",Ii[Ii.Default=1]="Default",Ii))(),Wi=(()=>{return(u=Wi||(Wi={}))[u.Emulated=0]="Emulated",u[u.None=2]="None",u[u.ShadowDom=3]="ShadowDom",Wi;var u})();const QT="undefined"!=typeof globalThis&&globalThis,JT="undefined"!=typeof window&&window,eI="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,It=QT||"undefined"!=typeof global&&global||JT||eI,so={},Ot=[],Rc=At({\u0275cmp:At}),yd=At({\u0275dir:At}),Cd=At({\u0275pipe:At}),C_=At({\u0275mod:At}),gr=At({\u0275fac:At}),Fa=At({__NG_ELEMENT_ID__:At});let tI=0;function Yr(u){return zr(()=>{const l={},f={type:u.type,providersResolver:null,decls:u.decls,vars:u.vars,factory:null,template:u.template||null,consts:u.consts||null,ngContentSelectors:u.ngContentSelectors,hostBindings:u.hostBindings||null,hostVars:u.hostVars||0,hostAttrs:u.hostAttrs||null,contentQueries:u.contentQueries||null,declaredInputs:l,inputs:null,outputs:null,exportAs:u.exportAs||null,onPush:u.changeDetection===Ii.OnPush,directiveDefs:null,pipeDefs:null,selectors:u.selectors||Ot,viewQuery:u.viewQuery||null,features:u.features||null,data:u.data||{},encapsulation:u.encapsulation||Wi.Emulated,id:"c",styles:u.styles||Ot,_:null,setInput:null,schemas:u.schemas||null,tView:null},g=u.directives,p=u.features,_=u.pipes;return f.id+=tI++,f.inputs=D_(u.inputs,l),f.outputs=D_(u.outputs),p&&p.forEach(C=>C(f)),f.directiveDefs=g?()=>("function"==typeof g?g():g).map(w_):null,f.pipeDefs=_?()=>("function"==typeof _?_():_).map(E_):null,f})}function w_(u){return In(u)||function $r(u){return u[yd]||null}(u)}function E_(u){return function Is(u){return u[Cd]||null}(u)}const b_={};function Ts(u){return zr(()=>{const a={type:u.type,bootstrap:u.bootstrap||Ot,declarations:u.declarations||Ot,imports:u.imports||Ot,exports:u.exports||Ot,transitiveCompileScopes:null,schemas:u.schemas||null,id:u.id||null};return null!=u.id&&(b_[u.id]=u.type),a})}function D_(u,a){if(null==u)return so;const l={};for(const f in u)if(u.hasOwnProperty(f)){let g=u[f],p=g;Array.isArray(g)&&(p=g[1],g=g[0]),l[g]=f,a&&(a[g]=p)}return l}const Tn=Yr;function In(u){return u[Rc]||null}function ci(u,a){const l=u[C_]||null;if(!l&&!0===a)throw new Error(`Type ${bt(u)} does not have '\u0275mod' property.`);return l}function zi(u){return Array.isArray(u)&&"object"==typeof u[1]}function xi(u){return Array.isArray(u)&&!0===u[1]}function bd(u){return 0!=(8&u.flags)}function Fc(u){return 2==(2&u.flags)}function Pc(u){return 1==(1&u.flags)}function Ai(u){return null!==u.template}function aI(u){return 0!=(512&u[2])}function Rs(u,a){return u.hasOwnProperty(gr)?u[gr]:null}class uI{constructor(a,l,f){this.previousValue=a,this.currentValue=l,this.firstChange=f}isFirstChange(){return this.firstChange}}function Os(){return I_}function I_(u){return u.type.prototype.ngOnChanges&&(u.setInput=dI),hI}function hI(){const u=x_(this),a=null==u?void 0:u.current;if(a){const l=u.previous;if(l===so)u.previous=a;else for(let f in a)l[f]=a[f];u.current=null,this.ngOnChanges(a)}}function dI(u,a,l,f){const g=x_(u)||function fI(u,a){return u[S_]=a}(u,{previous:so,current:null}),p=g.current||(g.current={}),_=g.previous,C=this.declaredInputs[l],b=_[C];p[C]=new uI(b&&b.currentValue,a,_===so),u[f]=a}Os.ngInherit=!0;const S_="__ngSimpleChanges__";function x_(u){return u[S_]||null}let xd;function Gt(u){return!!u.listen}const A_={createRenderer:(u,a)=>function Ad(){return void 0!==xd?xd:"undefined"!=typeof document?document:void 0}()};function Qt(u){for(;Array.isArray(u);)u=u[0];return u}function di(u,a){return Qt(a[u.index])}function Rd(u,a){return u.data[a]}function Xn(u,a){const l=a[u];return zi(l)?l:l[0]}function Od(u){return 128==(128&u[2])}function Xr(u,a){return null==a?null:u[a]}function O_(u){u[18]=0}function Md(u,a){u[5]+=a;let l=u,f=u[3];for(;null!==f&&(1===a&&1===l[5]||-1===a&&0===l[5]);)f[5]+=a,l=f,f=f[3]}const Xe={lFrame:U_(null),bindingsEnabled:!0};function L_(){return Xe.bindingsEnabled}function me(){return Xe.lFrame.lView}function _t(){return Xe.lFrame.tView}function ln(){let u=F_();for(;null!==u&&64===u.type;)u=u.parent;return u}function F_(){return Xe.lFrame.currentTNode}function Yi(u,a){const l=Xe.lFrame;l.currentTNode=u,l.isParent=a}function Ld(){return Xe.lFrame.isParent}function ho(){return Xe.lFrame.bindingIndex++}function OI(u,a){const l=Xe.lFrame;l.bindingIndex=l.bindingRootIndex=u,Pd(a)}function Pd(u){Xe.lFrame.currentDirectiveIndex=u}function kd(u){Xe.lFrame.currentQueryIndex=u}function LI(u){const a=u[1];return 2===a.type?a.declTNode:1===a.type?u[6]:null}function B_(u,a,l){if(l&We.SkipSelf){let g=a,p=u;for(;!(g=g.parent,null!==g||l&We.Host||(g=LI(p),null===g||(p=p[15],10&g.type))););if(null===g)return!1;a=g,u=p}const f=Xe.lFrame=j_();return f.currentTNode=a,f.lView=u,!0}function Bc(u){const a=j_(),l=u[1];Xe.lFrame=a,a.currentTNode=l.firstChild,a.lView=u,a.tView=l,a.contextLView=u,a.bindingIndex=l.bindingStartIndex,a.inI18n=!1}function j_(){const u=Xe.lFrame,a=null===u?null:u.child;return null===a?U_(u):a}function U_(u){const a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:u,child:null,inI18n:!1};return null!==u&&(u.child=a),a}function V_(){const u=Xe.lFrame;return Xe.lFrame=u.parent,u.currentTNode=null,u.lView=null,u}const H_=V_;function jc(){const u=V_();u.isParent=!0,u.tView=null,u.selectedIndex=-1,u.contextLView=null,u.elementDepthCount=0,u.currentDirectiveIndex=-1,u.currentNamespace=null,u.bindingRootIndex=-1,u.bindingIndex=-1,u.currentQueryIndex=0}function Mn(){return Xe.lFrame.selectedIndex}function qr(u){Xe.lFrame.selectedIndex=u}function Wt(){const u=Xe.lFrame;return Rd(u.tView,u.selectedIndex)}function Uc(u,a){for(let l=a.directiveStart,f=a.directiveEnd;l<f;l++){const p=u.data[l].type.prototype,{ngAfterContentInit:_,ngAfterContentChecked:C,ngAfterViewInit:b,ngAfterViewChecked:O,ngOnDestroy:M}=p;_&&(u.contentHooks||(u.contentHooks=[])).push(-l,_),C&&((u.contentHooks||(u.contentHooks=[])).push(l,C),(u.contentCheckHooks||(u.contentCheckHooks=[])).push(l,C)),b&&(u.viewHooks||(u.viewHooks=[])).push(-l,b),O&&((u.viewHooks||(u.viewHooks=[])).push(l,O),(u.viewCheckHooks||(u.viewCheckHooks=[])).push(l,O)),null!=M&&(u.destroyHooks||(u.destroyHooks=[])).push(l,M)}}function Vc(u,a,l){G_(u,a,3,l)}function Hc(u,a,l,f){(3&u[2])===l&&G_(u,a,l,f)}function Bd(u,a){let l=u[2];(3&l)===a&&(l&=2047,l+=1,u[2]=l)}function G_(u,a,l,f){const p=null!=f?f:-1,_=a.length-1;let C=0;for(let b=void 0!==f?65535&u[18]:0;b<_;b++)if("number"==typeof a[b+1]){if(C=a[b],null!=f&&C>=f)break}else a[b]<0&&(u[18]+=65536),(C<p||-1==p)&&(HI(u,l,a,b),u[18]=(4294901760&u[18])+b+2),b++}function HI(u,a,l,f){const g=l[f]<0,p=l[f+1],C=u[g?-l[f]:l[f]];if(g){if(u[2]>>11<u[18]>>16&&(3&u[2])===a){u[2]+=2048;try{p.call(C)}finally{}}}else try{p.call(C)}finally{}}class ja{constructor(a,l,f){this.factory=a,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=f}}function Gc(u,a,l){const f=Gt(u);let g=0;for(;g<l.length;){const p=l[g];if("number"==typeof p){if(0!==p)break;g++;const _=l[g++],C=l[g++],b=l[g++];f?u.setAttribute(a,C,b,_):a.setAttributeNS(_,C,b)}else{const _=p,C=l[++g];Ud(_)?f&&u.setProperty(a,_,C):f?u.setAttribute(a,_,C):a.setAttribute(_,C),g++}}return g}function W_(u){return 3===u||4===u||6===u}function Ud(u){return 64===u.charCodeAt(0)}function Wc(u,a){if(null!==a&&0!==a.length)if(null===u||0===u.length)u=a.slice();else{let l=-1;for(let f=0;f<a.length;f++){const g=a[f];"number"==typeof g?l=g:0===l||z_(u,l,g,null,-1===l||2===l?a[++f]:null)}}return u}function z_(u,a,l,f,g){let p=0,_=u.length;if(-1===a)_=-1;else for(;p<u.length;){const C=u[p++];if("number"==typeof C){if(C===a){_=-1;break}if(C>a){_=p-1;break}}}for(;p<u.length;){const C=u[p];if("number"==typeof C)break;if(C===l){if(null===f)return void(null!==g&&(u[p+1]=g));if(f===u[p+1])return void(u[p+2]=g)}p++,null!==f&&p++,null!==g&&p++}-1!==_&&(u.splice(_,0,a),p=_+1),u.splice(p++,0,l),null!==f&&u.splice(p++,0,f),null!==g&&u.splice(p++,0,g)}function Y_(u){return-1!==u}function fo(u){return 32767&u}function go(u,a){let l=function $I(u){return u>>16}(u),f=a;for(;l>0;)f=f[15],l--;return f}let Vd=!0;function zc(u){const a=Vd;return Vd=u,a}let XI=0;function Va(u,a){const l=Gd(u,a);if(-1!==l)return l;const f=a[1];f.firstCreatePass&&(u.injectorIndex=a.length,Hd(f.data,u),Hd(a,null),Hd(f.blueprint,null));const g=Yc(u,a),p=u.injectorIndex;if(Y_(g)){const _=fo(g),C=go(g,a),b=C[1].data;for(let O=0;O<8;O++)a[p+O]=C[_+O]|b[_+O]}return a[p+8]=g,p}function Hd(u,a){u.push(0,0,0,0,0,0,0,0,a)}function Gd(u,a){return-1===u.injectorIndex||u.parent&&u.parent.injectorIndex===u.injectorIndex||null===a[u.injectorIndex+8]?-1:u.injectorIndex}function Yc(u,a){if(u.parent&&-1!==u.parent.injectorIndex)return u.parent.injectorIndex;let l=0,f=null,g=a;for(;null!==g;){const p=g[1],_=p.type;if(f=2===_?p.declTNode:1===_?g[6]:null,null===f)return-1;if(l++,g=g[15],-1!==f.injectorIndex)return f.injectorIndex|l<<16}return-1}function $c(u,a,l){!function qI(u,a,l){let f;"string"==typeof l?f=l.charCodeAt(0)||0:l.hasOwnProperty(Fa)&&(f=l[Fa]),null==f&&(f=l[Fa]=XI++);const g=255&f;a.data[u+(g>>5)]|=1<<g}(u,a,l)}function q_(u,a,l){if(l&We.Optional)return u;xc(a,"NodeInjector")}function Z_(u,a,l,f){if(l&We.Optional&&void 0===f&&(f=null),0==(l&(We.Self|We.Host))){const g=u[9],p=Wr(void 0);try{return g?g.get(a,f,l&We.Optional):y_(a,f,l&We.Optional)}finally{Wr(p)}}return q_(f,a,l)}function K_(u,a,l,f=We.Default,g){if(null!==u){const p=function JI(u){if("string"==typeof u)return u.charCodeAt(0)||0;const a=u.hasOwnProperty(Fa)?u[Fa]:void 0;return"number"==typeof a?a>=0?255&a:KI:a}(l);if("function"==typeof p){if(!B_(a,u,f))return f&We.Host?q_(g,l,f):Z_(a,l,f,g);try{const _=p(f);if(null!=_||f&We.Optional)return _;xc(l)}finally{H_()}}else if("number"==typeof p){let _=null,C=Gd(u,a),b=-1,O=f&We.Host?a[16][6]:null;for((-1===C||f&We.SkipSelf)&&(b=-1===C?Yc(u,a):a[C+8],-1!==b&&ev(f,!1)?(_=a[1],C=fo(b),a=go(b,a)):C=-1);-1!==C;){const M=a[1];if(J_(p,C,M.data)){const P=QI(C,a,l,_,f,O);if(P!==Q_)return P}b=a[C+8],-1!==b&&ev(f,a[1].data[C+8]===O)&&J_(p,C,a)?(_=M,C=fo(b),a=go(b,a)):C=-1}}}return Z_(a,l,f,g)}const Q_={};function KI(){return new po(ln(),me())}function QI(u,a,l,f,g,p){const _=a[1],C=_.data[u+8],M=function Xc(u,a,l,f,g){const p=u.providerIndexes,_=a.data,C=1048575&p,b=u.directiveStart,M=p>>20,k=g?C+M:u.directiveEnd;for(let j=f?C:C+M;j<k;j++){const G=_[j];if(j<b&&l===G||j>=b&&G.type===l)return j}if(g){const j=_[b];if(j&&Ai(j)&&j.type===l)return b}return null}(C,_,l,null==f?Fc(C)&&Vd:f!=_&&0!=(3&C.type),g&We.Host&&p===C);return null!==M?Ha(a,_,M,C):Q_}function Ha(u,a,l,f){let g=u[l];const p=a.data;if(function GI(u){return u instanceof ja}(g)){const _=g;_.resolving&&function WT(u,a){const l=a?`. Dependency path: ${a.join(" > ")} > ${u}`:"";throw new wt(-200,`Circular dependency in DI detected for ${u}${l}`)}(Cn(p[l]));const C=zc(_.canSeeViewProviders);_.resolving=!0;const b=_.injectImpl?Wr(_.injectImpl):null;B_(u,f,We.Default);try{g=u[l]=_.factory(void 0,p,u,f),a.firstCreatePass&&l>=f.directiveStart&&function VI(u,a,l){const{ngOnChanges:f,ngOnInit:g,ngDoCheck:p}=a.type.prototype;if(f){const _=I_(a);(l.preOrderHooks||(l.preOrderHooks=[])).push(u,_),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(u,_)}g&&(l.preOrderHooks||(l.preOrderHooks=[])).push(0-u,g),p&&((l.preOrderHooks||(l.preOrderHooks=[])).push(u,p),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(u,p))}(l,p[l],a)}finally{null!==b&&Wr(b),zc(C),_.resolving=!1,H_()}}return g}function J_(u,a,l){return!!(l[a+(u>>5)]&1<<u)}function ev(u,a){return!(u&We.Self||u&We.Host&&a)}class po{constructor(a,l){this._tNode=a,this._lView=l}get(a,l,f){return K_(this._tNode,this._lView,a,f,l)}}const _o="__parameters__";function yo(u,a,l){return zr(()=>{const f=function zd(u){return function(...l){if(u){const f=u(...l);for(const g in f)this[g]=f[g]}}}(a);function g(...p){if(this instanceof g)return f.apply(this,p),this;const _=new g(...p);return C.annotation=_,C;function C(b,O,M){const P=b.hasOwnProperty(_o)?b[_o]:Object.defineProperty(b,_o,{value:[]})[_o];for(;P.length<=M;)P.push(null);return(P[M]=P[M]||[]).push(_),b}}return l&&(g.prototype=Object.create(l.prototype)),g.prototype.ngMetadataName=u,g.annotationCls=g,g})}class yt{constructor(a,l){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof l?this.__NG_ELEMENT_ID__=l:void 0!==l&&(this.\u0275prov=mt({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}toString(){return`InjectionToken ${this._desc}`}}const nS=new yt("AnalyzeForEntryComponents");function $i(u,a){u.forEach(l=>Array.isArray(l)?$i(l,a):a(l))}function nv(u,a,l){a>=u.length?u.push(l):u.splice(a,0,l)}function qc(u,a){return a>=u.length-1?u.pop():u.splice(a,1)[0]}const $a={},qd="__NG_DI_FLAG__",Kc="ngTempTokenPath",dS=/\n/gm,av="__source",gS=At({provide:String,useValue:At});let Xa;function lv(u){const a=Xa;return Xa=u,a}function pS(u,a=We.Default){if(void 0===Xa)throw new wt(203,"");return null===Xa?y_(u,void 0,a):Xa.get(u,a&We.Optional?null:void 0,a)}function Ge(u,a=We.Default){return(function KT(){return vd}()||pS)(Je(u),a)}const mS=Ge;function Zd(u){const a=[];for(let l=0;l<u.length;l++){const f=Je(u[l]);if(Array.isArray(f)){if(0===f.length)throw new wt(900,"");let g,p=We.Default;for(let _=0;_<f.length;_++){const C=f[_],b=_S(C);"number"==typeof b?-1===b?g=C.token:p|=b:g=C}a.push(Ge(g,p))}else a.push(Ge(f))}return a}function qa(u,a){return u[qd]=a,u.prototype[qd]=a,u}function _S(u){return u[qd]}const Qc=qa(yo("Inject",u=>({token:u})),-1),Kr=qa(yo("Optional"),8),Za=qa(yo("SkipSelf"),4);class _v{constructor(a){this.changingThisBreaksApplicationSecurity=a}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const jS=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,US=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Jt=(()=>((Jt=Jt||{})[Jt.NONE=0]="NONE",Jt[Jt.HTML=1]="HTML",Jt[Jt.STYLE=2]="STYLE",Jt[Jt.SCRIPT=3]="SCRIPT",Jt[Jt.URL=4]="URL",Jt[Jt.RESOURCE_URL=5]="RESOURCE_URL",Jt))();function sf(u){const a=function el(){const u=me();return u&&u[12]}();return a?a.sanitize(Jt.URL,u)||"":function Qa(u,a){const l=function PS(u){return u instanceof _v&&u.getTypeName()||null}(u);if(null!=l&&l!==a){if("ResourceURL"===l&&"URL"===a)return!0;throw new Error(`Required a safe ${a}, got a ${l} (see https://g.co/ng/security#xss)`)}return l===a}(u,"URL")?function Qr(u){return u instanceof _v?u.changingThisBreaksApplicationSecurity:u}(u):function nu(u){return(u=String(u)).match(jS)||u.match(US)?u:"unsafe:"+u}($e(u))}const Sv="__ngContext__";function xn(u,a){u[Sv]=a}function af(u){const a=function tl(u){return u[Sv]||null}(u);return a?Array.isArray(a)?a:a.lView:null}function cf(u){return u.ngOriginalError}function cx(u,...a){u.error(...a)}class nl{constructor(){this._console=console}handleError(a){const l=this._findOriginalError(a),f=function lx(u){return u&&u.ngErrorLogger||cx}(a);f(this._console,"ERROR",a),l&&f(this._console,"ORIGINAL ERROR",l)}_findOriginalError(a){let l=a&&cf(a);for(;l&&cf(l);)l=cf(l);return l||null}}const yx=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(It))();function qi(u){return u instanceof Function?u():u}var Zn=(()=>((Zn=Zn||{})[Zn.Important=1]="Important",Zn[Zn.DashCase=2]="DashCase",Zn))();function hf(u,a){return undefined(u,a)}function il(u){const a=u[3];return xi(a)?a[3]:a}function df(u){return Nv(u[13])}function ff(u){return Nv(u[4])}function Nv(u){for(;null!==u&&!xi(u);)u=u[4];return u}function Do(u,a,l,f,g){if(null!=f){let p,_=!1;xi(f)?p=f:zi(f)&&(_=!0,f=f[0]);const C=Qt(f);0===u&&null!==l?null==g?Hv(a,l,C):Ms(a,l,C,g||null,!0):1===u&&null!==l?Ms(a,l,C,g||null,!0):2===u?function qv(u,a,l){const f=ru(u,a);f&&function Lx(u,a,l,f){Gt(u)?u.removeChild(a,l,f):a.removeChild(l)}(u,f,a,l)}(a,C,_):3===u&&a.destroyNode(C),null!=p&&function Nx(u,a,l,f,g){const p=l[7];p!==Qt(l)&&Do(a,u,f,p,g);for(let C=10;C<l.length;C++){const b=l[C];rl(b[1],b,u,a,f,p)}}(a,u,p,l,g)}}function pf(u,a,l){if(Gt(u))return u.createElement(a,l);{const f=null!==l?function _I(u){const a=u.toLowerCase();return"svg"===a?"http://www.w3.org/2000/svg":"math"===a?"http://www.w3.org/1998/MathML/":null}(l):null;return null===f?u.createElement(a):u.createElementNS(f,a)}}function Bv(u,a){const l=u[9],f=l.indexOf(a),g=a[3];1024&a[2]&&(a[2]&=-1025,Md(g,-1)),l.splice(f,1)}function mf(u,a){if(u.length<=10)return;const l=10+a,f=u[l];if(f){const g=f[17];null!==g&&g!==u&&Bv(g,f),a>0&&(u[l-1][4]=f[4]);const p=qc(u,10+a);!function Tx(u,a){rl(u,a,a[11],2,null,null),a[0]=null,a[6]=null}(f[1],f);const _=p[19];null!==_&&_.detachView(p[1]),f[3]=null,f[4]=null,f[2]&=-129}return f}function jv(u,a){if(!(256&a[2])){const l=a[11];Gt(l)&&l.destroyNode&&rl(u,a,l,3,null,null),function xx(u){let a=u[13];if(!a)return _f(u[1],u);for(;a;){let l=null;if(zi(a))l=a[13];else{const f=a[10];f&&(l=f)}if(!l){for(;a&&!a[4]&&a!==u;)zi(a)&&_f(a[1],a),a=a[3];null===a&&(a=u),zi(a)&&_f(a[1],a),l=a&&a[4]}a=l}}(a)}}function _f(u,a){if(!(256&a[2])){a[2]&=-129,a[2]|=256,function Mx(u,a){let l;if(null!=u&&null!=(l=u.destroyHooks))for(let f=0;f<l.length;f+=2){const g=a[l[f]];if(!(g instanceof ja)){const p=l[f+1];if(Array.isArray(p))for(let _=0;_<p.length;_+=2){const C=g[p[_]],b=p[_+1];try{b.call(C)}finally{}}else try{p.call(g)}finally{}}}}(u,a),function Ox(u,a){const l=u.cleanup,f=a[7];let g=-1;if(null!==l)for(let p=0;p<l.length-1;p+=2)if("string"==typeof l[p]){const _=l[p+1],C="function"==typeof _?_(a):Qt(a[_]),b=f[g=l[p+2]],O=l[p+3];"boolean"==typeof O?C.removeEventListener(l[p],b,O):O>=0?f[g=O]():f[g=-O].unsubscribe(),p+=2}else{const _=f[g=l[p+1]];l[p].call(_)}if(null!==f){for(let p=g+1;p<f.length;p++)f[p]();a[7]=null}}(u,a),1===a[1].type&&Gt(a[11])&&a[11].destroy();const l=a[17];if(null!==l&&xi(a[3])){l!==a[3]&&Bv(l,a);const f=a[19];null!==f&&f.detachView(u)}}}function Uv(u,a,l){return function Vv(u,a,l){let f=a;for(;null!==f&&40&f.type;)f=(a=f).parent;if(null===f)return l[0];if(2&f.flags){const g=u.data[f.directiveStart].encapsulation;if(g===Wi.None||g===Wi.Emulated)return null}return di(f,l)}(u,a.parent,l)}function Ms(u,a,l,f,g){Gt(u)?u.insertBefore(a,l,f,g):a.insertBefore(l,f,g)}function Hv(u,a,l){Gt(u)?u.appendChild(a,l):a.appendChild(l)}function Gv(u,a,l,f,g){null!==f?Ms(u,a,l,f,g):Hv(u,a,l)}function ru(u,a){return Gt(u)?u.parentNode(a):a.parentNode}let Yv=function zv(u,a,l){return 40&u.type?di(u,l):null};function su(u,a,l,f){const g=Uv(u,f,a),p=a[11],C=function Wv(u,a,l){return Yv(u,a,l)}(f.parent||a[6],f,a);if(null!=g)if(Array.isArray(l))for(let b=0;b<l.length;b++)Gv(p,g,l[b],C,!1);else Gv(p,g,l,C,!1)}function ou(u,a){if(null!==a){const l=a.type;if(3&l)return di(a,u);if(4&l)return yf(-1,u[a.index]);if(8&l){const f=a.child;if(null!==f)return ou(u,f);{const g=u[a.index];return xi(g)?yf(-1,g):Qt(g)}}if(32&l)return hf(a,u)()||Qt(u[a.index]);{const f=Xv(u,a);return null!==f?Array.isArray(f)?f[0]:ou(il(u[16]),f):ou(u,a.next)}}return null}function Xv(u,a){return null!==a?u[16][6].projection[a.projection]:null}function yf(u,a){const l=10+u+1;if(l<a.length){const f=a[l],g=f[1].firstChild;if(null!==g)return ou(f,g)}return a[7]}function Cf(u,a,l,f,g,p,_){for(;null!=l;){const C=f[l.index],b=l.type;if(_&&0===a&&(C&&xn(Qt(C),f),l.flags|=4),64!=(64&l.flags))if(8&b)Cf(u,a,l.child,f,g,p,!1),Do(a,u,g,C,p);else if(32&b){const O=hf(l,f);let M;for(;M=O();)Do(a,u,g,M,p);Do(a,u,g,C,p)}else 16&b?Zv(u,a,f,l,g,p):Do(a,u,g,C,p);l=_?l.projectionNext:l.next}}function rl(u,a,l,f,g,p){Cf(l,f,u.firstChild,a,g,p,!1)}function Zv(u,a,l,f,g,p){const _=l[16],b=_[6].projection[f.projection];if(Array.isArray(b))for(let O=0;O<b.length;O++)Do(a,u,g,b[O],p);else Cf(u,a,b,_[3],g,p,!0)}function Kv(u,a,l){Gt(u)?u.setAttribute(a,"style",l):a.style.cssText=l}function wf(u,a,l){Gt(u)?""===l?u.removeAttribute(a,"class"):u.setAttribute(a,"class",l):a.className=l}function Qv(u,a,l){let f=u.length;for(;;){const g=u.indexOf(a,l);if(-1===g)return g;if(0===g||u.charCodeAt(g-1)<=32){const p=a.length;if(g+p===f||u.charCodeAt(g+p)<=32)return g}l=g+1}}const Jv="ng-template";function Bx(u,a,l){let f=0;for(;f<u.length;){let g=u[f++];if(l&&"class"===g){if(g=u[f],-1!==Qv(g.toLowerCase(),a,0))return!0}else if(1===g){for(;f<u.length&&"string"==typeof(g=u[f++]);)if(g.toLowerCase()===a)return!0;return!1}}return!1}function ey(u){return 4===u.type&&u.value!==Jv}function jx(u,a,l){return a===(4!==u.type||l?u.value:Jv)}function Ux(u,a,l){let f=4;const g=u.attrs||[],p=function Gx(u){for(let a=0;a<u.length;a++)if(W_(u[a]))return a;return u.length}(g);let _=!1;for(let C=0;C<a.length;C++){const b=a[C];if("number"!=typeof b){if(!_)if(4&f){if(f=2|1&f,""!==b&&!jx(u,b,l)||""===b&&1===a.length){if(Ri(f))return!1;_=!0}}else{const O=8&f?b:a[++C];if(8&f&&null!==u.attrs){if(!Bx(u.attrs,O,l)){if(Ri(f))return!1;_=!0}continue}const P=Vx(8&f?"class":b,g,ey(u),l);if(-1===P){if(Ri(f))return!1;_=!0;continue}if(""!==O){let k;k=P>p?"":g[P+1].toLowerCase();const j=8&f?k:null;if(j&&-1!==Qv(j,O,0)||2&f&&O!==k){if(Ri(f))return!1;_=!0}}}}else{if(!_&&!Ri(f)&&!Ri(b))return!1;if(_&&Ri(b))continue;_=!1,f=b|1&f}}return Ri(f)||_}function Ri(u){return 0==(1&u)}function Vx(u,a,l,f){if(null===a)return-1;let g=0;if(f||!l){let p=!1;for(;g<a.length;){const _=a[g];if(_===u)return g;if(3===_||6===_)p=!0;else{if(1===_||2===_){let C=a[++g];for(;"string"==typeof C;)C=a[++g];continue}if(4===_)break;if(0===_){g+=4;continue}}g+=p?1:2}return-1}return function Wx(u,a){let l=u.indexOf(4);if(l>-1)for(l++;l<u.length;){const f=u[l];if("number"==typeof f)return-1;if(f===a)return l;l++}return-1}(a,u)}function ty(u,a,l=!1){for(let f=0;f<a.length;f++)if(Ux(u,a[f],l))return!0;return!1}function ny(u,a){return u?":not("+a.trim()+")":a}function Yx(u){let a=u[0],l=1,f=2,g="",p=!1;for(;l<u.length;){let _=u[l];if("string"==typeof _)if(2&f){const C=u[++l];g+="["+_+(C.length>0?'="'+C+'"':"")+"]"}else 8&f?g+="."+_:4&f&&(g+=" "+_);else""!==g&&!Ri(_)&&(a+=ny(p,g),g=""),f=_,p=p||!Ri(f);l++}return""!==g&&(a+=ny(p,g)),a}const qe={};function Jr(u){iy(_t(),me(),Mn()+u,!1)}function iy(u,a,l,f){if(!f)if(3==(3&a[2])){const p=u.preOrderCheckHooks;null!==p&&Vc(a,p,l)}else{const p=u.preOrderHooks;null!==p&&Hc(a,p,0,l)}qr(l)}function gy(u,a){const l=u.contentQueries;if(null!==l)for(let f=0;f<l.length;f+=2){const g=l[f],p=l[f+1];if(-1!==p){const _=u.data[p];kd(g),_.contentQueries(2,a[p],p)}}}function sl(u,a,l,f,g,p,_,C,b,O){const M=a.blueprint.slice();return M[0]=g,M[2]=140|f,O_(M),M[3]=M[15]=u,M[8]=l,M[10]=_||u&&u[10],M[11]=C||u&&u[11],M[12]=b||u&&u[12]||null,M[9]=O||u&&u[9]||null,M[6]=p,M[16]=2==a.type?u[16]:M,M}function To(u,a,l,f,g){let p=u.data[a];if(null===p)p=function Lf(u,a,l,f,g){const p=F_(),_=Ld(),b=u.data[a]=function uA(u,a,l,f,g,p){return{type:l,index:f,insertBeforeIndex:null,injectorIndex:a?a.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:p,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,_?p:p&&p.parent,l,a,f,g);return null===u.firstChild&&(u.firstChild=b),null!==p&&(_?null==p.child&&null!==b.parent&&(p.child=b):null===p.next&&(p.next=b)),b}(u,a,l,f,g),function RI(){return Xe.lFrame.inI18n}()&&(p.flags|=64);else if(64&p.type){p.type=l,p.value=f,p.attrs=g;const _=function Ba(){const u=Xe.lFrame,a=u.currentTNode;return u.isParent?a:a.parent}();p.injectorIndex=null===_?-1:_.injectorIndex}return Yi(p,!0),p}function Io(u,a,l,f){if(0===l)return-1;const g=a.length;for(let p=0;p<l;p++)a.push(f),u.blueprint.push(f),u.data.push(null);return g}function ol(u,a,l){Bc(a);try{const f=u.viewQuery;null!==f&&Hf(1,f,l);const g=u.template;null!==g&&py(u,a,g,1,l),u.firstCreatePass&&(u.firstCreatePass=!1),u.staticContentQueries&&gy(u,a),u.staticViewQueries&&Hf(2,u.viewQuery,l);const p=u.components;null!==p&&function aA(u,a){for(let l=0;l<a.length;l++)xA(u,a[l])}(a,p)}catch(f){throw u.firstCreatePass&&(u.incompleteFirstPass=!0,u.firstCreatePass=!1),f}finally{a[2]&=-5,jc()}}function So(u,a,l,f){const g=a[2];if(256!=(256&g)){Bc(a);try{O_(a),function P_(u){return Xe.lFrame.bindingIndex=u}(u.bindingStartIndex),null!==l&&py(u,a,l,2,f);const _=3==(3&g);if(_){const O=u.preOrderCheckHooks;null!==O&&Vc(a,O,null)}else{const O=u.preOrderHooks;null!==O&&Hc(a,O,0,null),Bd(a,0)}if(function IA(u){for(let a=df(u);null!==a;a=ff(a)){if(!a[2])continue;const l=a[9];for(let f=0;f<l.length;f++){const g=l[f],p=g[3];0==(1024&g[2])&&Md(p,1),g[2]|=1024}}}(a),function TA(u){for(let a=df(u);null!==a;a=ff(a))for(let l=10;l<a.length;l++){const f=a[l],g=f[1];Od(f)&&So(g,f,g.template,f[8])}}(a),null!==u.contentQueries&&gy(u,a),_){const O=u.contentCheckHooks;null!==O&&Vc(a,O)}else{const O=u.contentHooks;null!==O&&Hc(a,O,1),Bd(a,1)}!function sA(u,a){const l=u.hostBindingOpCodes;if(null!==l)try{for(let f=0;f<l.length;f++){const g=l[f];if(g<0)qr(~g);else{const p=g,_=l[++f],C=l[++f];OI(_,p),C(2,a[p])}}}finally{qr(-1)}}(u,a);const C=u.components;null!==C&&function oA(u,a){for(let l=0;l<a.length;l++)SA(u,a[l])}(a,C);const b=u.viewQuery;if(null!==b&&Hf(2,b,f),_){const O=u.viewCheckHooks;null!==O&&Vc(a,O)}else{const O=u.viewHooks;null!==O&&Hc(a,O,2),Bd(a,2)}!0===u.firstUpdatePass&&(u.firstUpdatePass=!1),a[2]&=-73,1024&a[2]&&(a[2]&=-1025,Md(a[3],-1))}finally{jc()}}}function lA(u,a,l,f){const g=a[10],_=function R_(u){return 4==(4&u[2])}(a);try{!_&&g.begin&&g.begin(),_&&ol(u,a,f),So(u,a,l,f)}finally{!_&&g.end&&g.end()}}function py(u,a,l,f,g){const p=Mn(),_=2&f;try{qr(-1),_&&a.length>20&&iy(u,a,20,!1),l(f,g)}finally{qr(p)}}function Ff(u,a,l){!L_()||(function _A(u,a,l,f){const g=l.directiveStart,p=l.directiveEnd;u.firstCreatePass||Va(l,a),xn(f,a);const _=l.initialInputs;for(let C=g;C<p;C++){const b=u.data[C],O=Ai(b);O&&EA(a,l,b);const M=Ha(a,u,C,l);xn(M,a),null!==_&&bA(0,C-g,M,b,0,_),O&&(Xn(l.index,a)[8]=M)}}(u,a,l,di(l,a)),128==(128&l.flags)&&function vA(u,a,l){const f=l.directiveStart,g=l.directiveEnd,_=l.index,C=function MI(){return Xe.lFrame.currentDirectiveIndex}();try{qr(_);for(let b=f;b<g;b++){const O=u.data[b],M=a[b];Pd(b),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&Dy(O,M)}}finally{qr(-1),Pd(C)}}(u,a,l))}function Pf(u,a,l=di){const f=a.localNames;if(null!==f){let g=a.index+1;for(let p=0;p<f.length;p+=2){const _=f[p+1],C=-1===_?l(a,u):u[_];u[g++]=C}}}function _y(u){const a=u.tView;return null===a||a.incompleteFirstPass?u.tView=uu(1,null,u.template,u.decls,u.vars,u.directiveDefs,u.pipeDefs,u.viewQuery,u.schemas,u.consts):a}function uu(u,a,l,f,g,p,_,C,b,O){const M=20+f,P=M+g,k=function cA(u,a){const l=[];for(let f=0;f<a;f++)l.push(f<u?null:qe);return l}(M,P),j="function"==typeof O?O():O;return k[1]={type:u,blueprint:k,template:l,queries:null,viewQuery:C,declTNode:a,data:k.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:P,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof p?p():p,pipeRegistry:"function"==typeof _?_():_,firstChild:null,schemas:b,consts:j,incompleteFirstPass:!1}}function wy(u,a,l){for(let f in u)if(u.hasOwnProperty(f)){const g=u[f];(l=null===l?{}:l).hasOwnProperty(f)?l[f].push(a,g):l[f]=[a,g]}return l}function Nf(u,a,l,f){let g=!1;if(L_()){const p=function yA(u,a,l){const f=u.directiveRegistry;let g=null;if(f)for(let p=0;p<f.length;p++){const _=f[p];ty(l,_.selectors,!1)&&(g||(g=[]),$c(Va(l,a),u,_.type),Ai(_)?(Ty(u,l),g.unshift(_)):g.push(_))}return g}(u,a,l),_=null===f?null:{"":-1};if(null!==p){g=!0,Iy(l,u.data.length,p.length);for(let M=0;M<p.length;M++){const P=p[M];P.providersResolver&&P.providersResolver(P)}let C=!1,b=!1,O=Io(u,a,p.length,null);for(let M=0;M<p.length;M++){const P=p[M];l.mergedAttrs=Wc(l.mergedAttrs,P.hostAttrs),Sy(u,l,a,O,P),wA(O,P,_),null!==P.contentQueries&&(l.flags|=8),(null!==P.hostBindings||null!==P.hostAttrs||0!==P.hostVars)&&(l.flags|=128);const k=P.type.prototype;!C&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((u.preOrderHooks||(u.preOrderHooks=[])).push(l.index),C=!0),!b&&(k.ngOnChanges||k.ngDoCheck)&&((u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(l.index),b=!0),O++}!function hA(u,a){const f=a.directiveEnd,g=u.data,p=a.attrs,_=[];let C=null,b=null;for(let O=a.directiveStart;O<f;O++){const M=g[O],P=M.inputs,k=null===p||ey(a)?null:DA(P,p);_.push(k),C=wy(P,O,C),b=wy(M.outputs,O,b)}null!==C&&(C.hasOwnProperty("class")&&(a.flags|=16),C.hasOwnProperty("style")&&(a.flags|=32)),a.initialInputs=_,a.inputs=C,a.outputs=b}(u,l)}_&&function CA(u,a,l){if(a){const f=u.localNames=[];for(let g=0;g<a.length;g+=2){const p=l[a[g+1]];if(null==p)throw new wt(-301,!1);f.push(a[g],p)}}}(l,f,_)}return l.mergedAttrs=Wc(l.mergedAttrs,l.attrs),g}function by(u,a,l,f,g,p){const _=p.hostBindings;if(_){let C=u.hostBindingOpCodes;null===C&&(C=u.hostBindingOpCodes=[]);const b=~a.index;(function mA(u){let a=u.length;for(;a>0;){const l=u[--a];if("number"==typeof l&&l<0)return l}return 0})(C)!=b&&C.push(b),C.push(f,g,_)}}function Dy(u,a){null!==u.hostBindings&&u.hostBindings(1,a)}function Ty(u,a){a.flags|=2,(u.components||(u.components=[])).push(a.index)}function wA(u,a,l){if(l){if(a.exportAs)for(let f=0;f<a.exportAs.length;f++)l[a.exportAs[f]]=u;Ai(a)&&(l[""]=u)}}function Iy(u,a,l){u.flags|=1,u.directiveStart=a,u.directiveEnd=a+l,u.providerIndexes=a}function Sy(u,a,l,f,g){u.data[f]=g;const p=g.factory||(g.factory=Rs(g.type)),_=new ja(p,Ai(g),null);u.blueprint[f]=_,l[f]=_,by(u,a,0,f,Io(u,l,g.hostVars,qe),g)}function EA(u,a,l){const f=di(a,u),g=_y(l),p=u[10],_=hu(u,sl(u,g,null,l.onPush?64:16,f,a,p,p.createRenderer(f,l),null,null));u[a.index]=_}function Zi(u,a,l,f,g,p){const _=di(u,a);!function kf(u,a,l,f,g,p,_){if(null==p)Gt(u)?u.removeAttribute(a,g,l):a.removeAttribute(g);else{const C=null==_?$e(p):_(p,f||"",g);Gt(u)?u.setAttribute(a,g,C,l):l?a.setAttributeNS(l,g,C):a.setAttribute(g,C)}}(a[11],_,p,u.value,l,f,g)}function bA(u,a,l,f,g,p){const _=p[a];if(null!==_){const C=f.setInput;for(let b=0;b<_.length;){const O=_[b++],M=_[b++],P=_[b++];null!==C?f.setInput(l,P,O,M):l[M]=P}}}function DA(u,a){let l=null,f=0;for(;f<a.length;){const g=a[f];if(0!==g)if(5!==g){if("number"==typeof g)break;u.hasOwnProperty(g)&&(null===l&&(l=[]),l.push(g,u[g],a[f+1])),f+=2}else f+=2;else f+=4}return l}function xy(u,a,l,f){return new Array(u,!0,!1,a,null,0,f,l,null,null)}function SA(u,a){const l=Xn(a,u);if(Od(l)){const f=l[1];80&l[2]?So(f,l,f.template,l[8]):l[5]>0&&Bf(l)}}function Bf(u){for(let f=df(u);null!==f;f=ff(f))for(let g=10;g<f.length;g++){const p=f[g];if(1024&p[2]){const _=p[1];So(_,p,_.template,p[8])}else p[5]>0&&Bf(p)}const l=u[1].components;if(null!==l)for(let f=0;f<l.length;f++){const g=Xn(l[f],u);Od(g)&&g[5]>0&&Bf(g)}}function xA(u,a){const l=Xn(a,u),f=l[1];(function AA(u,a){for(let l=a.length;l<u.blueprint.length;l++)a.push(u.blueprint[l])})(f,l),ol(f,l,l[8])}function hu(u,a){return u[13]?u[14][4]=a:u[13]=a,u[14]=a,a}function jf(u){for(;u;){u[2]|=64;const a=il(u);if(aI(u)&&!a)return u;u=a}return null}function Ay(u){!function Uf(u){for(let a=0;a<u.components.length;a++){const l=u.components[a],f=af(l),g=f[1];lA(g,f,g.template,l)}}(u[8])}function Hf(u,a,l){kd(0),a(u,l)}const OA=(()=>Promise.resolve(null))();function Ry(u){return u[7]||(u[7]=[])}function Oy(u){return u.cleanup||(u.cleanup=[])}function Ly(u,a){const l=u[9],f=l?l.get(nl,null):null;f&&f.handleError(a)}function Fy(u,a,l,f,g){for(let p=0;p<l.length;){const _=l[p++],C=l[p++],b=a[_],O=u.data[_];null!==O.setInput?O.setInput(b,g,f,C):b[C]=g}}function vr(u,a,l){const f=function Nc(u,a){return Qt(a[u])}(a,u);!function kv(u,a,l){Gt(u)?u.setValue(a,l):a.textContent=l}(u[11],f,l)}function du(u,a,l){let f=l?u.styles:null,g=l?u.classes:null,p=0;if(null!==a)for(let _=0;_<a.length;_++){const C=a[_];"number"==typeof C?p=C:1==p?g=fd(g,C):2==p&&(f=fd(f,C+": "+a[++_]+";"))}l?u.styles=f:u.stylesWithoutHost=f,l?u.classes=g:u.classesWithoutHost=g}const Gf=new yt("INJECTOR",-1);class Py{get(a,l=$a){if(l===$a){const f=new Error(`NullInjectorError: No provider for ${bt(a)}!`);throw f.name="NullInjectorError",f}return l}}const Wf=new yt("Set Injector scope."),al={},FA={};let zf;function Ny(){return void 0===zf&&(zf=new Py),zf}function ky(u,a=null,l=null,f){const g=By(u,a,l,f);return g._resolveInjectorDefTypes(),g}function By(u,a=null,l=null,f){return new PA(u,l,a||Ny(),f)}class PA{constructor(a,l,f,g=null){this.parent=f,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const p=[];l&&$i(l,C=>this.processProvider(C,a,l)),$i([a],C=>this.processInjectorType(C,[],p)),this.records.set(Gf,xo(void 0,this));const _=this.records.get(Wf);this.scope=null!=_?_.value:null,this.source=g||("object"==typeof a?null:bt(a))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(a=>a.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(a,l=$a,f=We.Default){this.assertNotDestroyed();const g=lv(this),p=Wr(void 0);try{if(!(f&We.SkipSelf)){let C=this.records.get(a);if(void 0===C){const b=function GA(u){return"function"==typeof u||"object"==typeof u&&u instanceof yt}(a)&&md(a);C=b&&this.injectableDefInScope(b)?xo(Yf(a),al):null,this.records.set(a,C)}if(null!=C)return this.hydrate(a,C)}return(f&We.Self?Ny():this.parent).get(a,l=f&We.Optional&&l===$a?null:l)}catch(_){if("NullInjectorError"===_.name){if((_[Kc]=_[Kc]||[]).unshift(bt(a)),g)throw _;return function vS(u,a,l,f){const g=u[Kc];throw a[av]&&g.unshift(a[av]),u.message=function yS(u,a,l,f=null){u=u&&"\n"===u.charAt(0)&&"\u0275"==u.charAt(1)?u.substr(2):u;let g=bt(a);if(Array.isArray(a))g=a.map(bt).join(" -> ");else if("object"==typeof a){let p=[];for(let _ in a)if(a.hasOwnProperty(_)){let C=a[_];p.push(_+":"+("string"==typeof C?JSON.stringify(C):bt(C)))}g=`{${p.join(", ")}}`}return`${l}${f?"("+f+")":""}[${g}]: ${u.replace(dS,"\n  ")}`}("\n"+u.message,g,l,f),u.ngTokenPath=g,u[Kc]=null,u}(_,a,"R3InjectorError",this.source)}throw _}finally{Wr(p),lv(g)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(a=>this.get(a))}toString(){const a=[];return this.records.forEach((f,g)=>a.push(bt(g))),`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new wt(205,!1)}processInjectorType(a,l,f){if(!(a=Je(a)))return!1;let g=__(a);const p=null==g&&a.ngModule||void 0,_=void 0===p?a:p,C=-1!==f.indexOf(_);if(void 0!==p&&(g=__(p)),null==g)return!1;if(null!=g.imports&&!C){let M;f.push(_);try{$i(g.imports,P=>{this.processInjectorType(P,l,f)&&(void 0===M&&(M=[]),M.push(P))})}finally{}if(void 0!==M)for(let P=0;P<M.length;P++){const{ngModule:k,providers:j}=M[P];$i(j,G=>this.processProvider(G,k,j||Ot))}}this.injectorDefTypes.add(_);const b=Rs(_)||(()=>new _);this.records.set(_,xo(b,al));const O=g.providers;if(null!=O&&!C){const M=a;$i(O,P=>this.processProvider(P,M,O))}return void 0!==p&&void 0!==a.providers}processProvider(a,l,f){let g=Ao(a=Je(a))?a:Je(a&&a.provide);const p=function kA(u,a,l){return Uy(u)?xo(void 0,u.useValue):xo(function jy(u,a,l){let f;if(Ao(u)){const g=Je(u);return Rs(g)||Yf(g)}if(Uy(u))f=()=>Je(u.useValue);else if(function jA(u){return!(!u||!u.useFactory)}(u))f=()=>u.useFactory(...Zd(u.deps||[]));else if(function BA(u){return!(!u||!u.useExisting)}(u))f=()=>Ge(Je(u.useExisting));else{const g=Je(u&&(u.useClass||u.provide));if(!function VA(u){return!!u.deps}(u))return Rs(g)||Yf(g);f=()=>new g(...Zd(u.deps))}return f}(u),al)}(a);if(Ao(a)||!0!==a.multi)this.records.get(g);else{let _=this.records.get(g);_||(_=xo(void 0,al,!0),_.factory=()=>Zd(_.multi),this.records.set(g,_)),g=a,_.multi.push(a)}this.records.set(g,p)}hydrate(a,l){return l.value===al&&(l.value=FA,l.value=l.factory()),"object"==typeof l.value&&l.value&&function HA(u){return null!==u&&"object"==typeof u&&"function"==typeof u.ngOnDestroy}(l.value)&&this.onDestroy.add(l.value),l.value}injectableDefInScope(a){if(!a.providedIn)return!1;const l=Je(a.providedIn);return"string"==typeof l?"any"===l||l===this.scope:this.injectorDefTypes.has(l)}}function Yf(u){const a=md(u),l=null!==a?a.factory:Rs(u);if(null!==l)return l;if(u instanceof yt)throw new wt(204,!1);if(u instanceof Function)return function NA(u){const a=u.length;if(a>0)throw function Ya(u,a){const l=[];for(let f=0;f<u;f++)l.push(a);return l}(a,"?"),new wt(204,!1);const l=function XT(u){const a=u&&(u[Ac]||u[v_]);if(a){const l=function qT(u){if(u.hasOwnProperty("name"))return u.name;const a=(""+u).match(/^function\s*([^\s(]+)/);return null===a?"":a[1]}(u);return console.warn(`DEPRECATED: DI is instantiating a token "${l}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${l}" class.`),a}return null}(u);return null!==l?()=>l.factory(u):()=>new u}(u);throw new wt(204,!1)}function xo(u,a,l=!1){return{factory:u,value:a,multi:l?[]:void 0}}function Uy(u){return null!==u&&"object"==typeof u&&gS in u}function Ao(u){return"function"==typeof u}let Qn=(()=>{class u{static create(l,f){var g;if(Array.isArray(l))return ky({name:""},f,l,"");{const p=null!==(g=l.name)&&void 0!==g?g:"";return ky({name:p},l.parent,l.providers,p)}}}return u.THROW_IF_NOT_FOUND=$a,u.NULL=new Py,u.\u0275prov=mt({token:u,providedIn:"any",factory:()=>Ge(Gf)}),u.__NG_ELEMENT_ID__=-1,u})();function KA(u,a){Uc(af(u)[1],ln())}let fu=null;function Ro(){if(!fu){const u=It.Symbol;if(u&&u.iterator)fu=u.iterator;else{const a=Object.getOwnPropertyNames(Map.prototype);for(let l=0;l<a.length;++l){const f=a[l];"entries"!==f&&"size"!==f&&Map.prototype[f]===Map.prototype.entries&&(fu=f)}}}return fu}function ll(u){return!!function Zf(u){return null!==u&&("function"==typeof u||"object"==typeof u)}(u)&&(Array.isArray(u)||!(u instanceof Map)&&Ro()in u)}function An(u,a,l){return!Object.is(u[a],l)&&(u[a]=l,!0)}function Kf(u,a,l,f){const g=me();return An(g,ho(),a)&&(_t(),Zi(Wt(),g,u,a,l,f)),Kf}function ul(u,a,l,f,g,p,_,C){const b=me(),O=_t(),M=u+20,P=O.firstCreatePass?function lR(u,a,l,f,g,p,_,C,b){const O=a.consts,M=To(a,u,4,_||null,Xr(O,C));Nf(a,l,M,Xr(O,b)),Uc(a,M);const P=M.tViews=uu(2,M,f,g,p,a.directiveRegistry,a.pipeRegistry,null,a.schemas,O);return null!==a.queries&&(a.queries.template(a,M),P.queries=a.queries.embeddedTView(M)),M}(M,O,b,a,l,f,g,p,_):O.data[M];Yi(P,!1);const k=b[11].createComment("");su(O,b,k,P),xn(k,b),hu(b,b[M]=xy(k,b,k,P)),Pc(P)&&Ff(O,b,P),null!=_&&Pf(b,P,C)}function Be(u,a=We.Default){const l=me();return null===l?Ge(u,a):K_(ln(),l,Je(u),a)}function ng(){throw new Error("invalid")}function Qi(u,a,l){const f=me();return An(f,ho(),a)&&function Kn(u,a,l,f,g,p,_,C){const b=di(a,l);let M,O=a.inputs;!C&&null!=O&&(M=O[f])?(Fy(u,l,M,f,g),Fc(a)&&function fA(u,a){const l=Xn(a,u);16&l[2]||(l[2]|=64)}(l,a.index)):3&a.type&&(f=function dA(u){return"class"===u?"className":"for"===u?"htmlFor":"formaction"===u?"formAction":"innerHtml"===u?"innerHTML":"readonly"===u?"readOnly":"tabindex"===u?"tabIndex":u}(f),g=null!=_?_(g,a.value||"",f):g,Gt(p)?p.setProperty(b,f,g):Ud(f)||(b.setProperty?b.setProperty(f,g):b[f]=g))}(_t(),Wt(),f,u,a,f[11],l,!1),Qi}function ig(u,a,l,f,g){const _=g?"class":"style";Fy(u,l,a.inputs[_],_,f)}function mn(u,a,l,f){const g=me(),p=_t(),_=20+u,C=g[11],b=g[_]=pf(C,a,function UI(){return Xe.lFrame.currentNamespace}()),O=p.firstCreatePass?function AR(u,a,l,f,g,p,_){const C=a.consts,O=To(a,u,2,g,Xr(C,p));return Nf(a,l,O,Xr(C,_)),null!==O.attrs&&du(O,O.attrs,!1),null!==O.mergedAttrs&&du(O,O.mergedAttrs,!0),null!==a.queries&&a.queries.elementStart(a,O),O}(_,p,g,0,a,l,f):p.data[_];Yi(O,!0);const M=O.mergedAttrs;null!==M&&Gc(C,b,M);const P=O.classes;null!==P&&wf(C,b,P);const k=O.styles;return null!==k&&Kv(C,b,k),64!=(64&O.flags)&&su(p,g,b,O),0===function bI(){return Xe.lFrame.elementDepthCount}()&&xn(b,g),function DI(){Xe.lFrame.elementDepthCount++}(),Pc(O)&&(Ff(p,g,O),function my(u,a,l){if(bd(a)){const g=a.directiveEnd;for(let p=a.directiveStart;p<g;p++){const _=u.data[p];_.contentQueries&&_.contentQueries(1,l[p],p)}}}(p,O,g)),null!==f&&Pf(g,O),mn}function un(){let u=ln();Ld()?function Fd(){Xe.lFrame.isParent=!1}():(u=u.parent,Yi(u,!1));const a=u;!function TI(){Xe.lFrame.elementDepthCount--}();const l=_t();return l.firstCreatePass&&(Uc(l,u),bd(u)&&l.queries.elementEnd(u)),null!=a.classesWithoutHost&&function zI(u){return 0!=(16&u.flags)}(a)&&ig(l,a,me(),a.classesWithoutHost,!0),null!=a.stylesWithoutHost&&function YI(u){return 0!=(32&u.flags)}(a)&&ig(l,a,me(),a.stylesWithoutHost,!1),un}function Ji(u,a,l,f){return mn(u,a,l,f),un(),Ji}function mu(u){return!!u&&"function"==typeof u.then}const b0=function E0(u){return!!u&&"function"==typeof u.subscribe};function Vo(u,a,l,f){const g=me(),p=_t(),_=ln();return function T0(u,a,l,f,g,p,_,C){const b=Pc(f),M=u.firstCreatePass&&Oy(u),P=a[8],k=Ry(a);let j=!0;if(3&f.type||C){const Y=di(f,a),X=C?C(Y):Y,$=k.length,K=C?ge=>C(Qt(ge[f.index])):f.index;if(Gt(l)){let ge=null;if(!C&&b&&(ge=function MR(u,a,l,f){const g=u.cleanup;if(null!=g)for(let p=0;p<g.length-1;p+=2){const _=g[p];if(_===l&&g[p+1]===f){const C=a[7],b=g[p+2];return C.length>b?C[b]:null}"string"==typeof _&&(p+=2)}return null}(u,a,g,f.index)),null!==ge)(ge.__ngLastListenerFn__||ge).__ngNextListenerFn__=p,ge.__ngLastListenerFn__=p,j=!1;else{p=og(f,a,P,p,!1);const _e=l.listen(X,g,p);k.push(p,_e),M&&M.push(g,K,$,$+1)}}else p=og(f,a,P,p,!0),X.addEventListener(g,p,_),k.push(p),M&&M.push(g,K,$,_)}else p=og(f,a,P,p,!1);const G=f.outputs;let z;if(j&&null!==G&&(z=G[g])){const Y=z.length;if(Y)for(let X=0;X<Y;X+=2){const Te=a[z[X]][z[X+1]].subscribe(p),Se=k.length;k.push(p,Te),M&&M.push(g,f.index,Se,-(Se+1))}}}(p,g,g[11],_,u,a,!!l,f),Vo}function I0(u,a,l,f){try{return!1!==l(f)}catch(g){return Ly(u,g),!1}}function og(u,a,l,f,g){return function p(_){if(_===Function)return f;const C=2&u.flags?Xn(u.index,a):a;0==(32&a[2])&&jf(C);let b=I0(a,0,f,_),O=p.__ngNextListenerFn__;for(;O;)b=I0(a,0,O,_)&&b,O=O.__ngNextListenerFn__;return g&&!1===b&&(_.preventDefault(),_.returnValue=!1),b}}function _u(u=1){return function FI(u){return(Xe.lFrame.contextLView=function PI(u,a){for(;u>0;)a=a[15],u--;return a}(u,Xe.lFrame.contextLView))[8]}(u)}function yr(u,a=""){const l=me(),f=_t(),g=u+20,p=f.firstCreatePass?To(f,g,1,a,null):f.data[g],_=l[g]=function gf(u,a){return Gt(u)?u.createText(a):u.createTextNode(a)}(l[11],a);su(f,l,_,p),Yi(p,!1)}function Go(u,a,l){const f=me(),g=function Mo(u,a,l,f){return An(u,ho(),l)?a+$e(l)+f:qe}(f,u,a,l);return g!==qe&&vr(f,Mn(),g),Go}const yu="en-US";let yC=yu;class WC{}class EO{resolveComponentFactory(a){throw function wO(u){const a=Error(`No component factory found for ${bt(u)}. Did you add it to @NgModule.entryComponents?`);return a.ngComponent=u,a}(a)}}let ml=(()=>{class u{}return u.NULL=new EO,u})();function bO(){return Yo(ln(),me())}function Yo(u,a){return new ns(di(u,a))}let ns=(()=>{class u{constructor(l){this.nativeElement=l}}return u.__NG_ELEMENT_ID__=bO,u})();class YC{}let SO=(()=>{class u{}return u.\u0275prov=mt({token:u,providedIn:"root",factory:()=>null}),u})();class Tu{constructor(a){this.full=a,this.major=a.split(".")[0],this.minor=a.split(".")[1],this.patch=a.split(".").slice(2).join(".")}}const xO=new Tu("13.3.10"),pg={};function Iu(u,a,l,f,g=!1){for(;null!==l;){const p=a[l.index];if(null!==p&&f.push(Qt(p)),xi(p))for(let C=10;C<p.length;C++){const b=p[C],O=b[1].firstChild;null!==O&&Iu(b[1],b,O,f)}const _=l.type;if(8&_)Iu(u,a,l.child,f);else if(32&_){const C=hf(l,a);let b;for(;b=C();)f.push(b)}else if(16&_){const C=Xv(a,l);if(Array.isArray(C))f.push(...C);else{const b=il(a[16]);Iu(b[1],b,C,f,!0)}}l=g?l.projectionNext:l.next}return f}class _l{constructor(a,l){this._lView=a,this._cdRefInjectingView=l,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const a=this._lView,l=a[1];return Iu(l,a,l.firstChild,[])}get context(){return this._lView[8]}set context(a){this._lView[8]=a}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const a=this._lView[3];if(xi(a)){const l=a[8],f=l?l.indexOf(this):-1;f>-1&&(mf(a,f),qc(l,f))}this._attachedToViewContainer=!1}jv(this._lView[1],this._lView)}onDestroy(a){!function Cy(u,a,l,f){const g=Ry(a);null===l?g.push(f):(g.push(l),u.firstCreatePass&&Oy(u).push(f,g.length-1))}(this._lView[1],this._lView,null,a)}markForCheck(){jf(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function Vf(u,a,l){const f=a[10];f.begin&&f.begin();try{So(u,a,u.template,l)}catch(g){throw Ly(a,g),g}finally{f.end&&f.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new wt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Sx(u,a){rl(u,a,a[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new wt(902,"");this._appRef=a}}class AO extends _l{constructor(a){super(a),this._view=a}detectChanges(){Ay(this._view)}checkNoChanges(){}get context(){return null}}class $C extends ml{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){const l=In(a);return new mg(l,this.ngModule)}}function XC(u){const a=[];for(let l in u)u.hasOwnProperty(l)&&a.push({propName:u[l],templateName:l});return a}class mg extends WC{constructor(a,l){super(),this.componentDef=a,this.ngModule=l,this.componentType=a.type,this.selector=function $x(u){return u.map(Yx).join(",")}(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!l}get inputs(){return XC(this.componentDef.inputs)}get outputs(){return XC(this.componentDef.outputs)}create(a,l,f,g){const p=(g=g||this.ngModule)?function OO(u,a){return{get:(l,f,g)=>{const p=u.get(l,pg,g);return p!==pg||f===pg?p:a.get(l,f,g)}}}(a,g.injector):a,_=p.get(YC,A_),C=p.get(SO,null),b=_.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",M=f?function yy(u,a,l){if(Gt(u))return u.selectRootElement(a,l===Wi.ShadowDom);let f="string"==typeof a?u.querySelector(a):a;return f.textContent="",f}(b,f,this.componentDef.encapsulation):pf(_.createRenderer(null,this.componentDef),O,function RO(u){const a=u.toLowerCase();return"svg"===a?"svg":"math"===a?"math":null}(O)),P=this.componentDef.onPush?576:528,k=function Ky(u,a){return{components:[],scheduler:u||yx,clean:OA,playerHandler:a||null,flags:0}}(),j=uu(0,null,null,1,0,null,null,null,null,null),G=sl(null,j,k,P,null,null,_,b,C,p);let z,Y;Bc(G);try{const X=function qy(u,a,l,f,g,p){const _=l[1];l[20]=u;const b=To(_,20,2,"#host",null),O=b.mergedAttrs=a.hostAttrs;null!==O&&(du(b,O,!0),null!==u&&(Gc(g,u,O),null!==b.classes&&wf(g,u,b.classes),null!==b.styles&&Kv(g,u,b.styles)));const M=f.createRenderer(u,a),P=sl(l,_y(a),null,a.onPush?64:16,l[20],b,f,M,p||null,null);return _.firstCreatePass&&($c(Va(b,l),_,a.type),Ty(_,b),Iy(b,l.length,1)),hu(l,P),l[20]=P}(M,this.componentDef,G,_,b);if(M)if(f)Gc(b,M,["ng-version",xO.full]);else{const{attrs:$,classes:K}=function Xx(u){const a=[],l=[];let f=1,g=2;for(;f<u.length;){let p=u[f];if("string"==typeof p)2===g?""!==p&&a.push(p,u[++f]):8===g&&l.push(p);else{if(!Ri(g))break;g=p}f++}return{attrs:a,classes:l}}(this.componentDef.selectors[0]);$&&Gc(b,M,$),K&&K.length>0&&wf(b,M,K.join(" "))}if(Y=Rd(j,20),void 0!==l){const $=Y.projection=[];for(let K=0;K<this.ngContentSelectors.length;K++){const ge=l[K];$.push(null!=ge?Array.from(ge):null)}}z=function Zy(u,a,l,f,g){const p=l[1],_=function pA(u,a,l){const f=ln();u.firstCreatePass&&(l.providersResolver&&l.providersResolver(l),Sy(u,f,a,Io(u,a,1,null),l));const g=Ha(a,u,f.directiveStart,f);xn(g,a);const p=di(f,a);return p&&xn(p,a),g}(p,l,a);if(f.components.push(_),u[8]=_,g&&g.forEach(b=>b(_,a)),a.contentQueries){const b=ln();a.contentQueries(1,_,b.directiveStart)}const C=ln();return!p.firstCreatePass||null===a.hostBindings&&null===a.hostAttrs||(qr(C.index),by(l[1],C,0,C.directiveStart,C.directiveEnd,a),Dy(a,_)),_}(X,this.componentDef,G,k,[KA]),ol(j,G,null)}finally{jc()}return new LO(this.componentType,z,Yo(Y,G),G,Y)}}class LO extends class CO{}{constructor(a,l,f,g,p){super(),this.location=f,this._rootLView=g,this._tNode=p,this.instance=l,this.hostView=this.changeDetectorRef=new AO(g),this.componentType=a}get injector(){return new po(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}}class Cr{}class qC{}const $o=new Map;class QC extends Cr{constructor(a,l){super(),this._parent=l,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new $C(this);const f=ci(a);this._bootstrapComponents=qi(f.bootstrap),this._r3Injector=By(a,l,[{provide:Cr,useValue:this},{provide:ml,useValue:this.componentFactoryResolver}],bt(a)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(a)}get(a,l=Qn.THROW_IF_NOT_FOUND,f=We.Default){return a===Qn||a===Cr||a===Gf?this:this._r3Injector.get(a,l,f)}destroy(){const a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}}class _g extends qC{constructor(a){super(),this.moduleType=a,null!==ci(a)&&function PO(u){const a=new Set;!function l(f){const g=ci(f,!0),p=g.id;null!==p&&(function ZC(u,a,l){if(a&&a!==l)throw new Error(`Duplicate module registered for ${u} - ${bt(a)} vs ${bt(a.name)}`)}(p,$o.get(p),f),$o.set(p,f));const _=qi(g.imports);for(const C of _)a.has(C)||(a.add(C),l(C))}(u)}(a)}create(a){return new QC(this.moduleType,a)}}function Su(u,a,l){const f=function On(){const u=Xe.lFrame;let a=u.bindingRootIndex;return-1===a&&(a=u.bindingRootIndex=u.tView.bindingStartIndex),a}()+u,g=me();return g[f]===qe?function Ki(u,a,l){return u[a]=l}(g,f,l?a.call(l):a()):function cl(u,a){return u[a]}(g,f)}function vg(u){return a=>{setTimeout(u,void 0,a)}}const Pn=class QO extends cr{constructor(a=!1){super(),this.__isAsync=a}emit(a){super.next(a)}subscribe(a,l,f){var g,p,_;let C=a,b=l||(()=>null),O=f;if(a&&"object"==typeof a){const P=a;C=null===(g=P.next)||void 0===g?void 0:g.bind(P),b=null===(p=P.error)||void 0===p?void 0:p.bind(P),O=null===(_=P.complete)||void 0===_?void 0:_.bind(P)}this.__isAsync&&(b=vg(b),C&&(C=vg(C)),O&&(O=vg(O)));const M=super.subscribe({next:C,error:b,complete:O});return a instanceof li&&a.add(M),M}};Symbol;let wr=(()=>{class u{}return u.__NG_ELEMENT_ID__=nM,u})();const eM=wr,tM=class extends eM{constructor(a,l,f){super(),this._declarationLView=a,this._declarationTContainer=l,this.elementRef=f}createEmbeddedView(a){const l=this._declarationTContainer.tViews,f=sl(this._declarationLView,l,a,16,null,l.declTNode,null,null,null,null);f[17]=this._declarationLView[this._declarationTContainer.index];const p=this._declarationLView[19];return null!==p&&(f[19]=p.createEmbeddedView(l)),ol(l,f,a),new _l(f)}};function nM(){return xu(ln(),me())}function xu(u,a){return 4&u.type?new tM(a,u,Yo(u,a)):null}let Pi=(()=>{class u{}return u.__NG_ELEMENT_ID__=iM,u})();function iM(){return function ow(u,a){let l;const f=a[u.index];if(xi(f))l=f;else{let g;if(8&u.type)g=Qt(f);else{const p=a[11];g=p.createComment("");const _=di(u,a);Ms(p,ru(p,_),g,function Fx(u,a){return Gt(u)?u.nextSibling(a):a.nextSibling}(p,_),!1)}a[u.index]=l=xy(f,a,g,u),hu(a,l)}return new rw(l,u,a)}(ln(),me())}const rM=Pi,rw=class extends rM{constructor(a,l,f){super(),this._lContainer=a,this._hostTNode=l,this._hostLView=f}get element(){return Yo(this._hostTNode,this._hostLView)}get injector(){return new po(this._hostTNode,this._hostLView)}get parentInjector(){const a=Yc(this._hostTNode,this._hostLView);if(Y_(a)){const l=go(a,this._hostLView),f=fo(a);return new po(l[1].data[f+8],l)}return new po(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){const l=sw(this._lContainer);return null!==l&&l[a]||null}get length(){return this._lContainer.length-10}createEmbeddedView(a,l,f){const g=a.createEmbeddedView(l||{});return this.insert(g,f),g}createComponent(a,l,f,g,p){const _=a&&!function za(u){return"function"==typeof u}(a);let C;if(_)C=l;else{const P=l||{};C=P.index,f=P.injector,g=P.projectableNodes,p=P.ngModuleRef}const b=_?a:new mg(In(a)),O=f||this.parentInjector;if(!p&&null==b.ngModule){const k=(_?O:this.parentInjector).get(Cr,null);k&&(p=k)}const M=b.create(O,g,void 0,p);return this.insert(M.hostView,C),M}insert(a,l){const f=a._lView,g=f[1];if(function EI(u){return xi(u[3])}(f)){const M=this.indexOf(a);if(-1!==M)this.detach(M);else{const P=f[3],k=new rw(P,P[6],P[3]);k.detach(k.indexOf(a))}}const p=this._adjustIndex(l),_=this._lContainer;!function Ax(u,a,l,f){const g=10+f,p=l.length;f>0&&(l[g-1][4]=a),f<p-10?(a[4]=l[g],nv(l,10+f,a)):(l.push(a),a[4]=null),a[3]=l;const _=a[17];null!==_&&l!==_&&function Rx(u,a){const l=u[9];a[16]!==a[3][3][16]&&(u[2]=!0),null===l?u[9]=[a]:l.push(a)}(_,a);const C=a[19];null!==C&&C.insertView(u),a[2]|=128}(g,f,_,p);const C=yf(p,_),b=f[11],O=ru(b,_[7]);return null!==O&&function Ix(u,a,l,f,g,p){f[0]=g,f[6]=a,rl(u,f,l,1,g,p)}(g,_[6],b,f,O,C),a.attachToViewContainerRef(),nv(Cg(_),p,a),a}move(a,l){return this.insert(a,l)}indexOf(a){const l=sw(this._lContainer);return null!==l?l.indexOf(a):-1}remove(a){const l=this._adjustIndex(a,-1),f=mf(this._lContainer,l);f&&(qc(Cg(this._lContainer),l),jv(f[1],f))}detach(a){const l=this._adjustIndex(a,-1),f=mf(this._lContainer,l);return f&&null!=qc(Cg(this._lContainer),l)?new _l(f):null}_adjustIndex(a,l=0){return null==a?this.length+l:a}};function sw(u){return u[8]}function Cg(u){return u[8]||(u[8]=[])}function dw(u,a){return xu(u,a)}function Ou(...u){}const Fg=new yt("Application Initializer");let Pg=(()=>{class u{constructor(l){this.appInits=l,this.resolve=Ou,this.reject=Ou,this.initialized=!1,this.done=!1,this.donePromise=new Promise((f,g)=>{this.resolve=f,this.reject=g})}runInitializers(){if(this.initialized)return;const l=[],f=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const p=this.appInits[g]();if(mu(p))l.push(p);else if(b0(p)){const _=new Promise((C,b)=>{p.subscribe({complete:C,error:b})});l.push(_)}}Promise.all(l).then(()=>{f()}).catch(g=>{this.reject(g)}),0===l.length&&f(),this.initialized=!0}}return u.\u0275fac=function(l){return new(l||u)(Ge(Fg,8))},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();const wl=new yt("AppId",{providedIn:"root",factory:function Aw(){return`${Ng()}${Ng()}${Ng()}`}});function Ng(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Rw=new yt("Platform Initializer"),Ow=new yt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Mw=new yt("appBootstrapListener");let RM=(()=>{class u{log(l){console.log(l)}warn(l){console.warn(l)}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"platform"}),u})();const is=new yt("LocaleId",{providedIn:"root",factory:()=>mS(is,We.Optional|We.SkipSelf)||function OM(){return"undefined"!=typeof $localize&&$localize.locale||yu}()});class LM{constructor(a,l){this.ngModuleFactory=a,this.componentFactories=l}}let Lw=(()=>{class u{compileModuleSync(l){return new _g(l)}compileModuleAsync(l){return Promise.resolve(this.compileModuleSync(l))}compileModuleAndAllComponentsSync(l){const f=this.compileModuleSync(l),p=qi(ci(l).declarations).reduce((_,C)=>{const b=In(C);return b&&_.push(new mg(b)),_},[]);return new LM(f,p)}compileModuleAndAllComponentsAsync(l){return Promise.resolve(this.compileModuleAndAllComponentsSync(l))}clearCache(){}clearCacheFor(l){}getModuleId(l){}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();const PM=(()=>Promise.resolve(0))();function kg(u){"undefined"==typeof Zone?PM.then(()=>{u&&u.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",u)}class wn{constructor({enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:f=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pn(!1),this.onMicrotaskEmpty=new Pn(!1),this.onStable=new Pn(!1),this.onError=new Pn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!f&&l,g.shouldCoalesceRunChangeDetection=f,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function NM(){let u=It.requestAnimationFrame,a=It.cancelAnimationFrame;if("undefined"!=typeof Zone&&u&&a){const l=u[Zone.__symbol__("OriginalDelegate")];l&&(u=l);const f=a[Zone.__symbol__("OriginalDelegate")];f&&(a=f)}return{nativeRequestAnimationFrame:u,nativeCancelAnimationFrame:a}}().nativeRequestAnimationFrame,function jM(u){const a=()=>{!function BM(u){u.isCheckStableRunning||-1!==u.lastRequestAnimationFrameId||(u.lastRequestAnimationFrameId=u.nativeRequestAnimationFrame.call(It,()=>{u.fakeTopEventTask||(u.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{u.lastRequestAnimationFrameId=-1,jg(u),u.isCheckStableRunning=!0,Bg(u),u.isCheckStableRunning=!1},void 0,()=>{},()=>{})),u.fakeTopEventTask.invoke()}),jg(u))}(u)};u._inner=u._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,f,g,p,_,C)=>{try{return Fw(u),l.invokeTask(g,p,_,C)}finally{(u.shouldCoalesceEventChangeDetection&&"eventTask"===p.type||u.shouldCoalesceRunChangeDetection)&&a(),Pw(u)}},onInvoke:(l,f,g,p,_,C,b)=>{try{return Fw(u),l.invoke(g,p,_,C,b)}finally{u.shouldCoalesceRunChangeDetection&&a(),Pw(u)}},onHasTask:(l,f,g,p)=>{l.hasTask(g,p),f===g&&("microTask"==p.change?(u._hasPendingMicrotasks=p.microTask,jg(u),Bg(u)):"macroTask"==p.change&&(u.hasPendingMacrotasks=p.macroTask))},onHandleError:(l,f,g,p)=>(l.handleError(g,p),u.runOutsideAngular(()=>u.onError.emit(p)),!1)})}(g)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!wn.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(wn.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(a,l,f){return this._inner.run(a,l,f)}runTask(a,l,f,g){const p=this._inner,_=p.scheduleEventTask("NgZoneEvent: "+g,a,kM,Ou,Ou);try{return p.runTask(_,l,f)}finally{p.cancelTask(_)}}runGuarded(a,l,f){return this._inner.runGuarded(a,l,f)}runOutsideAngular(a){return this._outer.run(a)}}const kM={};function Bg(u){if(0==u._nesting&&!u.hasPendingMicrotasks&&!u.isStable)try{u._nesting++,u.onMicrotaskEmpty.emit(null)}finally{if(u._nesting--,!u.hasPendingMicrotasks)try{u.runOutsideAngular(()=>u.onStable.emit(null))}finally{u.isStable=!0}}}function jg(u){u.hasPendingMicrotasks=!!(u._hasPendingMicrotasks||(u.shouldCoalesceEventChangeDetection||u.shouldCoalesceRunChangeDetection)&&-1!==u.lastRequestAnimationFrameId)}function Fw(u){u._nesting++,u.isStable&&(u.isStable=!1,u.onUnstable.emit(null))}function Pw(u){u._nesting--,Bg(u)}class UM{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pn,this.onMicrotaskEmpty=new Pn,this.onStable=new Pn,this.onError=new Pn}run(a,l,f){return a.apply(l,f)}runGuarded(a,l,f){return a.apply(l,f)}runOutsideAngular(a){return a()}runTask(a,l,f,g){return a.apply(l,f)}}let Ug=(()=>{class u{constructor(l){this._ngZone=l,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),l.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{wn.assertNotInAngularZone(),kg(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())kg(()=>{for(;0!==this._callbacks.length;){let l=this._callbacks.pop();clearTimeout(l.timeoutId),l.doneCb(this._didWork)}this._didWork=!1});else{let l=this.getPendingTasks();this._callbacks=this._callbacks.filter(f=>!f.updateCb||!f.updateCb(l)||(clearTimeout(f.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(l=>({source:l.source,creationLocation:l.creationLocation,data:l.data})):[]}addCallback(l,f,g){let p=-1;f&&f>0&&(p=setTimeout(()=>{this._callbacks=this._callbacks.filter(_=>_.timeoutId!==p),l(this._didWork,this.getPendingTasks())},f)),this._callbacks.push({doneCb:l,timeoutId:p,updateCb:g})}whenStable(l,f,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(l,f,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(l,f,g){return[]}}return u.\u0275fac=function(l){return new(l||u)(Ge(wn))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})(),VM=(()=>{class u{constructor(){this._applications=new Map,Vg.addToWindow(this)}registerApplication(l,f){this._applications.set(l,f)}unregisterApplication(l){this._applications.delete(l)}unregisterAllApplications(){this._applications.clear()}getTestability(l){return this._applications.get(l)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(l,f=!0){return Vg.findTestabilityInTree(this,l,f)}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"platform"}),u})();class HM{addToWindow(a){}findTestabilityInTree(a,l,f){return null}}let Vg=new HM,Ps=null;const Nw=new yt("AllowMultipleToken"),kw=new yt("PlatformOnDestroy");class Bw{constructor(a,l){this.name=a,this.token=l}}function jw(u,a,l=[]){const f=`Platform: ${a}`,g=new yt(f);return(p=[])=>{let _=Hg();if(!_||_.injector.get(Nw,!1)){const C=[...l,...p,{provide:g,useValue:!0}];u?u(C):function YM(u){if(Ps&&!Ps.get(Nw,!1))throw new wt(400,"");Ps=u;const a=u.get(Uw),l=u.get(Rw,null);l&&l.forEach(f=>f())}(function XM(u=[],a){return Qn.create({name:a,providers:[{provide:Wf,useValue:"platform"},{provide:kw,useValue:()=>Ps=null},...u]})}(C,f))}return function $M(u){const a=Hg();if(!a)throw new wt(401,"");return a}()}}function Hg(){var u;return null!==(u=null==Ps?void 0:Ps.get(Uw))&&void 0!==u?u:null}let Uw=(()=>{class u{constructor(l){this._injector=l,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(l,f){const C=function qM(u,a){let l;return l="noop"===u?new UM:("zone.js"===u?void 0:u)||new wn({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==a?void 0:a.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==a?void 0:a.ngZoneRunCoalescing)}),l}(f?f.ngZone:void 0,{ngZoneEventCoalescing:f&&f.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:f&&f.ngZoneRunCoalescing||!1}),b=[{provide:wn,useValue:C}];return C.run(()=>{const O=Qn.create({providers:b,parent:this.injector,name:l.moduleType.name}),M=l.create(O),P=M.injector.get(nl,null);if(!P)throw new wt(402,"");return C.runOutsideAngular(()=>{const k=C.onError.subscribe({next:j=>{P.handleError(j)}});M.onDestroy(()=>{Wg(this._modules,M),k.unsubscribe()})}),function ZM(u,a,l){try{const f=l();return mu(f)?f.catch(g=>{throw a.runOutsideAngular(()=>u.handleError(g)),g}):f}catch(f){throw a.runOutsideAngular(()=>u.handleError(f)),f}}(P,C,()=>{const k=M.injector.get(Pg);return k.runInitializers(),k.donePromise.then(()=>(function D1(u){Yn(u,"Expected localeId to be defined"),"string"==typeof u&&(yC=u.toLowerCase().replace(/_/g,"-"))}(M.injector.get(is,yu)||yu),this._moduleDoBootstrap(M),M))})})}bootstrapModule(l,f=[]){const g=Vw({},f);return function WM(u,a,l){const f=new _g(l);return Promise.resolve(f)}(0,0,l).then(p=>this.bootstrapModuleFactory(p,g))}_moduleDoBootstrap(l){const f=l.injector.get(Gg);if(l._bootstrapComponents.length>0)l._bootstrapComponents.forEach(g=>f.bootstrap(g));else{if(!l.instance.ngDoBootstrap)throw new wt(403,"");l.instance.ngDoBootstrap(f)}this._modules.push(l)}onDestroy(l){this._destroyListeners.push(l)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new wt(404,"");this._modules.slice().forEach(f=>f.destroy()),this._destroyListeners.forEach(f=>f());const l=this._injector.get(kw,null);null==l||l(),this._destroyed=!0}get destroyed(){return this._destroyed}}return u.\u0275fac=function(l){return new(l||u)(Ge(Qn))},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"platform"}),u})();function Vw(u,a){return Array.isArray(a)?a.reduce(Vw,u):Object.assign(Object.assign({},u),a)}let Gg=(()=>{class u{constructor(l,f,g,p){this._zone=l,this._injector=f,this._exceptionHandler=g,this._initStatus=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const _=new an(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),C=new an(b=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{wn.assertNotInAngularZone(),kg(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const M=this._zone.onUnstable.subscribe(()=>{wn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{O.unsubscribe(),M.unsubscribe()}});this.isStable=function VT(...u){const a=La(u),l=function FT(u,a){return"number"==typeof ud(u)?u.pop():a}(u,1/0),f=u;return f.length?1===f.length?ur(f[0]):Ma(l)(yn(f,a)):dr}(_,C.pipe(function HT(u={}){const{connector:a=(()=>new cr),resetOnError:l=!0,resetOnComplete:f=!0,resetOnRefCountZero:g=!0}=u;return p=>{let _=null,C=null,b=null,O=0,M=!1,P=!1;const k=()=>{null==C||C.unsubscribe(),C=null},j=()=>{k(),_=b=null,M=P=!1},G=()=>{const z=_;j(),null==z||z.unsubscribe()};return _n((z,Y)=>{O++,!P&&!M&&k();const X=b=null!=b?b:a();Y.add(()=>{O--,0===O&&!P&&!M&&(C=hd(G,g))}),X.subscribe(Y),_||(_=new Tc({next:$=>X.next($),error:$=>{P=!0,k(),C=hd(j,l,$),X.error($)},complete:()=>{M=!0,k(),C=hd(j,f),X.complete()}}),yn(z).subscribe(_))})(p)}}()))}bootstrap(l,f){if(!this._initStatus.done)throw new wt(405,"");let g;g=l instanceof WC?l:this._injector.get(ml).resolveComponentFactory(l),this.componentTypes.push(g.componentType);const p=function zM(u){return u.isBoundToModule}(g)?void 0:this._injector.get(Cr),C=g.create(Qn.NULL,[],f||g.selector,p),b=C.location.nativeElement,O=C.injector.get(Ug,null),M=O&&C.injector.get(VM);return O&&M&&M.registerApplication(b,O),C.onDestroy(()=>{this.detachView(C.hostView),Wg(this.components,C),M&&M.unregisterApplication(b)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new wt(101,"");try{this._runningTick=!0;for(let l of this._views)l.detectChanges()}catch(l){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(l))}finally{this._runningTick=!1}}attachView(l){const f=l;this._views.push(f),f.attachToAppRef(this)}detachView(l){const f=l;Wg(this._views,f),f.detachFromAppRef()}_loadComponent(l){this.attachView(l.hostView),this.tick(),this.components.push(l),this._injector.get(Mw,[]).concat(this._bootstrapListeners).forEach(g=>g(l))}ngOnDestroy(){this._views.slice().forEach(l=>l.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return u.\u0275fac=function(l){return new(l||u)(Ge(wn),Ge(Qn),Ge(nl),Ge(Pg))},u.\u0275prov=mt({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();function Wg(u,a){const l=u.indexOf(a);l>-1&&u.splice(l,1)}let Gw=!0,zg=(()=>{class u{}return u.__NG_ELEMENT_ID__=JM,u})();function JM(u){return function eL(u,a,l){if(Fc(u)&&!l){const f=Xn(u.index,a);return new _l(f,f)}return 47&u.type?new _l(a[16],a):null}(ln(),me(),16==(16&u))}class Xw{constructor(){}supports(a){return ll(a)}create(a){return new oL(a)}}const sL=(u,a)=>a;class oL{constructor(a){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=a||sL}forEachItem(a){let l;for(l=this._itHead;null!==l;l=l._next)a(l)}forEachOperation(a){let l=this._itHead,f=this._removalsHead,g=0,p=null;for(;l||f;){const _=!f||l&&l.currentIndex<Zw(f,g,p)?l:f,C=Zw(_,g,p),b=_.currentIndex;if(_===f)g--,f=f._nextRemoved;else if(l=l._next,null==_.previousIndex)g++;else{p||(p=[]);const O=C-g,M=b-g;if(O!=M){for(let k=0;k<O;k++){const j=k<p.length?p[k]:p[k]=0,G=j+k;M<=G&&G<O&&(p[k]=j+1)}p[_.previousIndex]=M-O}}C!==b&&a(_,C,b)}}forEachPreviousItem(a){let l;for(l=this._previousItHead;null!==l;l=l._nextPrevious)a(l)}forEachAddedItem(a){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)a(l)}forEachMovedItem(a){let l;for(l=this._movesHead;null!==l;l=l._nextMoved)a(l)}forEachRemovedItem(a){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)a(l)}forEachIdentityChange(a){let l;for(l=this._identityChangesHead;null!==l;l=l._nextIdentityChange)a(l)}diff(a){if(null==a&&(a=[]),!ll(a))throw new wt(900,"");return this.check(a)?this:null}onDestroy(){}check(a){this._reset();let g,p,_,l=this._itHead,f=!1;if(Array.isArray(a)){this.length=a.length;for(let C=0;C<this.length;C++)p=a[C],_=this._trackByFn(C,p),null!==l&&Object.is(l.trackById,_)?(f&&(l=this._verifyReinsertion(l,p,_,C)),Object.is(l.item,p)||this._addIdentityChange(l,p)):(l=this._mismatch(l,p,_,C),f=!0),l=l._next}else g=0,function aR(u,a){if(Array.isArray(u))for(let l=0;l<u.length;l++)a(u[l]);else{const l=u[Ro()]();let f;for(;!(f=l.next()).done;)a(f.value)}}(a,C=>{_=this._trackByFn(g,C),null!==l&&Object.is(l.trackById,_)?(f&&(l=this._verifyReinsertion(l,C,_,g)),Object.is(l.item,C)||this._addIdentityChange(l,C)):(l=this._mismatch(l,C,_,g),f=!0),l=l._next,g++}),this.length=g;return this._truncate(l),this.collection=a,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let a;for(a=this._previousItHead=this._itHead;null!==a;a=a._next)a._nextPrevious=a._next;for(a=this._additionsHead;null!==a;a=a._nextAdded)a.previousIndex=a.currentIndex;for(this._additionsHead=this._additionsTail=null,a=this._movesHead;null!==a;a=a._nextMoved)a.previousIndex=a.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(a,l,f,g){let p;return null===a?p=this._itTail:(p=a._prev,this._remove(a)),null!==(a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null))?(Object.is(a.item,l)||this._addIdentityChange(a,l),this._reinsertAfter(a,p,g)):null!==(a=null===this._linkedRecords?null:this._linkedRecords.get(f,g))?(Object.is(a.item,l)||this._addIdentityChange(a,l),this._moveAfter(a,p,g)):a=this._addAfter(new aL(l,f),p,g),a}_verifyReinsertion(a,l,f,g){let p=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null);return null!==p?a=this._reinsertAfter(p,a._prev,g):a.currentIndex!=g&&(a.currentIndex=g,this._addToMoves(a,g)),a}_truncate(a){for(;null!==a;){const l=a._next;this._addToRemovals(this._unlink(a)),a=l}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(a,l,f){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(a);const g=a._prevRemoved,p=a._nextRemoved;return null===g?this._removalsHead=p:g._nextRemoved=p,null===p?this._removalsTail=g:p._prevRemoved=g,this._insertAfter(a,l,f),this._addToMoves(a,f),a}_moveAfter(a,l,f){return this._unlink(a),this._insertAfter(a,l,f),this._addToMoves(a,f),a}_addAfter(a,l,f){return this._insertAfter(a,l,f),this._additionsTail=null===this._additionsTail?this._additionsHead=a:this._additionsTail._nextAdded=a,a}_insertAfter(a,l,f){const g=null===l?this._itHead:l._next;return a._next=g,a._prev=l,null===g?this._itTail=a:g._prev=a,null===l?this._itHead=a:l._next=a,null===this._linkedRecords&&(this._linkedRecords=new qw),this._linkedRecords.put(a),a.currentIndex=f,a}_remove(a){return this._addToRemovals(this._unlink(a))}_unlink(a){null!==this._linkedRecords&&this._linkedRecords.remove(a);const l=a._prev,f=a._next;return null===l?this._itHead=f:l._next=f,null===f?this._itTail=l:f._prev=l,a}_addToMoves(a,l){return a.previousIndex===l||(this._movesTail=null===this._movesTail?this._movesHead=a:this._movesTail._nextMoved=a),a}_addToRemovals(a){return null===this._unlinkedRecords&&(this._unlinkedRecords=new qw),this._unlinkedRecords.put(a),a.currentIndex=null,a._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=a,a._prevRemoved=null):(a._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=a),a}_addIdentityChange(a,l){return a.item=l,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=a:this._identityChangesTail._nextIdentityChange=a,a}}class aL{constructor(a,l){this.item=a,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class lL{constructor(){this._head=null,this._tail=null}add(a){null===this._head?(this._head=this._tail=a,a._nextDup=null,a._prevDup=null):(this._tail._nextDup=a,a._prevDup=this._tail,a._nextDup=null,this._tail=a)}get(a,l){let f;for(f=this._head;null!==f;f=f._nextDup)if((null===l||l<=f.currentIndex)&&Object.is(f.trackById,a))return f;return null}remove(a){const l=a._prevDup,f=a._nextDup;return null===l?this._head=f:l._nextDup=f,null===f?this._tail=l:f._prevDup=l,null===this._head}}class qw{constructor(){this.map=new Map}put(a){const l=a.trackById;let f=this.map.get(l);f||(f=new lL,this.map.set(l,f)),f.add(a)}get(a,l){const g=this.map.get(a);return g?g.get(a,l):null}remove(a){const l=a.trackById;return this.map.get(l).remove(a)&&this.map.delete(l),a}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Zw(u,a,l){const f=u.previousIndex;if(null===f)return f;let g=0;return l&&f<l.length&&(g=l[f]),f+a+g}function Qw(){return new Fu([new Xw])}let Fu=(()=>{class u{constructor(l){this.factories=l}static create(l,f){if(null!=f){const g=f.factories.slice();l=l.concat(g)}return new u(l)}static extend(l){return{provide:u,useFactory:f=>u.create(l,f||Qw()),deps:[[u,new Za,new Kr]]}}find(l){const f=this.factories.find(g=>g.supports(l));if(null!=f)return f;throw new wt(901,"")}}return u.\u0275prov=mt({token:u,providedIn:"root",factory:Qw}),u})();const fL=jw(null,"core",[]);let gL=(()=>{class u{constructor(l){}}return u.\u0275fac=function(l){return new(l||u)(Ge(Gg))},u.\u0275mod=Ts({type:u}),u.\u0275inj=Gr({}),u})(),Pu=null;function rs(){return Pu}const pi=new yt("DocumentToken");let ks=(()=>{class u{historyGo(l){throw new Error("Not implemented")}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:function(){return function vL(){return Ge(eE)}()},providedIn:"platform"}),u})();const yL=new yt("Location Initialized");let eE=(()=>{class u extends ks{constructor(l){super(),this._doc=l,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return rs().getBaseHref(this._doc)}onPopState(l){const f=rs().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",l,!1),()=>f.removeEventListener("popstate",l)}onHashChange(l){const f=rs().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",l,!1),()=>f.removeEventListener("hashchange",l)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(l){this.location.pathname=l}pushState(l,f,g){tE()?this._history.pushState(l,f,g):this.location.hash=g}replaceState(l,f,g){tE()?this._history.replaceState(l,f,g):this.location.hash=g}forward(){this._history.forward()}back(){this._history.back()}historyGo(l=0){this._history.go(l)}getState(){return this._history.state}}return u.\u0275fac=function(l){return new(l||u)(Ge(pi))},u.\u0275prov=mt({token:u,factory:function(){return function CL(){return new eE(Ge(pi))}()},providedIn:"platform"}),u})();function tE(){return!!window.history.pushState}function Zg(u,a){if(0==u.length)return a;if(0==a.length)return u;let l=0;return u.endsWith("/")&&l++,a.startsWith("/")&&l++,2==l?u+a.substring(1):1==l?u+a:u+"/"+a}function nE(u){const a=u.match(/#|\?|$/),l=a&&a.index||u.length;return u.slice(0,l-("/"===u[l-1]?1:0))+u.slice(l)}function Er(u){return u&&"?"!==u[0]?"?"+u:u}let qo=(()=>{class u{historyGo(l){throw new Error("Not implemented")}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:function(){return function wL(u){const a=Ge(pi).location;return new iE(Ge(ks),a&&a.origin||"")}()},providedIn:"root"}),u})();const Kg=new yt("appBaseHref");let iE=(()=>{class u extends qo{constructor(l,f){if(super(),this._platformLocation=l,this._removeListenerFns=[],null==f&&(f=this._platformLocation.getBaseHrefFromDOM()),null==f)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=f}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(l){this._removeListenerFns.push(this._platformLocation.onPopState(l),this._platformLocation.onHashChange(l))}getBaseHref(){return this._baseHref}prepareExternalUrl(l){return Zg(this._baseHref,l)}path(l=!1){const f=this._platformLocation.pathname+Er(this._platformLocation.search),g=this._platformLocation.hash;return g&&l?`${f}${g}`:f}pushState(l,f,g,p){const _=this.prepareExternalUrl(g+Er(p));this._platformLocation.pushState(l,f,_)}replaceState(l,f,g,p){const _=this.prepareExternalUrl(g+Er(p));this._platformLocation.replaceState(l,f,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(l=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,l)}}return u.\u0275fac=function(l){return new(l||u)(Ge(ks),Ge(Kg,8))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})(),EL=(()=>{class u extends qo{constructor(l,f){super(),this._platformLocation=l,this._baseHref="",this._removeListenerFns=[],null!=f&&(this._baseHref=f)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(l){this._removeListenerFns.push(this._platformLocation.onPopState(l),this._platformLocation.onHashChange(l))}getBaseHref(){return this._baseHref}path(l=!1){let f=this._platformLocation.hash;return null==f&&(f="#"),f.length>0?f.substring(1):f}prepareExternalUrl(l){const f=Zg(this._baseHref,l);return f.length>0?"#"+f:f}pushState(l,f,g,p){let _=this.prepareExternalUrl(g+Er(p));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.pushState(l,f,_)}replaceState(l,f,g,p){let _=this.prepareExternalUrl(g+Er(p));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.replaceState(l,f,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(l=0){var f,g;null===(g=(f=this._platformLocation).historyGo)||void 0===g||g.call(f,l)}}return u.\u0275fac=function(l){return new(l||u)(Ge(ks),Ge(Kg,8))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})(),Qg=(()=>{class u{constructor(l,f){this._subject=new Pn,this._urlChangeListeners=[],this._platformStrategy=l;const g=this._platformStrategy.getBaseHref();this._platformLocation=f,this._baseHref=nE(rE(g)),this._platformStrategy.onPopState(p=>{this._subject.emit({url:this.path(!0),pop:!0,state:p.state,type:p.type})})}path(l=!1){return this.normalize(this._platformStrategy.path(l))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(l,f=""){return this.path()==this.normalize(l+Er(f))}normalize(l){return u.stripTrailingSlash(function DL(u,a){return u&&a.startsWith(u)?a.substring(u.length):a}(this._baseHref,rE(l)))}prepareExternalUrl(l){return l&&"/"!==l[0]&&(l="/"+l),this._platformStrategy.prepareExternalUrl(l)}go(l,f="",g=null){this._platformStrategy.pushState(g,"",l,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(l+Er(f)),g)}replaceState(l,f="",g=null){this._platformStrategy.replaceState(g,"",l,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(l+Er(f)),g)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(l=0){var f,g;null===(g=(f=this._platformStrategy).historyGo)||void 0===g||g.call(f,l)}onUrlChange(l){this._urlChangeListeners.push(l),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}))}_notifyUrlChangeListeners(l="",f){this._urlChangeListeners.forEach(g=>g(l,f))}subscribe(l,f,g){return this._subject.subscribe({next:l,error:f,complete:g})}}return u.normalizeQueryParams=Er,u.joinWithSlash=Zg,u.stripTrailingSlash=nE,u.\u0275fac=function(l){return new(l||u)(Ge(qo),Ge(ks))},u.\u0275prov=mt({token:u,factory:function(){return function bL(){return new Qg(Ge(qo),Ge(ks))}()},providedIn:"root"}),u})();function rE(u){return u.replace(/\/index.html$/,"")}class uF{constructor(a,l,f,g){this.$implicit=a,this.ngForOf=l,this.index=f,this.count=g}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let fE=(()=>{class u{constructor(l,f,g){this._viewContainer=l,this._template=f,this._differs=g,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(l){this._ngForOf=l,this._ngForOfDirty=!0}set ngForTrackBy(l){this._trackByFn=l}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(l){l&&(this._template=l)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const l=this._ngForOf;!this._differ&&l&&(this._differ=this._differs.find(l).create(this.ngForTrackBy))}if(this._differ){const l=this._differ.diff(this._ngForOf);l&&this._applyChanges(l)}}_applyChanges(l){const f=this._viewContainer;l.forEachOperation((g,p,_)=>{if(null==g.previousIndex)f.createEmbeddedView(this._template,new uF(g.item,this._ngForOf,-1,-1),null===_?void 0:_);else if(null==_)f.remove(null===p?void 0:p);else if(null!==p){const C=f.get(p);f.move(C,_),gE(C,g)}});for(let g=0,p=f.length;g<p;g++){const C=f.get(g).context;C.index=g,C.count=p,C.ngForOf=this._ngForOf}l.forEachIdentityChange(g=>{gE(f.get(g.currentIndex),g)})}static ngTemplateContextGuard(l,f){return!0}}return u.\u0275fac=function(l){return new(l||u)(Be(Pi),Be(wr),Be(Fu))},u.\u0275dir=Tn({type:u,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),u})();function gE(u,a){u.context.$implicit=a.item}let pE=(()=>{class u{constructor(l,f){this._viewContainer=l,this._context=new hF,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(l){this._context.$implicit=this._context.ngIf=l,this._updateView()}set ngIfThen(l){mE("ngIfThen",l),this._thenTemplateRef=l,this._thenViewRef=null,this._updateView()}set ngIfElse(l){mE("ngIfElse",l),this._elseTemplateRef=l,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(l,f){return!0}}return u.\u0275fac=function(l){return new(l||u)(Be(Pi),Be(wr))},u.\u0275dir=Tn({type:u,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),u})();class hF{constructor(){this.$implicit=null,this.ngIf=null}}function mE(u,a){if(a&&!a.createEmbeddedView)throw new Error(`${u} must be a TemplateRef, but received '${bt(a)}'.`)}let BF=(()=>{class u{}return u.\u0275fac=function(l){return new(l||u)},u.\u0275mod=Ts({type:u}),u.\u0275inj=Gr({}),u})();let HF=(()=>{class u{}return u.\u0275prov=mt({token:u,providedIn:"root",factory:()=>new GF(Ge(pi),window)}),u})();class GF{constructor(a,l){this.document=a,this.window=l,this.offset=()=>[0,0]}setOffset(a){this.offset=Array.isArray(a)?()=>a:a}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(a){this.supportsScrolling()&&this.window.scrollTo(a[0],a[1])}scrollToAnchor(a){if(!this.supportsScrolling())return;const l=function WF(u,a){const l=u.getElementById(a)||u.getElementsByName(a)[0];if(l)return l;if("function"==typeof u.createTreeWalker&&u.body&&(u.body.createShadowRoot||u.body.attachShadow)){const f=u.createTreeWalker(u.body,NodeFilter.SHOW_ELEMENT);let g=f.currentNode;for(;g;){const p=g.shadowRoot;if(p){const _=p.getElementById(a)||p.querySelector(`[name="${a}"]`);if(_)return _}g=f.nextNode()}}return null}(this.document,a);l&&(this.scrollToElement(l),l.focus())}setHistoryScrollRestoration(a){if(this.supportScrollRestoration()){const l=this.window.history;l&&l.scrollRestoration&&(l.scrollRestoration=a)}}scrollToElement(a){const l=a.getBoundingClientRect(),f=l.left+this.window.pageXOffset,g=l.top+this.window.pageYOffset,p=this.offset();this.window.scrollTo(f-p[0],g-p[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const a=CE(this.window.history)||CE(Object.getPrototypeOf(this.window.history));return!(!a||!a.writable&&!a.set)}catch(a){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(a){return!1}}}function CE(u){return Object.getOwnPropertyDescriptor(u,"scrollRestoration")}class dp extends class YF extends class _L{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function mL(u){Pu||(Pu=u)}(new dp)}onAndCancel(a,l,f){return a.addEventListener(l,f,!1),()=>{a.removeEventListener(l,f,!1)}}dispatchEvent(a,l){a.dispatchEvent(l)}remove(a){a.parentNode&&a.parentNode.removeChild(a)}createElement(a,l){return(l=l||this.getDefaultDocument()).createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,l){return"window"===l?window:"document"===l?a:"body"===l?a.body:null}getBaseHref(a){const l=function $F(){return Tl=Tl||document.querySelector("base"),Tl?Tl.getAttribute("href"):null}();return null==l?null:function XF(u){zu=zu||document.createElement("a"),zu.setAttribute("href",u);const a=zu.pathname;return"/"===a.charAt(0)?a:`/${a}`}(l)}resetBaseElement(){Tl=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return function aF(u,a){a=encodeURIComponent(a);for(const l of u.split(";")){const f=l.indexOf("="),[g,p]=-1==f?[l,""]:[l.slice(0,f),l.slice(f+1)];if(g.trim()===a)return decodeURIComponent(p)}return null}(document.cookie,a)}}let zu,Tl=null;const wE=new yt("TRANSITION_ID"),ZF=[{provide:Fg,useFactory:function qF(u,a,l){return()=>{l.get(Pg).donePromise.then(()=>{const f=rs(),g=a.querySelectorAll(`style[ng-transition="${u}"]`);for(let p=0;p<g.length;p++)f.remove(g[p])})}},deps:[wE,pi,Qn],multi:!0}];class fp{static init(){!function GM(u){Vg=u}(new fp)}addToWindow(a){It.getAngularTestability=(f,g=!0)=>{const p=a.findTestabilityInTree(f,g);if(null==p)throw new Error("Could not find testability for element.");return p},It.getAllAngularTestabilities=()=>a.getAllTestabilities(),It.getAllAngularRootElements=()=>a.getAllRootElements(),It.frameworkStabilizers||(It.frameworkStabilizers=[]),It.frameworkStabilizers.push(f=>{const g=It.getAllAngularTestabilities();let p=g.length,_=!1;const C=function(b){_=_||b,p--,0==p&&f(_)};g.forEach(function(b){b.whenStable(C)})})}findTestabilityInTree(a,l,f){if(null==l)return null;const g=a.getTestability(l);return null!=g?g:f?rs().isShadowRoot(l)?this.findTestabilityInTree(a,l.host,!0):this.findTestabilityInTree(a,l.parentElement,!0):null}}let KF=(()=>{class u{build(){return new XMLHttpRequest}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();const Yu=new yt("EventManagerPlugins");let $u=(()=>{class u{constructor(l,f){this._zone=f,this._eventNameToPlugin=new Map,l.forEach(g=>g.manager=this),this._plugins=l.slice().reverse()}addEventListener(l,f,g){return this._findPluginFor(f).addEventListener(l,f,g)}addGlobalEventListener(l,f,g){return this._findPluginFor(f).addGlobalEventListener(l,f,g)}getZone(){return this._zone}_findPluginFor(l){const f=this._eventNameToPlugin.get(l);if(f)return f;const g=this._plugins;for(let p=0;p<g.length;p++){const _=g[p];if(_.supports(l))return this._eventNameToPlugin.set(l,_),_}throw new Error(`No event manager plugin found for event ${l}`)}}return u.\u0275fac=function(l){return new(l||u)(Ge(Yu),Ge(wn))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();class EE{constructor(a){this._doc=a}addGlobalEventListener(a,l,f){const g=rs().getGlobalEventTarget(this._doc,a);if(!g)throw new Error(`Unsupported event target ${g} for event ${l}`);return this.addEventListener(g,l,f)}}let bE=(()=>{class u{constructor(){this._stylesSet=new Set}addStyles(l){const f=new Set;l.forEach(g=>{this._stylesSet.has(g)||(this._stylesSet.add(g),f.add(g))}),this.onStylesAdded(f)}onStylesAdded(l){}getAllStyles(){return Array.from(this._stylesSet)}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})(),Il=(()=>{class u extends bE{constructor(l){super(),this._doc=l,this._hostNodes=new Map,this._hostNodes.set(l.head,[])}_addStylesToHost(l,f,g){l.forEach(p=>{const _=this._doc.createElement("style");_.textContent=p,g.push(f.appendChild(_))})}addHost(l){const f=[];this._addStylesToHost(this._stylesSet,l,f),this._hostNodes.set(l,f)}removeHost(l){const f=this._hostNodes.get(l);f&&f.forEach(DE),this._hostNodes.delete(l)}onStylesAdded(l){this._hostNodes.forEach((f,g)=>{this._addStylesToHost(l,g,f)})}ngOnDestroy(){this._hostNodes.forEach(l=>l.forEach(DE))}}return u.\u0275fac=function(l){return new(l||u)(Ge(pi))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();function DE(u){rs().remove(u)}const gp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},pp=/%COMP%/g;function Xu(u,a,l){for(let f=0;f<a.length;f++){let g=a[f];Array.isArray(g)?Xu(u,g,l):(g=g.replace(pp,u),l.push(g))}return l}function SE(u){return a=>{if("__ngUnwrap__"===a)return u;!1===u(a)&&(a.preventDefault(),a.returnValue=!1)}}let mp=(()=>{class u{constructor(l,f,g){this.eventManager=l,this.sharedStylesHost=f,this.appId=g,this.rendererByCompId=new Map,this.defaultRenderer=new _p(l)}createRenderer(l,f){if(!l||!f)return this.defaultRenderer;switch(f.encapsulation){case Wi.Emulated:{let g=this.rendererByCompId.get(f.id);return g||(g=new iP(this.eventManager,this.sharedStylesHost,f,this.appId),this.rendererByCompId.set(f.id,g)),g.applyToHost(l),g}case 1:case Wi.ShadowDom:return new rP(this.eventManager,this.sharedStylesHost,l,f);default:if(!this.rendererByCompId.has(f.id)){const g=Xu(f.id,f.styles,[]);this.sharedStylesHost.addStyles(g),this.rendererByCompId.set(f.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return u.\u0275fac=function(l){return new(l||u)(Ge($u),Ge(Il),Ge(wl))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();class _p{constructor(a){this.eventManager=a,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(a,l){return l?document.createElementNS(gp[l]||l,a):document.createElement(a)}createComment(a){return document.createComment(a)}createText(a){return document.createTextNode(a)}appendChild(a,l){a.appendChild(l)}insertBefore(a,l,f){a&&a.insertBefore(l,f)}removeChild(a,l){a&&a.removeChild(l)}selectRootElement(a,l){let f="string"==typeof a?document.querySelector(a):a;if(!f)throw new Error(`The selector "${a}" did not match any elements`);return l||(f.textContent=""),f}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,l,f,g){if(g){l=g+":"+l;const p=gp[g];p?a.setAttributeNS(p,l,f):a.setAttribute(l,f)}else a.setAttribute(l,f)}removeAttribute(a,l,f){if(f){const g=gp[f];g?a.removeAttributeNS(g,l):a.removeAttribute(`${f}:${l}`)}else a.removeAttribute(l)}addClass(a,l){a.classList.add(l)}removeClass(a,l){a.classList.remove(l)}setStyle(a,l,f,g){g&(Zn.DashCase|Zn.Important)?a.style.setProperty(l,f,g&Zn.Important?"important":""):a.style[l]=f}removeStyle(a,l,f){f&Zn.DashCase?a.style.removeProperty(l):a.style[l]=""}setProperty(a,l,f){a[l]=f}setValue(a,l){a.nodeValue=l}listen(a,l,f){return"string"==typeof a?this.eventManager.addGlobalEventListener(a,l,SE(f)):this.eventManager.addEventListener(a,l,SE(f))}}class iP extends _p{constructor(a,l,f,g){super(a),this.component=f;const p=Xu(g+"-"+f.id,f.styles,[]);l.addStyles(p),this.contentAttr=function eP(u){return"_ngcontent-%COMP%".replace(pp,u)}(g+"-"+f.id),this.hostAttr=function tP(u){return"_nghost-%COMP%".replace(pp,u)}(g+"-"+f.id)}applyToHost(a){super.setAttribute(a,this.hostAttr,"")}createElement(a,l){const f=super.createElement(a,l);return super.setAttribute(f,this.contentAttr,""),f}}class rP extends _p{constructor(a,l,f,g){super(a),this.sharedStylesHost=l,this.hostEl=f,this.shadowRoot=f.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const p=Xu(g.id,g.styles,[]);for(let _=0;_<p.length;_++){const C=document.createElement("style");C.textContent=p[_],this.shadowRoot.appendChild(C)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(a,l){return super.appendChild(this.nodeOrShadowRoot(a),l)}insertBefore(a,l,f){return super.insertBefore(this.nodeOrShadowRoot(a),l,f)}removeChild(a,l){return super.removeChild(this.nodeOrShadowRoot(a),l)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}}let sP=(()=>{class u extends EE{constructor(l){super(l)}supports(l){return!0}addEventListener(l,f,g){return l.addEventListener(f,g,!1),()=>this.removeEventListener(l,f,g)}removeEventListener(l,f,g){return l.removeEventListener(f,g)}}return u.\u0275fac=function(l){return new(l||u)(Ge(pi))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();const AE=["alt","control","meta","shift"],aP={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},RE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},lP={alt:u=>u.altKey,control:u=>u.ctrlKey,meta:u=>u.metaKey,shift:u=>u.shiftKey};let cP=(()=>{class u extends EE{constructor(l){super(l)}supports(l){return null!=u.parseEventName(l)}addEventListener(l,f,g){const p=u.parseEventName(f),_=u.eventCallback(p.fullKey,g,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rs().onAndCancel(l,p.domEventName,_))}static parseEventName(l){const f=l.toLowerCase().split("."),g=f.shift();if(0===f.length||"keydown"!==g&&"keyup"!==g)return null;const p=u._normalizeKey(f.pop());let _="";if(AE.forEach(b=>{const O=f.indexOf(b);O>-1&&(f.splice(O,1),_+=b+".")}),_+=p,0!=f.length||0===p.length)return null;const C={};return C.domEventName=g,C.fullKey=_,C}static getEventFullKey(l){let f="",g=function uP(u){let a=u.key;if(null==a){if(a=u.keyIdentifier,null==a)return"Unidentified";a.startsWith("U+")&&(a=String.fromCharCode(parseInt(a.substring(2),16)),3===u.location&&RE.hasOwnProperty(a)&&(a=RE[a]))}return aP[a]||a}(l);return g=g.toLowerCase()," "===g?g="space":"."===g&&(g="dot"),AE.forEach(p=>{p!=g&&lP[p](l)&&(f+=p+".")}),f+=g,f}static eventCallback(l,f,g){return p=>{u.getEventFullKey(p)===l&&g.runGuarded(()=>f(p))}}static _normalizeKey(l){return"esc"===l?"escape":l}}return u.\u0275fac=function(l){return new(l||u)(Ge(pi))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();const gP=jw(fL,"browser",[{provide:Ow,useValue:"browser"},{provide:Rw,useValue:function hP(){dp.makeCurrent(),fp.init()},multi:!0},{provide:pi,useFactory:function fP(){return function vI(u){xd=u}(document),document},deps:[]}]),pP=[{provide:Wf,useValue:"root"},{provide:nl,useFactory:function dP(){return new nl},deps:[]},{provide:Yu,useClass:sP,multi:!0,deps:[pi,wn,Ow]},{provide:Yu,useClass:cP,multi:!0,deps:[pi]},{provide:mp,useClass:mp,deps:[$u,Il,wl]},{provide:YC,useExisting:mp},{provide:bE,useExisting:Il},{provide:Il,useClass:Il,deps:[pi]},{provide:Ug,useClass:Ug,deps:[wn]},{provide:$u,useClass:$u,deps:[Yu,wn]},{provide:class zF{},useClass:KF,deps:[]}];let mP=(()=>{class u{constructor(l){if(l)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(l){return{ngModule:u,providers:[{provide:wl,useValue:l.appId},{provide:wE,useExisting:wl},ZF]}}}return u.\u0275fac=function(l){return new(l||u)(Ge(u,12))},u.\u0275mod=Ts({type:u}),u.\u0275inj=Gr({providers:pP,imports:[BF,gL]}),u})();function nt(...u){return yn(u,La(u))}"undefined"!=typeof window&&window;class Bi extends cr{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){const l=super._subscribe(a);return!l.closed&&a.next(this._value),l}getValue(){const{hasError:a,thrownError:l,_value:f}=this;if(a)throw l;return this._throwIfClosed(),f}next(a){super.next(this._value=a)}}const{isArray:SP}=Array,{getPrototypeOf:xP,prototype:AP,keys:RP}=Object;const{isArray:LP}=Array;function kP(...u){const a=La(u),l=function LT(u){return Lt(ud(u))?u.pop():void 0}(u),{args:f,keys:g}=function OP(u){if(1===u.length){const a=u[0];if(SP(a))return{args:a,keys:null};if(function MP(u){return u&&"object"==typeof u&&xP(u)===AP}(a)){const l=RP(a);return{args:l.map(f=>a[f]),keys:l}}}return{args:u,keys:null}}(u);if(0===f.length)return yn([],a);const p=new an(function BP(u,a,l=bs){return f=>{LE(a,()=>{const{length:g}=u,p=new Array(g);let _=g,C=g;for(let b=0;b<g;b++)LE(a,()=>{const O=yn(u[b],a);let M=!1;O.subscribe(vn(f,P=>{p[b]=P,M||(M=!0,C--),C||f.next(l(p.slice()))},()=>{--_||f.complete()}))},f)},f)}}(f,a,g?_=>function NP(u,a){return u.reduce((l,f,g)=>(l[f]=a[g],l),{})}(g,_):bs));return l?p.pipe(function PP(u){return Bt(a=>function FP(u,a){return LP(a)?u(...a):u(a)}(u,a))}(l)):p}function LE(u,a,l){u?hr(l,u,a):a()}function qu(u,a){const l=Lt(u)?u:()=>u,f=g=>g.error(l());return new an(a?g=>a.schedule(f,0,g):f)}const Zu=Ra(u=>function(){u(this),this.name="EmptyError",this.message="no elements in sequence"});function yp(...u){return function jP(){return Ma(1)}()(yn(u,La(u)))}function FE(u){return new an(a=>{ur(u()).subscribe(a)})}function PE(){return _n((u,a)=>{let l=null;u._refCount++;const f=vn(a,void 0,void 0,void 0,()=>{if(!u||u._refCount<=0||0<--u._refCount)return void(l=null);const g=u._connection,p=l;l=null,g&&(!p||g===p)&&g.unsubscribe(),a.unsubscribe()});u.subscribe(f),f.closed||(l=u.connect())})}class UP extends an{constructor(a,l){super(),this.source=a,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,Qm(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){const a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:a}=this;this._subject=this._connection=null,null==a||a.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new li;const l=this.getSubject();a.add(this.source.subscribe(vn(l,void 0,()=>{this._teardown(),l.complete()},f=>{this._teardown(),l.error(f)},()=>this._teardown()))),a.closed&&(this._connection=null,a=li.EMPTY)}return a}refCount(){return PE()(this)}}function Bs(u,a){return _n((l,f)=>{let g=null,p=0,_=!1;const C=()=>_&&!g&&f.complete();l.subscribe(vn(f,b=>{null==g||g.unsubscribe();let O=0;const M=p++;ur(u(b,M)).subscribe(g=vn(f,P=>f.next(a?a(b,P,M,O++):P),()=>{g=null,C()}))},()=>{_=!0,C()}))})}function HP(u,a,l,f,g){return(p,_)=>{let C=l,b=a,O=0;p.subscribe(vn(_,M=>{const P=O++;b=C?u(b,M,P):(C=!0,M),f&&_.next(b)},g&&(()=>{C&&_.next(b),_.complete()})))}}function NE(u,a){return _n(HP(u,a,arguments.length>=2,!0))}function Zo(u,a){return _n((l,f)=>{let g=0;l.subscribe(vn(f,p=>u.call(a,p,g++)&&f.next(p)))})}function os(u){return _n((a,l)=>{let p,f=null,g=!1;f=a.subscribe(vn(l,void 0,void 0,_=>{p=ur(u(_,os(u)(a))),f?(f.unsubscribe(),f=null,p.subscribe(l)):g=!0})),g&&(f.unsubscribe(),f=null,p.subscribe(l))})}function Sl(u,a){return Lt(a)?gn(u,a,1):gn(u,1)}function Cp(u){return u<=0?()=>dr:_n((a,l)=>{let f=[];a.subscribe(vn(l,g=>{f.push(g),u<f.length&&f.shift()},()=>{for(const g of f)l.next(g);l.complete()},void 0,()=>{f=null}))})}function kE(u=GP){return _n((a,l)=>{let f=!1;a.subscribe(vn(l,g=>{f=!0,l.next(g)},()=>f?l.complete():l.error(u())))})}function GP(){return new Zu}function BE(u){return _n((a,l)=>{let f=!1;a.subscribe(vn(l,g=>{f=!0,l.next(g)},()=>{f||l.next(u),l.complete()}))})}function Ko(u,a){const l=arguments.length>=2;return f=>f.pipe(u?Zo((g,p)=>u(g,p,f)):bs,Sc(1),l?BE(a):kE(()=>new Zu))}function Jn(u,a,l){const f=Lt(u)||a||l?{next:u,error:a,complete:l}:u;return f?_n((g,p)=>{var _;null===(_=f.subscribe)||void 0===_||_.call(f);let C=!0;g.subscribe(vn(p,b=>{var O;null===(O=f.next)||void 0===O||O.call(f,b),p.next(b)},()=>{var b;C=!1,null===(b=f.complete)||void 0===b||b.call(f),p.complete()},b=>{var O;C=!1,null===(O=f.error)||void 0===O||O.call(f,b),p.error(b)},()=>{var b,O;C&&(null===(b=f.unsubscribe)||void 0===b||b.call(f)),null===(O=f.finalize)||void 0===O||O.call(f)}))}):bs}class Dr{constructor(a,l){this.id=a,this.url=l}}class wp extends Dr{constructor(a,l,f="imperative",g=null){super(a,l),this.navigationTrigger=f,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class xl extends Dr{constructor(a,l,f){super(a,l),this.urlAfterRedirects=f}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class jE extends Dr{constructor(a,l,f){super(a,l),this.reason=f}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class YP extends Dr{constructor(a,l,f){super(a,l),this.error=f}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class $P extends Dr{constructor(a,l,f,g){super(a,l),this.urlAfterRedirects=f,this.state=g}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XP extends Dr{constructor(a,l,f,g){super(a,l),this.urlAfterRedirects=f,this.state=g}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qP extends Dr{constructor(a,l,f,g,p){super(a,l),this.urlAfterRedirects=f,this.state=g,this.shouldActivate=p}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ZP extends Dr{constructor(a,l,f,g){super(a,l),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class KP extends Dr{constructor(a,l,f,g){super(a,l),this.urlAfterRedirects=f,this.state=g}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class UE{constructor(a){this.route=a}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class VE{constructor(a){this.route=a}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class QP{constructor(a){this.snapshot=a}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JP{constructor(a){this.snapshot=a}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eN{constructor(a){this.snapshot=a}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tN{constructor(a){this.snapshot=a}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HE{constructor(a,l,f){this.routerEvent=a,this.position=l,this.anchor=f}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const lt="primary";class nN{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){const l=this.params[a];return Array.isArray(l)?l[0]:l}return null}getAll(a){if(this.has(a)){const l=this.params[a];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}}function Qo(u){return new nN(u)}const GE="ngNavigationCancelingError";function Ep(u){const a=Error("NavigationCancelingError: "+u);return a[GE]=!0,a}function rN(u,a,l){const f=l.path.split("/");if(f.length>u.length||"full"===l.pathMatch&&(a.hasChildren()||f.length<u.length))return null;const g={};for(let p=0;p<f.length;p++){const _=f[p],C=u[p];if(_.startsWith(":"))g[_.substring(1)]=C;else if(_!==C.path)return null}return{consumed:u.slice(0,f.length),posParams:g}}function nr(u,a){const l=u?Object.keys(u):void 0,f=a?Object.keys(a):void 0;if(!l||!f||l.length!=f.length)return!1;let g;for(let p=0;p<l.length;p++)if(g=l[p],!WE(u[g],a[g]))return!1;return!0}function WE(u,a){if(Array.isArray(u)&&Array.isArray(a)){if(u.length!==a.length)return!1;const l=[...u].sort(),f=[...a].sort();return l.every((g,p)=>f[p]===g)}return u===a}function zE(u){return Array.prototype.concat.apply([],u)}function YE(u){return u.length>0?u[u.length-1]:null}function En(u,a){for(const l in u)u.hasOwnProperty(l)&&a(u[l],l)}function ir(u){return b0(u)?u:mu(u)?yn(Promise.resolve(u)):nt(u)}const aN={exact:function qE(u,a,l){if(!Us(u.segments,a.segments)||!Ku(u.segments,a.segments,l)||u.numberOfChildren!==a.numberOfChildren)return!1;for(const f in a.children)if(!u.children[f]||!qE(u.children[f],a.children[f],l))return!1;return!0},subset:ZE},$E={exact:function lN(u,a){return nr(u,a)},subset:function cN(u,a){return Object.keys(a).length<=Object.keys(u).length&&Object.keys(a).every(l=>WE(u[l],a[l]))},ignored:()=>!0};function XE(u,a,l){return aN[l.paths](u.root,a.root,l.matrixParams)&&$E[l.queryParams](u.queryParams,a.queryParams)&&!("exact"===l.fragment&&u.fragment!==a.fragment)}function ZE(u,a,l){return KE(u,a,a.segments,l)}function KE(u,a,l,f){if(u.segments.length>l.length){const g=u.segments.slice(0,l.length);return!(!Us(g,l)||a.hasChildren()||!Ku(g,l,f))}if(u.segments.length===l.length){if(!Us(u.segments,l)||!Ku(u.segments,l,f))return!1;for(const g in a.children)if(!u.children[g]||!ZE(u.children[g],a.children[g],f))return!1;return!0}{const g=l.slice(0,u.segments.length),p=l.slice(u.segments.length);return!!(Us(u.segments,g)&&Ku(u.segments,g,f)&&u.children[lt])&&KE(u.children[lt],a,p,f)}}function Ku(u,a,l){return a.every((f,g)=>$E[l](u[g].parameters,f.parameters))}class js{constructor(a,l,f){this.root=a,this.queryParams=l,this.fragment=f}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qo(this.queryParams)),this._queryParamMap}toString(){return dN.serialize(this)}}class gt{constructor(a,l){this.segments=a,this.children=l,this.parent=null,En(l,(f,g)=>f.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Qu(this)}}class Al{constructor(a,l){this.path=a,this.parameters=l}get parameterMap(){return this._parameterMap||(this._parameterMap=Qo(this.parameters)),this._parameterMap}toString(){return nb(this)}}function Us(u,a){return u.length===a.length&&u.every((l,f)=>l.path===a[f].path)}class QE{}class JE{parse(a){const l=new wN(a);return new js(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(a){const l=`/${Rl(a.root,!0)}`,f=function pN(u){const a=Object.keys(u).map(l=>{const f=u[l];return Array.isArray(f)?f.map(g=>`${Ju(l)}=${Ju(g)}`).join("&"):`${Ju(l)}=${Ju(f)}`}).filter(l=>!!l);return a.length?`?${a.join("&")}`:""}(a.queryParams);return`${l}${f}${"string"==typeof a.fragment?`#${function fN(u){return encodeURI(u)}(a.fragment)}`:""}`}}const dN=new JE;function Qu(u){return u.segments.map(a=>nb(a)).join("/")}function Rl(u,a){if(!u.hasChildren())return Qu(u);if(a){const l=u.children[lt]?Rl(u.children[lt],!1):"",f=[];return En(u.children,(g,p)=>{p!==lt&&f.push(`${p}:${Rl(g,!1)}`)}),f.length>0?`${l}(${f.join("//")})`:l}{const l=function hN(u,a){let l=[];return En(u.children,(f,g)=>{g===lt&&(l=l.concat(a(f,g)))}),En(u.children,(f,g)=>{g!==lt&&(l=l.concat(a(f,g)))}),l}(u,(f,g)=>g===lt?[Rl(u.children[lt],!1)]:[`${g}:${Rl(f,!1)}`]);return 1===Object.keys(u.children).length&&null!=u.children[lt]?`${Qu(u)}/${l[0]}`:`${Qu(u)}/(${l.join("//")})`}}function eb(u){return encodeURIComponent(u).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ju(u){return eb(u).replace(/%3B/gi,";")}function bp(u){return eb(u).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function eh(u){return decodeURIComponent(u)}function tb(u){return eh(u.replace(/\+/g,"%20"))}function nb(u){return`${bp(u.path)}${function gN(u){return Object.keys(u).map(a=>`;${bp(a)}=${bp(u[a])}`).join("")}(u.parameters)}`}const mN=/^[^\/()?;=#]+/;function th(u){const a=u.match(mN);return a?a[0]:""}const _N=/^[^=?&#]+/,yN=/^[^&#]+/;class wN{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new gt([],{}):new gt([],this.parseChildren())}parseQueryParams(){const a={};if(this.consumeOptional("?"))do{this.parseQueryParam(a)}while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let f={};return this.peekStartsWith("(")&&(f=this.parseParens(!1)),(a.length>0||Object.keys(l).length>0)&&(f[lt]=new gt(a,l)),f}parseSegment(){const a=th(this.remaining);if(""===a&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(a),new Al(eh(a),this.parseMatrixParams())}parseMatrixParams(){const a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){const l=th(this.remaining);if(!l)return;this.capture(l);let f="";if(this.consumeOptional("=")){const g=th(this.remaining);g&&(f=g,this.capture(f))}a[eh(l)]=eh(f)}parseQueryParam(a){const l=function vN(u){const a=u.match(_N);return a?a[0]:""}(this.remaining);if(!l)return;this.capture(l);let f="";if(this.consumeOptional("=")){const _=function CN(u){const a=u.match(yN);return a?a[0]:""}(this.remaining);_&&(f=_,this.capture(f))}const g=tb(l),p=tb(f);if(a.hasOwnProperty(g)){let _=a[g];Array.isArray(_)||(_=[_],a[g]=_),_.push(p)}else a[g]=p}parseParens(a){const l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const f=th(this.remaining),g=this.remaining[f.length];if("/"!==g&&")"!==g&&";"!==g)throw new Error(`Cannot parse url '${this.url}'`);let p;f.indexOf(":")>-1?(p=f.substr(0,f.indexOf(":")),this.capture(p),this.capture(":")):a&&(p=lt);const _=this.parseChildren();l[p]=1===Object.keys(_).length?_[lt]:new gt([],_),this.consumeOptional("//")}return l}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return!!this.peekStartsWith(a)&&(this.remaining=this.remaining.substring(a.length),!0)}capture(a){if(!this.consumeOptional(a))throw new Error(`Expected "${a}".`)}}class ib{constructor(a){this._root=a}get root(){return this._root.value}parent(a){const l=this.pathFromRoot(a);return l.length>1?l[l.length-2]:null}children(a){const l=Dp(a,this._root);return l?l.children.map(f=>f.value):[]}firstChild(a){const l=Dp(a,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(a){const l=Tp(a,this._root);return l.length<2?[]:l[l.length-2].children.map(g=>g.value).filter(g=>g!==a)}pathFromRoot(a){return Tp(a,this._root).map(l=>l.value)}}function Dp(u,a){if(u===a.value)return a;for(const l of a.children){const f=Dp(u,l);if(f)return f}return null}function Tp(u,a){if(u===a.value)return[a];for(const l of a.children){const f=Tp(u,l);if(f.length)return f.unshift(a),f}return[]}class Tr{constructor(a,l){this.value=a,this.children=l}toString(){return`TreeNode(${this.value})`}}function Jo(u){const a={};return u&&u.children.forEach(l=>a[l.value.outlet]=l),a}class rb extends ib{constructor(a,l){super(a),this.snapshot=l,Ip(this,a)}toString(){return this.snapshot.toString()}}function sb(u,a){const l=function EN(u,a){const _=new nh([],{},{},"",{},lt,a,null,u.root,-1,{});return new ab("",new Tr(_,[]))}(u,a),f=new Bi([new Al("",{})]),g=new Bi({}),p=new Bi({}),_=new Bi({}),C=new Bi(""),b=new ea(f,g,_,C,p,lt,a,l.root);return b.snapshot=l.root,new rb(new Tr(b,[]),l)}class ea{constructor(a,l,f,g,p,_,C,b){this.url=a,this.params=l,this.queryParams=f,this.fragment=g,this.data=p,this.outlet=_,this.component=C,this._futureSnapshot=b}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Bt(a=>Qo(a)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Bt(a=>Qo(a)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ob(u,a="emptyOnly"){const l=u.pathFromRoot;let f=0;if("always"!==a)for(f=l.length-1;f>=1;){const g=l[f],p=l[f-1];if(g.routeConfig&&""===g.routeConfig.path)f--;else{if(p.component)break;f--}}return function bN(u){return u.reduce((a,l)=>({params:Object.assign(Object.assign({},a.params),l.params),data:Object.assign(Object.assign({},a.data),l.data),resolve:Object.assign(Object.assign({},a.resolve),l._resolvedData)}),{params:{},data:{},resolve:{}})}(l.slice(f))}class nh{constructor(a,l,f,g,p,_,C,b,O,M,P){this.url=a,this.params=l,this.queryParams=f,this.fragment=g,this.data=p,this.outlet=_,this.component=C,this.routeConfig=b,this._urlSegment=O,this._lastPathIndex=M,this._resolve=P}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Qo(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Qo(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(f=>f.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ab extends ib{constructor(a,l){super(l),this.url=a,Ip(this,l)}toString(){return lb(this._root)}}function Ip(u,a){a.value._routerState=u,a.children.forEach(l=>Ip(u,l))}function lb(u){const a=u.children.length>0?` { ${u.children.map(lb).join(", ")} } `:"";return`${u.value}${a}`}function Sp(u){if(u.snapshot){const a=u.snapshot,l=u._futureSnapshot;u.snapshot=l,nr(a.queryParams,l.queryParams)||u.queryParams.next(l.queryParams),a.fragment!==l.fragment&&u.fragment.next(l.fragment),nr(a.params,l.params)||u.params.next(l.params),function sN(u,a){if(u.length!==a.length)return!1;for(let l=0;l<u.length;++l)if(!nr(u[l],a[l]))return!1;return!0}(a.url,l.url)||u.url.next(l.url),nr(a.data,l.data)||u.data.next(l.data)}else u.snapshot=u._futureSnapshot,u.data.next(u._futureSnapshot.data)}function xp(u,a){const l=nr(u.params,a.params)&&function uN(u,a){return Us(u,a)&&u.every((l,f)=>nr(l.parameters,a[f].parameters))}(u.url,a.url);return l&&!(!u.parent!=!a.parent)&&(!u.parent||xp(u.parent,a.parent))}function Ol(u,a,l){if(l&&u.shouldReuseRoute(a.value,l.value.snapshot)){const f=l.value;f._futureSnapshot=a.value;const g=function TN(u,a,l){return a.children.map(f=>{for(const g of l.children)if(u.shouldReuseRoute(f.value,g.value.snapshot))return Ol(u,f,g);return Ol(u,f)})}(u,a,l);return new Tr(f,g)}{if(u.shouldAttach(a.value)){const p=u.retrieve(a.value);if(null!==p){const _=p.route;return _.value._futureSnapshot=a.value,_.children=a.children.map(C=>Ol(u,C)),_}}const f=function IN(u){return new ea(new Bi(u.url),new Bi(u.params),new Bi(u.queryParams),new Bi(u.fragment),new Bi(u.data),u.outlet,u.component,u)}(a.value),g=a.children.map(p=>Ol(u,p));return new Tr(f,g)}}function ih(u){return"object"==typeof u&&null!=u&&!u.outlets&&!u.segmentPath}function Ml(u){return"object"==typeof u&&null!=u&&u.outlets}function Ap(u,a,l,f,g){let p={};if(f&&En(f,(C,b)=>{p[b]=Array.isArray(C)?C.map(O=>`${O}`):`${C}`}),u===a)return new js(l,p,g);const _=cb(u,a,l);return new js(_,p,g)}function cb(u,a,l){const f={};return En(u.children,(g,p)=>{f[p]=g===a?l:cb(g,a,l)}),new gt(u.segments,f)}class ub{constructor(a,l,f){if(this.isAbsolute=a,this.numberOfDoubleDots=l,this.commands=f,a&&f.length>0&&ih(f[0]))throw new Error("Root segment cannot have matrix parameters");const g=f.find(Ml);if(g&&g!==YE(f))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Rp{constructor(a,l,f){this.segmentGroup=a,this.processChildren=l,this.index=f}}function hb(u,a,l){if(u||(u=new gt([],{})),0===u.segments.length&&u.hasChildren())return rh(u,a,l);const f=function MN(u,a,l){let f=0,g=a;const p={match:!1,pathIndex:0,commandIndex:0};for(;g<u.segments.length;){if(f>=l.length)return p;const _=u.segments[g],C=l[f];if(Ml(C))break;const b=`${C}`,O=f<l.length-1?l[f+1]:null;if(g>0&&void 0===b)break;if(b&&O&&"object"==typeof O&&void 0===O.outlets){if(!fb(b,O,_))return p;f+=2}else{if(!fb(b,{},_))return p;f++}g++}return{match:!0,pathIndex:g,commandIndex:f}}(u,a,l),g=l.slice(f.commandIndex);if(f.match&&f.pathIndex<u.segments.length){const p=new gt(u.segments.slice(0,f.pathIndex),{});return p.children[lt]=new gt(u.segments.slice(f.pathIndex),u.children),rh(p,0,g)}return f.match&&0===g.length?new gt(u.segments,{}):f.match&&!u.hasChildren()?Op(u,a,l):f.match?rh(u,0,g):Op(u,a,l)}function rh(u,a,l){if(0===l.length)return new gt(u.segments,{});{const f=function ON(u){return Ml(u[0])?u[0].outlets:{[lt]:u}}(l),g={};return En(f,(p,_)=>{"string"==typeof p&&(p=[p]),null!==p&&(g[_]=hb(u.children[_],a,p))}),En(u.children,(p,_)=>{void 0===f[_]&&(g[_]=p)}),new gt(u.segments,g)}}function Op(u,a,l){const f=u.segments.slice(0,a);let g=0;for(;g<l.length;){const p=l[g];if(Ml(p)){const b=LN(p.outlets);return new gt(f,b)}if(0===g&&ih(l[0])){f.push(new Al(u.segments[a].path,db(l[0]))),g++;continue}const _=Ml(p)?p.outlets[lt]:`${p}`,C=g<l.length-1?l[g+1]:null;_&&C&&ih(C)?(f.push(new Al(_,db(C))),g+=2):(f.push(new Al(_,{})),g++)}return new gt(f,{})}function LN(u){const a={};return En(u,(l,f)=>{"string"==typeof l&&(l=[l]),null!==l&&(a[f]=Op(new gt([],{}),0,l))}),a}function db(u){const a={};return En(u,(l,f)=>a[f]=`${l}`),a}function fb(u,a,l){return u==l.path&&nr(a,l.parameters)}class PN{constructor(a,l,f,g){this.routeReuseStrategy=a,this.futureState=l,this.currState=f,this.forwardEvent=g}activate(a){const l=this.futureState._root,f=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,f,a),Sp(this.futureState.root),this.activateChildRoutes(l,f,a)}deactivateChildRoutes(a,l,f){const g=Jo(l);a.children.forEach(p=>{const _=p.value.outlet;this.deactivateRoutes(p,g[_],f),delete g[_]}),En(g,(p,_)=>{this.deactivateRouteAndItsChildren(p,f)})}deactivateRoutes(a,l,f){const g=a.value,p=l?l.value:null;if(g===p)if(g.component){const _=f.getContext(g.outlet);_&&this.deactivateChildRoutes(a,l,_.children)}else this.deactivateChildRoutes(a,l,f);else p&&this.deactivateRouteAndItsChildren(l,f)}deactivateRouteAndItsChildren(a,l){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,l):this.deactivateRouteAndOutlet(a,l)}detachAndStoreRouteSubtree(a,l){const f=l.getContext(a.value.outlet),g=f&&a.value.component?f.children:l,p=Jo(a);for(const _ of Object.keys(p))this.deactivateRouteAndItsChildren(p[_],g);if(f&&f.outlet){const _=f.outlet.detach(),C=f.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:_,route:a,contexts:C})}}deactivateRouteAndOutlet(a,l){const f=l.getContext(a.value.outlet),g=f&&a.value.component?f.children:l,p=Jo(a);for(const _ of Object.keys(p))this.deactivateRouteAndItsChildren(p[_],g);f&&f.outlet&&(f.outlet.deactivate(),f.children.onOutletDeactivated(),f.attachRef=null,f.resolver=null,f.route=null)}activateChildRoutes(a,l,f){const g=Jo(l);a.children.forEach(p=>{this.activateRoutes(p,g[p.value.outlet],f),this.forwardEvent(new tN(p.value.snapshot))}),a.children.length&&this.forwardEvent(new JP(a.value.snapshot))}activateRoutes(a,l,f){const g=a.value,p=l?l.value:null;if(Sp(g),g===p)if(g.component){const _=f.getOrCreateContext(g.outlet);this.activateChildRoutes(a,l,_.children)}else this.activateChildRoutes(a,l,f);else if(g.component){const _=f.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){const C=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),_.children.onOutletReAttached(C.contexts),_.attachRef=C.componentRef,_.route=C.route.value,_.outlet&&_.outlet.attach(C.componentRef,C.route.value),Sp(C.route.value),this.activateChildRoutes(a,null,_.children)}else{const C=function NN(u){for(let a=u.parent;a;a=a.parent){const l=a.routeConfig;if(l&&l._loadedConfig)return l._loadedConfig;if(l&&l.component)return null}return null}(g.snapshot),b=C?C.module.componentFactoryResolver:null;_.attachRef=null,_.route=g,_.resolver=b,_.outlet&&_.outlet.activateWith(g,b),this.activateChildRoutes(a,null,_.children)}}else this.activateChildRoutes(a,null,f)}}class Mp{constructor(a,l){this.routes=a,this.module=l}}function as(u){return"function"==typeof u}function Vs(u){return u instanceof js}const Ll=Symbol("INITIAL_VALUE");function Fl(){return Bs(u=>kP(u.map(a=>a.pipe(Sc(1),function VP(...u){const a=La(u);return _n((l,f)=>{(a?yp(u,l,a):yp(u,l)).subscribe(f)})}(Ll)))).pipe(NE((a,l)=>{let f=!1;return l.reduce((g,p,_)=>g!==Ll?g:(p===Ll&&(f=!0),f||!1!==p&&_!==l.length-1&&!Vs(p)?g:p),a)},Ll),Zo(a=>a!==Ll),Bt(a=>Vs(a)?a:!0===a),Sc(1)))}class HN{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Pl,this.attachRef=null}}class Pl{constructor(){this.contexts=new Map}onChildOutletCreated(a,l){const f=this.getOrCreateContext(a);f.outlet=l,this.contexts.set(a,f)}onChildOutletDestroyed(a){const l=this.getContext(a);l&&(l.outlet=null,l.attachRef=null)}onOutletDeactivated(){const a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let l=this.getContext(a);return l||(l=new HN,this.contexts.set(a,l)),l}getContext(a){return this.contexts.get(a)||null}}let Lp=(()=>{class u{constructor(l,f,g,p,_){this.parentContexts=l,this.location=f,this.resolver=g,this.changeDetector=_,this.activated=null,this._activatedRoute=null,this.activateEvents=new Pn,this.deactivateEvents=new Pn,this.attachEvents=new Pn,this.detachEvents=new Pn,this.name=p||lt,l.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const l=this.parentContexts.getContext(this.name);l&&l.route&&(l.attachRef?this.attach(l.attachRef,l.route):this.activateWith(l.route,l.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const l=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(l.instance),l}attach(l,f){this.activated=l,this._activatedRoute=f,this.location.insert(l.hostView),this.attachEvents.emit(l.instance)}deactivate(){if(this.activated){const l=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(l)}}activateWith(l,f){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=l;const _=(f=f||this.resolver).resolveComponentFactory(l._futureSnapshot.routeConfig.component),C=this.parentContexts.getOrCreateContext(this.name).children,b=new GN(l,C,this.location.injector);this.activated=this.location.createComponent(_,this.location.length,b),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return u.\u0275fac=function(l){return new(l||u)(Be(Pl),Be(Pi),Be(ml),function Ga(u){return function ZI(u,a){if("class"===a)return u.classes;if("style"===a)return u.styles;const l=u.attrs;if(l){const f=l.length;let g=0;for(;g<f;){const p=l[g];if(W_(p))break;if(0===p)g+=2;else if("number"==typeof p)for(g++;g<f&&"string"==typeof l[g];)g++;else{if(p===a)return l[g+1];g+=2}}}return null}(ln(),u)}("name"),Be(zg))},u.\u0275dir=Tn({type:u,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),u})();class GN{constructor(a,l,f){this.route=a,this.childContexts=l,this.parent=f}get(a,l){return a===ea?this.route:a===Pl?this.childContexts:this.parent.get(a,l)}}let gb=(()=>{class u{}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["ng-component"]],decls:1,vars:0,template:function(l,f){1&l&&Ji(0,"router-outlet")},directives:[Lp],encapsulation:2}),u})();function pb(u,a=""){for(let l=0;l<u.length;l++){const f=u[l];WN(f,zN(a,f))}}function WN(u,a){u.children&&pb(u.children,a)}function zN(u,a){return a?u||a.path?u&&!a.path?`${u}/`:!u&&a.path?a.path:`${u}/${a.path}`:"":u}function Fp(u){const a=u.children&&u.children.map(Fp),l=a?Object.assign(Object.assign({},u),{children:a}):Object.assign({},u);return!l.component&&(a||l.loadChildren)&&l.outlet&&l.outlet!==lt&&(l.component=gb),l}function vi(u){return u.outlet||lt}function mb(u,a){const l=u.filter(f=>vi(f)===a);return l.push(...u.filter(f=>vi(f)!==a)),l}const _b={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sh(u,a,l){var f;if(""===a.path)return"full"===a.pathMatch&&(u.hasChildren()||l.length>0)?Object.assign({},_b):{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};const p=(a.matcher||rN)(l,u,a);if(!p)return Object.assign({},_b);const _={};En(p.posParams,(b,O)=>{_[O]=b.path});const C=p.consumed.length>0?Object.assign(Object.assign({},_),p.consumed[p.consumed.length-1].parameters):_;return{matched:!0,consumedSegments:p.consumed,remainingSegments:l.slice(p.consumed.length),parameters:C,positionalParamSegments:null!==(f=p.posParams)&&void 0!==f?f:{}}}function oh(u,a,l,f,g="corrected"){if(l.length>0&&function XN(u,a,l){return l.some(f=>ah(u,a,f)&&vi(f)!==lt)}(u,l,f)){const _=new gt(a,function $N(u,a,l,f){const g={};g[lt]=f,f._sourceSegment=u,f._segmentIndexShift=a.length;for(const p of l)if(""===p.path&&vi(p)!==lt){const _=new gt([],{});_._sourceSegment=u,_._segmentIndexShift=a.length,g[vi(p)]=_}return g}(u,a,f,new gt(l,u.children)));return _._sourceSegment=u,_._segmentIndexShift=a.length,{segmentGroup:_,slicedSegments:[]}}if(0===l.length&&function qN(u,a,l){return l.some(f=>ah(u,a,f))}(u,l,f)){const _=new gt(u.segments,function YN(u,a,l,f,g,p){const _={};for(const C of f)if(ah(u,l,C)&&!g[vi(C)]){const b=new gt([],{});b._sourceSegment=u,b._segmentIndexShift="legacy"===p?u.segments.length:a.length,_[vi(C)]=b}return Object.assign(Object.assign({},g),_)}(u,a,l,f,u.children,g));return _._sourceSegment=u,_._segmentIndexShift=a.length,{segmentGroup:_,slicedSegments:l}}const p=new gt(u.segments,u.children);return p._sourceSegment=u,p._segmentIndexShift=a.length,{segmentGroup:p,slicedSegments:l}}function ah(u,a,l){return(!(u.hasChildren()||a.length>0)||"full"!==l.pathMatch)&&""===l.path}function vb(u,a,l,f){return!!(vi(u)===f||f!==lt&&ah(a,l,u))&&("**"===u.path||sh(a,u,l).matched)}function yb(u,a,l){return 0===a.length&&!u.children[l]}class lh{constructor(a){this.segmentGroup=a||null}}class Cb{constructor(a){this.urlTree=a}}function Nl(u){return qu(new lh(u))}function wb(u){return qu(new Cb(u))}class JN{constructor(a,l,f,g,p){this.configLoader=l,this.urlSerializer=f,this.urlTree=g,this.config=p,this.allowRedirects=!0,this.ngModule=a.get(Cr)}apply(){const a=oh(this.urlTree.root,[],[],this.config).segmentGroup,l=new gt(a.segments,a.children);return this.expandSegmentGroup(this.ngModule,this.config,l,lt).pipe(Bt(p=>this.createUrlTree(Pp(p),this.urlTree.queryParams,this.urlTree.fragment))).pipe(os(p=>{if(p instanceof Cb)return this.allowRedirects=!1,this.match(p.urlTree);throw p instanceof lh?this.noMatchError(p):p}))}match(a){return this.expandSegmentGroup(this.ngModule,this.config,a.root,lt).pipe(Bt(g=>this.createUrlTree(Pp(g),a.queryParams,a.fragment))).pipe(os(g=>{throw g instanceof lh?this.noMatchError(g):g}))}noMatchError(a){return new Error(`Cannot match any routes. URL Segment: '${a.segmentGroup}'`)}createUrlTree(a,l,f){const g=a.segments.length>0?new gt([],{[lt]:a}):a;return new js(g,l,f)}expandSegmentGroup(a,l,f,g){return 0===f.segments.length&&f.hasChildren()?this.expandChildren(a,l,f).pipe(Bt(p=>new gt([],p))):this.expandSegment(a,f,l,f.segments,g,!0)}expandChildren(a,l,f){const g=[];for(const p of Object.keys(f.children))"primary"===p?g.unshift(p):g.push(p);return yn(g).pipe(Sl(p=>{const _=f.children[p],C=mb(l,p);return this.expandSegmentGroup(a,C,_,p).pipe(Bt(b=>({segment:b,outlet:p})))}),NE((p,_)=>(p[_.outlet]=_.segment,p),{}),function WP(u,a){const l=arguments.length>=2;return f=>f.pipe(u?Zo((g,p)=>u(g,p,f)):bs,Cp(1),l?BE(a):kE(()=>new Zu))}())}expandSegment(a,l,f,g,p,_){return yn(f).pipe(Sl(C=>this.expandSegmentAgainstRoute(a,l,f,C,g,p,_).pipe(os(O=>{if(O instanceof lh)return nt(null);throw O}))),Ko(C=>!!C),os((C,b)=>{if(C instanceof Zu||"EmptyError"===C.name)return yb(l,g,p)?nt(new gt([],{})):Nl(l);throw C}))}expandSegmentAgainstRoute(a,l,f,g,p,_,C){return vb(g,l,p,_)?void 0===g.redirectTo?this.matchSegmentAgainstRoute(a,l,g,p,_):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(a,l,f,g,p,_):Nl(l):Nl(l)}expandSegmentAgainstRouteUsingRedirect(a,l,f,g,p,_){return"**"===g.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(a,f,g,_):this.expandRegularSegmentAgainstRouteUsingRedirect(a,l,f,g,p,_)}expandWildCardWithParamsAgainstRouteUsingRedirect(a,l,f,g){const p=this.applyRedirectCommands([],f.redirectTo,{});return f.redirectTo.startsWith("/")?wb(p):this.lineralizeSegments(f,p).pipe(gn(_=>{const C=new gt(_,{});return this.expandSegment(a,C,l,_,g,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(a,l,f,g,p,_){const{matched:C,consumedSegments:b,remainingSegments:O,positionalParamSegments:M}=sh(l,g,p);if(!C)return Nl(l);const P=this.applyRedirectCommands(b,g.redirectTo,M);return g.redirectTo.startsWith("/")?wb(P):this.lineralizeSegments(g,P).pipe(gn(k=>this.expandSegment(a,l,f,k.concat(O),_,!1)))}matchSegmentAgainstRoute(a,l,f,g,p){if("**"===f.path)return f.loadChildren?(f._loadedConfig?nt(f._loadedConfig):this.configLoader.load(a.injector,f)).pipe(Bt(P=>(f._loadedConfig=P,new gt(g,{})))):nt(new gt(g,{}));const{matched:_,consumedSegments:C,remainingSegments:b}=sh(l,f,g);return _?this.getChildConfig(a,f,g).pipe(gn(M=>{const P=M.module,k=M.routes,{segmentGroup:j,slicedSegments:G}=oh(l,C,b,k),z=new gt(j.segments,j.children);if(0===G.length&&z.hasChildren())return this.expandChildren(P,k,z).pipe(Bt(K=>new gt(C,K)));if(0===k.length&&0===G.length)return nt(new gt(C,{}));const Y=vi(f)===p;return this.expandSegment(P,z,k,G,Y?lt:p,!0).pipe(Bt($=>new gt(C.concat($.segments),$.children)))})):Nl(l)}getChildConfig(a,l,f){return l.children?nt(new Mp(l.children,a)):l.loadChildren?void 0!==l._loadedConfig?nt(l._loadedConfig):this.runCanLoadGuards(a.injector,l,f).pipe(gn(g=>g?this.configLoader.load(a.injector,l).pipe(Bt(p=>(l._loadedConfig=p,p))):function KN(u){return qu(Ep(`Cannot load children because the guard of the route "path: '${u.path}'" returned false`))}(l))):nt(new Mp([],a))}runCanLoadGuards(a,l,f){const g=l.canLoad;return g&&0!==g.length?nt(g.map(_=>{const C=a.get(_);let b;if(function BN(u){return u&&as(u.canLoad)}(C))b=C.canLoad(l,f);else{if(!as(C))throw new Error("Invalid CanLoad guard");b=C(l,f)}return ir(b)})).pipe(Fl(),Jn(_=>{if(!Vs(_))return;const C=Ep(`Redirecting to "${this.urlSerializer.serialize(_)}"`);throw C.url=_,C}),Bt(_=>!0===_)):nt(!0)}lineralizeSegments(a,l){let f=[],g=l.root;for(;;){if(f=f.concat(g.segments),0===g.numberOfChildren)return nt(f);if(g.numberOfChildren>1||!g.children[lt])return qu(new Error(`Only absolute redirects can have named outlets. redirectTo: '${a.redirectTo}'`));g=g.children[lt]}}applyRedirectCommands(a,l,f){return this.applyRedirectCreatreUrlTree(l,this.urlSerializer.parse(l),a,f)}applyRedirectCreatreUrlTree(a,l,f,g){const p=this.createSegmentGroup(a,l.root,f,g);return new js(p,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(a,l){const f={};return En(a,(g,p)=>{if("string"==typeof g&&g.startsWith(":")){const C=g.substring(1);f[p]=l[C]}else f[p]=g}),f}createSegmentGroup(a,l,f,g){const p=this.createSegments(a,l.segments,f,g);let _={};return En(l.children,(C,b)=>{_[b]=this.createSegmentGroup(a,C,f,g)}),new gt(p,_)}createSegments(a,l,f,g){return l.map(p=>p.path.startsWith(":")?this.findPosParam(a,p,g):this.findOrReturn(p,f))}findPosParam(a,l,f){const g=f[l.path.substring(1)];if(!g)throw new Error(`Cannot redirect to '${a}'. Cannot find '${l.path}'.`);return g}findOrReturn(a,l){let f=0;for(const g of l){if(g.path===a.path)return l.splice(f),g;f++}return a}}function Pp(u){const a={};for(const f of Object.keys(u.children)){const p=Pp(u.children[f]);(p.segments.length>0||p.hasChildren())&&(a[f]=p)}return function ek(u){if(1===u.numberOfChildren&&u.children[lt]){const a=u.children[lt];return new gt(u.segments.concat(a.segments),a.children)}return u}(new gt(u.segments,a))}class Eb{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}}class ch{constructor(a,l){this.component=a,this.route=l}}function nk(u,a,l){const f=u._root;return kl(f,a?a._root:null,l,[f.value])}function uh(u,a,l){const f=function rk(u){if(!u)return null;for(let a=u.parent;a;a=a.parent){const l=a.routeConfig;if(l&&l._loadedConfig)return l._loadedConfig}return null}(a);return(f?f.module.injector:l).get(u)}function kl(u,a,l,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const p=Jo(a);return u.children.forEach(_=>{(function sk(u,a,l,f,g={canDeactivateChecks:[],canActivateChecks:[]}){const p=u.value,_=a?a.value:null,C=l?l.getContext(u.value.outlet):null;if(_&&p.routeConfig===_.routeConfig){const b=function ok(u,a,l){if("function"==typeof l)return l(u,a);switch(l){case"pathParamsChange":return!Us(u.url,a.url);case"pathParamsOrQueryParamsChange":return!Us(u.url,a.url)||!nr(u.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xp(u,a)||!nr(u.queryParams,a.queryParams);default:return!xp(u,a)}}(_,p,p.routeConfig.runGuardsAndResolvers);b?g.canActivateChecks.push(new Eb(f)):(p.data=_.data,p._resolvedData=_._resolvedData),kl(u,a,p.component?C?C.children:null:l,f,g),b&&C&&C.outlet&&C.outlet.isActivated&&g.canDeactivateChecks.push(new ch(C.outlet.component,_))}else _&&Bl(a,C,g),g.canActivateChecks.push(new Eb(f)),kl(u,null,p.component?C?C.children:null:l,f,g)})(_,p[_.value.outlet],l,f.concat([_.value]),g),delete p[_.value.outlet]}),En(p,(_,C)=>Bl(_,l.getContext(C),g)),g}function Bl(u,a,l){const f=Jo(u),g=u.value;En(f,(p,_)=>{Bl(p,g.component?a?a.children.getContext(_):null:a,l)}),l.canDeactivateChecks.push(new ch(g.component&&a&&a.outlet&&a.outlet.isActivated?a.outlet.component:null,g))}class pk{}function bb(u){return new an(a=>a.error(u))}class _k{constructor(a,l,f,g,p,_){this.rootComponentType=a,this.config=l,this.urlTree=f,this.url=g,this.paramsInheritanceStrategy=p,this.relativeLinkResolution=_}recognize(){const a=oh(this.urlTree.root,[],[],this.config.filter(_=>void 0===_.redirectTo),this.relativeLinkResolution).segmentGroup,l=this.processSegmentGroup(this.config,a,lt);if(null===l)return null;const f=new nh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},lt,this.rootComponentType,null,this.urlTree.root,-1,{}),g=new Tr(f,l),p=new ab(this.url,g);return this.inheritParamsAndData(p._root),p}inheritParamsAndData(a){const l=a.value,f=ob(l,this.paramsInheritanceStrategy);l.params=Object.freeze(f.params),l.data=Object.freeze(f.data),a.children.forEach(g=>this.inheritParamsAndData(g))}processSegmentGroup(a,l,f){return 0===l.segments.length&&l.hasChildren()?this.processChildren(a,l):this.processSegment(a,l,l.segments,f)}processChildren(a,l){const f=[];for(const p of Object.keys(l.children)){const _=l.children[p],C=mb(a,p),b=this.processSegmentGroup(C,_,p);if(null===b)return null;f.push(...b)}const g=Db(f);return function vk(u){u.sort((a,l)=>a.value.outlet===lt?-1:l.value.outlet===lt?1:a.value.outlet.localeCompare(l.value.outlet))}(g),g}processSegment(a,l,f,g){for(const p of a){const _=this.processSegmentAgainstRoute(p,l,f,g);if(null!==_)return _}return yb(l,f,g)?[]:null}processSegmentAgainstRoute(a,l,f,g){if(a.redirectTo||!vb(a,l,f,g))return null;let p,_=[],C=[];if("**"===a.path){const j=f.length>0?YE(f).parameters:{};p=new nh(f,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Sb(a),vi(a),a.component,a,Tb(l),Ib(l)+f.length,xb(a))}else{const j=sh(l,a,f);if(!j.matched)return null;_=j.consumedSegments,C=j.remainingSegments,p=new nh(_,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Sb(a),vi(a),a.component,a,Tb(l),Ib(l)+_.length,xb(a))}const b=function yk(u){return u.children?u.children:u.loadChildren?u._loadedConfig.routes:[]}(a),{segmentGroup:O,slicedSegments:M}=oh(l,_,C,b.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===M.length&&O.hasChildren()){const j=this.processChildren(b,O);return null===j?null:[new Tr(p,j)]}if(0===b.length&&0===M.length)return[new Tr(p,[])];const P=vi(a)===g,k=this.processSegment(b,O,M,P?lt:g);return null===k?null:[new Tr(p,k)]}}function Ck(u){const a=u.value.routeConfig;return a&&""===a.path&&void 0===a.redirectTo}function Db(u){const a=[],l=new Set;for(const f of u){if(!Ck(f)){a.push(f);continue}const g=a.find(p=>f.value.routeConfig===p.value.routeConfig);void 0!==g?(g.children.push(...f.children),l.add(g)):a.push(f)}for(const f of l){const g=Db(f.children);a.push(new Tr(f.value,g))}return a.filter(f=>!l.has(f))}function Tb(u){let a=u;for(;a._sourceSegment;)a=a._sourceSegment;return a}function Ib(u){let a=u,l=a._segmentIndexShift?a._segmentIndexShift:0;for(;a._sourceSegment;)a=a._sourceSegment,l+=a._segmentIndexShift?a._segmentIndexShift:0;return l-1}function Sb(u){return u.data||{}}function xb(u){return u.resolve||{}}function Ab(u){return[...Object.keys(u),...Object.getOwnPropertySymbols(u)]}function Np(u){return Bs(a=>{const l=u(a);return l?yn(l).pipe(Bt(()=>a)):nt(a)})}class xk extends class Sk{shouldDetach(a){return!1}store(a,l){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,l){return a.routeConfig===l.routeConfig}}{}const kp=new yt("ROUTES");class Rb{constructor(a,l,f,g){this.injector=a,this.compiler=l,this.onLoadStartListener=f,this.onLoadEndListener=g}load(a,l){if(l._loader$)return l._loader$;this.onLoadStartListener&&this.onLoadStartListener(l);const g=this.loadModuleFactory(l.loadChildren).pipe(Bt(p=>{this.onLoadEndListener&&this.onLoadEndListener(l);const _=p.create(a);return new Mp(zE(_.injector.get(kp,void 0,We.Self|We.Optional)).map(Fp),_)}),os(p=>{throw l._loader$=void 0,p}));return l._loader$=new UP(g,()=>new cr).pipe(PE()),l._loader$}loadModuleFactory(a){return ir(a()).pipe(gn(l=>l instanceof qC?nt(l):yn(this.compiler.compileModuleAsync(l))))}}class Rk{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,l){return a}}function Ok(u){throw u}function Mk(u,a,l){return a.parse("/")}function Ob(u,a){return nt(null)}const Lk={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Fk={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ei=(()=>{class u{constructor(l,f,g,p,_,C,b){this.rootComponentType=l,this.urlSerializer=f,this.rootContexts=g,this.location=p,this.config=b,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new cr,this.errorHandler=Ok,this.malformedUriErrorHandler=Mk,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Ob,afterPreactivation:Ob},this.urlHandlingStrategy=new Rk,this.routeReuseStrategy=new xk,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=_.get(Cr),this.console=_.get(RM);const P=_.get(wn);this.isNgZoneEnabled=P instanceof wn&&wn.isInAngularZone(),this.resetConfig(b),this.currentUrlTree=function oN(){return new js(new gt([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Rb(_,C,k=>this.triggerEvent(new UE(k)),k=>this.triggerEvent(new VE(k))),this.routerState=sb(this.currentUrlTree,this.rootComponentType),this.transitions=new Bi({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var l;return null===(l=this.location.getState())||void 0===l?void 0:l.\u0275routerPageId}setupNavigations(l){const f=this.events;return l.pipe(Zo(g=>0!==g.id),Bt(g=>Object.assign(Object.assign({},g),{extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),Bs(g=>{let p=!1,_=!1;return nt(g).pipe(Jn(C=>{this.currentNavigation={id:C.id,initialUrl:C.currentRawUrl,extractedUrl:C.extractedUrl,trigger:C.source,extras:C.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Bs(C=>{const b=this.browserUrlTree.toString(),O=!this.navigated||C.extractedUrl.toString()!==b||b!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||O)&&this.urlHandlingStrategy.shouldProcessUrl(C.rawUrl))return Mb(C.source)&&(this.browserUrlTree=C.extractedUrl),nt(C).pipe(Bs(P=>{const k=this.transitions.getValue();return f.next(new wp(P.id,this.serializeUrl(P.extractedUrl),P.source,P.restoredState)),k!==this.transitions.getValue()?dr:Promise.resolve(P)}),function tk(u,a,l,f){return Bs(g=>function QN(u,a,l,f,g){return new JN(u,a,l,f,g).apply()}(u,a,l,g.extractedUrl,f).pipe(Bt(p=>Object.assign(Object.assign({},g),{urlAfterRedirects:p}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Jn(P=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:P.urlAfterRedirects})}),function wk(u,a,l,f,g){return gn(p=>function mk(u,a,l,f,g="emptyOnly",p="legacy"){try{const _=new _k(u,a,l,f,g,p).recognize();return null===_?bb(new pk):nt(_)}catch(_){return bb(_)}}(u,a,p.urlAfterRedirects,l(p.urlAfterRedirects),f,g).pipe(Bt(_=>Object.assign(Object.assign({},p),{targetSnapshot:_}))))}(this.rootComponentType,this.config,P=>this.serializeUrl(P),this.paramsInheritanceStrategy,this.relativeLinkResolution),Jn(P=>{if("eager"===this.urlUpdateStrategy){if(!P.extras.skipLocationChange){const j=this.urlHandlingStrategy.merge(P.urlAfterRedirects,P.rawUrl);this.setBrowserUrl(j,P)}this.browserUrlTree=P.urlAfterRedirects}const k=new $P(P.id,this.serializeUrl(P.extractedUrl),this.serializeUrl(P.urlAfterRedirects),P.targetSnapshot);f.next(k)}));if(O&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:k,extractedUrl:j,source:G,restoredState:z,extras:Y}=C,X=new wp(k,this.serializeUrl(j),G,z);f.next(X);const $=sb(j,this.rootComponentType).snapshot;return nt(Object.assign(Object.assign({},C),{targetSnapshot:$,urlAfterRedirects:j,extras:Object.assign(Object.assign({},Y),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=C.rawUrl,C.resolve(null),dr}),Np(C=>{const{targetSnapshot:b,id:O,extractedUrl:M,rawUrl:P,extras:{skipLocationChange:k,replaceUrl:j}}=C;return this.hooks.beforePreactivation(b,{navigationId:O,appliedUrlTree:M,rawUrlTree:P,skipLocationChange:!!k,replaceUrl:!!j})}),Jn(C=>{const b=new XP(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(b)}),Bt(C=>Object.assign(Object.assign({},C),{guards:nk(C.targetSnapshot,C.currentSnapshot,this.rootContexts)})),function ak(u,a){return gn(l=>{const{targetSnapshot:f,currentSnapshot:g,guards:{canActivateChecks:p,canDeactivateChecks:_}}=l;return 0===_.length&&0===p.length?nt(Object.assign(Object.assign({},l),{guardsResult:!0})):function lk(u,a,l,f){return yn(u).pipe(gn(g=>function gk(u,a,l,f,g){const p=a&&a.routeConfig?a.routeConfig.canDeactivate:null;return p&&0!==p.length?nt(p.map(C=>{const b=uh(C,a,g);let O;if(function VN(u){return u&&as(u.canDeactivate)}(b))O=ir(b.canDeactivate(u,a,l,f));else{if(!as(b))throw new Error("Invalid CanDeactivate guard");O=ir(b(u,a,l,f))}return O.pipe(Ko())})).pipe(Fl()):nt(!0)}(g.component,g.route,l,a,f)),Ko(g=>!0!==g,!0))}(_,f,g,u).pipe(gn(C=>C&&function kN(u){return"boolean"==typeof u}(C)?function ck(u,a,l,f){return yn(a).pipe(Sl(g=>yp(function hk(u,a){return null!==u&&a&&a(new QP(u)),nt(!0)}(g.route.parent,f),function uk(u,a){return null!==u&&a&&a(new eN(u)),nt(!0)}(g.route,f),function fk(u,a,l){const f=a[a.length-1],p=a.slice(0,a.length-1).reverse().map(_=>function ik(u){const a=u.routeConfig?u.routeConfig.canActivateChild:null;return a&&0!==a.length?{node:u,guards:a}:null}(_)).filter(_=>null!==_).map(_=>FE(()=>nt(_.guards.map(b=>{const O=uh(b,_.node,l);let M;if(function UN(u){return u&&as(u.canActivateChild)}(O))M=ir(O.canActivateChild(f,u));else{if(!as(O))throw new Error("Invalid CanActivateChild guard");M=ir(O(f,u))}return M.pipe(Ko())})).pipe(Fl())));return nt(p).pipe(Fl())}(u,g.path,l),function dk(u,a,l){const f=a.routeConfig?a.routeConfig.canActivate:null;if(!f||0===f.length)return nt(!0);const g=f.map(p=>FE(()=>{const _=uh(p,a,l);let C;if(function jN(u){return u&&as(u.canActivate)}(_))C=ir(_.canActivate(a,u));else{if(!as(_))throw new Error("Invalid CanActivate guard");C=ir(_(a,u))}return C.pipe(Ko())}));return nt(g).pipe(Fl())}(u,g.route,l))),Ko(g=>!0!==g,!0))}(f,p,u,a):nt(C)),Bt(C=>Object.assign(Object.assign({},l),{guardsResult:C})))})}(this.ngModule.injector,C=>this.triggerEvent(C)),Jn(C=>{if(Vs(C.guardsResult)){const O=Ep(`Redirecting to "${this.serializeUrl(C.guardsResult)}"`);throw O.url=C.guardsResult,O}const b=new qP(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot,!!C.guardsResult);this.triggerEvent(b)}),Zo(C=>!!C.guardsResult||(this.restoreHistory(C),this.cancelNavigationTransition(C,""),!1)),Np(C=>{if(C.guards.canActivateChecks.length)return nt(C).pipe(Jn(b=>{const O=new ZP(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(O)}),Bs(b=>{let O=!1;return nt(b).pipe(function Ek(u,a){return gn(l=>{const{targetSnapshot:f,guards:{canActivateChecks:g}}=l;if(!g.length)return nt(l);let p=0;return yn(g).pipe(Sl(_=>function bk(u,a,l,f){return function Dk(u,a,l,f){const g=Ab(u);if(0===g.length)return nt({});const p={};return yn(g).pipe(gn(_=>function Tk(u,a,l,f){const g=uh(u,a,f);return ir(g.resolve?g.resolve(a,l):g(a,l))}(u[_],a,l,f).pipe(Jn(C=>{p[_]=C}))),Cp(1),gn(()=>Ab(p).length===g.length?nt(p):dr))}(u._resolve,u,a,f).pipe(Bt(p=>(u._resolvedData=p,u.data=Object.assign(Object.assign({},u.data),ob(u,l).resolve),null)))}(_.route,f,u,a)),Jn(()=>p++),Cp(1),gn(_=>p===g.length?nt(l):dr))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Jn({next:()=>O=!0,complete:()=>{O||(this.restoreHistory(b),this.cancelNavigationTransition(b,"At least one route resolver didn't emit any value."))}}))}),Jn(b=>{const O=new KP(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(O)}))}),Np(C=>{const{targetSnapshot:b,id:O,extractedUrl:M,rawUrl:P,extras:{skipLocationChange:k,replaceUrl:j}}=C;return this.hooks.afterPreactivation(b,{navigationId:O,appliedUrlTree:M,rawUrlTree:P,skipLocationChange:!!k,replaceUrl:!!j})}),Bt(C=>{const b=function DN(u,a,l){const f=Ol(u,a._root,l?l._root:void 0);return new rb(f,a)}(this.routeReuseStrategy,C.targetSnapshot,C.currentRouterState);return Object.assign(Object.assign({},C),{targetRouterState:b})}),Jn(C=>{this.currentUrlTree=C.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl),this.routerState=C.targetRouterState,"deferred"===this.urlUpdateStrategy&&(C.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,C),this.browserUrlTree=C.urlAfterRedirects)}),((u,a,l)=>Bt(f=>(new PN(a,f.targetRouterState,f.currentRouterState,l).activate(u),f)))(this.rootContexts,this.routeReuseStrategy,C=>this.triggerEvent(C)),Jn({next(){p=!0},complete(){p=!0}}),function zP(u){return _n((a,l)=>{try{a.subscribe(l)}finally{l.add(u)}})}(()=>{var C;p||_||this.cancelNavigationTransition(g,`Navigation ID ${g.id} is not equal to the current navigation id ${this.navigationId}`),(null===(C=this.currentNavigation)||void 0===C?void 0:C.id)===g.id&&(this.currentNavigation=null)}),os(C=>{if(_=!0,function iN(u){return u&&u[GE]}(C)){const b=Vs(C.url);b||(this.navigated=!0,this.restoreHistory(g,!0));const O=new jE(g.id,this.serializeUrl(g.extractedUrl),C.message);f.next(O),b?setTimeout(()=>{const M=this.urlHandlingStrategy.merge(C.url,this.rawUrlTree),P={skipLocationChange:g.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Mb(g.source)};this.scheduleNavigation(M,"imperative",null,P,{resolve:g.resolve,reject:g.reject,promise:g.promise})},0):g.resolve(!1)}else{this.restoreHistory(g,!0);const b=new YP(g.id,this.serializeUrl(g.extractedUrl),C);f.next(b);try{g.resolve(this.errorHandler(C))}catch(O){g.reject(O)}}return dr}))}))}resetRootComponentType(l){this.rootComponentType=l,this.routerState.root.component=this.rootComponentType}setTransition(l){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),l))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(l=>{const f="popstate"===l.type?"popstate":"hashchange";"popstate"===f&&setTimeout(()=>{var g;const p={replaceUrl:!0},_=(null===(g=l.state)||void 0===g?void 0:g.navigationId)?l.state:null;if(_){const b=Object.assign({},_);delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(p.state=b)}const C=this.parseUrl(l.url);this.scheduleNavigation(C,f,_,p)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(l){this.events.next(l)}resetConfig(l){pb(l),this.config=l.map(Fp),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(l,f={}){const{relativeTo:g,queryParams:p,fragment:_,queryParamsHandling:C,preserveFragment:b}=f,O=g||this.routerState.root,M=b?this.currentUrlTree.fragment:_;let P=null;switch(C){case"merge":P=Object.assign(Object.assign({},this.currentUrlTree.queryParams),p);break;case"preserve":P=this.currentUrlTree.queryParams;break;default:P=p||null}return null!==P&&(P=this.removeEmptyProps(P)),function SN(u,a,l,f,g){if(0===l.length)return Ap(a.root,a.root,a.root,f,g);const p=function xN(u){if("string"==typeof u[0]&&1===u.length&&"/"===u[0])return new ub(!0,0,u);let a=0,l=!1;const f=u.reduce((g,p,_)=>{if("object"==typeof p&&null!=p){if(p.outlets){const C={};return En(p.outlets,(b,O)=>{C[O]="string"==typeof b?b.split("/"):b}),[...g,{outlets:C}]}if(p.segmentPath)return[...g,p.segmentPath]}return"string"!=typeof p?[...g,p]:0===_?(p.split("/").forEach((C,b)=>{0==b&&"."===C||(0==b&&""===C?l=!0:".."===C?a++:""!=C&&g.push(C))}),g):[...g,p]},[]);return new ub(l,a,f)}(l);if(p.toRoot())return Ap(a.root,a.root,new gt([],{}),f,g);const _=function AN(u,a,l){if(u.isAbsolute)return new Rp(a.root,!0,0);if(-1===l.snapshot._lastPathIndex){const p=l.snapshot._urlSegment;return new Rp(p,p===a.root,0)}const f=ih(u.commands[0])?0:1;return function RN(u,a,l){let f=u,g=a,p=l;for(;p>g;){if(p-=g,f=f.parent,!f)throw new Error("Invalid number of '../'");g=f.segments.length}return new Rp(f,!1,g-p)}(l.snapshot._urlSegment,l.snapshot._lastPathIndex+f,u.numberOfDoubleDots)}(p,a,u),C=_.processChildren?rh(_.segmentGroup,_.index,p.commands):hb(_.segmentGroup,_.index,p.commands);return Ap(a.root,_.segmentGroup,C,f,g)}(O,this.currentUrlTree,l,P,null!=M?M:null)}navigateByUrl(l,f={skipLocationChange:!1}){const g=Vs(l)?l:this.parseUrl(l),p=this.urlHandlingStrategy.merge(g,this.rawUrlTree);return this.scheduleNavigation(p,"imperative",null,f)}navigate(l,f={skipLocationChange:!1}){return function Pk(u){for(let a=0;a<u.length;a++){const l=u[a];if(null==l)throw new Error(`The requested path contains ${l} segment at index ${a}`)}}(l),this.navigateByUrl(this.createUrlTree(l,f),f)}serializeUrl(l){return this.urlSerializer.serialize(l)}parseUrl(l){let f;try{f=this.urlSerializer.parse(l)}catch(g){f=this.malformedUriErrorHandler(g,this.urlSerializer,l)}return f}isActive(l,f){let g;if(g=!0===f?Object.assign({},Lk):!1===f?Object.assign({},Fk):f,Vs(l))return XE(this.currentUrlTree,l,g);const p=this.parseUrl(l);return XE(this.currentUrlTree,p,g)}removeEmptyProps(l){return Object.keys(l).reduce((f,g)=>{const p=l[g];return null!=p&&(f[g]=p),f},{})}processNavigations(){this.navigations.subscribe(l=>{this.navigated=!0,this.lastSuccessfulId=l.id,this.currentPageId=l.targetPageId,this.events.next(new xl(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,l.resolve(!0)},l=>{this.console.warn(`Unhandled Navigation Error: ${l}`)})}scheduleNavigation(l,f,g,p,_){var C,b;if(this.disposed)return Promise.resolve(!1);let O,M,P;_?(O=_.resolve,M=_.reject,P=_.promise):P=new Promise((G,z)=>{O=G,M=z});const k=++this.navigationId;let j;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(g=this.location.getState()),j=g&&g.\u0275routerPageId?g.\u0275routerPageId:p.replaceUrl||p.skipLocationChange?null!==(C=this.browserPageId)&&void 0!==C?C:0:(null!==(b=this.browserPageId)&&void 0!==b?b:0)+1):j=0,this.setTransition({id:k,targetPageId:j,source:f,restoredState:g,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:l,extras:p,resolve:O,reject:M,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(G=>Promise.reject(G))}setBrowserUrl(l,f){const g=this.urlSerializer.serialize(l),p=Object.assign(Object.assign({},f.extras.state),this.generateNgRouterState(f.id,f.targetPageId));this.location.isCurrentPathEqualTo(g)||f.extras.replaceUrl?this.location.replaceState(g,"",p):this.location.go(g,"",p)}restoreHistory(l,f=!1){var g,p;if("computed"===this.canceledNavigationResolution){const _=this.currentPageId-l.targetPageId;"popstate"!==l.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(g=this.currentNavigation)||void 0===g?void 0:g.finalUrl)||0===_?this.currentUrlTree===(null===(p=this.currentNavigation)||void 0===p?void 0:p.finalUrl)&&0===_&&(this.resetState(l),this.browserUrlTree=l.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(_)}else"replace"===this.canceledNavigationResolution&&(f&&this.resetState(l),this.resetUrlToCurrentUrlTree())}resetState(l){this.routerState=l.currentRouterState,this.currentUrlTree=l.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,l.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(l,f){const g=new jE(l.id,this.serializeUrl(l.extractedUrl),f);this.triggerEvent(g),l.resolve(!1)}generateNgRouterState(l,f){return"computed"===this.canceledNavigationResolution?{navigationId:l,\u0275routerPageId:f}:{navigationId:l}}}return u.\u0275fac=function(l){ng()},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();function Mb(u){return"imperative"!==u}let jl=(()=>{class u{constructor(l,f,g){this.router=l,this.route=f,this.locationStrategy=g,this.commands=null,this.href=null,this.onChanges=new cr,this.subscription=l.events.subscribe(p=>{p instanceof xl&&this.updateTargetUrlAndHref()})}set routerLink(l){this.commands=null!=l?Array.isArray(l)?l:[l]:null}ngOnChanges(l){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(l,f,g,p,_){if(0!==l||f||g||p||_||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const C={skipLocationChange:ta(this.skipLocationChange),replaceUrl:ta(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:ta(this.preserveFragment)})}}return u.\u0275fac=function(l){return new(l||u)(Be(ei),Be(ea),Be(qo))},u.\u0275dir=Tn({type:u,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(l,f){1&l&&Vo("click",function(p){return f.onClick(p.button,p.ctrlKey,p.shiftKey,p.altKey,p.metaKey)}),2&l&&Kf("target",f.target)("href",f.href,sf)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Os]}),u})();function ta(u){return""===u||!!u}class Lb{}class Fb{preload(a,l){return nt(null)}}let Pb=(()=>{class u{constructor(l,f,g,p){this.router=l,this.injector=g,this.preloadingStrategy=p,this.loader=new Rb(g,f,b=>l.triggerEvent(new UE(b)),b=>l.triggerEvent(new VE(b)))}setUpPreloading(){this.subscription=this.router.events.pipe(Zo(l=>l instanceof xl),Sl(()=>this.preload())).subscribe(()=>{})}preload(){const l=this.injector.get(Cr);return this.processRoutes(l,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(l,f){const g=[];for(const p of f)if(p.loadChildren&&!p.canLoad&&p._loadedConfig){const _=p._loadedConfig;g.push(this.processRoutes(_.module,_.routes))}else p.loadChildren&&!p.canLoad?g.push(this.preloadConfig(l,p)):p.children&&g.push(this.processRoutes(l,p.children));return yn(g).pipe(Ma(),Bt(p=>{}))}preloadConfig(l,f){return this.preloadingStrategy.preload(f,()=>(f._loadedConfig?nt(f._loadedConfig):this.loader.load(l.injector,f)).pipe(gn(p=>(f._loadedConfig=p,this.processRoutes(p.module,p.routes)))))}}return u.\u0275fac=function(l){return new(l||u)(Ge(ei),Ge(Lw),Ge(Qn),Ge(Lb))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})(),jp=(()=>{class u{constructor(l,f,g={}){this.router=l,this.viewportScroller=f,this.options=g,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},g.scrollPositionRestoration=g.scrollPositionRestoration||"disabled",g.anchorScrolling=g.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(l=>{l instanceof wp?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=l.navigationTrigger,this.restoredId=l.restoredState?l.restoredState.navigationId:0):l instanceof xl&&(this.lastId=l.id,this.scheduleScrollEvent(l,this.router.parseUrl(l.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(l=>{l instanceof HE&&(l.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(l.position):l.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(l.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(l,f){this.router.triggerEvent(new HE(l,"popstate"===this.lastSource?this.store[this.restoredId]:null,f))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return u.\u0275fac=function(l){ng()},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();const Hs=new yt("ROUTER_CONFIGURATION"),Nb=new yt("ROUTER_FORROOT_GUARD"),jk=[Qg,{provide:QE,useClass:JE},{provide:ei,useFactory:function Wk(u,a,l,f,g,p,_={},C,b){const O=new ei(null,u,a,l,f,g,zE(p));return C&&(O.urlHandlingStrategy=C),b&&(O.routeReuseStrategy=b),function zk(u,a){u.errorHandler&&(a.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(a.malformedUriErrorHandler=u.malformedUriErrorHandler),u.onSameUrlNavigation&&(a.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(a.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.relativeLinkResolution&&(a.relativeLinkResolution=u.relativeLinkResolution),u.urlUpdateStrategy&&(a.urlUpdateStrategy=u.urlUpdateStrategy),u.canceledNavigationResolution&&(a.canceledNavigationResolution=u.canceledNavigationResolution)}(_,O),_.enableTracing&&O.events.subscribe(M=>{var P,k;null===(P=console.group)||void 0===P||P.call(console,`Router Event: ${M.constructor.name}`),console.log(M.toString()),console.log(M),null===(k=console.groupEnd)||void 0===k||k.call(console)}),O},deps:[QE,Pl,Qg,Qn,Lw,kp,Hs,[class Ak{},new Kr],[class Ik{},new Kr]]},Pl,{provide:ea,useFactory:function Yk(u){return u.routerState.root},deps:[ei]},Pb,Fb,class Bk{preload(a,l){return l().pipe(os(()=>nt(null)))}},{provide:Hs,useValue:{enableTracing:!1}}];function Uk(){return new Bw("Router",ei)}let kb=(()=>{class u{constructor(l,f){}static forRoot(l,f){return{ngModule:u,providers:[jk,Bb(l),{provide:Nb,useFactory:Gk,deps:[[ei,new Kr,new Za]]},{provide:Hs,useValue:f||{}},{provide:qo,useFactory:Hk,deps:[ks,[new Qc(Kg),new Kr],Hs]},{provide:jp,useFactory:Vk,deps:[ei,HF,Hs]},{provide:Lb,useExisting:f&&f.preloadingStrategy?f.preloadingStrategy:Fb},{provide:Bw,multi:!0,useFactory:Uk},[Up,{provide:Fg,multi:!0,useFactory:$k,deps:[Up]},{provide:jb,useFactory:Xk,deps:[Up]},{provide:Mw,multi:!0,useExisting:jb}]]}}static forChild(l){return{ngModule:u,providers:[Bb(l)]}}}return u.\u0275fac=function(l){return new(l||u)(Ge(Nb,8),Ge(ei,8))},u.\u0275mod=Ts({type:u}),u.\u0275inj=Gr({}),u})();function Vk(u,a,l){return l.scrollOffset&&a.setOffset(l.scrollOffset),new jp(u,a,l)}function Hk(u,a,l={}){return l.useHash?new EL(u,a):new iE(u,a)}function Gk(u){return"guarded"}function Bb(u){return[{provide:nS,multi:!0,useValue:u},{provide:kp,multi:!0,useValue:u}]}let Up=(()=>{class u{constructor(l){this.injector=l,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new cr}appInitializer(){return this.injector.get(yL,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let f=null;const g=new Promise(C=>f=C),p=this.injector.get(ei),_=this.injector.get(Hs);return"disabled"===_.initialNavigation?(p.setUpLocationChangeListener(),f(!0)):"enabled"===_.initialNavigation||"enabledBlocking"===_.initialNavigation?(p.hooks.afterPreactivation=()=>this.initNavigation?nt(null):(this.initNavigation=!0,f(!0),this.resultOfPreactivationDone),p.initialNavigation()):f(!0),g})}bootstrapListener(l){const f=this.injector.get(Hs),g=this.injector.get(Pb),p=this.injector.get(jp),_=this.injector.get(ei),C=this.injector.get(Gg);l===C.components[0]&&(("enabledNonBlocking"===f.initialNavigation||void 0===f.initialNavigation)&&_.initialNavigation(),g.setUpPreloading(),p.init(),_.resetRootComponentType(C.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return u.\u0275fac=function(l){return new(l||u)(Ge(Qn))},u.\u0275prov=mt({token:u,factory:u.\u0275fac}),u})();function $k(u){return u.appInitializer.bind(u)}function Xk(u){return u.bootstrapListener.bind(u)}const jb=new yt("Router Initializer");function Ub(u,a,l,f,g,p,_){try{var C=u[p](_),b=C.value}catch(O){return void l(O)}C.done?a(b):Promise.resolve(b).then(f,g)}function ae(u){return function(){var a=this,l=arguments;return new Promise(function(f,g){var p=u.apply(a,l);function _(b){Ub(p,f,g,_,C,"next",b)}function C(b){Ub(p,f,g,_,C,"throw",b)}_(void 0)})}}function ot(u,a,l,f){if("a"===l&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?u!==a||!f:!a.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?f:"a"===l?f.call(u):f?f.value:a.get(u)}function Gs(u,a,l,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?u!==a||!g:!a.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(u,l):g?g.value=l:a.set(u,l),l}var Ws,rr,je,u;"function"==typeof SuppressedError&&SuppressedError,(u=Ws||(Ws={}))[u.BOPM_BLOCK=0]="BOPM_BLOCK",u[u.BOPM_UPDATE=1]="BOPM_UPDATE",function(u){u[u.CCUT_AUTO=0]="CCUT_AUTO",u[u.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",u[u.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",u[u.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",u[u.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",u[u.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(rr||(rr={})),function(u){u[u.IPF_BINARY=0]="IPF_BINARY",u[u.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",u[u.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",u[u.IPF_NV21=3]="IPF_NV21",u[u.IPF_RGB_565=4]="IPF_RGB_565",u[u.IPF_RGB_555=5]="IPF_RGB_555",u[u.IPF_RGB_888=6]="IPF_RGB_888",u[u.IPF_ARGB_8888=7]="IPF_ARGB_8888",u[u.IPF_RGB_161616=8]="IPF_RGB_161616",u[u.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",u[u.IPF_ABGR_8888=10]="IPF_ABGR_8888",u[u.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",u[u.IPF_BGR_888=12]="IPF_BGR_888",u[u.IPF_BINARY_8=13]="IPF_BINARY_8",u[u.IPF_NV12=14]="IPF_NV12",u[u.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(je||(je={}));const Vb=u=>Object.prototype.toString.call(u),Vp=u=>Array.isArray?Array.isArray(u):"[object Array]"===Vb(u),Hp=u=>"[object Boolean]"===Vb(u),Yt=u=>"number"==typeof u&&!Number.isNaN(u),ji=u=>null!==u&&"object"==typeof u&&!Array.isArray(u),Hb=u=>!(!ji(u)||!(u.bytes instanceof Uint8Array)||!Yt(u.width)||u.width<=0||!Yt(u.height)||u.height<=0||!Yt(u.stride)||u.stride<=0||!("format"in u)||"tag"in u&&!Kk(u.tag)),Kk=u=>!!ji(u)&&!!Yt(u.imageId)&&"type"in u,na=u=>!!ji(u)&&!!Yt(u.x)&&!!Yt(u.y);function Gb(u,a){return Gp.apply(this,arguments)}function Gp(){return Gp=ae(function*(u,a){return yield new Promise((l,f)=>{let g=new XMLHttpRequest;g.open("GET",u,!0),g.responseType=a,g.send(),g.onloadend=ae(function*(){g.status<200||g.status>=300?f(u+" "+g.status):l(g.response)}),g.onerror=()=>{f(new Error("Network Error: "+g.statusText))}})}),Gp.apply(this,arguments)}const zs=(u,a)=>{let l=u.split("."),f=a.split(".");for(let g=0;g<l.length&&g<f.length;++g){let p=l[g],_=f[g];if(p===_)continue;let C=parseInt(l[g]),b=parseInt(f[g]);return C===b||Number.isNaN(C)&&Number.isNaN(b)?p<_?-1:1:C<b||Number.isNaN(C)&&Number.isInteger(b)?-1:1}return l.length===f.length?0:l.length<f.length?-1:1},t2="function"==typeof BigInt;var hh,nn,Ys,Ul,Vl,yi,$s,Wp;class Ci{get _isFetchingStarted(){return ot(this,Vl,"f")}constructor(){hh.add(this),nn.set(this,[]),Ys.set(this,1),Ul.set(this,Ws.BOPM_BLOCK),Vl.set(this,!1),yi.set(this,void 0),$s.set(this,rr.CCUT_AUTO)}setErrorListener(a){}addImageToBuffer(a){var l;if(!Hb(a))throw new TypeError("Invalid 'image'.");if((null===(l=a.tag)||void 0===l?void 0:l.hasOwnProperty("imageId"))&&"number"==typeof a.tag.imageId&&this.hasImage(a.tag.imageId))throw new Error("Existed imageId.");if(ot(this,nn,"f").length>=ot(this,Ys,"f"))switch(ot(this,Ul,"f")){case Ws.BOPM_BLOCK:break;case Ws.BOPM_UPDATE:if(ot(this,nn,"f").push(a),ji(ot(this,yi,"f"))&&Yt(ot(this,yi,"f").imageId)&&1==ot(this,yi,"f").keepInBuffer)for(;ot(this,nn,"f").length>ot(this,Ys,"f");){const f=ot(this,nn,"f").findIndex(g=>{var p;return(null===(p=g.tag)||void 0===p?void 0:p.imageId)!==ot(this,yi,"f").imageId});ot(this,nn,"f").splice(f,1)}else ot(this,nn,"f").splice(0,ot(this,nn,"f").length-ot(this,Ys,"f"))}else ot(this,nn,"f").push(a)}getImage(){if(0===ot(this,nn,"f").length)return null;let a;if(ot(this,yi,"f")&&Yt(ot(this,yi,"f").imageId)){const l=ot(this,hh,"m",Wp).call(this,ot(this,yi,"f").imageId);if(l<0)throw new Error(`Image with id ${ot(this,yi,"f").imageId} doesn't exist.`);a=ot(this,nn,"f").slice(l,l+1)[0]}else a=ot(this,nn,"f").pop();if([je.IPF_RGB_565,je.IPF_RGB_555,je.IPF_RGB_888,je.IPF_ARGB_8888,je.IPF_RGB_161616,je.IPF_ARGB_16161616,je.IPF_ABGR_8888,je.IPF_ABGR_16161616,je.IPF_BGR_888].includes(a.format)){if(ot(this,$s,"f")===rr.CCUT_RGB_R_CHANNEL_ONLY){Ci._onLog&&Ci._onLog("only get R channel data.");const l=new Uint8Array(a.width*a.height);for(let f=0;f<l.length;f++)switch(a.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:l[f]=a.bytes[3*f+2];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:l[f]=a.bytes[4*f+2];break;case je.IPF_BGR_888:l[f]=a.bytes[3*f];break;case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:l[f]=a.bytes[4*f]}a.bytes=l,a.stride=a.width,a.format=je.IPF_GRAYSCALED}else if(ot(this,$s,"f")===rr.CCUT_RGB_G_CHANNEL_ONLY){Ci._onLog&&Ci._onLog("only get G channel data.");const l=new Uint8Array(a.width*a.height);for(let f=0;f<l.length;f++)switch(a.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:case je.IPF_BGR_888:l[f]=a.bytes[3*f+1];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:l[f]=a.bytes[4*f+1]}a.bytes=l,a.stride=a.width,a.format=je.IPF_GRAYSCALED}else if(ot(this,$s,"f")===rr.CCUT_RGB_B_CHANNEL_ONLY){Ci._onLog&&Ci._onLog("only get B channel data.");const l=new Uint8Array(a.width*a.height);for(let f=0;f<l.length;f++)switch(a.format){case je.IPF_RGB_565:case je.IPF_RGB_555:case je.IPF_RGB_888:case je.IPF_RGB_161616:l[f]=a.bytes[3*f];break;case je.IPF_ARGB_8888:case je.IPF_ARGB_16161616:l[f]=a.bytes[4*f];break;case je.IPF_BGR_888:l[f]=a.bytes[3*f+2];break;case je.IPF_ABGR_8888:case je.IPF_ABGR_16161616:l[f]=a.bytes[4*f+2]}a.bytes=l,a.stride=a.width,a.format=je.IPF_GRAYSCALED}}else[je.IPF_NV21,je.IPF_NV12].includes(a.format)&&Ci._onLog&&Ci._onLog("NV21 or NV12 is not supported.");return a}setNextImageToReturn(a,l){if(!((...f)=>0!==f.length&&f.every(g=>Yt(g)))(a))throw new TypeError("Invalid 'imageId'.");if(void 0!==l&&!Hp(l))throw new TypeError("Invalid 'keepInBuffer'.");Gs(this,yi,{imageId:a,keepInBuffer:l},"f")}_resetNextReturnedImage(){Gs(this,yi,null,"f")}hasImage(a){return ot(this,hh,"m",Wp).call(this,a)>=0}startFetching(){Gs(this,Vl,!0,"f")}stopFetching(){Gs(this,Vl,!1,"f")}setMaxImageCount(a){if("number"!=typeof a)throw new TypeError("Invalid 'count'.");if(a<1||Math.round(a)!==a)throw new Error("Invalid 'count'.");for(Gs(this,Ys,a,"f");ot(this,nn,"f")&&ot(this,nn,"f").length>a;)ot(this,nn,"f").shift()}getMaxImageCount(){return ot(this,Ys,"f")}getImageCount(){return ot(this,nn,"f").length}clearBuffer(){ot(this,nn,"f").length=0}isBufferEmpty(){return 0===ot(this,nn,"f").length}setBufferOverflowProtectionMode(a){Gs(this,Ul,a,"f")}getBufferOverflowProtectionMode(){return ot(this,Ul,"f")}setColourChannelUsageType(a){Gs(this,$s,a,"f")}getColourChannelUsageType(){return ot(this,$s,"f")}}nn=new WeakMap,Ys=new WeakMap,Ul=new WeakMap,Vl=new WeakMap,yi=new WeakMap,$s=new WeakMap,hh=new WeakSet,Wp=function(u){if("number"!=typeof u)throw new TypeError("Invalid 'imageId'.");return ot(this,nn,"f").findIndex(a=>{var l;return(null===(l=a.tag)||void 0===l?void 0:l.imageId)===u})};const dh="undefined"==typeof self,Wb=(()=>{if(!dh&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})(),zb=u=>{if(null==u&&(u="./"),!dh){let a=document.createElement("a");a.href=u,u=a.href}return u.endsWith("/")||(u+="/"),u};let Hl,Ir,fh,gh,Hn;"undefined"!=typeof navigator&&(Hl=navigator,Ir=Hl.userAgent,fh=Hl.platform,gh=Hl.mediaDevices),function(){if(!dh){const u={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Hl.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},a={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:fh,search:"Win"},Mac:{str:fh},Linux:{str:fh}};let l="unknownBrowser",f=0,g="unknownOS";for(let p in u){const _=u[p]||{};let O=_.verStr||Ir,M=_.verSearch||p;if(M instanceof Array||(M=[M]),-1!=(_.str||Ir).indexOf(_.search||p)){l=p;for(let P of M){let k=O.indexOf(P);if(-1!=k){f=parseFloat(O.substring(k+P.length+1));break}}break}}for(let p in a){const _=a[p]||{};if(-1!=(_.str||Ir).indexOf(_.search||p)){g=p;break}}"Linux"==g&&-1!=Ir.indexOf("Windows NT")&&(g="HarmonyOS"),Hn={browser:l,version:f,OS:g}}dh&&(Hn={browser:"ssr",version:0,OS:"ssr"})}();const n2="undefined"!=typeof WebAssembly&&Ir&&!(/Safari/.test(Ir)&&!/Chrome/.test(Ir)&&/\(.+\s11_2_([2-6]).*\)/.test(Ir)),i2="undefined"!=typeof Worker,Yb=!(!gh||!gh.getUserMedia),r2=function(){var u=ae(function*(){let a=!1;if(Yb)try{(yield gh.getUserMedia({video:!0})).getTracks().forEach(l=>{l.stop()}),a=!0}catch(l){}return a});return function(){return u.apply(this,arguments)}}(),$b=u=>u&&"object"==typeof u&&"function"==typeof u.then;class ph extends Promise{constructor(a){let l,f;super((g,p)=>{l=g,f=p}),this._s="pending",this.resolve=g=>{this.isPending&&($b(g)?this.task=g:(this._s="fulfilled",l(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=a}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(a){var l=this;let f;this._task=a,$b(a)?f=a:"function"==typeof a&&(f=new Promise(a)),f&&ae(function*(){try{const g=yield f;a===l._task&&l.resolve(g)}catch(g){a===l._task&&l.reject(g)}})()}get isEmpty(){return null==this._task}}const wi={},Xb=function(){var u=ae(function*(a){let l="string"==typeof a?[a]:a,f=[];for(let g of l)f.push(wi[g]=wi[g]||new ph);yield Promise.all(f)});return function(l){return u.apply(this,arguments)}}(),mh=function(){var u=ae(function*(a,l){let f,g="string"==typeof a?[a]:a,p=[];for(let _ of g){let C;p.push(C=wi[_]=wi[_]||new ph(f=f||l())),C.isEmpty&&(C.task=f=f||l())}yield Promise.all(p)});return function(l,f){return u.apply(this,arguments)}}();let ct,qb=0;const Dt=()=>qb++,vt={};let ls,zp=!1;const Xs={},fn={},Ze={std:{version:"1.2.10",path:zb(Wb+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:Wb}},Gl=new Proxy(Ze,{get(u,a,l){let f=Reflect.get(u,a,l);return f&&f.path&&(f=f.path),f}}),cs={dip:{wasm:!0}},sr=function(){var u=ae(function*(a){let l;a instanceof Array||(a=a?[a]:[]);{let p=wi.core;l=!p||p.isEmpty}let f=new Map;for(let p of a){if(p=p.toLowerCase(),"std"==p||"core"==p)continue;if(!cs[p])throw Error("The '"+p+"' module cannot be found.");let _=cs[p].deps;if(null==_?void 0:_.length)for(let b of _){let O=wi[b];f.has(b)||f.set(b,!O||O.isEmpty)}let C=wi[p];f.has(p)||f.set(p,!C||C.isEmpty)}let g=[];l&&g.push("core"),g.push(...f.keys()),yield mh(g,ae(function*(){const p=[...f.entries()].filter(P=>P[1]).map(P=>P[0]),_={};for(let P in Gl){if("rootDirectory"==P)continue;let k=Gl[P];Gl.rootDirectory&&(k.startsWith("http://")||k.startsWith("https://")||(k=Gl.rootDirectory+"/"+k)),_[P]=zb(k)}const C={};for(let P of p)C[P]=cs[P];const b={engineResourcePaths:_,autoResources:C,names:p};let O=new ph;if(l){b.needLoadCore=!0;let P=_.core+$t._workerName;_.rootDirectory&&(P=_.rootDirectory+P),P.startsWith(location.origin)||(P=yield fetch(P).then(k=>k.blob()).then(k=>URL.createObjectURL(k))),ct=new Worker(P),ct.onerror=k=>{let j=new Error(k.message);O.reject(j)},ct.addEventListener("message",k=>{let j=k.data?k.data:k,z=j.id,Y=j.body;switch(j.type){case"log":ls&&ls(j.message);break;case"task":try{vt[z](Y),delete vt[z]}catch(X){throw delete vt[z],X}break;case"event":try{vt[z](Y)}catch(X){throw X}break;default:console.log(k)}}),b.bLog=!!ls,b.bd=zp,b.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield Xb("worker");let M=qb++;vt[M]=P=>{if(P.success)Object.assign(Xs,P.versions),"{}"!==JSON.stringify(P.versions)&&($t._versions=P.versions),O.resolve(void 0);else{const k=Error(P.message);P.stack&&(k.stack=P.stack),O.reject(k)}},ct.postMessage({type:"loadWasm",body:b,id:M}),l&&mh("worker",()=>Promise.resolve()),yield O}))});return function(l){return u.apply(this,arguments)}}();class $t{static get engineResourcePaths(){return Gl}static set engineResourcePaths(a){Object.assign(Ze,a)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ls}static set _onLog(a){(u=>{ls=u,ct&&ct.postMessage({type:"setBLog",body:{value:!!u}})})(a)}static get _bDebug(){return zp}static set _bDebug(a){(u=>{zp=u,ct&&ct.postMessage({type:"setBDebug",body:{value:!!u}})})(a)}static isModuleLoaded(a){return a=(a=a||"core").toLowerCase(),!!wi[a]&&wi[a].isFulfilled}static loadWasm(a){return ae(function*(){return yield sr(a)})()}static detectEnvironment(){return ae(function*(){return yield ae(function*(){return{wasm:n2,worker:i2,getUserMedia:Yb,camera:yield r2(),browser:Hn.browser,version:Hn.version,OS:Hn.OS}})()})()}static getModuleVersion(){return ae(function*(){return yield new Promise((a,l)=>{let f=Dt();vt[f]=function(){var g=ae(function*(p){if(p.success)return a(p.versions);{let _=new Error(p.message);return _.stack=p.stack+"\n"+_.stack,l(_)}});return function(p){return g.apply(this,arguments)}}(),ct.postMessage({type:"getModuleVersion",id:f})})})()}static getVersion(){return`3.2.30(Worker: ${Xs.core&&Xs.core.worker||"Not Loaded"}, Wasm: ${Xs.core&&Xs.core.wasm||"Not Loaded"})`}static enableLogging(){Ci._onLog=console.log,$t._onLog=console.log}static disableLogging(){Ci._onLog=null,$t._onLog=null}static cfd(a){return ae(function*(){return yield new Promise((l,f)=>{let g=Dt();vt[g]=function(){var p=ae(function*(_){if(_.success)return l();{let C=new Error(_.message);return C.stack=_.stack+"\n"+C.stack,f(C)}});return function(_){return p.apply(this,arguments)}}(),ct.postMessage({type:"cfd",id:g,body:{count:a}})})})()}}var Xt,Zb,Yp,Kb,Qb,_h,Jb,eD,ia,tD,nD;$t._bSupportDce4Module=-1,$t._bSupportIRTModule=-1,$t._versions=null,$t._workerName="core.worker.js",$t.browserInfo=Hn,function(u){u[u.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",u[u.CRIT_BARCODE=2]="CRIT_BARCODE",u[u.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",u[u.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",u[u.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",u[u.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Xt||(Xt={})),function(u){u[u.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",u[u.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",u[u.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",u[u.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(Zb||(Zb={})),function(u){u[u.EC_OK=0]="EC_OK",u[u.EC_UNKNOWN=-1e4]="EC_UNKNOWN",u[u.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",u[u.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",u[u.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",u[u.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",u[u.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",u[u.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",u[u.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",u[u.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",u[u.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",u[u.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",u[u.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",u[u.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",u[u.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",u[u.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",u[u.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",u[u.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",u[u.EC_TIMEOUT=-10026]="EC_TIMEOUT",u[u.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",u[u.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",u[u.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",u[u.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",u[u.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",u[u.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",u[u.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",u[u.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",u[u.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",u[u.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",u[u.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",u[u.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",u[u.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",u[u.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",u[u.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",u[u.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",u[u.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",u[u.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",u[u.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",u[u.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",u[u.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",u[u.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",u[u.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",u[u.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",u[u.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",u[u.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",u[u.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",u[u.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",u[u.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",u[u.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",u[u.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",u[u.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",u[u.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",u[u.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",u[u.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",u[u.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",u[u.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",u[u.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",u[u.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",u[u.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",u[u.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",u[u.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",u[u.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",u[u.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",u[u.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",u[u.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",u[u.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",u[u.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",u[u.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",u[u.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",u[u.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",u[u.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",u[u.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",u[u.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",u[u.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",u[u.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",u[u.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",u[u.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",u[u.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",u[u.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",u[u.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",u[u.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",u[u.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",u[u.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",u[u.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",u[u.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",u[u.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",u[u.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",u[u.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",u[u.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",u[u.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",u[u.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",u[u.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",u[u.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",u[u.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",u[u.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",u[u.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",u[u.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",u[u.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",u[u.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",u[u.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",u[u.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Yp||(Yp={})),function(u){u[u.GEM_SKIP=0]="GEM_SKIP",u[u.GEM_AUTO=1]="GEM_AUTO",u[u.GEM_GENERAL=2]="GEM_GENERAL",u[u.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",u[u.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",u[u.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",u[u.GEM_REV=-2147483648]="GEM_REV"}(Kb||(Kb={})),function(u){u[u.GTM_SKIP=0]="GTM_SKIP",u[u.GTM_INVERTED=1]="GTM_INVERTED",u[u.GTM_ORIGINAL=2]="GTM_ORIGINAL",u[u.GTM_AUTO=4]="GTM_AUTO",u[u.GTM_REV=-2147483648]="GTM_REV"}(Qb||(Qb={})),function(u){u[u.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",u[u.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(_h||(_h={})),function(u){u[u.PDFRM_VECTOR=1]="PDFRM_VECTOR",u[u.PDFRM_RASTER=2]="PDFRM_RASTER",u[u.PDFRM_REV=-2147483648]="PDFRM_REV"}(Jb||(Jb={})),function(u){u[u.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",u[u.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(eD||(eD={})),function(u){u[u.IRUT_NULL=0]="IRUT_NULL",u[u.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",u[u.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",u[u.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",u[u.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",u[u.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",u[u.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",u[u.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",u[u.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",u[u.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",u[u.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",u[u.IRUT_CONTOURS=1024]="IRUT_CONTOURS",u[u.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",u[u.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",u[u.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",u[u.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",u[u.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",u[u.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",u[u.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",u[u.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",u[u.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",u[u.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",u[u.IRUT_CORNERS=2097152]="IRUT_CORNERS",u[u.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",u[u.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",u[u.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",u[u.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",u[u.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",u[u.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",u[u.IRUT_ALL=268435455]="IRUT_ALL"}(ia||(ia={})),function(u){u[u.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",u[u.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",u[u.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",u[u.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",u[u.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",u[u.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",u[u.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",u[u.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",u[u.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(tD||(tD={})),function(u){u[u.ST_NULL=0]="ST_NULL",u[u.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",u[u.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",u[u.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",u[u.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",u[u.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",u[u.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",u[u.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(nD||(nD={}));const us="undefined"==typeof self,iD=us?{}:self,rD=(()=>{if(!us&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})(),sD=u=>{if(null==u&&(u="./"),!us){let a=document.createElement("a");a.href=u,u=a.href}return u.endsWith("/")||(u+="/"),u},oD=u=>u&&"object"==typeof u&&"function"==typeof u.then;class $p extends Promise{constructor(a){let l,f;super((g,p)=>{l=g,f=p}),this._s="pending",this.resolve=g=>{this.isPending&&(oD(g)?this.task=g:(this._s="fulfilled",l(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=a}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(a){var l=this;let f;this._task=a,oD(a)?f=a:"function"==typeof a&&(f=new Promise(a)),f&&ae(function*(){try{const g=yield f;a===l._task&&l.resolve(g)}catch(g){a===l._task&&l.reject(g)}})()}get isEmpty(){return null==this._task}}const vh=" is not allowed to change after `createInstance` or `loadWasm` is called.",a2=!us&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",aD=(u,a)=>{const l=u;if(!l._pLoad.isEmpty)throw new Error("`license`"+vh);l._license=a};!us&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const lD=u=>{if(null==u)u=[];else{u=u instanceof Array?[...u]:[u];for(let a=0;a<u.length;++a){if(!us){let l=document.createElement("a");l.href=u[a],u[a]=l.href}u[a].endsWith("/")||(u[a]+="/")}}return u},cD=(u,a)=>{const l=u;if(!l._pLoad.isEmpty)throw new Error("`licenseServer`"+vh);l._licenseServer=lD(a)},uD=(u,a)=>{const l=u;if(!l._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+vh);l._deviceFriendlyName=a||""};let Wl,zl,yh,Xp,Ui;"undefined"!=typeof navigator&&(Wl=navigator,zl=Wl.userAgent,yh=Wl.platform,Xp=Wl.mediaDevices),function(){if(!us){const u={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Wl.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},a={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:yh,search:"Win"},Mac:{str:yh},Linux:{str:yh}};let l="unknownBrowser",f=0,g="unknownOS";for(let p in u){const _=u[p]||{};let O=_.verStr||zl,M=_.verSearch||p;if(M instanceof Array||(M=[M]),-1!=(_.str||zl).indexOf(_.search||p)){l=p;for(let P of M){let k=O.indexOf(P);if(-1!=k){f=parseFloat(O.substring(k+P.length+1));break}}break}}for(let p in a){const _=a[p]||{};if(-1!=(_.str||zl).indexOf(_.search||p)){g=p;break}}"Linux"==g&&-1!=zl.indexOf("Windows NT")&&(g="HarmonyOS"),Ui={browser:l,version:f,OS:g}}us&&(Ui={browser:"ssr",version:0,OS:"ssr"})}();const hD=function(){var u=ae(function*(){return sr("license"),mh("dynamsoft_inited",ae(function*(){let{lt:a,l,ls:f,sp:g,rmk:p,cv:_}=((O,M=!1)=>{const P=O;if(P._pLoad.isEmpty){let k,j,G,z=P._license||"",Y=JSON.parse(JSON.stringify(P._licenseServer)),X=P._sessionPassword,$=0;if(z.startsWith("t")||z.startsWith("f"))$=0;else if(0===z.length||z.startsWith("P")||z.startsWith("L")||z.startsWith("Y")||z.startsWith("A"))$=1;else{$=2;const K=z.indexOf(":");-1!=K&&(z=z.substring(K+1));const ge=z.indexOf("?");if(-1!=ge&&(j=z.substring(ge+1),z=z.substring(0,ge)),z.startsWith("DLC2"))$=0;else{if(z.startsWith("DLS2")){let _e;try{let Te=z.substring(4);Te=atob(Te),_e=JSON.parse(Te)}catch(Te){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(z=_e.handshakeCode?_e.handshakeCode:_e.organizationID?_e.organizationID:"","number"==typeof z&&(z=JSON.stringify(z)),0===Y.length){let Te=[];_e.mainServerURL&&(Te[0]=_e.mainServerURL),_e.standbyServerURL&&(Te[1]=_e.standbyServerURL),Y=lD(Te)}!X&&_e.sessionPassword&&(X=_e.sessionPassword),k=_e.remark}z&&"200001"!==z&&!z.startsWith("200001-")||($=1)}}if($&&(M||(iD.crypto||(G="Please upgrade your browser to support online key."),iD.crypto.subtle||(G="Require https to use online key in this browser."))),G){if(1!==$)throw new Error(G);$=0,console.warn(G),P._lastErrorCode=-1,P._lastErrorString=G}return 1===$&&(z="",console.warn("Applying for a public trial license ...")),{lt:$,l:z,ls:Y,sp:X,rmk:k,cv:j}}throw new Error("Can't preprocess license again"+vh)})(Mt),C=new $p;Mt._pLoad.task=C,ae(function*(){try{yield Mt._pLoad}catch(O){}})();let b=Dt();vt[b]=O=>{if(O.message&&Mt._onAuthMessage){let k=Mt._onAuthMessage(O.message);null!=k&&(O.message=k)}let M,P=!1;if(1===a&&(P=!0),O.success?(ls&&ls("init license success"),O.message&&console.warn(O.message),$t._bSupportIRTModule=O.bSupportIRTModule,$t._bSupportDce4Module=O.bSupportDce4Module,Mt.bPassValidation=!0):(M=Error(O.message),O.stack&&(M.stack=O.stack),O.ltsErrorCode&&(M.ltsErrorCode=O.ltsErrorCode),P||111==O.ltsErrorCode&&-1!=O.message.toLowerCase().indexOf("trial license")&&(P=!0)),P){let k=Ze.license;Ze.rootDirectory&&(k=Ze.rootDirectory+"/"+k),k=sD(k),(j=ae(function*(G,z,Y){if(!G._bNeverShowDialog)try{let X=yield fetch(G.engineResourcePath+"dls.license.dialog.html");if(!X.ok)throw Error("Get license dialog fail. Network Error: "+X.statusText);let $=yield X.text();if(!$.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let K=document.createElement("div");K.innerHTML=$;let ge=[];for(let y=0;y<K.childElementCount;++y){let w=K.children[y];w instanceof HTMLStyleElement&&(ge.push(w),document.head.append(w))}let _e=1==K.childElementCount?K.children[0]:K;_e.remove();let Te,Se,F,Ce,Ne,Ke=[_e],D=_e.children;for(let y of D)Ke.push(y);for(let y=0;y<Ke.length;++y)for(let w of Ke[y].children)Ke.push(w);for(let y of Ke)if(!Te&&y.classList.contains("dls-license-mask"))Te=y,y.addEventListener("click",w=>{if(y==w.target){_e.remove();for(let I of ge)I.remove()}});else if(!Se&&y.classList.contains("dls-license-icon-close"))Se=y,y.addEventListener("click",()=>{_e.remove();for(let w of ge)w.remove()});else if(!F&&y.classList.contains("dls-license-icon-error"))F=y,"error"!=z&&y.remove();else if(!Ce&&y.classList.contains("dls-license-icon-warn"))Ce=y,"warn"!=z&&y.remove();else if(!Ne&&y.classList.contains("dls-license-msg-content")){Ne=y;let w=Y;for(;w;){let I=w.indexOf("["),m=w.indexOf("]",I),v=w.indexOf("(",m),T=w.indexOf(")",v);if(-1==I||-1==m||-1==v||-1==T){y.appendChild(new Text(w));break}I>0&&y.appendChild(new Text(w.substring(0,I)));let A=document.createElement("a"),S=w.substring(I+1,m);A.innerText=S;let x=w.substring(v+1,T);A.setAttribute("href",x),A.setAttribute("target","_blank"),y.appendChild(A),w=w.substring(T+1)}}document.body.appendChild(_e)}catch(X){G._onLog&&G._onLog(X.message||X)}}),function(G,z,Y){return j.apply(this,arguments)})({_bNeverShowDialog:Mt._bNeverShowDialog,engineResourcePath:k,_onLog:ls},O.success?"warn":"error",O.message)}var j;O.success?C.resolve(void 0):C.reject(M)},yield Xb("worker"),ct.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!a,bptk:1===a,l,os:Ui,fn:Mt.deviceFriendlyName,ls:f,sp:g,rmk:p,cv:_},id:b}),Mt.bCallInitLicense=!0,yield C}))});return function(){return u.apply(this,arguments)}}();let dD;fn.license={},fn.license.dynamsoft=hD,fn.license.getAR=ae(function*(){{let u=wi.dynamsoft_inited;u&&u.isRejected&&(yield u)}return ct?new Promise((u,a)=>{let l=Dt();vt[l]=function(){var f=ae(function*(g){if(g.success){delete g.success;{let p=Mt.license;p&&(p.startsWith("t")||p.startsWith("f"))&&(g.pk=p)}if(Object.keys(g).length){if(g.lem){let p=Error(g.lem);p.ltsErrorCode=g.lec,delete g.lem,delete g.lec,g.ae=p}u(g)}else u(null)}else{let p=Error(g.message);g.stack&&(p.stack=g.stack),a(p)}});return function(g){return f.apply(this,arguments)}}(),ct.postMessage({type:"getAR",id:l})}):null});class Mt{static setLicenseServer(a){cD(Mt,a)}static get license(){return this._license}static set license(a){aD(Mt,a)}static get licenseServer(){return this._licenseServer}static set licenseServer(a){cD(Mt,a)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(a){uD(Mt,a)}static initLicense(a,l){if(aD(Mt,a),Mt.bCallInitLicense=!0,l)return hD()}static setDeviceFriendlyName(a){uD(Mt,a)}static getDeviceFriendlyName(){return Mt._deviceFriendlyName}static getDeviceUUID(){return ae(function*(){return yield mh("dynamsoft_uuid",ae(function*(){yield sr();let a=new $p,l=Dt();vt[l]=f=>{if(f.success)a.resolve(f.uuid);else{const g=Error(f.message);f.stack&&(g.stack=f.stack),a.reject(g)}},ct.postMessage({type:"getDeviceUUID",id:l}),dD=yield a})),dD})()}}Mt._pLoad=new $p,Mt.bPassValidation=!1,Mt.bCallInitLicense=!1,Mt._license=a2,Mt._licenseServer=[],Mt._deviceFriendlyName="",null==Ze.license&&(Ze.license=rD),cs.license={wasm:!0},fn.license.LicenseManager=Mt;const qp="1.2.10";"string"!=typeof Ze.std&&zs(Ze.std.version,qp)<0&&(Ze.std={version:qp,path:sD(rD+`../../dynamsoft-capture-vision-std@${qp}/dist/`)});const fD=u=>u&&"object"==typeof u&&"function"==typeof u.then;class ra extends Promise{constructor(a){let l,f;super((g,p)=>{l=g,f=p}),this._s="pending",this.resolve=g=>{this.isPending&&(fD(g)?this.task=g:(this._s="fulfilled",l(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=a}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(a){var l=this;let f;this._task=a,fD(a)?f=a:"function"==typeof a&&(f=new Promise(a)),f&&ae(function*(){try{const g=yield f;a===l._task&&l.resolve(g)}catch(g){a===l._task&&l.reject(g)}})()}get isEmpty(){return null==this._task}}class l2{constructor(a){this._cvr=a}getMaxBufferedItems(){var a=this;return ae(function*(){return yield new Promise((l,f)=>{let g=Dt();vt[g]=function(){var p=ae(function*(_){if(_.success)return l(_.count);{let C=new Error(_.message);return C.stack=_.stack+"\n"+C.stack,f(C)}});return function(_){return p.apply(this,arguments)}}(),ct.postMessage({type:"cvr_getMaxBufferedItems",id:g,instanceID:a._cvr._instanceID})})})()}setMaxBufferedItems(a){var l=this;return ae(function*(){return yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f();{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_setMaxBufferedItems",id:p,instanceID:l._cvr._instanceID,body:{count:a}})})})()}getBufferedCharacterItemSet(){var a=this;return ae(function*(){return yield new Promise((l,f)=>{let g=Dt();vt[g]=function(){var p=ae(function*(_){if(_.success)return l(_.itemSet);{let C=new Error(_.message);return C.stack=_.stack+"\n"+C.stack,f(C)}});return function(_){return p.apply(this,arguments)}}(),ct.postMessage({type:"cvr_getBufferedCharacterItemSet",id:g,instanceID:a._cvr._instanceID})})})()}}var c2={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const gD=(u,a)=>{for(let l in a._irrRegistryState)a._irrRegistryState[l]=!1;for(let l of u._intermediateResultReceiverSet)if(l.isDce)a._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let f in l)a._irrRegistryState[f]||(a._irrRegistryState[f]=!!l[f])};class u2{constructor(a){this._irrRegistryState=c2,this._cvr=a}addResultReceiver(a){var l=this;return ae(function*(){if("object"!=typeof a)throw new Error("Invalid receiver.");l._cvr._intermediateResultReceiverSet.add(a),gD(l._cvr,l);let f=-1,g={};if(!a.isDce){if(!a._observedResultUnitTypes||!a._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");f=a._observedResultUnitTypes,a._observedTaskMap.forEach((p,_)=>{g[_]=p}),a._observedTaskMap.clear()}return yield new Promise((p,_)=>{let C=Dt();vt[C]=function(){var b=ae(function*(O){if(O.success)return p();{let M=new Error(O.message);return M.stack=O.stack+"\n"+M.stack,_(M)}});return function(O){return b.apply(this,arguments)}}(),ct.postMessage({type:"cvr_setIrrRegistry",id:C,instanceID:l._cvr._instanceID,body:{receiverObj:l._irrRegistryState,observedResultUnitTypes:String(f),observedTaskMap:g}})})})()}removeResultReceiver(a){var l=this;return ae(function*(){return l._cvr._intermediateResultReceiverSet.delete(a),gD(l._cvr,l),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f();{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_setIrrRegistry",id:p,instanceID:l._cvr._instanceID,body:{receiverObj:l._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const pD="undefined"==typeof self,Zp=(()=>{if(!pD&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})(),mD=u=>{if(null==u&&(u="./"),!pD){let a=document.createElement("a");a.href=u,u=a.href}return u.endsWith("/")||(u+="/"),u};var Kp;null==Ze.cvr&&(Ze.cvr=Zp),cs.cvr={js:!0,wasm:!0,deps:["license","dip"]},fn.cvr={};const Qp="1.2.10";"string"!=typeof Ze.std&&zs(Ze.std.version,Qp)<0&&(Ze.std={version:Qp,path:mD(Zp+`../../dynamsoft-capture-vision-std@${Qp}/dist/`)});const Jp="2.2.30";(!Ze.dip||"string"!=typeof Ze.dip&&zs(Ze.dip.version,Jp)<0)&&(Ze.dip={version:Jp,path:mD(Zp+`../../dynamsoft-image-processing@${Jp}/dist/`)});class _D{static getVersion(){return this._version}}var Ch,vD;function yD(u,a){if(u&&u.location){const l=u.location.points;for(let f of l)f.x=f.x/a,f.y=f.y/a;yD(u.referencedItem,a)}}_D._version=`2.2.30(Worker: ${null===(Kp=Xs.cvr)||void 0===Kp?void 0:Kp.worker}, Wasm: loading...`,function(u){u[u.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",u[u.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Ch||(Ch={})),function(u){u[u.IRUT_NULL=0]="IRUT_NULL",u[u.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",u[u.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",u[u.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",u[u.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",u[u.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",u[u.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",u[u.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",u[u.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",u[u.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",u[u.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",u[u.IRUT_CONTOURS=1024]="IRUT_CONTOURS",u[u.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",u[u.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",u[u.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",u[u.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",u[u.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",u[u.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",u[u.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",u[u.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",u[u.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",u[u.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",u[u.IRUT_CORNERS=2097152]="IRUT_CORNERS",u[u.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",u[u.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",u[u.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",u[u.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",u[u.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",u[u.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",u[u.IRUT_ALL=134217727]="IRUT_ALL"}(vD||(vD={}));class Ct{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes($t.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return ae(function*(){if(!fn.license)throw Error("Module `license` is not existed.");yield fn.license.dynamsoft(),yield sr(["cvr"]);const a=new Ct,l=new ra;let f=Dt();return vt[f]=function(){var g=ae(function*(p){var _;if(p.success)a._instanceID=p.instanceID,a._currentSettings=JSON.parse(p.outputSettings),_D._version=`2.2.30(Worker: ${null===(_=Xs.cvr)||void 0===_?void 0:_.worker}, Wasm: ${p.version})`,0===$t.bSupportDce4Module&&(a._intermediateResultManager=a.getIntermediateResultManager(!0)),l.resolve(a);else{const C=Error(p.message);p.stack&&(C.stack=p.stack),l.reject(C)}});return function(p){return g.apply(this,arguments)}}(),ct.postMessage({type:"cvr_createInstance",id:f}),l})()}_singleFrameModeCallback(a){var l=this;return ae(function*(){l._isa.getCameraView().setScanLaserVisible(!0);for(let _ of l._resultReceiverSet)l._bNeedOutputOriginalImage&&_.onOriginalImageResultReceived&&_.onOriginalImageResultReceived({imageData:a});const f={bytes:new Uint8Array(a.bytes),width:a.width,height:a.height,stride:a.stride,format:a.format,tag:a.tag};l._templateName||(l._templateName=l._currentSettings.CaptureVisionTemplates[0].Name);const g=yield l.capture(f,l._templateName);g.originalImageTag=a.tag;for(let _ of l._resultReceiverSet)_.isDce&&_.onCapturedResultReceived(g,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const p={originalImageHashId:g.originalImageHashId,originalImageTag:g.originalImageTag,errorCode:g.errorCode,errorString:g.errorString};for(let _ of l._resultReceiverSet)if(_.onDecodedBarcodesReceived&&g.barcodeResultItems&&_.onDecodedBarcodesReceived(Object.assign(Object.assign({},p),{barcodeResultItems:g.barcodeResultItems})),_.onRecognizedTextLinesReceived&&g.textLineResultItems&&_.onRecognizedTextLinesReceived(Object.assign(Object.assign({},p),{textLineResultItems:g.textLineResultItems})),_.onDetectedQuadsReceived&&g.detectedQuadResultItems&&_.onDetectedQuadsReceived(Object.assign(Object.assign({},p),{detectedQuadResultItems:g.detectedQuadResultItems})),_.onNormalizedImagesReceived&&g.normalizedImageResultItems&&_.onNormalizedImagesReceived(Object.assign(Object.assign({},p),{normalizedImageResultItems:g.normalizedImageResultItems})),_.onParsedResultsReceived&&g.parsedResultItems&&_.onParsedResultsReceived(Object.assign(Object.assign({},p),{parsedResultItems:g.parsedResultItems})),_.onCapturedResultReceived&&!_.isDce){if(l._bNeedOutputOriginalImage){const C=g.items.findIndex(b=>1===b.type);-1!==C&&(g.items[C].imageData=a)}_.onCapturedResultReceived(g)}})()}setInput(a){if(this._checkIsDisposed(),a){if(this._isa=a,a.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const l=this._isa.getCameraView();if(l){const f=l._capturedResultReceiver;f.isDce=!0,this._resultReceiverSet.add(f)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(a){if(this._checkIsDisposed(),"object"!=typeof a)return console.warn("Invalid ISA state listener.");a&&Object.keys(a)&&this._isaStateListenerSet.add(a)}removeImageSourceStateListener(a){return this._checkIsDisposed(),this._isaStateListenerSet.delete(a)}addResultReceiver(a){if(this._checkIsDisposed(),"object"!=typeof a)throw new Error("Invalid receiver.");a&&Object.keys(a).length&&(this._resultReceiverSet.add(a),this._setCrrRegistry())}removeResultReceiver(a){this._checkIsDisposed(),this._resultReceiverSet.delete(a),this._setCrrRegistry()}_setCrrRegistry(){var a=this;return ae(function*(){const l={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let p of a._resultReceiverSet)p.isDce||(l.onCapturedResultReceived=!!p.onCapturedResultReceived,l.onDecodedBarcodesReceived=!!p.onDecodedBarcodesReceived,l.onRecognizedTextLinesReceived=!!p.onRecognizedTextLinesReceived,l.onDetectedQuadsReceived=!!p.onDetectedQuadsReceived,l.onNormalizedImagesReceived=!!p.onNormalizedImagesReceived,l.onParsedResultsReceived=!!p.onParsedResultsReceived);const f=new ra;let g=Dt();return vt[g]=function(){var p=ae(function*(_){if(_.success)f.resolve();else{let C=new Error(_.message);C.stack=_.stack+"\n"+C.stack,f.reject()}});return function(_){return p.apply(this,arguments)}}(),ct.postMessage({type:"cvr_setCrrRegistry",id:g,instanceID:a._instanceID,body:{receiver:JSON.stringify(l)}}),f})()}addResultFilter(a){var l=this;return ae(function*(){if(l._checkIsDisposed(),"object"!=typeof a)return console.warn("Invalid filter.");if(a&&Object.keys(a)){l._resultFilterSet.add(a),l._handleFilterSwitch();for(let f of l._resultFilterSet)yield l._enableResultCrossVerification(f.verificationEnabled),yield l._enableResultDeduplication(f.duplicateFilterEnabled),yield l._setDuplicateForgetTime(f.duplicateForgetTime)}})()}removeResultFilter(a){var l=this;return ae(function*(){l._checkIsDisposed(),l._resultFilterSet.delete(a),l._handleFilterSwitch();for(let f of l._resultFilterSet)yield l._enableResultCrossVerification(f.verificationEnabled),yield l._enableResultDeduplication(f.duplicateFilterEnabled),yield l._setDuplicateForgetTime(f.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let a of this._resultFilterSet)a.isResultCrossVerificationEnabled(Xt.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),a.isResultCrossVerificationEnabled(Xt.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),a.isResultCrossVerificationEnabled(Xt.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),a.isResultCrossVerificationEnabled(Xt.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(a){var l=this;return ae(function*(){var f,g;if(l._checkIsDisposed(),!l._bPauseScan)return;if(!l._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");a||(a=l._currentSettings.CaptureVisionTemplates[0].Name);const p=yield l.containsTask(a);return yield sr(p),p.includes("dlr")&&!(null===(f=fn.dlr)||void 0===f?void 0:f.bLoadConfusableCharsData)&&(yield null===(g=fn.dlr)||void 0===g?void 0:g.loadRecognitionData("ConfusableChars",Ze.dlr)),l._isa.isCameraEnhancer&&(p.includes("ddn")?l._isa.setPixelFormat(je.IPF_ABGR_8888):l._isa.setPixelFormat(je.IPF_GRAYSCALED)),void 0!==l._isa.singleFrameMode&&"disabled"!==l._isa.singleFrameMode?(l._templateName=a,void l._isa.on("singleFrameAcquired",l._singleFrameModeCallbackBind)):(l._isa.getColourChannelUsageType()===rr.CCUT_AUTO&&l._isa.setColourChannelUsageType(p.includes("ddn")?rr.CCUT_FULL_CHANNEL:rr.CCUT_Y_CHANNEL_ONLY),l._promiseStartScan&&l._promiseStartScan.isPending?l._promiseStartScan:(l._promiseStartScan=new ra((_,C)=>{if(l.disposed)return;let b=Dt();vt[b]=function(){var O=ae(function*(M){if(l._promiseStartScan&&!l._promiseStartScan.isFulfilled){if(!M.success){let P=new Error(M.message);return P.stack=M.stack+"\n"+P.stack,C(P)}for(let P of l._resultFilterSet)yield l.addResultFilter(P);l._bPauseScan=!1,l._bNeedOutputOriginalImage=M.bNeedOutputOriginalImage,l._loopReadVideoTimeoutId&&clearTimeout(l._loopReadVideoTimeoutId),l._loopReadVideoTimeoutId=setTimeout(ae(function*(){-1!==l._minImageCaptureInterval&&l._isa.startFetching(),l._loopReadVideo(a),_()}),0),l._isa.isCameraEnhancer&&l._isa.getCameraView().setScanLaserVisible(!0)}});return function(M){return O.apply(this,arguments)}}(),ct.postMessage({type:"cvr_startCapturing",id:b,instanceID:l._instanceID,body:{templateName:a}})}),yield l._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(rr.CCUT_AUTO)))}_clearVerifyList(){var a=this;return ae(function*(){let l=Dt();const f=new ra;return vt[l]=function(){var g=ae(function*(p){if(p.success)return f.resolve();{let _=new Error(p.message);return _.stack=p.stack+"\n"+_.stack,f.reject(_)}});return function(p){return g.apply(this,arguments)}}(),ct.postMessage({type:"cvr_clearVerifyList",id:l,instanceID:a._instanceID}),f})()}_getIntermediateResult(){var a=this;return ae(function*(){a._checkIsDisposed();let l=Dt();const f=new ra;return vt[l]=function(){var g=ae(function*(p){if(p.success)f.resolve(p.result);else{let _=new Error(p.message);_.stack=p.stack+"\n"+_.stack,f.reject(_)}});return function(p){return g.apply(this,arguments)}}(),ct.postMessage({type:"cvr_getIntermediateResult",id:l,instanceID:a._instanceID}),f})()}containsTask(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(JSON.parse(C.tasks));{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_containsTask",id:p,instanceID:l._instanceID,body:{templateName:a}})})})()}_loopReadVideo(a){var l=this;return ae(function*(){if(l._dynamsoft=!0,l.disposed||l._bPauseScan)return;if(l._isa.isBufferEmpty())if(l._isa.hasNextImageToFetch())for(let g of l._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(Ch.ISS_BUFFER_EMPTY);else if(!l._isa.hasNextImageToFetch())for(let g of l._isaStateListenerSet)g.onImageSourceStateReceived&&g.onImageSourceStateReceived(Ch.ISS_EXHAUSTED);if(-1===l._minImageCaptureInterval||l._isa.isBufferEmpty())try{l._isa.isBufferEmpty()&&Ct._onLog&&Ct._onLog("buffer is empty so fetch image"),Ct._onLog&&Ct._onLog(`DCE: start fetching a frame: ${Date.now()}`),l._dsImage=l._isa.fetchImage(),Ct._onLog&&Ct._onLog(`DCE: finish fetching a frame: ${Date.now()}`),l._isa.setImageFetchInterval(l._averageTime)}catch(g){return void l._reRunCurrnetFunc(a)}else if(l._isa.setImageFetchInterval(l._averageTime-(l._dsImage&&l._dsImage.tag?l._dsImage.tag.timeSpent:0)),l._dsImage=l._isa.getImage(),l._dsImage.tag&&Date.now()-l._dsImage.tag.timeStamp>200)return void l._reRunCurrnetFunc(a);if(!l._dsImage)return void l._reRunCurrnetFunc(a);for(let g of l._resultReceiverSet)l._bNeedOutputOriginalImage&&g.onOriginalImageResultReceived&&g.onOriginalImageResultReceived({imageData:l._dsImage});const f=Date.now();l._captureDsimage(l._dsImage,a).then(function(){var g=ae(function*(p){if(Ct._onLog&&Ct._onLog("no js handle time: "+(Date.now()-f)),l._bPauseScan)return void l._reRunCurrnetFunc(a);p.originalImageTag=l._dsImage.tag?l._dsImage.tag:null;for(let b of l._resultReceiverSet)if(b.isDce){const O=Date.now();if(b.onCapturedResultReceived(p,{isDetectVerifyOpen:l._bOpenDetectVerify,isNormalizeVerifyOpen:l._bOpenNormalizeVerify,isBarcodeVerifyOpen:l._bOpenBarcodeVerify,isLabelVerifyOpen:l._bOpenLabelVerify}),Ct._onLog){const M=Date.now()-O;M>10&&Ct._onLog(`draw result time: ${M}`)}}const _={originalImageHashId:p.originalImageHashId,originalImageTag:p.originalImageTag,errorCode:p.errorCode,errorString:p.errorString};for(let b of l._resultReceiverSet)b.onDecodedBarcodesReceived&&p.barcodeResultItems&&b.onDecodedBarcodesReceived(Object.assign(Object.assign({},_),{barcodeResultItems:p.barcodeResultItems.filter(O=>!O.isFilter)})),b.onRecognizedTextLinesReceived&&p.textLineResultItems&&b.onRecognizedTextLinesReceived(Object.assign(Object.assign({},_),{textLineResultItems:p.textLineResultItems.filter(O=>!O.isFilter)})),b.onDetectedQuadsReceived&&p.detectedQuadResultItems&&b.onDetectedQuadsReceived(Object.assign(Object.assign({},_),{detectedQuadResultItems:p.detectedQuadResultItems.filter(O=>!O.isFilter)})),b.onNormalizedImagesReceived&&p.normalizedImageResultItems&&b.onNormalizedImagesReceived(Object.assign(Object.assign({},_),{normalizedImageResultItems:p.normalizedImageResultItems.filter(O=>!O.isFilter)})),b.onParsedResultsReceived&&p.parsedResultItems&&b.onParsedResultsReceived(Object.assign(Object.assign({},_),{parsedResultItems:p.parsedResultItems.filter(O=>!O.isFilter)})),b.onCapturedResultReceived&&!b.isDce&&(p.items=p.items.filter(O=>!O.isFilter),p.barcodeResultItems&&(p.barcodeResultItems=p.barcodeResultItems.filter(O=>!O.isFilter)),p.textLineResultItems&&(p.textLineResultItems=p.textLineResultItems.filter(O=>!O.isFilter)),p.detectedQuadResultItems&&(p.detectedQuadResultItems=p.detectedQuadResultItems.filter(O=>!O.isFilter)),p.normalizedImageResultItems&&(p.normalizedImageResultItems=p.normalizedImageResultItems.filter(O=>!O.isFilter)),p.parsedResultItems&&(p.parsedResultItems=p.parsedResultItems.filter(O=>!O.isFilter)),b.onCapturedResultReceived(p));const C=Date.now();if(l._minImageCaptureInterval>-1&&(5===l._averageProcessintTimeArray.length&&l._averageProcessintTimeArray.shift(),5===l._averageFetchImageTimeArray.length&&l._averageFetchImageTimeArray.shift(),l._averageProcessintTimeArray.push(Date.now()-f),l._averageFetchImageTimeArray.push(l._dsImage&&l._dsImage.tag?l._dsImage.tag.timeSpent:0),l._averageTime=Math.min(...l._averageProcessintTimeArray)-Math.max(...l._averageFetchImageTimeArray),l._averageTime=l._averageTime>0?l._averageTime:0,Ct._onLog&&(Ct._onLog(`minImageCaptureInterval: ${l._minImageCaptureInterval}`),Ct._onLog(`averageProcessintTimeArray: ${l._averageProcessintTimeArray}`),Ct._onLog(`averageFetchImageTimeArray: ${l._averageFetchImageTimeArray}`),Ct._onLog(`averageTime: ${l._averageTime}`))),Ct._onLog){const b=Date.now()-C;b>10&&Ct._onLog(`fetch image calculate time: ${b}`)}Ct._onLog&&Ct._onLog(`time finish decode: ${Date.now()}`),Ct._onLog&&Ct._onLog("main time: "+(Date.now()-f)),Ct._onLog&&Ct._onLog("===================================================="),l._loopReadVideoTimeoutId&&clearTimeout(l._loopReadVideoTimeoutId),l._loopReadVideoTimeoutId=l._minImageCaptureInterval>0&&l._minImageCaptureInterval>=l._averageTime?setTimeout(()=>{l._loopReadVideo(a)},l._minImageCaptureInterval-l._averageTime):setTimeout(()=>{l._loopReadVideo(a)},Math.max(l._minImageCaptureInterval,0))});return function(p){return g.apply(this,arguments)}}()).catch(g=>{l._isa.stopFetching(),l._loopReadVideoTimeoutId&&clearTimeout(l._loopReadVideoTimeoutId),l._loopReadVideoTimeoutId=setTimeout(()=>{l._isa.startFetching(),l._loopReadVideo(a)},Math.max(l._minImageCaptureInterval,1e3)),"platform error"!==g.message&&setTimeout(()=>{throw g},0)})})()}_reRunCurrnetFunc(a){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(a)},0)}capture(a,l){var f=this;return ae(function*(){var g,p;f._checkIsDisposed(),l||(l=f._currentSettings.CaptureVisionTemplates[0].Name);const _=yield f.containsTask(l);let C;if(yield sr(_),_.includes("dlr")&&!(null===(g=fn.dlr)||void 0===g?void 0:g.bLoadConfusableCharsData)&&(yield null===(p=fn.dlr)||void 0===p?void 0:p.loadRecognitionData("ConfusableChars",Ze.dlr)),f._dynamsoft=!1,Hb(a))C=yield f._captureDsimage(a,l);else if("string"==typeof a)C="data:image/"==a.substring(0,11)?yield f._captureBase64(a,l):yield f._captureUrl(a,l);else if(a instanceof Blob)C=yield f._captureBlob(a,l);else if(a instanceof HTMLImageElement)C=yield f._captureImage(a,l);else if(a instanceof HTMLCanvasElement)C=yield f._captureCanvas(a,l);else{if(!(a instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");C=yield f._captureVideo(a,l)}return C})()}_captureDsimage(a,l){var f=this;return ae(function*(){return yield f._captureInWorker(a,l)})()}_captureUrl(a,l){var f=this;return ae(function*(){let g=yield Gb(a,"blob");return yield f._captureBlob(g,l)})()}_captureBase64(a,l){var f=this;return ae(function*(){a=a.substring(a.indexOf(",")+1);let g=atob(a),p=g.length,_=new Uint8Array(p);for(;p--;)_[p]=g.charCodeAt(p);return yield f._captureBlob(new Blob([_]),l)})()}_captureBlob(a,l){var f=this;return ae(function*(){let g=null,p=null;if("undefined"!=typeof createImageBitmap)try{g=yield createImageBitmap(a)}catch(C){}var C;g||(p=yield(C=ae(function*(b){return yield new Promise((O,M)=>{let P=URL.createObjectURL(b),k=new Image;k.src=P,k.onload=()=>{URL.revokeObjectURL(k.dbrObjUrl),O(k)},k.onerror=j=>{M(new Error("Can't convert blob to image : "+(j instanceof Event?j.type:j)))}})}),function(b){return C.apply(this,arguments)})(a));let _=yield f._captureImage(g||p,l);return g&&g.close(),_})()}_captureImage(a,l){var f=this;return ae(function*(){let g,p,_=a instanceof HTMLImageElement?a.naturalWidth:a.width,C=a instanceof HTMLImageElement?a.naturalHeight:a.height,b=Math.max(_,C);b>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/b,g=Math.round(_*f._compressRate),p=Math.round(C*f._compressRate)):(g=_,p=C),f._canvas||(f._canvas=document.createElement("canvas"));const O=f._canvas;return O.width===g&&O.height===p||(O.width=g,O.height=p),O.ctx2d||(O.ctx2d=O.getContext("2d",{willReadFrequently:!0})),O.ctx2d.drawImage(a,0,0,_,C,0,0,g,p),a.dbrObjUrl&&URL.revokeObjectURL(a.dbrObjUrl),yield f._captureCanvas(O,l)})()}_captureCanvas(a,l){var f=this;return ae(function*(){if(a.crossOrigin&&"anonymous"!=a.crossOrigin)throw"cors";if([a.width,a.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const g=a.ctx2d||a.getContext("2d",{willReadFrequently:!0}),p={bytes:Uint8Array.from(g.getImageData(0,0,a.width,a.height).data),width:a.width,height:a.height,stride:4*a.width,format:10};return yield f._captureInWorker(p,l)})()}_captureVideo(a,l){var f=this;return ae(function*(){if(a.crossOrigin&&"anonymous"!=a.crossOrigin)throw"cors";let g,p,_=a.videoWidth,C=a.videoHeight,b=Math.max(_,C);b>f.maxCvsSideLength?(f._compressRate=f.maxCvsSideLength/b,g=Math.round(_*f._compressRate),p=Math.round(C*f._compressRate)):(g=_,p=C),f._canvas||(f._canvas=document.createElement("canvas"));const O=f._canvas;return O.width===g&&O.height===p||(O.width=g,O.height=p),O.ctx2d||(O.ctx2d=O.getContext("2d",{willReadFrequently:!0})),O.ctx2d.drawImage(a,0,0,_,C,0,0,g,p),yield f._captureCanvas(O,l)})()}_captureInWorker(a,l){var f=this;return ae(function*(){const{bytes:g,width:p,height:_,stride:C,format:b}=a;let O=Dt();const M=new ra;return vt[O]=function(){var P=ae(function*(k){var j,G;if(!k.success){let z=new Error(k.message);return z.stack=k.stack+"\n"+z.stack,M.reject(z)}{const z=Date.now();Ct._onLog&&(Ct._onLog(`get result time from worker: ${z}`),Ct._onLog("worker to main time consume: "+(z-k.workerReturnMsgTime)));try{const Y=k.captureResult;a.bytes=k.bytes;for(let $ of Y.items)0!==f._compressRate&&yD($,f._compressRate),$.type===Xt.CRIT_ORIGINAL_IMAGE?$.imageData=a:$.type===Xt.CRIT_NORMALIZED_IMAGE?null===(j=fn.ddn)||void 0===j||j.handleNormalizedImageResultItem($):$.type===Xt.CRIT_PARSED_RESULT&&(null===(G=fn.dcp)||void 0===G||G.handleParsedResultItem($));if(f._dynamsoft)for(let $ of f._resultFilterSet)$.onDecodedBarcodesReceived(Y.items),$.onRecognizedTextLinesReceived(Y.items),$.onDetectedQuadsReceived(Y.items),$.onNormalizedImagesReceived(Y.items);const X=function($){const K={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return $.items.forEach(ge=>{ge.type===Xt.CRIT_BARCODE?K.barcodeResultItems.push(ge):ge.type===Xt.CRIT_TEXT_LINE?K.textLineResultItems.push(ge):ge.type===Xt.CRIT_DETECTED_QUAD?K.detectedQuadResultItems.push(ge):ge.type===Xt.CRIT_NORMALIZED_IMAGE?K.normalizedImageResultItems.push(ge):ge.type===Xt.CRIT_PARSED_RESULT&&K.parsedResultItems.push(ge)}),K}(Y);if(X.barcodeResultItems.length&&(Y.barcodeResultItems=X.barcodeResultItems),X.textLineResultItems.length&&(Y.textLineResultItems=X.textLineResultItems),X.detectedQuadResultItems.length&&(Y.detectedQuadResultItems=X.detectedQuadResultItems),X.normalizedImageResultItems.length&&(Y.normalizedImageResultItems=X.normalizedImageResultItems),X.parsedResultItems.length&&(Y.parsedResultItems=X.parsedResultItems),!f._bPauseScan||!f._dynamsoft){const $=Y.intermediateResult;if($){let K=0;for(let ge of f._intermediateResultReceiverSet){K++;for(let _e of $){if("onTaskResultsReceived"===_e.info.callbackName){for(let Te of _e.intermediateResultUnits)Te.originalImageTag=a.tag?a.tag:null;ge[_e.info.callbackName]&&ge[_e.info.callbackName]({intermediateResultUnits:_e.intermediateResultUnits},_e.info)}else ge[_e.info.callbackName]&&ge[_e.info.callbackName](_e.result,_e.info);K===f._intermediateResultReceiverSet.size&&delete _e.info.callbackName}}}Y&&Y.intermediateResult&&delete Y.intermediateResult}return f._compressRate=0,M.resolve(Y)}catch(Y){return M.reject(Y)}}});return function(k){return P.apply(this,arguments)}}(),Ct._onLog&&Ct._onLog(`send buffer to worker: ${Date.now()}`),ct.postMessage({type:"cvr_capture",id:O,instanceID:f._instanceID,body:{bytes:g,width:p,height:_,stride:C,format:b,templateName:l||"",dynamsoft:f._dynamsoft}},[g.buffer]),M})()}initSettings(a){var l=this;return ae(function*(){return l._checkIsDisposed(),a&&["string","object"].includes(typeof a)?("string"==typeof a?a.startsWith("{")?l._currentSettings=JSON.parse(a):a=yield Gb(a,"text"):"object"==typeof a&&(l._currentSettings=a,a=JSON.stringify(a)),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success){const b=JSON.parse(C.response);if(0!==b.exception){let P=new Error(b.description?b.description:"Init Settings Failed.");return P.errorCode=b.exception,g(P)}let O=[],M=JSON.parse(a).CaptureVisionTemplates;for(let P=0;P<M.length;P++){let k=yield l.containsTask(M[P].Name);O=O.concat(k)}return yield sr([...new Set(O)]),l._bNeedOutputOriginalImage=1===l._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,f(b)}{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_initSettings",id:p,instanceID:l._instanceID,body:{settings:a}})})):console.error("Invalid template.")})()}outputSettings(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success){const b=JSON.parse(C.settings);if(0!==b.errorCode){let O=new Error(b.errorString);return O.errorCode=b.errorCode,g(O)}return delete b.errorCode,delete b.errorString,f(b)}{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_outputSettings",id:p,instanceID:l._instanceID,body:{templateName:a||"*"}})})})()}outputSettingsToFile(a,l,f){var g=this;return ae(function*(){const p=yield g.outputSettings(a),_=new Blob([JSON.stringify(p,null,2,function(C,b){return b instanceof Array?JSON.stringify(b):b},2)],{type:"application/json"});if(f){const C=document.createElement("a");C.href=URL.createObjectURL(_),l.endsWith(".json")&&(l=l.replace(".json","")),C.download=`${l}.json`,C.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(C.href)},500)},C.click()}return _})()}getSimplifiedSettings(a){var l=this;return ae(function*(){l._checkIsDisposed(),a||(a=l._currentSettings.CaptureVisionTemplates[0].Name);const f=yield l.containsTask(a);return yield sr(f),yield new Promise((g,p)=>{let _=Dt();vt[_]=function(){var C=ae(function*(b){if(b.success){const O=JSON.parse(b.settings,(M,P)=>t2&&"barcodeFormatIds"===M?BigInt(P):P);if(O.minImageCaptureInterval=l._minImageCaptureInterval,0!==O.code){let M=new Error(O.codeString);return M.errorCode=O.errorCode,p(M)}return delete O.code,delete O.codeString,g(O)}{let O=new Error(b.message);return O.stack=b.stack+"\n"+O.stack,p(O)}});return function(b){return C.apply(this,arguments)}}(),ct.postMessage({type:"cvr_getSimplifiedSettings",id:_,instanceID:l._instanceID,body:{templateName:a}})})})()}updateSettings(a,l){var f=this;return ae(function*(){f._checkIsDisposed();const g=yield f.containsTask(a);return yield sr(g),yield new Promise((p,_)=>{let C=Dt();vt[C]=function(){var b=ae(function*(O){if(O.success){const M=JSON.parse(O.response);if(l.minImageCaptureInterval&&l.minImageCaptureInterval>=-1&&(f._minImageCaptureInterval=l.minImageCaptureInterval),f._bNeedOutputOriginalImage=O.bNeedOutputOriginalImage,0!==M.exception){let P=new Error(M.description?M.description:"Update Settings Failed.");return P.errorCode=M.exception,_(P)}return f._currentSettings=yield f.outputSettings("*"),p(M)}{let M=new Error(O.message);return M.stack=O.stack+"\n"+M.stack,_(M)}});return function(O){return b.apply(this,arguments)}}(),ct.postMessage({type:"cvr_updateSettings",id:C,instanceID:f._instanceID,body:{settings:l,templateName:a}})})})()}resetSettings(){var a=this;return ae(function*(){return a._checkIsDisposed(),yield new Promise((l,f)=>{let g=Dt();vt[g]=function(){var p=ae(function*(_){if(_.success){const C=JSON.parse(_.response);if(0!==C.exception){let b=new Error(C.description?C.description:"Reset Settings Failed.");return b.errorCode=C.exception,f(b)}return a._currentSettings=yield a.outputSettings("*"),l(C)}{let C=new Error(_.message);return C.stack=_.stack+"\n"+C.stack,f(C)}});return function(_){return p.apply(this,arguments)}}(),ct.postMessage({type:"cvr_resetSettings",id:g,instanceID:a._instanceID})})})()}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new l2(this)),this._bufferdItemsManager}getIntermediateResultManager(a){if(this._checkIsDisposed(),!a&&0!==$t.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new u2(this)),this._intermediateResultManager}contains(a,l){return function(f,g){let p=g.x,_=g.y,C=f[0].x,b=f[0].y,O=f[1].x,M=f[1].y,P=f[2].x,k=f[2].y,j=f[3].x,G=f[3].y,z=K(p,_,C,b,O,M),Y=K(p,_,O,M,P,k),X=K(p,_,P,k,j,G),$=K(p,_,j,G,C,b);function K(ge,_e,Te,Se,F,Ce){return(ge-Te)*(Ce-Se)-(_e-Se)*(F-Te)}return z>=0&&Y>=0&&X>=0&&$>=0||z<=0&&Y<=0&&X<=0&&$<=0}(a,l)}parseRequiredResources(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(JSON.parse(C.resources));{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_parseRequiredResources",id:p,instanceID:l._instanceID,body:{templateName:a}})})})()}dispose(){var a=this;return ae(function*(){a._checkIsDisposed(),a._promiseStartScan&&a.stopCapturing(),a._isa=null,a._resultReceiverSet.clear(),a._isaStateListenerSet.clear(),a._resultFilterSet.clear(),a.bDestroyed=!0;let l=Dt();vt[l]=f=>{if(!f.success){let g=new Error(f.message);throw g.stack=f.stack+"\n"+g.stack,g}},ct.postMessage({type:"cvr_dispose",id:l,instanceID:a._instanceID})})()}_enableResultCrossVerification(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(C.result);{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_enableResultCrossVerification",id:p,instanceID:l._instanceID,body:{verificationEnabled:a}})})})()}_enableResultDeduplication(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(C.result);{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_enableResultDeduplication",id:p,instanceID:l._instanceID,body:{duplicateFilterEnabled:a}})})})()}_setDuplicateForgetTime(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(C.result);{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_setDuplicateForgetTime",id:p,instanceID:l._instanceID,body:{duplicateForgetTime:a}})})})()}_getDuplicateForgetTime(a){var l=this;return ae(function*(){return l._checkIsDisposed(),yield new Promise((f,g)=>{let p=Dt();vt[p]=function(){var _=ae(function*(C){if(C.success)return f(C.time);{let b=new Error(C.message);return b.stack=C.stack+"\n"+b.stack,g(b)}});return function(C){return _.apply(this,arguments)}}(),ct.postMessage({type:"cvr_getDuplicateForgetTime",id:p,instanceID:l._instanceID,body:{type:a}})})})()}_setThresholdValue(a,l,f){var g=this;return ae(function*(){return yield sr("ddn"),yield new Promise((p,_)=>{let C=Dt();vt[C]=function(){var b=ae(function*(O){if(O.success)return p();{let M=new Error(O.message);return M.stack=O.stack+"\n"+M.stack,_(M)}});return function(O){return b.apply(this,arguments)}}(),ct.postMessage({type:"ddn_setThresholdValue",id:C,instanceID:g._instanceID,body:{threshold:a,leftLimit:l,rightLimit:f}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}const em="undefined"==typeof self,h2=(()=>{if(!em&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})();function U(u,a,l,f){if("a"===l&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?u!==a||!f:!a.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?f:"a"===l?f.call(u):f?f.value:a.get(u)}function Oe(u,a,l,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?u!==a||!g:!a.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(u,l):g?g.value=l:a.set(u,l),l}let Yl,Sr,wh,Eh,bn;null==Ze.dce&&(Ze.dce=h2),cs.dce={wasm:!1,js:!1},fn.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(Yl=navigator,Sr=Yl.userAgent,wh=Yl.platform,Eh=Yl.mediaDevices),function(){if(!em){const u={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Yl.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},a={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:wh,search:"Win"},Mac:{str:wh},Linux:{str:wh}};let l="unknownBrowser",f=0,g="unknownOS";for(let p in u){const _=u[p]||{};let O=_.verStr||Sr,M=_.verSearch||p;if(M instanceof Array||(M=[M]),-1!=(_.str||Sr).indexOf(_.search||p)){l=p;for(let P of M){let k=O.indexOf(P);if(-1!=k){f=parseFloat(O.substring(k+P.length+1));break}}break}}for(let p in a){const _=a[p]||{};if(-1!=(_.str||Sr).indexOf(_.search||p)){g=p;break}}"Linux"==g&&-1!=Sr.indexOf("Windows NT")&&(g="HarmonyOS"),bn={browser:l,version:f,OS:g}}em&&(bn={browser:"ssr",version:0,OS:"ssr"})}();const d2="undefined"!=typeof WebAssembly&&Sr&&!(/Safari/.test(Sr)&&!/Chrome/.test(Sr)&&/\(.+\s11_2_([2-6]).*\)/.test(Sr)),f2="undefined"!=typeof Worker,CD=!(!Eh||!Eh.getUserMedia),g2=function(){var u=ae(function*(){let a=!1;if(CD)try{(yield Eh.getUserMedia({video:!0})).getTracks().forEach(l=>{l.stop()}),a=!0}catch(l){}return a});return function(){return u.apply(this,arguments)}}();var p2={653:(u,a,l)=>{var f,g,p,_,C,b,O,M,P,k,G,z,Y,X,$,K,ge,_e,Te,Se,D,y,w,I,F=F||{version:"5.2.1"};if(a.fabric=F,"undefined"!=typeof document&&"undefined"!=typeof window)F.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),F.window=window;else{var Ce=new(l(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;F.document=Ce.document,F.jsdomImplForWrapper=l(898).implForWrapper,F.nodeCanvas=l(245).Canvas,F.window=Ce,DOMParser=F.window.DOMParser}function Ne(D,y){var w=D.canvas,I=y.targetCanvas,m=I.getContext("2d");m.translate(0,I.height),m.scale(1,-1),m.drawImage(w,0,w.height-I.height,I.width,I.height,0,0,I.width,I.height)}function Ke(D,y){var w=y.targetCanvas.getContext("2d"),I=y.destinationWidth,m=y.destinationHeight,v=I*m*4,T=new Uint8Array(this.imageBuffer,0,v),A=new Uint8ClampedArray(this.imageBuffer,0,v);D.readPixels(0,0,I,m,D.RGBA,D.UNSIGNED_BYTE,T);var S=new ImageData(A,I,m);w.putImageData(S,0,0)}F.isTouchSupported="ontouchstart"in F.window||"ontouchstart"in F.document||F.window&&F.window.navigator&&F.window.navigator.maxTouchPoints>0,F.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,F.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],F.DPI=96,F.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",F.commaWsp="(?:\\s+,?\\s*|,\\s*)",F.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,F.reNonWord=/[ \n\.,;!\?\-]/,F.fontPaths={},F.iMatrix=[1,0,0,1,0,0],F.svgNS="http://www.w3.org/2000/svg",F.perfLimitSizeTotal=2097152,F.maxCacheSideLimit=4096,F.minCacheSideLimit=256,F.charWidthsCache={},F.textureSize=2048,F.disableStyleCopyPaste=!1,F.enableGLFiltering=!0,F.devicePixelRatio=F.window.devicePixelRatio||F.window.webkitDevicePixelRatio||F.window.mozDevicePixelRatio||1,F.browserShadowBlurConstant=1,F.arcToSegmentsCache={},F.boundsOfCurveCache={},F.cachesBoundsOfCurve=!0,F.forceGLPutImageData=!1,F.initFilterBackend=function(){return F.enableGLFiltering&&F.isWebglSupported&&F.isWebglSupported(F.textureSize)?(console.log("max texture size: "+F.maxTextureSize),new F.WebglFilterBackend({tileSize:F.textureSize})):F.Canvas2dFilterBackend?new F.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=F),function(){function D(w,I){if(this.__eventListeners[w]){var m=this.__eventListeners[w];I?m[m.indexOf(I)]=!1:F.util.array.fill(m,!1)}}function y(w,I){var m=function(){I.apply(this,arguments),this.off(w,m)}.bind(this);this.on(w,m)}F.Observable={fire:function(w,I){if(!this.__eventListeners)return this;var m=this.__eventListeners[w];if(!m)return this;for(var v=0,T=m.length;v<T;v++)m[v]&&m[v].call(this,I||{});return this.__eventListeners[w]=m.filter(function(A){return!1!==A}),this},on:function(w,I){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var m in w)this.on(m,w[m]);else this.__eventListeners[w]||(this.__eventListeners[w]=[]),this.__eventListeners[w].push(I);return this},once:function(w,I){if(1===arguments.length)for(var m in w)y.call(this,m,w[m]);else y.call(this,w,I);return this},off:function(w,I){if(!this.__eventListeners)return this;if(0===arguments.length)for(w in this.__eventListeners)D.call(this,w);else if(1===arguments.length&&"object"==typeof arguments[0])for(var m in w)D.call(this,m,w[m]);else D.call(this,w,I);return this}}}(),F.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var D=0,y=arguments.length;D<y;D++)this._onObjectAdded(arguments[D]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(D,y,w){var I=this._objects;return w?I[y]=D:I.splice(y,0,D),this._onObjectAdded&&this._onObjectAdded(D),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var D,y=this._objects,w=!1,I=0,m=arguments.length;I<m;I++)-1!==(D=y.indexOf(arguments[I]))&&(w=!0,y.splice(D,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[I]));return this.renderOnAddRemove&&w&&this.requestRenderAll(),this},forEachObject:function(D,y){for(var w=this.getObjects(),I=0,m=w.length;I<m;I++)D.call(y,w[I],I,w);return this},getObjects:function(D){return void 0===D?this._objects.concat():this._objects.filter(function(y){return y.type===D})},item:function(D){return this._objects[D]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(D,y){return this._objects.indexOf(D)>-1||!!y&&this._objects.some(function(w){return"function"==typeof w.contains&&w.contains(D,!0)})},complexity:function(){return this._objects.reduce(function(D,y){return D+(y.complexity?y.complexity():0)},0)}},F.CommonMethods={_setOptions:function(D){for(var y in D)this.set(y,D[y])},_initGradient:function(D,y){!D||!D.colorStops||D instanceof F.Gradient||this.set(y,new F.Gradient(D))},_initPattern:function(D,y,w){!D||!D.source||D instanceof F.Pattern?w&&w():this.set(y,new F.Pattern(D,w))},_setObject:function(D){for(var y in D)this._set(y,D[y])},set:function(D,y){return"object"==typeof D?this._setObject(D):this._set(D,y),this},_set:function(D,y){this[D]=y},toggle:function(D){var y=this.get(D);return"boolean"==typeof y&&this.set(D,!y),this},get:function(D){return this[D]}},f=a,g=Math.sqrt,p=Math.atan2,_=Math.pow,C=Math.PI/180,b=Math.PI/2,F.util={cos:function(D){if(0===D)return 1;switch(D<0&&(D=-D),D/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(D)},sin:function(D){if(0===D)return 0;var y=1;switch(D<0&&(y=-1),D/b){case 1:return y;case 2:return 0;case 3:return-y}return Math.sin(D)},removeFromArray:function(D,y){var w=D.indexOf(y);return-1!==w&&D.splice(w,1),D},getRandomInt:function(D,y){return Math.floor(Math.random()*(y-D+1))+D},degreesToRadians:function(D){return D*C},radiansToDegrees:function(D){return D/C},rotatePoint:function(D,y,w){var I=new F.Point(D.x-y.x,D.y-y.y),m=F.util.rotateVector(I,w);return new F.Point(m.x,m.y).addEquals(y)},rotateVector:function(D,y){var w=F.util.sin(y),I=F.util.cos(y);return{x:D.x*I-D.y*w,y:D.x*w+D.y*I}},createVector:function(D,y){return new F.Point(y.x-D.x,y.y-D.y)},calcAngleBetweenVectors:function(D,y){return Math.acos((D.x*y.x+D.y*y.y)/(Math.hypot(D.x,D.y)*Math.hypot(y.x,y.y)))},getHatVector:function(D){return new F.Point(D.x,D.y).multiply(1/Math.hypot(D.x,D.y))},getBisector:function(D,y,w){var I=F.util.createVector(D,y),m=F.util.createVector(D,w),v=F.util.calcAngleBetweenVectors(I,m),T=v*(0===F.util.calcAngleBetweenVectors(F.util.rotateVector(I,v),m)?1:-1)/2;return{vector:F.util.getHatVector(F.util.rotateVector(I,T)),angle:v}},projectStrokeOnPoints:function(D,y,w){var I=[],m=y.strokeWidth/2,v=y.strokeUniform?new F.Point(1/y.scaleX,1/y.scaleY):new F.Point(1,1),T=function(A){var S=m/Math.hypot(A.x,A.y);return new F.Point(A.x*S*v.x,A.y*S*v.y)};return D.length<=1||D.forEach(function(A,S){var x,L,N=new F.Point(A.x,A.y);0===S?(L=D[S+1],x=w?T(F.util.createVector(L,N)).addEquals(N):D[D.length-1]):S===D.length-1?(x=D[S-1],L=w?T(F.util.createVector(x,N)).addEquals(N):D[0]):(x=D[S-1],L=D[S+1]);var B,H,V=F.util.getBisector(N,x,L),W=V.vector;if("miter"===y.strokeLineJoin&&(B=-m/Math.sin(V.angle/2),H=new F.Point(W.x*B*v.x,W.y*B*v.y),Math.hypot(H.x,H.y)/m<=y.strokeMiterLimit))return I.push(N.add(H)),void I.push(N.subtract(H));B=-m*Math.SQRT2,H=new F.Point(W.x*B*v.x,W.y*B*v.y),I.push(N.add(H)),I.push(N.subtract(H))}),I},transformPoint:function(D,y,w){return w?new F.Point(y[0]*D.x+y[2]*D.y,y[1]*D.x+y[3]*D.y):new F.Point(y[0]*D.x+y[2]*D.y+y[4],y[1]*D.x+y[3]*D.y+y[5])},makeBoundingBoxFromPoints:function(D,y){if(y)for(var w=0;w<D.length;w++)D[w]=F.util.transformPoint(D[w],y);var I=[D[0].x,D[1].x,D[2].x,D[3].x],m=F.util.array.min(I),v=F.util.array.max(I)-m,T=[D[0].y,D[1].y,D[2].y,D[3].y],A=F.util.array.min(T);return{left:m,top:A,width:v,height:F.util.array.max(T)-A}},invertTransform:function(D){var y=1/(D[0]*D[3]-D[1]*D[2]),w=[y*D[3],-y*D[1],-y*D[2],y*D[0]],I=F.util.transformPoint({x:D[4],y:D[5]},w,!0);return w[4]=-I.x,w[5]=-I.y,w},toFixed:function(D,y){return parseFloat(Number(D).toFixed(y))},parseUnit:function(D,y){var w=/\D{0,2}$/.exec(D),I=parseFloat(D);switch(y||(y=F.Text.DEFAULT_SVG_FONT_SIZE),w[0]){case"mm":return I*F.DPI/25.4;case"cm":return I*F.DPI/2.54;case"in":return I*F.DPI;case"pt":return I*F.DPI/72;case"pc":return I*F.DPI/72*12;case"em":return I*y;default:return I}},falseFunction:function(){return!1},getKlass:function(D,y){return D=F.util.string.camelize(D.charAt(0).toUpperCase()+D.slice(1)),F.util.resolveNamespace(y)[D]},getSvgAttributes:function(D){var y=["instantiated_by_use","style","id","class"];switch(D){case"linearGradient":y=y.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":y=y.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":y=y.concat(["offset","stop-color","stop-opacity"])}return y},resolveNamespace:function(D){if(!D)return F;var y,w=D.split("."),I=w.length,m=f||F.window;for(y=0;y<I;++y)m=m[w[y]];return m},loadImage:function(D,y,w,I){if(D){var m=F.util.createImage(),v=function(){y&&y.call(w,m,!1),m=m.onload=m.onerror=null};m.onload=v,m.onerror=function(){F.log("Error loading "+m.src),y&&y.call(w,null,!0),m=m.onload=m.onerror=null},0!==D.indexOf("data")&&null!=I&&(m.crossOrigin=I),"data:image/svg"===D.substring(0,14)&&(m.onload=null,F.util.loadImageInDom(m,v)),m.src=D}else y&&y.call(w,D)},loadImageInDom:function(D,y){var w=F.document.createElement("div");w.style.width=w.style.height="1px",w.style.left=w.style.top="-100%",w.style.position="absolute",w.appendChild(D),F.document.querySelector("body").appendChild(w),D.onload=function(){y(),w.parentNode.removeChild(w),w=null}},enlivenObjects:function(D,y,w,I){var m=[],v=0,T=(D=D||[]).length;function A(){++v===T&&y&&y(m.filter(function(S){return S}))}T?D.forEach(function(S,x){S&&S.type?F.util.getKlass(S.type,w).fromObject(S,function(L,N){N||(m[x]=L),I&&I(S,L,N),A()}):A()}):y&&y(m)},enlivenObjectEnlivables:function(D,y,w){var I=F.Object.ENLIVEN_PROPS.filter(function(m){return!!D[m]});F.util.enlivenObjects(I.map(function(m){return D[m]}),function(m){var v={};I.forEach(function(T,A){v[T]=m[A],y&&(y[T]=m[A])}),w&&w(v)})},enlivenPatterns:function(D,y){function w(){++m===v&&y&&y(I)}var I=[],m=0,v=(D=D||[]).length;v?D.forEach(function(T,A){T&&T.source?new F.Pattern(T,function(S){I[A]=S,w()}):(I[A]=T,w())}):y&&y(I)},groupSVGElements:function(D,y,w){var I;return D&&1===D.length?D[0]:(y&&(y.width&&y.height?y.centerPoint={x:y.width/2,y:y.height/2}:(delete y.width,delete y.height)),I=new F.Group(D,y),void 0!==w&&(I.sourcePath=w),I)},populateWithProperties:function(D,y,w){if(w&&Array.isArray(w))for(var I=0,m=w.length;I<m;I++)w[I]in D&&(y[w[I]]=D[w[I]])},createCanvasElement:function(){return F.document.createElement("canvas")},copyCanvasElement:function(D){var y=F.util.createCanvasElement();return y.width=D.width,y.height=D.height,y.getContext("2d").drawImage(D,0,0),y},toDataURL:function(D,y,w){return D.toDataURL("image/"+y,w)},createImage:function(){return F.document.createElement("img")},multiplyTransformMatrices:function(D,y,w){return[D[0]*y[0]+D[2]*y[1],D[1]*y[0]+D[3]*y[1],D[0]*y[2]+D[2]*y[3],D[1]*y[2]+D[3]*y[3],w?0:D[0]*y[4]+D[2]*y[5]+D[4],w?0:D[1]*y[4]+D[3]*y[5]+D[5]]},qrDecompose:function(D){var y=p(D[1],D[0]),w=_(D[0],2)+_(D[1],2),I=g(w),m=(D[0]*D[3]-D[2]*D[1])/I,v=p(D[0]*D[2]+D[1]*D[3],w);return{angle:y/C,scaleX:I,scaleY:m,skewX:v/C,skewY:0,translateX:D[4],translateY:D[5]}},calcRotateMatrix:function(D){if(!D.angle)return F.iMatrix.concat();var y=F.util.degreesToRadians(D.angle),w=F.util.cos(y),I=F.util.sin(y);return[w,I,-I,w,0,0]},calcDimensionsMatrix:function(D){var y=void 0===D.scaleX?1:D.scaleX,w=void 0===D.scaleY?1:D.scaleY,I=[D.flipX?-y:y,0,0,D.flipY?-w:w,0,0],m=F.util.multiplyTransformMatrices,v=F.util.degreesToRadians;return D.skewX&&(I=m(I,[1,0,Math.tan(v(D.skewX)),1],!0)),D.skewY&&(I=m(I,[1,Math.tan(v(D.skewY)),0,1],!0)),I},composeMatrix:function(D){var y=[1,0,0,1,D.translateX||0,D.translateY||0],w=F.util.multiplyTransformMatrices;return D.angle&&(y=w(y,F.util.calcRotateMatrix(D))),(1!==D.scaleX||1!==D.scaleY||D.skewX||D.skewY||D.flipX||D.flipY)&&(y=w(y,F.util.calcDimensionsMatrix(D))),y},resetObjectTransform:function(D){D.scaleX=1,D.scaleY=1,D.skewX=0,D.skewY=0,D.flipX=!1,D.flipY=!1,D.rotate(0)},saveObjectTransform:function(D){return{scaleX:D.scaleX,scaleY:D.scaleY,skewX:D.skewX,skewY:D.skewY,angle:D.angle,left:D.left,flipX:D.flipX,flipY:D.flipY,top:D.top}},isTransparent:function(D,y,w,I){I>0&&(y>I?y-=I:y=0,w>I?w-=I:w=0);var m,v=!0,T=D.getImageData(y,w,2*I||1,2*I||1),A=T.data.length;for(m=3;m<A&&0!=(v=T.data[m]<=0);m+=4);return T=null,v},parsePreserveAspectRatioAttribute:function(D){var y,w="meet",I=D.split(" ");return I&&I.length&&("meet"!==(w=I.pop())&&"slice"!==w?(y=w,w="meet"):I.length&&(y=I.pop())),{meetOrSlice:w,alignX:"none"!==y?y.slice(1,4):"none",alignY:"none"!==y?y.slice(5,8):"none"}},clearFabricFontCache:function(D){(D=(D||"").toLowerCase())?F.charWidthsCache[D]&&delete F.charWidthsCache[D]:F.charWidthsCache={}},limitDimsByArea:function(D,y){var w=Math.sqrt(y*D),I=Math.floor(y/w);return{x:Math.floor(w),y:I}},capValue:function(D,y,w){return Math.max(D,Math.min(y,w))},findScaleToFit:function(D,y){return Math.min(y.width/D.width,y.height/D.height)},findScaleToCover:function(D,y){return Math.max(y.width/D.width,y.height/D.height)},matrixToSVG:function(D){return"matrix("+D.map(function(y){return F.util.toFixed(y,F.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(D,y){var w=F.util.invertTransform(y),I=F.util.multiplyTransformMatrices(w,D.calcOwnMatrix());F.util.applyTransformToObject(D,I)},addTransformToObject:function(D,y){F.util.applyTransformToObject(D,F.util.multiplyTransformMatrices(y,D.calcOwnMatrix()))},applyTransformToObject:function(D,y){var w=F.util.qrDecompose(y),I=new F.Point(w.translateX,w.translateY);D.flipX=!1,D.flipY=!1,D.set("scaleX",w.scaleX),D.set("scaleY",w.scaleY),D.skewX=w.skewX,D.skewY=w.skewY,D.angle=w.angle,D.setPositionByOrigin(I,"center","center")},sizeAfterTransform:function(D,y,w){var I=D/2,m=y/2,v=[{x:-I,y:-m},{x:I,y:-m},{x:-I,y:m},{x:I,y:m}],T=F.util.calcDimensionsMatrix(w),A=F.util.makeBoundingBoxFromPoints(v,T);return{x:A.width,y:A.height}},mergeClipPaths:function(D,y){var w=D,I=y;w.inverted&&!I.inverted&&(w=y,I=D),F.util.applyTransformToObject(I,F.util.multiplyTransformMatrices(F.util.invertTransform(w.calcTransformMatrix()),I.calcTransformMatrix()));var m=w.inverted&&I.inverted;return m&&(w.inverted=I.inverted=!1),new F.Group([w],{clipPath:I,inverted:m})}},function(){var D=Array.prototype.join,y={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},w={m:"l",M:"L"};function I(H,V,W,q,ne,ie,he,le,oe,J,Q){var re=F.util.cos(H),ue=F.util.sin(H),de=F.util.cos(V),te=F.util.sin(V),ee=W*ne*de-q*ie*te+he,se=q*ne*de+W*ie*te+le;return["C",J+oe*(-W*ne*ue-q*ie*re),Q+oe*(-q*ne*ue+W*ie*re),ee+oe*(W*ne*te+q*ie*de),se+oe*(q*ne*te-W*ie*de),ee,se]}function m(H,V,W,q){var ne=Math.atan2(V,H),ie=Math.atan2(q,W);return ie>=ne?ie-ne:2*Math.PI-(ne-ie)}function v(H,V,W){for(var oe=function(re,ue,de,te,ee,se,fe){var ce=Math.PI,pe=fe*ce/180,De=F.util.sin(pe),we=F.util.cos(pe),ve=0,be=0,Ee=-we*re*.5-De*ue*.5,Ie=-we*ue*.5+De*re*.5,ke=(de=Math.abs(de))*de,Re=(te=Math.abs(te))*te,rt=Ie*Ie,Et=Ee*Ee,Di=ke*Re-ke*rt-Re*Et,Hr=0;if(Di<0){var Sa=Math.sqrt(1-Di/(ke*Re));de*=Sa,te*=Sa}else Hr=(ee===se?-1:1)*Math.sqrt(Di/(ke*rt+Re*Et));var Vt=Hr*de*Ie/te,Ti=-Hr*te*Ee/de,yc=we*Vt-De*Ti+.5*re,xa=De*Vt+we*Ti+.5*ue,ro=m(1,0,(Ee-Vt)/de,(Ie-Ti)/te),Aa=m((Ee-Vt)/de,(Ie-Ti)/te,(-Ee-Vt)/de,(-Ie-Ti)/te);0===se&&Aa>0?Aa-=2*ce:1===se&&Aa<0&&(Aa+=2*ce);for(var sT=Math.ceil(Math.abs(Aa/ce*2)),id=[],Cc=Aa/sT,W2=8/3*Math.sin(Cc/4)*Math.sin(Cc/4)/Math.sin(Cc/2),Gm=ro+Cc,wc=0;wc<sT;wc++)id[wc]=I(ro,Gm,we,De,de,te,yc,xa,W2,ve,be),ve=id[wc][5],be=id[wc][6],ro=Gm,Gm+=Cc;return id}(W[6]-H,W[7]-V,W[1],W[2],W[4],W[5],W[3]),J=0,Q=oe.length;J<Q;J++)oe[J][1]+=H,oe[J][2]+=V,oe[J][3]+=H,oe[J][4]+=V,oe[J][5]+=H,oe[J][6]+=V;return oe}function T(H,V,W,q){return Math.sqrt((W-H)*(W-H)+(q-V)*(q-V))}function A(H,V,W,q,ne,ie,he,le){return function(oe){var J,te,Q=(J=oe)*J*J,re=3*(te=oe)*te*(1-te),ue=function(te){return 3*te*(1-te)*(1-te)}(oe),de=function(te){return(1-te)*(1-te)*(1-te)}(oe);return{x:he*Q+ne*re+W*ue+H*de,y:le*Q+ie*re+q*ue+V*de}}}function S(H,V,W,q,ne,ie,he,le){return function(oe){var J=1-oe;return Math.atan2(3*J*J*(q-V)+6*J*oe*(ie-q)+3*oe*oe*(le-ie),3*J*J*(W-H)+6*J*oe*(ne-W)+3*oe*oe*(he-ne))}}function x(H,V,W,q,ne,ie){return function(he){var le,re,oe=(le=he)*le,J=2*(re=he)*(1-re),Q=function(re){return(1-re)*(1-re)}(he);return{x:ne*oe+W*J+H*Q,y:ie*oe+q*J+V*Q}}}function L(H,V,W,q,ne,ie){return function(he){var le=1-he;return Math.atan2(2*le*(q-V)+2*he*(ie-q),2*le*(W-H)+2*he*(ne-W))}}function N(H,V,W){var q,ne,ie={x:V,y:W},he=0;for(ne=1;ne<=100;ne+=1)q=H(ne/100),he+=T(ie.x,ie.y,q.x,q.y),ie=q;return he}function B(H){for(var V,W,q,ne,ie=0,he=H.length,le=0,oe=0,J=0,Q=0,re=[],ue=0;ue<he;ue++){switch(q={x:le,y:oe,command:(V=H[ue])[0]},V[0]){case"M":q.length=0,J=le=V[1],Q=oe=V[2];break;case"L":q.length=T(le,oe,V[1],V[2]),le=V[1],oe=V[2];break;case"C":W=A(le,oe,V[1],V[2],V[3],V[4],V[5],V[6]),ne=S(le,oe,V[1],V[2],V[3],V[4],V[5],V[6]),q.iterator=W,q.angleFinder=ne,q.length=N(W,le,oe),le=V[5],oe=V[6];break;case"Q":W=x(le,oe,V[1],V[2],V[3],V[4]),ne=L(le,oe,V[1],V[2],V[3],V[4]),q.iterator=W,q.angleFinder=ne,q.length=N(W,le,oe),le=V[3],oe=V[4];break;case"Z":case"z":q.destX=J,q.destY=Q,q.length=T(le,oe,J,Q),le=J,oe=Q}ie+=q.length,re.push(q)}return re.push({length:ie,x:le,y:oe}),re}F.util.joinPath=function(H){return H.map(function(V){return V.join(" ")}).join(" ")},F.util.parsePath=function(H){var V,W,q,ne,ie,he=[],le=[],oe=F.rePathCommand,J="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",Q="("+J+")"+F.commaWsp,re="([01])"+F.commaWsp+"?",ue=new RegExp(Q+"?"+Q+"?"+Q+re+re+Q+"?("+J+")","g");if(!H||!H.match)return he;for(var de,te=0,ee=(ie=H.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;te<ee;te++){ne=(V=ie[te]).slice(1).trim(),le.length=0;var se=V.charAt(0);if(de=[se],"a"===se.toLowerCase())for(var fe;fe=ue.exec(ne);)for(var ce=1;ce<fe.length;ce++)le.push(fe[ce]);else for(;q=oe.exec(ne);)le.push(q[0]);ce=0;for(var pe=le.length;ce<pe;ce++)W=parseFloat(le[ce]),isNaN(W)||de.push(W);var De=y[se.toLowerCase()],we=w[se]||se;if(de.length-1>De)for(var ve=1,be=de.length;ve<be;ve+=De)he.push([se].concat(de.slice(ve,ve+De))),se=we;else he.push(de)}return he},F.util.makePathSimpler=function(H){var V,W,q,ne,ie,he,le=0,oe=0,J=H.length,Q=0,re=0,ue=[];for(W=0;W<J;++W){switch(q=!1,(V=H[W].slice(0))[0]){case"l":V[0]="L",V[1]+=le,V[2]+=oe;case"L":le=V[1],oe=V[2];break;case"h":V[1]+=le;case"H":V[0]="L",V[2]=oe,le=V[1];break;case"v":V[1]+=oe;case"V":V[0]="L",oe=V[1],V[1]=le,V[2]=oe;break;case"m":V[0]="M",V[1]+=le,V[2]+=oe;case"M":le=V[1],oe=V[2],Q=V[1],re=V[2];break;case"c":V[0]="C",V[1]+=le,V[2]+=oe,V[3]+=le,V[4]+=oe,V[5]+=le,V[6]+=oe;case"C":ie=V[3],he=V[4],le=V[5],oe=V[6];break;case"s":V[0]="S",V[1]+=le,V[2]+=oe,V[3]+=le,V[4]+=oe;case"S":"C"===ne?(ie=2*le-ie,he=2*oe-he):(ie=le,he=oe),le=V[3],oe=V[4],V[0]="C",V[5]=V[3],V[6]=V[4],V[3]=V[1],V[4]=V[2],V[1]=ie,V[2]=he,ie=V[3],he=V[4];break;case"q":V[0]="Q",V[1]+=le,V[2]+=oe,V[3]+=le,V[4]+=oe;case"Q":ie=V[1],he=V[2],le=V[3],oe=V[4];break;case"t":V[0]="T",V[1]+=le,V[2]+=oe;case"T":"Q"===ne?(ie=2*le-ie,he=2*oe-he):(ie=le,he=oe),V[0]="Q",le=V[1],oe=V[2],V[1]=ie,V[2]=he,V[3]=le,V[4]=oe;break;case"a":V[0]="A",V[6]+=le,V[7]+=oe;case"A":q=!0,ue=ue.concat(v(le,oe,V)),le=V[6],oe=V[7];break;case"z":case"Z":le=Q,oe=re}q||ue.push(V),ne=V[0]}return ue},F.util.getSmoothPathFromPoints=function(H,V){var W,q=[],ne=new F.Point(H[0].x,H[0].y),ie=new F.Point(H[1].x,H[1].y),he=H.length,le=1,oe=0,J=he>2;for(J&&(le=H[2].x<ie.x?-1:H[2].x===ie.x?0:1,oe=H[2].y<ie.y?-1:H[2].y===ie.y?0:1),q.push(["M",ne.x-le*(V=V||0),ne.y-oe*V]),W=1;W<he;W++){if(!ne.eq(ie)){var Q=ne.midPointFrom(ie);q.push(["Q",ne.x,ne.y,Q.x,Q.y])}ne=H[W],W+1<H.length&&(ie=H[W+1])}return J&&(le=ne.x>H[W-2].x?1:ne.x===H[W-2].x?0:-1,oe=ne.y>H[W-2].y?1:ne.y===H[W-2].y?0:-1),q.push(["L",ne.x+le*V,ne.y+oe*V]),q},F.util.getPathSegmentsInfo=B,F.util.getBoundsOfCurve=function(H,V,W,q,ne,ie,he,le){var oe;if(F.cachesBoundsOfCurve&&(oe=D.call(arguments),F.boundsOfCurveCache[oe]))return F.boundsOfCurveCache[oe];var J,Q,re,ue,de,te,ee,se,fe=Math.sqrt,ce=Math.min,pe=Math.max,De=Math.abs,we=[],ve=[[],[]];Q=6*H-12*W+6*ne,J=-3*H+9*W-9*ne+3*he,re=3*W-3*H;for(var be=0;be<2;++be)if(be>0&&(Q=6*V-12*q+6*ie,J=-3*V+9*q-9*ie+3*le,re=3*q-3*V),De(J)<1e-12){if(De(Q)<1e-12)continue;0<(ue=-re/Q)&&ue<1&&we.push(ue)}else(ee=Q*Q-4*re*J)<0||(0<(de=(-Q+(se=fe(ee)))/(2*J))&&de<1&&we.push(de),0<(te=(-Q-se)/(2*J))&&te<1&&we.push(te));for(var Ee,ke,Re=we.length,rt=Re;Re--;)Ee=(ke=1-(ue=we[Re]))*ke*ke*H+3*ke*ke*ue*W+3*ke*ue*ue*ne+ue*ue*ue*he,ve[0][Re]=Ee,ve[1][Re]=ke*ke*ke*V+3*ke*ke*ue*q+3*ke*ue*ue*ie+ue*ue*ue*le;ve[0][rt]=H,ve[1][rt]=V,ve[0][rt+1]=he,ve[1][rt+1]=le;var Et=[{x:ce.apply(null,ve[0]),y:ce.apply(null,ve[1])},{x:pe.apply(null,ve[0]),y:pe.apply(null,ve[1])}];return F.cachesBoundsOfCurve&&(F.boundsOfCurveCache[oe]=Et),Et},F.util.getPointOnPath=function(H,V,W){W||(W=B(H));for(var q=0;V-W[q].length>0&&q<W.length-2;)V-=W[q].length,q++;var ne,ie=W[q],he=V/ie.length,oe=H[q];switch(ie.command){case"M":return{x:ie.x,y:ie.y,angle:0};case"Z":case"z":return(ne=new F.Point(ie.x,ie.y).lerp(new F.Point(ie.destX,ie.destY),he)).angle=Math.atan2(ie.destY-ie.y,ie.destX-ie.x),ne;case"L":return(ne=new F.Point(ie.x,ie.y).lerp(new F.Point(oe[1],oe[2]),he)).angle=Math.atan2(oe[2]-ie.y,oe[1]-ie.x),ne;case"C":case"Q":return function(J,Q){for(var re,ue,de,te=0,ee=0,se=J.iterator,fe={x:J.x,y:J.y},ce=.01,pe=J.angleFinder;ee<Q&&ce>1e-4;)re=se(te),de=te,(ue=T(fe.x,fe.y,re.x,re.y))+ee>Q?(te-=ce,ce/=2):(fe=re,te+=ce,ee+=ue);return re.angle=pe(de),re}(ie,V)}},F.util.transformPath=function(H,V,W){return W&&(V=F.util.multiplyTransformMatrices(V,[1,0,0,1,-W.x,-W.y])),H.map(function(q){for(var ne=q.slice(0),ie={},he=1;he<q.length-1;he+=2)ie.x=q[he],ie.y=q[he+1],ie=F.util.transformPoint(ie,V),ne[he]=ie.x,ne[he+1]=ie.y;return ne})}}(),function(){var D=Array.prototype.slice;function y(w,I,m){if(w&&0!==w.length){var v=w.length-1,T=I?w[v][I]:w[v];if(I)for(;v--;)m(w[v][I],T)&&(T=w[v][I]);else for(;v--;)m(w[v],T)&&(T=w[v]);return T}}F.util.array={fill:function(w,I){for(var m=w.length;m--;)w[m]=I;return w},invoke:function(w,I){for(var m=D.call(arguments,2),v=[],T=0,A=w.length;T<A;T++)v[T]=m.length?w[T][I].apply(w[T],m):w[T][I].call(w[T]);return v},min:function(w,I){return y(w,I,function(m,v){return m<v})},max:function(w,I){return y(w,I,function(m,v){return m>=v})}}}(),function(){function D(y,w,I){if(I)if(!F.isLikelyNode&&w instanceof Element)y=w;else if(w instanceof Array){y=[];for(var m=0,v=w.length;m<v;m++)y[m]=D({},w[m],I)}else if(w&&"object"==typeof w)for(var T in w)"canvas"===T||"group"===T?y[T]=null:w.hasOwnProperty(T)&&(y[T]=D({},w[T],I));else y=w;else for(var T in w)y[T]=w[T];return y}F.util.object={extend:D,clone:function(y,w){return D({},y,w)}},F.util.object.extend(F.util,F.Observable)}(),function(){function D(y,w){var I=y.charCodeAt(w);if(isNaN(I))return"";if(I<55296||I>57343)return y.charAt(w);if(55296<=I&&I<=56319){if(y.length<=w+1)throw"High surrogate without following low surrogate";var m=y.charCodeAt(w+1);if(56320>m||m>57343)throw"High surrogate without following low surrogate";return y.charAt(w)+y.charAt(w+1)}if(0===w)throw"Low surrogate without preceding high surrogate";var v=y.charCodeAt(w-1);if(55296>v||v>56319)throw"Low surrogate without preceding high surrogate";return!1}F.util.string={camelize:function(y){return y.replace(/-+(.)?/g,function(w,I){return I?I.toUpperCase():""})},capitalize:function(y,w){return y.charAt(0).toUpperCase()+(w?y.slice(1):y.slice(1).toLowerCase())},escapeXml:function(y){return y.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(y){var w,I=0,m=[];for(I=0;I<y.length;I++)!1!==(w=D(y,I))&&m.push(w);return m}}}(),function(){var D=Array.prototype.slice,y=function(){},w=function(){for(var T in{toString:1})if("toString"===T)return!1;return!0}(),I=function(T,A,S){for(var x in A)T.prototype[x]=x in T.prototype&&"function"==typeof T.prototype[x]&&(A[x]+"").indexOf("callSuper")>-1?function(L){return function(){var N=this.constructor.superclass;this.constructor.superclass=S;var B=A[L].apply(this,arguments);if(this.constructor.superclass=N,"initialize"!==L)return B}}(x):A[x],w&&(A.toString!==Object.prototype.toString&&(T.prototype.toString=A.toString),A.valueOf!==Object.prototype.valueOf&&(T.prototype.valueOf=A.valueOf))};function m(){}function v(T){for(var A=null,S=this;S.constructor.superclass;){var x=S.constructor.superclass.prototype[T];if(S[T]!==x){A=x;break}S=S.constructor.superclass.prototype}return A?arguments.length>1?A.apply(this,D.call(arguments,1)):A.call(this):console.log("tried to callSuper "+T+", method not found in prototype chain",this)}F.util.createClass=function(){var T=null,A=D.call(arguments,0);function S(){this.initialize.apply(this,arguments)}"function"==typeof A[0]&&(T=A.shift()),S.superclass=T,S.subclasses=[],T&&(m.prototype=T.prototype,S.prototype=new m,T.subclasses.push(S));for(var x=0,L=A.length;x<L;x++)I(S,A[x],T);return S.prototype.initialize||(S.prototype.initialize=y),S.prototype.constructor=S,S.prototype.callSuper=v,S}}(),O=!!F.document.createElement("div").attachEvent,M=["touchstart","touchmove","touchend"],F.util.addListener=function(D,y,w,I){D&&D.addEventListener(y,w,!O&&I)},F.util.removeListener=function(D,y,w,I){D&&D.removeEventListener(y,w,!O&&I)},F.util.getPointer=function(D){var m,v,w=F.util.getScrollLeftTop(D.target),I=(v=(m=D).changedTouches)&&v[0]?v[0]:m;return{x:I.clientX+w.left,y:I.clientY+w.top}},F.util.isTouchEvent=function(D){return M.indexOf(D.type)>-1||"touch"===D.pointerType},k="string"==typeof(P=F.document.createElement("div")).style.opacity,G=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,z=function(D){return D},k?z=function(D,y){return D.style.opacity=y,D}:"string"==typeof P.style.filter&&(z=function(D,y){var w=D.style;return D.currentStyle&&!D.currentStyle.hasLayout&&(w.zoom=1),G.test(w.filter)?w.filter=w.filter.replace(G,y=y>=.9999?"":"alpha(opacity="+100*y+")"):w.filter+=" alpha(opacity="+100*y+")",D}),F.util.setStyle=function(D,y){var w=D.style;if(!w)return D;if("string"==typeof y)return D.style.cssText+=";"+y,y.indexOf("opacity")>-1?z(D,y.match(/opacity:\s*(\d?\.?\d*)/)[1]):D;for(var I in y)"opacity"===I?z(D,y[I]):w["float"===I||"cssFloat"===I?void 0===w.styleFloat?"cssFloat":"styleFloat":I]=y[I];return D},function(){var D,y,w,I,m=Array.prototype.slice,v=function(S){return m.call(S,0)};try{D=v(F.document.childNodes)instanceof Array}catch(S){}function T(S,x){var L=F.document.createElement(S);for(var N in x)"class"===N?L.className=x[N]:"for"===N?L.htmlFor=x[N]:L.setAttribute(N,x[N]);return L}function A(S){for(var x=0,L=0,N=F.document.documentElement,B=F.document.body||{scrollLeft:0,scrollTop:0};S&&(S.parentNode||S.host)&&((S=S.parentNode||S.host)===F.document?(x=B.scrollLeft||N.scrollLeft||0,L=B.scrollTop||N.scrollTop||0):(x+=S.scrollLeft||0,L+=S.scrollTop||0),1!==S.nodeType||"fixed"!==S.style.position););return{left:x,top:L}}D||(v=function(S){for(var x=new Array(S.length),L=S.length;L--;)x[L]=S[L];return x}),y=F.document.defaultView&&F.document.defaultView.getComputedStyle?function(S,x){var L=F.document.defaultView.getComputedStyle(S,null);return L?L[x]:void 0}:function(S,x){var L=S.style[x];return!L&&S.currentStyle&&(L=S.currentStyle[x]),L},I="userSelect"in(w=F.document.documentElement.style)?"userSelect":"MozUserSelect"in w?"MozUserSelect":"WebkitUserSelect"in w?"WebkitUserSelect":"KhtmlUserSelect"in w?"KhtmlUserSelect":"",F.util.makeElementUnselectable=function(S){return void 0!==S.onselectstart&&(S.onselectstart=F.util.falseFunction),I?S.style[I]="none":"string"==typeof S.unselectable&&(S.unselectable="on"),S},F.util.makeElementSelectable=function(S){return void 0!==S.onselectstart&&(S.onselectstart=null),I?S.style[I]="":"string"==typeof S.unselectable&&(S.unselectable=""),S},F.util.setImageSmoothing=function(S,x){S.imageSmoothingEnabled=S.imageSmoothingEnabled||S.webkitImageSmoothingEnabled||S.mozImageSmoothingEnabled||S.msImageSmoothingEnabled||S.oImageSmoothingEnabled,S.imageSmoothingEnabled=x},F.util.getById=function(S){return"string"==typeof S?F.document.getElementById(S):S},F.util.toArray=v,F.util.addClass=function(S,x){S&&-1===(" "+S.className+" ").indexOf(" "+x+" ")&&(S.className+=(S.className?" ":"")+x)},F.util.makeElement=T,F.util.wrapElement=function(S,x,L){return"string"==typeof x&&(x=T(x,L)),S.parentNode&&S.parentNode.replaceChild(x,S),x.appendChild(S),x},F.util.getScrollLeftTop=A,F.util.getElementOffset=function(S){var x,L,N=S&&S.ownerDocument,B={left:0,top:0},H={left:0,top:0},V={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!N)return H;for(var W in V)H[V[W]]+=parseInt(y(S,W),10)||0;return x=N.documentElement,void 0!==S.getBoundingClientRect&&(B=S.getBoundingClientRect()),L=A(S),{left:B.left+L.left-(x.clientLeft||0)+H.left,top:B.top+L.top-(x.clientTop||0)+H.top}},F.util.getNodeCanvas=function(S){var x=F.jsdomImplForWrapper(S);return x._canvas||x._image},F.util.cleanUpJsdomNode=function(S){if(F.isLikelyNode){var x=F.jsdomImplForWrapper(S);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}}(),function(){function D(){}F.util.request=function(y,w){w||(w={});var A,S,I=w.method?w.method.toUpperCase():"GET",m=w.onComplete||function(){},v=new F.window.XMLHttpRequest,T=w.body||w.parameters;return v.onreadystatechange=function(){4===v.readyState&&(m(v),v.onreadystatechange=D)},"GET"===I&&(T=null,"string"==typeof w.parameters&&(S=w.parameters,y=(A=y)+(/\?/.test(A)?"&":"?")+S)),v.open(I,y,!0),"POST"!==I&&"PUT"!==I||v.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),v.send(T),v}}(),F.log=console.log,F.warn=console.warn,function(){var D=F.util.object.extend,y=F.util.object.clone,w=[];function I(){return!1}function m(S,x,L,N){return-L*Math.cos(S/N*(Math.PI/2))+L+x}F.util.object.extend(w,{cancelAll:function(){var S=this.splice(0);return S.forEach(function(x){x.cancel()}),S},cancelByCanvas:function(S){if(!S)return[];var x=this.filter(function(L){return"object"==typeof L.target&&L.target.canvas===S});return x.forEach(function(L){L.cancel()}),x},cancelByTarget:function(S){var x=this.findAnimationsByTarget(S);return x.forEach(function(L){L.cancel()}),x},findAnimationIndex:function(S){return this.indexOf(this.findAnimation(S))},findAnimation:function(S){return this.find(function(x){return x.cancel===S})},findAnimationsByTarget:function(S){return S?this.filter(function(x){return x.target===S}):[]}});var v=F.window.requestAnimationFrame||F.window.webkitRequestAnimationFrame||F.window.mozRequestAnimationFrame||F.window.oRequestAnimationFrame||F.window.msRequestAnimationFrame||function(S){return F.window.setTimeout(S,1e3/60)},T=F.window.cancelAnimationFrame||F.window.clearTimeout;function A(){return v.apply(F.window,arguments)}F.util.animate=function(S){S||(S={});var x,L=!1,N=function(){var B=F.runningAnimations.indexOf(x);return B>-1&&F.runningAnimations.splice(B,1)[0]};return x=D(y(S),{cancel:function(){return L=!0,N()},currentValue:"startValue"in S?S.startValue:0,completionRate:0,durationRate:0}),F.runningAnimations.push(x),A(function(B){var H,V=B||+new Date,W=S.duration||500,q=V+W,ne=S.onChange||I,ie=S.abort||I,he=S.onComplete||I,le=S.easing||m,oe="startValue"in S&&S.startValue.length>0,J="startValue"in S?S.startValue:0,Q="endValue"in S?S.endValue:100,re=S.byValue||(oe?J.map(function(ue,de){return Q[de]-J[de]}):Q-J);S.onStart&&S.onStart(),function ue(de){var te=(H=de||+new Date)>q?W:H-V,ee=te/W,se=oe?J.map(function(ce,pe){return le(te,J[pe],re[pe],W)}):le(te,J,re,W),fe=Math.abs(oe?(se[0]-J[0])/re[0]:(se-J)/re);if(x.currentValue=oe?se.slice():se,x.completionRate=fe,x.durationRate=ee,!L){if(!ie(se,fe,ee))return H>q?(x.currentValue=oe?Q.slice():Q,x.completionRate=1,x.durationRate=1,ne(oe?Q.slice():Q,1,1),he(Q,1,1),void N()):(ne(se,fe,ee),void A(ue));N()}}(V)}),x.cancel},F.util.requestAnimFrame=A,F.util.cancelAnimFrame=function(){return T.apply(F.window,arguments)},F.runningAnimations=w}(),function(){function D(y,w,I){var m="rgba("+parseInt(y[0]+I*(w[0]-y[0]),10)+","+parseInt(y[1]+I*(w[1]-y[1]),10)+","+parseInt(y[2]+I*(w[2]-y[2]),10);return(m+=","+(y&&w?parseFloat(y[3]+I*(w[3]-y[3])):1))+")"}F.util.animateColor=function(y,w,I,m){var v=new F.Color(y).getSource(),T=new F.Color(w).getSource(),A=m.onComplete,S=m.onChange;return F.util.animate(F.util.object.extend(m=m||{},{duration:I||500,startValue:v,endValue:T,byValue:T,easing:function(x,L,N,B){return D(L,N,m.colorEasing?m.colorEasing(x,B):1-Math.cos(x/B*(Math.PI/2)))},onComplete:function(x,L,N){if(A)return A(D(T,T,0),L,N)},onChange:function(x,L,N){if(S){if(Array.isArray(x))return S(D(x,x,0),L,N);S(x,L,N)}}}))}}(),function(){function D(m,v,T,A){return m<Math.abs(v)?(m=v,A=T/4):A=0===v&&0===m?T/(2*Math.PI)*Math.asin(1):T/(2*Math.PI)*Math.asin(v/m),{a:m,c:v,p:T,s:A}}function y(m,v,T){return m.a*Math.pow(2,10*(v-=1))*Math.sin((v*T-m.s)*(2*Math.PI)/m.p)}function w(m,v,T,A){return T-I(A-m,0,T,A)+v}function I(m,v,T,A){return(m/=A)<1/2.75?T*(7.5625*m*m)+v:m<2/2.75?T*(7.5625*(m-=1.5/2.75)*m+.75)+v:m<2.5/2.75?T*(7.5625*(m-=2.25/2.75)*m+.9375)+v:T*(7.5625*(m-=2.625/2.75)*m+.984375)+v}F.util.ease={easeInQuad:function(m,v,T,A){return T*(m/=A)*m+v},easeOutQuad:function(m,v,T,A){return-T*(m/=A)*(m-2)+v},easeInOutQuad:function(m,v,T,A){return(m/=A/2)<1?T/2*m*m+v:-T/2*(--m*(m-2)-1)+v},easeInCubic:function(m,v,T,A){return T*(m/=A)*m*m+v},easeOutCubic:function(m,v,T,A){return T*((m=m/A-1)*m*m+1)+v},easeInOutCubic:function(m,v,T,A){return(m/=A/2)<1?T/2*m*m*m+v:T/2*((m-=2)*m*m+2)+v},easeInQuart:function(m,v,T,A){return T*(m/=A)*m*m*m+v},easeOutQuart:function(m,v,T,A){return-T*((m=m/A-1)*m*m*m-1)+v},easeInOutQuart:function(m,v,T,A){return(m/=A/2)<1?T/2*m*m*m*m+v:-T/2*((m-=2)*m*m*m-2)+v},easeInQuint:function(m,v,T,A){return T*(m/=A)*m*m*m*m+v},easeOutQuint:function(m,v,T,A){return T*((m=m/A-1)*m*m*m*m+1)+v},easeInOutQuint:function(m,v,T,A){return(m/=A/2)<1?T/2*m*m*m*m*m+v:T/2*((m-=2)*m*m*m*m+2)+v},easeInSine:function(m,v,T,A){return-T*Math.cos(m/A*(Math.PI/2))+T+v},easeOutSine:function(m,v,T,A){return T*Math.sin(m/A*(Math.PI/2))+v},easeInOutSine:function(m,v,T,A){return-T/2*(Math.cos(Math.PI*m/A)-1)+v},easeInExpo:function(m,v,T,A){return 0===m?v:T*Math.pow(2,10*(m/A-1))+v},easeOutExpo:function(m,v,T,A){return m===A?v+T:T*(1-Math.pow(2,-10*m/A))+v},easeInOutExpo:function(m,v,T,A){return 0===m?v:m===A?v+T:(m/=A/2)<1?T/2*Math.pow(2,10*(m-1))+v:T/2*(2-Math.pow(2,-10*--m))+v},easeInCirc:function(m,v,T,A){return-T*(Math.sqrt(1-(m/=A)*m)-1)+v},easeOutCirc:function(m,v,T,A){return T*Math.sqrt(1-(m=m/A-1)*m)+v},easeInOutCirc:function(m,v,T,A){return(m/=A/2)<1?-T/2*(Math.sqrt(1-m*m)-1)+v:T/2*(Math.sqrt(1-(m-=2)*m)+1)+v},easeInElastic:function(m,v,T,A){var S=0;return 0===m?v:1==(m/=A)?v+T:(S||(S=.3*A),-y(D(T,T,S,1.70158),m,A)+v)},easeOutElastic:function(m,v,T,A){var S=0;if(0===m)return v;if(1==(m/=A))return v+T;S||(S=.3*A);var x=D(T,T,S,1.70158);return x.a*Math.pow(2,-10*m)*Math.sin((m*A-x.s)*(2*Math.PI)/x.p)+x.c+v},easeInOutElastic:function(m,v,T,A){var S=0;if(0===m)return v;if(2==(m/=A/2))return v+T;S||(S=A*(.3*1.5));var x=D(T,T,S,1.70158);return m<1?-.5*y(x,m,A)+v:x.a*Math.pow(2,-10*(m-=1))*Math.sin((m*A-x.s)*(2*Math.PI)/x.p)*.5+x.c+v},easeInBack:function(m,v,T,A,S){return void 0===S&&(S=1.70158),T*(m/=A)*m*((S+1)*m-S)+v},easeOutBack:function(m,v,T,A,S){return void 0===S&&(S=1.70158),T*((m=m/A-1)*m*((S+1)*m+S)+1)+v},easeInOutBack:function(m,v,T,A,S){return void 0===S&&(S=1.70158),(m/=A/2)<1?T/2*(m*m*((1+(S*=1.525))*m-S))+v:T/2*((m-=2)*m*((1+(S*=1.525))*m+S)+2)+v},easeInBounce:w,easeOutBounce:I,easeInOutBounce:function(m,v,T,A){return m<A/2?.5*w(2*m,0,T,A)+v:.5*I(2*m-A,0,T,A)+.5*T+v}}}(),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.util.object.clone,m=y.util.toFixed,v=y.util.parseUnit,T=y.util.multiplyTransformMatrices,A={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},S={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",L="clip-path";function N(J){return J in A?A[J]:J}function B(J,Q,re,ue){var de,te=Array.isArray(Q);if("fill"!==J&&"stroke"!==J||"none"!==Q){if("strokeUniform"===J)return"non-scaling-stroke"===Q;if("strokeDashArray"===J)Q="none"===Q?null:Q.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===J)Q=re&&re.transformMatrix?T(re.transformMatrix,y.parseTransformAttribute(Q)):y.parseTransformAttribute(Q);else if("visible"===J)Q="none"!==Q&&"hidden"!==Q,re&&!1===re.visible&&(Q=!1);else if("opacity"===J)Q=parseFloat(Q),re&&void 0!==re.opacity&&(Q*=re.opacity);else if("textAnchor"===J)Q="start"===Q?"left":"end"===Q?"right":"center";else if("charSpacing"===J)de=v(Q,ue)/ue*1e3;else if("paintFirst"===J){var ee=Q.indexOf("fill"),se=Q.indexOf("stroke");Q="fill",(ee>-1&&se>-1&&se<ee||-1===ee&&se>-1)&&(Q="stroke")}else{if("href"===J||"xlink:href"===J||"font"===J)return Q;if("imageSmoothing"===J)return"optimizeQuality"===Q;de=te?Q.map(v):v(Q,ue)}}else Q="";return!te&&isNaN(de)?Q:de}function H(J){return new RegExp("^("+J.join("|")+")\\b","i")}function V(J,Q){var ue,de,te,ee=[];for(de=0,te=Q.length;de<te;de++)ue=J.getElementsByTagName(Q[de]),ee=ee.concat(Array.prototype.slice.call(ue));return ee}function W(J,Q){var re,ue=!0;return(re=q(J,Q.pop()))&&Q.length&&(ue=function(de,te){for(var ee,se=!0;de.parentNode&&1===de.parentNode.nodeType&&te.length;)se&&(ee=te.pop()),se=q(de=de.parentNode,ee);return 0===te.length}(J,Q)),re&&ue&&0===Q.length}function q(J,Q){var re,ue,de=J.nodeName,te=J.getAttribute("class"),ee=J.getAttribute("id");if(re=new RegExp("^"+de,"i"),Q=Q.replace(re,""),ee&&Q.length&&(re=new RegExp("#"+ee+"(?![a-zA-Z\\-]+)","i"),Q=Q.replace(re,"")),te&&Q.length)for(ue=(te=te.split(" ")).length;ue--;)re=new RegExp("\\."+te[ue]+"(?![a-zA-Z\\-]+)","i"),Q=Q.replace(re,"");return 0===Q.length}function ne(J,Q){var re;if(J.getElementById&&(re=J.getElementById(Q)),re)return re;var ue,de,te,ee=J.getElementsByTagName("*");for(de=0,te=ee.length;de<te;de++)if(Q===(ue=ee[de]).getAttribute("id"))return ue}y.svgValidTagNamesRegEx=H(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),y.svgViewBoxElementsRegEx=H(["symbol","image","marker","pattern","view","svg"]),y.svgInvalidAncestorsRegEx=H(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),y.svgValidParentsRegEx=H(["symbol","g","a","svg","clipPath","defs"]),y.cssRules={},y.gradientDefs={},y.clipPaths={},y.parseTransformAttribute=function(){function J(se,fe,ce){se[ce]=Math.tan(y.util.degreesToRadians(fe[0]))}var Q=y.iMatrix,re=y.reNum,ue=y.commaWsp,de="(?:(?:(matrix)\\s*\\(\\s*("+re+")"+ue+"("+re+")"+ue+"("+re+")"+ue+"("+re+")"+ue+"("+re+")"+ue+"("+re+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+re+")(?:"+ue+"("+re+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+re+")(?:"+ue+"("+re+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+re+")(?:"+ue+"("+re+")"+ue+"("+re+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+re+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+re+")\\s*\\)))",te=new RegExp("^\\s*(?:(?:"+de+"(?:"+ue+"*"+de+")*)?)\\s*$"),ee=new RegExp(de,"g");return function(se){var fe=Q.concat(),ce=[];if(!se||se&&!te.test(se))return fe;se.replace(ee,function(De){var Ee,Ie,we=new RegExp(de).exec(De).filter(function(Ee){return!!Ee}),ve=we[1],be=we.slice(2).map(parseFloat);switch(ve){case"translate":(Ee=fe)[4]=(Ie=be)[0],2===Ie.length&&(Ee[5]=Ie[1]);break;case"rotate":be[0]=y.util.degreesToRadians(be[0]),function(Ee,Ie){var ke=y.util.cos(Ie[0]),Re=y.util.sin(Ie[0]),rt=0,Et=0;3===Ie.length&&(rt=Ie[1],Et=Ie[2]),Ee[0]=ke,Ee[1]=Re,Ee[2]=-Re,Ee[3]=ke,Ee[4]=rt-(ke*rt-Re*Et),Ee[5]=Et-(Re*rt+ke*Et)}(fe,be);break;case"scale":!function(Ee,Ie){var Re=2===Ie.length?Ie[1]:Ie[0];Ee[0]=Ie[0],Ee[3]=Re}(fe,be);break;case"skewX":J(fe,be,2);break;case"skewY":J(fe,be,1);break;case"matrix":fe=be}ce.push(fe.concat()),fe=Q.concat()});for(var pe=ce[0];ce.length>1;)ce.shift(),pe=y.util.multiplyTransformMatrices(pe,ce[0]);return pe}}();var ie=new RegExp("^\\s*("+y.reNum+"+)\\s*,?\\s*("+y.reNum+"+)\\s*,?\\s*("+y.reNum+"+)\\s*,?\\s*("+y.reNum+"+)\\s*$");function he(J){if(!y.svgViewBoxElementsRegEx.test(J.nodeName))return{};var Q,re,ue,de,te,ee,se=J.getAttribute("viewBox"),fe=1,ce=1,pe=J.getAttribute("width"),De=J.getAttribute("height"),we=J.getAttribute("x")||0,ve=J.getAttribute("y")||0,be=J.getAttribute("preserveAspectRatio")||"",Ee=!se||!(se=se.match(ie)),Ie=!pe||!De||"100%"===pe||"100%"===De,ke=Ee&&Ie,Re={},rt="",Et=0,Di=0;if(Re.width=0,Re.height=0,Re.toBeParsed=ke,Ee&&(we||ve)&&J.parentNode&&"#document"!==J.parentNode.nodeName&&(rt=" translate("+v(we)+" "+v(ve)+") ",te=(J.getAttribute("transform")||"")+rt,J.setAttribute("transform",te),J.removeAttribute("x"),J.removeAttribute("y")),ke)return Re;if(Ee)return Re.width=v(pe),Re.height=v(De),Re;if(Q=-parseFloat(se[1]),re=-parseFloat(se[2]),ue=parseFloat(se[3]),de=parseFloat(se[4]),Re.minX=Q,Re.minY=re,Re.viewBoxWidth=ue,Re.viewBoxHeight=de,Ie?(Re.width=ue,Re.height=de):(Re.width=v(pe),Re.height=v(De),fe=Re.width/ue,ce=Re.height/de),"none"!==(be=y.util.parsePreserveAspectRatioAttribute(be)).alignX&&("meet"===be.meetOrSlice&&(ce=fe=fe>ce?ce:fe),"slice"===be.meetOrSlice&&(ce=fe=fe>ce?fe:ce),Et=Re.width-ue*fe,Di=Re.height-de*fe,"Mid"===be.alignX&&(Et/=2),"Mid"===be.alignY&&(Di/=2),"Min"===be.alignX&&(Et=0),"Min"===be.alignY&&(Di=0)),1===fe&&1===ce&&0===Q&&0===re&&0===we&&0===ve)return Re;if((we||ve)&&"#document"!==J.parentNode.nodeName&&(rt=" translate("+v(we)+" "+v(ve)+") "),te=rt+" matrix("+fe+" 0 0 "+ce+" "+(Q*fe+Et)+" "+(re*ce+Di)+") ","svg"===J.nodeName){for(ee=J.ownerDocument.createElementNS(y.svgNS,"g");J.firstChild;)ee.appendChild(J.firstChild);J.appendChild(ee)}else(ee=J).removeAttribute("x"),ee.removeAttribute("y"),te=ee.getAttribute("transform")+te;return ee.setAttribute("transform",te),Re}function le(J,Q){var re="xlink:href",ue=ne(J,Q.getAttribute(re).slice(1));if(ue&&ue.getAttribute(re)&&le(J,ue),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(te){ue&&!Q.hasAttribute(te)&&ue.hasAttribute(te)&&Q.setAttribute(te,ue.getAttribute(te))}),!Q.children.length)for(var de=ue.cloneNode(!0);de.firstChild;)Q.appendChild(de.firstChild);Q.removeAttribute(re)}y.parseSVGDocument=function(J,Q,re,ue){if(J){!function(we){for(var ve=V(we,["use","svg:use"]),be=0;ve.length&&be<ve.length;){var Ee=ve[be],Ie=Ee.getAttribute("xlink:href")||Ee.getAttribute("href");if(null===Ie)return;var ke,Re,rt,Et,Di=Ie.slice(1),Hr=Ee.getAttribute("x")||0,Sa=Ee.getAttribute("y")||0,Vt=ne(we,Di).cloneNode(!0),Ti=(Vt.getAttribute("transform")||"")+" translate("+Hr+", "+Sa+")",yc=ve.length,xa=y.svgNS;if(he(Vt),/^svg$/i.test(Vt.nodeName)){var ro=Vt.ownerDocument.createElementNS(xa,"g");for(Re=0,Et=(rt=Vt.attributes).length;Re<Et;Re++)ke=rt.item(Re),ro.setAttributeNS(xa,ke.nodeName,ke.nodeValue);for(;Vt.firstChild;)ro.appendChild(Vt.firstChild);Vt=ro}for(Re=0,Et=(rt=Ee.attributes).length;Re<Et;Re++)"x"!==(ke=rt.item(Re)).nodeName&&"y"!==ke.nodeName&&"xlink:href"!==ke.nodeName&&"href"!==ke.nodeName&&("transform"===ke.nodeName?Ti=ke.nodeValue+" "+Ti:Vt.setAttribute(ke.nodeName,ke.nodeValue));Vt.setAttribute("transform",Ti),Vt.setAttribute("instantiated_by_use","1"),Vt.removeAttribute("id"),Ee.parentNode.replaceChild(Vt,Ee),ve.length===yc&&be++}}(J);var de,te,ee=y.Object.__uid++,se=he(J),fe=y.util.toArray(J.getElementsByTagName("*"));if(se.crossOrigin=ue&&ue.crossOrigin,se.svgUid=ee,0===fe.length&&y.isLikelyNode){var ce=[];for(de=0,te=(fe=J.selectNodes('//*[name(.)!="svg"]')).length;de<te;de++)ce[de]=fe[de];fe=ce}var pe=fe.filter(function(we){return he(we),y.svgValidTagNamesRegEx.test(we.nodeName.replace("svg:",""))&&!function(ve,be){for(;ve&&(ve=ve.parentNode);)if(ve.nodeName&&be.test(ve.nodeName.replace("svg:",""))&&!ve.getAttribute("instantiated_by_use"))return!0;return!1}(we,y.svgInvalidAncestorsRegEx)});if(!pe||pe&&!pe.length)Q&&Q([],{});else{var De={};fe.filter(function(we){return"clipPath"===we.nodeName.replace("svg:","")}).forEach(function(we){var ve=we.getAttribute("id");De[ve]=y.util.toArray(we.getElementsByTagName("*")).filter(function(be){return y.svgValidTagNamesRegEx.test(be.nodeName.replace("svg:",""))})}),y.gradientDefs[ee]=y.getGradientDefs(J),y.cssRules[ee]=y.getCSSRules(J),y.clipPaths[ee]=De,y.parseElements(pe,function(we,ve){Q&&(Q(we,se,ve,fe),delete y.gradientDefs[ee],delete y.cssRules[ee],delete y.clipPaths[ee])},I(se),re,ue)}}};var oe=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+y.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+y.reNum+"))?\\s+(.*)");w(y,{parseFontDeclaration:function(J,Q){var re=J.match(oe);if(re){var ue=re[1],de=re[3],te=re[4],ee=re[5],se=re[6];ue&&(Q.fontStyle=ue),de&&(Q.fontWeight=isNaN(parseFloat(de))?de:parseFloat(de)),te&&(Q.fontSize=v(te)),se&&(Q.fontFamily=se),ee&&(Q.lineHeight="normal"===ee?1:ee)}},getGradientDefs:function(J){var Q,re=V(J,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),ue=0,de={};for(ue=re.length;ue--;)(Q=re[ue]).getAttribute("xlink:href")&&le(J,Q),de[Q.getAttribute("id")]=Q;return de},parseAttributes:function(J,Q,re){if(J){var ue,de,te,ee={};void 0===re&&(re=J.getAttribute("svgUid")),J.parentNode&&y.svgValidParentsRegEx.test(J.parentNode.nodeName)&&(ee=y.parseAttributes(J.parentNode,Q,re));var se=Q.reduce(function(be,Ee){return(ue=J.getAttribute(Ee))&&(be[Ee]=ue),be},{}),fe=w(function(be,Ee){var Ie={};for(var ke in y.cssRules[Ee])if(W(be,ke.split(" ")))for(var Re in y.cssRules[Ee][ke])Ie[Re]=y.cssRules[Ee][ke][Re];return Ie}(J,re),y.parseStyleAttribute(J));se=w(se,fe),fe[L]&&J.setAttribute(L,fe[L]),de=te=ee.fontSize||y.Text.DEFAULT_SVG_FONT_SIZE,se[x]&&(se[x]=de=v(se[x],te));var ce,pe,De={};for(var we in se)pe=B(ce=N(we),se[we],ee,de),De[ce]=pe;De&&De.font&&y.parseFontDeclaration(De.font,De);var ve=w(ee,De);return y.svgValidParentsRegEx.test(J.nodeName)?ve:function(be){for(var Ee in S)if(void 0!==be[S[Ee]]&&""!==be[Ee]){if(void 0===be[Ee]){if(!y.Object.prototype[Ee])continue;be[Ee]=y.Object.prototype[Ee]}if(0!==be[Ee].indexOf("url(")){var Ie=new y.Color(be[Ee]);be[Ee]=Ie.setAlpha(m(Ie.getAlpha()*be[S[Ee]],2)).toRgba()}}return be}(ve)}},parseElements:function(J,Q,re,ue,de){new y.ElementsParser(J,Q,re,ue,de).parse()},parseStyleAttribute:function(J){var de,te,ee,Q={},re=J.getAttribute("style");return re&&("string"==typeof re?(de=Q,re.replace(/;\s*$/,"").split(";").forEach(function(se){var fe=se.split(":");te=fe[0].trim().toLowerCase(),ee=fe[1].trim(),de[te]=ee})):function(ue,de){for(var se in ue)void 0!==ue[se]&&(de[se.toLowerCase()]=ue[se])}(re,Q)),Q},parsePointsAttribute:function(J){if(!J)return null;var Q,re,ue=[];for(Q=0,re=(J=(J=J.replace(/,/g," ").trim()).split(/\s+/)).length;Q<re;Q+=2)ue.push({x:parseFloat(J[Q]),y:parseFloat(J[Q+1])});return ue},getCSSRules:function(J){var Q,re,ue=J.getElementsByTagName("style"),de={};for(Q=0,re=ue.length;Q<re;Q++){var te=ue[Q].textContent;""!==(te=te.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&te.split("}").filter(function(ee){return ee.trim()}).forEach(function(ee){var se=ee.split("{"),fe={},ce=se[1].trim().split(";").filter(function(ve){return ve.trim()});for(Q=0,re=ce.length;Q<re;Q++){var pe=ce[Q].split(":"),De=pe[0].trim(),we=pe[1].trim();fe[De]=we}(ee=se[0].trim()).split(",").forEach(function(ve){""!==(ve=ve.replace(/^svg/i,"").trim())&&(de[ve]?y.util.object.extend(de[ve],fe):de[ve]=y.util.object.clone(fe))})})}return de},loadSVGFromURL:function(J,Q,re,ue){J=J.replace(/^\n\s*/,"").trim(),new y.util.request(J,{method:"get",onComplete:function(de){var te=de.responseXML;if(!te||!te.documentElement)return Q&&Q(null),!1;y.parseSVGDocument(te.documentElement,function(ee,se,fe,ce){Q&&Q(ee,se,fe,ce)},re,ue)}})},loadSVGFromString:function(J,Q,re,ue){var de=(new y.window.DOMParser).parseFromString(J.trim(),"text/xml");y.parseSVGDocument(de.documentElement,function(te,ee,se,fe){Q(te,ee,se,fe)},re,ue)}})}(a),F.ElementsParser=function(D,y,w,I,m,v){this.elements=D,this.callback=y,this.options=w,this.reviver=I,this.svgUid=w&&w.svgUid||0,this.parsingOptions=m,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=v},(Y=F.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},Y.createObjects=function(){var D=this;this.elements.forEach(function(y,w){y.setAttribute("svgUid",D.svgUid),D.createObject(y,w)})},Y.findTag=function(D){return F[F.util.string.capitalize(D.tagName.replace("svg:",""))]},Y.createObject=function(D,y){var w=this.findTag(D);if(w&&w.fromElement)try{w.fromElement(D,this.createCallback(y,D),this.options)}catch(I){F.log(I)}else this.checkIfDone()},Y.createCallback=function(D,y){var w=this;return function(I){var m;w.resolveGradient(I,y,"fill"),w.resolveGradient(I,y,"stroke"),I instanceof F.Image&&I._originalElement&&(m=I.parsePreserveAspectRatioAttribute(y)),I._removeTransformMatrix(m),w.resolveClipPath(I,y),w.reviver&&w.reviver(y,I),w.instances[D]=I,w.checkIfDone()}},Y.extractPropertyDefinition=function(D,y,w){var I=D[y],m=this.regexUrl;if(m.test(I)){m.lastIndex=0;var v=m.exec(I)[1];return m.lastIndex=0,F[w][this.svgUid][v]}},Y.resolveGradient=function(D,y,w){var I=this.extractPropertyDefinition(D,w,"gradientDefs");if(I){var m=y.getAttribute(w+"-opacity"),v=F.Gradient.fromElement(I,D,m,this.options);D.set(w,v)}},Y.createClipPathCallback=function(D,y){return function(w){w._removeTransformMatrix(),w.fillRule=w.clipRule,y.push(w)}},Y.resolveClipPath=function(D,y){var w,I,m,v,T=this.extractPropertyDefinition(D,"clipPath","clipPaths");if(T){m=[],I=F.util.invertTransform(D.calcTransformMatrix());for(var A=T[0].parentNode,S=y;S.parentNode&&S.getAttribute("clip-path")!==D.clipPath;)S=S.parentNode;S.parentNode.appendChild(A);for(var x=0;x<T.length;x++)this.findTag(w=T[x]).fromElement(w,this.createClipPathCallback(D,m),this.options);T=1===m.length?m[0]:new F.Group(m),v=F.util.multiplyTransformMatrices(I,T.calcTransformMatrix()),T.clipPath&&this.resolveClipPath(T,S);var L=F.util.qrDecompose(v);T.flipX=!1,T.flipY=!1,T.set("scaleX",L.scaleX),T.set("scaleY",L.scaleY),T.angle=L.angle,T.skewX=L.skewX,T.skewY=0,T.setPositionByOrigin({x:L.translateX,y:L.translateY},"center","center"),D.clipPath=T}else delete D.clipPath},Y.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(D){return null!=D}),this.callback(this.instances,this.elements))},function(D){var y=D.fabric||(D.fabric={});function w(I,m){this.x=I,this.y=m}y.Point?y.warn("fabric.Point is already defined"):(y.Point=w,w.prototype={type:"point",constructor:w,add:function(I){return new w(this.x+I.x,this.y+I.y)},addEquals:function(I){return this.x+=I.x,this.y+=I.y,this},scalarAdd:function(I){return new w(this.x+I,this.y+I)},scalarAddEquals:function(I){return this.x+=I,this.y+=I,this},subtract:function(I){return new w(this.x-I.x,this.y-I.y)},subtractEquals:function(I){return this.x-=I.x,this.y-=I.y,this},scalarSubtract:function(I){return new w(this.x-I,this.y-I)},scalarSubtractEquals:function(I){return this.x-=I,this.y-=I,this},multiply:function(I){return new w(this.x*I,this.y*I)},multiplyEquals:function(I){return this.x*=I,this.y*=I,this},divide:function(I){return new w(this.x/I,this.y/I)},divideEquals:function(I){return this.x/=I,this.y/=I,this},eq:function(I){return this.x===I.x&&this.y===I.y},lt:function(I){return this.x<I.x&&this.y<I.y},lte:function(I){return this.x<=I.x&&this.y<=I.y},gt:function(I){return this.x>I.x&&this.y>I.y},gte:function(I){return this.x>=I.x&&this.y>=I.y},lerp:function(I,m){return void 0===m&&(m=.5),m=Math.max(Math.min(1,m),0),new w(this.x+(I.x-this.x)*m,this.y+(I.y-this.y)*m)},distanceFrom:function(I){var m=this.x-I.x,v=this.y-I.y;return Math.sqrt(m*m+v*v)},midPointFrom:function(I){return this.lerp(I)},min:function(I){return new w(Math.min(this.x,I.x),Math.min(this.y,I.y))},max:function(I){return new w(Math.max(this.x,I.x),Math.max(this.y,I.y))},toString:function(){return this.x+","+this.y},setXY:function(I,m){return this.x=I,this.y=m,this},setX:function(I){return this.x=I,this},setY:function(I){return this.y=I,this},setFromPoint:function(I){return this.x=I.x,this.y=I.y,this},swap:function(I){var m=this.x,v=this.y;this.x=I.x,this.y=I.y,I.x=m,I.y=v},clone:function(){return new w(this.x,this.y)}})}(a),function(D){var y=D.fabric||(D.fabric={});function w(I){this.status=I,this.points=[]}y.Intersection?y.warn("fabric.Intersection is already defined"):(y.Intersection=w,y.Intersection.prototype={constructor:w,appendPoint:function(I){return this.points.push(I),this},appendPoints:function(I){return this.points=this.points.concat(I),this}},y.Intersection.intersectLineLine=function(I,m,v,T){var A,S=(T.x-v.x)*(I.y-v.y)-(T.y-v.y)*(I.x-v.x),x=(m.x-I.x)*(I.y-v.y)-(m.y-I.y)*(I.x-v.x),L=(T.y-v.y)*(m.x-I.x)-(T.x-v.x)*(m.y-I.y);if(0!==L){var N=S/L,B=x/L;0<=N&&N<=1&&0<=B&&B<=1?(A=new w("Intersection")).appendPoint(new y.Point(I.x+N*(m.x-I.x),I.y+N*(m.y-I.y))):A=new w}else A=new w(0===S||0===x?"Coincident":"Parallel");return A},y.Intersection.intersectLinePolygon=function(I,m,v){var S,x,L=new w,N=v.length;for(x=0;x<N;x++)S=w.intersectLineLine(I,m,v[x],v[(x+1)%N]),L.appendPoints(S.points);return L.points.length>0&&(L.status="Intersection"),L},y.Intersection.intersectPolygonPolygon=function(I,m){var v,T=new w,A=I.length;for(v=0;v<A;v++){var L=w.intersectLinePolygon(I[v],I[(v+1)%A],m);T.appendPoints(L.points)}return T.points.length>0&&(T.status="Intersection"),T},y.Intersection.intersectPolygonRectangle=function(I,m,v){var T=m.min(v),A=m.max(v),S=new y.Point(A.x,T.y),x=new y.Point(T.x,A.y),L=w.intersectLinePolygon(T,S,I),N=w.intersectLinePolygon(S,A,I),B=w.intersectLinePolygon(A,x,I),H=w.intersectLinePolygon(x,T,I),V=new w;return V.appendPoints(L.points),V.appendPoints(N.points),V.appendPoints(B.points),V.appendPoints(H.points),V.points.length>0&&(V.status="Intersection"),V})}(a),function(D){var y=D.fabric||(D.fabric={});function w(m){m?this._tryParsingColor(m):this.setSource([0,0,0,1])}function I(m,v,T){return T<0&&(T+=1),T>1&&(T-=1),T<1/6?m+6*(v-m)*T:T<.5?v:T<2/3?m+(v-m)*(2/3-T)*6:m}y.Color?y.warn("fabric.Color is already defined."):(y.Color=w,y.Color.prototype={_tryParsingColor:function(m){var v;m in w.colorNameMap&&(m=w.colorNameMap[m]),"transparent"===m&&(v=[255,255,255,0]),v||(v=w.sourceFromHex(m)),v||(v=w.sourceFromRgb(m)),v||(v=w.sourceFromHsl(m)),v||(v=[0,0,0,1]),v&&this.setSource(v)},_rgbToHsl:function(m,v,T){var A,S,x,L=y.util.array.max([m/=255,v/=255,T/=255]),N=y.util.array.min([m,v,T]);if(x=(L+N)/2,L===N)A=S=0;else{var B=L-N;switch(S=x>.5?B/(2-L-N):B/(L+N),L){case m:A=(v-T)/B+(v<T?6:0);break;case v:A=(T-m)/B+2;break;case T:A=(m-v)/B+4}A/=6}return[Math.round(360*A),Math.round(100*S),Math.round(100*x)]},getSource:function(){return this._source},setSource:function(m){this._source=m},toRgb:function(){var m=this.getSource();return"rgb("+m[0]+","+m[1]+","+m[2]+")"},toRgba:function(){var m=this.getSource();return"rgba("+m[0]+","+m[1]+","+m[2]+","+m[3]+")"},toHsl:function(){var m=this.getSource(),v=this._rgbToHsl(m[0],m[1],m[2]);return"hsl("+v[0]+","+v[1]+"%,"+v[2]+"%)"},toHsla:function(){var m=this.getSource(),v=this._rgbToHsl(m[0],m[1],m[2]);return"hsla("+v[0]+","+v[1]+"%,"+v[2]+"%,"+m[3]+")"},toHex:function(){var m,v,T,A=this.getSource();return m=1===(m=A[0].toString(16)).length?"0"+m:m,v=1===(v=A[1].toString(16)).length?"0"+v:v,T=1===(T=A[2].toString(16)).length?"0"+T:T,m.toUpperCase()+v.toUpperCase()+T.toUpperCase()},toHexa:function(){var m,v=this.getSource();return m=1===(m=(m=Math.round(255*v[3])).toString(16)).length?"0"+m:m,this.toHex()+m.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(m){var v=this.getSource();return v[3]=m,this.setSource(v),this},toGrayscale:function(){var m=this.getSource(),v=parseInt((.3*m[0]+.59*m[1]+.11*m[2]).toFixed(0),10);return this.setSource([v,v,v,m[3]]),this},toBlackWhite:function(m){var v=this.getSource(),T=(.3*v[0]+.59*v[1]+.11*v[2]).toFixed(0),A=v[3];return m=m||127,T=Number(T)<Number(m)?0:255,this.setSource([T,T,T,A]),this},overlayWith:function(m){m instanceof w||(m=new w(m));var v,T=[],A=this.getAlpha(),S=this.getSource(),x=m.getSource();for(v=0;v<3;v++)T.push(Math.round(.5*S[v]+.5*x[v]));return T[3]=A,this.setSource(T),this}},y.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,y.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,y.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,y.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},y.Color.fromRgb=function(m){return w.fromSource(w.sourceFromRgb(m))},y.Color.sourceFromRgb=function(m){var v=m.match(w.reRGBa);if(v){var T=parseInt(v[1],10)/(/%$/.test(v[1])?100:1)*(/%$/.test(v[1])?255:1),A=parseInt(v[2],10)/(/%$/.test(v[2])?100:1)*(/%$/.test(v[2])?255:1),S=parseInt(v[3],10)/(/%$/.test(v[3])?100:1)*(/%$/.test(v[3])?255:1);return[parseInt(T,10),parseInt(A,10),parseInt(S,10),v[4]?parseFloat(v[4]):1]}},y.Color.fromRgba=w.fromRgb,y.Color.fromHsl=function(m){return w.fromSource(w.sourceFromHsl(m))},y.Color.sourceFromHsl=function(m){var v=m.match(w.reHSLa);if(v){var T,A,S,x=(parseFloat(v[1])%360+360)%360/360,L=parseFloat(v[2])/(/%$/.test(v[2])?100:1),N=parseFloat(v[3])/(/%$/.test(v[3])?100:1);if(0===L)T=A=S=N;else{var B=N<=.5?N*(L+1):N+L-N*L,H=2*N-B;T=I(H,B,x+1/3),A=I(H,B,x),S=I(H,B,x-1/3)}return[Math.round(255*T),Math.round(255*A),Math.round(255*S),v[4]?parseFloat(v[4]):1]}},y.Color.fromHsla=w.fromHsl,y.Color.fromHex=function(m){return w.fromSource(w.sourceFromHex(m))},y.Color.sourceFromHex=function(m){if(m.match(w.reHex)){var v=m.slice(m.indexOf("#")+1),T=3===v.length||4===v.length,A=8===v.length||4===v.length,S=T?v.charAt(0)+v.charAt(0):v.substring(0,2),x=T?v.charAt(1)+v.charAt(1):v.substring(2,4),L=T?v.charAt(2)+v.charAt(2):v.substring(4,6),N=A?T?v.charAt(3)+v.charAt(3):v.substring(6,8):"FF";return[parseInt(S,16),parseInt(x,16),parseInt(L,16),parseFloat((parseInt(N,16)/255).toFixed(2))]}},y.Color.fromSource=function(m){var v=new w;return v.setSource(m),v})}(a),function(D){var y=D.fabric||(D.fabric={}),w=["e","se","s","sw","w","nw","n","ne","e"],I=["ns","nesw","ew","nwse"],m={},v="left",T="top",A="right",S="bottom",x="center",L={top:S,bottom:T,left:A,right:v,center:x},N=y.util.radiansToDegrees,B=Math.sign||function(te){return(te>0)-(te<0)||+te};function H(te,ee){var se=te.angle+N(Math.atan2(ee.y,ee.x))+360;return Math.round(se%360/45)}function V(te,ee){var se=ee.transform.target,fe=se.canvas,ce=y.util.object.clone(ee);ce.target=se,fe&&fe.fire("object:"+te,ce),se.fire(te,ee)}function W(te,ee){var se=ee.canvas,fe=te[se.uniScaleKey];return se.uniformScaling&&!fe||!se.uniformScaling&&fe}function q(te){return te.originX===x&&te.originY===x}function ne(te,ee,se){var fe=te.lockScalingX,ce=te.lockScalingY;return!((!fe||!ce)&&(ee||!fe&&!ce||!se)&&(!fe||"x"!==ee)&&(!ce||"y"!==ee))}function ie(te,ee,se,fe){return{e:te,transform:ee,pointer:{x:se,y:fe}}}function he(te){return function(ee,se,fe,ce){var pe=se.target,De=pe.getCenterPoint(),we=pe.translateToOriginPoint(De,se.originX,se.originY),ve=te(ee,se,fe,ce);return pe.setPositionByOrigin(we,se.originX,se.originY),ve}}function le(te,ee){return function(se,fe,ce,pe){var De=ee(se,fe,ce,pe);return De&&V(te,ie(se,fe,ce,pe)),De}}function oe(te,ee,se,fe,ce){var pe=te.target,De=pe.controls[te.corner],we=pe.canvas.getZoom(),ve=pe.padding/we,be=pe.toLocalPoint(new y.Point(fe,ce),ee,se);return be.x>=ve&&(be.x-=ve),be.x<=-ve&&(be.x+=ve),be.y>=ve&&(be.y-=ve),be.y<=ve&&(be.y+=ve),be.x-=De.offsetX,be.y-=De.offsetY,be}function J(te){return te.flipX!==te.flipY}function Q(te,ee,se,fe,ce){if(0!==te[ee]){var pe=ce/te._getTransformedDimensions()[fe]*te[se];te.set(se,pe)}}function re(te,ee,se,fe){var ce,pe=ee.target,De=pe._getTransformedDimensions(0,pe.skewY),we=oe(ee,ee.originX,ee.originY,se,fe),ve=Math.abs(2*we.x)-De.x,be=pe.skewX;ve<2?ce=0:(ce=N(Math.atan2(ve/pe.scaleX,De.y/pe.scaleY)),ee.originX===v&&ee.originY===S&&(ce=-ce),ee.originX===A&&ee.originY===T&&(ce=-ce),J(pe)&&(ce=-ce));var Ee=be!==ce;if(Ee){var Ie=pe._getTransformedDimensions().y;pe.set("skewX",ce),Q(pe,"skewY","scaleY","y",Ie)}return Ee}function ue(te,ee,se,fe){var ce,pe=ee.target,De=pe._getTransformedDimensions(pe.skewX,0),we=oe(ee,ee.originX,ee.originY,se,fe),ve=Math.abs(2*we.y)-De.y,be=pe.skewY;ve<2?ce=0:(ce=N(Math.atan2(ve/pe.scaleY,De.x/pe.scaleX)),ee.originX===v&&ee.originY===S&&(ce=-ce),ee.originX===A&&ee.originY===T&&(ce=-ce),J(pe)&&(ce=-ce));var Ee=be!==ce;if(Ee){var Ie=pe._getTransformedDimensions().x;pe.set("skewY",ce),Q(pe,"skewX","scaleX","x",Ie)}return Ee}function de(te,ee,se,fe,ce){var pe,De,we,ve,be,Ee,Ie=ee.target,ke=Ie.lockScalingX,Re=Ie.lockScalingY,rt=(ce=ce||{}).by,Et=W(te,Ie),Di=ne(Ie,rt,Et),Hr=ee.gestureScale;if(Di)return!1;if(Hr)De=ee.scaleX*Hr,we=ee.scaleY*Hr;else{if(pe=oe(ee,ee.originX,ee.originY,se,fe),be="y"!==rt?B(pe.x):1,Ee="x"!==rt?B(pe.y):1,ee.signX||(ee.signX=be),ee.signY||(ee.signY=Ee),Ie.lockScalingFlip&&(ee.signX!==be||ee.signY!==Ee))return!1;if(ve=Ie._getTransformedDimensions(),Et&&!rt){var Sa=Math.abs(pe.x)+Math.abs(pe.y),Vt=ee.original,Ti=Sa/(Math.abs(ve.x*Vt.scaleX/Ie.scaleX)+Math.abs(ve.y*Vt.scaleY/Ie.scaleY));De=Vt.scaleX*Ti,we=Vt.scaleY*Ti}else De=Math.abs(pe.x*Ie.scaleX/ve.x),we=Math.abs(pe.y*Ie.scaleY/ve.y);q(ee)&&(De*=2,we*=2),ee.signX!==be&&"y"!==rt&&(ee.originX=L[ee.originX],De*=-1,ee.signX=be),ee.signY!==Ee&&"x"!==rt&&(ee.originY=L[ee.originY],we*=-1,ee.signY=Ee)}var yc=Ie.scaleX,xa=Ie.scaleY;return rt?("x"===rt&&Ie.set("scaleX",De),"y"===rt&&Ie.set("scaleY",we)):(!ke&&Ie.set("scaleX",De),!Re&&Ie.set("scaleY",we)),yc!==Ie.scaleX||xa!==Ie.scaleY}m.scaleCursorStyleHandler=function(te,ee,se){var fe=W(te,se),ce="";if(0!==ee.x&&0===ee.y?ce="x":0===ee.x&&0!==ee.y&&(ce="y"),ne(se,ce,fe))return"not-allowed";var pe=H(se,ee);return w[pe]+"-resize"},m.skewCursorStyleHandler=function(te,ee,se){if(0!==ee.x&&se.lockSkewingY||0!==ee.y&&se.lockSkewingX)return"not-allowed";var ce=H(se,ee)%4;return I[ce]+"-resize"},m.scaleSkewCursorStyleHandler=function(te,ee,se){return te[se.canvas.altActionKey]?m.skewCursorStyleHandler(te,ee,se):m.scaleCursorStyleHandler(te,ee,se)},m.rotationWithSnapping=le("rotating",he(function(te,ee,se,fe){var ce=ee,pe=ce.target,De=pe.translateToOriginPoint(pe.getCenterPoint(),ce.originX,ce.originY);if(pe.lockRotation)return!1;var we,ve=Math.atan2(ce.ey-De.y,ce.ex-De.x),be=Math.atan2(fe-De.y,se-De.x),Ee=N(be-ve+ce.theta);if(pe.snapAngle>0){var Ie=pe.snapAngle,ke=pe.snapThreshold||Ie,Re=Math.ceil(Ee/Ie)*Ie,rt=Math.floor(Ee/Ie)*Ie;Math.abs(Ee-rt)<ke?Ee=rt:Math.abs(Ee-Re)<ke&&(Ee=Re)}return Ee<0&&(Ee=360+Ee),we=pe.angle!==(Ee%=360),pe.angle=Ee,we})),m.scalingEqually=le("scaling",he(function(te,ee,se,fe){return de(te,ee,se,fe)})),m.scalingX=le("scaling",he(function(te,ee,se,fe){return de(te,ee,se,fe,{by:"x"})})),m.scalingY=le("scaling",he(function(te,ee,se,fe){return de(te,ee,se,fe,{by:"y"})})),m.scalingYOrSkewingX=function(te,ee,se,fe){return te[ee.target.canvas.altActionKey]?m.skewHandlerX(te,ee,se,fe):m.scalingY(te,ee,se,fe)},m.scalingXOrSkewingY=function(te,ee,se,fe){return te[ee.target.canvas.altActionKey]?m.skewHandlerY(te,ee,se,fe):m.scalingX(te,ee,se,fe)},m.changeWidth=le("resizing",he(function(te,ee,se,fe){var ce=ee.target,pe=oe(ee,ee.originX,ee.originY,se,fe),De=ce.strokeWidth/(ce.strokeUniform?ce.scaleX:1),we=q(ee)?2:1,ve=ce.width,be=Math.abs(pe.x*we/ce.scaleX)-De;return ce.set("width",Math.max(be,0)),ve!==be})),m.skewHandlerX=function(te,ee,se,fe){var ce,pe=ee.target,De=pe.skewX,we=ee.originY;return!pe.lockSkewingX&&(0===De?ce=oe(ee,x,x,se,fe).x>0?v:A:(De>0&&(ce=we===T?v:A),De<0&&(ce=we===T?A:v),J(pe)&&(ce=ce===v?A:v)),ee.originX=ce,le("skewing",he(re))(te,ee,se,fe))},m.skewHandlerY=function(te,ee,se,fe){var ce,pe=ee.target,De=pe.skewY,we=ee.originX;return!pe.lockSkewingY&&(0===De?ce=oe(ee,x,x,se,fe).y>0?T:S:(De>0&&(ce=we===v?T:S),De<0&&(ce=we===v?S:T),J(pe)&&(ce=ce===T?S:T)),ee.originY=ce,le("skewing",he(ue))(te,ee,se,fe))},m.dragHandler=function(te,ee,se,fe){var ce=ee.target,pe=se-ee.offsetX,De=fe-ee.offsetY,we=!ce.get("lockMovementX")&&ce.left!==pe,ve=!ce.get("lockMovementY")&&ce.top!==De;return we&&ce.set("left",pe),ve&&ce.set("top",De),(we||ve)&&V("moving",ie(te,ee,se,fe)),we||ve},m.scaleOrSkewActionName=function(te,ee,se){var fe=te[se.canvas.altActionKey];return 0===ee.x?fe?"skewX":"scaleY":0===ee.y?fe?"skewY":"scaleX":void 0},m.rotationStyleHandler=function(te,ee,se){return se.lockRotation?"not-allowed":ee.cursorStyle},m.fireEvent=V,m.wrapWithFixedAnchor=he,m.wrapWithFireEvent=le,m.getLocalPoint=oe,y.controlsUtils=m}(a),y=(D=a).fabric||(D.fabric={}),w=y.util.degreesToRadians,(I=y.controlsUtils).renderCircleControl=function(m,v,T,A,S){A=A||{};var x,L=this.sizeX||A.cornerSize||S.cornerSize,N=this.sizeY||A.cornerSize||S.cornerSize,B=void 0!==A.transparentCorners?A.transparentCorners:S.transparentCorners,H=B?"stroke":"fill",V=!B&&(A.cornerStrokeColor||S.cornerStrokeColor),W=v,q=T;m.save(),m.fillStyle=A.cornerColor||S.cornerColor,m.strokeStyle=A.cornerStrokeColor||S.cornerStrokeColor,L>N?(x=L,m.scale(1,N/L),q=T*L/N):N>L?(x=N,m.scale(L/N,1),W=v*N/L):x=L,m.lineWidth=1,m.beginPath(),m.arc(W,q,x/2,0,2*Math.PI,!1),m[H](),V&&m.stroke(),m.restore()},I.renderSquareControl=function(m,v,T,A,S){A=A||{};var x=this.sizeX||A.cornerSize||S.cornerSize,L=this.sizeY||A.cornerSize||S.cornerSize,N=void 0!==A.transparentCorners?A.transparentCorners:S.transparentCorners,B=N?"stroke":"fill",H=!N&&(A.cornerStrokeColor||S.cornerStrokeColor),V=x/2,W=L/2;m.save(),m.fillStyle=A.cornerColor||S.cornerColor,m.strokeStyle=A.cornerStrokeColor||S.cornerStrokeColor,m.lineWidth=1,m.translate(v,T),m.rotate(w(S.angle)),m[B+"Rect"](-V,-W,x,L),H&&m.strokeRect(-V,-W,x,L),m.restore()},function(D){var y=D.fabric||(D.fabric={});y.Control=function(w){for(var I in w)this[I]=w[I]},y.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(w,I){return I.cursorStyle},getActionName:function(w,I){return I.actionName},getVisibility:function(w,I){var m=w._controlsVisibility;return m&&void 0!==m[I]?m[I]:this.visible},setVisibility:function(w){this.visible=w},positionHandler:function(w,I){return y.util.transformPoint({x:this.x*w.x+this.offsetX,y:this.y*w.y+this.offsetY},I)},calcCornerCoords:function(w,I,m,v,T){var A,S,x,L,N=T?this.touchSizeX:this.sizeX,B=T?this.touchSizeY:this.sizeY;if(N&&B&&N!==B){var H=Math.atan2(B,N),V=Math.sqrt(N*N+B*B)/2,W=H-y.util.degreesToRadians(w),q=Math.PI/2-H-y.util.degreesToRadians(w);A=V*y.util.cos(W),S=V*y.util.sin(W),x=V*y.util.cos(q),L=V*y.util.sin(q)}else V=.7071067812*(N&&B?N:I),W=y.util.degreesToRadians(45-w),A=x=V*y.util.cos(W),S=L=V*y.util.sin(W);return{tl:{x:m-L,y:v-x},tr:{x:m+A,y:v-S},bl:{x:m-A,y:v+S},br:{x:m+L,y:v+x}}},render:function(w,I,m,v,T){"circle"===((v=v||{}).cornerStyle||T.cornerStyle)?y.controlsUtils.renderCircleControl.call(this,w,I,m,v,T):y.controlsUtils.renderSquareControl.call(this,w,I,m,v,T)}}}(a),function(){function D(w,I){var m,v,T,A,S=w.getAttribute("style"),x=w.getAttribute("offset")||0;if(x=(x=parseFloat(x)/(/%$/.test(x)?100:1))<0?0:x>1?1:x,S){var L=S.split(/\s*;\s*/);for(""===L[L.length-1]&&L.pop(),A=L.length;A--;){var N=L[A].split(/\s*:\s*/),B=N[0].trim(),H=N[1].trim();"stop-color"===B?m=H:"stop-opacity"===B&&(T=H)}}return m||(m=w.getAttribute("stop-color")||"rgb(0,0,0)"),T||(T=w.getAttribute("stop-opacity")),v=(m=new F.Color(m)).getAlpha(),T=isNaN(parseFloat(T))?1:parseFloat(T),T*=v*I,{offset:x,color:m.toRgb(),opacity:T}}var y=F.util.object.clone;F.Gradient=F.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(w){w||(w={}),w.coords||(w.coords={});var I,m=this;Object.keys(w).forEach(function(v){m[v]=w[v]}),this.id?this.id+="_"+F.Object.__uid++:this.id=F.Object.__uid++,I={x1:w.coords.x1||0,y1:w.coords.y1||0,x2:w.coords.x2||0,y2:w.coords.y2||0},"radial"===this.type&&(I.r1=w.coords.r1||0,I.r2=w.coords.r2||0),this.coords=I,this.colorStops=w.colorStops.slice()},addColorStop:function(w){for(var I in w){var m=new F.Color(w[I]);this.colorStops.push({offset:parseFloat(I),color:m.toRgb(),opacity:m.getAlpha()})}return this},toObject:function(w){var I={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return F.util.populateWithProperties(this,I,w),I},toSVG:function(w,I){var m,v,T,A,S=y(this.coords,!0),x=(I=I||{},y(this.colorStops,!0)),L=S.r1>S.r2,N=this.gradientTransform?this.gradientTransform.concat():F.iMatrix.concat(),B=-this.offsetX,H=-this.offsetY,V=!!I.additionalTransform,W="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(he,le){return he.offset-le.offset}),"objectBoundingBox"===W?(B/=w.width,H/=w.height):(B+=w.width/2,H+=w.height/2),"path"===w.type&&"percentage"!==this.gradientUnits&&(B-=w.pathOffset.x,H-=w.pathOffset.y),N[4]-=B,N[5]-=H,A='id="SVGID_'+this.id+'" gradientUnits="'+W+'"',A+=' gradientTransform="'+(V?I.additionalTransform+" ":"")+F.util.matrixToSVG(N)+'" ',"linear"===this.type?T=["<linearGradient ",A,' x1="',S.x1,'" y1="',S.y1,'" x2="',S.x2,'" y2="',S.y2,'">\n']:"radial"===this.type&&(T=["<radialGradient ",A,' cx="',L?S.x1:S.x2,'" cy="',L?S.y1:S.y2,'" r="',L?S.r1:S.r2,'" fx="',L?S.x2:S.x1,'" fy="',L?S.y2:S.y1,'">\n']),"radial"===this.type){if(L)for((x=x.concat()).reverse(),m=0,v=x.length;m<v;m++)x[m].offset=1-x[m].offset;var q=Math.min(S.r1,S.r2);if(q>0){var ne=q/Math.max(S.r1,S.r2);for(m=0,v=x.length;m<v;m++)x[m].offset+=ne*(1-x[m].offset)}}for(m=0,v=x.length;m<v;m++){var ie=x[m];T.push("<stop ",'offset="',100*ie.offset+"%",'" style="stop-color:',ie.color,void 0!==ie.opacity?";stop-opacity: "+ie.opacity:";",'"/>\n')}return T.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),T.join("")},toLive:function(w){var I,m,v,T=F.util.object.clone(this.coords);if(this.type){for("linear"===this.type?I=w.createLinearGradient(T.x1,T.y1,T.x2,T.y2):"radial"===this.type&&(I=w.createRadialGradient(T.x1,T.y1,T.r1,T.x2,T.y2,T.r2)),m=0,v=this.colorStops.length;m<v;m++){var A=this.colorStops[m].color,S=this.colorStops[m].opacity,x=this.colorStops[m].offset;void 0!==S&&(A=new F.Color(A).setAlpha(S).toRgba()),I.addColorStop(x,A)}return I}}}),F.util.object.extend(F.Gradient,{fromElement:function(w,I,m,v){var T=parseFloat(m)/(/%$/.test(m)?100:1);T=T<0?0:T>1?1:T,isNaN(T)&&(T=1);var A,S,x,L,ne,ie,he,le,oe,J,N=w.getElementsByTagName("stop"),B="userSpaceOnUse"===w.getAttribute("gradientUnits")?"pixels":"percentage",H=w.getAttribute("gradientTransform")||"",V=[],W=0,q=0;for("linearGradient"===w.nodeName||"LINEARGRADIENT"===w.nodeName?(A="linear",S={x1:(ne=w).getAttribute("x1")||0,y1:ne.getAttribute("y1")||0,x2:ne.getAttribute("x2")||"100%",y2:ne.getAttribute("y2")||0}):(A="radial",S=function(ne){return{x1:ne.getAttribute("fx")||ne.getAttribute("cx")||"50%",y1:ne.getAttribute("fy")||ne.getAttribute("cy")||"50%",r1:0,x2:ne.getAttribute("cx")||"50%",y2:ne.getAttribute("cy")||"50%",r2:ne.getAttribute("r")||"50%"}}(w)),x=N.length;x--;)V.push(D(N[x],T));return L=F.parseTransformAttribute(H),ie=S,he=v,le=B,Object.keys(ie).forEach(function(Q){"Infinity"===(oe=ie[Q])?J=1:"-Infinity"===oe?J=0:(J=parseFloat(ie[Q],10),"string"==typeof oe&&/^(\d+\.\d+)%|(\d+)%$/.test(oe)&&(J*=.01,"pixels"===le&&("x1"!==Q&&"x2"!==Q&&"r2"!==Q||(J*=he.viewBoxWidth||he.width),"y1"!==Q&&"y2"!==Q||(J*=he.viewBoxHeight||he.height)))),ie[Q]=J}),"pixels"===B&&(W=-I.left,q=-I.top),new F.Gradient({id:w.getAttribute("id"),type:A,coords:S,colorStops:V,gradientUnits:B,gradientTransform:L,offsetX:W,offsetY:q})}})}(),X=F.util.toFixed,F.Pattern=F.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(D,y){if(D||(D={}),this.id=F.Object.__uid++,this.setOptions(D),!D.source||D.source&&"string"!=typeof D.source)y&&y(this);else{var w=this;this.source=F.util.createImage(),F.util.loadImage(D.source,function(I,m){w.source=I,y&&y(w,m)},null,this.crossOrigin)}},toObject:function(D){var y,w,I=F.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?y=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(y=this.source.toDataURL()),w={type:"pattern",source:y,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:X(this.offsetX,I),offsetY:X(this.offsetY,I),patternTransform:this.patternTransform?this.patternTransform.concat():null},F.util.populateWithProperties(this,w,D),w},toSVG:function(D){var y="function"==typeof this.source?this.source():this.source,w=y.width/D.width,I=y.height/D.height,m=this.offsetX/D.width,v=this.offsetY/D.height,T="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(I=1,v&&(I+=Math.abs(v))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(w=1,m&&(w+=Math.abs(m))),y.src?T=y.src:y.toDataURL&&(T=y.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+m+'" y="'+v+'" width="'+w+'" height="'+I+'">\n<image x="0" y="0" width="'+y.width+'" height="'+y.height+'" xlink:href="'+T+'"></image>\n</pattern>\n'},setOptions:function(D){for(var y in D)this[y]=D[y]},toLive:function(D){var y=this.source;return y&&(void 0===y.src||y.complete&&0!==y.naturalWidth&&0!==y.naturalHeight)?D.createPattern(y,this.repeat):""}}),function(D){var y=D.fabric||(D.fabric={}),w=y.util.toFixed;y.Shadow?y.warn("fabric.Shadow is already defined."):(y.Shadow=y.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(I){for(var m in"string"==typeof I&&(I=this._parseShadow(I)),I)this[m]=I[m];this.id=y.Object.__uid++},_parseShadow:function(I){var m=I.trim(),v=y.Shadow.reOffsetsAndBlur.exec(m)||[];return{color:(m.replace(y.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(v[1],10)||0,offsetY:parseFloat(v[2],10)||0,blur:parseFloat(v[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(I){var m=40,v=40,T=y.Object.NUM_FRACTION_DIGITS,A=y.util.rotateVector({x:this.offsetX,y:this.offsetY},y.util.degreesToRadians(-I.angle)),S=new y.Color(this.color);return I.width&&I.height&&(m=100*w((Math.abs(A.x)+this.blur)/I.width,T)+20,v=100*w((Math.abs(A.y)+this.blur)/I.height,T)+20),I.flipX&&(A.x*=-1),I.flipY&&(A.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+v+'%" height="'+(100+2*v)+'%" x="-'+m+'%" width="'+(100+2*m)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+w(this.blur?this.blur/2:0,T)+'"></feGaussianBlur>\n\t<feOffset dx="'+w(A.x,T)+'" dy="'+w(A.y,T)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+S.toRgb()+'" flood-opacity="'+S.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var I={},m=y.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(v){this[v]!==m[v]&&(I[v]=this[v])},this),I}}),y.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(a),function(){if(F.StaticCanvas)F.warn("fabric.StaticCanvas is already defined.");else{var D=F.util.object.extend,y=F.util.getElementOffset,w=F.util.removeFromArray,I=F.util.toFixed,m=F.util.transformPoint,v=F.util.invertTransform,T=F.util.getNodeCanvas,A=F.util.createCanvasElement,S=new Error("Could not initialize `canvas` element");F.StaticCanvas=F.util.createClass(F.CommonMethods,{initialize:function(x,L){L||(L={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(x,L)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:F.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(x,L){var N=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(x),this._initOptions(L),this.interactive||this._initRetinaScaling(),L.overlayImage&&this.setOverlayImage(L.overlayImage,N),L.backgroundImage&&this.setBackgroundImage(L.backgroundImage,N),L.backgroundColor&&this.setBackgroundColor(L.backgroundColor,N),L.overlayColor&&this.setOverlayColor(L.overlayColor,N),this.calcOffset()},_isRetinaScaling:function(){return F.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,F.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var x=F.devicePixelRatio;this.__initRetinaScaling(x,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(x,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(x,L,N){L.setAttribute("width",this.width*x),L.setAttribute("height",this.height*x),N.scale(x,x)},calcOffset:function(){return this._offset=y(this.lowerCanvasEl),this},setOverlayImage:function(x,L,N){return this.__setBgOverlayImage("overlayImage",x,L,N)},setBackgroundImage:function(x,L,N){return this.__setBgOverlayImage("backgroundImage",x,L,N)},setOverlayColor:function(x,L){return this.__setBgOverlayColor("overlayColor",x,L)},setBackgroundColor:function(x,L){return this.__setBgOverlayColor("backgroundColor",x,L)},__setBgOverlayImage:function(x,L,N,B){return"string"==typeof L?F.util.loadImage(L,function(H,V){if(H){var W=new F.Image(H,B);this[x]=W,W.canvas=this}N&&N(H,V)},this,B&&B.crossOrigin):(B&&L.setOptions(B),this[x]=L,L&&(L.canvas=this),N&&N(L,!1)),this},__setBgOverlayColor:function(x,L,N){return this[x]=L,this._initGradient(L,x),this._initPattern(L,x,N),this},_createCanvasElement:function(){var x=A();if(!x||(x.style||(x.style={}),void 0===x.getContext))throw S;return x},_initOptions:function(x){var L=this.lowerCanvasEl;this._setOptions(x),this.width=this.width||parseInt(L.width,10)||0,this.height=this.height||parseInt(L.height,10)||0,this.lowerCanvasEl.style&&(L.width=this.width,L.height=this.height,L.style.width=this.width+"px",L.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(x){this.lowerCanvasEl=x&&x.getContext?x:F.util.getById(x)||this._createCanvasElement(),F.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(x,L){return this.setDimensions({width:x},L)},setHeight:function(x,L){return this.setDimensions({height:x},L)},setDimensions:function(x,L){var N;for(var B in L=L||{},x)N=x[B],L.cssOnly||(this._setBackstoreDimension(B,x[B]),N+="px",this.hasLostContext=!0),L.backstoreOnly||this._setCssDimension(B,N);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),L.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(x,L){return this.lowerCanvasEl[x]=L,this.upperCanvasEl&&(this.upperCanvasEl[x]=L),this.cacheCanvasEl&&(this.cacheCanvasEl[x]=L),this[x]=L,this},_setCssDimension:function(x,L){return this.lowerCanvasEl.style[x]=L,this.upperCanvasEl&&(this.upperCanvasEl.style[x]=L),this.wrapperEl&&(this.wrapperEl.style[x]=L),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(x){var L,N,B,H=this._activeObject,V=this.backgroundImage,W=this.overlayImage;for(this.viewportTransform=x,N=0,B=this._objects.length;N<B;N++)(L=this._objects[N]).group||L.setCoords(!0);return H&&H.setCoords(),V&&V.setCoords(!0),W&&W.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(x,L){var N=x,B=this.viewportTransform.slice(0);x=m(x,v(this.viewportTransform)),B[0]=L,B[3]=L;var H=m(x,B);return B[4]+=N.x-H.x,B[5]+=N.y-H.y,this.setViewportTransform(B)},setZoom:function(x){return this.zoomToPoint(new F.Point(0,0),x),this},absolutePan:function(x){var L=this.viewportTransform.slice(0);return L[4]=-x.x,L[5]=-x.y,this.setViewportTransform(L)},relativePan:function(x){return this.absolutePan(new F.Point(-x.x-this.viewportTransform[4],-x.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(x){this.stateful&&x.setupState(),x._set("canvas",this),x.setCoords(),this.fire("object:added",{target:x}),x.fire("added")},_onObjectRemoved:function(x){this.fire("object:removed",{target:x}),x.fire("removed"),delete x.canvas},clearContext:function(x){return x.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=F.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var x={},L=this.width,N=this.height,B=v(this.viewportTransform);return x.tl=m({x:0,y:0},B),x.br=m({x:L,y:N},B),x.tr=new F.Point(x.br.x,x.tl.y),x.bl=new F.Point(x.tl.x,x.br.y),this.vptCoords=x,x},cancelRequestedRender:function(){this.isRendering&&(F.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(x,L){var N=this.viewportTransform,B=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(x),F.util.setImageSmoothing(x,this.imageSmoothingEnabled),this.fire("before:render",{ctx:x}),this._renderBackground(x),x.save(),x.transform(N[0],N[1],N[2],N[3],N[4],N[5]),this._renderObjects(x,L),x.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(x),B&&(B.canvas=this,B.shouldCache(),B._transformDone=!0,B.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(x)),this._renderOverlay(x),this.controlsAboveOverlay&&this.interactive&&this.drawControls(x),this.fire("after:render",{ctx:x})},drawClipPathOnCanvas:function(x){var L=this.viewportTransform,N=this.clipPath;x.save(),x.transform(L[0],L[1],L[2],L[3],L[4],L[5]),x.globalCompositeOperation="destination-in",N.transform(x),x.scale(1/N.zoomX,1/N.zoomY),x.drawImage(N._cacheCanvas,-N.cacheTranslationX,-N.cacheTranslationY),x.restore()},_renderObjects:function(x,L){var N,B;for(N=0,B=L.length;N<B;++N)L[N]&&L[N].render(x)},_renderBackgroundOrOverlay:function(x,L){var N=this[L+"Color"],B=this[L+"Image"],H=this.viewportTransform,V=this[L+"Vpt"];if(N||B){if(N){x.save(),x.beginPath(),x.moveTo(0,0),x.lineTo(this.width,0),x.lineTo(this.width,this.height),x.lineTo(0,this.height),x.closePath(),x.fillStyle=N.toLive?N.toLive(x,this):N,V&&x.transform(H[0],H[1],H[2],H[3],H[4],H[5]),x.transform(1,0,0,1,N.offsetX||0,N.offsetY||0);var W=N.gradientTransform||N.patternTransform;W&&x.transform(W[0],W[1],W[2],W[3],W[4],W[5]),x.fill(),x.restore()}B&&(x.save(),V&&x.transform(H[0],H[1],H[2],H[3],H[4],H[5]),B.render(x),x.restore())}},_renderBackground:function(x){this._renderBackgroundOrOverlay(x,"background")},_renderOverlay:function(x){this._renderBackgroundOrOverlay(x,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new F.Point(this.width/2,this.height/2)},centerObjectH:function(x){return this._centerObject(x,new F.Point(this.getCenterPoint().x,x.getCenterPoint().y))},centerObjectV:function(x){return this._centerObject(x,new F.Point(x.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(x){var L=this.getCenterPoint();return this._centerObject(x,L)},viewportCenterObject:function(x){var L=this.getVpCenter();return this._centerObject(x,L)},viewportCenterObjectH:function(x){var L=this.getVpCenter();return this._centerObject(x,new F.Point(L.x,x.getCenterPoint().y)),this},viewportCenterObjectV:function(x){var L=this.getVpCenter();return this._centerObject(x,new F.Point(x.getCenterPoint().x,L.y))},getVpCenter:function(){var x=this.getCenterPoint(),L=v(this.viewportTransform);return m(x,L)},_centerObject:function(x,L){return x.setPositionByOrigin(L,"center","center"),x.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(x){return this.toDatalessObject(x)},toObject:function(x){return this._toObjectMethod("toObject",x)},toDatalessObject:function(x){return this._toObjectMethod("toDatalessObject",x)},_toObjectMethod:function(x,L){var N=this.clipPath,B={version:F.version,objects:this._toObjects(x,L)};return N&&!N.excludeFromExport&&(B.clipPath=this._toObject(this.clipPath,x,L)),D(B,this.__serializeBgOverlay(x,L)),F.util.populateWithProperties(this,B,L),B},_toObjects:function(x,L){return this._objects.filter(function(N){return!N.excludeFromExport}).map(function(N){return this._toObject(N,x,L)},this)},_toObject:function(x,L,N){var B;this.includeDefaultValues||(B=x.includeDefaultValues,x.includeDefaultValues=!1);var H=x[L](N);return this.includeDefaultValues||(x.includeDefaultValues=B),H},__serializeBgOverlay:function(x,L){var N={},B=this.backgroundImage,H=this.overlayImage,V=this.backgroundColor,W=this.overlayColor;return V&&V.toObject?V.excludeFromExport||(N.background=V.toObject(L)):V&&(N.background=V),W&&W.toObject?W.excludeFromExport||(N.overlay=W.toObject(L)):W&&(N.overlay=W),B&&!B.excludeFromExport&&(N.backgroundImage=this._toObject(B,x,L)),H&&!H.excludeFromExport&&(N.overlayImage=this._toObject(H,x,L)),N},svgViewportTransformation:!0,toSVG:function(x,L){x||(x={}),x.reviver=L;var N=[];return this._setSVGPreamble(N,x),this._setSVGHeader(N,x),this.clipPath&&N.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(N,"background"),this._setSVGBgOverlayImage(N,"backgroundImage",L),this._setSVGObjects(N,L),this.clipPath&&N.push("</g>\n"),this._setSVGBgOverlayColor(N,"overlay"),this._setSVGBgOverlayImage(N,"overlayImage",L),N.push("</svg>"),N.join("")},_setSVGPreamble:function(x,L){L.suppressPreamble||x.push('<?xml version="1.0" encoding="',L.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(x,L){var N,B=L.width||this.width,H=L.height||this.height,V='viewBox="0 0 '+this.width+" "+this.height+'" ',W=F.Object.NUM_FRACTION_DIGITS;L.viewBox?V='viewBox="'+L.viewBox.x+" "+L.viewBox.y+" "+L.viewBox.width+" "+L.viewBox.height+'" ':this.svgViewportTransformation&&(V='viewBox="'+I(-(N=this.viewportTransform)[4]/N[0],W)+" "+I(-N[5]/N[3],W)+" "+I(this.width/N[0],W)+" "+I(this.height/N[3],W)+'" '),x.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',B,'" ','height="',H,'" ',V,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",F.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(L),"</defs>\n")},createSVGClipPathMarkup:function(x){var L=this.clipPath;return L?(L.clipPathId="CLIPPATH_"+F.Object.__uid++,'<clipPath id="'+L.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(x.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var x=this;return["background","overlay"].map(function(L){var N=x[L+"Color"];if(N&&N.toLive){var B=x[L+"Vpt"],H=x.viewportTransform;return N.toSVG({width:x.width/(B?H[0]:1),height:x.height/(B?H[3]:1)},{additionalTransform:B?F.util.matrixToSVG(H):""})}}).join("")},createSVGFontFacesMarkup:function(){var x,L,N,B,H,V,W,q,ne="",ie={},he=F.fontPaths,le=[];for(this._objects.forEach(function J(Q){le.push(Q),Q._objects&&Q._objects.forEach(J)}),W=0,q=le.length;W<q;W++)if(L=(x=le[W]).fontFamily,-1!==x.type.indexOf("text")&&!ie[L]&&he[L]&&(ie[L]=!0,x.styles))for(H in N=x.styles)for(V in B=N[H])!ie[L=B[V].fontFamily]&&he[L]&&(ie[L]=!0);for(var oe in ie)ne+=["\t\t@font-face {\n","\t\t\tfont-family: '",oe,"';\n","\t\t\tsrc: url('",he[oe],"');\n","\t\t}\n"].join("");return ne&&(ne=['\t<style type="text/css">',"<![CDATA[\n",ne,"]]>","</style>\n"].join("")),ne},_setSVGObjects:function(x,L){var N,B,H,V=this._objects;for(B=0,H=V.length;B<H;B++)(N=V[B]).excludeFromExport||this._setSVGObject(x,N,L)},_setSVGObject:function(x,L,N){x.push(L.toSVG(N))},_setSVGBgOverlayImage:function(x,L,N){this[L]&&!this[L].excludeFromExport&&this[L].toSVG&&x.push(this[L].toSVG(N))},_setSVGBgOverlayColor:function(x,L){var N=this[L+"Color"],H=this.width,V=this.height;if(N)if(N.toLive){var W=N.repeat,q=F.util.invertTransform(this.viewportTransform),ne=this[L+"Vpt"]?F.util.matrixToSVG(q):"";x.push('<rect transform="'+ne+" translate(",H/2,",",V/2,')"',' x="',N.offsetX-H/2,'" y="',N.offsetY-V/2,'" ','width="',"repeat-y"===W||"no-repeat"===W?N.source.width:H,'" height="',"repeat-x"===W||"no-repeat"===W?N.source.height:V,'" fill="url(#SVGID_'+N.id+')"',"></rect>\n")}else x.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',N,'"',"></rect>\n")},sendToBack:function(x){if(!x)return this;var L,N,B,H=this._activeObject;if(x===H&&"activeSelection"===x.type)for(L=(B=H._objects).length;L--;)w(this._objects,N=B[L]),this._objects.unshift(N);else w(this._objects,x),this._objects.unshift(x);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(x){if(!x)return this;var L,N,B,H=this._activeObject;if(x===H&&"activeSelection"===x.type)for(B=H._objects,L=0;L<B.length;L++)w(this._objects,N=B[L]),this._objects.push(N);else w(this._objects,x),this._objects.push(x);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(x,L){if(!x)return this;var N,B,H,V,W,q=this._activeObject,ne=0;if(x===q&&"activeSelection"===x.type)for(W=q._objects,N=0;N<W.length;N++)(H=this._objects.indexOf(B=W[N]))>0+ne&&(V=H-1,w(this._objects,B),this._objects.splice(V,0,B)),ne++;else 0!==(H=this._objects.indexOf(x))&&(V=this._findNewLowerIndex(x,H,L),w(this._objects,x),this._objects.splice(V,0,x));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(x,L,N){var B,H;if(N){for(B=L,H=L-1;H>=0;--H)if(x.intersectsWithObject(this._objects[H])||x.isContainedWithinObject(this._objects[H])||this._objects[H].isContainedWithinObject(x)){B=H;break}}else B=L-1;return B},bringForward:function(x,L){if(!x)return this;var N,B,H,V,W,q=this._activeObject,ne=0;if(x===q&&"activeSelection"===x.type)for(N=(W=q._objects).length;N--;)(H=this._objects.indexOf(B=W[N]))<this._objects.length-1-ne&&(V=H+1,w(this._objects,B),this._objects.splice(V,0,B)),ne++;else(H=this._objects.indexOf(x))!==this._objects.length-1&&(V=this._findNewUpperIndex(x,H,L),w(this._objects,x),this._objects.splice(V,0,x));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(x,L,N){var B,H,V;if(N){for(B=L,H=L+1,V=this._objects.length;H<V;++H)if(x.intersectsWithObject(this._objects[H])||x.isContainedWithinObject(this._objects[H])||this._objects[H].isContainedWithinObject(x)){B=H;break}}else B=L+1;return B},moveTo:function(x,L){return w(this._objects,x),this._objects.splice(L,0,x),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(F.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(x){x.dispose&&x.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),F.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),F.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),D(F.StaticCanvas.prototype,F.Observable),D(F.StaticCanvas.prototype,F.Collection),D(F.StaticCanvas.prototype,F.DataURLExporter),D(F.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(x){var L=A();if(!L||!L.getContext)return null;var N=L.getContext("2d");return N&&"setLineDash"===x?void 0!==N.setLineDash:null}}),F.StaticCanvas.prototype.toJSON=F.StaticCanvas.prototype.toObject,F.isLikelyNode&&(F.StaticCanvas.prototype.createPNGStream=function(){var x=T(this.lowerCanvasEl);return x&&x.createPNGStream()},F.StaticCanvas.prototype.createJPEGStream=function(x){var L=T(this.lowerCanvasEl);return L&&L.createJPEGStream(x)})}}(),F.BaseBrush=F.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(D){D.strokeStyle=this.color,D.lineWidth=this.width,D.lineCap=this.strokeLineCap,D.miterLimit=this.strokeMiterLimit,D.lineJoin=this.strokeLineJoin,D.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(D){var y=this.canvas.viewportTransform;D.save(),D.transform(y[0],y[1],y[2],y[3],y[4],y[5])},_setShadow:function(){if(this.shadow){var D=this.canvas,y=this.shadow,w=D.contextTop,I=D.getZoom();D&&D._isRetinaScaling()&&(I*=F.devicePixelRatio),w.shadowColor=y.color,w.shadowBlur=y.blur*I,w.shadowOffsetX=y.offsetX*I,w.shadowOffsetY=y.offsetY*I}},needsFullRender:function(){return new F.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var D=this.canvas.contextTop;D.shadowColor="",D.shadowBlur=D.shadowOffsetX=D.shadowOffsetY=0},_isOutSideCanvas:function(D){return D.x<0||D.x>this.canvas.getWidth()||D.y<0||D.y>this.canvas.getHeight()}}),F.PencilBrush=F.util.createClass(F.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(D){this.canvas=D,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(D,y,w){var I=y.midPointFrom(w);return D.quadraticCurveTo(y.x,y.y,I.x,I.y),I},onMouseDown:function(D,y){this.canvas._isMainEvent(y.e)&&(this.drawStraightLine=y.e[this.straightLineKey],this._prepareForDrawing(D),this._captureDrawingPath(D),this._render())},onMouseMove:function(D,y){if(this.canvas._isMainEvent(y.e)&&(this.drawStraightLine=y.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(D))&&this._captureDrawingPath(D)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var w=this._points,I=w.length,m=this.canvas.contextTop;this._saveAndTransform(m),this.oldEnd&&(m.beginPath(),m.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(m,w[I-2],w[I-1],!0),m.stroke(),m.restore()}},onMouseUp:function(D){return!this.canvas._isMainEvent(D.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(D){var y=new F.Point(D.x,D.y);this._reset(),this._addPoint(y),this.canvas.contextTop.moveTo(y.x,y.y)},_addPoint:function(D){return!(this._points.length>1&&D.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(D),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(D){var y=new F.Point(D.x,D.y);return this._addPoint(y)},_render:function(D){var y,w,I=this._points[0],m=this._points[1];if(this._saveAndTransform(D=D||this.canvas.contextTop),D.beginPath(),2===this._points.length&&I.x===m.x&&I.y===m.y){var v=this.width/1e3;I=new F.Point(I.x,I.y),m=new F.Point(m.x,m.y),I.x-=v,m.x+=v}for(D.moveTo(I.x,I.y),y=1,w=this._points.length;y<w;y++)this._drawSegment(D,I,m),I=this._points[y],m=this._points[y+1];D.lineTo(I.x,I.y),D.stroke(),D.restore()},convertPointsToSVGPath:function(D){return F.util.getSmoothPathFromPoints(D,this.width/1e3)},_isEmptySVGPath:function(D){return"M 0 0 Q 0 0 0 0 L 0 0"===F.util.joinPath(D)},createPath:function(D){var y=new F.Path(D,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,y.shadow=new F.Shadow(this.shadow)),y},decimatePoints:function(D,y){if(D.length<=2)return D;var w,I=this.canvas.getZoom(),m=Math.pow(y/I,2),v=D.length-1,T=D[0],A=[T];for(w=1;w<v-1;w++)Math.pow(T.x-D[w].x,2)+Math.pow(T.y-D[w].y,2)>=m&&A.push(T=D[w]);return A.push(D[v]),A},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var D=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(D))this.canvas.requestRenderAll();else{var y=this.createPath(D);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:y}),this.canvas.add(y),this.canvas.requestRenderAll(),y.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:y})}}}),F.CircleBrush=F.util.createClass(F.BaseBrush,{width:10,initialize:function(D){this.canvas=D,this.points=[]},drawDot:function(D){var y=this.addPoint(D),w=this.canvas.contextTop;this._saveAndTransform(w),this.dot(w,y),w.restore()},dot:function(D,y){D.fillStyle=y.fill,D.beginPath(),D.arc(y.x,y.y,y.radius,0,2*Math.PI,!1),D.closePath(),D.fill()},onMouseDown:function(D){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(D)},_render:function(){var D,y,w=this.canvas.contextTop,I=this.points;for(this._saveAndTransform(w),D=0,y=I.length;D<y;D++)this.dot(w,I[D]);w.restore()},onMouseMove:function(D){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(D)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(D),this._render()):this.drawDot(D))},onMouseUp:function(){var D,y,w=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var I=[];for(D=0,y=this.points.length;D<y;D++){var m=this.points[D],v=new F.Circle({radius:m.radius,left:m.x,top:m.y,originX:"center",originY:"center",fill:m.fill});this.shadow&&(v.shadow=new F.Shadow(this.shadow)),I.push(v)}var T=new F.Group(I);T.canvas=this.canvas,this.canvas.fire("before:path:created",{path:T}),this.canvas.add(T),this.canvas.fire("path:created",{path:T}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=w,this.canvas.requestRenderAll()},addPoint:function(D){var y=new F.Point(D.x,D.y),w=F.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,I=new F.Color(this.color).setAlpha(F.util.getRandomInt(0,100)/100).toRgba();return y.radius=w,y.fill=I,this.points.push(y),y}}),F.SprayBrush=F.util.createClass(F.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(D){this.canvas=D,this.sprayChunks=[]},onMouseDown:function(D){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(D),this.render(this.sprayChunkPoints)},onMouseMove:function(D){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(D)||(this.addSprayChunk(D),this.render(this.sprayChunkPoints))},onMouseUp:function(){var D=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var y=[],w=0,I=this.sprayChunks.length;w<I;w++)for(var m=this.sprayChunks[w],v=0,T=m.length;v<T;v++){var A=new F.Rect({width:m[v].width,height:m[v].width,left:m[v].x+1,top:m[v].y+1,originX:"center",originY:"center",fill:this.color});y.push(A)}this.optimizeOverlapping&&(y=this._getOptimizedRects(y));var S=new F.Group(y);this.shadow&&S.set("shadow",new F.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:S}),this.canvas.add(S),this.canvas.fire("path:created",{path:S}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=D,this.canvas.requestRenderAll()},_getOptimizedRects:function(D){var y,w,I,m={};for(w=0,I=D.length;w<I;w++)m[y=D[w].left+""+D[w].top]||(m[y]=D[w]);var v=[];for(y in m)v.push(m[y]);return v},render:function(D){var y,w,I=this.canvas.contextTop;for(I.fillStyle=this.color,this._saveAndTransform(I),y=0,w=D.length;y<w;y++){var m=D[y];void 0!==m.opacity&&(I.globalAlpha=m.opacity),I.fillRect(m.x,m.y,m.width,m.width)}I.restore()},_render:function(){var D,y,w=this.canvas.contextTop;for(w.fillStyle=this.color,this._saveAndTransform(w),D=0,y=this.sprayChunks.length;D<y;D++)this.render(this.sprayChunks[D]);w.restore()},addSprayChunk:function(D){this.sprayChunkPoints=[];var y,w,I,m,v=this.width/2;for(m=0;m<this.density;m++){y=F.util.getRandomInt(D.x-v,D.x+v),w=F.util.getRandomInt(D.y-v,D.y+v),I=this.dotWidthVariance?F.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var T=new F.Point(y,w);T.width=I,this.randomOpacity&&(T.opacity=F.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(T)}this.sprayChunks.push(this.sprayChunkPoints)}}),F.PatternBrush=F.util.createClass(F.PencilBrush,{getPatternSrc:function(){var D=F.util.createCanvasElement(),y=D.getContext("2d");return D.width=D.height=25,y.fillStyle=this.color,y.beginPath(),y.arc(10,10,10,0,2*Math.PI,!1),y.closePath(),y.fill(),D},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(D){return D.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(D){this.callSuper("_setBrushStyles",D),D.strokeStyle=this.getPattern(D)},createPath:function(D){var y=this.callSuper("createPath",D),w=y._getLeftTopCoords().scalarAdd(y.strokeWidth/2);return y.stroke=new F.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-w.x,offsetY:-w.y}),y}}),function(){var D=F.util.getPointer,y=F.util.degreesToRadians,w=F.util.isTouchEvent;for(var I in F.Canvas=F.util.createClass(F.StaticCanvas,{initialize:function(m,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(m,v),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=F.PencilBrush&&new F.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var m,v,T,A=this.getActiveObjects();if(A.length>0&&!this.preserveObjectStacking){v=[],T=[];for(var S=0,x=this._objects.length;S<x;S++)-1===A.indexOf(m=this._objects[S])?v.push(m):T.push(m);A.length>1&&(this._activeObject._objects=T),v.push.apply(v,T)}else v=this._objects;return v},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(m){m.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(m),this.contextTopDirty=!0),m.restore()},renderTop:function(){var m=this.contextTop;return this.clearContext(m),this.renderTopLayer(m),this.fire("after:render"),this},_normalizePointer:function(m,v){var T=m.calcTransformMatrix(),A=F.util.invertTransform(T),S=this.restorePointerVpt(v);return F.util.transformPoint(S,A)},isTargetTransparent:function(m,v,T){if(m.shouldCache()&&m._cacheCanvas&&m!==this._activeObject){var A=this._normalizePointer(m,{x:v,y:T}),S=Math.max(m.cacheTranslationX+A.x*m.zoomX,0),x=Math.max(m.cacheTranslationY+A.y*m.zoomY,0);return F.util.isTransparent(m._cacheContext,Math.round(S),Math.round(x),this.targetFindTolerance)}var L=this.contextCache,N=m.selectionBackgroundColor,B=this.viewportTransform;return m.selectionBackgroundColor="",this.clearContext(L),L.save(),L.transform(B[0],B[1],B[2],B[3],B[4],B[5]),m.render(L),L.restore(),m.selectionBackgroundColor=N,F.util.isTransparent(L,v,T,this.targetFindTolerance)},_isSelectionKeyPressed:function(m){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(v){return!0===m[v]}):m[this.selectionKey]},_shouldClearSelection:function(m,v){var T=this.getActiveObjects(),A=this._activeObject;return!v||v&&A&&T.length>1&&-1===T.indexOf(v)&&A!==v&&!this._isSelectionKeyPressed(m)||v&&!v.evented||v&&!v.selectable&&A&&A!==v},_shouldCenterTransform:function(m,v,T){var A;if(m)return"scale"===v||"scaleX"===v||"scaleY"===v||"resizing"===v?A=this.centeredScaling||m.centeredScaling:"rotate"===v&&(A=this.centeredRotation||m.centeredRotation),A?!T:T},_getOriginFromCorner:function(m,v){var T={x:m.originX,y:m.originY};return"ml"===v||"tl"===v||"bl"===v?T.x="right":"mr"!==v&&"tr"!==v&&"br"!==v||(T.x="left"),"tl"===v||"mt"===v||"tr"===v?T.y="bottom":"bl"!==v&&"mb"!==v&&"br"!==v||(T.y="top"),T},_getActionFromCorner:function(m,v,T,A){if(!v||!m)return"drag";var S=A.controls[v];return S.getActionName(T,S,A)},_setupCurrentTransform:function(m,v,T){if(v){var A=this.getPointer(m),S=v.__corner,x=v.controls[S],L=T&&S?x.getActionHandler(m,v,x):F.controlsUtils.dragHandler,N=this._getActionFromCorner(T,S,m,v),B=this._getOriginFromCorner(v,S),H=m[this.centeredKey],V={target:v,action:N,actionHandler:L,corner:S,scaleX:v.scaleX,scaleY:v.scaleY,skewX:v.skewX,skewY:v.skewY,offsetX:A.x-v.left,offsetY:A.y-v.top,originX:B.x,originY:B.y,ex:A.x,ey:A.y,lastX:A.x,lastY:A.y,theta:y(v.angle),width:v.width*v.scaleX,shiftKey:m.shiftKey,altKey:H,original:F.util.saveObjectTransform(v)};this._shouldCenterTransform(v,N,H)&&(V.originX="center",V.originY="center"),V.original.originX=B.x,V.original.originY=B.y,this._currentTransform=V,this._beforeTransform(m)}},setCursor:function(m){this.upperCanvasEl.style.cursor=m},_drawSelection:function(m){var v=this._groupSelector,T=new F.Point(v.ex,v.ey),A=F.util.transformPoint(T,this.viewportTransform),S=new F.Point(v.ex+v.left,v.ey+v.top),x=F.util.transformPoint(S,this.viewportTransform),L=Math.min(A.x,x.x),N=Math.min(A.y,x.y),B=Math.max(A.x,x.x),H=Math.max(A.y,x.y),V=this.selectionLineWidth/2;this.selectionColor&&(m.fillStyle=this.selectionColor,m.fillRect(L,N,B-L,H-N)),this.selectionLineWidth&&this.selectionBorderColor&&(m.lineWidth=this.selectionLineWidth,m.strokeStyle=this.selectionBorderColor,L+=V,N+=V,B-=V,H-=V,F.Object.prototype._setLineDash.call(this,m,this.selectionDashArray),m.strokeRect(L,N,B-L,H-N))},findTarget:function(m,v){if(!this.skipTargetFind){var T,A,S=this.getPointer(m,!0),x=this._activeObject,L=this.getActiveObjects(),N=w(m),B=L.length>1&&!v||1===L.length;if(this.targets=[],B&&x._findTargetCorner(S,N)||L.length>1&&!v&&x===this._searchPossibleTargets([x],S))return x;if(1===L.length&&x===this._searchPossibleTargets([x],S)){if(!this.preserveObjectStacking)return x;T=x,A=this.targets,this.targets=[]}var H=this._searchPossibleTargets(this._objects,S);return m[this.altSelectionKey]&&H&&T&&H!==T&&(H=T,this.targets=A),H}},_checkTarget:function(m,v,T){if(v&&v.visible&&v.evented&&v.containsPoint(m)&&(!this.perPixelTargetFind&&!v.perPixelTargetFind||v.isEditing||!this.isTargetTransparent(v,T.x,T.y)))return!0},_searchPossibleTargets:function(m,v){for(var T,A,S=m.length;S--;){var x=m[S],L=x.group?this._normalizePointer(x.group,v):v;if(this._checkTarget(L,x,v)){(T=m[S]).subTargetCheck&&T instanceof F.Group&&(A=this._searchPossibleTargets(T._objects,v))&&this.targets.push(A);break}}return T},restorePointerVpt:function(m){return F.util.transformPoint(m,F.util.invertTransform(this.viewportTransform))},getPointer:function(m,v){if(this._absolutePointer&&!v)return this._absolutePointer;if(this._pointer&&v)return this._pointer;var T,A=D(m),S=this.upperCanvasEl,x=S.getBoundingClientRect(),L=x.width||0,N=x.height||0;L&&N||("top"in x&&"bottom"in x&&(N=Math.abs(x.top-x.bottom)),"right"in x&&"left"in x&&(L=Math.abs(x.right-x.left))),this.calcOffset(),A.x=A.x-this._offset.left,A.y=A.y-this._offset.top,v||(A=this.restorePointerVpt(A));var B=this.getRetinaScaling();return 1!==B&&(A.x/=B,A.y/=B),{x:A.x*(T=0===L||0===N?{width:1,height:1}:{width:S.width/L,height:S.height/N}).width,y:A.y*T.height}},_createUpperCanvas:function(){var m=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),v=this.lowerCanvasEl,T=this.upperCanvasEl;T?T.className="":(T=this._createCanvasElement(),this.upperCanvasEl=T),F.util.addClass(T,"upper-canvas "+m),this.wrapperEl.appendChild(T),this._copyCanvasStyle(v,T),this._applyCanvasStyle(T),this.contextTop=T.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=F.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),F.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),F.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(m){var v=this.width||m.width,T=this.height||m.height;F.util.setStyle(m,{position:"absolute",width:v+"px",height:T+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),m.width=v,m.height=T,F.util.makeElementUnselectable(m)},_copyCanvasStyle:function(m,v){v.style.cssText=m.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var m=this._activeObject;return m?"activeSelection"===m.type&&m._objects?m._objects.slice(0):[m]:[]},_onObjectRemoved:function(m){m===this._activeObject&&(this.fire("before:selection:cleared",{target:m}),this._discardActiveObject(),this.fire("selection:cleared",{target:m}),m.fire("deselected")),m===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",m)},_fireSelectionEvents:function(m,v){var T=!1,A=this.getActiveObjects(),S=[],x=[];m.forEach(function(L){-1===A.indexOf(L)&&(T=!0,L.fire("deselected",{e:v,target:L}),x.push(L))}),A.forEach(function(L){-1===m.indexOf(L)&&(T=!0,L.fire("selected",{e:v,target:L}),S.push(L))}),m.length>0&&A.length>0?T&&this.fire("selection:updated",{e:v,selected:S,deselected:x}):A.length>0?this.fire("selection:created",{e:v,selected:S}):m.length>0&&this.fire("selection:cleared",{e:v,deselected:x})},setActiveObject:function(m,v){var T=this.getActiveObjects();return this._setActiveObject(m,v),this._fireSelectionEvents(T,v),this},_setActiveObject:function(m,v){return this._activeObject!==m&&!!this._discardActiveObject(v,m)&&!m.onSelect({e:v})&&(this._activeObject=m,!0)},_discardActiveObject:function(m,v){var T=this._activeObject;if(T){if(T.onDeselect({e:m,object:v}))return!1;this._activeObject=null}return!0},discardActiveObject:function(m){var v=this.getActiveObjects(),T=this.getActiveObject();return v.length&&this.fire("before:selection:cleared",{target:T,e:m}),this._discardActiveObject(m),this._fireSelectionEvents(v,m),this},dispose:function(){var m=this.wrapperEl;return this.removeListeners(),m.removeChild(this.upperCanvasEl),m.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(v){F.util.cleanUpJsdomNode(this[v]),this[v]=void 0}.bind(this)),m.parentNode&&m.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,F.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(m){var v=this._activeObject;v&&v._renderControls(m)},_toObject:function(m,v,T){var A=this._realizeGroupTransformOnObject(m),S=this.callSuper("_toObject",m,v,T);return this._unwindGroupTransformOnObject(m,A),S},_realizeGroupTransformOnObject:function(m){if(m.group&&"activeSelection"===m.group.type&&this._activeObject===m.group){var v={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(T){v[T]=m[T]}),F.util.addTransformToObject(m,this._activeObject.calcOwnMatrix()),v}return null},_unwindGroupTransformOnObject:function(m,v){v&&m.set(v)},_setSVGObject:function(m,v,T){var A=this._realizeGroupTransformOnObject(v);this.callSuper("_setSVGObject",m,v,T),this._unwindGroupTransformOnObject(v,A)},setViewportTransform:function(m){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),F.StaticCanvas.prototype.setViewportTransform.call(this,m)}}),F.StaticCanvas)"prototype"!==I&&(F.Canvas[I]=F.StaticCanvas[I])}(),function(){var D=F.util.addListener,y=F.util.removeListener,w={passive:!1};function I(m,v){return m.button&&m.button===v-1}F.util.object.extend(F.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(D,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(m,v){var T=this.upperCanvasEl,A=this._getEventPrefix();m(F.window,"resize",this._onResize),m(T,A+"down",this._onMouseDown),m(T,A+"move",this._onMouseMove,w),m(T,A+"out",this._onMouseOut),m(T,A+"enter",this._onMouseEnter),m(T,"wheel",this._onMouseWheel),m(T,"contextmenu",this._onContextMenu),m(T,"dblclick",this._onDoubleClick),m(T,"dragover",this._onDragOver),m(T,"dragenter",this._onDragEnter),m(T,"dragleave",this._onDragLeave),m(T,"drop",this._onDrop),this.enablePointerEvents||m(T,"touchstart",this._onTouchStart,w),"undefined"!=typeof eventjs&&v in eventjs&&(eventjs[v](T,"gesture",this._onGesture),eventjs[v](T,"drag",this._onDrag),eventjs[v](T,"orientation",this._onOrientationChange),eventjs[v](T,"shake",this._onShake),eventjs[v](T,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(y,"remove");var m=this._getEventPrefix();y(F.document,m+"up",this._onMouseUp),y(F.document,"touchend",this._onTouchEnd,w),y(F.document,m+"move",this._onMouseMove,w),y(F.document,"touchmove",this._onMouseMove,w)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(m,v){this.__onTransformGesture&&this.__onTransformGesture(m,v)},_onDrag:function(m,v){this.__onDrag&&this.__onDrag(m,v)},_onMouseWheel:function(m){this.__onMouseWheel(m)},_onMouseOut:function(m){var v=this._hoveredTarget;this.fire("mouse:out",{target:v,e:m}),this._hoveredTarget=null,v&&v.fire("mouseout",{e:m});var T=this;this._hoveredTargets.forEach(function(A){T.fire("mouse:out",{target:v,e:m}),A&&v.fire("mouseout",{e:m})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(A){A.isEditing&&A.hiddenTextarea.focus()})},_onMouseEnter:function(m){this._currentTransform||this.findTarget(m)||(this.fire("mouse:over",{target:null,e:m}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(m,v){this.__onOrientationChange&&this.__onOrientationChange(m,v)},_onShake:function(m,v){this.__onShake&&this.__onShake(m,v)},_onLongPress:function(m,v){this.__onLongPress&&this.__onLongPress(m,v)},_onDragOver:function(m){m.preventDefault();var v=this._simpleEventHandler("dragover",m);this._fireEnterLeaveEvents(v,m)},_onDrop:function(m){return this._simpleEventHandler("drop:before",m),this._simpleEventHandler("drop",m)},_onContextMenu:function(m){return this.stopContextMenu&&(m.stopPropagation(),m.preventDefault()),!1},_onDoubleClick:function(m){this._cacheTransformEventData(m),this._handleEvent(m,"dblclick"),this._resetTransformEventData(m)},getPointerId:function(m){var v=m.changedTouches;return v?v[0]&&v[0].identifier:this.enablePointerEvents?m.pointerId:-1},_isMainEvent:function(m){return!0===m.isPrimary||!1!==m.isPrimary&&("touchend"===m.type&&0===m.touches.length||!m.changedTouches||m.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(m){m.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(m)),this.__onMouseDown(m),this._resetTransformEventData();var v=this.upperCanvasEl,T=this._getEventPrefix();D(F.document,"touchend",this._onTouchEnd,w),D(F.document,"touchmove",this._onMouseMove,w),y(v,T+"down",this._onMouseDown)},_onMouseDown:function(m){this.__onMouseDown(m),this._resetTransformEventData();var v=this.upperCanvasEl,T=this._getEventPrefix();y(v,T+"move",this._onMouseMove,w),D(F.document,T+"up",this._onMouseUp),D(F.document,T+"move",this._onMouseMove,w)},_onTouchEnd:function(m){if(!(m.touches.length>0)){this.__onMouseUp(m),this._resetTransformEventData(),this.mainTouchId=null;var v=this._getEventPrefix();y(F.document,"touchend",this._onTouchEnd,w),y(F.document,"touchmove",this._onMouseMove,w);var T=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){D(T.upperCanvasEl,v+"down",T._onMouseDown),T._willAddMouseDown=0},400)}},_onMouseUp:function(m){this.__onMouseUp(m),this._resetTransformEventData();var v=this.upperCanvasEl,T=this._getEventPrefix();this._isMainEvent(m)&&(y(F.document,T+"up",this._onMouseUp),y(F.document,T+"move",this._onMouseMove,w),D(v,T+"move",this._onMouseMove,w))},_onMouseMove:function(m){!this.allowTouchScrolling&&m.preventDefault&&m.preventDefault(),this.__onMouseMove(m)},_onResize:function(){this.calcOffset()},_shouldRender:function(m){var v=this._activeObject;return!!(!!v!=!!m||v&&m&&v!==m)||!1},__onMouseUp:function(m){var v,T=this._currentTransform,A=this._groupSelector,S=!1,x=!A||0===A.left&&0===A.top;if(this._cacheTransformEventData(m),v=this._target,this._handleEvent(m,"up:before"),I(m,3))this.fireRightClick&&this._handleEvent(m,"up",3,x);else{if(I(m,2))return this.fireMiddleClick&&this._handleEvent(m,"up",2,x),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(m);else if(this._isMainEvent(m)){if(T&&(this._finalizeCurrentTransform(m),S=T.actionPerformed),!x){var L=v===this._activeObject;this._maybeGroupObjects(m),S||(S=this._shouldRender(v)||!L&&v===this._activeObject)}var N,B;if(v){if(N=v._findTargetCorner(this.getPointer(m,!0),F.util.isTouchEvent(m)),v.selectable&&v!==this._activeObject&&"up"===v.activeOn)this.setActiveObject(v,m),S=!0;else{var H=v.controls[N],V=H&&H.getMouseUpHandler(m,v,H);V&&V(m,T,(B=this.getPointer(m)).x,B.y)}v.isMoving=!1}if(T&&(T.target!==v||T.corner!==N)){var W=T.target&&T.target.controls[T.corner],q=W&&W.getMouseUpHandler(m,v,H);B=B||this.getPointer(m),q&&q(m,T,B.x,B.y)}this._setCursorFromEvent(m,v),this._handleEvent(m,"up",1,x),this._groupSelector=null,this._currentTransform=null,v&&(v.__corner=0),S?this.requestRenderAll():x||this.renderTop()}}},_simpleEventHandler:function(m,v){var T=this.findTarget(v),A=this.targets,S={e:v,target:T,subTargets:A};if(this.fire(m,S),T&&T.fire(m,S),!A)return T;for(var x=0;x<A.length;x++)A[x].fire(m,S);return T},_handleEvent:function(m,v,T,A){var S=this._target,x=this.targets||[],L={e:m,target:S,subTargets:x,button:T||1,isClick:A||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===v&&(L.currentTarget=this.findTarget(m),L.currentSubTargets=this.targets),this.fire("mouse:"+v,L),S&&S.fire("mouse"+v,L);for(var N=0;N<x.length;N++)x[N].fire("mouse"+v,L)},_finalizeCurrentTransform:function(m){var v=this._currentTransform,T=v.target,A={e:m,target:T,transform:v,action:v.action};T._scaling&&(T._scaling=!1),T.setCoords(),(v.actionPerformed||this.stateful&&T.hasStateChanged())&&this._fire("modified",A)},_onMouseDownInDrawingMode:function(m){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(m).requestRenderAll();var v=this.getPointer(m);this.freeDrawingBrush.onMouseDown(v,{e:m,pointer:v}),this._handleEvent(m,"down")},_onMouseMoveInDrawingMode:function(m){if(this._isCurrentlyDrawing){var v=this.getPointer(m);this.freeDrawingBrush.onMouseMove(v,{e:m,pointer:v})}this.setCursor(this.freeDrawingCursor),this._handleEvent(m,"move")},_onMouseUpInDrawingMode:function(m){var v=this.getPointer(m);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:m,pointer:v}),this._handleEvent(m,"up")},__onMouseDown:function(m){this._cacheTransformEventData(m),this._handleEvent(m,"down:before");var v=this._target;if(I(m,3))this.fireRightClick&&this._handleEvent(m,"down",3);else if(I(m,2))this.fireMiddleClick&&this._handleEvent(m,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(m);else if(this._isMainEvent(m)&&!this._currentTransform){var T=this._pointer;this._previousPointer=T;var A=this._shouldRender(v),S=this._shouldGroup(m,v);if(this._shouldClearSelection(m,v)?this.discardActiveObject(m):S&&(this._handleGrouping(m,v),v=this._activeObject),!this.selection||v&&(v.selectable||v.isEditing||v===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),v){var x=v===this._activeObject;v.selectable&&"down"===v.activeOn&&this.setActiveObject(v,m);var L=v._findTargetCorner(this.getPointer(m,!0),F.util.isTouchEvent(m));if(v.__corner=L,v===this._activeObject&&(L||!S)){this._setupCurrentTransform(m,v,x);var N=v.controls[L],B=(T=this.getPointer(m),N&&N.getMouseDownHandler(m,v,N));B&&B(m,this._currentTransform,T.x,T.y)}}this._handleEvent(m,"down"),(A||S)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(m){this._resetTransformEventData(),this._pointer=this.getPointer(m,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(m)||null},_beforeTransform:function(m){var v=this._currentTransform;this.stateful&&v.target.saveState(),this.fire("before:transform",{e:m,transform:v})},__onMouseMove:function(m){var v,T;if(this._handleEvent(m,"move:before"),this._cacheTransformEventData(m),this.isDrawingMode)this._onMouseMoveInDrawingMode(m);else if(this._isMainEvent(m)){var A=this._groupSelector;A?(A.left=(T=this._absolutePointer).x-A.ex,A.top=T.y-A.ey,this.renderTop()):this._currentTransform?this._transformObject(m):(v=this.findTarget(m)||null,this._setCursorFromEvent(m,v),this._fireOverOutEvents(v,m)),this._handleEvent(m,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(m,v){var T=this._hoveredTarget,A=this._hoveredTargets,S=this.targets,x=Math.max(A.length,S.length);this.fireSyntheticInOutEvents(m,v,{oldTarget:T,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var L=0;L<x;L++)this.fireSyntheticInOutEvents(S[L],v,{oldTarget:A[L],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=m,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(m,v){var T=this._draggedoverTarget,A=this._hoveredTargets,S=this.targets,x=Math.max(A.length,S.length);this.fireSyntheticInOutEvents(m,v,{oldTarget:T,evtOut:"dragleave",evtIn:"dragenter"});for(var L=0;L<x;L++)this.fireSyntheticInOutEvents(S[L],v,{oldTarget:A[L],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=m},fireSyntheticInOutEvents:function(m,v,T){var A,S,x,L=T.oldTarget,N=L!==m,B=T.canvasEvtIn,H=T.canvasEvtOut;N&&(A={e:v,target:m,previousTarget:L},S={e:v,target:L,nextTarget:m}),x=m&&N,L&&N&&(H&&this.fire(H,S),L.fire(T.evtOut,S)),x&&(B&&this.fire(B,A),m.fire(T.evtIn,A))},__onMouseWheel:function(m){this._cacheTransformEventData(m),this._handleEvent(m,"wheel"),this._resetTransformEventData()},_transformObject:function(m){var v=this.getPointer(m),T=this._currentTransform;T.reset=!1,T.shiftKey=m.shiftKey,T.altKey=m[this.centeredKey],this._performTransformAction(m,T,v),T.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(m,v,T){var x=v.action,L=!1,N=v.actionHandler;N&&(L=N(m,v,T.x,T.y)),"drag"===x&&L&&(v.target.isMoving=!0,this.setCursor(v.target.moveCursor||this.moveCursor)),v.actionPerformed=v.actionPerformed||L},_fire:F.controlsUtils.fireEvent,_setCursorFromEvent:function(m,v){if(!v)return this.setCursor(this.defaultCursor),!1;var T=v.hoverCursor||this.hoverCursor,A=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,S=(!A||!A.contains(v))&&v._findTargetCorner(this.getPointer(m,!0));S?this.setCursor(this.getCornerCursor(S,v,m)):(v.subTargetCheck&&this.targets.concat().reverse().map(function(x){T=x.hoverCursor||T}),this.setCursor(T))},getCornerCursor:function(m,v,T){var A=v.controls[m];return A.cursorStyleHandler(T,A,v)}})}(),$=Math.min,K=Math.max,F.util.object.extend(F.Canvas.prototype,{_shouldGroup:function(D,y){var w=this._activeObject;return w&&this._isSelectionKeyPressed(D)&&y&&y.selectable&&this.selection&&(w!==y||"activeSelection"===w.type)&&!y.onSelect({e:D})},_handleGrouping:function(D,y){var w=this._activeObject;w.__corner||(y!==w||(y=this.findTarget(D,!0))&&y.selectable)&&(w&&"activeSelection"===w.type?this._updateActiveSelection(y,D):this._createActiveSelection(y,D))},_updateActiveSelection:function(D,y){var w=this._activeObject,I=w._objects.slice(0);w.contains(D)?(w.removeWithUpdate(D),this._hoveredTarget=D,this._hoveredTargets=this.targets.concat(),1===w.size()&&this._setActiveObject(w.item(0),y)):(w.addWithUpdate(D),this._hoveredTarget=w,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(I,y)},_createActiveSelection:function(D,y){var w=this.getActiveObjects(),I=this._createGroup(D);this._hoveredTarget=I,this._setActiveObject(I,y),this._fireSelectionEvents(w,y)},_createGroup:function(D){var y=this._objects,w=y.indexOf(this._activeObject)<y.indexOf(D)?[this._activeObject,D]:[D,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new F.ActiveSelection(w,{canvas:this})},_groupSelectedObjects:function(D){var y,w=this._collectObjects(D);1===w.length?this.setActiveObject(w[0],D):w.length>1&&(y=new F.ActiveSelection(w.reverse(),{canvas:this}),this.setActiveObject(y,D))},_collectObjects:function(D){for(var y,w=[],I=this._groupSelector.ex,m=this._groupSelector.ey,v=I+this._groupSelector.left,T=m+this._groupSelector.top,A=new F.Point($(I,v),$(m,T)),S=new F.Point(K(I,v),K(m,T)),x=!this.selectionFullyContained,L=I===v&&m===T,N=this._objects.length;N--&&!((y=this._objects[N])&&y.selectable&&y.visible&&(x&&y.intersectsWithRect(A,S,!0)||y.isContainedWithinRect(A,S,!0)||x&&y.containsPoint(A,null,!0)||x&&y.containsPoint(S,null,!0))&&(w.push(y),L)););return w.length>1&&(w=w.filter(function(B){return!B.onSelect({e:D})})),w},_maybeGroupObjects:function(D){this.selection&&this._groupSelector&&this._groupSelectedObjects(D),this.setCursor(this.defaultCursor),this._groupSelector=null}}),F.util.object.extend(F.StaticCanvas.prototype,{toDataURL:function(D){D||(D={});var y=D.format||"png",w=D.quality||1,I=(D.multiplier||1)*(D.enableRetinaScaling?this.getRetinaScaling():1),m=this.toCanvasElement(I,D);return F.util.toDataURL(m,y,w)},toCanvasElement:function(D,y){var w=((y=y||{}).width||this.width)*(D=D||1),I=(y.height||this.height)*D,m=this.getZoom(),v=this.width,T=this.height,A=m*D,S=this.viewportTransform,N=this.interactive,B=[A,0,0,A,(S[4]-(y.left||0))*D,(S[5]-(y.top||0))*D],H=this.enableRetinaScaling,V=F.util.createCanvasElement(),W=this.contextTop;return V.width=w,V.height=I,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=B,this.width=w,this.height=I,this.calcViewportBoundaries(),this.renderCanvas(V.getContext("2d"),this._objects),this.viewportTransform=S,this.width=v,this.height=T,this.calcViewportBoundaries(),this.interactive=N,this.enableRetinaScaling=H,this.contextTop=W,V}}),F.util.object.extend(F.StaticCanvas.prototype,{loadFromJSON:function(D,y,w){if(D){var I="string"==typeof D?JSON.parse(D):F.util.object.clone(D),m=this,v=I.clipPath,T=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete I.clipPath,this._enlivenObjects(I.objects,function(A){m.clear(),m._setBgOverlay(I,function(){v?m._enlivenObjects([v],function(S){m.clipPath=S[0],m.__setupCanvas.call(m,I,A,T,y)}):m.__setupCanvas.call(m,I,A,T,y)})},w),this}},__setupCanvas:function(D,y,w,I){var m=this;y.forEach(function(v,T){m.insertAt(v,T)}),this.renderOnAddRemove=w,delete D.objects,delete D.backgroundImage,delete D.overlayImage,delete D.background,delete D.overlay,this._setOptions(D),this.renderAll(),I&&I()},_setBgOverlay:function(D,y){var w={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(D.backgroundImage||D.overlayImage||D.background||D.overlay){var I=function(){w.backgroundImage&&w.overlayImage&&w.backgroundColor&&w.overlayColor&&y&&y()};this.__setBgOverlay("backgroundImage",D.backgroundImage,w,I),this.__setBgOverlay("overlayImage",D.overlayImage,w,I),this.__setBgOverlay("backgroundColor",D.background,w,I),this.__setBgOverlay("overlayColor",D.overlay,w,I)}else y&&y()},__setBgOverlay:function(D,y,w,I){var m=this;if(!y)return w[D]=!0,void(I&&I());"backgroundImage"===D||"overlayImage"===D?F.util.enlivenObjects([y],function(v){m[D]=v[0],w[D]=!0,I&&I()}):this["set"+F.util.string.capitalize(D,!0)](y,function(){w[D]=!0,I&&I()})},_enlivenObjects:function(D,y,w){D&&0!==D.length?F.util.enlivenObjects(D,function(I){y&&y(I)},null,w):y&&y([])},_toDataURL:function(D,y){this.clone(function(w){y(w.toDataURL(D))})},_toDataURLWithMultiplier:function(D,y,w){this.clone(function(I){w(I.toDataURLWithMultiplier(D,y))})},clone:function(D,y){var w=JSON.stringify(this.toJSON(y));this.cloneWithoutData(function(I){I.loadFromJSON(w,function(){D&&D(I)})})},cloneWithoutData:function(D){var y=F.util.createCanvasElement();y.width=this.width,y.height=this.height;var w=new F.Canvas(y);this.backgroundImage?(w.setBackgroundImage(this.backgroundImage.src,function(){w.renderAll(),D&&D(w)}),w.backgroundImageOpacity=this.backgroundImageOpacity,w.backgroundImageStretch=this.backgroundImageStretch):D&&D(w)}}),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.util.object.clone,m=y.util.toFixed,v=y.util.string.capitalize,T=y.util.degreesToRadians;y.Object||(y.Object=y.util.createClass(y.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!y.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(S){S&&this.setOptions(S)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=y.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(S){var x=y.perfLimitSizeTotal,L=S.width,N=S.height,B=y.maxCacheSideLimit,H=y.minCacheSideLimit;if(L<=B&&N<=B&&L*N<=x)return L<H&&(S.width=H),N<H&&(S.height=H),S;var W=y.util.limitDimsByArea(L/N,x),q=y.util.capValue,ne=q(H,W.x,B),ie=q(H,W.y,B);return L>ne&&(S.zoomX/=L/ne,S.width=ne,S.capped=!0),N>ie&&(S.zoomY/=N/ie,S.height=ie,S.capped=!0),S},_getCacheCanvasDimensions:function(){var S=this.getTotalObjectScaling(),x=this._getTransformedDimensions(0,0),L=x.x*S.scaleX/this.scaleX,N=x.y*S.scaleY/this.scaleY;return{width:L+2,height:N+2,zoomX:S.scaleX,zoomY:S.scaleY,x:L,y:N}},_updateCacheCanvas:function(){var S=this.canvas;if(this.noScaleCache&&S&&S._currentTransform){var L=S._currentTransform.action;if(this===S._currentTransform.target&&L.slice&&"scale"===L.slice(0,5))return!1}var N,B,H=this._cacheCanvas,V=this._limitCacheSize(this._getCacheCanvasDimensions()),W=y.minCacheSideLimit,q=V.width,ne=V.height,ie=V.zoomX,he=V.zoomY,le=q!==this.cacheWidth||ne!==this.cacheHeight,J=le||this.zoomX!==ie||this.zoomY!==he,Q=0,re=0,ue=!1;if(le){var de=this._cacheCanvas.width,te=this._cacheCanvas.height,ee=q>de||ne>te;ue=ee||(q<.9*de||ne<.9*te)&&de>W&&te>W,ee&&!V.capped&&(q>W||ne>W)&&(Q=.1*q,re=.1*ne)}return this instanceof y.Text&&this.path&&(J=!0,ue=!0,Q+=this.getHeightOfLine(0)*this.zoomX,re+=this.getHeightOfLine(0)*this.zoomY),!!J&&(ue?(H.width=Math.ceil(q+Q),H.height=Math.ceil(ne+re)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,H.width,H.height)),N=V.x/2,B=V.y/2,this.cacheTranslationX=Math.round(H.width/2-N)+N,this.cacheTranslationY=Math.round(H.height/2-B)+B,this.cacheWidth=q,this.cacheHeight=ne,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(ie,he),this.zoomX=ie,this.zoomY=he,!0)},setOptions:function(S){this._setOptions(S),this._initGradient(S.fill,"fill"),this._initGradient(S.stroke,"stroke"),this._initPattern(S.fill,"fill"),this._initPattern(S.stroke,"stroke")},transform:function(S){var L=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&S===this.canvas.contextTop));S.transform(L[0],L[1],L[2],L[3],L[4],L[5])},toObject:function(S){var x=y.Object.NUM_FRACTION_DIGITS,L={type:this.type,version:y.version,originX:this.originX,originY:this.originY,left:m(this.left,x),top:m(this.top,x),width:m(this.width,x),height:m(this.height,x),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:m(this.strokeWidth,x),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:m(this.strokeMiterLimit,x),scaleX:m(this.scaleX,x),scaleY:m(this.scaleY,x),angle:m(this.angle,x),flipX:this.flipX,flipY:this.flipY,opacity:m(this.opacity,x),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:m(this.skewX,x),skewY:m(this.skewY,x)};return this.clipPath&&!this.clipPath.excludeFromExport&&(L.clipPath=this.clipPath.toObject(S),L.clipPath.inverted=this.clipPath.inverted,L.clipPath.absolutePositioned=this.clipPath.absolutePositioned),y.util.populateWithProperties(this,L,S),this.includeDefaultValues||(L=this._removeDefaultValues(L)),L},toDatalessObject:function(S){return this.toObject(S)},_removeDefaultValues:function(S){var x=y.util.getKlass(S.type).prototype;return x.stateProperties.forEach(function(L){"left"!==L&&"top"!==L&&(S[L]===x[L]&&delete S[L],Array.isArray(S[L])&&Array.isArray(x[L])&&0===S[L].length&&0===x[L].length&&delete S[L])}),S},toString:function(){return"#<fabric."+v(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var S=y.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(S.scaleX),scaleY:Math.abs(S.scaleY)}},getTotalObjectScaling:function(){var S=this.getObjectScaling(),x=S.scaleX,L=S.scaleY;if(this.canvas){var N=this.canvas.getZoom(),B=this.canvas.getRetinaScaling();x*=N*B,L*=N*B}return{scaleX:x,scaleY:L}},getObjectOpacity:function(){var S=this.opacity;return this.group&&(S*=this.group.getObjectOpacity()),S},_set:function(S,x){var N=this[S]!==x,B=!1;return("scaleX"===S||"scaleY"===S)&&(x=this._constrainScale(x)),"scaleX"===S&&x<0?(this.flipX=!this.flipX,x*=-1):"scaleY"===S&&x<0?(this.flipY=!this.flipY,x*=-1):"shadow"!==S||!x||x instanceof y.Shadow?"dirty"===S&&this.group&&this.group.set("dirty",x):x=new y.Shadow(x),this[S]=x,N&&(B=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(S)>-1?(this.dirty=!0,B&&this.group.set("dirty",!0)):B&&this.stateProperties.indexOf(S)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:y.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(S){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(S.save(),this._setupCompositeOperation(S),this.drawSelectionBackground(S),this.transform(S),this._setOpacity(S),this._setShadow(S,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(S)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(S),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),S.restore())},renderCache:function(S){S=S||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,S.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(S,x){if(S.save(),S.globalCompositeOperation=x.inverted?"destination-out":"destination-in",x.absolutePositioned){var L=y.util.invertTransform(this.calcTransformMatrix());S.transform(L[0],L[1],L[2],L[3],L[4],L[5])}x.transform(S),S.scale(1/x.zoomX,1/x.zoomY),S.drawImage(x._cacheCanvas,-x.cacheTranslationX,-x.cacheTranslationY),S.restore()},drawObject:function(S,x){var L=this.fill,N=this.stroke;x?(this.fill="black",this.stroke="",this._setClippingProperties(S)):this._renderBackground(S),this._render(S),this._drawClipPath(S,this.clipPath),this.fill=L,this.stroke=N},_drawClipPath:function(S,x){x&&(x.canvas=this.canvas,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCache(S,x))},drawCacheOnCanvas:function(S){S.scale(1/this.zoomX,1/this.zoomY),S.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(S){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!S&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!S){var x=this.cacheWidth/this.zoomX,L=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-x/2,-L/2,x,L)}return!0}return!1},_renderBackground:function(S){if(this.backgroundColor){var x=this._getNonTransformedDimensions();S.fillStyle=this.backgroundColor,S.fillRect(-x.x/2,-x.y/2,x.x,x.y),this._removeShadow(S)}},_setOpacity:function(S){this.group&&!this.group._transformDone?S.globalAlpha=this.getObjectOpacity():S.globalAlpha*=this.opacity},_setStrokeStyles:function(S,x){var L=x.stroke;L&&(S.lineWidth=x.strokeWidth,S.lineCap=x.strokeLineCap,S.lineDashOffset=x.strokeDashOffset,S.lineJoin=x.strokeLineJoin,S.miterLimit=x.strokeMiterLimit,L.toLive?"percentage"===L.gradientUnits||L.gradientTransform||L.patternTransform?this._applyPatternForTransformedGradient(S,L):(S.strokeStyle=L.toLive(S,this),this._applyPatternGradientTransform(S,L)):S.strokeStyle=x.stroke)},_setFillStyles:function(S,x){var L=x.fill;L&&(L.toLive?(S.fillStyle=L.toLive(S,this),this._applyPatternGradientTransform(S,x.fill)):S.fillStyle=L)},_setClippingProperties:function(S){S.globalAlpha=1,S.strokeStyle="transparent",S.fillStyle="#000000"},_setLineDash:function(S,x){x&&0!==x.length&&(1&x.length&&x.push.apply(x,x),S.setLineDash(x))},_renderControls:function(S,x){var L,N,B,H=this.getViewportTransform(),V=this.calcTransformMatrix();N=void 0!==(x=x||{}).hasBorders?x.hasBorders:this.hasBorders,B=void 0!==x.hasControls?x.hasControls:this.hasControls,V=y.util.multiplyTransformMatrices(H,V),L=y.util.qrDecompose(V),S.save(),S.translate(L.translateX,L.translateY),S.lineWidth=1*this.borderScaleFactor,this.group||(S.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(L.angle-=180),S.rotate(T(this.group?L.angle:this.angle)),x.forActiveSelection||this.group?N&&this.drawBordersInGroup(S,L,x):N&&this.drawBorders(S,x),B&&this.drawControls(S,x),S.restore()},_setShadow:function(S){if(this.shadow){var x,L=this.shadow,N=this.canvas,B=N&&N.viewportTransform[0]||1,H=N&&N.viewportTransform[3]||1;x=L.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),N&&N._isRetinaScaling()&&(B*=y.devicePixelRatio,H*=y.devicePixelRatio),S.shadowColor=L.color,S.shadowBlur=L.blur*y.browserShadowBlurConstant*(B+H)*(x.scaleX+x.scaleY)/4,S.shadowOffsetX=L.offsetX*B*x.scaleX,S.shadowOffsetY=L.offsetY*H*x.scaleY}},_removeShadow:function(S){this.shadow&&(S.shadowColor="",S.shadowBlur=S.shadowOffsetX=S.shadowOffsetY=0)},_applyPatternGradientTransform:function(S,x){if(!x||!x.toLive)return{offsetX:0,offsetY:0};var L=x.gradientTransform||x.patternTransform,N=-this.width/2+x.offsetX||0,B=-this.height/2+x.offsetY||0;return"percentage"===x.gradientUnits?S.transform(this.width,0,0,this.height,N,B):S.transform(1,0,0,1,N,B),L&&S.transform(L[0],L[1],L[2],L[3],L[4],L[5]),{offsetX:N,offsetY:B}},_renderPaintInOrder:function(S){"stroke"===this.paintFirst?(this._renderStroke(S),this._renderFill(S)):(this._renderFill(S),this._renderStroke(S))},_render:function(){},_renderFill:function(S){this.fill&&(S.save(),this._setFillStyles(S,this),"evenodd"===this.fillRule?S.fill("evenodd"):S.fill(),S.restore())},_renderStroke:function(S){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(S),S.save(),this.strokeUniform&&this.group){var x=this.getObjectScaling();S.scale(1/x.scaleX,1/x.scaleY)}else this.strokeUniform&&S.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(S,this.strokeDashArray),this._setStrokeStyles(S,this),S.stroke(),S.restore()}},_applyPatternForTransformedGradient:function(S,x){var L,N=this._limitCacheSize(this._getCacheCanvasDimensions()),B=y.util.createCanvasElement(),H=this.canvas.getRetinaScaling(),V=N.x/this.scaleX/H,W=N.y/this.scaleY/H;B.width=V,B.height=W,(L=B.getContext("2d")).beginPath(),L.moveTo(0,0),L.lineTo(V,0),L.lineTo(V,W),L.lineTo(0,W),L.closePath(),L.translate(V/2,W/2),L.scale(N.zoomX/this.scaleX/H,N.zoomY/this.scaleY/H),this._applyPatternGradientTransform(L,x),L.fillStyle=x.toLive(S),L.fill(),S.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),S.scale(H*this.scaleX/N.zoomX,H*this.scaleY/N.zoomY),S.strokeStyle=L.createPattern(B,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var S=y.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",S.scaleX),this.set("scaleY",S.scaleY),this.angle=S.angle,this.skewX=S.skewX,this.skewY=0}},_removeTransformMatrix:function(S){var x=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),x=y.util.transformPoint(x,this.transformMatrix)),this.transformMatrix=null,S&&(this.scaleX*=S.scaleX,this.scaleY*=S.scaleY,this.cropX=S.cropX,this.cropY=S.cropY,x.x+=S.offsetLeft,x.y+=S.offsetTop,this.width=S.width,this.height=S.height),this.setPositionByOrigin(x,"center","center")},clone:function(S,x){var L=this.toObject(x);this.constructor.fromObject?this.constructor.fromObject(L,S):y.Object._fromObject("Object",L,S)},cloneAsImage:function(S,x){var L=this.toCanvasElement(x);return S&&S(new y.Image(L)),this},toCanvasElement:function(S){S||(S={});var x=y.util,L=x.saveObjectTransform(this),N=this.group,B=this.shadow,H=Math.abs,V=(S.multiplier||1)*(S.enableRetinaScaling?y.devicePixelRatio:1);delete this.group,S.withoutTransform&&x.resetObjectTransform(this),S.withoutShadow&&(this.shadow=null);var W,q,ie,he=y.util.createCanvasElement(),le=this.getBoundingRect(!0,!0),oe=this.shadow,J={x:0,y:0};oe&&(q=oe.blur,W=oe.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),J.x=2*Math.round(H(oe.offsetX)+q)*H(W.scaleX),J.y=2*Math.round(H(oe.offsetY)+q)*H(W.scaleY)),ie=le.height+J.y,he.width=Math.ceil(le.width+J.x),he.height=Math.ceil(ie);var Q=new y.StaticCanvas(he,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===S.format&&(Q.backgroundColor="#fff"),this.setPositionByOrigin(new y.Point(Q.width/2,Q.height/2),"center","center");var re=this.canvas;Q.add(this);var ue=Q.toCanvasElement(V||1,S);return this.shadow=B,this.set("canvas",re),N&&(this.group=N),this.set(L).setCoords(),Q._objects=[],Q.dispose(),Q=null,ue},toDataURL:function(S){return S||(S={}),y.util.toDataURL(this.toCanvasElement(S),S.format||"png",S.quality||1)},isType:function(S){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===S},complexity:function(){return 1},toJSON:function(S){return this.toObject(S)},rotate:function(S){var x=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return x&&this._setOriginToCenter(),this.set("angle",S),x&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(S,x){x=x||this.canvas.getPointer(S);var L=new y.Point(x.x,x.y),N=this._getLeftTopCoords();return this.angle&&(L=y.util.rotatePoint(L,N,T(-this.angle))),{x:L.x-N.x,y:L.y-N.y}},_setupCompositeOperation:function(S){this.globalCompositeOperation&&(S.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){y.runningAnimations&&y.runningAnimations.cancelByTarget(this)}}),y.util.createAccessors&&y.util.createAccessors(y.Object),w(y.Object.prototype,y.Observable),y.Object.NUM_FRACTION_DIGITS=2,y.Object.ENLIVEN_PROPS=["clipPath"],y.Object._fromObject=function(S,x,L,N){var B=y[S];x=I(x,!0),y.util.enlivenPatterns([x.fill,x.stroke],function(H){void 0!==H[0]&&(x.fill=H[0]),void 0!==H[1]&&(x.stroke=H[1]),y.util.enlivenObjectEnlivables(x,x,function(){var V=N?new B(x[N],x):new B(x);L&&L(V)})})},y.Object.__uid=0)}(a),ge=F.util.degreesToRadians,_e={left:-.5,center:0,right:.5},Te={top:-.5,center:0,bottom:.5},F.util.object.extend(F.Object.prototype,{translateToGivenOrigin:function(D,y,w,I,m){var v,T,A,S=D.x,x=D.y;return"string"==typeof y?y=_e[y]:y-=.5,"string"==typeof I?I=_e[I]:I-=.5,"string"==typeof w?w=Te[w]:w-=.5,"string"==typeof m?m=Te[m]:m-=.5,T=m-w,((v=I-y)||T)&&(A=this._getTransformedDimensions(),S=D.x+v*A.x,x=D.y+T*A.y),new F.Point(S,x)},translateToCenterPoint:function(D,y,w){var I=this.translateToGivenOrigin(D,y,w,"center","center");return this.angle?F.util.rotatePoint(I,D,ge(this.angle)):I},translateToOriginPoint:function(D,y,w){var I=this.translateToGivenOrigin(D,"center","center",y,w);return this.angle?F.util.rotatePoint(I,D,ge(this.angle)):I},getCenterPoint:function(){var D=new F.Point(this.left,this.top);return this.translateToCenterPoint(D,this.originX,this.originY)},getPointByOrigin:function(D,y){var w=this.getCenterPoint();return this.translateToOriginPoint(w,D,y)},toLocalPoint:function(D,y,w){var I,m,v=this.getCenterPoint();return I=void 0!==y&&void 0!==w?this.translateToGivenOrigin(v,"center","center",y,w):new F.Point(this.left,this.top),m=new F.Point(D.x,D.y),this.angle&&(m=F.util.rotatePoint(m,v,-ge(this.angle))),m.subtractEquals(I)},setPositionByOrigin:function(D,y,w){var I=this.translateToCenterPoint(D,y,w),m=this.translateToOriginPoint(I,this.originX,this.originY);this.set("left",m.x),this.set("top",m.y)},adjustPosition:function(D){var y,w,I=ge(this.angle),m=this.getScaledWidth(),v=F.util.cos(I)*m,T=F.util.sin(I)*m;this.left+=v*((w="string"==typeof D?_e[D]:D-.5)-(y="string"==typeof this.originX?_e[this.originX]:this.originX-.5)),this.top+=T*(w-y),this.setCoords(),this.originX=D},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var D=this.getCenterPoint();this.originX="center",this.originY="center",this.left=D.x,this.top=D.y},_resetOrigin:function(){var D=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=D.x,this.top=D.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var D=F.util,y=D.degreesToRadians,w=D.multiplyTransformMatrices,I=D.transformPoint;D.object.extend(F.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(m,v){return v?m?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),m?this.aCoords:this.lineCoords)},getCoords:function(m,v){return T=this._getCoords(m,v),[new F.Point(T.tl.x,T.tl.y),new F.Point(T.tr.x,T.tr.y),new F.Point(T.br.x,T.br.y),new F.Point(T.bl.x,T.bl.y)];var T},intersectsWithRect:function(m,v,T,A){var S=this.getCoords(T,A);return"Intersection"===F.Intersection.intersectPolygonRectangle(S,m,v).status},intersectsWithObject:function(m,v,T){return"Intersection"===F.Intersection.intersectPolygonPolygon(this.getCoords(v,T),m.getCoords(v,T)).status||m.isContainedWithinObject(this,v,T)||this.isContainedWithinObject(m,v,T)},isContainedWithinObject:function(m,v,T){for(var A=this.getCoords(v,T),x=0,L=m._getImageLines(v?m.aCoords:m.lineCoords);x<4;x++)if(!m.containsPoint(A[x],L))return!1;return!0},isContainedWithinRect:function(m,v,T,A){var S=this.getBoundingRect(T,A);return S.left>=m.x&&S.left+S.width<=v.x&&S.top>=m.y&&S.top+S.height<=v.y},containsPoint:function(m,v,T,A){var S=this._getCoords(T,A),x=(v=v||this._getImageLines(S),this._findCrossPoints(m,v));return 0!==x&&x%2==1},isOnScreen:function(m){if(!this.canvas)return!1;var v=this.canvas.vptCoords.tl,T=this.canvas.vptCoords.br;return!!this.getCoords(!0,m).some(function(A){return A.x<=T.x&&A.x>=v.x&&A.y<=T.y&&A.y>=v.y})||!!this.intersectsWithRect(v,T,!0,m)||this._containsCenterOfCanvas(v,T,m)},_containsCenterOfCanvas:function(m,v,T){return!!this.containsPoint({x:(m.x+v.x)/2,y:(m.y+v.y)/2},null,!0,T)},isPartiallyOnScreen:function(m){if(!this.canvas)return!1;var v=this.canvas.vptCoords.tl,T=this.canvas.vptCoords.br;return!!this.intersectsWithRect(v,T,!0,m)||this.getCoords(!0,m).every(function(A){return(A.x>=T.x||A.x<=v.x)&&(A.y>=T.y||A.y<=v.y)})&&this._containsCenterOfCanvas(v,T,m)},_getImageLines:function(m){return{topline:{o:m.tl,d:m.tr},rightline:{o:m.tr,d:m.br},bottomline:{o:m.br,d:m.bl},leftline:{o:m.bl,d:m.tl}}},_findCrossPoints:function(m,v){var T,A,S,x=0;for(var L in v)if(!((S=v[L]).o.y<m.y&&S.d.y<m.y||S.o.y>=m.y&&S.d.y>=m.y||(S.o.x===S.d.x&&S.o.x>=m.x?A=S.o.x:(T=(S.d.y-S.o.y)/(S.d.x-S.o.x),A=-(m.y-0*m.x-(S.o.y-T*S.o.x))/(0-T)),A>=m.x&&(x+=1),2!==x)))break;return x},getBoundingRect:function(m,v){var T=this.getCoords(m,v);return D.makeBoundingBoxFromPoints(T)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(m){return Math.abs(m)<this.minScaleLimit?m<0?-this.minScaleLimit:this.minScaleLimit:0===m?1e-4:m},scale:function(m){return this._set("scaleX",m),this._set("scaleY",m),this.setCoords()},scaleToWidth:function(m,v){var T=this.getBoundingRect(v).width/this.getScaledWidth();return this.scale(m/this.width/T)},scaleToHeight:function(m,v){var T=this.getBoundingRect(v).height/this.getScaledHeight();return this.scale(m/this.height/T)},calcLineCoords:function(){var m=this.getViewportTransform(),v=this.padding,T=y(this.angle),A=D.cos(T)*v,S=D.sin(T)*v,x=A+S,L=A-S,N=this.calcACoords(),B={tl:I(N.tl,m),tr:I(N.tr,m),bl:I(N.bl,m),br:I(N.br,m)};return v&&(B.tl.x-=L,B.tl.y-=x,B.tr.x+=x,B.tr.y-=L,B.bl.x-=x,B.bl.y+=L,B.br.x+=L,B.br.y+=x),B},calcOCoords:function(){var m=this._calcRotateMatrix(),v=this._calcTranslateMatrix(),T=this.getViewportTransform(),A=w(T,v),S=w(A,m),x=(S=w(S,[1/T[0],0,0,1/T[3],0,0]),this._calculateCurrentDimensions()),L={};return this.forEachControl(function(N,B,H){L[B]=N.positionHandler(x,S,H)}),L},calcACoords:function(){var m=this._calcRotateMatrix(),v=this._calcTranslateMatrix(),T=w(v,m),A=this._getTransformedDimensions(),S=A.x/2,x=A.y/2;return{tl:I({x:-S,y:-x},T),tr:I({x:S,y:-x},T),bl:I({x:-S,y:x},T),br:I({x:S,y:x},T)}},setCoords:function(m){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),m||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return D.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var m=this.getCenterPoint();return[1,0,0,1,m.x,m.y]},transformMatrixKey:function(m){var v="_",T="";return!m&&this.group&&(T=this.group.transformMatrixKey(m)+v),T+this.top+v+this.left+v+this.scaleX+v+this.scaleY+v+this.skewX+v+this.skewY+v+this.angle+v+this.originX+v+this.originY+v+this.width+v+this.height+v+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(m){var v=this.calcOwnMatrix();if(m||!this.group)return v;var T=this.transformMatrixKey(m),A=this.matrixCache||(this.matrixCache={});return A.key===T?A.value:(this.group&&(v=w(this.group.calcTransformMatrix(!1),v)),A.key=T,A.value=v,v)},calcOwnMatrix:function(){var m=this.transformMatrixKey(!0),v=this.ownMatrixCache||(this.ownMatrixCache={});if(v.key===m)return v.value;var T=this._calcTranslateMatrix(),A={angle:this.angle,translateX:T[4],translateY:T[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return v.key=m,v.value=D.composeMatrix(A),v.value},_getNonTransformedDimensions:function(){var m=this.strokeWidth;return{x:this.width+m,y:this.height+m}},_getTransformedDimensions:function(m,v){void 0===m&&(m=this.skewX),void 0===v&&(v=this.skewY);var T,A,S,x=0===m&&0===v;if(this.strokeUniform?(A=this.width,S=this.height):(A=(T=this._getNonTransformedDimensions()).x,S=T.y),x)return this._finalizeDimensions(A*this.scaleX,S*this.scaleY);var L=D.sizeAfterTransform(A,S,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:m,skewY:v});return this._finalizeDimensions(L.x,L.y)},_finalizeDimensions:function(m,v){return this.strokeUniform?{x:m+this.strokeWidth,y:v+this.strokeWidth}:{x:m,y:v}},_calculateCurrentDimensions:function(){var m=this.getViewportTransform(),v=this._getTransformedDimensions();return I(v,m,!0).scalarAdd(2*this.padding)}})}(),F.util.object.extend(F.Object.prototype,{sendToBack:function(){return this.group?F.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?F.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(D){return this.group?F.StaticCanvas.prototype.sendBackwards.call(this.group,this,D):this.canvas&&this.canvas.sendBackwards(this,D),this},bringForward:function(D){return this.group?F.StaticCanvas.prototype.bringForward.call(this.group,this,D):this.canvas&&this.canvas.bringForward(this,D),this},moveTo:function(D){return this.group&&"activeSelection"!==this.group.type?F.StaticCanvas.prototype.moveTo.call(this.group,this,D):this.canvas&&this.canvas.moveTo(this,D),this}}),function(){function D(w,I){if(I){if(I.toLive)return w+": url(#SVGID_"+I.id+"); ";var m=new F.Color(I),v=w+": "+m.toRgb()+"; ",T=m.getAlpha();return 1!==T&&(v+=w+"-opacity: "+T.toString()+"; "),v}return w+": none; "}var y=F.util.toFixed;F.util.object.extend(F.Object.prototype,{getSvgStyles:function(w){var I=this.fillRule?this.fillRule:"nonzero",m=this.strokeWidth?this.strokeWidth:"0",v=this.strokeDashArray?this.strokeDashArray.join(" "):"none",T=this.strokeDashOffset?this.strokeDashOffset:"0",A=this.strokeLineCap?this.strokeLineCap:"butt",S=this.strokeLineJoin?this.strokeLineJoin:"miter",x=this.strokeMiterLimit?this.strokeMiterLimit:"4",L=void 0!==this.opacity?this.opacity:"1",N=this.visible?"":" visibility: hidden;",B=w?"":this.getSvgFilter(),H=D("fill",this.fill);return[D("stroke",this.stroke),"stroke-width: ",m,"; ","stroke-dasharray: ",v,"; ","stroke-linecap: ",A,"; ","stroke-dashoffset: ",T,"; ","stroke-linejoin: ",S,"; ","stroke-miterlimit: ",x,"; ",H,"fill-rule: ",I,"; ","opacity: ",L,";",B,N].join("")},getSvgSpanStyles:function(w,I){var m="; ",v=w.fontFamily?"font-family: "+(-1===w.fontFamily.indexOf("'")&&-1===w.fontFamily.indexOf('"')?"'"+w.fontFamily+"'":w.fontFamily)+m:"",T=w.strokeWidth?"stroke-width: "+w.strokeWidth+m:"",A=w.fontSize?"font-size: "+w.fontSize+"px"+m:"",S=w.fontStyle?"font-style: "+w.fontStyle+m:"",x=w.fontWeight?"font-weight: "+w.fontWeight+m:"",L=w.fill?D("fill",w.fill):"",N=w.stroke?D("stroke",w.stroke):"",B=this.getSvgTextDecoration(w);return B&&(B="text-decoration: "+B+m),[N,T,v,A,S,x,B,L,w.deltaY?"baseline-shift: "+-w.deltaY+"; ":"",I?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(w){return["overline","underline","line-through"].filter(function(I){return w[I.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(w,I){var m=w?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+F.util.matrixToSVG(m)+(I||"")+'" '},_setSVGBg:function(w){if(this.backgroundColor){var I=F.Object.NUM_FRACTION_DIGITS;w.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',y(-this.width/2,I),'" y="',y(-this.height/2,I),'" width="',y(this.width,I),'" height="',y(this.height,I),'"></rect>\n')}},toSVG:function(w){return this._createBaseSVGMarkup(this._toSVG(w),{reviver:w})},toClipPathSVG:function(w){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(w),{reviver:w})},_createBaseClipPathSVGMarkup:function(w,I){var m=(I=I||{}).reviver,T=[this.getSvgTransform(!0,I.additionalTransform||""),this.getSvgCommons()].join(""),A=w.indexOf("COMMON_PARTS");return w[A]=T,m?m(w.join("")):w.join("")},_createBaseSVGMarkup:function(w,I){var m,v,T=(I=I||{}).noStyle,A=I.reviver,S=T?"":'style="'+this.getSvgStyles()+'" ',x=I.withShadow?'style="'+this.getSvgFilter()+'" ':"",L=this.clipPath,N=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",B=L&&L.absolutePositioned,H=this.stroke,V=this.fill,W=this.shadow,q=[],ne=w.indexOf("COMMON_PARTS"),ie=I.additionalTransform;return L&&(L.clipPathId="CLIPPATH_"+F.Object.__uid++,v='<clipPath id="'+L.clipPathId+'" >\n'+L.toClipPathSVG(A)+"</clipPath>\n"),B&&q.push("<g ",x,this.getSvgCommons()," >\n"),q.push("<g ",this.getSvgTransform(!1),B?"":x+this.getSvgCommons()," >\n"),m=[S,N,T?"":this.addPaintOrder()," ",ie?'transform="'+ie+'" ':""].join(""),w[ne]=m,V&&V.toLive&&q.push(V.toSVG(this)),H&&H.toLive&&q.push(H.toSVG(this)),W&&q.push(W.toSVG(this)),L&&q.push(v),q.push(w.join("")),q.push("</g>\n"),B&&q.push("</g>\n"),A?A(q.join("")):q.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var D=F.util.object.extend,y="stateProperties";function w(m,v,T){var A={};T.forEach(function(S){A[S]=m[S]}),D(m[v],A,!0)}function I(m,v,T){if(m===v)return!0;if(Array.isArray(m)){if(!Array.isArray(v)||m.length!==v.length)return!1;for(var A=0,S=m.length;A<S;A++)if(!I(m[A],v[A]))return!1;return!0}if(m&&"object"==typeof m){var x,L=Object.keys(m);if(!v||"object"!=typeof v||!T&&L.length!==Object.keys(v).length)return!1;for(A=0,S=L.length;A<S;A++)if("canvas"!==(x=L[A])&&"group"!==x&&!I(m[x],v[x]))return!1;return!0}}F.util.object.extend(F.Object.prototype,{hasStateChanged:function(m){var v="_"+(m=m||y);return Object.keys(this[v]).length<this[m].length||!I(this[v],this,!0)},saveState:function(m){var v=m&&m.propertySet||y,T="_"+v;return this[T]?(w(this,T,this[v]),m&&m.stateProperties&&w(this,T,m.stateProperties),this):this.setupState(m)},setupState:function(m){var v=(m=m||{}).propertySet||y;return m.propertySet=v,this["_"+v]={},this.saveState(m),this}})}(),function(){var D=F.util.degreesToRadians;F.util.object.extend(F.Object.prototype,{_findTargetCorner:function(y,w){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var I,m,v,T=y.x,A=y.y,S=Object.keys(this.oCoords),x=S.length-1;for(this.__corner=0;x>=0;x--)if(this.isControlVisible(v=S[x])&&(m=this._getImageLines(w?this.oCoords[v].touchCorner:this.oCoords[v].corner),0!==(I=this._findCrossPoints({x:T,y:A},m))&&I%2==1))return this.__corner=v,v;return!1},forEachControl:function(y){for(var w in this.controls)y(this.controls[w],w,this)},_setCornerCoords:function(){var y=this.oCoords;for(var w in y){var I=this.controls[w];y[w].corner=I.calcCornerCoords(this.angle,this.cornerSize,y[w].x,y[w].y,!1),y[w].touchCorner=I.calcCornerCoords(this.angle,this.touchCornerSize,y[w].x,y[w].y,!0)}},drawSelectionBackground:function(y){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;y.save();var w=this.getCenterPoint(),I=this._calculateCurrentDimensions(),m=this.canvas.viewportTransform;return y.translate(w.x,w.y),y.scale(1/m[0],1/m[3]),y.rotate(D(this.angle)),y.fillStyle=this.selectionBackgroundColor,y.fillRect(-I.x/2,-I.y/2,I.x,I.y),y.restore(),this},drawBorders:function(y,w){w=w||{};var I=this._calculateCurrentDimensions(),m=this.borderScaleFactor,v=I.x+m,T=I.y+m,A=void 0!==w.hasControls?w.hasControls:this.hasControls,S=!1;return y.save(),y.strokeStyle=w.borderColor||this.borderColor,this._setLineDash(y,w.borderDashArray||this.borderDashArray),y.strokeRect(-v/2,-T/2,v,T),A&&(y.beginPath(),this.forEachControl(function(x,L,N){x.withConnection&&x.getVisibility(N,L)&&(S=!0,y.moveTo(x.x*v,x.y*T),y.lineTo(x.x*v+x.offsetX,x.y*T+x.offsetY))}),S&&y.stroke()),y.restore(),this},drawBordersInGroup:function(y,w,I){I=I||{};var m=F.util.sizeAfterTransform(this.width,this.height,w),v=this.strokeWidth,T=this.strokeUniform,A=this.borderScaleFactor,S=m.x+v*(T?this.canvas.getZoom():w.scaleX)+A,x=m.y+v*(T?this.canvas.getZoom():w.scaleY)+A;return y.save(),this._setLineDash(y,I.borderDashArray||this.borderDashArray),y.strokeStyle=I.borderColor||this.borderColor,y.strokeRect(-S/2,-x/2,S,x),y.restore(),this},drawControls:function(y,w){w=w||{},y.save();var I,m,v=this.canvas.getRetinaScaling();return y.setTransform(v,0,0,v,0,0),y.strokeStyle=y.fillStyle=w.cornerColor||this.cornerColor,this.transparentCorners||(y.strokeStyle=w.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(y,w.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(I=this.group.calcTransformMatrix()),this.forEachControl(function(T,A,S){m=S.oCoords[A],T.getVisibility(S,A)&&(I&&(m=F.util.transformPoint(m,I)),T.render(y,m.x,m.y,w,S))}),y.restore(),this},isControlVisible:function(y){return this.controls[y]&&this.controls[y].getVisibility(this,y)},setControlVisible:function(y,w){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[y]=w,this},setControlsVisibility:function(y){for(var w in y||(y={}),y)this.setControlVisible(w,y[w]);return this},onDeselect:function(){},onSelect:function(){}})}(),F.util.object.extend(F.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(D,y){var w=function(){},I=(y=y||{}).onComplete||w,m=y.onChange||w,v=this;return F.util.animate({target:this,startValue:D.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(T){D.set("left",T),v.requestRenderAll(),m()},onComplete:function(){D.setCoords(),I()}})},fxCenterObjectV:function(D,y){var w=function(){},I=(y=y||{}).onComplete||w,m=y.onChange||w,v=this;return F.util.animate({target:this,startValue:D.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(T){D.set("top",T),v.requestRenderAll(),m()},onComplete:function(){D.setCoords(),I()}})},fxRemove:function(D,y){var w=function(){},I=(y=y||{}).onComplete||w,m=y.onChange||w,v=this;return F.util.animate({target:this,startValue:D.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(T){D.set("opacity",T),v.requestRenderAll(),m()},onComplete:function(){v.remove(D),I()}})}}),F.util.object.extend(F.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var D,w=[],I=[];for(D in arguments[0])w.push(D);for(var m=0,v=w.length;m<v;m++)I.push(this._animate(D=w[m],arguments[0][D],arguments[1],m!==v-1));return I}return this._animate.apply(this,arguments)},_animate:function(D,y,w,I){var m,v=this;y=y.toString(),w=w?F.util.object.clone(w):{},~D.indexOf(".")&&(m=D.split("."));var T=v.colorProperties.indexOf(D)>-1||m&&v.colorProperties.indexOf(m[1])>-1,A=m?this.get(m[0])[m[1]]:this.get(D);"from"in w||(w.from=A),T||(y=~y.indexOf("=")?A+parseFloat(y.replace("=","")):parseFloat(y));var S={target:this,startValue:w.from,endValue:y,byValue:w.by,easing:w.easing,duration:w.duration,abort:w.abort&&function(x,L,N){return w.abort.call(v,x,L,N)},onChange:function(x,L,N){m?v[m[0]][m[1]]=x:v.set(D,x),I||w.onChange&&w.onChange(x,L,N)},onComplete:function(x,L,N){I||(v.setCoords(),w.onComplete&&w.onComplete(x,L,N))}};return T?F.util.animateColor(S.startValue,S.endValue,S.duration,S):F.util.animate(S)}}),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.util.object.clone,m={x1:1,x2:1,y1:1,y2:1};function v(T,A){var S=T.origin,x=T.axis1,L=T.axis2,N=T.dimension,B=A.nearest,H=A.center,V=A.farthest;return function(){switch(this.get(S)){case B:return Math.min(this.get(x),this.get(L));case H:return Math.min(this.get(x),this.get(L))+.5*this.get(N);case V:return Math.max(this.get(x),this.get(L))}}}y.Line?y.warn("fabric.Line is already defined"):(y.Line=y.util.createClass(y.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:y.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(T,A){T||(T=[0,0,0,0]),this.callSuper("initialize",A),this.set("x1",T[0]),this.set("y1",T[1]),this.set("x2",T[2]),this.set("y2",T[3]),this._setWidthHeight(A)},_setWidthHeight:function(T){T||(T={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in T?T.left:this._getLeftToOriginX(),this.top="top"in T?T.top:this._getTopToOriginY()},_set:function(T,A){return this.callSuper("_set",T,A),void 0!==m[T]&&this._setWidthHeight(),this},_getLeftToOriginX:v({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:v({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(T){T.beginPath();var A=this.calcLinePoints();T.moveTo(A.x1,A.y1),T.lineTo(A.x2,A.y2),T.lineWidth=this.strokeWidth;var S=T.strokeStyle;T.strokeStyle=this.stroke||T.fillStyle,this.stroke&&this._renderStroke(T),T.strokeStyle=S},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(T){return w(this.callSuper("toObject",T),this.calcLinePoints())},_getNonTransformedDimensions:function(){var T=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(T.y-=this.strokeWidth),0===this.height&&(T.x-=this.strokeWidth)),T},calcLinePoints:function(){var T=this.x1<=this.x2?-1:1,A=this.y1<=this.y2?-1:1;return{x1:T*this.width*.5,x2:T*this.width*-.5,y1:A*this.height*.5,y2:A*this.height*-.5}},_toSVG:function(){var T=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',T.x1,'" y1="',T.y1,'" x2="',T.x2,'" y2="',T.y2,'" />\n']}}),y.Line.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),y.Line.fromElement=function(T,A,S){S=S||{};var x=y.parseAttributes(T,y.Line.ATTRIBUTE_NAMES);A(new y.Line([x.x1||0,x.y1||0,x.x2||0,x.y2||0],w(x,S)))},y.Line.fromObject=function(T,A){var S=I(T,!0);S.points=[T.x1,T.y1,T.x2,T.y2],y.Object._fromObject("Line",S,function(x){delete x.points,A&&A(x)},"points")})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.degreesToRadians;y.Circle?y.warn("fabric.Circle is already defined."):(y.Circle=y.util.createClass(y.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:y.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(I,m){return this.callSuper("_set",I,m),"radius"===I&&this.setRadius(m),this},toObject:function(I){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(I))},_toSVG:function(){var I,m=(this.endAngle-this.startAngle)%360;if(0===m)I=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var v=w(this.startAngle),T=w(this.endAngle),A=this.radius;I=['<path d="M '+y.util.cos(v)*A+" "+y.util.sin(v)*A," A "+A+" "+A," 0 ",+(m>180?"1":"0")+" 1"," "+y.util.cos(T)*A+" "+y.util.sin(T)*A,'" ',"COMMON_PARTS"," />\n"]}return I},_render:function(I){I.beginPath(),I.arc(0,0,this.radius,w(this.startAngle),w(this.endAngle),!1),this._renderPaintInOrder(I)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(I){return this.radius=I,this.set("width",2*I).set("height",2*I)}}),y.Circle.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),y.Circle.fromElement=function(I,m){var v,T=y.parseAttributes(I,y.Circle.ATTRIBUTE_NAMES);if(!("radius"in(v=T)&&v.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");T.left=(T.left||0)-T.radius,T.top=(T.top||0)-T.radius,m(new y.Circle(T))},y.Circle.fromObject=function(I,m){y.Object._fromObject("Circle",I,m)})}(a),function(D){var y=D.fabric||(D.fabric={});y.Triangle?y.warn("fabric.Triangle is already defined"):(y.Triangle=y.util.createClass(y.Object,{type:"triangle",width:100,height:100,_render:function(w){var I=this.width/2,m=this.height/2;w.beginPath(),w.moveTo(-I,m),w.lineTo(0,-m),w.lineTo(I,m),w.closePath(),this._renderPaintInOrder(w)},_toSVG:function(){var w=this.width/2,I=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-w+" "+I,"0 "+-I,w+" "+I].join(","),'" />']}}),y.Triangle.fromObject=function(w,I){return y.Object._fromObject("Triangle",w,I)})}(a),function(D){var y=D.fabric||(D.fabric={}),w=2*Math.PI;y.Ellipse?y.warn("fabric.Ellipse is already defined."):(y.Ellipse=y.util.createClass(y.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:y.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(I){this.callSuper("initialize",I),this.set("rx",I&&I.rx||0),this.set("ry",I&&I.ry||0)},_set:function(I,m){switch(this.callSuper("_set",I,m),I){case"rx":this.rx=m,this.set("width",2*m);break;case"ry":this.ry=m,this.set("height",2*m)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(I){return this.callSuper("toObject",["rx","ry"].concat(I))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(I){I.beginPath(),I.save(),I.transform(1,0,0,this.ry/this.rx,0,0),I.arc(0,0,this.rx,0,w,!1),I.restore(),this._renderPaintInOrder(I)}}),y.Ellipse.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),y.Ellipse.fromElement=function(I,m){var v=y.parseAttributes(I,y.Ellipse.ATTRIBUTE_NAMES);v.left=(v.left||0)-v.rx,v.top=(v.top||0)-v.ry,m(new y.Ellipse(v))},y.Ellipse.fromObject=function(I,m){y.Object._fromObject("Ellipse",I,m)})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend;y.Rect?y.warn("fabric.Rect is already defined"):(y.Rect=y.util.createClass(y.Object,{stateProperties:y.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:y.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(I){this.callSuper("initialize",I),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(I){var m=this.rx?Math.min(this.rx,this.width/2):0,v=this.ry?Math.min(this.ry,this.height/2):0,T=this.width,A=this.height,S=-this.width/2,x=-this.height/2,L=0!==m||0!==v,N=.4477152502;I.beginPath(),I.moveTo(S+m,x),I.lineTo(S+T-m,x),L&&I.bezierCurveTo(S+T-N*m,x,S+T,x+N*v,S+T,x+v),I.lineTo(S+T,x+A-v),L&&I.bezierCurveTo(S+T,x+A-N*v,S+T-N*m,x+A,S+T-m,x+A),I.lineTo(S+m,x+A),L&&I.bezierCurveTo(S+N*m,x+A,S,x+A-N*v,S,x+A-v),I.lineTo(S,x+v),L&&I.bezierCurveTo(S,x+N*v,S+N*m,x,S+m,x),I.closePath(),this._renderPaintInOrder(I)},toObject:function(I){return this.callSuper("toObject",["rx","ry"].concat(I))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),y.Rect.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),y.Rect.fromElement=function(I,m,v){if(!I)return m(null);v=v||{};var T=y.parseAttributes(I,y.Rect.ATTRIBUTE_NAMES);T.left=T.left||0,T.top=T.top||0,T.height=T.height||0,T.width=T.width||0;var A=new y.Rect(w(v?y.util.object.clone(v):{},T));A.visible=A.visible&&A.width>0&&A.height>0,m(A)},y.Rect.fromObject=function(I,m){return y.Object._fromObject("Rect",I,m)})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.util.array.min,m=y.util.array.max,v=y.util.toFixed,T=y.util.projectStrokeOnPoints;y.Polyline?y.warn("fabric.Polyline is already defined"):(y.Polyline=y.util.createClass(y.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:y.Object.prototype.cacheProperties.concat("points"),initialize:function(A,S){S=S||{},this.points=A||[],this.callSuper("initialize",S),this._setPositionDimensions(S)},_projectStrokeOnPoints:function(){return T(this.points,this,!0)},_setPositionDimensions:function(A){var S,x=this._calcDimensions(A),L=this.exactBoundingBox?this.strokeWidth:0;this.width=x.width-L,this.height=x.height-L,A.fromSVG||(S=this.translateToGivenOrigin({x:x.left-this.strokeWidth/2+L/2,y:x.top-this.strokeWidth/2+L/2},"left","top",this.originX,this.originY)),void 0===A.left&&(this.left=A.fromSVG?x.left:S.x),void 0===A.top&&(this.top=A.fromSVG?x.top:S.y),this.pathOffset={x:x.left+this.width/2+L/2,y:x.top+this.height/2+L/2}},_calcDimensions:function(){var A=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,S=I(A,"x")||0,x=I(A,"y")||0;return{left:S,top:x,width:(m(A,"x")||0)-S,height:(m(A,"y")||0)-x}},toObject:function(A){return w(this.callSuper("toObject",A),{points:this.points.concat()})},_toSVG:function(){for(var A=[],S=this.pathOffset.x,x=this.pathOffset.y,L=y.Object.NUM_FRACTION_DIGITS,N=0,B=this.points.length;N<B;N++)A.push(v(this.points[N].x-S,L),",",v(this.points[N].y-x,L)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',A.join(""),'" />\n']},commonRender:function(A){var S,x=this.points.length,L=this.pathOffset.x,N=this.pathOffset.y;if(!x||isNaN(this.points[x-1].y))return!1;A.beginPath(),A.moveTo(this.points[0].x-L,this.points[0].y-N);for(var B=0;B<x;B++)A.lineTo((S=this.points[B]).x-L,S.y-N);return!0},_render:function(A){this.commonRender(A)&&this._renderPaintInOrder(A)},complexity:function(){return this.get("points").length}}),y.Polyline.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat(),y.Polyline.fromElementGenerator=function(A){return function(S,x,L){if(!S)return x(null);L||(L={});var N=y.parsePointsAttribute(S.getAttribute("points")),B=y.parseAttributes(S,y[A].ATTRIBUTE_NAMES);B.fromSVG=!0,x(new y[A](N,w(B,L)))}},y.Polyline.fromElement=y.Polyline.fromElementGenerator("Polyline"),y.Polyline.fromObject=function(A,S){return y.Object._fromObject("Polyline",A,S,"points")})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.projectStrokeOnPoints;y.Polygon?y.warn("fabric.Polygon is already defined"):(y.Polygon=y.util.createClass(y.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return w(this.points,this)},_render:function(I){this.commonRender(I)&&(I.closePath(),this._renderPaintInOrder(I))}}),y.Polygon.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat(),y.Polygon.fromElement=y.Polyline.fromElementGenerator("Polygon"),y.Polygon.fromObject=function(I,m){y.Object._fromObject("Polygon",I,m,"points")})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.array.min,I=y.util.array.max,m=y.util.object.extend,v=y.util.object.clone,T=y.util.toFixed;y.Path?y.warn("fabric.Path is already defined"):(y.Path=y.util.createClass(y.Object,{type:"path",path:null,cacheProperties:y.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:y.Object.prototype.stateProperties.concat("path"),initialize:function(A,S){delete(S=v(S||{})).path,this.callSuper("initialize",S),this._setPath(A||[],S)},_setPath:function(A,S){this.path=y.util.makePathSimpler(Array.isArray(A)?A:y.util.parsePath(A)),y.Polyline.prototype._setPositionDimensions.call(this,S||{})},_renderPathCommands:function(A){var S,x=0,L=0,N=0,B=0,W=-this.pathOffset.x,q=-this.pathOffset.y;A.beginPath();for(var ne=0,ie=this.path.length;ne<ie;++ne)switch((S=this.path[ne])[0]){case"L":A.lineTo((N=S[1])+W,(B=S[2])+q);break;case"M":x=N=S[1],L=B=S[2],A.moveTo(N+W,B+q);break;case"C":A.bezierCurveTo(S[1]+W,S[2]+q,S[3]+W,S[4]+q,(N=S[5])+W,(B=S[6])+q);break;case"Q":A.quadraticCurveTo(S[1]+W,S[2]+q,S[3]+W,S[4]+q),N=S[3],B=S[4];break;case"z":case"Z":N=x,B=L,A.closePath()}},_render:function(A){this._renderPathCommands(A),this._renderPaintInOrder(A)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(A){return m(this.callSuper("toObject",A),{path:this.path.map(function(S){return S.slice()})})},toDatalessObject:function(A){var S=this.toObject(["sourcePath"].concat(A));return S.sourcePath&&delete S.path,S},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',y.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var A=y.Object.NUM_FRACTION_DIGITS;return" translate("+T(-this.pathOffset.x,A)+", "+T(-this.pathOffset.y,A)+")"},toClipPathSVG:function(A){var S=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:A,additionalTransform:S})},toSVG:function(A){var S=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:A,additionalTransform:S})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var A,S,x=[],L=[],N=0,B=0,H=0,V=0,W=0,q=this.path.length;W<q;++W){switch((A=this.path[W])[0]){case"L":H=A[1],V=A[2],S=[];break;case"M":N=H=A[1],B=V=A[2],S=[];break;case"C":S=y.util.getBoundsOfCurve(H,V,A[1],A[2],A[3],A[4],A[5],A[6]),H=A[5],V=A[6];break;case"Q":S=y.util.getBoundsOfCurve(H,V,A[1],A[2],A[1],A[2],A[3],A[4]),H=A[3],V=A[4];break;case"z":case"Z":H=N,V=B}S.forEach(function(he){x.push(he.x),L.push(he.y)}),x.push(H),L.push(V)}var ne=w(x)||0,ie=w(L)||0;return{left:ne,top:ie,width:(I(x)||0)-ne,height:(I(L)||0)-ie}}}),y.Path.fromObject=function(A,S){"string"==typeof A.sourcePath?y.loadSVGFromURL(A.sourcePath,function(L){var N=L[0];N.setOptions(A),S&&S(N)}):y.Object._fromObject("Path",A,S,"path")},y.Path.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat(["d"]),y.Path.fromElement=function(A,S,x){var L=y.parseAttributes(A,y.Path.ATTRIBUTE_NAMES);L.fromSVG=!0,S(new y.Path(L.d,m(L,x)))})}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.array.min,I=y.util.array.max;y.Group||(y.Group=y.util.createClass(y.Object,y.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(m,v,T){v=v||{},this._objects=[],T&&this.callSuper("initialize",v),this._objects=m||[];for(var A=this._objects.length;A--;)this._objects[A].group=this;if(T)this._updateObjectsACoords();else{var S=v&&v.centerPoint;void 0!==v.originX&&(this.originX=v.originX),void 0!==v.originY&&(this.originY=v.originY),S||this._calcBounds(),this._updateObjectsCoords(S),delete v.centerPoint,this.callSuper("initialize",v)}this.setCoords()},_updateObjectsACoords:function(){for(var m=this._objects.length;m--;)this._objects[m].setCoords(!0)},_updateObjectsCoords:function(m){m=m||this.getCenterPoint();for(var v=this._objects.length;v--;)this._updateObjectCoords(this._objects[v],m)},_updateObjectCoords:function(m,v){m.set({left:m.left-v.x,top:m.top-v.y}),m.group=this,m.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(m){var v=!!this.group;return this._restoreObjectsState(),y.util.resetObjectTransform(this),m&&(v&&y.util.removeTransformFromObject(m,this.group.calcTransformMatrix()),this._objects.push(m),m.group=this,m._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,v?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(m){return this._restoreObjectsState(),y.util.resetObjectTransform(this),this.remove(m),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(m){this.dirty=!0,m.group=this,m._set("canvas",this.canvas)},_onObjectRemoved:function(m){this.dirty=!0,delete m.group},_set:function(m,v){var T=this._objects.length;if(this.useSetOnGroup)for(;T--;)this._objects[T].setOnGroup(m,v);if("canvas"===m)for(;T--;)this._objects[T]._set(m,v);y.Object.prototype._set.call(this,m,v)},toObject:function(m){var v=this.includeDefaultValues,T=this._objects.filter(function(S){return!S.excludeFromExport}).map(function(S){var x=S.includeDefaultValues;S.includeDefaultValues=v;var L=S.toObject(m);return S.includeDefaultValues=x,L}),A=y.Object.prototype.toObject.call(this,m);return A.objects=T,A},toDatalessObject:function(m){var v,T=this.sourcePath;if(T)v=T;else{var A=this.includeDefaultValues;v=this._objects.map(function(x){var L=x.includeDefaultValues;x.includeDefaultValues=A;var N=x.toDatalessObject(m);return x.includeDefaultValues=L,N})}var S=y.Object.prototype.toDatalessObject.call(this,m);return S.objects=v,S},render:function(m){this._transformDone=!0,this.callSuper("render",m),this._transformDone=!1},shouldCache:function(){var m=y.Object.prototype.shouldCache.call(this);if(m)for(var v=0,T=this._objects.length;v<T;v++)if(this._objects[v].willDrawShadow())return this.ownCaching=!1,!1;return m},willDrawShadow:function(){if(y.Object.prototype.willDrawShadow.call(this))return!0;for(var m=0,v=this._objects.length;m<v;m++)if(this._objects[m].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(m){for(var v=0,T=this._objects.length;v<T;v++)this._objects[v].render(m);this._drawClipPath(m,this.clipPath)},isCacheDirty:function(m){if(this.callSuper("isCacheDirty",m))return!0;if(!this.statefullCache)return!1;for(var v=0,T=this._objects.length;v<T;v++)if(this._objects[v].isCacheDirty(!0)){if(this._cacheCanvas){var A=this.cacheWidth/this.zoomX,S=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-A/2,-S/2,A,S)}return!0}return!1},_restoreObjectsState:function(){var m=this.calcOwnMatrix();return this._objects.forEach(function(v){y.util.addTransformToObject(v,m),delete v.group,v.setCoords()}),this},destroy:function(){return this._objects.forEach(function(m){m.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(m){m.dispose&&m.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var m=this._objects,v=this.canvas;this._objects=[];var T=this.toObject();delete T.objects;var A=new y.ActiveSelection([]);return A.set(T),A.type="activeSelection",v.remove(this),m.forEach(function(S){S.group=A,S.dirty=!0,v.add(S)}),A.canvas=v,A._objects=m,v._activeObject=A,A.setCoords(),A}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(m){m.setCoords(!0)}),this},_calcBounds:function(m){for(var v,T,A,S,x=[],L=[],N=["tr","br","bl","tl"],B=0,H=this._objects.length,V=N.length;B<H;++B){for(A=(v=this._objects[B]).calcACoords(),S=0;S<V;S++)x.push(A[T=N[S]].x),L.push(A[T].y);v.aCoords=A}this._getBounds(x,L,m)},_getBounds:function(m,v,T){var A=new y.Point(w(m),w(v)),S=new y.Point(I(m),I(v)),x=A.y||0,L=A.x||0,B=S.y-A.y||0;this.width=S.x-A.x||0,this.height=B,T||this.setPositionByOrigin({x:L,y:x},"left","top")},_toSVG:function(m){for(var v=["<g ","COMMON_PARTS"," >\n"],T=0,A=this._objects.length;T<A;T++)v.push("\t\t",this._objects[T].toSVG(m));return v.push("</g>\n"),v},getSvgStyles:function(){var v=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),v].join("")},toClipPathSVG:function(m){for(var v=[],T=0,A=this._objects.length;T<A;T++)v.push("\t",this._objects[T].toClipPathSVG(m));return this._createBaseClipPathSVGMarkup(v,{reviver:m})}}),y.Group.fromObject=function(m,v){var T=m.objects,A=y.util.object.clone(m,!0);delete A.objects,"string"!=typeof T?y.util.enlivenObjects(T,function(S){var x=y.util.object.clone(m,!0);delete x.objects,y.util.enlivenObjectEnlivables(m,x,function(){v&&v(new y.Group(S,x,!0))})}):y.loadSVGFromURL(T,function(S){var x=y.util.groupSVGElements(S,m,T);x.set(A),v&&v(x)})})}(a),function(D){var y=D.fabric||(D.fabric={});y.ActiveSelection||(y.ActiveSelection=y.util.createClass(y.Group,{type:"activeSelection",initialize:function(w,I){I=I||{},this._objects=w||[];for(var m=this._objects.length;m--;)this._objects[m].group=this;I.originX&&(this.originX=I.originX),I.originY&&(this.originY=I.originY),this._calcBounds(),this._updateObjectsCoords(),y.Object.prototype.initialize.call(this,I),this.setCoords()},toGroup:function(){var w=this._objects.concat();this._objects=[];var I=y.Object.prototype.toObject.call(this),m=new y.Group([]);if(delete I.type,m.set(I),w.forEach(function(T){T.canvas.remove(T),T.group=m}),m._objects=w,!this.canvas)return m;var v=this.canvas;return v.add(m),v._activeObject=m,m.setCoords(),m},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(w,I,m){w.save(),w.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",w,I),void 0===(m=m||{}).hasControls&&(m.hasControls=!1),m.forActiveSelection=!0;for(var v=0,T=this._objects.length;v<T;v++)this._objects[v]._renderControls(w,m);w.restore()}}),y.ActiveSelection.fromObject=function(w,I){y.util.enlivenObjects(w.objects,function(m){delete w.objects,I&&I(new y.ActiveSelection(m,w,!0))})})}(a),function(D){var y=F.util.object.extend;D.fabric||(D.fabric={}),D.fabric.Image?F.warn("fabric.Image is already defined."):(F.Image=F.util.createClass(F.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:F.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:F.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(w,I){I||(I={}),this.filters=[],this.cacheKey="texture"+F.Object.__uid++,this.callSuper("initialize",I),this._initElement(w,I)},getElement:function(){return this._element||{}},setElement:function(w,I){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=w,this._originalElement=w,this._initConfig(I),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(w){var I=F.filterBackend;I&&I.evictCachesForKey&&I.evictCachesForKey(w)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(w){F.util.cleanUpJsdomNode(this[w]),this[w]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var w=this.getElement();return{width:w.naturalWidth||w.width,height:w.naturalHeight||w.height}},_stroke:function(w){if(this.stroke&&0!==this.strokeWidth){var I=this.width/2,m=this.height/2;w.beginPath(),w.moveTo(-I,-m),w.lineTo(I,-m),w.lineTo(I,m),w.lineTo(-I,m),w.lineTo(-I,-m),w.closePath()}},toObject:function(w){var I=[];this.filters.forEach(function(v){v&&I.push(v.toObject())});var m=y(this.callSuper("toObject",["cropX","cropY"].concat(w)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:I});return this.resizeFilter&&(m.resizeFilter=this.resizeFilter.toObject()),m},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var w,I=[],m=[],v=this._element,T=-this.width/2,A=-this.height/2,S="",x="";if(!v)return[];if(this.hasCrop()){var L=F.Object.__uid++;I.push('<clipPath id="imageCrop_'+L+'">\n','\t<rect x="'+T+'" y="'+A+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),S=' clip-path="url(#imageCrop_'+L+')" '}if(this.imageSmoothing||(x='" image-rendering="optimizeSpeed'),m.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',T-this.cropX,'" y="',A-this.cropY,'" width="',v.width||v.naturalWidth,'" height="',v.height||v.height,x,'"',S,"></image>\n"),this.stroke||this.strokeDashArray){var N=this.fill;this.fill=null,w=["\t<rect ",'x="',T,'" y="',A,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=N}return"fill"!==this.paintFirst?I.concat(w,m):I.concat(m,w)},getSrc:function(w){var I=w?this._element:this._originalElement;return I?I.toDataURL?I.toDataURL():this.srcFromAttribute?I.getAttribute("src"):I.src:this.src||""},setSrc:function(w,I,m){return F.util.loadImage(w,function(v,T){this.setElement(v,m),this._setWidthHeight(),I&&I(this,T)},this,m&&m.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var w=this.resizeFilter,I=this.minimumScaleTrigger,m=this.getTotalObjectScaling(),v=m.scaleX,T=m.scaleY,A=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!w||v>I&&T>I)return this._element=A,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=v,void(this._lastScaleY=T);F.filterBackend||(F.filterBackend=F.initFilterBackend());var S=F.util.createCanvasElement(),x=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,L=A.width,N=A.height;S.width=L,S.height=N,this._element=S,this._lastScaleX=w.scaleX=v,this._lastScaleY=w.scaleY=T,F.filterBackend.applyFilters([w],A,L,N,this._element,x),this._filterScalingX=S.width/this._originalElement.width,this._filterScalingY=S.height/this._originalElement.height},applyFilters:function(w){if(w=(w=w||this.filters||[]).filter(function(A){return A&&!A.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===w.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var I=this._originalElement,m=I.naturalWidth||I.width,v=I.naturalHeight||I.height;if(this._element===this._originalElement){var T=F.util.createCanvasElement();T.width=m,T.height=v,this._element=T,this._filteredEl=T}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,m,v),this._lastScaleX=1,this._lastScaleY=1;return F.filterBackend||(F.filterBackend=F.initFilterBackend()),F.filterBackend.applyFilters(w,this._originalElement,m,v,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(w){F.util.setImageSmoothing(w,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(w),this._renderPaintInOrder(w)},drawCacheOnCanvas:function(w){F.util.setImageSmoothing(w,this.imageSmoothing),F.Object.prototype.drawCacheOnCanvas.call(this,w)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(w){var I=this._element;if(I){var m=this._filterScalingX,v=this._filterScalingY,T=this.width,A=this.height,S=Math.min,x=Math.max,L=x(this.cropX,0),N=x(this.cropY,0),B=I.naturalWidth||I.width,H=I.naturalHeight||I.height,V=L*m,W=N*v,q=S(T*m,B-V),ne=S(A*v,H-W),ie=-T/2,he=-A/2,le=S(T,B/m-L),oe=S(A,H/v-N);I&&w.drawImage(I,V,W,q,ne,ie,he,le,oe)}},_needsResize:function(){var w=this.getTotalObjectScaling();return w.scaleX!==this._lastScaleX||w.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(w,I){this.setElement(F.util.getById(w),I),F.util.addClass(this.getElement(),F.Image.CSS_CANVAS)},_initConfig:function(w){w||(w={}),this.setOptions(w),this._setWidthHeight(w)},_initFilters:function(w,I){w&&w.length?F.util.enlivenObjects(w,function(m){I&&I(m)},"fabric.Image.filters"):I&&I()},_setWidthHeight:function(w){w||(w={});var I=this.getElement();this.width=w.width||I.naturalWidth||I.width||0,this.height=w.height||I.naturalHeight||I.height||0},parsePreserveAspectRatioAttribute:function(){var w,I=F.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),m=this._element.width,v=this._element.height,T=1,A=1,S=0,x=0,L=0,N=0,B=this.width,H=this.height,V={width:B,height:H};return!I||"none"===I.alignX&&"none"===I.alignY?(T=B/m,A=H/v):("meet"===I.meetOrSlice&&(w=(B-m*(T=A=F.util.findScaleToFit(this._element,V)))/2,"Min"===I.alignX&&(S=-w),"Max"===I.alignX&&(S=w),w=(H-v*A)/2,"Min"===I.alignY&&(x=-w),"Max"===I.alignY&&(x=w)),"slice"===I.meetOrSlice&&(w=m-B/(T=A=F.util.findScaleToCover(this._element,V)),"Mid"===I.alignX&&(L=w/2),"Max"===I.alignX&&(L=w),w=v-H/A,"Mid"===I.alignY&&(N=w/2),"Max"===I.alignY&&(N=w),m=B/T,v=H/A)),{width:m,height:v,scaleX:T,scaleY:A,offsetLeft:S,offsetTop:x,cropX:L,cropY:N}}}),F.Image.CSS_CANVAS="canvas-img",F.Image.prototype.getSvgSrc=F.Image.prototype.getSrc,F.Image.fromObject=function(w,I){var m=F.util.object.clone(w);F.util.loadImage(m.src,function(v,T){T?I&&I(null,!0):F.Image.prototype._initFilters.call(m,m.filters,function(A){m.filters=A||[],F.Image.prototype._initFilters.call(m,[m.resizeFilter],function(S){m.resizeFilter=S[0],F.util.enlivenObjectEnlivables(m,m,function(){var x=new F.Image(v,m);I(x,!1)})})})},null,m.crossOrigin)},F.Image.fromURL=function(w,I,m){F.util.loadImage(w,function(v,T){I&&I(new F.Image(v,m),T)},null,m&&m.crossOrigin)},F.Image.ATTRIBUTE_NAMES=F.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),F.Image.fromElement=function(w,I,m){var v=F.parseAttributes(w,F.Image.ATTRIBUTE_NAMES);F.Image.fromURL(v["xlink:href"],I,y(m?F.util.object.clone(m):{},v))})}(a),F.util.object.extend(F.Object.prototype,{_getAngleValueForStraighten:function(){var D=this.angle%360;return D>0?90*Math.round((D-1)/90):90*Math.round(D/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(D){var y=function(){},w=(D=D||{}).onComplete||y,I=D.onChange||y,m=this;return F.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(v){m.rotate(v),I()},onComplete:function(){m.setCoords(),w()}})}}),F.util.object.extend(F.StaticCanvas.prototype,{straightenObject:function(D){return D.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(D){return D.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function D(w,I){var m="precision "+I+" float;\nvoid main(){}",v=w.createShader(w.FRAGMENT_SHADER);return w.shaderSource(v,m),w.compileShader(v),!!w.getShaderParameter(v,w.COMPILE_STATUS)}function y(w){w&&w.tileSize&&(this.tileSize=w.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}F.isWebglSupported=function(w){if(F.isLikelyNode)return!1;w=w||F.WebglFilterBackend.prototype.tileSize;var I=document.createElement("canvas"),m=I.getContext("webgl")||I.getContext("experimental-webgl"),v=!1;if(m){F.maxTextureSize=m.getParameter(m.MAX_TEXTURE_SIZE),v=F.maxTextureSize>=w;for(var T=["highp","mediump","lowp"],A=0;A<3;A++)if(D(m,T[A])){F.webGlPrecision=T[A];break}}return this.isSupported=v,v},F.WebglFilterBackend=y,y.prototype={tileSize:2048,resources:{},setupGLContext:function(w,I){this.dispose(),this.createWebGLCanvas(w,I),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(w,I)},chooseFastestCopyGLTo2DMethod:function(w,I){var m,v=void 0!==window.performance;try{new ImageData(1,1),m=!0}catch(H){m=!1}var T="undefined"!=typeof ArrayBuffer,A="undefined"!=typeof Uint8ClampedArray;if(v&&m&&T&&A){var S=F.util.createCanvasElement(),x=new ArrayBuffer(w*I*4);if(F.forceGLPutImageData)return this.imageBuffer=x,void(this.copyGLTo2D=Ke);var L,N,B={imageBuffer:x,destinationWidth:w,destinationHeight:I,targetCanvas:S};S.width=w,S.height=I,L=window.performance.now(),Ne.call(B,this.gl,B),N=window.performance.now()-L,L=window.performance.now(),Ke.call(B,this.gl,B),N>window.performance.now()-L?(this.imageBuffer=x,this.copyGLTo2D=Ke):this.copyGLTo2D=Ne}},createWebGLCanvas:function(w,I){var m=F.util.createCanvasElement();m.width=w,m.height=I;var v={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},T=m.getContext("webgl",v);T||(T=m.getContext("experimental-webgl",v)),T&&(T.clearColor(0,0,0,0),this.canvas=m,this.gl=T)},applyFilters:function(w,I,m,v,T,A){var S,x=this.gl;A&&(S=this.getCachedTexture(A,I));var B,H,q,ne,L={originalWidth:I.width||I.originalWidth,originalHeight:I.height||I.originalHeight,sourceWidth:m,sourceHeight:v,destinationWidth:m,destinationHeight:v,context:x,sourceTexture:this.createTexture(x,m,v,!S&&I),targetTexture:this.createTexture(x,m,v),originalTexture:S||this.createTexture(x,m,v,!S&&I),passes:w.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:T},N=x.createFramebuffer();return x.bindFramebuffer(x.FRAMEBUFFER,N),w.forEach(function(B){B&&B.applyTo(L)}),ne=(B=L).destinationHeight,(H=B.targetCanvas).width===(q=B.destinationWidth)&&H.height===ne||(H.width=q,H.height=ne),this.copyGLTo2D(x,L),x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(L.sourceTexture),x.deleteTexture(L.targetTexture),x.deleteFramebuffer(N),T.getContext("2d").setTransform(1,0,0,1,0,0),L},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(w,I,m,v){var T=w.createTexture();return w.bindTexture(w.TEXTURE_2D,T),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),v?w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,v):w.texImage2D(w.TEXTURE_2D,0,w.RGBA,I,m,0,w.RGBA,w.UNSIGNED_BYTE,null),T},getCachedTexture:function(w,I){if(this.textureCache[w])return this.textureCache[w];var m=this.createTexture(this.gl,I.width,I.height,I);return this.textureCache[w]=m,m},evictCachesForKey:function(w){this.textureCache[w]&&(this.gl.deleteTexture(this.textureCache[w]),delete this.textureCache[w])},copyGLTo2D:Ne,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var w=this.gl,I={renderer:"",vendor:""};if(!w)return I;var m=w.getExtension("WEBGL_debug_renderer_info");if(m){var v=w.getParameter(m.UNMASKED_RENDERER_WEBGL),T=w.getParameter(m.UNMASKED_VENDOR_WEBGL);v&&(I.renderer=v.toLowerCase()),T&&(I.vendor=T.toLowerCase())}return this.gpuInfo=I,I}}}(),function(){var D=function(){};function y(){}F.Canvas2dFilterBackend=y,y.prototype={evictCachesForKey:D,dispose:D,clearWebGLCaches:D,resources:{},applyFilters:function(w,I,m,v,T){var A=T.getContext("2d");A.drawImage(I,0,0,m,v);var S={sourceWidth:m,sourceHeight:v,imageData:A.getImageData(0,0,m,v),originalEl:I,originalImageData:A.getImageData(0,0,m,v),canvasEl:T,ctx:A,filterBackend:this};return w.forEach(function(x){x.applyTo(S)}),S.imageData.width===m&&S.imageData.height===v||(T.width=S.imageData.width,T.height=S.imageData.height),A.putImageData(S.imageData,0,0),S}}}(),F.Image=F.Image||{},F.Image.filters=F.Image.filters||{},F.Image.filters.BaseFilter=F.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(D){D&&this.setOptions(D)},setOptions:function(D){for(var y in D)this[y]=D[y]},createProgram:function(D,y,w){y=y||this.fragmentSource,w=w||this.vertexSource,"highp"!==F.webGlPrecision&&(y=y.replace(/precision highp float/g,"precision "+F.webGlPrecision+" float"));var I=D.createShader(D.VERTEX_SHADER);if(D.shaderSource(I,w),D.compileShader(I),!D.getShaderParameter(I,D.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+D.getShaderInfoLog(I));var m=D.createShader(D.FRAGMENT_SHADER);if(D.shaderSource(m,y),D.compileShader(m),!D.getShaderParameter(m,D.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+D.getShaderInfoLog(m));var v=D.createProgram();if(D.attachShader(v,I),D.attachShader(v,m),D.linkProgram(v),!D.getProgramParameter(v,D.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+D.getProgramInfoLog(v));var T=this.getAttributeLocations(D,v),A=this.getUniformLocations(D,v)||{};return A.uStepW=D.getUniformLocation(v,"uStepW"),A.uStepH=D.getUniformLocation(v,"uStepH"),{program:v,attributeLocations:T,uniformLocations:A}},getAttributeLocations:function(D,y){return{aPosition:D.getAttribLocation(y,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(D,y,w){var I=y.aPosition,m=D.createBuffer();D.bindBuffer(D.ARRAY_BUFFER,m),D.enableVertexAttribArray(I),D.vertexAttribPointer(I,2,D.FLOAT,!1,0,0),D.bufferData(D.ARRAY_BUFFER,w,D.STATIC_DRAW)},_setupFrameBuffer:function(D){var y,w,I=D.context;D.passes>1?(w=D.destinationHeight,D.sourceWidth===(y=D.destinationWidth)&&D.sourceHeight===w||(I.deleteTexture(D.targetTexture),D.targetTexture=D.filterBackend.createTexture(I,y,w)),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,D.targetTexture,0)):(I.bindFramebuffer(I.FRAMEBUFFER,null),I.finish())},_swapTextures:function(D){D.passes--,D.pass++;var y=D.targetTexture;D.targetTexture=D.sourceTexture,D.sourceTexture=y},isNeutralState:function(){var D=this.mainParameter,y=F.Image.filters[this.type].prototype;if(D){if(Array.isArray(y[D])){for(var w=y[D].length;w--;)if(this[D][w]!==y[D][w])return!1;return!0}return y[D]===this[D]}return!1},applyTo:function(D){D.webgl?(this._setupFrameBuffer(D),this.applyToWebGL(D),this._swapTextures(D)):this.applyTo2d(D)},retrieveShader:function(D){return D.programCache.hasOwnProperty(this.type)||(D.programCache[this.type]=this.createProgram(D.context)),D.programCache[this.type]},applyToWebGL:function(D){var y=D.context,w=this.retrieveShader(D);y.bindTexture(y.TEXTURE_2D,0===D.pass&&D.originalTexture?D.originalTexture:D.sourceTexture),y.useProgram(w.program),this.sendAttributeData(y,w.attributeLocations,D.aPosition),y.uniform1f(w.uniformLocations.uStepW,1/D.sourceWidth),y.uniform1f(w.uniformLocations.uStepH,1/D.sourceHeight),this.sendUniformData(y,w.uniformLocations),y.viewport(0,0,D.destinationWidth,D.destinationHeight),y.drawArrays(y.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(D,y,w){D.activeTexture(w),D.bindTexture(D.TEXTURE_2D,y),D.activeTexture(D.TEXTURE0)},unbindAdditionalTexture:function(D,y){D.activeTexture(y),D.bindTexture(D.TEXTURE_2D,null),D.activeTexture(D.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(D){this[this.mainParameter]=D},sendUniformData:function(){},createHelpLayer:function(D){if(!D.helpLayer){var y=document.createElement("canvas");y.width=D.sourceWidth,y.height=D.sourceHeight,D.helpLayer=y}},toObject:function(){var D={type:this.type},y=this.mainParameter;return y&&(D[y]=this[y]),D},toJSON:function(){return this.toObject()}}),F.Image.filters.BaseFilter.fromObject=function(D,y){var w=new F.Image.filters[D.type](D);return y&&y(w),w},function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.ColorMatrix=(0,y.util.createClass)(w.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(m){this.callSuper("initialize",m),this.matrix=this.matrix.slice(0)},applyTo2d:function(m){var v,T,A,S,x,L=m.imageData.data,N=L.length,B=this.matrix,H=this.colorsOnly;for(x=0;x<N;x+=4)v=L[x],T=L[x+1],A=L[x+2],H?(L[x]=v*B[0]+T*B[1]+A*B[2]+255*B[4],L[x+1]=v*B[5]+T*B[6]+A*B[7]+255*B[9],L[x+2]=v*B[10]+T*B[11]+A*B[12]+255*B[14]):(L[x]=v*B[0]+T*B[1]+A*B[2]+(S=L[x+3])*B[3]+255*B[4],L[x+1]=v*B[5]+T*B[6]+A*B[7]+S*B[8]+255*B[9],L[x+2]=v*B[10]+T*B[11]+A*B[12]+S*B[13]+255*B[14],L[x+3]=v*B[15]+T*B[16]+A*B[17]+S*B[18]+255*B[19])},getUniformLocations:function(m,v){return{uColorMatrix:m.getUniformLocation(v,"uColorMatrix"),uConstants:m.getUniformLocation(v,"uConstants")}},sendUniformData:function(m,v){var T=this.matrix,S=[T[4],T[9],T[14],T[19]];m.uniformMatrix4fv(v.uColorMatrix,!1,[T[0],T[1],T[2],T[3],T[5],T[6],T[7],T[8],T[10],T[11],T[12],T[13],T[15],T[16],T[17],T[18]]),m.uniform4fv(v.uConstants,S)}}),y.Image.filters.ColorMatrix.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Brightness=(0,y.util.createClass)(w.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(m){if(0!==this.brightness){var v,T=m.imageData.data,A=T.length,S=Math.round(255*this.brightness);for(v=0;v<A;v+=4)T[v]=T[v]+S,T[v+1]=T[v+1]+S,T[v+2]=T[v+2]+S}},getUniformLocations:function(m,v){return{uBrightness:m.getUniformLocation(v,"uBrightness")}},sendUniformData:function(m,v){m.uniform1f(v.uBrightness,this.brightness)}}),y.Image.filters.Brightness.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.Image.filters;I.Convolute=(0,y.util.createClass)(I.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(v){var T=Math.sqrt(this.matrix.length),A=this.type+"_"+T+"_"+(this.opaque?1:0),S=this.fragmentSource[A];return v.programCache.hasOwnProperty(A)||(v.programCache[A]=this.createProgram(v.context,S)),v.programCache[A]},applyTo2d:function(v){var T,A,S,x,L,N,B,H,V,W,q,ne,ie,he=v.imageData,le=he.data,oe=this.matrix,J=Math.round(Math.sqrt(oe.length)),Q=Math.floor(J/2),re=he.width,ue=he.height,de=v.ctx.createImageData(re,ue),te=de.data,ee=this.opaque?1:0;for(q=0;q<ue;q++)for(W=0;W<re;W++){for(L=4*(q*re+W),T=0,A=0,S=0,x=0,ie=0;ie<J;ie++)for(ne=0;ne<J;ne++)N=W+ne-Q,(B=q+ie-Q)<0||B>=ue||N<0||N>=re||(T+=le[H=4*(B*re+N)]*(V=oe[ie*J+ne]),A+=le[H+1]*V,S+=le[H+2]*V,ee||(x+=le[H+3]*V));te[L]=T,te[L+1]=A,te[L+2]=S,te[L+3]=ee?le[L+3]:x}v.imageData=de},getUniformLocations:function(v,T){return{uMatrix:v.getUniformLocation(T,"uMatrix"),uOpaque:v.getUniformLocation(T,"uOpaque"),uHalfSize:v.getUniformLocation(T,"uHalfSize"),uSize:v.getUniformLocation(T,"uSize")}},sendUniformData:function(v,T){v.uniform1fv(T.uMatrix,this.matrix)},toObject:function(){return w(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),y.Image.filters.Convolute.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Grayscale=(0,y.util.createClass)(w.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(m){var v,T,A=m.imageData.data,S=A.length,x=this.mode;for(v=0;v<S;v+=4)"average"===x?T=(A[v]+A[v+1]+A[v+2])/3:"lightness"===x?T=(Math.min(A[v],A[v+1],A[v+2])+Math.max(A[v],A[v+1],A[v+2]))/2:"luminosity"===x&&(T=.21*A[v]+.72*A[v+1]+.07*A[v+2]),A[v]=T,A[v+1]=T,A[v+2]=T},retrieveShader:function(m){var v=this.type+"_"+this.mode;return m.programCache.hasOwnProperty(v)||(m.programCache[v]=this.createProgram(m.context,this.fragmentSource[this.mode])),m.programCache[v]},getUniformLocations:function(m,v){return{uMode:m.getUniformLocation(v,"uMode")}},sendUniformData:function(m,v){m.uniform1i(v.uMode,1)},isNeutralState:function(){return!1}}),y.Image.filters.Grayscale.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Invert=(0,y.util.createClass)(w.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(m){var v,T=m.imageData.data,A=T.length;for(v=0;v<A;v+=4)T[v]=255-T[v],T[v+1]=255-T[v+1],T[v+2]=255-T[v+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(m,v){return{uInvert:m.getUniformLocation(v,"uInvert")}},sendUniformData:function(m,v){m.uniform1i(v.uInvert,this.invert)}}),y.Image.filters.Invert.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.Image.filters;I.Noise=(0,y.util.createClass)(I.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(v){if(0!==this.noise){var T,A,x,S=v.imageData.data,L=this.noise;for(T=0,x=S.length;T<x;T+=4)A=(.5-Math.random())*L,S[T]+=A,S[T+1]+=A,S[T+2]+=A}},getUniformLocations:function(v,T){return{uNoise:v.getUniformLocation(T,"uNoise"),uSeed:v.getUniformLocation(T,"uSeed")}},sendUniformData:function(v,T){v.uniform1f(T.uNoise,this.noise/255),v.uniform1f(T.uSeed,Math.random())},toObject:function(){return w(this.callSuper("toObject"),{noise:this.noise})}}),y.Image.filters.Noise.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Pixelate=(0,y.util.createClass)(w.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(m){var v,T,A,S,x,L,N,B,H,V,W,q=m.imageData,ne=q.data,ie=q.height,he=q.width;for(T=0;T<ie;T+=this.blocksize)for(A=0;A<he;A+=this.blocksize)for(S=ne[v=4*T*he+4*A],x=ne[v+1],L=ne[v+2],N=ne[v+3],V=Math.min(T+this.blocksize,ie),W=Math.min(A+this.blocksize,he),B=T;B<V;B++)for(H=A;H<W;H++)ne[v=4*B*he+4*H]=S,ne[v+1]=x,ne[v+2]=L,ne[v+3]=N},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(m,v){return{uBlocksize:m.getUniformLocation(v,"uBlocksize"),uStepW:m.getUniformLocation(v,"uStepW"),uStepH:m.getUniformLocation(v,"uStepH")}},sendUniformData:function(m,v){m.uniform1f(v.uBlocksize,this.blocksize)}}),y.Image.filters.Pixelate.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.extend,I=y.Image.filters;I.RemoveColor=(0,y.util.createClass)(I.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(v){var T,A,S,x,L=v.imageData.data,N=255*this.distance,B=new y.Color(this.color).getSource(),H=[B[0]-N,B[1]-N,B[2]-N],V=[B[0]+N,B[1]+N,B[2]+N];for(T=0;T<L.length;T+=4)S=L[T+1],x=L[T+2],(A=L[T])>H[0]&&S>H[1]&&x>H[2]&&A<V[0]&&S<V[1]&&x<V[2]&&(L[T+3]=0)},getUniformLocations:function(v,T){return{uLow:v.getUniformLocation(T,"uLow"),uHigh:v.getUniformLocation(T,"uHigh")}},sendUniformData:function(v,T){var A=new y.Color(this.color).getSource(),S=parseFloat(this.distance),L=[A[0]/255+S,A[1]/255+S,A[2]/255+S,1];v.uniform4fv(T.uLow,[0+A[0]/255-S,0+A[1]/255-S,0+A[2]/255-S,1]),v.uniform4fv(T.uHigh,L)},toObject:function(){return w(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),y.Image.filters.RemoveColor.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters,I=y.util.createClass,m={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var v in m)w[v]=I(w.ColorMatrix,{type:v,matrix:m[v],mainParameter:!1,colorsOnly:!0}),y.Image.filters[v].fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric,w=y.Image.filters;w.BlendColor=(0,y.util.createClass)(w.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(m){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[m]+"}\n}"},retrieveShader:function(m){var v,T=this.type+"_"+this.mode;return m.programCache.hasOwnProperty(T)||(v=this.buildSource(this.mode),m.programCache[T]=this.createProgram(m.context,v)),m.programCache[T]},applyTo2d:function(m){var v,T,A,S,x,L,N,B=m.imageData.data,H=B.length,V=1-this.alpha;v=(N=new y.Color(this.color).getSource())[0]*this.alpha,T=N[1]*this.alpha,A=N[2]*this.alpha;for(var W=0;W<H;W+=4)switch(S=B[W],x=B[W+1],L=B[W+2],this.mode){case"multiply":B[W]=S*v/255,B[W+1]=x*T/255,B[W+2]=L*A/255;break;case"screen":B[W]=255-(255-S)*(255-v)/255,B[W+1]=255-(255-x)*(255-T)/255,B[W+2]=255-(255-L)*(255-A)/255;break;case"add":B[W]=S+v,B[W+1]=x+T,B[W+2]=L+A;break;case"diff":case"difference":B[W]=Math.abs(S-v),B[W+1]=Math.abs(x-T),B[W+2]=Math.abs(L-A);break;case"subtract":B[W]=S-v,B[W+1]=x-T,B[W+2]=L-A;break;case"darken":B[W]=Math.min(S,v),B[W+1]=Math.min(x,T),B[W+2]=Math.min(L,A);break;case"lighten":B[W]=Math.max(S,v),B[W+1]=Math.max(x,T),B[W+2]=Math.max(L,A);break;case"overlay":B[W]=v<128?2*S*v/255:255-2*(255-S)*(255-v)/255,B[W+1]=T<128?2*x*T/255:255-2*(255-x)*(255-T)/255,B[W+2]=A<128?2*L*A/255:255-2*(255-L)*(255-A)/255;break;case"exclusion":B[W]=v+S-2*v*S/255,B[W+1]=T+x-2*T*x/255,B[W+2]=A+L-2*A*L/255;break;case"tint":B[W]=v+S*V,B[W+1]=T+x*V,B[W+2]=A+L*V}},getUniformLocations:function(m,v){return{uColor:m.getUniformLocation(v,"uColor")}},sendUniformData:function(m,v){var T=new y.Color(this.color).getSource();T[0]=this.alpha*T[0]/255,T[1]=this.alpha*T[1]/255,T[2]=this.alpha*T[2]/255,T[3]=this.alpha,m.uniform4fv(v.uColor,T)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),y.Image.filters.BlendColor.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric,w=y.Image.filters;w.BlendImage=(0,y.util.createClass)(w.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(m){var v=this.type+"_"+this.mode,T=this.fragmentSource[this.mode];return m.programCache.hasOwnProperty(v)||(m.programCache[v]=this.createProgram(m.context,T)),m.programCache[v]},applyToWebGL:function(m){var v=m.context,T=this.createTexture(m.filterBackend,this.image);this.bindAdditionalTexture(v,T,v.TEXTURE1),this.callSuper("applyToWebGL",m),this.unbindAdditionalTexture(v,v.TEXTURE1)},createTexture:function(m,v){return m.getCachedTexture(v.cacheKey,v._element)},calculateMatrix:function(){var m=this.image;return[1/m.scaleX,0,0,0,1/m.scaleY,0,-m.left/m._element.width,-m.top/m._element.height,1]},applyTo2d:function(m){var v,T,A,S,x,L,N,B,H,V,W,q=m.imageData,ne=m.filterBackend.resources,ie=q.data,he=ie.length,le=q.width,oe=q.height,J=this.image;ne.blendImage||(ne.blendImage=y.util.createCanvasElement()),V=(H=ne.blendImage).getContext("2d"),H.width!==le||H.height!==oe?(H.width=le,H.height=oe):V.clearRect(0,0,le,oe),V.setTransform(J.scaleX,0,0,J.scaleY,J.left,J.top),V.drawImage(J._element,0,0,le,oe),W=V.getImageData(0,0,le,oe).data;for(var Q=0;Q<he;Q+=4)switch(x=ie[Q],L=ie[Q+1],N=ie[Q+2],B=ie[Q+3],v=W[Q],T=W[Q+1],A=W[Q+2],S=W[Q+3],this.mode){case"multiply":ie[Q]=x*v/255,ie[Q+1]=L*T/255,ie[Q+2]=N*A/255,ie[Q+3]=B*S/255;break;case"mask":ie[Q+3]=S}},getUniformLocations:function(m,v){return{uTransformMatrix:m.getUniformLocation(v,"uTransformMatrix"),uImage:m.getUniformLocation(v,"uImage")}},sendUniformData:function(m,v){var T=this.calculateMatrix();m.uniform1i(v.uImage,1),m.uniformMatrix3fv(v.uTransformMatrix,!1,T)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),y.Image.filters.BlendImage.fromObject=function(m,v){y.Image.fromObject(m.image,function(T){var A=y.util.object.clone(m);A.image=T,v(new y.Image.filters.BlendImage(A))})}}(a),function(D){var y=D.fabric||(D.fabric={}),w=Math.pow,I=Math.floor,m=Math.sqrt,v=Math.abs,T=Math.round,A=Math.sin,S=Math.ceil,x=y.Image.filters;x.Resize=(0,y.util.createClass)(x.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(N,B){return{uDelta:N.getUniformLocation(B,"uDelta"),uTaps:N.getUniformLocation(B,"uTaps")}},sendUniformData:function(N,B){N.uniform2fv(B.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),N.uniform1fv(B.uTaps,this.taps)},retrieveShader:function(N){var B=this.getFilterWindow(),H=this.type+"_"+B;if(!N.programCache.hasOwnProperty(H)){var V=this.generateShader(B);N.programCache[H]=this.createProgram(N.context,V)}return N.programCache[H]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var N=this.lanczosCreate(this.lanczosLobes),B=this.tempScale,H=this.getFilterWindow(),V=new Array(H),W=1;W<=H;W++)V[W-1]=N(W*B);return V},generateShader:function(N){for(var B=new Array(N),H=this.fragmentSourceTOP,V=1;V<=N;V++)B[V-1]=V+".0 * uDelta";return H+="uniform float uTaps["+N+"];\n",H+="void main() {\n",H+="  vec4 color = texture2D(uTexture, vTexCoord);\n",H+="  float sum = 1.0;\n",B.forEach(function(W,q){H+="  color += texture2D(uTexture, vTexCoord + "+W+") * uTaps["+q+"];\n",H+="  color += texture2D(uTexture, vTexCoord - "+W+") * uTaps["+q+"];\n",H+="  sum += 2.0 * uTaps["+q+"];\n"}),H+="  gl_FragColor = color / sum;\n",H+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(N){N.webgl?(N.passes++,this.width=N.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=N.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),N.destinationWidth=this.dW,this._setupFrameBuffer(N),this.applyToWebGL(N),this._swapTextures(N),N.sourceWidth=N.destinationWidth,this.height=N.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),N.destinationHeight=this.dH,this._setupFrameBuffer(N),this.applyToWebGL(N),this._swapTextures(N),N.sourceHeight=N.destinationHeight):this.applyTo2d(N)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(N){return function(B){if(B>=N||B<=-N)return 0;if(B<1.1920929e-7&&B>-1.1920929e-7)return 1;var H=(B*=Math.PI)/N;return A(B)/B*A(H)/H}},applyTo2d:function(N){var B=N.imageData,H=this.scaleX,V=this.scaleY;this.rcpScaleX=1/H,this.rcpScaleY=1/V;var W,q=B.width,ne=B.height,ie=T(q*H),he=T(ne*V);"sliceHack"===this.resizeType?W=this.sliceByTwo(N,q,ne,ie,he):"hermite"===this.resizeType?W=this.hermiteFastResize(N,q,ne,ie,he):"bilinear"===this.resizeType?W=this.bilinearFiltering(N,q,ne,ie,he):"lanczos"===this.resizeType&&(W=this.lanczosResize(N,q,ne,ie,he)),N.imageData=W},sliceByTwo:function(N,B,H,V,W){var q,ne,ie=N.imageData,le=!1,oe=!1,J=.5*B,Q=.5*H,re=y.filterBackend.resources,ue=0,de=0,te=B,ee=0;for(re.sliceByTwo||(re.sliceByTwo=document.createElement("canvas")),((q=re.sliceByTwo).width<1.5*B||q.height<H)&&(q.width=1.5*B,q.height=H),(ne=q.getContext("2d")).clearRect(0,0,1.5*B,H),ne.putImageData(ie,0,0),V=I(V),W=I(W);!le||!oe;)B=J,H=Q,V<I(.5*J)?J=I(.5*J):(J=V,le=!0),W<I(.5*Q)?Q=I(.5*Q):(Q=W,oe=!0),ne.drawImage(q,ue,de,B,H,te,ee,J,Q),ue=te,de=ee,ee+=Q;return ne.getImageData(ue,de,V,W)},lanczosResize:function(N,B,H,V,W){var q=N.imageData.data,ne=N.ctx.createImageData(V,W),ie=ne.data,he=this.lanczosCreate(this.lanczosLobes),le=this.rcpScaleX,oe=this.rcpScaleY,J=2/this.rcpScaleX,Q=2/this.rcpScaleY,re=S(le*this.lanczosLobes/2),ue=S(oe*this.lanczosLobes/2),de={},te={},ee={};return function se(fe){var ce,pe,De,we,ve,be,Ee,Ie,ke,Re,rt;for(te.x=(fe+.5)*le,ee.x=I(te.x),ce=0;ce<W;ce++){for(te.y=(ce+.5)*oe,ee.y=I(te.y),ve=0,be=0,Ee=0,Ie=0,ke=0,pe=ee.x-re;pe<=ee.x+re;pe++)if(!(pe<0||pe>=B)){Re=I(1e3*v(pe-te.x)),de[Re]||(de[Re]={});for(var Et=ee.y-ue;Et<=ee.y+ue;Et++)Et<0||Et>=H||(rt=I(1e3*v(Et-te.y)),de[Re][rt]||(de[Re][rt]=he(m(w(Re*J,2)+w(rt*Q,2))/1e3)),(De=de[Re][rt])>0&&(ve+=De,be+=De*q[we=4*(Et*B+pe)],Ee+=De*q[we+1],Ie+=De*q[we+2],ke+=De*q[we+3]))}ie[we=4*(ce*V+fe)]=be/ve,ie[we+1]=Ee/ve,ie[we+2]=Ie/ve,ie[we+3]=ke/ve}return++fe<V?se(fe):ne}(0)},bilinearFiltering:function(N,B,H,V,W){var q,ne,ie,he,le,oe,J,re,ue=0,de=this.rcpScaleX,te=this.rcpScaleY,ee=4*(B-1),se=N.imageData.data,fe=N.ctx.createImageData(V,W),ce=fe.data;for(ie=0;ie<W;ie++)for(he=0;he<V;he++)for(le=de*he-(q=I(de*he)),oe=te*ie-(ne=I(te*ie)),re=4*(ne*B+q),J=0;J<4;J++)ce[ue++]=se[re+J]*(1-le)*(1-oe)+se[re+4+J]*le*(1-oe)+se[re+ee+J]*oe*(1-le)+se[re+ee+4+J]*le*oe;return fe},hermiteFastResize:function(N,B,H,V,W){for(var q=this.rcpScaleX,ne=this.rcpScaleY,ie=S(q/2),he=S(ne/2),le=N.imageData.data,oe=N.ctx.createImageData(V,W),J=oe.data,Q=0;Q<W;Q++)for(var re=0;re<V;re++){for(var ue=4*(re+Q*V),de=0,te=0,ee=0,se=0,fe=0,ce=0,pe=0,De=(Q+.5)*ne,we=I(Q*ne);we<(Q+1)*ne;we++)for(var ve=v(De-(we+.5))/he,be=(re+.5)*q,Ee=ve*ve,Ie=I(re*q);Ie<(re+1)*q;Ie++){var ke=v(be-(Ie+.5))/ie,Re=m(Ee+ke*ke);Re>1&&Re<-1||(de=2*Re*Re*Re-3*Re*Re+1)>0&&(pe+=de*le[3+(ke=4*(Ie+we*B))],ee+=de,le[ke+3]<255&&(de=de*le[ke+3]/250),se+=de*le[ke],fe+=de*le[ke+1],ce+=de*le[ke+2],te+=de)}J[ue]=se/te,J[ue+1]=fe/te,J[ue+2]=ce/te,J[ue+3]=pe/ee}return oe},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),y.Image.filters.Resize.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Contrast=(0,y.util.createClass)(w.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(m){if(0!==this.contrast){var v,T=m.imageData.data,A=T.length,S=Math.floor(255*this.contrast),x=259*(S+255)/(255*(259-S));for(v=0;v<A;v+=4)T[v]=x*(T[v]-128)+128,T[v+1]=x*(T[v+1]-128)+128,T[v+2]=x*(T[v+2]-128)+128}},getUniformLocations:function(m,v){return{uContrast:m.getUniformLocation(v,"uContrast")}},sendUniformData:function(m,v){m.uniform1f(v.uContrast,this.contrast)}}),y.Image.filters.Contrast.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Saturation=(0,y.util.createClass)(w.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(m){if(0!==this.saturation){var v,T,A=m.imageData.data,S=A.length,x=-this.saturation;for(v=0;v<S;v+=4)T=Math.max(A[v],A[v+1],A[v+2]),A[v]+=T!==A[v]?(T-A[v])*x:0,A[v+1]+=T!==A[v+1]?(T-A[v+1])*x:0,A[v+2]+=T!==A[v+2]?(T-A[v+2])*x:0}},getUniformLocations:function(m,v){return{uSaturation:m.getUniformLocation(v,"uSaturation")}},sendUniformData:function(m,v){m.uniform1f(v.uSaturation,-this.saturation)}}),y.Image.filters.Saturation.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Vibrance=(0,y.util.createClass)(w.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(m){if(0!==this.vibrance){var v,T,S,x=m.imageData.data,L=x.length,N=-this.vibrance;for(v=0;v<L;v+=4)T=Math.max(x[v],x[v+1],x[v+2]),S=2*Math.abs(T-(x[v]+x[v+1]+x[v+2])/3)/255*N,x[v]+=T!==x[v]?(T-x[v])*S:0,x[v+1]+=T!==x[v+1]?(T-x[v+1])*S:0,x[v+2]+=T!==x[v+2]?(T-x[v+2])*S:0}},getUniformLocations:function(m,v){return{uVibrance:m.getUniformLocation(v,"uVibrance")}},sendUniformData:function(m,v){m.uniform1f(v.uVibrance,-this.vibrance)}}),y.Image.filters.Vibrance.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Blur=(0,y.util.createClass)(w.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(m){m.webgl?(this.aspectRatio=m.sourceWidth/m.sourceHeight,m.passes++,this._setupFrameBuffer(m),this.horizontal=!0,this.applyToWebGL(m),this._swapTextures(m),this._setupFrameBuffer(m),this.horizontal=!1,this.applyToWebGL(m),this._swapTextures(m)):this.applyTo2d(m)},applyTo2d:function(m){m.imageData=this.simpleBlur(m)},simpleBlur:function(m){var v,T,A=m.filterBackend.resources,S=m.imageData.width,x=m.imageData.height;A.blurLayer1||(A.blurLayer1=y.util.createCanvasElement(),A.blurLayer2=y.util.createCanvasElement()),T=A.blurLayer2,(v=A.blurLayer1).width===S&&v.height===x||(T.width=v.width=S,T.height=v.height=x);var L,N,B,H,V=v.getContext("2d"),W=T.getContext("2d"),q=.06*this.blur*.5;for(V.putImageData(m.imageData,0,0),W.clearRect(0,0,S,x),H=-15;H<=15;H++)B=q*(N=H/15)*S+(L=(Math.random()-.5)/4),W.globalAlpha=1-Math.abs(N),W.drawImage(v,B,L),V.drawImage(T,0,0),W.globalAlpha=1,W.clearRect(0,0,T.width,T.height);for(H=-15;H<=15;H++)B=q*(N=H/15)*x+(L=(Math.random()-.5)/4),W.globalAlpha=1-Math.abs(N),W.drawImage(v,L,B),V.drawImage(T,0,0),W.globalAlpha=1,W.clearRect(0,0,T.width,T.height);m.ctx.drawImage(v,0,0);var ne=m.ctx.getImageData(0,0,v.width,v.height);return V.globalAlpha=1,V.clearRect(0,0,v.width,v.height),ne},getUniformLocations:function(m,v){return{delta:m.getUniformLocation(v,"uDelta")}},sendUniformData:function(m,v){var T=this.chooseRightDelta();m.uniform2fv(v.delta,T)},chooseRightDelta:function(){var m,v=1,T=[0,0];return this.horizontal?this.aspectRatio>1&&(v=1/this.aspectRatio):this.aspectRatio<1&&(v=this.aspectRatio),m=v*this.blur*.12,this.horizontal?T[0]=m:T[1]=m,T}}),w.Blur.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Gamma=(0,y.util.createClass)(w.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(m){this.gamma=[1,1,1],w.BaseFilter.prototype.initialize.call(this,m)},applyTo2d:function(m){var v,T=m.imageData.data,A=this.gamma,S=T.length,x=1/A[0],L=1/A[1],N=1/A[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,S=256;v<S;v++)this.rVals[v]=255*Math.pow(v/255,x),this.gVals[v]=255*Math.pow(v/255,L),this.bVals[v]=255*Math.pow(v/255,N);for(v=0,S=T.length;v<S;v+=4)T[v]=this.rVals[T[v]],T[v+1]=this.gVals[T[v+1]],T[v+2]=this.bVals[T[v+2]]},getUniformLocations:function(m,v){return{uGamma:m.getUniformLocation(v,"uGamma")}},sendUniformData:function(m,v){m.uniform3fv(v.uGamma,this.gamma)}}),y.Image.filters.Gamma.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.Composed=(0,y.util.createClass)(w.BaseFilter,{type:"Composed",subFilters:[],initialize:function(m){this.callSuper("initialize",m),this.subFilters=this.subFilters.slice(0)},applyTo:function(m){m.passes+=this.subFilters.length-1,this.subFilters.forEach(function(v){v.applyTo(m)})},toObject:function(){return y.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(m){return m.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(m){return!m.isNeutralState()})}}),y.Image.filters.Composed.fromObject=function(m,v){var T=(m.subFilters||[]).map(function(S){return new y.Image.filters[S.type](S)}),A=new y.Image.filters.Composed({subFilters:T});return v&&v(A),A}}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.Image.filters;w.HueRotation=(0,y.util.createClass)(w.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var m=this.rotation*Math.PI,v=y.util.cos(m),T=y.util.sin(m),A=1/3,S=Math.sqrt(A)*T,x=1-v;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=v+x/3,this.matrix[1]=A*x-S,this.matrix[2]=A*x+S,this.matrix[5]=A*x+S,this.matrix[6]=v+A*x,this.matrix[7]=A*x-S,this.matrix[10]=A*x-S,this.matrix[11]=A*x+S,this.matrix[12]=v+A*x},isNeutralState:function(m){return this.calculateMatrix(),w.BaseFilter.prototype.isNeutralState.call(this,m)},applyTo:function(m){this.calculateMatrix(),w.BaseFilter.prototype.applyTo.call(this,m)}}),y.Image.filters.HueRotation.fromObject=y.Image.filters.BaseFilter.fromObject}(a),function(D){var y=D.fabric||(D.fabric={}),w=y.util.object.clone;if(y.Text)y.warn("fabric.Text is already defined");else{var I="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");y.Text=y.util.createClass(y.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:y.Object.prototype.stateProperties.concat(I),cacheProperties:y.Object.prototype.cacheProperties.concat(I),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(m,v){this.styles=v&&v.styles||{},this.text=m,this.__skipDimension=!0,this.callSuper("initialize",v),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var m=this.path;m&&(m.segmentsInfo=y.util.getPathSegmentsInfo(m.path))},getMeasuringContext:function(){return y._measuringContext||(y._measuringContext=this.canvas&&this.canvas.contextCache||y.util.createCanvasElement().getContext("2d")),y._measuringContext},_splitText:function(){var m=this._splitTextIntoLines(this.text);return this.textLines=m.lines,this._textLines=m.graphemeLines,this._unwrappedTextLines=m._unwrappedLines,this._text=m.graphemeText,m},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var m,v,A,S,x,L,N=0,B=this._textLines.length;N<B;N++)if(("justify"===this.textAlign||N!==B-1&&!this.isEndOfWrapping(N))&&(A=0,S=this._textLines[N],(v=this.getLineWidth(N))<this.width&&(L=this.textLines[N].match(this._reSpacesAndTabs)))){m=(this.width-v)/L.length;for(var H=0,V=S.length;H<=V;H++)x=this.__charBounds[N][H],this._reSpaceAndTab.test(S[H])?(x.width+=m,x.kernedWidth+=m,x.left+=A,A+=m):x.left+=A}},isEndOfWrapping:function(m){return m===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var m=this.callSuper("_getCacheCanvasDimensions"),v=this.fontSize;return m.width+=v*m.zoomX,m.height+=v*m.zoomY,m},_render:function(m){var v=this.path;v&&!v.isNotVisible()&&v._render(m),this._setTextStyles(m),this._renderTextLinesBackground(m),this._renderTextDecoration(m,"underline"),this._renderText(m),this._renderTextDecoration(m,"overline"),this._renderTextDecoration(m,"linethrough")},_renderText:function(m){"stroke"===this.paintFirst?(this._renderTextStroke(m),this._renderTextFill(m)):(this._renderTextFill(m),this._renderTextStroke(m))},_setTextStyles:function(m,v,T){if(m.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":m.textBaseline="middle";break;case"ascender":m.textBaseline="top";break;case"descender":m.textBaseline="bottom"}m.font=this._getFontDeclaration(v,T)},calcTextWidth:function(){for(var m=this.getLineWidth(0),v=1,T=this._textLines.length;v<T;v++){var A=this.getLineWidth(v);A>m&&(m=A)}return m},_renderTextLine:function(m,v,T,A,S,x){this._renderChars(m,v,T,A,S,x)},_renderTextLinesBackground:function(m){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var v,T,A,S,x,L,N,B=m.fillStyle,H=this._getLeftOffset(),V=this._getTopOffset(),W=0,q=0,ne=this.path,ie=0,he=this._textLines.length;ie<he;ie++)if(v=this.getHeightOfLine(ie),this.textBackgroundColor||this.styleHas("textBackgroundColor",ie)){A=this._textLines[ie],T=this._getLineLeftOffset(ie),q=0,W=0,S=this.getValueOfPropertyAt(ie,0,"textBackgroundColor");for(var le=0,oe=A.length;le<oe;le++)x=this.__charBounds[ie][le],L=this.getValueOfPropertyAt(ie,le,"textBackgroundColor"),ne?(m.save(),m.translate(x.renderLeft,x.renderTop),m.rotate(x.angle),m.fillStyle=L,L&&m.fillRect(-x.width/2,-v/this.lineHeight*(1-this._fontSizeFraction),x.width,v/this.lineHeight),m.restore()):L!==S?(N=H+T+W,"rtl"===this.direction&&(N=this.width-N-q),m.fillStyle=S,S&&m.fillRect(N,V,q,v/this.lineHeight),W=x.left,q=x.width,S=L):q+=x.kernedWidth;L&&!ne&&(N=H+T+W,"rtl"===this.direction&&(N=this.width-N-q),m.fillStyle=L,m.fillRect(N,V,q,v/this.lineHeight)),V+=v}else V+=v;m.fillStyle=B,this._removeShadow(m)}},getFontCache:function(m){var v=m.fontFamily.toLowerCase();y.charWidthsCache[v]||(y.charWidthsCache[v]={});var T=y.charWidthsCache[v],A=m.fontStyle.toLowerCase()+"_"+(m.fontWeight+"").toLowerCase();return T[A]||(T[A]={}),T[A]},_measureChar:function(m,v,T,A){var S,x,L,N,B=this.getFontCache(v),H=T+m,V=this._getFontDeclaration(v)===this._getFontDeclaration(A),W=v.fontSize/this.CACHE_FONT_SIZE;if(T&&void 0!==B[T]&&(L=B[T]),void 0!==B[m]&&(N=S=B[m]),V&&void 0!==B[H]&&(N=(x=B[H])-L),void 0===S||void 0===L||void 0===x){var q=this.getMeasuringContext();this._setTextStyles(q,v,!0)}return void 0===S&&(N=S=q.measureText(m).width,B[m]=S),void 0===L&&V&&T&&(L=q.measureText(T).width,B[T]=L),V&&void 0===x&&(x=q.measureText(H).width,B[H]=x,N=x-L),{width:S*W,kernedWidth:N*W}},getHeightOfChar:function(m,v){return this.getValueOfPropertyAt(m,v,"fontSize")},measureLine:function(m){var v=this._measureLine(m);return 0!==this.charSpacing&&(v.width-=this._getWidthOfCharSpacing()),v.width<0&&(v.width=0),v},_measureLine:function(m){var v,T,A,S,x,L,N=0,B=this._textLines[m],H=new Array(B.length),V=0,W=this.path,q="right"===this.pathSide;for(this.__charBounds[m]=H,v=0;v<B.length;v++)S=this._getGraphemeBox(T=B[v],m,v,A),H[v]=S,N+=S.kernedWidth,A=T;if(H[v]={left:S?S.left+S.width:0,width:0,kernedWidth:0,height:this.fontSize},W){switch(L=W.segmentsInfo[W.segmentsInfo.length-1].length,(x=y.util.getPointOnPath(W.path,0,W.segmentsInfo)).x+=W.pathOffset.x,x.y+=W.pathOffset.y,this.textAlign){case"left":V=q?L-N:0;break;case"center":V=(L-N)/2;break;case"right":V=q?0:L-N}for(V+=this.pathStartOffset*(q?-1:1),v=q?B.length-1:0;q?v>=0:v<B.length;q?v--:v++)V>L?V%=L:V<0&&(V+=L),this._setGraphemeOnPath(V,S=H[v],x),V+=S.kernedWidth}return{width:N,numOfSpaces:0}},_setGraphemeOnPath:function(m,v,T){var S=this.path,x=y.util.getPointOnPath(S.path,m+v.kernedWidth/2,S.segmentsInfo);v.renderLeft=x.x-T.x,v.renderTop=x.y-T.y,v.angle=x.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(m,v,T,A,S){var x,L=this.getCompleteStyleDeclaration(v,T),N=A?this.getCompleteStyleDeclaration(v,T-1):{},B=this._measureChar(m,L,A,N),H=B.kernedWidth,V=B.width;0!==this.charSpacing&&(V+=x=this._getWidthOfCharSpacing(),H+=x);var W={width:V,left:0,height:L.fontSize,kernedWidth:H,deltaY:L.deltaY};if(T>0&&!S){var q=this.__charBounds[v][T-1];W.left=q.left+q.width+B.kernedWidth-B.width}return W},getHeightOfLine:function(m){if(this.__lineHeights[m])return this.__lineHeights[m];for(var v=this._textLines[m],T=this.getHeightOfChar(m,0),A=1,S=v.length;A<S;A++)T=Math.max(this.getHeightOfChar(m,A),T);return this.__lineHeights[m]=T*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var m,v=0,T=0,A=this._textLines.length;T<A;T++)m=this.getHeightOfLine(T),v+=T===A-1?m/this.lineHeight:m;return v},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(m,v){m.save();for(var T=0,A=this._getLeftOffset(),S=this._getTopOffset(),x=0,L=this._textLines.length;x<L;x++){var N=this.getHeightOfLine(x),B=N/this.lineHeight,H=this._getLineLeftOffset(x);this._renderTextLine(v,m,this._textLines[x],A+H,S+T+B,x),T+=N}m.restore()},_renderTextFill:function(m){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(m,"fillText")},_renderTextStroke:function(m){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(m),m.save(),this._setLineDash(m,this.strokeDashArray),m.beginPath(),this._renderTextCommon(m,"strokeText"),m.closePath(),m.restore())},_renderChars:function(m,v,T,A,S,x){var L,N,B,H,W=this.getHeightOfLine(x),q=-1!==this.textAlign.indexOf("justify"),ne="",ie=0,he=this.path,le=!q&&0===this.charSpacing&&this.isEmptyStyles(x)&&!he,oe="ltr"===this.direction,J="ltr"===this.direction?1:-1,Q=v.canvas.getAttribute("dir");if(v.save(),Q!==this.direction&&(v.canvas.setAttribute("dir",oe?"ltr":"rtl"),v.direction=oe?"ltr":"rtl",v.textAlign=oe?"left":"right"),S-=W*this._fontSizeFraction/this.lineHeight,le)return this._renderChar(m,v,x,0,T.join(""),A,S,W),void v.restore();for(var re=0,ue=T.length-1;re<=ue;re++)H=re===ue||this.charSpacing||he,ne+=T[re],B=this.__charBounds[x][re],0===ie?(A+=J*(B.kernedWidth-B.width),ie+=B.width):ie+=B.kernedWidth,q&&!H&&this._reSpaceAndTab.test(T[re])&&(H=!0),H||(L=L||this.getCompleteStyleDeclaration(x,re),N=this.getCompleteStyleDeclaration(x,re+1),H=this._hasStyleChanged(L,N)),H&&(he?(v.save(),v.translate(B.renderLeft,B.renderTop),v.rotate(B.angle),this._renderChar(m,v,x,re,ne,-ie/2,0,W),v.restore()):this._renderChar(m,v,x,re,ne,A,S,W),ne="",L=N,A+=J*ie,ie=0);v.restore()},_applyPatternGradientTransformText:function(m){var v,T=y.util.createCanvasElement(),A=this.width+this.strokeWidth,S=this.height+this.strokeWidth;return T.width=A,T.height=S,(v=T.getContext("2d")).beginPath(),v.moveTo(0,0),v.lineTo(A,0),v.lineTo(A,S),v.lineTo(0,S),v.closePath(),v.translate(A/2,S/2),v.fillStyle=m.toLive(v),this._applyPatternGradientTransform(v,m),v.fill(),v.createPattern(T,"no-repeat")},handleFiller:function(m,v,T){var A,S;return T.toLive?"percentage"===T.gradientUnits||T.gradientTransform||T.patternTransform?(m.translate(A=-this.width/2,S=-this.height/2),m[v]=this._applyPatternGradientTransformText(T),{offsetX:A,offsetY:S}):(m[v]=T.toLive(m,this),this._applyPatternGradientTransform(m,T)):(m[v]=T,{offsetX:0,offsetY:0})},_setStrokeStyles:function(m,v){return m.lineWidth=v.strokeWidth,m.lineCap=this.strokeLineCap,m.lineDashOffset=this.strokeDashOffset,m.lineJoin=this.strokeLineJoin,m.miterLimit=this.strokeMiterLimit,this.handleFiller(m,"strokeStyle",v.stroke)},_setFillStyles:function(m,v){return this.handleFiller(m,"fillStyle",v.fill)},_renderChar:function(m,v,T,A,S,x,L){var N,B,H=this._getStyleDeclaration(T,A),V=this.getCompleteStyleDeclaration(T,A),W="fillText"===m&&V.fill,q="strokeText"===m&&V.stroke&&V.strokeWidth;(q||W)&&(v.save(),W&&(N=this._setFillStyles(v,V)),q&&(B=this._setStrokeStyles(v,V)),v.font=this._getFontDeclaration(V),H&&H.textBackgroundColor&&this._removeShadow(v),H&&H.deltaY&&(L+=H.deltaY),W&&v.fillText(S,x-N.offsetX,L-N.offsetY),q&&v.strokeText(S,x-B.offsetX,L-B.offsetY),v.restore())},setSuperscript:function(m,v){return this._setScript(m,v,this.superscript)},setSubscript:function(m,v){return this._setScript(m,v,this.subscript)},_setScript:function(m,v,T){var A=this.get2DCursorLocation(m,!0),S=this.getValueOfPropertyAt(A.lineIndex,A.charIndex,"fontSize"),x=this.getValueOfPropertyAt(A.lineIndex,A.charIndex,"deltaY");return this.setSelectionStyles({fontSize:S*T.size,deltaY:x+S*T.baseline},m,v),this},_hasStyleChanged:function(m,v){return m.fill!==v.fill||m.stroke!==v.stroke||m.strokeWidth!==v.strokeWidth||m.fontSize!==v.fontSize||m.fontFamily!==v.fontFamily||m.fontWeight!==v.fontWeight||m.fontStyle!==v.fontStyle||m.deltaY!==v.deltaY},_hasStyleChangedForSvg:function(m,v){return this._hasStyleChanged(m,v)||m.overline!==v.overline||m.underline!==v.underline||m.linethrough!==v.linethrough},_getLineLeftOffset:function(m){var v=this.getLineWidth(m),T=this.width-v,A=this.textAlign,S=this.direction,x=0,L=this.isEndOfWrapping(m);return"justify"===A||"justify-center"===A&&!L||"justify-right"===A&&!L||"justify-left"===A&&!L?0:("center"===A&&(x=T/2),"right"===A&&(x=T),"justify-center"===A&&(x=T/2),"justify-right"===A&&(x=T),"rtl"===S&&(x-=T),x)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var m=this._forceClearCache;return m||(m=this.hasStateChanged("_dimensionAffectingProps")),m&&(this.dirty=!0,this._forceClearCache=!1),m},getLineWidth:function(m){if(void 0!==this.__lineWidths[m])return this.__lineWidths[m];var v=this.measureLine(m).width;return this.__lineWidths[m]=v,v},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(m,v,T){var A=this._getStyleDeclaration(m,v);return A&&void 0!==A[T]?A[T]:this[T]},_renderTextDecoration:function(m,v){if(this[v]||this.styleHas(v)){for(var T,A,S,x,L,N,B,H,V,W,q,ne,ie,he,le,oe,J=this._getLeftOffset(),Q=this._getTopOffset(),re=this.path,ue=this._getWidthOfCharSpacing(),de=this.offsets[v],te=0,ee=this._textLines.length;te<ee;te++)if(T=this.getHeightOfLine(te),this[v]||this.styleHas(v,te)){B=this._textLines[te],he=T/this.lineHeight,x=this._getLineLeftOffset(te),W=0,q=0,H=this.getValueOfPropertyAt(te,0,v),oe=this.getValueOfPropertyAt(te,0,"fill"),V=Q+he*(1-this._fontSizeFraction),A=this.getHeightOfChar(te,0),L=this.getValueOfPropertyAt(te,0,"deltaY");for(var se=0,fe=B.length;se<fe;se++)if(ne=this.__charBounds[te][se],ie=this.getValueOfPropertyAt(te,se,v),le=this.getValueOfPropertyAt(te,se,"fill"),S=this.getHeightOfChar(te,se),N=this.getValueOfPropertyAt(te,se,"deltaY"),re&&ie&&le)m.save(),m.fillStyle=oe,m.translate(ne.renderLeft,ne.renderTop),m.rotate(ne.angle),m.fillRect(-ne.kernedWidth/2,de*S+N,ne.kernedWidth,this.fontSize/15),m.restore();else if((ie!==H||le!==oe||S!==A||N!==L)&&q>0){var ce=J+x+W;"rtl"===this.direction&&(ce=this.width-ce-q),H&&oe&&(m.fillStyle=oe,m.fillRect(ce,V+de*A+L,q,this.fontSize/15)),W=ne.left,q=ne.width,H=ie,oe=le,A=S,L=N}else q+=ne.kernedWidth;ce=J+x+W,"rtl"===this.direction&&(ce=this.width-ce-q),m.fillStyle=le,ie&&le&&m.fillRect(ce,V+de*A+L,q-ue,this.fontSize/15),Q+=T}else Q+=T;this._removeShadow(m)}},_getFontDeclaration:function(m,v){var T=m||this,A=this.fontFamily,S=y.Text.genericFonts.indexOf(A.toLowerCase())>-1,x=void 0===A||A.indexOf("'")>-1||A.indexOf(",")>-1||A.indexOf('"')>-1||S?T.fontFamily:'"'+T.fontFamily+'"';return[y.isLikelyNode?T.fontWeight:T.fontStyle,y.isLikelyNode?T.fontStyle:T.fontWeight,v?this.CACHE_FONT_SIZE+"px":T.fontSize+"px",x].join(" ")},render:function(m){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",m)))},_splitTextIntoLines:function(m){for(var v=m.split(this._reNewline),T=new Array(v.length),A=["\n"],S=[],x=0;x<v.length;x++)T[x]=y.util.string.graphemeSplit(v[x]),S=S.concat(T[x],A);return S.pop(),{_unwrappedLines:T,lines:v,graphemeText:S,graphemeLines:T}},toObject:function(m){var v=I.concat(m),T=this.callSuper("toObject",v);return T.styles=w(this.styles,!0),T.path&&(T.path=this.path.toObject()),T},set:function(m,v){this.callSuper("set",m,v);var T=!1,A=!1;if("object"==typeof m)for(var S in m)"path"===S&&this.setPathInfo(),T=T||-1!==this._dimensionAffectingProps.indexOf(S),A=A||"path"===S;else T=-1!==this._dimensionAffectingProps.indexOf(m),A="path"===m;return A&&this.setPathInfo(),T&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),y.Text.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),y.Text.DEFAULT_SVG_FONT_SIZE=16,y.Text.fromElement=function(m,v,T){if(!m)return v(null);var A=y.parseAttributes(m,y.Text.ATTRIBUTE_NAMES),S=A.textAnchor||"left";if((T=y.util.object.extend(T?w(T):{},A)).top=T.top||0,T.left=T.left||0,A.textDecoration){var x=A.textDecoration;-1!==x.indexOf("underline")&&(T.underline=!0),-1!==x.indexOf("overline")&&(T.overline=!0),-1!==x.indexOf("line-through")&&(T.linethrough=!0),delete T.textDecoration}"dx"in A&&(T.left+=A.dx),"dy"in A&&(T.top+=A.dy),"fontSize"in T||(T.fontSize=y.Text.DEFAULT_SVG_FONT_SIZE);var L="";"textContent"in m?L=m.textContent:"firstChild"in m&&null!==m.firstChild&&"data"in m.firstChild&&null!==m.firstChild.data&&(L=m.firstChild.data),L=L.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var N=T.strokeWidth;T.strokeWidth=0;var B=new y.Text(L,T),H=B.getScaledHeight()/B.height,V=((B.height+B.strokeWidth)*B.lineHeight-B.height)*H,W=B.getScaledHeight()+V,q=0;"center"===S&&(q=B.getScaledWidth()/2),"right"===S&&(q=B.getScaledWidth()),B.set({left:B.left-q,top:B.top-(W-B.fontSize*(.07+B._fontSizeFraction))/B.lineHeight,strokeWidth:void 0!==N?N:1}),v(B)},y.Text.fromObject=function(m,v){var T=w(m),A=m.path;return delete T.path,y.Object._fromObject("Text",T,function(S){A?y.Object._fromObject("Path",A,function(x){S.set("path",x),v(S)},"path"):v(S)},"text")},y.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],y.util.createAccessors&&y.util.createAccessors(y.Text)}}(a),F.util.object.extend(F.Text.prototype,{isEmptyStyles:function(D){if(!this.styles||void 0!==D&&!this.styles[D])return!0;var y=void 0===D?this.styles:{line:this.styles[D]};for(var w in y)for(var I in y[w])for(var m in y[w][I])return!1;return!0},styleHas:function(D,y){if(!this.styles||!D||""===D||void 0!==y&&!this.styles[y])return!1;var w=void 0===y?this.styles:{0:this.styles[y]};for(var I in w)for(var m in w[I])if(void 0!==w[I][m][D])return!0;return!1},cleanStyle:function(D){if(!this.styles||!D||""===D)return!1;var y,w,I=this.styles,m=0,v=!0,T=0;for(var A in I){for(var S in y=0,I[A]){var x;m++,(x=I[A][S]).hasOwnProperty(D)?(w?x[D]!==w&&(v=!1):w=x[D],x[D]===this[D]&&delete x[D]):v=!1,0!==Object.keys(x).length?y++:delete I[A][S]}0===y&&delete I[A]}for(var L=0;L<this._textLines.length;L++)T+=this._textLines[L].length;v&&m===T&&(this[D]=w,this.removeStyle(D))},removeStyle:function(D){if(this.styles&&D&&""!==D){var y,w,I,m=this.styles;for(w in m){for(I in y=m[w])delete y[I][D],0===Object.keys(y[I]).length&&delete y[I];0===Object.keys(y).length&&delete m[w]}}},_extendStyles:function(D,y){var w=this.get2DCursorLocation(D);this._getLineStyle(w.lineIndex)||this._setLineStyle(w.lineIndex),this._getStyleDeclaration(w.lineIndex,w.charIndex)||this._setStyleDeclaration(w.lineIndex,w.charIndex,{}),F.util.object.extend(this._getStyleDeclaration(w.lineIndex,w.charIndex),y)},get2DCursorLocation:function(D,y){void 0===D&&(D=this.selectionStart);for(var w=y?this._unwrappedTextLines:this._textLines,I=w.length,m=0;m<I;m++){if(D<=w[m].length)return{lineIndex:m,charIndex:D};D-=w[m].length+this.missingNewlineOffset(m)}return{lineIndex:m-1,charIndex:w[m-1].length<D?w[m-1].length:D}},getSelectionStyles:function(D,y,w){void 0===D&&(D=this.selectionStart||0),void 0===y&&(y=this.selectionEnd||D);for(var I=[],m=D;m<y;m++)I.push(this.getStyleAtPosition(m,w));return I},getStyleAtPosition:function(D,y){var w=this.get2DCursorLocation(D);return(y?this.getCompleteStyleDeclaration(w.lineIndex,w.charIndex):this._getStyleDeclaration(w.lineIndex,w.charIndex))||{}},setSelectionStyles:function(D,y,w){void 0===y&&(y=this.selectionStart||0),void 0===w&&(w=this.selectionEnd||y);for(var I=y;I<w;I++)this._extendStyles(I,D);return this._forceClearCache=!0,this},_getStyleDeclaration:function(D,y){var w=this.styles&&this.styles[D];return w?w[y]:null},getCompleteStyleDeclaration:function(D,y){for(var w,I=this._getStyleDeclaration(D,y)||{},m={},v=0;v<this._styleProperties.length;v++)m[w=this._styleProperties[v]]=void 0===I[w]?this[w]:I[w];return m},_setStyleDeclaration:function(D,y,w){this.styles[D][y]=w},_deleteStyleDeclaration:function(D,y){delete this.styles[D][y]},_getLineStyle:function(D){return!!this.styles[D]},_setLineStyle:function(D){this.styles[D]={}},_deleteLineStyle:function(D){delete this.styles[D]}}),function(){function D(y){y.textDecoration&&(y.textDecoration.indexOf("underline")>-1&&(y.underline=!0),y.textDecoration.indexOf("line-through")>-1&&(y.linethrough=!0),y.textDecoration.indexOf("overline")>-1&&(y.overline=!0),delete y.textDecoration)}F.IText=F.util.createClass(F.Text,F.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(y,w){this.callSuper("initialize",y,w),this.initBehavior()},setSelectionStart:function(y){y=Math.max(y,0),this._updateAndFire("selectionStart",y)},setSelectionEnd:function(y){y=Math.min(y,this.text.length),this._updateAndFire("selectionEnd",y)},_updateAndFire:function(y,w){this[y]!==w&&(this._fireSelectionChanged(),this[y]=w),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(y){this.clearContextTop(),this.callSuper("render",y),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(y){this.callSuper("_render",y)},clearContextTop:function(y){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var w=this.canvas.contextTop,I=this.canvas.viewportTransform;w.save(),w.transform(I[0],I[1],I[2],I[3],I[4],I[5]),this.transform(w),this._clearTextArea(w),y||w.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var y=this._getCursorBoundaries(),w=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(y,w):this.renderSelection(y,w),w.restore()}},_clearTextArea:function(y){var w=this.width+4,I=this.height+4;y.clearRect(-w/2,-I/2,w,I)},_getCursorBoundaries:function(y){void 0===y&&(y=this.selectionStart);var w=this._getLeftOffset(),I=this._getTopOffset(),m=this._getCursorBoundariesOffsets(y);return{left:w,top:I,leftOffset:m.left,topOffset:m.top}},_getCursorBoundariesOffsets:function(y){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var w,I,m,v,T=0,A=0,S=this.get2DCursorLocation(y);m=S.charIndex,I=S.lineIndex;for(var x=0;x<I;x++)T+=this.getHeightOfLine(x);w=this._getLineLeftOffset(I);var L=this.__charBounds[I][m];return L&&(A=L.left),0!==this.charSpacing&&m===this._textLines[I].length&&(A-=this._getWidthOfCharSpacing()),v={top:T,left:w+(A>0?A:0)},"rtl"===this.direction&&(v.left*=-1),this.cursorOffsetCache=v,this.cursorOffsetCache},renderCursor:function(y,w){var I=this.get2DCursorLocation(),m=I.lineIndex,v=I.charIndex>0?I.charIndex-1:0,T=this.getValueOfPropertyAt(m,v,"fontSize"),A=this.scaleX*this.canvas.getZoom(),S=this.cursorWidth/A,x=y.topOffset,L=this.getValueOfPropertyAt(m,v,"deltaY");x+=(1-this._fontSizeFraction)*this.getHeightOfLine(m)/this.lineHeight-T*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(y,w),w.fillStyle=this.cursorColor||this.getValueOfPropertyAt(m,v,"fill"),w.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,w.fillRect(y.left+y.leftOffset-S/2,x+y.top+L,S,T)},renderSelection:function(y,w){for(var I=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,m=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,v=-1!==this.textAlign.indexOf("justify"),T=this.get2DCursorLocation(I),A=this.get2DCursorLocation(m),S=T.lineIndex,x=A.lineIndex,L=T.charIndex<0?0:T.charIndex,N=A.charIndex<0?0:A.charIndex,B=S;B<=x;B++){var H,V=this._getLineLeftOffset(B)||0,W=this.getHeightOfLine(B),q=0,ne=0;if(B===S&&(q=this.__charBounds[S][L].left),B>=S&&B<x)ne=v&&!this.isEndOfWrapping(B)?this.width:this.getLineWidth(B)||5;else if(B===x)if(0===N)ne=this.__charBounds[x][N].left;else{var ie=this._getWidthOfCharSpacing();ne=this.__charBounds[x][N-1].left+this.__charBounds[x][N-1].width-ie}H=W,(this.lineHeight<1||B===x&&this.lineHeight>1)&&(W/=this.lineHeight);var he=y.left+V+q,le=ne-q,oe=W,J=0;this.inCompositionMode?(w.fillStyle=this.compositionColor||"black",oe=1,J=W):w.fillStyle=this.selectionColor,"rtl"===this.direction&&(he=this.width-he-le),w.fillRect(he,y.top+y.topOffset+J,le,oe),y.topOffset+=H}},getCurrentCharFontSize:function(){var y=this._getCurrentCharIndex();return this.getValueOfPropertyAt(y.l,y.c,"fontSize")},getCurrentCharColor:function(){var y=this._getCurrentCharIndex();return this.getValueOfPropertyAt(y.l,y.c,"fill")},_getCurrentCharIndex:function(){var y=this.get2DCursorLocation(this.selectionStart,!0);return{l:y.lineIndex,c:y.charIndex>0?y.charIndex-1:0}}}),F.IText.fromObject=function(y,w){if(D(y),y.styles)for(var I in y.styles)for(var m in y.styles[I])D(y.styles[I][m]);F.Object._fromObject("IText",y,w,"text")}}(),Se=F.util.object.clone,F.util.object.extend(F.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var D=this;this.on("added",function(){var y=D.canvas;y&&(y._hasITextHandlers||(y._hasITextHandlers=!0,D._initCanvasHandlers(y)),y._iTextInstances=y._iTextInstances||[],y._iTextInstances.push(D))})},initRemovedHandler:function(){var D=this;this.on("removed",function(){var y=D.canvas;y&&(y._iTextInstances=y._iTextInstances||[],F.util.removeFromArray(y._iTextInstances,D),0===y._iTextInstances.length&&(y._hasITextHandlers=!1,D._removeCanvasHandlers(y)))})},_initCanvasHandlers:function(D){D._mouseUpITextHandler=function(){D._iTextInstances&&D._iTextInstances.forEach(function(y){y.__isMousedown=!1})},D.on("mouse:up",D._mouseUpITextHandler)},_removeCanvasHandlers:function(D){D.off("mouse:up",D._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(D,y,w,I){var m;return m={isAborted:!1,abort:function(){this.isAborted=!0}},D.animate("_currentCursorOpacity",y,{duration:w,onComplete:function(){m.isAborted||D[I]()},onChange:function(){D.canvas&&D.selectionStart===D.selectionEnd&&D.renderCursorOrSelection()},abort:function(){return m.isAborted}}),m},_onTickComplete:function(){var D=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){D._currentTickCompleteState=D._animateCursor(D,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(D){var y=this,w=D?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){y._tick()},w)},abortCursorAnimation:function(){var D=this._currentTickState||this._currentTickCompleteState,y=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,D&&y&&y.clearContext(y.contextTop||y.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(D){var y=0,w=D-1;if(this._reSpace.test(this._text[w]))for(;this._reSpace.test(this._text[w]);)y++,w--;for(;/\S/.test(this._text[w])&&w>-1;)y++,w--;return D-y},findWordBoundaryRight:function(D){var y=0,w=D;if(this._reSpace.test(this._text[w]))for(;this._reSpace.test(this._text[w]);)y++,w++;for(;/\S/.test(this._text[w])&&w<this._text.length;)y++,w++;return D+y},findLineBoundaryLeft:function(D){for(var y=0,w=D-1;!/\n/.test(this._text[w])&&w>-1;)y++,w--;return D-y},findLineBoundaryRight:function(D){for(var y=0,w=D;!/\n/.test(this._text[w])&&w<this._text.length;)y++,w++;return D+y},searchWordBoundary:function(D,y){for(var w=this._text,I=this._reSpace.test(w[D])?D-1:D,m=w[I],v=F.reNonWord;!v.test(m)&&I>0&&I<w.length;)m=w[I+=y];return v.test(m)&&(I+=1===y?0:1),I},selectWord:function(D){var y=this.searchWordBoundary(D=D||this.selectionStart,-1),w=this.searchWordBoundary(D,1);this.selectionStart=y,this.selectionEnd=w,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(D){var y=this.findLineBoundaryLeft(D=D||this.selectionStart),w=this.findLineBoundaryRight(D);return this.selectionStart=y,this.selectionEnd=w,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(D){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(D),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(D){D._iTextInstances&&D._iTextInstances.forEach(function(y){y.selected=!1,y.isEditing&&y.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(D){if(this.__isMousedown&&this.isEditing){var y=this.getSelectionStartFromPointer(D.e),w=this.selectionStart,I=this.selectionEnd;(y===this.__selectionStartOnMouseDown&&w!==I||w!==y&&I!==y)&&(y>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=y):(this.selectionStart=y,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===w&&this.selectionEnd===I||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(D,y,w){var I=w.slice(0,D),m=F.util.string.graphemeSplit(I).length;if(D===y)return{selectionStart:m,selectionEnd:m};var v=w.slice(D,y);return{selectionStart:m,selectionEnd:m+F.util.string.graphemeSplit(v).length}},fromGraphemeToStringSelection:function(D,y,w){var I=w.slice(0,D).join("").length;return D===y?{selectionStart:I,selectionEnd:I}:{selectionStart:I,selectionEnd:I+w.slice(D,y).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var D=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=D.selectionStart,this.hiddenTextarea.selectionEnd=D.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var D=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=D.selectionEnd,this.inCompositionMode||(this.selectionStart=D.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var D=this._calcTextareaPosition();this.hiddenTextarea.style.left=D.left,this.hiddenTextarea.style.top=D.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var D=this.inCompositionMode?this.compositionStart:this.selectionStart,y=this._getCursorBoundaries(D),w=this.get2DCursorLocation(D),v=this.getValueOfPropertyAt(w.lineIndex,w.charIndex,"fontSize")*this.lineHeight,T=y.leftOffset,A=this.calcTransformMatrix(),S={x:y.left+T,y:y.top+y.topOffset+v},x=this.canvas.getRetinaScaling(),L=this.canvas.upperCanvasEl,N=L.width/x,B=L.height/x,H=N-v,V=B-v,W=L.clientWidth/N,q=L.clientHeight/B;return S=F.util.transformPoint(S,A),(S=F.util.transformPoint(S,this.canvas.viewportTransform)).x*=W,S.y*=q,S.x<0&&(S.x=0),S.x>H&&(S.x=H),S.y<0&&(S.y=0),S.y>V&&(S.y=V),S.x+=this.canvas._offset.left,S.y+=this.canvas._offset.top,{left:S.x+"px",top:S.y+"px",fontSize:v+"px",charHeight:v}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var D=this._textBeforeEdit!==this.text,y=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,y&&(y.blur&&y.blur(),y.parentNode&&y.parentNode.removeChild(y)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),D&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),D&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var D in this.styles)this._textLines[D]||delete this.styles[D]},removeStyleFromTo:function(D,y){var w,I,m=this.get2DCursorLocation(D,!0),v=this.get2DCursorLocation(y,!0),T=m.lineIndex,A=m.charIndex,S=v.lineIndex,x=v.charIndex;if(T!==S){if(this.styles[T])for(w=A;w<this._unwrappedTextLines[T].length;w++)delete this.styles[T][w];if(this.styles[S])for(w=x;w<this._unwrappedTextLines[S].length;w++)(I=this.styles[S][w])&&(this.styles[T]||(this.styles[T]={}),this.styles[T][A+w-x]=I);for(w=T+1;w<=S;w++)delete this.styles[w];this.shiftLineStyles(S,T-S)}else if(this.styles[T]){I=this.styles[T];var L,N,B=x-A;for(w=A;w<x;w++)delete I[w];for(N in this.styles[T])(L=parseInt(N,10))>=x&&(I[L-B]=I[N],delete I[N])}},shiftLineStyles:function(D,y){var w=Se(this.styles);for(var I in this.styles){var m=parseInt(I,10);m>D&&(this.styles[m+y]=w[m],w[m-y]||delete this.styles[m])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(D,y,w,I){var m,v={},T=!1,A=this._unwrappedTextLines[D].length===y;for(var S in w||(w=1),this.shiftLineStyles(D,w),this.styles[D]&&(m=this.styles[D][0===y?y:y-1]),this.styles[D]){var x=parseInt(S,10);x>=y&&(T=!0,v[x-y]=this.styles[D][S],A&&0===y||delete this.styles[D][S])}var L=!1;for(T&&!A&&(this.styles[D+w]=v,L=!0),L&&w--;w>0;)I&&I[w-1]?this.styles[D+w]={0:Se(I[w-1])}:m?this.styles[D+w]={0:Se(m)}:delete this.styles[D+w],w--;this._forceClearCache=!0},insertCharStyleObject:function(D,y,w,I){this.styles||(this.styles={});var m=this.styles[D],v=m?Se(m):{};for(var T in w||(w=1),v){var A=parseInt(T,10);A>=y&&(m[A+w]=v[A],v[A-w]||delete m[A])}if(this._forceClearCache=!0,I)for(;w--;)Object.keys(I[w]).length&&(this.styles[D]||(this.styles[D]={}),this.styles[D][y+w]=Se(I[w]));else if(m)for(var S=m[y?y-1:1];S&&w--;)this.styles[D][y+w]=Se(S)},insertNewStyleBlock:function(D,y,w){for(var I=this.get2DCursorLocation(y,!0),m=[0],v=0,T=0;T<D.length;T++)"\n"===D[T]?m[++v]=0:m[v]++;for(m[0]>0&&(this.insertCharStyleObject(I.lineIndex,I.charIndex,m[0],w),w=w&&w.slice(m[0]+1)),v&&this.insertNewlineStyleObject(I.lineIndex,I.charIndex+m[0],v),T=1;T<v;T++)m[T]>0?this.insertCharStyleObject(I.lineIndex+T,0,m[T],w):w&&this.styles[I.lineIndex+T]&&w[0]&&(this.styles[I.lineIndex+T][0]=w[0]),w=w&&w.slice(m[T]+1);m[T]>0&&this.insertCharStyleObject(I.lineIndex+T,0,m[T],w)},setSelectionStartEndWithShift:function(D,y,w){w<=D?(y===D?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=D),this.selectionStart=w):w>D&&w<y?"right"===this._selectionDirection?this.selectionEnd=w:this.selectionStart=w:(y===D?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=y),this.selectionEnd=w)},setSelectionInBoundaries:function(){var D=this.text.length;this.selectionStart>D?this.selectionStart=D:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>D?this.selectionEnd=D:this.selectionEnd<0&&(this.selectionEnd=0)}}),F.util.object.extend(F.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(D){if(this.canvas){this.__newClickTime=+new Date;var y=D.pointer;this.isTripleClick(y)&&(this.fire("tripleclick",D),this._stopEvent(D.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=y,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(D){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===D.x&&this.__lastPointer.y===D.y},_stopEvent:function(D){D.preventDefault&&D.preventDefault(),D.stopPropagation&&D.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(D){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(D.e))},tripleClickHandler:function(D){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(D.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(D){!this.canvas||!this.editable||D.e.button&&1!==D.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(D.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(D){!this.canvas||!this.editable||D.e.button&&1!==D.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(D){if(this.__isMousedown=!1,!(!this.editable||this.group||D.transform&&D.transform.actionPerformed||D.e.button&&1!==D.e.button)){if(this.canvas){var y=this.canvas._activeObject;if(y&&y!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(D.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(D){var y=this.getSelectionStartFromPointer(D);D.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,y):(this.selectionStart=y,this.selectionEnd=y),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(D){for(var y,w=this.getLocalPointer(D),I=0,m=0,v=0,T=0,A=0,S=0,x=this._textLines.length;S<x&&v<=w.y;S++)v+=this.getHeightOfLine(S)*this.scaleY,A=S,S>0&&(T+=this._textLines[S-1].length+this.missingNewlineOffset(S-1));m=this._getLineLeftOffset(A)*this.scaleX,y=this._textLines[A],"rtl"===this.direction&&(w.x=this.width*this.scaleX-w.x+m);for(var L=0,N=y.length;L<N&&(I=m,(m+=this.__charBounds[A][L].kernedWidth*this.scaleX)<=w.x);L++)T++;return this._getNewSelectionStartFromOffset(w,I,m,T,N)},_getNewSelectionStartFromOffset:function(D,y,w,I,m){var T=w-D.x,A=I+(T>D.x-y||T<0?0:1);return this.flipX&&(A=m-A),A>this._text.length&&(A=this._text.length),A}}),F.util.object.extend(F.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=F.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var D=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+D.top+"; left: "+D.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+D.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):F.document.body.appendChild(this.hiddenTextarea),F.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),F.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),F.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),F.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),F.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),F.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),F.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),F.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),F.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(F.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(D){if(this.isEditing){var y="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(D.keyCode in y)this[y[D.keyCode]](D);else{if(!(D.keyCode in this.ctrlKeysMapDown)||!D.ctrlKey&&!D.metaKey)return;this[this.ctrlKeysMapDown[D.keyCode]](D)}D.stopImmediatePropagation(),D.preventDefault(),D.keyCode>=33&&D.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(D){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:D.keyCode in this.ctrlKeysMapUp&&(D.ctrlKey||D.metaKey)&&(this[this.ctrlKeysMapUp[D.keyCode]](D),D.stopImmediatePropagation(),D.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(D){var y=this.fromPaste;if(this.fromPaste=!1,D&&D.stopPropagation(),this.isEditing){var w,I,m,v,T,A=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,S=this._text.length,x=A.length,L=x-S,N=this.selectionStart,B=this.selectionEnd,H=N!==B;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var V=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),W=N>V.selectionStart;H?(w=this._text.slice(N,B),L+=B-N):x<S&&(w=W?this._text.slice(B+L,B):this._text.slice(N,N-L)),I=A.slice(V.selectionEnd-L,V.selectionEnd),w&&w.length&&(I.length&&(m=this.getSelectionStyles(N,N+1,!1),m=I.map(function(){return m[0]})),H?(v=N,T=B):W?(v=B-w.length,T=B):(v=B,T=B+w.length),this.removeStyleFromTo(v,T)),I.length&&(y&&I.join("")===F.copiedText&&!F.disableStyleCopyPaste&&(m=F.copiedTextStyle),this.insertNewStyleBlock(I,N,m)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(D){this.compositionStart=D.target.selectionStart,this.compositionEnd=D.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(F.copiedText=this.getSelectedText(),F.copiedTextStyle=F.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(D){return D&&D.clipboardData||F.window.clipboardData},_getWidthBeforeCursor:function(D,y){var w,I=this._getLineLeftOffset(D);return y>0&&(I+=(w=this.__charBounds[D][y-1]).left+w.width),I},getDownCursorOffset:function(D,y){var w=this._getSelectionForOffset(D,y),I=this.get2DCursorLocation(w),m=I.lineIndex;if(m===this._textLines.length-1||D.metaKey||34===D.keyCode)return this._text.length-w;var v=I.charIndex,T=this._getWidthBeforeCursor(m,v),A=this._getIndexOnLine(m+1,T);return this._textLines[m].slice(v).length+A+1+this.missingNewlineOffset(m)},_getSelectionForOffset:function(D,y){return D.shiftKey&&this.selectionStart!==this.selectionEnd&&y?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(D,y){var w=this._getSelectionForOffset(D,y),I=this.get2DCursorLocation(w),m=I.lineIndex;if(0===m||D.metaKey||33===D.keyCode)return-w;var v=I.charIndex,T=this._getWidthBeforeCursor(m,v),A=this._getIndexOnLine(m-1,T),S=this._textLines[m].slice(0,v),x=this.missingNewlineOffset(m-1);return-this._textLines[m-1].length+A-S.length+(1-x)},_getIndexOnLine:function(D,y){for(var w,I,m=this._textLines[D],v=this._getLineLeftOffset(D),T=0,A=0,S=m.length;A<S;A++)if((v+=w=this.__charBounds[D][A].width)>y){I=!0;var L=v,N=Math.abs(v-w-y);T=Math.abs(L-y)<N?A:A-1;break}return I||(T=m.length-1),T},moveCursorDown:function(D){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",D)},moveCursorUp:function(D){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",D)},_moveCursorUpOrDown:function(D,y){var w=this["get"+D+"CursorOffset"](y,"right"===this._selectionDirection);y.shiftKey?this.moveCursorWithShift(w):this.moveCursorWithoutShift(w),0!==w&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(D){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+D:this.selectionEnd+D),0!==D},moveCursorWithoutShift:function(D){return D<0?(this.selectionStart+=D,this.selectionEnd=this.selectionStart):(this.selectionEnd+=D,this.selectionStart=this.selectionEnd),0!==D},moveCursorLeft:function(D){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",D)},_move:function(D,y,w){var I;if(D.altKey)I=this["findWordBoundary"+w](this[y]);else{if(!D.metaKey&&35!==D.keyCode&&36!==D.keyCode)return this[y]+="Left"===w?-1:1,!0;I=this["findLineBoundary"+w](this[y])}if(void 0!==typeof I&&this[y]!==I)return this[y]=I,!0},_moveLeft:function(D,y){return this._move(D,y,"Left")},_moveRight:function(D,y){return this._move(D,y,"Right")},moveCursorLeftWithoutShift:function(D){var y=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(y=this._moveLeft(D,"selectionStart")),this.selectionEnd=this.selectionStart,y},moveCursorLeftWithShift:function(D){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(D,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(D,"selectionStart")):void 0},moveCursorRight:function(D){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",D)},_moveCursorLeftOrRight:function(D,y){var w="moveCursor"+D+"With";this._currentCursorOpacity=1,this[w+=y.shiftKey?"Shift":"outShift"](y)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(D){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(D,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(D,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(D){var y=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(y=this._moveRight(D,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,y},removeChars:function(D,y){void 0===y&&(y=D+1),this.removeStyleFromTo(D,y),this._text.splice(D,y-D),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(D,y,w,I){void 0===I&&(I=w),I>w&&this.removeStyleFromTo(w,I);var m=F.util.string.graphemeSplit(D);this.insertNewStyleBlock(m,w,y),this._text=[].concat(this._text.slice(0,w),m,this._text.slice(I)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var D=F.util.toFixed,y=/  +/g;F.util.object.extend(F.Text.prototype,{_toSVG:function(){var w=this._getSVGLeftTopOffsets(),I=this._getSVGTextAndBg(w.textTop,w.textLeft);return this._wrapSVGTextAndBg(I)},toSVG:function(w){return this._createBaseSVGMarkup(this._toSVG(),{reviver:w,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(w){var I=this.getSvgTextDecoration(this);return[w.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",I?'text-decoration="'+I+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",w.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(w,I){var m,v=[],T=[],A=w;this._setSVGBg(T);for(var S=0,x=this._textLines.length;S<x;S++)m=this._getLineLeftOffset(S),(this.textBackgroundColor||this.styleHas("textBackgroundColor",S))&&this._setSVGTextLineBg(T,S,I+m,A),this._setSVGTextLineText(v,S,I+m,A),A+=this.getHeightOfLine(S);return{textSpans:v,textBgRects:T}},_createTextCharSpan:function(w,I,m,v){var T=w!==w.trim()||w.match(y),A=this.getSvgSpanStyles(I,T),S=A?'style="'+A+'"':"",x=I.deltaY,L="",N=F.Object.NUM_FRACTION_DIGITS;return x&&(L=' dy="'+D(x,N)+'" '),['<tspan x="',D(m,N),'" y="',D(v,N),'" ',L,S,">",F.util.string.escapeXml(w),"</tspan>"].join("")},_setSVGTextLineText:function(w,I,m,v){var T,A,S,x,L,N=this.getHeightOfLine(I),B=-1!==this.textAlign.indexOf("justify"),H="",V=0,W=this._textLines[I];v+=N*(1-this._fontSizeFraction)/this.lineHeight;for(var q=0,ne=W.length-1;q<=ne;q++)L=q===ne||this.charSpacing,H+=W[q],S=this.__charBounds[I][q],0===V?(m+=S.kernedWidth-S.width,V+=S.width):V+=S.kernedWidth,B&&!L&&this._reSpaceAndTab.test(W[q])&&(L=!0),L||(T=T||this.getCompleteStyleDeclaration(I,q),A=this.getCompleteStyleDeclaration(I,q+1),L=this._hasStyleChangedForSvg(T,A)),L&&(x=this._getStyleDeclaration(I,q)||{},w.push(this._createTextCharSpan(H,x,m,v)),H="",T=A,m+=V,V=0)},_pushTextBgRect:function(w,I,m,v,T,A){var S=F.Object.NUM_FRACTION_DIGITS;w.push("\t\t<rect ",this._getFillAttributes(I),' x="',D(m,S),'" y="',D(v,S),'" width="',D(T,S),'" height="',D(A,S),'"></rect>\n')},_setSVGTextLineBg:function(w,I,m,v){for(var T,A,S=this._textLines[I],x=this.getHeightOfLine(I)/this.lineHeight,L=0,N=0,B=this.getValueOfPropertyAt(I,0,"textBackgroundColor"),H=0,V=S.length;H<V;H++)T=this.__charBounds[I][H],(A=this.getValueOfPropertyAt(I,H,"textBackgroundColor"))!==B?(B&&this._pushTextBgRect(w,B,m+N,v,L,x),N=T.left,L=T.width,B=A):L+=T.kernedWidth;A&&this._pushTextBgRect(w,A,m+N,v,L,x)},_getFillAttributes:function(w){var I=w&&"string"==typeof w?new F.Color(w):"";return I&&I.getSource()&&1!==I.getAlpha()?'opacity="'+I.getAlpha()+'" fill="'+I.setAlpha(1).toRgb()+'"':'fill="'+w+'"'},_getSVGLineTopOffset:function(w){for(var I,m=0,v=0;v<w;v++)m+=this.getHeightOfLine(v);return I=this.getHeightOfLine(v),{lineTop:m,offset:(this._fontSizeMult-this._fontSizeFraction)*I/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(w){return F.Object.prototype.getSvgStyles.call(this,w)+" white-space: pre;"}})}(),function(D){var y=D.fabric||(D.fabric={});y.Textbox=y.util.createClass(y.IText,y.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:y.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(w){for(var I=0,m=0,v=0,T={},A=0;A<w.graphemeLines.length;A++)"\n"===w.graphemeText[v]&&A>0?(m=0,v++,I++):!this.splitByGrapheme&&this._reSpaceAndTab.test(w.graphemeText[v])&&A>0&&(m++,v++),T[A]={line:I,offset:m},v+=w.graphemeLines[A].length,m+=w.graphemeLines[A].length;return T},styleHas:function(w,I){if(this._styleMap&&!this.isWrapping){var m=this._styleMap[I];m&&(I=m.line)}return y.Text.prototype.styleHas.call(this,w,I)},isEmptyStyles:function(w){if(!this.styles)return!0;var I,m,v=0,T=!1,A=this._styleMap[w],S=this._styleMap[w+1];for(var x in A&&(w=A.line,v=A.offset),S&&(T=S.line===w,I=S.offset),m=void 0===w?this.styles:{line:this.styles[w]})for(var L in m[x])if(L>=v&&(!T||L<I))for(var N in m[x][L])return!1;return!0},_getStyleDeclaration:function(w,I){if(this._styleMap&&!this.isWrapping){var m=this._styleMap[w];if(!m)return null;w=m.line,I=m.offset+I}return this.callSuper("_getStyleDeclaration",w,I)},_setStyleDeclaration:function(w,I,m){var v=this._styleMap[w];this.styles[w=v.line][I=v.offset+I]=m},_deleteStyleDeclaration:function(w,I){var m=this._styleMap[w];delete this.styles[w=m.line][I=m.offset+I]},_getLineStyle:function(w){return!!this.styles[this._styleMap[w].line]},_setLineStyle:function(w){this.styles[this._styleMap[w].line]={}},_wrapText:function(w,I){var m,v=[];for(this.isWrapping=!0,m=0;m<w.length;m++)v=v.concat(this._wrapLine(w[m],m,I));return this.isWrapping=!1,v},_measureWord:function(w,I,m){var v,T=0;m=m||0;for(var A=0,S=w.length;A<S;A++)T+=this._getGraphemeBox(w[A],I,A+m,v,!0).kernedWidth,v=w[A];return T},_wrapLine:function(w,I,m,v){var T=0,A=this.splitByGrapheme,S=[],x=[],L=A?y.util.string.graphemeSplit(w):w.split(this._wordJoiners),N="",B=0,H=A?"":" ",V=0,W=0,q=0,ne=!0,ie=this._getWidthOfCharSpacing();v=v||0,0===L.length&&L.push([]),m-=v;for(var he=0;he<L.length;he++)N=A?L[he]:y.util.string.graphemeSplit(L[he]),V=this._measureWord(N,I,B),B+=N.length,(T+=W+V-ie)>m&&!ne?(S.push(x),x=[],T=V,ne=!0):T+=ie,ne||A||x.push(H),x=x.concat(N),W=A?0:this._measureWord([H],I,B),B++,ne=!1,V>q&&(q=V);return he&&S.push(x),q+v>this.dynamicMinWidth&&(this.dynamicMinWidth=q-ie+v),S},isEndOfWrapping:function(w){return!this._styleMap[w+1]||this._styleMap[w+1].line!==this._styleMap[w].line},missingNewlineOffset:function(w){return this.splitByGrapheme?this.isEndOfWrapping(w)?1:0:1},_splitTextIntoLines:function(w){for(var I=y.Text.prototype._splitTextIntoLines.call(this,w),m=this._wrapText(I.lines,this.width),v=new Array(m.length),T=0;T<m.length;T++)v[T]=m[T].join("");return I.lines=v,I.graphemeLines=m,I},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var w={};for(var I in this._styleMap)this._textLines[I]&&(w[this._styleMap[I].line]=1);for(var I in this.styles)w[I]||delete this.styles[I]},toObject:function(w){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(w))}}),y.Textbox.fromObject=function(w,I){return y.Object._fromObject("Textbox",w,I,"text")}}(a),function(){var D=F.controlsUtils,y=D.scaleSkewCursorStyleHandler,w=D.scaleCursorStyleHandler,I=D.scalingEqually,m=D.scalingYOrSkewingX,v=D.scalingXOrSkewingY,T=D.scaleOrSkewActionName,A=F.Object.prototype.controls;if(A.ml=new F.Control({x:-.5,y:0,cursorStyleHandler:y,actionHandler:v,getActionName:T}),A.mr=new F.Control({x:.5,y:0,cursorStyleHandler:y,actionHandler:v,getActionName:T}),A.mb=new F.Control({x:0,y:.5,cursorStyleHandler:y,actionHandler:m,getActionName:T}),A.mt=new F.Control({x:0,y:-.5,cursorStyleHandler:y,actionHandler:m,getActionName:T}),A.tl=new F.Control({x:-.5,y:-.5,cursorStyleHandler:w,actionHandler:I}),A.tr=new F.Control({x:.5,y:-.5,cursorStyleHandler:w,actionHandler:I}),A.bl=new F.Control({x:-.5,y:.5,cursorStyleHandler:w,actionHandler:I}),A.br=new F.Control({x:.5,y:.5,cursorStyleHandler:w,actionHandler:I}),A.mtr=new F.Control({x:0,y:-.5,actionHandler:D.rotationWithSnapping,cursorStyleHandler:D.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),F.Textbox){var S=F.Textbox.prototype.controls={};S.mtr=A.mtr,S.tr=A.tr,S.br=A.br,S.tl=A.tl,S.bl=A.bl,S.mt=A.mt,S.mb=A.mb,S.mr=new F.Control({x:.5,y:0,actionHandler:D.changeWidth,cursorStyleHandler:y,actionName:"resizing"}),S.ml=new F.Control({x:-.5,y:0,actionHandler:D.changeWidth,cursorStyleHandler:y,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},wD={};function qs(u){var a=wD[u];if(void 0!==a)return a.exports;var l=wD[u]={exports:{}};return p2[u](l,l.exports,qs),l.exports}qs.d=(u,a)=>{for(var l in a)qs.o(a,l)&&!qs.o(u,l)&&Object.defineProperty(u,l,{enumerable:!0,get:a[l]})},qs.o=(u,a)=>Object.prototype.hasOwnProperty.call(u,a);var ED={};(()=>{let u;qs.d(ED,{R:()=>u}),u="undefined"!=typeof document&&"undefined"!=typeof window?qs(653).fabric:{version:"5.2.1"}})();var Dn,ti,hs,bD,st=ED.R;(function(u){u[u.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",u[u.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",u[u.DIMT_TEXT=4]="DIMT_TEXT",u[u.DIMT_ARC=8]="DIMT_ARC",u[u.DIMT_IMAGE=16]="DIMT_IMAGE",u[u.DIMT_POLYGON=32]="DIMT_POLYGON",u[u.DIMT_LINE=64]="DIMT_LINE",u[u.DIMT_GROUP=128]="DIMT_GROUP"})(Dn||(Dn={})),function(u){u[u.DIS_DEFAULT=1]="DIS_DEFAULT",u[u.DIS_SELECTED=2]="DIS_SELECTED"}(ti||(ti={})),function(u){u[u.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",u[u.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",u[u.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(hs||(hs={})),function(u){u.GREY="grey",u.GREY32="grey32",u.RGBA="rgba",u.RBGA="rbga",u.GRBA="grba",u.GBRA="gbra",u.BRGA="brga",u.BGRA="bgra"}(bD||(bD={}));const sa=u=>"number"==typeof u&&!Number.isNaN(u),tm=u=>"string"==typeof u;var bh,$l,oa,nm,or,Dh;(function(u){u[u.ARC=0]="ARC",u[u.IMAGE=1]="IMAGE",u[u.LINE=2]="LINE",u[u.POLYGON=3]="POLYGON",u[u.QUAD=4]="QUAD",u[u.RECT=5]="RECT",u[u.TEXT=6]="TEXT",u[u.GROUP=7]="GROUP"})(or||(or={})),function(u){u[u.DEFAULT=0]="DEFAULT",u[u.SELECTED=1]="SELECTED"}(Dh||(Dh={}));class Gn{get mediaType(){return new Map([["rect",Dn.DIMT_RECTANGLE],["quad",Dn.DIMT_QUADRILATERAL],["text",Dn.DIMT_TEXT],["arc",Dn.DIMT_ARC],["image",Dn.DIMT_IMAGE],["polygon",Dn.DIMT_POLYGON],["line",Dn.DIMT_LINE],["group",Dn.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(U(this,$l,"f")){case ti.DIS_DEFAULT:return"default";case ti.DIS_SELECTED:return"selected"}}set drawingStyleId(a){this.styleId=a}get drawingStyleId(){return this.styleId}set coordinateBase(a){if(!["view","image"].includes(a))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===U(this,oa,"f")&&"view"===a?this.updateCoordinateBaseFromImageToView():"view"===U(this,oa,"f")&&"image"===a&&this.updateCoordinateBaseFromViewToImage()),Oe(this,oa,a,"f")}get coordinateBase(){return U(this,oa,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(a,l){if(bh.add(this),$l.set(this,void 0),oa.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=l&&!sa(l))throw new TypeError("Invalid 'drawingStyleId'.");a&&this._setFabricObject(a),this.setState(ti.DIS_DEFAULT),this.styleId=l}_setFabricObject(a){this._fabricObject=a,this._fabricObject.on("selected",()=>{this.setState(ti.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(ti.DIS_SELECTED):this.setState(ti.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),a.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(a){Oe(this,$l,a,"f")}getState(){return U(this,$l,"f")}_on(a,l){if(!l)return;const f=a.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${a}' does not exist.`);let p=g.get(l);p||(p=_=>{const C=_.e;if(!C)return void(l&&l.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const b={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let O,M,P,k;const j=C.target.getBoundingClientRect();O=j.left,M=j.top,P=O+window.scrollX,k=M+window.scrollY;const{width:G,height:z}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),Y=this._drawingLayer.width,X=this._drawingLayer.height,$=G/z,K=Y/X,ge=this._drawingLayer._getObjectFit();let _e,Te,Se,F,Ce=1;if("contain"===ge)$<K?(Ce=G/Y,_e=O+this.get("x")*Ce,Te=M+this.get("y")*Ce+(z-X*Ce)/2,Se=P+this.get("x")*Ce,F=k+this.get("y")*Ce+(z-X*Ce)/2):(Ce=z/X,_e=O+this.get("x")*Ce+(G-Y*Ce)/2,Te=M+this.get("y")*Ce,Se=P+this.get("x")*Ce+(G-Y*Ce)/2,F=k+this.get("y")*Ce);else if("cover"===ge)if($<K){Ce=z/X;let Ne=this.get("x")*Ce-(Y*Ce-G)/2;Ne=Math.max(Ne,0),Ne=Math.min(Ne,G),_e=O+Ne,Te=M+this.get("y")*Ce,Se=P+Ne,F=k+this.get("y")*Ce}else{Ce=G/Y;let Ne=this.get("y")*Ce-(X*Ce-z)/2;Ne=Math.max(Ne,0),Ne=Math.min(Ne,z),_e=O+this.get("x")*Ce,Te=M+Ne,Se=P+this.get("x")*Ce,F=k+Ne}b.itemClientX=Math.round(_e),b.itemClientY=Math.round(Te),b.itemPageX=Math.round(Se),b.itemPageY=Math.round(F)}for(let O of Object.getOwnPropertyNames(b))Object.defineProperty(C,O,{value:b[O],writable:!0});l&&l.apply(this,[C])},g.set(l,p),this._fabricObject.on("dblclick"===f?"mousedblclick":f,p))}on(a,l){this._on(a,l)}_off(a,l){const f=a.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${a}' does not exist.`);let p=g.get(l);p&&(g.delete(l),this._fabricObject.off("dblclick"===f?"mousedblclick":f,p))}off(a,l){this._off(a,l)}_setEditable(a){const l=this._fabricObject;a?(l.selectable=!0,l.hasControls=!0,l.hoverCursor=null):(l.selectable=!1,l.hasControls=!1,l.hoverCursor="default")}hasNote(a){return this.mapNoteName_Content.has(a)}addNote(a,l){if(this.hasNote(a.name)&&!l)throw new Error("A note with the same name already exists, please use a different name.");const f=a.content?JSON.parse(JSON.stringify(a.content)):a.content;this.mapNoteName_Content.set(a.name,[f])}getNote(a){const l=this.mapNoteName_Content.get(a);return l?1===l.length?{name:a,content:l[0]?JSON.parse(JSON.stringify(l[0])):l[0]}:{name:a,content:JSON.parse(JSON.stringify(l))}:null}getNotes(){const a=[];for(let l of this.mapNoteName_Content){let f=1===l[1].length?l[1][0]:l[1];f=f&&JSON.parse(JSON.stringify(f)),a.push({name:l[0],content:f})}return a}updateNote(a,l,f){const g=this.mapNoteName_Content.get(a);if(!g)throw new Error("The note name does not exist.");f||(g.length=0),l=l&&JSON.parse(JSON.stringify(l)),g.push(l)}deleteNote(a){this.mapNoteName_Content.delete(a)}clearNotes(){this.mapNoteName_Content.clear()}set(a,l){if(!this.extendSet(a,l))if("x"===a){const f=this._fabricObject.group;f?(this._fabricObject.set("left",l-f.left-f.width/2),f.addWithUpdate()):this._fabricObject.set("left",l)}else if("y"===a){const f=this._fabricObject.group;f?(this._fabricObject.set("top",l-f.top-f.height/2),f.addWithUpdate()):this._fabricObject.set("top",l)}else"styleId"===a?this.styleId=l:this._fabricObject.set(a,l);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(a)&&this._fabricObject.setCoords()}get(a){let l=this.extendGet(a);if(void 0===l)if("x"===a){const f=this._fabricObject.group;l=f?this._fabricObject.get("left")+f.left+f.width/2:this._fabricObject.get("left")}else if("y"===a){const f=this._fabricObject.group;l=f?this._fabricObject.get("top")+f.top+f.height/2:this._fabricObject.get("top")}else l="scaledWidth"===a?this._fabricObject.getScaledWidth():"scaledHeight"===a?this._fabricObject.getScaledHeight():["type","mediaType"].includes(a)?this.mediaType:"state"===a?this.getState():"styleId"===a?this.styleId:"drawingLayerId"===a?this.drawingLayerId:this._fabricObject.get(a);return l}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(a){if("number"!=typeof a)throw new TypeError("Invalid value.");return a*U(this,bh,"m",nm).call(this)}convertPropFromViewToImage(a){if("number"!=typeof a)throw new TypeError("Invalid value.");return a/U(this,bh,"m",nm).call(this)}_setLineWidth(a){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(a));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",a)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(a){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(a));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",a)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}$l=new WeakMap,oa=new WeakMap,bh=new WeakSet,nm=function(){const u=this._drawingLayer;if(!u)return 1;const a=u.width,l=u.height,{width:f,height:g}=u.fabricCanvas.wrapperEl.getBoundingClientRect();if(f<=0||g<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const p=f/a,_=g/l,C=u._getObjectFit();let b=1;return"contain"===C?b=p<_?f/a:g/l:"cover"===C&&(b=p<_?g/l:f/a),b},Gn.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Gn.mapItemType=new Map([[or.ARC,"arc"],[or.IMAGE,"image"],[or.LINE,"line"],[or.POLYGON,"polygon"],[or.QUAD,"quad"],[or.RECT,"rect"],[or.TEXT,"text"],[or.GROUP,"group"]]),Gn.arrStyleSelectors=["default","selected"],Gn.mapItemState=new Map([[Dh.DEFAULT,"default"],[Dh.SELECTED,"selected"]]);const DD=u=>null!==u&&"object"==typeof u&&!Array.isArray(u),im=u=>!!tm(u)&&""!==u,sm=u=>!(!ji(u)||!Yt(u.left)||u.left<0||!Yt(u.top)||u.top<0||!Yt(u.right)||u.right<0||!Yt(u.bottom)||u.bottom<0||u.left>=u.right||u.top>=u.bottom||!Hp(u.isMeasuredInPercentage)),ID=u=>!!ji(u)&&!!Vp(u.points)&&0!=u.points.length&&!u.points.some(a=>!na(a)),m2=na,SD=u=>!!ji(u)&&!!Vp(u.points)&&0!=u.points.length&&4==u.points.length&&!u.points.some(a=>!na(a)),xr=u=>!(!ji(u)||!Yt(u.x)||!Yt(u.y)||!Yt(u.width)||u.width<0||!Yt(u.height)||u.height<0||"isMeasuredInPercentage"in u&&!Hp(u.isMeasuredInPercentage)),xD=u=>!(!DD(u)||"id"in u&&!sa(u.id)||"lineWidth"in u&&!sa(u.lineWidth)||"fillStyle"in u&&!im(u.fillStyle)||"strokeStyle"in u&&!im(u.strokeStyle)||"paintMode"in u&&!["fill","stroke","strokeAndFill"].includes(u.paintMode)||"fontFamily"in u&&!im(u.fontFamily)||"fontSize"in u&&!sa(u.fontSize));class Th{static convert(a,l,f){const g={x:0,y:0,width:l,height:f};if(!a)return g;if(xr(a))a.isMeasuredInPercentage?(g.x=a.x/100*l,g.y=a.y/100*f,g.width=a.width/100*l,g.height=a.height/100*f):(g.x=a.x,g.y=a.y,g.width=a.width,g.height=a.height);else{if(!sm(a))throw TypeError("Invalid region.");a.isMeasuredInPercentage?(g.x=a.left/100*l,g.y=a.top/100*f,g.width=(a.right-a.left)/100*l,g.height=(a.bottom-a.top)/100*f):(g.x=a.left,g.y=a.top,g.width=a.right-a.left,g.height=a.bottom-a.top)}return g.x=Math.round(g.x),g.y=Math.round(g.y),g.width=Math.round(g.width),g.height=Math.round(g.height),g}}var Zs,Ih;class AD{constructor(){Zs.set(this,new Map),Ih.set(this,!1)}get disposed(){return U(this,Ih,"f")}on(a,l){a=a.toLowerCase();const f=U(this,Zs,"f").get(a);if(f){if(f.includes(l))return;f.push(l)}else U(this,Zs,"f").set(a,[l])}off(a,l){a=a.toLowerCase();const f=U(this,Zs,"f").get(a);if(!f)return;const g=f.indexOf(l);-1!==g&&f.splice(g,1)}offAll(a){a=a.toLowerCase();const l=U(this,Zs,"f").get(a);l&&(l.length=0)}fire(a,l=[],f={async:!1,copy:!0}){l||(l=[]),a=a.toLowerCase();const g=U(this,Zs,"f").get(a);if(g&&g.length){f=Object.assign({async:!1,copy:!0},f);for(let p of g){if(!p)continue;let _=[];if(f.copy)for(let b of l){try{b=JSON.parse(JSON.stringify(b))}catch(O){}_.push(b)}else _=l;let C=!1;if(f.async)setTimeout(()=>{this.disposed||g.includes(p)&&p.apply(f.target,_)},0);else try{C=p.apply(f.target,_)}catch(b){}if(!0===C)break}}}dispose(){Oe(this,Ih,!0,"f")}}function _2(u,a,l){return(l.x-u.x)*(a.y-u.y)==(a.x-u.x)*(l.y-u.y)&&Math.min(u.x,a.x)<=l.x&&l.x<=Math.max(u.x,a.x)&&Math.min(u.y,a.y)<=l.y&&l.y<=Math.max(u.y,a.y)}function om(u){return Math.abs(u)<1e-6?0:u<0?-1:1}function Sh(u,a,l,f){let g=u[0]*(l[1]-a[1])+a[0]*(u[1]-l[1])+l[0]*(a[1]-u[1]),p=u[0]*(f[1]-a[1])+a[0]*(u[1]-f[1])+f[0]*(a[1]-u[1]);return!((g^p)>=0&&0!==g&&0!==p||(g=l[0]*(u[1]-f[1])+f[0]*(l[1]-u[1])+u[0]*(f[1]-l[1]),p=l[0]*(a[1]-f[1])+f[0]*(l[1]-a[1])+a[0]*(f[1]-l[1]),(g^p)>=0&&0!==g&&0!==p))}Zs=new WeakMap,Ih=new WeakMap;const am=function(){var u=ae(function*(a){if("string"!=typeof a)throw new TypeError("Invalid url.");const l=yield fetch(a);if(!l.ok)throw Error("Network Error: "+l.statusText);const f=yield l.text();if(!f.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const g=document.createElement("div");g.insertAdjacentHTML("beforeend",f);for(let p=0;p<g.childElementCount;++p){let _=g.children[p];_ instanceof HTMLStyleElement&&document.head.append(_)}return 1==g.childElementCount?g.children[0]:g});return function(l){return u.apply(this,arguments)}}();var ds,fs,ps;class aa extends Gn{constructor(a,l){if(super(null,l),ds.set(this,void 0),!xr(a))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new st.Rect({left:a.x,top:a.y,width:a.width,height:a.height})),Oe(this,ds,JSON.parse(JSON.stringify(a)),"f"),this._mediaType="rect"}extendSet(a,l){return!1}extendGet(a){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(a){this.setRect(a)}getPosition(){return this.getRect()}updatePosition(){U(this,ds,"f")&&this.setRect(U(this,ds,"f"))}setRect(a){if(!xr(a))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(a.x)),this.set("top",this.convertPropFromViewToImage(a.y)),this.set("width",this.convertPropFromViewToImage(a.width)),this.set("height",this.convertPropFromViewToImage(a.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",a.x),this.set("top",a.y),this.set("width",a.width),this.set("height",a.height)}this._drawingLayer.renderAll()}else Oe(this,ds,JSON.parse(JSON.stringify(a)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,ds,"f")?JSON.parse(JSON.stringify(U(this,ds,"f"))):null}}function lm(u,a,l){return st.util.transformPoint({x:l.points[this.pointIndex].x-l.pathOffset.x,y:l.points[this.pointIndex].y-l.pathOffset.y},l.calcTransformMatrix())}function RD(u){let a=new st.Point(u.strokeUniform?1/u.scaleX:1,u.strokeUniform?1/u.scaleY:1).multiply(u.strokeWidth);return new st.Point(u.width+a.x,u.height+a.y)}function cm(u,a,l,f){let g=a.target,p=g.controls[g.__corner],_=g.toLocalPoint(new st.Point(l,f),"center","center"),C=RD(g),b=g._getTransformedDimensions(0,0);return g.points[p.pointIndex]={x:_.x*C.x/b.x+g.pathOffset.x,y:_.y*C.y/b.y+g.pathOffset.y},st.controlsUtils.fireEvent("scaling",{e:u,transform:a,pointer:{x:l,y:f}}),!0}function um(u,a){return function(l,f,g,p){let _=f.target,C=st.util.transformPoint({x:_.points[u].x-_.pathOffset.x,y:_.points[u].y-_.pathOffset.y},_.calcTransformMatrix()),b=a(l,f,g,p);_._setPositionDimensions({});let O=RD(_);return _.setPositionByOrigin(C,(_.points[u].x-_.pathOffset.x)/O.x+.5,(_.points[u].y-_.pathOffset.y)/O.y+.5),b}}ds=new WeakMap;class hm extends Gn{constructor(a,l){if(super(null,l),fs.set(this,void 0),!ID(a))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new st.Polygon(a.points,{objectCaching:!1}));const f=this._fabricObject;let g=f.points.length-1;f.controls=f.points.reduce(function(p,_,C){return p["p"+C]=new st.Control({positionHandler:lm,actionHandler:um(C>0?C-1:g,cm),actionName:"modifyPolygon",pointIndex:C}),p},{}),Oe(this,fs,JSON.parse(JSON.stringify(a)),"f"),this._mediaType="polygon"}extendSet(a,l){if("vertices"===a){const f=this._fabricObject;if(f.group){const p=f.group;f.points=l.map(_=>({x:_.x-p.left-p.width/2,y:_.y-p.top-p.height/2})),p.addWithUpdate()}else f.points=l;const g=f.points.length-1;return f.controls=f.points.reduce(function(p,_,C){return p["p"+C]=new st.Control({positionHandler:lm,actionHandler:um(C>0?C-1:g,cm),actionName:"modifyPolygon",pointIndex:C}),p},{}),f._setPositionDimensions({}),!0}}extendGet(a){if("vertices"===a){const l=[],f=this._fabricObject;if(f.selectable&&!f.group)for(let g in f.oCoords)l.push({x:f.oCoords[g].x,y:f.oCoords[g].y});else for(let g of f.points){const C=st.util.transformPoint({x:g.x-f.pathOffset.x,y:g.y-f.pathOffset.y},f.calcTransformMatrix());l.push({x:C.x,y:C.y})}return l}}updateCoordinateBaseFromImageToView(){const a=this.get("vertices").map(l=>({x:this.convertPropFromViewToImage(l.x),y:this.convertPropFromViewToImage(l.y)}));this.set("vertices",a)}updateCoordinateBaseFromViewToImage(){const a=this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}));this.set("vertices",a)}setPosition(a){this.setPolygon(a)}getPosition(){return this.getPolygon()}updatePosition(){U(this,fs,"f")&&this.setPolygon(U(this,fs,"f"))}setPolygon(a){if(!ID(a))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const l=a.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",l)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",a.points)}this._drawingLayer.renderAll()}else Oe(this,fs,JSON.parse(JSON.stringify(a)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(a=>({x:this.convertPropFromImageToView(a.x),y:this.convertPropFromImageToView(a.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,fs,"f")?JSON.parse(JSON.stringify(U(this,fs,"f"))):null}}fs=new WeakMap;const OD=u=>{let a=u.split("\n").map(f=>f.split("\t"));return(l=>{for(let f=0;;f++){let g=-1;for(let p=0;p<l.length;p++){let _=l[p][f];void 0!==_&&_.length>g&&(g=_.length)}if(-1===g)break;for(let p=0;p<l.length;p++){if(f>=l[p].length-1)continue;let _=" ".repeat(g+2-l[p][f].length);l[p][f]=l[p][f].concat(_)}}})(a),(l=>{let f="";for(let g=0;g<l.length;g++)f=f.concat(...l[g],g===l.length-1?"":"\n");return f})(a)};class v2 extends Gn{constructor(a,l,f){if(super(null,f),ps.set(this,void 0),!tm(a))throw new TypeError("Invalid 'text'.");if(!xr(l))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new st.Textbox(OD(a),{left:l.x,top:l.y,width:l.width})),this._text=a,Oe(this,ps,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="text"}extendSet(a,l){if("text"===a)return this._text=l,this._fabricObject.set("text",OD(l)),!0}extendGet(a){if("text"===a)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(a){this.setTextRect(a)}getPosition(){return this.getTextRect()}updatePosition(){U(this,ps,"f")&&this.setTextRect(U(this,ps,"f"))}setText(a){if(!tm(a))throw new TypeError("Invalid 'text'.");this.set("text",a)}getText(){return this.get("text")}setTextRect(a){if(!xr(a))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(a.x)),this.set("top",this.convertPropFromViewToImage(a.y)),this.set("width",this.convertPropFromViewToImage(a.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",a.x),this.set("top",a.y),this.set("width",a.width)}this._drawingLayer.renderAll()}else Oe(this,ps,JSON.parse(JSON.stringify(a)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,ps,"f")?JSON.parse(JSON.stringify(U(this,ps,"f"))):null}}var _s,vs,la,dm,ca,Xl,ua,ni,ql,Zl,Kl,MD,LD,FD,PD,xh,Tt,Ql,Jl,ec,rn,Ah,Rh,Oh,ys,tc,nc,fm,ii,Mh,ND,gm,pm,ic,Lh;ps=new WeakMap;class y2 extends hm{constructor(a,l){if(super({points:null==a?void 0:a.points},l),_s.set(this,void 0),!SD(a))throw new TypeError("Invalid 'quad'.");Oe(this,_s,JSON.parse(JSON.stringify(a)),"f"),this._mediaType="quad"}setPosition(a){this.setQuad(a)}getPosition(){return this.getQuad()}updatePosition(){U(this,_s,"f")&&this.setQuad(U(this,_s,"f"))}setPolygon(){}getPolygon(){return null}setQuad(a){if(!SD(a))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const l=a.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",l)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",a.points)}this._drawingLayer.renderAll()}else Oe(this,_s,JSON.parse(JSON.stringify(a)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(a=>({x:this.convertPropFromImageToView(a.x),y:this.convertPropFromImageToView(a.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,_s,"f")?JSON.parse(JSON.stringify(U(this,_s,"f"))):null}}_s=new WeakMap;class C2 extends Gn{constructor(a){super(new st.Group(a.map(l=>l._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(ti.DIS_SELECTED);const l=this._fabricObject._objects;for(let f of l)setTimeout(()=>{f&&f.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(ti.DIS_DEFAULT);const l=this._fabricObject._objects;for(let f of l)setTimeout(()=>{f&&f.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(a,l){return!1}extendGet(a){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(a=>a.getDrawingItem())}setChildDrawingItems(a){if(!a||!a.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,a,"add"):this._fabricObject.addWithUpdate(a._getFabricObject())}removeChildItem(a){a&&a.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,a,"remove"):this._fabricObject.removeWithUpdate(a._getFabricObject()))}}class ye{static createDrawingStyle(a){if(!xD(a))throw new Error("Invalid style definition.");let l,f=ye.USER_START_STYLE_ID;for(;U(ye,vs,"f",la).has(f);)f++;l=f;const g=JSON.parse(JSON.stringify(a));g.id=l;for(let p in U(ye,vs,"f",dm))g.hasOwnProperty(p)||(g[p]=U(ye,vs,"f",dm)[p]);return U(ye,vs,"f",la).set(l,g),g.id}static _getDrawingStyle(a,l){if("number"!=typeof a)throw new Error("Invalid style id.");const f=U(ye,vs,"f",la).get(a);return f?l?JSON.parse(JSON.stringify(f)):f:null}static getDrawingStyle(a){return this._getDrawingStyle(a,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(U(ye,vs,"f",la).values())))}static _updateDrawingStyle(a,l){if(!xD(l))throw new Error("Invalid style definition.");const f=U(ye,vs,"f",la).get(a);if(f)for(let g in l)f.hasOwnProperty(g)&&(f[g]=l[g])}static updateDrawingStyle(a,l){this._updateDrawingStyle(a,l)}}vs=ye,ye.STYLE_BLUE_STROKE=1,ye.STYLE_GREEN_STROKE=2,ye.STYLE_ORANGE_STROKE=3,ye.STYLE_YELLOW_STROKE=4,ye.STYLE_BLUE_STROKE_FILL=5,ye.STYLE_GREEN_STROKE_FILL=6,ye.STYLE_ORANGE_STROKE_FILL=7,ye.STYLE_YELLOW_STROKE_FILL=8,ye.STYLE_BLUE_STROKE_TRANSPARENT=9,ye.STYLE_GREEN_STROKE_TRANSPARENT=10,ye.STYLE_ORANGE_STROKE_TRANSPARENT=11,ye.USER_START_STYLE_ID=1024,la={value:new Map([[ye.STYLE_BLUE_STROKE,{id:ye.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ye.STYLE_GREEN_STROKE,{id:ye.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_ORANGE_STROKE,{id:ye.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_YELLOW_STROKE,{id:ye.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[ye.STYLE_BLUE_STROKE_FILL,{id:ye.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_GREEN_STROKE_FILL,{id:ye.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_ORANGE_STROKE_FILL,{id:ye.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_YELLOW_STROKE_FILL,{id:ye.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_BLUE_STROKE_TRANSPARENT,{id:ye.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_GREEN_STROKE_TRANSPARENT,{id:ye.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[ye.STYLE_ORANGE_STROKE_TRANSPARENT,{id:ye.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},dm={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(st.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(st.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(u){u.dispose&&u.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),st.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},st.Object.prototype.transparentCorners=!1,st.Object.prototype.cornerSize=20,st.Object.prototype.touchCornerSize=100,st.Object.prototype.cornerColor="rgb(254,142,20)",st.Object.prototype.cornerStyle="circle",st.Object.prototype.strokeUniform=!0,st.Object.prototype.hasBorders=!1,st.Canvas.prototype.containerClass="",st.Canvas.prototype.getPointer=function(u,a){if(this._absolutePointer&&!a)return this._absolutePointer;if(this._pointer&&a)return this._pointer;var l,f=this.upperCanvasEl,g=st.util.getPointer(u,f),p=f.getBoundingClientRect(),_=p.width||0,C=p.height||0;_&&C||("top"in p&&"bottom"in p&&(C=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(_=Math.abs(p.right-p.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,a||(g=this.restorePointerVpt(g));var b=this.getRetinaScaling();if(1!==b&&(g.x/=b,g.y/=b),0!==_&&0!==C){var O=window.getComputedStyle(f).objectFit,M=f.width,P=f.height;l={width:M/_,height:P/C};var Y=M/P,X=_/C;return"contain"===O?Y>X?{x:g.x*l.width,y:(g.y-(C-_/Y)/2)*l.width}:{x:(g.x-(_-C*Y)/2)*l.height,y:g.y*l.height}:"cover"===O?Y>X?{x:(M-l.height*_)/2+g.x*l.height,y:g.y*l.height}:{x:g.x*l.width,y:(P-l.width*C)/2+g.y*l.width}:{x:g.x*l.width,y:g.y*l.height}}return{x:g.x*(l={width:1,height:1}).width,y:g.y*l.height}},st.Canvas.prototype._onTouchStart=function(u){var a=this.findTarget(u);!this.allowTouchScrolling&&u.cancelable&&u.preventDefault&&u.preventDefault(),a&&u.cancelable&&u.preventDefault&&u.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(u)),this.__onMouseDown(u),this._resetTransformEventData();var l=this.upperCanvasEl,f=this._getEventPrefix();st.util.addListener(st.document,"touchend",this._onTouchEnd,{passive:!1}),st.util.addListener(st.document,"touchmove",this._onMouseMove,{passive:!1}),st.util.removeListener(l,f+"down",this._onMouseDown)},st.Textbox.prototype._wrapLine=function(u,a,l,f){const g=u.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var _=0,C=this.splitByGrapheme||!(!g||!g.length),b=[],O=[],M=C?st.util.string.graphemeSplit(u):u.split(this._wordJoiners),P="",k=0,j=C?"":" ",G=0,z=0,Y=0,X=!0,$=this._getWidthOfCharSpacing();f=f||0,0===M.length&&M.push([]),l-=f;for(var K=0;K<M.length;K++)P=C?M[K]:st.util.string.graphemeSplit(M[K]),G=this._measureWord(P,a,k),k+=P.length,(_+=z+G-$)>l&&!X?(b.push(O),O=[],_=G,X=!0):_+=$,X||C||O.push(j),O=O.concat(P),z=C?0:this._measureWord([j],a,k),k++,X=!1,G>Y&&(Y=G);return K&&b.push(O),Y+f>this.dynamicMinWidth&&(this.dynamicMinWidth=Y-$+f),b});class Nt{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(a){this.fabricCanvas.selection=a,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(a,l,f){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,a.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=a.getFabricCanvas();else{let _=this.fabricCanvas=new st.Canvas(a,Object.assign(f,{allowTouchScrolling:!0,selection:!1}));_.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),_.lowerCanvasEl.className="",_.upperCanvasEl.className="",_.on("selection:created",function(C){const b=C.selected,O=[];for(let M of b){const P=M.getDrawingItem()._drawingLayer;P&&!O.includes(P)&&O.push(P)}for(let M of O){const P=[];for(let k of b){const j=k.getDrawingItem();j._drawingLayer===M&&P.push(j)}setTimeout(()=>{M.onSelectionChanged&&M.onSelectionChanged(P,[])},0)}}),_.on("before:selection:cleared",function(C){const b=this.getActiveObjects(),O=[];for(let M of b){const P=M.getDrawingItem()._drawingLayer;P&&!O.includes(P)&&O.push(P)}for(let M of O){const P=[];for(let k of b){const j=k.getDrawingItem();j._drawingLayer===M&&P.push(j)}setTimeout(()=>{const k=[];for(let j of P)M.hasDrawingItem(j)&&k.push(j);k.length>0&&M.onSelectionChanged&&M.onSelectionChanged([],k)},0)}}),_.on("selection:updated",function(C){const b=C.selected,O=C.deselected,M=[];for(let P of b){const k=P.getDrawingItem()._drawingLayer;k&&!M.includes(k)&&M.push(k)}for(let P of O){const k=P.getDrawingItem()._drawingLayer;k&&!M.includes(k)&&M.push(k)}for(let P of M){const k=[],j=[];for(let G of b){const z=G.getDrawingItem();z._drawingLayer===P&&k.push(z)}for(let G of O){const z=G.getDrawingItem();z._drawingLayer===P&&j.push(z)}setTimeout(()=>{P.onSelectionChanged&&P.onSelectionChanged(k,j)},0)}}),_.wrapperEl.style.position="absolute",a.getFabricCanvas=()=>this.fabricCanvas}let g,p;switch(this.id=l,l){case Nt.DDN_LAYER_ID:g=ye.getDrawingStyle(ye.STYLE_BLUE_STROKE),p=ye.getDrawingStyle(ye.STYLE_BLUE_STROKE_FILL);break;case Nt.DBR_LAYER_ID:g=ye.getDrawingStyle(ye.STYLE_ORANGE_STROKE),p=ye.getDrawingStyle(ye.STYLE_ORANGE_STROKE_FILL);break;case Nt.DLR_LAYER_ID:g=ye.getDrawingStyle(ye.STYLE_GREEN_STROKE),p=ye.getDrawingStyle(ye.STYLE_GREEN_STROKE_FILL);break;default:g=ye.getDrawingStyle(ye.STYLE_YELLOW_STROKE),p=ye.getDrawingStyle(ye.STYLE_YELLOW_STROKE_FILL)}for(let _ of Gn.arrMediaTypes)this.mapType_StateAndStyleId.set(_,{default:g.id,selected:p.id})}getId(){return this.id}setVisible(a){if(a){for(let l of this._arrFabricObject)l.visible=!0,l.hasControls=!0;this._visible=!0}else{for(let l of this._arrFabricObject)l.visible=!1,l.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(a){return a.styleId?ye.getDrawingStyle(a.styleId):ye.getDrawingStyle(a._mapState_StyleId.get(a.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(a,l,f,g){const p=this.getDrawingItems(_=>_._mediaType===a);for(let _ of p)_.styleSelector===l&&this._changeItemStyle(_,f,!0);g||this.fabricCanvas.renderAll()}_changeItemStyle(a,l,f){if(!a||!l)return;const g=a._getFabricObject();"number"==typeof a.styleId&&(l=ye.getDrawingStyle(a.styleId)),g.strokeWidth=l.lineWidth,"fill"===l.paintMode?(g.fill=l.fillStyle,g.stroke=l.fillStyle):"stroke"===l.paintMode?(g.fill="transparent",g.stroke=l.strokeStyle):"strokeAndFill"===l.paintMode&&(g.fill=l.fillStyle,g.stroke=l.strokeStyle),g.fontFamily&&(g.fontFamily=l.fontFamily),g.fontSize&&(g.fontSize=l.fontSize),g.group||(g.dirty=!0),f||this.fabricCanvas.renderAll()}_updateGroupItem(a,l,f){if(!a||!l)return;const g=a.getChildDrawingItems();if("add"===f){if(g.includes(l))return;const p=l._getFabricObject();if(this.fabricCanvas.getObjects().includes(p)){if(!this._arrFabricObject.includes(p))throw new Error("Existed in other drawing layers.");l._zIndex=null}else{let _;if(l.styleId)_=ye.getDrawingStyle(l.styleId);else{const C=this.mapType_StateAndStyleId.get(l._mediaType);_=ye.getDrawingStyle(C[a.styleSelector]);const b=()=>{this._changeItemStyle(l,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).selected),!0)},O=()=>{this._changeItemStyle(l,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).default),!0)};l._on("selected",b),l._on("deselected",O),l._funcChangeStyleToSelected=b,l._funcChangeStyleToDefault=O}l._drawingLayer=this,l._drawingLayerId=this.id,this._changeItemStyle(l,_,!0)}a._fabricObject.addWithUpdate(l._getFabricObject())}else{if("remove"!==f||!g.includes(l))return;l._zIndex=null,l._drawingLayer=null,l._drawingLayerId=null,l._off("selected",l._funcChangeStyleToSelected),l._off("deselected",l._funcChangeStyleToDefault),l._funcChangeStyleToSelected=null,l._funcChangeStyleToDefault=null,a._fabricObject.removeWithUpdate(l._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(a,l){if(!(a instanceof Gn))throw new TypeError("Invalid 'drawingItem'.");if(a._drawingLayer){if(a._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let f=a._getFabricObject();const g=this.fabricCanvas.getObjects();let p,_;if(g.includes(f)){if(this._arrFabricObject.includes(f))return;throw new Error("Existed in other drawing layers.")}if("group"===a._mediaType){p=a.getChildDrawingItems();for(let O of p)if(O._drawingLayer&&O._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(l&&"object"==typeof l&&!Array.isArray(l))for(let O in l)f.set(O,l[O]);if(p){for(let O of p){const M=this.mapType_StateAndStyleId.get(O._mediaType);for(let P of Gn.arrStyleSelectors)O._mapState_StyleId.set(P,M[P]);if(O.styleId)_=ye.getDrawingStyle(O.styleId);else{_=ye.getDrawingStyle(M.default);const P=()=>{this._changeItemStyle(O,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(O._mediaType).selected),!0)},k=()=>{this._changeItemStyle(O,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(O._mediaType).default),!0)};O._on("selected",P),O._on("deselected",k),O._funcChangeStyleToSelected=P,O._funcChangeStyleToDefault=k}O._drawingLayer=this,O._drawingLayerId=this.id,this._changeItemStyle(O,_,!0)}f.dirty=!0,this.fabricCanvas.renderAll()}else{const O=this.mapType_StateAndStyleId.get(a._mediaType);for(let M of Gn.arrStyleSelectors)a._mapState_StyleId.set(M,O[M]);if(a.styleId)_=ye.getDrawingStyle(a.styleId);else{_=ye.getDrawingStyle(O.default);const M=()=>{this._changeItemStyle(a,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(a._mediaType).selected))},P=()=>{this._changeItemStyle(a,ye.getDrawingStyle(this.mapType_StateAndStyleId.get(a._mediaType).default))};a._on("selected",M),a._on("deselected",P),a._funcChangeStyleToSelected=M,a._funcChangeStyleToDefault=P}this._changeItemStyle(a,_)}a._zIndex=this.id,a._drawingLayer=this,a._drawingLayerId=this.id;const C=this._arrFabricObject.length;let b=g.length;if(C)b=g.indexOf(this._arrFabricObject[C-1])+1;else for(let O=0;O<g.length;O++)if(a._zIndex<g[O].getDrawingItem()._zIndex){b=O;break}this._arrDrwaingItem.push(a),this._arrFabricObject.push(f),f.visible=!!this._visible,this.fabricCanvas.insertAt(f,b,!1)}addDrawingItem(a){if(!a||!a.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)a._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");a._setEditable(!0)}this._addDrawingItem(a),a.updatePosition()}addDrawingItems(a){for(let l of a)this.addDrawingItem(l)}removeDrawingItem(a){if(!a||!a.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(a))return;if(a._zIndex=null,a._drawingLayer=null,a._drawingLayerId=null,"group"===a._mediaType){const f=a.getChildDrawingItems();for(let g of f)g._zIndex=null,g._drawingLayer=null,g._drawingLayerId=null,g._off("selected",g._funcChangeStyleToSelected),g._off("deselected",g._funcChangeStyleToDefault),g._funcChangeStyleToSelected=null,g._funcChangeStyleToDefault=null,g._mapState_StyleId.clear()}else a._off("selected",a._funcChangeStyleToSelected),a._off("deselected",a._funcChangeStyleToDefault),a._funcChangeStyleToSelected=null,a._funcChangeStyleToDefault=null,a._mapState_StyleId.clear();const l=a._getFabricObject();"selected"===a.styleSelector&&(l.group?l.group.removeWithUpdate(l):this.fabricCanvas._activeObject=null,a.setState(ti.DIS_DEFAULT)),this.fabricCanvas.remove(l),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(a),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(l),1)}removeDrawingItems(a){for(let l of a)this.removeDrawingItem(l)}setDrawingItems(a){this.clearDrawingItems(),this.addDrawingItems(a)}getDrawingItems(a){return a&&"function"==typeof a?this._arrDrwaingItem.filter(a):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const a=this.fabricCanvas.getActiveObjects(),l=[];for(let f of a)this._arrFabricObject.includes(f)&&l.push(f.getDrawingItem());return l}hasDrawingItem(a){if(!a||!a.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(a)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(a,l,f){l?l.forEach(_=>_.toLowerCase()):l=Gn.arrMediaTypes,f?f.forEach(_=>_.toLowerCase()):f=Gn.arrStyleSelectors;const g=ye.getDrawingStyle(a);if(!g)throw new Error(`The 'drawingStyle' with id '${a}' doesn't exist.`);let p;for(let _ of l)if(p=this.mapType_StateAndStyleId.get(_),p)for(let C of f){this._changeMediaTypeCurStyleInStyleSelector(_,C,g,!0),p[C]=a;for(let b of this._arrDrwaingItem)b._mediaType===_&&b._mapState_StyleId.set(C,a)}this.fabricCanvas.renderAll()}setDefaultStyle(a,l,f){const g=[];f&Dn.DIMT_RECTANGLE&&g.push("rect"),f&Dn.DIMT_QUADRILATERAL&&g.push("quad"),f&Dn.DIMT_TEXT&&g.push("text"),f&Dn.DIMT_ARC&&g.push("arc"),f&Dn.DIMT_IMAGE&&g.push("image"),f&Dn.DIMT_POLYGON&&g.push("polygon"),f&Dn.DIMT_LINE&&g.push("line");const p=[];l&ti.DIS_DEFAULT&&p.push("default"),l&ti.DIS_SELECTED&&p.push("selected"),this._setDefaultStyle(a,g.length?g:null,p.length?p:null)}setMode(a){if("viewer"===(a=a.toLowerCase())){for(let l of this._arrDrwaingItem)l._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==a)throw new RangeError("Invalid value.");for(let l of this._arrDrwaingItem)l._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(a,l){this.fabricCanvas.setDimensions(a,l)}_setObjectFit(a){if(a=a.toLowerCase(),!["contain","cover"].includes(a))throw new Error(`Unsupported value '${a}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=a,this.fabricCanvas.upperCanvasEl.style.objectFit=a}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let a of this._arrDrwaingItem){const l=this._getItemCurrentStyle(a);this._changeItemStyle(a,l,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Nt.DDN_LAYER_ID=1,Nt.DBR_LAYER_ID=2,Nt.DLR_LAYER_ID=3,Nt.USER_DEFINED_LAYER_BASE_ID=100,Nt.TIP_LAYER_ID=999;class w2{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(a,l){if(this.getDrawingLayer(l))throw new Error("Existed drawing layer id.");const f=new Nt(a,l,{enableRetinaScaling:!1});return f._manager=this,this._arrDrawingLayer.push(f),this._switchPointerEvent(),f}deleteDrawingLayer(a){const l=this.getDrawingLayer(a);if(!l)return;const f=this._arrDrawingLayer;l.dispose(),f.splice(f.indexOf(l),1),this._switchPointerEvent()}clearDrawingLayers(){for(let a of this._arrDrawingLayer)a.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(a){for(let l of this._arrDrawingLayer)if(l.getId()===a)return l;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const a=this._getFabricCanvas().getActiveObjects(),l=[];for(let f of a)l.push(f.getDrawingItem());return l}setDimensions(a,l){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(a,l)}setObjectFit(a){for(let l of this._arrDrawingLayer)l&&l._setObjectFit(a)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(a){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=a?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let a of this._arrDrawingLayer)a.getMode()}}class E2 extends v2{constructor(a,l,f,g,p){super(a,{x:l,y:f,width:g,height:0},p),ca.set(this,void 0),Xl.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var _=0,C=0,b=this._textLines.length;C<b;C++)_+=this.getHeightOfLine(C);return _+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(a){Oe(this,ca,a,"f"),U(this,Xl,"f")&&clearTimeout(U(this,Xl,"f")),U(this,ca,"f")>=0&&Oe(this,Xl,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},U(this,ca,"f")),"f")}getDuration(){return U(this,ca,"f")}}ca=new WeakMap,Xl=new WeakMap,ni=new WeakMap,ql=new WeakMap,Zl=new WeakMap,Kl=new WeakMap,ua=new WeakSet,MD=function(u,a,l,f,g,p){const _=new E2(u,a,l,f,p);return _.coordinateBase=g,_},LD=function(u,a){a.hasDrawingItem(u)||a.addDrawingItems([u])},FD=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},PD=function(){if(!this._tip)return;const u=U(this,ni,"f");this._tip.coordinateBase=u.coordinateBase,this._tip.setTextRect({x:u.topLeftPoint.x,y:u.topLeftPoint.y,width:u.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class mm extends HTMLElement{constructor(){super(),xh.set(this,void 0);const a=document.createElement("template").content,l=document.createElement("div");l.setAttribute("class","wrapper"),a.appendChild(l),Oe(this,xh,l,"f");const f=document.createElement("slot");f.setAttribute("name","single-frame-input-container"),l.append(f);const g=document.createElement("slot");g.setAttribute("name","content"),l.append(g);const p=document.createElement("slot");p.setAttribute("name","drawing-layer"),l.append(p);const _=document.createElement("style");_.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',a.appendChild(_),this.attachShadow({mode:"open"}).appendChild(a.cloneNode(!0))}getWrapper(){return U(this,xh,"f")}setElement(a,l){if(!(l instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(a))throw new TypeError("Invalid 'slot'.");this.removeElement(a),l.setAttribute("slot",a),this.appendChild(l)}getElement(a){if(!["content","single-frame-input-container","drawing-layer"].includes(a))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${a}"]`)}removeElement(a){var l;if(!["content","single-frame-input-container","drawing-layer"].includes(a))throw new TypeError("Invalid 'slot'.");null===(l=this.querySelectorAll(`[slot="${a}"]`))||void 0===l||l.forEach(f=>f.remove())}}xh=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",mm);class ha extends HTMLElement{constructor(){super();const a=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(a.cloneNode(!0))}showScanLaser(){const a=this.shadowRoot.querySelector(".dce-scanlight");a&&(a.style.display="")}hideScanLaser(){const a=this.shadowRoot.querySelector(".dce-scanlight");a&&(a.style.display="none")}getElement(a){return this.shadowRoot.querySelector(a)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class Kt extends class b2{constructor(){ua.add(this),ni.set(this,void 0),ql.set(this,void 0),Zl.set(this,void 0),Kl.set(this,!0),this._drawingLayerManager=new w2}createDrawingLayerBaseCvs(a,l,f="contain"){if("number"!=typeof a||a<=1)throw new Error("Invalid 'width'.");if("number"!=typeof l||l<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(f))throw new Error("Unsupported 'objectFit'.");const g=document.createElement("canvas");return g.width==a&&g.height==l||(g.width=a,g.height=l),g.style.objectFit=f,g}_createDrawingLayer(a,l,f,g){if(!this._layerBaseCvs){let C;try{C=this.getContentDimensions()}catch(b){if("Invalid content dimensions."!==(b.message||b))throw b}l||(l=(null==C?void 0:C.width)||1280),f||(f=(null==C?void 0:C.height)||720),g||(g=(null==C?void 0:C.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(l,f,g)}const p=this._layerBaseCvs,_=this._drawingLayerManager.createDrawingLayer(p,a);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",p.parentElement),_}createDrawingLayer(){let a;for(let l=Nt.USER_DEFINED_LAYER_BASE_ID;;l++)if(!this._drawingLayerManager.getDrawingLayer(l)&&l!==Nt.TIP_LAYER_ID){a=l;break}return this._createDrawingLayer(a)}deleteDrawingLayer(a){var l;this._drawingLayerManager.deleteDrawingLayer(a),this._drawingLayerManager.getAllDrawingLayers().length||(null===(l=this._innerComponent)||void 0===l||l.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(a){if("number"!=typeof a)throw new TypeError("Invalid id.");if(a<Nt.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${a} is not defined by users.`);this.deleteDrawingLayer(a)}_clearDrawingLayers(){const a=this.getAllDrawingLayers();for(let l of a)this.deleteDrawingLayer(l.getId())}clearUserDefinedDrawingLayers(){const a=this.getAllDrawingLayers();for(let l of a){const f=l.getId();f<Nt.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(f)}}getDrawingLayer(a){return a==Nt.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(a)||([Nt.DDN_LAYER_ID,Nt.DBR_LAYER_ID,Nt.DLR_LAYER_ID].includes(a)?this._createDrawingLayer(a):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(a=>a.getId()>=0&&a.getId()!==Nt.TIP_LAYER_ID)}updateDrawingLayers(a){((l,f,g)=>{if(!(l<=1||f<=1)){if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:l,height:f},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(g)}})(a.width,a.height,a.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(a){if(!(DD(l=a)&&m2(l.topLeftPoint)&&sa(l.width))||l.width<=0||!sa(l.duration)||"coordinateBase"in l&&!["view","image"].includes(l.coordinateBase))throw new Error("Invalid tip config.");var l;Oe(this,ni,JSON.parse(JSON.stringify(a)),"f"),U(this,ni,"f").coordinateBase||(U(this,ni,"f").coordinateBase="view"),Oe(this,Zl,a.duration,"f"),U(this,ua,"m",PD).call(this)}getTipConfig(){return U(this,ni,"f")?U(this,ni,"f"):null}setTipVisible(a){if("boolean"!=typeof a)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",a),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Oe(this,Kl,a,"f")}isTipVisible(){return U(this,Kl,"f")}updateTipMessage(a){if(!U(this,ni,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=ye.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Nt.TIP_LAYER_ID)||this._createDrawingLayer(Nt.TIP_LAYER_ID)),this._tip?this._tip.set("text",a):this._tip=U(this,ua,"m",MD).call(this,a,U(this,ni,"f").topLeftPoint.x,U(this,ni,"f").topLeftPoint.y,U(this,ni,"f").width,U(this,ni,"f").coordinateBase,this._tipStyleId),U(this,ua,"m",LD).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",U(this,Kl,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),U(this,ql,"f")&&clearTimeout(U(this,ql,"f")),U(this,Zl,"f")>=0&&Oe(this,ql,setTimeout(()=>{U(this,ua,"m",FD).call(this)},U(this,Zl,"f")),"f")}}{static get engineResourcePath(){return $t.engineResourcePaths.dce}static set defaultUIElementURL(a){Kt._defaultUIElementURL=a}static get defaultUIElementURL(){var a;return null===(a=Kt._defaultUIElementURL)||void 0===a?void 0:a.replace("@engineResourcePath/",Kt.engineResourcePath)}static createInstance(a){return ae(function*(){customElements.get(Kt.uiComponentName)||customElements.define(Kt.uiComponentName,ha);const l=new Kt;return yield l.setUIElement(a||Kt.defaultUIElementURL),l})()}static _transformCoordinates(a,l,f,g,p,_,C){const O=C/p;a.x=Math.round(a.x/(_/g)+l),a.y=Math.round(a.y/O+f)}set _singleFrameMode(a){if(!["disabled","image","camera"].includes(a))throw new Error("Invalid value.");if(a!==U(this,tc,"f")){if(Oe(this,tc,a,"f"),U(this,Tt,"m",ii).call(this))Oe(this,rn,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!U(this,rn,"f")){const l=document.createElement("video");l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.objectFit=this.getVideoFit(),l.setAttribute("autoplay","true"),l.setAttribute("playsinline","true"),l.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(bn.OS)&&l.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Oe(this,rn,l,"f");const f=document.createElement("div");f.append(l),f.style.overflow="hidden",this._videoContainer=f,this._innerComponent.setElement("content",f)}U(this,Tt,"m",ii).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return U(this,tc,"f")}get disposed(){return U(this,fm,"f")}constructor(){var a;super(),a=this,Tt.add(this),Ql.set(this,void 0),Jl.set(this,void 0),ec.set(this,void 0),this.containerClassName="dce-video-container",rn.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Ah.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,Rh.set(this,!1),Oh.set(this,!1),ys.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{U(this,Tt,"m",ic).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&U(this,Tt,"m",pm).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{Kt._onLog&&Kt._onLog("window resize event triggered."),U(this,ys,"f").width===document.documentElement.clientWidth&&U(this,ys,"f").height===document.documentElement.clientHeight||(U(this,ys,"f").width=document.documentElement.clientWidth,U(this,ys,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},tc.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!U(this,Tt,"m",ii).call(this))return;let l;if(this._singleFrameInputContainer)l=this._singleFrameInputContainer.firstElementChild;else{l=document.createElement("input"),l.setAttribute("type","file"),"camera"===this._singleFrameMode?(l.setAttribute("capture",""),l.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(l.removeAttribute("capture"),l.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),l.addEventListener("change",ae(function*(){const g=l.files[0];l.value="";{const p=function(){var j=ae(function*(G){let z=null,Y=null;if("undefined"!=typeof createImageBitmap)try{if(z=yield createImageBitmap(G),z)return z}catch($){}var X;return z||(Y=yield(X=G,new Promise(($,K)=>{let ge=URL.createObjectURL(X),_e=new Image;_e.src=ge,_e.onload=()=>{URL.revokeObjectURL(_e.src),$(_e)},_e.onerror=Te=>{K(new Error("Can't convert blob to image : "+(Te instanceof Event?Te.type:Te)))}}))),Y});return function(z){return j.apply(this,arguments)}}(),_=(j,G,z,Y)=>{j.width==z&&j.height==Y||(j.width=z,j.height=Y);const X=j.getContext("2d");X.clearRect(0,0,j.width,j.height),X.drawImage(G,0,0)},C=yield p(g),b=C instanceof HTMLImageElement?C.naturalWidth:C.width,O=C instanceof HTMLImageElement?C.naturalHeight:C.height;let M=a._cvsSingleFrameMode;const P=null==M?void 0:M.width,k=null==M?void 0:M.height;M||(M=document.createElement("canvas"),a._cvsSingleFrameMode=M),_(M,C,b,O),a._innerComponent.setElement("content",M),P===M.width&&k===M.height||a.eventHandler.fire("content:updated",null,{async:!1})}a._onSingleFrameAcquired&&setTimeout(()=>{a._onSingleFrameAcquired(a._cvsSingleFrameMode)},0)})),l.style.position="absolute",l.style.top="-9999px",l.style.backgroundColor="transparent",l.style.color="transparent";const f=document.createElement("div");f.append(l),this._innerComponent.setElement("single-frame-input-container",f),this._singleFrameInputContainer=f}null==l||l.click()},nc.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(l,f)=>{var g,p,_,C;if(this.disposed||(this.clearAllInnerDrawingItems(),!l))return;const b=l.originalImageTag;if(!b)return;const O=l.items;if(!(null==O?void 0:O.length))return;const M=(null===(g=b.cropRegion)||void 0===g?void 0:g.left)||0,P=(null===(p=b.cropRegion)||void 0===p?void 0:p.top)||0,k=(null===(_=b.cropRegion)||void 0===_?void 0:_.right)?b.cropRegion.right-M:b.originalWidth,j=(null===(C=b.cropRegion)||void 0===C?void 0:C.bottom)?b.cropRegion.bottom-P:b.originalHeight,G=b.currentWidth,z=b.currentHeight,Y=(K,ge,_e,Te,Se,F,Ce,Ne,Ke=[],D)=>{ge.forEach(w=>Kt._transformCoordinates(w,_e,Te,Se,F,Ce,Ne));const y=new y2({points:[{x:ge[0].x,y:ge[0].y},{x:ge[1].x,y:ge[1].y},{x:ge[2].x,y:ge[2].y},{x:ge[3].x,y:ge[3].y}]},D);for(let w of Ke)y.addNote(w);K.addDrawingItems([y]),U(this,nc,"f").push(y)};let X,$;for(let K of O)switch(K.type){case Xt.CRIT_ORIGINAL_IMAGE:break;case Xt.CRIT_BARCODE:X=this.getDrawingLayer(Nt.DBR_LAYER_ID),$=[{name:"format",content:K.formatString},{name:"text",content:K.text}],(null==f?void 0:f.isBarcodeVerifyOpen)?K.verified?Y(X,K.location.points,M,P,k,j,G,z,$):Y(X,K.location.points,M,P,k,j,G,z,$,ye.STYLE_ORANGE_STROKE_TRANSPARENT):Y(X,K.location.points,M,P,k,j,G,z,$);break;case Xt.CRIT_TEXT_LINE:X=this.getDrawingLayer(Nt.DLR_LAYER_ID),$=[{name:"text",content:K.text}],f.isLabelVerifyOpen?K.verified?Y(X,K.location.points,M,P,k,j,G,z,$):Y(X,K.location.points,M,P,k,j,G,z,$,ye.STYLE_GREEN_STROKE_TRANSPARENT):Y(X,K.location.points,M,P,k,j,G,z,$);break;case Xt.CRIT_DETECTED_QUAD:X=this.getDrawingLayer(Nt.DDN_LAYER_ID),(null==f?void 0:f.isDetectVerifyOpen)?K.verified?Y(X,K.location.points,M,P,k,j,G,z,[]):Y(X,K.location.points,M,P,k,j,G,z,[],ye.STYLE_BLUE_STROKE_TRANSPARENT):Y(X,K.location.points,M,P,k,j,G,z,[]);break;case Xt.CRIT_NORMALIZED_IMAGE:X=this.getDrawingLayer(Nt.DDN_LAYER_ID),(null==f?void 0:f.isNormalizeVerifyOpen)?K.verified?Y(X,K.location.points,M,P,k,j,G,z,[]):Y(X,K.location.points,M,P,k,j,G,z,[],ye.STYLE_BLUE_STROKE_TRANSPARENT):Y(X,K.location.points,M,P,k,j,G,z,[]);break;case Xt.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},fm.set(this,!1),this.eventHandler=new AD,this.eventHandler.on("content:updated",()=>{U(this,Ql,"f")&&clearTimeout(U(this,Ql,"f")),Oe(this,Ql,setTimeout(()=>{if(this.disposed)return;let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateDrawingLayers(l),this.updateConvertedRegion(l)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{U(this,Jl,"f")&&clearTimeout(U(this,Jl,"f")),Oe(this,Jl,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(a){a instanceof HTMLTemplateElement?(window._dce_default_template=a,this.UIElement=new ha):this.UIElement=a,this._unbindUI(),this._bindUI()}setUIElement(a){var l=this;return ae(function*(){let f;if(f="string"==typeof a?yield am(a):a,f instanceof HTMLDivElement&&0==f.childElementCount){const g=yield am(Kt.defaultUIElementURL);g instanceof HTMLTemplateElement?(window._dce_default_template=g,f.append(new ha)):f.append(g),l._setUIElement(f)}else l._setUIElement(f)})()}getUIElement(){return this.UIElement}_bindUI(){var a;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let l,f=this.UIElement;if(f instanceof ha?l=f.getElement(`.${this.containerClassName}`):f instanceof HTMLDivElement&&1===f.childElementCount&&f.firstElementChild instanceof ha?(l=f.firstElementChild.getElement(`.${this.containerClassName}`),f=f.firstElementChild):l=f.classList.contains(this.containerClassName)?f:f.querySelector(`.${this.containerClassName}`),!l)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new mm,l.appendChild(this._innerComponent),!U(this,Tt,"m",ii).call(this)){const g=document.createElement("video");g.style.position="absolute",g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%",g.style.objectFit=this.getVideoFit(),g.setAttribute("autoplay","true"),g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(bn.OS)&&g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Oe(this,rn,g,"f");const p=document.createElement("div");p.append(g),p.style.overflow="hidden",this._videoContainer=p,this._innerComponent.setElement("content",p)}if(f instanceof ha?(this._selRsl=f.getElement(".dce-sel-resolution"),this._selMinLtr=f.getElement(".dlr-sel-minletter"),this._divScanArea=f.getElement(".dce-scanarea"),this._divScanLight=f.getElement(".dce-scanlight"),this._bgLoading=f.getElement(".dce-bg-loading"),this._bgCamera=f.getElement(".dce-bg-camera"),this._selCam=f.getElement(".dce-sel-camera"),this._optGotRsl=f.getElement(".dce-opt-gotResolution"),this._btnClose=f.getElement(".dce-btn-close"),this._optGotMinLtr=f.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=f.querySelector(".dce-sel-resolution"),this._selMinLtr=f.querySelector(".dlr-sel-minletter"),this._divScanArea=f.querySelector(".dce-scanarea"),this._divScanLight=f.querySelector(".dce-scanlight"),this._bgLoading=f.querySelector(".dce-bg-loading"),this._bgCamera=f.querySelector(".dce-bg-camera"),this._selCam=f.querySelector(".dce-sel-camera"),this._optGotRsl=f.querySelector(".dce-opt-gotResolution"),this._btnClose=f.querySelector(".dce-btn-close"),this._optGotMinLtr=f.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||U(this,Tt,"m",ii).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||U(this,Tt,"m",ii).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||U(this,Tt,"m",ic).call(this),U(this,Tt,"m",ii).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),U(this,Tt,"m",ii).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(p=>{var _;Kt._onLog&&Kt._onLog("resize observer triggered.");for(let C of p)C.target===(null===(_=this._innerComponent)||void 0===_?void 0:_.getWrapper())&&this._videoResizeListener()}));const g=null===(a=this._innerComponent)||void 0===a?void 0:a.getWrapper();g&&this._resizeObserver.observe(g)}U(this,ys,"f").width=document.documentElement.clientWidth,U(this,ys,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var a,l,f,g;U(this,Tt,"m",ii).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),U(this,Tt,"m",ic).call(this),null===(a=this._drawingLayerManager)||void 0===a||a.clearDrawingLayers(),null===(l=this._innerComponent)||void 0===l||l.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(f=this._innerComponent)||void 0===f||f.remove(),this._innerComponent=null,Oe(this,rn,null,"f"),null===(g=this._videoContainer)||void 0===g||g.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(a,l){if(!this._selCam)return;let f;this._selCam.textContent="";for(let g of l){const p=document.createElement("option");p.value=g.deviceId,p.innerText=g.label,this._selCam.append(p),g.deviceId&&a&&a.deviceId==g.deviceId&&(f=p)}this._selCam.value=f?f.value:""}_renderResolutionInfo(a){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",a.width),this._optGotRsl.setAttribute("data-height",a.height),this._optGotRsl.innerText="got "+a.width+"x"+a.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return U(this,rn,"f")}isVideoLoaded(){return!!U(this,rn,"f")&&4==U(this,rn,"f").readyState}setVideoFit(a){if(a=a.toLowerCase(),!["contain","cover"].includes(a))throw new Error(`Unsupported value '${a}'.`);if(this.videoFit=a,!U(this,rn,"f")||(U(this,rn,"f").style.objectFit=a,U(this,Tt,"m",ii).call(this)))return;let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}U(this,Tt,"m",Lh).call(this,l,this.getConvertedRegion()),this.updateDrawingLayers(l)}getVideoFit(){return this.videoFit}getContentDimensions(){var a,l,f,g;let p,_,C;if(U(this,Tt,"m",ii).call(this)?(p=null===(f=this._cvsSingleFrameMode)||void 0===f?void 0:f.width,_=null===(g=this._cvsSingleFrameMode)||void 0===g?void 0:g.height,C="contain"):(p=null===(a=U(this,rn,"f"))||void 0===a?void 0:a.videoWidth,_=null===(l=U(this,rn,"f"))||void 0===l?void 0:l.videoHeight,C=this.getVideoFit()),!p||!_)throw new Error("Invalid content dimensions.");return{width:p,height:_,objectFit:C}}updateConvertedRegion(a){const l=Th.convert(this.scanRegion,a.width,a.height);Oe(this,Ah,l,"f"),U(this,ec,"f")&&clearTimeout(U(this,ec,"f")),Oe(this,ec,setTimeout(()=>{let f;try{f=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}U(this,Tt,"m",Mh).call(this,f,l),U(this,Tt,"m",Lh).call(this,f,l)},0),"f")}getConvertedRegion(){return U(this,Ah,"f")}setScanRegion(a){if(null!=a&&!sm(a)&&!xr(a))throw TypeError("Invalid 'region'.");let l;this.scanRegion=a?JSON.parse(JSON.stringify(a)):null;try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}this.updateConvertedRegion(l)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(a){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const l=U(this,rn,"f").videoWidth,f=U(this,rn,"f").videoHeight,g=this.getVideoFit(),{width:p,height:_}=this._innerComponent.getBoundingClientRect();if(p<=0||_<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let C;const b={x:0,y:0,width:l,height:f,isMeasuredInPercentage:!1};if("cover"===g&&(p/_<l/f?(C=_/f,b.x=Math.floor((l-p/C)/2),b.y=0,b.width=Math.ceil(p/C),b.height=f):(C=p/l,b.x=0,b.y=Math.floor((f-_/C)/2),b.width=l,b.height=Math.ceil(_/C))),null==a?void 0:a.inPixels)return b;const O=b;return O.x=Math.ceil(O.x/f*100),O.y=Math.ceil(O.y/l*100),O.width=Math.floor(O.width/l*100),O.height=Math.floor(O.height/f*100),O.isMeasuredInPercentage=!0,b}setScanRegionMask(a,l,f,g){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||U(this,Tt,"m",gm).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=ye.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=ye.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const p=this._drawingLayerOfMask.width,_=this._drawingLayerOfMask.height,C=new aa({x:0,y:0,width:p,height:_},this._maskBackRectStyleId),b=new aa({x:-p/2,y:-_/2+l,width:a,height:g}),O=new aa({x:-p/2+a+f,y:-_/2+l,width:p-a-f<0?0:p-a-f,height:g}),M=new aa({x:-p/2,y:-_/2,width:p,height:l}),P=new aa({x:-p/2,y:-_/2+l+g,width:p,height:_-l-g<0?0:_-l-g});b.set("strokeWidth",0),O.set("strokeWidth",0),M.set("strokeWidth",0),P.set("strokeWidth",0);const k=new C2([b,O,M,P])._getFabricObject();C.set("clipPath",k);const j=new aa({x:a,y:l,width:f,height:g},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([C,j])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(a){Oe(this,Rh,a,"f"),a?U(this,Tt,"m",ND).call(this):U(this,Tt,"m",gm).call(this)}setScanRegionMaskVisible(a){this._setScanRegionMaskVisible(a),this._userSetMaskVisible=a}isScanRegionMaskVisible(){return U(this,Rh,"f")}setScanRegionMaskStyle(a){if(!a)return;let l;a.fillStyle&&(this.regionMaskFillStyle=a.fillStyle),a.strokeStyle&&(this.regionMaskStrokeStyle=a.strokeStyle),a.lineWidth&&(this.regionMaskLineWidth=a.lineWidth),this._maskBackRectStyleId&&ye.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&ye.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{l=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}U(this,Tt,"m",Mh).call(this,l,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(a){Oe(this,Oh,a,"f"),a?U(this,Tt,"m",pm).call(this):U(this,Tt,"m",ic).call(this)}setScanLaserVisible(a){this._setScanLaserVisible(a),this._userSetLaserVisible=a}isScanLaserVisible(){return U(this,Oh,"f")}_updateVideoContainer(){if(!U(this,rn,"f")||U(this,Tt,"m",ii).call(this))return;let a=1;const l=U(this,rn,"f").style.transform.match(/scale\((.+)\)/);l&&(a=parseFloat(l[1]));const f=this._videoContainer;if("contain"===this.videoFit&&a>1){const g=U(this,rn,"f").videoWidth,p=U(this,rn,"f").videoHeight,{width:_,height:C}=this._innerComponent.getBoundingClientRect(),b=g/p;if(_/C<b){let O=_/b;f.style.left="0",f.style.top=(C-O)/2/C*100+"%",f.style.width="100%",f.style.height=O/C*100+"%"}else{let O=C*b;f.style.left=(_-O)/2/_*100+"%",f.style.top="0",f.style.width=O/_*100+"%",f.style.height="100%"}}else f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%"}updateLayers(){let a;this._updateVideoContainer();try{a=this.getContentDimensions()}catch(f){if("Invalid content dimensions."===(f.message||f))return;throw f}const l=this.getConvertedRegion();U(this,Tt,"m",Lh).call(this,a,l),this.updateDrawingLayers(a),U(this,Tt,"m",Mh).call(this,a,l)}clearAllInnerDrawingItems(){U(this,nc,"f").forEach(a=>a.remove()),U(this,nc,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let a in this)delete this[a];Object.defineProperty(this,"disposed",{value:!0})}}function Z(u,a,l,f){if("a"===l&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?u!==a||!f:!a.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?f:"a"===l?f.call(u):f?f.value:a.get(u)}function ht(u,a,l,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?u!==a||!g:!a.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(u,l):g?g.value=l:a.set(u,l),l}Ql=new WeakMap,Jl=new WeakMap,ec=new WeakMap,rn=new WeakMap,Ah=new WeakMap,Rh=new WeakMap,Oh=new WeakMap,ys=new WeakMap,tc=new WeakMap,nc=new WeakMap,fm=new WeakMap,Tt=new WeakSet,ii=function(){return"disabled"!==this._singleFrameMode},Mh=function(u,a){!a||0===a.x&&0===a.y&&a.width===u.width&&a.height===u.height?this.clearScanRegionMask():this.setScanRegionMask(a.x,a.y,a.width,a.height)},ND=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},gm=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},pm=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},ic=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Lh=function(u,a){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:l,height:f,objectFit:g}=u;a||(a={x:0,y:0,width:l,height:f});const{width:p,height:_}=this._innerComponent.getBoundingClientRect();if(p<=0||_<=0)return;const C=p/_,b=l/f;let O,M,P,k,j=1;if("contain"===g)C<b?(j=p/l,O=0,M=(_-f*j)/2):(j=_/f,O=(p-l*j)/2,M=0),O+=a.x*j,M+=a.y*j,P=a.width*j,k=a.height*j;else if("cover"===g)if(C<b){j=_/f,O=a.x*j-(l*j-p)/2,O=Math.max(O,0),O=Math.min(O,p),M=a.y*j;let G=(a.x+a.width)*j-(l*j-p)/2;G=Math.max(G,0),G=Math.min(G,p),P=G-O,k=a.height*j}else{j=p/l,O=a.x*j,M=a.y*j-(f*j-_)/2,M=Math.max(M,0),M=Math.min(M,_);let G=(a.y+a.height)*j-(f*j-_)/2;G=Math.max(G,0),G=Math.min(G,_),P=a.width*j,k=G-M}else O=0,M=0,P=0,k=0;this._divScanArea.style.left=O+"px",this._divScanArea.style.top=M+"px",this._divScanArea.style.width=P+"px",this._divScanArea.style.height=k+"px"},Kt.uiComponentName="default-camera-view",Kt._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const kD="undefined"==typeof self;let rc,sc,Fh,_m,Rn;function kn(u,a,l,f){if("a"===l&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?u!==a||!f:!a.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?f:"a"===l?f.call(u):f?f.value:a.get(u)}function Vi(u,a,l,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?u!==a||!g:!a.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(u,l):g?g.value=l:a.set(u,l),l}"undefined"!=typeof navigator&&(rc=navigator,sc=rc.userAgent,Fh=rc.platform,_m=rc.mediaDevices),function(){if(!kD){const u={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:rc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},a={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Fh,search:"Win"},Mac:{str:Fh},Linux:{str:Fh}};let l="unknownBrowser",f=0,g="unknownOS";for(let p in u){const _=u[p]||{};let O=_.verStr||sc,M=_.verSearch||p;if(M instanceof Array||(M=[M]),-1!=(_.str||sc).indexOf(_.search||p)){l=p;for(let P of M){let k=O.indexOf(P);if(-1!=k){f=parseFloat(O.substring(k+P.length+1));break}}break}}for(let p in a){const _=a[p]||{};if(-1!=(_.str||sc).indexOf(_.search||p)){g=p;break}}"Linux"==g&&-1!=sc.indexOf("Windows NT")&&(g="HarmonyOS"),Rn={browser:l,version:f,OS:g}}kD&&(Rn={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let Rr=class{static multiply(a,l){const f=[];for(let g=0;g<3;g++){const p=l.slice(3*g,3*g+3);for(let _=0;_<3;_++){const C=[a[_],a[_+3],a[_+6]].reduce((b,O,M)=>b+O*p[M],0);f.push(C)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(a,l,f){return Ze.multiply(a,[1,0,0,0,1,0,l,f,1])}static rotate(a,l){var f=Math.cos(l),g=Math.sin(l);return Ze.multiply(a,[f,-g,0,g,f,0,0,0,1])}static scale(a,l,f){return Ze.multiply(a,[l,0,0,0,f,0,0,0,1])}};var dt,Or,Mr,Ph,da,oc,ac,fa,Nh,Ks,kh,vm,Le,Qe,pt,Bh,jh,St,Ei,Lr,ga,Uh,ar,Fr,ri,pa,ma,lc,Vh,_a,Qs,Pr,Nr,ym,sn,Cm,Js,BD,Hh,Gh,jD,Hi,wm,Em,va,cc,Wh,si,ya,bm,Dm,UD;!function(u){u.GREY="grey",u.GREY32="grey32",u.RGBA="rgba",u.RBGA="rbga",u.GRBA="grba",u.GBRA="gbra",u.BRGA="brga",u.BGRA="bgra"}(dt||(dt={}));class ze{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Vi(ze,Or,!1,"f",Mr),!1):(Vi(ze,Or,!0,"f",Mr),!0)}get disposed(){return kn(this,Nh,"f")}constructor(){Ph.set(this,dt.RGBA),da.set(this,null),oc.set(this,null),ac.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,fa.set(this,null),Nh.set(this,!1)}drawImage(a,l,f,g,p,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==kn(ze,Or,"f",Mr)&&ze.checkWebGLSupport(),(null==_?void 0:_.bUseWebGL)&&!kn(ze,Or,"f",Mr))throw new Error("Your browser or machine may not support WebGL.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let C;ze._onLog&&(C=Date.now(),ze._onLog("drawImage(), START: "+C));let b=0,O=0,M=f,P=g,k=0,j=0,G=f,z=g;p&&(p.sx&&(b=Math.round(p.sx)),p.sy&&(O=Math.round(p.sy)),p.sWidth&&(M=Math.round(p.sWidth)),p.sHeight&&(P=Math.round(p.sHeight)),p.dx&&(k=Math.round(p.dx)),p.dy&&(j=Math.round(p.dy)),p.dWidth&&(G=Math.round(p.dWidth)),p.dHeight&&(z=Math.round(p.dHeight)));let Y,X=dt.RGBA;if((null==_?void 0:_.pixelFormat)&&(X=_.pixelFormat),(null==_?void 0:_.bufferContainer)&&(Y=_.bufferContainer,Y.length<4*G*z))throw new Error("Unexpected size of the 'bufferContainer'.");const $=a;if(!kn(ze,Or,"f",Mr)||!(this.useWebGLByDefault&&null==(null==_?void 0:_.bUseWebGL)||(null==_?void 0:_.bUseWebGL))){ze._onLog&&ze._onLog("drawImage() in context2d."),$.ctx2d||($.ctx2d=$.getContext("2d",{willReadFrequently:!0}));const K=$.ctx2d;if(!K)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return($.width<k+G||$.height<j+z)&&($.width=k+G,$.height=j+z),K.drawImage(l,b,O,M,P,k,j,G,z),ze._onLog&&ze._onLog("drawImage() in context2d end. Costs: "+(Date.now()-C)),{context:K,pixelFormat:dt.RGBA,bUseWebGL:!1}}ze._onLog&&ze._onLog("drawImage() in WebGL.");try{($.width<k+G||$.height<j+z)&&($.width=k+G,$.height=j+z,$.ctxWebGL&&$.ctxWebGL.viewport(0,0,k+G,j+z));const K=$.ctxWebGL||$.getContext("webgl",{antialias:!1})||$.getContext("experimental-webgl",{antialias:!1});if(!K){ze._onLog&&ze._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const F=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw F.name="WebGLError",F}if(!$.ctxWebGL||X!==kn(this,Ph,"f")){$.ctxWebGL=K;const F=m=>{const v=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,v),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),m.STATIC_DRAW);const T=m.createBuffer();return m.bindBuffer(m.ARRAY_BUFFER,T),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),m.STATIC_DRAW),{positions:v,texCoords:T}},Ce=m=>{const v=m.createTexture();return m.bindTexture(m.TEXTURE_2D,v),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),v},Ne=(m,v)=>{const T=m.createProgram();if(v.forEach(A=>m.attachShader(T,A)),m.linkProgram(T),!m.getProgramParameter(T,m.LINK_STATUS)){const A=new Error(`An error occured linking the program: ${m.getProgramInfoLog(T)}.`);throw A.name="WebGLError",A}return m.useProgram(T),T},Ke=(m,v,T)=>{const A=m.createShader(v);if(m.shaderSource(A,T),m.compileShader(A),!m.getShaderParameter(A,m.COMPILE_STATUS)){const S=new Error(`An error occured compiling the shader: ${m.getShaderInfoLog(A)}.`);throw S.name="WebGLError",S}return A},D="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let y="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(X)&&(y=X.slice(0,3));const w=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${y} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,I=Ne(K,[Ke(K,K.VERTEX_SHADER,D),Ke(K,K.FRAGMENT_SHADER,w)]);Vi(this,oc,{program:I,attribLocations:{vertexPosition:K.getAttribLocation(I,"a_position"),texPosition:K.getAttribLocation(I,"a_texCoord")},uniformLocations:{uSampler:K.getUniformLocation(I,"u_image"),uColorFactor:K.getUniformLocation(I,"uColorFactor"),uMatrix:K.getUniformLocation(I,"u_matrix"),uTextureMatrix:K.getUniformLocation(I,"u_textureMatrix")}},"f"),Vi(this,ac,F(K),"f"),Vi(this,da,Ce(K),"f"),Vi(this,Ph,X,"f")}const ge=(F,Ce,Ne)=>{F.bindBuffer(F.ARRAY_BUFFER,Ce),F.enableVertexAttribArray(Ne),F.vertexAttribPointer(Ne,2,F.FLOAT,!1,0,0)},Te=(F,Ce,Ne,Ke)=>{F.clearColor(0,0,0,1),F.clearDepth(1),F.enable(F.DEPTH_TEST),F.depthFunc(F.LEQUAL),F.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),ge(F,Ne.positions,Ce.attribLocations.vertexPosition),ge(F,Ne.texCoords,Ce.attribLocations.texPosition),F.activeTexture(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,Ke),F.uniform1i(Ce.uniformLocations.uSampler,0),F.uniform1f(Ce.uniformLocations.uColorFactor,[dt.GREY,dt.GREY32].includes(X)?1:0);let D,y,w=Rr.translate(Rr.identity(),-1,-1);w=Rr.scale(w,2,2),w=Rr.scale(w,1/F.canvas.width,1/F.canvas.height),D=Rr.translate(w,k,j),D=Rr.scale(D,G,z),F.uniformMatrix3fv(Ce.uniformLocations.uMatrix,!1,D),y=Rr.translate(Rr.identity(),b/f,O/g),y=Rr.scale(y,M/f,P/g),F.uniformMatrix3fv(Ce.uniformLocations.uTextureMatrix,!1,y),F.drawArrays(F.TRIANGLES,0,6)};((F,Ce,Ne)=>{const Ke=F.RGBA,D=F.RGBA,y=F.UNSIGNED_BYTE;F.bindTexture(F.TEXTURE_2D,Ce),F.texImage2D(F.TEXTURE_2D,0,Ke,D,y,Ne)})(K,kn(this,da,"f"),l),Te(K,kn(this,oc,"f"),kn(this,ac,"f"),kn(this,da,"f"));const Se=Y||new Uint8Array(4*G*z);if(K.readPixels(k,j,G,z,K.RGBA,K.UNSIGNED_BYTE,Se),255!==Se[3]){ze._onLog&&ze._onLog("Incorrect WebGL drawing .");const F=new Error("WebGL error: incorrect drawing.");throw F.name="WebGLError",F}return ze._onLog&&ze._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-C)),{context:K,pixelFormat:X===dt.GREY?dt.GREY32:X,bUseWebGL:!0}}catch(K){if(this.forceLoseContext(),null==(null==_?void 0:_.bUseWebGL))return ze._onLog&&ze._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(a,l,f,g,p,Object.assign({},_,{bUseWebGL:!1}));throw K.name="WebGLError",K}}readCvsData(a,l,f){if(!(a instanceof CanvasRenderingContext2D||a instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,p=0,_=0,C=a.canvas.width,b=a.canvas.height;if(l&&(l.x&&(p=l.x),l.y&&(_=l.y),l.width&&(C=l.width),l.height&&(b=l.height)),(null==f?void 0:f.length)<4*C*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(a instanceof WebGLRenderingContext){const O=a;f?(O.readPixels(p,_,C,b,O.RGBA,O.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*C*b)):(g=new Uint8Array(4*C*b),O.readPixels(p,_,C,b,O.RGBA,O.UNSIGNED_BYTE,g))}else if(a instanceof CanvasRenderingContext2D){let O;O=a.getImageData(p,_,C,b),g=new Uint8Array(O.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(a,l,f,g){let p,_;if(ze._onLog&&(p=Date.now(),ze._onLog("transformPixelFormat(), START: "+p)),l===f)return ze._onLog&&ze._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),g?new Uint8Array(a):a;const C=[dt.RGBA,dt.RBGA,dt.GRBA,dt.GBRA,dt.BRGA,dt.BGRA];if(C.includes(l))if(f===dt.GREY){_=new Uint8Array(a.length/4);for(let b=0;b<a.length;b+=4)_[b/4]=.21*a[b]+.71*a[b+1]+.07*a[b+2]}else if(f===dt.GREY32){_=g?new Uint8Array(a):a;for(let b=0;b<a.length;b+=4){const O=.21*a[b]+.71*a[b+1]+.07*a[b+2];_[b]=O,_[b+1]=O,_[b+2]=O}}else{if(!C.includes(f))throw new Error("Unable to transform.");if(g){_=new Uint8Array(a);const b=l.indexOf("r"),O=l.indexOf("g"),M=l.indexOf("b"),P=f.indexOf("r"),k=f.indexOf("g"),j=f.indexOf("b");for(let G=0;G<a.length;G+=4)_[G+P]=a[G+b],_[G+k]=a[G+O],_[G+j]=a[G+M]}else{_=a;const b=l.indexOf("r"),O=l.indexOf("g"),M=l.indexOf("b"),P=f.indexOf("r"),k=f.indexOf("g"),j=f.indexOf("b");for(let G=0;G<a.length;G+=4){let z=[a[G],a[G+1],a[G+2]];_[G+P]=z[b],_[G+k]=z[O],_[G+j]=z[M]}}}else if(l===dt.GREY){if(f!==dt.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*a.length);for(let b=0;b<a.length;b++)_[4*b]=a[b],_[4*b+1]=a[b],_[4*b+2]=a[b],_[4*b+3]=255}else{if(l!==dt.GREY32)throw new Error("Unable to transform.");if(f!==dt.GREY)throw new Error("Unable to transform.");_=new Uint8Array(a.length/4);for(let b=0;b<a.length;b+=4)_[b/4]=a[b]}return ze._onLog&&ze._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),_}getImageData(a,l,f,g,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!l||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==kn(ze,Or,"f",Mr)&&ze.checkWebGLSupport(),(null==p?void 0:p.bUseWebGL)&&!kn(ze,Or,"f",Mr))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>l||g.sy>f||g.sx+g.sWidth>l||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(a instanceof HTMLVideoElement&&4!==a.readyState||a instanceof HTMLImageElement&&!a.complete)throw new Error("The source is not loaded.");let _;ze._onLog&&(_=Date.now(),ze._onLog("getImageData(), START: "+_));const C=Math.round(g.sx),b=Math.round(g.sy),O=Math.round(g.sWidth),M=Math.round(g.sHeight),P=Math.round(g.dWidth),k=Math.round(g.dHeight);let j=dt.RGBA;(null==p?void 0:p.pixelFormat)&&(j=p.pixelFormat);let G,z,Y,X=null;if((null==p?void 0:p.bufferContainer)&&(X=p.bufferContainer),kn(ze,Or,"f",Mr)&&(this.useWebGLByDefault&&null==(null==p?void 0:p.bUseWebGL)||(null==p?void 0:p.bUseWebGL))){ze._onLog&&ze._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),G=this._reusedWebGLCvs;try{if(X)if(j===dt.GREY){if(Y=new Uint8Array(4*P*k),z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Y}),Y=this.transformPixelFormat(Y,z.pixelFormat,j),X){if(X.length<Y.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(Y)}}else z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:X}),Y=new Uint8Array(X.buffer,0,4*P*k),Y=this.transformPixelFormat(Y,z.pixelFormat,j);else j===dt.GREY?((!kn(this,fa,"f")||kn(this,fa,"f").length<4*P*k)&&Vi(this,fa,new Uint8Array(4*P*k),"f"),Y=new Uint8Array(kn(this,fa,"f").buffer,0,4*P*k)):Y=new Uint8Array(4*P*k),z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Y}),Y=this.transformPixelFormat(Y,z.pixelFormat,j)}catch($){if("WebGLError"===$.name&&(this.forceLoseContext(),null==(null==p?void 0:p.bUseWebGL)))return ze._onLog&&ze._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},Object.assign({},p,{bUseWebGL:!1}));throw $}}else if(ze._onLog&&ze._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),G=this._reusedCvs,z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:dt.RGBA,bUseWebGL:!1}),Y=this.readCvsData(z.context,{width:P,height:k},null),Y=this.transformPixelFormat(Y,z.pixelFormat,j),X){if(X.length<Y.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(Y)}return ze._onLog&&ze._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:Y,pixelFormat:j,width:P,height:k,bUseWebGL:z.bUseWebGL}}convertDataToCvs(a,l,f,g){if(!(a instanceof Uint8Array||a instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof l||l<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const p=document.createElement("canvas");let _;if(p.width=l,p.height=f,g===dt.GREY){_=new Uint8ClampedArray(4*l*f);for(let b=0;b<_.length;b+=4)_[b]=a[b/4],_[b+1]=a[b/4],_[b+2]=a[b/4],_[b+3]=255}else _=new Uint8ClampedArray(a.buffer);const C=new ImageData(_,l,f);return p.getContext("2d").putImageData(C,0,0),p}forceLoseContext(){if(!this._reusedWebGLCvs)return;const a=this._reusedWebGLCvs.ctxWebGL;a&&!a.isContextLost()&&a.getExtension("WEBGL_lose_context")&&a.getExtension("WEBGL_lose_context").loseContext(),Vi(this,da,null,"f"),Vi(this,oc,null,"f"),Vi(this,ac,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Vi(this,Nh,!0,"f")}}Or=ze,Ph=new WeakMap,da=new WeakMap,oc=new WeakMap,ac=new WeakMap,fa=new WeakMap,Nh=new WeakMap,Mr={value:void 0};class D2{constructor(){Ks.set(this,new Map),kh.set(this,!1)}get disposed(){return Z(this,kh,"f")}on(a,l){a=a.toLowerCase();const f=Z(this,Ks,"f").get(a);if(f){if(f.includes(l))return;f.push(l)}else Z(this,Ks,"f").set(a,[l])}off(a,l){a=a.toLowerCase();const f=Z(this,Ks,"f").get(a);if(!f)return;const g=f.indexOf(l);-1!==g&&f.splice(g,1)}offAll(a){a=a.toLowerCase();const l=Z(this,Ks,"f").get(a);l&&(l.length=0)}fire(a,l=[],f={async:!1,copy:!0}){var g=this;return ae(function*(){l||(l=[]),a=a.toLowerCase();const p=Z(g,Ks,"f").get(a);if(p&&p.length){f=Object.assign({async:!1,copy:!0},f);for(let _ of p){if(!_)continue;let C=[];if(f.copy)for(let O of l){try{O=JSON.parse(JSON.stringify(O))}catch(M){}C.push(O)}else C=l;let b=!1;if(f.async)setTimeout(()=>{g.disposed||_.apply(f.target,C)},0);else try{b=_.apply(f.target,C)}catch(O){}if(!0===b)break}}})()}dispose(){ht(this,kh,!0,"f")}}Ks=new WeakMap,kh=new WeakMap;const Wn=(u,a,l,f)=>{if(!l)return u;let g=a+Math.round((u-a)/l)*l;return f&&(g=Math.min(g,f)),g};class He{static get version(){return"2.0.7"}static isStorageAvailable(a){let l;try{l=window[a];const f="__storage_test__";return l.setItem(f,f),l.removeItem(f),!0}catch(f){return f instanceof DOMException&&(22===f.code||1014===f.code||"QuotaExceededError"===f.name||"NS_ERROR_DOM_QUOTA_REACHED"===f.name)&&l&&0!==l.length}}static findBestRearCameraInIOS(a,l){if(!a||!a.length)return null;let f=!1;if((null==l?void 0:l.getMainCamera)&&(f=!0),f){const g=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],p=a.find(_=>g.includes(_.label.toLowerCase()));return null==p?void 0:p.deviceId}{const g=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],p=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],_=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],C=a.filter(M=>{const P=M.label.toLowerCase();return g.some(k=>P.includes(k))});if(!C.length)return null;const b=C.find(M=>{const P=M.label.toLowerCase();return p.some(k=>P.includes(k))});if(b)return b.deviceId;const O=C.find(M=>{const P=M.label.toLowerCase();return _.some(k=>P.includes(k))});return O?O.deviceId:C[0].deviceId}}static findBestRearCamera(a,l){if(!a||!a.length)return null;if(["iPhone","iPad","Mac"].includes(Rn.OS))return He.findBestRearCameraInIOS(a,{getMainCamera:null==l?void 0:l.getMainCameraInIOS});const f=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let g of a){const p=g.label.toLowerCase();if(p&&f.some(_=>p.includes(_))&&/\b0(\b)?/.test(p))return g.deviceId}return["Android","HarmonyOS"].includes(Rn.OS)?a[a.length-1].deviceId:null}static findBestCamera(a,l,f){return a&&a.length?"environment"===l?this.findBestRearCamera(a,f):"user"===l?null:l?void 0:null:null}static playVideo(a,l,f){return ae(function*(){if(!a)throw new Error("Invalid 'videoEl'.");if(!l)throw new Error("Invalid 'source'.");return new Promise(function(){var g=ae(function*(p,_){let C;const b=()=>{a.removeEventListener("loadstart",k),a.removeEventListener("abort",j),a.removeEventListener("play",G),a.removeEventListener("error",z),a.removeEventListener("loadedmetadata",$)};let O=!1;const M=()=>{O=!0,C&&clearTimeout(C),b(),p(a)},P=K=>{C&&clearTimeout(C),b(),_(K)},k=()=>{a.addEventListener("abort",j,{once:!0})},j=()=>{const K=new Error("Video playing was interrupted.");K.name="AbortError",P(K)},G=()=>{M()},z=()=>{P(new Error(`Video error ${a.error.code}: ${a.error.message}.`))};let Y;const X=new Promise(K=>{Y=K}),$=()=>{Y()};if(a.addEventListener("loadstart",k,{once:!0}),a.addEventListener("play",G,{once:!0}),a.addEventListener("error",z,{once:!0}),a.addEventListener("loadedmetadata",$,{once:!0}),"string"==typeof l||l instanceof String?a.src=l:a.srcObject=l,a.autoplay&&(yield new Promise(K=>{setTimeout(K,1e3)})),!O){f&&(C=setTimeout(()=>{b(),_(new Error("Failed to play video. Timeout."))},f));try{a.src&&(yield a.load()),yield a.play(),M()}catch(K){console.warn("1st play error: "+((null==K?void 0:K.message)||K))}if(!O){yield X;try{yield a.play(),M()}catch(K){console.warn("2rd play error: "+((null==K?void 0:K.message)||K)),P(K)}}}});return function(p,_){return g.apply(this,arguments)}}())})()}static testCameraAccess(a){return ae(function*(){var l,f;if(!(null===(f=null===(l=null==window?void 0:window.navigator)||void 0===l?void 0:l.mediaDevices)||void 0===f?void 0:f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=a?yield navigator.mediaDevices.getUserMedia(a):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(p){return{ok:!1,errorName:p.name,errorMessage:p.message}}finally{null==g||g.getTracks().forEach(p=>{p.stop()})}return{ok:!0}})()}get state(){if(!Z(this,ri,"f"))return"closed";if("pending"===Z(this,ri,"f"))return"opening";if("fulfilled"===Z(this,ri,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(a){a?He.isStorageAvailable("localStorage")?ht(this,ga,!0,"f"):(ht(this,ga,!1,"f"),console.warn("Local storage is unavailable")):ht(this,ga,!1,"f")}get ifSaveLastUsedCamera(){return Z(this,ga,"f")}get isVideoPlaying(){return!(!Z(this,Qe,"f")||Z(this,Qe,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(a){var l,f,g;if(!(a instanceof HTMLElement)&&null!=a)throw new TypeError("Invalid 'element'.");null===(l=Z(this,Qs,"f"))||void 0===l||l.removeEventListener("click",Z(this,_a,"f")),null===(f=Z(this,Qs,"f"))||void 0===f||f.removeEventListener("touchend",Z(this,_a,"f")),null===(g=Z(this,Qs,"f"))||void 0===g||g.removeEventListener("touchmove",Z(this,Vh,"f")),ht(this,Qs,a,"f"),a&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Rn.OS)?(a.addEventListener("touchend",Z(this,_a,"f")),a.addEventListener("touchmove",Z(this,Vh,"f"))):a.addEventListener("click",Z(this,_a,"f")))}get tapFocusEventBoundEl(){return Z(this,Qs,"f")}get disposed(){return Z(this,Gh,"f")}constructor(a){var f,g,l=this;Le.add(this),Qe.set(this,null),pt.set(this,void 0),Bh.set(this,()=>{"opened"===this.state&&Z(this,sn,"f").fire("resumed",null,{target:this,async:!1})}),jh.set(this,()=>{Z(this,sn,"f").fire("paused",null,{target:this,async:!1})}),St.set(this,void 0),Ei.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],Lr.set(this,void 0),ga.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Uh.set(this,void 0),ar.set(this,!0),Fr.set(this,void 0),ri.set(this,void 0),pa.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},ma.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(p,_)=>{let C,b;const O=window.getComputedStyle(Z(this,Qe,"f")).objectFit,M=this.getResolution(),P=Z(this,Qe,"f").getBoundingClientRect(),k=P.left,j=P.top,{width:G,height:z}=Z(this,Qe,"f").getBoundingClientRect();if(G<=0||z<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const Y=G/z,X=M.width/M.height;let $=1;if("contain"===O)X>Y?($=G/M.width,C=(p-k)/$,b=(_-j-(z-G/X)/2)/$):($=z/M.height,b=(_-j)/$,C=(p-k-(G-z*X)/2)/$);else{if("cover"!==O)throw new Error("Unsupported object-fit.");X>Y?($=z/M.height,b=(_-j)/$,C=(p-k+(z*X-G)/2)/$):($=G/M.width,C=(p-k)/$,b=(_-j+(G/X-z)/2)/$)}return{x:C,y:b}},lc.set(this,!1),Vh.set(this,()=>{ht(this,lc,!0,"f")}),_a.set(this,function(){var p=ae(function*(_){var C;if(Z(l,lc,"f"))return void ht(l,lc,!1,"f");if(!(Z(l,ma,"f")&&l.isVideoPlaying&&Z(l,pt,"f")&&l._focusSupported))return;if(!l._focusParameters.fds&&(l._focusParameters.fds=null===(C=l.getCameraCapabilities())||void 0===C?void 0:C.focusDistance,!l._focusParameters.fds))return void(l._focusSupported=!1);if(null==l._focusParameters.kTimeout&&(l._focusParameters.kTimeout=(l._focusParameters.maxTimeout-l._focusParameters.minTimeout)/(1/l._focusParameters.fds.min-1/l._focusParameters.fds.max)),1==l._focusParameters.isDoingFocus)return;let b,O;if(l._focusParameters.taskBackToContinous&&(clearTimeout(l._focusParameters.taskBackToContinous),l._focusParameters.taskBackToContinous=null),_ instanceof MouseEvent)b=_.clientX,O=_.clientY;else{if(!(_ instanceof TouchEvent))throw new Error("Unknown event type.");if(!_.changedTouches.length)return;b=_.changedTouches[0].clientX,O=_.changedTouches[0].clientY}const M=l.getResolution(),P=2*Math.round(Math.min(M.width,M.height)/l._focusParameters.defaultFocusAreaSizeRatio/2);let k;try{k=l.calculateCoordInVideo(b,O)}catch(X){}if(k.x<0||k.x>M.width||k.y<0||k.y>M.height)return;const j={x:k.x+"px",y:k.y+"px"},G=P+"px",z=G;let Y;He._onLog&&(Y=Date.now());try{yield Z(l,Le,"m",bm).call(l,j,G,z,l._focusParameters.tapFocusMinDistance,l._focusParameters.tapFocusMaxDistance)}catch(X){if(He._onLog)throw He._onLog(X),X}He._onLog&&He._onLog(`Tap focus costs: ${Date.now()-Y} ms`),l._focusParameters.taskBackToContinous=setTimeout(()=>{var X;He._onLog&&He._onLog("Back to continuous focus."),null===(X=Z(l,pt,"f"))||void 0===X||X.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},l._focusParameters.focusBackToContinousTime),Z(l,sn,"f").fire("tapfocus",null,{target:l,async:!1})});return function(_){return p.apply(this,arguments)}}()),Qs.set(this,null),Pr.set(this,1),Nr.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!Z(this,Qe,"f"))return;const p=Z(this,Pr,"f");if(p<1)throw new RangeError("Invalid scale value.");if(1===p)Z(this,Qe,"f").style.transform="";else{const _=window.getComputedStyle(Z(this,Qe,"f")).objectFit,C=Z(this,Qe,"f").videoWidth,b=Z(this,Qe,"f").videoHeight,{width:O,height:M}=Z(this,Qe,"f").getBoundingClientRect();if(O<=0||M<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const P=O/M,k=C/b;let j=1;"contain"===_?j=P<k?O/(C/p):M/(b/p):"cover"===_&&(j=k>P?M/(C/p):O/(b/p));const G=j*(1-1/p)*(C/2-Z(this,Nr,"f").x),z=j*(1-1/p)*(b/2-Z(this,Nr,"f").y);Z(this,Qe,"f").style.transform=`translate(${G}px, ${z}px) scale(${p})`}},ym.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const p=document.createElement("canvas");let _;if(p.width=this.width,p.height=this.height,this.pixelFormat===dt.GREY){_=new Uint8ClampedArray(this.width*this.height*4);for(let b=0;b<_.length;b+=4)_[b]=this.data[b/4],_[b+1]=this.data[b/4],_[b+2]=this.data[b/4],_[b+3]=255}else _=new Uint8ClampedArray(this.data.buffer);const C=new ImageData(_,this.width,this.height);return p.getContext("2d").putImageData(C,0,0),p}),sn.set(this,void 0),Cm.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Js.set(this,new Map),BD.set(this,!1),Hh.set(this,ae(function*(){var p,_;if("visible"===document.visibilityState){if(He._onLog&&He._onLog("document visible. video paused: "+(null===(p=Z(l,Qe,"f"))||void 0===p?void 0:p.paused)),"opening"==l.state||"opened"==l.state){let C=!1;if(!l.isVideoPlaying){He._onLog&&He._onLog("document visible. Not auto resume. 1st resume start.");try{yield l.resume(),C=!0}catch(b){He._onLog&&He._onLog("document visible. 1st resume video failed, try open instead.")}C||(yield Z(l,Le,"m",va).call(l))}if(yield new Promise(b=>setTimeout(b,300)),!l.isVideoPlaying){He._onLog&&He._onLog("document visible. 1st open failed. 2rd resume start."),C=!1;try{yield l.resume(),C=!0}catch(b){He._onLog&&He._onLog("document visible. 2rd resume video failed, try open instead.")}C||(yield Z(l,Le,"m",va).call(l))}}}else"hidden"===document.visibilityState&&(He._onLog&&He._onLog("document hidden. video paused: "+(null===(_=Z(l,Qe,"f"))||void 0===_?void 0:_.paused)),"opening"==l.state||"opened"==l.state&&l.isVideoPlaying&&l.pause())})),Gh.set(this,!1),(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia)||setTimeout(()=>{He.onWarning&&He.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),a instanceof HTMLVideoElement&&this.setVideoEl(a),ht(this,sn,new D2,"f"),this.imageDataGetter=new ze,document.addEventListener("visibilitychange",Z(this,Hh,"f"))}setVideoEl(a){if(!(a&&a instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");a.addEventListener("play",Z(this,Bh,"f")),a.addEventListener("pause",Z(this,jh,"f")),ht(this,Qe,a,"f")}getVideoEl(){return Z(this,Qe,"f")}releaseVideoEl(){var a,l;null===(a=Z(this,Qe,"f"))||void 0===a||a.removeEventListener("play",Z(this,Bh,"f")),null===(l=Z(this,Qe,"f"))||void 0===l||l.removeEventListener("pause",Z(this,jh,"f")),ht(this,Qe,null,"f")}isVideoLoaded(){return!!Z(this,Qe,"f")&&4==Z(this,Qe,"f").readyState}open(){var a=this;return ae(function*(){if(Z(a,Fr,"f")&&!Z(a,ar,"f")){if("pending"===Z(a,ri,"f"))return Z(a,Fr,"f");if("fulfilled"===Z(a,ri,"f"))return}Z(a,sn,"f").fire("before:open",null,{target:a}),yield Z(a,Le,"m",va).call(a),Z(a,sn,"f").fire("played",null,{target:a,async:!1}),Z(a,sn,"f").fire("opened",null,{target:a,async:!1})})()}close(){var a=this;return ae(function*(){if("closed"===a.state)return;Z(a,sn,"f").fire("before:close",null,{target:a});const l=Z(a,Fr,"f");if(Z(a,Le,"m",Wh).call(a),l&&"pending"===Z(a,ri,"f")){try{yield l}catch(f){}if(!1===Z(a,ar,"f")){const f=new Error("'close()' was interrupted.");throw f.name="AbortError",f}}ht(a,Fr,null,"f"),ht(a,ri,null,"f"),Z(a,sn,"f").fire("closed",null,{target:a,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");Z(this,Qe,"f").pause()}resume(){var a=this;return ae(function*(){if(!a.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==a.state)throw new Error("Camera or video is not open.");yield Z(a,Qe,"f").play()})()}setCamera(a){var l=this;return ae(function*(){if("string"!=typeof a)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof Z(l,St,"f").video&&(Z(l,St,"f").video={}),delete Z(l,St,"f").video.facingMode,Z(l,St,"f").video.deviceId={exact:a},!("closed"===l.state||l.videoSrc||"opening"===l.state&&Z(l,ar,"f"))){Z(l,sn,"f").fire("before:camera:change",[],{target:l,async:!1}),yield Z(l,Le,"m",cc).call(l);try{l.resetSoftwareScale()}catch(f){}return Z(l,Ei,"f")}})()}switchToFrontCamera(a){var l=this;return ae(function*(){if("object"!=typeof Z(l,St,"f").video&&(Z(l,St,"f").video={}),(null==a?void 0:a.resolution)&&(Z(l,St,"f").video.width={ideal:a.resolution.width},Z(l,St,"f").video.height={ideal:a.resolution.height}),delete Z(l,St,"f").video.deviceId,Z(l,St,"f").video.facingMode={exact:"user"},ht(l,Lr,null,"f"),!("closed"===l.state||l.videoSrc||"opening"===l.state&&Z(l,ar,"f"))){Z(l,sn,"f").fire("before:camera:change",[],{target:l,async:!1}),Z(l,Le,"m",cc).call(l);try{l.resetSoftwareScale()}catch(f){}return Z(l,Ei,"f")}})()}getCamera(){var a;if(Z(this,Ei,"f"))return Z(this,Ei,"f");{let l=(null===(a=Z(this,St,"f").video)||void 0===a?void 0:a.deviceId)||"";if(l){l=l.exact||l.ideal||l;for(let f of this._arrCameras)if(f.deviceId===l)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(a){var l=this;return ae(function*(){var f,g;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let p;if(a){let b=yield navigator.mediaDevices.getUserMedia({video:!0});p=(yield navigator.mediaDevices.enumerateDevices()).filter(O=>"videoinput"===O.kind),b.getTracks().forEach(O=>{O.stop()})}else p=(yield navigator.mediaDevices.enumerateDevices()).filter(b=>"videoinput"===b.kind);const _=[],C=[];if(l._arrCameras)for(let b of l._arrCameras)b._checked&&C.push(b);for(let b=0;b<p.length;b++){let O,M=p[b];for(let P of C)if(M.deviceId==P.deviceId){O=P;break}O||(O={deviceId:M.deviceId,label:M.label?M.label:"camera "+b,_checked:!1}),O.deviceId&&_.push(O)}return l._arrCameras=_,He._onLog&&He._onLog(JSON.stringify(l._arrCameras)),_})()}getCameras(){var a=this;return ae(function*(){var l,f;if(!(null===(f=null===(l=null==window?void 0:window.navigator)||void 0===l?void 0:l.mediaDevices)||void 0===f?void 0:f.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const g=(yield navigator.mediaDevices.enumerateDevices()).filter(p=>"videoinput"===p.kind);return a._getCameras(!(!g||!g.length||g[0].deviceId))})()}getAllCameras(){var a=this;return ae(function*(){return a.getCameras()})()}setResolution(a,l,f){var g=this;return ae(function*(){if("number"!=typeof a||a<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof Z(g,St,"f").video&&(Z(g,St,"f").video={}),f?(Z(g,St,"f").video.width={exact:a},Z(g,St,"f").video.height={exact:l}):(Z(g,St,"f").video.width={ideal:a},Z(g,St,"f").video.height={ideal:l}),"closed"===g.state||g.videoSrc||"opening"===g.state&&Z(g,ar,"f"))return null;Z(g,sn,"f").fire("before:resolution:change",[],{target:g,async:!1}),yield Z(g,Le,"m",cc).call(g);try{g.resetSoftwareScale()}catch(_){}const p=g.getResolution();return{width:p.width,height:p.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&Z(this,Qe,"f"))return{width:Z(this,Qe,"f").videoWidth,height:Z(this,Qe,"f").videoHeight};if(Z(this,pt,"f")){const a=Z(this,pt,"f").getSettings();return{width:a.width,height:a.height}}if(this.isVideoLoaded())return{width:Z(this,Qe,"f").videoWidth,height:Z(this,Qe,"f").videoHeight};{const a={width:0,height:0};let l=Z(this,St,"f").video.width||0,f=Z(this,St,"f").video.height||0;return l&&(a.width=l.exact||l.ideal||l),f&&(a.height=f.exact||f.ideal||f),a}}getResolutions(a){var l=this;return ae(function*(){var f,g,p,_,C,b,O,M,P,k,j;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let G="";const z=(Y,X)=>{const $=Z(l,Js,"f").get(Y);if(!$||!$.length)return!1;for(let K of $)if(K.width===X.width&&K.height===X.height)return!0;return!1};if(l._mediaStream){G=null===(j=Z(l,Ei,"f"))||void 0===j?void 0:j.deviceId;let Y=Z(l,Js,"f").get(G);if(Y&&!a)return JSON.parse(JSON.stringify(Y));Y=[],Z(l,Js,"f").set(G,Y),ht(l,pa,!0,"f");try{for(let X of l.detectedResolutions){yield Z(l,pt,"f").applyConstraints({width:{ideal:X.width},height:{ideal:X.height}}),Z(l,Le,"m",Hi).call(l);const $=Z(l,pt,"f").getSettings(),K={width:$.width,height:$.height};z(G,K)||Y.push({width:K.width,height:K.height})}}catch(X){throw Z(l,Le,"m",Wh).call(l),ht(l,pa,!1,"f"),X}try{yield Z(l,Le,"m",va).call(l)}catch(X){if("AbortError"===X.name)return Y;throw X}finally{ht(l,pa,!1,"f")}return Y}{const Y=function(){var K=ae(function*(ge,_e,Te){const Se={video:{deviceId:{exact:ge},width:{ideal:_e},height:{ideal:Te}}};let F=null;try{F=yield navigator.mediaDevices.getUserMedia(Se)}catch(Ke){return null}if(!F)return null;const Ce=F.getVideoTracks();let Ne=null;try{const Ke=Ce[0].getSettings();Ne={width:Ke.width,height:Ke.height}}catch(Ke){const D=document.createElement("video");D.srcObject=F,Ne={width:D.videoWidth,height:D.videoHeight},D.srcObject=null}return Ce.forEach(Ke=>{Ke.stop()}),Ne});return function(_e,Te,Se){return K.apply(this,arguments)}}();let X=(null===(C=null===(_=null===(p=Z(l,St,"f"))||void 0===p?void 0:p.video)||void 0===_?void 0:_.deviceId)||void 0===C?void 0:C.exact)||(null===(M=null===(O=null===(b=Z(l,St,"f"))||void 0===b?void 0:b.video)||void 0===O?void 0:O.deviceId)||void 0===M?void 0:M.ideal)||(null===(k=null===(P=Z(l,St,"f"))||void 0===P?void 0:P.video)||void 0===k?void 0:k.deviceId);if(!X)return[];let $=Z(l,Js,"f").get(X);if($&&!a)return JSON.parse(JSON.stringify($));$=[],Z(l,Js,"f").set(X,$);for(let K of l.detectedResolutions){const ge=yield Y(X,K.width,K.height);ge&&!z(X,ge)&&$.push({width:ge.width,height:ge.height})}return $}})()}setMediaStreamConstraints(a,l){var f=this;return ae(function*(){if(null===(g=a)||"[object Object]"!==Object.prototype.toString.call(g))throw new TypeError("Invalid 'mediaStreamConstraints'.");var g;ht(f,St,JSON.parse(JSON.stringify(a)),"f"),ht(f,Lr,null,"f"),l&&Z(f,Le,"m",cc).call(f)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(Z(this,St,"f")))}resetMediaStreamConstraints(){ht(this,St,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!Z(this,pt,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Z(this,pt,"f").getCapabilities?Z(this,pt,"f").getCapabilities():{}}getCameraSettings(){if(!Z(this,pt,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return Z(this,pt,"f").getSettings()}turnOnTorch(){var a=this;return ae(function*(){if(!Z(a,pt,"f")||"opened"!==a.state)throw new Error("Camera is not open.");const l=a.getCameraCapabilities();if(!(null==l?void 0:l.torch))throw Error("Not supported.");yield Z(a,pt,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var a=this;return ae(function*(){if(!Z(a,pt,"f")||"opened"!==a.state)throw new Error("Camera is not open.");const l=a.getCameraCapabilities();if(!(null==l?void 0:l.torch))throw Error("Not supported.");yield Z(a,pt,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(a,l){var f=this;return ae(function*(){var g;if("number"!=typeof a)throw new TypeError("Invalid 'value'.");if(!Z(f,pt,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const p=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.colorTemperature;if(!p)throw Error("Not supported.");return l&&(a<p.min?a=p.min:a>p.max&&(a=p.max),a=Wn(a,p.min,p.step,p.max)),yield Z(f,pt,"f").applyConstraints({advanced:[{colorTemperature:a,whiteBalanceMode:"manual"}]}),a})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(a,l){var f=this;return ae(function*(){var g;if("number"!=typeof a)throw new TypeError("Invalid 'value'.");if(!Z(f,pt,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const p=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.exposureCompensation;if(!p)throw Error("Not supported.");return l&&(a<p.min?a=p.min:a>p.max&&(a=p.max),a=Wn(a,p.min,p.step,p.max)),yield Z(f,pt,"f").applyConstraints({advanced:[{exposureCompensation:a}]}),a})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(a,l){var f=this;return ae(function*(){var g;if("number"!=typeof a)throw new TypeError("Invalid 'value'.");if(!Z(f,pt,"f")||"opened"!==f.state)throw new Error("Camera is not open.");let p=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.frameRate;if(!p)throw Error("Not supported.");l&&(a<p.min?a=p.min:a>p.max&&(a=p.max));const _=f.getResolution();return yield Z(f,pt,"f").applyConstraints({width:{ideal:Math.max(_.width,_.height)},frameRate:a}),a})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(a,l){var f=this;return ae(function*(){if("object"!=typeof a||Array.isArray(a)||null==a)throw new TypeError("Invalid 'settings'.");if(!Z(f,pt,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const g=f.getCameraCapabilities(),p=null==g?void 0:g.focusMode,_=null==g?void 0:g.focusDistance;if(!p)throw Error("Not supported.");if("string"!=typeof a.mode)throw TypeError("Invalid 'mode'.");const C=a.mode.toLowerCase();if(!p.includes(C))throw Error("Unsupported focus mode.");if("manual"===C){if(!_)throw Error("Manual focus unsupported.");if(a.hasOwnProperty("distance")){let b=a.distance;l&&(b<_.min?b=_.min:b>_.max&&(b=_.max),b=Wn(b,_.min,_.step,_.max)),f._focusParameters.focusArea=null,yield Z(f,pt,"f").applyConstraints({advanced:[{focusMode:C,focusDistance:b}]})}else{if(!a.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const b=a.area.centerPoint;let O=a.area.width,M=a.area.height;if(!O||!M){const P=f.getResolution();O||(O=2*Math.round(Math.min(P.width,P.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),M||(M=2*Math.round(Math.min(P.width,P.height)/f._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}f._focusParameters.focusArea={centerPoint:{x:b.x,y:b.y},width:O,height:M},yield Z(f,Le,"m",bm).call(f,b,O,M)}}}else f._focusParameters.focusArea=null,yield Z(f,pt,"f").applyConstraints({advanced:[{focusMode:C}]})})()}getFocus(){const a=this.getCameraSettings(),l=a.focusMode;return l?"manual"===l?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:a.focusDistance}:{mode:l}:null}enableTapToFocus(){var a=this;return ae(function*(){ht(a,ma,!0,"f")})()}disableTapToFocus(){ht(this,ma,!1,"f")}isTapToFocusEnabled(){return Z(this,ma,"f")}setZoom(a){var l=this;return ae(function*(){if("object"!=typeof a||Array.isArray(a)||null==a)throw new TypeError("Invalid 'settings'.");if("number"!=typeof a.factor)throw new TypeError("Illegal type of 'factor'.");if(a.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==l.state)throw new Error("Video is not playing.");a.centerPoint?Z(l,Le,"m",Dm).call(l,a.centerPoint):l.resetScaleCenter();try{if(Z(l,Le,"m",UD).call(l,Z(l,Nr,"f"))){const f=yield l.setHardwareScale(a.factor,!0);let g=l.getHardwareScale();1==g&&1!=f&&(g=f),l.setSoftwareScale(a.factor>g?a.factor/g:1)}else yield l.setHardwareScale(1),l.setSoftwareScale(a.factor)}catch(f){const g=f.message||f;if("Not supported."!==g&&"Camera is not open."!==g)throw f;l.setSoftwareScale(a.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let a=1;try{a=this.getHardwareScale()}catch(l){if("Camera is not open."!==(l.message||l))throw l}return{factor:a*Z(this,Pr,"f")}}resetZoom(){var a=this;return ae(function*(){yield a.setZoom({factor:1})})()}setHardwareScale(a,l){var f=this;return ae(function*(){var g;if("number"!=typeof a)throw new TypeError("Invalid 'value'.");if(a<1)throw new RangeError("Invalid 'value'.");if(!Z(f,pt,"f")||"opened"!==f.state)throw new Error("Camera is not open.");const p=null===(g=f.getCameraCapabilities())||void 0===g?void 0:g.zoom;if(!p)throw Error("Not supported.");return l&&(a<p.min?a=p.min:a>p.max&&(a=p.max),a=Wn(a,p.min,p.step,p.max)),yield Z(f,pt,"f").applyConstraints({advanced:[{zoom:a}]}),a})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(a,l){if("number"!=typeof a)throw new TypeError("Invalid 'value'.");if(a<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");l&&Z(this,Le,"m",Dm).call(this,l),ht(this,Pr,a,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return Z(this,Pr,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const a=this.getResolution();ht(this,Nr,{x:a.width/2,y:a.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(a){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||Z(this,pa,"f"))return null;const l=Date.now();He._onLog&&He._onLog("getFrameData() START: "+l);const f=Z(this,Qe,"f").videoWidth,g=Z(this,Qe,"f").videoHeight;let p={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};(null==a?void 0:a.position)&&(p=JSON.parse(JSON.stringify(a.position)));let _=dt.RGBA;(null==a?void 0:a.pixelFormat)&&(_=a.pixelFormat);let C=Z(this,Pr,"f");(null==a?void 0:a.scale)&&(C=a.scale);let b=Z(this,Nr,"f");if(null==a?void 0:a.scaleCenter){if("string"!=typeof a.scaleCenter.x||"string"!=typeof a.scaleCenter.y)throw new Error("Invalid scale center.");let k=0,j=0;if(a.scaleCenter.x.endsWith("px"))k=parseFloat(a.scaleCenter.x);else{if(!a.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");k=parseFloat(a.scaleCenter.x)/100*f}if(a.scaleCenter.y.endsWith("px"))j=parseFloat(a.scaleCenter.y);else{if(!a.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");j=parseFloat(a.scaleCenter.y)/100*g}if(isNaN(k)||isNaN(j))throw new Error("Invalid scale center.");b.x=Math.round(k),b.y=Math.round(j)}let O=null;if((null==a?void 0:a.bufferContainer)&&(O=a.bufferContainer),0==f||0==g)return null;1!==C&&(p.sWidth=Math.round(p.sWidth/C),p.sHeight=Math.round(p.sHeight/C),p.sx=Math.round((1-1/C)*b.x+p.sx/C),p.sy=Math.round((1-1/C)*b.y+p.sy/C));const M=this.imageDataGetter.getImageData(Z(this,Qe,"f"),f,g,p,{pixelFormat:_,bufferContainer:O});if(!M)return null;const P=Date.now();return He._onLog&&He._onLog("getFrameData() END: "+P),{data:M.data,width:M.width,height:M.height,pixelFormat:M.pixelFormat,timeSpent:P-l,timeStamp:P,toCanvas:Z(this,ym,"f")}}on(a,l){if(!Z(this,Cm,"f").includes(a.toLowerCase()))throw new Error(`Event '${a}' does not exist.`);Z(this,sn,"f").on(a,l)}off(a,l){Z(this,sn,"f").off(a,l)}dispose(){var a=this;return ae(function*(){a.tapFocusEventBoundEl=null,yield a.close(),a.releaseVideoEl(),Z(a,sn,"f").dispose(),a.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",Z(a,Hh,"f")),ht(a,Gh,!0,"f")})()}}var uc,zh,Ca,eo,Yh,wa,VD,HD,ft,Tm,Im,Me,Pe,hc,kr,to,$h,Xh,qh,dc,no,Zh,Br,oi,Ut,Fe,lr,Sm,xt,GD,WD,xm,Am;Qe=new WeakMap,pt=new WeakMap,Bh=new WeakMap,jh=new WeakMap,St=new WeakMap,Ei=new WeakMap,Lr=new WeakMap,ga=new WeakMap,Uh=new WeakMap,ar=new WeakMap,Fr=new WeakMap,ri=new WeakMap,pa=new WeakMap,ma=new WeakMap,lc=new WeakMap,Vh=new WeakMap,_a=new WeakMap,Qs=new WeakMap,Pr=new WeakMap,Nr=new WeakMap,ym=new WeakMap,sn=new WeakMap,Cm=new WeakMap,Js=new WeakMap,BD=new WeakMap,Hh=new WeakMap,Gh=new WeakMap,Le=new WeakSet,jD=function(){var u=ae(function*(){var a=this;const l=this.getMediaStreamConstraints();if("boolean"==typeof l.video&&(l.video={}),!l.video.deviceId)if(Z(this,Lr,"f"))delete l.video.facingMode,l.video.deviceId={exact:Z(this,Lr,"f")};else if(this.ifSaveLastUsedCamera&&He.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete l.video.facingMode,l.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const f=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),g=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));f&&g&&(l.video.width=f,l.video.height=g)}else if(!this.ifSkipCameraInspection){const f=function(){var _=ae(function*(C){let b=null;return"environment"===C&&["Android","HarmonyOS","iPhone","iPad"].includes(Rn.OS)?(yield a._getCameras(!1),Z(a,Le,"m",Hi).call(a),b=He.findBestCamera(a._arrCameras,"environment",{getMainCameraInIOS:a.selectIOSRearMainCameraAsDefault})):C||["Android","HarmonyOS","iPhone","iPad"].includes(Rn.OS)||(yield a._getCameras(!1),Z(a,Le,"m",Hi).call(a),b=He.findBestCamera(a._arrCameras,null,{getMainCameraInIOS:a.selectIOSRearMainCameraAsDefault})),b});return function(b){return _.apply(this,arguments)}}();let g=l.video.facingMode;g instanceof Array&&g.length&&(g=g[0]),"object"==typeof g&&(g=g.exact||g.ideal);const p=yield f(g);p&&(delete l.video.facingMode,l.video.deviceId={exact:p})}return l});return function(){return u.apply(this,arguments)}}(),Hi=function(){if(Z(this,ar,"f")){const u=new Error("The operation was interrupted.");throw u.name="AbortError",u}},wm=function(){var u=ae(function*(a){var f,g,l=this;if(!(null===(g=null===(f=null==window?void 0:window.navigator)||void 0===f?void 0:f.mediaDevices)||void 0===g?void 0:g.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let p;try{He._onLog&&He._onLog("======try getUserMedia========");let _=[0,500,1e3,2e3],C=null;const b=function(){var O=ae(function*(M){for(let P of _){P&&(yield new Promise(k=>setTimeout(k,P)),Z(l,Le,"m",Hi).call(l));try{He._onLog&&He._onLog("ask "+JSON.stringify(M)),p=yield navigator.mediaDevices.getUserMedia(M),Z(l,Le,"m",Hi).call(l);break}catch(k){if("NotFoundError"===k.name||"NotAllowedError"===k.name||"AbortError"===k.name||"OverconstrainedError"===k.name)throw k;C=k,He._onLog&&He._onLog(k.message||k)}}});return function(P){return O.apply(this,arguments)}}();if(yield b(a),p||"object"!=typeof a.video||(a.video.deviceId&&(delete a.video.deviceId,yield b(a)),!p&&a.video.facingMode&&(delete a.video.facingMode,yield b(a)),p||!a.video.width&&!a.video.height||(delete a.video.width,delete a.video.height,yield b(a))),!p)throw C;return p}catch(_){throw null==p||p.getTracks().forEach(C=>{C.stop()}),"NotFoundError"===_.name&&(DOMException?_=new DOMException("No camera available, please use a device with an accessible camera.",_.name):(_=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),_}});return function(l){return u.apply(this,arguments)}}(),Em=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(u=>{u.stop()}),this._mediaStream=null),ht(this,pt,null,"f")},va=function(){var u=ae(function*(){var a=this;ht(this,ar,!1,"f");const l=ht(this,Uh,Symbol(),"f");if(Z(this,Fr,"f")&&"pending"===Z(this,ri,"f")){try{yield Z(this,Fr,"f")}catch(g){}Z(this,Le,"m",Hi).call(this)}return l!==Z(this,Uh,"f")?void 0:ht(this,Fr,ae(function*(){ht(a,ri,"pending","f");try{if(a.videoSrc){if(!Z(a,Qe,"f"))throw new Error("'videoEl' should be set.");yield He.playVideo(Z(a,Qe,"f"),a.videoSrc,a.cameraOpenTimeout),Z(a,Le,"m",Hi).call(a)}else{let g=yield Z(a,Le,"m",jD).call(a);Z(a,Le,"m",Em).call(a);let p=yield Z(a,Le,"m",wm).call(a,g);yield a._getCameras(!1),Z(a,Le,"m",Hi).call(a);const _=()=>{const M=p.getVideoTracks();let P,k;if(M.length&&(P=M[0]),P){const j=P.getSettings();if(j)for(let G of a._arrCameras)if(j.deviceId===G.deviceId){G._checked=!0,G.label=P.label,k=G;break}}return k},C=Z(a,St,"f");if("object"==typeof C.video){let M=C.video.facingMode;if(M instanceof Array&&M.length&&(M=M[0]),"object"==typeof M&&(M=M.exact||M.ideal),!(Z(a,Lr,"f")||a.ifSaveLastUsedCamera&&He.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||a.ifSkipCameraInspection||C.video.deviceId)){const P=_(),k=He.findBestCamera(a._arrCameras,M,{getMainCameraInIOS:a.selectIOSRearMainCameraAsDefault});k&&k!=(null==P?void 0:P.deviceId)&&(p.getTracks().forEach(j=>{j.stop()}),g.video.deviceId={exact:k},p=yield Z(a,Le,"m",wm).call(a,g),Z(a,Le,"m",Hi).call(a))}}const b=_();(null==b?void 0:b.deviceId)&&(ht(a,Lr,b&&b.deviceId,"f"),a.ifSaveLastUsedCamera&&He.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",Z(a,Lr,"f")),"object"==typeof g.video&&g.video.width&&g.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(g.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(g.video.height))))),Z(a,Qe,"f")&&(yield He.playVideo(Z(a,Qe,"f"),p,a.cameraOpenTimeout),Z(a,Le,"m",Hi).call(a)),a._mediaStream=p;const O=p.getVideoTracks();(null==O?void 0:O.length)&&ht(a,pt,O[0],"f"),ht(a,Ei,b,"f")}}catch(g){throw Z(a,Le,"m",Wh).call(a),ht(a,ri,null,"f"),g}ht(a,ri,"fulfilled","f")})(),"f")});return function(){return u.apply(this,arguments)}}(),cc=function(){var u=ae(function*(){var a;if("closed"===this.state||this.videoSrc)return;const l=null===(a=Z(this,Ei,"f"))||void 0===a?void 0:a.deviceId,f=this.getResolution();yield Z(this,Le,"m",va).call(this);const g=this.getResolution();l&&l!==Z(this,Ei,"f").deviceId&&Z(this,sn,"f").fire("camera:changed",[Z(this,Ei,"f").deviceId,l],{target:this,async:!1}),f.width==g.width&&f.height==g.height||Z(this,sn,"f").fire("resolution:changed",[{width:g.width,height:g.height},{width:f.width,height:f.height}],{target:this,async:!1}),Z(this,sn,"f").fire("played",null,{target:this,async:!1})});return function(){return u.apply(this,arguments)}}(),Wh=function(){Z(this,Le,"m",Em).call(this),ht(this,Ei,null,"f"),Z(this,Qe,"f")&&(Z(this,Qe,"f").srcObject=null,this.videoSrc&&(Z(this,Qe,"f").pause(),Z(this,Qe,"f").currentTime=0)),ht(this,ar,!0,"f");try{this.resetSoftwareScale()}catch(u){}},si=function(){var u=ae(function*(l,f){const g=Y=>{if(!Z(this,pt,"f")||!this.isVideoPlaying||Y.focusTaskId!=this._focusParameters.curFocusTaskId){Z(this,pt,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const X=new Error(`Focus task ${Y.focusTaskId} canceled.`);throw X.name="DeprecatedTaskError",X}1===this._focusParameters.isDoingFocus&&Date.now()-Y.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let p;f=Wn(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield Z(this,pt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),g(l),p=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/f),Math.abs(1/this._focusParameters.fds.max-1/f))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/f)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=f,yield new Promise(Y=>{setTimeout(Y,p)}),g(l);let _=l.focusL-l.focusW/2,C=l.focusT-l.focusH/2,b=l.focusW,O=l.focusH;const M=this.getResolution();if(_>=M.width||C>=M.height)throw new Error("Invalid area.");_+b>M.width&&(b=M.width-_),C+O>M.height&&(O=M.height-C),_=Math.round(_),C=Math.round(C),b=Math.round(b),O=Math.round(O);const P=4*M.width*M.height*this._focusParameters.defaultTempBufferContainerLenRatio,k=4*b*O;let j=this._focusParameters.tempBufferContainer;if(j){const Y=j.length;P>Y&&P>=k?j=new Uint8Array(P):k>Y&&k>=P&&(j=new Uint8Array(k))}else j=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(P,k));if(!this.imageDataGetter.getImageData(Z(this,Qe,"f"),M.width,M.height,{sx:_,sy:C,sWidth:b,sHeight:O,dWidth:b,dHeight:O},{pixelFormat:dt.RGBA,bufferContainer:j}))return Z(this,Le,"m",a).call(this,l,f);const G=j;let z=0;for(let Y=0,X=k-8;Y<X;++Y){let $=G[Y]-G[Y+8];++Y;let K=G[Y]-G[Y+8];++Y;let ge=G[Y]-G[Y+8];++Y,z+=$*$+K*K+ge*ge}return-z});function a(l,f){return u.apply(this,arguments)}return a}(),ya=function(){var u=ae(function*(l,f,g,p,_,C,b){let O;if(f=Wn(f,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p=Wn(p,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),C?C=Wn(C,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(C=Wn(Math.sqrt((f||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b=yield Z(this,Le,"m",si).call(this,l,C)),b<=g&&b<=_?O=3:g<_&&g<b?O=1:_<g&&_<b&&(O=2),(p-f)/2<=this._focusParameters.fds.step)return 3===O||(1===O?yield Z(this,pt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}):2===O&&(yield Z(this,pt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:p}]}))),!0;if(1===O)return yield Z(this,Le,"m",a).call(this,l,f,g,C,b);if(2===O)return yield Z(this,Le,"m",a).call(this,l,C,b,p,_);if(3!==O)return g=yield Z(this,Le,"m",si).call(this,l,f),_=yield Z(this,Le,"m",si).call(this,l,p),yield Z(this,Le,"m",a).call(this,l,f,g,p,_);let M=Wn(Math.sqrt((f||this._focusParameters.fds.step)*(C||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),P=Wn(Math.sqrt((p||this._focusParameters.fds.step)*(C||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/M)<=Math.abs(1/this._focusParameters.oldDistance-1/P)){let k=yield Z(this,Le,"m",si).call(this,l,M);if(k<b)return yield Z(this,Le,"m",a).call(this,l,f,g,C,b,M,k);if(k==b)return yield Z(this,Le,"m",a).call(this,l,M,k,C,b);let j=yield Z(this,Le,"m",si).call(this,l,P);if(k>b&&b<j)return yield Z(this,Le,"m",a).call(this,l,M,k,P,j,C,b);if(b==j)return yield Z(this,Le,"m",a).call(this,l,C,b,P,j);if(b>j)return yield Z(this,Le,"m",a).call(this,l,C,b,p,_,P,j)}else{let k=yield Z(this,Le,"m",si).call(this,l,P);if(b>k)return yield Z(this,Le,"m",a).call(this,l,C,b,p,_,P,k);if(b==k)return yield Z(this,Le,"m",a).call(this,l,C,b,P,k);let j=yield Z(this,Le,"m",si).call(this,l,M);if(j>b&&b<k)return yield Z(this,Le,"m",a).call(this,l,M,j,P,k,C,b);if(j==b)return yield Z(this,Le,"m",a).call(this,l,M,j,C,b);if(j<b)return yield Z(this,Le,"m",a).call(this,l,f,g,C,b,M,j)}return!1});function a(l,f,g,p,_,C,b){return u.apply(this,arguments)}return a}(),bm=function(){var u=ae(function*(a,l,f,g,p){var C,_=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!a||"string"!=typeof a.x||"string"!=typeof a.y)throw new Error("Invalid 'centerPoint'.");if(!l||"string"!=typeof l)throw new Error("Invalid 'width'.");if(!f||"string"!=typeof f)throw new Error("Invalid 'height'.");const b=this.getResolution();let O=0,M=0;if(a.x.endsWith("px"))O=parseFloat(a.x);else{if(!a.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");O=parseFloat(a.x)/100*b.width}if(a.y.endsWith("px"))M=parseFloat(a.y);else{if(!a.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");M=parseFloat(a.y)/100*b.height}if(isNaN(O)||isNaN(M)||O<0||O>b.width||M<0||M>b.height)throw new Error("Invalid 'centerPoint'.");let P=0;if(l.endsWith("px"))P=parseFloat(l);else{if(!l.endsWith("%"))throw new Error("Invalid 'width'.");P=parseFloat(l)/100*b.width}if(isNaN(P)||P<0)throw new Error("Invalid 'width'.");let k=0;if(f.endsWith("px"))k=parseFloat(f);else{if(!f.endsWith("%"))throw new Error("Invalid 'height'.");k=parseFloat(f)/100*b.height}if(isNaN(k)||k<0)throw new Error("Invalid 'height'.");if(1!==Z(this,Pr,"f")){const z=Z(this,Pr,"f"),Y=Z(this,Nr,"f");P/=z,k/=z,O=(1-1/z)*Y.x+O/z,M=(1-1/z)*Y.y+M/z}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(C=this.getCameraCapabilities())||void 0===C?void 0:C.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:O,focusT:M,focusW:P,focusH:k,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},G=function(){var z=ae(function*(Y,X,$){try{(null==X||X<_._focusParameters.fds.min)&&(X=_._focusParameters.fds.min),(null==$||$>_._focusParameters.fds.max)&&($=_._focusParameters.fds.max),_._focusParameters.oldDistance=null;let K=Wn(Math.sqrt($*(X||_._focusParameters.fds.step)),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),ge=Wn(Math.sqrt((X||_._focusParameters.fds.step)*K),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),_e=Wn(Math.sqrt(K*$),_._focusParameters.fds.min,_._focusParameters.fds.step,_._focusParameters.fds.max),Te=yield Z(_,Le,"m",si).call(_,Y,_e),Se=yield Z(_,Le,"m",si).call(_,Y,ge),F=yield Z(_,Le,"m",si).call(_,Y,K);if(Se>F&&F<Te){const Ce=yield Z(_,Le,"m",ya).call(_,Y,ge,Se,_e,Te,K,F);return _._focusParameters.isDoingFocus=0,Ce}if(Se<F&&Se<Te){let Ce=yield Z(_,Le,"m",si).call(_,Y,X);const Ne=yield Z(_,Le,"m",ya).call(_,Y,X,Ce,K,F,ge,Se);return _._focusParameters.isDoingFocus=0,Ne}if(F>Te&&Se>Te){let Ce=yield Z(_,Le,"m",si).call(_,Y,$);const Ne=yield Z(_,Le,"m",ya).call(_,Y,K,F,$,Ce,_e,Te);return _._focusParameters.isDoingFocus=0,Ne}if(Se==F&&F<Te){const Ce=yield Z(_,Le,"m",ya).call(_,Y,ge,Se,K,F);return _._focusParameters.isDoingFocus=0,Ce}if(F==Te&&Se>F){const Ce=yield Z(_,Le,"m",ya).call(_,Y,K,F,_e,Te);return _._focusParameters.isDoingFocus=0,Ce}return G(Y,X,$)}catch(K){if("DeprecatedTaskError"!==K.name)throw K}});return function(X,$,K){return z.apply(this,arguments)}}();return G(j,g,p)});return function(l,f,g,p,_){return u.apply(this,arguments)}}(),Dm=function(u){if("opened"!==this.state)throw new Error("Video is not playing.");if(!u||"string"!=typeof u.x||"string"!=typeof u.y)throw new Error("Invalid 'center'.");const a=this.getResolution();let l=0,f=0;if(u.x.endsWith("px"))l=parseFloat(u.x);else{if(!u.x.endsWith("%"))throw new Error("Invalid scale center.");l=parseFloat(u.x)/100*a.width}if(u.y.endsWith("px"))f=parseFloat(u.y);else{if(!u.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(u.y)/100*a.height}if(isNaN(l)||isNaN(f))throw new Error("Invalid scale center.");ht(this,Nr,{x:l,y:f},"f")},UD=function(u){if("opened"!==this.state)throw new Error("Video is not playing.");const a=this.getResolution();return u&&u.x==a.width/2&&u.y==a.height/2},He.browserInfo=Rn,He.onWarning=null===(vm=null==window?void 0:window.console)||void 0===vm?void 0:vm.warn;class jr{constructor(a){uc.add(this),zh.set(this,void 0),Ca.set(this,0),eo.set(this,void 0),Yh.set(this,0),wa.set(this,!1),Oe(this,zh,a,"f")}startCharging(){U(this,wa,"f")||(jr._onLog&&jr._onLog("start charging."),U(this,uc,"m",HD).call(this),Oe(this,wa,!0,"f"))}stopCharging(){U(this,eo,"f")&&clearTimeout(U(this,eo,"f")),U(this,wa,"f")&&(jr._onLog&&jr._onLog("stop charging."),Oe(this,Ca,Date.now()-U(this,Yh,"f"),"f"),Oe(this,wa,!1,"f"))}}zh=new WeakMap,Ca=new WeakMap,eo=new WeakMap,Yh=new WeakMap,wa=new WeakMap,uc=new WeakSet,VD=function(){$t.cfd(1),jr._onLog&&jr._onLog("charge 1.")},HD=function u(){0==U(this,Ca,"f")&&U(this,uc,"m",VD).call(this),Oe(this,Yh,Date.now(),"f"),U(this,eo,"f")&&clearTimeout(U(this,eo,"f")),Oe(this,eo,setTimeout(()=>{Oe(this,Ca,0,"f"),U(this,uc,"m",u).call(this)},U(this,zh,"f")-U(this,Ca,"f")),"f")};const zD=new Map([[je.IPF_GRAYSCALED,dt.GREY],[je.IPF_ABGR_8888,dt.RGBA],[je.IPF_ARGB_8888,dt.BGRA]]),YD=new Map([[dt.GREY,je.IPF_GRAYSCALED],[dt.RGBA,je.IPF_ABGR_8888],[dt.BGRA,je.IPF_ARGB_8888]]),Rm="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class it extends Ci{static set _onLog(a){Oe(it,Tm,a,"f",Im),He._onLog=a,jr._onLog=a}static get _onLog(){return U(it,Tm,"f",Im)}static detectEnvironment(){return ae(function*(){return yield ae(function*(){return{wasm:d2,worker:f2,getUserMedia:CD,camera:yield g2(),browser:bn.browser,version:bn.version,OS:bn.OS}})()})()}static testCameraAccess(){return ae(function*(){const a=yield He.testCameraAccess();return a.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===a.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===a.errorName||"NotFoundError"===a.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===a.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===a.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===a.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===a.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:a.errorMessage}})()}static createInstance(a){return ae(function*(){var l,f;if(a&&!(a instanceof Kt))throw new TypeError("Invalid view.");if(null===(l=fn.license)||void 0===l?void 0:l.LicenseManager){if(!(null===(f=fn.license)||void 0===f?void 0:f.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield $t.loadWasm(["license"]),yield fn.license.dynamsoft()}const g=new it(a);return it.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{it.onWarning&&it.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{it.onWarning&&it.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),g})()}get video(){return U(this,Me,"f").getVideoEl()}set videoSrc(a){if(!U(this,Me,"f"))throw new Error("Camera manager is null.");U(this,Pe,"f")&&(U(this,Pe,"f")._hideDefaultSelection=!0),U(this,Me,"f").videoSrc=a}get videoSrc(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.videoSrc}set ifSaveLastUsedCamera(a){if(!U(this,Me,"f"))throw new Error("Camera manager is null.");U(this,Me,"f").ifSaveLastUsedCamera=a}get ifSaveLastUsedCamera(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.ifSaveLastUsedCamera}set ifSkipCameraInspection(a){if(!U(this,Me,"f"))throw new Error("Camera manager is null.");U(this,Me,"f").ifSkipCameraInspection=a}get ifSkipCameraInspection(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.ifSkipCameraInspection}set cameraOpenTimeout(a){if(!U(this,Me,"f"))throw new Error("Camera manager is null.");U(this,Me,"f").cameraOpenTimeout=a}get cameraOpenTimeout(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.cameraOpenTimeout}set singleFrameMode(a){if(!["disabled","image","camera"].includes(a))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Oe(this,$h,a,"f")}get singleFrameMode(){return U(this,$h,"f")}get _isFetchingStarted(){return U(this,Br,"f")}get disposed(){return U(this,Sm,"f")}constructor(a){var l;if(super(),l=this,ft.add(this),Me.set(this,void 0),Pe.set(this,void 0),hc.set(this,"closed"),kr.set(this,void 0),to.set(this,!1),$h.set(this,void 0),this._onCameraSelChange=ae(function*(){l.isOpen()&&U(l,Pe,"f")&&!U(l,Pe,"f").disposed&&(yield l.selectCamera(U(l,Pe,"f")._selCam.value))}),this._onResolutionSelChange=ae(function*(){if(!l.isOpen()||!U(l,Pe,"f")||U(l,Pe,"f").disposed)return;let f,g;if(U(l,Pe,"f")._selRsl&&-1!=U(l,Pe,"f")._selRsl.selectedIndex){let p=U(l,Pe,"f")._selRsl.options[U(l,Pe,"f")._selRsl.selectedIndex];f=parseInt(p.getAttribute("data-width")),g=parseInt(p.getAttribute("data-height"))}yield l.setResolution({width:f,height:g})}),this._onCloseBtnClick=ae(function*(){l.isOpen()&&U(l,Pe,"f")&&!U(l,Pe,"f").disposed&&l.close()}),Xh.set(this,(f,g,p,_)=>{const C=Date.now(),b={sx:_.x,sy:_.y,sWidth:_.width,sHeight:_.height,dWidth:_.width,dHeight:_.height},O=Math.max(b.dWidth,b.dHeight);if(this.canvasSizeLimit&&O>this.canvasSizeLimit){const k=this.canvasSizeLimit/O;b.dWidth>b.dHeight?(b.dWidth=this.canvasSizeLimit,b.dHeight=Math.round(b.dHeight*k)):(b.dWidth=Math.round(b.dWidth*k),b.dHeight=this.canvasSizeLimit)}const M=U(this,Me,"f").imageDataGetter.getImageData(f,g,p,b,{pixelFormat:zD.get(this.getPixelFormat())});let P=null;if(M){const k=Date.now();let j;j=M.pixelFormat===dt.GREY?M.width:4*M.width;let G=!0;0===b.sx&&0===b.sy&&b.sWidth===g&&b.sHeight===p&&(G=!1),P={bytes:M.data,width:M.width,height:M.height,stride:j,format:YD.get(M.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_h.ITT_FILE_IMAGE,isCropped:G,cropRegion:{left:_.x,top:_.y,right:_.x+_.width,bottom:_.y+_.height,isMeasuredInPercentage:!1},originalWidth:g,originalHeight:p,currentWidth:M.width,currentHeight:M.height,timeSpent:k-C,timeStamp:k},toCanvas:U(this,qh,"f"),isDCEFrame:!0}}return P}),this._onSingleFrameAcquired=f=>{let g;g=U(this,Pe,"f")?U(this,Pe,"f").getConvertedRegion():Th.convert(U(this,no,"f"),f.width,f.height),g||(g={x:0,y:0,width:f.width,height:f.height});const p=U(this,Xh,"f").call(this,f,f.width,f.height,g);U(this,kr,"f").fire("singleFrameAcquired",[p],{async:!1,copy:!1})},qh.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const f=document.createElement("canvas");let g;if(f.width=this.width,f.height=this.height,this.format===je.IPF_GRAYSCALED){g=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<g.length;p+=4)g[p]=this.bytes[p/4],g[p+1]=this.bytes[p/4],g[p+2]=this.bytes[p/4],g[p+3]=255}else g=new Uint8ClampedArray(this.bytes.buffer);return f.getContext("2d").putImageData(new ImageData(g,this.width,this.height),0,0),f}),dc.set(this,void 0),no.set(this,void 0),Zh.set(this,je.IPF_ABGR_8888),Br.set(this,!1),this._imageId=-1,oi.set(this,void 0),this.fetchInterval=0,Ut.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Fe.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),lr.set(this,void 0),Sm.set(this,!1),this.isCameraEnhancer=!0,a&&!(a instanceof Kt))throw new TypeError("Invalid view.");Oe(this,kr,new AD,"f"),Oe(this,Me,new He,"f"),this._imageDataGetter=U(this,Me,"f").imageDataGetter,U(this,Me,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const f=U(this,Me,"f").getSoftwareScale();if(f<1)throw new RangeError("Invalid scale value.");U(this,Pe,"f")&&!U(this,Pe,"f").disposed?(this.video.style.transform=1===f?"":`scale(${f})`,U(this,Pe,"f")._updateVideoContainer()):this.video.style.transform=1===f?"":`scale(${f})`},["iPhone","iPad","Android","HarmonyOS"].includes(bn.OS)?U(this,Me,"f").setResolution(1280,720):U(this,Me,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",a&&this.setCameraView(a),this._on("before:camera:change",()=>{U(this,lr,"f").stopCharging();const f=U(this,Pe,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const f=U(this,Pe,"f");f&&!f.disposed&&(f._startLoading(),f.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),a.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{U(this,lr,"f").stopCharging(),U(this,Pe,"f")}),this._on("resumed",()=>{U(this,Pe,"f")}),this._on("tapfocus",()=>{U(this,Ut,"f").tapToFocus&&U(this,lr,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var f=ae(function*(g,p){var _,C,b,O;if(U(l,ft,"m",xt).call(l)||!l.isOpen()||l.isPaused())return;const M=g.intermediateResultUnits;it._onLog&&(it._onLog("intermediateResultUnits:"),it._onLog(M));let P=!1,k=!1;for(let j of M){if(j.unitType===ia.IRUT_DECODED_BARCODES&&j.decodedBarcodes.length){P=!0;break}j.unitType===ia.IRUT_LOCALIZED_BARCODES&&j.localizedBarcodes.length&&(k=!0)}if(it._onLog&&(it._onLog("hasLocalizedBarcodes:"),it._onLog(k)),U(l,Ut,"f").autoZoom||U(l,Ut,"f").enhancedFocus)if(P)U(l,Fe,"f").autoZoomInFrameArray.length=0,U(l,Fe,"f").autoZoomOutFrameCount=0,U(l,Fe,"f").frameArrayInIdealZoom.length=0,U(l,Fe,"f").autoFocusFrameArray.length=0;else{const j=function(){var z=ae(function*(Y){yield l.setZoom(Y),U(l,Ut,"f").autoZoom&&U(l,lr,"f").startCharging()});return function(X){return z.apply(this,arguments)}}(),G=function(){var z=ae(function*(Y){yield l.setFocus(Y),U(l,Ut,"f").enhancedFocus&&U(l,lr,"f").startCharging()});return function(X){return z.apply(this,arguments)}}();if(k){const z=M[0].originalImageTag,Y=(null===(_=z.cropRegion)||void 0===_?void 0:_.left)||0,X=(null===(C=z.cropRegion)||void 0===C?void 0:C.top)||0,$=(null===(b=z.cropRegion)||void 0===b?void 0:b.right)?z.cropRegion.right-Y:z.originalWidth,K=(null===(O=z.cropRegion)||void 0===O?void 0:O.bottom)?z.cropRegion.bottom-X:z.originalHeight,ge=z.currentWidth,_e=z.currentHeight;let Te;{let Se,F,Ce,Ne,Ke;{const w=l.video.videoWidth*(1-U(l,Fe,"f").autoZoomDetectionArea)/2,I=l.video.videoWidth*(1+U(l,Fe,"f").autoZoomDetectionArea)/2,m=I,v=w,T=l.video.videoHeight*(1-U(l,Fe,"f").autoZoomDetectionArea)/2,A=T,S=l.video.videoHeight*(1+U(l,Fe,"f").autoZoomDetectionArea)/2;Ke=[{x:w,y:T},{x:I,y:A},{x:m,y:S},{x:v,y:S}]}it._onLog&&(it._onLog("detectionArea:"),it._onLog(Ke));const D=[];{const w=(I,m)=>{const v=(A,S)=>{if(!A&&!S)throw new Error("Invalid arguments.");return function(x,L,N){let B=!1;const H=x.length;if(H<=2)return!1;for(let V=0;V<H;V++){const W=x[V],q=x[(V+1)%H];if(_2(W,q,{x:L,y:N}))return!0;om(W.y-N)>0!=om(q.y-N)>0&&om(L-(N-W.y)*(W.x-q.x)/(W.y-q.y)-W.x)<0&&(B=!B)}return B}(S,A.x,A.y)},T=(A,S)=>!!(Sh([A[0],A[1]],[A[2],A[3]],[S[0].x,S[0].y],[S[1].x,S[1].y])||Sh([A[0],A[1]],[A[2],A[3]],[S[1].x,S[1].y],[S[2].x,S[2].y])||Sh([A[0],A[1]],[A[2],A[3]],[S[2].x,S[2].y],[S[3].x,S[3].y])||Sh([A[0],A[1]],[A[2],A[3]],[S[3].x,S[3].y],[S[0].x,S[0].y]));return!!(v({x:I[0].x,y:I[0].y},m)||v({x:I[1].x,y:I[1].y},m)||v({x:I[2].x,y:I[2].y},m)||v({x:I[3].x,y:I[3].y},m))||!!(v({x:m[0].x,y:m[0].y},I)||v({x:m[1].x,y:m[1].y},I)||v({x:m[2].x,y:m[2].y},I)||v({x:m[3].x,y:m[3].y},I))||!!(T([m[0].x,m[0].y,m[1].x,m[1].y],I)||T([m[1].x,m[1].y,m[2].x,m[2].y],I)||T([m[2].x,m[2].y,m[3].x,m[3].y],I)||T([m[3].x,m[3].y,m[0].x,m[0].y],I))};for(let I of M)if(I.unitType===ia.IRUT_LOCALIZED_BARCODES)for(let m of I.localizedBarcodes){if(!m)continue;const v=m.location.points;v.forEach(T=>{Kt._transformCoordinates(T,Y,X,$,K,ge,_e)}),w(Ke,v)&&D.push(m)}if(it._debug&&U(l,Pe,"f")){const I=l.__layer||(l.__layer=U(l,Pe,"f")._createDrawingLayer(99));I.clearDrawingItems();const m=l.__styleId2||(l.__styleId2=ye.createDrawingStyle({strokeStyle:"red"}));for(let v of M)if(v.unitType===ia.IRUT_LOCALIZED_BARCODES)for(let T of v.localizedBarcodes){if(!T)continue;const S=new hm({points:T.location.points},m);I.addDrawingItems([S])}}}if(it._onLog&&(it._onLog("intersectedResults:"),it._onLog(D)),!D.length)return;let y;if(D.length){let w=D.filter(I=>I.possibleFormats==Rm.BF_QR_CODE||I.possibleFormats==Rm.BF_DATAMATRIX);if(w.length||(w=D.filter(I=>I.possibleFormats==Rm.BF_ONED),w.length||(w=D)),w.length){const I=v=>{const T=v.location.points,A=(T[0].x+T[1].x+T[2].x+T[3].x)/4,S=(T[0].y+T[1].y+T[2].y+T[3].y)/4;return(A-ge/2)*(A-ge/2)+(S-_e/2)*(S-_e/2)};y=w[0];let m=I(y);if(1!=w.length)for(let v=1;v<w.length;v++){const T=I(w[v]);(w[v].confidence>1.1*y.confidence||w[v].confidence>.9*y.confidence&&T<m)&&(y=w[v],m=T)}}}if(it._onLog&&(it._onLog("highPriorityResult:"),it._onLog(y)),y){const w=y.location.points;Se=Math.min(w[0].x,w[1].x,w[2].x,w[3].x),F=Math.max(w[0].x,w[1].x,w[2].x,w[3].x),Ce=Math.min(w[0].y,w[1].y,w[2].y,w[3].y),Ne=Math.max(w[0].y,w[1].y,w[2].y,w[3].y),Te={points:[{x:Se,y:Ce},{x:F,y:Ce},{x:F,y:Ne},{x:Se,y:Ne}],result:y}}}if(it._onLog&&(it._onLog("boundingRect:"),it._onLog(Te)),!Te)return;if(it._debug&&U(l,Pe,"f")&&(null==Te?void 0:Te.points)){const Se=l.__layer||(l.__layer=U(l,Pe,"f")._createDrawingLayer(99)),F=l.__styleId1||(l.__styleId1=ye.createDrawingStyle({strokeStyle:"blue"})),Ce=new hm({points:Te.points},F);Se.addDrawingItems([Ce])}if(U(l,Fe,"f").autoZoomOutFrameCount=0,U(l,Ut,"f").autoZoom){const Se=U(l,Fe,"f").autoZoomIdealArea[1];let F=(1-U(l,Fe,"f").autoZoomTargetBorder)/2;const Ce=Te.points[0].x/$,Ne=($-Te.points[2].x)/$,Ke=Te.points[0].y/K,D=(K-Te.points[2].y)/K;if(Ce>Se&&Ne>Se&&Ke>Se&&D>Se&&Te.result.moduleSize<U(l,Fe,"f").autoZoomInIdealModuleSize){if(U(l,Fe,"f").autoZoomInFrameArray.push(!0),U(l,Fe,"f").autoZoomInFrameArray.splice(0,U(l,Fe,"f").autoZoomInFrameArray.length-U(l,Fe,"f").autoZoomInFrameLimit[0]),U(l,Fe,"f").frameArrayInIdealZoom.length=0,U(l,Ut,"f").enhancedFocus&&G({mode:"continuous"}).catch(()=>{}),U(l,Fe,"f").autoZoomInFrameArray.filter(y=>!0===y).length>=U(l,Fe,"f").autoZoomInFrameLimit[1]){U(l,Fe,"f").autoZoomInFrameArray.length=0;const y=[(.5-F)/(.5-Ce),(.5-F)/(.5-Ne),(.5-F)/(.5-Ke),(.5-F)/(.5-D)].filter(T=>T>0),w=Math.min(...y,U(l,Fe,"f").autoZoomInIdealModuleSize/Te.result.moduleSize),I=l.getZoomSettings().factor;let m=Math.max(Math.pow(I*w,1/U(l,Fe,"f").autoZoomInMaxTimes),U(l,Fe,"f").autoZoomInMinStep);m=Math.min(m,w);let v=I*m;v=Math.max(U(l,Fe,"f").minValue,v),v=Math.min(U(l,Fe,"f").maxValue,v);try{yield j({factor:v})}catch(T){console.warn(T.message||T)}l.clearBuffer()}}else if(U(l,Fe,"f").autoZoomInFrameArray.length=0,U(l,Fe,"f").frameArrayInIdealZoom.push(!0),U(l,Fe,"f").frameArrayInIdealZoom.splice(0,U(l,Fe,"f").frameArrayInIdealZoom.length-U(l,Fe,"f").frameLimitInIdealZoom[0]),U(l,Fe,"f").frameArrayInIdealZoom.filter(y=>!0===y).length>=U(l,Fe,"f").frameLimitInIdealZoom[1]&&(U(l,Fe,"f").frameArrayInIdealZoom.length=0,U(l,Ut,"f").enhancedFocus)){const y=Te.points;try{yield G({mode:"manual",area:{centerPoint:{x:(y[0].x+y[2].x)/2+"px",y:(y[0].y+y[2].y)/2+"px"},width:y[2].x-y[0].x+"px",height:y[2].y-y[0].y+"px"}})}catch(w){console.warn(w.message||w)}l.clearBuffer()}}if(!U(l,Ut,"f").autoZoom&&U(l,Ut,"f").enhancedFocus&&(U(l,Fe,"f").autoFocusFrameArray.push(!0),U(l,Fe,"f").autoFocusFrameArray.splice(0,U(l,Fe,"f").autoFocusFrameArray.length-U(l,Fe,"f").autoFocusFrameLimit[0]),U(l,Fe,"f").autoFocusFrameArray.filter(Se=>!0===Se).length>=U(l,Fe,"f").autoFocusFrameLimit[1])){U(l,Fe,"f").autoFocusFrameArray.length=0;try{const Se=Te.points;yield G({mode:"manual",area:{centerPoint:{x:(Se[0].x+Se[2].x)/2+"px",y:(Se[0].y+Se[2].y)/2+"px"},width:Se[2].x-Se[0].x+"px",height:Se[2].y-Se[0].y+"px"}})}catch(Se){console.warn(Se.message||Se)}l.clearBuffer()}}else{if(U(l,Ut,"f").autoZoom){if(U(l,Fe,"f").autoZoomInFrameArray.push(!1),U(l,Fe,"f").autoZoomInFrameArray.splice(0,U(l,Fe,"f").autoZoomInFrameArray.length-U(l,Fe,"f").autoZoomInFrameLimit[0]),U(l,Fe,"f").autoZoomOutFrameCount++,U(l,Fe,"f").frameArrayInIdealZoom.push(!1),U(l,Fe,"f").frameArrayInIdealZoom.splice(0,U(l,Fe,"f").frameArrayInIdealZoom.length-U(l,Fe,"f").frameLimitInIdealZoom[0]),U(l,Fe,"f").autoZoomOutFrameCount>=U(l,Fe,"f").autoZoomOutFrameLimit){U(l,Fe,"f").autoZoomOutFrameCount=0;const z=l.getZoomSettings().factor;let Y=z-Math.max((z-1)*U(l,Fe,"f").autoZoomOutStepRate,U(l,Fe,"f").autoZoomOutMinStep);Y=Math.max(U(l,Fe,"f").minValue,Y),Y=Math.min(U(l,Fe,"f").maxValue,Y);try{yield j({factor:Y})}catch(X){console.warn(X.message||X)}l.clearBuffer()}U(l,Ut,"f").enhancedFocus&&G({mode:"continuous"}).catch(()=>{})}!U(l,Ut,"f").autoZoom&&U(l,Ut,"f").enhancedFocus&&(U(l,Fe,"f").autoFocusFrameArray.length=0,G({mode:"continuous"}).catch(()=>{}))}}});return function(g,p){return f.apply(this,arguments)}}(),Oe(this,lr,new jr(1e4),"f")}setCameraView(a){if(!(a instanceof Kt))throw new TypeError("Invalid view.");if(a.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),a._singleFrameMode=this.singleFrameMode,a._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(U(this,Pe,"f")._hideDefaultSelection=!0),U(this,ft,"m",xt).call(this)||U(this,Me,"f").setVideoEl(a.getVideoElement()),Oe(this,Pe,a,"f"),this.addListenerToView()}getCameraView(){return U(this,Pe,"f")}releaseCameraView(){U(this,Pe,"f")&&(this.removeListenerFromView(),U(this,Pe,"f").disposed||(U(this,Pe,"f")._singleFrameMode="disabled",U(this,Pe,"f")._onSingleFrameAcquired=null,U(this,Pe,"f")._hideDefaultSelection=!1),U(this,Me,"f").releaseVideoEl(),Oe(this,Pe,null,"f"))}addListenerToView(){if(!U(this,Pe,"f"))return;if(U(this,Pe,"f").disposed)throw new Error("'cameraView' has been disposed.");const a=U(this,Pe,"f");U(this,ft,"m",xt).call(this)||this.videoSrc||(a._innerComponent&&(U(this,Me,"f").tapFocusEventBoundEl=a._innerComponent),a._selCam&&a._selCam.addEventListener("change",this._onCameraSelChange),a._selRsl&&a._selRsl.addEventListener("change",this._onResolutionSelChange)),a._btnClose&&a._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!U(this,Pe,"f")||U(this,Pe,"f").disposed)return;const a=U(this,Pe,"f");U(this,Me,"f").tapFocusEventBoundEl=null,a._selCam&&a._selCam.removeEventListener("change",this._onCameraSelChange),a._selRsl&&a._selRsl.removeEventListener("change",this._onResolutionSelChange),a._btnClose&&a._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return U(this,ft,"m",xt).call(this)?U(this,hc,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(U(this,Me,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var a=this;return ae(function*(){const l=U(a,Pe,"f");if(null==l?void 0:l.disposed)throw new Error("'cameraView' has been disposed.");l&&(l._singleFrameMode=a.singleFrameMode,U(a,ft,"m",xt).call(a)?l._clickIptSingleFrameMode():(U(a,Me,"f").setVideoEl(l.getVideoElement()),l._startLoading()));let f={width:0,height:0,deviceId:""};if(!U(a,ft,"m",xt).call(a)){try{yield U(a,Me,"f").open()}catch(p){throw l&&l._stopLoading(),p}U(a,to,"f")&&a.turnOnTorch().catch(()=>{});const g=a.getResolution();f.width=g.width,f.height=g.height,f.deviceId=a.getSelectedCamera().deviceId}return Oe(a,hc,"open","f"),l&&(l._innerComponent.style.display="",U(a,ft,"m",xt).call(a)||(l._stopLoading(),l._renderCamerasInfo(a.getSelectedCamera(),U(a,Me,"f")._arrCameras),l._renderResolutionInfo({width:f.width,height:f.height}),l.eventHandler.fire("content:updated",null,{async:!1}),l.eventHandler.fire("videoEl:resized",null,{async:!1}))),U(a,kr,"f").fire("opened",null,{target:a,async:!1}),f})()}close(){const a=U(this,Pe,"f");if(null==a?void 0:a.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),U(this,ft,"m",xt).call(this)||U(this,Me,"f").close(),Oe(this,hc,"closed","f"),U(this,lr,"f").stopCharging(),a&&(a._innerComponent.style.display="none",U(this,ft,"m",xt).call(this)&&a._innerComponent.removeElement("content"),a._stopLoading()),U(this,kr,"f").fire("closed",null,{target:this,async:!1})}pause(){if(U(this,ft,"m",xt).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");U(this,Me,"f").pause()}isPaused(){var a;return!U(this,ft,"m",xt).call(this)&&!0===(null===(a=this.video)||void 0===a?void 0:a.paused)}resume(){var a=this;return ae(function*(){if(U(a,ft,"m",xt).call(a))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield U(a,Me,"f").resume()})()}selectCamera(a){var l=this;return ae(function*(){if(!a)throw new Error("Invalid value.");let f;f="string"==typeof a?a:a.deviceId,yield U(l,Me,"f").setCamera(f),Oe(l,to,!1,"f");const g=l.getResolution(),p=U(l,Pe,"f");return p&&!p.disposed&&(p._stopLoading(),p._renderCamerasInfo(l.getSelectedCamera(),U(l,Me,"f")._arrCameras),p._renderResolutionInfo({width:g.width,height:g.height})),{width:g.width,height:g.height,deviceId:l.getSelectedCamera().deviceId}})()}getSelectedCamera(){return U(this,Me,"f").getCamera()}getAllCameras(){var a=this;return ae(function*(){return U(a,Me,"f").getCameras()})()}setResolution(a){var l=this;return ae(function*(){yield U(l,Me,"f").setResolution(a.width,a.height),U(l,to,"f")&&l.turnOnTorch().catch(()=>{});const f=l.getResolution(),g=U(l,Pe,"f");return g&&!g.disposed&&(g._stopLoading(),g._renderResolutionInfo({width:f.width,height:f.height})),{width:f.width,height:f.height,deviceId:l.getSelectedCamera().deviceId}})()}getResolution(){return U(this,Me,"f").getResolution()}getAvailableResolutions(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getResolutions()}_on(a,l){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(a.toLowerCase())?U(this,kr,"f").on(a,l):U(this,Me,"f").on(a,l)}_off(a,l){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(a.toLowerCase())?U(this,kr,"f").off(a,l):U(this,Me,"f").off(a,l)}on(a,l){const f=a.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._on(g,l)}off(a,l){const f=a.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._off(g,l)}getVideoSettings(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getMediaStreamConstraints()}updateVideoSettings(a){var l=this;return ae(function*(){var f;yield null===(f=U(l,Me,"f"))||void 0===f?void 0:f.setMediaStreamConstraints(a,!0)})()}getCapabilities(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getCameraCapabilities()}getCameraSettings(){return U(this,Me,"f").getCameraSettings()}turnOnTorch(){var a=this;return ae(function*(){var l;if(U(a,ft,"m",xt).call(a))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(l=U(a,Me,"f"))||void 0===l?void 0:l.turnOnTorch(),Oe(a,to,!0,"f")})()}turnOffTorch(){var a=this;return ae(function*(){var l;if(U(a,ft,"m",xt).call(a))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(l=U(a,Me,"f"))||void 0===l?void 0:l.turnOffTorch(),Oe(a,to,!1,"f")})()}setColorTemperature(a){var l=this;return ae(function*(){if(U(l,ft,"m",xt).call(l))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield U(l,Me,"f").setColorTemperature(a,!0)})()}getColorTemperature(){return U(this,Me,"f").getColorTemperature()}setExposureCompensation(a){var l=this;return ae(function*(){var f;if(U(l,ft,"m",xt).call(l))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(f=U(l,Me,"f"))||void 0===f?void 0:f.setExposureCompensation(a,!0)})()}getExposureCompensation(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getExposureCompensation()}_setZoom(a){var l=this;return ae(function*(){var f;if(U(l,ft,"m",xt).call(l))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(f=U(l,Me,"f"))||void 0===f?void 0:f.setZoom(a)})()}setZoom(a){var l=this;return ae(function*(){yield l._setZoom(a)})()}getZoomSettings(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getZoom()}resetZoom(){var a=this;return ae(function*(){var l;if(U(a,ft,"m",xt).call(a))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(l=U(a,Me,"f"))||void 0===l?void 0:l.resetZoom()})()}setFrameRate(a){var l=this;return ae(function*(){var f;if(U(l,ft,"m",xt).call(l))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(f=U(l,Me,"f"))||void 0===f?void 0:f.setFrameRate(a,!0)})()}getFrameRate(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getFrameRate()}setFocus(a){var l=this;return ae(function*(){var f;if(U(l,ft,"m",xt).call(l))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(f=U(l,Me,"f"))||void 0===f?void 0:f.setFocus(a,!0)})()}getFocusSettings(){var a;return null===(a=U(this,Me,"f"))||void 0===a?void 0:a.getFocus()}setAutoZoomRange(a){U(this,Fe,"f").minValue=a.min,U(this,Fe,"f").maxValue=a.max}getAutoZoomRange(){return{min:U(this,Fe,"f").minValue,max:U(this,Fe,"f").maxValue}}enableEnhancedFeatures(a){var l=this;return ae(function*(){var f,g;if(!(null===(g=null===(f=fn.license)||void 0===f?void 0:f.LicenseManager)||void 0===g?void 0:g.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==$t.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");a&hs.EF_ENHANCED_FOCUS&&(U(l,Ut,"f").enhancedFocus=!0),a&hs.EF_AUTO_ZOOM&&(U(l,Ut,"f").autoZoom=!0),a&hs.EF_TAP_TO_FOCUS&&(U(l,Ut,"f").tapToFocus=!0,U(l,Me,"f").enableTapToFocus())})()}disableEnhancedFeatures(a){a&hs.EF_ENHANCED_FOCUS&&(U(this,Ut,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),a&hs.EF_AUTO_ZOOM&&(U(this,Ut,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),a&hs.EF_TAP_TO_FOCUS&&(U(this,Ut,"f").tapToFocus=!1,U(this,Me,"f").disableTapToFocus()),U(this,ft,"m",WD).call(this)&&U(this,ft,"m",GD).call(this)||U(this,lr,"f").stopCharging()}_setScanRegion(a){if(null!=a&&!sm(a)&&!xr(a))throw TypeError("Invalid 'region'.");Oe(this,no,a?JSON.parse(JSON.stringify(a)):null,"f"),U(this,Pe,"f")&&!U(this,Pe,"f").disposed&&U(this,Pe,"f").setScanRegion(a)}setScanRegion(a){this._setScanRegion(a),U(this,Pe,"f")&&!U(this,Pe,"f").disposed&&(null===a?U(this,Pe,"f").setScanRegionMaskVisible(!1):U(this,Pe,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(U(this,no,"f")))}setErrorListener(a){if(!a)throw new TypeError("Invalid 'listener'");Oe(this,dc,a,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!U(this,Me,"f").isVideoLoaded()||U(this,ft,"m",xt).call(this))}startFetching(){if(U(this,ft,"m",xt).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");U(this,Br,"f")||(Oe(this,Br,!0,"f"),U(this,ft,"m",xm).call(this))}stopFetching(){U(this,Br,"f")&&(it._onLog&&it._onLog("DCE: stop fetching loop: "+Date.now()),U(this,oi,"f")&&clearTimeout(U(this,oi,"f")),Oe(this,Br,!1,"f"))}fetchImage(){if(U(this,ft,"m",xt).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const a=this.getResolution();if(!(null==a?void 0:a.width)||!(null==a?void 0:a.height))throw new Error("The video is not loaded.");let l;if(l=Th.convert(U(this,no,"f"),a.width,a.height),l||(l={x:0,y:0,width:a.width,height:a.height}),l.x>a.width||l.y>a.height)throw new Error("Invalid scan region.");l.x+l.width>a.width&&(l.width=a.width-l.x),l.y+l.height>a.height&&(l.height=a.height-l.y);const f={sx:l.x,sy:l.y,sWidth:l.width,sHeight:l.height,dWidth:l.width,dHeight:l.height},g=Math.max(f.dWidth,f.dHeight);if(this.canvasSizeLimit&&g>this.canvasSizeLimit){const b=this.canvasSizeLimit/g;f.dWidth>f.dHeight?(f.dWidth=this.canvasSizeLimit,f.dHeight=Math.round(f.dHeight*b)):(f.dWidth=Math.round(f.dWidth*b),f.dHeight=this.canvasSizeLimit)}const p=U(this,Me,"f").getFrameData({position:f,pixelFormat:zD.get(this.getPixelFormat())});if(!p)return null;let _;_=p.pixelFormat===dt.GREY?p.width:4*p.width;let C=!0;return 0===f.sx&&0===f.sy&&f.sWidth===a.width&&f.sHeight===a.height&&(C=!1),{bytes:p.data,width:p.width,height:p.height,stride:_,format:YD.get(p.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_h.ITT_VIDEO_FRAME,isCropped:C,cropRegion:{left:l.x,top:l.y,right:l.x+l.width,bottom:l.y+l.height,isMeasuredInPercentage:!1},originalWidth:a.width,originalHeight:a.height,currentWidth:p.width,currentHeight:p.height,timeSpent:p.timeSpent,timeStamp:p.timeStamp},toCanvas:U(this,qh,"f"),isDCEFrame:!0}}setImageFetchInterval(a){this.fetchInterval=a,U(this,Br,"f")&&(U(this,oi,"f")&&clearTimeout(U(this,oi,"f")),Oe(this,oi,setTimeout(()=>{this.disposed||U(this,ft,"m",xm).call(this)},a),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(a){Oe(this,Zh,a,"f")}getPixelFormat(){return U(this,Zh,"f")}takePhoto(a){var l=this;if(!this.isOpen())throw new Error("Not open.");if(U(this,ft,"m",xt).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),f.setAttribute("capture",""),f.style.position="absolute",f.style.top="-9999px",f.style.backgroundColor="transparent",f.style.color="transparent",f.addEventListener("click",()=>{const g=this.isOpen();this.close(),window.addEventListener("focus",()=>{g&&this.open(),f.remove()},{once:!0})}),f.addEventListener("change",ae(function*(){const g=f.files[0],p=yield(M=ae(function*(P){let k=null,j=null;if("undefined"!=typeof createImageBitmap)try{if(k=yield createImageBitmap(P),k)return k}catch(z){}var G;return k||(j=yield(G=P,new Promise((z,Y)=>{let X=URL.createObjectURL(G),$=new Image;$.src=X,$.onload=()=>{URL.revokeObjectURL($.src),z($)},$.onerror=K=>{Y(new Error("Can't convert blob to image : "+(K instanceof Event?K.type:K)))}}))),j}),function(P){return M.apply(this,arguments)})(g),_=p instanceof HTMLImageElement?p.naturalWidth:p.width,C=p instanceof HTMLImageElement?p.naturalHeight:p.height;var M;let b=Th.convert(U(l,no,"f"),_,C);b||(b={x:0,y:0,width:_,height:C});const O=U(l,Xh,"f").call(l,p,_,C,b);a&&a(O)})),document.body.appendChild(f),f.click()}convertToPageCoordinates(a){const l=U(this,ft,"m",Am).call(this,a);return{x:l.pageX,y:l.pageY}}convertToClientCoordinates(a){const l=U(this,ft,"m",Am).call(this,a);return{x:l.clientX,y:l.clientY}}dispose(){this.close(),U(this,Me,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let a in this)delete this[a];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function Bn(u,a,l,f){if("a"===l&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof a?u!==a||!f:!a.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?f:"a"===l?f.call(u):f?f.value:a.get(u)}function Gi(u,a,l,f,g){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof a?u!==a||!g:!a.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?g.call(u,l):g?g.value=l:a.set(u,l),l}Tm=it,Me=new WeakMap,Pe=new WeakMap,hc=new WeakMap,kr=new WeakMap,to=new WeakMap,$h=new WeakMap,Xh=new WeakMap,qh=new WeakMap,dc=new WeakMap,no=new WeakMap,Zh=new WeakMap,Br=new WeakMap,oi=new WeakMap,Ut=new WeakMap,Fe=new WeakMap,lr=new WeakMap,Sm=new WeakMap,ft=new WeakSet,xt=function(){return"disabled"!==this.singleFrameMode},GD=function(){return!this.videoSrc&&"opened"===U(this,Me,"f").state},WD=function(){for(let u in U(this,Ut,"f"))if(1==U(this,Ut,"f")[u])return!0;return!1},xm=function u(){if(this.disposed)return;if("open"!==this.getCameraState()||!U(this,Br,"f"))return U(this,oi,"f")&&clearTimeout(U(this,oi,"f")),void Oe(this,oi,setTimeout(()=>{this.disposed||U(this,ft,"m",u).call(this)},this.fetchInterval),"f");const a=()=>{var l;let f;it._onLog&&it._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{f=this.fetchImage()}catch(g){const p=g.message||g;if("The video is not loaded."===p)return;if(null===(l=U(this,dc,"f"))||void 0===l?void 0:l.onErrorReceived)return void setTimeout(()=>{var _;null===(_=U(this,dc,"f"))||void 0===_||_.onErrorReceived(Yp.EC_IMAGE_READ_FAILED,p)},0);console.warn(g)}f?(this.addImageToBuffer(f),it._onLog&&it._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),U(this,kr,"f").fire("frameAddedToBuffer",null,{async:!1})):it._onLog&&it._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case Ws.BOPM_BLOCK:break;case Ws.BOPM_UPDATE:a()}else a();U(this,oi,"f")&&clearTimeout(U(this,oi,"f")),Oe(this,oi,setTimeout(()=>{this.disposed||U(this,ft,"m",u).call(this)},this.fetchInterval),"f")},Am=function(u){if(!U(this,Pe,"f"))throw new Error("Camera view is not set.");if(U(this,Pe,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!U(this,ft,"m",xt).call(this)&&!U(this,Me,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(U(this,ft,"m",xt).call(this)&&!U(this,Pe,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const a=U(this,Pe,"f")._innerComponent.getBoundingClientRect(),l=a.left,f=a.top,g=l+window.scrollX,p=f+window.scrollY,{width:_,height:C}=U(this,Pe,"f")._innerComponent.getBoundingClientRect();if(_<=0||C<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let b,O,M;if(U(this,ft,"m",xt).call(this)){const $=U(this,Pe,"f")._innerComponent.getElement("content");b=$.width,O=$.height,M="contain"}else{const $=this.getVideoEl();b=$.videoWidth,O=$.videoHeight,M=U(this,Pe,"f").getVideoFit()}const P=_/C,k=b/O;let j,G,z,Y,X=1;if("contain"===M)P<k?(X=_/b,j=l+u.x*X,G=f+u.y*X+(C-O*X)/2,z=g+u.x*X,Y=p+u.y*X+(C-O*X)/2):(X=C/O,j=l+u.x*X+(_-b*X)/2,G=f+u.y*X,z=g+u.x*X+(_-b*X)/2,Y=p+u.y*X);else if("cover"===M)if(P<k){X=C/O;let $=u.x*X-(b*X-_)/2;$=Math.max($,0),$=Math.min($,_),j=l+$,G=f+u.y*X,z=g+$,Y=p+u.y*X}else{X=_/b;let $=u.y*X-(O*X-C)/2;$=Math.max($,0),$=Math.min($,C),j=l+u.x*X,G=f+$,z=g+u.x*X,Y=p+$}return{clientX:j,clientY:G,pageX:z,pageY:Y}},it._debug=!1,Im={value:void 0},it.browserInfo=bn,"function"==typeof SuppressedError&&SuppressedError;class ai{static multiply(a,l){const f=[];for(let g=0;g<3;g++){const p=l.slice(3*g,3*g+3);for(let _=0;_<3;_++){const C=[a[_],a[_+3],a[_+6]].reduce((b,O,M)=>b+O*p[M],0);f.push(C)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(a,l,f){return ai.multiply(a,[1,0,0,0,1,0,l,f,1])}static rotate(a,l){var f=Math.cos(l),g=Math.sin(l);return ai.multiply(a,[f,-g,0,g,f,0,0,0,1])}static scale(a,l,f){return ai.multiply(a,[l,0,0,0,f,0,0,0,1])}}var kt,Ur,Vr,Kh,Ea,fc,gc,ba,Qh,bi,$D,Lm,_c,vc;!function(u){u.GREY="grey",u.GREY32="grey32",u.RGBA="rgba",u.RBGA="rbga",u.GRBA="grba",u.GBRA="gbra",u.BRGA="brga",u.BGRA="bgra"}(kt||(kt={}));class Ye{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(Gi(Ye,Ur,!1,"f",Vr),!1):(Gi(Ye,Ur,!0,"f",Vr),!0)}get disposed(){return Bn(this,Qh,"f")}constructor(){Kh.set(this,kt.RGBA),Ea.set(this,null),fc.set(this,null),gc.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,ba.set(this,null),Qh.set(this,!1)}drawImage(a,l,f,g,p,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Bn(Ye,Ur,"f",Vr)&&Ye.checkWebGLSupport(),(null==_?void 0:_.bUseWebGL)&&!Bn(Ye,Ur,"f",Vr))throw new Error("Your browser or machine may not support WebGL.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let C;Ye._onLog&&(C=Date.now(),Ye._onLog("drawImage(), START: "+C));let b=0,O=0,M=f,P=g,k=0,j=0,G=f,z=g;p&&(p.sx&&(b=Math.round(p.sx)),p.sy&&(O=Math.round(p.sy)),p.sWidth&&(M=Math.round(p.sWidth)),p.sHeight&&(P=Math.round(p.sHeight)),p.dx&&(k=Math.round(p.dx)),p.dy&&(j=Math.round(p.dy)),p.dWidth&&(G=Math.round(p.dWidth)),p.dHeight&&(z=Math.round(p.dHeight)));let Y,X=kt.RGBA;if((null==_?void 0:_.pixelFormat)&&(X=_.pixelFormat),(null==_?void 0:_.bufferContainer)&&(Y=_.bufferContainer,Y.length<4*G*z))throw new Error("Unexpected size of the 'bufferContainer'.");const $=a;if(!Bn(Ye,Ur,"f",Vr)||!(this.useWebGLByDefault&&null==(null==_?void 0:_.bUseWebGL)||(null==_?void 0:_.bUseWebGL))){Ye._onLog&&Ye._onLog("drawImage() in context2d."),$.ctx2d||($.ctx2d=$.getContext("2d",{willReadFrequently:!0}));const K=$.ctx2d;if(!K)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return($.width<k+G||$.height<j+z)&&($.width=k+G,$.height=j+z),K.drawImage(l,b,O,M,P,k,j,G,z),Ye._onLog&&Ye._onLog("drawImage() in context2d end. Costs: "+(Date.now()-C)),{context:K,pixelFormat:kt.RGBA,bUseWebGL:!1}}Ye._onLog&&Ye._onLog("drawImage() in WebGL.");try{($.width<k+G||$.height<j+z)&&($.width=k+G,$.height=j+z,$.ctxWebGL&&$.ctxWebGL.viewport(0,0,k+G,j+z));const K=$.ctxWebGL||$.getContext("webgl",{antialias:!1})||$.getContext("experimental-webgl",{antialias:!1});if(!K){Ye._onLog&&Ye._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const F=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw F.name="WebGLError",F}if(!$.ctxWebGL||X!==Bn(this,Kh,"f")){$.ctxWebGL=K;const F=m=>{const v=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,v),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),m.STATIC_DRAW);const T=m.createBuffer();return m.bindBuffer(m.ARRAY_BUFFER,T),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),m.STATIC_DRAW),{positions:v,texCoords:T}},Ce=m=>{const v=m.createTexture();return m.bindTexture(m.TEXTURE_2D,v),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),v},Ne=(m,v)=>{const T=m.createProgram();if(v.forEach(A=>m.attachShader(T,A)),m.linkProgram(T),!m.getProgramParameter(T,m.LINK_STATUS)){const A=new Error(`An error occured linking the program: ${m.getProgramInfoLog(T)}.`);throw A.name="WebGLError",A}return m.useProgram(T),T},Ke=(m,v,T)=>{const A=m.createShader(v);if(m.shaderSource(A,T),m.compileShader(A),!m.getShaderParameter(A,m.COMPILE_STATUS)){const S=new Error(`An error occured compiling the shader: ${m.getShaderInfoLog(A)}.`);throw S.name="WebGLError",S}return A},D="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let y="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(X)&&(y=X.slice(0,3));const w=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${y} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,I=Ne(K,[Ke(K,K.VERTEX_SHADER,D),Ke(K,K.FRAGMENT_SHADER,w)]);Gi(this,fc,{program:I,attribLocations:{vertexPosition:K.getAttribLocation(I,"a_position"),texPosition:K.getAttribLocation(I,"a_texCoord")},uniformLocations:{uSampler:K.getUniformLocation(I,"u_image"),uColorFactor:K.getUniformLocation(I,"uColorFactor"),uMatrix:K.getUniformLocation(I,"u_matrix"),uTextureMatrix:K.getUniformLocation(I,"u_textureMatrix")}},"f"),Gi(this,gc,F(K),"f"),Gi(this,Ea,Ce(K),"f"),Gi(this,Kh,X,"f")}const ge=(F,Ce,Ne)=>{F.bindBuffer(F.ARRAY_BUFFER,Ce),F.enableVertexAttribArray(Ne),F.vertexAttribPointer(Ne,2,F.FLOAT,!1,0,0)},Te=(F,Ce,Ne,Ke)=>{F.clearColor(0,0,0,1),F.clearDepth(1),F.enable(F.DEPTH_TEST),F.depthFunc(F.LEQUAL),F.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),ge(F,Ne.positions,Ce.attribLocations.vertexPosition),ge(F,Ne.texCoords,Ce.attribLocations.texPosition),F.activeTexture(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,Ke),F.uniform1i(Ce.uniformLocations.uSampler,0),F.uniform1f(Ce.uniformLocations.uColorFactor,[kt.GREY,kt.GREY32].includes(X)?1:0);let D,y,w=ai.translate(ai.identity(),-1,-1);w=ai.scale(w,2,2),w=ai.scale(w,1/F.canvas.width,1/F.canvas.height),D=ai.translate(w,k,j),D=ai.scale(D,G,z),F.uniformMatrix3fv(Ce.uniformLocations.uMatrix,!1,D),y=ai.translate(ai.identity(),b/f,O/g),y=ai.scale(y,M/f,P/g),F.uniformMatrix3fv(Ce.uniformLocations.uTextureMatrix,!1,y),F.drawArrays(F.TRIANGLES,0,6)};((F,Ce,Ne)=>{const Ke=F.RGBA,D=F.RGBA,y=F.UNSIGNED_BYTE;F.bindTexture(F.TEXTURE_2D,Ce),F.texImage2D(F.TEXTURE_2D,0,Ke,D,y,Ne)})(K,Bn(this,Ea,"f"),l),Te(K,Bn(this,fc,"f"),Bn(this,gc,"f"),Bn(this,Ea,"f"));const Se=Y||new Uint8Array(4*G*z);if(K.readPixels(k,j,G,z,K.RGBA,K.UNSIGNED_BYTE,Se),255!==Se[3]){Ye._onLog&&Ye._onLog("Incorrect WebGL drawing .");const F=new Error("WebGL error: incorrect drawing.");throw F.name="WebGLError",F}return Ye._onLog&&Ye._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-C)),{context:K,pixelFormat:X===kt.GREY?kt.GREY32:X,bUseWebGL:!0}}catch(K){if(this.forceLoseContext(),null==(null==_?void 0:_.bUseWebGL))return Ye._onLog&&Ye._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(a,l,f,g,p,Object.assign({},_,{bUseWebGL:!1}));throw K.name="WebGLError",K}}readCvsData(a,l,f){if(!(a instanceof CanvasRenderingContext2D||a instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,p=0,_=0,C=a.canvas.width,b=a.canvas.height;if(l&&(l.x&&(p=l.x),l.y&&(_=l.y),l.width&&(C=l.width),l.height&&(b=l.height)),(null==f?void 0:f.length)<4*C*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(a instanceof WebGLRenderingContext){const O=a;f?(O.readPixels(p,_,C,b,O.RGBA,O.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*C*b)):(g=new Uint8Array(4*C*b),O.readPixels(p,_,C,b,O.RGBA,O.UNSIGNED_BYTE,g))}else if(a instanceof CanvasRenderingContext2D){let O;O=a.getImageData(p,_,C,b),g=new Uint8Array(O.data.buffer),null==f||f.set(g)}return g}transformPixelFormat(a,l,f,g){let p,_;if(Ye._onLog&&(p=Date.now(),Ye._onLog("transformPixelFormat(), START: "+p)),l===f)return Ye._onLog&&Ye._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),g?new Uint8Array(a):a;const C=[kt.RGBA,kt.RBGA,kt.GRBA,kt.GBRA,kt.BRGA,kt.BGRA];if(C.includes(l))if(f===kt.GREY){_=new Uint8Array(a.length/4);for(let b=0;b<a.length;b+=4)_[b/4]=.21*a[b]+.71*a[b+1]+.07*a[b+2]}else if(f===kt.GREY32){_=g?new Uint8Array(a):a;for(let b=0;b<a.length;b+=4){const O=.21*a[b]+.71*a[b+1]+.07*a[b+2];_[b]=O,_[b+1]=O,_[b+2]=O}}else{if(!C.includes(f))throw new Error("Unable to transform.");if(g){_=new Uint8Array(a);const b=l.indexOf("r"),O=l.indexOf("g"),M=l.indexOf("b"),P=f.indexOf("r"),k=f.indexOf("g"),j=f.indexOf("b");for(let G=0;G<a.length;G+=4)_[G+P]=a[G+b],_[G+k]=a[G+O],_[G+j]=a[G+M]}else{_=a;const b=l.indexOf("r"),O=l.indexOf("g"),M=l.indexOf("b"),P=f.indexOf("r"),k=f.indexOf("g"),j=f.indexOf("b");for(let G=0;G<a.length;G+=4){let z=[a[G],a[G+1],a[G+2]];_[G+P]=z[b],_[G+k]=z[O],_[G+j]=z[M]}}}else if(l===kt.GREY){if(f!==kt.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*a.length);for(let b=0;b<a.length;b++)_[4*b]=a[b],_[4*b+1]=a[b],_[4*b+2]=a[b],_[4*b+3]=255}else{if(l!==kt.GREY32)throw new Error("Unable to transform.");if(f!==kt.GREY)throw new Error("Unable to transform.");_=new Uint8Array(a.length/4);for(let b=0;b<a.length;b+=4)_[b/4]=a[b]}return Ye._onLog&&Ye._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),_}getImageData(a,l,f,g,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!l||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Bn(Ye,Ur,"f",Vr)&&Ye.checkWebGLSupport(),(null==p?void 0:p.bUseWebGL)&&!Bn(Ye,Ur,"f",Vr))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>l||g.sy>f||g.sx+g.sWidth>l||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(a instanceof HTMLVideoElement&&4!==a.readyState||a instanceof HTMLImageElement&&!a.complete)throw new Error("The source is not loaded.");let _;Ye._onLog&&(_=Date.now(),Ye._onLog("getImageData(), START: "+_));const C=Math.round(g.sx),b=Math.round(g.sy),O=Math.round(g.sWidth),M=Math.round(g.sHeight),P=Math.round(g.dWidth),k=Math.round(g.dHeight);let j=kt.RGBA;(null==p?void 0:p.pixelFormat)&&(j=p.pixelFormat);let G,z,Y,X=null;if((null==p?void 0:p.bufferContainer)&&(X=p.bufferContainer),Bn(Ye,Ur,"f",Vr)&&(this.useWebGLByDefault&&null==(null==p?void 0:p.bUseWebGL)||(null==p?void 0:p.bUseWebGL))){Ye._onLog&&Ye._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),G=this._reusedWebGLCvs;try{if(X)if(j===kt.GREY){if(Y=new Uint8Array(4*P*k),z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Y}),Y=this.transformPixelFormat(Y,z.pixelFormat,j),X){if(X.length<Y.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(Y)}}else z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:X}),Y=new Uint8Array(X.buffer,0,4*P*k),Y=this.transformPixelFormat(Y,z.pixelFormat,j);else j===kt.GREY?((!Bn(this,ba,"f")||Bn(this,ba,"f").length<4*P*k)&&Gi(this,ba,new Uint8Array(4*P*k),"f"),Y=new Uint8Array(Bn(this,ba,"f").buffer,0,4*P*k)):Y=new Uint8Array(4*P*k),z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:Y}),Y=this.transformPixelFormat(Y,z.pixelFormat,j)}catch($){if("WebGLError"===$.name&&(this.forceLoseContext(),null==(null==p?void 0:p.bUseWebGL)))return Ye._onLog&&Ye._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},Object.assign({},p,{bUseWebGL:!1}));throw $}}else if(Ye._onLog&&Ye._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),G=this._reusedCvs,z=this.drawImage(G,a,l,f,{sx:C,sy:b,sWidth:O,sHeight:M,dWidth:P,dHeight:k},{pixelFormat:kt.RGBA,bUseWebGL:!1}),Y=this.readCvsData(z.context,{width:P,height:k},null),Y=this.transformPixelFormat(Y,z.pixelFormat,j),X){if(X.length<Y.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(Y)}return Ye._onLog&&Ye._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:Y,pixelFormat:j,width:P,height:k,bUseWebGL:z.bUseWebGL}}convertDataToCvs(a,l,f,g){if(!(a instanceof Uint8Array||a instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof l||l<=0)throw new Error("Invalid 'width'.");if("number"!=typeof f||f<=0)throw new Error("Invalid 'height'.");const p=document.createElement("canvas");let _;if(p.width=l,p.height=f,g===kt.GREY){_=new Uint8ClampedArray(4*l*f);for(let b=0;b<_.length;b+=4)_[b]=a[b/4],_[b+1]=a[b/4],_[b+2]=a[b/4],_[b+3]=255}else _=new Uint8ClampedArray(a.buffer);const C=new ImageData(_,l,f);return p.getContext("2d").putImageData(C,0,0),p}forceLoseContext(){if(!this._reusedWebGLCvs)return;const a=this._reusedWebGLCvs.ctxWebGL;a&&!a.isContextLost()&&a.getExtension("WEBGL_lose_context")&&a.getExtension("WEBGL_lose_context").loseContext(),Gi(this,Ea,null,"f"),Gi(this,fc,null,"f"),Gi(this,gc,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Gi(this,Qh,!0,"f")}}Ur=Ye,Kh=new WeakMap,Ea=new WeakMap,fc=new WeakMap,gc=new WeakMap,ba=new WeakMap,Qh=new WeakMap,Vr={value:void 0};class Ta{static beep(){if(!this.beepSoundSource)return;let a;if(U(this,bi,"f",_c).size&&(a=U(this,bi,"f",_c).values().next().value,this.beepSoundSource==a.src?(U(this,bi,"f",_c).delete(a),a.play()):a=null),!a)if(U(this,bi,"f",vc).size<64){a=new Audio(this.beepSoundSource);let l=null,f=()=>{a.removeEventListener("loadedmetadata",f),a.play(),l=setTimeout(()=>{U(this,bi,"f",vc).delete(a)},2e3*a.duration)};a.addEventListener("loadedmetadata",f),a.addEventListener("ended",()=>{null!=l&&(clearTimeout(l),l=null),a.pause(),a.currentTime=0,U(this,bi,"f",vc).delete(a),U(this,bi,"f",_c).add(a)})}else U(this,bi,"f",Lm)||(Oe(this,bi,!0,"f",Lm),console.warn("The requested audio tracks exceed 64 and will not be played."));a&&U(this,bi,"f",vc).add(a)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Ta.vibrateDuration)}}bi=Ta,$D={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},Lm={value:!1},_c={value:new Set},vc={value:new Set},Ta.beepSoundSource=U(Ta,bi,"f",$D),Ta.vibrateDuration=300;const qD="undefined"==typeof self,Fm=(()=>{if(!qD&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})(),ZD=u=>{if(null==u&&(u="./"),!qD){let a=document.createElement("a");a.href=u,u=a.href}return u.endsWith("/")||(u+="/"),u};null==Ze.dbr&&(Ze.dbr=Fm),cs.dbr={js:!1,wasm:!0,deps:["license","dip"]},fn.dbr={};"string"!=typeof Ze.std&&zs(Ze.std.version,"1.2.0")<0&&(Ze.std={version:"1.2.0",path:ZD(Fm+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const Nm="2.2.10";var KD,QD,JD,eT;(!Ze.dip||"string"!=typeof Ze.dip&&zs(Ze.dip.version,Nm)<0)&&(Ze.dip={version:Nm,path:ZD(Fm+`../../dynamsoft-image-processing@${Nm}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(u){u[u.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",u[u.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",u[u.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(KD||(KD={})),function(u){u[u.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",u[u.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",u[u.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",u[u.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(QD||(QD={})),function(u){u[u.LM_AUTO=1]="LM_AUTO",u[u.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",u[u.LM_STATISTICS=4]="LM_STATISTICS",u[u.LM_LINES=8]="LM_LINES",u[u.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",u[u.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",u[u.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",u[u.LM_CENTRE=128]="LM_CENTRE",u[u.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",u[u.LM_REV=-2147483648]="LM_REV",u[u.LM_SKIP=0]="LM_SKIP"}(JD||(JD={})),function(u){u[u.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",u[u.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",u[u.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",u[u.DM_SMOOTHING=8]="DM_SMOOTHING",u[u.DM_MORPHING=16]="DM_MORPHING",u[u.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",u[u.DM_SHARPENING=64]="DM_SHARPENING",u[u.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",u[u.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",u[u.DM_REV=-2147483648]="DM_REV",u[u.DM_SKIP=0]="DM_SKIP"}(eT||(eT={}));const nT="undefined"==typeof self,km=(()=>{if(!nT&&document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}return u.substring(0,u.lastIndexOf("/")+1)}return"./"})(),iT=u=>{if(null==u&&(u="./"),!nT){let a=document.createElement("a");a.href=u,u=a.href}return u.endsWith("/")||(u+="/"),u};null==Ze.utility&&(Ze.utility=km),cs.utility={js:!0,wasm:!0};const Bm="1.2.10";"string"!=typeof Ze.std&&zs(Ze.std.version,Bm)<0&&(Ze.std={version:Bm,path:iT(km+`../../dynamsoft-capture-vision-std@${Bm}/dist/`)});const jm="2.2.30";(!Ze.dip||"string"!=typeof Ze.dip&&zs(Ze.dip.version,jm)<0)&&(Ze.dip={version:jm,path:iT(km+`../../dynamsoft-image-processing@${jm}/dist/`)});let Cs="./";if(document.currentScript){let u=document.currentScript.src,a=u.indexOf("?");if(-1!=a)u=u.substring(0,a);else{let l=u.indexOf("#");-1!=l&&(u=u.substring(0,l))}Cs=u.substring(0,u.lastIndexOf("/")+1)}const io=u=>{null==u&&(u="./");let a=document.createElement("a");return a.href=u,(u=a.href).endsWith("/")||(u+="/"),u};$t.engineResourcePaths={std:io(Cs+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:io(Cs+"../../dynamsoft-image-processing@2.2.30/dist/"),core:io(Cs+"../../dynamsoft-core@3.2.30/dist/"),license:io(Cs+"../../dynamsoft-license@3.2.21/dist/"),cvr:io(Cs+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:io(Cs+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:io(Cs+"../../dynamsoft-barcode-reader@10.2.10/dist/")},$t.engineResourcePaths={std:"assets/dynamsoft-capture-vision-std/",dip:"assets/dynamsoft-image-processing/",core:"assets/dynamsoft-core/",license:"assets/dynamsoft-license/",cvr:"assets/dynamsoft-capture-vision-router/",dbr:"assets/dynamsoft-barcode-reader/",dce:"assets/dynamsoft-camera-enhancer/"},Mt.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ==",!0),$t.loadWasm(["DBR"]);const A2=[{id:"reader",name:"Barcode and QR Code Reader",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner",description:"Scan barcode and QR code from camera stream"}],R2=function(){return["/barcode-reader"]};function O2(u,a){if(1&u&&(mn(0,"div")(1,"a",4),yr(2),un()()),2&u){const l=_u().$implicit;Jr(1),Qi("title",l.name+" details")("routerLink",Su(3,R2)),Jr(1),Go("> ",l.name," ")}}const M2=function(){return["/barcode-scanner"]};function L2(u,a){if(1&u&&(mn(0,"a",4),yr(1),un()),2&u){const l=_u().$implicit;Qi("title",l.name+" details")("routerLink",Su(3,M2)),Jr(1),Go("> ",l.name," ")}}function F2(u,a){if(1&u&&(mn(0,"p"),yr(1),un()),2&u){const l=_u().$implicit;Jr(1),Go("Description: ",l.description,"")}}function P2(u,a){if(1&u&&(mn(0,"div")(1,"h3"),ul(2,O2,3,4,"div",1),ul(3,L2,2,4,"ng-template",null,2,dw),un(),ul(5,F2,2,1,"p",3),un()),2&u){const l=a.$implicit,f=function u0(u){return function uo(u,a){return u[a]}(function AI(){return Xe.lFrame.contextLView}(),20+u)}(4);Jr(2),Qi("ngIf","reader"===l.id)("ngIfElse",f),Jr(3),Qi("ngIf",l.description)}}let N2=(()=>{class u{constructor(){this.products=A2}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["app-product-list"]],decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["elseBlock",""],[4,"ngIf"],[3,"title","routerLink"]],template:function(l,f){1&l&&(mn(0,"h2"),yr(1,"Examples"),un(),ul(2,P2,6,3,"div",0)),2&l&&(Jr(2),Qi("ngForOf",f.products))},directives:[fE,pE,jl],styles:[""]}),u})();class rT{initOverlay(a){this.overlay=a,this.context=this.overlay.getContext("2d")}updateOverlay(a,l){this.overlay&&(this.overlay.width=a,this.overlay.height=l,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(a,l){if(this.context){let f=a.points;this.context.beginPath(),this.context.moveTo(f[0].x,f[0].y),this.context.lineTo(f[1].x,f[1].y),this.context.lineTo(f[2].x,f[2].y),this.context.lineTo(f[3].x,f[3].y),this.context.lineTo(f[0].x,f[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let g=[f[0].x,f[1].x,f[2].x,f[3].x],p=[f[0].y,f[1].y,f[2].y,f[3].y];g.sort(function(b,O){return b-O}),p.sort(function(b,O){return O-b}),this.context.fillText(l,g[0],p[0]+50)}}}let k2=(()=>{class u{constructor(){this.isLoaded=!1,this.overlayManager=new rT}ngOnInit(){var l=this;this.overlayManager.initOverlay(document.getElementById("overlay")),ae(function*(){l.cvr=yield Ct.createInstance(),l.isLoaded=!0})()}onChange(l){let g=l.currentTarget.files;if(g){let p=g.item(0);if(p){let _=new FileReader;_.onload=C=>{let b=document.getElementById("image");if(b){b.src=C.target.result;const O=new Image;O.onload=M=>{this.overlayManager.updateOverlay(O.width,O.height),this.cvr&&this.cvr.capture(p,"ReadBarcodes_Balance").then(P=>{console.log(P);let k=[],j=document.getElementById("result");try{let z,Y=P.items;if(Y.length>0){for(var G=0;G<Y.length;++G){if(Y[G].type!==Xt.CRIT_BARCODE)continue;let X=Y[G];k.push(X.text),z=X.location,console.log(z),this.overlayManager.drawOverlay(z,X.text)}j&&(j.innerHTML=k.join(", "))}else j&&(j.innerHTML=k.join(", "))}catch(z){alert(z)}})},O.src=C.target.result}},_.readAsDataURL(p)}}}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["app-barcode-reader"]],decls:9,vars:1,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(l,f){1&l&&(mn(0,"span",0),yr(1,"Loading Library..."),un(),Ji(2,"br"),mn(3,"input",1),Vo("change",function(p){return f.onChange(p)}),un(),mn(4,"div"),Ji(5,"a",2),un(),mn(6,"div",3),Ji(7,"img",4)(8,"canvas",5),un()),2&l&&Qi("hidden",f.isLoaded)},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),u})();const B2=[{path:"",component:N2},{path:"barcode-reader",component:k2},{path:"barcode-scanner",component:(()=>{class u{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new rT}ngOnInit(){var l=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),ae(function*(){yield l.initBarcodeScanner()})()}ngOnDestroy(){var l,f;this.isDestroyed=!0;try{null===(l=this.cvr)||void 0===l||l.dispose(),null===(f=this.cameraEnhancer)||void 0===f||f.dispose()}catch(g){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let l=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(l.width,l.height)}}initBarcodeScanner(){var l=this;return ae(function*(){var f,g,p,_;const C=yield Kt.createInstance();l.cameraEnhancer=yield it.createInstance(C),l.isLoaded=!0;let b=document.getElementById("videoContainer");if(b){b.append(C.getUIElement()),null===(g=null===(f=C.getUIElement().shadowRoot)||void 0===f?void 0:f.querySelector(".dce-sel-camera"))||void 0===g||g.setAttribute("style","display: none"),null===(_=null===(p=C.getUIElement().shadowRoot)||void 0===p?void 0:p.querySelector(".dce-sel-resolution"))||void 0===_||_.setAttribute("style","display: none");let O=yield l.cameraEnhancer.getAllCameras();if(l.listCameras(O),l.cvr=yield Ct.createInstance(),l.isDestroyed||(l.cvr.setInput(l.cameraEnhancer),l.cvr.addResultReceiver({onCapturedResultReceived:M=>{l.overlayManager.clearOverlay();let P=[],k=document.getElementById("result");try{let G,z=M.items;if(z.length>0){for(var j=0;j<z.length;++j){if(z[j].type!==Xt.CRIT_BARCODE)continue;let Y=z[j];P.push(Y.text),G=Y.location,console.log(G),l.overlayManager.drawOverlay(G,Y.text)}k&&(k.innerHTML=P.join(", "))}else k&&(k.innerHTML=P.join(", "))}catch(G){alert(G)}}}),l.cvr.addResultReceiver({onDecodedBarcodesReceived:M=>{!M.barcodeResultItems.length||console.log(M)}}),l.cameraEnhancer.on("played",()=>{l.updateResolution()}),yield l.openCamera(),l.isDestroyed)||(yield l.cvr.startCapturing("ReadSingleBarcode"),l.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var l=this;return ae(function*(){if(l.overlayManager.clearOverlay(),l.videoSelect){let f=l.videoSelect.value;l.cameraEnhancer&&(yield l.cameraEnhancer.selectCamera(f),yield l.cameraEnhancer.open())}})()}listCameras(l){for(var f=0;f<l.length;++f){var g=l[f],p=document.createElement("option");p.value=g.deviceId,p.text=g.label,this.cameraInfo[g.deviceId]=g,this.videoSelect&&this.videoSelect.appendChild(p)}}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["app-barcode-scanner"]],decls:10,vars:1,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"]],template:function(l,f){1&l&&(mn(0,"span",0),yr(1,"Loading Library..."),un(),Ji(2,"br"),mn(3,"div",1)(4,"label",2),yr(5,"Video source: "),un(),mn(6,"select",3),Vo("change",function(){return f.openCamera()}),un()(),mn(7,"div",4),Ji(8,"div",5)(9,"canvas",6),un()),2&l&&Qi("hidden",f.isLoaded)},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),u})()}];let j2=(()=>{class u{}return u.\u0275fac=function(l){return new(l||u)},u.\u0275mod=Ts({type:u}),u.\u0275inj=Gr({imports:[[kb.forRoot(B2)],kb]}),u})();const U2=function(){return["/"]};let V2=(()=>{class u{constructor(){}ngOnInit(){}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(l,f){1&l&&(mn(0,"a",0)(1,"h1"),yr(2,"Dynamsoft Barcode Reader and Scanner"),un()()),2&l&&Qi("routerLink",Su(1,U2))},directives:[jl],styles:[""]}),u})(),H2=(()=>{class u{constructor(){this.title="angular-barcode-qr-code-scanner"}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275cmp=Yr({type:u,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(l,f){1&l&&(Ji(0,"app-top-bar"),mn(1,"div",0),Ji(2,"router-outlet"),un())},directives:[V2,Lp],styles:[""]}),u})(),G2=(()=>{class u{}return u.\u0275fac=function(l){return new(l||u)},u.\u0275mod=Ts({type:u,bootstrap:[H2]}),u.\u0275inj=Gr({providers:[],imports:[[mP,j2]]}),u})();(function QM(){Gw=!1})(),gP().bootstrapModule(G2).catch(u=>console.error(u))}},Lt=>{Lt(Lt.s=4)}]);