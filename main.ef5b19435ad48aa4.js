"use strict";(self.webpackChunkangular_barcode_qr_code_scanner=self.webpackChunkangular_barcode_qr_code_scanner||[]).push([[179],{380:()=>{function Ut(f){return"function"==typeof f}function Ka(f){const u=f(g=>{Error.call(g),g.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}const Kc=Ka(f=>function(u){f(this),this.message=u?`${u.length} errors occurred during unsubscription:\n${u.map((g,p)=>`${p+1}) ${g.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=u});function Qa(f,l){if(f){const u=f.indexOf(l);0<=u&&f.splice(u,1)}}class Di{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:u}=this;if(u)if(this._parentage=null,Array.isArray(u))for(const m of u)m.remove(this);else u.remove(this);const{initialTeardown:g}=this;if(Ut(g))try{g()}catch(m){l=m instanceof Kc?m.errors:[m]}const{_finalizers:p}=this;if(p){this._finalizers=null;for(const m of p)try{hv(m)}catch(v){l=null!=l?l:[],v instanceof Kc?l=[...l,...v.errors]:l.push(v)}}if(l)throw new Kc(l)}}add(l){var u;if(l&&l!==this)if(this.closed)hv(l);else{if(l instanceof Di){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=null!==(u=this._finalizers)&&void 0!==u?u:[]).push(l)}}_hasParent(l){const{_parentage:u}=this;return u===l||Array.isArray(u)&&u.includes(l)}_addParent(l){const{_parentage:u}=this;this._parentage=Array.isArray(u)?(u.push(l),u):u?[u,l]:l}_removeParent(l){const{_parentage:u}=this;u===l?this._parentage=null:Array.isArray(u)&&Qa(u,l)}remove(l){const{_finalizers:u}=this;u&&Qa(u,l),l instanceof Di&&l._removeParent(this)}}Di.EMPTY=(()=>{const f=new Di;return f.closed=!0,f})();const cv=Di.EMPTY;function uv(f){return f instanceof Di||f&&"closed"in f&&Ut(f.remove)&&Ut(f.add)&&Ut(f.unsubscribe)}function hv(f){Ut(f)?f():f.unsubscribe()}const Ws={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Qc={setTimeout(f,l,...u){const{delegate:g}=Qc;return(null==g?void 0:g.setTimeout)?g.setTimeout(f,l,...u):setTimeout(f,l,...u)},clearTimeout(f){const{delegate:l}=Qc;return((null==l?void 0:l.clearTimeout)||clearTimeout)(f)},delegate:void 0};function dv(f){Qc.setTimeout(()=>{const{onUnhandledError:l}=Ws;if(!l)throw f;l(f)})}function fv(){}const VT=Wd("C",void 0,void 0);function Wd(f,l,u){return{kind:f,value:l,error:u}}let zs=null;function Jc(f){if(Ws.useDeprecatedSynchronousErrorHandling){const l=!zs;if(l&&(zs={errorThrown:!1,error:null}),f(),l){const{errorThrown:u,error:g}=zs;if(zs=null,u)throw g}}else f()}class zd extends Di{constructor(l){super(),this.isStopped=!1,l?(this.destination=l,uv(l)&&l.add(this)):this.destination=YT}static create(l,u,g){return new eu(l,u,g)}next(l){this.isStopped?$d(function UT(f){return Wd("N",f,void 0)}(l),this):this._next(l)}error(l){this.isStopped?$d(function jT(f){return Wd("E",void 0,f)}(l),this):(this.isStopped=!0,this._error(l))}complete(){this.isStopped?$d(VT,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(l){this.destination.next(l)}_error(l){try{this.destination.error(l)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const HT=Function.prototype.bind;function Yd(f,l){return HT.call(f,l)}class WT{constructor(l){this.partialObserver=l}next(l){const{partialObserver:u}=this;if(u.next)try{u.next(l)}catch(g){tu(g)}}error(l){const{partialObserver:u}=this;if(u.error)try{u.error(l)}catch(g){tu(g)}else tu(l)}complete(){const{partialObserver:l}=this;if(l.complete)try{l.complete()}catch(u){tu(u)}}}class eu extends zd{constructor(l,u,g){let p;if(super(),Ut(l)||!l)p={next:null!=l?l:void 0,error:null!=u?u:void 0,complete:null!=g?g:void 0};else{let m;this&&Ws.useDeprecatedNextContext?(m=Object.create(l),m.unsubscribe=()=>this.unsubscribe(),p={next:l.next&&Yd(l.next,m),error:l.error&&Yd(l.error,m),complete:l.complete&&Yd(l.complete,m)}):p=l}this.destination=new WT(p)}}function tu(f){Ws.useDeprecatedSynchronousErrorHandling?function GT(f){Ws.useDeprecatedSynchronousErrorHandling&&zs&&(zs.errorThrown=!0,zs.error=f)}(f):dv(f)}function $d(f,l){const{onStoppedNotification:u}=Ws;u&&Qc.setTimeout(()=>u(f,l))}const YT={closed:!0,next:fv,error:function zT(f){throw f},complete:fv},Xd="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ys(f){return f}let dn=(()=>{class f{constructor(u){u&&(this._subscribe=u)}lift(u){const g=new f;return g.source=this,g.operator=u,g}subscribe(u,g,p){const m=function XT(f){return f&&f instanceof zd||function $T(f){return f&&Ut(f.next)&&Ut(f.error)&&Ut(f.complete)}(f)&&uv(f)}(u)?u:new eu(u,g,p);return Jc(()=>{const{operator:v,source:y}=this;m.add(v?v.call(m,y):y?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(u){try{return this._subscribe(u)}catch(g){u.error(g)}}forEach(u,g){return new(g=pv(g))((p,m)=>{const v=new eu({next:y=>{try{u(y)}catch(b){m(b),v.unsubscribe()}},error:m,complete:p});this.subscribe(v)})}_subscribe(u){var g;return null===(g=this.source)||void 0===g?void 0:g.subscribe(u)}[Xd](){return this}pipe(...u){return function gv(f){return 0===f.length?Ys:1===f.length?f[0]:function(u){return f.reduce((g,p)=>p(g),u)}}(u)(this)}toPromise(u){return new(u=pv(u))((g,p)=>{let m;this.subscribe(v=>m=v,v=>p(v),()=>g(m))})}}return f.create=l=>new f(l),f})();function pv(f){var l;return null!==(l=null!=f?f:Ws.Promise)&&void 0!==l?l:Promise}const qT=Ka(f=>function(){f(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Fr=(()=>{class f extends dn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(u){const g=new mv(this,this);return g.operator=u,g}_throwIfClosed(){if(this.closed)throw new qT}next(u){Jc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const g of this.currentObservers)g.next(u)}})}error(u){Jc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=u;const{observers:g}=this;for(;g.length;)g.shift().error(u)}})}complete(){Jc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:u}=this;for(;u.length;)u.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var u;return(null===(u=this.observers)||void 0===u?void 0:u.length)>0}_trySubscribe(u){return this._throwIfClosed(),super._trySubscribe(u)}_subscribe(u){return this._throwIfClosed(),this._checkFinalizedStatuses(u),this._innerSubscribe(u)}_innerSubscribe(u){const{hasError:g,isStopped:p,observers:m}=this;return g||p?cv:(this.currentObservers=null,m.push(u),new Di(()=>{this.currentObservers=null,Qa(m,u)}))}_checkFinalizedStatuses(u){const{hasError:g,thrownError:p,isStopped:m}=this;g?u.error(p):m&&u.complete()}asObservable(){const u=new dn;return u.source=this,u}}return f.create=(l,u)=>new mv(l,u),f})();class mv extends Fr{constructor(l,u){super(),this.destination=l,this.source=u}next(l){var u,g;null===(g=null===(u=this.destination)||void 0===u?void 0:u.next)||void 0===g||g.call(u,l)}error(l){var u,g;null===(g=null===(u=this.destination)||void 0===u?void 0:u.error)||void 0===g||g.call(u,l)}complete(){var l,u;null===(u=null===(l=this.destination)||void 0===l?void 0:l.complete)||void 0===u||u.call(l)}_subscribe(l){var u,g;return null!==(g=null===(u=this.source)||void 0===u?void 0:u.subscribe(l))&&void 0!==g?g:cv}}function _v(f){return Ut(null==f?void 0:f.lift)}function An(f){return l=>{if(_v(l))return l.lift(function(u){try{return f(u,this)}catch(g){this.error(g)}});throw new TypeError("Unable to lift unknown Observable type")}}function Sn(f,l,u,g,p){return new ZT(f,l,u,g,p)}class ZT extends zd{constructor(l,u,g,p,m,v){super(l),this.onFinalize=m,this.shouldUnsubscribe=v,this._next=u?function(y){try{u(y)}catch(b){l.error(b)}}:super._next,this._error=p?function(y){try{p(y)}catch(b){l.error(b)}finally{this.unsubscribe()}}:super._error,this._complete=g?function(){try{g()}catch(y){l.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var l;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:u}=this;super.unsubscribe(),!u&&(null===(l=this.onFinalize)||void 0===l||l.call(this))}}}function Gt(f,l){return An((u,g)=>{let p=0;u.subscribe(Sn(g,m=>{g.next(f.call(l,m,p++))}))})}function $s(f){return this instanceof $s?(this.v=f,this):new $s(f)}function JT(f,l,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p,g=u.apply(f,l||[]),m=[];return p={},v("next"),v("throw"),v("return"),p[Symbol.asyncIterator]=function(){return this},p;function v(k){g[k]&&(p[k]=function(j){return new Promise(function(H,z){m.push([k,j,H,z])>1||y(k,j)})})}function y(k,j){try{!function b(k){k.value instanceof $s?Promise.resolve(k.value.v).then(A,L):N(m[0][2],k)}(g[k](j))}catch(H){N(m[0][3],H)}}function A(k){y("next",k)}function L(k){y("throw",k)}function N(k,j){k(j),m.shift(),m.length&&y(m[0][0],m[0][1])}}function ex(f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,l=f[Symbol.asyncIterator];return l?l.call(f):(f=function Cv(f){var l="function"==typeof Symbol&&Symbol.iterator,u=l&&f[l],g=0;if(u)return u.call(f);if(f&&"number"==typeof f.length)return{next:function(){return f&&g>=f.length&&(f=void 0),{value:f&&f[g++],done:!f}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}(f),u={},g("next"),g("throw"),g("return"),u[Symbol.asyncIterator]=function(){return this},u);function g(m){u[m]=f[m]&&function(v){return new Promise(function(y,b){!function p(m,v,y,b){Promise.resolve(b).then(function(A){m({value:A,done:y})},v)}(y,b,(v=f[m](v)).done,v.value)})}}}const wv=f=>f&&"number"==typeof f.length&&"function"!=typeof f;function Ev(f){return Ut(null==f?void 0:f.then)}function bv(f){return Ut(f[Xd])}function Dv(f){return Symbol.asyncIterator&&Ut(null==f?void 0:f[Symbol.asyncIterator])}function Sv(f){return new TypeError(`You provided ${null!==f&&"object"==typeof f?"an invalid object":`'${f}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Iv=function nx(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Tv(f){return Ut(null==f?void 0:f[Iv])}function xv(f){return JT(this,arguments,function*(){const u=f.getReader();try{for(;;){const{value:g,done:p}=yield $s(u.read());if(p)return yield $s(void 0);yield yield $s(g)}}finally{u.releaseLock()}})}function Av(f){return Ut(null==f?void 0:f.getReader)}function hr(f){if(f instanceof dn)return f;if(null!=f){if(bv(f))return function ix(f){return new dn(l=>{const u=f[Xd]();if(Ut(u.subscribe))return u.subscribe(l);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(f);if(wv(f))return function rx(f){return new dn(l=>{for(let u=0;u<f.length&&!l.closed;u++)l.next(f[u]);l.complete()})}(f);if(Ev(f))return function sx(f){return new dn(l=>{f.then(u=>{l.closed||(l.next(u),l.complete())},u=>l.error(u)).then(null,dv)})}(f);if(Dv(f))return Rv(f);if(Tv(f))return function ox(f){return new dn(l=>{for(const u of f)if(l.next(u),l.closed)return;l.complete()})}(f);if(Av(f))return function ax(f){return Rv(xv(f))}(f)}throw Sv(f)}function Rv(f){return new dn(l=>{(function lx(f,l){var u,g,p,m;return function KT(f,l,u,g){return new(u||(u=Promise))(function(m,v){function y(L){try{A(g.next(L))}catch(N){v(N)}}function b(L){try{A(g.throw(L))}catch(N){v(N)}}function A(L){L.done?m(L.value):function p(m){return m instanceof u?m:new u(function(v){v(m)})}(L.value).then(y,b)}A((g=g.apply(f,l||[])).next())})}(this,void 0,void 0,function*(){try{for(u=ex(f);!(g=yield u.next()).done;)if(l.next(g.value),l.closed)return}catch(v){p={error:v}}finally{try{g&&!g.done&&(m=u.return)&&(yield m.call(u))}finally{if(p)throw p.error}}l.complete()})})(f,l).catch(u=>l.error(u))})}function Pr(f,l,u,g=0,p=!1){const m=l.schedule(function(){u(),p?f.add(this.schedule(null,g)):this.unsubscribe()},g);if(f.add(m),!p)return m}function In(f,l,u=1/0){return Ut(l)?In((g,p)=>Gt((m,v)=>l(g,m,p,v))(hr(f(g,p))),u):("number"==typeof l&&(u=l),An((g,p)=>function cx(f,l,u,g,p,m,v,y){const b=[];let A=0,L=0,N=!1;const k=()=>{N&&!b.length&&!A&&l.complete()},j=z=>A<g?H(z):b.push(z),H=z=>{m&&l.next(z),A++;let $=!1;hr(u(z,L++)).subscribe(Sn(l,q=>{null==p||p(q),m?j(q):l.next(q)},()=>{$=!0},void 0,()=>{if($)try{for(A--;b.length&&A<g;){const q=b.shift();v?Pr(l,v,()=>H(q)):H(q)}k()}catch(q){l.error(q)}}))};return f.subscribe(Sn(l,j,()=>{N=!0,k()})),()=>{null==y||y()}}(g,p,f,u)))}function Ja(f=1/0){return In(Ys,f)}const Nr=new dn(f=>f.complete());function Zd(f){return f[f.length-1]}function Mv(f){return Ut(Zd(f))?f.pop():void 0}function el(f){return function hx(f){return f&&Ut(f.schedule)}(Zd(f))?f.pop():void 0}function Ov(f,l=0){return An((u,g)=>{u.subscribe(Sn(g,p=>Pr(g,f,()=>g.next(p),l),()=>Pr(g,f,()=>g.complete(),l),p=>Pr(g,f,()=>g.error(p),l)))})}function Lv(f,l=0){return An((u,g)=>{g.add(f.schedule(()=>u.subscribe(g),l))})}function Fv(f,l){if(!f)throw new Error("Iterable cannot be null");return new dn(u=>{Pr(u,l,()=>{const g=f[Symbol.asyncIterator]();Pr(u,l,()=>{g.next().then(p=>{p.done?u.complete():u.next(p.value)})},0,!0)})})}function Tn(f,l){return l?function vx(f,l){if(null!=f){if(bv(f))return function fx(f,l){return hr(f).pipe(Lv(l),Ov(l))}(f,l);if(wv(f))return function px(f,l){return new dn(u=>{let g=0;return l.schedule(function(){g===f.length?u.complete():(u.next(f[g++]),u.closed||this.schedule())})})}(f,l);if(Ev(f))return function gx(f,l){return hr(f).pipe(Lv(l),Ov(l))}(f,l);if(Dv(f))return Fv(f,l);if(Tv(f))return function mx(f,l){return new dn(u=>{let g;return Pr(u,l,()=>{g=f[Iv](),Pr(u,l,()=>{let p,m;try{({value:p,done:m}=g.next())}catch(v){return void u.error(v)}m?u.complete():u.next(p)},0,!0)}),()=>Ut(null==g?void 0:g.return)&&g.return()})}(f,l);if(Av(f))return function _x(f,l){return Fv(xv(f),l)}(f,l)}throw Sv(f)}(f,l):hr(f)}function nu(f){return f<=0?()=>Nr:An((l,u)=>{let g=0;l.subscribe(Sn(u,p=>{++g<=f&&(u.next(p),f<=g&&u.complete())}))})}function Kd(f,l,...u){return!0===l?(f(),null):!1===l?null:l(...u).pipe(nu(1)).subscribe(()=>f())}function kt(f){for(let l in f)if(f[l]===kt)return l;throw Error("Could not find renamed property on target object.")}function Qd(f,l){for(const u in l)l.hasOwnProperty(u)&&!f.hasOwnProperty(u)&&(f[u]=l[u])}function At(f){if("string"==typeof f)return f;if(Array.isArray(f))return"["+f.map(At).join(", ")+"]";if(null==f)return""+f;if(f.overriddenName)return`${f.overriddenName}`;if(f.name)return`${f.name}`;const l=f.toString();if(null==l)return""+l;const u=l.indexOf("\n");return-1===u?l:l.substring(0,u)}function Jd(f,l){return null==f||""===f?null===l?"":l:null==l||""===l?f:f+" "+l}const wx=kt({__forward_ref__:kt});function Ht(f){return f.__forward_ref__=Ht,f.toString=function(){return At(this())},f}function ot(f){return Pv(f)?f():f}function Pv(f){return"function"==typeof f&&f.hasOwnProperty(wx)&&f.__forward_ref__===Ht}class St extends Error{constructor(l,u){super(function ef(f,l){return`NG0${Math.abs(f)}${l?": "+l:""}`}(l,u)),this.code=l}}function Je(f){return"string"==typeof f?f:null==f?"":String(f)}function Rn(f){return"function"==typeof f?f.name||f.toString():"object"==typeof f&&null!=f&&"function"==typeof f.type?f.type.name||f.type.toString():Je(f)}function iu(f,l){const u=l?` in ${l}`:"";throw new St(-201,`No provider for ${Rn(f)} found${u}`)}function oi(f,l){null==f&&function Bt(f,l,u,g){throw new Error(`ASSERTION ERROR: ${f}`+(null==g?"":` [Expected=> ${u} ${g} ${l} <=Actual]`))}(l,f,null,"!=")}function Ct(f){return{token:f.token,providedIn:f.providedIn||null,factory:f.factory,value:void 0}}function zi(f){return{providers:f.providers||[],imports:f.imports||[]}}function tf(f){return Nv(f,ru)||Nv(f,Bv)}function Nv(f,l){return f.hasOwnProperty(l)?f[l]:null}function kv(f){return f&&(f.hasOwnProperty(nf)||f.hasOwnProperty(xx))?f[nf]:null}const ru=kt({\u0275prov:kt}),nf=kt({\u0275inj:kt}),Bv=kt({ngInjectableDef:kt}),xx=kt({ngInjectorDef:kt});var qe=(()=>((qe=qe||{})[qe.Default=0]="Default",qe[qe.Host=1]="Host",qe[qe.Self=2]="Self",qe[qe.SkipSelf=4]="SkipSelf",qe[qe.Optional=8]="Optional",qe))();let rf;function gs(f){const l=rf;return rf=f,l}function Vv(f,l,u){const g=tf(f);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:u&qe.Optional?null:void 0!==l?l:void iu(At(f),"Injector")}function ps(f){return{toString:f}.toString()}var Yi=(()=>((Yi=Yi||{})[Yi.OnPush=0]="OnPush",Yi[Yi.Default=1]="Default",Yi))(),dr=(()=>{return(f=dr||(dr={}))[f.Emulated=0]="Emulated",f[f.None=2]="None",f[f.ShadowDom=3]="ShadowDom",dr;var f})();const Rx="undefined"!=typeof globalThis&&globalThis,Mx="undefined"!=typeof window&&window,Ox="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ot=Rx||"undefined"!=typeof global&&global||Mx||Ox,To={},Vt=[],su=kt({\u0275cmp:kt}),sf=kt({\u0275dir:kt}),of=kt({\u0275pipe:kt}),jv=kt({\u0275mod:kt}),Br=kt({\u0275fac:kt}),tl=kt({__NG_ELEMENT_ID__:kt});let Lx=0;function Si(f){return ps(()=>{const u={},g={type:f.type,providersResolver:null,decls:f.decls,vars:f.vars,factory:null,template:f.template||null,consts:f.consts||null,ngContentSelectors:f.ngContentSelectors,hostBindings:f.hostBindings||null,hostVars:f.hostVars||0,hostAttrs:f.hostAttrs||null,contentQueries:f.contentQueries||null,declaredInputs:u,inputs:null,outputs:null,exportAs:f.exportAs||null,onPush:f.changeDetection===Yi.OnPush,directiveDefs:null,pipeDefs:null,selectors:f.selectors||Vt,viewQuery:f.viewQuery||null,features:f.features||null,data:f.data||{},encapsulation:f.encapsulation||dr.Emulated,id:"c",styles:f.styles||Vt,_:null,setInput:null,schemas:f.schemas||null,tView:null},p=f.directives,m=f.features,v=f.pipes;return g.id+=Lx++,g.inputs=Wv(f.inputs,u),g.outputs=Wv(f.outputs),m&&m.forEach(y=>y(g)),g.directiveDefs=p?()=>("function"==typeof p?p():p).map(Uv):null,g.pipeDefs=v?()=>("function"==typeof v?v():v).map(Gv):null,g})}function Uv(f){return Nn(f)||function ms(f){return f[sf]||null}(f)}function Gv(f){return function Xs(f){return f[of]||null}(f)}const Hv={};function fr(f){return ps(()=>{const l={type:f.type,bootstrap:f.bootstrap||Vt,declarations:f.declarations||Vt,imports:f.imports||Vt,exports:f.exports||Vt,transitiveCompileScopes:null,schemas:f.schemas||null,id:f.id||null};return null!=f.id&&(Hv[f.id]=f.type),l})}function Wv(f,l){if(null==f)return To;const u={};for(const g in f)if(f.hasOwnProperty(g)){let p=f[g],m=p;Array.isArray(p)&&(m=p[1],p=p[0]),u[p]=g,l&&(l[p]=m)}return u}const $e=Si;function Nn(f){return f[su]||null}function Ii(f,l){const u=f[jv]||null;if(!u&&!0===l)throw new Error(`Type ${At(f)} does not have '\u0275mod' property.`);return u}function gr(f){return Array.isArray(f)&&"object"==typeof f[1]}function Xi(f){return Array.isArray(f)&&!0===f[1]}function cf(f){return 0!=(8&f.flags)}function cu(f){return 2==(2&f.flags)}function uu(f){return 1==(1&f.flags)}function qi(f){return null!==f.template}function Vx(f){return 0!=(512&f[2])}function Qs(f,l){return f.hasOwnProperty(Br)?f[Br]:null}class Gx{constructor(l,u,g){this.previousValue=l,this.currentValue=u,this.firstChange=g}isFirstChange(){return this.firstChange}}function xi(){return Yv}function Yv(f){return f.type.prototype.ngOnChanges&&(f.setInput=Wx),Hx}function Hx(){const f=Xv(this),l=null==f?void 0:f.current;if(l){const u=f.previous;if(u===To)f.previous=l;else for(let g in l)u[g]=l[g];f.current=null,this.ngOnChanges(l)}}function Wx(f,l,u,g){const p=Xv(f)||function zx(f,l){return f[$v]=l}(f,{previous:To,current:null}),m=p.current||(p.current={}),v=p.previous,y=this.declaredInputs[u],b=v[y];m[y]=new Gx(b&&b.currentValue,l,v===To),f[g]=l}xi.ngInherit=!0;const $v="__ngSimpleChanges__";function Xv(f){return f[$v]||null}let gf;function nn(f){return!!f.listen}const qv={createRenderer:(f,l)=>function pf(){return void 0!==gf?gf:"undefined"!=typeof document?document:void 0}()};function fn(f){for(;Array.isArray(f);)f=f[0];return f}function hu(f,l){return fn(l[f])}function Ri(f,l){return fn(l[f.index])}function mf(f,l){return f.data[l]}function li(f,l){const u=l[f];return gr(u)?u:u[0]}function _f(f){return 128==(128&f[2])}function _s(f,l){return null==l?null:f[l]}function Kv(f){f[18]=0}function vf(f,l){f[5]+=l;let u=f,g=f[3];for(;null!==g&&(1===l&&1===u[5]||-1===l&&0===u[5]);)g[5]+=l,u=g,g=g[3]}const et={lFrame:oy(null),bindingsEnabled:!0};function Jv(){return et.bindingsEnabled}function ve(){return et.lFrame.lView}function It(){return et.lFrame.tView}function wn(){let f=ey();for(;null!==f&&64===f.type;)f=f.parent;return f}function ey(){return et.lFrame.currentTNode}function pr(f,l){const u=et.lFrame;u.currentTNode=f,u.isParent=l}function yf(){return et.lFrame.isParent}function Lo(){return et.lFrame.bindingIndex++}function cA(f,l){const u=et.lFrame;u.bindingIndex=u.bindingRootIndex=f,wf(l)}function wf(f){et.lFrame.currentDirectiveIndex=f}function bf(f){et.lFrame.currentQueryIndex=f}function hA(f){const l=f[1];return 2===l.type?l.declTNode:1===l.type?f[6]:null}function ry(f,l,u){if(u&qe.SkipSelf){let p=l,m=f;for(;!(p=p.parent,null!==p||u&qe.Host||(p=hA(m),null===p||(m=m[15],10&p.type))););if(null===p)return!1;l=p,f=m}const g=et.lFrame=sy();return g.currentTNode=l,g.lView=f,!0}function fu(f){const l=sy(),u=f[1];et.lFrame=l,l.currentTNode=u.firstChild,l.lView=f,l.tView=u,l.contextLView=f,l.bindingIndex=u.bindingStartIndex,l.inI18n=!1}function sy(){const f=et.lFrame,l=null===f?null:f.child;return null===l?oy(f):l}function oy(f){const l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:f,child:null,inI18n:!1};return null!==f&&(f.child=l),l}function ay(){const f=et.lFrame;return et.lFrame=f.parent,f.currentTNode=null,f.lView=null,f}const ly=ay;function gu(){const f=ay();f.isParent=!0,f.tView=null,f.selectedIndex=-1,f.contextLView=null,f.elementDepthCount=0,f.currentDirectiveIndex=-1,f.currentNamespace=null,f.bindingRootIndex=-1,f.bindingIndex=-1,f.currentQueryIndex=0}function Wn(){return et.lFrame.selectedIndex}function vs(f){et.lFrame.selectedIndex=f}function rn(){const f=et.lFrame;return mf(f.tView,f.selectedIndex)}function pu(f,l){for(let u=l.directiveStart,g=l.directiveEnd;u<g;u++){const m=f.data[u].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:y,ngAfterViewInit:b,ngAfterViewChecked:A,ngOnDestroy:L}=m;v&&(f.contentHooks||(f.contentHooks=[])).push(-u,v),y&&((f.contentHooks||(f.contentHooks=[])).push(u,y),(f.contentCheckHooks||(f.contentCheckHooks=[])).push(u,y)),b&&(f.viewHooks||(f.viewHooks=[])).push(-u,b),A&&((f.viewHooks||(f.viewHooks=[])).push(u,A),(f.viewCheckHooks||(f.viewCheckHooks=[])).push(u,A)),null!=L&&(f.destroyHooks||(f.destroyHooks=[])).push(u,L)}}function mu(f,l,u){cy(f,l,3,u)}function _u(f,l,u,g){(3&f[2])===u&&cy(f,l,u,g)}function Df(f,l){let u=f[2];(3&u)===l&&(u&=2047,u+=1,f[2]=u)}function cy(f,l,u,g){const m=null!=g?g:-1,v=l.length-1;let y=0;for(let b=void 0!==g?65535&f[18]:0;b<v;b++)if("number"==typeof l[b+1]){if(y=l[b],null!=g&&y>=g)break}else l[b]<0&&(f[18]+=65536),(y<m||-1==m)&&(CA(f,u,l,b),f[18]=(4294901760&f[18])+b+2),b++}function CA(f,l,u,g){const p=u[g]<0,m=u[g+1],y=f[p?-u[g]:u[g]];if(p){if(f[2]>>11<f[18]>>16&&(3&f[2])===l){f[2]+=2048;try{m.call(y)}finally{}}}else try{m.call(y)}finally{}}class ol{constructor(l,u,g){this.factory=l,this.resolving=!1,this.canSeeViewProviders=u,this.injectImpl=g}}function vu(f,l,u){const g=nn(f);let p=0;for(;p<u.length;){const m=u[p];if("number"==typeof m){if(0!==m)break;p++;const v=u[p++],y=u[p++],b=u[p++];g?f.setAttribute(l,y,b,v):l.setAttributeNS(v,y,b)}else{const v=m,y=u[++p];If(v)?g&&f.setProperty(l,v,y):g?f.setAttribute(l,v,y):l.setAttribute(v,y),p++}}return p}function uy(f){return 3===f||4===f||6===f}function If(f){return 64===f.charCodeAt(0)}function yu(f,l){if(null!==l&&0!==l.length)if(null===f||0===f.length)f=l.slice();else{let u=-1;for(let g=0;g<l.length;g++){const p=l[g];"number"==typeof p?u=p:0===u||hy(f,u,p,null,-1===u||2===u?l[++g]:null)}}return f}function hy(f,l,u,g,p){let m=0,v=f.length;if(-1===l)v=-1;else for(;m<f.length;){const y=f[m++];if("number"==typeof y){if(y===l){v=-1;break}if(y>l){v=m-1;break}}}for(;m<f.length;){const y=f[m];if("number"==typeof y)break;if(y===u){if(null===g)return void(null!==p&&(f[m+1]=p));if(g===f[m+1])return void(f[m+2]=p)}m++,null!==g&&m++,null!==p&&m++}-1!==v&&(f.splice(v,0,l),m=v+1),f.splice(m++,0,u),null!==g&&f.splice(m++,0,g),null!==p&&f.splice(m++,0,p)}function dy(f){return-1!==f}function Fo(f){return 32767&f}function Po(f,l){let u=function SA(f){return f>>16}(f),g=l;for(;u>0;)g=g[15],u--;return g}let Tf=!0;function Cu(f){const l=Tf;return Tf=f,l}let IA=0;function ll(f,l){const u=Af(f,l);if(-1!==u)return u;const g=l[1];g.firstCreatePass&&(f.injectorIndex=l.length,xf(g.data,f),xf(l,null),xf(g.blueprint,null));const p=wu(f,l),m=f.injectorIndex;if(dy(p)){const v=Fo(p),y=Po(p,l),b=y[1].data;for(let A=0;A<8;A++)l[m+A]=y[v+A]|b[v+A]}return l[m+8]=p,m}function xf(f,l){f.push(0,0,0,0,0,0,0,0,l)}function Af(f,l){return-1===f.injectorIndex||f.parent&&f.parent.injectorIndex===f.injectorIndex||null===l[f.injectorIndex+8]?-1:f.injectorIndex}function wu(f,l){if(f.parent&&-1!==f.parent.injectorIndex)return f.parent.injectorIndex;let u=0,g=null,p=l;for(;null!==p;){const m=p[1],v=m.type;if(g=2===v?m.declTNode:1===v?p[6]:null,null===g)return-1;if(u++,p=p[15],-1!==g.injectorIndex)return g.injectorIndex|u<<16}return-1}function Eu(f,l,u){!function TA(f,l,u){let g;"string"==typeof u?g=u.charCodeAt(0)||0:u.hasOwnProperty(tl)&&(g=u[tl]),null==g&&(g=u[tl]=IA++);const p=255&g;l.data[f+(p>>5)]|=1<<p}(f,l,u)}function py(f,l,u){if(u&qe.Optional)return f;iu(l,"NodeInjector")}function my(f,l,u,g){if(u&qe.Optional&&void 0===g&&(g=null),0==(u&(qe.Self|qe.Host))){const p=f[9],m=gs(void 0);try{return p?p.get(l,g,u&qe.Optional):Vv(l,g,u&qe.Optional)}finally{gs(m)}}return py(g,l,u)}function _y(f,l,u,g=qe.Default,p){if(null!==f){const m=function MA(f){if("string"==typeof f)return f.charCodeAt(0)||0;const l=f.hasOwnProperty(tl)?f[tl]:void 0;return"number"==typeof l?l>=0?255&l:AA:l}(u);if("function"==typeof m){if(!ry(l,f,g))return g&qe.Host?py(p,u,g):my(l,u,g,p);try{const v=m(g);if(null!=v||g&qe.Optional)return v;iu(u)}finally{ly()}}else if("number"==typeof m){let v=null,y=Af(f,l),b=-1,A=g&qe.Host?l[16][6]:null;for((-1===y||g&qe.SkipSelf)&&(b=-1===y?wu(f,l):l[y+8],-1!==b&&Cy(g,!1)?(v=l[1],y=Fo(b),l=Po(b,l)):y=-1);-1!==y;){const L=l[1];if(yy(m,y,L.data)){const N=RA(y,l,u,v,g,A);if(N!==vy)return N}b=l[y+8],-1!==b&&Cy(g,l[1].data[y+8]===A)&&yy(m,y,l)?(v=L,y=Fo(b),l=Po(b,l)):y=-1}}}return my(l,u,g,p)}const vy={};function AA(){return new No(wn(),ve())}function RA(f,l,u,g,p,m){const v=l[1],y=v.data[f+8],L=function bu(f,l,u,g,p){const m=f.providerIndexes,v=l.data,y=1048575&m,b=f.directiveStart,L=m>>20,k=p?y+L:f.directiveEnd;for(let j=g?y:y+L;j<k;j++){const H=v[j];if(j<b&&u===H||j>=b&&H.type===u)return j}if(p){const j=v[b];if(j&&qi(j)&&j.type===u)return b}return null}(y,v,u,null==g?cu(y)&&Tf:g!=v&&0!=(3&y.type),p&qe.Host&&m===y);return null!==L?cl(l,v,L,y):vy}function cl(f,l,u,g){let p=f[u];const m=l.data;if(function wA(f){return f instanceof ol}(p)){const v=p;v.resolving&&function Ex(f,l){const u=l?`. Dependency path: ${l.join(" > ")} > ${f}`:"";throw new St(-200,`Circular dependency in DI detected for ${f}${u}`)}(Rn(m[u]));const y=Cu(v.canSeeViewProviders);v.resolving=!0;const b=v.injectImpl?gs(v.injectImpl):null;ry(f,g,qe.Default);try{p=f[u]=v.factory(void 0,m,f,g),l.firstCreatePass&&u>=g.directiveStart&&function yA(f,l,u){const{ngOnChanges:g,ngOnInit:p,ngDoCheck:m}=l.type.prototype;if(g){const v=Yv(l);(u.preOrderHooks||(u.preOrderHooks=[])).push(f,v),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(f,v)}p&&(u.preOrderHooks||(u.preOrderHooks=[])).push(0-f,p),m&&((u.preOrderHooks||(u.preOrderHooks=[])).push(f,m),(u.preOrderCheckHooks||(u.preOrderCheckHooks=[])).push(f,m))}(u,m[u],l)}finally{null!==b&&gs(b),Cu(y),v.resolving=!1,ly()}}return p}function yy(f,l,u){return!!(u[l+(f>>5)]&1<<f)}function Cy(f,l){return!(f&qe.Self||f&qe.Host&&l)}class No{constructor(l,u){this._tNode=l,this._lView=u}get(l,u,g){return _y(this._tNode,this._lView,l,g,u)}}function Rf(f){return Pv(f)?()=>{const l=Rf(ot(f));return l&&l()}:Qs(f)}const Bo="__parameters__";function jo(f,l,u){return ps(()=>{const g=function Mf(f){return function(...u){if(f){const g=f(...u);for(const p in g)this[p]=g[p]}}}(l);function p(...m){if(this instanceof p)return g.apply(this,m),this;const v=new p(...m);return y.annotation=v,y;function y(b,A,L){const N=b.hasOwnProperty(Bo)?b[Bo]:Object.defineProperty(b,Bo,{value:[]})[Bo];for(;N.length<=L;)N.push(null);return(N[L]=N[L]||[]).push(v),b}}return u&&(p.prototype=Object.create(u.prototype)),p.prototype.ngMetadataName=f,p.annotationCls=p,p})}class gt{constructor(l,u){this._desc=l,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof u?this.__NG_ELEMENT_ID__=u:void 0!==u&&(this.\u0275prov=Ct({token:this,providedIn:u.providedIn||"root",factory:u.factory}))}toString(){return`InjectionToken ${this._desc}`}}const LA=new gt("AnalyzeForEntryComponents");function mr(f,l){f.forEach(u=>Array.isArray(u)?mr(u,l):l(u))}function Ey(f,l,u){l>=f.length?f.push(u):f.splice(l,0,u)}function Du(f,l){return l>=f.length-1?f.pop():f.splice(l,1)[0]}function ci(f,l,u){let g=Uo(f,l);return g>=0?f[1|g]=u:(g=~g,function NA(f,l,u,g){let p=f.length;if(p==l)f.push(u,g);else if(1===p)f.push(g,f[0]),f[0]=u;else{for(p--,f.push(f[p-1],f[p]);p>l;)f[p]=f[p-2],p--;f[l]=u,f[l+1]=g}}(f,g,l,u)),g}function Lf(f,l){const u=Uo(f,l);if(u>=0)return f[1|u]}function Uo(f,l){return function Sy(f,l,u){let g=0,p=f.length>>u;for(;p!==g;){const m=g+(p-g>>1),v=f[m<<u];if(l===v)return m<<u;v>l?p=m:g=m+1}return~(p<<u)}(f,l,1)}const gl={},Pf="__NG_DI_FLAG__",Iu="ngTempTokenPath",HA=/\n/gm,Ty="__source",zA=kt({provide:String,useValue:kt});let pl;function xy(f){const l=pl;return pl=f,l}function YA(f,l=qe.Default){if(void 0===pl)throw new St(203,"");return null===pl?Vv(f,void 0,l):pl.get(f,l&qe.Optional?null:void 0,l)}function Xe(f,l=qe.Default){return(function Ax(){return rf}()||YA)(ot(f),l)}const $A=Xe;function Nf(f){const l=[];for(let u=0;u<f.length;u++){const g=ot(f[u]);if(Array.isArray(g)){if(0===g.length)throw new St(900,"");let p,m=qe.Default;for(let v=0;v<g.length;v++){const y=g[v],b=XA(y);"number"==typeof b?-1===b?p=y.token:m|=b:p=y}l.push(Xe(p,m))}else l.push(Xe(g))}return l}function ml(f,l){return f[Pf]=l,f.prototype[Pf]=l,f}function XA(f){return f[Pf]}const Tu=ml(jo("Inject",f=>({token:f})),-1),Cs=ml(jo("Optional"),8),_l=ml(jo("SkipSelf"),4);class ky{constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ws(f){return f instanceof ky?f.changingThisBreaksApplicationSecurity:f}const mR=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,_R=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var gn=(()=>((gn=gn||{})[gn.NONE=0]="NONE",gn[gn.HTML=1]="HTML",gn[gn.STYLE=2]="STYLE",gn[gn.SCRIPT=3]="SCRIPT",gn[gn.URL=4]="URL",gn[gn.RESOURCE_URL=5]="RESOURCE_URL",gn))();function Wf(f){const l=function wl(){const f=ve();return f&&f[12]}();return l?l.sanitize(gn.URL,f)||"":function yl(f,l){const u=function dR(f){return f instanceof ky&&f.getTypeName()||null}(f);if(null!=u&&u!==l){if("ResourceURL"===u&&"URL"===l)return!0;throw new Error(`Required a safe ${l}, got a ${u} (see https://g.co/ng/security#xss)`)}return u===l}(f,"URL")?ws(f):function Mu(f){return(f=String(f)).match(mR)||f.match(_R)?f:"unsafe:"+f}(Je(f))}const $y="__ngContext__";function Vn(f,l){f[$y]=l}function Yf(f){const l=function El(f){return f[$y]||null}(f);return l?Array.isArray(l)?l:l.lView:null}function Xf(f){return f.ngOriginalError}function jR(f,...l){f.error(...l)}class bl{constructor(){this._console=console}handleError(l){const u=this._findOriginalError(l),g=function VR(f){return f&&f.ngErrorLogger||jR}(l);g(this._console,"ERROR",l),u&&g(this._console,"ORIGINAL ERROR",u)}_findOriginalError(l){let u=l&&Xf(l);for(;u&&Xf(u);)u=Xf(u);return u||null}}const ZR=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ot))();function vr(f){return f instanceof Function?f():f}var ui=(()=>((ui=ui||{})[ui.Important=1]="Important",ui[ui.DashCase=2]="DashCase",ui))();function Zf(f,l){return undefined(f,l)}function Dl(f){const l=f[3];return Xi(l)?l[3]:l}function Kf(f){return n0(f[13])}function Qf(f){return n0(f[4])}function n0(f){for(;null!==f&&!Xi(f);)f=f[4];return f}function zo(f,l,u,g,p){if(null!=g){let m,v=!1;Xi(g)?m=g:gr(g)&&(v=!0,g=g[0]);const y=fn(g);0===f&&null!==u?null==p?c0(l,u,y):Js(l,u,y,p||null,!0):1===f&&null!==u?Js(l,u,y,p||null,!0):2===f?function m0(f,l,u){const g=Lu(f,l);g&&function u1(f,l,u,g){nn(f)?f.removeChild(l,u,g):l.removeChild(u)}(f,g,l,u)}(l,y,v):3===f&&l.destroyNode(y),null!=m&&function f1(f,l,u,g,p){const m=u[7];m!==fn(u)&&zo(l,f,g,m,p);for(let y=10;y<u.length;y++){const b=u[y];Sl(b[1],b,f,l,g,m)}}(l,f,m,u,p)}}function eg(f,l,u){if(nn(f))return f.createElement(l,u);{const g=null!==u?function qx(f){const l=f.toLowerCase();return"svg"===l?"http://www.w3.org/2000/svg":"math"===l?"http://www.w3.org/1998/MathML/":null}(u):null;return null===g?f.createElement(l):f.createElementNS(g,l)}}function s0(f,l){const u=f[9],g=u.indexOf(l),p=l[3];1024&l[2]&&(l[2]&=-1025,vf(p,-1)),u.splice(g,1)}function tg(f,l){if(f.length<=10)return;const u=10+l,g=f[u];if(g){const p=g[17];null!==p&&p!==f&&s0(p,g),l>0&&(f[u-1][4]=g[4]);const m=Du(f,10+l);!function n1(f,l){Sl(f,l,l[11],2,null,null),l[0]=null,l[6]=null}(g[1],g);const v=m[19];null!==v&&v.detachView(m[1]),g[3]=null,g[4]=null,g[2]&=-129}return g}function o0(f,l){if(!(256&l[2])){const u=l[11];nn(u)&&u.destroyNode&&Sl(f,l,u,3,null,null),function s1(f){let l=f[13];if(!l)return ng(f[1],f);for(;l;){let u=null;if(gr(l))u=l[13];else{const g=l[10];g&&(u=g)}if(!u){for(;l&&!l[4]&&l!==f;)gr(l)&&ng(l[1],l),l=l[3];null===l&&(l=f),gr(l)&&ng(l[1],l),u=l&&l[4]}l=u}}(l)}}function ng(f,l){if(!(256&l[2])){l[2]&=-129,l[2]|=256,function c1(f,l){let u;if(null!=f&&null!=(u=f.destroyHooks))for(let g=0;g<u.length;g+=2){const p=l[u[g]];if(!(p instanceof ol)){const m=u[g+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const y=p[m[v]],b=m[v+1];try{b.call(y)}finally{}}else try{m.call(p)}finally{}}}}(f,l),function l1(f,l){const u=f.cleanup,g=l[7];let p=-1;if(null!==u)for(let m=0;m<u.length-1;m+=2)if("string"==typeof u[m]){const v=u[m+1],y="function"==typeof v?v(l):fn(l[v]),b=g[p=u[m+2]],A=u[m+3];"boolean"==typeof A?y.removeEventListener(u[m],b,A):A>=0?g[p=A]():g[p=-A].unsubscribe(),m+=2}else{const v=g[p=u[m+1]];u[m].call(v)}if(null!==g){for(let m=p+1;m<g.length;m++)g[m]();l[7]=null}}(f,l),1===l[1].type&&nn(l[11])&&l[11].destroy();const u=l[17];if(null!==u&&Xi(l[3])){u!==l[3]&&s0(u,l);const g=l[19];null!==g&&g.detachView(f)}}}function a0(f,l,u){return function l0(f,l,u){let g=l;for(;null!==g&&40&g.type;)g=(l=g).parent;if(null===g)return u[0];if(2&g.flags){const p=f.data[g.directiveStart].encapsulation;if(p===dr.None||p===dr.Emulated)return null}return Ri(g,u)}(f,l.parent,u)}function Js(f,l,u,g,p){nn(f)?f.insertBefore(l,u,g,p):l.insertBefore(u,g,p)}function c0(f,l,u){nn(f)?f.appendChild(l,u):l.appendChild(u)}function u0(f,l,u,g,p){null!==g?Js(f,l,u,g,p):c0(f,l,u)}function Lu(f,l){return nn(f)?f.parentNode(l):l.parentNode}let f0=function d0(f,l,u){return 40&f.type?Ri(f,u):null};function Fu(f,l,u,g){const p=a0(f,g,l),m=l[11],y=function h0(f,l,u){return f0(f,l,u)}(g.parent||l[6],g,l);if(null!=p)if(Array.isArray(u))for(let b=0;b<u.length;b++)u0(m,p,u[b],y,!1);else u0(m,p,u,y,!1)}function Pu(f,l){if(null!==l){const u=l.type;if(3&u)return Ri(l,f);if(4&u)return rg(-1,f[l.index]);if(8&u){const g=l.child;if(null!==g)return Pu(f,g);{const p=f[l.index];return Xi(p)?rg(-1,p):fn(p)}}if(32&u)return Zf(l,f)()||fn(f[l.index]);{const g=p0(f,l);return null!==g?Array.isArray(g)?g[0]:Pu(Dl(f[16]),g):Pu(f,l.next)}}return null}function p0(f,l){return null!==l?f[16][6].projection[l.projection]:null}function rg(f,l){const u=10+f+1;if(u<l.length){const g=l[u],p=g[1].firstChild;if(null!==p)return Pu(g,p)}return l[7]}function sg(f,l,u,g,p,m,v){for(;null!=u;){const y=g[u.index],b=u.type;if(v&&0===l&&(y&&Vn(fn(y),g),u.flags|=4),64!=(64&u.flags))if(8&b)sg(f,l,u.child,g,p,m,!1),zo(l,f,p,y,m);else if(32&b){const A=Zf(u,g);let L;for(;L=A();)zo(l,f,p,L,m);zo(l,f,p,y,m)}else 16&b?_0(f,l,g,u,p,m):zo(l,f,p,y,m);u=v?u.projectionNext:u.next}}function Sl(f,l,u,g,p,m){sg(u,g,f.firstChild,l,p,m,!1)}function _0(f,l,u,g,p,m){const v=u[16],b=v[6].projection[g.projection];if(Array.isArray(b))for(let A=0;A<b.length;A++)zo(l,f,p,b[A],m);else sg(f,l,b,v[3],p,m,!0)}function v0(f,l,u){nn(f)?f.setAttribute(l,"style",u):l.style.cssText=u}function og(f,l,u){nn(f)?""===u?f.removeAttribute(l,"class"):f.setAttribute(l,"class",u):l.className=u}function y0(f,l,u){let g=f.length;for(;;){const p=f.indexOf(l,u);if(-1===p)return p;if(0===p||f.charCodeAt(p-1)<=32){const m=l.length;if(p+m===g||f.charCodeAt(p+m)<=32)return p}u=p+1}}const C0="ng-template";function p1(f,l,u){let g=0;for(;g<f.length;){let p=f[g++];if(u&&"class"===p){if(p=f[g],-1!==y0(p.toLowerCase(),l,0))return!0}else if(1===p){for(;g<f.length&&"string"==typeof(p=f[g++]);)if(p.toLowerCase()===l)return!0;return!1}}return!1}function w0(f){return 4===f.type&&f.value!==C0}function m1(f,l,u){return l===(4!==f.type||u?f.value:C0)}function _1(f,l,u){let g=4;const p=f.attrs||[],m=function C1(f){for(let l=0;l<f.length;l++)if(uy(f[l]))return l;return f.length}(p);let v=!1;for(let y=0;y<l.length;y++){const b=l[y];if("number"!=typeof b){if(!v)if(4&g){if(g=2|1&g,""!==b&&!m1(f,b,u)||""===b&&1===l.length){if(Zi(g))return!1;v=!0}}else{const A=8&g?b:l[++y];if(8&g&&null!==f.attrs){if(!p1(f.attrs,A,u)){if(Zi(g))return!1;v=!0}continue}const N=v1(8&g?"class":b,p,w0(f),u);if(-1===N){if(Zi(g))return!1;v=!0;continue}if(""!==A){let k;k=N>m?"":p[N+1].toLowerCase();const j=8&g?k:null;if(j&&-1!==y0(j,A,0)||2&g&&A!==k){if(Zi(g))return!1;v=!0}}}}else{if(!v&&!Zi(g)&&!Zi(b))return!1;if(v&&Zi(b))continue;v=!1,g=b|1&g}}return Zi(g)||v}function Zi(f){return 0==(1&f)}function v1(f,l,u,g){if(null===l)return-1;let p=0;if(g||!u){let m=!1;for(;p<l.length;){const v=l[p];if(v===f)return p;if(3===v||6===v)m=!0;else{if(1===v||2===v){let y=l[++p];for(;"string"==typeof y;)y=l[++p];continue}if(4===v)break;if(0===v){p+=4;continue}}p+=m?1:2}return-1}return function w1(f,l){let u=f.indexOf(4);if(u>-1)for(u++;u<f.length;){const g=f[u];if("number"==typeof g)return-1;if(g===l)return u;u++}return-1}(l,f)}function E0(f,l,u=!1){for(let g=0;g<l.length;g++)if(_1(f,l[g],u))return!0;return!1}function b0(f,l){return f?":not("+l.trim()+")":l}function b1(f){let l=f[0],u=1,g=2,p="",m=!1;for(;u<f.length;){let v=f[u];if("string"==typeof v)if(2&g){const y=f[++u];p+="["+v+(y.length>0?'="'+y+'"':"")+"]"}else 8&g?p+="."+v:4&g&&(p+=" "+v);else""!==p&&!Zi(v)&&(l+=b0(m,p),p=""),g=v,m=m||!Zi(g);u++}return""!==p&&(l+=b0(m,p)),l}const tt={};function un(f){D0(It(),ve(),Wn()+f,!1)}function D0(f,l,u,g){if(!g)if(3==(3&l[2])){const m=f.preOrderCheckHooks;null!==m&&mu(l,m,u)}else{const m=f.preOrderHooks;null!==m&&_u(l,m,0,u)}vs(u)}function Nu(f,l){return f<<17|l<<2}function Ki(f){return f>>17&32767}function ag(f){return 2|f}function Ur(f){return(131068&f)>>2}function lg(f,l){return-131069&f|l<<2}function cg(f){return 1|f}function P0(f,l){const u=f.contentQueries;if(null!==u)for(let g=0;g<u.length;g+=2){const p=u[g],m=u[g+1];if(-1!==m){const v=f.data[m];bf(p),v.contentQueries(2,l[m],m)}}}function Il(f,l,u,g,p,m,v,y,b,A){const L=l.blueprint.slice();return L[0]=p,L[2]=140|g,Kv(L),L[3]=L[15]=f,L[8]=u,L[10]=v||f&&f[10],L[11]=y||f&&f[11],L[12]=b||f&&f[12]||null,L[9]=A||f&&f[9]||null,L[6]=m,L[16]=2==l.type?f[16]:L,L}function Yo(f,l,u,g,p){let m=f.data[l];if(null===m)m=function vg(f,l,u,g,p){const m=ey(),v=yf(),b=f.data[l]=function U1(f,l,u,g,p,m){return{type:u,index:g,insertBeforeIndex:null,injectorIndex:l?l.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:p,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,u,l,g,p);return null===f.firstChild&&(f.firstChild=b),null!==m&&(v?null==m.child&&null!==b.parent&&(m.child=b):null===m.next&&(m.next=b)),b}(f,l,u,g,p),function lA(){return et.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=u,m.value=g,m.attrs=p;const v=function sl(){const f=et.lFrame,l=f.currentTNode;return f.isParent?l:l.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return pr(m,!0),m}function $o(f,l,u,g){if(0===u)return-1;const p=l.length;for(let m=0;m<u;m++)l.push(g),f.blueprint.push(g),f.data.push(null);return p}function Tl(f,l,u){fu(l);try{const g=f.viewQuery;null!==g&&Tg(1,g,u);const p=f.template;null!==p&&N0(f,l,p,1,u),f.firstCreatePass&&(f.firstCreatePass=!1),f.staticContentQueries&&P0(f,l),f.staticViewQueries&&Tg(2,f.viewQuery,u);const m=f.components;null!==m&&function B1(f,l){for(let u=0;u<l.length;u++)sM(f,l[u])}(l,m)}catch(g){throw f.firstCreatePass&&(f.incompleteFirstPass=!0,f.firstCreatePass=!1),g}finally{l[2]&=-5,gu()}}function Xo(f,l,u,g){const p=l[2];if(256!=(256&p)){fu(l);try{Kv(l),function ty(f){return et.lFrame.bindingIndex=f}(f.bindingStartIndex),null!==u&&N0(f,l,u,2,g);const v=3==(3&p);if(v){const A=f.preOrderCheckHooks;null!==A&&mu(l,A,null)}else{const A=f.preOrderHooks;null!==A&&_u(l,A,0,null),Df(l,0)}if(function iM(f){for(let l=Kf(f);null!==l;l=Qf(l)){if(!l[2])continue;const u=l[9];for(let g=0;g<u.length;g++){const p=u[g],m=p[3];0==(1024&p[2])&&vf(m,1),p[2]|=1024}}}(l),function nM(f){for(let l=Kf(f);null!==l;l=Qf(l))for(let u=10;u<l.length;u++){const g=l[u],p=g[1];_f(g)&&Xo(p,g,p.template,g[8])}}(l),null!==f.contentQueries&&P0(f,l),v){const A=f.contentCheckHooks;null!==A&&mu(l,A)}else{const A=f.contentHooks;null!==A&&_u(l,A,1),Df(l,1)}!function N1(f,l){const u=f.hostBindingOpCodes;if(null!==u)try{for(let g=0;g<u.length;g++){const p=u[g];if(p<0)vs(~p);else{const m=p,v=u[++g],y=u[++g];cA(v,m),y(2,l[m])}}}finally{vs(-1)}}(f,l);const y=f.components;null!==y&&function k1(f,l){for(let u=0;u<l.length;u++)rM(f,l[u])}(l,y);const b=f.viewQuery;if(null!==b&&Tg(2,b,g),v){const A=f.viewCheckHooks;null!==A&&mu(l,A)}else{const A=f.viewHooks;null!==A&&_u(l,A,2),Df(l,2)}!0===f.firstUpdatePass&&(f.firstUpdatePass=!1),l[2]&=-73,1024&l[2]&&(l[2]&=-1025,vf(l[3],-1))}finally{gu()}}}function V1(f,l,u,g){const p=l[10],v=function Zv(f){return 4==(4&f[2])}(l);try{!v&&p.begin&&p.begin(),v&&Tl(f,l,g),Xo(f,l,u,g)}finally{!v&&p.end&&p.end()}}function N0(f,l,u,g,p){const m=Wn(),v=2&g;try{vs(-1),v&&l.length>20&&D0(f,l,20,!1),u(g,p)}finally{vs(m)}}function yg(f,l,u){!Jv()||(function X1(f,l,u,g){const p=u.directiveStart,m=u.directiveEnd;f.firstCreatePass||ll(u,l),Vn(g,l);const v=u.initialInputs;for(let y=p;y<m;y++){const b=f.data[y],A=qi(b);A&&J1(l,u,b);const L=cl(l,f,y,u);Vn(L,l),null!==v&&eM(0,y-p,L,b,0,v),A&&(li(u.index,l)[8]=L)}}(f,l,u,Ri(u,l)),128==(128&u.flags)&&function q1(f,l,u){const g=u.directiveStart,p=u.directiveEnd,v=u.index,y=function uA(){return et.lFrame.currentDirectiveIndex}();try{vs(v);for(let b=g;b<p;b++){const A=f.data[b],L=l[b];wf(b),(null!==A.hostBindings||0!==A.hostVars||null!==A.hostAttrs)&&z0(A,L)}}finally{vs(-1),wf(y)}}(f,l,u))}function Cg(f,l,u=Ri){const g=l.localNames;if(null!==g){let p=l.index+1;for(let m=0;m<g.length;m+=2){const v=g[m+1],y=-1===v?u(l,f):f[v];f[p++]=y}}}function B0(f){const l=f.tView;return null===l||l.incompleteFirstPass?f.tView=Vu(1,null,f.template,f.decls,f.vars,f.directiveDefs,f.pipeDefs,f.viewQuery,f.schemas,f.consts):l}function Vu(f,l,u,g,p,m,v,y,b,A){const L=20+g,N=L+p,k=function j1(f,l){const u=[];for(let g=0;g<l;g++)u.push(g<f?null:tt);return u}(L,N),j="function"==typeof A?A():A;return k[1]={type:f,blueprint:k,template:u,queries:null,viewQuery:y,declTNode:l,data:k.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:N,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:b,consts:j,incompleteFirstPass:!1}}function G0(f,l,u){for(let g in f)if(f.hasOwnProperty(g)){const p=f[g];(u=null===u?{}:u).hasOwnProperty(g)?u[g].push(l,p):u[g]=[l,p]}return u}function wg(f,l,u,g){let p=!1;if(Jv()){const m=function Z1(f,l,u){const g=f.directiveRegistry;let p=null;if(g)for(let m=0;m<g.length;m++){const v=g[m];E0(u,v.selectors,!1)&&(p||(p=[]),Eu(ll(u,l),f,v.type),qi(v)?(Y0(f,u),p.unshift(v)):p.push(v))}return p}(f,l,u),v=null===g?null:{"":-1};if(null!==m){p=!0,$0(u,f.data.length,m.length);for(let L=0;L<m.length;L++){const N=m[L];N.providersResolver&&N.providersResolver(N)}let y=!1,b=!1,A=$o(f,l,m.length,null);for(let L=0;L<m.length;L++){const N=m[L];u.mergedAttrs=yu(u.mergedAttrs,N.hostAttrs),X0(f,u,l,A,N),Q1(A,N,v),null!==N.contentQueries&&(u.flags|=8),(null!==N.hostBindings||null!==N.hostAttrs||0!==N.hostVars)&&(u.flags|=128);const k=N.type.prototype;!y&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((f.preOrderHooks||(f.preOrderHooks=[])).push(u.index),y=!0),!b&&(k.ngOnChanges||k.ngDoCheck)&&((f.preOrderCheckHooks||(f.preOrderCheckHooks=[])).push(u.index),b=!0),A++}!function G1(f,l){const g=l.directiveEnd,p=f.data,m=l.attrs,v=[];let y=null,b=null;for(let A=l.directiveStart;A<g;A++){const L=p[A],N=L.inputs,k=null===m||w0(l)?null:tM(N,m);v.push(k),y=G0(N,A,y),b=G0(L.outputs,A,b)}null!==y&&(y.hasOwnProperty("class")&&(l.flags|=16),y.hasOwnProperty("style")&&(l.flags|=32)),l.initialInputs=v,l.inputs=y,l.outputs=b}(f,u)}v&&function K1(f,l,u){if(l){const g=f.localNames=[];for(let p=0;p<l.length;p+=2){const m=u[l[p+1]];if(null==m)throw new St(-301,!1);g.push(l[p],m)}}}(u,g,v)}return u.mergedAttrs=yu(u.mergedAttrs,u.attrs),p}function W0(f,l,u,g,p,m){const v=m.hostBindings;if(v){let y=f.hostBindingOpCodes;null===y&&(y=f.hostBindingOpCodes=[]);const b=~l.index;(function $1(f){let l=f.length;for(;l>0;){const u=f[--l];if("number"==typeof u&&u<0)return u}return 0})(y)!=b&&y.push(b),y.push(g,p,v)}}function z0(f,l){null!==f.hostBindings&&f.hostBindings(1,l)}function Y0(f,l){l.flags|=2,(f.components||(f.components=[])).push(l.index)}function Q1(f,l,u){if(u){if(l.exportAs)for(let g=0;g<l.exportAs.length;g++)u[l.exportAs[g]]=f;qi(l)&&(u[""]=f)}}function $0(f,l,u){f.flags|=1,f.directiveStart=l,f.directiveEnd=l+u,f.providerIndexes=l}function X0(f,l,u,g,p){f.data[g]=p;const m=p.factory||(p.factory=Qs(p.type)),v=new ol(m,qi(p),null);f.blueprint[g]=v,u[g]=v,W0(f,l,0,g,$o(f,u,p.hostVars,tt),p)}function J1(f,l,u){const g=Ri(l,f),p=B0(u),m=f[10],v=ju(f,Il(f,p,null,u.onPush?64:16,g,l,m,m.createRenderer(g,u),null,null));f[l.index]=v}function yr(f,l,u,g,p,m){const v=Ri(f,l);!function Eg(f,l,u,g,p,m,v){if(null==m)nn(f)?f.removeAttribute(l,p,u):l.removeAttribute(p);else{const y=null==v?Je(m):v(m,g||"",p);nn(f)?f.setAttribute(l,p,y,u):u?l.setAttributeNS(u,p,y):l.setAttribute(p,y)}}(l[11],v,m,f.value,u,g,p)}function eM(f,l,u,g,p,m){const v=m[l];if(null!==v){const y=g.setInput;for(let b=0;b<v.length;){const A=v[b++],L=v[b++],N=v[b++];null!==y?g.setInput(u,N,A,L):u[L]=N}}}function tM(f,l){let u=null,g=0;for(;g<l.length;){const p=l[g];if(0!==p)if(5!==p){if("number"==typeof p)break;f.hasOwnProperty(p)&&(null===u&&(u=[]),u.push(p,f[p],l[g+1])),g+=2}else g+=2;else g+=4}return u}function q0(f,l,u,g){return new Array(f,!0,!1,l,null,0,g,u,null,null)}function rM(f,l){const u=li(l,f);if(_f(u)){const g=u[1];80&u[2]?Xo(g,u,g.template,u[8]):u[5]>0&&bg(u)}}function bg(f){for(let g=Kf(f);null!==g;g=Qf(g))for(let p=10;p<g.length;p++){const m=g[p];if(1024&m[2]){const v=m[1];Xo(v,m,v.template,m[8])}else m[5]>0&&bg(m)}const u=f[1].components;if(null!==u)for(let g=0;g<u.length;g++){const p=li(u[g],f);_f(p)&&p[5]>0&&bg(p)}}function sM(f,l){const u=li(l,f),g=u[1];(function oM(f,l){for(let u=l.length;u<f.blueprint.length;u++)l.push(f.blueprint[u])})(g,u),Tl(g,u,u[8])}function ju(f,l){return f[13]?f[14][4]=l:f[13]=l,f[14]=l,l}function Dg(f){for(;f;){f[2]|=64;const l=Dl(f);if(Vx(f)&&!l)return f;f=l}return null}function Z0(f){!function Sg(f){for(let l=0;l<f.components.length;l++){const u=f.components[l],g=Yf(u),p=g[1];V1(p,g,p.template,u)}}(f[8])}function Tg(f,l,u){bf(0),l(f,u)}const lM=(()=>Promise.resolve(null))();function K0(f){return f[7]||(f[7]=[])}function Q0(f){return f.cleanup||(f.cleanup=[])}function eC(f,l){const u=f[9],g=u?u.get(bl,null):null;g&&g.handleError(l)}function tC(f,l,u,g,p){for(let m=0;m<u.length;){const v=u[m++],y=u[m++],b=l[v],A=f.data[v];null!==A.setInput?A.setInput(b,p,g,y):b[y]=p}}function Gr(f,l,u){const g=hu(l,f);!function r0(f,l,u){nn(f)?f.setValue(l,u):l.textContent=u}(f[11],g,u)}function Uu(f,l,u){let g=u?f.styles:null,p=u?f.classes:null,m=0;if(null!==l)for(let v=0;v<l.length;v++){const y=l[v];"number"==typeof y?m=y:1==m?p=Jd(p,y):2==m&&(g=Jd(g,y+": "+l[++v]+";"))}u?f.styles=g:f.stylesWithoutHost=g,u?f.classes=p:f.classesWithoutHost=p}const xg=new gt("INJECTOR",-1);class nC{get(l,u=gl){if(u===gl){const g=new Error(`NullInjectorError: No provider for ${At(l)}!`);throw g.name="NullInjectorError",g}return u}}const Ag=new gt("Set Injector scope."),xl={},hM={};let Rg;function iC(){return void 0===Rg&&(Rg=new nC),Rg}function rC(f,l=null,u=null,g){const p=sC(f,l,u,g);return p._resolveInjectorDefTypes(),p}function sC(f,l=null,u=null,g){return new dM(f,u,l||iC(),g)}class dM{constructor(l,u,g,p=null){this.parent=g,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];u&&mr(u,y=>this.processProvider(y,l,u)),mr([l],y=>this.processInjectorType(y,[],m)),this.records.set(xg,qo(void 0,this));const v=this.records.get(Ag);this.scope=null!=v?v.value:null,this.source=p||("object"==typeof l?null:At(l))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(l=>l.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(l,u=gl,g=qe.Default){this.assertNotDestroyed();const p=xy(this),m=gs(void 0);try{if(!(g&qe.SkipSelf)){let y=this.records.get(l);if(void 0===y){const b=function CM(f){return"function"==typeof f||"object"==typeof f&&f instanceof gt}(l)&&tf(l);y=b&&this.injectableDefInScope(b)?qo(Mg(l),xl):null,this.records.set(l,y)}if(null!=y)return this.hydrate(l,y)}return(g&qe.Self?iC():this.parent).get(l,u=g&qe.Optional&&u===gl?null:u)}catch(v){if("NullInjectorError"===v.name){if((v[Iu]=v[Iu]||[]).unshift(At(l)),p)throw v;return function qA(f,l,u,g){const p=f[Iu];throw l[Ty]&&p.unshift(l[Ty]),f.message=function ZA(f,l,u,g=null){f=f&&"\n"===f.charAt(0)&&"\u0275"==f.charAt(1)?f.substr(2):f;let p=At(l);if(Array.isArray(l))p=l.map(At).join(" -> ");else if("object"==typeof l){let m=[];for(let v in l)if(l.hasOwnProperty(v)){let y=l[v];m.push(v+":"+("string"==typeof y?JSON.stringify(y):At(y)))}p=`{${m.join(", ")}}`}return`${u}${g?"("+g+")":""}[${p}]: ${f.replace(HA,"\n  ")}`}("\n"+f.message,p,u,g),f.ngTokenPath=p,f[Iu]=null,f}(v,l,"R3InjectorError",this.source)}throw v}finally{gs(m),xy(p)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(l=>this.get(l))}toString(){const l=[];return this.records.forEach((g,p)=>l.push(At(p))),`R3Injector[${l.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new St(205,!1)}processInjectorType(l,u,g){if(!(l=ot(l)))return!1;let p=kv(l);const m=null==p&&l.ngModule||void 0,v=void 0===m?l:m,y=-1!==g.indexOf(v);if(void 0!==m&&(p=kv(m)),null==p)return!1;if(null!=p.imports&&!y){let L;g.push(v);try{mr(p.imports,N=>{this.processInjectorType(N,u,g)&&(void 0===L&&(L=[]),L.push(N))})}finally{}if(void 0!==L)for(let N=0;N<L.length;N++){const{ngModule:k,providers:j}=L[N];mr(j,H=>this.processProvider(H,k,j||Vt))}}this.injectorDefTypes.add(v);const b=Qs(v)||(()=>new v);this.records.set(v,qo(b,xl));const A=p.providers;if(null!=A&&!y){const L=l;mr(A,N=>this.processProvider(N,L,A))}return void 0!==m&&void 0!==l.providers}processProvider(l,u,g){let p=Zo(l=ot(l))?l:ot(l&&l.provide);const m=function gM(f,l,u){return aC(f)?qo(void 0,f.useValue):qo(oC(f),xl)}(l);if(Zo(l)||!0!==l.multi)this.records.get(p);else{let v=this.records.get(p);v||(v=qo(void 0,xl,!0),v.factory=()=>Nf(v.multi),this.records.set(p,v)),p=l,v.multi.push(l)}this.records.set(p,m)}hydrate(l,u){return u.value===xl&&(u.value=hM,u.value=u.factory()),"object"==typeof u.value&&u.value&&function yM(f){return null!==f&&"object"==typeof f&&"function"==typeof f.ngOnDestroy}(u.value)&&this.onDestroy.add(u.value),u.value}injectableDefInScope(l){if(!l.providedIn)return!1;const u=ot(l.providedIn);return"string"==typeof u?"any"===u||u===this.scope:this.injectorDefTypes.has(u)}}function Mg(f){const l=tf(f),u=null!==l?l.factory:Qs(f);if(null!==u)return u;if(f instanceof gt)throw new St(204,!1);if(f instanceof Function)return function fM(f){const l=f.length;if(l>0)throw function fl(f,l){const u=[];for(let g=0;g<f;g++)u.push(l);return u}(l,"?"),new St(204,!1);const u=function Ix(f){const l=f&&(f[ru]||f[Bv]);if(l){const u=function Tx(f){if(f.hasOwnProperty("name"))return f.name;const l=(""+f).match(/^function\s*([^\s(]+)/);return null===l?"":l[1]}(f);return console.warn(`DEPRECATED: DI is instantiating a token "${u}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${u}" class.`),l}return null}(f);return null!==u?()=>u.factory(f):()=>new f}(f);throw new St(204,!1)}function oC(f,l,u){let g;if(Zo(f)){const p=ot(f);return Qs(p)||Mg(p)}if(aC(f))g=()=>ot(f.useValue);else if(function mM(f){return!(!f||!f.useFactory)}(f))g=()=>f.useFactory(...Nf(f.deps||[]));else if(function pM(f){return!(!f||!f.useExisting)}(f))g=()=>Xe(ot(f.useExisting));else{const p=ot(f&&(f.useClass||f.provide));if(!function vM(f){return!!f.deps}(f))return Qs(p)||Mg(p);g=()=>new p(...Nf(f.deps))}return g}function qo(f,l,u=!1){return{factory:f,value:l,multi:u?[]:void 0}}function aC(f){return null!==f&&"object"==typeof f&&zA in f}function Zo(f){return"function"==typeof f}let ei=(()=>{class f{static create(u,g){var p;if(Array.isArray(u))return rC({name:""},g,u,"");{const m=null!==(p=u.name)&&void 0!==p?p:"";return rC({name:m},u.parent,u.providers,m)}}}return f.THROW_IF_NOT_FOUND=gl,f.NULL=new nC,f.\u0275prov=Ct({token:f,providedIn:"any",factory:()=>Xe(xg)}),f.__NG_ELEMENT_ID__=-1,f})();function xM(f,l){pu(Yf(f)[1],wn())}function Rt(f){let l=function yC(f){return Object.getPrototypeOf(f.prototype).constructor}(f.type),u=!0;const g=[f];for(;l;){let p;if(qi(f))p=l.\u0275cmp||l.\u0275dir;else{if(l.\u0275cmp)throw new St(903,"");p=l.\u0275dir}if(p){if(u){g.push(p);const v=f;v.inputs=Fg(f.inputs),v.declaredInputs=Fg(f.declaredInputs),v.outputs=Fg(f.outputs);const y=p.hostBindings;y&&OM(f,y);const b=p.viewQuery,A=p.contentQueries;if(b&&RM(f,b),A&&MM(f,A),Qd(f.inputs,p.inputs),Qd(f.declaredInputs,p.declaredInputs),Qd(f.outputs,p.outputs),qi(p)&&p.data.animation){const L=f.data;L.animation=(L.animation||[]).concat(p.data.animation)}}const m=p.features;if(m)for(let v=0;v<m.length;v++){const y=m[v];y&&y.ngInherit&&y(f),y===Rt&&(u=!1)}}l=Object.getPrototypeOf(l)}!function AM(f){let l=0,u=null;for(let g=f.length-1;g>=0;g--){const p=f[g];p.hostVars=l+=p.hostVars,p.hostAttrs=yu(p.hostAttrs,u=yu(u,p.hostAttrs))}}(g)}function Fg(f){return f===To?{}:f===Vt?[]:f}function RM(f,l){const u=f.viewQuery;f.viewQuery=u?(g,p)=>{l(g,p),u(g,p)}:l}function MM(f,l){const u=f.contentQueries;f.contentQueries=u?(g,p,m)=>{l(g,p,m),u(g,p,m)}:l}function OM(f,l){const u=f.hostBindings;f.hostBindings=u?(g,p)=>{l(g,p),u(g,p)}:l}let Gu=null;function Ko(){if(!Gu){const f=Ot.Symbol;if(f&&f.iterator)Gu=f.iterator;else{const l=Object.getOwnPropertyNames(Map.prototype);for(let u=0;u<l.length;++u){const g=l[u];"entries"!==g&&"size"!==g&&Map.prototype[g]===Map.prototype.entries&&(Gu=g)}}}return Gu}function Al(f){return!!function Pg(f){return null!==f&&("function"==typeof f||"object"==typeof f)}(f)&&(Array.isArray(f)||!(f instanceof Map)&&Ko()in f)}function jn(f,l,u){return!Object.is(f[l],u)&&(f[l]=u,!0)}function wr(f,l,u,g){const p=ve();return jn(p,Lo(),l)&&(It(),yr(rn(),p,f,l,u,g)),wr}function Ji(f,l,u,g,p,m,v,y){const b=ve(),A=It(),L=f+20,N=A.firstCreatePass?function VM(f,l,u,g,p,m,v,y,b){const A=l.consts,L=Yo(l,f,4,v||null,_s(A,y));wg(l,u,L,_s(A,b)),pu(l,L);const N=L.tViews=Vu(2,L,g,p,m,l.directiveRegistry,l.pipeRegistry,null,l.schemas,A);return null!==l.queries&&(l.queries.template(l,L),N.queries=l.queries.embeddedTView(L)),L}(L,A,b,l,u,g,p,m,v):A.data[L];pr(N,!1);const k=b[11].createComment("");Fu(A,b,k,N),Vn(k,b),ju(b,b[L]=q0(k,b,k,N)),uu(N)&&yg(A,b,N),null!=v&&Cg(b,N,y)}function ye(f,l=qe.Default){const u=ve();return null===u?Xe(f,l):_y(wn(),u,ot(f),l)}function jg(){throw new Error("invalid")}function Zt(f,l,u){const g=ve();return jn(g,Lo(),l)&&function hi(f,l,u,g,p,m,v,y){const b=Ri(l,u);let L,A=l.inputs;!y&&null!=A&&(L=A[g])?(tC(f,u,L,g,p),cu(l)&&function W1(f,l){const u=li(l,f);16&u[2]||(u[2]|=64)}(u,l.index)):3&l.type&&(g=function H1(f){return"class"===f?"className":"for"===f?"htmlFor":"formaction"===f?"formAction":"innerHtml"===f?"innerHTML":"readonly"===f?"readOnly":"tabindex"===f?"tabIndex":f}(g),p=null!=v?v(p,l.value||"",g):p,nn(m)?m.setProperty(b,g,p):If(g)||(b.setProperty?b.setProperty(g,p):b[g]=p))}(It(),rn(),g,f,l,g[11],u,!1),Zt}function Ug(f,l,u,g,p){const v=p?"class":"style";tC(f,u,l.inputs[v],v,g)}function He(f,l,u,g){const p=ve(),m=It(),v=20+f,y=p[11],b=p[v]=eg(y,l,function vA(){return et.lFrame.currentNamespace}()),A=m.firstCreatePass?function aO(f,l,u,g,p,m,v){const y=l.consts,A=Yo(l,f,2,p,_s(y,m));return wg(l,u,A,_s(y,v)),null!==A.attrs&&Uu(A,A.attrs,!1),null!==A.mergedAttrs&&Uu(A,A.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,A),A}(v,m,p,0,l,u,g):m.data[v];pr(A,!0);const L=A.mergedAttrs;null!==L&&vu(y,b,L);const N=A.classes;null!==N&&og(y,b,N);const k=A.styles;return null!==k&&v0(y,b,k),64!=(64&A.flags)&&Fu(m,p,b,A),0===function tA(){return et.lFrame.elementDepthCount}()&&Vn(b,p),function nA(){et.lFrame.elementDepthCount++}(),uu(A)&&(yg(m,p,A),function k0(f,l,u){if(cf(l)){const p=l.directiveEnd;for(let m=l.directiveStart;m<p;m++){const v=f.data[m];v.contentQueries&&v.contentQueries(1,u[m],m)}}}(m,A,p)),null!==g&&Cg(p,A),He}function Ue(){let f=wn();yf()?function Cf(){et.lFrame.isParent=!1}():(f=f.parent,pr(f,!1));const l=f;!function iA(){et.lFrame.elementDepthCount--}();const u=It();return u.firstCreatePass&&(pu(u,f),cf(f)&&u.queries.elementEnd(f)),null!=l.classesWithoutHost&&function bA(f){return 0!=(16&f.flags)}(l)&&Ug(u,l,ve(),l.classesWithoutHost,!0),null!=l.stylesWithoutHost&&function DA(f){return 0!=(32&f.flags)}(l)&&Ug(u,l,ve(),l.stylesWithoutHost,!1),Ue}function Mn(f,l,u,g){return He(f,l,u,g),Ue(),Mn}function Ml(f){return!!f&&"function"==typeof f.then}const Wg=function jC(f){return!!f&&"function"==typeof f.subscribe};function Tt(f,l,u,g){const p=ve(),m=It(),v=wn();return function GC(f,l,u,g,p,m,v,y){const b=uu(g),L=f.firstCreatePass&&Q0(f),N=l[8],k=K0(l);let j=!0;if(3&g.type||y){const $=Ri(g,l),q=y?y($):$,X=k.length,Q=y?pe=>y(fn(pe[g.index])):g.index;if(nn(u)){let pe=null;if(!y&&b&&(pe=function uO(f,l,u,g){const p=f.cleanup;if(null!=p)for(let m=0;m<p.length-1;m+=2){const v=p[m];if(v===u&&p[m+1]===g){const y=l[7],b=p[m+2];return y.length>b?y[b]:null}"string"==typeof v&&(m+=2)}return null}(f,l,p,g.index)),null!==pe)(pe.__ngLastListenerFn__||pe).__ngNextListenerFn__=m,pe.__ngLastListenerFn__=m,j=!1;else{m=zg(g,l,N,m,!1);const _e=u.listen(q,p,m);k.push(m,_e),L&&L.push(p,Q,X,X+1)}}else m=zg(g,l,N,m,!0),q.addEventListener(p,m,v),k.push(m),L&&L.push(p,Q,X,v)}else m=zg(g,l,N,m,!1);const H=g.outputs;let z;if(j&&null!==H&&(z=H[p])){const $=z.length;if($)for(let q=0;q<$;q+=2){const Te=l[z[q]][z[q+1]].subscribe(m),Re=k.length;k.push(m,Te),L&&L.push(p,g.index,Re,-(Re+1))}}}(m,p,p[11],v,f,l,!!u,g),Tt}function HC(f,l,u,g){try{return!1!==u(g)}catch(p){return eC(f,p),!1}}function zg(f,l,u,g,p){return function m(v){if(v===Function)return g;const y=2&f.flags?li(f.index,l):l;0==(32&l[2])&&Dg(y);let b=HC(l,0,g,v),A=m.__ngNextListenerFn__;for(;A;)b=HC(l,0,A,v)&&b,A=A.__ngNextListenerFn__;return p&&!1===b&&(v.preventDefault(),v.returnValue=!1),b}}function Hr(f=1){return function dA(f){return(et.lFrame.contextLView=function fA(f,l){for(;f>0;)l=l[15],f--;return l}(f,et.lFrame.contextLView))[8]}(f)}function JC(f,l,u,g,p){const m=f[u+1],v=null===l;let y=g?Ki(m):Ur(m),b=!1;for(;0!==y&&(!1===b||v);){const L=f[y+1];mO(f[y],l)&&(b=!0,f[y+1]=g?cg(L):ag(L)),y=g?Ki(L):Ur(L)}b&&(f[u+1]=g?ag(m):cg(m))}function mO(f,l){return null===f||null==l||(Array.isArray(f)?f[1]:f)===l||!(!Array.isArray(f)||"string"!=typeof l)&&Uo(f,l)>=0}function zu(f,l){return function er(f,l,u,g){const p=ve(),m=It(),v=function jr(f){const l=et.lFrame,u=l.bindingIndex;return l.bindingIndex=l.bindingIndex+f,u}(2);m.firstUpdatePass&&function lw(f,l,u,g){const p=f.data;if(null===p[u+1]){const m=p[Wn()],v=function aw(f,l){return l>=f.expandoStartIndex}(f,u);(function dw(f,l){return 0!=(f.flags&(l?16:32))})(m,g)&&null===l&&!v&&(l=!1),l=function SO(f,l,u,g){const p=function Ef(f){const l=et.lFrame.currentDirectiveIndex;return-1===l?null:f[l]}(f);let m=g?l.residualClasses:l.residualStyles;if(null===p)0===(g?l.classBindings:l.styleBindings)&&(u=Ol(u=$g(null,f,l,u,g),l.attrs,g),m=null);else{const v=l.directiveStylingLast;if(-1===v||f[v]!==p)if(u=$g(p,f,l,u,g),null===m){let b=function IO(f,l,u){const g=u?l.classBindings:l.styleBindings;if(0!==Ur(g))return f[Ki(g)]}(f,l,g);void 0!==b&&Array.isArray(b)&&(b=$g(null,f,l,b[1],g),b=Ol(b,l.attrs,g),function TO(f,l,u,g){f[Ki(u?l.classBindings:l.styleBindings)]=g}(f,l,g,b))}else m=function xO(f,l,u){let g;const p=l.directiveEnd;for(let m=1+l.directiveStylingLast;m<p;m++)g=Ol(g,f[m].hostAttrs,u);return Ol(g,l.attrs,u)}(f,l,g)}return void 0!==m&&(g?l.residualClasses=m:l.residualStyles=m),u}(p,m,l,g),function gO(f,l,u,g,p,m){let v=m?l.classBindings:l.styleBindings,y=Ki(v),b=Ur(v);f[g]=u;let L,A=!1;if(Array.isArray(u)){const N=u;L=N[1],(null===L||Uo(N,L)>0)&&(A=!0)}else L=u;if(p)if(0!==b){const k=Ki(f[y+1]);f[g+1]=Nu(k,y),0!==k&&(f[k+1]=lg(f[k+1],g)),f[y+1]=function I1(f,l){return 131071&f|l<<17}(f[y+1],g)}else f[g+1]=Nu(y,0),0!==y&&(f[y+1]=lg(f[y+1],g)),y=g;else f[g+1]=Nu(b,0),0===y?y=g:f[b+1]=lg(f[b+1],g),b=g;A&&(f[g+1]=ag(f[g+1])),JC(f,L,g,!0),JC(f,L,g,!1),function pO(f,l,u,g,p){const m=p?f.residualClasses:f.residualStyles;null!=m&&"string"==typeof l&&Uo(m,l)>=0&&(u[g+1]=cg(u[g+1]))}(l,L,f,g,m),v=Nu(y,b),m?l.classBindings=v:l.styleBindings=v}(p,m,l,u,v,g)}}(m,f,v,g),l!==tt&&jn(p,v,l)&&function uw(f,l,u,g,p,m,v,y){if(!(3&l.type))return;const b=f.data,A=b[y+1];Yu(function T0(f){return 1==(1&f)}(A)?hw(b,l,u,p,Ur(A),v):void 0)||(Yu(m)||function I0(f){return 2==(2&f)}(A)&&(m=hw(b,null,u,p,y,v)),function g1(f,l,u,g,p){const m=nn(f);if(l)p?m?f.addClass(u,g):u.classList.add(g):m?f.removeClass(u,g):u.classList.remove(g);else{let v=-1===g.indexOf("-")?void 0:ui.DashCase;if(null==p)m?f.removeStyle(u,g,v):u.style.removeProperty(g);else{const y="string"==typeof p&&p.endsWith("!important");y&&(p=p.slice(0,-10),v|=ui.Important),m?f.setStyle(u,g,p,v):u.style.setProperty(g,p,y?"important":"")}}}(g,v,hu(Wn(),u),p,m))}(m,m.data[Wn()],p,p[11],f,p[v+1]=function MO(f,l){return null==f||("string"==typeof l?f+=l:"object"==typeof f&&(f=At(ws(f)))),f}(l,u),g,v)}(f,l,null,!0),zu}function $g(f,l,u,g,p){let m=null;const v=u.directiveEnd;let y=u.directiveStylingLast;for(-1===y?y=u.directiveStart:y++;y<v&&(m=l[y],g=Ol(g,m.hostAttrs,p),m!==f);)y++;return null!==f&&(u.directiveStylingLast=y),g}function Ol(f,l,u){const g=u?1:2;let p=-1;if(null!==l)for(let m=0;m<l.length;m++){const v=l[m];"number"==typeof v?p=v:p===g&&(Array.isArray(f)||(f=void 0===f?[]:["",f]),ci(f,v,!!u||l[++m]))}return void 0===f?null:f}function hw(f,l,u,g,p,m){const v=null===l;let y;for(;p>0;){const b=f[p],A=Array.isArray(b),L=A?b[1]:b,N=null===L;let k=u[p+1];k===tt&&(k=N?Vt:void 0);let j=N?Lf(k,g):L===g?k:void 0;if(A&&!Yu(j)&&(j=Lf(b,g)),Yu(j)&&(y=j,v))return y;const H=f[p+1];p=v?Ki(H):Ur(H)}if(null!==l){let b=m?l.residualClasses:l.residualStyles;null!=b&&(y=Lf(b,g))}return y}function Yu(f){return void 0!==f}function Lt(f,l=""){const u=ve(),g=It(),p=f+20,m=g.firstCreatePass?Yo(g,p,1,l,null):g.data[p],v=u[p]=function Jf(f,l){return nn(f)?f.createText(l):f.createTextNode(l)}(u[11],l);Fu(g,u,v,m),pr(m,!1)}function Dr(f,l,u){const g=ve(),p=function Jo(f,l,u,g){return jn(f,Lo(),u)?l+Je(u)+g:tt}(g,f,l,u);return p!==tt&&Gr(g,Wn(),p),Dr}const $u="en-US";let Pw=$u;function Zg(f,l,u,g,p){if(f=ot(f),Array.isArray(f))for(let m=0;m<f.length;m++)Zg(f[m],l,u,g,p);else{const m=It(),v=ve();let y=Zo(f)?f:ot(f.provide),b=oC(f);const A=wn(),L=1048575&A.providerIndexes,N=A.directiveStart,k=A.providerIndexes>>20;if(Zo(f)||!f.multi){const j=new ol(b,p,ye),H=Qg(y,l,p?L:L+k,N);-1===H?(Eu(ll(A,v),m,y),Kg(m,f,l.length),l.push(y),A.directiveStart++,A.directiveEnd++,p&&(A.providerIndexes+=1048576),u.push(j),v.push(j)):(u[H]=j,v[H]=j)}else{const j=Qg(y,l,L+k,N),H=Qg(y,l,L,L+k),z=j>=0&&u[j],$=H>=0&&u[H];if(p&&!$||!p&&!z){Eu(ll(A,v),m,y);const q=function ZL(f,l,u,g,p){const m=new ol(f,u,ye);return m.multi=[],m.index=l,m.componentProviders=0,sE(m,p,g&&!u),m}(p?qL:XL,u.length,p,g,b);!p&&$&&(u[H].providerFactory=q),Kg(m,f,l.length,0),l.push(y),A.directiveStart++,A.directiveEnd++,p&&(A.providerIndexes+=1048576),u.push(q),v.push(q)}else Kg(m,f,j>-1?j:H,sE(u[p?H:j],b,!p&&g));!p&&g&&$&&u[H].componentProviders++}}}function Kg(f,l,u,g){const p=Zo(l),m=function _M(f){return!!f.useClass}(l);if(p||m){const b=(m?ot(l.useClass):l).prototype.ngOnDestroy;if(b){const A=f.destroyHooks||(f.destroyHooks=[]);if(!p&&l.multi){const L=A.indexOf(u);-1===L?A.push(u,[g,b]):A[L+1].push(g,b)}else A.push(u,b)}}}function sE(f,l,u){return u&&f.componentProviders++,f.multi.push(l)-1}function Qg(f,l,u,g){for(let p=u;p<g;p++)if(l[p]===f)return p;return-1}function XL(f,l,u,g){return Jg(this.multi,[])}function qL(f,l,u,g){const p=this.multi;let m;if(this.providerFactory){const v=this.providerFactory.componentProviders,y=cl(u,u[1],this.providerFactory.index,g);m=y.slice(0,v),Jg(p,m);for(let b=v;b<y.length;b++)m.push(y[b])}else m=[],Jg(p,m);return m}function Jg(f,l){for(let u=0;u<f.length;u++)l.push((0,f[u])());return l}function Kt(f,l=[]){return u=>{u.providersResolver=(g,p)=>function $L(f,l,u){const g=It();if(g.firstCreatePass){const p=qi(f);Zg(u,g.data,g.blueprint,p,!0),Zg(l,g.data,g.blueprint,p,!1)}}(g,p?p(f):f,l)}}class oE{}class JL{resolveComponentFactory(l){throw function QL(f){const l=Error(`No component factory found for ${At(f)}. Did you add it to @NgModule.entryComponents?`);return l.ngComponent=f,l}(l)}}let kl=(()=>{class f{}return f.NULL=new JL,f})();function eF(){return ha(wn(),ve())}function ha(f,l){return new di(Ri(f,l))}let di=(()=>{class f{constructor(u){this.nativeElement=u}}return f.__NG_ELEMENT_ID__=eF,f})();class lE{}let Wr=(()=>{class f{}return f.__NG_ELEMENT_ID__=()=>function iF(){const f=ve(),u=li(wn().index,f);return function nF(f){return f[11]}(gr(u)?u:f)}(),f})(),rF=(()=>{class f{}return f.\u0275prov=Ct({token:f,providedIn:"root",factory:()=>null}),f})();class Bl{constructor(l){this.full=l,this.major=l.split(".")[0],this.minor=l.split(".")[1],this.patch=l.split(".").slice(2).join(".")}}const sF=new Bl("13.3.10"),ep={};function Qu(f,l,u,g,p=!1){for(;null!==u;){const m=l[u.index];if(null!==m&&g.push(fn(m)),Xi(m))for(let y=10;y<m.length;y++){const b=m[y],A=b[1].firstChild;null!==A&&Qu(b[1],b,A,g)}const v=u.type;if(8&v)Qu(f,l,u.child,g);else if(32&v){const y=Zf(u,l);let b;for(;b=y();)g.push(b)}else if(16&v){const y=p0(l,u);if(Array.isArray(y))g.push(...y);else{const b=Dl(l[16]);Qu(b[1],b,y,g,!0)}}u=p?u.projectionNext:u.next}return g}class Vl{constructor(l,u){this._lView=l,this._cdRefInjectingView=u,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const l=this._lView,u=l[1];return Qu(u,l,u.firstChild,[])}get context(){return this._lView[8]}set context(l){this._lView[8]=l}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const l=this._lView[3];if(Xi(l)){const u=l[8],g=u?u.indexOf(this):-1;g>-1&&(tg(l,g),Du(u,g))}this._attachedToViewContainer=!1}o0(this._lView[1],this._lView)}onDestroy(l){!function U0(f,l,u,g){const p=K0(l);null===u?p.push(g):(p.push(u),f.firstCreatePass&&Q0(f).push(g,p.length-1))}(this._lView[1],this._lView,null,l)}markForCheck(){Dg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function Ig(f,l,u){const g=l[10];g.begin&&g.begin();try{Xo(f,l,f.template,u)}catch(p){throw eC(l,p),p}finally{g.end&&g.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new St(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function r1(f,l){Sl(f,l,l[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new St(902,"");this._appRef=l}}class oF extends Vl{constructor(l){super(l),this._view=l}detectChanges(){Z0(this._view)}checkNoChanges(){}get context(){return null}}class cE extends kl{constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){const u=Nn(l);return new tp(u,this.ngModule)}}function uE(f){const l=[];for(let u in f)f.hasOwnProperty(u)&&l.push({propName:f[u],templateName:u});return l}class tp extends oE{constructor(l,u){super(),this.componentDef=l,this.ngModule=u,this.componentType=l.type,this.selector=function D1(f){return f.map(b1).join(",")}(l.selectors),this.ngContentSelectors=l.ngContentSelectors?l.ngContentSelectors:[],this.isBoundToModule=!!u}get inputs(){return uE(this.componentDef.inputs)}get outputs(){return uE(this.componentDef.outputs)}create(l,u,g,p){const m=(p=p||this.ngModule)?function lF(f,l){return{get:(u,g,p)=>{const m=f.get(u,ep,p);return m!==ep||g===ep?m:l.get(u,g,p)}}}(l,p.injector):l,v=m.get(lE,qv),y=m.get(rF,null),b=v.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",L=g?function j0(f,l,u){if(nn(f))return f.selectRootElement(l,u===dr.ShadowDom);let g="string"==typeof l?f.querySelector(l):l;return g.textContent="",g}(b,g,this.componentDef.encapsulation):eg(v.createRenderer(null,this.componentDef),A,function aF(f){const l=f.toLowerCase();return"svg"===l?"svg":"math"===l?"math":null}(A)),N=this.componentDef.onPush?576:528,k=function vC(f,l){return{components:[],scheduler:f||ZR,clean:lM,playerHandler:l||null,flags:0}}(),j=Vu(0,null,null,1,0,null,null,null,null,null),H=Il(null,j,k,N,null,null,v,b,y,m);let z,$;fu(H);try{const q=function mC(f,l,u,g,p,m){const v=u[1];u[20]=f;const b=Yo(v,20,2,"#host",null),A=b.mergedAttrs=l.hostAttrs;null!==A&&(Uu(b,A,!0),null!==f&&(vu(p,f,A),null!==b.classes&&og(p,f,b.classes),null!==b.styles&&v0(p,f,b.styles)));const L=g.createRenderer(f,l),N=Il(u,B0(l),null,l.onPush?64:16,u[20],b,g,L,m||null,null);return v.firstCreatePass&&(Eu(ll(b,u),v,l.type),Y0(v,b),$0(b,u.length,1)),ju(u,N),u[20]=N}(L,this.componentDef,H,v,b);if(L)if(g)vu(b,L,["ng-version",sF.full]);else{const{attrs:X,classes:Q}=function S1(f){const l=[],u=[];let g=1,p=2;for(;g<f.length;){let m=f[g];if("string"==typeof m)2===p?""!==m&&l.push(m,f[++g]):8===p&&u.push(m);else{if(!Zi(p))break;p=m}g++}return{attrs:l,classes:u}}(this.componentDef.selectors[0]);X&&vu(b,L,X),Q&&Q.length>0&&og(b,L,Q.join(" "))}if($=mf(j,20),void 0!==u){const X=$.projection=[];for(let Q=0;Q<this.ngContentSelectors.length;Q++){const pe=u[Q];X.push(null!=pe?Array.from(pe):null)}}z=function _C(f,l,u,g,p){const m=u[1],v=function Y1(f,l,u){const g=wn();f.firstCreatePass&&(u.providersResolver&&u.providersResolver(u),X0(f,g,l,$o(f,l,1,null),u));const p=cl(l,f,g.directiveStart,g);Vn(p,l);const m=Ri(g,l);return m&&Vn(m,l),p}(m,u,l);if(g.components.push(v),f[8]=v,p&&p.forEach(b=>b(v,l)),l.contentQueries){const b=wn();l.contentQueries(1,v,b.directiveStart)}const y=wn();return!m.firstCreatePass||null===l.hostBindings&&null===l.hostAttrs||(vs(y.index),W0(u[1],y,0,y.directiveStart,y.directiveEnd,l),z0(l,v)),v}(q,this.componentDef,H,k,[xM]),Tl(j,H,null)}finally{gu()}return new uF(this.componentType,z,ha($,H),H,$)}}class uF extends class KL{}{constructor(l,u,g,p,m){super(),this.location=g,this._rootLView=p,this._tNode=m,this.instance=u,this.hostView=this.changeDetectorRef=new oF(p),this.componentType=l}get injector(){return new No(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}}class zr{}class hE{}const da=new Map;class gE extends zr{constructor(l,u){super(),this._parent=u,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new cE(this);const g=Ii(l);this._bootstrapComponents=vr(g.bootstrap),this._r3Injector=sC(l,u,[{provide:zr,useValue:this},{provide:kl,useValue:this.componentFactoryResolver}],At(l)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(l)}get(l,u=ei.THROW_IF_NOT_FOUND,g=qe.Default){return l===ei||l===zr||l===xg?this:this._r3Injector.get(l,u,g)}destroy(){const l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(u=>u()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}}class np extends hE{constructor(l){super(),this.moduleType=l,null!==Ii(l)&&function dF(f){const l=new Set;!function u(g){const p=Ii(g,!0),m=p.id;null!==m&&(function dE(f,l,u){if(l&&l!==u)throw new Error(`Duplicate module registered for ${f} - ${At(l)} vs ${At(l.name)}`)}(m,da.get(m),g),da.set(m,g));const v=vr(p.imports);for(const y of v)l.has(y)||(l.add(y),u(y))}(f)}(l)}create(l){return new gE(this.moduleType,l)}}function Ds(f,l,u){const g=function Hn(){const f=et.lFrame;let l=f.bindingRootIndex;return-1===l&&(l=f.bindingRootIndex=f.tView.bindingStartIndex),l}()+f,p=ve();return p[g]===tt?function Cr(f,l,u){return f[l]=u}(p,g,u?l.call(u):l()):function Rl(f,l){return f[l]}(p,g)}function ip(f){return l=>{setTimeout(f,void 0,l)}}const on=class AF extends Fr{constructor(l=!1){super(),this.__isAsync=l}emit(l){super.next(l)}subscribe(l,u,g){var p,m,v;let y=l,b=u||(()=>null),A=g;if(l&&"object"==typeof l){const N=l;y=null===(p=N.next)||void 0===p?void 0:p.bind(N),b=null===(m=N.error)||void 0===m?void 0:m.bind(N),A=null===(v=N.complete)||void 0===v?void 0:v.bind(N)}this.__isAsync&&(b=ip(b),y&&(y=ip(y)),A&&(A=ip(A)));const L=super.subscribe({next:y,error:b,complete:A});return l instanceof Di&&l.add(L),L}};Symbol;let Yr=(()=>{class f{}return f.__NG_ELEMENT_ID__=LF,f})();const MF=Yr,OF=class extends MF{constructor(l,u,g){super(),this._declarationLView=l,this._declarationTContainer=u,this.elementRef=g}createEmbeddedView(l){const u=this._declarationTContainer.tViews,g=Il(this._declarationLView,u,l,16,null,u.declTNode,null,null,null,null);g[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(g[19]=m.createEmbeddedView(u)),Tl(u,g,l),new Vl(g)}};function LF(){return function Ju(f,l){return 4&f.type?new OF(l,f,ha(f,l)):null}(wn(),ve())}let nr=(()=>{class f{}return f.__NG_ELEMENT_ID__=FF,f})();function FF(){return function EE(f,l){let u;const g=l[f.index];if(Xi(g))u=g;else{let p;if(8&f.type)p=fn(g);else{const m=l[11];p=m.createComment("");const v=Ri(f,l);Js(m,Lu(m,v),p,function h1(f,l){return nn(f)?f.nextSibling(l):l.nextSibling}(m,v),!1)}l[f.index]=u=q0(g,l,p,f),ju(l,u)}return new CE(u,f,l)}(wn(),ve())}const PF=nr,CE=class extends PF{constructor(l,u,g){super(),this._lContainer=l,this._hostTNode=u,this._hostLView=g}get element(){return ha(this._hostTNode,this._hostLView)}get injector(){return new No(this._hostTNode,this._hostLView)}get parentInjector(){const l=wu(this._hostTNode,this._hostLView);if(dy(l)){const u=Po(l,this._hostLView),g=Fo(l);return new No(u[1].data[g+8],u)}return new No(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){const u=wE(this._lContainer);return null!==u&&u[l]||null}get length(){return this._lContainer.length-10}createEmbeddedView(l,u,g){const p=l.createEmbeddedView(u||{});return this.insert(p,g),p}createComponent(l,u,g,p,m){const v=l&&!function dl(f){return"function"==typeof f}(l);let y;if(v)y=u;else{const N=u||{};y=N.index,g=N.injector,p=N.projectableNodes,m=N.ngModuleRef}const b=v?l:new tp(Nn(l)),A=g||this.parentInjector;if(!m&&null==b.ngModule){const k=(v?A:this.parentInjector).get(zr,null);k&&(m=k)}const L=b.create(A,p,void 0,m);return this.insert(L.hostView,y),L}insert(l,u){const g=l._lView,p=g[1];if(function eA(f){return Xi(f[3])}(g)){const L=this.indexOf(l);if(-1!==L)this.detach(L);else{const N=g[3],k=new CE(N,N[6],N[3]);k.detach(k.indexOf(l))}}const m=this._adjustIndex(u),v=this._lContainer;!function o1(f,l,u,g){const p=10+g,m=u.length;g>0&&(u[p-1][4]=l),g<m-10?(l[4]=u[p],Ey(u,10+g,l)):(u.push(l),l[4]=null),l[3]=u;const v=l[17];null!==v&&u!==v&&function a1(f,l){const u=f[9];l[16]!==l[3][3][16]&&(f[2]=!0),null===u?f[9]=[l]:u.push(l)}(v,l);const y=l[19];null!==y&&y.insertView(f),l[2]|=128}(p,g,v,m);const y=rg(m,v),b=g[11],A=Lu(b,v[7]);return null!==A&&function i1(f,l,u,g,p,m){g[0]=p,g[6]=l,Sl(f,g,u,1,p,m)}(p,v[6],b,g,A,y),l.attachToViewContainerRef(),Ey(sp(v),m,l),l}move(l,u){return this.insert(l,u)}indexOf(l){const u=wE(this._lContainer);return null!==u?u.indexOf(l):-1}remove(l){const u=this._adjustIndex(l,-1),g=tg(this._lContainer,u);g&&(Du(sp(this._lContainer),u),o0(g[1],g))}detach(l){const u=this._adjustIndex(l,-1),g=tg(this._lContainer,u);return g&&null!=Du(sp(this._lContainer),u)?new Vl(g):null}_adjustIndex(l,u=0){return null==l?this.length+u:l}};function wE(f){return f[8]}function sp(f){return f[8]||(f[8]=[])}function nh(...f){}const yp=new gt("Application Initializer");let Cp=(()=>{class f{constructor(u){this.appInits=u,this.resolve=nh,this.reject=nh,this.initialized=!1,this.done=!1,this.donePromise=new Promise((g,p)=>{this.resolve=g,this.reject=p})}runInitializers(){if(this.initialized)return;const u=[],g=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let p=0;p<this.appInits.length;p++){const m=this.appInits[p]();if(Ml(m))u.push(m);else if(Wg(m)){const v=new Promise((y,b)=>{m.subscribe({complete:y,error:b})});u.push(v)}}Promise.all(u).then(()=>{g()}).catch(p=>{this.reject(p)}),0===u.length&&g(),this.initialized=!0}}return f.\u0275fac=function(u){return new(u||f)(Xe(yp,8))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const Hl=new gt("AppId",{providedIn:"root",factory:function WE(){return`${wp()}${wp()}${wp()}`}});function wp(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const zE=new gt("Platform Initializer"),YE=new gt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),$E=new gt("appBootstrapListener");let lP=(()=>{class f{log(u){console.log(u)}warn(u){console.warn(u)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();const Ss=new gt("LocaleId",{providedIn:"root",factory:()=>$A(Ss,qe.Optional|qe.SkipSelf)||function cP(){return"undefined"!=typeof $localize&&$localize.locale||$u}()});class hP{constructor(l,u){this.ngModuleFactory=l,this.componentFactories=u}}let XE=(()=>{class f{compileModuleSync(u){return new np(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){const g=this.compileModuleSync(u),m=vr(Ii(u).declarations).reduce((v,y)=>{const b=Nn(y);return b&&v.push(new tp(b)),v},[]);return new hP(g,m)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const fP=(()=>Promise.resolve(0))();function Ep(f){"undefined"==typeof Zone?fP.then(()=>{f&&f.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",f)}class On{constructor({enableLongStackTrace:l=!1,shouldCoalesceEventChangeDetection:u=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new on(!1),this.onMicrotaskEmpty=new on(!1),this.onStable=new on(!1),this.onError=new on(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const p=this;p._nesting=0,p._outer=p._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(p._inner=p._inner.fork(new Zone.TaskTrackingZoneSpec)),l&&Zone.longStackTraceZoneSpec&&(p._inner=p._inner.fork(Zone.longStackTraceZoneSpec)),p.shouldCoalesceEventChangeDetection=!g&&u,p.shouldCoalesceRunChangeDetection=g,p.lastRequestAnimationFrameId=-1,p.nativeRequestAnimationFrame=function gP(){let f=Ot.requestAnimationFrame,l=Ot.cancelAnimationFrame;if("undefined"!=typeof Zone&&f&&l){const u=f[Zone.__symbol__("OriginalDelegate")];u&&(f=u);const g=l[Zone.__symbol__("OriginalDelegate")];g&&(l=g)}return{nativeRequestAnimationFrame:f,nativeCancelAnimationFrame:l}}().nativeRequestAnimationFrame,function _P(f){const l=()=>{!function mP(f){f.isCheckStableRunning||-1!==f.lastRequestAnimationFrameId||(f.lastRequestAnimationFrameId=f.nativeRequestAnimationFrame.call(Ot,()=>{f.fakeTopEventTask||(f.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{f.lastRequestAnimationFrameId=-1,Dp(f),f.isCheckStableRunning=!0,bp(f),f.isCheckStableRunning=!1},void 0,()=>{},()=>{})),f.fakeTopEventTask.invoke()}),Dp(f))}(f)};f._inner=f._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(u,g,p,m,v,y)=>{try{return qE(f),u.invokeTask(p,m,v,y)}finally{(f.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||f.shouldCoalesceRunChangeDetection)&&l(),ZE(f)}},onInvoke:(u,g,p,m,v,y,b)=>{try{return qE(f),u.invoke(p,m,v,y,b)}finally{f.shouldCoalesceRunChangeDetection&&l(),ZE(f)}},onHasTask:(u,g,p,m)=>{u.hasTask(p,m),g===p&&("microTask"==m.change?(f._hasPendingMicrotasks=m.microTask,Dp(f),bp(f)):"macroTask"==m.change&&(f.hasPendingMacrotasks=m.macroTask))},onHandleError:(u,g,p,m)=>(u.handleError(p,m),f.runOutsideAngular(()=>f.onError.emit(m)),!1)})}(p)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!On.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(On.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(l,u,g){return this._inner.run(l,u,g)}runTask(l,u,g,p){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+p,l,pP,nh,nh);try{return m.runTask(v,u,g)}finally{m.cancelTask(v)}}runGuarded(l,u,g){return this._inner.runGuarded(l,u,g)}runOutsideAngular(l){return this._outer.run(l)}}const pP={};function bp(f){if(0==f._nesting&&!f.hasPendingMicrotasks&&!f.isStable)try{f._nesting++,f.onMicrotaskEmpty.emit(null)}finally{if(f._nesting--,!f.hasPendingMicrotasks)try{f.runOutsideAngular(()=>f.onStable.emit(null))}finally{f.isStable=!0}}}function Dp(f){f.hasPendingMicrotasks=!!(f._hasPendingMicrotasks||(f.shouldCoalesceEventChangeDetection||f.shouldCoalesceRunChangeDetection)&&-1!==f.lastRequestAnimationFrameId)}function qE(f){f._nesting++,f.isStable&&(f.isStable=!1,f.onUnstable.emit(null))}function ZE(f){f._nesting--,bp(f)}class vP{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new on,this.onMicrotaskEmpty=new on,this.onStable=new on,this.onError=new on}run(l,u,g){return l.apply(u,g)}runGuarded(l,u,g){return l.apply(u,g)}runOutsideAngular(l){return l()}runTask(l,u,g,p){return l.apply(u,g)}}let Sp=(()=>{class f{constructor(u){this._ngZone=u,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),u.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{On.assertNotInAngularZone(),Ep(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ep(()=>{for(;0!==this._callbacks.length;){let u=this._callbacks.pop();clearTimeout(u.timeoutId),u.doneCb(this._didWork)}this._didWork=!1});else{let u=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>!g.updateCb||!g.updateCb(u)||(clearTimeout(g.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(u=>({source:u.source,creationLocation:u.creationLocation,data:u.data})):[]}addCallback(u,g,p){let m=-1;g&&g>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),u(this._didWork,this.getPendingTasks())},g)),this._callbacks.push({doneCb:u,timeoutId:m,updateCb:p})}whenStable(u,g,p){if(p&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(u,g,p),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(u,g,p){return[]}}return f.\u0275fac=function(u){return new(u||f)(Xe(On))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})(),yP=(()=>{class f{constructor(){this._applications=new Map,Ip.addToWindow(this)}registerApplication(u,g){this._applications.set(u,g)}unregisterApplication(u){this._applications.delete(u)}unregisterAllApplications(){this._applications.clear()}getTestability(u){return this._applications.get(u)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(u,g=!0){return Ip.findTestabilityInTree(this,u,g)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();class CP{addToWindow(l){}findTestabilityInTree(l,u,g){return null}}let Ip=new CP,no=null;const KE=new gt("AllowMultipleToken"),QE=new gt("PlatformOnDestroy");class JE{constructor(l,u){this.name=l,this.token=u}}function eb(f,l,u=[]){const g=`Platform: ${l}`,p=new gt(g);return(m=[])=>{let v=Tp();if(!v||v.injector.get(KE,!1)){const y=[...u,...m,{provide:p,useValue:!0}];f?f(y):function DP(f){if(no&&!no.get(KE,!1))throw new St(400,"");no=f;const l=f.get(tb),u=f.get(zE,null);u&&u.forEach(g=>g())}(function IP(f=[],l){return ei.create({name:l,providers:[{provide:Ag,useValue:"platform"},{provide:QE,useValue:()=>no=null},...f]})}(y,g))}return function SP(f){const l=Tp();if(!l)throw new St(401,"");return l}()}}function Tp(){var f;return null!==(f=null==no?void 0:no.get(tb))&&void 0!==f?f:null}let tb=(()=>{class f{constructor(u){this._injector=u,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(u,g){const y=function TP(f,l){let u;return u="noop"===f?new vP:("zone.js"===f?void 0:f)||new On({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==l?void 0:l.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==l?void 0:l.ngZoneRunCoalescing)}),u}(g?g.ngZone:void 0,{ngZoneEventCoalescing:g&&g.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:g&&g.ngZoneRunCoalescing||!1}),b=[{provide:On,useValue:y}];return y.run(()=>{const A=ei.create({providers:b,parent:this.injector,name:u.moduleType.name}),L=u.create(A),N=L.injector.get(bl,null);if(!N)throw new St(402,"");return y.runOutsideAngular(()=>{const k=y.onError.subscribe({next:j=>{N.handleError(j)}});L.onDestroy(()=>{Ap(this._modules,L),k.unsubscribe()})}),function xP(f,l,u){try{const g=u();return Ml(g)?g.catch(p=>{throw l.runOutsideAngular(()=>f.handleError(p)),p}):g}catch(g){throw l.runOutsideAngular(()=>f.handleError(g)),g}}(N,y,()=>{const k=L.injector.get(Cp);return k.runInitializers(),k.donePromise.then(()=>(function nL(f){oi(f,"Expected localeId to be defined"),"string"==typeof f&&(Pw=f.toLowerCase().replace(/_/g,"-"))}(L.injector.get(Ss,$u)||$u),this._moduleDoBootstrap(L),L))})})}bootstrapModule(u,g=[]){const p=nb({},g);return function EP(f,l,u){const g=new np(u);return Promise.resolve(g)}(0,0,u).then(m=>this.bootstrapModuleFactory(m,p))}_moduleDoBootstrap(u){const g=u.injector.get(xp);if(u._bootstrapComponents.length>0)u._bootstrapComponents.forEach(p=>g.bootstrap(p));else{if(!u.instance.ngDoBootstrap)throw new St(403,"");u.instance.ngDoBootstrap(g)}this._modules.push(u)}onDestroy(u){this._destroyListeners.push(u)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new St(404,"");this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());const u=this._injector.get(QE,null);null==u||u(),this._destroyed=!0}get destroyed(){return this._destroyed}}return f.\u0275fac=function(u){return new(u||f)(Xe(ei))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"platform"}),f})();function nb(f,l){return Array.isArray(l)?l.reduce(nb,f):Object.assign(Object.assign({},f),l)}let xp=(()=>{class f{constructor(u,g,p,m){this._zone=u,this._injector=g,this._exceptionHandler=p,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new dn(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),y=new dn(b=>{let A;this._zone.runOutsideAngular(()=>{A=this._zone.onStable.subscribe(()=>{On.assertNotInAngularZone(),Ep(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{On.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{A.unsubscribe(),L.unsubscribe()}});this.isStable=function yx(...f){const l=el(f),u=function dx(f,l){return"number"==typeof Zd(f)?f.pop():l}(f,1/0),g=f;return g.length?1===g.length?hr(g[0]):Ja(u)(Tn(g,l)):Nr}(v,y.pipe(function Cx(f={}){const{connector:l=(()=>new Fr),resetOnError:u=!0,resetOnComplete:g=!0,resetOnRefCountZero:p=!0}=f;return m=>{let v=null,y=null,b=null,A=0,L=!1,N=!1;const k=()=>{null==y||y.unsubscribe(),y=null},j=()=>{k(),v=b=null,L=N=!1},H=()=>{const z=v;j(),null==z||z.unsubscribe()};return An((z,$)=>{A++,!N&&!L&&k();const q=b=null!=b?b:l();$.add(()=>{A--,0===A&&!N&&!L&&(y=Kd(H,p))}),q.subscribe($),v||(v=new eu({next:X=>q.next(X),error:X=>{N=!0,k(),y=Kd(j,u,X),q.error(X)},complete:()=>{L=!0,k(),y=Kd(j,g),q.complete()}}),Tn(z).subscribe(v))})(m)}}()))}bootstrap(u,g){if(!this._initStatus.done)throw new St(405,"");let p;p=u instanceof oE?u:this._injector.get(kl).resolveComponentFactory(u),this.componentTypes.push(p.componentType);const m=function bP(f){return f.isBoundToModule}(p)?void 0:this._injector.get(zr),y=p.create(ei.NULL,[],g||p.selector,m),b=y.location.nativeElement,A=y.injector.get(Sp,null),L=A&&y.injector.get(yP);return A&&L&&L.registerApplication(b,A),y.onDestroy(()=>{this.detachView(y.hostView),Ap(this.components,y),L&&L.unregisterApplication(b)}),this._loadComponent(y),y}tick(){if(this._runningTick)throw new St(101,"");try{this._runningTick=!0;for(let u of this._views)u.detectChanges()}catch(u){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(u))}finally{this._runningTick=!1}}attachView(u){const g=u;this._views.push(g),g.attachToAppRef(this)}detachView(u){const g=u;Ap(this._views,g),g.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u),this._injector.get($E,[]).concat(this._bootstrapListeners).forEach(p=>p(u))}ngOnDestroy(){this._views.slice().forEach(u=>u.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return f.\u0275fac=function(u){return new(u||f)(Xe(On),Xe(ei),Xe(bl),Xe(Cp))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();function Ap(f,l){const u=f.indexOf(l);u>-1&&f.splice(u,1)}let rb=!0,ih=(()=>{class f{}return f.__NG_ELEMENT_ID__=MP,f})();function MP(f){return function OP(f,l,u){if(cu(f)&&!u){const g=li(f.index,l);return new Vl(g,g)}return 47&f.type?new Vl(l[16],l):null}(wn(),ve(),16==(16&f))}class cb{constructor(){}supports(l){return Al(l)}create(l){return new BP(l)}}const kP=(f,l)=>l;class BP{constructor(l){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=l||kP}forEachItem(l){let u;for(u=this._itHead;null!==u;u=u._next)l(u)}forEachOperation(l){let u=this._itHead,g=this._removalsHead,p=0,m=null;for(;u||g;){const v=!g||u&&u.currentIndex<hb(g,p,m)?u:g,y=hb(v,p,m),b=v.currentIndex;if(v===g)p--,g=g._nextRemoved;else if(u=u._next,null==v.previousIndex)p++;else{m||(m=[]);const A=y-p,L=b-p;if(A!=L){for(let k=0;k<A;k++){const j=k<m.length?m[k]:m[k]=0,H=j+k;L<=H&&H<A&&(m[k]=j+1)}m[v.previousIndex]=L-A}}y!==b&&l(v,y,b)}}forEachPreviousItem(l){let u;for(u=this._previousItHead;null!==u;u=u._nextPrevious)l(u)}forEachAddedItem(l){let u;for(u=this._additionsHead;null!==u;u=u._nextAdded)l(u)}forEachMovedItem(l){let u;for(u=this._movesHead;null!==u;u=u._nextMoved)l(u)}forEachRemovedItem(l){let u;for(u=this._removalsHead;null!==u;u=u._nextRemoved)l(u)}forEachIdentityChange(l){let u;for(u=this._identityChangesHead;null!==u;u=u._nextIdentityChange)l(u)}diff(l){if(null==l&&(l=[]),!Al(l))throw new St(900,"");return this.check(l)?this:null}onDestroy(){}check(l){this._reset();let p,m,v,u=this._itHead,g=!1;if(Array.isArray(l)){this.length=l.length;for(let y=0;y<this.length;y++)m=l[y],v=this._trackByFn(y,m),null!==u&&Object.is(u.trackById,v)?(g&&(u=this._verifyReinsertion(u,m,v,y)),Object.is(u.item,m)||this._addIdentityChange(u,m)):(u=this._mismatch(u,m,v,y),g=!0),u=u._next}else p=0,function BM(f,l){if(Array.isArray(f))for(let u=0;u<f.length;u++)l(f[u]);else{const u=f[Ko()]();let g;for(;!(g=u.next()).done;)l(g.value)}}(l,y=>{v=this._trackByFn(p,y),null!==u&&Object.is(u.trackById,v)?(g&&(u=this._verifyReinsertion(u,y,v,p)),Object.is(u.item,y)||this._addIdentityChange(u,y)):(u=this._mismatch(u,y,v,p),g=!0),u=u._next,p++}),this.length=p;return this._truncate(u),this.collection=l,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let l;for(l=this._previousItHead=this._itHead;null!==l;l=l._next)l._nextPrevious=l._next;for(l=this._additionsHead;null!==l;l=l._nextAdded)l.previousIndex=l.currentIndex;for(this._additionsHead=this._additionsTail=null,l=this._movesHead;null!==l;l=l._nextMoved)l.previousIndex=l.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(l,u,g,p){let m;return null===l?m=this._itTail:(m=l._prev,this._remove(l)),null!==(l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._reinsertAfter(l,m,p)):null!==(l=null===this._linkedRecords?null:this._linkedRecords.get(g,p))?(Object.is(l.item,u)||this._addIdentityChange(l,u),this._moveAfter(l,m,p)):l=this._addAfter(new VP(u,g),m,p),l}_verifyReinsertion(l,u,g,p){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==m?l=this._reinsertAfter(m,l._prev,p):l.currentIndex!=p&&(l.currentIndex=p,this._addToMoves(l,p)),l}_truncate(l){for(;null!==l;){const u=l._next;this._addToRemovals(this._unlink(l)),l=u}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(l,u,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(l);const p=l._prevRemoved,m=l._nextRemoved;return null===p?this._removalsHead=m:p._nextRemoved=m,null===m?this._removalsTail=p:m._prevRemoved=p,this._insertAfter(l,u,g),this._addToMoves(l,g),l}_moveAfter(l,u,g){return this._unlink(l),this._insertAfter(l,u,g),this._addToMoves(l,g),l}_addAfter(l,u,g){return this._insertAfter(l,u,g),this._additionsTail=null===this._additionsTail?this._additionsHead=l:this._additionsTail._nextAdded=l,l}_insertAfter(l,u,g){const p=null===u?this._itHead:u._next;return l._next=p,l._prev=u,null===p?this._itTail=l:p._prev=l,null===u?this._itHead=l:u._next=l,null===this._linkedRecords&&(this._linkedRecords=new ub),this._linkedRecords.put(l),l.currentIndex=g,l}_remove(l){return this._addToRemovals(this._unlink(l))}_unlink(l){null!==this._linkedRecords&&this._linkedRecords.remove(l);const u=l._prev,g=l._next;return null===u?this._itHead=g:u._next=g,null===g?this._itTail=u:g._prev=u,l}_addToMoves(l,u){return l.previousIndex===u||(this._movesTail=null===this._movesTail?this._movesHead=l:this._movesTail._nextMoved=l),l}_addToRemovals(l){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ub),this._unlinkedRecords.put(l),l.currentIndex=null,l._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=l,l._prevRemoved=null):(l._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=l),l}_addIdentityChange(l,u){return l.item=u,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=l:this._identityChangesTail._nextIdentityChange=l,l}}class VP{constructor(l,u){this.item=l,this.trackById=u,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class jP{constructor(){this._head=null,this._tail=null}add(l){null===this._head?(this._head=this._tail=l,l._nextDup=null,l._prevDup=null):(this._tail._nextDup=l,l._prevDup=this._tail,l._nextDup=null,this._tail=l)}get(l,u){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===u||u<=g.currentIndex)&&Object.is(g.trackById,l))return g;return null}remove(l){const u=l._prevDup,g=l._nextDup;return null===u?this._head=g:u._nextDup=g,null===g?this._tail=u:g._prevDup=u,null===this._head}}class ub{constructor(){this.map=new Map}put(l){const u=l.trackById;let g=this.map.get(u);g||(g=new jP,this.map.set(u,g)),g.add(l)}get(l,u){const p=this.map.get(l);return p?p.get(l,u):null}remove(l){const u=l.trackById;return this.map.get(u).remove(l)&&this.map.delete(u),l}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hb(f,l,u){const g=f.previousIndex;if(null===g)return g;let p=0;return u&&g<u.length&&(p=u[g]),g+l+p}function fb(){return new oh([new cb])}let oh=(()=>{class f{constructor(u){this.factories=u}static create(u,g){if(null!=g){const p=g.factories.slice();u=u.concat(p)}return new f(u)}static extend(u){return{provide:f,useFactory:g=>f.create(u,g||fb()),deps:[[f,new _l,new Cs]]}}find(u){const g=this.factories.find(p=>p.supports(u));if(null!=g)return g;throw new St(901,"")}}return f.\u0275prov=Ct({token:f,providedIn:"root",factory:fb}),f})();const zP=eb(null,"core",[]);let YP=(()=>{class f{constructor(u){}}return f.\u0275fac=function(u){return new(u||f)(Xe(xp))},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({}),f})(),ah=null;function Sr(){return ah}const Li=new gt("DocumentToken");let ro=(()=>{class f{historyGo(u){throw new Error("Not implemented")}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:function(){return function ZP(){return Xe(pb)}()},providedIn:"platform"}),f})();const KP=new gt("Location Initialized");let pb=(()=>{class f extends ro{constructor(u){super(),this._doc=u,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Sr().getBaseHref(this._doc)}onPopState(u){const g=Sr().getGlobalEventTarget(this._doc,"window");return g.addEventListener("popstate",u,!1),()=>g.removeEventListener("popstate",u)}onHashChange(u){const g=Sr().getGlobalEventTarget(this._doc,"window");return g.addEventListener("hashchange",u,!1),()=>g.removeEventListener("hashchange",u)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(u){this.location.pathname=u}pushState(u,g,p){mb()?this._history.pushState(u,g,p):this.location.hash=p}replaceState(u,g,p){mb()?this._history.replaceState(u,g,p):this.location.hash=p}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}}return f.\u0275fac=function(u){return new(u||f)(Xe(Li))},f.\u0275prov=Ct({token:f,factory:function(){return function QP(){return new pb(Xe(Li))}()},providedIn:"platform"}),f})();function mb(){return!!window.history.pushState}function Fp(f,l){if(0==f.length)return l;if(0==l.length)return f;let u=0;return f.endsWith("/")&&u++,l.startsWith("/")&&u++,2==u?f+l.substring(1):1==u?f+l:f+"/"+l}function _b(f){const l=f.match(/#|\?|$/),u=l&&l.index||f.length;return f.slice(0,u-("/"===f[u-1]?1:0))+f.slice(u)}function $r(f){return f&&"?"!==f[0]?"?"+f:f}let ga=(()=>{class f{historyGo(u){throw new Error("Not implemented")}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:function(){return function JP(f){const l=Xe(Li).location;return new vb(Xe(ro),l&&l.origin||"")}()},providedIn:"root"}),f})();const Pp=new gt("appBaseHref");let vb=(()=>{class f extends ga{constructor(u,g){if(super(),this._platformLocation=u,this._removeListenerFns=[],null==g&&(g=this._platformLocation.getBaseHrefFromDOM()),null==g)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=g}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return Fp(this._baseHref,u)}path(u=!1){const g=this._platformLocation.pathname+$r(this._platformLocation.search),p=this._platformLocation.hash;return p&&u?`${g}${p}`:g}pushState(u,g,p,m){const v=this.prepareExternalUrl(p+$r(m));this._platformLocation.pushState(u,g,v)}replaceState(u,g,p,m){const v=this.prepareExternalUrl(p+$r(m));this._platformLocation.replaceState(u,g,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformLocation).historyGo)||void 0===p||p.call(g,u)}}return f.\u0275fac=function(u){return new(u||f)(Xe(ro),Xe(Pp,8))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})(),eN=(()=>{class f extends ga{constructor(u,g){super(),this._platformLocation=u,this._baseHref="",this._removeListenerFns=[],null!=g&&(this._baseHref=g)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}path(u=!1){let g=this._platformLocation.hash;return null==g&&(g="#"),g.length>0?g.substring(1):g}prepareExternalUrl(u){const g=Fp(this._baseHref,u);return g.length>0?"#"+g:g}pushState(u,g,p,m){let v=this.prepareExternalUrl(p+$r(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(u,g,v)}replaceState(u,g,p,m){let v=this.prepareExternalUrl(p+$r(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(u,g,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformLocation).historyGo)||void 0===p||p.call(g,u)}}return f.\u0275fac=function(u){return new(u||f)(Xe(ro),Xe(Pp,8))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})(),Np=(()=>{class f{constructor(u,g){this._subject=new on,this._urlChangeListeners=[],this._platformStrategy=u;const p=this._platformStrategy.getBaseHref();this._platformLocation=g,this._baseHref=_b(yb(p)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(u=!1){return this.normalize(this._platformStrategy.path(u))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(u,g=""){return this.path()==this.normalize(u+$r(g))}normalize(u){return f.stripTrailingSlash(function nN(f,l){return f&&l.startsWith(f)?l.substring(f.length):l}(this._baseHref,yb(u)))}prepareExternalUrl(u){return u&&"/"!==u[0]&&(u="/"+u),this._platformStrategy.prepareExternalUrl(u)}go(u,g="",p=null){this._platformStrategy.pushState(p,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+$r(g)),p)}replaceState(u,g="",p=null){this._platformStrategy.replaceState(p,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+$r(g)),p)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(u=0){var g,p;null===(p=(g=this._platformStrategy).historyGo)||void 0===p||p.call(g,u)}onUrlChange(u){this._urlChangeListeners.push(u),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(g=>{this._notifyUrlChangeListeners(g.url,g.state)}))}_notifyUrlChangeListeners(u="",g){this._urlChangeListeners.forEach(p=>p(u,g))}subscribe(u,g,p){return this._subject.subscribe({next:u,error:g,complete:p})}}return f.normalizeQueryParams=$r,f.joinWithSlash=Fp,f.stripTrailingSlash=_b,f.\u0275fac=function(u){return new(u||f)(Xe(ga),Xe(ro))},f.\u0275prov=Ct({token:f,factory:function(){return function tN(){return new Np(Xe(ga),Xe(ro))}()},providedIn:"root"}),f})();function yb(f){return f.replace(/\/index.html$/,"")}class GN{constructor(l,u,g,p){this.$implicit=l,this.ngForOf=u,this.index=g,this.count=p}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let xb=(()=>{class f{constructor(u,g,p){this._viewContainer=u,this._template=g,this._differs=p,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(u){this._ngForOf=u,this._ngForOfDirty=!0}set ngForTrackBy(u){this._trackByFn=u}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(u){u&&(this._template=u)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const u=this._ngForOf;!this._differ&&u&&(this._differ=this._differs.find(u).create(this.ngForTrackBy))}if(this._differ){const u=this._differ.diff(this._ngForOf);u&&this._applyChanges(u)}}_applyChanges(u){const g=this._viewContainer;u.forEachOperation((p,m,v)=>{if(null==p.previousIndex)g.createEmbeddedView(this._template,new GN(p.item,this._ngForOf,-1,-1),null===v?void 0:v);else if(null==v)g.remove(null===m?void 0:m);else if(null!==m){const y=g.get(m);g.move(y,v),Ab(y,p)}});for(let p=0,m=g.length;p<m;p++){const y=g.get(p).context;y.index=p,y.count=m,y.ngForOf=this._ngForOf}u.forEachIdentityChange(p=>{Ab(g.get(p.currentIndex),p)})}static ngTemplateContextGuard(u,g){return!0}}return f.\u0275fac=function(u){return new(u||f)(ye(nr),ye(Yr),ye(oh))},f.\u0275dir=$e({type:f,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),f})();function Ab(f,l){f.context.$implicit=l.item}let Yp=(()=>{class f{constructor(u,g){this._viewContainer=u,this._context=new HN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=g}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){Rb("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){Rb("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,g){return!0}}return f.\u0275fac=function(u){return new(u||f)(ye(nr),ye(Yr))},f.\u0275dir=$e({type:f,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),f})();class HN{constructor(){this.$implicit=null,this.ngIf=null}}function Rb(f,l){if(l&&!l.createEmbeddedView)throw new Error(`${f} must be a TemplateRef, but received '${At(l)}'.`)}let mk=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({}),f})();let Ck=(()=>{class f{}return f.\u0275prov=Ct({token:f,providedIn:"root",factory:()=>new wk(Xe(Li),window)}),f})();class wk{constructor(l,u){this.document=l,this.window=u,this.offset=()=>[0,0]}setOffset(l){this.offset=Array.isArray(l)?()=>l:l}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(l){this.supportsScrolling()&&this.window.scrollTo(l[0],l[1])}scrollToAnchor(l){if(!this.supportsScrolling())return;const u=function Ek(f,l){const u=f.getElementById(l)||f.getElementsByName(l)[0];if(u)return u;if("function"==typeof f.createTreeWalker&&f.body&&(f.body.createShadowRoot||f.body.attachShadow)){const g=f.createTreeWalker(f.body,NodeFilter.SHOW_ELEMENT);let p=g.currentNode;for(;p;){const m=p.shadowRoot;if(m){const v=m.getElementById(l)||m.querySelector(`[name="${l}"]`);if(v)return v}p=g.nextNode()}}return null}(this.document,l);u&&(this.scrollToElement(u),u.focus())}setHistoryScrollRestoration(l){if(this.supportScrollRestoration()){const u=this.window.history;u&&u.scrollRestoration&&(u.scrollRestoration=l)}}scrollToElement(l){const u=l.getBoundingClientRect(),g=u.left+this.window.pageXOffset,p=u.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(g-m[0],p-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const l=Fb(this.window.history)||Fb(Object.getPrototypeOf(this.window.history));return!(!l||!l.writable&&!l.set)}catch(l){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(l){return!1}}}function Fb(f){return Object.getOwnPropertyDescriptor(f,"scrollRestoration")}class Kp extends class Dk extends class qP{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function XP(f){ah||(ah=f)}(new Kp)}onAndCancel(l,u,g){return l.addEventListener(u,g,!1),()=>{l.removeEventListener(u,g,!1)}}dispatchEvent(l,u){l.dispatchEvent(u)}remove(l){l.parentNode&&l.parentNode.removeChild(l)}createElement(l,u){return(u=u||this.getDefaultDocument()).createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,u){return"window"===u?window:"document"===u?l:"body"===u?l.body:null}getBaseHref(l){const u=function Sk(){return $l=$l||document.querySelector("base"),$l?$l.getAttribute("href"):null}();return null==u?null:function Ik(f){_h=_h||document.createElement("a"),_h.setAttribute("href",f);const l=_h.pathname;return"/"===l.charAt(0)?l:`/${l}`}(u)}resetBaseElement(){$l=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return function VN(f,l){l=encodeURIComponent(l);for(const u of f.split(";")){const g=u.indexOf("="),[p,m]=-1==g?[u,""]:[u.slice(0,g),u.slice(g+1)];if(p.trim()===l)return decodeURIComponent(m)}return null}(document.cookie,l)}}let _h,$l=null;const Pb=new gt("TRANSITION_ID"),xk=[{provide:yp,useFactory:function Tk(f,l,u){return()=>{u.get(Cp).donePromise.then(()=>{const g=Sr(),p=l.querySelectorAll(`style[ng-transition="${f}"]`);for(let m=0;m<p.length;m++)g.remove(p[m])})}},deps:[Pb,Li,ei],multi:!0}];class Qp{static init(){!function wP(f){Ip=f}(new Qp)}addToWindow(l){Ot.getAngularTestability=(g,p=!0)=>{const m=l.findTestabilityInTree(g,p);if(null==m)throw new Error("Could not find testability for element.");return m},Ot.getAllAngularTestabilities=()=>l.getAllTestabilities(),Ot.getAllAngularRootElements=()=>l.getAllRootElements(),Ot.frameworkStabilizers||(Ot.frameworkStabilizers=[]),Ot.frameworkStabilizers.push(g=>{const p=Ot.getAllAngularTestabilities();let m=p.length,v=!1;const y=function(b){v=v||b,m--,0==m&&g(v)};p.forEach(function(b){b.whenStable(y)})})}findTestabilityInTree(l,u,g){if(null==u)return null;const p=l.getTestability(u);return null!=p?p:g?Sr().isShadowRoot(u)?this.findTestabilityInTree(l,u.host,!0):this.findTestabilityInTree(l,u.parentElement,!0):null}}let Ak=(()=>{class f{build(){return new XMLHttpRequest}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();const vh=new gt("EventManagerPlugins");let yh=(()=>{class f{constructor(u,g){this._zone=g,this._eventNameToPlugin=new Map,u.forEach(p=>p.manager=this),this._plugins=u.slice().reverse()}addEventListener(u,g,p){return this._findPluginFor(g).addEventListener(u,g,p)}addGlobalEventListener(u,g,p){return this._findPluginFor(g).addGlobalEventListener(u,g,p)}getZone(){return this._zone}_findPluginFor(u){const g=this._eventNameToPlugin.get(u);if(g)return g;const p=this._plugins;for(let m=0;m<p.length;m++){const v=p[m];if(v.supports(u))return this._eventNameToPlugin.set(u,v),v}throw new Error(`No event manager plugin found for event ${u}`)}}return f.\u0275fac=function(u){return new(u||f)(Xe(vh),Xe(On))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();class Nb{constructor(l){this._doc=l}addGlobalEventListener(l,u,g){const p=Sr().getGlobalEventTarget(this._doc,l);if(!p)throw new Error(`Unsupported event target ${p} for event ${u}`);return this.addEventListener(p,u,g)}}let kb=(()=>{class f{constructor(){this._stylesSet=new Set}addStyles(u){const g=new Set;u.forEach(p=>{this._stylesSet.has(p)||(this._stylesSet.add(p),g.add(p))}),this.onStylesAdded(g)}onStylesAdded(u){}getAllStyles(){return Array.from(this._stylesSet)}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})(),Xl=(()=>{class f extends kb{constructor(u){super(),this._doc=u,this._hostNodes=new Map,this._hostNodes.set(u.head,[])}_addStylesToHost(u,g,p){u.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,p.push(g.appendChild(v))})}addHost(u){const g=[];this._addStylesToHost(this._stylesSet,u,g),this._hostNodes.set(u,g)}removeHost(u){const g=this._hostNodes.get(u);g&&g.forEach(Bb),this._hostNodes.delete(u)}onStylesAdded(u){this._hostNodes.forEach((g,p)=>{this._addStylesToHost(u,p,g)})}ngOnDestroy(){this._hostNodes.forEach(u=>u.forEach(Bb))}}return f.\u0275fac=function(u){return new(u||f)(Xe(Li))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();function Bb(f){Sr().remove(f)}const Jp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},em=/%COMP%/g;function Ch(f,l,u){for(let g=0;g<l.length;g++){let p=l[g];Array.isArray(p)?Ch(f,p,u):(p=p.replace(em,f),u.push(p))}return u}function Ub(f){return l=>{if("__ngUnwrap__"===l)return f;!1===f(l)&&(l.preventDefault(),l.returnValue=!1)}}let tm=(()=>{class f{constructor(u,g,p){this.eventManager=u,this.sharedStylesHost=g,this.appId=p,this.rendererByCompId=new Map,this.defaultRenderer=new nm(u)}createRenderer(u,g){if(!u||!g)return this.defaultRenderer;switch(g.encapsulation){case dr.Emulated:{let p=this.rendererByCompId.get(g.id);return p||(p=new Pk(this.eventManager,this.sharedStylesHost,g,this.appId),this.rendererByCompId.set(g.id,p)),p.applyToHost(u),p}case 1:case dr.ShadowDom:return new Nk(this.eventManager,this.sharedStylesHost,u,g);default:if(!this.rendererByCompId.has(g.id)){const p=Ch(g.id,g.styles,[]);this.sharedStylesHost.addStyles(p),this.rendererByCompId.set(g.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return f.\u0275fac=function(u){return new(u||f)(Xe(yh),Xe(Xl),Xe(Hl))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();class nm{constructor(l){this.eventManager=l,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(l,u){return u?document.createElementNS(Jp[u]||u,l):document.createElement(l)}createComment(l){return document.createComment(l)}createText(l){return document.createTextNode(l)}appendChild(l,u){l.appendChild(u)}insertBefore(l,u,g){l&&l.insertBefore(u,g)}removeChild(l,u){l&&l.removeChild(u)}selectRootElement(l,u){let g="string"==typeof l?document.querySelector(l):l;if(!g)throw new Error(`The selector "${l}" did not match any elements`);return u||(g.textContent=""),g}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,u,g,p){if(p){u=p+":"+u;const m=Jp[p];m?l.setAttributeNS(m,u,g):l.setAttribute(u,g)}else l.setAttribute(u,g)}removeAttribute(l,u,g){if(g){const p=Jp[g];p?l.removeAttributeNS(p,u):l.removeAttribute(`${g}:${u}`)}else l.removeAttribute(u)}addClass(l,u){l.classList.add(u)}removeClass(l,u){l.classList.remove(u)}setStyle(l,u,g,p){p&(ui.DashCase|ui.Important)?l.style.setProperty(u,g,p&ui.Important?"important":""):l.style[u]=g}removeStyle(l,u,g){g&ui.DashCase?l.style.removeProperty(u):l.style[u]=""}setProperty(l,u,g){l[u]=g}setValue(l,u){l.nodeValue=u}listen(l,u,g){return"string"==typeof l?this.eventManager.addGlobalEventListener(l,u,Ub(g)):this.eventManager.addEventListener(l,u,Ub(g))}}class Pk extends nm{constructor(l,u,g,p){super(l),this.component=g;const m=Ch(p+"-"+g.id,g.styles,[]);u.addStyles(m),this.contentAttr=function Ok(f){return"_ngcontent-%COMP%".replace(em,f)}(p+"-"+g.id),this.hostAttr=function Lk(f){return"_nghost-%COMP%".replace(em,f)}(p+"-"+g.id)}applyToHost(l){super.setAttribute(l,this.hostAttr,"")}createElement(l,u){const g=super.createElement(l,u);return super.setAttribute(g,this.contentAttr,""),g}}class Nk extends nm{constructor(l,u,g,p){super(l),this.sharedStylesHost=u,this.hostEl=g,this.shadowRoot=g.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=Ch(p.id,p.styles,[]);for(let v=0;v<m.length;v++){const y=document.createElement("style");y.textContent=m[v],this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(l,u){return super.appendChild(this.nodeOrShadowRoot(l),u)}insertBefore(l,u,g){return super.insertBefore(this.nodeOrShadowRoot(l),u,g)}removeChild(l,u){return super.removeChild(this.nodeOrShadowRoot(l),u)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}}let kk=(()=>{class f extends Nb{constructor(u){super(u)}supports(u){return!0}addEventListener(u,g,p){return u.addEventListener(g,p,!1),()=>this.removeEventListener(u,g,p)}removeEventListener(u,g,p){return u.removeEventListener(g,p)}}return f.\u0275fac=function(u){return new(u||f)(Xe(Li))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();const Hb=["alt","control","meta","shift"],Vk={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Wb={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},jk={alt:f=>f.altKey,control:f=>f.ctrlKey,meta:f=>f.metaKey,shift:f=>f.shiftKey};let Uk=(()=>{class f extends Nb{constructor(u){super(u)}supports(u){return null!=f.parseEventName(u)}addEventListener(u,g,p){const m=f.parseEventName(g),v=f.eventCallback(m.fullKey,p,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Sr().onAndCancel(u,m.domEventName,v))}static parseEventName(u){const g=u.toLowerCase().split("."),p=g.shift();if(0===g.length||"keydown"!==p&&"keyup"!==p)return null;const m=f._normalizeKey(g.pop());let v="";if(Hb.forEach(b=>{const A=g.indexOf(b);A>-1&&(g.splice(A,1),v+=b+".")}),v+=m,0!=g.length||0===m.length)return null;const y={};return y.domEventName=p,y.fullKey=v,y}static getEventFullKey(u){let g="",p=function Gk(f){let l=f.key;if(null==l){if(l=f.keyIdentifier,null==l)return"Unidentified";l.startsWith("U+")&&(l=String.fromCharCode(parseInt(l.substring(2),16)),3===f.location&&Wb.hasOwnProperty(l)&&(l=Wb[l]))}return Vk[l]||l}(u);return p=p.toLowerCase()," "===p?p="space":"."===p&&(p="dot"),Hb.forEach(m=>{m!=p&&jk[m](u)&&(g+=m+".")}),g+=p,g}static eventCallback(u,g,p){return m=>{f.getEventFullKey(m)===u&&p.runGuarded(()=>g(m))}}static _normalizeKey(u){return"esc"===u?"escape":u}}return f.\u0275fac=function(u){return new(u||f)(Xe(Li))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();const Yk=eb(zP,"browser",[{provide:YE,useValue:"browser"},{provide:zE,useValue:function Hk(){Kp.makeCurrent(),Qp.init()},multi:!0},{provide:Li,useFactory:function zk(){return function Zx(f){gf=f}(document),document},deps:[]}]),$k=[{provide:Ag,useValue:"root"},{provide:bl,useFactory:function Wk(){return new bl},deps:[]},{provide:vh,useClass:kk,multi:!0,deps:[Li,On,YE]},{provide:vh,useClass:Uk,multi:!0,deps:[Li]},{provide:tm,useClass:tm,deps:[yh,Xl,Hl]},{provide:lE,useExisting:tm},{provide:kb,useExisting:Xl},{provide:Xl,useClass:Xl,deps:[Li]},{provide:Sp,useClass:Sp,deps:[On]},{provide:yh,useClass:yh,deps:[vh,On]},{provide:class bk{},useClass:Ak,deps:[]}];let Xk=(()=>{class f{constructor(u){if(u)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(u){return{ngModule:f,providers:[{provide:Hl,useValue:u.appId},{provide:Pb,useExisting:Hl},xk]}}}return f.\u0275fac=function(u){return new(u||f)(Xe(f,12))},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({providers:$k,imports:[mk,YP]}),f})();"undefined"!=typeof window&&window;const{isArray:s2}=Array,{getPrototypeOf:o2,prototype:a2,keys:l2}=Object;function $b(f){if(1===f.length){const l=f[0];if(s2(l))return{args:l,keys:null};if(function c2(f){return f&&"object"==typeof f&&o2(f)===a2}(l)){const u=l2(l);return{args:u.map(g=>l[g]),keys:u}}}return{args:f,keys:null}}const{isArray:u2}=Array;function Xb(f){return Gt(l=>function h2(f,l){return u2(l)?f(...l):f(l)}(f,l))}function qb(f,l){return f.reduce((u,g,p)=>(u[g]=l[p],u),{})}let Zb=(()=>{class f{constructor(u,g){this._renderer=u,this._elementRef=g,this.onChange=p=>{},this.onTouched=()=>{}}setProperty(u,g){this._renderer.setProperty(this._elementRef.nativeElement,u,g)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}}return f.\u0275fac=function(u){return new(u||f)(ye(Wr),ye(di))},f.\u0275dir=$e({type:f}),f})(),so=(()=>{class f extends Zb{}return f.\u0275fac=function(){let l;return function(g){return(l||(l=function Bn(f){return ps(()=>{const l=f.prototype.constructor,u=l[Br]||Rf(l),g=Object.prototype;let p=Object.getPrototypeOf(f.prototype).constructor;for(;p&&p!==g;){const m=p[Br]||Rf(p);if(m&&m!==u)return m;p=Object.getPrototypeOf(p)}return m=>new m})}(f)))(g||f)}}(),f.\u0275dir=$e({type:f,features:[Rt]}),f})();const Ir=new gt("NgValueAccessor"),g2={provide:Ir,useExisting:Ht(()=>wh),multi:!0},m2=new gt("CompositionEventMode");let wh=(()=>{class f extends Zb{constructor(u,g,p){super(u,g),this._compositionMode=p,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function p2(){const f=Sr()?Sr().getUserAgent():"";return/android (\d+)/.test(f.toLowerCase())}())}writeValue(u){this.setProperty("value",null==u?"":u)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}}return f.\u0275fac=function(u){return new(u||f)(ye(Wr),ye(di),ye(m2,8))},f.\u0275dir=$e({type:f,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,g){1&u&&Tt("input",function(m){return g._handleInput(m.target.value)})("blur",function(){return g.onTouched()})("compositionstart",function(){return g._compositionStart()})("compositionend",function(m){return g._compositionEnd(m.target.value)})},features:[Kt([g2]),Rt]}),f})();const Un=new gt("NgValidators"),xs=new gt("NgAsyncValidators");function aD(f){return null!=f}function lD(f){const l=Ml(f)?Tn(f):f;return Wg(l),l}function cD(f){let l={};return f.forEach(u=>{l=null!=u?Object.assign(Object.assign({},l),u):l}),0===Object.keys(l).length?null:l}function uD(f,l){return l.map(u=>u(f))}function hD(f){return f.map(l=>function v2(f){return!f.validate}(l)?l:u=>l.validate(u))}function rm(f){return null!=f?function dD(f){if(!f)return null;const l=f.filter(aD);return 0==l.length?null:function(u){return cD(uD(u,l))}}(hD(f)):null}function sm(f){return null!=f?function fD(f){if(!f)return null;const l=f.filter(aD);return 0==l.length?null:function(u){return function d2(...f){const l=Mv(f),{args:u,keys:g}=$b(f),p=new dn(m=>{const{length:v}=u;if(!v)return void m.complete();const y=new Array(v);let b=v,A=v;for(let L=0;L<v;L++){let N=!1;hr(u[L]).subscribe(Sn(m,k=>{N||(N=!0,A--),y[L]=k},()=>b--,void 0,()=>{(!b||!N)&&(A||m.next(g?qb(g,y):y),m.complete())}))}});return l?p.pipe(Xb(l)):p}(uD(u,l).map(lD)).pipe(Gt(cD))}}(hD(f)):null}function gD(f,l){return null===f?[l]:Array.isArray(f)?[...f,l]:[f,l]}function om(f){return f?Array.isArray(f)?f:[f]:[]}function bh(f,l){return Array.isArray(f)?f.includes(l):f===l}function _D(f,l){const u=om(l);return om(f).forEach(p=>{bh(u,p)||u.push(p)}),u}function vD(f,l){return om(l).filter(u=>!bh(f,u))}class yD{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=rm(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=sm(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l){this.control&&this.control.reset(l)}hasError(l,u){return!!this.control&&this.control.hasError(l,u)}getError(l,u){return this.control?this.control.getError(l,u):null}}class As extends yD{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Xn extends yD{get formDirective(){return null}get path(){return null}}let wD=(()=>{class f extends class CD{constructor(l){this._cd=l}is(l){var u,g,p;return"submitted"===l?!!(null===(u=this._cd)||void 0===u?void 0:u.submitted):!!(null===(p=null===(g=this._cd)||void 0===g?void 0:g.control)||void 0===p?void 0:p[l])}}{constructor(u){super(u)}}return f.\u0275fac=function(u){return new(u||f)(ye(As,2))},f.\u0275dir=$e({type:f,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,g){2&u&&zu("ng-untouched",g.is("untouched"))("ng-touched",g.is("touched"))("ng-pristine",g.is("pristine"))("ng-dirty",g.is("dirty"))("ng-valid",g.is("valid"))("ng-invalid",g.is("invalid"))("ng-pending",g.is("pending"))},features:[Rt]}),f})();function ql(f,l){(function cm(f,l){const u=function pD(f){return f._rawValidators}(f);null!==l.validator?f.setValidators(gD(u,l.validator)):"function"==typeof u&&f.setValidators([u]);const g=function mD(f){return f._rawAsyncValidators}(f);null!==l.asyncValidator?f.setAsyncValidators(gD(g,l.asyncValidator)):"function"==typeof g&&f.setAsyncValidators([g]);const p=()=>f.updateValueAndValidity();Th(l._rawValidators,p),Th(l._rawAsyncValidators,p)})(f,l),l.valueAccessor.writeValue(f.value),function T2(f,l){l.valueAccessor.registerOnChange(u=>{f._pendingValue=u,f._pendingChange=!0,f._pendingDirty=!0,"change"===f.updateOn&&bD(f,l)})}(f,l),function A2(f,l){const u=(g,p)=>{l.valueAccessor.writeValue(g),p&&l.viewToModelUpdate(g)};f.registerOnChange(u),l._registerOnDestroy(()=>{f._unregisterOnChange(u)})}(f,l),function x2(f,l){l.valueAccessor.registerOnTouched(()=>{f._pendingTouched=!0,"blur"===f.updateOn&&f._pendingChange&&bD(f,l),"submit"!==f.updateOn&&f.markAsTouched()})}(f,l),function I2(f,l){if(l.valueAccessor.setDisabledState){const u=g=>{l.valueAccessor.setDisabledState(g)};f.registerOnDisabledChange(u),l._registerOnDestroy(()=>{f._unregisterOnDisabledChange(u)})}}(f,l)}function Th(f,l){f.forEach(u=>{u.registerOnValidatorChange&&u.registerOnValidatorChange(l)})}function bD(f,l){f._pendingDirty&&f.markAsDirty(),f.setValue(f._pendingValue,{emitModelToViewChange:!1}),l.viewToModelUpdate(f._pendingValue),f._pendingChange=!1}function dm(f,l){const u=f.indexOf(l);u>-1&&f.splice(u,1)}const Zl="VALID",Ah="INVALID",pa="PENDING",Kl="DISABLED";function gm(f){return(Rh(f)?f.validators:f)||null}function TD(f){return Array.isArray(f)?rm(f):f||null}function pm(f,l){return(Rh(l)?l.asyncValidators:f)||null}function xD(f){return Array.isArray(f)?sm(f):f||null}function Rh(f){return null!=f&&!Array.isArray(f)&&"object"==typeof f}const mm=f=>f instanceof vm;function RD(f){return(f=>f instanceof LD)(f)?f.value:f.getRawValue()}function MD(f,l){const u=mm(f),g=f.controls;if(!(u?Object.keys(g):g).length)throw new St(1e3,"");if(!g[l])throw new St(1001,"")}function OD(f,l){mm(f),f._forEachChild((g,p)=>{if(void 0===l[p])throw new St(1002,"")})}class _m{constructor(l,u){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=l,this._rawAsyncValidators=u,this._composedValidatorFn=TD(this._rawValidators),this._composedAsyncValidatorFn=xD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===Zl}get invalid(){return this.status===Ah}get pending(){return this.status==pa}get disabled(){return this.status===Kl}get enabled(){return this.status!==Kl}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._rawValidators=l,this._composedValidatorFn=TD(l)}setAsyncValidators(l){this._rawAsyncValidators=l,this._composedAsyncValidatorFn=xD(l)}addValidators(l){this.setValidators(_D(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(_D(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(vD(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(vD(l,this._rawAsyncValidators))}hasValidator(l){return bh(this._rawValidators,l)}hasAsyncValidator(l){return bh(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(u=>{u.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(u=>{u.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=pa,!1!==l.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=Kl,this.errors=null,this._forEachChild(g=>{g.disable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this._updateValue(),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(g=>g(!0))}enable(l={}){const u=this._parentMarkedDirty(l.onlySelf);this.status=Zl,this._forEachChild(g=>{g.enable(Object.assign(Object.assign({},l),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},l),{skipPristineCheck:u})),this._onDisabledChange.forEach(g=>g(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Zl||this.status===pa)&&this._runAsyncValidator(l.emitEvent)),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(u=>u._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Kl:Zl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=pa,this._hasOwnPendingAsyncValidator=!0;const u=lD(this.asyncValidator(this));this._asyncValidationSubscription=u.subscribe(g=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(g,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,u={}){this.errors=l,this._updateControlsErrors(!1!==u.emitEvent)}get(l){return function L2(f,l,u){if(null==l||(Array.isArray(l)||(l=l.split(u)),Array.isArray(l)&&0===l.length))return null;let g=f;return l.forEach(p=>{g=mm(g)?g.controls.hasOwnProperty(p)?g.controls[p]:null:(f=>f instanceof P2)(g)&&g.at(p)||null}),g}(this,l,".")}getError(l,u){const g=u?this.get(u):this;return g&&g.errors?g.errors[l]:null}hasError(l,u){return!!this.getError(l,u)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new on,this.statusChanges=new on}_calculateStatus(){return this._allControlsDisabled()?Kl:this.errors?Ah:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(pa)?pa:this._anyControlsHaveStatus(Ah)?Ah:Zl}_anyControlsHaveStatus(l){return this._anyControls(u=>u.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_isBoxedValue(l){return"object"==typeof l&&null!==l&&2===Object.keys(l).length&&"value"in l&&"disabled"in l}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){Rh(l)&&null!=l.updateOn&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){return!l&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class LD extends _m{constructor(l=null,u,g){super(gm(u),pm(g,u)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(u),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Rh(u)&&u.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(l)?l.value:l)}setValue(l,u={}){this.value=this._pendingValue=l,this._onChange.length&&!1!==u.emitModelToViewChange&&this._onChange.forEach(g=>g(this.value,!1!==u.emitViewToModelChange)),this.updateValueAndValidity(u)}patchValue(l,u={}){this.setValue(l,u)}reset(l=this.defaultValue,u={}){this._applyFormState(l),this.markAsPristine(u),this.markAsUntouched(u),this.setValue(this.value,u),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){dm(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){dm(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(l){this._isBoxedValue(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}}class vm extends _m{constructor(l,u,g){super(gm(u),pm(g,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,u){return this.controls[l]?this.controls[l]:(this.controls[l]=u,u.setParent(this),u._registerOnCollectionChange(this._onCollectionChange),u)}addControl(l,u,g={}){this.registerControl(l,u),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}removeControl(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}setControl(l,u,g={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],u&&this.registerControl(l,u),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,u={}){OD(this,l),Object.keys(l).forEach(g=>{MD(this,g),this.controls[g].setValue(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(Object.keys(l).forEach(g=>{this.controls[g]&&this.controls[g].patchValue(l[g],{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l={},u={}){this._forEachChild((g,p)=>{g.reset(l[p],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this._reduceChildren({},(l,u,g)=>(l[g]=RD(u),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(u,g)=>!!g._syncPendingControls()||u);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(u=>{const g=this.controls[u];g&&l(g,u)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(const u of Object.keys(this.controls)){const g=this.controls[u];if(this.contains(u)&&l(g))return!0}return!1}_reduceValue(){return this._reduceChildren({},(l,u,g)=>((u.enabled||this.disabled)&&(l[g]=u.value),l))}_reduceChildren(l,u){let g=l;return this._forEachChild((p,m)=>{g=u(g,p,m)}),g}_allControlsDisabled(){for(const l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class P2 extends _m{constructor(l,u,g){super(gm(u),pm(g,u)),this.controls=l,this._initObservables(),this._setUpdateStrategy(u),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(l){return this.controls[l]}push(l,u={}){this.controls.push(l),this._registerControl(l),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}insert(l,u,g={}){this.controls.splice(l,0,u),this._registerControl(u),this.updateValueAndValidity({emitEvent:g.emitEvent})}removeAt(l,u={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:u.emitEvent})}setControl(l,u,g={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),u&&(this.controls.splice(l,0,u),this._registerControl(u)),this.updateValueAndValidity({emitEvent:g.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(l,u={}){OD(this,l),l.forEach((g,p)=>{MD(this,p),this.at(p).setValue(g,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u)}patchValue(l,u={}){null!=l&&(l.forEach((g,p)=>{this.at(p)&&this.at(p).patchValue(g,{onlySelf:!0,emitEvent:u.emitEvent})}),this.updateValueAndValidity(u))}reset(l=[],u={}){this._forEachChild((g,p)=>{g.reset(l[p],{onlySelf:!0,emitEvent:u.emitEvent})}),this._updatePristine(u),this._updateTouched(u),this.updateValueAndValidity(u)}getRawValue(){return this.controls.map(l=>RD(l))}clear(l={}){this.controls.length<1||(this._forEachChild(u=>u._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:l.emitEvent}))}_syncPendingControls(){let l=this.controls.reduce((u,g)=>!!g._syncPendingControls()||u,!1);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){this.controls.forEach((u,g)=>{l(u,g)})}_updateValue(){this.value=this.controls.filter(l=>l.enabled||this.disabled).map(l=>l.value)}_anyControls(l){return this.controls.some(u=>u.enabled&&l(u))}_setUpControls(){this._forEachChild(l=>this._registerControl(l))}_allControlsDisabled(){for(const l of this.controls)if(l.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(l){l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)}}const B2={provide:As,useExisting:Ht(()=>Cm)},ND=(()=>Promise.resolve(null))();let Cm=(()=>{class f extends As{constructor(u,g,p,m,v){super(),this._changeDetectorRef=v,this.control=new LD,this._registered=!1,this.update=new on,this._parent=u,this._setValidators(g),this._setAsyncValidators(p),this.valueAccessor=function hm(f,l){if(!l)return null;let u,g,p;return Array.isArray(l),l.forEach(m=>{m.constructor===wh?u=m:function O2(f){return Object.getPrototypeOf(f.constructor)===so}(m)?g=m:p=m}),p||g||u||null}(0,m)}ngOnChanges(u){if(this._checkForErrors(),!this._registered||"name"in u){if(this._registered&&(this._checkName(),this.formDirective)){const g=u.name.previousValue;this.formDirective.removeControl({name:g,path:this._getPath(g)})}this._setUpControl()}"isDisabled"in u&&this._updateDisabled(u),function um(f,l){if(!f.hasOwnProperty("model"))return!1;const u=f.model;return!!u.isFirstChange()||!Object.is(l,u.currentValue)}(u,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){ql(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(u){ND.then(()=>{var g;this.control.setValue(u,{emitViewToModelChange:!1}),null===(g=this._changeDetectorRef)||void 0===g||g.markForCheck()})}_updateDisabled(u){const g=u.isDisabled.currentValue,p=""===g||g&&"false"!==g;ND.then(()=>{var m;p&&!this.control.disabled?this.control.disable():!p&&this.control.disabled&&this.control.enable(),null===(m=this._changeDetectorRef)||void 0===m||m.markForCheck()})}_getPath(u){return this._parent?function Sh(f,l){return[...l.path,f]}(u,this._parent):[u]}}return f.\u0275fac=function(u){return new(u||f)(ye(Xn,9),ye(Un,10),ye(xs,10),ye(Ir,10),ye(ih,8))},f.\u0275dir=$e({type:f,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Kt([B2]),Rt,xi]}),f})(),BD=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({}),f})(),uB=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({imports:[[BD]]}),f})(),hB=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({imports:[uB]}),f})();function ct(...f){return Tn(f,el(f))}class sr extends Fr{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){const u=super._subscribe(l);return!u.closed&&l.next(this._value),u}getValue(){const{hasError:l,thrownError:u,_value:g}=this;if(l)throw u;return this._throwIfClosed(),g}next(l){super.next(this._value=l)}}function nS(f,l,u){f?Pr(u,f,l):l()}function Mh(f,l){const u=Ut(f)?f:()=>f,g=p=>p.error(u());return new dn(l?p=>l.schedule(g,0,p):g)}const Oh=Ka(f=>function(){f(this),this.name="EmptyError",this.message="no elements in sequence"});function Tm(...f){return function gB(){return Ja(1)}()(Tn(f,el(f)))}function iS(f){return new dn(l=>{hr(f()).subscribe(l)})}function rS(){return An((f,l)=>{let u=null;f._refCount++;const g=Sn(l,void 0,void 0,void 0,()=>{if(!f||f._refCount<=0||0<--f._refCount)return void(u=null);const p=f._connection,m=u;u=null,p&&(!m||p===m)&&p.unsubscribe(),l.unsubscribe()});f.subscribe(g),g.closed||(u=f.connect())})}class pB extends dn{constructor(l,u){super(),this.source=l,this.subjectFactory=u,this._subject=null,this._refCount=0,this._connection=null,_v(l)&&(this.lift=l.lift)}_subscribe(l){return this.getSubject().subscribe(l)}getSubject(){const l=this._subject;return(!l||l.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:l}=this;this._subject=this._connection=null,null==l||l.unsubscribe()}connect(){let l=this._connection;if(!l){l=this._connection=new Di;const u=this.getSubject();l.add(this.source.subscribe(Sn(u,void 0,()=>{this._teardown(),u.complete()},g=>{this._teardown(),u.error(g)},()=>this._teardown()))),l.closed&&(this._connection=null,l=Di.EMPTY)}return l}refCount(){return rS()(this)}}function ao(f,l){return An((u,g)=>{let p=null,m=0,v=!1;const y=()=>v&&!p&&g.complete();u.subscribe(Sn(g,b=>{null==p||p.unsubscribe();let A=0;const L=m++;hr(f(b,L)).subscribe(p=Sn(g,N=>g.next(l?l(b,N,L,A++):N),()=>{p=null,y()}))},()=>{v=!0,y()}))})}function _B(f,l,u,g,p){return(m,v)=>{let y=u,b=l,A=0;m.subscribe(Sn(v,L=>{const N=A++;b=y?f(b,L,N):(y=!0,L),g&&v.next(b)},p&&(()=>{y&&v.next(b),v.complete()})))}}function sS(f,l){return An(_B(f,l,arguments.length>=2,!0))}function ma(f,l){return An((u,g)=>{let p=0;u.subscribe(Sn(g,m=>f.call(l,m,p++)&&g.next(m)))})}function Rs(f){return An((l,u)=>{let m,g=null,p=!1;g=l.subscribe(Sn(u,void 0,void 0,v=>{m=hr(f(v,Rs(f)(l))),g?(g.unsubscribe(),g=null,m.subscribe(u)):p=!0})),p&&(g.unsubscribe(),g=null,m.subscribe(u))})}function Jl(f,l){return Ut(l)?In(f,l,1):In(f,1)}function xm(f){return f<=0?()=>Nr:An((l,u)=>{let g=[];l.subscribe(Sn(u,p=>{g.push(p),f<g.length&&g.shift()},()=>{for(const p of g)u.next(p);u.complete()},void 0,()=>{g=null}))})}function oS(f=vB){return An((l,u)=>{let g=!1;l.subscribe(Sn(u,p=>{g=!0,u.next(p)},()=>g?u.complete():u.error(f())))})}function vB(){return new Oh}function aS(f){return An((l,u)=>{let g=!1;l.subscribe(Sn(u,p=>{g=!0,u.next(p)},()=>{g||u.next(f),u.complete()}))})}function _a(f,l){const u=arguments.length>=2;return g=>g.pipe(f?ma((p,m)=>f(p,m,g)):Ys,nu(1),u?aS(l):oS(()=>new Oh))}function fi(f,l,u){const g=Ut(f)||l||u?{next:f,error:l,complete:u}:f;return g?An((p,m)=>{var v;null===(v=g.subscribe)||void 0===v||v.call(g);let y=!0;p.subscribe(Sn(m,b=>{var A;null===(A=g.next)||void 0===A||A.call(g,b),m.next(b)},()=>{var b;y=!1,null===(b=g.complete)||void 0===b||b.call(g),m.complete()},b=>{var A;y=!1,null===(A=g.error)||void 0===A||A.call(g,b),m.error(b)},()=>{var b,A;y&&(null===(b=g.unsubscribe)||void 0===b||b.call(g)),null===(A=g.finalize)||void 0===A||A.call(g)}))}):Ys}class qr{constructor(l,u){this.id=l,this.url=u}}class Am extends qr{constructor(l,u,g="imperative",p=null){super(l,u),this.navigationTrigger=g,this.restoredState=p}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ec extends qr{constructor(l,u,g){super(l,u),this.urlAfterRedirects=g}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class lS extends qr{constructor(l,u,g){super(l,u),this.reason=g}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class wB extends qr{constructor(l,u,g){super(l,u),this.error=g}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class EB extends qr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bB extends qr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class DB extends qr{constructor(l,u,g,p,m){super(l,u),this.urlAfterRedirects=g,this.state=p,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class SB extends qr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class IB extends qr{constructor(l,u,g,p){super(l,u),this.urlAfterRedirects=g,this.state=p}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cS{constructor(l){this.route=l}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class uS{constructor(l){this.route=l}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class TB{constructor(l){this.snapshot=l}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xB{constructor(l){this.snapshot=l}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AB{constructor(l){this.snapshot=l}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class RB{constructor(l){this.snapshot=l}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hS{constructor(l,u,g){this.routerEvent=l,this.position=u,this.anchor=g}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const pt="primary";class MB{constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u[0]:u}return null}getAll(l){if(this.has(l)){const u=this.params[l];return Array.isArray(u)?u:[u]}return[]}get keys(){return Object.keys(this.params)}}function va(f){return new MB(f)}const dS="ngNavigationCancelingError";function Rm(f){const l=Error("NavigationCancelingError: "+f);return l[dS]=!0,l}function LB(f,l,u){const g=u.path.split("/");if(g.length>f.length||"full"===u.pathMatch&&(l.hasChildren()||g.length<f.length))return null;const p={};for(let m=0;m<g.length;m++){const v=g[m],y=f[m];if(v.startsWith(":"))p[v.substring(1)]=y;else if(v!==y.path)return null}return{consumed:f.slice(0,g.length),posParams:p}}function Tr(f,l){const u=f?Object.keys(f):void 0,g=l?Object.keys(l):void 0;if(!u||!g||u.length!=g.length)return!1;let p;for(let m=0;m<u.length;m++)if(p=u[m],!fS(f[p],l[p]))return!1;return!0}function fS(f,l){if(Array.isArray(f)&&Array.isArray(l)){if(f.length!==l.length)return!1;const u=[...f].sort(),g=[...l].sort();return u.every((p,m)=>g[m]===p)}return f===l}function gS(f){return Array.prototype.concat.apply([],f)}function pS(f){return f.length>0?f[f.length-1]:null}function Ln(f,l){for(const u in f)f.hasOwnProperty(u)&&l(f[u],u)}function xr(f){return Wg(f)?f:Ml(f)?Tn(Promise.resolve(f)):ct(f)}const NB={exact:function vS(f,l,u){if(!co(f.segments,l.segments)||!Lh(f.segments,l.segments,u)||f.numberOfChildren!==l.numberOfChildren)return!1;for(const g in l.children)if(!f.children[g]||!vS(f.children[g],l.children[g],u))return!1;return!0},subset:yS},mS={exact:function kB(f,l){return Tr(f,l)},subset:function BB(f,l){return Object.keys(l).length<=Object.keys(f).length&&Object.keys(l).every(u=>fS(f[u],l[u]))},ignored:()=>!0};function _S(f,l,u){return NB[u.paths](f.root,l.root,u.matrixParams)&&mS[u.queryParams](f.queryParams,l.queryParams)&&!("exact"===u.fragment&&f.fragment!==l.fragment)}function yS(f,l,u){return CS(f,l,l.segments,u)}function CS(f,l,u,g){if(f.segments.length>u.length){const p=f.segments.slice(0,u.length);return!(!co(p,u)||l.hasChildren()||!Lh(p,u,g))}if(f.segments.length===u.length){if(!co(f.segments,u)||!Lh(f.segments,u,g))return!1;for(const p in l.children)if(!f.children[p]||!yS(f.children[p],l.children[p],g))return!1;return!0}{const p=u.slice(0,f.segments.length),m=u.slice(f.segments.length);return!!(co(f.segments,p)&&Lh(f.segments,p,g)&&f.children[pt])&&CS(f.children[pt],l,m,g)}}function Lh(f,l,u){return l.every((g,p)=>mS[u](f[p].parameters,g.parameters))}class lo{constructor(l,u,g){this.root=l,this.queryParams=u,this.fragment=g}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=va(this.queryParams)),this._queryParamMap}toString(){return UB.serialize(this)}}class wt{constructor(l,u){this.segments=l,this.children=u,this.parent=null,Ln(u,(g,p)=>g.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fh(this)}}class tc{constructor(l,u){this.path=l,this.parameters=u}get parameterMap(){return this._parameterMap||(this._parameterMap=va(this.parameters)),this._parameterMap}toString(){return SS(this)}}function co(f,l){return f.length===l.length&&f.every((u,g)=>u.path===l[g].path)}class wS{}class ES{parse(l){const u=new ZB(l);return new lo(u.parseRootSegment(),u.parseQueryParams(),u.parseFragment())}serialize(l){const u=`/${nc(l.root,!0)}`,g=function WB(f){const l=Object.keys(f).map(u=>{const g=f[u];return Array.isArray(g)?g.map(p=>`${Ph(u)}=${Ph(p)}`).join("&"):`${Ph(u)}=${Ph(g)}`}).filter(u=>!!u);return l.length?`?${l.join("&")}`:""}(l.queryParams);return`${u}${g}${"string"==typeof l.fragment?`#${function GB(f){return encodeURI(f)}(l.fragment)}`:""}`}}const UB=new ES;function Fh(f){return f.segments.map(l=>SS(l)).join("/")}function nc(f,l){if(!f.hasChildren())return Fh(f);if(l){const u=f.children[pt]?nc(f.children[pt],!1):"",g=[];return Ln(f.children,(p,m)=>{m!==pt&&g.push(`${m}:${nc(p,!1)}`)}),g.length>0?`${u}(${g.join("//")})`:u}{const u=function jB(f,l){let u=[];return Ln(f.children,(g,p)=>{p===pt&&(u=u.concat(l(g,p)))}),Ln(f.children,(g,p)=>{p!==pt&&(u=u.concat(l(g,p)))}),u}(f,(g,p)=>p===pt?[nc(f.children[pt],!1)]:[`${p}:${nc(g,!1)}`]);return 1===Object.keys(f.children).length&&null!=f.children[pt]?`${Fh(f)}/${u[0]}`:`${Fh(f)}/(${u.join("//")})`}}function bS(f){return encodeURIComponent(f).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ph(f){return bS(f).replace(/%3B/gi,";")}function Mm(f){return bS(f).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Nh(f){return decodeURIComponent(f)}function DS(f){return Nh(f.replace(/\+/g,"%20"))}function SS(f){return`${Mm(f.path)}${function HB(f){return Object.keys(f).map(l=>`;${Mm(l)}=${Mm(f[l])}`).join("")}(f.parameters)}`}const zB=/^[^\/()?;=#]+/;function kh(f){const l=f.match(zB);return l?l[0]:""}const YB=/^[^=?&#]+/,XB=/^[^&#]+/;class ZB{constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new wt([],{}):new wt([],this.parseChildren())}parseQueryParams(){const l={};if(this.consumeOptional("?"))do{this.parseQueryParam(l)}while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let u={};this.peekStartsWith("/(")&&(this.capture("/"),u=this.parseParens(!0));let g={};return this.peekStartsWith("(")&&(g=this.parseParens(!1)),(l.length>0||Object.keys(u).length>0)&&(g[pt]=new wt(l,u)),g}parseSegment(){const l=kh(this.remaining);if(""===l&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(l),new tc(Nh(l),this.parseMatrixParams())}parseMatrixParams(){const l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){const u=kh(this.remaining);if(!u)return;this.capture(u);let g="";if(this.consumeOptional("=")){const p=kh(this.remaining);p&&(g=p,this.capture(g))}l[Nh(u)]=Nh(g)}parseQueryParam(l){const u=function $B(f){const l=f.match(YB);return l?l[0]:""}(this.remaining);if(!u)return;this.capture(u);let g="";if(this.consumeOptional("=")){const v=function qB(f){const l=f.match(XB);return l?l[0]:""}(this.remaining);v&&(g=v,this.capture(g))}const p=DS(u),m=DS(g);if(l.hasOwnProperty(p)){let v=l[p];Array.isArray(v)||(v=[v],l[p]=v),v.push(m)}else l[p]=m}parseParens(l){const u={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const g=kh(this.remaining),p=this.remaining[g.length];if("/"!==p&&")"!==p&&";"!==p)throw new Error(`Cannot parse url '${this.url}'`);let m;g.indexOf(":")>-1?(m=g.substr(0,g.indexOf(":")),this.capture(m),this.capture(":")):l&&(m=pt);const v=this.parseChildren();u[m]=1===Object.keys(v).length?v[pt]:new wt([],v),this.consumeOptional("//")}return u}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return!!this.peekStartsWith(l)&&(this.remaining=this.remaining.substring(l.length),!0)}capture(l){if(!this.consumeOptional(l))throw new Error(`Expected "${l}".`)}}class IS{constructor(l){this._root=l}get root(){return this._root.value}parent(l){const u=this.pathFromRoot(l);return u.length>1?u[u.length-2]:null}children(l){const u=Om(l,this._root);return u?u.children.map(g=>g.value):[]}firstChild(l){const u=Om(l,this._root);return u&&u.children.length>0?u.children[0].value:null}siblings(l){const u=Lm(l,this._root);return u.length<2?[]:u[u.length-2].children.map(p=>p.value).filter(p=>p!==l)}pathFromRoot(l){return Lm(l,this._root).map(u=>u.value)}}function Om(f,l){if(f===l.value)return l;for(const u of l.children){const g=Om(f,u);if(g)return g}return null}function Lm(f,l){if(f===l.value)return[l];for(const u of l.children){const g=Lm(f,u);if(g.length)return g.unshift(l),g}return[]}class Zr{constructor(l,u){this.value=l,this.children=u}toString(){return`TreeNode(${this.value})`}}function ya(f){const l={};return f&&f.children.forEach(u=>l[u.value.outlet]=u),l}class TS extends IS{constructor(l,u){super(l),this.snapshot=u,Fm(this,l)}toString(){return this.snapshot.toString()}}function xS(f,l){const u=function KB(f,l){const v=new Bh([],{},{},"",{},pt,l,null,f.root,-1,{});return new RS("",new Zr(v,[]))}(f,l),g=new sr([new tc("",{})]),p=new sr({}),m=new sr({}),v=new sr({}),y=new sr(""),b=new Ca(g,p,v,y,m,pt,l,u.root);return b.snapshot=u.root,new TS(new Zr(b,[]),u)}class Ca{constructor(l,u,g,p,m,v,y,b){this.url=l,this.params=u,this.queryParams=g,this.fragment=p,this.data=m,this.outlet=v,this.component=y,this._futureSnapshot=b}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Gt(l=>va(l)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Gt(l=>va(l)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function AS(f,l="emptyOnly"){const u=f.pathFromRoot;let g=0;if("always"!==l)for(g=u.length-1;g>=1;){const p=u[g],m=u[g-1];if(p.routeConfig&&""===p.routeConfig.path)g--;else{if(m.component)break;g--}}return function QB(f){return f.reduce((l,u)=>({params:Object.assign(Object.assign({},l.params),u.params),data:Object.assign(Object.assign({},l.data),u.data),resolve:Object.assign(Object.assign({},l.resolve),u._resolvedData)}),{params:{},data:{},resolve:{}})}(u.slice(g))}class Bh{constructor(l,u,g,p,m,v,y,b,A,L,N){this.url=l,this.params=u,this.queryParams=g,this.fragment=p,this.data=m,this.outlet=v,this.component=y,this.routeConfig=b,this._urlSegment=A,this._lastPathIndex=L,this._resolve=N}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=va(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=va(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(g=>g.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class RS extends IS{constructor(l,u){super(u),this.url=l,Fm(this,u)}toString(){return MS(this._root)}}function Fm(f,l){l.value._routerState=f,l.children.forEach(u=>Fm(f,u))}function MS(f){const l=f.children.length>0?` { ${f.children.map(MS).join(", ")} } `:"";return`${f.value}${l}`}function Pm(f){if(f.snapshot){const l=f.snapshot,u=f._futureSnapshot;f.snapshot=u,Tr(l.queryParams,u.queryParams)||f.queryParams.next(u.queryParams),l.fragment!==u.fragment&&f.fragment.next(u.fragment),Tr(l.params,u.params)||f.params.next(u.params),function FB(f,l){if(f.length!==l.length)return!1;for(let u=0;u<f.length;++u)if(!Tr(f[u],l[u]))return!1;return!0}(l.url,u.url)||f.url.next(u.url),Tr(l.data,u.data)||f.data.next(u.data)}else f.snapshot=f._futureSnapshot,f.data.next(f._futureSnapshot.data)}function Nm(f,l){const u=Tr(f.params,l.params)&&function VB(f,l){return co(f,l)&&f.every((u,g)=>Tr(u.parameters,l[g].parameters))}(f.url,l.url);return u&&!(!f.parent!=!l.parent)&&(!f.parent||Nm(f.parent,l.parent))}function ic(f,l,u){if(u&&f.shouldReuseRoute(l.value,u.value.snapshot)){const g=u.value;g._futureSnapshot=l.value;const p=function eV(f,l,u){return l.children.map(g=>{for(const p of u.children)if(f.shouldReuseRoute(g.value,p.value.snapshot))return ic(f,g,p);return ic(f,g)})}(f,l,u);return new Zr(g,p)}{if(f.shouldAttach(l.value)){const m=f.retrieve(l.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=l.value,v.children=l.children.map(y=>ic(f,y)),v}}const g=function tV(f){return new Ca(new sr(f.url),new sr(f.params),new sr(f.queryParams),new sr(f.fragment),new sr(f.data),f.outlet,f.component,f)}(l.value),p=l.children.map(m=>ic(f,m));return new Zr(g,p)}}function Vh(f){return"object"==typeof f&&null!=f&&!f.outlets&&!f.segmentPath}function rc(f){return"object"==typeof f&&null!=f&&f.outlets}function km(f,l,u,g,p){let m={};if(g&&Ln(g,(y,b)=>{m[b]=Array.isArray(y)?y.map(A=>`${A}`):`${y}`}),f===l)return new lo(u,m,p);const v=OS(f,l,u);return new lo(v,m,p)}function OS(f,l,u){const g={};return Ln(f.children,(p,m)=>{g[m]=p===l?u:OS(p,l,u)}),new wt(f.segments,g)}class LS{constructor(l,u,g){if(this.isAbsolute=l,this.numberOfDoubleDots=u,this.commands=g,l&&g.length>0&&Vh(g[0]))throw new Error("Root segment cannot have matrix parameters");const p=g.find(rc);if(p&&p!==pS(g))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Bm{constructor(l,u,g){this.segmentGroup=l,this.processChildren=u,this.index=g}}function FS(f,l,u){if(f||(f=new wt([],{})),0===f.segments.length&&f.hasChildren())return jh(f,l,u);const g=function aV(f,l,u){let g=0,p=l;const m={match:!1,pathIndex:0,commandIndex:0};for(;p<f.segments.length;){if(g>=u.length)return m;const v=f.segments[p],y=u[g];if(rc(y))break;const b=`${y}`,A=g<u.length-1?u[g+1]:null;if(p>0&&void 0===b)break;if(b&&A&&"object"==typeof A&&void 0===A.outlets){if(!NS(b,A,v))return m;g+=2}else{if(!NS(b,{},v))return m;g++}p++}return{match:!0,pathIndex:p,commandIndex:g}}(f,l,u),p=u.slice(g.commandIndex);if(g.match&&g.pathIndex<f.segments.length){const m=new wt(f.segments.slice(0,g.pathIndex),{});return m.children[pt]=new wt(f.segments.slice(g.pathIndex),f.children),jh(m,0,p)}return g.match&&0===p.length?new wt(f.segments,{}):g.match&&!f.hasChildren()?Vm(f,l,u):g.match?jh(f,0,p):Vm(f,l,u)}function jh(f,l,u){if(0===u.length)return new wt(f.segments,{});{const g=function oV(f){return rc(f[0])?f[0].outlets:{[pt]:f}}(u),p={};return Ln(g,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(p[v]=FS(f.children[v],l,m))}),Ln(f.children,(m,v)=>{void 0===g[v]&&(p[v]=m)}),new wt(f.segments,p)}}function Vm(f,l,u){const g=f.segments.slice(0,l);let p=0;for(;p<u.length;){const m=u[p];if(rc(m)){const b=lV(m.outlets);return new wt(g,b)}if(0===p&&Vh(u[0])){g.push(new tc(f.segments[l].path,PS(u[0]))),p++;continue}const v=rc(m)?m.outlets[pt]:`${m}`,y=p<u.length-1?u[p+1]:null;v&&y&&Vh(y)?(g.push(new tc(v,PS(y))),p+=2):(g.push(new tc(v,{})),p++)}return new wt(g,{})}function lV(f){const l={};return Ln(f,(u,g)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[g]=Vm(new wt([],{}),0,u))}),l}function PS(f){const l={};return Ln(f,(u,g)=>l[g]=`${u}`),l}function NS(f,l,u){return f==u.path&&Tr(l,u.parameters)}class uV{constructor(l,u,g,p){this.routeReuseStrategy=l,this.futureState=u,this.currState=g,this.forwardEvent=p}activate(l){const u=this.futureState._root,g=this.currState?this.currState._root:null;this.deactivateChildRoutes(u,g,l),Pm(this.futureState.root),this.activateChildRoutes(u,g,l)}deactivateChildRoutes(l,u,g){const p=ya(u);l.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,p[v],g),delete p[v]}),Ln(p,(m,v)=>{this.deactivateRouteAndItsChildren(m,g)})}deactivateRoutes(l,u,g){const p=l.value,m=u?u.value:null;if(p===m)if(p.component){const v=g.getContext(p.outlet);v&&this.deactivateChildRoutes(l,u,v.children)}else this.deactivateChildRoutes(l,u,g);else m&&this.deactivateRouteAndItsChildren(u,g)}deactivateRouteAndItsChildren(l,u){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,u):this.deactivateRouteAndOutlet(l,u)}detachAndStoreRouteSubtree(l,u){const g=u.getContext(l.value.outlet),p=g&&l.value.component?g.children:u,m=ya(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],p);if(g&&g.outlet){const v=g.outlet.detach(),y=g.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:v,route:l,contexts:y})}}deactivateRouteAndOutlet(l,u){const g=u.getContext(l.value.outlet),p=g&&l.value.component?g.children:u,m=ya(l);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],p);g&&g.outlet&&(g.outlet.deactivate(),g.children.onOutletDeactivated(),g.attachRef=null,g.resolver=null,g.route=null)}activateChildRoutes(l,u,g){const p=ya(u);l.children.forEach(m=>{this.activateRoutes(m,p[m.value.outlet],g),this.forwardEvent(new RB(m.value.snapshot))}),l.children.length&&this.forwardEvent(new xB(l.value.snapshot))}activateRoutes(l,u,g){const p=l.value,m=u?u.value:null;if(Pm(p),p===m)if(p.component){const v=g.getOrCreateContext(p.outlet);this.activateChildRoutes(l,u,v.children)}else this.activateChildRoutes(l,u,g);else if(p.component){const v=g.getOrCreateContext(p.outlet);if(this.routeReuseStrategy.shouldAttach(p.snapshot)){const y=this.routeReuseStrategy.retrieve(p.snapshot);this.routeReuseStrategy.store(p.snapshot,null),v.children.onOutletReAttached(y.contexts),v.attachRef=y.componentRef,v.route=y.route.value,v.outlet&&v.outlet.attach(y.componentRef,y.route.value),Pm(y.route.value),this.activateChildRoutes(l,null,v.children)}else{const y=function hV(f){for(let l=f.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig;if(u&&u.component)return null}return null}(p.snapshot),b=y?y.module.componentFactoryResolver:null;v.attachRef=null,v.route=p,v.resolver=b,v.outlet&&v.outlet.activateWith(p,b),this.activateChildRoutes(l,null,v.children)}}else this.activateChildRoutes(l,null,g)}}class jm{constructor(l,u){this.routes=l,this.module=u}}function Ms(f){return"function"==typeof f}function uo(f){return f instanceof lo}const sc=Symbol("INITIAL_VALUE");function oc(){return ao(f=>function dB(...f){const l=el(f),u=Mv(f),{args:g,keys:p}=$b(f);if(0===g.length)return Tn([],l);const m=new dn(function fB(f,l,u=Ys){return g=>{nS(l,()=>{const{length:p}=f,m=new Array(p);let v=p,y=p;for(let b=0;b<p;b++)nS(l,()=>{const A=Tn(f[b],l);let L=!1;A.subscribe(Sn(g,N=>{m[b]=N,L||(L=!0,y--),y||g.next(u(m.slice()))},()=>{--v||g.complete()}))},g)},g)}}(g,l,p?v=>qb(p,v):Ys));return u?m.pipe(Xb(u)):m}(f.map(l=>l.pipe(nu(1),function mB(...f){const l=el(f);return An((u,g)=>{(l?Tm(f,u,l):Tm(f,u)).subscribe(g)})}(sc)))).pipe(sS((l,u)=>{let g=!1;return u.reduce((p,m,v)=>p!==sc?p:(m===sc&&(g=!0),g||!1!==m&&v!==u.length-1&&!uo(m)?p:m),l)},sc),ma(l=>l!==sc),Gt(l=>uo(l)?l:!0===l),nu(1)))}class _V{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new ac,this.attachRef=null}}class ac{constructor(){this.contexts=new Map}onChildOutletCreated(l,u){const g=this.getOrCreateContext(l);g.outlet=u,this.contexts.set(l,g)}onChildOutletDestroyed(l){const u=this.getContext(l);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){const l=this.contexts;return this.contexts=new Map,l}onOutletReAttached(l){this.contexts=l}getOrCreateContext(l){let u=this.getContext(l);return u||(u=new _V,this.contexts.set(l,u)),u}getContext(l){return this.contexts.get(l)||null}}let Um=(()=>{class f{constructor(u,g,p,m,v){this.parentContexts=u,this.location=g,this.resolver=p,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new on,this.deactivateEvents=new on,this.attachEvents=new on,this.detachEvents=new on,this.name=m||pt,u.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const u=this.parentContexts.getContext(this.name);u&&u.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,g){this.activated=u,this._activatedRoute=g,this.location.insert(u.hostView),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){const u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,g){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=u;const v=(g=g||this.resolver).resolveComponentFactory(u._futureSnapshot.routeConfig.component),y=this.parentContexts.getOrCreateContext(this.name).children,b=new vV(u,y,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,b),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return f.\u0275fac=function(u){return new(u||f)(ye(ac),ye(nr),ye(kl),function ul(f){return function xA(f,l){if("class"===l)return f.classes;if("style"===l)return f.styles;const u=f.attrs;if(u){const g=u.length;let p=0;for(;p<g;){const m=u[p];if(uy(m))break;if(0===m)p+=2;else if("number"==typeof m)for(p++;p<g&&"string"==typeof u[p];)p++;else{if(m===l)return u[p+1];p+=2}}}return null}(wn(),f)}("name"),ye(ih))},f.\u0275dir=$e({type:f,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),f})();class vV{constructor(l,u,g){this.route=l,this.childContexts=u,this.parent=g}get(l,u){return l===Ca?this.route:l===ac?this.childContexts:this.parent.get(l,u)}}let kS=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["ng-component"]],decls:1,vars:0,template:function(u,g){1&u&&Mn(0,"router-outlet")},directives:[Um],encapsulation:2}),f})();function BS(f,l=""){for(let u=0;u<f.length;u++){const g=f[u];yV(g,CV(l,g))}}function yV(f,l){f.children&&BS(f.children,l)}function CV(f,l){return l?f||l.path?f&&!l.path?`${f}/`:!f&&l.path?l.path:`${f}/${l.path}`:"":f}function Gm(f){const l=f.children&&f.children.map(Gm),u=l?Object.assign(Object.assign({},f),{children:l}):Object.assign({},f);return!u.component&&(l||u.loadChildren)&&u.outlet&&u.outlet!==pt&&(u.component=kS),u}function Ni(f){return f.outlet||pt}function VS(f,l){const u=f.filter(g=>Ni(g)===l);return u.push(...f.filter(g=>Ni(g)!==l)),u}const jS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Uh(f,l,u){var g;if(""===l.path)return"full"===l.pathMatch&&(f.hasChildren()||u.length>0)?Object.assign({},jS):{matched:!0,consumedSegments:[],remainingSegments:u,parameters:{},positionalParamSegments:{}};const m=(l.matcher||LB)(u,f,l);if(!m)return Object.assign({},jS);const v={};Ln(m.posParams,(b,A)=>{v[A]=b.path});const y=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:u.slice(m.consumed.length),parameters:y,positionalParamSegments:null!==(g=m.posParams)&&void 0!==g?g:{}}}function Gh(f,l,u,g,p="corrected"){if(u.length>0&&function bV(f,l,u){return u.some(g=>Hh(f,l,g)&&Ni(g)!==pt)}(f,u,g)){const v=new wt(l,function EV(f,l,u,g){const p={};p[pt]=g,g._sourceSegment=f,g._segmentIndexShift=l.length;for(const m of u)if(""===m.path&&Ni(m)!==pt){const v=new wt([],{});v._sourceSegment=f,v._segmentIndexShift=l.length,p[Ni(m)]=v}return p}(f,l,g,new wt(u,f.children)));return v._sourceSegment=f,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:[]}}if(0===u.length&&function DV(f,l,u){return u.some(g=>Hh(f,l,g))}(f,u,g)){const v=new wt(f.segments,function wV(f,l,u,g,p,m){const v={};for(const y of g)if(Hh(f,u,y)&&!p[Ni(y)]){const b=new wt([],{});b._sourceSegment=f,b._segmentIndexShift="legacy"===m?f.segments.length:l.length,v[Ni(y)]=b}return Object.assign(Object.assign({},p),v)}(f,l,u,g,f.children,p));return v._sourceSegment=f,v._segmentIndexShift=l.length,{segmentGroup:v,slicedSegments:u}}const m=new wt(f.segments,f.children);return m._sourceSegment=f,m._segmentIndexShift=l.length,{segmentGroup:m,slicedSegments:u}}function Hh(f,l,u){return(!(f.hasChildren()||l.length>0)||"full"!==u.pathMatch)&&""===u.path}function US(f,l,u,g){return!!(Ni(f)===g||g!==pt&&Hh(l,u,f))&&("**"===f.path||Uh(l,f,u).matched)}function GS(f,l,u){return 0===l.length&&!f.children[u]}class Wh{constructor(l){this.segmentGroup=l||null}}class HS{constructor(l){this.urlTree=l}}function lc(f){return Mh(new Wh(f))}function WS(f){return Mh(new HS(f))}class xV{constructor(l,u,g,p,m){this.configLoader=u,this.urlSerializer=g,this.urlTree=p,this.config=m,this.allowRedirects=!0,this.ngModule=l.get(zr)}apply(){const l=Gh(this.urlTree.root,[],[],this.config).segmentGroup,u=new wt(l.segments,l.children);return this.expandSegmentGroup(this.ngModule,this.config,u,pt).pipe(Gt(m=>this.createUrlTree(Hm(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Rs(m=>{if(m instanceof HS)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof Wh?this.noMatchError(m):m}))}match(l){return this.expandSegmentGroup(this.ngModule,this.config,l.root,pt).pipe(Gt(p=>this.createUrlTree(Hm(p),l.queryParams,l.fragment))).pipe(Rs(p=>{throw p instanceof Wh?this.noMatchError(p):p}))}noMatchError(l){return new Error(`Cannot match any routes. URL Segment: '${l.segmentGroup}'`)}createUrlTree(l,u,g){const p=l.segments.length>0?new wt([],{[pt]:l}):l;return new lo(p,u,g)}expandSegmentGroup(l,u,g,p){return 0===g.segments.length&&g.hasChildren()?this.expandChildren(l,u,g).pipe(Gt(m=>new wt([],m))):this.expandSegment(l,g,u,g.segments,p,!0)}expandChildren(l,u,g){const p=[];for(const m of Object.keys(g.children))"primary"===m?p.unshift(m):p.push(m);return Tn(p).pipe(Jl(m=>{const v=g.children[m],y=VS(u,m);return this.expandSegmentGroup(l,y,v,m).pipe(Gt(b=>({segment:b,outlet:m})))}),sS((m,v)=>(m[v.outlet]=v.segment,m),{}),function yB(f,l){const u=arguments.length>=2;return g=>g.pipe(f?ma((p,m)=>f(p,m,g)):Ys,xm(1),u?aS(l):oS(()=>new Oh))}())}expandSegment(l,u,g,p,m,v){return Tn(g).pipe(Jl(y=>this.expandSegmentAgainstRoute(l,u,g,y,p,m,v).pipe(Rs(A=>{if(A instanceof Wh)return ct(null);throw A}))),_a(y=>!!y),Rs((y,b)=>{if(y instanceof Oh||"EmptyError"===y.name)return GS(u,p,m)?ct(new wt([],{})):lc(u);throw y}))}expandSegmentAgainstRoute(l,u,g,p,m,v,y){return US(p,u,m,v)?void 0===p.redirectTo?this.matchSegmentAgainstRoute(l,u,p,m,v):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v):lc(u):lc(u)}expandSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v){return"**"===p.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(l,g,p,v):this.expandRegularSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(l,u,g,p){const m=this.applyRedirectCommands([],g.redirectTo,{});return g.redirectTo.startsWith("/")?WS(m):this.lineralizeSegments(g,m).pipe(In(v=>{const y=new wt(v,{});return this.expandSegment(l,y,u,v,p,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(l,u,g,p,m,v){const{matched:y,consumedSegments:b,remainingSegments:A,positionalParamSegments:L}=Uh(u,p,m);if(!y)return lc(u);const N=this.applyRedirectCommands(b,p.redirectTo,L);return p.redirectTo.startsWith("/")?WS(N):this.lineralizeSegments(p,N).pipe(In(k=>this.expandSegment(l,u,g,k.concat(A),v,!1)))}matchSegmentAgainstRoute(l,u,g,p,m){if("**"===g.path)return g.loadChildren?(g._loadedConfig?ct(g._loadedConfig):this.configLoader.load(l.injector,g)).pipe(Gt(N=>(g._loadedConfig=N,new wt(p,{})))):ct(new wt(p,{}));const{matched:v,consumedSegments:y,remainingSegments:b}=Uh(u,g,p);return v?this.getChildConfig(l,g,p).pipe(In(L=>{const N=L.module,k=L.routes,{segmentGroup:j,slicedSegments:H}=Gh(u,y,b,k),z=new wt(j.segments,j.children);if(0===H.length&&z.hasChildren())return this.expandChildren(N,k,z).pipe(Gt(Q=>new wt(y,Q)));if(0===k.length&&0===H.length)return ct(new wt(y,{}));const $=Ni(g)===m;return this.expandSegment(N,z,k,H,$?pt:m,!0).pipe(Gt(X=>new wt(y.concat(X.segments),X.children)))})):lc(u)}getChildConfig(l,u,g){return u.children?ct(new jm(u.children,l)):u.loadChildren?void 0!==u._loadedConfig?ct(u._loadedConfig):this.runCanLoadGuards(l.injector,u,g).pipe(In(p=>p?this.configLoader.load(l.injector,u).pipe(Gt(m=>(u._loadedConfig=m,m))):function IV(f){return Mh(Rm(`Cannot load children because the guard of the route "path: '${f.path}'" returned false`))}(u))):ct(new jm([],l))}runCanLoadGuards(l,u,g){const p=u.canLoad;return p&&0!==p.length?ct(p.map(v=>{const y=l.get(v);let b;if(function fV(f){return f&&Ms(f.canLoad)}(y))b=y.canLoad(u,g);else{if(!Ms(y))throw new Error("Invalid CanLoad guard");b=y(u,g)}return xr(b)})).pipe(oc(),fi(v=>{if(!uo(v))return;const y=Rm(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw y.url=v,y}),Gt(v=>!0===v)):ct(!0)}lineralizeSegments(l,u){let g=[],p=u.root;for(;;){if(g=g.concat(p.segments),0===p.numberOfChildren)return ct(g);if(p.numberOfChildren>1||!p.children[pt])return Mh(new Error(`Only absolute redirects can have named outlets. redirectTo: '${l.redirectTo}'`));p=p.children[pt]}}applyRedirectCommands(l,u,g){return this.applyRedirectCreatreUrlTree(u,this.urlSerializer.parse(u),l,g)}applyRedirectCreatreUrlTree(l,u,g,p){const m=this.createSegmentGroup(l,u.root,g,p);return new lo(m,this.createQueryParams(u.queryParams,this.urlTree.queryParams),u.fragment)}createQueryParams(l,u){const g={};return Ln(l,(p,m)=>{if("string"==typeof p&&p.startsWith(":")){const y=p.substring(1);g[m]=u[y]}else g[m]=p}),g}createSegmentGroup(l,u,g,p){const m=this.createSegments(l,u.segments,g,p);let v={};return Ln(u.children,(y,b)=>{v[b]=this.createSegmentGroup(l,y,g,p)}),new wt(m,v)}createSegments(l,u,g,p){return u.map(m=>m.path.startsWith(":")?this.findPosParam(l,m,p):this.findOrReturn(m,g))}findPosParam(l,u,g){const p=g[u.path.substring(1)];if(!p)throw new Error(`Cannot redirect to '${l}'. Cannot find '${u.path}'.`);return p}findOrReturn(l,u){let g=0;for(const p of u){if(p.path===l.path)return u.splice(g),p;g++}return l}}function Hm(f){const l={};for(const g of Object.keys(f.children)){const m=Hm(f.children[g]);(m.segments.length>0||m.hasChildren())&&(l[g]=m)}return function AV(f){if(1===f.numberOfChildren&&f.children[pt]){const l=f.children[pt];return new wt(f.segments.concat(l.segments),l.children)}return f}(new wt(f.segments,l))}class zS{constructor(l){this.path=l,this.route=this.path[this.path.length-1]}}class zh{constructor(l,u){this.component=l,this.route=u}}function MV(f,l,u){const g=f._root;return cc(g,l?l._root:null,u,[g.value])}function Yh(f,l,u){const g=function LV(f){if(!f)return null;for(let l=f.parent;l;l=l.parent){const u=l.routeConfig;if(u&&u._loadedConfig)return u._loadedConfig}return null}(l);return(g?g.module.injector:u).get(f)}function cc(f,l,u,g,p={canDeactivateChecks:[],canActivateChecks:[]}){const m=ya(l);return f.children.forEach(v=>{(function FV(f,l,u,g,p={canDeactivateChecks:[],canActivateChecks:[]}){const m=f.value,v=l?l.value:null,y=u?u.getContext(f.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const b=function PV(f,l,u){if("function"==typeof u)return u(f,l);switch(u){case"pathParamsChange":return!co(f.url,l.url);case"pathParamsOrQueryParamsChange":return!co(f.url,l.url)||!Tr(f.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Nm(f,l)||!Tr(f.queryParams,l.queryParams);default:return!Nm(f,l)}}(v,m,m.routeConfig.runGuardsAndResolvers);b?p.canActivateChecks.push(new zS(g)):(m.data=v.data,m._resolvedData=v._resolvedData),cc(f,l,m.component?y?y.children:null:u,g,p),b&&y&&y.outlet&&y.outlet.isActivated&&p.canDeactivateChecks.push(new zh(y.outlet.component,v))}else v&&uc(l,y,p),p.canActivateChecks.push(new zS(g)),cc(f,null,m.component?y?y.children:null:u,g,p)})(v,m[v.value.outlet],u,g.concat([v.value]),p),delete m[v.value.outlet]}),Ln(m,(v,y)=>uc(v,u.getContext(y),p)),p}function uc(f,l,u){const g=ya(f),p=f.value;Ln(g,(m,v)=>{uc(m,p.component?l?l.children.getContext(v):null:l,u)}),u.canDeactivateChecks.push(new zh(p.component&&l&&l.outlet&&l.outlet.isActivated?l.outlet.component:null,p))}class WV{}function YS(f){return new dn(l=>l.error(f))}class YV{constructor(l,u,g,p,m,v){this.rootComponentType=l,this.config=u,this.urlTree=g,this.url=p,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const l=Gh(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,u=this.processSegmentGroup(this.config,l,pt);if(null===u)return null;const g=new Bh([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},pt,this.rootComponentType,null,this.urlTree.root,-1,{}),p=new Zr(g,u),m=new RS(this.url,p);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(l){const u=l.value,g=AS(u,this.paramsInheritanceStrategy);u.params=Object.freeze(g.params),u.data=Object.freeze(g.data),l.children.forEach(p=>this.inheritParamsAndData(p))}processSegmentGroup(l,u,g){return 0===u.segments.length&&u.hasChildren()?this.processChildren(l,u):this.processSegment(l,u,u.segments,g)}processChildren(l,u){const g=[];for(const m of Object.keys(u.children)){const v=u.children[m],y=VS(l,m),b=this.processSegmentGroup(y,v,m);if(null===b)return null;g.push(...b)}const p=$S(g);return function $V(f){f.sort((l,u)=>l.value.outlet===pt?-1:u.value.outlet===pt?1:l.value.outlet.localeCompare(u.value.outlet))}(p),p}processSegment(l,u,g,p){for(const m of l){const v=this.processSegmentAgainstRoute(m,u,g,p);if(null!==v)return v}return GS(u,g,p)?[]:null}processSegmentAgainstRoute(l,u,g,p){if(l.redirectTo||!US(l,u,g,p))return null;let m,v=[],y=[];if("**"===l.path){const j=g.length>0?pS(g).parameters:{};m=new Bh(g,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ZS(l),Ni(l),l.component,l,XS(u),qS(u)+g.length,KS(l))}else{const j=Uh(u,l,g);if(!j.matched)return null;v=j.consumedSegments,y=j.remainingSegments,m=new Bh(v,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,ZS(l),Ni(l),l.component,l,XS(u),qS(u)+v.length,KS(l))}const b=function XV(f){return f.children?f.children:f.loadChildren?f._loadedConfig.routes:[]}(l),{segmentGroup:A,slicedSegments:L}=Gh(u,v,y,b.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===L.length&&A.hasChildren()){const j=this.processChildren(b,A);return null===j?null:[new Zr(m,j)]}if(0===b.length&&0===L.length)return[new Zr(m,[])];const N=Ni(l)===p,k=this.processSegment(b,A,L,N?pt:p);return null===k?null:[new Zr(m,k)]}}function qV(f){const l=f.value.routeConfig;return l&&""===l.path&&void 0===l.redirectTo}function $S(f){const l=[],u=new Set;for(const g of f){if(!qV(g)){l.push(g);continue}const p=l.find(m=>g.value.routeConfig===m.value.routeConfig);void 0!==p?(p.children.push(...g.children),u.add(p)):l.push(g)}for(const g of u){const p=$S(g.children);l.push(new Zr(g.value,p))}return l.filter(g=>!u.has(g))}function XS(f){let l=f;for(;l._sourceSegment;)l=l._sourceSegment;return l}function qS(f){let l=f,u=l._segmentIndexShift?l._segmentIndexShift:0;for(;l._sourceSegment;)l=l._sourceSegment,u+=l._segmentIndexShift?l._segmentIndexShift:0;return u-1}function ZS(f){return f.data||{}}function KS(f){return f.resolve||{}}function QS(f){return[...Object.keys(f),...Object.getOwnPropertySymbols(f)]}function Wm(f){return ao(l=>{const u=f(l);return u?Tn(u).pipe(Gt(()=>l)):ct(l)})}class ij extends class nj{shouldDetach(l){return!1}store(l,u){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,u){return l.routeConfig===u.routeConfig}}{}const zm=new gt("ROUTES");class JS{constructor(l,u,g,p){this.injector=l,this.compiler=u,this.onLoadStartListener=g,this.onLoadEndListener=p}load(l,u){if(u._loader$)return u._loader$;this.onLoadStartListener&&this.onLoadStartListener(u);const p=this.loadModuleFactory(u.loadChildren).pipe(Gt(m=>{this.onLoadEndListener&&this.onLoadEndListener(u);const v=m.create(l);return new jm(gS(v.injector.get(zm,void 0,qe.Self|qe.Optional)).map(Gm),v)}),Rs(m=>{throw u._loader$=void 0,m}));return u._loader$=new pB(p,()=>new Fr).pipe(rS()),u._loader$}loadModuleFactory(l){return xr(l()).pipe(In(u=>u instanceof hE?ct(u):Tn(this.compiler.compileModuleAsync(u))))}}class sj{shouldProcessUrl(l){return!0}extract(l){return l}merge(l,u){return l}}function oj(f){throw f}function aj(f,l,u){return l.parse("/")}function eI(f,l){return ct(null)}const lj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},cj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let gi=(()=>{class f{constructor(u,g,p,m,v,y,b){this.rootComponentType=u,this.urlSerializer=g,this.rootContexts=p,this.location=m,this.config=b,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Fr,this.errorHandler=oj,this.malformedUriErrorHandler=aj,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:eI,afterPreactivation:eI},this.urlHandlingStrategy=new sj,this.routeReuseStrategy=new ij,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(zr),this.console=v.get(lP);const N=v.get(On);this.isNgZoneEnabled=N instanceof On&&On.isInAngularZone(),this.resetConfig(b),this.currentUrlTree=function PB(){return new lo(new wt([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new JS(v,y,k=>this.triggerEvent(new cS(k)),k=>this.triggerEvent(new uS(k))),this.routerState=xS(this.currentUrlTree,this.rootComponentType),this.transitions=new sr({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var u;return null===(u=this.location.getState())||void 0===u?void 0:u.\u0275routerPageId}setupNavigations(u){const g=this.events;return u.pipe(ma(p=>0!==p.id),Gt(p=>Object.assign(Object.assign({},p),{extractedUrl:this.urlHandlingStrategy.extract(p.rawUrl)})),ao(p=>{let m=!1,v=!1;return ct(p).pipe(fi(y=>{this.currentNavigation={id:y.id,initialUrl:y.currentRawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ao(y=>{const b=this.browserUrlTree.toString(),A=!this.navigated||y.extractedUrl.toString()!==b||b!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||A)&&this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return tI(y.source)&&(this.browserUrlTree=y.extractedUrl),ct(y).pipe(ao(N=>{const k=this.transitions.getValue();return g.next(new Am(N.id,this.serializeUrl(N.extractedUrl),N.source,N.restoredState)),k!==this.transitions.getValue()?Nr:Promise.resolve(N)}),function RV(f,l,u,g){return ao(p=>function TV(f,l,u,g,p){return new xV(f,l,u,g,p).apply()}(f,l,u,p.extractedUrl,g).pipe(Gt(m=>Object.assign(Object.assign({},p),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),fi(N=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:N.urlAfterRedirects})}),function ZV(f,l,u,g,p){return In(m=>function zV(f,l,u,g,p="emptyOnly",m="legacy"){try{const v=new YV(f,l,u,g,p,m).recognize();return null===v?YS(new WV):ct(v)}catch(v){return YS(v)}}(f,l,m.urlAfterRedirects,u(m.urlAfterRedirects),g,p).pipe(Gt(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,N=>this.serializeUrl(N),this.paramsInheritanceStrategy,this.relativeLinkResolution),fi(N=>{if("eager"===this.urlUpdateStrategy){if(!N.extras.skipLocationChange){const j=this.urlHandlingStrategy.merge(N.urlAfterRedirects,N.rawUrl);this.setBrowserUrl(j,N)}this.browserUrlTree=N.urlAfterRedirects}const k=new EB(N.id,this.serializeUrl(N.extractedUrl),this.serializeUrl(N.urlAfterRedirects),N.targetSnapshot);g.next(k)}));if(A&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:k,extractedUrl:j,source:H,restoredState:z,extras:$}=y,q=new Am(k,this.serializeUrl(j),H,z);g.next(q);const X=xS(j,this.rootComponentType).snapshot;return ct(Object.assign(Object.assign({},y),{targetSnapshot:X,urlAfterRedirects:j,extras:Object.assign(Object.assign({},$),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=y.rawUrl,y.resolve(null),Nr}),Wm(y=>{const{targetSnapshot:b,id:A,extractedUrl:L,rawUrl:N,extras:{skipLocationChange:k,replaceUrl:j}}=y;return this.hooks.beforePreactivation(b,{navigationId:A,appliedUrlTree:L,rawUrlTree:N,skipLocationChange:!!k,replaceUrl:!!j})}),fi(y=>{const b=new bB(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(b)}),Gt(y=>Object.assign(Object.assign({},y),{guards:MV(y.targetSnapshot,y.currentSnapshot,this.rootContexts)})),function NV(f,l){return In(u=>{const{targetSnapshot:g,currentSnapshot:p,guards:{canActivateChecks:m,canDeactivateChecks:v}}=u;return 0===v.length&&0===m.length?ct(Object.assign(Object.assign({},u),{guardsResult:!0})):function kV(f,l,u,g){return Tn(f).pipe(In(p=>function HV(f,l,u,g,p){const m=l&&l.routeConfig?l.routeConfig.canDeactivate:null;return m&&0!==m.length?ct(m.map(y=>{const b=Yh(y,l,p);let A;if(function mV(f){return f&&Ms(f.canDeactivate)}(b))A=xr(b.canDeactivate(f,l,u,g));else{if(!Ms(b))throw new Error("Invalid CanDeactivate guard");A=xr(b(f,l,u,g))}return A.pipe(_a())})).pipe(oc()):ct(!0)}(p.component,p.route,u,l,g)),_a(p=>!0!==p,!0))}(v,g,p,f).pipe(In(y=>y&&function dV(f){return"boolean"==typeof f}(y)?function BV(f,l,u,g){return Tn(l).pipe(Jl(p=>Tm(function jV(f,l){return null!==f&&l&&l(new TB(f)),ct(!0)}(p.route.parent,g),function VV(f,l){return null!==f&&l&&l(new AB(f)),ct(!0)}(p.route,g),function GV(f,l,u){const g=l[l.length-1],m=l.slice(0,l.length-1).reverse().map(v=>function OV(f){const l=f.routeConfig?f.routeConfig.canActivateChild:null;return l&&0!==l.length?{node:f,guards:l}:null}(v)).filter(v=>null!==v).map(v=>iS(()=>ct(v.guards.map(b=>{const A=Yh(b,v.node,u);let L;if(function pV(f){return f&&Ms(f.canActivateChild)}(A))L=xr(A.canActivateChild(g,f));else{if(!Ms(A))throw new Error("Invalid CanActivateChild guard");L=xr(A(g,f))}return L.pipe(_a())})).pipe(oc())));return ct(m).pipe(oc())}(f,p.path,u),function UV(f,l,u){const g=l.routeConfig?l.routeConfig.canActivate:null;if(!g||0===g.length)return ct(!0);const p=g.map(m=>iS(()=>{const v=Yh(m,l,u);let y;if(function gV(f){return f&&Ms(f.canActivate)}(v))y=xr(v.canActivate(l,f));else{if(!Ms(v))throw new Error("Invalid CanActivate guard");y=xr(v(l,f))}return y.pipe(_a())}));return ct(p).pipe(oc())}(f,p.route,u))),_a(p=>!0!==p,!0))}(g,m,f,l):ct(y)),Gt(y=>Object.assign(Object.assign({},u),{guardsResult:y})))})}(this.ngModule.injector,y=>this.triggerEvent(y)),fi(y=>{if(uo(y.guardsResult)){const A=Rm(`Redirecting to "${this.serializeUrl(y.guardsResult)}"`);throw A.url=y.guardsResult,A}const b=new DB(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.triggerEvent(b)}),ma(y=>!!y.guardsResult||(this.restoreHistory(y),this.cancelNavigationTransition(y,""),!1)),Wm(y=>{if(y.guards.canActivateChecks.length)return ct(y).pipe(fi(b=>{const A=new SB(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(A)}),ao(b=>{let A=!1;return ct(b).pipe(function KV(f,l){return In(u=>{const{targetSnapshot:g,guards:{canActivateChecks:p}}=u;if(!p.length)return ct(u);let m=0;return Tn(p).pipe(Jl(v=>function QV(f,l,u,g){return function JV(f,l,u,g){const p=QS(f);if(0===p.length)return ct({});const m={};return Tn(p).pipe(In(v=>function ej(f,l,u,g){const p=Yh(f,l,g);return xr(p.resolve?p.resolve(l,u):p(l,u))}(f[v],l,u,g).pipe(fi(y=>{m[v]=y}))),xm(1),In(()=>QS(m).length===p.length?ct(m):Nr))}(f._resolve,f,l,g).pipe(Gt(m=>(f._resolvedData=m,f.data=Object.assign(Object.assign({},f.data),AS(f,u).resolve),null)))}(v.route,g,f,l)),fi(()=>m++),xm(1),In(v=>m===p.length?ct(u):Nr))})}(this.paramsInheritanceStrategy,this.ngModule.injector),fi({next:()=>A=!0,complete:()=>{A||(this.restoreHistory(b),this.cancelNavigationTransition(b,"At least one route resolver didn't emit any value."))}}))}),fi(b=>{const A=new IB(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(A)}))}),Wm(y=>{const{targetSnapshot:b,id:A,extractedUrl:L,rawUrl:N,extras:{skipLocationChange:k,replaceUrl:j}}=y;return this.hooks.afterPreactivation(b,{navigationId:A,appliedUrlTree:L,rawUrlTree:N,skipLocationChange:!!k,replaceUrl:!!j})}),Gt(y=>{const b=function JB(f,l,u){const g=ic(f,l._root,u?u._root:void 0);return new TS(g,l)}(this.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return Object.assign(Object.assign({},y),{targetRouterState:b})}),fi(y=>{this.currentUrlTree=y.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),this.routerState=y.targetRouterState,"deferred"===this.urlUpdateStrategy&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y),this.browserUrlTree=y.urlAfterRedirects)}),((f,l,u)=>Gt(g=>(new uV(l,g.targetRouterState,g.currentRouterState,u).activate(f),g)))(this.rootContexts,this.routeReuseStrategy,y=>this.triggerEvent(y)),fi({next(){m=!0},complete(){m=!0}}),function CB(f){return An((l,u)=>{try{l.subscribe(u)}finally{u.add(f)}})}(()=>{var y;m||v||this.cancelNavigationTransition(p,`Navigation ID ${p.id} is not equal to the current navigation id ${this.navigationId}`),(null===(y=this.currentNavigation)||void 0===y?void 0:y.id)===p.id&&(this.currentNavigation=null)}),Rs(y=>{if(v=!0,function OB(f){return f&&f[dS]}(y)){const b=uo(y.url);b||(this.navigated=!0,this.restoreHistory(p,!0));const A=new lS(p.id,this.serializeUrl(p.extractedUrl),y.message);g.next(A),b?setTimeout(()=>{const L=this.urlHandlingStrategy.merge(y.url,this.rawUrlTree),N={skipLocationChange:p.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||tI(p.source)};this.scheduleNavigation(L,"imperative",null,N,{resolve:p.resolve,reject:p.reject,promise:p.promise})},0):p.resolve(!1)}else{this.restoreHistory(p,!0);const b=new wB(p.id,this.serializeUrl(p.extractedUrl),y);g.next(b);try{p.resolve(this.errorHandler(y))}catch(A){p.reject(A)}}return Nr}))}))}resetRootComponentType(u){this.rootComponentType=u,this.routerState.root.component=this.rootComponentType}setTransition(u){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),u))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(u=>{const g="popstate"===u.type?"popstate":"hashchange";"popstate"===g&&setTimeout(()=>{var p;const m={replaceUrl:!0},v=(null===(p=u.state)||void 0===p?void 0:p.navigationId)?u.state:null;if(v){const b=Object.assign({},v);delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(m.state=b)}const y=this.parseUrl(u.url);this.scheduleNavigation(y,g,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(u){this.events.next(u)}resetConfig(u){BS(u),this.config=u.map(Gm),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(u,g={}){const{relativeTo:p,queryParams:m,fragment:v,queryParamsHandling:y,preserveFragment:b}=g,A=p||this.routerState.root,L=b?this.currentUrlTree.fragment:v;let N=null;switch(y){case"merge":N=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":N=this.currentUrlTree.queryParams;break;default:N=m||null}return null!==N&&(N=this.removeEmptyProps(N)),function nV(f,l,u,g,p){if(0===u.length)return km(l.root,l.root,l.root,g,p);const m=function iV(f){if("string"==typeof f[0]&&1===f.length&&"/"===f[0])return new LS(!0,0,f);let l=0,u=!1;const g=f.reduce((p,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const y={};return Ln(m.outlets,(b,A)=>{y[A]="string"==typeof b?b.split("/"):b}),[...p,{outlets:y}]}if(m.segmentPath)return[...p,m.segmentPath]}return"string"!=typeof m?[...p,m]:0===v?(m.split("/").forEach((y,b)=>{0==b&&"."===y||(0==b&&""===y?u=!0:".."===y?l++:""!=y&&p.push(y))}),p):[...p,m]},[]);return new LS(u,l,g)}(u);if(m.toRoot())return km(l.root,l.root,new wt([],{}),g,p);const v=function rV(f,l,u){if(f.isAbsolute)return new Bm(l.root,!0,0);if(-1===u.snapshot._lastPathIndex){const m=u.snapshot._urlSegment;return new Bm(m,m===l.root,0)}const g=Vh(f.commands[0])?0:1;return function sV(f,l,u){let g=f,p=l,m=u;for(;m>p;){if(m-=p,g=g.parent,!g)throw new Error("Invalid number of '../'");p=g.segments.length}return new Bm(g,!1,p-m)}(u.snapshot._urlSegment,u.snapshot._lastPathIndex+g,f.numberOfDoubleDots)}(m,l,f),y=v.processChildren?jh(v.segmentGroup,v.index,m.commands):FS(v.segmentGroup,v.index,m.commands);return km(l.root,v.segmentGroup,y,g,p)}(A,this.currentUrlTree,u,N,null!=L?L:null)}navigateByUrl(u,g={skipLocationChange:!1}){const p=uo(u)?u:this.parseUrl(u),m=this.urlHandlingStrategy.merge(p,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,g)}navigate(u,g={skipLocationChange:!1}){return function uj(f){for(let l=0;l<f.length;l++){const u=f[l];if(null==u)throw new Error(`The requested path contains ${u} segment at index ${l}`)}}(u),this.navigateByUrl(this.createUrlTree(u,g),g)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){let g;try{g=this.urlSerializer.parse(u)}catch(p){g=this.malformedUriErrorHandler(p,this.urlSerializer,u)}return g}isActive(u,g){let p;if(p=!0===g?Object.assign({},lj):!1===g?Object.assign({},cj):g,uo(u))return _S(this.currentUrlTree,u,p);const m=this.parseUrl(u);return _S(this.currentUrlTree,m,p)}removeEmptyProps(u){return Object.keys(u).reduce((g,p)=>{const m=u[p];return null!=m&&(g[p]=m),g},{})}processNavigations(){this.navigations.subscribe(u=>{this.navigated=!0,this.lastSuccessfulId=u.id,this.currentPageId=u.targetPageId,this.events.next(new ec(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,u.resolve(!0)},u=>{this.console.warn(`Unhandled Navigation Error: ${u}`)})}scheduleNavigation(u,g,p,m,v){var y,b;if(this.disposed)return Promise.resolve(!1);let A,L,N;v?(A=v.resolve,L=v.reject,N=v.promise):N=new Promise((H,z)=>{A=H,L=z});const k=++this.navigationId;let j;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(p=this.location.getState()),j=p&&p.\u0275routerPageId?p.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(b=this.browserPageId)&&void 0!==b?b:0)+1):j=0,this.setTransition({id:k,targetPageId:j,source:g,restoredState:p,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:u,extras:m,resolve:A,reject:L,promise:N,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),N.catch(H=>Promise.reject(H))}setBrowserUrl(u,g){const p=this.urlSerializer.serialize(u),m=Object.assign(Object.assign({},g.extras.state),this.generateNgRouterState(g.id,g.targetPageId));this.location.isCurrentPathEqualTo(p)||g.extras.replaceUrl?this.location.replaceState(p,"",m):this.location.go(p,"",m)}restoreHistory(u,g=!1){var p,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-u.targetPageId;"popstate"!==u.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(p=this.currentNavigation)||void 0===p?void 0:p.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(u),this.browserUrlTree=u.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(g&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=u.currentRouterState,this.currentUrlTree=u.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(u,g){const p=new lS(u.id,this.serializeUrl(u.extractedUrl),g);this.triggerEvent(p),u.resolve(!1)}generateNgRouterState(u,g){return"computed"===this.canceledNavigationResolution?{navigationId:u,\u0275routerPageId:g}:{navigationId:u}}}return f.\u0275fac=function(u){jg()},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();function tI(f){return"imperative"!==f}let hc=(()=>{class f{constructor(u,g,p){this.router=u,this.route=g,this.locationStrategy=p,this.commands=null,this.href=null,this.onChanges=new Fr,this.subscription=u.events.subscribe(m=>{m instanceof ec&&this.updateTargetUrlAndHref()})}set routerLink(u){this.commands=null!=u?Array.isArray(u)?u:[u]:null}ngOnChanges(u){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(u,g,p,m,v){if(0!==u||g||p||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const y={skipLocationChange:wa(this.skipLocationChange),replaceUrl:wa(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,y),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:wa(this.preserveFragment)})}}return f.\u0275fac=function(u){return new(u||f)(ye(gi),ye(Ca),ye(ga))},f.\u0275dir=$e({type:f,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(u,g){1&u&&Tt("click",function(m){return g.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&u&&wr("target",g.target)("href",g.href,Wf)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[xi]}),f})();function wa(f){return""===f||!!f}class nI{}class iI{preload(l,u){return ct(null)}}let rI=(()=>{class f{constructor(u,g,p,m){this.router=u,this.injector=p,this.preloadingStrategy=m,this.loader=new JS(p,g,b=>u.triggerEvent(new cS(b)),b=>u.triggerEvent(new uS(b)))}setUpPreloading(){this.subscription=this.router.events.pipe(ma(u=>u instanceof ec),Jl(()=>this.preload())).subscribe(()=>{})}preload(){const u=this.injector.get(zr);return this.processRoutes(u,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,g){const p=[];for(const m of g)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;p.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?p.push(this.preloadConfig(u,m)):m.children&&p.push(this.processRoutes(u,m.children));return Tn(p).pipe(Ja(),Gt(m=>{}))}preloadConfig(u,g){return this.preloadingStrategy.preload(g,()=>(g._loadedConfig?ct(g._loadedConfig):this.loader.load(u.injector,g)).pipe(In(m=>(g._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return f.\u0275fac=function(u){return new(u||f)(Xe(gi),Xe(XE),Xe(ei),Xe(nI))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})(),$m=(()=>{class f{constructor(u,g,p={}){this.router=u,this.viewportScroller=g,this.options=p,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},p.scrollPositionRestoration=p.scrollPositionRestoration||"disabled",p.anchorScrolling=p.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(u=>{u instanceof Am?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof ec&&(this.lastId=u.id,this.scheduleScrollEvent(u,this.router.parseUrl(u.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(u=>{u instanceof hS&&(u.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(u.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,g){this.router.triggerEvent(new hS(u,"popstate"===this.lastSource?this.store[this.restoredId]:null,g))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return f.\u0275fac=function(u){jg()},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();const ho=new gt("ROUTER_CONFIGURATION"),sI=new gt("ROUTER_FORROOT_GUARD"),gj=[Np,{provide:wS,useClass:ES},{provide:gi,useFactory:function yj(f,l,u,g,p,m,v={},y,b){const A=new gi(null,f,l,u,g,p,gS(m));return y&&(A.urlHandlingStrategy=y),b&&(A.routeReuseStrategy=b),function Cj(f,l){f.errorHandler&&(l.errorHandler=f.errorHandler),f.malformedUriErrorHandler&&(l.malformedUriErrorHandler=f.malformedUriErrorHandler),f.onSameUrlNavigation&&(l.onSameUrlNavigation=f.onSameUrlNavigation),f.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=f.paramsInheritanceStrategy),f.relativeLinkResolution&&(l.relativeLinkResolution=f.relativeLinkResolution),f.urlUpdateStrategy&&(l.urlUpdateStrategy=f.urlUpdateStrategy),f.canceledNavigationResolution&&(l.canceledNavigationResolution=f.canceledNavigationResolution)}(v,A),v.enableTracing&&A.events.subscribe(L=>{var N,k;null===(N=console.group)||void 0===N||N.call(console,`Router Event: ${L.constructor.name}`),console.log(L.toString()),console.log(L),null===(k=console.groupEnd)||void 0===k||k.call(console)}),A},deps:[wS,ac,Np,ei,XE,zm,ho,[class rj{},new Cs],[class tj{},new Cs]]},ac,{provide:Ca,useFactory:function wj(f){return f.routerState.root},deps:[gi]},rI,iI,class fj{preload(l,u){return u().pipe(Rs(()=>ct(null)))}},{provide:ho,useValue:{enableTracing:!1}}];function pj(){return new JE("Router",gi)}let oI=(()=>{class f{constructor(u,g){}static forRoot(u,g){return{ngModule:f,providers:[gj,aI(u),{provide:sI,useFactory:vj,deps:[[gi,new Cs,new _l]]},{provide:ho,useValue:g||{}},{provide:ga,useFactory:_j,deps:[ro,[new Tu(Pp),new Cs],ho]},{provide:$m,useFactory:mj,deps:[gi,Ck,ho]},{provide:nI,useExisting:g&&g.preloadingStrategy?g.preloadingStrategy:iI},{provide:JE,multi:!0,useFactory:pj},[Xm,{provide:yp,multi:!0,useFactory:Ej,deps:[Xm]},{provide:lI,useFactory:bj,deps:[Xm]},{provide:$E,multi:!0,useExisting:lI}]]}}static forChild(u){return{ngModule:f,providers:[aI(u)]}}}return f.\u0275fac=function(u){return new(u||f)(Xe(sI,8),Xe(gi,8))},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({}),f})();function mj(f,l,u){return u.scrollOffset&&l.setOffset(u.scrollOffset),new $m(f,l,u)}function _j(f,l,u={}){return u.useHash?new eN(f,l):new vb(f,l)}function vj(f){return"guarded"}function aI(f){return[{provide:LA,multi:!0,useValue:f},{provide:zm,multi:!0,useValue:f}]}let Xm=(()=>{class f{constructor(u){this.injector=u,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Fr}appInitializer(){return this.injector.get(KP,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let g=null;const p=new Promise(y=>g=y),m=this.injector.get(gi),v=this.injector.get(ho);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),g(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?ct(null):(this.initNavigation=!0,g(!0),this.resultOfPreactivationDone),m.initialNavigation()):g(!0),p})}bootstrapListener(u){const g=this.injector.get(ho),p=this.injector.get(rI),m=this.injector.get($m),v=this.injector.get(gi),y=this.injector.get(xp);u===y.components[0]&&(("enabledNonBlocking"===g.initialNavigation||void 0===g.initialNavigation)&&v.initialNavigation(),p.setUpPreloading(),m.init(),v.resetRootComponentType(y.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return f.\u0275fac=function(u){return new(u||f)(Xe(ei))},f.\u0275prov=Ct({token:f,factory:f.\u0275fac}),f})();function Ej(f){return f.appInitializer.bind(f)}function bj(f){return f.bootstrapListener.bind(f)}const lI=new gt("Router Initializer");function cI(f,l,u,g,p,m,v){try{var y=f[m](v),b=y.value}catch(A){return void u(A)}y.done?l(b):Promise.resolve(b).then(g,p)}function re(f){return function(){var l=this,u=arguments;return new Promise(function(g,p){var m=f.apply(l,u);function v(b){cI(m,g,p,v,y,"next",b)}function y(b){cI(m,g,p,v,y,"throw",b)}v(void 0)})}}const Sj=[{id:"reader",name:"Barcode and QR Code Reader",description:"Scan barcode and QR code from image files"},{id:"scanner",name:"Barcode and QR Code Scanner",description:"Scan barcode and QR code from camera stream"},{id:"file-detection",name:"Document Detector (File)",description:"Detect document from image files"},{id:"camera-detection",name:"Document Scanner (Camera)",description:"Detect document from camera stream"},{id:"mrz-reader",name:"MRZ Reader",description:"Scan MRZ from image files"},{id:"mrz-scanner",name:"MRZ Scanner",description:"Scan MRZ from camera stream"}];function dt(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function fo(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}var go,Ar,Ge,f;"function"==typeof SuppressedError&&SuppressedError,(f=go||(go={}))[f.BOPM_BLOCK=0]="BOPM_BLOCK",f[f.BOPM_UPDATE=1]="BOPM_UPDATE",function(f){f[f.CCUT_AUTO=0]="CCUT_AUTO",f[f.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",f[f.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",f[f.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",f[f.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",f[f.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Ar||(Ar={})),function(f){f[f.IPF_BINARY=0]="IPF_BINARY",f[f.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",f[f.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",f[f.IPF_NV21=3]="IPF_NV21",f[f.IPF_RGB_565=4]="IPF_RGB_565",f[f.IPF_RGB_555=5]="IPF_RGB_555",f[f.IPF_RGB_888=6]="IPF_RGB_888",f[f.IPF_ARGB_8888=7]="IPF_ARGB_8888",f[f.IPF_RGB_161616=8]="IPF_RGB_161616",f[f.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",f[f.IPF_ABGR_8888=10]="IPF_ABGR_8888",f[f.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",f[f.IPF_BGR_888=12]="IPF_BGR_888",f[f.IPF_BINARY_8=13]="IPF_BINARY_8",f[f.IPF_NV12=14]="IPF_NV12",f[f.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Ge||(Ge={}));const uI=f=>Object.prototype.toString.call(f),qm=f=>Array.isArray?Array.isArray(f):"[object Array]"===uI(f),Zm=f=>"[object Boolean]"===uI(f),an=f=>"number"==typeof f&&!Number.isNaN(f),or=f=>null!==f&&"object"==typeof f&&!Array.isArray(f),hI=f=>!(!or(f)||!(f.bytes instanceof Uint8Array)||!an(f.width)||f.width<=0||!an(f.height)||f.height<=0||!an(f.stride)||f.stride<=0||!("format"in f)||"tag"in f&&!Tj(f.tag)),Tj=f=>!!or(f)&&!!an(f.imageId)&&"type"in f,Ea=f=>!!or(f)&&!!an(f.x)&&!!an(f.y);function Km(f,l){return Qm.apply(this,arguments)}function Qm(){return Qm=re(function*(f,l){return yield new Promise((u,g)=>{let p=new XMLHttpRequest;p.open("GET",f,!0),p.responseType=l,p.send(),p.onloadend=re(function*(){p.status<200||p.status>=300?g(f+" "+p.status):u(p.response)}),p.onerror=()=>{g(new Error("Network Error: "+p.statusText))}})}),Qm.apply(this,arguments)}const pi=(f,l)=>{let u=f.split("."),g=l.split(".");for(let p=0;p<u.length&&p<g.length;++p){let m=u[p],v=g[p];if(m===v)continue;let y=parseInt(u[p]),b=parseInt(g[p]);return y===b||Number.isNaN(y)&&Number.isNaN(b)?m<v?-1:1:y<b||Number.isNaN(y)&&Number.isInteger(b)?-1:1}return u.length===g.length?0:u.length<g.length?-1:1},Oj="function"==typeof BigInt;var $h,_n,po,dc,fc,ki,mo,Jm;class Bi{get _isFetchingStarted(){return dt(this,fc,"f")}constructor(){$h.add(this),_n.set(this,[]),po.set(this,1),dc.set(this,go.BOPM_BLOCK),fc.set(this,!1),ki.set(this,void 0),mo.set(this,Ar.CCUT_AUTO)}setErrorListener(l){}addImageToBuffer(l){var u;if(!hI(l))throw new TypeError("Invalid 'image'.");if((null===(u=l.tag)||void 0===u?void 0:u.hasOwnProperty("imageId"))&&"number"==typeof l.tag.imageId&&this.hasImage(l.tag.imageId))throw new Error("Existed imageId.");if(dt(this,_n,"f").length>=dt(this,po,"f"))switch(dt(this,dc,"f")){case go.BOPM_BLOCK:break;case go.BOPM_UPDATE:if(dt(this,_n,"f").push(l),or(dt(this,ki,"f"))&&an(dt(this,ki,"f").imageId)&&1==dt(this,ki,"f").keepInBuffer)for(;dt(this,_n,"f").length>dt(this,po,"f");){const g=dt(this,_n,"f").findIndex(p=>{var m;return(null===(m=p.tag)||void 0===m?void 0:m.imageId)!==dt(this,ki,"f").imageId});dt(this,_n,"f").splice(g,1)}else dt(this,_n,"f").splice(0,dt(this,_n,"f").length-dt(this,po,"f"))}else dt(this,_n,"f").push(l)}getImage(){if(0===dt(this,_n,"f").length)return null;let l;if(dt(this,ki,"f")&&an(dt(this,ki,"f").imageId)){const u=dt(this,$h,"m",Jm).call(this,dt(this,ki,"f").imageId);if(u<0)throw new Error(`Image with id ${dt(this,ki,"f").imageId} doesn't exist.`);l=dt(this,_n,"f").slice(u,u+1)[0]}else l=dt(this,_n,"f").pop();if([Ge.IPF_RGB_565,Ge.IPF_RGB_555,Ge.IPF_RGB_888,Ge.IPF_ARGB_8888,Ge.IPF_RGB_161616,Ge.IPF_ARGB_16161616,Ge.IPF_ABGR_8888,Ge.IPF_ABGR_16161616,Ge.IPF_BGR_888].includes(l.format)){if(dt(this,mo,"f")===Ar.CCUT_RGB_R_CHANNEL_ONLY){Bi._onLog&&Bi._onLog("only get R channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case Ge.IPF_RGB_565:case Ge.IPF_RGB_555:case Ge.IPF_RGB_888:case Ge.IPF_RGB_161616:u[g]=l.bytes[3*g+2];break;case Ge.IPF_ARGB_8888:case Ge.IPF_ARGB_16161616:u[g]=l.bytes[4*g+2];break;case Ge.IPF_BGR_888:u[g]=l.bytes[3*g];break;case Ge.IPF_ABGR_8888:case Ge.IPF_ABGR_16161616:u[g]=l.bytes[4*g]}l.bytes=u,l.stride=l.width,l.format=Ge.IPF_GRAYSCALED}else if(dt(this,mo,"f")===Ar.CCUT_RGB_G_CHANNEL_ONLY){Bi._onLog&&Bi._onLog("only get G channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case Ge.IPF_RGB_565:case Ge.IPF_RGB_555:case Ge.IPF_RGB_888:case Ge.IPF_RGB_161616:case Ge.IPF_BGR_888:u[g]=l.bytes[3*g+1];break;case Ge.IPF_ARGB_8888:case Ge.IPF_ARGB_16161616:case Ge.IPF_ABGR_8888:case Ge.IPF_ABGR_16161616:u[g]=l.bytes[4*g+1]}l.bytes=u,l.stride=l.width,l.format=Ge.IPF_GRAYSCALED}else if(dt(this,mo,"f")===Ar.CCUT_RGB_B_CHANNEL_ONLY){Bi._onLog&&Bi._onLog("only get B channel data.");const u=new Uint8Array(l.width*l.height);for(let g=0;g<u.length;g++)switch(l.format){case Ge.IPF_RGB_565:case Ge.IPF_RGB_555:case Ge.IPF_RGB_888:case Ge.IPF_RGB_161616:u[g]=l.bytes[3*g];break;case Ge.IPF_ARGB_8888:case Ge.IPF_ARGB_16161616:u[g]=l.bytes[4*g];break;case Ge.IPF_BGR_888:u[g]=l.bytes[3*g+2];break;case Ge.IPF_ABGR_8888:case Ge.IPF_ABGR_16161616:u[g]=l.bytes[4*g+2]}l.bytes=u,l.stride=l.width,l.format=Ge.IPF_GRAYSCALED}}else[Ge.IPF_NV21,Ge.IPF_NV12].includes(l.format)&&Bi._onLog&&Bi._onLog("NV21 or NV12 is not supported.");return l}setNextImageToReturn(l,u){if(!((...g)=>0!==g.length&&g.every(p=>an(p)))(l))throw new TypeError("Invalid 'imageId'.");if(void 0!==u&&!Zm(u))throw new TypeError("Invalid 'keepInBuffer'.");fo(this,ki,{imageId:l,keepInBuffer:u},"f")}_resetNextReturnedImage(){fo(this,ki,null,"f")}hasImage(l){return dt(this,$h,"m",Jm).call(this,l)>=0}startFetching(){fo(this,fc,!0,"f")}stopFetching(){fo(this,fc,!1,"f")}setMaxImageCount(l){if("number"!=typeof l)throw new TypeError("Invalid 'count'.");if(l<1||Math.round(l)!==l)throw new Error("Invalid 'count'.");for(fo(this,po,l,"f");dt(this,_n,"f")&&dt(this,_n,"f").length>l;)dt(this,_n,"f").shift()}getMaxImageCount(){return dt(this,po,"f")}getImageCount(){return dt(this,_n,"f").length}clearBuffer(){dt(this,_n,"f").length=0}isBufferEmpty(){return 0===dt(this,_n,"f").length}setBufferOverflowProtectionMode(l){fo(this,dc,l,"f")}getBufferOverflowProtectionMode(){return dt(this,dc,"f")}setColourChannelUsageType(l){fo(this,mo,l,"f")}getColourChannelUsageType(){return dt(this,mo,"f")}}_n=new WeakMap,po=new WeakMap,dc=new WeakMap,fc=new WeakMap,ki=new WeakMap,mo=new WeakMap,$h=new WeakSet,Jm=function(f){if("number"!=typeof f)throw new TypeError("Invalid 'imageId'.");return dt(this,_n,"f").findIndex(l=>{var u;return(null===(u=l.tag)||void 0===u?void 0:u.imageId)===f})};const Xh="undefined"==typeof self,dI=(()=>{if(!Xh&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),fI=f=>{if(null==f&&(f="./"),!Xh){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};let gc,Kr,qh,Zh,ni;"undefined"!=typeof navigator&&(gc=navigator,Kr=gc.userAgent,qh=gc.platform,Zh=gc.mediaDevices),function(){if(!Xh){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:gc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:qh,search:"Win"},Mac:{str:qh},Linux:{str:qh}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let A=v.verStr||Kr,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||Kr).indexOf(v.search||m)){u=m;for(let N of L){let k=A.indexOf(N);if(-1!=k){g=parseFloat(A.substring(k+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Kr).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=Kr.indexOf("Windows NT")&&(p="HarmonyOS"),ni={browser:u,version:g,OS:p}}Xh&&(ni={browser:"ssr",version:0,OS:"ssr"})}();const Lj="undefined"!=typeof WebAssembly&&Kr&&!(/Safari/.test(Kr)&&!/Chrome/.test(Kr)&&/\(.+\s11_2_([2-6]).*\)/.test(Kr)),Fj="undefined"!=typeof Worker,gI=!(!Zh||!Zh.getUserMedia),Pj=function(){var f=re(function*(){let l=!1;if(gI)try{(yield Zh.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return f.apply(this,arguments)}}(),pI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class Kh extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(pI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,pI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&re(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}const Vi={},mI=function(){var f=re(function*(l){let u="string"==typeof l?[l]:l,g=[];for(let p of u)g.push(Vi[p]=Vi[p]||new Kh);yield Promise.all(g)});return function(u){return f.apply(this,arguments)}}(),Qh=function(){var f=re(function*(l,u){let g,p="string"==typeof l?[l]:l,m=[];for(let v of p){let y;m.push(y=Vi[v]=Vi[v]||new Kh(g=g||u())),y.isEmpty&&(y.task=g=g||u())}yield Promise.all(m)});return function(u,g){return f.apply(this,arguments)}}();let Ze,_I=0;const Et=()=>_I++,it={};let Os,e_=!1;const qn={},Qt={},Ae={std:{version:"1.2.10",path:fI(dI+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:dI}},pc=new Proxy(Ae,{get(f,l,u){let g=Reflect.get(f,l,u);return g&&g.path&&(g=g.path),g}}),ji={dip:{wasm:!0}},mi=function(){var f=re(function*(l){let u;l instanceof Array||(l=l?[l]:[]);{let m=Vi.core;u=!m||m.isEmpty}let g=new Map;for(let m of l){if(m=m.toLowerCase(),"std"==m||"core"==m)continue;if(!ji[m])throw Error("The '"+m+"' module cannot be found.");let v=ji[m].deps;if(null==v?void 0:v.length)for(let b of v){let A=Vi[b];g.has(b)||g.set(b,!A||A.isEmpty)}let y=Vi[m];g.has(m)||g.set(m,!y||y.isEmpty)}let p=[];u&&p.push("core"),p.push(...g.keys()),yield Qh(p,re(function*(){const m=[...g.entries()].filter(N=>N[1]).map(N=>N[0]),v={};for(let N in pc){if("rootDirectory"==N)continue;let k=pc[N];pc.rootDirectory&&(k.startsWith("http://")||k.startsWith("https://")||(k=pc.rootDirectory+"/"+k)),v[N]=fI(k)}const y={};for(let N of m)y[N]=ji[N];const b={engineResourcePaths:v,autoResources:y,names:m};let A=new Kh;if(u){b.needLoadCore=!0;let N=v.core+Ft._workerName;v.rootDirectory&&(N=v.rootDirectory+N),N.startsWith(location.origin)||(N=yield fetch(N).then(k=>k.blob()).then(k=>URL.createObjectURL(k))),Ze=new Worker(N),Ze.onerror=k=>{let j=new Error(k.message);A.reject(j)},Ze.addEventListener("message",k=>{let j=k.data?k.data:k,z=j.id,$=j.body;switch(j.type){case"log":Os&&Os(j.message);break;case"task":try{it[z]($),delete it[z]}catch(q){throw delete it[z],q}break;case"event":try{it[z]($)}catch(q){throw q}break;default:console.log(k)}}),b.bLog=!!Os,b.bd=e_,b.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield mI("worker");let L=_I++;it[L]=N=>{if(N.success)Object.assign(qn,N.versions),"{}"!==JSON.stringify(N.versions)&&(Ft._versions=N.versions),A.resolve(void 0);else{const k=Error(N.message);N.stack&&(k.stack=N.stack),A.reject(k)}},Ze.postMessage({type:"loadWasm",body:b,id:L}),u&&Qh("worker",()=>Promise.resolve()),yield A}))});return function(u){return f.apply(this,arguments)}}();class Ft{static get engineResourcePaths(){return pc}static set engineResourcePaths(l){Object.assign(Ae,l)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Os}static set _onLog(l){(f=>{Os=f,Ze&&Ze.postMessage({type:"setBLog",body:{value:!!f}})})(l)}static get _bDebug(){return e_}static set _bDebug(l){(f=>{e_=f,Ze&&Ze.postMessage({type:"setBDebug",body:{value:!!f}})})(l)}static isModuleLoaded(l){return l=(l=l||"core").toLowerCase(),!!Vi[l]&&Vi[l].isFulfilled}static loadWasm(l){return re(function*(){return yield mi(l)})()}static detectEnvironment(){return re(function*(){return yield re(function*(){return{wasm:Lj,worker:Fj,getUserMedia:gI,camera:yield Pj(),browser:ni.browser,version:ni.version,OS:ni.OS}})()})()}static getModuleVersion(){return re(function*(){return yield new Promise((l,u)=>{let g=Et();it[g]=function(){var p=re(function*(m){if(m.success)return l(m.versions);{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,u(v)}});return function(m){return p.apply(this,arguments)}}(),Ze.postMessage({type:"getModuleVersion",id:g})})})()}static getVersion(){return`3.2.30(Worker: ${qn.core&&qn.core.worker||"Not Loaded"}, Wasm: ${qn.core&&qn.core.wasm||"Not Loaded"})`}static enableLogging(){Bi._onLog=console.log,Ft._onLog=console.log}static disableLogging(){Bi._onLog=null,Ft._onLog=null}static cfd(l){return re(function*(){return yield new Promise((u,g)=>{let p=Et();it[p]=function(){var m=re(function*(v){if(v.success)return u();{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,g(y)}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"cfd",id:p,body:{count:l}})})})()}}var Yt,vI,t_,yI,CI,Jh,wI,EI,ba,bI,DI;Ft._bSupportDce4Module=-1,Ft._bSupportIRTModule=-1,Ft._versions=null,Ft._workerName="core.worker.js",Ft.browserInfo=ni,function(f){f[f.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",f[f.CRIT_BARCODE=2]="CRIT_BARCODE",f[f.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",f[f.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",f[f.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",f[f.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Yt||(Yt={})),function(f){f[f.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",f[f.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",f[f.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",f[f.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(vI||(vI={})),function(f){f[f.EC_OK=0]="EC_OK",f[f.EC_UNKNOWN=-1e4]="EC_UNKNOWN",f[f.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",f[f.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",f[f.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",f[f.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",f[f.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",f[f.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",f[f.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",f[f.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",f[f.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",f[f.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",f[f.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",f[f.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",f[f.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",f[f.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",f[f.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",f[f.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",f[f.EC_TIMEOUT=-10026]="EC_TIMEOUT",f[f.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",f[f.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",f[f.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",f[f.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",f[f.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",f[f.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",f[f.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",f[f.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",f[f.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",f[f.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",f[f.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",f[f.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",f[f.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",f[f.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",f[f.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",f[f.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",f[f.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",f[f.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",f[f.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",f[f.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",f[f.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",f[f.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",f[f.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",f[f.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",f[f.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",f[f.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",f[f.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",f[f.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",f[f.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",f[f.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",f[f.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",f[f.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",f[f.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",f[f.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",f[f.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",f[f.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",f[f.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",f[f.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",f[f.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",f[f.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",f[f.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",f[f.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",f[f.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",f[f.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",f[f.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",f[f.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",f[f.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",f[f.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",f[f.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",f[f.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",f[f.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",f[f.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",f[f.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",f[f.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",f[f.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",f[f.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",f[f.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",f[f.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",f[f.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",f[f.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",f[f.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",f[f.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",f[f.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",f[f.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",f[f.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",f[f.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",f[f.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",f[f.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",f[f.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",f[f.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",f[f.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",f[f.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",f[f.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",f[f.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",f[f.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",f[f.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",f[f.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",f[f.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",f[f.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",f[f.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",f[f.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",f[f.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(t_||(t_={})),function(f){f[f.GEM_SKIP=0]="GEM_SKIP",f[f.GEM_AUTO=1]="GEM_AUTO",f[f.GEM_GENERAL=2]="GEM_GENERAL",f[f.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",f[f.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",f[f.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",f[f.GEM_REV=-2147483648]="GEM_REV"}(yI||(yI={})),function(f){f[f.GTM_SKIP=0]="GTM_SKIP",f[f.GTM_INVERTED=1]="GTM_INVERTED",f[f.GTM_ORIGINAL=2]="GTM_ORIGINAL",f[f.GTM_AUTO=4]="GTM_AUTO",f[f.GTM_REV=-2147483648]="GTM_REV"}(CI||(CI={})),function(f){f[f.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",f[f.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(Jh||(Jh={})),function(f){f[f.PDFRM_VECTOR=1]="PDFRM_VECTOR",f[f.PDFRM_RASTER=2]="PDFRM_RASTER",f[f.PDFRM_REV=-2147483648]="PDFRM_REV"}(wI||(wI={})),function(f){f[f.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",f[f.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(EI||(EI={})),function(f){f[f.IRUT_NULL=0]="IRUT_NULL",f[f.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",f[f.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",f[f.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",f[f.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",f[f.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",f[f.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",f[f.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",f[f.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",f[f.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",f[f.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",f[f.IRUT_CONTOURS=1024]="IRUT_CONTOURS",f[f.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",f[f.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",f[f.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",f[f.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",f[f.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",f[f.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",f[f.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",f[f.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",f[f.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",f[f.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",f[f.IRUT_CORNERS=2097152]="IRUT_CORNERS",f[f.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",f[f.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",f[f.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",f[f.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",f[f.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",f[f.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",f[f.IRUT_ALL=268435455]="IRUT_ALL"}(ba||(ba={})),function(f){f[f.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",f[f.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",f[f.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",f[f.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",f[f.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",f[f.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",f[f.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",f[f.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",f[f.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(bI||(bI={})),function(f){f[f.ST_NULL=0]="ST_NULL",f[f.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",f[f.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",f[f.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",f[f.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",f[f.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",f[f.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",f[f.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(DI||(DI={}));const Ls="undefined"==typeof self,SI=Ls?{}:self,II=(()=>{if(!Ls&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),TI=f=>{if(null==f&&(f="./"),!Ls){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f},xI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class n_ extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(xI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,xI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&re(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}const ed=" is not allowed to change after `createInstance` or `loadWasm` is called.",Bj=!Ls&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",AI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`license`"+ed);u._license=l};!Ls&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const RI=f=>{if(null==f)f=[];else{f=f instanceof Array?[...f]:[f];for(let l=0;l<f.length;++l){if(!Ls){let u=document.createElement("a");u.href=f[l],f[l]=u.href}f[l].endsWith("/")||(f[l]+="/")}}return f},MI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`licenseServer`"+ed);u._licenseServer=RI(l)},OI=(f,l)=>{const u=f;if(!u._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+ed);u._deviceFriendlyName=l||""};let mc,_c,td,i_,ar;"undefined"!=typeof navigator&&(mc=navigator,_c=mc.userAgent,td=mc.platform,i_=mc.mediaDevices),function(){if(!Ls){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:mc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:td,search:"Win"},Mac:{str:td},Linux:{str:td}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let A=v.verStr||_c,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||_c).indexOf(v.search||m)){u=m;for(let N of L){let k=A.indexOf(N);if(-1!=k){g=parseFloat(A.substring(k+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||_c).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=_c.indexOf("Windows NT")&&(p="HarmonyOS"),ar={browser:u,version:g,OS:p}}Ls&&(ar={browser:"ssr",version:0,OS:"ssr"})}();const LI=function(){var f=re(function*(){return mi("license"),Qh("dynamsoft_inited",re(function*(){let{lt:l,l:u,ls:g,sp:p,rmk:m,cv:v}=((A,L=!1)=>{const N=A;if(N._pLoad.isEmpty){let k,j,H,z=N._license||"",$=JSON.parse(JSON.stringify(N._licenseServer)),q=N._sessionPassword,X=0;if(z.startsWith("t")||z.startsWith("f"))X=0;else if(0===z.length||z.startsWith("P")||z.startsWith("L")||z.startsWith("Y")||z.startsWith("A"))X=1;else{X=2;const Q=z.indexOf(":");-1!=Q&&(z=z.substring(Q+1));const pe=z.indexOf("?");if(-1!=pe&&(j=z.substring(pe+1),z=z.substring(0,pe)),z.startsWith("DLC2"))X=0;else{if(z.startsWith("DLS2")){let _e;try{let Te=z.substring(4);Te=atob(Te),_e=JSON.parse(Te)}catch(Te){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(z=_e.handshakeCode?_e.handshakeCode:_e.organizationID?_e.organizationID:"","number"==typeof z&&(z=JSON.stringify(z)),0===$.length){let Te=[];_e.mainServerURL&&(Te[0]=_e.mainServerURL),_e.standbyServerURL&&(Te[1]=_e.standbyServerURL),$=RI(Te)}!q&&_e.sessionPassword&&(q=_e.sessionPassword),k=_e.remark}z&&"200001"!==z&&!z.startsWith("200001-")||(X=1)}}if(X&&(L||(SI.crypto||(H="Please upgrade your browser to support online key."),SI.crypto.subtle||(H="Require https to use online key in this browser."))),H){if(1!==X)throw new Error(H);X=0,console.warn(H),N._lastErrorCode=-1,N._lastErrorString=H}return 1===X&&(z="",console.warn("Applying for a public trial license ...")),{lt:X,l:z,ls:$,sp:q,rmk:k,cv:j}}throw new Error("Can't preprocess license again"+ed)})(jt),y=new n_;jt._pLoad.task=y,re(function*(){try{yield jt._pLoad}catch(A){}})();let b=Et();it[b]=A=>{if(A.message&&jt._onAuthMessage){let k=jt._onAuthMessage(A.message);null!=k&&(A.message=k)}let L,N=!1;if(1===l&&(N=!0),A.success?(Os&&Os("init license success"),A.message&&console.warn(A.message),Ft._bSupportIRTModule=A.bSupportIRTModule,Ft._bSupportDce4Module=A.bSupportDce4Module,jt.bPassValidation=!0):(L=Error(A.message),A.stack&&(L.stack=A.stack),A.ltsErrorCode&&(L.ltsErrorCode=A.ltsErrorCode),N||111==A.ltsErrorCode&&-1!=A.message.toLowerCase().indexOf("trial license")&&(N=!0)),N){let k=Ae.license;Ae.rootDirectory&&(k=Ae.rootDirectory+"/"+k),k=TI(k),(j=re(function*(H,z,$){if(!H._bNeverShowDialog)try{let q=yield fetch(H.engineResourcePath+"dls.license.dialog.html");if(!q.ok)throw Error("Get license dialog fail. Network Error: "+q.statusText);let X=yield q.text();if(!X.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let Q=document.createElement("div");Q.innerHTML=X;let pe=[];for(let w=0;w<Q.childElementCount;++w){let D=Q.children[w];D instanceof HTMLStyleElement&&(pe.push(D),document.head.append(D))}let _e=1==Q.childElementCount?Q.children[0]:Q;_e.remove();let Te,Re,P,Ee,Ve,nt=[_e],S=_e.children;for(let w of S)nt.push(w);for(let w=0;w<nt.length;++w)for(let D of nt[w].children)nt.push(D);for(let w of nt)if(!Te&&w.classList.contains("dls-license-mask"))Te=w,w.addEventListener("click",D=>{if(w==D.target){_e.remove();for(let T of pe)T.remove()}});else if(!Re&&w.classList.contains("dls-license-icon-close"))Re=w,w.addEventListener("click",()=>{_e.remove();for(let D of pe)D.remove()});else if(!P&&w.classList.contains("dls-license-icon-error"))P=w,"error"!=z&&w.remove();else if(!Ee&&w.classList.contains("dls-license-icon-warn"))Ee=w,"warn"!=z&&w.remove();else if(!Ve&&w.classList.contains("dls-license-msg-content")){Ve=w;let D=$;for(;D;){let T=D.indexOf("["),_=D.indexOf("]",T),C=D.indexOf("(",_),I=D.indexOf(")",C);if(-1==T||-1==_||-1==C||-1==I){w.appendChild(new Text(D));break}T>0&&w.appendChild(new Text(D.substring(0,T)));let O=document.createElement("a"),x=D.substring(T+1,_);O.innerText=x;let M=D.substring(C+1,I);O.setAttribute("href",M),O.setAttribute("target","_blank"),w.appendChild(O),D=D.substring(I+1)}}document.body.appendChild(_e)}catch(q){H._onLog&&H._onLog(q.message||q)}}),function(H,z,$){return j.apply(this,arguments)})({_bNeverShowDialog:jt._bNeverShowDialog,engineResourcePath:k,_onLog:Os},A.success?"warn":"error",A.message)}var j;A.success?y.resolve(void 0):y.reject(L)},yield mI("worker"),Ze.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!l,bptk:1===l,l:u,os:ar,fn:jt.deviceFriendlyName,ls:g,sp:p,rmk:m,cv:v},id:b}),jt.bCallInitLicense=!0,yield y}))});return function(){return f.apply(this,arguments)}}();let FI;Qt.license={},Qt.license.dynamsoft=LI,Qt.license.getAR=re(function*(){{let f=Vi.dynamsoft_inited;f&&f.isRejected&&(yield f)}return Ze?new Promise((f,l)=>{let u=Et();it[u]=function(){var g=re(function*(p){if(p.success){delete p.success;{let m=jt.license;m&&(m.startsWith("t")||m.startsWith("f"))&&(p.pk=m)}if(Object.keys(p).length){if(p.lem){let m=Error(p.lem);m.ltsErrorCode=p.lec,delete p.lem,delete p.lec,p.ae=m}f(p)}else f(null)}else{let m=Error(p.message);p.stack&&(m.stack=p.stack),l(m)}});return function(p){return g.apply(this,arguments)}}(),Ze.postMessage({type:"getAR",id:u})}):null});class jt{static setLicenseServer(l){MI(jt,l)}static get license(){return this._license}static set license(l){AI(jt,l)}static get licenseServer(){return this._licenseServer}static set licenseServer(l){MI(jt,l)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(l){OI(jt,l)}static initLicense(l,u){if(AI(jt,l),jt.bCallInitLicense=!0,u)return LI()}static setDeviceFriendlyName(l){OI(jt,l)}static getDeviceFriendlyName(){return jt._deviceFriendlyName}static getDeviceUUID(){return re(function*(){return yield Qh("dynamsoft_uuid",re(function*(){yield mi();let l=new n_,u=Et();it[u]=g=>{if(g.success)l.resolve(g.uuid);else{const p=Error(g.message);g.stack&&(p.stack=g.stack),l.reject(p)}},Ze.postMessage({type:"getDeviceUUID",id:u}),FI=yield l})),FI})()}}jt._pLoad=new n_,jt.bPassValidation=!1,jt.bCallInitLicense=!1,jt._license=Bj,jt._licenseServer=[],jt._deviceFriendlyName="",null==Ae.license&&(Ae.license=II),ji.license={wasm:!0},Qt.license.LicenseManager=jt;const r_="1.2.10";"string"!=typeof Ae.std&&pi(Ae.std.version,r_)<0&&(Ae.std={version:r_,path:TI(II+`../../dynamsoft-capture-vision-std@${r_}/dist/`)});const PI=f=>f&&"object"==typeof f&&"function"==typeof f.then;class Da extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(PI(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,PI(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&re(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}class Vj{constructor(l){this._cvr=l}getMaxBufferedItems(){var l=this;return re(function*(){return yield new Promise((u,g)=>{let p=Et();it[p]=function(){var m=re(function*(v){if(v.success)return u(v.count);{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,g(y)}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_getMaxBufferedItems",id:p,instanceID:l._cvr._instanceID})})})()}setMaxBufferedItems(l){var u=this;return re(function*(){return yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g();{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_setMaxBufferedItems",id:m,instanceID:u._cvr._instanceID,body:{count:l}})})})()}getBufferedCharacterItemSet(){var l=this;return re(function*(){return yield new Promise((u,g)=>{let p=Et();it[p]=function(){var m=re(function*(v){if(v.success)return u(v.itemSet);{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,g(y)}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_getBufferedCharacterItemSet",id:p,instanceID:l._cvr._instanceID})})})()}}var jj={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const NI=(f,l)=>{for(let u in l._irrRegistryState)l._irrRegistryState[u]=!1;for(let u of f._intermediateResultReceiverSet)if(u.isDce)l._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let g in u)l._irrRegistryState[g]||(l._irrRegistryState[g]=!!u[g])};class Uj{constructor(l){this._irrRegistryState=jj,this._cvr=l}addResultReceiver(l){var u=this;return re(function*(){if("object"!=typeof l)throw new Error("Invalid receiver.");u._cvr._intermediateResultReceiverSet.add(l),NI(u._cvr,u);let g=-1,p={};if(!l.isDce){if(!l._observedResultUnitTypes||!l._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");g=l._observedResultUnitTypes,l._observedTaskMap.forEach((m,v)=>{p[v]=m}),l._observedTaskMap.clear()}return yield new Promise((m,v)=>{let y=Et();it[y]=function(){var b=re(function*(A){if(A.success)return m();{let L=new Error(A.message);return L.stack=A.stack+"\n"+L.stack,v(L)}});return function(A){return b.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_setIrrRegistry",id:y,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState,observedResultUnitTypes:String(g),observedTaskMap:p}})})})()}removeResultReceiver(l){var u=this;return re(function*(){return u._cvr._intermediateResultReceiverSet.delete(l),NI(u._cvr,u),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g();{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_setIrrRegistry",id:m,instanceID:u._cvr._instanceID,body:{receiverObj:u._irrRegistryState}})})})()}getOriginalImage(){return this._cvr._dsImage}}const kI="undefined"==typeof self,s_=(()=>{if(!kI&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),BI=f=>{if(null==f&&(f="./"),!kI){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};var o_;null==Ae.cvr&&(Ae.cvr=s_),ji.cvr={js:!0,wasm:!0,deps:["license","dip"]},Qt.cvr={};const a_="1.2.10";"string"!=typeof Ae.std&&pi(Ae.std.version,a_)<0&&(Ae.std={version:a_,path:BI(s_+`../../dynamsoft-capture-vision-std@${a_}/dist/`)});const l_="2.2.30";(!Ae.dip||"string"!=typeof Ae.dip&&pi(Ae.dip.version,l_)<0)&&(Ae.dip={version:l_,path:BI(s_+`../../dynamsoft-image-processing@${l_}/dist/`)});class VI{static getVersion(){return this._version}}var nd,jI;function UI(f,l){if(f&&f.location){const u=f.location.points;for(let g of u)g.x=g.x/l,g.y=g.y/l;UI(f.referencedItem,l)}}VI._version=`2.2.30(Worker: ${null===(o_=qn.cvr)||void 0===o_?void 0:o_.worker}, Wasm: loading...`,function(f){f[f.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",f[f.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(nd||(nd={})),function(f){f[f.IRUT_NULL=0]="IRUT_NULL",f[f.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",f[f.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",f[f.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",f[f.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",f[f.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",f[f.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",f[f.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",f[f.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",f[f.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",f[f.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",f[f.IRUT_CONTOURS=1024]="IRUT_CONTOURS",f[f.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",f[f.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",f[f.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",f[f.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",f[f.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",f[f.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",f[f.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",f[f.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",f[f.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",f[f.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",f[f.IRUT_CORNERS=2097152]="IRUT_CORNERS",f[f.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",f[f.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",f[f.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",f[f.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",f[f.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",f[f.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",f[f.IRUT_ALL=134217727]="IRUT_ALL"}(jI||(jI={}));class bt{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Ft.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return re(function*(){if(!Qt.license)throw Error("Module `license` is not existed.");yield Qt.license.dynamsoft(),yield mi(["cvr"]);const l=new bt,u=new Da;let g=Et();return it[g]=function(){var p=re(function*(m){var v;if(m.success)l._instanceID=m.instanceID,l._currentSettings=JSON.parse(m.outputSettings),VI._version=`2.2.30(Worker: ${null===(v=qn.cvr)||void 0===v?void 0:v.worker}, Wasm: ${m.version})`,0===Ft.bSupportDce4Module&&(l._intermediateResultManager=l.getIntermediateResultManager(!0)),u.resolve(l);else{const y=Error(m.message);m.stack&&(y.stack=m.stack),u.reject(y)}});return function(m){return p.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_createInstance",id:g}),u})()}_singleFrameModeCallback(l){var u=this;return re(function*(){u._isa.getCameraView().setScanLaserVisible(!0);for(let v of u._resultReceiverSet)u._bNeedOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:l});const g={bytes:new Uint8Array(l.bytes),width:l.width,height:l.height,stride:l.stride,format:l.format,tag:l.tag};u._templateName||(u._templateName=u._currentSettings.CaptureVisionTemplates[0].Name);const p=yield u.capture(g,u._templateName);p.originalImageTag=l.tag;for(let v of u._resultReceiverSet)v.isDce&&v.onCapturedResultReceived(p,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const m={originalImageHashId:p.originalImageHashId,originalImageTag:p.originalImageTag,errorCode:p.errorCode,errorString:p.errorString};for(let v of u._resultReceiverSet)if(v.onDecodedBarcodesReceived&&p.barcodeResultItems&&v.onDecodedBarcodesReceived(Object.assign(Object.assign({},m),{barcodeResultItems:p.barcodeResultItems})),v.onRecognizedTextLinesReceived&&p.textLineResultItems&&v.onRecognizedTextLinesReceived(Object.assign(Object.assign({},m),{textLineResultItems:p.textLineResultItems})),v.onDetectedQuadsReceived&&p.detectedQuadResultItems&&v.onDetectedQuadsReceived(Object.assign(Object.assign({},m),{detectedQuadResultItems:p.detectedQuadResultItems})),v.onNormalizedImagesReceived&&p.normalizedImageResultItems&&v.onNormalizedImagesReceived(Object.assign(Object.assign({},m),{normalizedImageResultItems:p.normalizedImageResultItems})),v.onParsedResultsReceived&&p.parsedResultItems&&v.onParsedResultsReceived(Object.assign(Object.assign({},m),{parsedResultItems:p.parsedResultItems})),v.onCapturedResultReceived&&!v.isDce){if(u._bNeedOutputOriginalImage){const y=p.items.findIndex(b=>1===b.type);-1!==y&&(p.items[y].imageData=l)}v.onCapturedResultReceived(p)}})()}setInput(l){if(this._checkIsDisposed(),l){if(this._isa=l,l.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const u=this._isa.getCameraView();if(u){const g=u._capturedResultReceiver;g.isDce=!0,this._resultReceiverSet.add(g)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(l){if(this._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid ISA state listener.");l&&Object.keys(l)&&this._isaStateListenerSet.add(l)}removeImageSourceStateListener(l){return this._checkIsDisposed(),this._isaStateListenerSet.delete(l)}addResultReceiver(l){if(this._checkIsDisposed(),"object"!=typeof l)throw new Error("Invalid receiver.");l&&Object.keys(l).length&&(this._resultReceiverSet.add(l),this._setCrrRegistry())}removeResultReceiver(l){this._checkIsDisposed(),this._resultReceiverSet.delete(l),this._setCrrRegistry()}_setCrrRegistry(){var l=this;return re(function*(){const u={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let m of l._resultReceiverSet)m.isDce||(u.onCapturedResultReceived=!!m.onCapturedResultReceived,u.onDecodedBarcodesReceived=!!m.onDecodedBarcodesReceived,u.onRecognizedTextLinesReceived=!!m.onRecognizedTextLinesReceived,u.onDetectedQuadsReceived=!!m.onDetectedQuadsReceived,u.onNormalizedImagesReceived=!!m.onNormalizedImagesReceived,u.onParsedResultsReceived=!!m.onParsedResultsReceived);const g=new Da;let p=Et();return it[p]=function(){var m=re(function*(v){if(v.success)g.resolve();else{let y=new Error(v.message);y.stack=v.stack+"\n"+y.stack,g.reject()}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_setCrrRegistry",id:p,instanceID:l._instanceID,body:{receiver:JSON.stringify(u)}}),g})()}addResultFilter(l){var u=this;return re(function*(){if(u._checkIsDisposed(),"object"!=typeof l)return console.warn("Invalid filter.");if(l&&Object.keys(l)){u._resultFilterSet.add(l),u._handleFilterSwitch();for(let g of u._resultFilterSet)yield u._enableResultCrossVerification(g.verificationEnabled),yield u._enableResultDeduplication(g.duplicateFilterEnabled),yield u._setDuplicateForgetTime(g.duplicateForgetTime)}})()}removeResultFilter(l){var u=this;return re(function*(){u._checkIsDisposed(),u._resultFilterSet.delete(l),u._handleFilterSwitch();for(let g of u._resultFilterSet)yield u._enableResultCrossVerification(g.verificationEnabled),yield u._enableResultDeduplication(g.duplicateFilterEnabled),yield u._setDuplicateForgetTime(g.duplicateForgetTime)})()}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let l of this._resultFilterSet)l.isResultCrossVerificationEnabled(Yt.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),l.isResultCrossVerificationEnabled(Yt.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),l.isResultCrossVerificationEnabled(Yt.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),l.isResultCrossVerificationEnabled(Yt.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(l){var u=this;return re(function*(){var g,p;if(u._checkIsDisposed(),!u._bPauseScan)return;if(!u._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const m=yield u.containsTask(l);return yield mi(m),m.includes("dlr")&&!(null===(g=Qt.dlr)||void 0===g?void 0:g.bLoadConfusableCharsData)&&(yield null===(p=Qt.dlr)||void 0===p?void 0:p.loadRecognitionData("ConfusableChars",Ae.dlr)),u._isa.isCameraEnhancer&&(m.includes("ddn")?u._isa.setPixelFormat(Ge.IPF_ABGR_8888):u._isa.setPixelFormat(Ge.IPF_GRAYSCALED)),void 0!==u._isa.singleFrameMode&&"disabled"!==u._isa.singleFrameMode?(u._templateName=l,void u._isa.on("singleFrameAcquired",u._singleFrameModeCallbackBind)):(u._isa.getColourChannelUsageType()===Ar.CCUT_AUTO&&u._isa.setColourChannelUsageType(m.includes("ddn")?Ar.CCUT_FULL_CHANNEL:Ar.CCUT_Y_CHANNEL_ONLY),u._promiseStartScan&&u._promiseStartScan.isPending?u._promiseStartScan:(u._promiseStartScan=new Da((v,y)=>{if(u.disposed)return;let b=Et();it[b]=function(){var A=re(function*(L){if(u._promiseStartScan&&!u._promiseStartScan.isFulfilled){if(!L.success){let N=new Error(L.message);return N.stack=L.stack+"\n"+N.stack,y(N)}for(let N of u._resultFilterSet)yield u.addResultFilter(N);u._bPauseScan=!1,u._bNeedOutputOriginalImage=L.bNeedOutputOriginalImage,u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(re(function*(){-1!==u._minImageCaptureInterval&&u._isa.startFetching(),u._loopReadVideo(l),v()}),0),u._isa.isCameraEnhancer&&u._isa.getCameraView().setScanLaserVisible(!0)}});return function(L){return A.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_startCapturing",id:b,instanceID:u._instanceID,body:{templateName:l}})}),yield u._promiseStartScan))})()}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),void 0!==this._isa.singleFrameMode&&"disabled"!==this._isa.singleFrameMode)?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(Ar.CCUT_AUTO)))}_clearVerifyList(){var l=this;return re(function*(){let u=Et();const g=new Da;return it[u]=function(){var p=re(function*(m){if(m.success)return g.resolve();{let v=new Error(m.message);return v.stack=m.stack+"\n"+v.stack,g.reject(v)}});return function(m){return p.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_clearVerifyList",id:u,instanceID:l._instanceID}),g})()}_getIntermediateResult(){var l=this;return re(function*(){l._checkIsDisposed();let u=Et();const g=new Da;return it[u]=function(){var p=re(function*(m){if(m.success)g.resolve(m.result);else{let v=new Error(m.message);v.stack=m.stack+"\n"+v.stack,g.reject(v)}});return function(m){return p.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_getIntermediateResult",id:u,instanceID:l._instanceID}),g})()}containsTask(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(JSON.parse(y.tasks));{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_containsTask",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}_loopReadVideo(l){var u=this;return re(function*(){if(u._dynamsoft=!0,u.disposed||u._bPauseScan)return;if(u._isa.isBufferEmpty())if(u._isa.hasNextImageToFetch())for(let p of u._isaStateListenerSet)p.onImageSourceStateReceived&&p.onImageSourceStateReceived(nd.ISS_BUFFER_EMPTY);else if(!u._isa.hasNextImageToFetch())for(let p of u._isaStateListenerSet)p.onImageSourceStateReceived&&p.onImageSourceStateReceived(nd.ISS_EXHAUSTED);if(-1===u._minImageCaptureInterval||u._isa.isBufferEmpty())try{u._isa.isBufferEmpty()&&bt._onLog&&bt._onLog("buffer is empty so fetch image"),bt._onLog&&bt._onLog(`DCE: start fetching a frame: ${Date.now()}`),u._dsImage=u._isa.fetchImage(),bt._onLog&&bt._onLog(`DCE: finish fetching a frame: ${Date.now()}`),u._isa.setImageFetchInterval(u._averageTime)}catch(p){return void u._reRunCurrnetFunc(l)}else if(u._isa.setImageFetchInterval(u._averageTime-(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0)),u._dsImage=u._isa.getImage(),u._dsImage.tag&&Date.now()-u._dsImage.tag.timeStamp>200)return void u._reRunCurrnetFunc(l);if(!u._dsImage)return void u._reRunCurrnetFunc(l);for(let p of u._resultReceiverSet)u._bNeedOutputOriginalImage&&p.onOriginalImageResultReceived&&p.onOriginalImageResultReceived({imageData:u._dsImage});const g=Date.now();u._captureDsimage(u._dsImage,l).then(function(){var p=re(function*(m){if(bt._onLog&&bt._onLog("no js handle time: "+(Date.now()-g)),u._bPauseScan)return void u._reRunCurrnetFunc(l);m.originalImageTag=u._dsImage.tag?u._dsImage.tag:null;for(let b of u._resultReceiverSet)if(b.isDce){const A=Date.now();if(b.onCapturedResultReceived(m,{isDetectVerifyOpen:u._bOpenDetectVerify,isNormalizeVerifyOpen:u._bOpenNormalizeVerify,isBarcodeVerifyOpen:u._bOpenBarcodeVerify,isLabelVerifyOpen:u._bOpenLabelVerify}),bt._onLog){const L=Date.now()-A;L>10&&bt._onLog(`draw result time: ${L}`)}}const v={originalImageHashId:m.originalImageHashId,originalImageTag:m.originalImageTag,errorCode:m.errorCode,errorString:m.errorString};for(let b of u._resultReceiverSet)b.onDecodedBarcodesReceived&&m.barcodeResultItems&&b.onDecodedBarcodesReceived(Object.assign(Object.assign({},v),{barcodeResultItems:m.barcodeResultItems.filter(A=>!A.isFilter)})),b.onRecognizedTextLinesReceived&&m.textLineResultItems&&b.onRecognizedTextLinesReceived(Object.assign(Object.assign({},v),{textLineResultItems:m.textLineResultItems.filter(A=>!A.isFilter)})),b.onDetectedQuadsReceived&&m.detectedQuadResultItems&&b.onDetectedQuadsReceived(Object.assign(Object.assign({},v),{detectedQuadResultItems:m.detectedQuadResultItems.filter(A=>!A.isFilter)})),b.onNormalizedImagesReceived&&m.normalizedImageResultItems&&b.onNormalizedImagesReceived(Object.assign(Object.assign({},v),{normalizedImageResultItems:m.normalizedImageResultItems.filter(A=>!A.isFilter)})),b.onParsedResultsReceived&&m.parsedResultItems&&b.onParsedResultsReceived(Object.assign(Object.assign({},v),{parsedResultItems:m.parsedResultItems.filter(A=>!A.isFilter)})),b.onCapturedResultReceived&&!b.isDce&&(m.items=m.items.filter(A=>!A.isFilter),m.barcodeResultItems&&(m.barcodeResultItems=m.barcodeResultItems.filter(A=>!A.isFilter)),m.textLineResultItems&&(m.textLineResultItems=m.textLineResultItems.filter(A=>!A.isFilter)),m.detectedQuadResultItems&&(m.detectedQuadResultItems=m.detectedQuadResultItems.filter(A=>!A.isFilter)),m.normalizedImageResultItems&&(m.normalizedImageResultItems=m.normalizedImageResultItems.filter(A=>!A.isFilter)),m.parsedResultItems&&(m.parsedResultItems=m.parsedResultItems.filter(A=>!A.isFilter)),b.onCapturedResultReceived(m));const y=Date.now();if(u._minImageCaptureInterval>-1&&(5===u._averageProcessintTimeArray.length&&u._averageProcessintTimeArray.shift(),5===u._averageFetchImageTimeArray.length&&u._averageFetchImageTimeArray.shift(),u._averageProcessintTimeArray.push(Date.now()-g),u._averageFetchImageTimeArray.push(u._dsImage&&u._dsImage.tag?u._dsImage.tag.timeSpent:0),u._averageTime=Math.min(...u._averageProcessintTimeArray)-Math.max(...u._averageFetchImageTimeArray),u._averageTime=u._averageTime>0?u._averageTime:0,bt._onLog&&(bt._onLog(`minImageCaptureInterval: ${u._minImageCaptureInterval}`),bt._onLog(`averageProcessintTimeArray: ${u._averageProcessintTimeArray}`),bt._onLog(`averageFetchImageTimeArray: ${u._averageFetchImageTimeArray}`),bt._onLog(`averageTime: ${u._averageTime}`))),bt._onLog){const b=Date.now()-y;b>10&&bt._onLog(`fetch image calculate time: ${b}`)}bt._onLog&&bt._onLog(`time finish decode: ${Date.now()}`),bt._onLog&&bt._onLog("main time: "+(Date.now()-g)),bt._onLog&&bt._onLog("===================================================="),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=u._minImageCaptureInterval>0&&u._minImageCaptureInterval>=u._averageTime?setTimeout(()=>{u._loopReadVideo(l)},u._minImageCaptureInterval-u._averageTime):setTimeout(()=>{u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,0))});return function(m){return p.apply(this,arguments)}}()).catch(p=>{u._isa.stopFetching(),u._loopReadVideoTimeoutId&&clearTimeout(u._loopReadVideoTimeoutId),u._loopReadVideoTimeoutId=setTimeout(()=>{u._isa.startFetching(),u._loopReadVideo(l)},Math.max(u._minImageCaptureInterval,1e3)),"platform error"!==p.message&&setTimeout(()=>{throw p},0)})})()}_reRunCurrnetFunc(l){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(l)},0)}capture(l,u){var g=this;return re(function*(){var p,m;g._checkIsDisposed(),u||(u=g._currentSettings.CaptureVisionTemplates[0].Name);const v=yield g.containsTask(u);let y;if(yield mi(v),v.includes("dlr")&&!(null===(p=Qt.dlr)||void 0===p?void 0:p.bLoadConfusableCharsData)&&(yield null===(m=Qt.dlr)||void 0===m?void 0:m.loadRecognitionData("ConfusableChars",Ae.dlr)),g._dynamsoft=!1,hI(l))y=yield g._captureDsimage(l,u);else if("string"==typeof l)y="data:image/"==l.substring(0,11)?yield g._captureBase64(l,u):yield g._captureUrl(l,u);else if(l instanceof Blob)y=yield g._captureBlob(l,u);else if(l instanceof HTMLImageElement)y=yield g._captureImage(l,u);else if(l instanceof HTMLCanvasElement)y=yield g._captureCanvas(l,u);else{if(!(l instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");y=yield g._captureVideo(l,u)}return y})()}_captureDsimage(l,u){var g=this;return re(function*(){return yield g._captureInWorker(l,u)})()}_captureUrl(l,u){var g=this;return re(function*(){let p=yield Km(l,"blob");return yield g._captureBlob(p,u)})()}_captureBase64(l,u){var g=this;return re(function*(){l=l.substring(l.indexOf(",")+1);let p=atob(l),m=p.length,v=new Uint8Array(m);for(;m--;)v[m]=p.charCodeAt(m);return yield g._captureBlob(new Blob([v]),u)})()}_captureBlob(l,u){var g=this;return re(function*(){let p=null,m=null;if("undefined"!=typeof createImageBitmap)try{p=yield createImageBitmap(l)}catch(y){}var y;p||(m=yield(y=re(function*(b){return yield new Promise((A,L)=>{let N=URL.createObjectURL(b),k=new Image;k.src=N,k.onload=()=>{URL.revokeObjectURL(k.dbrObjUrl),A(k)},k.onerror=j=>{L(new Error("Can't convert blob to image : "+(j instanceof Event?j.type:j)))}})}),function(b){return y.apply(this,arguments)})(l));let v=yield g._captureImage(p||m,u);return p&&p.close(),v})()}_captureImage(l,u){var g=this;return re(function*(){let p,m,v=l instanceof HTMLImageElement?l.naturalWidth:l.width,y=l instanceof HTMLImageElement?l.naturalHeight:l.height,b=Math.max(v,y);b>g.maxCvsSideLength?(g._compressRate=g.maxCvsSideLength/b,p=Math.round(v*g._compressRate),m=Math.round(y*g._compressRate)):(p=v,m=y),g._canvas||(g._canvas=document.createElement("canvas"));const A=g._canvas;return A.width===p&&A.height===m||(A.width=p,A.height=m),A.ctx2d||(A.ctx2d=A.getContext("2d",{willReadFrequently:!0})),A.ctx2d.drawImage(l,0,0,v,y,0,0,p,m),l.dbrObjUrl&&URL.revokeObjectURL(l.dbrObjUrl),yield g._captureCanvas(A,u)})()}_captureCanvas(l,u){var g=this;return re(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";if([l.width,l.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const p=l.ctx2d||l.getContext("2d",{willReadFrequently:!0}),m={bytes:Uint8Array.from(p.getImageData(0,0,l.width,l.height).data),width:l.width,height:l.height,stride:4*l.width,format:10};return yield g._captureInWorker(m,u)})()}_captureVideo(l,u){var g=this;return re(function*(){if(l.crossOrigin&&"anonymous"!=l.crossOrigin)throw"cors";let p,m,v=l.videoWidth,y=l.videoHeight,b=Math.max(v,y);b>g.maxCvsSideLength?(g._compressRate=g.maxCvsSideLength/b,p=Math.round(v*g._compressRate),m=Math.round(y*g._compressRate)):(p=v,m=y),g._canvas||(g._canvas=document.createElement("canvas"));const A=g._canvas;return A.width===p&&A.height===m||(A.width=p,A.height=m),A.ctx2d||(A.ctx2d=A.getContext("2d",{willReadFrequently:!0})),A.ctx2d.drawImage(l,0,0,v,y,0,0,p,m),yield g._captureCanvas(A,u)})()}_captureInWorker(l,u){var g=this;return re(function*(){const{bytes:p,width:m,height:v,stride:y,format:b}=l;let A=Et();const L=new Da;return it[A]=function(){var N=re(function*(k){var j,H;if(!k.success){let z=new Error(k.message);return z.stack=k.stack+"\n"+z.stack,L.reject(z)}{const z=Date.now();bt._onLog&&(bt._onLog(`get result time from worker: ${z}`),bt._onLog("worker to main time consume: "+(z-k.workerReturnMsgTime)));try{const $=k.captureResult;l.bytes=k.bytes;for(let X of $.items)0!==g._compressRate&&UI(X,g._compressRate),X.type===Yt.CRIT_ORIGINAL_IMAGE?X.imageData=l:X.type===Yt.CRIT_NORMALIZED_IMAGE?null===(j=Qt.ddn)||void 0===j||j.handleNormalizedImageResultItem(X):X.type===Yt.CRIT_PARSED_RESULT&&(null===(H=Qt.dcp)||void 0===H||H.handleParsedResultItem(X));if(g._dynamsoft)for(let X of g._resultFilterSet)X.onDecodedBarcodesReceived($.items),X.onRecognizedTextLinesReceived($.items),X.onDetectedQuadsReceived($.items),X.onNormalizedImagesReceived($.items);const q=function(X){const Q={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return X.items.forEach(pe=>{pe.type===Yt.CRIT_BARCODE?Q.barcodeResultItems.push(pe):pe.type===Yt.CRIT_TEXT_LINE?Q.textLineResultItems.push(pe):pe.type===Yt.CRIT_DETECTED_QUAD?Q.detectedQuadResultItems.push(pe):pe.type===Yt.CRIT_NORMALIZED_IMAGE?Q.normalizedImageResultItems.push(pe):pe.type===Yt.CRIT_PARSED_RESULT&&Q.parsedResultItems.push(pe)}),Q}($);if(q.barcodeResultItems.length&&($.barcodeResultItems=q.barcodeResultItems),q.textLineResultItems.length&&($.textLineResultItems=q.textLineResultItems),q.detectedQuadResultItems.length&&($.detectedQuadResultItems=q.detectedQuadResultItems),q.normalizedImageResultItems.length&&($.normalizedImageResultItems=q.normalizedImageResultItems),q.parsedResultItems.length&&($.parsedResultItems=q.parsedResultItems),!g._bPauseScan||!g._dynamsoft){const X=$.intermediateResult;if(X){let Q=0;for(let pe of g._intermediateResultReceiverSet){Q++;for(let _e of X){if("onTaskResultsReceived"===_e.info.callbackName){for(let Te of _e.intermediateResultUnits)Te.originalImageTag=l.tag?l.tag:null;pe[_e.info.callbackName]&&pe[_e.info.callbackName]({intermediateResultUnits:_e.intermediateResultUnits},_e.info)}else pe[_e.info.callbackName]&&pe[_e.info.callbackName](_e.result,_e.info);Q===g._intermediateResultReceiverSet.size&&delete _e.info.callbackName}}}$&&$.intermediateResult&&delete $.intermediateResult}return g._compressRate=0,L.resolve($)}catch($){return L.reject($)}}});return function(k){return N.apply(this,arguments)}}(),bt._onLog&&bt._onLog(`send buffer to worker: ${Date.now()}`),Ze.postMessage({type:"cvr_capture",id:A,instanceID:g._instanceID,body:{bytes:p,width:m,height:v,stride:y,format:b,templateName:u||"",dynamsoft:g._dynamsoft}},[p.buffer]),L})()}initSettings(l){var u=this;return re(function*(){return u._checkIsDisposed(),l&&["string","object"].includes(typeof l)?("string"==typeof l?l.startsWith("{")?u._currentSettings=JSON.parse(l):l=yield Km(l,"text"):"object"==typeof l&&(u._currentSettings=l,l=JSON.stringify(l)),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success){const b=JSON.parse(y.response);if(0!==b.exception){let N=new Error(b.description?b.description:"Init Settings Failed.");return N.errorCode=b.exception,p(N)}let A=[],L=JSON.parse(l).CaptureVisionTemplates;for(let N=0;N<L.length;N++){let k=yield u.containsTask(L[N].Name);A=A.concat(k)}return yield mi([...new Set(A)]),u._bNeedOutputOriginalImage=1===u._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,g(b)}{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid template.")})()}outputSettings(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success){const b=JSON.parse(y.settings);if(0!==b.errorCode){let A=new Error(b.errorString);return A.errorCode=b.errorCode,p(A)}return delete b.errorCode,delete b.errorString,g(b)}{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_outputSettings",id:m,instanceID:u._instanceID,body:{templateName:l||"*"}})})})()}outputSettingsToFile(l,u,g){var p=this;return re(function*(){const m=yield p.outputSettings(l),v=new Blob([JSON.stringify(m,null,2,function(y,b){return b instanceof Array?JSON.stringify(b):b},2)],{type:"application/json"});if(g){const y=document.createElement("a");y.href=URL.createObjectURL(v),u.endsWith(".json")&&(u=u.replace(".json","")),y.download=`${u}.json`,y.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(y.href)},500)},y.click()}return v})()}getSimplifiedSettings(l){var u=this;return re(function*(){u._checkIsDisposed(),l||(l=u._currentSettings.CaptureVisionTemplates[0].Name);const g=yield u.containsTask(l);return yield mi(g),yield new Promise((p,m)=>{let v=Et();it[v]=function(){var y=re(function*(b){if(b.success){const A=JSON.parse(b.settings,(L,N)=>Oj&&"barcodeFormatIds"===L?BigInt(N):N);if(A.minImageCaptureInterval=u._minImageCaptureInterval,0!==A.code){let L=new Error(A.codeString);return L.errorCode=A.errorCode,m(L)}return delete A.code,delete A.codeString,p(A)}{let A=new Error(b.message);return A.stack=b.stack+"\n"+A.stack,m(A)}});return function(b){return y.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_getSimplifiedSettings",id:v,instanceID:u._instanceID,body:{templateName:l}})})})()}updateSettings(l,u){var g=this;return re(function*(){g._checkIsDisposed();const p=yield g.containsTask(l);return yield mi(p),yield new Promise((m,v)=>{let y=Et();it[y]=function(){var b=re(function*(A){if(A.success){const L=JSON.parse(A.response);if(u.minImageCaptureInterval&&u.minImageCaptureInterval>=-1&&(g._minImageCaptureInterval=u.minImageCaptureInterval),g._bNeedOutputOriginalImage=A.bNeedOutputOriginalImage,0!==L.exception){let N=new Error(L.description?L.description:"Update Settings Failed.");return N.errorCode=L.exception,v(N)}return g._currentSettings=yield g.outputSettings("*"),m(L)}{let L=new Error(A.message);return L.stack=A.stack+"\n"+L.stack,v(L)}});return function(A){return b.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_updateSettings",id:y,instanceID:g._instanceID,body:{settings:u,templateName:l}})})})()}resetSettings(){var l=this;return re(function*(){return l._checkIsDisposed(),yield new Promise((u,g)=>{let p=Et();it[p]=function(){var m=re(function*(v){if(v.success){const y=JSON.parse(v.response);if(0!==y.exception){let b=new Error(y.description?y.description:"Reset Settings Failed.");return b.errorCode=y.exception,g(b)}return l._currentSettings=yield l.outputSettings("*"),u(y)}{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,g(y)}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_resetSettings",id:p,instanceID:l._instanceID})})})()}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new Vj(this)),this._bufferdItemsManager}getIntermediateResultManager(l){if(this._checkIsDisposed(),!l&&0!==Ft.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new Uj(this)),this._intermediateResultManager}contains(l,u){return function(g,p){let m=p.x,v=p.y,y=g[0].x,b=g[0].y,A=g[1].x,L=g[1].y,N=g[2].x,k=g[2].y,j=g[3].x,H=g[3].y,z=Q(m,v,y,b,A,L),$=Q(m,v,A,L,N,k),q=Q(m,v,N,k,j,H),X=Q(m,v,j,H,y,b);function Q(pe,_e,Te,Re,P,Ee){return(pe-Te)*(Ee-Re)-(_e-Re)*(P-Te)}return z>=0&&$>=0&&q>=0&&X>=0||z<=0&&$<=0&&q<=0&&X<=0}(l,u)}parseRequiredResources(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(JSON.parse(y.resources));{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_parseRequiredResources",id:m,instanceID:u._instanceID,body:{templateName:l}})})})()}dispose(){var l=this;return re(function*(){l._checkIsDisposed(),l._promiseStartScan&&l.stopCapturing(),l._isa=null,l._resultReceiverSet.clear(),l._isaStateListenerSet.clear(),l._resultFilterSet.clear(),l.bDestroyed=!0;let u=Et();it[u]=g=>{if(!g.success){let p=new Error(g.message);throw p.stack=g.stack+"\n"+p.stack,p}},Ze.postMessage({type:"cvr_dispose",id:u,instanceID:l._instanceID})})()}_enableResultCrossVerification(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(y.result);{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_enableResultCrossVerification",id:m,instanceID:u._instanceID,body:{verificationEnabled:l}})})})()}_enableResultDeduplication(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(y.result);{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_enableResultDeduplication",id:m,instanceID:u._instanceID,body:{duplicateFilterEnabled:l}})})})()}_setDuplicateForgetTime(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(y.result);{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_setDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{duplicateForgetTime:l}})})})()}_getDuplicateForgetTime(l){var u=this;return re(function*(){return u._checkIsDisposed(),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success)return g(y.time);{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"cvr_getDuplicateForgetTime",id:m,instanceID:u._instanceID,body:{type:l}})})})()}_setThresholdValue(l,u,g){var p=this;return re(function*(){return yield mi("ddn"),yield new Promise((m,v)=>{let y=Et();it[y]=function(){var b=re(function*(A){if(A.success)return m();{let L=new Error(A.message);return L.stack=A.stack+"\n"+L.stack,v(L)}});return function(A){return b.apply(this,arguments)}}(),Ze.postMessage({type:"ddn_setThresholdValue",id:y,instanceID:p._instanceID,body:{threshold:l,leftLimit:u,rightLimit:g}})})})()}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}const c_="undefined"==typeof self,Gj=(()=>{if(!c_&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})();function U(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function Fe(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}let vc,Qr,id,rd,Fn;null==Ae.dce&&(Ae.dce=Gj),ji.dce={wasm:!1,js:!1},Qt.dce={},"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(vc=navigator,Qr=vc.userAgent,id=vc.platform,rd=vc.mediaDevices),function(){if(!c_){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:vc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:id,search:"Win"},Mac:{str:id},Linux:{str:id}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let A=v.verStr||Qr,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||Qr).indexOf(v.search||m)){u=m;for(let N of L){let k=A.indexOf(N);if(-1!=k){g=parseFloat(A.substring(k+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Qr).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=Qr.indexOf("Windows NT")&&(p="HarmonyOS"),Fn={browser:u,version:g,OS:p}}c_&&(Fn={browser:"ssr",version:0,OS:"ssr"})}();const Hj="undefined"!=typeof WebAssembly&&Qr&&!(/Safari/.test(Qr)&&!/Chrome/.test(Qr)&&/\(.+\s11_2_([2-6]).*\)/.test(Qr)),Wj="undefined"!=typeof Worker,GI=!(!rd||!rd.getUserMedia),zj=function(){var f=re(function*(){let l=!1;if(GI)try{(yield rd.getUserMedia({video:!0})).getTracks().forEach(u=>{u.stop()}),l=!0}catch(u){}return l});return function(){return f.apply(this,arguments)}}();var Yj={653:(f,l,u)=>{var g,p,m,v,y,b,A,L,N,k,H,z,$,q,X,Q,pe,_e,Te,Re,S,w,D,T,P=P||{version:"5.2.1"};if(l.fabric=P,"undefined"!=typeof document&&"undefined"!=typeof window)P.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),P.window=window;else{var Ee=new(u(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;P.document=Ee.document,P.jsdomImplForWrapper=u(898).implForWrapper,P.nodeCanvas=u(245).Canvas,P.window=Ee,DOMParser=P.window.DOMParser}function Ve(S,w){var D=S.canvas,T=w.targetCanvas,_=T.getContext("2d");_.translate(0,T.height),_.scale(1,-1),_.drawImage(D,0,D.height-T.height,T.width,T.height,0,0,T.width,T.height)}function nt(S,w){var D=w.targetCanvas.getContext("2d"),T=w.destinationWidth,_=w.destinationHeight,C=T*_*4,I=new Uint8Array(this.imageBuffer,0,C),O=new Uint8ClampedArray(this.imageBuffer,0,C);S.readPixels(0,0,T,_,S.RGBA,S.UNSIGNED_BYTE,I);var x=new ImageData(O,T,_);D.putImageData(x,0,0)}P.isTouchSupported="ontouchstart"in P.window||"ontouchstart"in P.document||P.window&&P.window.navigator&&P.window.navigator.maxTouchPoints>0,P.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,P.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],P.DPI=96,P.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",P.commaWsp="(?:\\s+,?\\s*|,\\s*)",P.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,P.reNonWord=/[ \n\.,;!\?\-]/,P.fontPaths={},P.iMatrix=[1,0,0,1,0,0],P.svgNS="http://www.w3.org/2000/svg",P.perfLimitSizeTotal=2097152,P.maxCacheSideLimit=4096,P.minCacheSideLimit=256,P.charWidthsCache={},P.textureSize=2048,P.disableStyleCopyPaste=!1,P.enableGLFiltering=!0,P.devicePixelRatio=P.window.devicePixelRatio||P.window.webkitDevicePixelRatio||P.window.mozDevicePixelRatio||1,P.browserShadowBlurConstant=1,P.arcToSegmentsCache={},P.boundsOfCurveCache={},P.cachesBoundsOfCurve=!0,P.forceGLPutImageData=!1,P.initFilterBackend=function(){return P.enableGLFiltering&&P.isWebglSupported&&P.isWebglSupported(P.textureSize)?(console.log("max texture size: "+P.maxTextureSize),new P.WebglFilterBackend({tileSize:P.textureSize})):P.Canvas2dFilterBackend?new P.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=P),function(){function S(D,T){if(this.__eventListeners[D]){var _=this.__eventListeners[D];T?_[_.indexOf(T)]=!1:P.util.array.fill(_,!1)}}function w(D,T){var _=function(){T.apply(this,arguments),this.off(D,_)}.bind(this);this.on(D,_)}P.Observable={fire:function(D,T){if(!this.__eventListeners)return this;var _=this.__eventListeners[D];if(!_)return this;for(var C=0,I=_.length;C<I;C++)_[C]&&_[C].call(this,T||{});return this.__eventListeners[D]=_.filter(function(O){return!1!==O}),this},on:function(D,T){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var _ in D)this.on(_,D[_]);else this.__eventListeners[D]||(this.__eventListeners[D]=[]),this.__eventListeners[D].push(T);return this},once:function(D,T){if(1===arguments.length)for(var _ in D)w.call(this,_,D[_]);else w.call(this,D,T);return this},off:function(D,T){if(!this.__eventListeners)return this;if(0===arguments.length)for(D in this.__eventListeners)S.call(this,D);else if(1===arguments.length&&"object"==typeof arguments[0])for(var _ in D)S.call(this,_,D[_]);else S.call(this,D,T);return this}}}(),P.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var S=0,w=arguments.length;S<w;S++)this._onObjectAdded(arguments[S]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(S,w,D){var T=this._objects;return D?T[w]=S:T.splice(w,0,S),this._onObjectAdded&&this._onObjectAdded(S),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var S,w=this._objects,D=!1,T=0,_=arguments.length;T<_;T++)-1!==(S=w.indexOf(arguments[T]))&&(D=!0,w.splice(S,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[T]));return this.renderOnAddRemove&&D&&this.requestRenderAll(),this},forEachObject:function(S,w){for(var D=this.getObjects(),T=0,_=D.length;T<_;T++)S.call(w,D[T],T,D);return this},getObjects:function(S){return void 0===S?this._objects.concat():this._objects.filter(function(w){return w.type===S})},item:function(S){return this._objects[S]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(S,w){return this._objects.indexOf(S)>-1||!!w&&this._objects.some(function(D){return"function"==typeof D.contains&&D.contains(S,!0)})},complexity:function(){return this._objects.reduce(function(S,w){return S+(w.complexity?w.complexity():0)},0)}},P.CommonMethods={_setOptions:function(S){for(var w in S)this.set(w,S[w])},_initGradient:function(S,w){!S||!S.colorStops||S instanceof P.Gradient||this.set(w,new P.Gradient(S))},_initPattern:function(S,w,D){!S||!S.source||S instanceof P.Pattern?D&&D():this.set(w,new P.Pattern(S,D))},_setObject:function(S){for(var w in S)this._set(w,S[w])},set:function(S,w){return"object"==typeof S?this._setObject(S):this._set(S,w),this},_set:function(S,w){this[S]=w},toggle:function(S){var w=this.get(S);return"boolean"==typeof w&&this.set(S,!w),this},get:function(S){return this[S]}},g=l,p=Math.sqrt,m=Math.atan2,v=Math.pow,y=Math.PI/180,b=Math.PI/2,P.util={cos:function(S){if(0===S)return 1;switch(S<0&&(S=-S),S/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(S)},sin:function(S){if(0===S)return 0;var w=1;switch(S<0&&(w=-1),S/b){case 1:return w;case 2:return 0;case 3:return-w}return Math.sin(S)},removeFromArray:function(S,w){var D=S.indexOf(w);return-1!==D&&S.splice(D,1),S},getRandomInt:function(S,w){return Math.floor(Math.random()*(w-S+1))+S},degreesToRadians:function(S){return S*y},radiansToDegrees:function(S){return S/y},rotatePoint:function(S,w,D){var T=new P.Point(S.x-w.x,S.y-w.y),_=P.util.rotateVector(T,D);return new P.Point(_.x,_.y).addEquals(w)},rotateVector:function(S,w){var D=P.util.sin(w),T=P.util.cos(w);return{x:S.x*T-S.y*D,y:S.x*D+S.y*T}},createVector:function(S,w){return new P.Point(w.x-S.x,w.y-S.y)},calcAngleBetweenVectors:function(S,w){return Math.acos((S.x*w.x+S.y*w.y)/(Math.hypot(S.x,S.y)*Math.hypot(w.x,w.y)))},getHatVector:function(S){return new P.Point(S.x,S.y).multiply(1/Math.hypot(S.x,S.y))},getBisector:function(S,w,D){var T=P.util.createVector(S,w),_=P.util.createVector(S,D),C=P.util.calcAngleBetweenVectors(T,_),I=C*(0===P.util.calcAngleBetweenVectors(P.util.rotateVector(T,C),_)?1:-1)/2;return{vector:P.util.getHatVector(P.util.rotateVector(T,I)),angle:C}},projectStrokeOnPoints:function(S,w,D){var T=[],_=w.strokeWidth/2,C=w.strokeUniform?new P.Point(1/w.scaleX,1/w.scaleY):new P.Point(1,1),I=function(O){var x=_/Math.hypot(O.x,O.y);return new P.Point(O.x*x*C.x,O.y*x*C.y)};return S.length<=1||S.forEach(function(O,x){var M,F,B=new P.Point(O.x,O.y);0===x?(F=S[x+1],M=D?I(P.util.createVector(F,B)).addEquals(B):S[S.length-1]):x===S.length-1?(M=S[x-1],F=D?I(P.util.createVector(M,B)).addEquals(B):S[0]):(M=S[x-1],F=S[x+1]);var V,W,G=P.util.getBisector(B,M,F),Y=G.vector;if("miter"===w.strokeLineJoin&&(V=-_/Math.sin(G.angle/2),W=new P.Point(Y.x*V*C.x,Y.y*V*C.y),Math.hypot(W.x,W.y)/_<=w.strokeMiterLimit))return T.push(B.add(W)),void T.push(B.subtract(W));V=-_*Math.SQRT2,W=new P.Point(Y.x*V*C.x,Y.y*V*C.y),T.push(B.add(W)),T.push(B.subtract(W))}),T},transformPoint:function(S,w,D){return D?new P.Point(w[0]*S.x+w[2]*S.y,w[1]*S.x+w[3]*S.y):new P.Point(w[0]*S.x+w[2]*S.y+w[4],w[1]*S.x+w[3]*S.y+w[5])},makeBoundingBoxFromPoints:function(S,w){if(w)for(var D=0;D<S.length;D++)S[D]=P.util.transformPoint(S[D],w);var T=[S[0].x,S[1].x,S[2].x,S[3].x],_=P.util.array.min(T),C=P.util.array.max(T)-_,I=[S[0].y,S[1].y,S[2].y,S[3].y],O=P.util.array.min(I);return{left:_,top:O,width:C,height:P.util.array.max(I)-O}},invertTransform:function(S){var w=1/(S[0]*S[3]-S[1]*S[2]),D=[w*S[3],-w*S[1],-w*S[2],w*S[0]],T=P.util.transformPoint({x:S[4],y:S[5]},D,!0);return D[4]=-T.x,D[5]=-T.y,D},toFixed:function(S,w){return parseFloat(Number(S).toFixed(w))},parseUnit:function(S,w){var D=/\D{0,2}$/.exec(S),T=parseFloat(S);switch(w||(w=P.Text.DEFAULT_SVG_FONT_SIZE),D[0]){case"mm":return T*P.DPI/25.4;case"cm":return T*P.DPI/2.54;case"in":return T*P.DPI;case"pt":return T*P.DPI/72;case"pc":return T*P.DPI/72*12;case"em":return T*w;default:return T}},falseFunction:function(){return!1},getKlass:function(S,w){return S=P.util.string.camelize(S.charAt(0).toUpperCase()+S.slice(1)),P.util.resolveNamespace(w)[S]},getSvgAttributes:function(S){var w=["instantiated_by_use","style","id","class"];switch(S){case"linearGradient":w=w.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":w=w.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":w=w.concat(["offset","stop-color","stop-opacity"])}return w},resolveNamespace:function(S){if(!S)return P;var w,D=S.split("."),T=D.length,_=g||P.window;for(w=0;w<T;++w)_=_[D[w]];return _},loadImage:function(S,w,D,T){if(S){var _=P.util.createImage(),C=function(){w&&w.call(D,_,!1),_=_.onload=_.onerror=null};_.onload=C,_.onerror=function(){P.log("Error loading "+_.src),w&&w.call(D,null,!0),_=_.onload=_.onerror=null},0!==S.indexOf("data")&&null!=T&&(_.crossOrigin=T),"data:image/svg"===S.substring(0,14)&&(_.onload=null,P.util.loadImageInDom(_,C)),_.src=S}else w&&w.call(D,S)},loadImageInDom:function(S,w){var D=P.document.createElement("div");D.style.width=D.style.height="1px",D.style.left=D.style.top="-100%",D.style.position="absolute",D.appendChild(S),P.document.querySelector("body").appendChild(D),S.onload=function(){w(),D.parentNode.removeChild(D),D=null}},enlivenObjects:function(S,w,D,T){var _=[],C=0,I=(S=S||[]).length;function O(){++C===I&&w&&w(_.filter(function(x){return x}))}I?S.forEach(function(x,M){x&&x.type?P.util.getKlass(x.type,D).fromObject(x,function(F,B){B||(_[M]=F),T&&T(x,F,B),O()}):O()}):w&&w(_)},enlivenObjectEnlivables:function(S,w,D){var T=P.Object.ENLIVEN_PROPS.filter(function(_){return!!S[_]});P.util.enlivenObjects(T.map(function(_){return S[_]}),function(_){var C={};T.forEach(function(I,O){C[I]=_[O],w&&(w[I]=_[O])}),D&&D(C)})},enlivenPatterns:function(S,w){function D(){++_===C&&w&&w(T)}var T=[],_=0,C=(S=S||[]).length;C?S.forEach(function(I,O){I&&I.source?new P.Pattern(I,function(x){T[O]=x,D()}):(T[O]=I,D())}):w&&w(T)},groupSVGElements:function(S,w,D){var T;return S&&1===S.length?S[0]:(w&&(w.width&&w.height?w.centerPoint={x:w.width/2,y:w.height/2}:(delete w.width,delete w.height)),T=new P.Group(S,w),void 0!==D&&(T.sourcePath=D),T)},populateWithProperties:function(S,w,D){if(D&&Array.isArray(D))for(var T=0,_=D.length;T<_;T++)D[T]in S&&(w[D[T]]=S[D[T]])},createCanvasElement:function(){return P.document.createElement("canvas")},copyCanvasElement:function(S){var w=P.util.createCanvasElement();return w.width=S.width,w.height=S.height,w.getContext("2d").drawImage(S,0,0),w},toDataURL:function(S,w,D){return S.toDataURL("image/"+w,D)},createImage:function(){return P.document.createElement("img")},multiplyTransformMatrices:function(S,w,D){return[S[0]*w[0]+S[2]*w[1],S[1]*w[0]+S[3]*w[1],S[0]*w[2]+S[2]*w[3],S[1]*w[2]+S[3]*w[3],D?0:S[0]*w[4]+S[2]*w[5]+S[4],D?0:S[1]*w[4]+S[3]*w[5]+S[5]]},qrDecompose:function(S){var w=m(S[1],S[0]),D=v(S[0],2)+v(S[1],2),T=p(D),_=(S[0]*S[3]-S[2]*S[1])/T,C=m(S[0]*S[2]+S[1]*S[3],D);return{angle:w/y,scaleX:T,scaleY:_,skewX:C/y,skewY:0,translateX:S[4],translateY:S[5]}},calcRotateMatrix:function(S){if(!S.angle)return P.iMatrix.concat();var w=P.util.degreesToRadians(S.angle),D=P.util.cos(w),T=P.util.sin(w);return[D,T,-T,D,0,0]},calcDimensionsMatrix:function(S){var w=void 0===S.scaleX?1:S.scaleX,D=void 0===S.scaleY?1:S.scaleY,T=[S.flipX?-w:w,0,0,S.flipY?-D:D,0,0],_=P.util.multiplyTransformMatrices,C=P.util.degreesToRadians;return S.skewX&&(T=_(T,[1,0,Math.tan(C(S.skewX)),1],!0)),S.skewY&&(T=_(T,[1,Math.tan(C(S.skewY)),0,1],!0)),T},composeMatrix:function(S){var w=[1,0,0,1,S.translateX||0,S.translateY||0],D=P.util.multiplyTransformMatrices;return S.angle&&(w=D(w,P.util.calcRotateMatrix(S))),(1!==S.scaleX||1!==S.scaleY||S.skewX||S.skewY||S.flipX||S.flipY)&&(w=D(w,P.util.calcDimensionsMatrix(S))),w},resetObjectTransform:function(S){S.scaleX=1,S.scaleY=1,S.skewX=0,S.skewY=0,S.flipX=!1,S.flipY=!1,S.rotate(0)},saveObjectTransform:function(S){return{scaleX:S.scaleX,scaleY:S.scaleY,skewX:S.skewX,skewY:S.skewY,angle:S.angle,left:S.left,flipX:S.flipX,flipY:S.flipY,top:S.top}},isTransparent:function(S,w,D,T){T>0&&(w>T?w-=T:w=0,D>T?D-=T:D=0);var _,C=!0,I=S.getImageData(w,D,2*T||1,2*T||1),O=I.data.length;for(_=3;_<O&&0!=(C=I.data[_]<=0);_+=4);return I=null,C},parsePreserveAspectRatioAttribute:function(S){var w,D="meet",T=S.split(" ");return T&&T.length&&("meet"!==(D=T.pop())&&"slice"!==D?(w=D,D="meet"):T.length&&(w=T.pop())),{meetOrSlice:D,alignX:"none"!==w?w.slice(1,4):"none",alignY:"none"!==w?w.slice(5,8):"none"}},clearFabricFontCache:function(S){(S=(S||"").toLowerCase())?P.charWidthsCache[S]&&delete P.charWidthsCache[S]:P.charWidthsCache={}},limitDimsByArea:function(S,w){var D=Math.sqrt(w*S),T=Math.floor(w/D);return{x:Math.floor(D),y:T}},capValue:function(S,w,D){return Math.max(S,Math.min(w,D))},findScaleToFit:function(S,w){return Math.min(w.width/S.width,w.height/S.height)},findScaleToCover:function(S,w){return Math.max(w.width/S.width,w.height/S.height)},matrixToSVG:function(S){return"matrix("+S.map(function(w){return P.util.toFixed(w,P.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(S,w){var D=P.util.invertTransform(w),T=P.util.multiplyTransformMatrices(D,S.calcOwnMatrix());P.util.applyTransformToObject(S,T)},addTransformToObject:function(S,w){P.util.applyTransformToObject(S,P.util.multiplyTransformMatrices(w,S.calcOwnMatrix()))},applyTransformToObject:function(S,w){var D=P.util.qrDecompose(w),T=new P.Point(D.translateX,D.translateY);S.flipX=!1,S.flipY=!1,S.set("scaleX",D.scaleX),S.set("scaleY",D.scaleY),S.skewX=D.skewX,S.skewY=D.skewY,S.angle=D.angle,S.setPositionByOrigin(T,"center","center")},sizeAfterTransform:function(S,w,D){var T=S/2,_=w/2,C=[{x:-T,y:-_},{x:T,y:-_},{x:-T,y:_},{x:T,y:_}],I=P.util.calcDimensionsMatrix(D),O=P.util.makeBoundingBoxFromPoints(C,I);return{x:O.width,y:O.height}},mergeClipPaths:function(S,w){var D=S,T=w;D.inverted&&!T.inverted&&(D=w,T=S),P.util.applyTransformToObject(T,P.util.multiplyTransformMatrices(P.util.invertTransform(D.calcTransformMatrix()),T.calcTransformMatrix()));var _=D.inverted&&T.inverted;return _&&(D.inverted=T.inverted=!1),new P.Group([D],{clipPath:T,inverted:_})}},function(){var S=Array.prototype.join,w={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},D={m:"l",M:"L"};function T(W,G,Y,Z,ie,se,de,ce,le,ee,J){var oe=P.util.cos(W),he=P.util.sin(W),fe=P.util.cos(G),ne=P.util.sin(G),te=Y*ie*fe-Z*se*ne+de,ae=Z*ie*fe+Y*se*ne+ce;return["C",ee+le*(-Y*ie*he-Z*se*oe),J+le*(-Z*ie*he+Y*se*oe),te+le*(Y*ie*ne+Z*se*fe),ae+le*(Z*ie*ne-Y*se*fe),te,ae]}function _(W,G,Y,Z){var ie=Math.atan2(G,W),se=Math.atan2(Z,Y);return se>=ie?se-ie:2*Math.PI-(ie-se)}function C(W,G,Y){for(var le=function(oe,he,fe,ne,te,ae,ge){var ue=Math.PI,me=ge*ue/180,Ie=P.util.sin(me),be=P.util.cos(me),Ce=0,Se=0,De=-be*oe*.5-Ie*he*.5,xe=-be*he*.5+Ie*oe*.5,je=(fe=Math.abs(fe))*fe,Le=(ne=Math.abs(ne))*ne,ut=xe*xe,xt=De*De,Hi=je*Le-je*ut-Le*xt,fs=0;if(Hi<0){var Xa=Math.sqrt(1-Hi/(je*Le));fe*=Xa,ne*=Xa}else fs=(te===ae?-1:1)*Math.sqrt(Hi/(je*ut+Le*xt));var en=fs*fe*xe/ne,Wi=-fs*ne*De/fe,Xc=be*en-Ie*Wi+.5*oe,qa=Ie*en+be*Wi+.5*he,Io=_(1,0,(De-en)/fe,(xe-Wi)/ne),Za=_((De-en)/fe,(xe-Wi)/ne,(-De-en)/fe,(-xe-Wi)/ne);0===ae&&Za>0?Za-=2*ue:1===ae&&Za<0&&(Za+=2*ue);for(var BT=Math.ceil(Math.abs(Za/ue*2)),Hd=[],qc=Za/BT,NU=8/3*Math.sin(qc/4)*Math.sin(qc/4)/Math.sin(qc/2),lv=Io+qc,Zc=0;Zc<BT;Zc++)Hd[Zc]=T(Io,lv,be,Ie,fe,ne,Xc,qa,NU,Ce,Se),Ce=Hd[Zc][5],Se=Hd[Zc][6],Io=lv,lv+=qc;return Hd}(Y[6]-W,Y[7]-G,Y[1],Y[2],Y[4],Y[5],Y[3]),ee=0,J=le.length;ee<J;ee++)le[ee][1]+=W,le[ee][2]+=G,le[ee][3]+=W,le[ee][4]+=G,le[ee][5]+=W,le[ee][6]+=G;return le}function I(W,G,Y,Z){return Math.sqrt((Y-W)*(Y-W)+(Z-G)*(Z-G))}function O(W,G,Y,Z,ie,se,de,ce){return function(le){var ee,ne,J=(ee=le)*ee*ee,oe=3*(ne=le)*ne*(1-ne),he=function(ne){return 3*ne*(1-ne)*(1-ne)}(le),fe=function(ne){return(1-ne)*(1-ne)*(1-ne)}(le);return{x:de*J+ie*oe+Y*he+W*fe,y:ce*J+se*oe+Z*he+G*fe}}}function x(W,G,Y,Z,ie,se,de,ce){return function(le){var ee=1-le;return Math.atan2(3*ee*ee*(Z-G)+6*ee*le*(se-Z)+3*le*le*(ce-se),3*ee*ee*(Y-W)+6*ee*le*(ie-Y)+3*le*le*(de-ie))}}function M(W,G,Y,Z,ie,se){return function(de){var ce,oe,le=(ce=de)*ce,ee=2*(oe=de)*(1-oe),J=function(oe){return(1-oe)*(1-oe)}(de);return{x:ie*le+Y*ee+W*J,y:se*le+Z*ee+G*J}}}function F(W,G,Y,Z,ie,se){return function(de){var ce=1-de;return Math.atan2(2*ce*(Z-G)+2*de*(se-Z),2*ce*(Y-W)+2*de*(ie-Y))}}function B(W,G,Y){var Z,ie,se={x:G,y:Y},de=0;for(ie=1;ie<=100;ie+=1)Z=W(ie/100),de+=I(se.x,se.y,Z.x,Z.y),se=Z;return de}function V(W){for(var G,Y,Z,ie,se=0,de=W.length,ce=0,le=0,ee=0,J=0,oe=[],he=0;he<de;he++){switch(Z={x:ce,y:le,command:(G=W[he])[0]},G[0]){case"M":Z.length=0,ee=ce=G[1],J=le=G[2];break;case"L":Z.length=I(ce,le,G[1],G[2]),ce=G[1],le=G[2];break;case"C":Y=O(ce,le,G[1],G[2],G[3],G[4],G[5],G[6]),ie=x(ce,le,G[1],G[2],G[3],G[4],G[5],G[6]),Z.iterator=Y,Z.angleFinder=ie,Z.length=B(Y,ce,le),ce=G[5],le=G[6];break;case"Q":Y=M(ce,le,G[1],G[2],G[3],G[4]),ie=F(ce,le,G[1],G[2],G[3],G[4]),Z.iterator=Y,Z.angleFinder=ie,Z.length=B(Y,ce,le),ce=G[3],le=G[4];break;case"Z":case"z":Z.destX=ee,Z.destY=J,Z.length=I(ce,le,ee,J),ce=ee,le=J}se+=Z.length,oe.push(Z)}return oe.push({length:se,x:ce,y:le}),oe}P.util.joinPath=function(W){return W.map(function(G){return G.join(" ")}).join(" ")},P.util.parsePath=function(W){var G,Y,Z,ie,se,de=[],ce=[],le=P.rePathCommand,ee="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",J="("+ee+")"+P.commaWsp,oe="([01])"+P.commaWsp+"?",he=new RegExp(J+"?"+J+"?"+J+oe+oe+J+"?("+ee+")","g");if(!W||!W.match)return de;for(var fe,ne=0,te=(se=W.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;ne<te;ne++){ie=(G=se[ne]).slice(1).trim(),ce.length=0;var ae=G.charAt(0);if(fe=[ae],"a"===ae.toLowerCase())for(var ge;ge=he.exec(ie);)for(var ue=1;ue<ge.length;ue++)ce.push(ge[ue]);else for(;Z=le.exec(ie);)ce.push(Z[0]);ue=0;for(var me=ce.length;ue<me;ue++)Y=parseFloat(ce[ue]),isNaN(Y)||fe.push(Y);var Ie=w[ae.toLowerCase()],be=D[ae]||ae;if(fe.length-1>Ie)for(var Ce=1,Se=fe.length;Ce<Se;Ce+=Ie)de.push([ae].concat(fe.slice(Ce,Ce+Ie))),ae=be;else de.push(fe)}return de},P.util.makePathSimpler=function(W){var G,Y,Z,ie,se,de,ce=0,le=0,ee=W.length,J=0,oe=0,he=[];for(Y=0;Y<ee;++Y){switch(Z=!1,(G=W[Y].slice(0))[0]){case"l":G[0]="L",G[1]+=ce,G[2]+=le;case"L":ce=G[1],le=G[2];break;case"h":G[1]+=ce;case"H":G[0]="L",G[2]=le,ce=G[1];break;case"v":G[1]+=le;case"V":G[0]="L",le=G[1],G[1]=ce,G[2]=le;break;case"m":G[0]="M",G[1]+=ce,G[2]+=le;case"M":ce=G[1],le=G[2],J=G[1],oe=G[2];break;case"c":G[0]="C",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le,G[5]+=ce,G[6]+=le;case"C":se=G[3],de=G[4],ce=G[5],le=G[6];break;case"s":G[0]="S",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le;case"S":"C"===ie?(se=2*ce-se,de=2*le-de):(se=ce,de=le),ce=G[3],le=G[4],G[0]="C",G[5]=G[3],G[6]=G[4],G[3]=G[1],G[4]=G[2],G[1]=se,G[2]=de,se=G[3],de=G[4];break;case"q":G[0]="Q",G[1]+=ce,G[2]+=le,G[3]+=ce,G[4]+=le;case"Q":se=G[1],de=G[2],ce=G[3],le=G[4];break;case"t":G[0]="T",G[1]+=ce,G[2]+=le;case"T":"Q"===ie?(se=2*ce-se,de=2*le-de):(se=ce,de=le),G[0]="Q",ce=G[1],le=G[2],G[1]=se,G[2]=de,G[3]=ce,G[4]=le;break;case"a":G[0]="A",G[6]+=ce,G[7]+=le;case"A":Z=!0,he=he.concat(C(ce,le,G)),ce=G[6],le=G[7];break;case"z":case"Z":ce=J,le=oe}Z||he.push(G),ie=G[0]}return he},P.util.getSmoothPathFromPoints=function(W,G){var Y,Z=[],ie=new P.Point(W[0].x,W[0].y),se=new P.Point(W[1].x,W[1].y),de=W.length,ce=1,le=0,ee=de>2;for(ee&&(ce=W[2].x<se.x?-1:W[2].x===se.x?0:1,le=W[2].y<se.y?-1:W[2].y===se.y?0:1),Z.push(["M",ie.x-ce*(G=G||0),ie.y-le*G]),Y=1;Y<de;Y++){if(!ie.eq(se)){var J=ie.midPointFrom(se);Z.push(["Q",ie.x,ie.y,J.x,J.y])}ie=W[Y],Y+1<W.length&&(se=W[Y+1])}return ee&&(ce=ie.x>W[Y-2].x?1:ie.x===W[Y-2].x?0:-1,le=ie.y>W[Y-2].y?1:ie.y===W[Y-2].y?0:-1),Z.push(["L",ie.x+ce*G,ie.y+le*G]),Z},P.util.getPathSegmentsInfo=V,P.util.getBoundsOfCurve=function(W,G,Y,Z,ie,se,de,ce){var le;if(P.cachesBoundsOfCurve&&(le=S.call(arguments),P.boundsOfCurveCache[le]))return P.boundsOfCurveCache[le];var ee,J,oe,he,fe,ne,te,ae,ge=Math.sqrt,ue=Math.min,me=Math.max,Ie=Math.abs,be=[],Ce=[[],[]];J=6*W-12*Y+6*ie,ee=-3*W+9*Y-9*ie+3*de,oe=3*Y-3*W;for(var Se=0;Se<2;++Se)if(Se>0&&(J=6*G-12*Z+6*se,ee=-3*G+9*Z-9*se+3*ce,oe=3*Z-3*G),Ie(ee)<1e-12){if(Ie(J)<1e-12)continue;0<(he=-oe/J)&&he<1&&be.push(he)}else(te=J*J-4*oe*ee)<0||(0<(fe=(-J+(ae=ge(te)))/(2*ee))&&fe<1&&be.push(fe),0<(ne=(-J-ae)/(2*ee))&&ne<1&&be.push(ne));for(var De,je,Le=be.length,ut=Le;Le--;)De=(je=1-(he=be[Le]))*je*je*W+3*je*je*he*Y+3*je*he*he*ie+he*he*he*de,Ce[0][Le]=De,Ce[1][Le]=je*je*je*G+3*je*je*he*Z+3*je*he*he*se+he*he*he*ce;Ce[0][ut]=W,Ce[1][ut]=G,Ce[0][ut+1]=de,Ce[1][ut+1]=ce;var xt=[{x:ue.apply(null,Ce[0]),y:ue.apply(null,Ce[1])},{x:me.apply(null,Ce[0]),y:me.apply(null,Ce[1])}];return P.cachesBoundsOfCurve&&(P.boundsOfCurveCache[le]=xt),xt},P.util.getPointOnPath=function(W,G,Y){Y||(Y=V(W));for(var Z=0;G-Y[Z].length>0&&Z<Y.length-2;)G-=Y[Z].length,Z++;var ie,se=Y[Z],de=G/se.length,le=W[Z];switch(se.command){case"M":return{x:se.x,y:se.y,angle:0};case"Z":case"z":return(ie=new P.Point(se.x,se.y).lerp(new P.Point(se.destX,se.destY),de)).angle=Math.atan2(se.destY-se.y,se.destX-se.x),ie;case"L":return(ie=new P.Point(se.x,se.y).lerp(new P.Point(le[1],le[2]),de)).angle=Math.atan2(le[2]-se.y,le[1]-se.x),ie;case"C":case"Q":return function(ee,J){for(var oe,he,fe,ne=0,te=0,ae=ee.iterator,ge={x:ee.x,y:ee.y},ue=.01,me=ee.angleFinder;te<J&&ue>1e-4;)oe=ae(ne),fe=ne,(he=I(ge.x,ge.y,oe.x,oe.y))+te>J?(ne-=ue,ue/=2):(ge=oe,ne+=ue,te+=he);return oe.angle=me(fe),oe}(se,G)}},P.util.transformPath=function(W,G,Y){return Y&&(G=P.util.multiplyTransformMatrices(G,[1,0,0,1,-Y.x,-Y.y])),W.map(function(Z){for(var ie=Z.slice(0),se={},de=1;de<Z.length-1;de+=2)se.x=Z[de],se.y=Z[de+1],se=P.util.transformPoint(se,G),ie[de]=se.x,ie[de+1]=se.y;return ie})}}(),function(){var S=Array.prototype.slice;function w(D,T,_){if(D&&0!==D.length){var C=D.length-1,I=T?D[C][T]:D[C];if(T)for(;C--;)_(D[C][T],I)&&(I=D[C][T]);else for(;C--;)_(D[C],I)&&(I=D[C]);return I}}P.util.array={fill:function(D,T){for(var _=D.length;_--;)D[_]=T;return D},invoke:function(D,T){for(var _=S.call(arguments,2),C=[],I=0,O=D.length;I<O;I++)C[I]=_.length?D[I][T].apply(D[I],_):D[I][T].call(D[I]);return C},min:function(D,T){return w(D,T,function(_,C){return _<C})},max:function(D,T){return w(D,T,function(_,C){return _>=C})}}}(),function(){function S(w,D,T){if(T)if(!P.isLikelyNode&&D instanceof Element)w=D;else if(D instanceof Array){w=[];for(var _=0,C=D.length;_<C;_++)w[_]=S({},D[_],T)}else if(D&&"object"==typeof D)for(var I in D)"canvas"===I||"group"===I?w[I]=null:D.hasOwnProperty(I)&&(w[I]=S({},D[I],T));else w=D;else for(var I in D)w[I]=D[I];return w}P.util.object={extend:S,clone:function(w,D){return S({},w,D)}},P.util.object.extend(P.util,P.Observable)}(),function(){function S(w,D){var T=w.charCodeAt(D);if(isNaN(T))return"";if(T<55296||T>57343)return w.charAt(D);if(55296<=T&&T<=56319){if(w.length<=D+1)throw"High surrogate without following low surrogate";var _=w.charCodeAt(D+1);if(56320>_||_>57343)throw"High surrogate without following low surrogate";return w.charAt(D)+w.charAt(D+1)}if(0===D)throw"Low surrogate without preceding high surrogate";var C=w.charCodeAt(D-1);if(55296>C||C>56319)throw"Low surrogate without preceding high surrogate";return!1}P.util.string={camelize:function(w){return w.replace(/-+(.)?/g,function(D,T){return T?T.toUpperCase():""})},capitalize:function(w,D){return w.charAt(0).toUpperCase()+(D?w.slice(1):w.slice(1).toLowerCase())},escapeXml:function(w){return w.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(w){var D,T=0,_=[];for(T=0;T<w.length;T++)!1!==(D=S(w,T))&&_.push(D);return _}}}(),function(){var S=Array.prototype.slice,w=function(){},D=function(){for(var I in{toString:1})if("toString"===I)return!1;return!0}(),T=function(I,O,x){for(var M in O)I.prototype[M]=M in I.prototype&&"function"==typeof I.prototype[M]&&(O[M]+"").indexOf("callSuper")>-1?function(F){return function(){var B=this.constructor.superclass;this.constructor.superclass=x;var V=O[F].apply(this,arguments);if(this.constructor.superclass=B,"initialize"!==F)return V}}(M):O[M],D&&(O.toString!==Object.prototype.toString&&(I.prototype.toString=O.toString),O.valueOf!==Object.prototype.valueOf&&(I.prototype.valueOf=O.valueOf))};function _(){}function C(I){for(var O=null,x=this;x.constructor.superclass;){var M=x.constructor.superclass.prototype[I];if(x[I]!==M){O=M;break}x=x.constructor.superclass.prototype}return O?arguments.length>1?O.apply(this,S.call(arguments,1)):O.call(this):console.log("tried to callSuper "+I+", method not found in prototype chain",this)}P.util.createClass=function(){var I=null,O=S.call(arguments,0);function x(){this.initialize.apply(this,arguments)}"function"==typeof O[0]&&(I=O.shift()),x.superclass=I,x.subclasses=[],I&&(_.prototype=I.prototype,x.prototype=new _,I.subclasses.push(x));for(var M=0,F=O.length;M<F;M++)T(x,O[M],I);return x.prototype.initialize||(x.prototype.initialize=w),x.prototype.constructor=x,x.prototype.callSuper=C,x}}(),A=!!P.document.createElement("div").attachEvent,L=["touchstart","touchmove","touchend"],P.util.addListener=function(S,w,D,T){S&&S.addEventListener(w,D,!A&&T)},P.util.removeListener=function(S,w,D,T){S&&S.removeEventListener(w,D,!A&&T)},P.util.getPointer=function(S){var _,C,D=P.util.getScrollLeftTop(S.target),T=(C=(_=S).changedTouches)&&C[0]?C[0]:_;return{x:T.clientX+D.left,y:T.clientY+D.top}},P.util.isTouchEvent=function(S){return L.indexOf(S.type)>-1||"touch"===S.pointerType},k="string"==typeof(N=P.document.createElement("div")).style.opacity,H=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,z=function(S){return S},k?z=function(S,w){return S.style.opacity=w,S}:"string"==typeof N.style.filter&&(z=function(S,w){var D=S.style;return S.currentStyle&&!S.currentStyle.hasLayout&&(D.zoom=1),H.test(D.filter)?D.filter=D.filter.replace(H,w=w>=.9999?"":"alpha(opacity="+100*w+")"):D.filter+=" alpha(opacity="+100*w+")",S}),P.util.setStyle=function(S,w){var D=S.style;if(!D)return S;if("string"==typeof w)return S.style.cssText+=";"+w,w.indexOf("opacity")>-1?z(S,w.match(/opacity:\s*(\d?\.?\d*)/)[1]):S;for(var T in w)"opacity"===T?z(S,w[T]):D["float"===T||"cssFloat"===T?void 0===D.styleFloat?"cssFloat":"styleFloat":T]=w[T];return S},function(){var S,w,D,T,_=Array.prototype.slice,C=function(x){return _.call(x,0)};try{S=C(P.document.childNodes)instanceof Array}catch(x){}function I(x,M){var F=P.document.createElement(x);for(var B in M)"class"===B?F.className=M[B]:"for"===B?F.htmlFor=M[B]:F.setAttribute(B,M[B]);return F}function O(x){for(var M=0,F=0,B=P.document.documentElement,V=P.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&((x=x.parentNode||x.host)===P.document?(M=V.scrollLeft||B.scrollLeft||0,F=V.scrollTop||B.scrollTop||0):(M+=x.scrollLeft||0,F+=x.scrollTop||0),1!==x.nodeType||"fixed"!==x.style.position););return{left:M,top:F}}S||(C=function(x){for(var M=new Array(x.length),F=x.length;F--;)M[F]=x[F];return M}),w=P.document.defaultView&&P.document.defaultView.getComputedStyle?function(x,M){var F=P.document.defaultView.getComputedStyle(x,null);return F?F[M]:void 0}:function(x,M){var F=x.style[M];return!F&&x.currentStyle&&(F=x.currentStyle[M]),F},T="userSelect"in(D=P.document.documentElement.style)?"userSelect":"MozUserSelect"in D?"MozUserSelect":"WebkitUserSelect"in D?"WebkitUserSelect":"KhtmlUserSelect"in D?"KhtmlUserSelect":"",P.util.makeElementUnselectable=function(x){return void 0!==x.onselectstart&&(x.onselectstart=P.util.falseFunction),T?x.style[T]="none":"string"==typeof x.unselectable&&(x.unselectable="on"),x},P.util.makeElementSelectable=function(x){return void 0!==x.onselectstart&&(x.onselectstart=null),T?x.style[T]="":"string"==typeof x.unselectable&&(x.unselectable=""),x},P.util.setImageSmoothing=function(x,M){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=M},P.util.getById=function(x){return"string"==typeof x?P.document.getElementById(x):x},P.util.toArray=C,P.util.addClass=function(x,M){x&&-1===(" "+x.className+" ").indexOf(" "+M+" ")&&(x.className+=(x.className?" ":"")+M)},P.util.makeElement=I,P.util.wrapElement=function(x,M,F){return"string"==typeof M&&(M=I(M,F)),x.parentNode&&x.parentNode.replaceChild(M,x),M.appendChild(x),M},P.util.getScrollLeftTop=O,P.util.getElementOffset=function(x){var M,F,B=x&&x.ownerDocument,V={left:0,top:0},W={left:0,top:0},G={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!B)return W;for(var Y in G)W[G[Y]]+=parseInt(w(x,Y),10)||0;return M=B.documentElement,void 0!==x.getBoundingClientRect&&(V=x.getBoundingClientRect()),F=O(x),{left:V.left+F.left-(M.clientLeft||0)+W.left,top:V.top+F.top-(M.clientTop||0)+W.top}},P.util.getNodeCanvas=function(x){var M=P.jsdomImplForWrapper(x);return M._canvas||M._image},P.util.cleanUpJsdomNode=function(x){if(P.isLikelyNode){var M=P.jsdomImplForWrapper(x);M&&(M._image=null,M._canvas=null,M._currentSrc=null,M._attributes=null,M._classList=null)}}}(),function(){function S(){}P.util.request=function(w,D){D||(D={});var O,x,T=D.method?D.method.toUpperCase():"GET",_=D.onComplete||function(){},C=new P.window.XMLHttpRequest,I=D.body||D.parameters;return C.onreadystatechange=function(){4===C.readyState&&(_(C),C.onreadystatechange=S)},"GET"===T&&(I=null,"string"==typeof D.parameters&&(x=D.parameters,w=(O=w)+(/\?/.test(O)?"&":"?")+x)),C.open(T,w,!0),"POST"!==T&&"PUT"!==T||C.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),C.send(I),C}}(),P.log=console.log,P.warn=console.warn,function(){var S=P.util.object.extend,w=P.util.object.clone,D=[];function T(){return!1}function _(x,M,F,B){return-F*Math.cos(x/B*(Math.PI/2))+F+M}P.util.object.extend(D,{cancelAll:function(){var x=this.splice(0);return x.forEach(function(M){M.cancel()}),x},cancelByCanvas:function(x){if(!x)return[];var M=this.filter(function(F){return"object"==typeof F.target&&F.target.canvas===x});return M.forEach(function(F){F.cancel()}),M},cancelByTarget:function(x){var M=this.findAnimationsByTarget(x);return M.forEach(function(F){F.cancel()}),M},findAnimationIndex:function(x){return this.indexOf(this.findAnimation(x))},findAnimation:function(x){return this.find(function(M){return M.cancel===x})},findAnimationsByTarget:function(x){return x?this.filter(function(M){return M.target===x}):[]}});var C=P.window.requestAnimationFrame||P.window.webkitRequestAnimationFrame||P.window.mozRequestAnimationFrame||P.window.oRequestAnimationFrame||P.window.msRequestAnimationFrame||function(x){return P.window.setTimeout(x,1e3/60)},I=P.window.cancelAnimationFrame||P.window.clearTimeout;function O(){return C.apply(P.window,arguments)}P.util.animate=function(x){x||(x={});var M,F=!1,B=function(){var V=P.runningAnimations.indexOf(M);return V>-1&&P.runningAnimations.splice(V,1)[0]};return M=S(w(x),{cancel:function(){return F=!0,B()},currentValue:"startValue"in x?x.startValue:0,completionRate:0,durationRate:0}),P.runningAnimations.push(M),O(function(V){var W,G=V||+new Date,Y=x.duration||500,Z=G+Y,ie=x.onChange||T,se=x.abort||T,de=x.onComplete||T,ce=x.easing||_,le="startValue"in x&&x.startValue.length>0,ee="startValue"in x?x.startValue:0,J="endValue"in x?x.endValue:100,oe=x.byValue||(le?ee.map(function(he,fe){return J[fe]-ee[fe]}):J-ee);x.onStart&&x.onStart(),function he(fe){var ne=(W=fe||+new Date)>Z?Y:W-G,te=ne/Y,ae=le?ee.map(function(ue,me){return ce(ne,ee[me],oe[me],Y)}):ce(ne,ee,oe,Y),ge=Math.abs(le?(ae[0]-ee[0])/oe[0]:(ae-ee)/oe);if(M.currentValue=le?ae.slice():ae,M.completionRate=ge,M.durationRate=te,!F){if(!se(ae,ge,te))return W>Z?(M.currentValue=le?J.slice():J,M.completionRate=1,M.durationRate=1,ie(le?J.slice():J,1,1),de(J,1,1),void B()):(ie(ae,ge,te),void O(he));B()}}(G)}),M.cancel},P.util.requestAnimFrame=O,P.util.cancelAnimFrame=function(){return I.apply(P.window,arguments)},P.runningAnimations=D}(),function(){function S(w,D,T){var _="rgba("+parseInt(w[0]+T*(D[0]-w[0]),10)+","+parseInt(w[1]+T*(D[1]-w[1]),10)+","+parseInt(w[2]+T*(D[2]-w[2]),10);return(_+=","+(w&&D?parseFloat(w[3]+T*(D[3]-w[3])):1))+")"}P.util.animateColor=function(w,D,T,_){var C=new P.Color(w).getSource(),I=new P.Color(D).getSource(),O=_.onComplete,x=_.onChange;return P.util.animate(P.util.object.extend(_=_||{},{duration:T||500,startValue:C,endValue:I,byValue:I,easing:function(M,F,B,V){return S(F,B,_.colorEasing?_.colorEasing(M,V):1-Math.cos(M/V*(Math.PI/2)))},onComplete:function(M,F,B){if(O)return O(S(I,I,0),F,B)},onChange:function(M,F,B){if(x){if(Array.isArray(M))return x(S(M,M,0),F,B);x(M,F,B)}}}))}}(),function(){function S(_,C,I,O){return _<Math.abs(C)?(_=C,O=I/4):O=0===C&&0===_?I/(2*Math.PI)*Math.asin(1):I/(2*Math.PI)*Math.asin(C/_),{a:_,c:C,p:I,s:O}}function w(_,C,I){return _.a*Math.pow(2,10*(C-=1))*Math.sin((C*I-_.s)*(2*Math.PI)/_.p)}function D(_,C,I,O){return I-T(O-_,0,I,O)+C}function T(_,C,I,O){return(_/=O)<1/2.75?I*(7.5625*_*_)+C:_<2/2.75?I*(7.5625*(_-=1.5/2.75)*_+.75)+C:_<2.5/2.75?I*(7.5625*(_-=2.25/2.75)*_+.9375)+C:I*(7.5625*(_-=2.625/2.75)*_+.984375)+C}P.util.ease={easeInQuad:function(_,C,I,O){return I*(_/=O)*_+C},easeOutQuad:function(_,C,I,O){return-I*(_/=O)*(_-2)+C},easeInOutQuad:function(_,C,I,O){return(_/=O/2)<1?I/2*_*_+C:-I/2*(--_*(_-2)-1)+C},easeInCubic:function(_,C,I,O){return I*(_/=O)*_*_+C},easeOutCubic:function(_,C,I,O){return I*((_=_/O-1)*_*_+1)+C},easeInOutCubic:function(_,C,I,O){return(_/=O/2)<1?I/2*_*_*_+C:I/2*((_-=2)*_*_+2)+C},easeInQuart:function(_,C,I,O){return I*(_/=O)*_*_*_+C},easeOutQuart:function(_,C,I,O){return-I*((_=_/O-1)*_*_*_-1)+C},easeInOutQuart:function(_,C,I,O){return(_/=O/2)<1?I/2*_*_*_*_+C:-I/2*((_-=2)*_*_*_-2)+C},easeInQuint:function(_,C,I,O){return I*(_/=O)*_*_*_*_+C},easeOutQuint:function(_,C,I,O){return I*((_=_/O-1)*_*_*_*_+1)+C},easeInOutQuint:function(_,C,I,O){return(_/=O/2)<1?I/2*_*_*_*_*_+C:I/2*((_-=2)*_*_*_*_+2)+C},easeInSine:function(_,C,I,O){return-I*Math.cos(_/O*(Math.PI/2))+I+C},easeOutSine:function(_,C,I,O){return I*Math.sin(_/O*(Math.PI/2))+C},easeInOutSine:function(_,C,I,O){return-I/2*(Math.cos(Math.PI*_/O)-1)+C},easeInExpo:function(_,C,I,O){return 0===_?C:I*Math.pow(2,10*(_/O-1))+C},easeOutExpo:function(_,C,I,O){return _===O?C+I:I*(1-Math.pow(2,-10*_/O))+C},easeInOutExpo:function(_,C,I,O){return 0===_?C:_===O?C+I:(_/=O/2)<1?I/2*Math.pow(2,10*(_-1))+C:I/2*(2-Math.pow(2,-10*--_))+C},easeInCirc:function(_,C,I,O){return-I*(Math.sqrt(1-(_/=O)*_)-1)+C},easeOutCirc:function(_,C,I,O){return I*Math.sqrt(1-(_=_/O-1)*_)+C},easeInOutCirc:function(_,C,I,O){return(_/=O/2)<1?-I/2*(Math.sqrt(1-_*_)-1)+C:I/2*(Math.sqrt(1-(_-=2)*_)+1)+C},easeInElastic:function(_,C,I,O){var x=0;return 0===_?C:1==(_/=O)?C+I:(x||(x=.3*O),-w(S(I,I,x,1.70158),_,O)+C)},easeOutElastic:function(_,C,I,O){var x=0;if(0===_)return C;if(1==(_/=O))return C+I;x||(x=.3*O);var M=S(I,I,x,1.70158);return M.a*Math.pow(2,-10*_)*Math.sin((_*O-M.s)*(2*Math.PI)/M.p)+M.c+C},easeInOutElastic:function(_,C,I,O){var x=0;if(0===_)return C;if(2==(_/=O/2))return C+I;x||(x=O*(.3*1.5));var M=S(I,I,x,1.70158);return _<1?-.5*w(M,_,O)+C:M.a*Math.pow(2,-10*(_-=1))*Math.sin((_*O-M.s)*(2*Math.PI)/M.p)*.5+M.c+C},easeInBack:function(_,C,I,O,x){return void 0===x&&(x=1.70158),I*(_/=O)*_*((x+1)*_-x)+C},easeOutBack:function(_,C,I,O,x){return void 0===x&&(x=1.70158),I*((_=_/O-1)*_*((x+1)*_+x)+1)+C},easeInOutBack:function(_,C,I,O,x){return void 0===x&&(x=1.70158),(_/=O/2)<1?I/2*(_*_*((1+(x*=1.525))*_-x))+C:I/2*((_-=2)*_*((1+(x*=1.525))*_+x)+2)+C},easeInBounce:D,easeOutBounce:T,easeInOutBounce:function(_,C,I,O){return _<O/2?.5*D(2*_,0,I,O)+C:.5*T(2*_-O,0,I,O)+.5*I+C}}}(),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.util.object.clone,_=w.util.toFixed,C=w.util.parseUnit,I=w.util.multiplyTransformMatrices,O={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},x={stroke:"strokeOpacity",fill:"fillOpacity"},M="font-size",F="clip-path";function B(ee){return ee in O?O[ee]:ee}function V(ee,J,oe,he){var fe,ne=Array.isArray(J);if("fill"!==ee&&"stroke"!==ee||"none"!==J){if("strokeUniform"===ee)return"non-scaling-stroke"===J;if("strokeDashArray"===ee)J="none"===J?null:J.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===ee)J=oe&&oe.transformMatrix?I(oe.transformMatrix,w.parseTransformAttribute(J)):w.parseTransformAttribute(J);else if("visible"===ee)J="none"!==J&&"hidden"!==J,oe&&!1===oe.visible&&(J=!1);else if("opacity"===ee)J=parseFloat(J),oe&&void 0!==oe.opacity&&(J*=oe.opacity);else if("textAnchor"===ee)J="start"===J?"left":"end"===J?"right":"center";else if("charSpacing"===ee)fe=C(J,he)/he*1e3;else if("paintFirst"===ee){var te=J.indexOf("fill"),ae=J.indexOf("stroke");J="fill",(te>-1&&ae>-1&&ae<te||-1===te&&ae>-1)&&(J="stroke")}else{if("href"===ee||"xlink:href"===ee||"font"===ee)return J;if("imageSmoothing"===ee)return"optimizeQuality"===J;fe=ne?J.map(C):C(J,he)}}else J="";return!ne&&isNaN(fe)?J:fe}function W(ee){return new RegExp("^("+ee.join("|")+")\\b","i")}function G(ee,J){var he,fe,ne,te=[];for(fe=0,ne=J.length;fe<ne;fe++)he=ee.getElementsByTagName(J[fe]),te=te.concat(Array.prototype.slice.call(he));return te}function Y(ee,J){var oe,he=!0;return(oe=Z(ee,J.pop()))&&J.length&&(he=function(fe,ne){for(var te,ae=!0;fe.parentNode&&1===fe.parentNode.nodeType&&ne.length;)ae&&(te=ne.pop()),ae=Z(fe=fe.parentNode,te);return 0===ne.length}(ee,J)),oe&&he&&0===J.length}function Z(ee,J){var oe,he,fe=ee.nodeName,ne=ee.getAttribute("class"),te=ee.getAttribute("id");if(oe=new RegExp("^"+fe,"i"),J=J.replace(oe,""),te&&J.length&&(oe=new RegExp("#"+te+"(?![a-zA-Z\\-]+)","i"),J=J.replace(oe,"")),ne&&J.length)for(he=(ne=ne.split(" ")).length;he--;)oe=new RegExp("\\."+ne[he]+"(?![a-zA-Z\\-]+)","i"),J=J.replace(oe,"");return 0===J.length}function ie(ee,J){var oe;if(ee.getElementById&&(oe=ee.getElementById(J)),oe)return oe;var he,fe,ne,te=ee.getElementsByTagName("*");for(fe=0,ne=te.length;fe<ne;fe++)if(J===(he=te[fe]).getAttribute("id"))return he}w.svgValidTagNamesRegEx=W(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),w.svgViewBoxElementsRegEx=W(["symbol","image","marker","pattern","view","svg"]),w.svgInvalidAncestorsRegEx=W(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),w.svgValidParentsRegEx=W(["symbol","g","a","svg","clipPath","defs"]),w.cssRules={},w.gradientDefs={},w.clipPaths={},w.parseTransformAttribute=function(){function ee(ae,ge,ue){ae[ue]=Math.tan(w.util.degreesToRadians(ge[0]))}var J=w.iMatrix,oe=w.reNum,he=w.commaWsp,fe="(?:(?:(matrix)\\s*\\(\\s*("+oe+")"+he+"("+oe+")"+he+"("+oe+")"+he+"("+oe+")"+he+"("+oe+")"+he+"("+oe+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+oe+")(?:"+he+"("+oe+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+oe+")(?:"+he+"("+oe+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+oe+")(?:"+he+"("+oe+")"+he+"("+oe+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+oe+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+oe+")\\s*\\)))",ne=new RegExp("^\\s*(?:(?:"+fe+"(?:"+he+"*"+fe+")*)?)\\s*$"),te=new RegExp(fe,"g");return function(ae){var ge=J.concat(),ue=[];if(!ae||ae&&!ne.test(ae))return ge;ae.replace(te,function(Ie){var De,xe,be=new RegExp(fe).exec(Ie).filter(function(De){return!!De}),Ce=be[1],Se=be.slice(2).map(parseFloat);switch(Ce){case"translate":(De=ge)[4]=(xe=Se)[0],2===xe.length&&(De[5]=xe[1]);break;case"rotate":Se[0]=w.util.degreesToRadians(Se[0]),function(De,xe){var je=w.util.cos(xe[0]),Le=w.util.sin(xe[0]),ut=0,xt=0;3===xe.length&&(ut=xe[1],xt=xe[2]),De[0]=je,De[1]=Le,De[2]=-Le,De[3]=je,De[4]=ut-(je*ut-Le*xt),De[5]=xt-(Le*ut+je*xt)}(ge,Se);break;case"scale":!function(De,xe){var Le=2===xe.length?xe[1]:xe[0];De[0]=xe[0],De[3]=Le}(ge,Se);break;case"skewX":ee(ge,Se,2);break;case"skewY":ee(ge,Se,1);break;case"matrix":ge=Se}ue.push(ge.concat()),ge=J.concat()});for(var me=ue[0];ue.length>1;)ue.shift(),me=w.util.multiplyTransformMatrices(me,ue[0]);return me}}();var se=new RegExp("^\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*,?\\s*("+w.reNum+"+)\\s*$");function de(ee){if(!w.svgViewBoxElementsRegEx.test(ee.nodeName))return{};var J,oe,he,fe,ne,te,ae=ee.getAttribute("viewBox"),ge=1,ue=1,me=ee.getAttribute("width"),Ie=ee.getAttribute("height"),be=ee.getAttribute("x")||0,Ce=ee.getAttribute("y")||0,Se=ee.getAttribute("preserveAspectRatio")||"",De=!ae||!(ae=ae.match(se)),xe=!me||!Ie||"100%"===me||"100%"===Ie,je=De&&xe,Le={},ut="",xt=0,Hi=0;if(Le.width=0,Le.height=0,Le.toBeParsed=je,De&&(be||Ce)&&ee.parentNode&&"#document"!==ee.parentNode.nodeName&&(ut=" translate("+C(be)+" "+C(Ce)+") ",ne=(ee.getAttribute("transform")||"")+ut,ee.setAttribute("transform",ne),ee.removeAttribute("x"),ee.removeAttribute("y")),je)return Le;if(De)return Le.width=C(me),Le.height=C(Ie),Le;if(J=-parseFloat(ae[1]),oe=-parseFloat(ae[2]),he=parseFloat(ae[3]),fe=parseFloat(ae[4]),Le.minX=J,Le.minY=oe,Le.viewBoxWidth=he,Le.viewBoxHeight=fe,xe?(Le.width=he,Le.height=fe):(Le.width=C(me),Le.height=C(Ie),ge=Le.width/he,ue=Le.height/fe),"none"!==(Se=w.util.parsePreserveAspectRatioAttribute(Se)).alignX&&("meet"===Se.meetOrSlice&&(ue=ge=ge>ue?ue:ge),"slice"===Se.meetOrSlice&&(ue=ge=ge>ue?ge:ue),xt=Le.width-he*ge,Hi=Le.height-fe*ge,"Mid"===Se.alignX&&(xt/=2),"Mid"===Se.alignY&&(Hi/=2),"Min"===Se.alignX&&(xt=0),"Min"===Se.alignY&&(Hi=0)),1===ge&&1===ue&&0===J&&0===oe&&0===be&&0===Ce)return Le;if((be||Ce)&&"#document"!==ee.parentNode.nodeName&&(ut=" translate("+C(be)+" "+C(Ce)+") "),ne=ut+" matrix("+ge+" 0 0 "+ue+" "+(J*ge+xt)+" "+(oe*ue+Hi)+") ","svg"===ee.nodeName){for(te=ee.ownerDocument.createElementNS(w.svgNS,"g");ee.firstChild;)te.appendChild(ee.firstChild);ee.appendChild(te)}else(te=ee).removeAttribute("x"),te.removeAttribute("y"),ne=te.getAttribute("transform")+ne;return te.setAttribute("transform",ne),Le}function ce(ee,J){var oe="xlink:href",he=ie(ee,J.getAttribute(oe).slice(1));if(he&&he.getAttribute(oe)&&ce(ee,he),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(ne){he&&!J.hasAttribute(ne)&&he.hasAttribute(ne)&&J.setAttribute(ne,he.getAttribute(ne))}),!J.children.length)for(var fe=he.cloneNode(!0);fe.firstChild;)J.appendChild(fe.firstChild);J.removeAttribute(oe)}w.parseSVGDocument=function(ee,J,oe,he){if(ee){!function(be){for(var Ce=G(be,["use","svg:use"]),Se=0;Ce.length&&Se<Ce.length;){var De=Ce[Se],xe=De.getAttribute("xlink:href")||De.getAttribute("href");if(null===xe)return;var je,Le,ut,xt,Hi=xe.slice(1),fs=De.getAttribute("x")||0,Xa=De.getAttribute("y")||0,en=ie(be,Hi).cloneNode(!0),Wi=(en.getAttribute("transform")||"")+" translate("+fs+", "+Xa+")",Xc=Ce.length,qa=w.svgNS;if(de(en),/^svg$/i.test(en.nodeName)){var Io=en.ownerDocument.createElementNS(qa,"g");for(Le=0,xt=(ut=en.attributes).length;Le<xt;Le++)je=ut.item(Le),Io.setAttributeNS(qa,je.nodeName,je.nodeValue);for(;en.firstChild;)Io.appendChild(en.firstChild);en=Io}for(Le=0,xt=(ut=De.attributes).length;Le<xt;Le++)"x"!==(je=ut.item(Le)).nodeName&&"y"!==je.nodeName&&"xlink:href"!==je.nodeName&&"href"!==je.nodeName&&("transform"===je.nodeName?Wi=je.nodeValue+" "+Wi:en.setAttribute(je.nodeName,je.nodeValue));en.setAttribute("transform",Wi),en.setAttribute("instantiated_by_use","1"),en.removeAttribute("id"),De.parentNode.replaceChild(en,De),Ce.length===Xc&&Se++}}(ee);var fe,ne,te=w.Object.__uid++,ae=de(ee),ge=w.util.toArray(ee.getElementsByTagName("*"));if(ae.crossOrigin=he&&he.crossOrigin,ae.svgUid=te,0===ge.length&&w.isLikelyNode){var ue=[];for(fe=0,ne=(ge=ee.selectNodes('//*[name(.)!="svg"]')).length;fe<ne;fe++)ue[fe]=ge[fe];ge=ue}var me=ge.filter(function(be){return de(be),w.svgValidTagNamesRegEx.test(be.nodeName.replace("svg:",""))&&!function(Ce,Se){for(;Ce&&(Ce=Ce.parentNode);)if(Ce.nodeName&&Se.test(Ce.nodeName.replace("svg:",""))&&!Ce.getAttribute("instantiated_by_use"))return!0;return!1}(be,w.svgInvalidAncestorsRegEx)});if(!me||me&&!me.length)J&&J([],{});else{var Ie={};ge.filter(function(be){return"clipPath"===be.nodeName.replace("svg:","")}).forEach(function(be){var Ce=be.getAttribute("id");Ie[Ce]=w.util.toArray(be.getElementsByTagName("*")).filter(function(Se){return w.svgValidTagNamesRegEx.test(Se.nodeName.replace("svg:",""))})}),w.gradientDefs[te]=w.getGradientDefs(ee),w.cssRules[te]=w.getCSSRules(ee),w.clipPaths[te]=Ie,w.parseElements(me,function(be,Ce){J&&(J(be,ae,Ce,ge),delete w.gradientDefs[te],delete w.cssRules[te],delete w.clipPaths[te])},T(ae),oe,he)}}};var le=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+w.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+w.reNum+"))?\\s+(.*)");D(w,{parseFontDeclaration:function(ee,J){var oe=ee.match(le);if(oe){var he=oe[1],fe=oe[3],ne=oe[4],te=oe[5],ae=oe[6];he&&(J.fontStyle=he),fe&&(J.fontWeight=isNaN(parseFloat(fe))?fe:parseFloat(fe)),ne&&(J.fontSize=C(ne)),ae&&(J.fontFamily=ae),te&&(J.lineHeight="normal"===te?1:te)}},getGradientDefs:function(ee){var J,oe=G(ee,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),he=0,fe={};for(he=oe.length;he--;)(J=oe[he]).getAttribute("xlink:href")&&ce(ee,J),fe[J.getAttribute("id")]=J;return fe},parseAttributes:function(ee,J,oe){if(ee){var he,fe,ne,te={};void 0===oe&&(oe=ee.getAttribute("svgUid")),ee.parentNode&&w.svgValidParentsRegEx.test(ee.parentNode.nodeName)&&(te=w.parseAttributes(ee.parentNode,J,oe));var ae=J.reduce(function(Se,De){return(he=ee.getAttribute(De))&&(Se[De]=he),Se},{}),ge=D(function(Se,De){var xe={};for(var je in w.cssRules[De])if(Y(Se,je.split(" ")))for(var Le in w.cssRules[De][je])xe[Le]=w.cssRules[De][je][Le];return xe}(ee,oe),w.parseStyleAttribute(ee));ae=D(ae,ge),ge[F]&&ee.setAttribute(F,ge[F]),fe=ne=te.fontSize||w.Text.DEFAULT_SVG_FONT_SIZE,ae[M]&&(ae[M]=fe=C(ae[M],ne));var ue,me,Ie={};for(var be in ae)me=V(ue=B(be),ae[be],te,fe),Ie[ue]=me;Ie&&Ie.font&&w.parseFontDeclaration(Ie.font,Ie);var Ce=D(te,Ie);return w.svgValidParentsRegEx.test(ee.nodeName)?Ce:function(Se){for(var De in x)if(void 0!==Se[x[De]]&&""!==Se[De]){if(void 0===Se[De]){if(!w.Object.prototype[De])continue;Se[De]=w.Object.prototype[De]}if(0!==Se[De].indexOf("url(")){var xe=new w.Color(Se[De]);Se[De]=xe.setAlpha(_(xe.getAlpha()*Se[x[De]],2)).toRgba()}}return Se}(Ce)}},parseElements:function(ee,J,oe,he,fe){new w.ElementsParser(ee,J,oe,he,fe).parse()},parseStyleAttribute:function(ee){var fe,ne,te,J={},oe=ee.getAttribute("style");return oe&&("string"==typeof oe?(fe=J,oe.replace(/;\s*$/,"").split(";").forEach(function(ae){var ge=ae.split(":");ne=ge[0].trim().toLowerCase(),te=ge[1].trim(),fe[ne]=te})):function(he,fe){for(var ae in he)void 0!==he[ae]&&(fe[ae.toLowerCase()]=he[ae])}(oe,J)),J},parsePointsAttribute:function(ee){if(!ee)return null;var J,oe,he=[];for(J=0,oe=(ee=(ee=ee.replace(/,/g," ").trim()).split(/\s+/)).length;J<oe;J+=2)he.push({x:parseFloat(ee[J]),y:parseFloat(ee[J+1])});return he},getCSSRules:function(ee){var J,oe,he=ee.getElementsByTagName("style"),fe={};for(J=0,oe=he.length;J<oe;J++){var ne=he[J].textContent;""!==(ne=ne.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&ne.split("}").filter(function(te){return te.trim()}).forEach(function(te){var ae=te.split("{"),ge={},ue=ae[1].trim().split(";").filter(function(Ce){return Ce.trim()});for(J=0,oe=ue.length;J<oe;J++){var me=ue[J].split(":"),Ie=me[0].trim(),be=me[1].trim();ge[Ie]=be}(te=ae[0].trim()).split(",").forEach(function(Ce){""!==(Ce=Ce.replace(/^svg/i,"").trim())&&(fe[Ce]?w.util.object.extend(fe[Ce],ge):fe[Ce]=w.util.object.clone(ge))})})}return fe},loadSVGFromURL:function(ee,J,oe,he){ee=ee.replace(/^\n\s*/,"").trim(),new w.util.request(ee,{method:"get",onComplete:function(fe){var ne=fe.responseXML;if(!ne||!ne.documentElement)return J&&J(null),!1;w.parseSVGDocument(ne.documentElement,function(te,ae,ge,ue){J&&J(te,ae,ge,ue)},oe,he)}})},loadSVGFromString:function(ee,J,oe,he){var fe=(new w.window.DOMParser).parseFromString(ee.trim(),"text/xml");w.parseSVGDocument(fe.documentElement,function(ne,te,ae,ge){J(ne,te,ae,ge)},oe,he)}})}(l),P.ElementsParser=function(S,w,D,T,_,C){this.elements=S,this.callback=w,this.options=D,this.reviver=T,this.svgUid=D&&D.svgUid||0,this.parsingOptions=_,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=C},($=P.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},$.createObjects=function(){var S=this;this.elements.forEach(function(w,D){w.setAttribute("svgUid",S.svgUid),S.createObject(w,D)})},$.findTag=function(S){return P[P.util.string.capitalize(S.tagName.replace("svg:",""))]},$.createObject=function(S,w){var D=this.findTag(S);if(D&&D.fromElement)try{D.fromElement(S,this.createCallback(w,S),this.options)}catch(T){P.log(T)}else this.checkIfDone()},$.createCallback=function(S,w){var D=this;return function(T){var _;D.resolveGradient(T,w,"fill"),D.resolveGradient(T,w,"stroke"),T instanceof P.Image&&T._originalElement&&(_=T.parsePreserveAspectRatioAttribute(w)),T._removeTransformMatrix(_),D.resolveClipPath(T,w),D.reviver&&D.reviver(w,T),D.instances[S]=T,D.checkIfDone()}},$.extractPropertyDefinition=function(S,w,D){var T=S[w],_=this.regexUrl;if(_.test(T)){_.lastIndex=0;var C=_.exec(T)[1];return _.lastIndex=0,P[D][this.svgUid][C]}},$.resolveGradient=function(S,w,D){var T=this.extractPropertyDefinition(S,D,"gradientDefs");if(T){var _=w.getAttribute(D+"-opacity"),C=P.Gradient.fromElement(T,S,_,this.options);S.set(D,C)}},$.createClipPathCallback=function(S,w){return function(D){D._removeTransformMatrix(),D.fillRule=D.clipRule,w.push(D)}},$.resolveClipPath=function(S,w){var D,T,_,C,I=this.extractPropertyDefinition(S,"clipPath","clipPaths");if(I){_=[],T=P.util.invertTransform(S.calcTransformMatrix());for(var O=I[0].parentNode,x=w;x.parentNode&&x.getAttribute("clip-path")!==S.clipPath;)x=x.parentNode;x.parentNode.appendChild(O);for(var M=0;M<I.length;M++)this.findTag(D=I[M]).fromElement(D,this.createClipPathCallback(S,_),this.options);I=1===_.length?_[0]:new P.Group(_),C=P.util.multiplyTransformMatrices(T,I.calcTransformMatrix()),I.clipPath&&this.resolveClipPath(I,x);var F=P.util.qrDecompose(C);I.flipX=!1,I.flipY=!1,I.set("scaleX",F.scaleX),I.set("scaleY",F.scaleY),I.angle=F.angle,I.skewX=F.skewX,I.skewY=0,I.setPositionByOrigin({x:F.translateX,y:F.translateY},"center","center"),S.clipPath=I}else delete S.clipPath},$.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(S){return null!=S}),this.callback(this.instances,this.elements))},function(S){var w=S.fabric||(S.fabric={});function D(T,_){this.x=T,this.y=_}w.Point?w.warn("fabric.Point is already defined"):(w.Point=D,D.prototype={type:"point",constructor:D,add:function(T){return new D(this.x+T.x,this.y+T.y)},addEquals:function(T){return this.x+=T.x,this.y+=T.y,this},scalarAdd:function(T){return new D(this.x+T,this.y+T)},scalarAddEquals:function(T){return this.x+=T,this.y+=T,this},subtract:function(T){return new D(this.x-T.x,this.y-T.y)},subtractEquals:function(T){return this.x-=T.x,this.y-=T.y,this},scalarSubtract:function(T){return new D(this.x-T,this.y-T)},scalarSubtractEquals:function(T){return this.x-=T,this.y-=T,this},multiply:function(T){return new D(this.x*T,this.y*T)},multiplyEquals:function(T){return this.x*=T,this.y*=T,this},divide:function(T){return new D(this.x/T,this.y/T)},divideEquals:function(T){return this.x/=T,this.y/=T,this},eq:function(T){return this.x===T.x&&this.y===T.y},lt:function(T){return this.x<T.x&&this.y<T.y},lte:function(T){return this.x<=T.x&&this.y<=T.y},gt:function(T){return this.x>T.x&&this.y>T.y},gte:function(T){return this.x>=T.x&&this.y>=T.y},lerp:function(T,_){return void 0===_&&(_=.5),_=Math.max(Math.min(1,_),0),new D(this.x+(T.x-this.x)*_,this.y+(T.y-this.y)*_)},distanceFrom:function(T){var _=this.x-T.x,C=this.y-T.y;return Math.sqrt(_*_+C*C)},midPointFrom:function(T){return this.lerp(T)},min:function(T){return new D(Math.min(this.x,T.x),Math.min(this.y,T.y))},max:function(T){return new D(Math.max(this.x,T.x),Math.max(this.y,T.y))},toString:function(){return this.x+","+this.y},setXY:function(T,_){return this.x=T,this.y=_,this},setX:function(T){return this.x=T,this},setY:function(T){return this.y=T,this},setFromPoint:function(T){return this.x=T.x,this.y=T.y,this},swap:function(T){var _=this.x,C=this.y;this.x=T.x,this.y=T.y,T.x=_,T.y=C},clone:function(){return new D(this.x,this.y)}})}(l),function(S){var w=S.fabric||(S.fabric={});function D(T){this.status=T,this.points=[]}w.Intersection?w.warn("fabric.Intersection is already defined"):(w.Intersection=D,w.Intersection.prototype={constructor:D,appendPoint:function(T){return this.points.push(T),this},appendPoints:function(T){return this.points=this.points.concat(T),this}},w.Intersection.intersectLineLine=function(T,_,C,I){var O,x=(I.x-C.x)*(T.y-C.y)-(I.y-C.y)*(T.x-C.x),M=(_.x-T.x)*(T.y-C.y)-(_.y-T.y)*(T.x-C.x),F=(I.y-C.y)*(_.x-T.x)-(I.x-C.x)*(_.y-T.y);if(0!==F){var B=x/F,V=M/F;0<=B&&B<=1&&0<=V&&V<=1?(O=new D("Intersection")).appendPoint(new w.Point(T.x+B*(_.x-T.x),T.y+B*(_.y-T.y))):O=new D}else O=new D(0===x||0===M?"Coincident":"Parallel");return O},w.Intersection.intersectLinePolygon=function(T,_,C){var x,M,F=new D,B=C.length;for(M=0;M<B;M++)x=D.intersectLineLine(T,_,C[M],C[(M+1)%B]),F.appendPoints(x.points);return F.points.length>0&&(F.status="Intersection"),F},w.Intersection.intersectPolygonPolygon=function(T,_){var C,I=new D,O=T.length;for(C=0;C<O;C++){var F=D.intersectLinePolygon(T[C],T[(C+1)%O],_);I.appendPoints(F.points)}return I.points.length>0&&(I.status="Intersection"),I},w.Intersection.intersectPolygonRectangle=function(T,_,C){var I=_.min(C),O=_.max(C),x=new w.Point(O.x,I.y),M=new w.Point(I.x,O.y),F=D.intersectLinePolygon(I,x,T),B=D.intersectLinePolygon(x,O,T),V=D.intersectLinePolygon(O,M,T),W=D.intersectLinePolygon(M,I,T),G=new D;return G.appendPoints(F.points),G.appendPoints(B.points),G.appendPoints(V.points),G.appendPoints(W.points),G.points.length>0&&(G.status="Intersection"),G})}(l),function(S){var w=S.fabric||(S.fabric={});function D(_){_?this._tryParsingColor(_):this.setSource([0,0,0,1])}function T(_,C,I){return I<0&&(I+=1),I>1&&(I-=1),I<1/6?_+6*(C-_)*I:I<.5?C:I<2/3?_+(C-_)*(2/3-I)*6:_}w.Color?w.warn("fabric.Color is already defined."):(w.Color=D,w.Color.prototype={_tryParsingColor:function(_){var C;_ in D.colorNameMap&&(_=D.colorNameMap[_]),"transparent"===_&&(C=[255,255,255,0]),C||(C=D.sourceFromHex(_)),C||(C=D.sourceFromRgb(_)),C||(C=D.sourceFromHsl(_)),C||(C=[0,0,0,1]),C&&this.setSource(C)},_rgbToHsl:function(_,C,I){var O,x,M,F=w.util.array.max([_/=255,C/=255,I/=255]),B=w.util.array.min([_,C,I]);if(M=(F+B)/2,F===B)O=x=0;else{var V=F-B;switch(x=M>.5?V/(2-F-B):V/(F+B),F){case _:O=(C-I)/V+(C<I?6:0);break;case C:O=(I-_)/V+2;break;case I:O=(_-C)/V+4}O/=6}return[Math.round(360*O),Math.round(100*x),Math.round(100*M)]},getSource:function(){return this._source},setSource:function(_){this._source=_},toRgb:function(){var _=this.getSource();return"rgb("+_[0]+","+_[1]+","+_[2]+")"},toRgba:function(){var _=this.getSource();return"rgba("+_[0]+","+_[1]+","+_[2]+","+_[3]+")"},toHsl:function(){var _=this.getSource(),C=this._rgbToHsl(_[0],_[1],_[2]);return"hsl("+C[0]+","+C[1]+"%,"+C[2]+"%)"},toHsla:function(){var _=this.getSource(),C=this._rgbToHsl(_[0],_[1],_[2]);return"hsla("+C[0]+","+C[1]+"%,"+C[2]+"%,"+_[3]+")"},toHex:function(){var _,C,I,O=this.getSource();return _=1===(_=O[0].toString(16)).length?"0"+_:_,C=1===(C=O[1].toString(16)).length?"0"+C:C,I=1===(I=O[2].toString(16)).length?"0"+I:I,_.toUpperCase()+C.toUpperCase()+I.toUpperCase()},toHexa:function(){var _,C=this.getSource();return _=1===(_=(_=Math.round(255*C[3])).toString(16)).length?"0"+_:_,this.toHex()+_.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(_){var C=this.getSource();return C[3]=_,this.setSource(C),this},toGrayscale:function(){var _=this.getSource(),C=parseInt((.3*_[0]+.59*_[1]+.11*_[2]).toFixed(0),10);return this.setSource([C,C,C,_[3]]),this},toBlackWhite:function(_){var C=this.getSource(),I=(.3*C[0]+.59*C[1]+.11*C[2]).toFixed(0),O=C[3];return _=_||127,I=Number(I)<Number(_)?0:255,this.setSource([I,I,I,O]),this},overlayWith:function(_){_ instanceof D||(_=new D(_));var C,I=[],O=this.getAlpha(),x=this.getSource(),M=_.getSource();for(C=0;C<3;C++)I.push(Math.round(.5*x[C]+.5*M[C]));return I[3]=O,this.setSource(I),this}},w.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,w.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,w.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,w.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},w.Color.fromRgb=function(_){return D.fromSource(D.sourceFromRgb(_))},w.Color.sourceFromRgb=function(_){var C=_.match(D.reRGBa);if(C){var I=parseInt(C[1],10)/(/%$/.test(C[1])?100:1)*(/%$/.test(C[1])?255:1),O=parseInt(C[2],10)/(/%$/.test(C[2])?100:1)*(/%$/.test(C[2])?255:1),x=parseInt(C[3],10)/(/%$/.test(C[3])?100:1)*(/%$/.test(C[3])?255:1);return[parseInt(I,10),parseInt(O,10),parseInt(x,10),C[4]?parseFloat(C[4]):1]}},w.Color.fromRgba=D.fromRgb,w.Color.fromHsl=function(_){return D.fromSource(D.sourceFromHsl(_))},w.Color.sourceFromHsl=function(_){var C=_.match(D.reHSLa);if(C){var I,O,x,M=(parseFloat(C[1])%360+360)%360/360,F=parseFloat(C[2])/(/%$/.test(C[2])?100:1),B=parseFloat(C[3])/(/%$/.test(C[3])?100:1);if(0===F)I=O=x=B;else{var V=B<=.5?B*(F+1):B+F-B*F,W=2*B-V;I=T(W,V,M+1/3),O=T(W,V,M),x=T(W,V,M-1/3)}return[Math.round(255*I),Math.round(255*O),Math.round(255*x),C[4]?parseFloat(C[4]):1]}},w.Color.fromHsla=D.fromHsl,w.Color.fromHex=function(_){return D.fromSource(D.sourceFromHex(_))},w.Color.sourceFromHex=function(_){if(_.match(D.reHex)){var C=_.slice(_.indexOf("#")+1),I=3===C.length||4===C.length,O=8===C.length||4===C.length,x=I?C.charAt(0)+C.charAt(0):C.substring(0,2),M=I?C.charAt(1)+C.charAt(1):C.substring(2,4),F=I?C.charAt(2)+C.charAt(2):C.substring(4,6),B=O?I?C.charAt(3)+C.charAt(3):C.substring(6,8):"FF";return[parseInt(x,16),parseInt(M,16),parseInt(F,16),parseFloat((parseInt(B,16)/255).toFixed(2))]}},w.Color.fromSource=function(_){var C=new D;return C.setSource(_),C})}(l),function(S){var w=S.fabric||(S.fabric={}),D=["e","se","s","sw","w","nw","n","ne","e"],T=["ns","nesw","ew","nwse"],_={},C="left",I="top",O="right",x="bottom",M="center",F={top:x,bottom:I,left:O,right:C,center:M},B=w.util.radiansToDegrees,V=Math.sign||function(ne){return(ne>0)-(ne<0)||+ne};function W(ne,te){var ae=ne.angle+B(Math.atan2(te.y,te.x))+360;return Math.round(ae%360/45)}function G(ne,te){var ae=te.transform.target,ge=ae.canvas,ue=w.util.object.clone(te);ue.target=ae,ge&&ge.fire("object:"+ne,ue),ae.fire(ne,te)}function Y(ne,te){var ae=te.canvas,ge=ne[ae.uniScaleKey];return ae.uniformScaling&&!ge||!ae.uniformScaling&&ge}function Z(ne){return ne.originX===M&&ne.originY===M}function ie(ne,te,ae){var ge=ne.lockScalingX,ue=ne.lockScalingY;return!((!ge||!ue)&&(te||!ge&&!ue||!ae)&&(!ge||"x"!==te)&&(!ue||"y"!==te))}function se(ne,te,ae,ge){return{e:ne,transform:te,pointer:{x:ae,y:ge}}}function de(ne){return function(te,ae,ge,ue){var me=ae.target,Ie=me.getCenterPoint(),be=me.translateToOriginPoint(Ie,ae.originX,ae.originY),Ce=ne(te,ae,ge,ue);return me.setPositionByOrigin(be,ae.originX,ae.originY),Ce}}function ce(ne,te){return function(ae,ge,ue,me){var Ie=te(ae,ge,ue,me);return Ie&&G(ne,se(ae,ge,ue,me)),Ie}}function le(ne,te,ae,ge,ue){var me=ne.target,Ie=me.controls[ne.corner],be=me.canvas.getZoom(),Ce=me.padding/be,Se=me.toLocalPoint(new w.Point(ge,ue),te,ae);return Se.x>=Ce&&(Se.x-=Ce),Se.x<=-Ce&&(Se.x+=Ce),Se.y>=Ce&&(Se.y-=Ce),Se.y<=Ce&&(Se.y+=Ce),Se.x-=Ie.offsetX,Se.y-=Ie.offsetY,Se}function ee(ne){return ne.flipX!==ne.flipY}function J(ne,te,ae,ge,ue){if(0!==ne[te]){var me=ue/ne._getTransformedDimensions()[ge]*ne[ae];ne.set(ae,me)}}function oe(ne,te,ae,ge){var ue,me=te.target,Ie=me._getTransformedDimensions(0,me.skewY),be=le(te,te.originX,te.originY,ae,ge),Ce=Math.abs(2*be.x)-Ie.x,Se=me.skewX;Ce<2?ue=0:(ue=B(Math.atan2(Ce/me.scaleX,Ie.y/me.scaleY)),te.originX===C&&te.originY===x&&(ue=-ue),te.originX===O&&te.originY===I&&(ue=-ue),ee(me)&&(ue=-ue));var De=Se!==ue;if(De){var xe=me._getTransformedDimensions().y;me.set("skewX",ue),J(me,"skewY","scaleY","y",xe)}return De}function he(ne,te,ae,ge){var ue,me=te.target,Ie=me._getTransformedDimensions(me.skewX,0),be=le(te,te.originX,te.originY,ae,ge),Ce=Math.abs(2*be.y)-Ie.y,Se=me.skewY;Ce<2?ue=0:(ue=B(Math.atan2(Ce/me.scaleY,Ie.x/me.scaleX)),te.originX===C&&te.originY===x&&(ue=-ue),te.originX===O&&te.originY===I&&(ue=-ue),ee(me)&&(ue=-ue));var De=Se!==ue;if(De){var xe=me._getTransformedDimensions().x;me.set("skewY",ue),J(me,"skewX","scaleX","x",xe)}return De}function fe(ne,te,ae,ge,ue){var me,Ie,be,Ce,Se,De,xe=te.target,je=xe.lockScalingX,Le=xe.lockScalingY,ut=(ue=ue||{}).by,xt=Y(ne,xe),Hi=ie(xe,ut,xt),fs=te.gestureScale;if(Hi)return!1;if(fs)Ie=te.scaleX*fs,be=te.scaleY*fs;else{if(me=le(te,te.originX,te.originY,ae,ge),Se="y"!==ut?V(me.x):1,De="x"!==ut?V(me.y):1,te.signX||(te.signX=Se),te.signY||(te.signY=De),xe.lockScalingFlip&&(te.signX!==Se||te.signY!==De))return!1;if(Ce=xe._getTransformedDimensions(),xt&&!ut){var Xa=Math.abs(me.x)+Math.abs(me.y),en=te.original,Wi=Xa/(Math.abs(Ce.x*en.scaleX/xe.scaleX)+Math.abs(Ce.y*en.scaleY/xe.scaleY));Ie=en.scaleX*Wi,be=en.scaleY*Wi}else Ie=Math.abs(me.x*xe.scaleX/Ce.x),be=Math.abs(me.y*xe.scaleY/Ce.y);Z(te)&&(Ie*=2,be*=2),te.signX!==Se&&"y"!==ut&&(te.originX=F[te.originX],Ie*=-1,te.signX=Se),te.signY!==De&&"x"!==ut&&(te.originY=F[te.originY],be*=-1,te.signY=De)}var Xc=xe.scaleX,qa=xe.scaleY;return ut?("x"===ut&&xe.set("scaleX",Ie),"y"===ut&&xe.set("scaleY",be)):(!je&&xe.set("scaleX",Ie),!Le&&xe.set("scaleY",be)),Xc!==xe.scaleX||qa!==xe.scaleY}_.scaleCursorStyleHandler=function(ne,te,ae){var ge=Y(ne,ae),ue="";if(0!==te.x&&0===te.y?ue="x":0===te.x&&0!==te.y&&(ue="y"),ie(ae,ue,ge))return"not-allowed";var me=W(ae,te);return D[me]+"-resize"},_.skewCursorStyleHandler=function(ne,te,ae){if(0!==te.x&&ae.lockSkewingY||0!==te.y&&ae.lockSkewingX)return"not-allowed";var ue=W(ae,te)%4;return T[ue]+"-resize"},_.scaleSkewCursorStyleHandler=function(ne,te,ae){return ne[ae.canvas.altActionKey]?_.skewCursorStyleHandler(ne,te,ae):_.scaleCursorStyleHandler(ne,te,ae)},_.rotationWithSnapping=ce("rotating",de(function(ne,te,ae,ge){var ue=te,me=ue.target,Ie=me.translateToOriginPoint(me.getCenterPoint(),ue.originX,ue.originY);if(me.lockRotation)return!1;var be,Ce=Math.atan2(ue.ey-Ie.y,ue.ex-Ie.x),Se=Math.atan2(ge-Ie.y,ae-Ie.x),De=B(Se-Ce+ue.theta);if(me.snapAngle>0){var xe=me.snapAngle,je=me.snapThreshold||xe,Le=Math.ceil(De/xe)*xe,ut=Math.floor(De/xe)*xe;Math.abs(De-ut)<je?De=ut:Math.abs(De-Le)<je&&(De=Le)}return De<0&&(De=360+De),be=me.angle!==(De%=360),me.angle=De,be})),_.scalingEqually=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge)})),_.scalingX=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge,{by:"x"})})),_.scalingY=ce("scaling",de(function(ne,te,ae,ge){return fe(ne,te,ae,ge,{by:"y"})})),_.scalingYOrSkewingX=function(ne,te,ae,ge){return ne[te.target.canvas.altActionKey]?_.skewHandlerX(ne,te,ae,ge):_.scalingY(ne,te,ae,ge)},_.scalingXOrSkewingY=function(ne,te,ae,ge){return ne[te.target.canvas.altActionKey]?_.skewHandlerY(ne,te,ae,ge):_.scalingX(ne,te,ae,ge)},_.changeWidth=ce("resizing",de(function(ne,te,ae,ge){var ue=te.target,me=le(te,te.originX,te.originY,ae,ge),Ie=ue.strokeWidth/(ue.strokeUniform?ue.scaleX:1),be=Z(te)?2:1,Ce=ue.width,Se=Math.abs(me.x*be/ue.scaleX)-Ie;return ue.set("width",Math.max(Se,0)),Ce!==Se})),_.skewHandlerX=function(ne,te,ae,ge){var ue,me=te.target,Ie=me.skewX,be=te.originY;return!me.lockSkewingX&&(0===Ie?ue=le(te,M,M,ae,ge).x>0?C:O:(Ie>0&&(ue=be===I?C:O),Ie<0&&(ue=be===I?O:C),ee(me)&&(ue=ue===C?O:C)),te.originX=ue,ce("skewing",de(oe))(ne,te,ae,ge))},_.skewHandlerY=function(ne,te,ae,ge){var ue,me=te.target,Ie=me.skewY,be=te.originX;return!me.lockSkewingY&&(0===Ie?ue=le(te,M,M,ae,ge).y>0?I:x:(Ie>0&&(ue=be===C?I:x),Ie<0&&(ue=be===C?x:I),ee(me)&&(ue=ue===I?x:I)),te.originY=ue,ce("skewing",de(he))(ne,te,ae,ge))},_.dragHandler=function(ne,te,ae,ge){var ue=te.target,me=ae-te.offsetX,Ie=ge-te.offsetY,be=!ue.get("lockMovementX")&&ue.left!==me,Ce=!ue.get("lockMovementY")&&ue.top!==Ie;return be&&ue.set("left",me),Ce&&ue.set("top",Ie),(be||Ce)&&G("moving",se(ne,te,ae,ge)),be||Ce},_.scaleOrSkewActionName=function(ne,te,ae){var ge=ne[ae.canvas.altActionKey];return 0===te.x?ge?"skewX":"scaleY":0===te.y?ge?"skewY":"scaleX":void 0},_.rotationStyleHandler=function(ne,te,ae){return ae.lockRotation?"not-allowed":te.cursorStyle},_.fireEvent=G,_.wrapWithFixedAnchor=de,_.wrapWithFireEvent=ce,_.getLocalPoint=le,w.controlsUtils=_}(l),w=(S=l).fabric||(S.fabric={}),D=w.util.degreesToRadians,(T=w.controlsUtils).renderCircleControl=function(_,C,I,O,x){O=O||{};var M,F=this.sizeX||O.cornerSize||x.cornerSize,B=this.sizeY||O.cornerSize||x.cornerSize,V=void 0!==O.transparentCorners?O.transparentCorners:x.transparentCorners,W=V?"stroke":"fill",G=!V&&(O.cornerStrokeColor||x.cornerStrokeColor),Y=C,Z=I;_.save(),_.fillStyle=O.cornerColor||x.cornerColor,_.strokeStyle=O.cornerStrokeColor||x.cornerStrokeColor,F>B?(M=F,_.scale(1,B/F),Z=I*F/B):B>F?(M=B,_.scale(F/B,1),Y=C*B/F):M=F,_.lineWidth=1,_.beginPath(),_.arc(Y,Z,M/2,0,2*Math.PI,!1),_[W](),G&&_.stroke(),_.restore()},T.renderSquareControl=function(_,C,I,O,x){O=O||{};var M=this.sizeX||O.cornerSize||x.cornerSize,F=this.sizeY||O.cornerSize||x.cornerSize,B=void 0!==O.transparentCorners?O.transparentCorners:x.transparentCorners,V=B?"stroke":"fill",W=!B&&(O.cornerStrokeColor||x.cornerStrokeColor),G=M/2,Y=F/2;_.save(),_.fillStyle=O.cornerColor||x.cornerColor,_.strokeStyle=O.cornerStrokeColor||x.cornerStrokeColor,_.lineWidth=1,_.translate(C,I),_.rotate(D(x.angle)),_[V+"Rect"](-G,-Y,M,F),W&&_.strokeRect(-G,-Y,M,F),_.restore()},function(S){var w=S.fabric||(S.fabric={});w.Control=function(D){for(var T in D)this[T]=D[T]},w.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(D,T){return T.cursorStyle},getActionName:function(D,T){return T.actionName},getVisibility:function(D,T){var _=D._controlsVisibility;return _&&void 0!==_[T]?_[T]:this.visible},setVisibility:function(D){this.visible=D},positionHandler:function(D,T){return w.util.transformPoint({x:this.x*D.x+this.offsetX,y:this.y*D.y+this.offsetY},T)},calcCornerCoords:function(D,T,_,C,I){var O,x,M,F,B=I?this.touchSizeX:this.sizeX,V=I?this.touchSizeY:this.sizeY;if(B&&V&&B!==V){var W=Math.atan2(V,B),G=Math.sqrt(B*B+V*V)/2,Y=W-w.util.degreesToRadians(D),Z=Math.PI/2-W-w.util.degreesToRadians(D);O=G*w.util.cos(Y),x=G*w.util.sin(Y),M=G*w.util.cos(Z),F=G*w.util.sin(Z)}else G=.7071067812*(B&&V?B:T),Y=w.util.degreesToRadians(45-D),O=M=G*w.util.cos(Y),x=F=G*w.util.sin(Y);return{tl:{x:_-F,y:C-M},tr:{x:_+O,y:C-x},bl:{x:_-O,y:C+x},br:{x:_+F,y:C+M}}},render:function(D,T,_,C,I){"circle"===((C=C||{}).cornerStyle||I.cornerStyle)?w.controlsUtils.renderCircleControl.call(this,D,T,_,C,I):w.controlsUtils.renderSquareControl.call(this,D,T,_,C,I)}}}(l),function(){function S(D,T){var _,C,I,O,x=D.getAttribute("style"),M=D.getAttribute("offset")||0;if(M=(M=parseFloat(M)/(/%$/.test(M)?100:1))<0?0:M>1?1:M,x){var F=x.split(/\s*;\s*/);for(""===F[F.length-1]&&F.pop(),O=F.length;O--;){var B=F[O].split(/\s*:\s*/),V=B[0].trim(),W=B[1].trim();"stop-color"===V?_=W:"stop-opacity"===V&&(I=W)}}return _||(_=D.getAttribute("stop-color")||"rgb(0,0,0)"),I||(I=D.getAttribute("stop-opacity")),C=(_=new P.Color(_)).getAlpha(),I=isNaN(parseFloat(I))?1:parseFloat(I),I*=C*T,{offset:M,color:_.toRgb(),opacity:I}}var w=P.util.object.clone;P.Gradient=P.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(D){D||(D={}),D.coords||(D.coords={});var T,_=this;Object.keys(D).forEach(function(C){_[C]=D[C]}),this.id?this.id+="_"+P.Object.__uid++:this.id=P.Object.__uid++,T={x1:D.coords.x1||0,y1:D.coords.y1||0,x2:D.coords.x2||0,y2:D.coords.y2||0},"radial"===this.type&&(T.r1=D.coords.r1||0,T.r2=D.coords.r2||0),this.coords=T,this.colorStops=D.colorStops.slice()},addColorStop:function(D){for(var T in D){var _=new P.Color(D[T]);this.colorStops.push({offset:parseFloat(T),color:_.toRgb(),opacity:_.getAlpha()})}return this},toObject:function(D){var T={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return P.util.populateWithProperties(this,T,D),T},toSVG:function(D,T){var _,C,I,O,x=w(this.coords,!0),M=(T=T||{},w(this.colorStops,!0)),F=x.r1>x.r2,B=this.gradientTransform?this.gradientTransform.concat():P.iMatrix.concat(),V=-this.offsetX,W=-this.offsetY,G=!!T.additionalTransform,Y="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(M.sort(function(de,ce){return de.offset-ce.offset}),"objectBoundingBox"===Y?(V/=D.width,W/=D.height):(V+=D.width/2,W+=D.height/2),"path"===D.type&&"percentage"!==this.gradientUnits&&(V-=D.pathOffset.x,W-=D.pathOffset.y),B[4]-=V,B[5]-=W,O='id="SVGID_'+this.id+'" gradientUnits="'+Y+'"',O+=' gradientTransform="'+(G?T.additionalTransform+" ":"")+P.util.matrixToSVG(B)+'" ',"linear"===this.type?I=["<linearGradient ",O,' x1="',x.x1,'" y1="',x.y1,'" x2="',x.x2,'" y2="',x.y2,'">\n']:"radial"===this.type&&(I=["<radialGradient ",O,' cx="',F?x.x1:x.x2,'" cy="',F?x.y1:x.y2,'" r="',F?x.r1:x.r2,'" fx="',F?x.x2:x.x1,'" fy="',F?x.y2:x.y1,'">\n']),"radial"===this.type){if(F)for((M=M.concat()).reverse(),_=0,C=M.length;_<C;_++)M[_].offset=1-M[_].offset;var Z=Math.min(x.r1,x.r2);if(Z>0){var ie=Z/Math.max(x.r1,x.r2);for(_=0,C=M.length;_<C;_++)M[_].offset+=ie*(1-M[_].offset)}}for(_=0,C=M.length;_<C;_++){var se=M[_];I.push("<stop ",'offset="',100*se.offset+"%",'" style="stop-color:',se.color,void 0!==se.opacity?";stop-opacity: "+se.opacity:";",'"/>\n')}return I.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),I.join("")},toLive:function(D){var T,_,C,I=P.util.object.clone(this.coords);if(this.type){for("linear"===this.type?T=D.createLinearGradient(I.x1,I.y1,I.x2,I.y2):"radial"===this.type&&(T=D.createRadialGradient(I.x1,I.y1,I.r1,I.x2,I.y2,I.r2)),_=0,C=this.colorStops.length;_<C;_++){var O=this.colorStops[_].color,x=this.colorStops[_].opacity,M=this.colorStops[_].offset;void 0!==x&&(O=new P.Color(O).setAlpha(x).toRgba()),T.addColorStop(M,O)}return T}}}),P.util.object.extend(P.Gradient,{fromElement:function(D,T,_,C){var I=parseFloat(_)/(/%$/.test(_)?100:1);I=I<0?0:I>1?1:I,isNaN(I)&&(I=1);var O,x,M,F,ie,se,de,ce,le,ee,B=D.getElementsByTagName("stop"),V="userSpaceOnUse"===D.getAttribute("gradientUnits")?"pixels":"percentage",W=D.getAttribute("gradientTransform")||"",G=[],Y=0,Z=0;for("linearGradient"===D.nodeName||"LINEARGRADIENT"===D.nodeName?(O="linear",x={x1:(ie=D).getAttribute("x1")||0,y1:ie.getAttribute("y1")||0,x2:ie.getAttribute("x2")||"100%",y2:ie.getAttribute("y2")||0}):(O="radial",x=function(ie){return{x1:ie.getAttribute("fx")||ie.getAttribute("cx")||"50%",y1:ie.getAttribute("fy")||ie.getAttribute("cy")||"50%",r1:0,x2:ie.getAttribute("cx")||"50%",y2:ie.getAttribute("cy")||"50%",r2:ie.getAttribute("r")||"50%"}}(D)),M=B.length;M--;)G.push(S(B[M],I));return F=P.parseTransformAttribute(W),se=x,de=C,ce=V,Object.keys(se).forEach(function(J){"Infinity"===(le=se[J])?ee=1:"-Infinity"===le?ee=0:(ee=parseFloat(se[J],10),"string"==typeof le&&/^(\d+\.\d+)%|(\d+)%$/.test(le)&&(ee*=.01,"pixels"===ce&&("x1"!==J&&"x2"!==J&&"r2"!==J||(ee*=de.viewBoxWidth||de.width),"y1"!==J&&"y2"!==J||(ee*=de.viewBoxHeight||de.height)))),se[J]=ee}),"pixels"===V&&(Y=-T.left,Z=-T.top),new P.Gradient({id:D.getAttribute("id"),type:O,coords:x,colorStops:G,gradientUnits:V,gradientTransform:F,offsetX:Y,offsetY:Z})}})}(),q=P.util.toFixed,P.Pattern=P.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(S,w){if(S||(S={}),this.id=P.Object.__uid++,this.setOptions(S),!S.source||S.source&&"string"!=typeof S.source)w&&w(this);else{var D=this;this.source=P.util.createImage(),P.util.loadImage(S.source,function(T,_){D.source=T,w&&w(D,_)},null,this.crossOrigin)}},toObject:function(S){var w,D,T=P.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?w=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(w=this.source.toDataURL()),D={type:"pattern",source:w,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:q(this.offsetX,T),offsetY:q(this.offsetY,T),patternTransform:this.patternTransform?this.patternTransform.concat():null},P.util.populateWithProperties(this,D,S),D},toSVG:function(S){var w="function"==typeof this.source?this.source():this.source,D=w.width/S.width,T=w.height/S.height,_=this.offsetX/S.width,C=this.offsetY/S.height,I="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(T=1,C&&(T+=Math.abs(C))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(D=1,_&&(D+=Math.abs(_))),w.src?I=w.src:w.toDataURL&&(I=w.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+_+'" y="'+C+'" width="'+D+'" height="'+T+'">\n<image x="0" y="0" width="'+w.width+'" height="'+w.height+'" xlink:href="'+I+'"></image>\n</pattern>\n'},setOptions:function(S){for(var w in S)this[w]=S[w]},toLive:function(S){var w=this.source;return w&&(void 0===w.src||w.complete&&0!==w.naturalWidth&&0!==w.naturalHeight)?S.createPattern(w,this.repeat):""}}),function(S){var w=S.fabric||(S.fabric={}),D=w.util.toFixed;w.Shadow?w.warn("fabric.Shadow is already defined."):(w.Shadow=w.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(T){for(var _ in"string"==typeof T&&(T=this._parseShadow(T)),T)this[_]=T[_];this.id=w.Object.__uid++},_parseShadow:function(T){var _=T.trim(),C=w.Shadow.reOffsetsAndBlur.exec(_)||[];return{color:(_.replace(w.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(C[1],10)||0,offsetY:parseFloat(C[2],10)||0,blur:parseFloat(C[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(T){var _=40,C=40,I=w.Object.NUM_FRACTION_DIGITS,O=w.util.rotateVector({x:this.offsetX,y:this.offsetY},w.util.degreesToRadians(-T.angle)),x=new w.Color(this.color);return T.width&&T.height&&(_=100*D((Math.abs(O.x)+this.blur)/T.width,I)+20,C=100*D((Math.abs(O.y)+this.blur)/T.height,I)+20),T.flipX&&(O.x*=-1),T.flipY&&(O.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+C+'%" height="'+(100+2*C)+'%" x="-'+_+'%" width="'+(100+2*_)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+D(this.blur?this.blur/2:0,I)+'"></feGaussianBlur>\n\t<feOffset dx="'+D(O.x,I)+'" dy="'+D(O.y,I)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+x.toRgb()+'" flood-opacity="'+x.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var T={},_=w.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(C){this[C]!==_[C]&&(T[C]=this[C])},this),T}}),w.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(l),function(){if(P.StaticCanvas)P.warn("fabric.StaticCanvas is already defined.");else{var S=P.util.object.extend,w=P.util.getElementOffset,D=P.util.removeFromArray,T=P.util.toFixed,_=P.util.transformPoint,C=P.util.invertTransform,I=P.util.getNodeCanvas,O=P.util.createCanvasElement,x=new Error("Could not initialize `canvas` element");P.StaticCanvas=P.util.createClass(P.CommonMethods,{initialize:function(M,F){F||(F={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(M,F)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:P.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(M,F){var B=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(M),this._initOptions(F),this.interactive||this._initRetinaScaling(),F.overlayImage&&this.setOverlayImage(F.overlayImage,B),F.backgroundImage&&this.setBackgroundImage(F.backgroundImage,B),F.backgroundColor&&this.setBackgroundColor(F.backgroundColor,B),F.overlayColor&&this.setOverlayColor(F.overlayColor,B),this.calcOffset()},_isRetinaScaling:function(){return P.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,P.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var M=P.devicePixelRatio;this.__initRetinaScaling(M,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(M,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(M,F,B){F.setAttribute("width",this.width*M),F.setAttribute("height",this.height*M),B.scale(M,M)},calcOffset:function(){return this._offset=w(this.lowerCanvasEl),this},setOverlayImage:function(M,F,B){return this.__setBgOverlayImage("overlayImage",M,F,B)},setBackgroundImage:function(M,F,B){return this.__setBgOverlayImage("backgroundImage",M,F,B)},setOverlayColor:function(M,F){return this.__setBgOverlayColor("overlayColor",M,F)},setBackgroundColor:function(M,F){return this.__setBgOverlayColor("backgroundColor",M,F)},__setBgOverlayImage:function(M,F,B,V){return"string"==typeof F?P.util.loadImage(F,function(W,G){if(W){var Y=new P.Image(W,V);this[M]=Y,Y.canvas=this}B&&B(W,G)},this,V&&V.crossOrigin):(V&&F.setOptions(V),this[M]=F,F&&(F.canvas=this),B&&B(F,!1)),this},__setBgOverlayColor:function(M,F,B){return this[M]=F,this._initGradient(F,M),this._initPattern(F,M,B),this},_createCanvasElement:function(){var M=O();if(!M||(M.style||(M.style={}),void 0===M.getContext))throw x;return M},_initOptions:function(M){var F=this.lowerCanvasEl;this._setOptions(M),this.width=this.width||parseInt(F.width,10)||0,this.height=this.height||parseInt(F.height,10)||0,this.lowerCanvasEl.style&&(F.width=this.width,F.height=this.height,F.style.width=this.width+"px",F.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(M){this.lowerCanvasEl=M&&M.getContext?M:P.util.getById(M)||this._createCanvasElement(),P.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(M,F){return this.setDimensions({width:M},F)},setHeight:function(M,F){return this.setDimensions({height:M},F)},setDimensions:function(M,F){var B;for(var V in F=F||{},M)B=M[V],F.cssOnly||(this._setBackstoreDimension(V,M[V]),B+="px",this.hasLostContext=!0),F.backstoreOnly||this._setCssDimension(V,B);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),F.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(M,F){return this.lowerCanvasEl[M]=F,this.upperCanvasEl&&(this.upperCanvasEl[M]=F),this.cacheCanvasEl&&(this.cacheCanvasEl[M]=F),this[M]=F,this},_setCssDimension:function(M,F){return this.lowerCanvasEl.style[M]=F,this.upperCanvasEl&&(this.upperCanvasEl.style[M]=F),this.wrapperEl&&(this.wrapperEl.style[M]=F),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(M){var F,B,V,W=this._activeObject,G=this.backgroundImage,Y=this.overlayImage;for(this.viewportTransform=M,B=0,V=this._objects.length;B<V;B++)(F=this._objects[B]).group||F.setCoords(!0);return W&&W.setCoords(),G&&G.setCoords(!0),Y&&Y.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(M,F){var B=M,V=this.viewportTransform.slice(0);M=_(M,C(this.viewportTransform)),V[0]=F,V[3]=F;var W=_(M,V);return V[4]+=B.x-W.x,V[5]+=B.y-W.y,this.setViewportTransform(V)},setZoom:function(M){return this.zoomToPoint(new P.Point(0,0),M),this},absolutePan:function(M){var F=this.viewportTransform.slice(0);return F[4]=-M.x,F[5]=-M.y,this.setViewportTransform(F)},relativePan:function(M){return this.absolutePan(new P.Point(-M.x-this.viewportTransform[4],-M.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(M){this.stateful&&M.setupState(),M._set("canvas",this),M.setCoords(),this.fire("object:added",{target:M}),M.fire("added")},_onObjectRemoved:function(M){this.fire("object:removed",{target:M}),M.fire("removed"),delete M.canvas},clearContext:function(M){return M.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=P.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var M={},F=this.width,B=this.height,V=C(this.viewportTransform);return M.tl=_({x:0,y:0},V),M.br=_({x:F,y:B},V),M.tr=new P.Point(M.br.x,M.tl.y),M.bl=new P.Point(M.tl.x,M.br.y),this.vptCoords=M,M},cancelRequestedRender:function(){this.isRendering&&(P.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(M,F){var B=this.viewportTransform,V=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(M),P.util.setImageSmoothing(M,this.imageSmoothingEnabled),this.fire("before:render",{ctx:M}),this._renderBackground(M),M.save(),M.transform(B[0],B[1],B[2],B[3],B[4],B[5]),this._renderObjects(M,F),M.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(M),V&&(V.canvas=this,V.shouldCache(),V._transformDone=!0,V.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(M)),this._renderOverlay(M),this.controlsAboveOverlay&&this.interactive&&this.drawControls(M),this.fire("after:render",{ctx:M})},drawClipPathOnCanvas:function(M){var F=this.viewportTransform,B=this.clipPath;M.save(),M.transform(F[0],F[1],F[2],F[3],F[4],F[5]),M.globalCompositeOperation="destination-in",B.transform(M),M.scale(1/B.zoomX,1/B.zoomY),M.drawImage(B._cacheCanvas,-B.cacheTranslationX,-B.cacheTranslationY),M.restore()},_renderObjects:function(M,F){var B,V;for(B=0,V=F.length;B<V;++B)F[B]&&F[B].render(M)},_renderBackgroundOrOverlay:function(M,F){var B=this[F+"Color"],V=this[F+"Image"],W=this.viewportTransform,G=this[F+"Vpt"];if(B||V){if(B){M.save(),M.beginPath(),M.moveTo(0,0),M.lineTo(this.width,0),M.lineTo(this.width,this.height),M.lineTo(0,this.height),M.closePath(),M.fillStyle=B.toLive?B.toLive(M,this):B,G&&M.transform(W[0],W[1],W[2],W[3],W[4],W[5]),M.transform(1,0,0,1,B.offsetX||0,B.offsetY||0);var Y=B.gradientTransform||B.patternTransform;Y&&M.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),M.fill(),M.restore()}V&&(M.save(),G&&M.transform(W[0],W[1],W[2],W[3],W[4],W[5]),V.render(M),M.restore())}},_renderBackground:function(M){this._renderBackgroundOrOverlay(M,"background")},_renderOverlay:function(M){this._renderBackgroundOrOverlay(M,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new P.Point(this.width/2,this.height/2)},centerObjectH:function(M){return this._centerObject(M,new P.Point(this.getCenterPoint().x,M.getCenterPoint().y))},centerObjectV:function(M){return this._centerObject(M,new P.Point(M.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(M){var F=this.getCenterPoint();return this._centerObject(M,F)},viewportCenterObject:function(M){var F=this.getVpCenter();return this._centerObject(M,F)},viewportCenterObjectH:function(M){var F=this.getVpCenter();return this._centerObject(M,new P.Point(F.x,M.getCenterPoint().y)),this},viewportCenterObjectV:function(M){var F=this.getVpCenter();return this._centerObject(M,new P.Point(M.getCenterPoint().x,F.y))},getVpCenter:function(){var M=this.getCenterPoint(),F=C(this.viewportTransform);return _(M,F)},_centerObject:function(M,F){return M.setPositionByOrigin(F,"center","center"),M.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(M){return this.toDatalessObject(M)},toObject:function(M){return this._toObjectMethod("toObject",M)},toDatalessObject:function(M){return this._toObjectMethod("toDatalessObject",M)},_toObjectMethod:function(M,F){var B=this.clipPath,V={version:P.version,objects:this._toObjects(M,F)};return B&&!B.excludeFromExport&&(V.clipPath=this._toObject(this.clipPath,M,F)),S(V,this.__serializeBgOverlay(M,F)),P.util.populateWithProperties(this,V,F),V},_toObjects:function(M,F){return this._objects.filter(function(B){return!B.excludeFromExport}).map(function(B){return this._toObject(B,M,F)},this)},_toObject:function(M,F,B){var V;this.includeDefaultValues||(V=M.includeDefaultValues,M.includeDefaultValues=!1);var W=M[F](B);return this.includeDefaultValues||(M.includeDefaultValues=V),W},__serializeBgOverlay:function(M,F){var B={},V=this.backgroundImage,W=this.overlayImage,G=this.backgroundColor,Y=this.overlayColor;return G&&G.toObject?G.excludeFromExport||(B.background=G.toObject(F)):G&&(B.background=G),Y&&Y.toObject?Y.excludeFromExport||(B.overlay=Y.toObject(F)):Y&&(B.overlay=Y),V&&!V.excludeFromExport&&(B.backgroundImage=this._toObject(V,M,F)),W&&!W.excludeFromExport&&(B.overlayImage=this._toObject(W,M,F)),B},svgViewportTransformation:!0,toSVG:function(M,F){M||(M={}),M.reviver=F;var B=[];return this._setSVGPreamble(B,M),this._setSVGHeader(B,M),this.clipPath&&B.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(B,"background"),this._setSVGBgOverlayImage(B,"backgroundImage",F),this._setSVGObjects(B,F),this.clipPath&&B.push("</g>\n"),this._setSVGBgOverlayColor(B,"overlay"),this._setSVGBgOverlayImage(B,"overlayImage",F),B.push("</svg>"),B.join("")},_setSVGPreamble:function(M,F){F.suppressPreamble||M.push('<?xml version="1.0" encoding="',F.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(M,F){var B,V=F.width||this.width,W=F.height||this.height,G='viewBox="0 0 '+this.width+" "+this.height+'" ',Y=P.Object.NUM_FRACTION_DIGITS;F.viewBox?G='viewBox="'+F.viewBox.x+" "+F.viewBox.y+" "+F.viewBox.width+" "+F.viewBox.height+'" ':this.svgViewportTransformation&&(G='viewBox="'+T(-(B=this.viewportTransform)[4]/B[0],Y)+" "+T(-B[5]/B[3],Y)+" "+T(this.width/B[0],Y)+" "+T(this.height/B[3],Y)+'" '),M.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',V,'" ','height="',W,'" ',G,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",P.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(F),"</defs>\n")},createSVGClipPathMarkup:function(M){var F=this.clipPath;return F?(F.clipPathId="CLIPPATH_"+P.Object.__uid++,'<clipPath id="'+F.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(M.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var M=this;return["background","overlay"].map(function(F){var B=M[F+"Color"];if(B&&B.toLive){var V=M[F+"Vpt"],W=M.viewportTransform;return B.toSVG({width:M.width/(V?W[0]:1),height:M.height/(V?W[3]:1)},{additionalTransform:V?P.util.matrixToSVG(W):""})}}).join("")},createSVGFontFacesMarkup:function(){var M,F,B,V,W,G,Y,Z,ie="",se={},de=P.fontPaths,ce=[];for(this._objects.forEach(function ee(J){ce.push(J),J._objects&&J._objects.forEach(ee)}),Y=0,Z=ce.length;Y<Z;Y++)if(F=(M=ce[Y]).fontFamily,-1!==M.type.indexOf("text")&&!se[F]&&de[F]&&(se[F]=!0,M.styles))for(W in B=M.styles)for(G in V=B[W])!se[F=V[G].fontFamily]&&de[F]&&(se[F]=!0);for(var le in se)ie+=["\t\t@font-face {\n","\t\t\tfont-family: '",le,"';\n","\t\t\tsrc: url('",de[le],"');\n","\t\t}\n"].join("");return ie&&(ie=['\t<style type="text/css">',"<![CDATA[\n",ie,"]]>","</style>\n"].join("")),ie},_setSVGObjects:function(M,F){var B,V,W,G=this._objects;for(V=0,W=G.length;V<W;V++)(B=G[V]).excludeFromExport||this._setSVGObject(M,B,F)},_setSVGObject:function(M,F,B){M.push(F.toSVG(B))},_setSVGBgOverlayImage:function(M,F,B){this[F]&&!this[F].excludeFromExport&&this[F].toSVG&&M.push(this[F].toSVG(B))},_setSVGBgOverlayColor:function(M,F){var B=this[F+"Color"],W=this.width,G=this.height;if(B)if(B.toLive){var Y=B.repeat,Z=P.util.invertTransform(this.viewportTransform),ie=this[F+"Vpt"]?P.util.matrixToSVG(Z):"";M.push('<rect transform="'+ie+" translate(",W/2,",",G/2,')"',' x="',B.offsetX-W/2,'" y="',B.offsetY-G/2,'" ','width="',"repeat-y"===Y||"no-repeat"===Y?B.source.width:W,'" height="',"repeat-x"===Y||"no-repeat"===Y?B.source.height:G,'" fill="url(#SVGID_'+B.id+')"',"></rect>\n")}else M.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',B,'"',"></rect>\n")},sendToBack:function(M){if(!M)return this;var F,B,V,W=this._activeObject;if(M===W&&"activeSelection"===M.type)for(F=(V=W._objects).length;F--;)D(this._objects,B=V[F]),this._objects.unshift(B);else D(this._objects,M),this._objects.unshift(M);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(M){if(!M)return this;var F,B,V,W=this._activeObject;if(M===W&&"activeSelection"===M.type)for(V=W._objects,F=0;F<V.length;F++)D(this._objects,B=V[F]),this._objects.push(B);else D(this._objects,M),this._objects.push(M);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(M,F){if(!M)return this;var B,V,W,G,Y,Z=this._activeObject,ie=0;if(M===Z&&"activeSelection"===M.type)for(Y=Z._objects,B=0;B<Y.length;B++)(W=this._objects.indexOf(V=Y[B]))>0+ie&&(G=W-1,D(this._objects,V),this._objects.splice(G,0,V)),ie++;else 0!==(W=this._objects.indexOf(M))&&(G=this._findNewLowerIndex(M,W,F),D(this._objects,M),this._objects.splice(G,0,M));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(M,F,B){var V,W;if(B){for(V=F,W=F-1;W>=0;--W)if(M.intersectsWithObject(this._objects[W])||M.isContainedWithinObject(this._objects[W])||this._objects[W].isContainedWithinObject(M)){V=W;break}}else V=F-1;return V},bringForward:function(M,F){if(!M)return this;var B,V,W,G,Y,Z=this._activeObject,ie=0;if(M===Z&&"activeSelection"===M.type)for(B=(Y=Z._objects).length;B--;)(W=this._objects.indexOf(V=Y[B]))<this._objects.length-1-ie&&(G=W+1,D(this._objects,V),this._objects.splice(G,0,V)),ie++;else(W=this._objects.indexOf(M))!==this._objects.length-1&&(G=this._findNewUpperIndex(M,W,F),D(this._objects,M),this._objects.splice(G,0,M));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(M,F,B){var V,W,G;if(B){for(V=F,W=F+1,G=this._objects.length;W<G;++W)if(M.intersectsWithObject(this._objects[W])||M.isContainedWithinObject(this._objects[W])||this._objects[W].isContainedWithinObject(M)){V=W;break}}else V=F+1;return V},moveTo:function(M,F){return D(this._objects,M),this._objects.splice(F,0,M),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(P.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(M){M.dispose&&M.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),P.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),P.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),S(P.StaticCanvas.prototype,P.Observable),S(P.StaticCanvas.prototype,P.Collection),S(P.StaticCanvas.prototype,P.DataURLExporter),S(P.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(M){var F=O();if(!F||!F.getContext)return null;var B=F.getContext("2d");return B&&"setLineDash"===M?void 0!==B.setLineDash:null}}),P.StaticCanvas.prototype.toJSON=P.StaticCanvas.prototype.toObject,P.isLikelyNode&&(P.StaticCanvas.prototype.createPNGStream=function(){var M=I(this.lowerCanvasEl);return M&&M.createPNGStream()},P.StaticCanvas.prototype.createJPEGStream=function(M){var F=I(this.lowerCanvasEl);return F&&F.createJPEGStream(M)})}}(),P.BaseBrush=P.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(S){S.strokeStyle=this.color,S.lineWidth=this.width,S.lineCap=this.strokeLineCap,S.miterLimit=this.strokeMiterLimit,S.lineJoin=this.strokeLineJoin,S.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(S){var w=this.canvas.viewportTransform;S.save(),S.transform(w[0],w[1],w[2],w[3],w[4],w[5])},_setShadow:function(){if(this.shadow){var S=this.canvas,w=this.shadow,D=S.contextTop,T=S.getZoom();S&&S._isRetinaScaling()&&(T*=P.devicePixelRatio),D.shadowColor=w.color,D.shadowBlur=w.blur*T,D.shadowOffsetX=w.offsetX*T,D.shadowOffsetY=w.offsetY*T}},needsFullRender:function(){return new P.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var S=this.canvas.contextTop;S.shadowColor="",S.shadowBlur=S.shadowOffsetX=S.shadowOffsetY=0},_isOutSideCanvas:function(S){return S.x<0||S.x>this.canvas.getWidth()||S.y<0||S.y>this.canvas.getHeight()}}),P.PencilBrush=P.util.createClass(P.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(S){this.canvas=S,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(S,w,D){var T=w.midPointFrom(D);return S.quadraticCurveTo(w.x,w.y,T.x,T.y),T},onMouseDown:function(S,w){this.canvas._isMainEvent(w.e)&&(this.drawStraightLine=w.e[this.straightLineKey],this._prepareForDrawing(S),this._captureDrawingPath(S),this._render())},onMouseMove:function(S,w){if(this.canvas._isMainEvent(w.e)&&(this.drawStraightLine=w.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(S))&&this._captureDrawingPath(S)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var D=this._points,T=D.length,_=this.canvas.contextTop;this._saveAndTransform(_),this.oldEnd&&(_.beginPath(),_.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(_,D[T-2],D[T-1],!0),_.stroke(),_.restore()}},onMouseUp:function(S){return!this.canvas._isMainEvent(S.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(S){var w=new P.Point(S.x,S.y);this._reset(),this._addPoint(w),this.canvas.contextTop.moveTo(w.x,w.y)},_addPoint:function(S){return!(this._points.length>1&&S.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(S),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(S){var w=new P.Point(S.x,S.y);return this._addPoint(w)},_render:function(S){var w,D,T=this._points[0],_=this._points[1];if(this._saveAndTransform(S=S||this.canvas.contextTop),S.beginPath(),2===this._points.length&&T.x===_.x&&T.y===_.y){var C=this.width/1e3;T=new P.Point(T.x,T.y),_=new P.Point(_.x,_.y),T.x-=C,_.x+=C}for(S.moveTo(T.x,T.y),w=1,D=this._points.length;w<D;w++)this._drawSegment(S,T,_),T=this._points[w],_=this._points[w+1];S.lineTo(T.x,T.y),S.stroke(),S.restore()},convertPointsToSVGPath:function(S){return P.util.getSmoothPathFromPoints(S,this.width/1e3)},_isEmptySVGPath:function(S){return"M 0 0 Q 0 0 0 0 L 0 0"===P.util.joinPath(S)},createPath:function(S){var w=new P.Path(S,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,w.shadow=new P.Shadow(this.shadow)),w},decimatePoints:function(S,w){if(S.length<=2)return S;var D,T=this.canvas.getZoom(),_=Math.pow(w/T,2),C=S.length-1,I=S[0],O=[I];for(D=1;D<C-1;D++)Math.pow(I.x-S[D].x,2)+Math.pow(I.y-S[D].y,2)>=_&&O.push(I=S[D]);return O.push(S[C]),O},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var S=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(S))this.canvas.requestRenderAll();else{var w=this.createPath(S);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:w}),this.canvas.add(w),this.canvas.requestRenderAll(),w.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:w})}}}),P.CircleBrush=P.util.createClass(P.BaseBrush,{width:10,initialize:function(S){this.canvas=S,this.points=[]},drawDot:function(S){var w=this.addPoint(S),D=this.canvas.contextTop;this._saveAndTransform(D),this.dot(D,w),D.restore()},dot:function(S,w){S.fillStyle=w.fill,S.beginPath(),S.arc(w.x,w.y,w.radius,0,2*Math.PI,!1),S.closePath(),S.fill()},onMouseDown:function(S){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(S)},_render:function(){var S,w,D=this.canvas.contextTop,T=this.points;for(this._saveAndTransform(D),S=0,w=T.length;S<w;S++)this.dot(D,T[S]);D.restore()},onMouseMove:function(S){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(S)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(S),this._render()):this.drawDot(S))},onMouseUp:function(){var S,w,D=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var T=[];for(S=0,w=this.points.length;S<w;S++){var _=this.points[S],C=new P.Circle({radius:_.radius,left:_.x,top:_.y,originX:"center",originY:"center",fill:_.fill});this.shadow&&(C.shadow=new P.Shadow(this.shadow)),T.push(C)}var I=new P.Group(T);I.canvas=this.canvas,this.canvas.fire("before:path:created",{path:I}),this.canvas.add(I),this.canvas.fire("path:created",{path:I}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=D,this.canvas.requestRenderAll()},addPoint:function(S){var w=new P.Point(S.x,S.y),D=P.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,T=new P.Color(this.color).setAlpha(P.util.getRandomInt(0,100)/100).toRgba();return w.radius=D,w.fill=T,this.points.push(w),w}}),P.SprayBrush=P.util.createClass(P.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(S){this.canvas=S,this.sprayChunks=[]},onMouseDown:function(S){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(S),this.render(this.sprayChunkPoints)},onMouseMove:function(S){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(S)||(this.addSprayChunk(S),this.render(this.sprayChunkPoints))},onMouseUp:function(){var S=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var w=[],D=0,T=this.sprayChunks.length;D<T;D++)for(var _=this.sprayChunks[D],C=0,I=_.length;C<I;C++){var O=new P.Rect({width:_[C].width,height:_[C].width,left:_[C].x+1,top:_[C].y+1,originX:"center",originY:"center",fill:this.color});w.push(O)}this.optimizeOverlapping&&(w=this._getOptimizedRects(w));var x=new P.Group(w);this.shadow&&x.set("shadow",new P.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:x}),this.canvas.add(x),this.canvas.fire("path:created",{path:x}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=S,this.canvas.requestRenderAll()},_getOptimizedRects:function(S){var w,D,T,_={};for(D=0,T=S.length;D<T;D++)_[w=S[D].left+""+S[D].top]||(_[w]=S[D]);var C=[];for(w in _)C.push(_[w]);return C},render:function(S){var w,D,T=this.canvas.contextTop;for(T.fillStyle=this.color,this._saveAndTransform(T),w=0,D=S.length;w<D;w++){var _=S[w];void 0!==_.opacity&&(T.globalAlpha=_.opacity),T.fillRect(_.x,_.y,_.width,_.width)}T.restore()},_render:function(){var S,w,D=this.canvas.contextTop;for(D.fillStyle=this.color,this._saveAndTransform(D),S=0,w=this.sprayChunks.length;S<w;S++)this.render(this.sprayChunks[S]);D.restore()},addSprayChunk:function(S){this.sprayChunkPoints=[];var w,D,T,_,C=this.width/2;for(_=0;_<this.density;_++){w=P.util.getRandomInt(S.x-C,S.x+C),D=P.util.getRandomInt(S.y-C,S.y+C),T=this.dotWidthVariance?P.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var I=new P.Point(w,D);I.width=T,this.randomOpacity&&(I.opacity=P.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(I)}this.sprayChunks.push(this.sprayChunkPoints)}}),P.PatternBrush=P.util.createClass(P.PencilBrush,{getPatternSrc:function(){var S=P.util.createCanvasElement(),w=S.getContext("2d");return S.width=S.height=25,w.fillStyle=this.color,w.beginPath(),w.arc(10,10,10,0,2*Math.PI,!1),w.closePath(),w.fill(),S},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(S){return S.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(S){this.callSuper("_setBrushStyles",S),S.strokeStyle=this.getPattern(S)},createPath:function(S){var w=this.callSuper("createPath",S),D=w._getLeftTopCoords().scalarAdd(w.strokeWidth/2);return w.stroke=new P.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-D.x,offsetY:-D.y}),w}}),function(){var S=P.util.getPointer,w=P.util.degreesToRadians,D=P.util.isTouchEvent;for(var T in P.Canvas=P.util.createClass(P.StaticCanvas,{initialize:function(_,C){C||(C={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(_,C),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=P.PencilBrush&&new P.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var _,C,I,O=this.getActiveObjects();if(O.length>0&&!this.preserveObjectStacking){C=[],I=[];for(var x=0,M=this._objects.length;x<M;x++)-1===O.indexOf(_=this._objects[x])?C.push(_):I.push(_);O.length>1&&(this._activeObject._objects=I),C.push.apply(C,I)}else C=this._objects;return C},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(_){_.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(_),this.contextTopDirty=!0),_.restore()},renderTop:function(){var _=this.contextTop;return this.clearContext(_),this.renderTopLayer(_),this.fire("after:render"),this},_normalizePointer:function(_,C){var I=_.calcTransformMatrix(),O=P.util.invertTransform(I),x=this.restorePointerVpt(C);return P.util.transformPoint(x,O)},isTargetTransparent:function(_,C,I){if(_.shouldCache()&&_._cacheCanvas&&_!==this._activeObject){var O=this._normalizePointer(_,{x:C,y:I}),x=Math.max(_.cacheTranslationX+O.x*_.zoomX,0),M=Math.max(_.cacheTranslationY+O.y*_.zoomY,0);return P.util.isTransparent(_._cacheContext,Math.round(x),Math.round(M),this.targetFindTolerance)}var F=this.contextCache,B=_.selectionBackgroundColor,V=this.viewportTransform;return _.selectionBackgroundColor="",this.clearContext(F),F.save(),F.transform(V[0],V[1],V[2],V[3],V[4],V[5]),_.render(F),F.restore(),_.selectionBackgroundColor=B,P.util.isTransparent(F,C,I,this.targetFindTolerance)},_isSelectionKeyPressed:function(_){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(C){return!0===_[C]}):_[this.selectionKey]},_shouldClearSelection:function(_,C){var I=this.getActiveObjects(),O=this._activeObject;return!C||C&&O&&I.length>1&&-1===I.indexOf(C)&&O!==C&&!this._isSelectionKeyPressed(_)||C&&!C.evented||C&&!C.selectable&&O&&O!==C},_shouldCenterTransform:function(_,C,I){var O;if(_)return"scale"===C||"scaleX"===C||"scaleY"===C||"resizing"===C?O=this.centeredScaling||_.centeredScaling:"rotate"===C&&(O=this.centeredRotation||_.centeredRotation),O?!I:I},_getOriginFromCorner:function(_,C){var I={x:_.originX,y:_.originY};return"ml"===C||"tl"===C||"bl"===C?I.x="right":"mr"!==C&&"tr"!==C&&"br"!==C||(I.x="left"),"tl"===C||"mt"===C||"tr"===C?I.y="bottom":"bl"!==C&&"mb"!==C&&"br"!==C||(I.y="top"),I},_getActionFromCorner:function(_,C,I,O){if(!C||!_)return"drag";var x=O.controls[C];return x.getActionName(I,x,O)},_setupCurrentTransform:function(_,C,I){if(C){var O=this.getPointer(_),x=C.__corner,M=C.controls[x],F=I&&x?M.getActionHandler(_,C,M):P.controlsUtils.dragHandler,B=this._getActionFromCorner(I,x,_,C),V=this._getOriginFromCorner(C,x),W=_[this.centeredKey],G={target:C,action:B,actionHandler:F,corner:x,scaleX:C.scaleX,scaleY:C.scaleY,skewX:C.skewX,skewY:C.skewY,offsetX:O.x-C.left,offsetY:O.y-C.top,originX:V.x,originY:V.y,ex:O.x,ey:O.y,lastX:O.x,lastY:O.y,theta:w(C.angle),width:C.width*C.scaleX,shiftKey:_.shiftKey,altKey:W,original:P.util.saveObjectTransform(C)};this._shouldCenterTransform(C,B,W)&&(G.originX="center",G.originY="center"),G.original.originX=V.x,G.original.originY=V.y,this._currentTransform=G,this._beforeTransform(_)}},setCursor:function(_){this.upperCanvasEl.style.cursor=_},_drawSelection:function(_){var C=this._groupSelector,I=new P.Point(C.ex,C.ey),O=P.util.transformPoint(I,this.viewportTransform),x=new P.Point(C.ex+C.left,C.ey+C.top),M=P.util.transformPoint(x,this.viewportTransform),F=Math.min(O.x,M.x),B=Math.min(O.y,M.y),V=Math.max(O.x,M.x),W=Math.max(O.y,M.y),G=this.selectionLineWidth/2;this.selectionColor&&(_.fillStyle=this.selectionColor,_.fillRect(F,B,V-F,W-B)),this.selectionLineWidth&&this.selectionBorderColor&&(_.lineWidth=this.selectionLineWidth,_.strokeStyle=this.selectionBorderColor,F+=G,B+=G,V-=G,W-=G,P.Object.prototype._setLineDash.call(this,_,this.selectionDashArray),_.strokeRect(F,B,V-F,W-B))},findTarget:function(_,C){if(!this.skipTargetFind){var I,O,x=this.getPointer(_,!0),M=this._activeObject,F=this.getActiveObjects(),B=D(_),V=F.length>1&&!C||1===F.length;if(this.targets=[],V&&M._findTargetCorner(x,B)||F.length>1&&!C&&M===this._searchPossibleTargets([M],x))return M;if(1===F.length&&M===this._searchPossibleTargets([M],x)){if(!this.preserveObjectStacking)return M;I=M,O=this.targets,this.targets=[]}var W=this._searchPossibleTargets(this._objects,x);return _[this.altSelectionKey]&&W&&I&&W!==I&&(W=I,this.targets=O),W}},_checkTarget:function(_,C,I){if(C&&C.visible&&C.evented&&C.containsPoint(_)&&(!this.perPixelTargetFind&&!C.perPixelTargetFind||C.isEditing||!this.isTargetTransparent(C,I.x,I.y)))return!0},_searchPossibleTargets:function(_,C){for(var I,O,x=_.length;x--;){var M=_[x],F=M.group?this._normalizePointer(M.group,C):C;if(this._checkTarget(F,M,C)){(I=_[x]).subTargetCheck&&I instanceof P.Group&&(O=this._searchPossibleTargets(I._objects,C))&&this.targets.push(O);break}}return I},restorePointerVpt:function(_){return P.util.transformPoint(_,P.util.invertTransform(this.viewportTransform))},getPointer:function(_,C){if(this._absolutePointer&&!C)return this._absolutePointer;if(this._pointer&&C)return this._pointer;var I,O=S(_),x=this.upperCanvasEl,M=x.getBoundingClientRect(),F=M.width||0,B=M.height||0;F&&B||("top"in M&&"bottom"in M&&(B=Math.abs(M.top-M.bottom)),"right"in M&&"left"in M&&(F=Math.abs(M.right-M.left))),this.calcOffset(),O.x=O.x-this._offset.left,O.y=O.y-this._offset.top,C||(O=this.restorePointerVpt(O));var V=this.getRetinaScaling();return 1!==V&&(O.x/=V,O.y/=V),{x:O.x*(I=0===F||0===B?{width:1,height:1}:{width:x.width/F,height:x.height/B}).width,y:O.y*I.height}},_createUpperCanvas:function(){var _=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),C=this.lowerCanvasEl,I=this.upperCanvasEl;I?I.className="":(I=this._createCanvasElement(),this.upperCanvasEl=I),P.util.addClass(I,"upper-canvas "+_),this.wrapperEl.appendChild(I),this._copyCanvasStyle(C,I),this._applyCanvasStyle(I),this.contextTop=I.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=P.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),P.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),P.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(_){var C=this.width||_.width,I=this.height||_.height;P.util.setStyle(_,{position:"absolute",width:C+"px",height:I+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),_.width=C,_.height=I,P.util.makeElementUnselectable(_)},_copyCanvasStyle:function(_,C){C.style.cssText=_.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var _=this._activeObject;return _?"activeSelection"===_.type&&_._objects?_._objects.slice(0):[_]:[]},_onObjectRemoved:function(_){_===this._activeObject&&(this.fire("before:selection:cleared",{target:_}),this._discardActiveObject(),this.fire("selection:cleared",{target:_}),_.fire("deselected")),_===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",_)},_fireSelectionEvents:function(_,C){var I=!1,O=this.getActiveObjects(),x=[],M=[];_.forEach(function(F){-1===O.indexOf(F)&&(I=!0,F.fire("deselected",{e:C,target:F}),M.push(F))}),O.forEach(function(F){-1===_.indexOf(F)&&(I=!0,F.fire("selected",{e:C,target:F}),x.push(F))}),_.length>0&&O.length>0?I&&this.fire("selection:updated",{e:C,selected:x,deselected:M}):O.length>0?this.fire("selection:created",{e:C,selected:x}):_.length>0&&this.fire("selection:cleared",{e:C,deselected:M})},setActiveObject:function(_,C){var I=this.getActiveObjects();return this._setActiveObject(_,C),this._fireSelectionEvents(I,C),this},_setActiveObject:function(_,C){return this._activeObject!==_&&!!this._discardActiveObject(C,_)&&!_.onSelect({e:C})&&(this._activeObject=_,!0)},_discardActiveObject:function(_,C){var I=this._activeObject;if(I){if(I.onDeselect({e:_,object:C}))return!1;this._activeObject=null}return!0},discardActiveObject:function(_){var C=this.getActiveObjects(),I=this.getActiveObject();return C.length&&this.fire("before:selection:cleared",{target:I,e:_}),this._discardActiveObject(_),this._fireSelectionEvents(C,_),this},dispose:function(){var _=this.wrapperEl;return this.removeListeners(),_.removeChild(this.upperCanvasEl),_.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(C){P.util.cleanUpJsdomNode(this[C]),this[C]=void 0}.bind(this)),_.parentNode&&_.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,P.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(_){var C=this._activeObject;C&&C._renderControls(_)},_toObject:function(_,C,I){var O=this._realizeGroupTransformOnObject(_),x=this.callSuper("_toObject",_,C,I);return this._unwindGroupTransformOnObject(_,O),x},_realizeGroupTransformOnObject:function(_){if(_.group&&"activeSelection"===_.group.type&&this._activeObject===_.group){var C={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(I){C[I]=_[I]}),P.util.addTransformToObject(_,this._activeObject.calcOwnMatrix()),C}return null},_unwindGroupTransformOnObject:function(_,C){C&&_.set(C)},_setSVGObject:function(_,C,I){var O=this._realizeGroupTransformOnObject(C);this.callSuper("_setSVGObject",_,C,I),this._unwindGroupTransformOnObject(C,O)},setViewportTransform:function(_){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),P.StaticCanvas.prototype.setViewportTransform.call(this,_)}}),P.StaticCanvas)"prototype"!==T&&(P.Canvas[T]=P.StaticCanvas[T])}(),function(){var S=P.util.addListener,w=P.util.removeListener,D={passive:!1};function T(_,C){return _.button&&_.button===C-1}P.util.object.extend(P.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(S,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(_,C){var I=this.upperCanvasEl,O=this._getEventPrefix();_(P.window,"resize",this._onResize),_(I,O+"down",this._onMouseDown),_(I,O+"move",this._onMouseMove,D),_(I,O+"out",this._onMouseOut),_(I,O+"enter",this._onMouseEnter),_(I,"wheel",this._onMouseWheel),_(I,"contextmenu",this._onContextMenu),_(I,"dblclick",this._onDoubleClick),_(I,"dragover",this._onDragOver),_(I,"dragenter",this._onDragEnter),_(I,"dragleave",this._onDragLeave),_(I,"drop",this._onDrop),this.enablePointerEvents||_(I,"touchstart",this._onTouchStart,D),"undefined"!=typeof eventjs&&C in eventjs&&(eventjs[C](I,"gesture",this._onGesture),eventjs[C](I,"drag",this._onDrag),eventjs[C](I,"orientation",this._onOrientationChange),eventjs[C](I,"shake",this._onShake),eventjs[C](I,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(w,"remove");var _=this._getEventPrefix();w(P.document,_+"up",this._onMouseUp),w(P.document,"touchend",this._onTouchEnd,D),w(P.document,_+"move",this._onMouseMove,D),w(P.document,"touchmove",this._onMouseMove,D)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(_,C){this.__onTransformGesture&&this.__onTransformGesture(_,C)},_onDrag:function(_,C){this.__onDrag&&this.__onDrag(_,C)},_onMouseWheel:function(_){this.__onMouseWheel(_)},_onMouseOut:function(_){var C=this._hoveredTarget;this.fire("mouse:out",{target:C,e:_}),this._hoveredTarget=null,C&&C.fire("mouseout",{e:_});var I=this;this._hoveredTargets.forEach(function(O){I.fire("mouse:out",{target:C,e:_}),O&&C.fire("mouseout",{e:_})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(O){O.isEditing&&O.hiddenTextarea.focus()})},_onMouseEnter:function(_){this._currentTransform||this.findTarget(_)||(this.fire("mouse:over",{target:null,e:_}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(_,C){this.__onOrientationChange&&this.__onOrientationChange(_,C)},_onShake:function(_,C){this.__onShake&&this.__onShake(_,C)},_onLongPress:function(_,C){this.__onLongPress&&this.__onLongPress(_,C)},_onDragOver:function(_){_.preventDefault();var C=this._simpleEventHandler("dragover",_);this._fireEnterLeaveEvents(C,_)},_onDrop:function(_){return this._simpleEventHandler("drop:before",_),this._simpleEventHandler("drop",_)},_onContextMenu:function(_){return this.stopContextMenu&&(_.stopPropagation(),_.preventDefault()),!1},_onDoubleClick:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"dblclick"),this._resetTransformEventData(_)},getPointerId:function(_){var C=_.changedTouches;return C?C[0]&&C[0].identifier:this.enablePointerEvents?_.pointerId:-1},_isMainEvent:function(_){return!0===_.isPrimary||!1!==_.isPrimary&&("touchend"===_.type&&0===_.touches.length||!_.changedTouches||_.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(_){_.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(_)),this.__onMouseDown(_),this._resetTransformEventData();var C=this.upperCanvasEl,I=this._getEventPrefix();S(P.document,"touchend",this._onTouchEnd,D),S(P.document,"touchmove",this._onMouseMove,D),w(C,I+"down",this._onMouseDown)},_onMouseDown:function(_){this.__onMouseDown(_),this._resetTransformEventData();var C=this.upperCanvasEl,I=this._getEventPrefix();w(C,I+"move",this._onMouseMove,D),S(P.document,I+"up",this._onMouseUp),S(P.document,I+"move",this._onMouseMove,D)},_onTouchEnd:function(_){if(!(_.touches.length>0)){this.__onMouseUp(_),this._resetTransformEventData(),this.mainTouchId=null;var C=this._getEventPrefix();w(P.document,"touchend",this._onTouchEnd,D),w(P.document,"touchmove",this._onMouseMove,D);var I=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){S(I.upperCanvasEl,C+"down",I._onMouseDown),I._willAddMouseDown=0},400)}},_onMouseUp:function(_){this.__onMouseUp(_),this._resetTransformEventData();var C=this.upperCanvasEl,I=this._getEventPrefix();this._isMainEvent(_)&&(w(P.document,I+"up",this._onMouseUp),w(P.document,I+"move",this._onMouseMove,D),S(C,I+"move",this._onMouseMove,D))},_onMouseMove:function(_){!this.allowTouchScrolling&&_.preventDefault&&_.preventDefault(),this.__onMouseMove(_)},_onResize:function(){this.calcOffset()},_shouldRender:function(_){var C=this._activeObject;return!!(!!C!=!!_||C&&_&&C!==_)||!1},__onMouseUp:function(_){var C,I=this._currentTransform,O=this._groupSelector,x=!1,M=!O||0===O.left&&0===O.top;if(this._cacheTransformEventData(_),C=this._target,this._handleEvent(_,"up:before"),T(_,3))this.fireRightClick&&this._handleEvent(_,"up",3,M);else{if(T(_,2))return this.fireMiddleClick&&this._handleEvent(_,"up",2,M),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(_);else if(this._isMainEvent(_)){if(I&&(this._finalizeCurrentTransform(_),x=I.actionPerformed),!M){var F=C===this._activeObject;this._maybeGroupObjects(_),x||(x=this._shouldRender(C)||!F&&C===this._activeObject)}var B,V;if(C){if(B=C._findTargetCorner(this.getPointer(_,!0),P.util.isTouchEvent(_)),C.selectable&&C!==this._activeObject&&"up"===C.activeOn)this.setActiveObject(C,_),x=!0;else{var W=C.controls[B],G=W&&W.getMouseUpHandler(_,C,W);G&&G(_,I,(V=this.getPointer(_)).x,V.y)}C.isMoving=!1}if(I&&(I.target!==C||I.corner!==B)){var Y=I.target&&I.target.controls[I.corner],Z=Y&&Y.getMouseUpHandler(_,C,W);V=V||this.getPointer(_),Z&&Z(_,I,V.x,V.y)}this._setCursorFromEvent(_,C),this._handleEvent(_,"up",1,M),this._groupSelector=null,this._currentTransform=null,C&&(C.__corner=0),x?this.requestRenderAll():M||this.renderTop()}}},_simpleEventHandler:function(_,C){var I=this.findTarget(C),O=this.targets,x={e:C,target:I,subTargets:O};if(this.fire(_,x),I&&I.fire(_,x),!O)return I;for(var M=0;M<O.length;M++)O[M].fire(_,x);return I},_handleEvent:function(_,C,I,O){var x=this._target,M=this.targets||[],F={e:_,target:x,subTargets:M,button:I||1,isClick:O||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===C&&(F.currentTarget=this.findTarget(_),F.currentSubTargets=this.targets),this.fire("mouse:"+C,F),x&&x.fire("mouse"+C,F);for(var B=0;B<M.length;B++)M[B].fire("mouse"+C,F)},_finalizeCurrentTransform:function(_){var C=this._currentTransform,I=C.target,O={e:_,target:I,transform:C,action:C.action};I._scaling&&(I._scaling=!1),I.setCoords(),(C.actionPerformed||this.stateful&&I.hasStateChanged())&&this._fire("modified",O)},_onMouseDownInDrawingMode:function(_){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(_).requestRenderAll();var C=this.getPointer(_);this.freeDrawingBrush.onMouseDown(C,{e:_,pointer:C}),this._handleEvent(_,"down")},_onMouseMoveInDrawingMode:function(_){if(this._isCurrentlyDrawing){var C=this.getPointer(_);this.freeDrawingBrush.onMouseMove(C,{e:_,pointer:C})}this.setCursor(this.freeDrawingCursor),this._handleEvent(_,"move")},_onMouseUpInDrawingMode:function(_){var C=this.getPointer(_);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:_,pointer:C}),this._handleEvent(_,"up")},__onMouseDown:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"down:before");var C=this._target;if(T(_,3))this.fireRightClick&&this._handleEvent(_,"down",3);else if(T(_,2))this.fireMiddleClick&&this._handleEvent(_,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(_);else if(this._isMainEvent(_)&&!this._currentTransform){var I=this._pointer;this._previousPointer=I;var O=this._shouldRender(C),x=this._shouldGroup(_,C);if(this._shouldClearSelection(_,C)?this.discardActiveObject(_):x&&(this._handleGrouping(_,C),C=this._activeObject),!this.selection||C&&(C.selectable||C.isEditing||C===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),C){var M=C===this._activeObject;C.selectable&&"down"===C.activeOn&&this.setActiveObject(C,_);var F=C._findTargetCorner(this.getPointer(_,!0),P.util.isTouchEvent(_));if(C.__corner=F,C===this._activeObject&&(F||!x)){this._setupCurrentTransform(_,C,M);var B=C.controls[F],V=(I=this.getPointer(_),B&&B.getMouseDownHandler(_,C,B));V&&V(_,this._currentTransform,I.x,I.y)}}this._handleEvent(_,"down"),(O||x)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(_){this._resetTransformEventData(),this._pointer=this.getPointer(_,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(_)||null},_beforeTransform:function(_){var C=this._currentTransform;this.stateful&&C.target.saveState(),this.fire("before:transform",{e:_,transform:C})},__onMouseMove:function(_){var C,I;if(this._handleEvent(_,"move:before"),this._cacheTransformEventData(_),this.isDrawingMode)this._onMouseMoveInDrawingMode(_);else if(this._isMainEvent(_)){var O=this._groupSelector;O?(O.left=(I=this._absolutePointer).x-O.ex,O.top=I.y-O.ey,this.renderTop()):this._currentTransform?this._transformObject(_):(C=this.findTarget(_)||null,this._setCursorFromEvent(_,C),this._fireOverOutEvents(C,_)),this._handleEvent(_,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(_,C){var I=this._hoveredTarget,O=this._hoveredTargets,x=this.targets,M=Math.max(O.length,x.length);this.fireSyntheticInOutEvents(_,C,{oldTarget:I,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var F=0;F<M;F++)this.fireSyntheticInOutEvents(x[F],C,{oldTarget:O[F],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=_,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(_,C){var I=this._draggedoverTarget,O=this._hoveredTargets,x=this.targets,M=Math.max(O.length,x.length);this.fireSyntheticInOutEvents(_,C,{oldTarget:I,evtOut:"dragleave",evtIn:"dragenter"});for(var F=0;F<M;F++)this.fireSyntheticInOutEvents(x[F],C,{oldTarget:O[F],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=_},fireSyntheticInOutEvents:function(_,C,I){var O,x,M,F=I.oldTarget,B=F!==_,V=I.canvasEvtIn,W=I.canvasEvtOut;B&&(O={e:C,target:_,previousTarget:F},x={e:C,target:F,nextTarget:_}),M=_&&B,F&&B&&(W&&this.fire(W,x),F.fire(I.evtOut,x)),M&&(V&&this.fire(V,O),_.fire(I.evtIn,O))},__onMouseWheel:function(_){this._cacheTransformEventData(_),this._handleEvent(_,"wheel"),this._resetTransformEventData()},_transformObject:function(_){var C=this.getPointer(_),I=this._currentTransform;I.reset=!1,I.shiftKey=_.shiftKey,I.altKey=_[this.centeredKey],this._performTransformAction(_,I,C),I.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(_,C,I){var M=C.action,F=!1,B=C.actionHandler;B&&(F=B(_,C,I.x,I.y)),"drag"===M&&F&&(C.target.isMoving=!0,this.setCursor(C.target.moveCursor||this.moveCursor)),C.actionPerformed=C.actionPerformed||F},_fire:P.controlsUtils.fireEvent,_setCursorFromEvent:function(_,C){if(!C)return this.setCursor(this.defaultCursor),!1;var I=C.hoverCursor||this.hoverCursor,O=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,x=(!O||!O.contains(C))&&C._findTargetCorner(this.getPointer(_,!0));x?this.setCursor(this.getCornerCursor(x,C,_)):(C.subTargetCheck&&this.targets.concat().reverse().map(function(M){I=M.hoverCursor||I}),this.setCursor(I))},getCornerCursor:function(_,C,I){var O=C.controls[_];return O.cursorStyleHandler(I,O,C)}})}(),X=Math.min,Q=Math.max,P.util.object.extend(P.Canvas.prototype,{_shouldGroup:function(S,w){var D=this._activeObject;return D&&this._isSelectionKeyPressed(S)&&w&&w.selectable&&this.selection&&(D!==w||"activeSelection"===D.type)&&!w.onSelect({e:S})},_handleGrouping:function(S,w){var D=this._activeObject;D.__corner||(w!==D||(w=this.findTarget(S,!0))&&w.selectable)&&(D&&"activeSelection"===D.type?this._updateActiveSelection(w,S):this._createActiveSelection(w,S))},_updateActiveSelection:function(S,w){var D=this._activeObject,T=D._objects.slice(0);D.contains(S)?(D.removeWithUpdate(S),this._hoveredTarget=S,this._hoveredTargets=this.targets.concat(),1===D.size()&&this._setActiveObject(D.item(0),w)):(D.addWithUpdate(S),this._hoveredTarget=D,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(T,w)},_createActiveSelection:function(S,w){var D=this.getActiveObjects(),T=this._createGroup(S);this._hoveredTarget=T,this._setActiveObject(T,w),this._fireSelectionEvents(D,w)},_createGroup:function(S){var w=this._objects,D=w.indexOf(this._activeObject)<w.indexOf(S)?[this._activeObject,S]:[S,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new P.ActiveSelection(D,{canvas:this})},_groupSelectedObjects:function(S){var w,D=this._collectObjects(S);1===D.length?this.setActiveObject(D[0],S):D.length>1&&(w=new P.ActiveSelection(D.reverse(),{canvas:this}),this.setActiveObject(w,S))},_collectObjects:function(S){for(var w,D=[],T=this._groupSelector.ex,_=this._groupSelector.ey,C=T+this._groupSelector.left,I=_+this._groupSelector.top,O=new P.Point(X(T,C),X(_,I)),x=new P.Point(Q(T,C),Q(_,I)),M=!this.selectionFullyContained,F=T===C&&_===I,B=this._objects.length;B--&&!((w=this._objects[B])&&w.selectable&&w.visible&&(M&&w.intersectsWithRect(O,x,!0)||w.isContainedWithinRect(O,x,!0)||M&&w.containsPoint(O,null,!0)||M&&w.containsPoint(x,null,!0))&&(D.push(w),F)););return D.length>1&&(D=D.filter(function(V){return!V.onSelect({e:S})})),D},_maybeGroupObjects:function(S){this.selection&&this._groupSelector&&this._groupSelectedObjects(S),this.setCursor(this.defaultCursor),this._groupSelector=null}}),P.util.object.extend(P.StaticCanvas.prototype,{toDataURL:function(S){S||(S={});var w=S.format||"png",D=S.quality||1,T=(S.multiplier||1)*(S.enableRetinaScaling?this.getRetinaScaling():1),_=this.toCanvasElement(T,S);return P.util.toDataURL(_,w,D)},toCanvasElement:function(S,w){var D=((w=w||{}).width||this.width)*(S=S||1),T=(w.height||this.height)*S,_=this.getZoom(),C=this.width,I=this.height,O=_*S,x=this.viewportTransform,B=this.interactive,V=[O,0,0,O,(x[4]-(w.left||0))*S,(x[5]-(w.top||0))*S],W=this.enableRetinaScaling,G=P.util.createCanvasElement(),Y=this.contextTop;return G.width=D,G.height=T,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=V,this.width=D,this.height=T,this.calcViewportBoundaries(),this.renderCanvas(G.getContext("2d"),this._objects),this.viewportTransform=x,this.width=C,this.height=I,this.calcViewportBoundaries(),this.interactive=B,this.enableRetinaScaling=W,this.contextTop=Y,G}}),P.util.object.extend(P.StaticCanvas.prototype,{loadFromJSON:function(S,w,D){if(S){var T="string"==typeof S?JSON.parse(S):P.util.object.clone(S),_=this,C=T.clipPath,I=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete T.clipPath,this._enlivenObjects(T.objects,function(O){_.clear(),_._setBgOverlay(T,function(){C?_._enlivenObjects([C],function(x){_.clipPath=x[0],_.__setupCanvas.call(_,T,O,I,w)}):_.__setupCanvas.call(_,T,O,I,w)})},D),this}},__setupCanvas:function(S,w,D,T){var _=this;w.forEach(function(C,I){_.insertAt(C,I)}),this.renderOnAddRemove=D,delete S.objects,delete S.backgroundImage,delete S.overlayImage,delete S.background,delete S.overlay,this._setOptions(S),this.renderAll(),T&&T()},_setBgOverlay:function(S,w){var D={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(S.backgroundImage||S.overlayImage||S.background||S.overlay){var T=function(){D.backgroundImage&&D.overlayImage&&D.backgroundColor&&D.overlayColor&&w&&w()};this.__setBgOverlay("backgroundImage",S.backgroundImage,D,T),this.__setBgOverlay("overlayImage",S.overlayImage,D,T),this.__setBgOverlay("backgroundColor",S.background,D,T),this.__setBgOverlay("overlayColor",S.overlay,D,T)}else w&&w()},__setBgOverlay:function(S,w,D,T){var _=this;if(!w)return D[S]=!0,void(T&&T());"backgroundImage"===S||"overlayImage"===S?P.util.enlivenObjects([w],function(C){_[S]=C[0],D[S]=!0,T&&T()}):this["set"+P.util.string.capitalize(S,!0)](w,function(){D[S]=!0,T&&T()})},_enlivenObjects:function(S,w,D){S&&0!==S.length?P.util.enlivenObjects(S,function(T){w&&w(T)},null,D):w&&w([])},_toDataURL:function(S,w){this.clone(function(D){w(D.toDataURL(S))})},_toDataURLWithMultiplier:function(S,w,D){this.clone(function(T){D(T.toDataURLWithMultiplier(S,w))})},clone:function(S,w){var D=JSON.stringify(this.toJSON(w));this.cloneWithoutData(function(T){T.loadFromJSON(D,function(){S&&S(T)})})},cloneWithoutData:function(S){var w=P.util.createCanvasElement();w.width=this.width,w.height=this.height;var D=new P.Canvas(w);this.backgroundImage?(D.setBackgroundImage(this.backgroundImage.src,function(){D.renderAll(),S&&S(D)}),D.backgroundImageOpacity=this.backgroundImageOpacity,D.backgroundImageStretch=this.backgroundImageStretch):S&&S(D)}}),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.util.object.clone,_=w.util.toFixed,C=w.util.string.capitalize,I=w.util.degreesToRadians;w.Object||(w.Object=w.util.createClass(w.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!w.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(x){x&&this.setOptions(x)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=w.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(x){var M=w.perfLimitSizeTotal,F=x.width,B=x.height,V=w.maxCacheSideLimit,W=w.minCacheSideLimit;if(F<=V&&B<=V&&F*B<=M)return F<W&&(x.width=W),B<W&&(x.height=W),x;var Y=w.util.limitDimsByArea(F/B,M),Z=w.util.capValue,ie=Z(W,Y.x,V),se=Z(W,Y.y,V);return F>ie&&(x.zoomX/=F/ie,x.width=ie,x.capped=!0),B>se&&(x.zoomY/=B/se,x.height=se,x.capped=!0),x},_getCacheCanvasDimensions:function(){var x=this.getTotalObjectScaling(),M=this._getTransformedDimensions(0,0),F=M.x*x.scaleX/this.scaleX,B=M.y*x.scaleY/this.scaleY;return{width:F+2,height:B+2,zoomX:x.scaleX,zoomY:x.scaleY,x:F,y:B}},_updateCacheCanvas:function(){var x=this.canvas;if(this.noScaleCache&&x&&x._currentTransform){var F=x._currentTransform.action;if(this===x._currentTransform.target&&F.slice&&"scale"===F.slice(0,5))return!1}var B,V,W=this._cacheCanvas,G=this._limitCacheSize(this._getCacheCanvasDimensions()),Y=w.minCacheSideLimit,Z=G.width,ie=G.height,se=G.zoomX,de=G.zoomY,ce=Z!==this.cacheWidth||ie!==this.cacheHeight,ee=ce||this.zoomX!==se||this.zoomY!==de,J=0,oe=0,he=!1;if(ce){var fe=this._cacheCanvas.width,ne=this._cacheCanvas.height,te=Z>fe||ie>ne;he=te||(Z<.9*fe||ie<.9*ne)&&fe>Y&&ne>Y,te&&!G.capped&&(Z>Y||ie>Y)&&(J=.1*Z,oe=.1*ie)}return this instanceof w.Text&&this.path&&(ee=!0,he=!0,J+=this.getHeightOfLine(0)*this.zoomX,oe+=this.getHeightOfLine(0)*this.zoomY),!!ee&&(he?(W.width=Math.ceil(Z+J),W.height=Math.ceil(ie+oe)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,W.width,W.height)),B=G.x/2,V=G.y/2,this.cacheTranslationX=Math.round(W.width/2-B)+B,this.cacheTranslationY=Math.round(W.height/2-V)+V,this.cacheWidth=Z,this.cacheHeight=ie,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(se,de),this.zoomX=se,this.zoomY=de,!0)},setOptions:function(x){this._setOptions(x),this._initGradient(x.fill,"fill"),this._initGradient(x.stroke,"stroke"),this._initPattern(x.fill,"fill"),this._initPattern(x.stroke,"stroke")},transform:function(x){var F=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&x===this.canvas.contextTop));x.transform(F[0],F[1],F[2],F[3],F[4],F[5])},toObject:function(x){var M=w.Object.NUM_FRACTION_DIGITS,F={type:this.type,version:w.version,originX:this.originX,originY:this.originY,left:_(this.left,M),top:_(this.top,M),width:_(this.width,M),height:_(this.height,M),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:_(this.strokeWidth,M),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:_(this.strokeMiterLimit,M),scaleX:_(this.scaleX,M),scaleY:_(this.scaleY,M),angle:_(this.angle,M),flipX:this.flipX,flipY:this.flipY,opacity:_(this.opacity,M),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:_(this.skewX,M),skewY:_(this.skewY,M)};return this.clipPath&&!this.clipPath.excludeFromExport&&(F.clipPath=this.clipPath.toObject(x),F.clipPath.inverted=this.clipPath.inverted,F.clipPath.absolutePositioned=this.clipPath.absolutePositioned),w.util.populateWithProperties(this,F,x),this.includeDefaultValues||(F=this._removeDefaultValues(F)),F},toDatalessObject:function(x){return this.toObject(x)},_removeDefaultValues:function(x){var M=w.util.getKlass(x.type).prototype;return M.stateProperties.forEach(function(F){"left"!==F&&"top"!==F&&(x[F]===M[F]&&delete x[F],Array.isArray(x[F])&&Array.isArray(M[F])&&0===x[F].length&&0===M[F].length&&delete x[F])}),x},toString:function(){return"#<fabric."+C(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var x=w.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(x.scaleX),scaleY:Math.abs(x.scaleY)}},getTotalObjectScaling:function(){var x=this.getObjectScaling(),M=x.scaleX,F=x.scaleY;if(this.canvas){var B=this.canvas.getZoom(),V=this.canvas.getRetinaScaling();M*=B*V,F*=B*V}return{scaleX:M,scaleY:F}},getObjectOpacity:function(){var x=this.opacity;return this.group&&(x*=this.group.getObjectOpacity()),x},_set:function(x,M){var B=this[x]!==M,V=!1;return("scaleX"===x||"scaleY"===x)&&(M=this._constrainScale(M)),"scaleX"===x&&M<0?(this.flipX=!this.flipX,M*=-1):"scaleY"===x&&M<0?(this.flipY=!this.flipY,M*=-1):"shadow"!==x||!M||M instanceof w.Shadow?"dirty"===x&&this.group&&this.group.set("dirty",M):M=new w.Shadow(M),this[x]=M,B&&(V=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(x)>-1?(this.dirty=!0,V&&this.group.set("dirty",!0)):V&&this.stateProperties.indexOf(x)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:w.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(x){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(x.save(),this._setupCompositeOperation(x),this.drawSelectionBackground(x),this.transform(x),this._setOpacity(x),this._setShadow(x,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(x)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(x),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),x.restore())},renderCache:function(x){x=x||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,x.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(x,M){if(x.save(),x.globalCompositeOperation=M.inverted?"destination-out":"destination-in",M.absolutePositioned){var F=w.util.invertTransform(this.calcTransformMatrix());x.transform(F[0],F[1],F[2],F[3],F[4],F[5])}M.transform(x),x.scale(1/M.zoomX,1/M.zoomY),x.drawImage(M._cacheCanvas,-M.cacheTranslationX,-M.cacheTranslationY),x.restore()},drawObject:function(x,M){var F=this.fill,B=this.stroke;M?(this.fill="black",this.stroke="",this._setClippingProperties(x)):this._renderBackground(x),this._render(x),this._drawClipPath(x,this.clipPath),this.fill=F,this.stroke=B},_drawClipPath:function(x,M){M&&(M.canvas=this.canvas,M.shouldCache(),M._transformDone=!0,M.renderCache({forClipping:!0}),this.drawClipPathOnCache(x,M))},drawCacheOnCanvas:function(x){x.scale(1/this.zoomX,1/this.zoomY),x.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(x){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!x&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!x){var M=this.cacheWidth/this.zoomX,F=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-M/2,-F/2,M,F)}return!0}return!1},_renderBackground:function(x){if(this.backgroundColor){var M=this._getNonTransformedDimensions();x.fillStyle=this.backgroundColor,x.fillRect(-M.x/2,-M.y/2,M.x,M.y),this._removeShadow(x)}},_setOpacity:function(x){this.group&&!this.group._transformDone?x.globalAlpha=this.getObjectOpacity():x.globalAlpha*=this.opacity},_setStrokeStyles:function(x,M){var F=M.stroke;F&&(x.lineWidth=M.strokeWidth,x.lineCap=M.strokeLineCap,x.lineDashOffset=M.strokeDashOffset,x.lineJoin=M.strokeLineJoin,x.miterLimit=M.strokeMiterLimit,F.toLive?"percentage"===F.gradientUnits||F.gradientTransform||F.patternTransform?this._applyPatternForTransformedGradient(x,F):(x.strokeStyle=F.toLive(x,this),this._applyPatternGradientTransform(x,F)):x.strokeStyle=M.stroke)},_setFillStyles:function(x,M){var F=M.fill;F&&(F.toLive?(x.fillStyle=F.toLive(x,this),this._applyPatternGradientTransform(x,M.fill)):x.fillStyle=F)},_setClippingProperties:function(x){x.globalAlpha=1,x.strokeStyle="transparent",x.fillStyle="#000000"},_setLineDash:function(x,M){M&&0!==M.length&&(1&M.length&&M.push.apply(M,M),x.setLineDash(M))},_renderControls:function(x,M){var F,B,V,W=this.getViewportTransform(),G=this.calcTransformMatrix();B=void 0!==(M=M||{}).hasBorders?M.hasBorders:this.hasBorders,V=void 0!==M.hasControls?M.hasControls:this.hasControls,G=w.util.multiplyTransformMatrices(W,G),F=w.util.qrDecompose(G),x.save(),x.translate(F.translateX,F.translateY),x.lineWidth=1*this.borderScaleFactor,this.group||(x.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(F.angle-=180),x.rotate(I(this.group?F.angle:this.angle)),M.forActiveSelection||this.group?B&&this.drawBordersInGroup(x,F,M):B&&this.drawBorders(x,M),V&&this.drawControls(x,M),x.restore()},_setShadow:function(x){if(this.shadow){var M,F=this.shadow,B=this.canvas,V=B&&B.viewportTransform[0]||1,W=B&&B.viewportTransform[3]||1;M=F.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),B&&B._isRetinaScaling()&&(V*=w.devicePixelRatio,W*=w.devicePixelRatio),x.shadowColor=F.color,x.shadowBlur=F.blur*w.browserShadowBlurConstant*(V+W)*(M.scaleX+M.scaleY)/4,x.shadowOffsetX=F.offsetX*V*M.scaleX,x.shadowOffsetY=F.offsetY*W*M.scaleY}},_removeShadow:function(x){this.shadow&&(x.shadowColor="",x.shadowBlur=x.shadowOffsetX=x.shadowOffsetY=0)},_applyPatternGradientTransform:function(x,M){if(!M||!M.toLive)return{offsetX:0,offsetY:0};var F=M.gradientTransform||M.patternTransform,B=-this.width/2+M.offsetX||0,V=-this.height/2+M.offsetY||0;return"percentage"===M.gradientUnits?x.transform(this.width,0,0,this.height,B,V):x.transform(1,0,0,1,B,V),F&&x.transform(F[0],F[1],F[2],F[3],F[4],F[5]),{offsetX:B,offsetY:V}},_renderPaintInOrder:function(x){"stroke"===this.paintFirst?(this._renderStroke(x),this._renderFill(x)):(this._renderFill(x),this._renderStroke(x))},_render:function(){},_renderFill:function(x){this.fill&&(x.save(),this._setFillStyles(x,this),"evenodd"===this.fillRule?x.fill("evenodd"):x.fill(),x.restore())},_renderStroke:function(x){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(x),x.save(),this.strokeUniform&&this.group){var M=this.getObjectScaling();x.scale(1/M.scaleX,1/M.scaleY)}else this.strokeUniform&&x.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(x,this.strokeDashArray),this._setStrokeStyles(x,this),x.stroke(),x.restore()}},_applyPatternForTransformedGradient:function(x,M){var F,B=this._limitCacheSize(this._getCacheCanvasDimensions()),V=w.util.createCanvasElement(),W=this.canvas.getRetinaScaling(),G=B.x/this.scaleX/W,Y=B.y/this.scaleY/W;V.width=G,V.height=Y,(F=V.getContext("2d")).beginPath(),F.moveTo(0,0),F.lineTo(G,0),F.lineTo(G,Y),F.lineTo(0,Y),F.closePath(),F.translate(G/2,Y/2),F.scale(B.zoomX/this.scaleX/W,B.zoomY/this.scaleY/W),this._applyPatternGradientTransform(F,M),F.fillStyle=M.toLive(x),F.fill(),x.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),x.scale(W*this.scaleX/B.zoomX,W*this.scaleY/B.zoomY),x.strokeStyle=F.createPattern(V,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var x=w.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",x.scaleX),this.set("scaleY",x.scaleY),this.angle=x.angle,this.skewX=x.skewX,this.skewY=0}},_removeTransformMatrix:function(x){var M=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),M=w.util.transformPoint(M,this.transformMatrix)),this.transformMatrix=null,x&&(this.scaleX*=x.scaleX,this.scaleY*=x.scaleY,this.cropX=x.cropX,this.cropY=x.cropY,M.x+=x.offsetLeft,M.y+=x.offsetTop,this.width=x.width,this.height=x.height),this.setPositionByOrigin(M,"center","center")},clone:function(x,M){var F=this.toObject(M);this.constructor.fromObject?this.constructor.fromObject(F,x):w.Object._fromObject("Object",F,x)},cloneAsImage:function(x,M){var F=this.toCanvasElement(M);return x&&x(new w.Image(F)),this},toCanvasElement:function(x){x||(x={});var M=w.util,F=M.saveObjectTransform(this),B=this.group,V=this.shadow,W=Math.abs,G=(x.multiplier||1)*(x.enableRetinaScaling?w.devicePixelRatio:1);delete this.group,x.withoutTransform&&M.resetObjectTransform(this),x.withoutShadow&&(this.shadow=null);var Y,Z,se,de=w.util.createCanvasElement(),ce=this.getBoundingRect(!0,!0),le=this.shadow,ee={x:0,y:0};le&&(Z=le.blur,Y=le.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),ee.x=2*Math.round(W(le.offsetX)+Z)*W(Y.scaleX),ee.y=2*Math.round(W(le.offsetY)+Z)*W(Y.scaleY)),se=ce.height+ee.y,de.width=Math.ceil(ce.width+ee.x),de.height=Math.ceil(se);var J=new w.StaticCanvas(de,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===x.format&&(J.backgroundColor="#fff"),this.setPositionByOrigin(new w.Point(J.width/2,J.height/2),"center","center");var oe=this.canvas;J.add(this);var he=J.toCanvasElement(G||1,x);return this.shadow=V,this.set("canvas",oe),B&&(this.group=B),this.set(F).setCoords(),J._objects=[],J.dispose(),J=null,he},toDataURL:function(x){return x||(x={}),w.util.toDataURL(this.toCanvasElement(x),x.format||"png",x.quality||1)},isType:function(x){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===x},complexity:function(){return 1},toJSON:function(x){return this.toObject(x)},rotate:function(x){var M=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return M&&this._setOriginToCenter(),this.set("angle",x),M&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(x,M){M=M||this.canvas.getPointer(x);var F=new w.Point(M.x,M.y),B=this._getLeftTopCoords();return this.angle&&(F=w.util.rotatePoint(F,B,I(-this.angle))),{x:F.x-B.x,y:F.y-B.y}},_setupCompositeOperation:function(x){this.globalCompositeOperation&&(x.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){w.runningAnimations&&w.runningAnimations.cancelByTarget(this)}}),w.util.createAccessors&&w.util.createAccessors(w.Object),D(w.Object.prototype,w.Observable),w.Object.NUM_FRACTION_DIGITS=2,w.Object.ENLIVEN_PROPS=["clipPath"],w.Object._fromObject=function(x,M,F,B){var V=w[x];M=T(M,!0),w.util.enlivenPatterns([M.fill,M.stroke],function(W){void 0!==W[0]&&(M.fill=W[0]),void 0!==W[1]&&(M.stroke=W[1]),w.util.enlivenObjectEnlivables(M,M,function(){var G=B?new V(M[B],M):new V(M);F&&F(G)})})},w.Object.__uid=0)}(l),pe=P.util.degreesToRadians,_e={left:-.5,center:0,right:.5},Te={top:-.5,center:0,bottom:.5},P.util.object.extend(P.Object.prototype,{translateToGivenOrigin:function(S,w,D,T,_){var C,I,O,x=S.x,M=S.y;return"string"==typeof w?w=_e[w]:w-=.5,"string"==typeof T?T=_e[T]:T-=.5,"string"==typeof D?D=Te[D]:D-=.5,"string"==typeof _?_=Te[_]:_-=.5,I=_-D,((C=T-w)||I)&&(O=this._getTransformedDimensions(),x=S.x+C*O.x,M=S.y+I*O.y),new P.Point(x,M)},translateToCenterPoint:function(S,w,D){var T=this.translateToGivenOrigin(S,w,D,"center","center");return this.angle?P.util.rotatePoint(T,S,pe(this.angle)):T},translateToOriginPoint:function(S,w,D){var T=this.translateToGivenOrigin(S,"center","center",w,D);return this.angle?P.util.rotatePoint(T,S,pe(this.angle)):T},getCenterPoint:function(){var S=new P.Point(this.left,this.top);return this.translateToCenterPoint(S,this.originX,this.originY)},getPointByOrigin:function(S,w){var D=this.getCenterPoint();return this.translateToOriginPoint(D,S,w)},toLocalPoint:function(S,w,D){var T,_,C=this.getCenterPoint();return T=void 0!==w&&void 0!==D?this.translateToGivenOrigin(C,"center","center",w,D):new P.Point(this.left,this.top),_=new P.Point(S.x,S.y),this.angle&&(_=P.util.rotatePoint(_,C,-pe(this.angle))),_.subtractEquals(T)},setPositionByOrigin:function(S,w,D){var T=this.translateToCenterPoint(S,w,D),_=this.translateToOriginPoint(T,this.originX,this.originY);this.set("left",_.x),this.set("top",_.y)},adjustPosition:function(S){var w,D,T=pe(this.angle),_=this.getScaledWidth(),C=P.util.cos(T)*_,I=P.util.sin(T)*_;this.left+=C*((D="string"==typeof S?_e[S]:S-.5)-(w="string"==typeof this.originX?_e[this.originX]:this.originX-.5)),this.top+=I*(D-w),this.setCoords(),this.originX=S},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var S=this.getCenterPoint();this.originX="center",this.originY="center",this.left=S.x,this.top=S.y},_resetOrigin:function(){var S=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=S.x,this.top=S.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var S=P.util,w=S.degreesToRadians,D=S.multiplyTransformMatrices,T=S.transformPoint;S.object.extend(P.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(_,C){return C?_?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),_?this.aCoords:this.lineCoords)},getCoords:function(_,C){return I=this._getCoords(_,C),[new P.Point(I.tl.x,I.tl.y),new P.Point(I.tr.x,I.tr.y),new P.Point(I.br.x,I.br.y),new P.Point(I.bl.x,I.bl.y)];var I},intersectsWithRect:function(_,C,I,O){var x=this.getCoords(I,O);return"Intersection"===P.Intersection.intersectPolygonRectangle(x,_,C).status},intersectsWithObject:function(_,C,I){return"Intersection"===P.Intersection.intersectPolygonPolygon(this.getCoords(C,I),_.getCoords(C,I)).status||_.isContainedWithinObject(this,C,I)||this.isContainedWithinObject(_,C,I)},isContainedWithinObject:function(_,C,I){for(var O=this.getCoords(C,I),M=0,F=_._getImageLines(C?_.aCoords:_.lineCoords);M<4;M++)if(!_.containsPoint(O[M],F))return!1;return!0},isContainedWithinRect:function(_,C,I,O){var x=this.getBoundingRect(I,O);return x.left>=_.x&&x.left+x.width<=C.x&&x.top>=_.y&&x.top+x.height<=C.y},containsPoint:function(_,C,I,O){var x=this._getCoords(I,O),M=(C=C||this._getImageLines(x),this._findCrossPoints(_,C));return 0!==M&&M%2==1},isOnScreen:function(_){if(!this.canvas)return!1;var C=this.canvas.vptCoords.tl,I=this.canvas.vptCoords.br;return!!this.getCoords(!0,_).some(function(O){return O.x<=I.x&&O.x>=C.x&&O.y<=I.y&&O.y>=C.y})||!!this.intersectsWithRect(C,I,!0,_)||this._containsCenterOfCanvas(C,I,_)},_containsCenterOfCanvas:function(_,C,I){return!!this.containsPoint({x:(_.x+C.x)/2,y:(_.y+C.y)/2},null,!0,I)},isPartiallyOnScreen:function(_){if(!this.canvas)return!1;var C=this.canvas.vptCoords.tl,I=this.canvas.vptCoords.br;return!!this.intersectsWithRect(C,I,!0,_)||this.getCoords(!0,_).every(function(O){return(O.x>=I.x||O.x<=C.x)&&(O.y>=I.y||O.y<=C.y)})&&this._containsCenterOfCanvas(C,I,_)},_getImageLines:function(_){return{topline:{o:_.tl,d:_.tr},rightline:{o:_.tr,d:_.br},bottomline:{o:_.br,d:_.bl},leftline:{o:_.bl,d:_.tl}}},_findCrossPoints:function(_,C){var I,O,x,M=0;for(var F in C)if(!((x=C[F]).o.y<_.y&&x.d.y<_.y||x.o.y>=_.y&&x.d.y>=_.y||(x.o.x===x.d.x&&x.o.x>=_.x?O=x.o.x:(I=(x.d.y-x.o.y)/(x.d.x-x.o.x),O=-(_.y-0*_.x-(x.o.y-I*x.o.x))/(0-I)),O>=_.x&&(M+=1),2!==M)))break;return M},getBoundingRect:function(_,C){var I=this.getCoords(_,C);return S.makeBoundingBoxFromPoints(I)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(_){return Math.abs(_)<this.minScaleLimit?_<0?-this.minScaleLimit:this.minScaleLimit:0===_?1e-4:_},scale:function(_){return this._set("scaleX",_),this._set("scaleY",_),this.setCoords()},scaleToWidth:function(_,C){var I=this.getBoundingRect(C).width/this.getScaledWidth();return this.scale(_/this.width/I)},scaleToHeight:function(_,C){var I=this.getBoundingRect(C).height/this.getScaledHeight();return this.scale(_/this.height/I)},calcLineCoords:function(){var _=this.getViewportTransform(),C=this.padding,I=w(this.angle),O=S.cos(I)*C,x=S.sin(I)*C,M=O+x,F=O-x,B=this.calcACoords(),V={tl:T(B.tl,_),tr:T(B.tr,_),bl:T(B.bl,_),br:T(B.br,_)};return C&&(V.tl.x-=F,V.tl.y-=M,V.tr.x+=M,V.tr.y-=F,V.bl.x-=M,V.bl.y+=F,V.br.x+=F,V.br.y+=M),V},calcOCoords:function(){var _=this._calcRotateMatrix(),C=this._calcTranslateMatrix(),I=this.getViewportTransform(),O=D(I,C),x=D(O,_),M=(x=D(x,[1/I[0],0,0,1/I[3],0,0]),this._calculateCurrentDimensions()),F={};return this.forEachControl(function(B,V,W){F[V]=B.positionHandler(M,x,W)}),F},calcACoords:function(){var _=this._calcRotateMatrix(),C=this._calcTranslateMatrix(),I=D(C,_),O=this._getTransformedDimensions(),x=O.x/2,M=O.y/2;return{tl:T({x:-x,y:-M},I),tr:T({x,y:-M},I),bl:T({x:-x,y:M},I),br:T({x,y:M},I)}},setCoords:function(_){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),_||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return S.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var _=this.getCenterPoint();return[1,0,0,1,_.x,_.y]},transformMatrixKey:function(_){var C="_",I="";return!_&&this.group&&(I=this.group.transformMatrixKey(_)+C),I+this.top+C+this.left+C+this.scaleX+C+this.scaleY+C+this.skewX+C+this.skewY+C+this.angle+C+this.originX+C+this.originY+C+this.width+C+this.height+C+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(_){var C=this.calcOwnMatrix();if(_||!this.group)return C;var I=this.transformMatrixKey(_),O=this.matrixCache||(this.matrixCache={});return O.key===I?O.value:(this.group&&(C=D(this.group.calcTransformMatrix(!1),C)),O.key=I,O.value=C,C)},calcOwnMatrix:function(){var _=this.transformMatrixKey(!0),C=this.ownMatrixCache||(this.ownMatrixCache={});if(C.key===_)return C.value;var I=this._calcTranslateMatrix(),O={angle:this.angle,translateX:I[4],translateY:I[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return C.key=_,C.value=S.composeMatrix(O),C.value},_getNonTransformedDimensions:function(){var _=this.strokeWidth;return{x:this.width+_,y:this.height+_}},_getTransformedDimensions:function(_,C){void 0===_&&(_=this.skewX),void 0===C&&(C=this.skewY);var I,O,x,M=0===_&&0===C;if(this.strokeUniform?(O=this.width,x=this.height):(O=(I=this._getNonTransformedDimensions()).x,x=I.y),M)return this._finalizeDimensions(O*this.scaleX,x*this.scaleY);var F=S.sizeAfterTransform(O,x,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:_,skewY:C});return this._finalizeDimensions(F.x,F.y)},_finalizeDimensions:function(_,C){return this.strokeUniform?{x:_+this.strokeWidth,y:C+this.strokeWidth}:{x:_,y:C}},_calculateCurrentDimensions:function(){var _=this.getViewportTransform(),C=this._getTransformedDimensions();return T(C,_,!0).scalarAdd(2*this.padding)}})}(),P.util.object.extend(P.Object.prototype,{sendToBack:function(){return this.group?P.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?P.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(S){return this.group?P.StaticCanvas.prototype.sendBackwards.call(this.group,this,S):this.canvas&&this.canvas.sendBackwards(this,S),this},bringForward:function(S){return this.group?P.StaticCanvas.prototype.bringForward.call(this.group,this,S):this.canvas&&this.canvas.bringForward(this,S),this},moveTo:function(S){return this.group&&"activeSelection"!==this.group.type?P.StaticCanvas.prototype.moveTo.call(this.group,this,S):this.canvas&&this.canvas.moveTo(this,S),this}}),function(){function S(D,T){if(T){if(T.toLive)return D+": url(#SVGID_"+T.id+"); ";var _=new P.Color(T),C=D+": "+_.toRgb()+"; ",I=_.getAlpha();return 1!==I&&(C+=D+"-opacity: "+I.toString()+"; "),C}return D+": none; "}var w=P.util.toFixed;P.util.object.extend(P.Object.prototype,{getSvgStyles:function(D){var T=this.fillRule?this.fillRule:"nonzero",_=this.strokeWidth?this.strokeWidth:"0",C=this.strokeDashArray?this.strokeDashArray.join(" "):"none",I=this.strokeDashOffset?this.strokeDashOffset:"0",O=this.strokeLineCap?this.strokeLineCap:"butt",x=this.strokeLineJoin?this.strokeLineJoin:"miter",M=this.strokeMiterLimit?this.strokeMiterLimit:"4",F=void 0!==this.opacity?this.opacity:"1",B=this.visible?"":" visibility: hidden;",V=D?"":this.getSvgFilter(),W=S("fill",this.fill);return[S("stroke",this.stroke),"stroke-width: ",_,"; ","stroke-dasharray: ",C,"; ","stroke-linecap: ",O,"; ","stroke-dashoffset: ",I,"; ","stroke-linejoin: ",x,"; ","stroke-miterlimit: ",M,"; ",W,"fill-rule: ",T,"; ","opacity: ",F,";",V,B].join("")},getSvgSpanStyles:function(D,T){var _="; ",C=D.fontFamily?"font-family: "+(-1===D.fontFamily.indexOf("'")&&-1===D.fontFamily.indexOf('"')?"'"+D.fontFamily+"'":D.fontFamily)+_:"",I=D.strokeWidth?"stroke-width: "+D.strokeWidth+_:"",O=D.fontSize?"font-size: "+D.fontSize+"px"+_:"",x=D.fontStyle?"font-style: "+D.fontStyle+_:"",M=D.fontWeight?"font-weight: "+D.fontWeight+_:"",F=D.fill?S("fill",D.fill):"",B=D.stroke?S("stroke",D.stroke):"",V=this.getSvgTextDecoration(D);return V&&(V="text-decoration: "+V+_),[B,I,C,O,x,M,V,F,D.deltaY?"baseline-shift: "+-D.deltaY+"; ":"",T?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(D){return["overline","underline","line-through"].filter(function(T){return D[T.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(D,T){var _=D?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+P.util.matrixToSVG(_)+(T||"")+'" '},_setSVGBg:function(D){if(this.backgroundColor){var T=P.Object.NUM_FRACTION_DIGITS;D.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',w(-this.width/2,T),'" y="',w(-this.height/2,T),'" width="',w(this.width,T),'" height="',w(this.height,T),'"></rect>\n')}},toSVG:function(D){return this._createBaseSVGMarkup(this._toSVG(D),{reviver:D})},toClipPathSVG:function(D){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(D),{reviver:D})},_createBaseClipPathSVGMarkup:function(D,T){var _=(T=T||{}).reviver,I=[this.getSvgTransform(!0,T.additionalTransform||""),this.getSvgCommons()].join(""),O=D.indexOf("COMMON_PARTS");return D[O]=I,_?_(D.join("")):D.join("")},_createBaseSVGMarkup:function(D,T){var _,C,I=(T=T||{}).noStyle,O=T.reviver,x=I?"":'style="'+this.getSvgStyles()+'" ',M=T.withShadow?'style="'+this.getSvgFilter()+'" ':"",F=this.clipPath,B=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",V=F&&F.absolutePositioned,W=this.stroke,G=this.fill,Y=this.shadow,Z=[],ie=D.indexOf("COMMON_PARTS"),se=T.additionalTransform;return F&&(F.clipPathId="CLIPPATH_"+P.Object.__uid++,C='<clipPath id="'+F.clipPathId+'" >\n'+F.toClipPathSVG(O)+"</clipPath>\n"),V&&Z.push("<g ",M,this.getSvgCommons()," >\n"),Z.push("<g ",this.getSvgTransform(!1),V?"":M+this.getSvgCommons()," >\n"),_=[x,B,I?"":this.addPaintOrder()," ",se?'transform="'+se+'" ':""].join(""),D[ie]=_,G&&G.toLive&&Z.push(G.toSVG(this)),W&&W.toLive&&Z.push(W.toSVG(this)),Y&&Z.push(Y.toSVG(this)),F&&Z.push(C),Z.push(D.join("")),Z.push("</g>\n"),V&&Z.push("</g>\n"),O?O(Z.join("")):Z.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var S=P.util.object.extend,w="stateProperties";function D(_,C,I){var O={};I.forEach(function(x){O[x]=_[x]}),S(_[C],O,!0)}function T(_,C,I){if(_===C)return!0;if(Array.isArray(_)){if(!Array.isArray(C)||_.length!==C.length)return!1;for(var O=0,x=_.length;O<x;O++)if(!T(_[O],C[O]))return!1;return!0}if(_&&"object"==typeof _){var M,F=Object.keys(_);if(!C||"object"!=typeof C||!I&&F.length!==Object.keys(C).length)return!1;for(O=0,x=F.length;O<x;O++)if("canvas"!==(M=F[O])&&"group"!==M&&!T(_[M],C[M]))return!1;return!0}}P.util.object.extend(P.Object.prototype,{hasStateChanged:function(_){var C="_"+(_=_||w);return Object.keys(this[C]).length<this[_].length||!T(this[C],this,!0)},saveState:function(_){var C=_&&_.propertySet||w,I="_"+C;return this[I]?(D(this,I,this[C]),_&&_.stateProperties&&D(this,I,_.stateProperties),this):this.setupState(_)},setupState:function(_){var C=(_=_||{}).propertySet||w;return _.propertySet=C,this["_"+C]={},this.saveState(_),this}})}(),function(){var S=P.util.degreesToRadians;P.util.object.extend(P.Object.prototype,{_findTargetCorner:function(w,D){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var T,_,C,I=w.x,O=w.y,x=Object.keys(this.oCoords),M=x.length-1;for(this.__corner=0;M>=0;M--)if(this.isControlVisible(C=x[M])&&(_=this._getImageLines(D?this.oCoords[C].touchCorner:this.oCoords[C].corner),0!==(T=this._findCrossPoints({x:I,y:O},_))&&T%2==1))return this.__corner=C,C;return!1},forEachControl:function(w){for(var D in this.controls)w(this.controls[D],D,this)},_setCornerCoords:function(){var w=this.oCoords;for(var D in w){var T=this.controls[D];w[D].corner=T.calcCornerCoords(this.angle,this.cornerSize,w[D].x,w[D].y,!1),w[D].touchCorner=T.calcCornerCoords(this.angle,this.touchCornerSize,w[D].x,w[D].y,!0)}},drawSelectionBackground:function(w){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;w.save();var D=this.getCenterPoint(),T=this._calculateCurrentDimensions(),_=this.canvas.viewportTransform;return w.translate(D.x,D.y),w.scale(1/_[0],1/_[3]),w.rotate(S(this.angle)),w.fillStyle=this.selectionBackgroundColor,w.fillRect(-T.x/2,-T.y/2,T.x,T.y),w.restore(),this},drawBorders:function(w,D){D=D||{};var T=this._calculateCurrentDimensions(),_=this.borderScaleFactor,C=T.x+_,I=T.y+_,O=void 0!==D.hasControls?D.hasControls:this.hasControls,x=!1;return w.save(),w.strokeStyle=D.borderColor||this.borderColor,this._setLineDash(w,D.borderDashArray||this.borderDashArray),w.strokeRect(-C/2,-I/2,C,I),O&&(w.beginPath(),this.forEachControl(function(M,F,B){M.withConnection&&M.getVisibility(B,F)&&(x=!0,w.moveTo(M.x*C,M.y*I),w.lineTo(M.x*C+M.offsetX,M.y*I+M.offsetY))}),x&&w.stroke()),w.restore(),this},drawBordersInGroup:function(w,D,T){T=T||{};var _=P.util.sizeAfterTransform(this.width,this.height,D),C=this.strokeWidth,I=this.strokeUniform,O=this.borderScaleFactor,x=_.x+C*(I?this.canvas.getZoom():D.scaleX)+O,M=_.y+C*(I?this.canvas.getZoom():D.scaleY)+O;return w.save(),this._setLineDash(w,T.borderDashArray||this.borderDashArray),w.strokeStyle=T.borderColor||this.borderColor,w.strokeRect(-x/2,-M/2,x,M),w.restore(),this},drawControls:function(w,D){D=D||{},w.save();var T,_,C=this.canvas.getRetinaScaling();return w.setTransform(C,0,0,C,0,0),w.strokeStyle=w.fillStyle=D.cornerColor||this.cornerColor,this.transparentCorners||(w.strokeStyle=D.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(w,D.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(T=this.group.calcTransformMatrix()),this.forEachControl(function(I,O,x){_=x.oCoords[O],I.getVisibility(x,O)&&(T&&(_=P.util.transformPoint(_,T)),I.render(w,_.x,_.y,D,x))}),w.restore(),this},isControlVisible:function(w){return this.controls[w]&&this.controls[w].getVisibility(this,w)},setControlVisible:function(w,D){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[w]=D,this},setControlsVisibility:function(w){for(var D in w||(w={}),w)this.setControlVisible(D,w[D]);return this},onDeselect:function(){},onSelect:function(){}})}(),P.util.object.extend(P.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(S,w){var D=function(){},T=(w=w||{}).onComplete||D,_=w.onChange||D,C=this;return P.util.animate({target:this,startValue:S.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(I){S.set("left",I),C.requestRenderAll(),_()},onComplete:function(){S.setCoords(),T()}})},fxCenterObjectV:function(S,w){var D=function(){},T=(w=w||{}).onComplete||D,_=w.onChange||D,C=this;return P.util.animate({target:this,startValue:S.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(I){S.set("top",I),C.requestRenderAll(),_()},onComplete:function(){S.setCoords(),T()}})},fxRemove:function(S,w){var D=function(){},T=(w=w||{}).onComplete||D,_=w.onChange||D,C=this;return P.util.animate({target:this,startValue:S.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(I){S.set("opacity",I),C.requestRenderAll(),_()},onComplete:function(){C.remove(S),T()}})}}),P.util.object.extend(P.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var S,D=[],T=[];for(S in arguments[0])D.push(S);for(var _=0,C=D.length;_<C;_++)T.push(this._animate(S=D[_],arguments[0][S],arguments[1],_!==C-1));return T}return this._animate.apply(this,arguments)},_animate:function(S,w,D,T){var _,C=this;w=w.toString(),D=D?P.util.object.clone(D):{},~S.indexOf(".")&&(_=S.split("."));var I=C.colorProperties.indexOf(S)>-1||_&&C.colorProperties.indexOf(_[1])>-1,O=_?this.get(_[0])[_[1]]:this.get(S);"from"in D||(D.from=O),I||(w=~w.indexOf("=")?O+parseFloat(w.replace("=","")):parseFloat(w));var x={target:this,startValue:D.from,endValue:w,byValue:D.by,easing:D.easing,duration:D.duration,abort:D.abort&&function(M,F,B){return D.abort.call(C,M,F,B)},onChange:function(M,F,B){_?C[_[0]][_[1]]=M:C.set(S,M),T||D.onChange&&D.onChange(M,F,B)},onComplete:function(M,F,B){T||(C.setCoords(),D.onComplete&&D.onComplete(M,F,B))}};return I?P.util.animateColor(x.startValue,x.endValue,x.duration,x):P.util.animate(x)}}),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.util.object.clone,_={x1:1,x2:1,y1:1,y2:1};function C(I,O){var x=I.origin,M=I.axis1,F=I.axis2,B=I.dimension,V=O.nearest,W=O.center,G=O.farthest;return function(){switch(this.get(x)){case V:return Math.min(this.get(M),this.get(F));case W:return Math.min(this.get(M),this.get(F))+.5*this.get(B);case G:return Math.max(this.get(M),this.get(F))}}}w.Line?w.warn("fabric.Line is already defined"):(w.Line=w.util.createClass(w.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:w.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(I,O){I||(I=[0,0,0,0]),this.callSuper("initialize",O),this.set("x1",I[0]),this.set("y1",I[1]),this.set("x2",I[2]),this.set("y2",I[3]),this._setWidthHeight(O)},_setWidthHeight:function(I){I||(I={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in I?I.left:this._getLeftToOriginX(),this.top="top"in I?I.top:this._getTopToOriginY()},_set:function(I,O){return this.callSuper("_set",I,O),void 0!==_[I]&&this._setWidthHeight(),this},_getLeftToOriginX:C({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:C({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(I){I.beginPath();var O=this.calcLinePoints();I.moveTo(O.x1,O.y1),I.lineTo(O.x2,O.y2),I.lineWidth=this.strokeWidth;var x=I.strokeStyle;I.strokeStyle=this.stroke||I.fillStyle,this.stroke&&this._renderStroke(I),I.strokeStyle=x},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(I){return D(this.callSuper("toObject",I),this.calcLinePoints())},_getNonTransformedDimensions:function(){var I=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(I.y-=this.strokeWidth),0===this.height&&(I.x-=this.strokeWidth)),I},calcLinePoints:function(){var I=this.x1<=this.x2?-1:1,O=this.y1<=this.y2?-1:1;return{x1:I*this.width*.5,x2:I*this.width*-.5,y1:O*this.height*.5,y2:O*this.height*-.5}},_toSVG:function(){var I=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',I.x1,'" y1="',I.y1,'" x2="',I.x2,'" y2="',I.y2,'" />\n']}}),w.Line.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),w.Line.fromElement=function(I,O,x){x=x||{};var M=w.parseAttributes(I,w.Line.ATTRIBUTE_NAMES);O(new w.Line([M.x1||0,M.y1||0,M.x2||0,M.y2||0],D(M,x)))},w.Line.fromObject=function(I,O){var x=T(I,!0);x.points=[I.x1,I.y1,I.x2,I.y2],w.Object._fromObject("Line",x,function(M){delete M.points,O&&O(M)},"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.degreesToRadians;w.Circle?w.warn("fabric.Circle is already defined."):(w.Circle=w.util.createClass(w.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:w.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(T,_){return this.callSuper("_set",T,_),"radius"===T&&this.setRadius(_),this},toObject:function(T){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(T))},_toSVG:function(){var T,_=(this.endAngle-this.startAngle)%360;if(0===_)T=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var C=D(this.startAngle),I=D(this.endAngle),O=this.radius;T=['<path d="M '+w.util.cos(C)*O+" "+w.util.sin(C)*O," A "+O+" "+O," 0 ",+(_>180?"1":"0")+" 1"," "+w.util.cos(I)*O+" "+w.util.sin(I)*O,'" ',"COMMON_PARTS"," />\n"]}return T},_render:function(T){T.beginPath(),T.arc(0,0,this.radius,D(this.startAngle),D(this.endAngle),!1),this._renderPaintInOrder(T)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(T){return this.radius=T,this.set("width",2*T).set("height",2*T)}}),w.Circle.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),w.Circle.fromElement=function(T,_){var C,I=w.parseAttributes(T,w.Circle.ATTRIBUTE_NAMES);if(!("radius"in(C=I)&&C.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");I.left=(I.left||0)-I.radius,I.top=(I.top||0)-I.radius,_(new w.Circle(I))},w.Circle.fromObject=function(T,_){w.Object._fromObject("Circle",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={});w.Triangle?w.warn("fabric.Triangle is already defined"):(w.Triangle=w.util.createClass(w.Object,{type:"triangle",width:100,height:100,_render:function(D){var T=this.width/2,_=this.height/2;D.beginPath(),D.moveTo(-T,_),D.lineTo(0,-_),D.lineTo(T,_),D.closePath(),this._renderPaintInOrder(D)},_toSVG:function(){var D=this.width/2,T=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-D+" "+T,"0 "+-T,D+" "+T].join(","),'" />']}}),w.Triangle.fromObject=function(D,T){return w.Object._fromObject("Triangle",D,T)})}(l),function(S){var w=S.fabric||(S.fabric={}),D=2*Math.PI;w.Ellipse?w.warn("fabric.Ellipse is already defined."):(w.Ellipse=w.util.createClass(w.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:w.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(T){this.callSuper("initialize",T),this.set("rx",T&&T.rx||0),this.set("ry",T&&T.ry||0)},_set:function(T,_){switch(this.callSuper("_set",T,_),T){case"rx":this.rx=_,this.set("width",2*_);break;case"ry":this.ry=_,this.set("height",2*_)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(T){return this.callSuper("toObject",["rx","ry"].concat(T))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(T){T.beginPath(),T.save(),T.transform(1,0,0,this.ry/this.rx,0,0),T.arc(0,0,this.rx,0,D,!1),T.restore(),this._renderPaintInOrder(T)}}),w.Ellipse.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),w.Ellipse.fromElement=function(T,_){var C=w.parseAttributes(T,w.Ellipse.ATTRIBUTE_NAMES);C.left=(C.left||0)-C.rx,C.top=(C.top||0)-C.ry,_(new w.Ellipse(C))},w.Ellipse.fromObject=function(T,_){w.Object._fromObject("Ellipse",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend;w.Rect?w.warn("fabric.Rect is already defined"):(w.Rect=w.util.createClass(w.Object,{stateProperties:w.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:w.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(T){this.callSuper("initialize",T),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(T){var _=this.rx?Math.min(this.rx,this.width/2):0,C=this.ry?Math.min(this.ry,this.height/2):0,I=this.width,O=this.height,x=-this.width/2,M=-this.height/2,F=0!==_||0!==C,B=.4477152502;T.beginPath(),T.moveTo(x+_,M),T.lineTo(x+I-_,M),F&&T.bezierCurveTo(x+I-B*_,M,x+I,M+B*C,x+I,M+C),T.lineTo(x+I,M+O-C),F&&T.bezierCurveTo(x+I,M+O-B*C,x+I-B*_,M+O,x+I-_,M+O),T.lineTo(x+_,M+O),F&&T.bezierCurveTo(x+B*_,M+O,x,M+O-B*C,x,M+O-C),T.lineTo(x,M+C),F&&T.bezierCurveTo(x,M+B*C,x+B*_,M,x+_,M),T.closePath(),this._renderPaintInOrder(T)},toObject:function(T){return this.callSuper("toObject",["rx","ry"].concat(T))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),w.Rect.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),w.Rect.fromElement=function(T,_,C){if(!T)return _(null);C=C||{};var I=w.parseAttributes(T,w.Rect.ATTRIBUTE_NAMES);I.left=I.left||0,I.top=I.top||0,I.height=I.height||0,I.width=I.width||0;var O=new w.Rect(D(C?w.util.object.clone(C):{},I));O.visible=O.visible&&O.width>0&&O.height>0,_(O)},w.Rect.fromObject=function(T,_){return w.Object._fromObject("Rect",T,_)})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.util.array.min,_=w.util.array.max,C=w.util.toFixed,I=w.util.projectStrokeOnPoints;w.Polyline?w.warn("fabric.Polyline is already defined"):(w.Polyline=w.util.createClass(w.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:w.Object.prototype.cacheProperties.concat("points"),initialize:function(O,x){x=x||{},this.points=O||[],this.callSuper("initialize",x),this._setPositionDimensions(x)},_projectStrokeOnPoints:function(){return I(this.points,this,!0)},_setPositionDimensions:function(O){var x,M=this._calcDimensions(O),F=this.exactBoundingBox?this.strokeWidth:0;this.width=M.width-F,this.height=M.height-F,O.fromSVG||(x=this.translateToGivenOrigin({x:M.left-this.strokeWidth/2+F/2,y:M.top-this.strokeWidth/2+F/2},"left","top",this.originX,this.originY)),void 0===O.left&&(this.left=O.fromSVG?M.left:x.x),void 0===O.top&&(this.top=O.fromSVG?M.top:x.y),this.pathOffset={x:M.left+this.width/2+F/2,y:M.top+this.height/2+F/2}},_calcDimensions:function(){var O=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,x=T(O,"x")||0,M=T(O,"y")||0;return{left:x,top:M,width:(_(O,"x")||0)-x,height:(_(O,"y")||0)-M}},toObject:function(O){return D(this.callSuper("toObject",O),{points:this.points.concat()})},_toSVG:function(){for(var O=[],x=this.pathOffset.x,M=this.pathOffset.y,F=w.Object.NUM_FRACTION_DIGITS,B=0,V=this.points.length;B<V;B++)O.push(C(this.points[B].x-x,F),",",C(this.points[B].y-M,F)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',O.join(""),'" />\n']},commonRender:function(O){var x,M=this.points.length,F=this.pathOffset.x,B=this.pathOffset.y;if(!M||isNaN(this.points[M-1].y))return!1;O.beginPath(),O.moveTo(this.points[0].x-F,this.points[0].y-B);for(var V=0;V<M;V++)O.lineTo((x=this.points[V]).x-F,x.y-B);return!0},_render:function(O){this.commonRender(O)&&this._renderPaintInOrder(O)},complexity:function(){return this.get("points").length}}),w.Polyline.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(),w.Polyline.fromElementGenerator=function(O){return function(x,M,F){if(!x)return M(null);F||(F={});var B=w.parsePointsAttribute(x.getAttribute("points")),V=w.parseAttributes(x,w[O].ATTRIBUTE_NAMES);V.fromSVG=!0,M(new w[O](B,D(V,F)))}},w.Polyline.fromElement=w.Polyline.fromElementGenerator("Polyline"),w.Polyline.fromObject=function(O,x){return w.Object._fromObject("Polyline",O,x,"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.projectStrokeOnPoints;w.Polygon?w.warn("fabric.Polygon is already defined"):(w.Polygon=w.util.createClass(w.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return D(this.points,this)},_render:function(T){this.commonRender(T)&&(T.closePath(),this._renderPaintInOrder(T))}}),w.Polygon.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(),w.Polygon.fromElement=w.Polyline.fromElementGenerator("Polygon"),w.Polygon.fromObject=function(T,_){w.Object._fromObject("Polygon",T,_,"points")})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.array.min,T=w.util.array.max,_=w.util.object.extend,C=w.util.object.clone,I=w.util.toFixed;w.Path?w.warn("fabric.Path is already defined"):(w.Path=w.util.createClass(w.Object,{type:"path",path:null,cacheProperties:w.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:w.Object.prototype.stateProperties.concat("path"),initialize:function(O,x){delete(x=C(x||{})).path,this.callSuper("initialize",x),this._setPath(O||[],x)},_setPath:function(O,x){this.path=w.util.makePathSimpler(Array.isArray(O)?O:w.util.parsePath(O)),w.Polyline.prototype._setPositionDimensions.call(this,x||{})},_renderPathCommands:function(O){var x,M=0,F=0,B=0,V=0,Y=-this.pathOffset.x,Z=-this.pathOffset.y;O.beginPath();for(var ie=0,se=this.path.length;ie<se;++ie)switch((x=this.path[ie])[0]){case"L":O.lineTo((B=x[1])+Y,(V=x[2])+Z);break;case"M":M=B=x[1],F=V=x[2],O.moveTo(B+Y,V+Z);break;case"C":O.bezierCurveTo(x[1]+Y,x[2]+Z,x[3]+Y,x[4]+Z,(B=x[5])+Y,(V=x[6])+Z);break;case"Q":O.quadraticCurveTo(x[1]+Y,x[2]+Z,x[3]+Y,x[4]+Z),B=x[3],V=x[4];break;case"z":case"Z":B=M,V=F,O.closePath()}},_render:function(O){this._renderPathCommands(O),this._renderPaintInOrder(O)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(O){return _(this.callSuper("toObject",O),{path:this.path.map(function(x){return x.slice()})})},toDatalessObject:function(O){var x=this.toObject(["sourcePath"].concat(O));return x.sourcePath&&delete x.path,x},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',w.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var O=w.Object.NUM_FRACTION_DIGITS;return" translate("+I(-this.pathOffset.x,O)+", "+I(-this.pathOffset.y,O)+")"},toClipPathSVG:function(O){var x=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:O,additionalTransform:x})},toSVG:function(O){var x=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:O,additionalTransform:x})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var O,x,M=[],F=[],B=0,V=0,W=0,G=0,Y=0,Z=this.path.length;Y<Z;++Y){switch((O=this.path[Y])[0]){case"L":W=O[1],G=O[2],x=[];break;case"M":B=W=O[1],V=G=O[2],x=[];break;case"C":x=w.util.getBoundsOfCurve(W,G,O[1],O[2],O[3],O[4],O[5],O[6]),W=O[5],G=O[6];break;case"Q":x=w.util.getBoundsOfCurve(W,G,O[1],O[2],O[1],O[2],O[3],O[4]),W=O[3],G=O[4];break;case"z":case"Z":W=B,G=V}x.forEach(function(de){M.push(de.x),F.push(de.y)}),M.push(W),F.push(G)}var ie=D(M)||0,se=D(F)||0;return{left:ie,top:se,width:(T(M)||0)-ie,height:(T(F)||0)-se}}}),w.Path.fromObject=function(O,x){"string"==typeof O.sourcePath?w.loadSVGFromURL(O.sourcePath,function(F){var B=F[0];B.setOptions(O),x&&x(B)}):w.Object._fromObject("Path",O,x,"path")},w.Path.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat(["d"]),w.Path.fromElement=function(O,x,M){var F=w.parseAttributes(O,w.Path.ATTRIBUTE_NAMES);F.fromSVG=!0,x(new w.Path(F.d,_(F,M)))})}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.array.min,T=w.util.array.max;w.Group||(w.Group=w.util.createClass(w.Object,w.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(_,C,I){C=C||{},this._objects=[],I&&this.callSuper("initialize",C),this._objects=_||[];for(var O=this._objects.length;O--;)this._objects[O].group=this;if(I)this._updateObjectsACoords();else{var x=C&&C.centerPoint;void 0!==C.originX&&(this.originX=C.originX),void 0!==C.originY&&(this.originY=C.originY),x||this._calcBounds(),this._updateObjectsCoords(x),delete C.centerPoint,this.callSuper("initialize",C)}this.setCoords()},_updateObjectsACoords:function(){for(var _=this._objects.length;_--;)this._objects[_].setCoords(!0)},_updateObjectsCoords:function(_){_=_||this.getCenterPoint();for(var C=this._objects.length;C--;)this._updateObjectCoords(this._objects[C],_)},_updateObjectCoords:function(_,C){_.set({left:_.left-C.x,top:_.top-C.y}),_.group=this,_.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(_){var C=!!this.group;return this._restoreObjectsState(),w.util.resetObjectTransform(this),_&&(C&&w.util.removeTransformFromObject(_,this.group.calcTransformMatrix()),this._objects.push(_),_.group=this,_._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,C?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(_){return this._restoreObjectsState(),w.util.resetObjectTransform(this),this.remove(_),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(_){this.dirty=!0,_.group=this,_._set("canvas",this.canvas)},_onObjectRemoved:function(_){this.dirty=!0,delete _.group},_set:function(_,C){var I=this._objects.length;if(this.useSetOnGroup)for(;I--;)this._objects[I].setOnGroup(_,C);if("canvas"===_)for(;I--;)this._objects[I]._set(_,C);w.Object.prototype._set.call(this,_,C)},toObject:function(_){var C=this.includeDefaultValues,I=this._objects.filter(function(x){return!x.excludeFromExport}).map(function(x){var M=x.includeDefaultValues;x.includeDefaultValues=C;var F=x.toObject(_);return x.includeDefaultValues=M,F}),O=w.Object.prototype.toObject.call(this,_);return O.objects=I,O},toDatalessObject:function(_){var C,I=this.sourcePath;if(I)C=I;else{var O=this.includeDefaultValues;C=this._objects.map(function(M){var F=M.includeDefaultValues;M.includeDefaultValues=O;var B=M.toDatalessObject(_);return M.includeDefaultValues=F,B})}var x=w.Object.prototype.toDatalessObject.call(this,_);return x.objects=C,x},render:function(_){this._transformDone=!0,this.callSuper("render",_),this._transformDone=!1},shouldCache:function(){var _=w.Object.prototype.shouldCache.call(this);if(_)for(var C=0,I=this._objects.length;C<I;C++)if(this._objects[C].willDrawShadow())return this.ownCaching=!1,!1;return _},willDrawShadow:function(){if(w.Object.prototype.willDrawShadow.call(this))return!0;for(var _=0,C=this._objects.length;_<C;_++)if(this._objects[_].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(_){for(var C=0,I=this._objects.length;C<I;C++)this._objects[C].render(_);this._drawClipPath(_,this.clipPath)},isCacheDirty:function(_){if(this.callSuper("isCacheDirty",_))return!0;if(!this.statefullCache)return!1;for(var C=0,I=this._objects.length;C<I;C++)if(this._objects[C].isCacheDirty(!0)){if(this._cacheCanvas){var O=this.cacheWidth/this.zoomX,x=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-O/2,-x/2,O,x)}return!0}return!1},_restoreObjectsState:function(){var _=this.calcOwnMatrix();return this._objects.forEach(function(C){w.util.addTransformToObject(C,_),delete C.group,C.setCoords()}),this},destroy:function(){return this._objects.forEach(function(_){_.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(_){_.dispose&&_.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var _=this._objects,C=this.canvas;this._objects=[];var I=this.toObject();delete I.objects;var O=new w.ActiveSelection([]);return O.set(I),O.type="activeSelection",C.remove(this),_.forEach(function(x){x.group=O,x.dirty=!0,C.add(x)}),O.canvas=C,O._objects=_,C._activeObject=O,O.setCoords(),O}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(_){_.setCoords(!0)}),this},_calcBounds:function(_){for(var C,I,O,x,M=[],F=[],B=["tr","br","bl","tl"],V=0,W=this._objects.length,G=B.length;V<W;++V){for(O=(C=this._objects[V]).calcACoords(),x=0;x<G;x++)M.push(O[I=B[x]].x),F.push(O[I].y);C.aCoords=O}this._getBounds(M,F,_)},_getBounds:function(_,C,I){var O=new w.Point(D(_),D(C)),x=new w.Point(T(_),T(C)),M=O.y||0,F=O.x||0,V=x.y-O.y||0;this.width=x.x-O.x||0,this.height=V,I||this.setPositionByOrigin({x:F,y:M},"left","top")},_toSVG:function(_){for(var C=["<g ","COMMON_PARTS"," >\n"],I=0,O=this._objects.length;I<O;I++)C.push("\t\t",this._objects[I].toSVG(_));return C.push("</g>\n"),C},getSvgStyles:function(){var C=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),C].join("")},toClipPathSVG:function(_){for(var C=[],I=0,O=this._objects.length;I<O;I++)C.push("\t",this._objects[I].toClipPathSVG(_));return this._createBaseClipPathSVGMarkup(C,{reviver:_})}}),w.Group.fromObject=function(_,C){var I=_.objects,O=w.util.object.clone(_,!0);delete O.objects,"string"!=typeof I?w.util.enlivenObjects(I,function(x){var M=w.util.object.clone(_,!0);delete M.objects,w.util.enlivenObjectEnlivables(_,M,function(){C&&C(new w.Group(x,M,!0))})}):w.loadSVGFromURL(I,function(x){var M=w.util.groupSVGElements(x,_,I);M.set(O),C&&C(M)})})}(l),function(S){var w=S.fabric||(S.fabric={});w.ActiveSelection||(w.ActiveSelection=w.util.createClass(w.Group,{type:"activeSelection",initialize:function(D,T){T=T||{},this._objects=D||[];for(var _=this._objects.length;_--;)this._objects[_].group=this;T.originX&&(this.originX=T.originX),T.originY&&(this.originY=T.originY),this._calcBounds(),this._updateObjectsCoords(),w.Object.prototype.initialize.call(this,T),this.setCoords()},toGroup:function(){var D=this._objects.concat();this._objects=[];var T=w.Object.prototype.toObject.call(this),_=new w.Group([]);if(delete T.type,_.set(T),D.forEach(function(I){I.canvas.remove(I),I.group=_}),_._objects=D,!this.canvas)return _;var C=this.canvas;return C.add(_),C._activeObject=_,_.setCoords(),_},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(D,T,_){D.save(),D.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",D,T),void 0===(_=_||{}).hasControls&&(_.hasControls=!1),_.forActiveSelection=!0;for(var C=0,I=this._objects.length;C<I;C++)this._objects[C]._renderControls(D,_);D.restore()}}),w.ActiveSelection.fromObject=function(D,T){w.util.enlivenObjects(D.objects,function(_){delete D.objects,T&&T(new w.ActiveSelection(_,D,!0))})})}(l),function(S){var w=P.util.object.extend;S.fabric||(S.fabric={}),S.fabric.Image?P.warn("fabric.Image is already defined."):(P.Image=P.util.createClass(P.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:P.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:P.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(D,T){T||(T={}),this.filters=[],this.cacheKey="texture"+P.Object.__uid++,this.callSuper("initialize",T),this._initElement(D,T)},getElement:function(){return this._element||{}},setElement:function(D,T){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=D,this._originalElement=D,this._initConfig(T),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(D){var T=P.filterBackend;T&&T.evictCachesForKey&&T.evictCachesForKey(D)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(D){P.util.cleanUpJsdomNode(this[D]),this[D]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var D=this.getElement();return{width:D.naturalWidth||D.width,height:D.naturalHeight||D.height}},_stroke:function(D){if(this.stroke&&0!==this.strokeWidth){var T=this.width/2,_=this.height/2;D.beginPath(),D.moveTo(-T,-_),D.lineTo(T,-_),D.lineTo(T,_),D.lineTo(-T,_),D.lineTo(-T,-_),D.closePath()}},toObject:function(D){var T=[];this.filters.forEach(function(C){C&&T.push(C.toObject())});var _=w(this.callSuper("toObject",["cropX","cropY"].concat(D)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:T});return this.resizeFilter&&(_.resizeFilter=this.resizeFilter.toObject()),_},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var D,T=[],_=[],C=this._element,I=-this.width/2,O=-this.height/2,x="",M="";if(!C)return[];if(this.hasCrop()){var F=P.Object.__uid++;T.push('<clipPath id="imageCrop_'+F+'">\n','\t<rect x="'+I+'" y="'+O+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),x=' clip-path="url(#imageCrop_'+F+')" '}if(this.imageSmoothing||(M='" image-rendering="optimizeSpeed'),_.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',I-this.cropX,'" y="',O-this.cropY,'" width="',C.width||C.naturalWidth,'" height="',C.height||C.height,M,'"',x,"></image>\n"),this.stroke||this.strokeDashArray){var B=this.fill;this.fill=null,D=["\t<rect ",'x="',I,'" y="',O,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=B}return"fill"!==this.paintFirst?T.concat(D,_):T.concat(_,D)},getSrc:function(D){var T=D?this._element:this._originalElement;return T?T.toDataURL?T.toDataURL():this.srcFromAttribute?T.getAttribute("src"):T.src:this.src||""},setSrc:function(D,T,_){return P.util.loadImage(D,function(C,I){this.setElement(C,_),this._setWidthHeight(),T&&T(this,I)},this,_&&_.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var D=this.resizeFilter,T=this.minimumScaleTrigger,_=this.getTotalObjectScaling(),C=_.scaleX,I=_.scaleY,O=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!D||C>T&&I>T)return this._element=O,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=C,void(this._lastScaleY=I);P.filterBackend||(P.filterBackend=P.initFilterBackend());var x=P.util.createCanvasElement(),M=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,F=O.width,B=O.height;x.width=F,x.height=B,this._element=x,this._lastScaleX=D.scaleX=C,this._lastScaleY=D.scaleY=I,P.filterBackend.applyFilters([D],O,F,B,this._element,M),this._filterScalingX=x.width/this._originalElement.width,this._filterScalingY=x.height/this._originalElement.height},applyFilters:function(D){if(D=(D=D||this.filters||[]).filter(function(O){return O&&!O.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===D.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var T=this._originalElement,_=T.naturalWidth||T.width,C=T.naturalHeight||T.height;if(this._element===this._originalElement){var I=P.util.createCanvasElement();I.width=_,I.height=C,this._element=I,this._filteredEl=I}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,_,C),this._lastScaleX=1,this._lastScaleY=1;return P.filterBackend||(P.filterBackend=P.initFilterBackend()),P.filterBackend.applyFilters(D,this._originalElement,_,C,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(D){P.util.setImageSmoothing(D,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(D),this._renderPaintInOrder(D)},drawCacheOnCanvas:function(D){P.util.setImageSmoothing(D,this.imageSmoothing),P.Object.prototype.drawCacheOnCanvas.call(this,D)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(D){var T=this._element;if(T){var _=this._filterScalingX,C=this._filterScalingY,I=this.width,O=this.height,x=Math.min,M=Math.max,F=M(this.cropX,0),B=M(this.cropY,0),V=T.naturalWidth||T.width,W=T.naturalHeight||T.height,G=F*_,Y=B*C,Z=x(I*_,V-G),ie=x(O*C,W-Y),se=-I/2,de=-O/2,ce=x(I,V/_-F),le=x(O,W/C-B);T&&D.drawImage(T,G,Y,Z,ie,se,de,ce,le)}},_needsResize:function(){var D=this.getTotalObjectScaling();return D.scaleX!==this._lastScaleX||D.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(D,T){this.setElement(P.util.getById(D),T),P.util.addClass(this.getElement(),P.Image.CSS_CANVAS)},_initConfig:function(D){D||(D={}),this.setOptions(D),this._setWidthHeight(D)},_initFilters:function(D,T){D&&D.length?P.util.enlivenObjects(D,function(_){T&&T(_)},"fabric.Image.filters"):T&&T()},_setWidthHeight:function(D){D||(D={});var T=this.getElement();this.width=D.width||T.naturalWidth||T.width||0,this.height=D.height||T.naturalHeight||T.height||0},parsePreserveAspectRatioAttribute:function(){var D,T=P.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),_=this._element.width,C=this._element.height,I=1,O=1,x=0,M=0,F=0,B=0,V=this.width,W=this.height,G={width:V,height:W};return!T||"none"===T.alignX&&"none"===T.alignY?(I=V/_,O=W/C):("meet"===T.meetOrSlice&&(D=(V-_*(I=O=P.util.findScaleToFit(this._element,G)))/2,"Min"===T.alignX&&(x=-D),"Max"===T.alignX&&(x=D),D=(W-C*O)/2,"Min"===T.alignY&&(M=-D),"Max"===T.alignY&&(M=D)),"slice"===T.meetOrSlice&&(D=_-V/(I=O=P.util.findScaleToCover(this._element,G)),"Mid"===T.alignX&&(F=D/2),"Max"===T.alignX&&(F=D),D=C-W/O,"Mid"===T.alignY&&(B=D/2),"Max"===T.alignY&&(B=D),_=V/I,C=W/O)),{width:_,height:C,scaleX:I,scaleY:O,offsetLeft:x,offsetTop:M,cropX:F,cropY:B}}}),P.Image.CSS_CANVAS="canvas-img",P.Image.prototype.getSvgSrc=P.Image.prototype.getSrc,P.Image.fromObject=function(D,T){var _=P.util.object.clone(D);P.util.loadImage(_.src,function(C,I){I?T&&T(null,!0):P.Image.prototype._initFilters.call(_,_.filters,function(O){_.filters=O||[],P.Image.prototype._initFilters.call(_,[_.resizeFilter],function(x){_.resizeFilter=x[0],P.util.enlivenObjectEnlivables(_,_,function(){var M=new P.Image(C,_);T(M,!1)})})})},null,_.crossOrigin)},P.Image.fromURL=function(D,T,_){P.util.loadImage(D,function(C,I){T&&T(new P.Image(C,_),I)},null,_&&_.crossOrigin)},P.Image.ATTRIBUTE_NAMES=P.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),P.Image.fromElement=function(D,T,_){var C=P.parseAttributes(D,P.Image.ATTRIBUTE_NAMES);P.Image.fromURL(C["xlink:href"],T,w(_?P.util.object.clone(_):{},C))})}(l),P.util.object.extend(P.Object.prototype,{_getAngleValueForStraighten:function(){var S=this.angle%360;return S>0?90*Math.round((S-1)/90):90*Math.round(S/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(S){var w=function(){},D=(S=S||{}).onComplete||w,T=S.onChange||w,_=this;return P.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(C){_.rotate(C),T()},onComplete:function(){_.setCoords(),D()}})}}),P.util.object.extend(P.StaticCanvas.prototype,{straightenObject:function(S){return S.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(S){return S.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function S(D,T){var _="precision "+T+" float;\nvoid main(){}",C=D.createShader(D.FRAGMENT_SHADER);return D.shaderSource(C,_),D.compileShader(C),!!D.getShaderParameter(C,D.COMPILE_STATUS)}function w(D){D&&D.tileSize&&(this.tileSize=D.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}P.isWebglSupported=function(D){if(P.isLikelyNode)return!1;D=D||P.WebglFilterBackend.prototype.tileSize;var T=document.createElement("canvas"),_=T.getContext("webgl")||T.getContext("experimental-webgl"),C=!1;if(_){P.maxTextureSize=_.getParameter(_.MAX_TEXTURE_SIZE),C=P.maxTextureSize>=D;for(var I=["highp","mediump","lowp"],O=0;O<3;O++)if(S(_,I[O])){P.webGlPrecision=I[O];break}}return this.isSupported=C,C},P.WebglFilterBackend=w,w.prototype={tileSize:2048,resources:{},setupGLContext:function(D,T){this.dispose(),this.createWebGLCanvas(D,T),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(D,T)},chooseFastestCopyGLTo2DMethod:function(D,T){var _,C=void 0!==window.performance;try{new ImageData(1,1),_=!0}catch(W){_=!1}var I="undefined"!=typeof ArrayBuffer,O="undefined"!=typeof Uint8ClampedArray;if(C&&_&&I&&O){var x=P.util.createCanvasElement(),M=new ArrayBuffer(D*T*4);if(P.forceGLPutImageData)return this.imageBuffer=M,void(this.copyGLTo2D=nt);var F,B,V={imageBuffer:M,destinationWidth:D,destinationHeight:T,targetCanvas:x};x.width=D,x.height=T,F=window.performance.now(),Ve.call(V,this.gl,V),B=window.performance.now()-F,F=window.performance.now(),nt.call(V,this.gl,V),B>window.performance.now()-F?(this.imageBuffer=M,this.copyGLTo2D=nt):this.copyGLTo2D=Ve}},createWebGLCanvas:function(D,T){var _=P.util.createCanvasElement();_.width=D,_.height=T;var C={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},I=_.getContext("webgl",C);I||(I=_.getContext("experimental-webgl",C)),I&&(I.clearColor(0,0,0,0),this.canvas=_,this.gl=I)},applyFilters:function(D,T,_,C,I,O){var x,M=this.gl;O&&(x=this.getCachedTexture(O,T));var V,W,Z,ie,F={originalWidth:T.width||T.originalWidth,originalHeight:T.height||T.originalHeight,sourceWidth:_,sourceHeight:C,destinationWidth:_,destinationHeight:C,context:M,sourceTexture:this.createTexture(M,_,C,!x&&T),targetTexture:this.createTexture(M,_,C),originalTexture:x||this.createTexture(M,_,C,!x&&T),passes:D.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:I},B=M.createFramebuffer();return M.bindFramebuffer(M.FRAMEBUFFER,B),D.forEach(function(V){V&&V.applyTo(F)}),ie=(V=F).destinationHeight,(W=V.targetCanvas).width===(Z=V.destinationWidth)&&W.height===ie||(W.width=Z,W.height=ie),this.copyGLTo2D(M,F),M.bindTexture(M.TEXTURE_2D,null),M.deleteTexture(F.sourceTexture),M.deleteTexture(F.targetTexture),M.deleteFramebuffer(B),I.getContext("2d").setTransform(1,0,0,1,0,0),F},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(D,T,_,C){var I=D.createTexture();return D.bindTexture(D.TEXTURE_2D,I),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),C?D.texImage2D(D.TEXTURE_2D,0,D.RGBA,D.RGBA,D.UNSIGNED_BYTE,C):D.texImage2D(D.TEXTURE_2D,0,D.RGBA,T,_,0,D.RGBA,D.UNSIGNED_BYTE,null),I},getCachedTexture:function(D,T){if(this.textureCache[D])return this.textureCache[D];var _=this.createTexture(this.gl,T.width,T.height,T);return this.textureCache[D]=_,_},evictCachesForKey:function(D){this.textureCache[D]&&(this.gl.deleteTexture(this.textureCache[D]),delete this.textureCache[D])},copyGLTo2D:Ve,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var D=this.gl,T={renderer:"",vendor:""};if(!D)return T;var _=D.getExtension("WEBGL_debug_renderer_info");if(_){var C=D.getParameter(_.UNMASKED_RENDERER_WEBGL),I=D.getParameter(_.UNMASKED_VENDOR_WEBGL);C&&(T.renderer=C.toLowerCase()),I&&(T.vendor=I.toLowerCase())}return this.gpuInfo=T,T}}}(),function(){var S=function(){};function w(){}P.Canvas2dFilterBackend=w,w.prototype={evictCachesForKey:S,dispose:S,clearWebGLCaches:S,resources:{},applyFilters:function(D,T,_,C,I){var O=I.getContext("2d");O.drawImage(T,0,0,_,C);var x={sourceWidth:_,sourceHeight:C,imageData:O.getImageData(0,0,_,C),originalEl:T,originalImageData:O.getImageData(0,0,_,C),canvasEl:I,ctx:O,filterBackend:this};return D.forEach(function(M){M.applyTo(x)}),x.imageData.width===_&&x.imageData.height===C||(I.width=x.imageData.width,I.height=x.imageData.height),O.putImageData(x.imageData,0,0),x}}}(),P.Image=P.Image||{},P.Image.filters=P.Image.filters||{},P.Image.filters.BaseFilter=P.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(S){S&&this.setOptions(S)},setOptions:function(S){for(var w in S)this[w]=S[w]},createProgram:function(S,w,D){w=w||this.fragmentSource,D=D||this.vertexSource,"highp"!==P.webGlPrecision&&(w=w.replace(/precision highp float/g,"precision "+P.webGlPrecision+" float"));var T=S.createShader(S.VERTEX_SHADER);if(S.shaderSource(T,D),S.compileShader(T),!S.getShaderParameter(T,S.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+S.getShaderInfoLog(T));var _=S.createShader(S.FRAGMENT_SHADER);if(S.shaderSource(_,w),S.compileShader(_),!S.getShaderParameter(_,S.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+S.getShaderInfoLog(_));var C=S.createProgram();if(S.attachShader(C,T),S.attachShader(C,_),S.linkProgram(C),!S.getProgramParameter(C,S.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+S.getProgramInfoLog(C));var I=this.getAttributeLocations(S,C),O=this.getUniformLocations(S,C)||{};return O.uStepW=S.getUniformLocation(C,"uStepW"),O.uStepH=S.getUniformLocation(C,"uStepH"),{program:C,attributeLocations:I,uniformLocations:O}},getAttributeLocations:function(S,w){return{aPosition:S.getAttribLocation(w,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(S,w,D){var T=w.aPosition,_=S.createBuffer();S.bindBuffer(S.ARRAY_BUFFER,_),S.enableVertexAttribArray(T),S.vertexAttribPointer(T,2,S.FLOAT,!1,0,0),S.bufferData(S.ARRAY_BUFFER,D,S.STATIC_DRAW)},_setupFrameBuffer:function(S){var w,D,T=S.context;S.passes>1?(D=S.destinationHeight,S.sourceWidth===(w=S.destinationWidth)&&S.sourceHeight===D||(T.deleteTexture(S.targetTexture),S.targetTexture=S.filterBackend.createTexture(T,w,D)),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,S.targetTexture,0)):(T.bindFramebuffer(T.FRAMEBUFFER,null),T.finish())},_swapTextures:function(S){S.passes--,S.pass++;var w=S.targetTexture;S.targetTexture=S.sourceTexture,S.sourceTexture=w},isNeutralState:function(){var S=this.mainParameter,w=P.Image.filters[this.type].prototype;if(S){if(Array.isArray(w[S])){for(var D=w[S].length;D--;)if(this[S][D]!==w[S][D])return!1;return!0}return w[S]===this[S]}return!1},applyTo:function(S){S.webgl?(this._setupFrameBuffer(S),this.applyToWebGL(S),this._swapTextures(S)):this.applyTo2d(S)},retrieveShader:function(S){return S.programCache.hasOwnProperty(this.type)||(S.programCache[this.type]=this.createProgram(S.context)),S.programCache[this.type]},applyToWebGL:function(S){var w=S.context,D=this.retrieveShader(S);w.bindTexture(w.TEXTURE_2D,0===S.pass&&S.originalTexture?S.originalTexture:S.sourceTexture),w.useProgram(D.program),this.sendAttributeData(w,D.attributeLocations,S.aPosition),w.uniform1f(D.uniformLocations.uStepW,1/S.sourceWidth),w.uniform1f(D.uniformLocations.uStepH,1/S.sourceHeight),this.sendUniformData(w,D.uniformLocations),w.viewport(0,0,S.destinationWidth,S.destinationHeight),w.drawArrays(w.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(S,w,D){S.activeTexture(D),S.bindTexture(S.TEXTURE_2D,w),S.activeTexture(S.TEXTURE0)},unbindAdditionalTexture:function(S,w){S.activeTexture(w),S.bindTexture(S.TEXTURE_2D,null),S.activeTexture(S.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(S){this[this.mainParameter]=S},sendUniformData:function(){},createHelpLayer:function(S){if(!S.helpLayer){var w=document.createElement("canvas");w.width=S.sourceWidth,w.height=S.sourceHeight,S.helpLayer=w}},toObject:function(){var S={type:this.type},w=this.mainParameter;return w&&(S[w]=this[w]),S},toJSON:function(){return this.toObject()}}),P.Image.filters.BaseFilter.fromObject=function(S,w){var D=new P.Image.filters[S.type](S);return w&&w(D),D},function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.ColorMatrix=(0,w.util.createClass)(D.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(_){this.callSuper("initialize",_),this.matrix=this.matrix.slice(0)},applyTo2d:function(_){var C,I,O,x,M,F=_.imageData.data,B=F.length,V=this.matrix,W=this.colorsOnly;for(M=0;M<B;M+=4)C=F[M],I=F[M+1],O=F[M+2],W?(F[M]=C*V[0]+I*V[1]+O*V[2]+255*V[4],F[M+1]=C*V[5]+I*V[6]+O*V[7]+255*V[9],F[M+2]=C*V[10]+I*V[11]+O*V[12]+255*V[14]):(F[M]=C*V[0]+I*V[1]+O*V[2]+(x=F[M+3])*V[3]+255*V[4],F[M+1]=C*V[5]+I*V[6]+O*V[7]+x*V[8]+255*V[9],F[M+2]=C*V[10]+I*V[11]+O*V[12]+x*V[13]+255*V[14],F[M+3]=C*V[15]+I*V[16]+O*V[17]+x*V[18]+255*V[19])},getUniformLocations:function(_,C){return{uColorMatrix:_.getUniformLocation(C,"uColorMatrix"),uConstants:_.getUniformLocation(C,"uConstants")}},sendUniformData:function(_,C){var I=this.matrix,x=[I[4],I[9],I[14],I[19]];_.uniformMatrix4fv(C.uColorMatrix,!1,[I[0],I[1],I[2],I[3],I[5],I[6],I[7],I[8],I[10],I[11],I[12],I[13],I[15],I[16],I[17],I[18]]),_.uniform4fv(C.uConstants,x)}}),w.Image.filters.ColorMatrix.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Brightness=(0,w.util.createClass)(D.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(_){if(0!==this.brightness){var C,I=_.imageData.data,O=I.length,x=Math.round(255*this.brightness);for(C=0;C<O;C+=4)I[C]=I[C]+x,I[C+1]=I[C+1]+x,I[C+2]=I[C+2]+x}},getUniformLocations:function(_,C){return{uBrightness:_.getUniformLocation(C,"uBrightness")}},sendUniformData:function(_,C){_.uniform1f(C.uBrightness,this.brightness)}}),w.Image.filters.Brightness.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.Image.filters;T.Convolute=(0,w.util.createClass)(T.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(C){var I=Math.sqrt(this.matrix.length),O=this.type+"_"+I+"_"+(this.opaque?1:0),x=this.fragmentSource[O];return C.programCache.hasOwnProperty(O)||(C.programCache[O]=this.createProgram(C.context,x)),C.programCache[O]},applyTo2d:function(C){var I,O,x,M,F,B,V,W,G,Y,Z,ie,se,de=C.imageData,ce=de.data,le=this.matrix,ee=Math.round(Math.sqrt(le.length)),J=Math.floor(ee/2),oe=de.width,he=de.height,fe=C.ctx.createImageData(oe,he),ne=fe.data,te=this.opaque?1:0;for(Z=0;Z<he;Z++)for(Y=0;Y<oe;Y++){for(F=4*(Z*oe+Y),I=0,O=0,x=0,M=0,se=0;se<ee;se++)for(ie=0;ie<ee;ie++)B=Y+ie-J,(V=Z+se-J)<0||V>=he||B<0||B>=oe||(I+=ce[W=4*(V*oe+B)]*(G=le[se*ee+ie]),O+=ce[W+1]*G,x+=ce[W+2]*G,te||(M+=ce[W+3]*G));ne[F]=I,ne[F+1]=O,ne[F+2]=x,ne[F+3]=te?ce[F+3]:M}C.imageData=fe},getUniformLocations:function(C,I){return{uMatrix:C.getUniformLocation(I,"uMatrix"),uOpaque:C.getUniformLocation(I,"uOpaque"),uHalfSize:C.getUniformLocation(I,"uHalfSize"),uSize:C.getUniformLocation(I,"uSize")}},sendUniformData:function(C,I){C.uniform1fv(I.uMatrix,this.matrix)},toObject:function(){return D(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),w.Image.filters.Convolute.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Grayscale=(0,w.util.createClass)(D.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(_){var C,I,O=_.imageData.data,x=O.length,M=this.mode;for(C=0;C<x;C+=4)"average"===M?I=(O[C]+O[C+1]+O[C+2])/3:"lightness"===M?I=(Math.min(O[C],O[C+1],O[C+2])+Math.max(O[C],O[C+1],O[C+2]))/2:"luminosity"===M&&(I=.21*O[C]+.72*O[C+1]+.07*O[C+2]),O[C]=I,O[C+1]=I,O[C+2]=I},retrieveShader:function(_){var C=this.type+"_"+this.mode;return _.programCache.hasOwnProperty(C)||(_.programCache[C]=this.createProgram(_.context,this.fragmentSource[this.mode])),_.programCache[C]},getUniformLocations:function(_,C){return{uMode:_.getUniformLocation(C,"uMode")}},sendUniformData:function(_,C){_.uniform1i(C.uMode,1)},isNeutralState:function(){return!1}}),w.Image.filters.Grayscale.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Invert=(0,w.util.createClass)(D.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(_){var C,I=_.imageData.data,O=I.length;for(C=0;C<O;C+=4)I[C]=255-I[C],I[C+1]=255-I[C+1],I[C+2]=255-I[C+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(_,C){return{uInvert:_.getUniformLocation(C,"uInvert")}},sendUniformData:function(_,C){_.uniform1i(C.uInvert,this.invert)}}),w.Image.filters.Invert.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.Image.filters;T.Noise=(0,w.util.createClass)(T.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(C){if(0!==this.noise){var I,O,M,x=C.imageData.data,F=this.noise;for(I=0,M=x.length;I<M;I+=4)O=(.5-Math.random())*F,x[I]+=O,x[I+1]+=O,x[I+2]+=O}},getUniformLocations:function(C,I){return{uNoise:C.getUniformLocation(I,"uNoise"),uSeed:C.getUniformLocation(I,"uSeed")}},sendUniformData:function(C,I){C.uniform1f(I.uNoise,this.noise/255),C.uniform1f(I.uSeed,Math.random())},toObject:function(){return D(this.callSuper("toObject"),{noise:this.noise})}}),w.Image.filters.Noise.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Pixelate=(0,w.util.createClass)(D.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(_){var C,I,O,x,M,F,B,V,W,G,Y,Z=_.imageData,ie=Z.data,se=Z.height,de=Z.width;for(I=0;I<se;I+=this.blocksize)for(O=0;O<de;O+=this.blocksize)for(x=ie[C=4*I*de+4*O],M=ie[C+1],F=ie[C+2],B=ie[C+3],G=Math.min(I+this.blocksize,se),Y=Math.min(O+this.blocksize,de),V=I;V<G;V++)for(W=O;W<Y;W++)ie[C=4*V*de+4*W]=x,ie[C+1]=M,ie[C+2]=F,ie[C+3]=B},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(_,C){return{uBlocksize:_.getUniformLocation(C,"uBlocksize"),uStepW:_.getUniformLocation(C,"uStepW"),uStepH:_.getUniformLocation(C,"uStepH")}},sendUniformData:function(_,C){_.uniform1f(C.uBlocksize,this.blocksize)}}),w.Image.filters.Pixelate.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.extend,T=w.Image.filters;T.RemoveColor=(0,w.util.createClass)(T.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(C){var I,O,x,M,F=C.imageData.data,B=255*this.distance,V=new w.Color(this.color).getSource(),W=[V[0]-B,V[1]-B,V[2]-B],G=[V[0]+B,V[1]+B,V[2]+B];for(I=0;I<F.length;I+=4)x=F[I+1],M=F[I+2],(O=F[I])>W[0]&&x>W[1]&&M>W[2]&&O<G[0]&&x<G[1]&&M<G[2]&&(F[I+3]=0)},getUniformLocations:function(C,I){return{uLow:C.getUniformLocation(I,"uLow"),uHigh:C.getUniformLocation(I,"uHigh")}},sendUniformData:function(C,I){var O=new w.Color(this.color).getSource(),x=parseFloat(this.distance),F=[O[0]/255+x,O[1]/255+x,O[2]/255+x,1];C.uniform4fv(I.uLow,[0+O[0]/255-x,0+O[1]/255-x,0+O[2]/255-x,1]),C.uniform4fv(I.uHigh,F)},toObject:function(){return D(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),w.Image.filters.RemoveColor.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters,T=w.util.createClass,_={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var C in _)D[C]=T(D.ColorMatrix,{type:C,matrix:_[C],mainParameter:!1,colorsOnly:!0}),w.Image.filters[C].fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric,D=w.Image.filters;D.BlendColor=(0,w.util.createClass)(D.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(_){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[_]+"}\n}"},retrieveShader:function(_){var C,I=this.type+"_"+this.mode;return _.programCache.hasOwnProperty(I)||(C=this.buildSource(this.mode),_.programCache[I]=this.createProgram(_.context,C)),_.programCache[I]},applyTo2d:function(_){var C,I,O,x,M,F,B,V=_.imageData.data,W=V.length,G=1-this.alpha;C=(B=new w.Color(this.color).getSource())[0]*this.alpha,I=B[1]*this.alpha,O=B[2]*this.alpha;for(var Y=0;Y<W;Y+=4)switch(x=V[Y],M=V[Y+1],F=V[Y+2],this.mode){case"multiply":V[Y]=x*C/255,V[Y+1]=M*I/255,V[Y+2]=F*O/255;break;case"screen":V[Y]=255-(255-x)*(255-C)/255,V[Y+1]=255-(255-M)*(255-I)/255,V[Y+2]=255-(255-F)*(255-O)/255;break;case"add":V[Y]=x+C,V[Y+1]=M+I,V[Y+2]=F+O;break;case"diff":case"difference":V[Y]=Math.abs(x-C),V[Y+1]=Math.abs(M-I),V[Y+2]=Math.abs(F-O);break;case"subtract":V[Y]=x-C,V[Y+1]=M-I,V[Y+2]=F-O;break;case"darken":V[Y]=Math.min(x,C),V[Y+1]=Math.min(M,I),V[Y+2]=Math.min(F,O);break;case"lighten":V[Y]=Math.max(x,C),V[Y+1]=Math.max(M,I),V[Y+2]=Math.max(F,O);break;case"overlay":V[Y]=C<128?2*x*C/255:255-2*(255-x)*(255-C)/255,V[Y+1]=I<128?2*M*I/255:255-2*(255-M)*(255-I)/255,V[Y+2]=O<128?2*F*O/255:255-2*(255-F)*(255-O)/255;break;case"exclusion":V[Y]=C+x-2*C*x/255,V[Y+1]=I+M-2*I*M/255,V[Y+2]=O+F-2*O*F/255;break;case"tint":V[Y]=C+x*G,V[Y+1]=I+M*G,V[Y+2]=O+F*G}},getUniformLocations:function(_,C){return{uColor:_.getUniformLocation(C,"uColor")}},sendUniformData:function(_,C){var I=new w.Color(this.color).getSource();I[0]=this.alpha*I[0]/255,I[1]=this.alpha*I[1]/255,I[2]=this.alpha*I[2]/255,I[3]=this.alpha,_.uniform4fv(C.uColor,I)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),w.Image.filters.BlendColor.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric,D=w.Image.filters;D.BlendImage=(0,w.util.createClass)(D.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(_){var C=this.type+"_"+this.mode,I=this.fragmentSource[this.mode];return _.programCache.hasOwnProperty(C)||(_.programCache[C]=this.createProgram(_.context,I)),_.programCache[C]},applyToWebGL:function(_){var C=_.context,I=this.createTexture(_.filterBackend,this.image);this.bindAdditionalTexture(C,I,C.TEXTURE1),this.callSuper("applyToWebGL",_),this.unbindAdditionalTexture(C,C.TEXTURE1)},createTexture:function(_,C){return _.getCachedTexture(C.cacheKey,C._element)},calculateMatrix:function(){var _=this.image;return[1/_.scaleX,0,0,0,1/_.scaleY,0,-_.left/_._element.width,-_.top/_._element.height,1]},applyTo2d:function(_){var C,I,O,x,M,F,B,V,W,G,Y,Z=_.imageData,ie=_.filterBackend.resources,se=Z.data,de=se.length,ce=Z.width,le=Z.height,ee=this.image;ie.blendImage||(ie.blendImage=w.util.createCanvasElement()),G=(W=ie.blendImage).getContext("2d"),W.width!==ce||W.height!==le?(W.width=ce,W.height=le):G.clearRect(0,0,ce,le),G.setTransform(ee.scaleX,0,0,ee.scaleY,ee.left,ee.top),G.drawImage(ee._element,0,0,ce,le),Y=G.getImageData(0,0,ce,le).data;for(var J=0;J<de;J+=4)switch(M=se[J],F=se[J+1],B=se[J+2],V=se[J+3],C=Y[J],I=Y[J+1],O=Y[J+2],x=Y[J+3],this.mode){case"multiply":se[J]=M*C/255,se[J+1]=F*I/255,se[J+2]=B*O/255,se[J+3]=V*x/255;break;case"mask":se[J+3]=x}},getUniformLocations:function(_,C){return{uTransformMatrix:_.getUniformLocation(C,"uTransformMatrix"),uImage:_.getUniformLocation(C,"uImage")}},sendUniformData:function(_,C){var I=this.calculateMatrix();_.uniform1i(C.uImage,1),_.uniformMatrix3fv(C.uTransformMatrix,!1,I)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),w.Image.filters.BlendImage.fromObject=function(_,C){w.Image.fromObject(_.image,function(I){var O=w.util.object.clone(_);O.image=I,C(new w.Image.filters.BlendImage(O))})}}(l),function(S){var w=S.fabric||(S.fabric={}),D=Math.pow,T=Math.floor,_=Math.sqrt,C=Math.abs,I=Math.round,O=Math.sin,x=Math.ceil,M=w.Image.filters;M.Resize=(0,w.util.createClass)(M.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(B,V){return{uDelta:B.getUniformLocation(V,"uDelta"),uTaps:B.getUniformLocation(V,"uTaps")}},sendUniformData:function(B,V){B.uniform2fv(V.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),B.uniform1fv(V.uTaps,this.taps)},retrieveShader:function(B){var V=this.getFilterWindow(),W=this.type+"_"+V;if(!B.programCache.hasOwnProperty(W)){var G=this.generateShader(V);B.programCache[W]=this.createProgram(B.context,G)}return B.programCache[W]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var B=this.lanczosCreate(this.lanczosLobes),V=this.tempScale,W=this.getFilterWindow(),G=new Array(W),Y=1;Y<=W;Y++)G[Y-1]=B(Y*V);return G},generateShader:function(B){for(var V=new Array(B),W=this.fragmentSourceTOP,G=1;G<=B;G++)V[G-1]=G+".0 * uDelta";return W+="uniform float uTaps["+B+"];\n",W+="void main() {\n",W+="  vec4 color = texture2D(uTexture, vTexCoord);\n",W+="  float sum = 1.0;\n",V.forEach(function(Y,Z){W+="  color += texture2D(uTexture, vTexCoord + "+Y+") * uTaps["+Z+"];\n",W+="  color += texture2D(uTexture, vTexCoord - "+Y+") * uTaps["+Z+"];\n",W+="  sum += 2.0 * uTaps["+Z+"];\n"}),W+="  gl_FragColor = color / sum;\n",W+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(B){B.webgl?(B.passes++,this.width=B.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=B.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),B.destinationWidth=this.dW,this._setupFrameBuffer(B),this.applyToWebGL(B),this._swapTextures(B),B.sourceWidth=B.destinationWidth,this.height=B.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),B.destinationHeight=this.dH,this._setupFrameBuffer(B),this.applyToWebGL(B),this._swapTextures(B),B.sourceHeight=B.destinationHeight):this.applyTo2d(B)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(B){return function(V){if(V>=B||V<=-B)return 0;if(V<1.1920929e-7&&V>-1.1920929e-7)return 1;var W=(V*=Math.PI)/B;return O(V)/V*O(W)/W}},applyTo2d:function(B){var V=B.imageData,W=this.scaleX,G=this.scaleY;this.rcpScaleX=1/W,this.rcpScaleY=1/G;var Y,Z=V.width,ie=V.height,se=I(Z*W),de=I(ie*G);"sliceHack"===this.resizeType?Y=this.sliceByTwo(B,Z,ie,se,de):"hermite"===this.resizeType?Y=this.hermiteFastResize(B,Z,ie,se,de):"bilinear"===this.resizeType?Y=this.bilinearFiltering(B,Z,ie,se,de):"lanczos"===this.resizeType&&(Y=this.lanczosResize(B,Z,ie,se,de)),B.imageData=Y},sliceByTwo:function(B,V,W,G,Y){var Z,ie,se=B.imageData,ce=!1,le=!1,ee=.5*V,J=.5*W,oe=w.filterBackend.resources,he=0,fe=0,ne=V,te=0;for(oe.sliceByTwo||(oe.sliceByTwo=document.createElement("canvas")),((Z=oe.sliceByTwo).width<1.5*V||Z.height<W)&&(Z.width=1.5*V,Z.height=W),(ie=Z.getContext("2d")).clearRect(0,0,1.5*V,W),ie.putImageData(se,0,0),G=T(G),Y=T(Y);!ce||!le;)V=ee,W=J,G<T(.5*ee)?ee=T(.5*ee):(ee=G,ce=!0),Y<T(.5*J)?J=T(.5*J):(J=Y,le=!0),ie.drawImage(Z,he,fe,V,W,ne,te,ee,J),he=ne,fe=te,te+=J;return ie.getImageData(he,fe,G,Y)},lanczosResize:function(B,V,W,G,Y){var Z=B.imageData.data,ie=B.ctx.createImageData(G,Y),se=ie.data,de=this.lanczosCreate(this.lanczosLobes),ce=this.rcpScaleX,le=this.rcpScaleY,ee=2/this.rcpScaleX,J=2/this.rcpScaleY,oe=x(ce*this.lanczosLobes/2),he=x(le*this.lanczosLobes/2),fe={},ne={},te={};return function ae(ge){var ue,me,Ie,be,Ce,Se,De,xe,je,Le,ut;for(ne.x=(ge+.5)*ce,te.x=T(ne.x),ue=0;ue<Y;ue++){for(ne.y=(ue+.5)*le,te.y=T(ne.y),Ce=0,Se=0,De=0,xe=0,je=0,me=te.x-oe;me<=te.x+oe;me++)if(!(me<0||me>=V)){Le=T(1e3*C(me-ne.x)),fe[Le]||(fe[Le]={});for(var xt=te.y-he;xt<=te.y+he;xt++)xt<0||xt>=W||(ut=T(1e3*C(xt-ne.y)),fe[Le][ut]||(fe[Le][ut]=de(_(D(Le*ee,2)+D(ut*J,2))/1e3)),(Ie=fe[Le][ut])>0&&(Ce+=Ie,Se+=Ie*Z[be=4*(xt*V+me)],De+=Ie*Z[be+1],xe+=Ie*Z[be+2],je+=Ie*Z[be+3]))}se[be=4*(ue*G+ge)]=Se/Ce,se[be+1]=De/Ce,se[be+2]=xe/Ce,se[be+3]=je/Ce}return++ge<G?ae(ge):ie}(0)},bilinearFiltering:function(B,V,W,G,Y){var Z,ie,se,de,ce,le,ee,oe,he=0,fe=this.rcpScaleX,ne=this.rcpScaleY,te=4*(V-1),ae=B.imageData.data,ge=B.ctx.createImageData(G,Y),ue=ge.data;for(se=0;se<Y;se++)for(de=0;de<G;de++)for(ce=fe*de-(Z=T(fe*de)),le=ne*se-(ie=T(ne*se)),oe=4*(ie*V+Z),ee=0;ee<4;ee++)ue[he++]=ae[oe+ee]*(1-ce)*(1-le)+ae[oe+4+ee]*ce*(1-le)+ae[oe+te+ee]*le*(1-ce)+ae[oe+te+4+ee]*ce*le;return ge},hermiteFastResize:function(B,V,W,G,Y){for(var Z=this.rcpScaleX,ie=this.rcpScaleY,se=x(Z/2),de=x(ie/2),ce=B.imageData.data,le=B.ctx.createImageData(G,Y),ee=le.data,J=0;J<Y;J++)for(var oe=0;oe<G;oe++){for(var he=4*(oe+J*G),fe=0,ne=0,te=0,ae=0,ge=0,ue=0,me=0,Ie=(J+.5)*ie,be=T(J*ie);be<(J+1)*ie;be++)for(var Ce=C(Ie-(be+.5))/de,Se=(oe+.5)*Z,De=Ce*Ce,xe=T(oe*Z);xe<(oe+1)*Z;xe++){var je=C(Se-(xe+.5))/se,Le=_(De+je*je);Le>1&&Le<-1||(fe=2*Le*Le*Le-3*Le*Le+1)>0&&(me+=fe*ce[3+(je=4*(xe+be*V))],te+=fe,ce[je+3]<255&&(fe=fe*ce[je+3]/250),ae+=fe*ce[je],ge+=fe*ce[je+1],ue+=fe*ce[je+2],ne+=fe)}ee[he]=ae/ne,ee[he+1]=ge/ne,ee[he+2]=ue/ne,ee[he+3]=me/te}return le},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),w.Image.filters.Resize.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Contrast=(0,w.util.createClass)(D.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(_){if(0!==this.contrast){var C,I=_.imageData.data,O=I.length,x=Math.floor(255*this.contrast),M=259*(x+255)/(255*(259-x));for(C=0;C<O;C+=4)I[C]=M*(I[C]-128)+128,I[C+1]=M*(I[C+1]-128)+128,I[C+2]=M*(I[C+2]-128)+128}},getUniformLocations:function(_,C){return{uContrast:_.getUniformLocation(C,"uContrast")}},sendUniformData:function(_,C){_.uniform1f(C.uContrast,this.contrast)}}),w.Image.filters.Contrast.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Saturation=(0,w.util.createClass)(D.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(_){if(0!==this.saturation){var C,I,O=_.imageData.data,x=O.length,M=-this.saturation;for(C=0;C<x;C+=4)I=Math.max(O[C],O[C+1],O[C+2]),O[C]+=I!==O[C]?(I-O[C])*M:0,O[C+1]+=I!==O[C+1]?(I-O[C+1])*M:0,O[C+2]+=I!==O[C+2]?(I-O[C+2])*M:0}},getUniformLocations:function(_,C){return{uSaturation:_.getUniformLocation(C,"uSaturation")}},sendUniformData:function(_,C){_.uniform1f(C.uSaturation,-this.saturation)}}),w.Image.filters.Saturation.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Vibrance=(0,w.util.createClass)(D.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(_){if(0!==this.vibrance){var C,I,x,M=_.imageData.data,F=M.length,B=-this.vibrance;for(C=0;C<F;C+=4)I=Math.max(M[C],M[C+1],M[C+2]),x=2*Math.abs(I-(M[C]+M[C+1]+M[C+2])/3)/255*B,M[C]+=I!==M[C]?(I-M[C])*x:0,M[C+1]+=I!==M[C+1]?(I-M[C+1])*x:0,M[C+2]+=I!==M[C+2]?(I-M[C+2])*x:0}},getUniformLocations:function(_,C){return{uVibrance:_.getUniformLocation(C,"uVibrance")}},sendUniformData:function(_,C){_.uniform1f(C.uVibrance,-this.vibrance)}}),w.Image.filters.Vibrance.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Blur=(0,w.util.createClass)(D.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(_){_.webgl?(this.aspectRatio=_.sourceWidth/_.sourceHeight,_.passes++,this._setupFrameBuffer(_),this.horizontal=!0,this.applyToWebGL(_),this._swapTextures(_),this._setupFrameBuffer(_),this.horizontal=!1,this.applyToWebGL(_),this._swapTextures(_)):this.applyTo2d(_)},applyTo2d:function(_){_.imageData=this.simpleBlur(_)},simpleBlur:function(_){var C,I,O=_.filterBackend.resources,x=_.imageData.width,M=_.imageData.height;O.blurLayer1||(O.blurLayer1=w.util.createCanvasElement(),O.blurLayer2=w.util.createCanvasElement()),I=O.blurLayer2,(C=O.blurLayer1).width===x&&C.height===M||(I.width=C.width=x,I.height=C.height=M);var F,B,V,W,G=C.getContext("2d"),Y=I.getContext("2d"),Z=.06*this.blur*.5;for(G.putImageData(_.imageData,0,0),Y.clearRect(0,0,x,M),W=-15;W<=15;W++)V=Z*(B=W/15)*x+(F=(Math.random()-.5)/4),Y.globalAlpha=1-Math.abs(B),Y.drawImage(C,V,F),G.drawImage(I,0,0),Y.globalAlpha=1,Y.clearRect(0,0,I.width,I.height);for(W=-15;W<=15;W++)V=Z*(B=W/15)*M+(F=(Math.random()-.5)/4),Y.globalAlpha=1-Math.abs(B),Y.drawImage(C,F,V),G.drawImage(I,0,0),Y.globalAlpha=1,Y.clearRect(0,0,I.width,I.height);_.ctx.drawImage(C,0,0);var ie=_.ctx.getImageData(0,0,C.width,C.height);return G.globalAlpha=1,G.clearRect(0,0,C.width,C.height),ie},getUniformLocations:function(_,C){return{delta:_.getUniformLocation(C,"uDelta")}},sendUniformData:function(_,C){var I=this.chooseRightDelta();_.uniform2fv(C.delta,I)},chooseRightDelta:function(){var _,C=1,I=[0,0];return this.horizontal?this.aspectRatio>1&&(C=1/this.aspectRatio):this.aspectRatio<1&&(C=this.aspectRatio),_=C*this.blur*.12,this.horizontal?I[0]=_:I[1]=_,I}}),D.Blur.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Gamma=(0,w.util.createClass)(D.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(_){this.gamma=[1,1,1],D.BaseFilter.prototype.initialize.call(this,_)},applyTo2d:function(_){var C,I=_.imageData.data,O=this.gamma,x=I.length,M=1/O[0],F=1/O[1],B=1/O[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),C=0,x=256;C<x;C++)this.rVals[C]=255*Math.pow(C/255,M),this.gVals[C]=255*Math.pow(C/255,F),this.bVals[C]=255*Math.pow(C/255,B);for(C=0,x=I.length;C<x;C+=4)I[C]=this.rVals[I[C]],I[C+1]=this.gVals[I[C+1]],I[C+2]=this.bVals[I[C+2]]},getUniformLocations:function(_,C){return{uGamma:_.getUniformLocation(C,"uGamma")}},sendUniformData:function(_,C){_.uniform3fv(C.uGamma,this.gamma)}}),w.Image.filters.Gamma.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.Composed=(0,w.util.createClass)(D.BaseFilter,{type:"Composed",subFilters:[],initialize:function(_){this.callSuper("initialize",_),this.subFilters=this.subFilters.slice(0)},applyTo:function(_){_.passes+=this.subFilters.length-1,this.subFilters.forEach(function(C){C.applyTo(_)})},toObject:function(){return w.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(_){return _.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(_){return!_.isNeutralState()})}}),w.Image.filters.Composed.fromObject=function(_,C){var I=(_.subFilters||[]).map(function(x){return new w.Image.filters[x.type](x)}),O=new w.Image.filters.Composed({subFilters:I});return C&&C(O),O}}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.Image.filters;D.HueRotation=(0,w.util.createClass)(D.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var _=this.rotation*Math.PI,C=w.util.cos(_),I=w.util.sin(_),O=1/3,x=Math.sqrt(O)*I,M=1-C;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=C+M/3,this.matrix[1]=O*M-x,this.matrix[2]=O*M+x,this.matrix[5]=O*M+x,this.matrix[6]=C+O*M,this.matrix[7]=O*M-x,this.matrix[10]=O*M-x,this.matrix[11]=O*M+x,this.matrix[12]=C+O*M},isNeutralState:function(_){return this.calculateMatrix(),D.BaseFilter.prototype.isNeutralState.call(this,_)},applyTo:function(_){this.calculateMatrix(),D.BaseFilter.prototype.applyTo.call(this,_)}}),w.Image.filters.HueRotation.fromObject=w.Image.filters.BaseFilter.fromObject}(l),function(S){var w=S.fabric||(S.fabric={}),D=w.util.object.clone;if(w.Text)w.warn("fabric.Text is already defined");else{var T="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");w.Text=w.util.createClass(w.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:w.Object.prototype.stateProperties.concat(T),cacheProperties:w.Object.prototype.cacheProperties.concat(T),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(_,C){this.styles=C&&C.styles||{},this.text=_,this.__skipDimension=!0,this.callSuper("initialize",C),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var _=this.path;_&&(_.segmentsInfo=w.util.getPathSegmentsInfo(_.path))},getMeasuringContext:function(){return w._measuringContext||(w._measuringContext=this.canvas&&this.canvas.contextCache||w.util.createCanvasElement().getContext("2d")),w._measuringContext},_splitText:function(){var _=this._splitTextIntoLines(this.text);return this.textLines=_.lines,this._textLines=_.graphemeLines,this._unwrappedTextLines=_._unwrappedLines,this._text=_.graphemeText,_},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var _,C,O,x,M,F,B=0,V=this._textLines.length;B<V;B++)if(("justify"===this.textAlign||B!==V-1&&!this.isEndOfWrapping(B))&&(O=0,x=this._textLines[B],(C=this.getLineWidth(B))<this.width&&(F=this.textLines[B].match(this._reSpacesAndTabs)))){_=(this.width-C)/F.length;for(var W=0,G=x.length;W<=G;W++)M=this.__charBounds[B][W],this._reSpaceAndTab.test(x[W])?(M.width+=_,M.kernedWidth+=_,M.left+=O,O+=_):M.left+=O}},isEndOfWrapping:function(_){return _===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var _=this.callSuper("_getCacheCanvasDimensions"),C=this.fontSize;return _.width+=C*_.zoomX,_.height+=C*_.zoomY,_},_render:function(_){var C=this.path;C&&!C.isNotVisible()&&C._render(_),this._setTextStyles(_),this._renderTextLinesBackground(_),this._renderTextDecoration(_,"underline"),this._renderText(_),this._renderTextDecoration(_,"overline"),this._renderTextDecoration(_,"linethrough")},_renderText:function(_){"stroke"===this.paintFirst?(this._renderTextStroke(_),this._renderTextFill(_)):(this._renderTextFill(_),this._renderTextStroke(_))},_setTextStyles:function(_,C,I){if(_.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":_.textBaseline="middle";break;case"ascender":_.textBaseline="top";break;case"descender":_.textBaseline="bottom"}_.font=this._getFontDeclaration(C,I)},calcTextWidth:function(){for(var _=this.getLineWidth(0),C=1,I=this._textLines.length;C<I;C++){var O=this.getLineWidth(C);O>_&&(_=O)}return _},_renderTextLine:function(_,C,I,O,x,M){this._renderChars(_,C,I,O,x,M)},_renderTextLinesBackground:function(_){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var C,I,O,x,M,F,B,V=_.fillStyle,W=this._getLeftOffset(),G=this._getTopOffset(),Y=0,Z=0,ie=this.path,se=0,de=this._textLines.length;se<de;se++)if(C=this.getHeightOfLine(se),this.textBackgroundColor||this.styleHas("textBackgroundColor",se)){O=this._textLines[se],I=this._getLineLeftOffset(se),Z=0,Y=0,x=this.getValueOfPropertyAt(se,0,"textBackgroundColor");for(var ce=0,le=O.length;ce<le;ce++)M=this.__charBounds[se][ce],F=this.getValueOfPropertyAt(se,ce,"textBackgroundColor"),ie?(_.save(),_.translate(M.renderLeft,M.renderTop),_.rotate(M.angle),_.fillStyle=F,F&&_.fillRect(-M.width/2,-C/this.lineHeight*(1-this._fontSizeFraction),M.width,C/this.lineHeight),_.restore()):F!==x?(B=W+I+Y,"rtl"===this.direction&&(B=this.width-B-Z),_.fillStyle=x,x&&_.fillRect(B,G,Z,C/this.lineHeight),Y=M.left,Z=M.width,x=F):Z+=M.kernedWidth;F&&!ie&&(B=W+I+Y,"rtl"===this.direction&&(B=this.width-B-Z),_.fillStyle=F,_.fillRect(B,G,Z,C/this.lineHeight)),G+=C}else G+=C;_.fillStyle=V,this._removeShadow(_)}},getFontCache:function(_){var C=_.fontFamily.toLowerCase();w.charWidthsCache[C]||(w.charWidthsCache[C]={});var I=w.charWidthsCache[C],O=_.fontStyle.toLowerCase()+"_"+(_.fontWeight+"").toLowerCase();return I[O]||(I[O]={}),I[O]},_measureChar:function(_,C,I,O){var x,M,F,B,V=this.getFontCache(C),W=I+_,G=this._getFontDeclaration(C)===this._getFontDeclaration(O),Y=C.fontSize/this.CACHE_FONT_SIZE;if(I&&void 0!==V[I]&&(F=V[I]),void 0!==V[_]&&(B=x=V[_]),G&&void 0!==V[W]&&(B=(M=V[W])-F),void 0===x||void 0===F||void 0===M){var Z=this.getMeasuringContext();this._setTextStyles(Z,C,!0)}return void 0===x&&(B=x=Z.measureText(_).width,V[_]=x),void 0===F&&G&&I&&(F=Z.measureText(I).width,V[I]=F),G&&void 0===M&&(M=Z.measureText(W).width,V[W]=M,B=M-F),{width:x*Y,kernedWidth:B*Y}},getHeightOfChar:function(_,C){return this.getValueOfPropertyAt(_,C,"fontSize")},measureLine:function(_){var C=this._measureLine(_);return 0!==this.charSpacing&&(C.width-=this._getWidthOfCharSpacing()),C.width<0&&(C.width=0),C},_measureLine:function(_){var C,I,O,x,M,F,B=0,V=this._textLines[_],W=new Array(V.length),G=0,Y=this.path,Z="right"===this.pathSide;for(this.__charBounds[_]=W,C=0;C<V.length;C++)x=this._getGraphemeBox(I=V[C],_,C,O),W[C]=x,B+=x.kernedWidth,O=I;if(W[C]={left:x?x.left+x.width:0,width:0,kernedWidth:0,height:this.fontSize},Y){switch(F=Y.segmentsInfo[Y.segmentsInfo.length-1].length,(M=w.util.getPointOnPath(Y.path,0,Y.segmentsInfo)).x+=Y.pathOffset.x,M.y+=Y.pathOffset.y,this.textAlign){case"left":G=Z?F-B:0;break;case"center":G=(F-B)/2;break;case"right":G=Z?0:F-B}for(G+=this.pathStartOffset*(Z?-1:1),C=Z?V.length-1:0;Z?C>=0:C<V.length;Z?C--:C++)G>F?G%=F:G<0&&(G+=F),this._setGraphemeOnPath(G,x=W[C],M),G+=x.kernedWidth}return{width:B,numOfSpaces:0}},_setGraphemeOnPath:function(_,C,I){var x=this.path,M=w.util.getPointOnPath(x.path,_+C.kernedWidth/2,x.segmentsInfo);C.renderLeft=M.x-I.x,C.renderTop=M.y-I.y,C.angle=M.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(_,C,I,O,x){var M,F=this.getCompleteStyleDeclaration(C,I),B=O?this.getCompleteStyleDeclaration(C,I-1):{},V=this._measureChar(_,F,O,B),W=V.kernedWidth,G=V.width;0!==this.charSpacing&&(G+=M=this._getWidthOfCharSpacing(),W+=M);var Y={width:G,left:0,height:F.fontSize,kernedWidth:W,deltaY:F.deltaY};if(I>0&&!x){var Z=this.__charBounds[C][I-1];Y.left=Z.left+Z.width+V.kernedWidth-V.width}return Y},getHeightOfLine:function(_){if(this.__lineHeights[_])return this.__lineHeights[_];for(var C=this._textLines[_],I=this.getHeightOfChar(_,0),O=1,x=C.length;O<x;O++)I=Math.max(this.getHeightOfChar(_,O),I);return this.__lineHeights[_]=I*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var _,C=0,I=0,O=this._textLines.length;I<O;I++)_=this.getHeightOfLine(I),C+=I===O-1?_/this.lineHeight:_;return C},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(_,C){_.save();for(var I=0,O=this._getLeftOffset(),x=this._getTopOffset(),M=0,F=this._textLines.length;M<F;M++){var B=this.getHeightOfLine(M),V=B/this.lineHeight,W=this._getLineLeftOffset(M);this._renderTextLine(C,_,this._textLines[M],O+W,x+I+V,M),I+=B}_.restore()},_renderTextFill:function(_){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(_,"fillText")},_renderTextStroke:function(_){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(_),_.save(),this._setLineDash(_,this.strokeDashArray),_.beginPath(),this._renderTextCommon(_,"strokeText"),_.closePath(),_.restore())},_renderChars:function(_,C,I,O,x,M){var F,B,V,W,Y=this.getHeightOfLine(M),Z=-1!==this.textAlign.indexOf("justify"),ie="",se=0,de=this.path,ce=!Z&&0===this.charSpacing&&this.isEmptyStyles(M)&&!de,le="ltr"===this.direction,ee="ltr"===this.direction?1:-1,J=C.canvas.getAttribute("dir");if(C.save(),J!==this.direction&&(C.canvas.setAttribute("dir",le?"ltr":"rtl"),C.direction=le?"ltr":"rtl",C.textAlign=le?"left":"right"),x-=Y*this._fontSizeFraction/this.lineHeight,ce)return this._renderChar(_,C,M,0,I.join(""),O,x,Y),void C.restore();for(var oe=0,he=I.length-1;oe<=he;oe++)W=oe===he||this.charSpacing||de,ie+=I[oe],V=this.__charBounds[M][oe],0===se?(O+=ee*(V.kernedWidth-V.width),se+=V.width):se+=V.kernedWidth,Z&&!W&&this._reSpaceAndTab.test(I[oe])&&(W=!0),W||(F=F||this.getCompleteStyleDeclaration(M,oe),B=this.getCompleteStyleDeclaration(M,oe+1),W=this._hasStyleChanged(F,B)),W&&(de?(C.save(),C.translate(V.renderLeft,V.renderTop),C.rotate(V.angle),this._renderChar(_,C,M,oe,ie,-se/2,0,Y),C.restore()):this._renderChar(_,C,M,oe,ie,O,x,Y),ie="",F=B,O+=ee*se,se=0);C.restore()},_applyPatternGradientTransformText:function(_){var C,I=w.util.createCanvasElement(),O=this.width+this.strokeWidth,x=this.height+this.strokeWidth;return I.width=O,I.height=x,(C=I.getContext("2d")).beginPath(),C.moveTo(0,0),C.lineTo(O,0),C.lineTo(O,x),C.lineTo(0,x),C.closePath(),C.translate(O/2,x/2),C.fillStyle=_.toLive(C),this._applyPatternGradientTransform(C,_),C.fill(),C.createPattern(I,"no-repeat")},handleFiller:function(_,C,I){var O,x;return I.toLive?"percentage"===I.gradientUnits||I.gradientTransform||I.patternTransform?(_.translate(O=-this.width/2,x=-this.height/2),_[C]=this._applyPatternGradientTransformText(I),{offsetX:O,offsetY:x}):(_[C]=I.toLive(_,this),this._applyPatternGradientTransform(_,I)):(_[C]=I,{offsetX:0,offsetY:0})},_setStrokeStyles:function(_,C){return _.lineWidth=C.strokeWidth,_.lineCap=this.strokeLineCap,_.lineDashOffset=this.strokeDashOffset,_.lineJoin=this.strokeLineJoin,_.miterLimit=this.strokeMiterLimit,this.handleFiller(_,"strokeStyle",C.stroke)},_setFillStyles:function(_,C){return this.handleFiller(_,"fillStyle",C.fill)},_renderChar:function(_,C,I,O,x,M,F){var B,V,W=this._getStyleDeclaration(I,O),G=this.getCompleteStyleDeclaration(I,O),Y="fillText"===_&&G.fill,Z="strokeText"===_&&G.stroke&&G.strokeWidth;(Z||Y)&&(C.save(),Y&&(B=this._setFillStyles(C,G)),Z&&(V=this._setStrokeStyles(C,G)),C.font=this._getFontDeclaration(G),W&&W.textBackgroundColor&&this._removeShadow(C),W&&W.deltaY&&(F+=W.deltaY),Y&&C.fillText(x,M-B.offsetX,F-B.offsetY),Z&&C.strokeText(x,M-V.offsetX,F-V.offsetY),C.restore())},setSuperscript:function(_,C){return this._setScript(_,C,this.superscript)},setSubscript:function(_,C){return this._setScript(_,C,this.subscript)},_setScript:function(_,C,I){var O=this.get2DCursorLocation(_,!0),x=this.getValueOfPropertyAt(O.lineIndex,O.charIndex,"fontSize"),M=this.getValueOfPropertyAt(O.lineIndex,O.charIndex,"deltaY");return this.setSelectionStyles({fontSize:x*I.size,deltaY:M+x*I.baseline},_,C),this},_hasStyleChanged:function(_,C){return _.fill!==C.fill||_.stroke!==C.stroke||_.strokeWidth!==C.strokeWidth||_.fontSize!==C.fontSize||_.fontFamily!==C.fontFamily||_.fontWeight!==C.fontWeight||_.fontStyle!==C.fontStyle||_.deltaY!==C.deltaY},_hasStyleChangedForSvg:function(_,C){return this._hasStyleChanged(_,C)||_.overline!==C.overline||_.underline!==C.underline||_.linethrough!==C.linethrough},_getLineLeftOffset:function(_){var C=this.getLineWidth(_),I=this.width-C,O=this.textAlign,x=this.direction,M=0,F=this.isEndOfWrapping(_);return"justify"===O||"justify-center"===O&&!F||"justify-right"===O&&!F||"justify-left"===O&&!F?0:("center"===O&&(M=I/2),"right"===O&&(M=I),"justify-center"===O&&(M=I/2),"justify-right"===O&&(M=I),"rtl"===x&&(M-=I),M)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var _=this._forceClearCache;return _||(_=this.hasStateChanged("_dimensionAffectingProps")),_&&(this.dirty=!0,this._forceClearCache=!1),_},getLineWidth:function(_){if(void 0!==this.__lineWidths[_])return this.__lineWidths[_];var C=this.measureLine(_).width;return this.__lineWidths[_]=C,C},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(_,C,I){var O=this._getStyleDeclaration(_,C);return O&&void 0!==O[I]?O[I]:this[I]},_renderTextDecoration:function(_,C){if(this[C]||this.styleHas(C)){for(var I,O,x,M,F,B,V,W,G,Y,Z,ie,se,de,ce,le,ee=this._getLeftOffset(),J=this._getTopOffset(),oe=this.path,he=this._getWidthOfCharSpacing(),fe=this.offsets[C],ne=0,te=this._textLines.length;ne<te;ne++)if(I=this.getHeightOfLine(ne),this[C]||this.styleHas(C,ne)){V=this._textLines[ne],de=I/this.lineHeight,M=this._getLineLeftOffset(ne),Y=0,Z=0,W=this.getValueOfPropertyAt(ne,0,C),le=this.getValueOfPropertyAt(ne,0,"fill"),G=J+de*(1-this._fontSizeFraction),O=this.getHeightOfChar(ne,0),F=this.getValueOfPropertyAt(ne,0,"deltaY");for(var ae=0,ge=V.length;ae<ge;ae++)if(ie=this.__charBounds[ne][ae],se=this.getValueOfPropertyAt(ne,ae,C),ce=this.getValueOfPropertyAt(ne,ae,"fill"),x=this.getHeightOfChar(ne,ae),B=this.getValueOfPropertyAt(ne,ae,"deltaY"),oe&&se&&ce)_.save(),_.fillStyle=le,_.translate(ie.renderLeft,ie.renderTop),_.rotate(ie.angle),_.fillRect(-ie.kernedWidth/2,fe*x+B,ie.kernedWidth,this.fontSize/15),_.restore();else if((se!==W||ce!==le||x!==O||B!==F)&&Z>0){var ue=ee+M+Y;"rtl"===this.direction&&(ue=this.width-ue-Z),W&&le&&(_.fillStyle=le,_.fillRect(ue,G+fe*O+F,Z,this.fontSize/15)),Y=ie.left,Z=ie.width,W=se,le=ce,O=x,F=B}else Z+=ie.kernedWidth;ue=ee+M+Y,"rtl"===this.direction&&(ue=this.width-ue-Z),_.fillStyle=ce,se&&ce&&_.fillRect(ue,G+fe*O+F,Z-he,this.fontSize/15),J+=I}else J+=I;this._removeShadow(_)}},_getFontDeclaration:function(_,C){var I=_||this,O=this.fontFamily,x=w.Text.genericFonts.indexOf(O.toLowerCase())>-1,M=void 0===O||O.indexOf("'")>-1||O.indexOf(",")>-1||O.indexOf('"')>-1||x?I.fontFamily:'"'+I.fontFamily+'"';return[w.isLikelyNode?I.fontWeight:I.fontStyle,w.isLikelyNode?I.fontStyle:I.fontWeight,C?this.CACHE_FONT_SIZE+"px":I.fontSize+"px",M].join(" ")},render:function(_){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",_)))},_splitTextIntoLines:function(_){for(var C=_.split(this._reNewline),I=new Array(C.length),O=["\n"],x=[],M=0;M<C.length;M++)I[M]=w.util.string.graphemeSplit(C[M]),x=x.concat(I[M],O);return x.pop(),{_unwrappedLines:I,lines:C,graphemeText:x,graphemeLines:I}},toObject:function(_){var C=T.concat(_),I=this.callSuper("toObject",C);return I.styles=D(this.styles,!0),I.path&&(I.path=this.path.toObject()),I},set:function(_,C){this.callSuper("set",_,C);var I=!1,O=!1;if("object"==typeof _)for(var x in _)"path"===x&&this.setPathInfo(),I=I||-1!==this._dimensionAffectingProps.indexOf(x),O=O||"path"===x;else I=-1!==this._dimensionAffectingProps.indexOf(_),O="path"===_;return O&&this.setPathInfo(),I&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),w.Text.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),w.Text.DEFAULT_SVG_FONT_SIZE=16,w.Text.fromElement=function(_,C,I){if(!_)return C(null);var O=w.parseAttributes(_,w.Text.ATTRIBUTE_NAMES),x=O.textAnchor||"left";if((I=w.util.object.extend(I?D(I):{},O)).top=I.top||0,I.left=I.left||0,O.textDecoration){var M=O.textDecoration;-1!==M.indexOf("underline")&&(I.underline=!0),-1!==M.indexOf("overline")&&(I.overline=!0),-1!==M.indexOf("line-through")&&(I.linethrough=!0),delete I.textDecoration}"dx"in O&&(I.left+=O.dx),"dy"in O&&(I.top+=O.dy),"fontSize"in I||(I.fontSize=w.Text.DEFAULT_SVG_FONT_SIZE);var F="";"textContent"in _?F=_.textContent:"firstChild"in _&&null!==_.firstChild&&"data"in _.firstChild&&null!==_.firstChild.data&&(F=_.firstChild.data),F=F.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var B=I.strokeWidth;I.strokeWidth=0;var V=new w.Text(F,I),W=V.getScaledHeight()/V.height,G=((V.height+V.strokeWidth)*V.lineHeight-V.height)*W,Y=V.getScaledHeight()+G,Z=0;"center"===x&&(Z=V.getScaledWidth()/2),"right"===x&&(Z=V.getScaledWidth()),V.set({left:V.left-Z,top:V.top-(Y-V.fontSize*(.07+V._fontSizeFraction))/V.lineHeight,strokeWidth:void 0!==B?B:1}),C(V)},w.Text.fromObject=function(_,C){var I=D(_),O=_.path;return delete I.path,w.Object._fromObject("Text",I,function(x){O?w.Object._fromObject("Path",O,function(M){x.set("path",M),C(x)},"path"):C(x)},"text")},w.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],w.util.createAccessors&&w.util.createAccessors(w.Text)}}(l),P.util.object.extend(P.Text.prototype,{isEmptyStyles:function(S){if(!this.styles||void 0!==S&&!this.styles[S])return!0;var w=void 0===S?this.styles:{line:this.styles[S]};for(var D in w)for(var T in w[D])for(var _ in w[D][T])return!1;return!0},styleHas:function(S,w){if(!this.styles||!S||""===S||void 0!==w&&!this.styles[w])return!1;var D=void 0===w?this.styles:{0:this.styles[w]};for(var T in D)for(var _ in D[T])if(void 0!==D[T][_][S])return!0;return!1},cleanStyle:function(S){if(!this.styles||!S||""===S)return!1;var w,D,T=this.styles,_=0,C=!0,I=0;for(var O in T){for(var x in w=0,T[O]){var M;_++,(M=T[O][x]).hasOwnProperty(S)?(D?M[S]!==D&&(C=!1):D=M[S],M[S]===this[S]&&delete M[S]):C=!1,0!==Object.keys(M).length?w++:delete T[O][x]}0===w&&delete T[O]}for(var F=0;F<this._textLines.length;F++)I+=this._textLines[F].length;C&&_===I&&(this[S]=D,this.removeStyle(S))},removeStyle:function(S){if(this.styles&&S&&""!==S){var w,D,T,_=this.styles;for(D in _){for(T in w=_[D])delete w[T][S],0===Object.keys(w[T]).length&&delete w[T];0===Object.keys(w).length&&delete _[D]}}},_extendStyles:function(S,w){var D=this.get2DCursorLocation(S);this._getLineStyle(D.lineIndex)||this._setLineStyle(D.lineIndex),this._getStyleDeclaration(D.lineIndex,D.charIndex)||this._setStyleDeclaration(D.lineIndex,D.charIndex,{}),P.util.object.extend(this._getStyleDeclaration(D.lineIndex,D.charIndex),w)},get2DCursorLocation:function(S,w){void 0===S&&(S=this.selectionStart);for(var D=w?this._unwrappedTextLines:this._textLines,T=D.length,_=0;_<T;_++){if(S<=D[_].length)return{lineIndex:_,charIndex:S};S-=D[_].length+this.missingNewlineOffset(_)}return{lineIndex:_-1,charIndex:D[_-1].length<S?D[_-1].length:S}},getSelectionStyles:function(S,w,D){void 0===S&&(S=this.selectionStart||0),void 0===w&&(w=this.selectionEnd||S);for(var T=[],_=S;_<w;_++)T.push(this.getStyleAtPosition(_,D));return T},getStyleAtPosition:function(S,w){var D=this.get2DCursorLocation(S);return(w?this.getCompleteStyleDeclaration(D.lineIndex,D.charIndex):this._getStyleDeclaration(D.lineIndex,D.charIndex))||{}},setSelectionStyles:function(S,w,D){void 0===w&&(w=this.selectionStart||0),void 0===D&&(D=this.selectionEnd||w);for(var T=w;T<D;T++)this._extendStyles(T,S);return this._forceClearCache=!0,this},_getStyleDeclaration:function(S,w){var D=this.styles&&this.styles[S];return D?D[w]:null},getCompleteStyleDeclaration:function(S,w){for(var D,T=this._getStyleDeclaration(S,w)||{},_={},C=0;C<this._styleProperties.length;C++)_[D=this._styleProperties[C]]=void 0===T[D]?this[D]:T[D];return _},_setStyleDeclaration:function(S,w,D){this.styles[S][w]=D},_deleteStyleDeclaration:function(S,w){delete this.styles[S][w]},_getLineStyle:function(S){return!!this.styles[S]},_setLineStyle:function(S){this.styles[S]={}},_deleteLineStyle:function(S){delete this.styles[S]}}),function(){function S(w){w.textDecoration&&(w.textDecoration.indexOf("underline")>-1&&(w.underline=!0),w.textDecoration.indexOf("line-through")>-1&&(w.linethrough=!0),w.textDecoration.indexOf("overline")>-1&&(w.overline=!0),delete w.textDecoration)}P.IText=P.util.createClass(P.Text,P.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(w,D){this.callSuper("initialize",w,D),this.initBehavior()},setSelectionStart:function(w){w=Math.max(w,0),this._updateAndFire("selectionStart",w)},setSelectionEnd:function(w){w=Math.min(w,this.text.length),this._updateAndFire("selectionEnd",w)},_updateAndFire:function(w,D){this[w]!==D&&(this._fireSelectionChanged(),this[w]=D),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(w){this.clearContextTop(),this.callSuper("render",w),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(w){this.callSuper("_render",w)},clearContextTop:function(w){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var D=this.canvas.contextTop,T=this.canvas.viewportTransform;D.save(),D.transform(T[0],T[1],T[2],T[3],T[4],T[5]),this.transform(D),this._clearTextArea(D),w||D.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var w=this._getCursorBoundaries(),D=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(w,D):this.renderSelection(w,D),D.restore()}},_clearTextArea:function(w){var D=this.width+4,T=this.height+4;w.clearRect(-D/2,-T/2,D,T)},_getCursorBoundaries:function(w){void 0===w&&(w=this.selectionStart);var D=this._getLeftOffset(),T=this._getTopOffset(),_=this._getCursorBoundariesOffsets(w);return{left:D,top:T,leftOffset:_.left,topOffset:_.top}},_getCursorBoundariesOffsets:function(w){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var D,T,_,C,I=0,O=0,x=this.get2DCursorLocation(w);_=x.charIndex,T=x.lineIndex;for(var M=0;M<T;M++)I+=this.getHeightOfLine(M);D=this._getLineLeftOffset(T);var F=this.__charBounds[T][_];return F&&(O=F.left),0!==this.charSpacing&&_===this._textLines[T].length&&(O-=this._getWidthOfCharSpacing()),C={top:I,left:D+(O>0?O:0)},"rtl"===this.direction&&(C.left*=-1),this.cursorOffsetCache=C,this.cursorOffsetCache},renderCursor:function(w,D){var T=this.get2DCursorLocation(),_=T.lineIndex,C=T.charIndex>0?T.charIndex-1:0,I=this.getValueOfPropertyAt(_,C,"fontSize"),O=this.scaleX*this.canvas.getZoom(),x=this.cursorWidth/O,M=w.topOffset,F=this.getValueOfPropertyAt(_,C,"deltaY");M+=(1-this._fontSizeFraction)*this.getHeightOfLine(_)/this.lineHeight-I*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(w,D),D.fillStyle=this.cursorColor||this.getValueOfPropertyAt(_,C,"fill"),D.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,D.fillRect(w.left+w.leftOffset-x/2,M+w.top+F,x,I)},renderSelection:function(w,D){for(var T=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,_=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,C=-1!==this.textAlign.indexOf("justify"),I=this.get2DCursorLocation(T),O=this.get2DCursorLocation(_),x=I.lineIndex,M=O.lineIndex,F=I.charIndex<0?0:I.charIndex,B=O.charIndex<0?0:O.charIndex,V=x;V<=M;V++){var W,G=this._getLineLeftOffset(V)||0,Y=this.getHeightOfLine(V),Z=0,ie=0;if(V===x&&(Z=this.__charBounds[x][F].left),V>=x&&V<M)ie=C&&!this.isEndOfWrapping(V)?this.width:this.getLineWidth(V)||5;else if(V===M)if(0===B)ie=this.__charBounds[M][B].left;else{var se=this._getWidthOfCharSpacing();ie=this.__charBounds[M][B-1].left+this.__charBounds[M][B-1].width-se}W=Y,(this.lineHeight<1||V===M&&this.lineHeight>1)&&(Y/=this.lineHeight);var de=w.left+G+Z,ce=ie-Z,le=Y,ee=0;this.inCompositionMode?(D.fillStyle=this.compositionColor||"black",le=1,ee=Y):D.fillStyle=this.selectionColor,"rtl"===this.direction&&(de=this.width-de-ce),D.fillRect(de,w.top+w.topOffset+ee,ce,le),w.topOffset+=W}},getCurrentCharFontSize:function(){var w=this._getCurrentCharIndex();return this.getValueOfPropertyAt(w.l,w.c,"fontSize")},getCurrentCharColor:function(){var w=this._getCurrentCharIndex();return this.getValueOfPropertyAt(w.l,w.c,"fill")},_getCurrentCharIndex:function(){var w=this.get2DCursorLocation(this.selectionStart,!0);return{l:w.lineIndex,c:w.charIndex>0?w.charIndex-1:0}}}),P.IText.fromObject=function(w,D){if(S(w),w.styles)for(var T in w.styles)for(var _ in w.styles[T])S(w.styles[T][_]);P.Object._fromObject("IText",w,D,"text")}}(),Re=P.util.object.clone,P.util.object.extend(P.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var S=this;this.on("added",function(){var w=S.canvas;w&&(w._hasITextHandlers||(w._hasITextHandlers=!0,S._initCanvasHandlers(w)),w._iTextInstances=w._iTextInstances||[],w._iTextInstances.push(S))})},initRemovedHandler:function(){var S=this;this.on("removed",function(){var w=S.canvas;w&&(w._iTextInstances=w._iTextInstances||[],P.util.removeFromArray(w._iTextInstances,S),0===w._iTextInstances.length&&(w._hasITextHandlers=!1,S._removeCanvasHandlers(w)))})},_initCanvasHandlers:function(S){S._mouseUpITextHandler=function(){S._iTextInstances&&S._iTextInstances.forEach(function(w){w.__isMousedown=!1})},S.on("mouse:up",S._mouseUpITextHandler)},_removeCanvasHandlers:function(S){S.off("mouse:up",S._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(S,w,D,T){var _;return _={isAborted:!1,abort:function(){this.isAborted=!0}},S.animate("_currentCursorOpacity",w,{duration:D,onComplete:function(){_.isAborted||S[T]()},onChange:function(){S.canvas&&S.selectionStart===S.selectionEnd&&S.renderCursorOrSelection()},abort:function(){return _.isAborted}}),_},_onTickComplete:function(){var S=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){S._currentTickCompleteState=S._animateCursor(S,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(S){var w=this,D=S?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){w._tick()},D)},abortCursorAnimation:function(){var S=this._currentTickState||this._currentTickCompleteState,w=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,S&&w&&w.clearContext(w.contextTop||w.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(S){var w=0,D=S-1;if(this._reSpace.test(this._text[D]))for(;this._reSpace.test(this._text[D]);)w++,D--;for(;/\S/.test(this._text[D])&&D>-1;)w++,D--;return S-w},findWordBoundaryRight:function(S){var w=0,D=S;if(this._reSpace.test(this._text[D]))for(;this._reSpace.test(this._text[D]);)w++,D++;for(;/\S/.test(this._text[D])&&D<this._text.length;)w++,D++;return S+w},findLineBoundaryLeft:function(S){for(var w=0,D=S-1;!/\n/.test(this._text[D])&&D>-1;)w++,D--;return S-w},findLineBoundaryRight:function(S){for(var w=0,D=S;!/\n/.test(this._text[D])&&D<this._text.length;)w++,D++;return S+w},searchWordBoundary:function(S,w){for(var D=this._text,T=this._reSpace.test(D[S])?S-1:S,_=D[T],C=P.reNonWord;!C.test(_)&&T>0&&T<D.length;)_=D[T+=w];return C.test(_)&&(T+=1===w?0:1),T},selectWord:function(S){var w=this.searchWordBoundary(S=S||this.selectionStart,-1),D=this.searchWordBoundary(S,1);this.selectionStart=w,this.selectionEnd=D,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(S){var w=this.findLineBoundaryLeft(S=S||this.selectionStart),D=this.findLineBoundaryRight(S);return this.selectionStart=w,this.selectionEnd=D,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(S){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(S),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(S){S._iTextInstances&&S._iTextInstances.forEach(function(w){w.selected=!1,w.isEditing&&w.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(S){if(this.__isMousedown&&this.isEditing){var w=this.getSelectionStartFromPointer(S.e),D=this.selectionStart,T=this.selectionEnd;(w===this.__selectionStartOnMouseDown&&D!==T||D!==w&&T!==w)&&(w>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=w):(this.selectionStart=w,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===D&&this.selectionEnd===T||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(S,w,D){var T=D.slice(0,S),_=P.util.string.graphemeSplit(T).length;if(S===w)return{selectionStart:_,selectionEnd:_};var C=D.slice(S,w);return{selectionStart:_,selectionEnd:_+P.util.string.graphemeSplit(C).length}},fromGraphemeToStringSelection:function(S,w,D){var T=D.slice(0,S).join("").length;return S===w?{selectionStart:T,selectionEnd:T}:{selectionStart:T,selectionEnd:T+D.slice(S,w).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var S=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=S.selectionStart,this.hiddenTextarea.selectionEnd=S.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=S.selectionEnd,this.inCompositionMode||(this.selectionStart=S.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var S=this._calcTextareaPosition();this.hiddenTextarea.style.left=S.left,this.hiddenTextarea.style.top=S.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var S=this.inCompositionMode?this.compositionStart:this.selectionStart,w=this._getCursorBoundaries(S),D=this.get2DCursorLocation(S),C=this.getValueOfPropertyAt(D.lineIndex,D.charIndex,"fontSize")*this.lineHeight,I=w.leftOffset,O=this.calcTransformMatrix(),x={x:w.left+I,y:w.top+w.topOffset+C},M=this.canvas.getRetinaScaling(),F=this.canvas.upperCanvasEl,B=F.width/M,V=F.height/M,W=B-C,G=V-C,Y=F.clientWidth/B,Z=F.clientHeight/V;return x=P.util.transformPoint(x,O),(x=P.util.transformPoint(x,this.canvas.viewportTransform)).x*=Y,x.y*=Z,x.x<0&&(x.x=0),x.x>W&&(x.x=W),x.y<0&&(x.y=0),x.y>G&&(x.y=G),x.x+=this.canvas._offset.left,x.y+=this.canvas._offset.top,{left:x.x+"px",top:x.y+"px",fontSize:C+"px",charHeight:C}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var S=this._textBeforeEdit!==this.text,w=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,w&&(w.blur&&w.blur(),w.parentNode&&w.parentNode.removeChild(w)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),S&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),S&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var S in this.styles)this._textLines[S]||delete this.styles[S]},removeStyleFromTo:function(S,w){var D,T,_=this.get2DCursorLocation(S,!0),C=this.get2DCursorLocation(w,!0),I=_.lineIndex,O=_.charIndex,x=C.lineIndex,M=C.charIndex;if(I!==x){if(this.styles[I])for(D=O;D<this._unwrappedTextLines[I].length;D++)delete this.styles[I][D];if(this.styles[x])for(D=M;D<this._unwrappedTextLines[x].length;D++)(T=this.styles[x][D])&&(this.styles[I]||(this.styles[I]={}),this.styles[I][O+D-M]=T);for(D=I+1;D<=x;D++)delete this.styles[D];this.shiftLineStyles(x,I-x)}else if(this.styles[I]){T=this.styles[I];var F,B,V=M-O;for(D=O;D<M;D++)delete T[D];for(B in this.styles[I])(F=parseInt(B,10))>=M&&(T[F-V]=T[B],delete T[B])}},shiftLineStyles:function(S,w){var D=Re(this.styles);for(var T in this.styles){var _=parseInt(T,10);_>S&&(this.styles[_+w]=D[_],D[_-w]||delete this.styles[_])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(S,w,D,T){var _,C={},I=!1,O=this._unwrappedTextLines[S].length===w;for(var x in D||(D=1),this.shiftLineStyles(S,D),this.styles[S]&&(_=this.styles[S][0===w?w:w-1]),this.styles[S]){var M=parseInt(x,10);M>=w&&(I=!0,C[M-w]=this.styles[S][x],O&&0===w||delete this.styles[S][x])}var F=!1;for(I&&!O&&(this.styles[S+D]=C,F=!0),F&&D--;D>0;)T&&T[D-1]?this.styles[S+D]={0:Re(T[D-1])}:_?this.styles[S+D]={0:Re(_)}:delete this.styles[S+D],D--;this._forceClearCache=!0},insertCharStyleObject:function(S,w,D,T){this.styles||(this.styles={});var _=this.styles[S],C=_?Re(_):{};for(var I in D||(D=1),C){var O=parseInt(I,10);O>=w&&(_[O+D]=C[O],C[O-D]||delete _[O])}if(this._forceClearCache=!0,T)for(;D--;)Object.keys(T[D]).length&&(this.styles[S]||(this.styles[S]={}),this.styles[S][w+D]=Re(T[D]));else if(_)for(var x=_[w?w-1:1];x&&D--;)this.styles[S][w+D]=Re(x)},insertNewStyleBlock:function(S,w,D){for(var T=this.get2DCursorLocation(w,!0),_=[0],C=0,I=0;I<S.length;I++)"\n"===S[I]?_[++C]=0:_[C]++;for(_[0]>0&&(this.insertCharStyleObject(T.lineIndex,T.charIndex,_[0],D),D=D&&D.slice(_[0]+1)),C&&this.insertNewlineStyleObject(T.lineIndex,T.charIndex+_[0],C),I=1;I<C;I++)_[I]>0?this.insertCharStyleObject(T.lineIndex+I,0,_[I],D):D&&this.styles[T.lineIndex+I]&&D[0]&&(this.styles[T.lineIndex+I][0]=D[0]),D=D&&D.slice(_[I]+1);_[I]>0&&this.insertCharStyleObject(T.lineIndex+I,0,_[I],D)},setSelectionStartEndWithShift:function(S,w,D){D<=S?(w===S?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=S),this.selectionStart=D):D>S&&D<w?"right"===this._selectionDirection?this.selectionEnd=D:this.selectionStart=D:(w===S?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=w),this.selectionEnd=D)},setSelectionInBoundaries:function(){var S=this.text.length;this.selectionStart>S?this.selectionStart=S:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>S?this.selectionEnd=S:this.selectionEnd<0&&(this.selectionEnd=0)}}),P.util.object.extend(P.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(S){if(this.canvas){this.__newClickTime=+new Date;var w=S.pointer;this.isTripleClick(w)&&(this.fire("tripleclick",S),this._stopEvent(S.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=w,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(S){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===S.x&&this.__lastPointer.y===S.y},_stopEvent:function(S){S.preventDefault&&S.preventDefault(),S.stopPropagation&&S.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(S){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(S.e))},tripleClickHandler:function(S){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(S.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(S){!this.canvas||!this.editable||S.e.button&&1!==S.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(S.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(S){!this.canvas||!this.editable||S.e.button&&1!==S.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(S){if(this.__isMousedown=!1,!(!this.editable||this.group||S.transform&&S.transform.actionPerformed||S.e.button&&1!==S.e.button)){if(this.canvas){var w=this.canvas._activeObject;if(w&&w!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(S.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(S){var w=this.getSelectionStartFromPointer(S);S.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,w):(this.selectionStart=w,this.selectionEnd=w),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(S){for(var w,D=this.getLocalPointer(S),T=0,_=0,C=0,I=0,O=0,x=0,M=this._textLines.length;x<M&&C<=D.y;x++)C+=this.getHeightOfLine(x)*this.scaleY,O=x,x>0&&(I+=this._textLines[x-1].length+this.missingNewlineOffset(x-1));_=this._getLineLeftOffset(O)*this.scaleX,w=this._textLines[O],"rtl"===this.direction&&(D.x=this.width*this.scaleX-D.x+_);for(var F=0,B=w.length;F<B&&(T=_,(_+=this.__charBounds[O][F].kernedWidth*this.scaleX)<=D.x);F++)I++;return this._getNewSelectionStartFromOffset(D,T,_,I,B)},_getNewSelectionStartFromOffset:function(S,w,D,T,_){var I=D-S.x,O=T+(I>S.x-w||I<0?0:1);return this.flipX&&(O=_-O),O>this._text.length&&(O=this._text.length),O}}),P.util.object.extend(P.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=P.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var S=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+S.top+"; left: "+S.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+S.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):P.document.body.appendChild(this.hiddenTextarea),P.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),P.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),P.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),P.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),P.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),P.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),P.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(P.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(S){if(this.isEditing){var w="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(S.keyCode in w)this[w[S.keyCode]](S);else{if(!(S.keyCode in this.ctrlKeysMapDown)||!S.ctrlKey&&!S.metaKey)return;this[this.ctrlKeysMapDown[S.keyCode]](S)}S.stopImmediatePropagation(),S.preventDefault(),S.keyCode>=33&&S.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(S){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:S.keyCode in this.ctrlKeysMapUp&&(S.ctrlKey||S.metaKey)&&(this[this.ctrlKeysMapUp[S.keyCode]](S),S.stopImmediatePropagation(),S.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(S){var w=this.fromPaste;if(this.fromPaste=!1,S&&S.stopPropagation(),this.isEditing){var D,T,_,C,I,O=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,x=this._text.length,M=O.length,F=M-x,B=this.selectionStart,V=this.selectionEnd,W=B!==V;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var G=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),Y=B>G.selectionStart;W?(D=this._text.slice(B,V),F+=V-B):M<x&&(D=Y?this._text.slice(V+F,V):this._text.slice(B,B-F)),T=O.slice(G.selectionEnd-F,G.selectionEnd),D&&D.length&&(T.length&&(_=this.getSelectionStyles(B,B+1,!1),_=T.map(function(){return _[0]})),W?(C=B,I=V):Y?(C=V-D.length,I=V):(C=V,I=V+D.length),this.removeStyleFromTo(C,I)),T.length&&(w&&T.join("")===P.copiedText&&!P.disableStyleCopyPaste&&(_=P.copiedTextStyle),this.insertNewStyleBlock(T,B,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(S){this.compositionStart=S.target.selectionStart,this.compositionEnd=S.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(P.copiedText=this.getSelectedText(),P.copiedTextStyle=P.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(S){return S&&S.clipboardData||P.window.clipboardData},_getWidthBeforeCursor:function(S,w){var D,T=this._getLineLeftOffset(S);return w>0&&(T+=(D=this.__charBounds[S][w-1]).left+D.width),T},getDownCursorOffset:function(S,w){var D=this._getSelectionForOffset(S,w),T=this.get2DCursorLocation(D),_=T.lineIndex;if(_===this._textLines.length-1||S.metaKey||34===S.keyCode)return this._text.length-D;var C=T.charIndex,I=this._getWidthBeforeCursor(_,C),O=this._getIndexOnLine(_+1,I);return this._textLines[_].slice(C).length+O+1+this.missingNewlineOffset(_)},_getSelectionForOffset:function(S,w){return S.shiftKey&&this.selectionStart!==this.selectionEnd&&w?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(S,w){var D=this._getSelectionForOffset(S,w),T=this.get2DCursorLocation(D),_=T.lineIndex;if(0===_||S.metaKey||33===S.keyCode)return-D;var C=T.charIndex,I=this._getWidthBeforeCursor(_,C),O=this._getIndexOnLine(_-1,I),x=this._textLines[_].slice(0,C),M=this.missingNewlineOffset(_-1);return-this._textLines[_-1].length+O-x.length+(1-M)},_getIndexOnLine:function(S,w){for(var D,T,_=this._textLines[S],C=this._getLineLeftOffset(S),I=0,O=0,x=_.length;O<x;O++)if((C+=D=this.__charBounds[S][O].width)>w){T=!0;var F=C,B=Math.abs(C-D-w);I=Math.abs(F-w)<B?O:O-1;break}return T||(I=_.length-1),I},moveCursorDown:function(S){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",S)},moveCursorUp:function(S){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",S)},_moveCursorUpOrDown:function(S,w){var D=this["get"+S+"CursorOffset"](w,"right"===this._selectionDirection);w.shiftKey?this.moveCursorWithShift(D):this.moveCursorWithoutShift(D),0!==D&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(S){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+S:this.selectionEnd+S),0!==S},moveCursorWithoutShift:function(S){return S<0?(this.selectionStart+=S,this.selectionEnd=this.selectionStart):(this.selectionEnd+=S,this.selectionStart=this.selectionEnd),0!==S},moveCursorLeft:function(S){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",S)},_move:function(S,w,D){var T;if(S.altKey)T=this["findWordBoundary"+D](this[w]);else{if(!S.metaKey&&35!==S.keyCode&&36!==S.keyCode)return this[w]+="Left"===D?-1:1,!0;T=this["findLineBoundary"+D](this[w])}if(void 0!==typeof T&&this[w]!==T)return this[w]=T,!0},_moveLeft:function(S,w){return this._move(S,w,"Left")},_moveRight:function(S,w){return this._move(S,w,"Right")},moveCursorLeftWithoutShift:function(S){var w=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(w=this._moveLeft(S,"selectionStart")),this.selectionEnd=this.selectionStart,w},moveCursorLeftWithShift:function(S){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(S,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(S,"selectionStart")):void 0},moveCursorRight:function(S){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",S)},_moveCursorLeftOrRight:function(S,w){var D="moveCursor"+S+"With";this._currentCursorOpacity=1,this[D+=w.shiftKey?"Shift":"outShift"](w)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(S){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(S,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(S,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(S){var w=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(w=this._moveRight(S,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,w},removeChars:function(S,w){void 0===w&&(w=S+1),this.removeStyleFromTo(S,w),this._text.splice(S,w-S),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(S,w,D,T){void 0===T&&(T=D),T>D&&this.removeStyleFromTo(D,T);var _=P.util.string.graphemeSplit(S);this.insertNewStyleBlock(_,D,w),this._text=[].concat(this._text.slice(0,D),_,this._text.slice(T)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var S=P.util.toFixed,w=/  +/g;P.util.object.extend(P.Text.prototype,{_toSVG:function(){var D=this._getSVGLeftTopOffsets(),T=this._getSVGTextAndBg(D.textTop,D.textLeft);return this._wrapSVGTextAndBg(T)},toSVG:function(D){return this._createBaseSVGMarkup(this._toSVG(),{reviver:D,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(D){var T=this.getSvgTextDecoration(this);return[D.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",T?'text-decoration="'+T+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",D.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(D,T){var _,C=[],I=[],O=D;this._setSVGBg(I);for(var x=0,M=this._textLines.length;x<M;x++)_=this._getLineLeftOffset(x),(this.textBackgroundColor||this.styleHas("textBackgroundColor",x))&&this._setSVGTextLineBg(I,x,T+_,O),this._setSVGTextLineText(C,x,T+_,O),O+=this.getHeightOfLine(x);return{textSpans:C,textBgRects:I}},_createTextCharSpan:function(D,T,_,C){var I=D!==D.trim()||D.match(w),O=this.getSvgSpanStyles(T,I),x=O?'style="'+O+'"':"",M=T.deltaY,F="",B=P.Object.NUM_FRACTION_DIGITS;return M&&(F=' dy="'+S(M,B)+'" '),['<tspan x="',S(_,B),'" y="',S(C,B),'" ',F,x,">",P.util.string.escapeXml(D),"</tspan>"].join("")},_setSVGTextLineText:function(D,T,_,C){var I,O,x,M,F,B=this.getHeightOfLine(T),V=-1!==this.textAlign.indexOf("justify"),W="",G=0,Y=this._textLines[T];C+=B*(1-this._fontSizeFraction)/this.lineHeight;for(var Z=0,ie=Y.length-1;Z<=ie;Z++)F=Z===ie||this.charSpacing,W+=Y[Z],x=this.__charBounds[T][Z],0===G?(_+=x.kernedWidth-x.width,G+=x.width):G+=x.kernedWidth,V&&!F&&this._reSpaceAndTab.test(Y[Z])&&(F=!0),F||(I=I||this.getCompleteStyleDeclaration(T,Z),O=this.getCompleteStyleDeclaration(T,Z+1),F=this._hasStyleChangedForSvg(I,O)),F&&(M=this._getStyleDeclaration(T,Z)||{},D.push(this._createTextCharSpan(W,M,_,C)),W="",I=O,_+=G,G=0)},_pushTextBgRect:function(D,T,_,C,I,O){var x=P.Object.NUM_FRACTION_DIGITS;D.push("\t\t<rect ",this._getFillAttributes(T),' x="',S(_,x),'" y="',S(C,x),'" width="',S(I,x),'" height="',S(O,x),'"></rect>\n')},_setSVGTextLineBg:function(D,T,_,C){for(var I,O,x=this._textLines[T],M=this.getHeightOfLine(T)/this.lineHeight,F=0,B=0,V=this.getValueOfPropertyAt(T,0,"textBackgroundColor"),W=0,G=x.length;W<G;W++)I=this.__charBounds[T][W],(O=this.getValueOfPropertyAt(T,W,"textBackgroundColor"))!==V?(V&&this._pushTextBgRect(D,V,_+B,C,F,M),B=I.left,F=I.width,V=O):F+=I.kernedWidth;O&&this._pushTextBgRect(D,O,_+B,C,F,M)},_getFillAttributes:function(D){var T=D&&"string"==typeof D?new P.Color(D):"";return T&&T.getSource()&&1!==T.getAlpha()?'opacity="'+T.getAlpha()+'" fill="'+T.setAlpha(1).toRgb()+'"':'fill="'+D+'"'},_getSVGLineTopOffset:function(D){for(var T,_=0,C=0;C<D;C++)_+=this.getHeightOfLine(C);return T=this.getHeightOfLine(C),{lineTop:_,offset:(this._fontSizeMult-this._fontSizeFraction)*T/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(D){return P.Object.prototype.getSvgStyles.call(this,D)+" white-space: pre;"}})}(),function(S){var w=S.fabric||(S.fabric={});w.Textbox=w.util.createClass(w.IText,w.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:w.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(D){for(var T=0,_=0,C=0,I={},O=0;O<D.graphemeLines.length;O++)"\n"===D.graphemeText[C]&&O>0?(_=0,C++,T++):!this.splitByGrapheme&&this._reSpaceAndTab.test(D.graphemeText[C])&&O>0&&(_++,C++),I[O]={line:T,offset:_},C+=D.graphemeLines[O].length,_+=D.graphemeLines[O].length;return I},styleHas:function(D,T){if(this._styleMap&&!this.isWrapping){var _=this._styleMap[T];_&&(T=_.line)}return w.Text.prototype.styleHas.call(this,D,T)},isEmptyStyles:function(D){if(!this.styles)return!0;var T,_,C=0,I=!1,O=this._styleMap[D],x=this._styleMap[D+1];for(var M in O&&(D=O.line,C=O.offset),x&&(I=x.line===D,T=x.offset),_=void 0===D?this.styles:{line:this.styles[D]})for(var F in _[M])if(F>=C&&(!I||F<T))for(var B in _[M][F])return!1;return!0},_getStyleDeclaration:function(D,T){if(this._styleMap&&!this.isWrapping){var _=this._styleMap[D];if(!_)return null;D=_.line,T=_.offset+T}return this.callSuper("_getStyleDeclaration",D,T)},_setStyleDeclaration:function(D,T,_){var C=this._styleMap[D];this.styles[D=C.line][T=C.offset+T]=_},_deleteStyleDeclaration:function(D,T){var _=this._styleMap[D];delete this.styles[D=_.line][T=_.offset+T]},_getLineStyle:function(D){return!!this.styles[this._styleMap[D].line]},_setLineStyle:function(D){this.styles[this._styleMap[D].line]={}},_wrapText:function(D,T){var _,C=[];for(this.isWrapping=!0,_=0;_<D.length;_++)C=C.concat(this._wrapLine(D[_],_,T));return this.isWrapping=!1,C},_measureWord:function(D,T,_){var C,I=0;_=_||0;for(var O=0,x=D.length;O<x;O++)I+=this._getGraphemeBox(D[O],T,O+_,C,!0).kernedWidth,C=D[O];return I},_wrapLine:function(D,T,_,C){var I=0,O=this.splitByGrapheme,x=[],M=[],F=O?w.util.string.graphemeSplit(D):D.split(this._wordJoiners),B="",V=0,W=O?"":" ",G=0,Y=0,Z=0,ie=!0,se=this._getWidthOfCharSpacing();C=C||0,0===F.length&&F.push([]),_-=C;for(var de=0;de<F.length;de++)B=O?F[de]:w.util.string.graphemeSplit(F[de]),G=this._measureWord(B,T,V),V+=B.length,(I+=Y+G-se)>_&&!ie?(x.push(M),M=[],I=G,ie=!0):I+=se,ie||O||M.push(W),M=M.concat(B),Y=O?0:this._measureWord([W],T,V),V++,ie=!1,G>Z&&(Z=G);return de&&x.push(M),Z+C>this.dynamicMinWidth&&(this.dynamicMinWidth=Z-se+C),x},isEndOfWrapping:function(D){return!this._styleMap[D+1]||this._styleMap[D+1].line!==this._styleMap[D].line},missingNewlineOffset:function(D){return this.splitByGrapheme?this.isEndOfWrapping(D)?1:0:1},_splitTextIntoLines:function(D){for(var T=w.Text.prototype._splitTextIntoLines.call(this,D),_=this._wrapText(T.lines,this.width),C=new Array(_.length),I=0;I<_.length;I++)C[I]=_[I].join("");return T.lines=C,T.graphemeLines=_,T},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var D={};for(var T in this._styleMap)this._textLines[T]&&(D[this._styleMap[T].line]=1);for(var T in this.styles)D[T]||delete this.styles[T]},toObject:function(D){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(D))}}),w.Textbox.fromObject=function(D,T){return w.Object._fromObject("Textbox",D,T,"text")}}(l),function(){var S=P.controlsUtils,w=S.scaleSkewCursorStyleHandler,D=S.scaleCursorStyleHandler,T=S.scalingEqually,_=S.scalingYOrSkewingX,C=S.scalingXOrSkewingY,I=S.scaleOrSkewActionName,O=P.Object.prototype.controls;if(O.ml=new P.Control({x:-.5,y:0,cursorStyleHandler:w,actionHandler:C,getActionName:I}),O.mr=new P.Control({x:.5,y:0,cursorStyleHandler:w,actionHandler:C,getActionName:I}),O.mb=new P.Control({x:0,y:.5,cursorStyleHandler:w,actionHandler:_,getActionName:I}),O.mt=new P.Control({x:0,y:-.5,cursorStyleHandler:w,actionHandler:_,getActionName:I}),O.tl=new P.Control({x:-.5,y:-.5,cursorStyleHandler:D,actionHandler:T}),O.tr=new P.Control({x:.5,y:-.5,cursorStyleHandler:D,actionHandler:T}),O.bl=new P.Control({x:-.5,y:.5,cursorStyleHandler:D,actionHandler:T}),O.br=new P.Control({x:.5,y:.5,cursorStyleHandler:D,actionHandler:T}),O.mtr=new P.Control({x:0,y:-.5,actionHandler:S.rotationWithSnapping,cursorStyleHandler:S.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),P.Textbox){var x=P.Textbox.prototype.controls={};x.mtr=O.mtr,x.tr=O.tr,x.br=O.br,x.tl=O.tl,x.bl=O.bl,x.mt=O.mt,x.mb=O.mb,x.mr=new P.Control({x:.5,y:0,actionHandler:S.changeWidth,cursorStyleHandler:w,actionName:"resizing"}),x.ml=new P.Control({x:-.5,y:0,actionHandler:S.changeWidth,cursorStyleHandler:w,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},HI={};function _o(f){var l=HI[f];if(void 0!==l)return l.exports;var u=HI[f]={exports:{}};return Yj[f](u,u.exports,_o),u.exports}_o.d=(f,l)=>{for(var u in l)_o.o(l,u)&&!_o.o(f,u)&&Object.defineProperty(f,u,{enumerable:!0,get:l[u]})},_o.o=(f,l)=>Object.prototype.hasOwnProperty.call(f,l);var WI={};(()=>{let f;_o.d(WI,{R:()=>f}),f="undefined"!=typeof document&&"undefined"!=typeof window?_o(653).fabric:{version:"5.2.1"}})();var Pn,_i,Fs,zI,ht=WI.R;(function(f){f[f.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",f[f.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",f[f.DIMT_TEXT=4]="DIMT_TEXT",f[f.DIMT_ARC=8]="DIMT_ARC",f[f.DIMT_IMAGE=16]="DIMT_IMAGE",f[f.DIMT_POLYGON=32]="DIMT_POLYGON",f[f.DIMT_LINE=64]="DIMT_LINE",f[f.DIMT_GROUP=128]="DIMT_GROUP"})(Pn||(Pn={})),function(f){f[f.DIS_DEFAULT=1]="DIS_DEFAULT",f[f.DIS_SELECTED=2]="DIS_SELECTED"}(_i||(_i={})),function(f){f[f.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",f[f.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",f[f.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Fs||(Fs={})),function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(zI||(zI={}));const Sa=f=>"number"==typeof f&&!Number.isNaN(f),u_=f=>"string"==typeof f;var sd,yc,Ia,h_,Rr,od;(function(f){f[f.ARC=0]="ARC",f[f.IMAGE=1]="IMAGE",f[f.LINE=2]="LINE",f[f.POLYGON=3]="POLYGON",f[f.QUAD=4]="QUAD",f[f.RECT=5]="RECT",f[f.TEXT=6]="TEXT",f[f.GROUP=7]="GROUP"})(Rr||(Rr={})),function(f){f[f.DEFAULT=0]="DEFAULT",f[f.SELECTED=1]="SELECTED"}(od||(od={}));class ii{get mediaType(){return new Map([["rect",Pn.DIMT_RECTANGLE],["quad",Pn.DIMT_QUADRILATERAL],["text",Pn.DIMT_TEXT],["arc",Pn.DIMT_ARC],["image",Pn.DIMT_IMAGE],["polygon",Pn.DIMT_POLYGON],["line",Pn.DIMT_LINE],["group",Pn.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(U(this,yc,"f")){case _i.DIS_DEFAULT:return"default";case _i.DIS_SELECTED:return"selected"}}set drawingStyleId(l){this.styleId=l}get drawingStyleId(){return this.styleId}set coordinateBase(l){if(!["view","image"].includes(l))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===U(this,Ia,"f")&&"view"===l?this.updateCoordinateBaseFromImageToView():"view"===U(this,Ia,"f")&&"image"===l&&this.updateCoordinateBaseFromViewToImage()),Fe(this,Ia,l,"f")}get coordinateBase(){return U(this,Ia,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(l,u){if(sd.add(this),yc.set(this,void 0),Ia.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=u&&!Sa(u))throw new TypeError("Invalid 'drawingStyleId'.");l&&this._setFabricObject(l),this.setState(_i.DIS_DEFAULT),this.styleId=u}_setFabricObject(l){this._fabricObject=l,this._fabricObject.on("selected",()=>{this.setState(_i.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(_i.DIS_SELECTED):this.setState(_i.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),l.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(l){Fe(this,yc,l,"f")}getState(){return U(this,yc,"f")}_on(l,u){if(!u)return;const g=l.toLowerCase(),p=this.mapEvent_Callbacks.get(g);if(!p)throw new Error(`Event '${l}' does not exist.`);let m=p.get(u);m||(m=v=>{const y=v.e;if(!y)return void(u&&u.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const b={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let A,L,N,k;const j=y.target.getBoundingClientRect();A=j.left,L=j.top,N=A+window.scrollX,k=L+window.scrollY;const{width:H,height:z}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),$=this._drawingLayer.width,q=this._drawingLayer.height,X=H/z,Q=$/q,pe=this._drawingLayer._getObjectFit();let _e,Te,Re,P,Ee=1;if("contain"===pe)X<Q?(Ee=H/$,_e=A+this.get("x")*Ee,Te=L+this.get("y")*Ee+(z-q*Ee)/2,Re=N+this.get("x")*Ee,P=k+this.get("y")*Ee+(z-q*Ee)/2):(Ee=z/q,_e=A+this.get("x")*Ee+(H-$*Ee)/2,Te=L+this.get("y")*Ee,Re=N+this.get("x")*Ee+(H-$*Ee)/2,P=k+this.get("y")*Ee);else if("cover"===pe)if(X<Q){Ee=z/q;let Ve=this.get("x")*Ee-($*Ee-H)/2;Ve=Math.max(Ve,0),Ve=Math.min(Ve,H),_e=A+Ve,Te=L+this.get("y")*Ee,Re=N+Ve,P=k+this.get("y")*Ee}else{Ee=H/$;let Ve=this.get("y")*Ee-(q*Ee-z)/2;Ve=Math.max(Ve,0),Ve=Math.min(Ve,z),_e=A+this.get("x")*Ee,Te=L+Ve,Re=N+this.get("x")*Ee,P=k+Ve}b.itemClientX=Math.round(_e),b.itemClientY=Math.round(Te),b.itemPageX=Math.round(Re),b.itemPageY=Math.round(P)}for(let A of Object.getOwnPropertyNames(b))Object.defineProperty(y,A,{value:b[A],writable:!0});u&&u.apply(this,[y])},p.set(u,m),this._fabricObject.on("dblclick"===g?"mousedblclick":g,m))}on(l,u){this._on(l,u)}_off(l,u){const g=l.toLowerCase(),p=this.mapEvent_Callbacks.get(g);if(!p)throw new Error(`Event '${l}' does not exist.`);let m=p.get(u);m&&(p.delete(u),this._fabricObject.off("dblclick"===g?"mousedblclick":g,m))}off(l,u){this._off(l,u)}_setEditable(l){const u=this._fabricObject;l?(u.selectable=!0,u.hasControls=!0,u.hoverCursor=null):(u.selectable=!1,u.hasControls=!1,u.hoverCursor="default")}hasNote(l){return this.mapNoteName_Content.has(l)}addNote(l,u){if(this.hasNote(l.name)&&!u)throw new Error("A note with the same name already exists, please use a different name.");const g=l.content?JSON.parse(JSON.stringify(l.content)):l.content;this.mapNoteName_Content.set(l.name,[g])}getNote(l){const u=this.mapNoteName_Content.get(l);return u?1===u.length?{name:l,content:u[0]?JSON.parse(JSON.stringify(u[0])):u[0]}:{name:l,content:JSON.parse(JSON.stringify(u))}:null}getNotes(){const l=[];for(let u of this.mapNoteName_Content){let g=1===u[1].length?u[1][0]:u[1];g=g&&JSON.parse(JSON.stringify(g)),l.push({name:u[0],content:g})}return l}updateNote(l,u,g){const p=this.mapNoteName_Content.get(l);if(!p)throw new Error("The note name does not exist.");g||(p.length=0),u=u&&JSON.parse(JSON.stringify(u)),p.push(u)}deleteNote(l){this.mapNoteName_Content.delete(l)}clearNotes(){this.mapNoteName_Content.clear()}set(l,u){if(!this.extendSet(l,u))if("x"===l){const g=this._fabricObject.group;g?(this._fabricObject.set("left",u-g.left-g.width/2),g.addWithUpdate()):this._fabricObject.set("left",u)}else if("y"===l){const g=this._fabricObject.group;g?(this._fabricObject.set("top",u-g.top-g.height/2),g.addWithUpdate()):this._fabricObject.set("top",u)}else"styleId"===l?this.styleId=u:this._fabricObject.set(l,u);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(l)&&this._fabricObject.setCoords()}get(l){let u=this.extendGet(l);if(void 0===u)if("x"===l){const g=this._fabricObject.group;u=g?this._fabricObject.get("left")+g.left+g.width/2:this._fabricObject.get("left")}else if("y"===l){const g=this._fabricObject.group;u=g?this._fabricObject.get("top")+g.top+g.height/2:this._fabricObject.get("top")}else u="scaledWidth"===l?this._fabricObject.getScaledWidth():"scaledHeight"===l?this._fabricObject.getScaledHeight():["type","mediaType"].includes(l)?this.mediaType:"state"===l?this.getState():"styleId"===l?this.styleId:"drawingLayerId"===l?this.drawingLayerId:this._fabricObject.get(l);return u}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l*U(this,sd,"m",h_).call(this)}convertPropFromViewToImage(l){if("number"!=typeof l)throw new TypeError("Invalid value.");return l/U(this,sd,"m",h_).call(this)}_setLineWidth(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",l)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(l){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(l));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",l)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}yc=new WeakMap,Ia=new WeakMap,sd=new WeakSet,h_=function(){const f=this._drawingLayer;if(!f)return 1;const l=f.width,u=f.height,{width:g,height:p}=f.fabricCanvas.wrapperEl.getBoundingClientRect();if(g<=0||p<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const m=g/l,v=p/u,y=f._getObjectFit();let b=1;return"contain"===y?b=m<v?g/l:p/u:"cover"===y&&(b=m<v?p/u:g/l),b},ii.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],ii.mapItemType=new Map([[Rr.ARC,"arc"],[Rr.IMAGE,"image"],[Rr.LINE,"line"],[Rr.POLYGON,"polygon"],[Rr.QUAD,"quad"],[Rr.RECT,"rect"],[Rr.TEXT,"text"],[Rr.GROUP,"group"]]),ii.arrStyleSelectors=["default","selected"],ii.mapItemState=new Map([[od.DEFAULT,"default"],[od.SELECTED,"selected"]]);const YI=f=>null!==f&&"object"==typeof f&&!Array.isArray(f),d_=f=>!!u_(f)&&""!==f,g_=f=>!(!or(f)||!an(f.left)||f.left<0||!an(f.top)||f.top<0||!an(f.right)||f.right<0||!an(f.bottom)||f.bottom<0||f.left>=f.right||f.top>=f.bottom||!Zm(f.isMeasuredInPercentage)),XI=f=>!!or(f)&&!!qm(f.points)&&0!=f.points.length&&!f.points.some(l=>!Ea(l)),$j=Ea,qI=f=>!!or(f)&&!!qm(f.points)&&0!=f.points.length&&4==f.points.length&&!f.points.some(l=>!Ea(l)),Jr=f=>!(!or(f)||!an(f.x)||!an(f.y)||!an(f.width)||f.width<0||!an(f.height)||f.height<0||"isMeasuredInPercentage"in f&&!Zm(f.isMeasuredInPercentage)),ZI=f=>!(!YI(f)||"id"in f&&!Sa(f.id)||"lineWidth"in f&&!Sa(f.lineWidth)||"fillStyle"in f&&!d_(f.fillStyle)||"strokeStyle"in f&&!d_(f.strokeStyle)||"paintMode"in f&&!["fill","stroke","strokeAndFill"].includes(f.paintMode)||"fontFamily"in f&&!d_(f.fontFamily)||"fontSize"in f&&!Sa(f.fontSize));class ad{static convert(l,u,g){const p={x:0,y:0,width:u,height:g};if(!l)return p;if(Jr(l))l.isMeasuredInPercentage?(p.x=l.x/100*u,p.y=l.y/100*g,p.width=l.width/100*u,p.height=l.height/100*g):(p.x=l.x,p.y=l.y,p.width=l.width,p.height=l.height);else{if(!g_(l))throw TypeError("Invalid region.");l.isMeasuredInPercentage?(p.x=l.left/100*u,p.y=l.top/100*g,p.width=(l.right-l.left)/100*u,p.height=(l.bottom-l.top)/100*g):(p.x=l.left,p.y=l.top,p.width=l.right-l.left,p.height=l.bottom-l.top)}return p.x=Math.round(p.x),p.y=Math.round(p.y),p.width=Math.round(p.width),p.height=Math.round(p.height),p}}var vo,ld;class KI{constructor(){vo.set(this,new Map),ld.set(this,!1)}get disposed(){return U(this,ld,"f")}on(l,u){l=l.toLowerCase();const g=U(this,vo,"f").get(l);if(g){if(g.includes(u))return;g.push(u)}else U(this,vo,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const g=U(this,vo,"f").get(l);if(!g)return;const p=g.indexOf(u);-1!==p&&g.splice(p,1)}offAll(l){l=l.toLowerCase();const u=U(this,vo,"f").get(l);u&&(u.length=0)}fire(l,u=[],g={async:!1,copy:!0}){u||(u=[]),l=l.toLowerCase();const p=U(this,vo,"f").get(l);if(p&&p.length){g=Object.assign({async:!1,copy:!0},g);for(let m of p){if(!m)continue;let v=[];if(g.copy)for(let b of u){try{b=JSON.parse(JSON.stringify(b))}catch(A){}v.push(b)}else v=u;let y=!1;if(g.async)setTimeout(()=>{this.disposed||p.includes(m)&&m.apply(g.target,v)},0);else try{y=m.apply(g.target,v)}catch(b){}if(!0===y)break}}}dispose(){Fe(this,ld,!0,"f")}}function Xj(f,l,u){return(u.x-f.x)*(l.y-f.y)==(l.x-f.x)*(u.y-f.y)&&Math.min(f.x,l.x)<=u.x&&u.x<=Math.max(f.x,l.x)&&Math.min(f.y,l.y)<=u.y&&u.y<=Math.max(f.y,l.y)}function p_(f){return Math.abs(f)<1e-6?0:f<0?-1:1}function cd(f,l,u,g){let p=f[0]*(u[1]-l[1])+l[0]*(f[1]-u[1])+u[0]*(l[1]-f[1]),m=f[0]*(g[1]-l[1])+l[0]*(f[1]-g[1])+g[0]*(l[1]-f[1]);return!((p^m)>=0&&0!==p&&0!==m||(p=u[0]*(f[1]-g[1])+g[0]*(u[1]-f[1])+f[0]*(g[1]-u[1]),m=u[0]*(l[1]-g[1])+g[0]*(u[1]-l[1])+l[0]*(g[1]-u[1]),(p^m)>=0&&0!==p&&0!==m))}vo=new WeakMap,ld=new WeakMap;const m_=function(){var f=re(function*(l){if("string"!=typeof l)throw new TypeError("Invalid url.");const u=yield fetch(l);if(!u.ok)throw Error("Network Error: "+u.statusText);const g=yield u.text();if(!g.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const p=document.createElement("div");p.insertAdjacentHTML("beforeend",g);for(let m=0;m<p.childElementCount;++m){let v=p.children[m];v instanceof HTMLStyleElement&&document.head.append(v)}return 1==p.childElementCount?p.children[0]:p});return function(u){return f.apply(this,arguments)}}();var Ps,Ns,Bs;class Ta extends ii{constructor(l,u){if(super(null,u),Ps.set(this,void 0),!Jr(l))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ht.Rect({left:l.x,top:l.y,width:l.width,height:l.height})),Fe(this,Ps,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="rect"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(l){this.setRect(l)}getPosition(){return this.getRect()}updatePosition(){U(this,Ps,"f")&&this.setRect(U(this,Ps,"f"))}setRect(l){if(!Jr(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width)),this.set("height",this.convertPropFromViewToImage(l.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width),this.set("height",l.height)}this._drawingLayer.renderAll()}else Fe(this,Ps,JSON.parse(JSON.stringify(l)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Ps,"f")?JSON.parse(JSON.stringify(U(this,Ps,"f"))):null}}function __(f,l,u){return ht.util.transformPoint({x:u.points[this.pointIndex].x-u.pathOffset.x,y:u.points[this.pointIndex].y-u.pathOffset.y},u.calcTransformMatrix())}function QI(f){let l=new ht.Point(f.strokeUniform?1/f.scaleX:1,f.strokeUniform?1/f.scaleY:1).multiply(f.strokeWidth);return new ht.Point(f.width+l.x,f.height+l.y)}function v_(f,l,u,g){let p=l.target,m=p.controls[p.__corner],v=p.toLocalPoint(new ht.Point(u,g),"center","center"),y=QI(p),b=p._getTransformedDimensions(0,0);return p.points[m.pointIndex]={x:v.x*y.x/b.x+p.pathOffset.x,y:v.y*y.y/b.y+p.pathOffset.y},ht.controlsUtils.fireEvent("scaling",{e:f,transform:l,pointer:{x:u,y:g}}),!0}function y_(f,l){return function(u,g,p,m){let v=g.target,y=ht.util.transformPoint({x:v.points[f].x-v.pathOffset.x,y:v.points[f].y-v.pathOffset.y},v.calcTransformMatrix()),b=l(u,g,p,m);v._setPositionDimensions({});let A=QI(v);return v.setPositionByOrigin(y,(v.points[f].x-v.pathOffset.x)/A.x+.5,(v.points[f].y-v.pathOffset.y)/A.y+.5),b}}Ps=new WeakMap;class C_ extends ii{constructor(l,u){if(super(null,u),Ns.set(this,void 0),!XI(l))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new ht.Polygon(l.points,{objectCaching:!1}));const g=this._fabricObject;let p=g.points.length-1;g.controls=g.points.reduce(function(m,v,y){return m["p"+y]=new ht.Control({positionHandler:__,actionHandler:y_(y>0?y-1:p,v_),actionName:"modifyPolygon",pointIndex:y}),m},{}),Fe(this,Ns,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="polygon"}extendSet(l,u){if("vertices"===l){const g=this._fabricObject;if(g.group){const m=g.group;g.points=u.map(v=>({x:v.x-m.left-m.width/2,y:v.y-m.top-m.height/2})),m.addWithUpdate()}else g.points=u;const p=g.points.length-1;return g.controls=g.points.reduce(function(m,v,y){return m["p"+y]=new ht.Control({positionHandler:__,actionHandler:y_(y>0?y-1:p,v_),actionName:"modifyPolygon",pointIndex:y}),m},{}),g._setPositionDimensions({}),!0}}extendGet(l){if("vertices"===l){const u=[],g=this._fabricObject;if(g.selectable&&!g.group)for(let p in g.oCoords)u.push({x:g.oCoords[p].x,y:g.oCoords[p].y});else for(let p of g.points){const y=ht.util.transformPoint({x:p.x-g.pathOffset.x,y:p.y-g.pathOffset.y},g.calcTransformMatrix());u.push({x:y.x,y:y.y})}return u}}updateCoordinateBaseFromImageToView(){const l=this.get("vertices").map(u=>({x:this.convertPropFromViewToImage(u.x),y:this.convertPropFromViewToImage(u.y)}));this.set("vertices",l)}updateCoordinateBaseFromViewToImage(){const l=this.get("vertices").map(u=>({x:this.convertPropFromImageToView(u.x),y:this.convertPropFromImageToView(u.y)}));this.set("vertices",l)}setPosition(l){this.setPolygon(l)}getPosition(){return this.getPolygon()}updatePosition(){U(this,Ns,"f")&&this.setPolygon(U(this,Ns,"f"))}setPolygon(l){if(!XI(l))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(g=>({x:this.convertPropFromViewToImage(g.x),y:this.convertPropFromViewToImage(g.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Fe(this,Ns,JSON.parse(JSON.stringify(l)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Ns,"f")?JSON.parse(JSON.stringify(U(this,Ns,"f"))):null}}Ns=new WeakMap;const JI=f=>{let l=f.split("\n").map(g=>g.split("\t"));return(u=>{for(let g=0;;g++){let p=-1;for(let m=0;m<u.length;m++){let v=u[m][g];void 0!==v&&v.length>p&&(p=v.length)}if(-1===p)break;for(let m=0;m<u.length;m++){if(g>=u[m].length-1)continue;let v=" ".repeat(p+2-u[m][g].length);u[m][g]=u[m][g].concat(v)}}})(l),(u=>{let g="";for(let p=0;p<u.length;p++)g=g.concat(...u[p],p===u.length-1?"":"\n");return g})(l)};class qj extends ii{constructor(l,u,g){if(super(null,g),Bs.set(this,void 0),!u_(l))throw new TypeError("Invalid 'text'.");if(!Jr(u))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ht.Textbox(JI(l),{left:u.x,top:u.y,width:u.width})),this._text=l,Fe(this,Bs,JSON.parse(JSON.stringify(u)),"f"),this._mediaType="text"}extendSet(l,u){if("text"===l)return this._text=u,this._fabricObject.set("text",JI(u)),!0}extendGet(l){if("text"===l)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(l){this.setTextRect(l)}getPosition(){return this.getTextRect()}updatePosition(){U(this,Bs,"f")&&this.setTextRect(U(this,Bs,"f"))}setText(l){if(!u_(l))throw new TypeError("Invalid 'text'.");this.set("text",l)}getText(){return this.get("text")}setTextRect(l){if(!Jr(l))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(l.x)),this.set("top",this.convertPropFromViewToImage(l.y)),this.set("width",this.convertPropFromViewToImage(l.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",l.x),this.set("top",l.y),this.set("width",l.width)}this._drawingLayer.renderAll()}else Fe(this,Bs,JSON.parse(JSON.stringify(l)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return U(this,Bs,"f")?JSON.parse(JSON.stringify(U(this,Bs,"f"))):null}}var js,Us,xa,w_,Aa,Cc,Ra,vi,wc,Ec,bc,eT,tT,nT,iT,ud,Mt,Dc,Sc,Ic,vn,hd,dd,fd,Gs,Tc,xc,E_,yi,gd,rT,b_,D_,Ac,pd;Bs=new WeakMap;class Zj extends C_{constructor(l,u){if(super({points:null==l?void 0:l.points},u),js.set(this,void 0),!qI(l))throw new TypeError("Invalid 'quad'.");Fe(this,js,JSON.parse(JSON.stringify(l)),"f"),this._mediaType="quad"}setPosition(l){this.setQuad(l)}getPosition(){return this.getQuad()}updatePosition(){U(this,js,"f")&&this.setQuad(U(this,js,"f"))}setPolygon(){}getPolygon(){return null}setQuad(l){if(!qI(l))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const u=l.points.map(g=>({x:this.convertPropFromViewToImage(g.x),y:this.convertPropFromViewToImage(g.y)}));this.set("vertices",u)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",l.points)}this._drawingLayer.renderAll()}else Fe(this,js,JSON.parse(JSON.stringify(l)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map(l=>({x:this.convertPropFromImageToView(l.x),y:this.convertPropFromImageToView(l.y)}))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return U(this,js,"f")?JSON.parse(JSON.stringify(U(this,js,"f"))):null}}js=new WeakMap;class Kj extends ii{constructor(l){super(new ht.Group(l.map(u=>u._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(_i.DIS_SELECTED);const u=this._fabricObject._objects;for(let g of u)setTimeout(()=>{g&&g.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(_i.DIS_DEFAULT);const u=this._fabricObject._objects;for(let g of u)setTimeout(()=>{g&&g.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(l,u){return!1}extendGet(l){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(l=>l.getDrawingItem())}setChildDrawingItems(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"add"):this._fabricObject.addWithUpdate(l._getFabricObject())}removeChildItem(l){l&&l.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,l,"remove"):this._fabricObject.removeWithUpdate(l._getFabricObject()))}}class we{static createDrawingStyle(l){if(!ZI(l))throw new Error("Invalid style definition.");let u,g=we.USER_START_STYLE_ID;for(;U(we,Us,"f",xa).has(g);)g++;u=g;const p=JSON.parse(JSON.stringify(l));p.id=u;for(let m in U(we,Us,"f",w_))p.hasOwnProperty(m)||(p[m]=U(we,Us,"f",w_)[m]);return U(we,Us,"f",xa).set(u,p),p.id}static _getDrawingStyle(l,u){if("number"!=typeof l)throw new Error("Invalid style id.");const g=U(we,Us,"f",xa).get(l);return g?u?JSON.parse(JSON.stringify(g)):g:null}static getDrawingStyle(l){return this._getDrawingStyle(l,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(U(we,Us,"f",xa).values())))}static _updateDrawingStyle(l,u){if(!ZI(u))throw new Error("Invalid style definition.");const g=U(we,Us,"f",xa).get(l);if(g)for(let p in u)g.hasOwnProperty(p)&&(g[p]=u[p])}static updateDrawingStyle(l,u){this._updateDrawingStyle(l,u)}}Us=we,we.STYLE_BLUE_STROKE=1,we.STYLE_GREEN_STROKE=2,we.STYLE_ORANGE_STROKE=3,we.STYLE_YELLOW_STROKE=4,we.STYLE_BLUE_STROKE_FILL=5,we.STYLE_GREEN_STROKE_FILL=6,we.STYLE_ORANGE_STROKE_FILL=7,we.STYLE_YELLOW_STROKE_FILL=8,we.STYLE_BLUE_STROKE_TRANSPARENT=9,we.STYLE_GREEN_STROKE_TRANSPARENT=10,we.STYLE_ORANGE_STROKE_TRANSPARENT=11,we.USER_START_STYLE_ID=1024,xa={value:new Map([[we.STYLE_BLUE_STROKE,{id:we.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE,{id:we.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE,{id:we.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_YELLOW_STROKE,{id:we.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[we.STYLE_BLUE_STROKE_FILL,{id:we.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE_FILL,{id:we.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE_FILL,{id:we.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_YELLOW_STROKE_FILL,{id:we.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_BLUE_STROKE_TRANSPARENT,{id:we.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_GREEN_STROKE_TRANSPARENT,{id:we.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[we.STYLE_ORANGE_STROKE_TRANSPARENT,{id:we.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},w_={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(ht.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(ht.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ht.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},ht.Object.prototype.transparentCorners=!1,ht.Object.prototype.cornerSize=20,ht.Object.prototype.touchCornerSize=100,ht.Object.prototype.cornerColor="rgb(254,142,20)",ht.Object.prototype.cornerStyle="circle",ht.Object.prototype.strokeUniform=!0,ht.Object.prototype.hasBorders=!1,ht.Canvas.prototype.containerClass="",ht.Canvas.prototype.getPointer=function(f,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var u,g=this.upperCanvasEl,p=ht.util.getPointer(f,g),m=g.getBoundingClientRect(),v=m.width||0,y=m.height||0;v&&y||("top"in m&&"bottom"in m&&(y=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(v=Math.abs(m.right-m.left))),this.calcOffset(),p.x=p.x-this._offset.left,p.y=p.y-this._offset.top,l||(p=this.restorePointerVpt(p));var b=this.getRetinaScaling();if(1!==b&&(p.x/=b,p.y/=b),0!==v&&0!==y){var A=window.getComputedStyle(g).objectFit,L=g.width,N=g.height;u={width:L/v,height:N/y};var $=L/N,q=v/y;return"contain"===A?$>q?{x:p.x*u.width,y:(p.y-(y-v/$)/2)*u.width}:{x:(p.x-(v-y*$)/2)*u.height,y:p.y*u.height}:"cover"===A?$>q?{x:(L-u.height*v)/2+p.x*u.height,y:p.y*u.height}:{x:p.x*u.width,y:(N-u.width*y)/2+p.y*u.width}:{x:p.x*u.width,y:p.y*u.height}}return{x:p.x*(u={width:1,height:1}).width,y:p.y*u.height}},ht.Canvas.prototype._onTouchStart=function(f){var l=this.findTarget(f);!this.allowTouchScrolling&&f.cancelable&&f.preventDefault&&f.preventDefault(),l&&f.cancelable&&f.preventDefault&&f.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),this._resetTransformEventData();var u=this.upperCanvasEl,g=this._getEventPrefix();ht.util.addListener(ht.document,"touchend",this._onTouchEnd,{passive:!1}),ht.util.addListener(ht.document,"touchmove",this._onMouseMove,{passive:!1}),ht.util.removeListener(u,g+"down",this._onMouseDown)},ht.Textbox.prototype._wrapLine=function(f,l,u,g){const p=f.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var v=0,y=this.splitByGrapheme||!(!p||!p.length),b=[],A=[],L=y?ht.util.string.graphemeSplit(f):f.split(this._wordJoiners),N="",k=0,j=y?"":" ",H=0,z=0,$=0,q=!0,X=this._getWidthOfCharSpacing();g=g||0,0===L.length&&L.push([]),u-=g;for(var Q=0;Q<L.length;Q++)N=y?L[Q]:ht.util.string.graphemeSplit(L[Q]),H=this._measureWord(N,l,k),k+=N.length,(v+=z+H-X)>u&&!q?(b.push(A),A=[],v=H,q=!0):v+=X,q||y||A.push(j),A=A.concat(N),z=y?0:this._measureWord([j],l,k),k++,q=!1,H>$&&($=H);return Q&&b.push(A),$+g>this.dynamicMinWidth&&(this.dynamicMinWidth=$-X+g),b});class $t{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(l){this.fabricCanvas.selection=l,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(l,u,g){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,l.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=l.getFabricCanvas();else{let v=this.fabricCanvas=new ht.Canvas(l,Object.assign(g,{allowTouchScrolling:!0,selection:!1}));v.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),v.lowerCanvasEl.className="",v.upperCanvasEl.className="",v.on("selection:created",function(y){const b=y.selected,A=[];for(let L of b){const N=L.getDrawingItem()._drawingLayer;N&&!A.includes(N)&&A.push(N)}for(let L of A){const N=[];for(let k of b){const j=k.getDrawingItem();j._drawingLayer===L&&N.push(j)}setTimeout(()=>{L.onSelectionChanged&&L.onSelectionChanged(N,[])},0)}}),v.on("before:selection:cleared",function(y){const b=this.getActiveObjects(),A=[];for(let L of b){const N=L.getDrawingItem()._drawingLayer;N&&!A.includes(N)&&A.push(N)}for(let L of A){const N=[];for(let k of b){const j=k.getDrawingItem();j._drawingLayer===L&&N.push(j)}setTimeout(()=>{const k=[];for(let j of N)L.hasDrawingItem(j)&&k.push(j);k.length>0&&L.onSelectionChanged&&L.onSelectionChanged([],k)},0)}}),v.on("selection:updated",function(y){const b=y.selected,A=y.deselected,L=[];for(let N of b){const k=N.getDrawingItem()._drawingLayer;k&&!L.includes(k)&&L.push(k)}for(let N of A){const k=N.getDrawingItem()._drawingLayer;k&&!L.includes(k)&&L.push(k)}for(let N of L){const k=[],j=[];for(let H of b){const z=H.getDrawingItem();z._drawingLayer===N&&k.push(z)}for(let H of A){const z=H.getDrawingItem();z._drawingLayer===N&&j.push(z)}setTimeout(()=>{N.onSelectionChanged&&N.onSelectionChanged(k,j)},0)}}),v.wrapperEl.style.position="absolute",l.getFabricCanvas=()=>this.fabricCanvas}let p,m;switch(this.id=u,u){case $t.DDN_LAYER_ID:p=we.getDrawingStyle(we.STYLE_BLUE_STROKE),m=we.getDrawingStyle(we.STYLE_BLUE_STROKE_FILL);break;case $t.DBR_LAYER_ID:p=we.getDrawingStyle(we.STYLE_ORANGE_STROKE),m=we.getDrawingStyle(we.STYLE_ORANGE_STROKE_FILL);break;case $t.DLR_LAYER_ID:p=we.getDrawingStyle(we.STYLE_GREEN_STROKE),m=we.getDrawingStyle(we.STYLE_GREEN_STROKE_FILL);break;default:p=we.getDrawingStyle(we.STYLE_YELLOW_STROKE),m=we.getDrawingStyle(we.STYLE_YELLOW_STROKE_FILL)}for(let v of ii.arrMediaTypes)this.mapType_StateAndStyleId.set(v,{default:p.id,selected:m.id})}getId(){return this.id}setVisible(l){if(l){for(let u of this._arrFabricObject)u.visible=!0,u.hasControls=!0;this._visible=!0}else{for(let u of this._arrFabricObject)u.visible=!1,u.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(l){return l.styleId?we.getDrawingStyle(l.styleId):we.getDrawingStyle(l._mapState_StyleId.get(l.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(l,u,g,p){const m=this.getDrawingItems(v=>v._mediaType===l);for(let v of m)v.styleSelector===u&&this._changeItemStyle(v,g,!0);p||this.fabricCanvas.renderAll()}_changeItemStyle(l,u,g){if(!l||!u)return;const p=l._getFabricObject();"number"==typeof l.styleId&&(u=we.getDrawingStyle(l.styleId)),p.strokeWidth=u.lineWidth,"fill"===u.paintMode?(p.fill=u.fillStyle,p.stroke=u.fillStyle):"stroke"===u.paintMode?(p.fill="transparent",p.stroke=u.strokeStyle):"strokeAndFill"===u.paintMode&&(p.fill=u.fillStyle,p.stroke=u.strokeStyle),p.fontFamily&&(p.fontFamily=u.fontFamily),p.fontSize&&(p.fontSize=u.fontSize),p.group||(p.dirty=!0),g||this.fabricCanvas.renderAll()}_updateGroupItem(l,u,g){if(!l||!u)return;const p=l.getChildDrawingItems();if("add"===g){if(p.includes(u))return;const m=u._getFabricObject();if(this.fabricCanvas.getObjects().includes(m)){if(!this._arrFabricObject.includes(m))throw new Error("Existed in other drawing layers.");u._zIndex=null}else{let v;if(u.styleId)v=we.getDrawingStyle(u.styleId);else{const y=this.mapType_StateAndStyleId.get(u._mediaType);v=we.getDrawingStyle(y[l.styleSelector]);const b=()=>{this._changeItemStyle(u,we.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).selected),!0)},A=()=>{this._changeItemStyle(u,we.getDrawingStyle(this.mapType_StateAndStyleId.get(u._mediaType).default),!0)};u._on("selected",b),u._on("deselected",A),u._funcChangeStyleToSelected=b,u._funcChangeStyleToDefault=A}u._drawingLayer=this,u._drawingLayerId=this.id,this._changeItemStyle(u,v,!0)}l._fabricObject.addWithUpdate(u._getFabricObject())}else{if("remove"!==g||!p.includes(u))return;u._zIndex=null,u._drawingLayer=null,u._drawingLayerId=null,u._off("selected",u._funcChangeStyleToSelected),u._off("deselected",u._funcChangeStyleToDefault),u._funcChangeStyleToSelected=null,u._funcChangeStyleToDefault=null,l._fabricObject.removeWithUpdate(u._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(l,u){if(!(l instanceof ii))throw new TypeError("Invalid 'drawingItem'.");if(l._drawingLayer){if(l._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let g=l._getFabricObject();const p=this.fabricCanvas.getObjects();let m,v;if(p.includes(g)){if(this._arrFabricObject.includes(g))return;throw new Error("Existed in other drawing layers.")}if("group"===l._mediaType){m=l.getChildDrawingItems();for(let A of m)if(A._drawingLayer&&A._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(u&&"object"==typeof u&&!Array.isArray(u))for(let A in u)g.set(A,u[A]);if(m){for(let A of m){const L=this.mapType_StateAndStyleId.get(A._mediaType);for(let N of ii.arrStyleSelectors)A._mapState_StyleId.set(N,L[N]);if(A.styleId)v=we.getDrawingStyle(A.styleId);else{v=we.getDrawingStyle(L.default);const N=()=>{this._changeItemStyle(A,we.getDrawingStyle(this.mapType_StateAndStyleId.get(A._mediaType).selected),!0)},k=()=>{this._changeItemStyle(A,we.getDrawingStyle(this.mapType_StateAndStyleId.get(A._mediaType).default),!0)};A._on("selected",N),A._on("deselected",k),A._funcChangeStyleToSelected=N,A._funcChangeStyleToDefault=k}A._drawingLayer=this,A._drawingLayerId=this.id,this._changeItemStyle(A,v,!0)}g.dirty=!0,this.fabricCanvas.renderAll()}else{const A=this.mapType_StateAndStyleId.get(l._mediaType);for(let L of ii.arrStyleSelectors)l._mapState_StyleId.set(L,A[L]);if(l.styleId)v=we.getDrawingStyle(l.styleId);else{v=we.getDrawingStyle(A.default);const L=()=>{this._changeItemStyle(l,we.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).selected))},N=()=>{this._changeItemStyle(l,we.getDrawingStyle(this.mapType_StateAndStyleId.get(l._mediaType).default))};l._on("selected",L),l._on("deselected",N),l._funcChangeStyleToSelected=L,l._funcChangeStyleToDefault=N}this._changeItemStyle(l,v)}l._zIndex=this.id,l._drawingLayer=this,l._drawingLayerId=this.id;const y=this._arrFabricObject.length;let b=p.length;if(y)b=p.indexOf(this._arrFabricObject[y-1])+1;else for(let A=0;A<p.length;A++)if(l._zIndex<p[A].getDrawingItem()._zIndex){b=A;break}this._arrDrwaingItem.push(l),this._arrFabricObject.push(g),g.visible=!!this._visible,this.fabricCanvas.insertAt(g,b,!1)}addDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)l._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");l._setEditable(!0)}this._addDrawingItem(l),l.updatePosition()}addDrawingItems(l){for(let u of l)this.addDrawingItem(u)}removeDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(l))return;if(l._zIndex=null,l._drawingLayer=null,l._drawingLayerId=null,"group"===l._mediaType){const g=l.getChildDrawingItems();for(let p of g)p._zIndex=null,p._drawingLayer=null,p._drawingLayerId=null,p._off("selected",p._funcChangeStyleToSelected),p._off("deselected",p._funcChangeStyleToDefault),p._funcChangeStyleToSelected=null,p._funcChangeStyleToDefault=null,p._mapState_StyleId.clear()}else l._off("selected",l._funcChangeStyleToSelected),l._off("deselected",l._funcChangeStyleToDefault),l._funcChangeStyleToSelected=null,l._funcChangeStyleToDefault=null,l._mapState_StyleId.clear();const u=l._getFabricObject();"selected"===l.styleSelector&&(u.group?u.group.removeWithUpdate(u):this.fabricCanvas._activeObject=null,l.setState(_i.DIS_DEFAULT)),this.fabricCanvas.remove(u),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(l),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(u),1)}removeDrawingItems(l){for(let u of l)this.removeDrawingItem(u)}setDrawingItems(l){this.clearDrawingItems(),this.addDrawingItems(l)}getDrawingItems(l){return l&&"function"==typeof l?this._arrDrwaingItem.filter(l):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const l=this.fabricCanvas.getActiveObjects(),u=[];for(let g of l)this._arrFabricObject.includes(g)&&u.push(g.getDrawingItem());return u}hasDrawingItem(l){if(!l||!l.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(l)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(l,u,g){u?u.forEach(v=>v.toLowerCase()):u=ii.arrMediaTypes,g?g.forEach(v=>v.toLowerCase()):g=ii.arrStyleSelectors;const p=we.getDrawingStyle(l);if(!p)throw new Error(`The 'drawingStyle' with id '${l}' doesn't exist.`);let m;for(let v of u)if(m=this.mapType_StateAndStyleId.get(v),m)for(let y of g){this._changeMediaTypeCurStyleInStyleSelector(v,y,p,!0),m[y]=l;for(let b of this._arrDrwaingItem)b._mediaType===v&&b._mapState_StyleId.set(y,l)}this.fabricCanvas.renderAll()}setDefaultStyle(l,u,g){const p=[];g&Pn.DIMT_RECTANGLE&&p.push("rect"),g&Pn.DIMT_QUADRILATERAL&&p.push("quad"),g&Pn.DIMT_TEXT&&p.push("text"),g&Pn.DIMT_ARC&&p.push("arc"),g&Pn.DIMT_IMAGE&&p.push("image"),g&Pn.DIMT_POLYGON&&p.push("polygon"),g&Pn.DIMT_LINE&&p.push("line");const m=[];u&_i.DIS_DEFAULT&&m.push("default"),u&_i.DIS_SELECTED&&m.push("selected"),this._setDefaultStyle(l,p.length?p:null,m.length?m:null)}setMode(l){if("viewer"===(l=l.toLowerCase())){for(let u of this._arrDrwaingItem)u._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==l)throw new RangeError("Invalid value.");for(let u of this._arrDrwaingItem)u._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(l,u){this.fabricCanvas.setDimensions(l,u)}_setObjectFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=l,this.fabricCanvas.upperCanvasEl.style.objectFit=l}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let l of this._arrDrwaingItem){const u=this._getItemCurrentStyle(l);this._changeItemStyle(l,u,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}$t.DDN_LAYER_ID=1,$t.DBR_LAYER_ID=2,$t.DLR_LAYER_ID=3,$t.USER_DEFINED_LAYER_BASE_ID=100,$t.TIP_LAYER_ID=999;class Qj{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(l,u){if(this.getDrawingLayer(u))throw new Error("Existed drawing layer id.");const g=new $t(l,u,{enableRetinaScaling:!1});return g._manager=this,this._arrDrawingLayer.push(g),this._switchPointerEvent(),g}deleteDrawingLayer(l){const u=this.getDrawingLayer(l);if(!u)return;const g=this._arrDrawingLayer;u.dispose(),g.splice(g.indexOf(u),1),this._switchPointerEvent()}clearDrawingLayers(){for(let l of this._arrDrawingLayer)l.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(l){for(let u of this._arrDrawingLayer)if(u.getId()===l)return u;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const l=this._getFabricCanvas().getActiveObjects(),u=[];for(let g of l)u.push(g.getDrawingItem());return u}setDimensions(l,u){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(l,u)}setObjectFit(l){for(let u of this._arrDrawingLayer)u&&u._setObjectFit(l)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(l){this._arrDrawingLayer.length&&(this._getFabricCanvas().wrapperEl.style.display=l?"block":"none")}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let l of this._arrDrawingLayer)l.getMode()}}class Jj extends qj{constructor(l,u,g,p,m){super(l,{x:u,y:g,width:p,height:0},m),Aa.set(this,void 0),Cc.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var v=0,y=0,b=this._textLines.length;y<b;y++)v+=this.getHeightOfLine(y);return v+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(l){Fe(this,Aa,l,"f"),U(this,Cc,"f")&&clearTimeout(U(this,Cc,"f")),U(this,Aa,"f")>=0&&Fe(this,Cc,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},U(this,Aa,"f")),"f")}getDuration(){return U(this,Aa,"f")}}Aa=new WeakMap,Cc=new WeakMap,vi=new WeakMap,wc=new WeakMap,Ec=new WeakMap,bc=new WeakMap,Ra=new WeakSet,eT=function(f,l,u,g,p,m){const v=new Jj(f,l,u,g,m);return v.coordinateBase=p,v},tT=function(f,l){l.hasDrawingItem(f)||l.addDrawingItems([f])},nT=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},iT=function(){if(!this._tip)return;const f=U(this,vi,"f");this._tip.coordinateBase=f.coordinateBase,this._tip.setTextRect({x:f.topLeftPoint.x,y:f.topLeftPoint.y,width:f.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class S_ extends HTMLElement{constructor(){super(),ud.set(this,void 0);const l=document.createElement("template").content,u=document.createElement("div");u.setAttribute("class","wrapper"),l.appendChild(u),Fe(this,ud,u,"f");const g=document.createElement("slot");g.setAttribute("name","single-frame-input-container"),u.append(g);const p=document.createElement("slot");p.setAttribute("name","content"),u.append(p);const m=document.createElement("slot");m.setAttribute("name","drawing-layer"),u.append(m);const v=document.createElement("style");v.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',l.appendChild(v),this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}getWrapper(){return U(this,ud,"f")}setElement(l,u){if(!(u instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");this.removeElement(l),u.setAttribute("slot",l),this.appendChild(u)}getElement(l){if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${l}"]`)}removeElement(l){var u;if(!["content","single-frame-input-container","drawing-layer"].includes(l))throw new TypeError("Invalid 'slot'.");null===(u=this.querySelectorAll(`[slot="${l}"]`))||void 0===u||u.forEach(g=>g.remove())}}ud=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",S_);class Ma extends HTMLElement{constructor(){super();const l=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(l.cloneNode(!0))}showScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="")}hideScanLaser(){const l=this.shadowRoot.querySelector(".dce-scanlight");l&&(l.style.display="none")}getElement(l){return this.shadowRoot.querySelector(l)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class ln extends class eU{constructor(){Ra.add(this),vi.set(this,void 0),wc.set(this,void 0),Ec.set(this,void 0),bc.set(this,!0),this._drawingLayerManager=new Qj}createDrawingLayerBaseCvs(l,u,g="contain"){if("number"!=typeof l||l<=1)throw new Error("Invalid 'width'.");if("number"!=typeof u||u<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");const p=document.createElement("canvas");return p.width==l&&p.height==u||(p.width=l,p.height=u),p.style.objectFit=g,p}_createDrawingLayer(l,u,g,p){if(!this._layerBaseCvs){let y;try{y=this.getContentDimensions()}catch(b){if("Invalid content dimensions."!==(b.message||b))throw b}u||(u=(null==y?void 0:y.width)||1280),g||(g=(null==y?void 0:y.height)||720),p||(p=(null==y?void 0:y.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(u,g,p)}const m=this._layerBaseCvs,v=this._drawingLayerManager.createDrawingLayer(m,l);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",m.parentElement),v}createDrawingLayer(){let l;for(let u=$t.USER_DEFINED_LAYER_BASE_ID;;u++)if(!this._drawingLayerManager.getDrawingLayer(u)&&u!==$t.TIP_LAYER_ID){l=u;break}return this._createDrawingLayer(l)}deleteDrawingLayer(l){var u;this._drawingLayerManager.deleteDrawingLayer(l),this._drawingLayerManager.getAllDrawingLayers().length||(null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(l){if("number"!=typeof l)throw new TypeError("Invalid id.");if(l<$t.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${l} is not defined by users.`);this.deleteDrawingLayer(l)}_clearDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l)this.deleteDrawingLayer(u.getId())}clearUserDefinedDrawingLayers(){const l=this.getAllDrawingLayers();for(let u of l){const g=u.getId();g<$t.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(g)}}getDrawingLayer(l){return l==$t.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(l)||([$t.DDN_LAYER_ID,$t.DBR_LAYER_ID,$t.DLR_LAYER_ID].includes(l)?this._createDrawingLayer(l):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(l=>l.getId()>=0&&l.getId()!==$t.TIP_LAYER_ID)}updateDrawingLayers(l){((u,g,p)=>{if(!(u<=1||g<=1)){if(!["contain","cover"].includes(p))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:u,height:g},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(p)}})(l.width,l.height,l.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(l){if(!(YI(u=l)&&$j(u.topLeftPoint)&&Sa(u.width))||u.width<=0||!Sa(u.duration)||"coordinateBase"in u&&!["view","image"].includes(u.coordinateBase))throw new Error("Invalid tip config.");var u;Fe(this,vi,JSON.parse(JSON.stringify(l)),"f"),U(this,vi,"f").coordinateBase||(U(this,vi,"f").coordinateBase="view"),Fe(this,Ec,l.duration,"f"),U(this,Ra,"m",iT).call(this)}getTipConfig(){return U(this,vi,"f")?U(this,vi,"f"):null}setTipVisible(l){if("boolean"!=typeof l)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",l),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Fe(this,bc,l,"f")}isTipVisible(){return U(this,bc,"f")}updateTipMessage(l){if(!U(this,vi,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=we.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer($t.TIP_LAYER_ID)||this._createDrawingLayer($t.TIP_LAYER_ID)),this._tip?this._tip.set("text",l):this._tip=U(this,Ra,"m",eT).call(this,l,U(this,vi,"f").topLeftPoint.x,U(this,vi,"f").topLeftPoint.y,U(this,vi,"f").width,U(this,vi,"f").coordinateBase,this._tipStyleId),U(this,Ra,"m",tT).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",U(this,bc,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),U(this,wc,"f")&&clearTimeout(U(this,wc,"f")),U(this,Ec,"f")>=0&&Fe(this,wc,setTimeout(()=>{U(this,Ra,"m",nT).call(this)},U(this,Ec,"f")),"f")}}{static get engineResourcePath(){return Ft.engineResourcePaths.dce}static set defaultUIElementURL(l){ln._defaultUIElementURL=l}static get defaultUIElementURL(){var l;return null===(l=ln._defaultUIElementURL)||void 0===l?void 0:l.replace("@engineResourcePath/",ln.engineResourcePath)}static createInstance(l){return re(function*(){customElements.get(ln.uiComponentName)||customElements.define(ln.uiComponentName,Ma);const u=new ln;return yield u.setUIElement(l||ln.defaultUIElementURL),u})()}static _transformCoordinates(l,u,g,p,m,v,y){const A=y/m;l.x=Math.round(l.x/(v/p)+u),l.y=Math.round(l.y/A+g)}set _singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(l!==U(this,Tc,"f")){if(Fe(this,Tc,l,"f"),U(this,Mt,"m",yi).call(this))Fe(this,vn,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!U(this,vn,"f")){const u=document.createElement("video");u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.objectFit=this.getVideoFit(),u.setAttribute("autoplay","true"),u.setAttribute("playsinline","true"),u.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Fn.OS)&&u.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Fe(this,vn,u,"f");const g=document.createElement("div");g.append(u),g.style.overflow="hidden",this._videoContainer=g,this._innerComponent.setElement("content",g)}U(this,Mt,"m",yi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return U(this,Tc,"f")}get disposed(){return U(this,E_,"f")}constructor(){var l;super(),l=this,Mt.add(this),Dc.set(this,void 0),Sc.set(this,void 0),Ic.set(this,void 0),this.containerClassName="dce-video-container",vn.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,hd.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,dd.set(this,!1),fd.set(this,!1),Gs.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{U(this,Mt,"m",Ac).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&U(this,Mt,"m",D_).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{ln._onLog&&ln._onLog("window resize event triggered."),U(this,Gs,"f").width===document.documentElement.clientWidth&&U(this,Gs,"f").height===document.documentElement.clientHeight||(U(this,Gs,"f").width=document.documentElement.clientWidth,U(this,Gs,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Tc.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!U(this,Mt,"m",yi).call(this))return;let u;if(this._singleFrameInputContainer)u=this._singleFrameInputContainer.firstElementChild;else{u=document.createElement("input"),u.setAttribute("type","file"),"camera"===this._singleFrameMode?(u.setAttribute("capture",""),u.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(u.removeAttribute("capture"),u.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),u.addEventListener("change",re(function*(){const p=u.files[0];u.value="";{const m=function(){var j=re(function*(H){let z=null,$=null;if("undefined"!=typeof createImageBitmap)try{if(z=yield createImageBitmap(H),z)return z}catch(X){}var q;return z||($=yield(q=H,new Promise((X,Q)=>{let pe=URL.createObjectURL(q),_e=new Image;_e.src=pe,_e.onload=()=>{URL.revokeObjectURL(_e.src),X(_e)},_e.onerror=Te=>{Q(new Error("Can't convert blob to image : "+(Te instanceof Event?Te.type:Te)))}}))),$});return function(z){return j.apply(this,arguments)}}(),v=(j,H,z,$)=>{j.width==z&&j.height==$||(j.width=z,j.height=$);const q=j.getContext("2d");q.clearRect(0,0,j.width,j.height),q.drawImage(H,0,0)},y=yield m(p),b=y instanceof HTMLImageElement?y.naturalWidth:y.width,A=y instanceof HTMLImageElement?y.naturalHeight:y.height;let L=l._cvsSingleFrameMode;const N=null==L?void 0:L.width,k=null==L?void 0:L.height;L||(L=document.createElement("canvas"),l._cvsSingleFrameMode=L),v(L,y,b,A),l._innerComponent.setElement("content",L),N===L.width&&k===L.height||l.eventHandler.fire("content:updated",null,{async:!1})}l._onSingleFrameAcquired&&setTimeout(()=>{l._onSingleFrameAcquired(l._cvsSingleFrameMode)},0)})),u.style.position="absolute",u.style.top="-9999px",u.style.backgroundColor="transparent",u.style.color="transparent";const g=document.createElement("div");g.append(u),this._innerComponent.setElement("single-frame-input-container",g),this._singleFrameInputContainer=g}null==u||u.click()},xc.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(u,g)=>{var p,m,v,y;if(this.disposed||(this.clearAllInnerDrawingItems(),!u))return;const b=u.originalImageTag;if(!b)return;const A=u.items;if(!(null==A?void 0:A.length))return;const L=(null===(p=b.cropRegion)||void 0===p?void 0:p.left)||0,N=(null===(m=b.cropRegion)||void 0===m?void 0:m.top)||0,k=(null===(v=b.cropRegion)||void 0===v?void 0:v.right)?b.cropRegion.right-L:b.originalWidth,j=(null===(y=b.cropRegion)||void 0===y?void 0:y.bottom)?b.cropRegion.bottom-N:b.originalHeight,H=b.currentWidth,z=b.currentHeight,$=(Q,pe,_e,Te,Re,P,Ee,Ve,nt=[],S)=>{pe.forEach(D=>ln._transformCoordinates(D,_e,Te,Re,P,Ee,Ve));const w=new Zj({points:[{x:pe[0].x,y:pe[0].y},{x:pe[1].x,y:pe[1].y},{x:pe[2].x,y:pe[2].y},{x:pe[3].x,y:pe[3].y}]},S);for(let D of nt)w.addNote(D);Q.addDrawingItems([w]),U(this,xc,"f").push(w)};let q,X;for(let Q of A)switch(Q.type){case Yt.CRIT_ORIGINAL_IMAGE:break;case Yt.CRIT_BARCODE:q=this.getDrawingLayer($t.DBR_LAYER_ID),X=[{name:"format",content:Q.formatString},{name:"text",content:Q.text}],(null==g?void 0:g.isBarcodeVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,k,j,H,z,X):$(q,Q.location.points,L,N,k,j,H,z,X,we.STYLE_ORANGE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,k,j,H,z,X);break;case Yt.CRIT_TEXT_LINE:q=this.getDrawingLayer($t.DLR_LAYER_ID),X=[{name:"text",content:Q.text}],g.isLabelVerifyOpen?Q.verified?$(q,Q.location.points,L,N,k,j,H,z,X):$(q,Q.location.points,L,N,k,j,H,z,X,we.STYLE_GREEN_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,k,j,H,z,X);break;case Yt.CRIT_DETECTED_QUAD:q=this.getDrawingLayer($t.DDN_LAYER_ID),(null==g?void 0:g.isDetectVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,k,j,H,z,[]):$(q,Q.location.points,L,N,k,j,H,z,[],we.STYLE_BLUE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,k,j,H,z,[]);break;case Yt.CRIT_NORMALIZED_IMAGE:q=this.getDrawingLayer($t.DDN_LAYER_ID),(null==g?void 0:g.isNormalizeVerifyOpen)?Q.verified?$(q,Q.location.points,L,N,k,j,H,z,[]):$(q,Q.location.points,L,N,k,j,H,z,[],we.STYLE_BLUE_STROKE_TRANSPARENT):$(q,Q.location.points,L,N,k,j,H,z,[]);break;case Yt.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},E_.set(this,!1),this.eventHandler=new KI,this.eventHandler.on("content:updated",()=>{U(this,Dc,"f")&&clearTimeout(U(this,Dc,"f")),Fe(this,Dc,setTimeout(()=>{if(this.disposed)return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}this.updateDrawingLayers(u),this.updateConvertedRegion(u)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{U(this,Sc,"f")&&clearTimeout(U(this,Sc,"f")),Fe(this,Sc,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(l){l instanceof HTMLTemplateElement?(window._dce_default_template=l,this.UIElement=new Ma):this.UIElement=l,this._unbindUI(),this._bindUI()}setUIElement(l){var u=this;return re(function*(){let g;if(g="string"==typeof l?yield m_(l):l,g instanceof HTMLDivElement&&0==g.childElementCount){const p=yield m_(ln.defaultUIElementURL);p instanceof HTMLTemplateElement?(window._dce_default_template=p,g.append(new Ma)):g.append(p),u._setUIElement(g)}else u._setUIElement(g)})()}getUIElement(){return this.UIElement}_bindUI(){var l;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let u,g=this.UIElement;if(g instanceof Ma?u=g.getElement(`.${this.containerClassName}`):g instanceof HTMLDivElement&&1===g.childElementCount&&g.firstElementChild instanceof Ma?(u=g.firstElementChild.getElement(`.${this.containerClassName}`),g=g.firstElementChild):u=g.classList.contains(this.containerClassName)?g:g.querySelector(`.${this.containerClassName}`),!u)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new S_,u.appendChild(this._innerComponent),!U(this,Mt,"m",yi).call(this)){const p=document.createElement("video");p.style.position="absolute",p.style.left="0",p.style.top="0",p.style.width="100%",p.style.height="100%",p.style.objectFit=this.getVideoFit(),p.setAttribute("autoplay","true"),p.setAttribute("playsinline","true"),p.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Fn.OS)&&p.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Fe(this,vn,p,"f");const m=document.createElement("div");m.append(p),m.style.overflow="hidden",this._videoContainer=m,this._innerComponent.setElement("content",m)}if(g instanceof Ma?(this._selRsl=g.getElement(".dce-sel-resolution"),this._selMinLtr=g.getElement(".dlr-sel-minletter"),this._divScanArea=g.getElement(".dce-scanarea"),this._divScanLight=g.getElement(".dce-scanlight"),this._bgLoading=g.getElement(".dce-bg-loading"),this._bgCamera=g.getElement(".dce-bg-camera"),this._selCam=g.getElement(".dce-sel-camera"),this._optGotRsl=g.getElement(".dce-opt-gotResolution"),this._btnClose=g.getElement(".dce-btn-close"),this._optGotMinLtr=g.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=g.querySelector(".dce-sel-resolution"),this._selMinLtr=g.querySelector(".dlr-sel-minletter"),this._divScanArea=g.querySelector(".dce-scanarea"),this._divScanLight=g.querySelector(".dce-scanlight"),this._bgLoading=g.querySelector(".dce-bg-loading"),this._bgCamera=g.querySelector(".dce-bg-camera"),this._selCam=g.querySelector(".dce-sel-camera"),this._optGotRsl=g.querySelector(".dce-opt-gotResolution"),this._btnClose=g.querySelector(".dce-btn-close"),this._optGotMinLtr=g.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||U(this,Mt,"m",yi).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||U(this,Mt,"m",yi).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||U(this,Mt,"m",Ac).call(this),U(this,Mt,"m",yi).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),U(this,Mt,"m",yi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(m=>{var v;ln._onLog&&ln._onLog("resize observer triggered.");for(let y of m)y.target===(null===(v=this._innerComponent)||void 0===v?void 0:v.getWrapper())&&this._videoResizeListener()}));const p=null===(l=this._innerComponent)||void 0===l?void 0:l.getWrapper();p&&this._resizeObserver.observe(p)}U(this,Gs,"f").width=document.documentElement.clientWidth,U(this,Gs,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var l,u,g,p;U(this,Mt,"m",yi).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),U(this,Mt,"m",Ac).call(this),null===(l=this._drawingLayerManager)||void 0===l||l.clearDrawingLayers(),null===(u=this._innerComponent)||void 0===u||u.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(g=this._innerComponent)||void 0===g||g.remove(),this._innerComponent=null,Fe(this,vn,null,"f"),null===(p=this._videoContainer)||void 0===p||p.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(l,u){if(!this._selCam)return;let g;this._selCam.textContent="";for(let p of u){const m=document.createElement("option");m.value=p.deviceId,m.innerText=p.label,this._selCam.append(m),p.deviceId&&l&&l.deviceId==p.deviceId&&(g=m)}this._selCam.value=g?g.value:""}_renderResolutionInfo(l){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",l.width),this._optGotRsl.setAttribute("data-height",l.height),this._optGotRsl.innerText="got "+l.width+"x"+l.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return U(this,vn,"f")}isVideoLoaded(){return!!U(this,vn,"f")&&4==U(this,vn,"f").readyState}setVideoFit(l){if(l=l.toLowerCase(),!["contain","cover"].includes(l))throw new Error(`Unsupported value '${l}'.`);if(this.videoFit=l,!U(this,vn,"f")||(U(this,vn,"f").style.objectFit=l,U(this,Mt,"m",yi).call(this)))return;let u;this._updateVideoContainer();try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}U(this,Mt,"m",pd).call(this,u,this.getConvertedRegion()),this.updateDrawingLayers(u)}getVideoFit(){return this.videoFit}getContentDimensions(){var l,u,g,p;let m,v,y;if(U(this,Mt,"m",yi).call(this)?(m=null===(g=this._cvsSingleFrameMode)||void 0===g?void 0:g.width,v=null===(p=this._cvsSingleFrameMode)||void 0===p?void 0:p.height,y="contain"):(m=null===(l=U(this,vn,"f"))||void 0===l?void 0:l.videoWidth,v=null===(u=U(this,vn,"f"))||void 0===u?void 0:u.videoHeight,y=this.getVideoFit()),!m||!v)throw new Error("Invalid content dimensions.");return{width:m,height:v,objectFit:y}}updateConvertedRegion(l){const u=ad.convert(this.scanRegion,l.width,l.height);Fe(this,hd,u,"f"),U(this,Ic,"f")&&clearTimeout(U(this,Ic,"f")),Fe(this,Ic,setTimeout(()=>{let g;try{g=this.getContentDimensions()}catch(p){if("Invalid content dimensions."===(p.message||p))return;throw p}U(this,Mt,"m",gd).call(this,g,u),U(this,Mt,"m",pd).call(this,g,u)},0),"f")}getConvertedRegion(){return U(this,hd,"f")}setScanRegion(l){if(null!=l&&!g_(l)&&!Jr(l))throw TypeError("Invalid 'region'.");let u;this.scanRegion=l?JSON.parse(JSON.stringify(l)):null;try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}this.updateConvertedRegion(u)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(l){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const u=U(this,vn,"f").videoWidth,g=U(this,vn,"f").videoHeight,p=this.getVideoFit(),{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let y;const b={x:0,y:0,width:u,height:g,isMeasuredInPercentage:!1};if("cover"===p&&(m/v<u/g?(y=v/g,b.x=Math.floor((u-m/y)/2),b.y=0,b.width=Math.ceil(m/y),b.height=g):(y=m/u,b.x=0,b.y=Math.floor((g-v/y)/2),b.width=u,b.height=Math.ceil(v/y))),null==l?void 0:l.inPixels)return b;const A=b;return A.x=Math.ceil(A.x/g*100),A.y=Math.ceil(A.y/u*100),A.width=Math.floor(A.width/u*100),A.height=Math.floor(A.height/g*100),A.isMeasuredInPercentage=!0,b}setScanRegionMask(l,u,g,p){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||U(this,Mt,"m",b_).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=we.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=we.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const m=this._drawingLayerOfMask.width,v=this._drawingLayerOfMask.height,y=new Ta({x:0,y:0,width:m,height:v},this._maskBackRectStyleId),b=new Ta({x:-m/2,y:-v/2+u,width:l,height:p}),A=new Ta({x:-m/2+l+g,y:-v/2+u,width:m-l-g<0?0:m-l-g,height:p}),L=new Ta({x:-m/2,y:-v/2,width:m,height:u}),N=new Ta({x:-m/2,y:-v/2+u+p,width:m,height:v-u-p<0?0:v-u-p});b.set("strokeWidth",0),A.set("strokeWidth",0),L.set("strokeWidth",0),N.set("strokeWidth",0);const k=new Kj([b,A,L,N])._getFabricObject();y.set("clipPath",k);const j=new Ta({x:l,y:u,width:g,height:p},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([y,j])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(l){Fe(this,dd,l,"f"),l?U(this,Mt,"m",rT).call(this):U(this,Mt,"m",b_).call(this)}setScanRegionMaskVisible(l){this._setScanRegionMaskVisible(l),this._userSetMaskVisible=l}isScanRegionMaskVisible(){return U(this,dd,"f")}setScanRegionMaskStyle(l){if(!l)return;let u;l.fillStyle&&(this.regionMaskFillStyle=l.fillStyle),l.strokeStyle&&(this.regionMaskStrokeStyle=l.strokeStyle),l.lineWidth&&(this.regionMaskLineWidth=l.lineWidth),this._maskBackRectStyleId&&we.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&we.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{u=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}U(this,Mt,"m",gd).call(this,u,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(l){Fe(this,fd,l,"f"),l?U(this,Mt,"m",D_).call(this):U(this,Mt,"m",Ac).call(this)}setScanLaserVisible(l){this._setScanLaserVisible(l),this._userSetLaserVisible=l}isScanLaserVisible(){return U(this,fd,"f")}_updateVideoContainer(){if(!U(this,vn,"f")||U(this,Mt,"m",yi).call(this))return;let l=1;const u=U(this,vn,"f").style.transform.match(/scale\((.+)\)/);u&&(l=parseFloat(u[1]));const g=this._videoContainer;if("contain"===this.videoFit&&l>1){const p=U(this,vn,"f").videoWidth,m=U(this,vn,"f").videoHeight,{width:v,height:y}=this._innerComponent.getBoundingClientRect(),b=p/m;if(v/y<b){let A=v/b;g.style.left="0",g.style.top=(y-A)/2/y*100+"%",g.style.width="100%",g.style.height=A/y*100+"%"}else{let A=y*b;g.style.left=(v-A)/2/v*100+"%",g.style.top="0",g.style.width=A/v*100+"%",g.style.height="100%"}}else g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%"}updateLayers(){let l;this._updateVideoContainer();try{l=this.getContentDimensions()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}const u=this.getConvertedRegion();U(this,Mt,"m",pd).call(this,l,u),this.updateDrawingLayers(l),U(this,Mt,"m",gd).call(this,l,u)}clearAllInnerDrawingItems(){U(this,xc,"f").forEach(l=>l.remove()),U(this,xc,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"disposed",{value:!0})}}function K(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function _t(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}Dc=new WeakMap,Sc=new WeakMap,Ic=new WeakMap,vn=new WeakMap,hd=new WeakMap,dd=new WeakMap,fd=new WeakMap,Gs=new WeakMap,Tc=new WeakMap,xc=new WeakMap,E_=new WeakMap,Mt=new WeakSet,yi=function(){return"disabled"!==this._singleFrameMode},gd=function(f,l){!l||0===l.x&&0===l.y&&l.width===f.width&&l.height===f.height?this.clearScanRegionMask():this.setScanRegionMask(l.x,l.y,l.width,l.height)},rT=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},b_=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},D_=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},Ac=function(){this._divScanLight&&(this._divScanLight.style.display="none")},pd=function(f,l){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:u,height:g,objectFit:p}=f;l||(l={x:0,y:0,width:u,height:g});const{width:m,height:v}=this._innerComponent.getBoundingClientRect();if(m<=0||v<=0)return;const y=m/v,b=u/g;let A,L,N,k,j=1;if("contain"===p)y<b?(j=m/u,A=0,L=(v-g*j)/2):(j=v/g,A=(m-u*j)/2,L=0),A+=l.x*j,L+=l.y*j,N=l.width*j,k=l.height*j;else if("cover"===p)if(y<b){j=v/g,A=l.x*j-(u*j-m)/2,A=Math.max(A,0),A=Math.min(A,m),L=l.y*j;let H=(l.x+l.width)*j-(u*j-m)/2;H=Math.max(H,0),H=Math.min(H,m),N=H-A,k=l.height*j}else{j=m/u,A=l.x*j,L=l.y*j-(g*j-v)/2,L=Math.max(L,0),L=Math.min(L,v);let H=(l.y+l.height)*j-(g*j-v)/2;H=Math.max(H,0),H=Math.min(H,v),N=l.width*j,k=H-L}else A=0,L=0,N=0,k=0;this._divScanArea.style.left=A+"px",this._divScanArea.style.top=L+"px",this._divScanArea.style.width=N+"px",this._divScanArea.style.height=k+"px"},ln.uiComponentName="default-camera-view",ln._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const sT="undefined"==typeof self;let Rc,Mc,md,I_,Gn;function Zn(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function lr(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}"undefined"!=typeof navigator&&(Rc=navigator,Mc=Rc.userAgent,md=Rc.platform,I_=Rc.mediaDevices),function(){if(!sT){const f={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Rc.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},l={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:md,search:"Win"},Mac:{str:md},Linux:{str:md}};let u="unknownBrowser",g=0,p="unknownOS";for(let m in f){const v=f[m]||{};let A=v.verStr||Mc,L=v.verSearch||m;if(L instanceof Array||(L=[L]),-1!=(v.str||Mc).indexOf(v.search||m)){u=m;for(let N of L){let k=A.indexOf(N);if(-1!=k){g=parseFloat(A.substring(k+N.length+1));break}}break}}for(let m in l){const v=l[m]||{};if(-1!=(v.str||Mc).indexOf(v.search||m)){p=m;break}}"Linux"==p&&-1!=Mc.indexOf("Windows NT")&&(p="HarmonyOS"),Gn={browser:u,version:g,OS:p}}sT&&(Gn={browser:"ssr",version:0,OS:"ssr"})}(),"function"==typeof SuppressedError&&SuppressedError;let ts=class{static multiply(l,u){const g=[];for(let p=0;p<3;p++){const m=u.slice(3*p,3*p+3);for(let v=0;v<3;v++){const y=[l[v],l[v+3],l[v+6]].reduce((b,A,L)=>b+A*m[L],0);g.push(y)}}return g}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,g){return Ae.multiply(l,[1,0,0,0,1,0,u,g,1])}static rotate(l,u){var g=Math.cos(u),p=Math.sin(u);return Ae.multiply(l,[g,-p,0,p,g,0,0,0,1])}static scale(l,u,g){return Ae.multiply(l,[u,0,0,0,g,0,0,0,1])}};var vt,ns,is,_d,Oa,Oc,Lc,La,vd,yo,yd,T_,Ne,rt,Dt,Cd,wd,Pt,Ui,rs,Fa,Ed,Mr,ss,Ci,Pa,Na,Fc,bd,ka,Co,os,as,x_,yn,A_,wo,oT,Dd,Sd,aT,cr,R_,M_,Ba,Pc,Id,wi,Va,O_,L_,lT;!function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(vt||(vt={}));class Ke{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(lr(Ke,ns,!1,"f",is),!1):(lr(Ke,ns,!0,"f",is),!0)}get disposed(){return Zn(this,vd,"f")}constructor(){_d.set(this,vt.RGBA),Oa.set(this,null),Oc.set(this,null),Lc.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,La.set(this,null),vd.set(this,!1)}drawImage(l,u,g,p,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!g||!p)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Zn(Ke,ns,"f",is)&&Ke.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!Zn(Ke,ns,"f",is))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let y;Ke._onLog&&(y=Date.now(),Ke._onLog("drawImage(), START: "+y));let b=0,A=0,L=g,N=p,k=0,j=0,H=g,z=p;m&&(m.sx&&(b=Math.round(m.sx)),m.sy&&(A=Math.round(m.sy)),m.sWidth&&(L=Math.round(m.sWidth)),m.sHeight&&(N=Math.round(m.sHeight)),m.dx&&(k=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(H=Math.round(m.dWidth)),m.dHeight&&(z=Math.round(m.dHeight)));let $,q=vt.RGBA;if((null==v?void 0:v.pixelFormat)&&(q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&($=v.bufferContainer,$.length<4*H*z))throw new Error("Unexpected size of the 'bufferContainer'.");const X=l;if(!Zn(Ke,ns,"f",is)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){Ke._onLog&&Ke._onLog("drawImage() in context2d."),X.ctx2d||(X.ctx2d=X.getContext("2d",{willReadFrequently:!0}));const Q=X.ctx2d;if(!Q)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(X.width<k+H||X.height<j+z)&&(X.width=k+H,X.height=j+z),Q.drawImage(u,b,A,L,N,k,j,H,z),Ke._onLog&&Ke._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:Q,pixelFormat:vt.RGBA,bUseWebGL:!1}}Ke._onLog&&Ke._onLog("drawImage() in WebGL.");try{(X.width<k+H||X.height<j+z)&&(X.width=k+H,X.height=j+z,X.ctxWebGL&&X.ctxWebGL.viewport(0,0,k+H,j+z));const Q=X.ctxWebGL||X.getContext("webgl",{antialias:!1})||X.getContext("experimental-webgl",{antialias:!1});if(!Q){Ke._onLog&&Ke._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const P=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw P.name="WebGLError",P}if(!X.ctxWebGL||q!==Zn(this,_d,"f")){X.ctxWebGL=Q;const P=_=>{const C=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,C),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW);const I=_.createBuffer();return _.bindBuffer(_.ARRAY_BUFFER,I),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW),{positions:C,texCoords:I}},Ee=_=>{const C=_.createTexture();return _.bindTexture(_.TEXTURE_2D,C),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),C},Ve=(_,C)=>{const I=_.createProgram();if(C.forEach(O=>_.attachShader(I,O)),_.linkProgram(I),!_.getProgramParameter(I,_.LINK_STATUS)){const O=new Error(`An error occured linking the program: ${_.getProgramInfoLog(I)}.`);throw O.name="WebGLError",O}return _.useProgram(I),I},nt=(_,C,I)=>{const O=_.createShader(C);if(_.shaderSource(O,I),_.compileShader(O),!_.getShaderParameter(O,_.COMPILE_STATUS)){const x=new Error(`An error occured compiling the shader: ${_.getShaderInfoLog(O)}.`);throw x.name="WebGLError",x}return O},S="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let w="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(w=q.slice(0,3));const D=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${w} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,T=Ve(Q,[nt(Q,Q.VERTEX_SHADER,S),nt(Q,Q.FRAGMENT_SHADER,D)]);lr(this,Oc,{program:T,attribLocations:{vertexPosition:Q.getAttribLocation(T,"a_position"),texPosition:Q.getAttribLocation(T,"a_texCoord")},uniformLocations:{uSampler:Q.getUniformLocation(T,"u_image"),uColorFactor:Q.getUniformLocation(T,"uColorFactor"),uMatrix:Q.getUniformLocation(T,"u_matrix"),uTextureMatrix:Q.getUniformLocation(T,"u_textureMatrix")}},"f"),lr(this,Lc,P(Q),"f"),lr(this,Oa,Ee(Q),"f"),lr(this,_d,q,"f")}const pe=(P,Ee,Ve)=>{P.bindBuffer(P.ARRAY_BUFFER,Ee),P.enableVertexAttribArray(Ve),P.vertexAttribPointer(Ve,2,P.FLOAT,!1,0,0)},Te=(P,Ee,Ve,nt)=>{P.clearColor(0,0,0,1),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT),pe(P,Ve.positions,Ee.attribLocations.vertexPosition),pe(P,Ve.texCoords,Ee.attribLocations.texPosition),P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,nt),P.uniform1i(Ee.uniformLocations.uSampler,0),P.uniform1f(Ee.uniformLocations.uColorFactor,[vt.GREY,vt.GREY32].includes(q)?1:0);let S,w,D=ts.translate(ts.identity(),-1,-1);D=ts.scale(D,2,2),D=ts.scale(D,1/P.canvas.width,1/P.canvas.height),S=ts.translate(D,k,j),S=ts.scale(S,H,z),P.uniformMatrix3fv(Ee.uniformLocations.uMatrix,!1,S),w=ts.translate(ts.identity(),b/g,A/p),w=ts.scale(w,L/g,N/p),P.uniformMatrix3fv(Ee.uniformLocations.uTextureMatrix,!1,w),P.drawArrays(P.TRIANGLES,0,6)};((P,Ee,Ve)=>{const nt=P.RGBA,S=P.RGBA,w=P.UNSIGNED_BYTE;P.bindTexture(P.TEXTURE_2D,Ee),P.texImage2D(P.TEXTURE_2D,0,nt,S,w,Ve)})(Q,Zn(this,Oa,"f"),u),Te(Q,Zn(this,Oc,"f"),Zn(this,Lc,"f"),Zn(this,Oa,"f"));const Re=$||new Uint8Array(4*H*z);if(Q.readPixels(k,j,H,z,Q.RGBA,Q.UNSIGNED_BYTE,Re),255!==Re[3]){Ke._onLog&&Ke._onLog("Incorrect WebGL drawing .");const P=new Error("WebGL error: incorrect drawing.");throw P.name="WebGLError",P}return Ke._onLog&&Ke._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:Q,pixelFormat:q===vt.GREY?vt.GREY32:q,bUseWebGL:!0}}catch(Q){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return Ke._onLog&&Ke._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,g,p,m,Object.assign({},v,{bUseWebGL:!1}));throw Q.name="WebGLError",Q}}readCvsData(l,u,g){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let p,m=0,v=0,y=l.canvas.width,b=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(y=u.width),u.height&&(b=u.height)),(null==g?void 0:g.length)<4*y*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const A=l;g?(A.readPixels(m,v,y,b,A.RGBA,A.UNSIGNED_BYTE,g),p=new Uint8Array(g.buffer,0,4*y*b)):(p=new Uint8Array(4*y*b),A.readPixels(m,v,y,b,A.RGBA,A.UNSIGNED_BYTE,p))}else if(l instanceof CanvasRenderingContext2D){let A;A=l.getImageData(m,v,y,b),p=new Uint8Array(A.data.buffer),null==g||g.set(p)}return p}transformPixelFormat(l,u,g,p){let m,v;if(Ke._onLog&&(m=Date.now(),Ke._onLog("transformPixelFormat(), START: "+m)),u===g)return Ke._onLog&&Ke._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),p?new Uint8Array(l):l;const y=[vt.RGBA,vt.RBGA,vt.GRBA,vt.GBRA,vt.BRGA,vt.BGRA];if(y.includes(u))if(g===vt.GREY){v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=.21*l[b]+.71*l[b+1]+.07*l[b+2]}else if(g===vt.GREY32){v=p?new Uint8Array(l):l;for(let b=0;b<l.length;b+=4){const A=.21*l[b]+.71*l[b+1]+.07*l[b+2];v[b]=A,v[b+1]=A,v[b+2]=A}}else{if(!y.includes(g))throw new Error("Unable to transform.");if(p){v=new Uint8Array(l);const b=u.indexOf("r"),A=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),k=g.indexOf("g"),j=g.indexOf("b");for(let H=0;H<l.length;H+=4)v[H+N]=l[H+b],v[H+k]=l[H+A],v[H+j]=l[H+L]}else{v=l;const b=u.indexOf("r"),A=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),k=g.indexOf("g"),j=g.indexOf("b");for(let H=0;H<l.length;H+=4){let z=[l[H],l[H+1],l[H+2]];v[H+N]=z[b],v[H+k]=z[A],v[H+j]=z[L]}}}else if(u===vt.GREY){if(g!==vt.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let b=0;b<l.length;b++)v[4*b]=l[b],v[4*b+1]=l[b],v[4*b+2]=l[b],v[4*b+3]=255}else{if(u!==vt.GREY32)throw new Error("Unable to transform.");if(g!==vt.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=l[b]}return Ke._onLog&&Ke._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,g,p,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Zn(Ke,ns,"f",is)&&Ke.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!Zn(Ke,ns,"f",is))throw new Error("Your browser or machine may not support WebGL.");if(p.sx>u||p.sy>g||p.sx+p.sWidth>u||p.sy+p.sHeight>g)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;Ke._onLog&&(v=Date.now(),Ke._onLog("getImageData(), START: "+v));const y=Math.round(p.sx),b=Math.round(p.sy),A=Math.round(p.sWidth),L=Math.round(p.sHeight),N=Math.round(p.dWidth),k=Math.round(p.dHeight);let j=vt.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let H,z,$,q=null;if((null==m?void 0:m.bufferContainer)&&(q=m.bufferContainer),Zn(Ke,ns,"f",is)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){Ke._onLog&&Ke._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs;try{if(q)if(j===vt.GREY){if($=new Uint8Array(4*N*k),z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,z.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}}else z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:q}),$=new Uint8Array(q.buffer,0,4*N*k),$=this.transformPixelFormat($,z.pixelFormat,j);else j===vt.GREY?((!Zn(this,La,"f")||Zn(this,La,"f").length<4*N*k)&&lr(this,La,new Uint8Array(4*N*k),"f"),$=new Uint8Array(Zn(this,La,"f").buffer,0,4*N*k)):$=new Uint8Array(4*N*k),z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,z.pixelFormat,j)}catch(X){if("WebGLError"===X.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return Ke._onLog&&Ke._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},Object.assign({},m,{bUseWebGL:!1}));throw X}}else if(Ke._onLog&&Ke._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs,z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:vt.RGBA,bUseWebGL:!1}),$=this.readCvsData(z.context,{width:N,height:k},null),$=this.transformPixelFormat($,z.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}return Ke._onLog&&Ke._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:$,pixelFormat:j,width:N,height:k,bUseWebGL:z.bUseWebGL}}convertDataToCvs(l,u,g,p){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof g||g<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=g,p===vt.GREY){v=new Uint8ClampedArray(4*u*g);for(let b=0;b<v.length;b+=4)v[b]=l[b/4],v[b+1]=l[b/4],v[b+2]=l[b/4],v[b+3]=255}else v=new Uint8ClampedArray(l.buffer);const y=new ImageData(v,u,g);return m.getContext("2d").putImageData(y,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),lr(this,Oa,null,"f"),lr(this,Oc,null,"f"),lr(this,Lc,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),lr(this,vd,!0,"f")}}ns=Ke,_d=new WeakMap,Oa=new WeakMap,Oc=new WeakMap,Lc=new WeakMap,La=new WeakMap,vd=new WeakMap,is={value:void 0};class tU{constructor(){yo.set(this,new Map),yd.set(this,!1)}get disposed(){return K(this,yd,"f")}on(l,u){l=l.toLowerCase();const g=K(this,yo,"f").get(l);if(g){if(g.includes(u))return;g.push(u)}else K(this,yo,"f").set(l,[u])}off(l,u){l=l.toLowerCase();const g=K(this,yo,"f").get(l);if(!g)return;const p=g.indexOf(u);-1!==p&&g.splice(p,1)}offAll(l){l=l.toLowerCase();const u=K(this,yo,"f").get(l);u&&(u.length=0)}fire(l,u=[],g={async:!1,copy:!0}){var p=this;return re(function*(){u||(u=[]),l=l.toLowerCase();const m=K(p,yo,"f").get(l);if(m&&m.length){g=Object.assign({async:!1,copy:!0},g);for(let v of m){if(!v)continue;let y=[];if(g.copy)for(let A of u){try{A=JSON.parse(JSON.stringify(A))}catch(L){}y.push(A)}else y=u;let b=!1;if(g.async)setTimeout(()=>{p.disposed||v.apply(g.target,y)},0);else try{b=v.apply(g.target,y)}catch(A){}if(!0===b)break}}})()}dispose(){_t(this,yd,!0,"f")}}yo=new WeakMap,yd=new WeakMap;const ri=(f,l,u,g)=>{if(!u)return f;let p=l+Math.round((f-l)/u)*u;return g&&(p=Math.min(p,g)),p};class Ye{static get version(){return"2.0.7"}static isStorageAvailable(l){let u;try{u=window[l];const g="__storage_test__";return u.setItem(g,g),u.removeItem(g),!0}catch(g){return g instanceof DOMException&&(22===g.code||1014===g.code||"QuotaExceededError"===g.name||"NS_ERROR_DOM_QUOTA_REACHED"===g.name)&&u&&0!==u.length}}static findBestRearCameraInIOS(l,u){if(!l||!l.length)return null;let g=!1;if((null==u?void 0:u.getMainCamera)&&(g=!0),g){const p=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],m=l.find(v=>p.includes(v.label.toLowerCase()));return null==m?void 0:m.deviceId}{const p=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],m=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],v=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],y=l.filter(L=>{const N=L.label.toLowerCase();return p.some(k=>N.includes(k))});if(!y.length)return null;const b=y.find(L=>{const N=L.label.toLowerCase();return m.some(k=>N.includes(k))});if(b)return b.deviceId;const A=y.find(L=>{const N=L.label.toLowerCase();return v.some(k=>N.includes(k))});return A?A.deviceId:y[0].deviceId}}static findBestRearCamera(l,u){if(!l||!l.length)return null;if(["iPhone","iPad","Mac"].includes(Gn.OS))return Ye.findBestRearCameraInIOS(l,{getMainCamera:null==u?void 0:u.getMainCameraInIOS});const g=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let p of l){const m=p.label.toLowerCase();if(m&&g.some(v=>m.includes(v))&&/\b0(\b)?/.test(m))return p.deviceId}return["Android","HarmonyOS"].includes(Gn.OS)?l[l.length-1].deviceId:null}static findBestCamera(l,u,g){return l&&l.length?"environment"===u?this.findBestRearCamera(l,g):"user"===u?null:u?void 0:null:null}static playVideo(l,u,g){return re(function*(){if(!l)throw new Error("Invalid 'videoEl'.");if(!u)throw new Error("Invalid 'source'.");return new Promise(function(){var p=re(function*(m,v){let y;const b=()=>{l.removeEventListener("loadstart",k),l.removeEventListener("abort",j),l.removeEventListener("play",H),l.removeEventListener("error",z),l.removeEventListener("loadedmetadata",X)};let A=!1;const L=()=>{A=!0,y&&clearTimeout(y),b(),m(l)},N=Q=>{y&&clearTimeout(y),b(),v(Q)},k=()=>{l.addEventListener("abort",j,{once:!0})},j=()=>{const Q=new Error("Video playing was interrupted.");Q.name="AbortError",N(Q)},H=()=>{L()},z=()=>{N(new Error(`Video error ${l.error.code}: ${l.error.message}.`))};let $;const q=new Promise(Q=>{$=Q}),X=()=>{$()};if(l.addEventListener("loadstart",k,{once:!0}),l.addEventListener("play",H,{once:!0}),l.addEventListener("error",z,{once:!0}),l.addEventListener("loadedmetadata",X,{once:!0}),"string"==typeof u||u instanceof String?l.src=u:l.srcObject=u,l.autoplay&&(yield new Promise(Q=>{setTimeout(Q,1e3)})),!A){g&&(y=setTimeout(()=>{b(),v(new Error("Failed to play video. Timeout."))},g));try{l.src&&(yield l.load()),yield l.play(),L()}catch(Q){console.warn("1st play error: "+((null==Q?void 0:Q.message)||Q))}if(!A){yield q;try{yield l.play(),L()}catch(Q){console.warn("2rd play error: "+((null==Q?void 0:Q.message)||Q)),N(Q)}}}});return function(m,v){return p.apply(this,arguments)}}())})()}static testCameraAccess(l){return re(function*(){var u,g;if(!(null===(g=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===g?void 0:g.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let p;try{p=l?yield navigator.mediaDevices.getUserMedia(l):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(m){return{ok:!1,errorName:m.name,errorMessage:m.message}}finally{null==p||p.getTracks().forEach(m=>{m.stop()})}return{ok:!0}})()}get state(){if(!K(this,Ci,"f"))return"closed";if("pending"===K(this,Ci,"f"))return"opening";if("fulfilled"===K(this,Ci,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(l){l?Ye.isStorageAvailable("localStorage")?_t(this,Fa,!0,"f"):(_t(this,Fa,!1,"f"),console.warn("Local storage is unavailable")):_t(this,Fa,!1,"f")}get ifSaveLastUsedCamera(){return K(this,Fa,"f")}get isVideoPlaying(){return!(!K(this,rt,"f")||K(this,rt,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(l){var u,g,p;if(!(l instanceof HTMLElement)&&null!=l)throw new TypeError("Invalid 'element'.");null===(u=K(this,Co,"f"))||void 0===u||u.removeEventListener("click",K(this,ka,"f")),null===(g=K(this,Co,"f"))||void 0===g||g.removeEventListener("touchend",K(this,ka,"f")),null===(p=K(this,Co,"f"))||void 0===p||p.removeEventListener("touchmove",K(this,bd,"f")),_t(this,Co,l,"f"),l&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)?(l.addEventListener("touchend",K(this,ka,"f")),l.addEventListener("touchmove",K(this,bd,"f"))):l.addEventListener("click",K(this,ka,"f")))}get tapFocusEventBoundEl(){return K(this,Co,"f")}get disposed(){return K(this,Sd,"f")}constructor(l){var g,p,u=this;Ne.add(this),rt.set(this,null),Dt.set(this,void 0),Cd.set(this,()=>{"opened"===this.state&&K(this,yn,"f").fire("resumed",null,{target:this,async:!1})}),wd.set(this,()=>{K(this,yn,"f").fire("paused",null,{target:this,async:!1})}),Pt.set(this,void 0),Ui.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],rs.set(this,void 0),Fa.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Ed.set(this,void 0),Mr.set(this,!0),ss.set(this,void 0),Ci.set(this,void 0),Pa.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Na.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(m,v)=>{let y,b;const A=window.getComputedStyle(K(this,rt,"f")).objectFit,L=this.getResolution(),N=K(this,rt,"f").getBoundingClientRect(),k=N.left,j=N.top,{width:H,height:z}=K(this,rt,"f").getBoundingClientRect();if(H<=0||z<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const $=H/z,q=L.width/L.height;let X=1;if("contain"===A)q>$?(X=H/L.width,y=(m-k)/X,b=(v-j-(z-H/q)/2)/X):(X=z/L.height,b=(v-j)/X,y=(m-k-(H-z*q)/2)/X);else{if("cover"!==A)throw new Error("Unsupported object-fit.");q>$?(X=z/L.height,b=(v-j)/X,y=(m-k+(z*q-H)/2)/X):(X=H/L.width,y=(m-k)/X,b=(v-j+(H/q-z)/2)/X)}return{x:y,y:b}},Fc.set(this,!1),bd.set(this,()=>{_t(this,Fc,!0,"f")}),ka.set(this,function(){var m=re(function*(v){var y;if(K(u,Fc,"f"))return void _t(u,Fc,!1,"f");if(!(K(u,Na,"f")&&u.isVideoPlaying&&K(u,Dt,"f")&&u._focusSupported))return;if(!u._focusParameters.fds&&(u._focusParameters.fds=null===(y=u.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!u._focusParameters.fds))return void(u._focusSupported=!1);if(null==u._focusParameters.kTimeout&&(u._focusParameters.kTimeout=(u._focusParameters.maxTimeout-u._focusParameters.minTimeout)/(1/u._focusParameters.fds.min-1/u._focusParameters.fds.max)),1==u._focusParameters.isDoingFocus)return;let b,A;if(u._focusParameters.taskBackToContinous&&(clearTimeout(u._focusParameters.taskBackToContinous),u._focusParameters.taskBackToContinous=null),v instanceof MouseEvent)b=v.clientX,A=v.clientY;else{if(!(v instanceof TouchEvent))throw new Error("Unknown event type.");if(!v.changedTouches.length)return;b=v.changedTouches[0].clientX,A=v.changedTouches[0].clientY}const L=u.getResolution(),N=2*Math.round(Math.min(L.width,L.height)/u._focusParameters.defaultFocusAreaSizeRatio/2);let k;try{k=u.calculateCoordInVideo(b,A)}catch(q){}if(k.x<0||k.x>L.width||k.y<0||k.y>L.height)return;const j={x:k.x+"px",y:k.y+"px"},H=N+"px",z=H;let $;Ye._onLog&&($=Date.now());try{yield K(u,Ne,"m",O_).call(u,j,H,z,u._focusParameters.tapFocusMinDistance,u._focusParameters.tapFocusMaxDistance)}catch(q){if(Ye._onLog)throw Ye._onLog(q),q}Ye._onLog&&Ye._onLog(`Tap focus costs: ${Date.now()-$} ms`),u._focusParameters.taskBackToContinous=setTimeout(()=>{var q;Ye._onLog&&Ye._onLog("Back to continuous focus."),null===(q=K(u,Dt,"f"))||void 0===q||q.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},u._focusParameters.focusBackToContinousTime),K(u,yn,"f").fire("tapfocus",null,{target:u,async:!1})});return function(v){return m.apply(this,arguments)}}()),Co.set(this,null),os.set(this,1),as.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!K(this,rt,"f"))return;const m=K(this,os,"f");if(m<1)throw new RangeError("Invalid scale value.");if(1===m)K(this,rt,"f").style.transform="";else{const v=window.getComputedStyle(K(this,rt,"f")).objectFit,y=K(this,rt,"f").videoWidth,b=K(this,rt,"f").videoHeight,{width:A,height:L}=K(this,rt,"f").getBoundingClientRect();if(A<=0||L<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const N=A/L,k=y/b;let j=1;"contain"===v?j=N<k?A/(y/m):L/(b/m):"cover"===v&&(j=k>N?L/(y/m):A/(b/m));const H=j*(1-1/m)*(y/2-K(this,as,"f").x),z=j*(1-1/m)*(b/2-K(this,as,"f").y);K(this,rt,"f").style.transform=`translate(${H}px, ${z}px) scale(${m})`}},x_.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const m=document.createElement("canvas");let v;if(m.width=this.width,m.height=this.height,this.pixelFormat===vt.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let b=0;b<v.length;b+=4)v[b]=this.data[b/4],v[b+1]=this.data[b/4],v[b+2]=this.data[b/4],v[b+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const y=new ImageData(v,this.width,this.height);return m.getContext("2d").putImageData(y,0,0),m}),yn.set(this,void 0),A_.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],wo.set(this,new Map),oT.set(this,!1),Dd.set(this,re(function*(){var m,v;if("visible"===document.visibilityState){if(Ye._onLog&&Ye._onLog("document visible. video paused: "+(null===(m=K(u,rt,"f"))||void 0===m?void 0:m.paused)),"opening"==u.state||"opened"==u.state){let y=!1;if(!u.isVideoPlaying){Ye._onLog&&Ye._onLog("document visible. Not auto resume. 1st resume start.");try{yield u.resume(),y=!0}catch(b){Ye._onLog&&Ye._onLog("document visible. 1st resume video failed, try open instead.")}y||(yield K(u,Ne,"m",Ba).call(u))}if(yield new Promise(b=>setTimeout(b,300)),!u.isVideoPlaying){Ye._onLog&&Ye._onLog("document visible. 1st open failed. 2rd resume start."),y=!1;try{yield u.resume(),y=!0}catch(b){Ye._onLog&&Ye._onLog("document visible. 2rd resume video failed, try open instead.")}y||(yield K(u,Ne,"m",Ba).call(u))}}}else"hidden"===document.visibilityState&&(Ye._onLog&&Ye._onLog("document hidden. video paused: "+(null===(v=K(u,rt,"f"))||void 0===v?void 0:v.paused)),"opening"==u.state||"opened"==u.state&&u.isVideoPlaying&&u.pause())})),Sd.set(this,!1),(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia)||setTimeout(()=>{Ye.onWarning&&Ye.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),l instanceof HTMLVideoElement&&this.setVideoEl(l),_t(this,yn,new tU,"f"),this.imageDataGetter=new Ke,document.addEventListener("visibilitychange",K(this,Dd,"f"))}setVideoEl(l){if(!(l&&l instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");l.addEventListener("play",K(this,Cd,"f")),l.addEventListener("pause",K(this,wd,"f")),_t(this,rt,l,"f")}getVideoEl(){return K(this,rt,"f")}releaseVideoEl(){var l,u;null===(l=K(this,rt,"f"))||void 0===l||l.removeEventListener("play",K(this,Cd,"f")),null===(u=K(this,rt,"f"))||void 0===u||u.removeEventListener("pause",K(this,wd,"f")),_t(this,rt,null,"f")}isVideoLoaded(){return!!K(this,rt,"f")&&4==K(this,rt,"f").readyState}open(){var l=this;return re(function*(){if(K(l,ss,"f")&&!K(l,Mr,"f")){if("pending"===K(l,Ci,"f"))return K(l,ss,"f");if("fulfilled"===K(l,Ci,"f"))return}K(l,yn,"f").fire("before:open",null,{target:l}),yield K(l,Ne,"m",Ba).call(l),K(l,yn,"f").fire("played",null,{target:l,async:!1}),K(l,yn,"f").fire("opened",null,{target:l,async:!1})})()}close(){var l=this;return re(function*(){if("closed"===l.state)return;K(l,yn,"f").fire("before:close",null,{target:l});const u=K(l,ss,"f");if(K(l,Ne,"m",Id).call(l),u&&"pending"===K(l,Ci,"f")){try{yield u}catch(g){}if(!1===K(l,Mr,"f")){const g=new Error("'close()' was interrupted.");throw g.name="AbortError",g}}_t(l,ss,null,"f"),_t(l,Ci,null,"f"),K(l,yn,"f").fire("closed",null,{target:l,async:!1})})()}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");K(this,rt,"f").pause()}resume(){var l=this;return re(function*(){if(!l.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==l.state)throw new Error("Camera or video is not open.");yield K(l,rt,"f").play()})()}setCamera(l){var u=this;return re(function*(){if("string"!=typeof l)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof K(u,Pt,"f").video&&(K(u,Pt,"f").video={}),delete K(u,Pt,"f").video.facingMode,K(u,Pt,"f").video.deviceId={exact:l},!("closed"===u.state||u.videoSrc||"opening"===u.state&&K(u,Mr,"f"))){K(u,yn,"f").fire("before:camera:change",[],{target:u,async:!1}),yield K(u,Ne,"m",Pc).call(u);try{u.resetSoftwareScale()}catch(g){}return K(u,Ui,"f")}})()}switchToFrontCamera(l){var u=this;return re(function*(){if("object"!=typeof K(u,Pt,"f").video&&(K(u,Pt,"f").video={}),(null==l?void 0:l.resolution)&&(K(u,Pt,"f").video.width={ideal:l.resolution.width},K(u,Pt,"f").video.height={ideal:l.resolution.height}),delete K(u,Pt,"f").video.deviceId,K(u,Pt,"f").video.facingMode={exact:"user"},_t(u,rs,null,"f"),!("closed"===u.state||u.videoSrc||"opening"===u.state&&K(u,Mr,"f"))){K(u,yn,"f").fire("before:camera:change",[],{target:u,async:!1}),K(u,Ne,"m",Pc).call(u);try{u.resetSoftwareScale()}catch(g){}return K(u,Ui,"f")}})()}getCamera(){var l;if(K(this,Ui,"f"))return K(this,Ui,"f");{let u=(null===(l=K(this,Pt,"f").video)||void 0===l?void 0:l.deviceId)||"";if(u){u=u.exact||u.ideal||u;for(let g of this._arrCameras)if(g.deviceId===u)return JSON.parse(JSON.stringify(g))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(l){var u=this;return re(function*(){var g,p;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;if(l){let b=yield navigator.mediaDevices.getUserMedia({video:!0});m=(yield navigator.mediaDevices.enumerateDevices()).filter(A=>"videoinput"===A.kind),b.getTracks().forEach(A=>{A.stop()})}else m=(yield navigator.mediaDevices.enumerateDevices()).filter(b=>"videoinput"===b.kind);const v=[],y=[];if(u._arrCameras)for(let b of u._arrCameras)b._checked&&y.push(b);for(let b=0;b<m.length;b++){let A,L=m[b];for(let N of y)if(L.deviceId==N.deviceId){A=N;break}A||(A={deviceId:L.deviceId,label:L.label?L.label:"camera "+b,_checked:!1}),A.deviceId&&v.push(A)}return u._arrCameras=v,Ye._onLog&&Ye._onLog(JSON.stringify(u._arrCameras)),v})()}getCameras(){var l=this;return re(function*(){var u,g;if(!(null===(g=null===(u=null==window?void 0:window.navigator)||void 0===u?void 0:u.mediaDevices)||void 0===g?void 0:g.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const p=(yield navigator.mediaDevices.enumerateDevices()).filter(m=>"videoinput"===m.kind);return l._getCameras(!(!p||!p.length||p[0].deviceId))})()}getAllCameras(){var l=this;return re(function*(){return l.getCameras()})()}setResolution(l,u,g){var p=this;return re(function*(){if("number"!=typeof l||l<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof u||u<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof K(p,Pt,"f").video&&(K(p,Pt,"f").video={}),g?(K(p,Pt,"f").video.width={exact:l},K(p,Pt,"f").video.height={exact:u}):(K(p,Pt,"f").video.width={ideal:l},K(p,Pt,"f").video.height={ideal:u}),"closed"===p.state||p.videoSrc||"opening"===p.state&&K(p,Mr,"f"))return null;K(p,yn,"f").fire("before:resolution:change",[],{target:p,async:!1}),yield K(p,Ne,"m",Pc).call(p);try{p.resetSoftwareScale()}catch(v){}const m=p.getResolution();return{width:m.width,height:m.height}})()}getResolution(){if("opened"===this.state&&this.videoSrc&&K(this,rt,"f"))return{width:K(this,rt,"f").videoWidth,height:K(this,rt,"f").videoHeight};if(K(this,Dt,"f")){const l=K(this,Dt,"f").getSettings();return{width:l.width,height:l.height}}if(this.isVideoLoaded())return{width:K(this,rt,"f").videoWidth,height:K(this,rt,"f").videoHeight};{const l={width:0,height:0};let u=K(this,Pt,"f").video.width||0,g=K(this,Pt,"f").video.height||0;return u&&(l.width=u.exact||u.ideal||u),g&&(l.height=g.exact||g.ideal||g),l}}getResolutions(l){var u=this;return re(function*(){var g,p,m,v,y,b,A,L,N,k,j;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let H="";const z=($,q)=>{const X=K(u,wo,"f").get($);if(!X||!X.length)return!1;for(let Q of X)if(Q.width===q.width&&Q.height===q.height)return!0;return!1};if(u._mediaStream){H=null===(j=K(u,Ui,"f"))||void 0===j?void 0:j.deviceId;let $=K(u,wo,"f").get(H);if($&&!l)return JSON.parse(JSON.stringify($));$=[],K(u,wo,"f").set(H,$),_t(u,Pa,!0,"f");try{for(let q of u.detectedResolutions){yield K(u,Dt,"f").applyConstraints({width:{ideal:q.width},height:{ideal:q.height}}),K(u,Ne,"m",cr).call(u);const X=K(u,Dt,"f").getSettings(),Q={width:X.width,height:X.height};z(H,Q)||$.push({width:Q.width,height:Q.height})}}catch(q){throw K(u,Ne,"m",Id).call(u),_t(u,Pa,!1,"f"),q}try{yield K(u,Ne,"m",Ba).call(u)}catch(q){if("AbortError"===q.name)return $;throw q}finally{_t(u,Pa,!1,"f")}return $}{const $=function(){var Q=re(function*(pe,_e,Te){const Re={video:{deviceId:{exact:pe},width:{ideal:_e},height:{ideal:Te}}};let P=null;try{P=yield navigator.mediaDevices.getUserMedia(Re)}catch(nt){return null}if(!P)return null;const Ee=P.getVideoTracks();let Ve=null;try{const nt=Ee[0].getSettings();Ve={width:nt.width,height:nt.height}}catch(nt){const S=document.createElement("video");S.srcObject=P,Ve={width:S.videoWidth,height:S.videoHeight},S.srcObject=null}return Ee.forEach(nt=>{nt.stop()}),Ve});return function(_e,Te,Re){return Q.apply(this,arguments)}}();let q=(null===(y=null===(v=null===(m=K(u,Pt,"f"))||void 0===m?void 0:m.video)||void 0===v?void 0:v.deviceId)||void 0===y?void 0:y.exact)||(null===(L=null===(A=null===(b=K(u,Pt,"f"))||void 0===b?void 0:b.video)||void 0===A?void 0:A.deviceId)||void 0===L?void 0:L.ideal)||(null===(k=null===(N=K(u,Pt,"f"))||void 0===N?void 0:N.video)||void 0===k?void 0:k.deviceId);if(!q)return[];let X=K(u,wo,"f").get(q);if(X&&!l)return JSON.parse(JSON.stringify(X));X=[],K(u,wo,"f").set(q,X);for(let Q of u.detectedResolutions){const pe=yield $(q,Q.width,Q.height);pe&&!z(q,pe)&&X.push({width:pe.width,height:pe.height})}return X}})()}setMediaStreamConstraints(l,u){var g=this;return re(function*(){if(null===(p=l)||"[object Object]"!==Object.prototype.toString.call(p))throw new TypeError("Invalid 'mediaStreamConstraints'.");var p;_t(g,Pt,JSON.parse(JSON.stringify(l)),"f"),_t(g,rs,null,"f"),u&&K(g,Ne,"m",Pc).call(g)})()}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(K(this,Pt,"f")))}resetMediaStreamConstraints(){_t(this,Pt,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!K(this,Dt,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return K(this,Dt,"f").getCapabilities?K(this,Dt,"f").getCapabilities():{}}getCameraSettings(){if(!K(this,Dt,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return K(this,Dt,"f").getSettings()}turnOnTorch(){var l=this;return re(function*(){if(!K(l,Dt,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield K(l,Dt,"f").applyConstraints({advanced:[{torch:!0}]})})()}turnOffTorch(){var l=this;return re(function*(){if(!K(l,Dt,"f")||"opened"!==l.state)throw new Error("Camera is not open.");const u=l.getCameraCapabilities();if(!(null==u?void 0:u.torch))throw Error("Not supported.");yield K(l,Dt,"f").applyConstraints({advanced:[{torch:!1}]})})()}setColorTemperature(l,u){var g=this;return re(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Dt,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.colorTemperature;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ri(l,m.min,m.step,m.max)),yield K(g,Dt,"f").applyConstraints({advanced:[{colorTemperature:l,whiteBalanceMode:"manual"}]}),l})()}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(l,u){var g=this;return re(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Dt,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.exposureCompensation;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ri(l,m.min,m.step,m.max)),yield K(g,Dt,"f").applyConstraints({advanced:[{exposureCompensation:l}]}),l})()}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(l,u){var g=this;return re(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(!K(g,Dt,"f")||"opened"!==g.state)throw new Error("Camera is not open.");let m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.frameRate;if(!m)throw Error("Not supported.");u&&(l<m.min?l=m.min:l>m.max&&(l=m.max));const v=g.getResolution();return yield K(g,Dt,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:l}),l})()}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(l,u){var g=this;return re(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if(!K(g,Dt,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const p=g.getCameraCapabilities(),m=null==p?void 0:p.focusMode,v=null==p?void 0:p.focusDistance;if(!m)throw Error("Not supported.");if("string"!=typeof l.mode)throw TypeError("Invalid 'mode'.");const y=l.mode.toLowerCase();if(!m.includes(y))throw Error("Unsupported focus mode.");if("manual"===y){if(!v)throw Error("Manual focus unsupported.");if(l.hasOwnProperty("distance")){let b=l.distance;u&&(b<v.min?b=v.min:b>v.max&&(b=v.max),b=ri(b,v.min,v.step,v.max)),g._focusParameters.focusArea=null,yield K(g,Dt,"f").applyConstraints({advanced:[{focusMode:y,focusDistance:b}]})}else{if(!l.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const b=l.area.centerPoint;let A=l.area.width,L=l.area.height;if(!A||!L){const N=g.getResolution();A||(A=2*Math.round(Math.min(N.width,N.height)/g._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),L||(L=2*Math.round(Math.min(N.width,N.height)/g._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}g._focusParameters.focusArea={centerPoint:{x:b.x,y:b.y},width:A,height:L},yield K(g,Ne,"m",O_).call(g,b,A,L)}}}else g._focusParameters.focusArea=null,yield K(g,Dt,"f").applyConstraints({advanced:[{focusMode:y}]})})()}getFocus(){const l=this.getCameraSettings(),u=l.focusMode;return u?"manual"===u?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:l.focusDistance}:{mode:u}:null}enableTapToFocus(){var l=this;return re(function*(){_t(l,Na,!0,"f")})()}disableTapToFocus(){_t(this,Na,!1,"f")}isTapToFocusEnabled(){return K(this,Na,"f")}setZoom(l){var u=this;return re(function*(){if("object"!=typeof l||Array.isArray(l)||null==l)throw new TypeError("Invalid 'settings'.");if("number"!=typeof l.factor)throw new TypeError("Illegal type of 'factor'.");if(l.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==u.state)throw new Error("Video is not playing.");l.centerPoint?K(u,Ne,"m",L_).call(u,l.centerPoint):u.resetScaleCenter();try{if(K(u,Ne,"m",lT).call(u,K(u,as,"f"))){const g=yield u.setHardwareScale(l.factor,!0);let p=u.getHardwareScale();1==p&&1!=g&&(p=g),u.setSoftwareScale(l.factor>p?l.factor/p:1)}else yield u.setHardwareScale(1),u.setSoftwareScale(l.factor)}catch(g){const p=g.message||g;if("Not supported."!==p&&"Camera is not open."!==p)throw g;u.setSoftwareScale(l.factor)}})()}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let l=1;try{l=this.getHardwareScale()}catch(u){if("Camera is not open."!==(u.message||u))throw u}return{factor:l*K(this,os,"f")}}resetZoom(){var l=this;return re(function*(){yield l.setZoom({factor:1})})()}setHardwareScale(l,u){var g=this;return re(function*(){var p;if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if(!K(g,Dt,"f")||"opened"!==g.state)throw new Error("Camera is not open.");const m=null===(p=g.getCameraCapabilities())||void 0===p?void 0:p.zoom;if(!m)throw Error("Not supported.");return u&&(l<m.min?l=m.min:l>m.max&&(l=m.max),l=ri(l,m.min,m.step,m.max)),yield K(g,Dt,"f").applyConstraints({advanced:[{zoom:l}]}),l})()}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(l,u){if("number"!=typeof l)throw new TypeError("Invalid 'value'.");if(l<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");u&&K(this,Ne,"m",L_).call(this,u),_t(this,os,l,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return K(this,os,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();_t(this,as,{x:l.width/2,y:l.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(l){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||K(this,Pa,"f"))return null;const u=Date.now();Ye._onLog&&Ye._onLog("getFrameData() START: "+u);const g=K(this,rt,"f").videoWidth,p=K(this,rt,"f").videoHeight;let m={sx:0,sy:0,sWidth:g,sHeight:p,dWidth:g,dHeight:p};(null==l?void 0:l.position)&&(m=JSON.parse(JSON.stringify(l.position)));let v=vt.RGBA;(null==l?void 0:l.pixelFormat)&&(v=l.pixelFormat);let y=K(this,os,"f");(null==l?void 0:l.scale)&&(y=l.scale);let b=K(this,as,"f");if(null==l?void 0:l.scaleCenter){if("string"!=typeof l.scaleCenter.x||"string"!=typeof l.scaleCenter.y)throw new Error("Invalid scale center.");let k=0,j=0;if(l.scaleCenter.x.endsWith("px"))k=parseFloat(l.scaleCenter.x);else{if(!l.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");k=parseFloat(l.scaleCenter.x)/100*g}if(l.scaleCenter.y.endsWith("px"))j=parseFloat(l.scaleCenter.y);else{if(!l.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");j=parseFloat(l.scaleCenter.y)/100*p}if(isNaN(k)||isNaN(j))throw new Error("Invalid scale center.");b.x=Math.round(k),b.y=Math.round(j)}let A=null;if((null==l?void 0:l.bufferContainer)&&(A=l.bufferContainer),0==g||0==p)return null;1!==y&&(m.sWidth=Math.round(m.sWidth/y),m.sHeight=Math.round(m.sHeight/y),m.sx=Math.round((1-1/y)*b.x+m.sx/y),m.sy=Math.round((1-1/y)*b.y+m.sy/y));const L=this.imageDataGetter.getImageData(K(this,rt,"f"),g,p,m,{pixelFormat:v,bufferContainer:A});if(!L)return null;const N=Date.now();return Ye._onLog&&Ye._onLog("getFrameData() END: "+N),{data:L.data,width:L.width,height:L.height,pixelFormat:L.pixelFormat,timeSpent:N-u,timeStamp:N,toCanvas:K(this,x_,"f")}}on(l,u){if(!K(this,A_,"f").includes(l.toLowerCase()))throw new Error(`Event '${l}' does not exist.`);K(this,yn,"f").on(l,u)}off(l,u){K(this,yn,"f").off(l,u)}dispose(){var l=this;return re(function*(){l.tapFocusEventBoundEl=null,yield l.close(),l.releaseVideoEl(),K(l,yn,"f").dispose(),l.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",K(l,Dd,"f")),_t(l,Sd,!0,"f")})()}}var Nc,Td,ja,Eo,xd,Ua,cT,uT,yt,F_,P_,Pe,Be,kc,ls,bo,Ad,Rd,Md,Bc,Do,Od,cs,Ei,Jt,ke,Or,N_,Nt,hT,dT,k_,B_;rt=new WeakMap,Dt=new WeakMap,Cd=new WeakMap,wd=new WeakMap,Pt=new WeakMap,Ui=new WeakMap,rs=new WeakMap,Fa=new WeakMap,Ed=new WeakMap,Mr=new WeakMap,ss=new WeakMap,Ci=new WeakMap,Pa=new WeakMap,Na=new WeakMap,Fc=new WeakMap,bd=new WeakMap,ka=new WeakMap,Co=new WeakMap,os=new WeakMap,as=new WeakMap,x_=new WeakMap,yn=new WeakMap,A_=new WeakMap,wo=new WeakMap,oT=new WeakMap,Dd=new WeakMap,Sd=new WeakMap,Ne=new WeakSet,aT=function(){var f=re(function*(){var l=this;const u=this.getMediaStreamConstraints();if("boolean"==typeof u.video&&(u.video={}),!u.video.deviceId)if(K(this,rs,"f"))delete u.video.facingMode,u.video.deviceId={exact:K(this,rs,"f")};else if(this.ifSaveLastUsedCamera&&Ye.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete u.video.facingMode,u.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const g=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),p=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));g&&p&&(u.video.width=g,u.video.height=p)}else if(!this.ifSkipCameraInspection){const g=function(){var v=re(function*(y){let b=null;return"environment"===y&&["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)?(yield l._getCameras(!1),K(l,Ne,"m",cr).call(l),b=Ye.findBestCamera(l._arrCameras,"environment",{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})):y||["Android","HarmonyOS","iPhone","iPad"].includes(Gn.OS)||(yield l._getCameras(!1),K(l,Ne,"m",cr).call(l),b=Ye.findBestCamera(l._arrCameras,null,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault})),b});return function(b){return v.apply(this,arguments)}}();let p=u.video.facingMode;p instanceof Array&&p.length&&(p=p[0]),"object"==typeof p&&(p=p.exact||p.ideal);const m=yield g(p);m&&(delete u.video.facingMode,u.video.deviceId={exact:m})}return u});return function(){return f.apply(this,arguments)}}(),cr=function(){if(K(this,Mr,"f")){const f=new Error("The operation was interrupted.");throw f.name="AbortError",f}},R_=function(){var f=re(function*(l){var g,p,u=this;if(!(null===(p=null===(g=null==window?void 0:window.navigator)||void 0===g?void 0:g.mediaDevices)||void 0===p?void 0:p.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let m;try{Ye._onLog&&Ye._onLog("======try getUserMedia========");let v=[0,500,1e3,2e3],y=null;const b=function(){var A=re(function*(L){for(let N of v){N&&(yield new Promise(k=>setTimeout(k,N)),K(u,Ne,"m",cr).call(u));try{Ye._onLog&&Ye._onLog("ask "+JSON.stringify(L)),m=yield navigator.mediaDevices.getUserMedia(L),K(u,Ne,"m",cr).call(u);break}catch(k){if("NotFoundError"===k.name||"NotAllowedError"===k.name||"AbortError"===k.name||"OverconstrainedError"===k.name)throw k;y=k,Ye._onLog&&Ye._onLog(k.message||k)}}});return function(N){return A.apply(this,arguments)}}();if(yield b(l),m||"object"!=typeof l.video||(l.video.deviceId&&(delete l.video.deviceId,yield b(l)),!m&&l.video.facingMode&&(delete l.video.facingMode,yield b(l)),m||!l.video.width&&!l.video.height||(delete l.video.width,delete l.video.height,yield b(l))),!m)throw y;return m}catch(v){throw null==m||m.getTracks().forEach(y=>{y.stop()}),"NotFoundError"===v.name&&(DOMException?v=new DOMException("No camera available, please use a device with an accessible camera.",v.name):(v=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),v}});return function(u){return f.apply(this,arguments)}}(),M_=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(f=>{f.stop()}),this._mediaStream=null),_t(this,Dt,null,"f")},Ba=function(){var f=re(function*(){var l=this;_t(this,Mr,!1,"f");const u=_t(this,Ed,Symbol(),"f");if(K(this,ss,"f")&&"pending"===K(this,Ci,"f")){try{yield K(this,ss,"f")}catch(p){}K(this,Ne,"m",cr).call(this)}return u!==K(this,Ed,"f")?void 0:_t(this,ss,re(function*(){_t(l,Ci,"pending","f");try{if(l.videoSrc){if(!K(l,rt,"f"))throw new Error("'videoEl' should be set.");yield Ye.playVideo(K(l,rt,"f"),l.videoSrc,l.cameraOpenTimeout),K(l,Ne,"m",cr).call(l)}else{let p=yield K(l,Ne,"m",aT).call(l);K(l,Ne,"m",M_).call(l);let m=yield K(l,Ne,"m",R_).call(l,p);yield l._getCameras(!1),K(l,Ne,"m",cr).call(l);const v=()=>{const L=m.getVideoTracks();let N,k;if(L.length&&(N=L[0]),N){const j=N.getSettings();if(j)for(let H of l._arrCameras)if(j.deviceId===H.deviceId){H._checked=!0,H.label=N.label,k=H;break}}return k},y=K(l,Pt,"f");if("object"==typeof y.video){let L=y.video.facingMode;if(L instanceof Array&&L.length&&(L=L[0]),"object"==typeof L&&(L=L.exact||L.ideal),!(K(l,rs,"f")||l.ifSaveLastUsedCamera&&Ye.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||l.ifSkipCameraInspection||y.video.deviceId)){const N=v(),k=Ye.findBestCamera(l._arrCameras,L,{getMainCameraInIOS:l.selectIOSRearMainCameraAsDefault});k&&k!=(null==N?void 0:N.deviceId)&&(m.getTracks().forEach(j=>{j.stop()}),p.video.deviceId={exact:k},m=yield K(l,Ne,"m",R_).call(l,p),K(l,Ne,"m",cr).call(l))}}const b=v();(null==b?void 0:b.deviceId)&&(_t(l,rs,b&&b.deviceId,"f"),l.ifSaveLastUsedCamera&&Ye.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",K(l,rs,"f")),"object"==typeof p.video&&p.video.width&&p.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(p.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(p.video.height))))),K(l,rt,"f")&&(yield Ye.playVideo(K(l,rt,"f"),m,l.cameraOpenTimeout),K(l,Ne,"m",cr).call(l)),l._mediaStream=m;const A=m.getVideoTracks();(null==A?void 0:A.length)&&_t(l,Dt,A[0],"f"),_t(l,Ui,b,"f")}}catch(p){throw K(l,Ne,"m",Id).call(l),_t(l,Ci,null,"f"),p}_t(l,Ci,"fulfilled","f")})(),"f")});return function(){return f.apply(this,arguments)}}(),Pc=function(){var f=re(function*(){var l;if("closed"===this.state||this.videoSrc)return;const u=null===(l=K(this,Ui,"f"))||void 0===l?void 0:l.deviceId,g=this.getResolution();yield K(this,Ne,"m",Ba).call(this);const p=this.getResolution();u&&u!==K(this,Ui,"f").deviceId&&K(this,yn,"f").fire("camera:changed",[K(this,Ui,"f").deviceId,u],{target:this,async:!1}),g.width==p.width&&g.height==p.height||K(this,yn,"f").fire("resolution:changed",[{width:p.width,height:p.height},{width:g.width,height:g.height}],{target:this,async:!1}),K(this,yn,"f").fire("played",null,{target:this,async:!1})});return function(){return f.apply(this,arguments)}}(),Id=function(){K(this,Ne,"m",M_).call(this),_t(this,Ui,null,"f"),K(this,rt,"f")&&(K(this,rt,"f").srcObject=null,this.videoSrc&&(K(this,rt,"f").pause(),K(this,rt,"f").currentTime=0)),_t(this,Mr,!0,"f");try{this.resetSoftwareScale()}catch(f){}},wi=function(){var f=re(function*(u,g){const p=$=>{if(!K(this,Dt,"f")||!this.isVideoPlaying||$.focusTaskId!=this._focusParameters.curFocusTaskId){K(this,Dt,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const q=new Error(`Focus task ${$.focusTaskId} canceled.`);throw q.name="DeprecatedTaskError",q}1===this._focusParameters.isDoingFocus&&Date.now()-$.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let m;g=ri(g,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield K(this,Dt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]}),p(u),m=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/g),Math.abs(1/this._focusParameters.fds.max-1/g))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/g)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=g,yield new Promise($=>{setTimeout($,m)}),p(u);let v=u.focusL-u.focusW/2,y=u.focusT-u.focusH/2,b=u.focusW,A=u.focusH;const L=this.getResolution();if(v>=L.width||y>=L.height)throw new Error("Invalid area.");v+b>L.width&&(b=L.width-v),y+A>L.height&&(A=L.height-y),v=Math.round(v),y=Math.round(y),b=Math.round(b),A=Math.round(A);const N=4*L.width*L.height*this._focusParameters.defaultTempBufferContainerLenRatio,k=4*b*A;let j=this._focusParameters.tempBufferContainer;if(j){const $=j.length;N>$&&N>=k?j=new Uint8Array(N):k>$&&k>=N&&(j=new Uint8Array(k))}else j=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(N,k));if(!this.imageDataGetter.getImageData(K(this,rt,"f"),L.width,L.height,{sx:v,sy:y,sWidth:b,sHeight:A,dWidth:b,dHeight:A},{pixelFormat:vt.RGBA,bufferContainer:j}))return K(this,Ne,"m",l).call(this,u,g);const H=j;let z=0;for(let $=0,q=k-8;$<q;++$){let X=H[$]-H[$+8];++$;let Q=H[$]-H[$+8];++$;let pe=H[$]-H[$+8];++$,z+=X*X+Q*Q+pe*pe}return-z});function l(u,g){return f.apply(this,arguments)}return l}(),Va=function(){var f=re(function*(u,g,p,m,v,y,b){let A;if(g=ri(g,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m=ri(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y?y=ri(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(y=ri(Math.sqrt((g||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b=yield K(this,Ne,"m",wi).call(this,u,y)),b<=p&&b<=v?A=3:p<v&&p<b?A=1:v<p&&v<b&&(A=2),(m-g)/2<=this._focusParameters.fds.step)return 3===A||(1===A?yield K(this,Dt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]}):2===A&&(yield K(this,Dt,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}))),!0;if(1===A)return yield K(this,Ne,"m",l).call(this,u,g,p,y,b);if(2===A)return yield K(this,Ne,"m",l).call(this,u,y,b,m,v);if(3!==A)return p=yield K(this,Ne,"m",wi).call(this,u,g),v=yield K(this,Ne,"m",wi).call(this,u,m),yield K(this,Ne,"m",l).call(this,u,g,p,m,v);let L=ri(Math.sqrt((g||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),N=ri(Math.sqrt((m||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/L)<=Math.abs(1/this._focusParameters.oldDistance-1/N)){let k=yield K(this,Ne,"m",wi).call(this,u,L);if(k<b)return yield K(this,Ne,"m",l).call(this,u,g,p,y,b,L,k);if(k==b)return yield K(this,Ne,"m",l).call(this,u,L,k,y,b);let j=yield K(this,Ne,"m",wi).call(this,u,N);if(k>b&&b<j)return yield K(this,Ne,"m",l).call(this,u,L,k,N,j,y,b);if(b==j)return yield K(this,Ne,"m",l).call(this,u,y,b,N,j);if(b>j)return yield K(this,Ne,"m",l).call(this,u,y,b,m,v,N,j)}else{let k=yield K(this,Ne,"m",wi).call(this,u,N);if(b>k)return yield K(this,Ne,"m",l).call(this,u,y,b,m,v,N,k);if(b==k)return yield K(this,Ne,"m",l).call(this,u,y,b,N,k);let j=yield K(this,Ne,"m",wi).call(this,u,L);if(j>b&&b<k)return yield K(this,Ne,"m",l).call(this,u,L,j,N,k,y,b);if(j==b)return yield K(this,Ne,"m",l).call(this,u,L,j,y,b);if(j<b)return yield K(this,Ne,"m",l).call(this,u,g,p,y,b,L,j)}return!1});function l(u,g,p,m,v,y,b){return f.apply(this,arguments)}return l}(),O_=function(){var f=re(function*(l,u,g,p,m){var y,v=this;if(1==this._focusParameters.isDoingFocus)return!1;if(!l||"string"!=typeof l.x||"string"!=typeof l.y)throw new Error("Invalid 'centerPoint'.");if(!u||"string"!=typeof u)throw new Error("Invalid 'width'.");if(!g||"string"!=typeof g)throw new Error("Invalid 'height'.");const b=this.getResolution();let A=0,L=0;if(l.x.endsWith("px"))A=parseFloat(l.x);else{if(!l.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");A=parseFloat(l.x)/100*b.width}if(l.y.endsWith("px"))L=parseFloat(l.y);else{if(!l.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");L=parseFloat(l.y)/100*b.height}if(isNaN(A)||isNaN(L)||A<0||A>b.width||L<0||L>b.height)throw new Error("Invalid 'centerPoint'.");let N=0;if(u.endsWith("px"))N=parseFloat(u);else{if(!u.endsWith("%"))throw new Error("Invalid 'width'.");N=parseFloat(u)/100*b.width}if(isNaN(N)||N<0)throw new Error("Invalid 'width'.");let k=0;if(g.endsWith("px"))k=parseFloat(g);else{if(!g.endsWith("%"))throw new Error("Invalid 'height'.");k=parseFloat(g)/100*b.height}if(isNaN(k)||k<0)throw new Error("Invalid 'height'.");if(1!==K(this,os,"f")){const z=K(this,os,"f"),$=K(this,as,"f");N/=z,k/=z,A=(1-1/z)*$.x+A/z,L=(1-1/z)*$.y+L/z}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(y=this.getCameraCapabilities())||void 0===y?void 0:y.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const j={focusL:A,focusT:L,focusW:N,focusH:k,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},H=function(){var z=re(function*($,q,X){try{(null==q||q<v._focusParameters.fds.min)&&(q=v._focusParameters.fds.min),(null==X||X>v._focusParameters.fds.max)&&(X=v._focusParameters.fds.max),v._focusParameters.oldDistance=null;let Q=ri(Math.sqrt(X*(q||v._focusParameters.fds.step)),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),pe=ri(Math.sqrt((q||v._focusParameters.fds.step)*Q),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),_e=ri(Math.sqrt(Q*X),v._focusParameters.fds.min,v._focusParameters.fds.step,v._focusParameters.fds.max),Te=yield K(v,Ne,"m",wi).call(v,$,_e),Re=yield K(v,Ne,"m",wi).call(v,$,pe),P=yield K(v,Ne,"m",wi).call(v,$,Q);if(Re>P&&P<Te){const Ee=yield K(v,Ne,"m",Va).call(v,$,pe,Re,_e,Te,Q,P);return v._focusParameters.isDoingFocus=0,Ee}if(Re<P&&Re<Te){let Ee=yield K(v,Ne,"m",wi).call(v,$,q);const Ve=yield K(v,Ne,"m",Va).call(v,$,q,Ee,Q,P,pe,Re);return v._focusParameters.isDoingFocus=0,Ve}if(P>Te&&Re>Te){let Ee=yield K(v,Ne,"m",wi).call(v,$,X);const Ve=yield K(v,Ne,"m",Va).call(v,$,Q,P,X,Ee,_e,Te);return v._focusParameters.isDoingFocus=0,Ve}if(Re==P&&P<Te){const Ee=yield K(v,Ne,"m",Va).call(v,$,pe,Re,Q,P);return v._focusParameters.isDoingFocus=0,Ee}if(P==Te&&Re>P){const Ee=yield K(v,Ne,"m",Va).call(v,$,Q,P,_e,Te);return v._focusParameters.isDoingFocus=0,Ee}return H($,q,X)}catch(Q){if("DeprecatedTaskError"!==Q.name)throw Q}});return function(q,X,Q){return z.apply(this,arguments)}}();return H(j,p,m)});return function(u,g,p,m,v){return f.apply(this,arguments)}}(),L_=function(f){if("opened"!==this.state)throw new Error("Video is not playing.");if(!f||"string"!=typeof f.x||"string"!=typeof f.y)throw new Error("Invalid 'center'.");const l=this.getResolution();let u=0,g=0;if(f.x.endsWith("px"))u=parseFloat(f.x);else{if(!f.x.endsWith("%"))throw new Error("Invalid scale center.");u=parseFloat(f.x)/100*l.width}if(f.y.endsWith("px"))g=parseFloat(f.y);else{if(!f.y.endsWith("%"))throw new Error("Invalid scale center.");g=parseFloat(f.y)/100*l.height}if(isNaN(u)||isNaN(g))throw new Error("Invalid scale center.");_t(this,as,{x:u,y:g},"f")},lT=function(f){if("opened"!==this.state)throw new Error("Video is not playing.");const l=this.getResolution();return f&&f.x==l.width/2&&f.y==l.height/2},Ye.browserInfo=Gn,Ye.onWarning=null===(T_=null==window?void 0:window.console)||void 0===T_?void 0:T_.warn;class us{constructor(l){Nc.add(this),Td.set(this,void 0),ja.set(this,0),Eo.set(this,void 0),xd.set(this,0),Ua.set(this,!1),Fe(this,Td,l,"f")}startCharging(){U(this,Ua,"f")||(us._onLog&&us._onLog("start charging."),U(this,Nc,"m",uT).call(this),Fe(this,Ua,!0,"f"))}stopCharging(){U(this,Eo,"f")&&clearTimeout(U(this,Eo,"f")),U(this,Ua,"f")&&(us._onLog&&us._onLog("stop charging."),Fe(this,ja,Date.now()-U(this,xd,"f"),"f"),Fe(this,Ua,!1,"f"))}}Td=new WeakMap,ja=new WeakMap,Eo=new WeakMap,xd=new WeakMap,Ua=new WeakMap,Nc=new WeakSet,cT=function(){Ft.cfd(1),us._onLog&&us._onLog("charge 1.")},uT=function f(){0==U(this,ja,"f")&&U(this,Nc,"m",cT).call(this),Fe(this,xd,Date.now(),"f"),U(this,Eo,"f")&&clearTimeout(U(this,Eo,"f")),Fe(this,Eo,setTimeout(()=>{Fe(this,ja,0,"f"),U(this,Nc,"m",f).call(this)},U(this,Td,"f")-U(this,ja,"f")),"f")};const fT=new Map([[Ge.IPF_GRAYSCALED,vt.GREY],[Ge.IPF_ABGR_8888,vt.RGBA],[Ge.IPF_ARGB_8888,vt.BGRA]]),gT=new Map([[vt.GREY,Ge.IPF_GRAYSCALED],[vt.RGBA,Ge.IPF_ABGR_8888],[vt.BGRA,Ge.IPF_ARGB_8888]]),V_="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class st extends Bi{static set _onLog(l){Fe(st,F_,l,"f",P_),Ye._onLog=l,us._onLog=l}static get _onLog(){return U(st,F_,"f",P_)}static detectEnvironment(){return re(function*(){return yield re(function*(){return{wasm:Hj,worker:Wj,getUserMedia:GI,camera:yield zj(),browser:Fn.browser,version:Fn.version,OS:Fn.OS}})()})()}static testCameraAccess(){return re(function*(){const l=yield Ye.testCameraAccess();return l.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===l.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===l.errorName||"NotFoundError"===l.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===l.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===l.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===l.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===l.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:l.errorMessage}})()}static createInstance(l){return re(function*(){var u,g;if(l&&!(l instanceof ln))throw new TypeError("Invalid view.");if(null===(u=Qt.license)||void 0===u?void 0:u.LicenseManager){if(!(null===(g=Qt.license)||void 0===g?void 0:g.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield Ft.loadWasm(["license"]),yield Qt.license.dynamsoft()}const p=new st(l);return st.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{st.onWarning&&st.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{st.onWarning&&st.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),p})()}get video(){return U(this,Pe,"f").getVideoEl()}set videoSrc(l){if(!U(this,Pe,"f"))throw new Error("Camera manager is null.");U(this,Be,"f")&&(U(this,Be,"f")._hideDefaultSelection=!0),U(this,Pe,"f").videoSrc=l}get videoSrc(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.videoSrc}set ifSaveLastUsedCamera(l){if(!U(this,Pe,"f"))throw new Error("Camera manager is null.");U(this,Pe,"f").ifSaveLastUsedCamera=l}get ifSaveLastUsedCamera(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.ifSaveLastUsedCamera}set ifSkipCameraInspection(l){if(!U(this,Pe,"f"))throw new Error("Camera manager is null.");U(this,Pe,"f").ifSkipCameraInspection=l}get ifSkipCameraInspection(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.ifSkipCameraInspection}set cameraOpenTimeout(l){if(!U(this,Pe,"f"))throw new Error("Camera manager is null.");U(this,Pe,"f").cameraOpenTimeout=l}get cameraOpenTimeout(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.cameraOpenTimeout}set singleFrameMode(l){if(!["disabled","image","camera"].includes(l))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Fe(this,Ad,l,"f")}get singleFrameMode(){return U(this,Ad,"f")}get _isFetchingStarted(){return U(this,cs,"f")}get disposed(){return U(this,N_,"f")}constructor(l){var u;if(super(),u=this,yt.add(this),Pe.set(this,void 0),Be.set(this,void 0),kc.set(this,"closed"),ls.set(this,void 0),bo.set(this,!1),Ad.set(this,void 0),this._onCameraSelChange=re(function*(){u.isOpen()&&U(u,Be,"f")&&!U(u,Be,"f").disposed&&(yield u.selectCamera(U(u,Be,"f")._selCam.value))}),this._onResolutionSelChange=re(function*(){if(!u.isOpen()||!U(u,Be,"f")||U(u,Be,"f").disposed)return;let g,p;if(U(u,Be,"f")._selRsl&&-1!=U(u,Be,"f")._selRsl.selectedIndex){let m=U(u,Be,"f")._selRsl.options[U(u,Be,"f")._selRsl.selectedIndex];g=parseInt(m.getAttribute("data-width")),p=parseInt(m.getAttribute("data-height"))}yield u.setResolution({width:g,height:p})}),this._onCloseBtnClick=re(function*(){u.isOpen()&&U(u,Be,"f")&&!U(u,Be,"f").disposed&&u.close()}),Rd.set(this,(g,p,m,v)=>{const y=Date.now(),b={sx:v.x,sy:v.y,sWidth:v.width,sHeight:v.height,dWidth:v.width,dHeight:v.height},A=Math.max(b.dWidth,b.dHeight);if(this.canvasSizeLimit&&A>this.canvasSizeLimit){const k=this.canvasSizeLimit/A;b.dWidth>b.dHeight?(b.dWidth=this.canvasSizeLimit,b.dHeight=Math.round(b.dHeight*k)):(b.dWidth=Math.round(b.dWidth*k),b.dHeight=this.canvasSizeLimit)}const L=U(this,Pe,"f").imageDataGetter.getImageData(g,p,m,b,{pixelFormat:fT.get(this.getPixelFormat())});let N=null;if(L){const k=Date.now();let j;j=L.pixelFormat===vt.GREY?L.width:4*L.width;let H=!0;0===b.sx&&0===b.sy&&b.sWidth===p&&b.sHeight===m&&(H=!1),N={bytes:L.data,width:L.width,height:L.height,stride:j,format:gT.get(L.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Jh.ITT_FILE_IMAGE,isCropped:H,cropRegion:{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height,isMeasuredInPercentage:!1},originalWidth:p,originalHeight:m,currentWidth:L.width,currentHeight:L.height,timeSpent:k-y,timeStamp:k},toCanvas:U(this,Md,"f"),isDCEFrame:!0}}return N}),this._onSingleFrameAcquired=g=>{let p;p=U(this,Be,"f")?U(this,Be,"f").getConvertedRegion():ad.convert(U(this,Do,"f"),g.width,g.height),p||(p={x:0,y:0,width:g.width,height:g.height});const m=U(this,Rd,"f").call(this,g,g.width,g.height,p);U(this,ls,"f").fire("singleFrameAcquired",[m],{async:!1,copy:!1})},Md.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const g=document.createElement("canvas");let p;if(g.width=this.width,g.height=this.height,this.format===Ge.IPF_GRAYSCALED){p=new Uint8ClampedArray(this.width*this.height*4);for(let m=0;m<p.length;m+=4)p[m]=this.bytes[m/4],p[m+1]=this.bytes[m/4],p[m+2]=this.bytes[m/4],p[m+3]=255}else p=new Uint8ClampedArray(this.bytes.buffer);return g.getContext("2d").putImageData(new ImageData(p,this.width,this.height),0,0),g}),Bc.set(this,void 0),Do.set(this,void 0),Od.set(this,Ge.IPF_ABGR_8888),cs.set(this,!1),this._imageId=-1,Ei.set(this,void 0),this.fetchInterval=0,Jt.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),ke.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Or.set(this,void 0),N_.set(this,!1),this.isCameraEnhancer=!0,l&&!(l instanceof ln))throw new TypeError("Invalid view.");Fe(this,ls,new KI,"f"),Fe(this,Pe,new Ye,"f"),this._imageDataGetter=U(this,Pe,"f").imageDataGetter,U(this,Pe,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const g=U(this,Pe,"f").getSoftwareScale();if(g<1)throw new RangeError("Invalid scale value.");U(this,Be,"f")&&!U(this,Be,"f").disposed?(this.video.style.transform=1===g?"":`scale(${g})`,U(this,Be,"f")._updateVideoContainer()):this.video.style.transform=1===g?"":`scale(${g})`},["iPhone","iPad","Android","HarmonyOS"].includes(Fn.OS)?U(this,Pe,"f").setResolution(1280,720):U(this,Pe,"f").setResolution(1920,1080),this.singleFrameMode=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"disabled":"image",l&&this.setCameraView(l),this._on("before:camera:change",()=>{U(this,Or,"f").stopCharging();const g=U(this,Be,"f");g&&!g.disposed&&(g._startLoading(),g.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const g=U(this,Be,"f");g&&!g.disposed&&(g._startLoading(),g.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),l.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{U(this,Or,"f").stopCharging(),U(this,Be,"f")}),this._on("resumed",()=>{U(this,Be,"f")}),this._on("tapfocus",()=>{U(this,Jt,"f").tapToFocus&&U(this,Or,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=function(){var g=re(function*(p,m){var v,y,b,A;if(U(u,yt,"m",Nt).call(u)||!u.isOpen()||u.isPaused())return;const L=p.intermediateResultUnits;st._onLog&&(st._onLog("intermediateResultUnits:"),st._onLog(L));let N=!1,k=!1;for(let j of L){if(j.unitType===ba.IRUT_DECODED_BARCODES&&j.decodedBarcodes.length){N=!0;break}j.unitType===ba.IRUT_LOCALIZED_BARCODES&&j.localizedBarcodes.length&&(k=!0)}if(st._onLog&&(st._onLog("hasLocalizedBarcodes:"),st._onLog(k)),U(u,Jt,"f").autoZoom||U(u,Jt,"f").enhancedFocus)if(N)U(u,ke,"f").autoZoomInFrameArray.length=0,U(u,ke,"f").autoZoomOutFrameCount=0,U(u,ke,"f").frameArrayInIdealZoom.length=0,U(u,ke,"f").autoFocusFrameArray.length=0;else{const j=function(){var z=re(function*($){yield u.setZoom($),U(u,Jt,"f").autoZoom&&U(u,Or,"f").startCharging()});return function(q){return z.apply(this,arguments)}}(),H=function(){var z=re(function*($){yield u.setFocus($),U(u,Jt,"f").enhancedFocus&&U(u,Or,"f").startCharging()});return function(q){return z.apply(this,arguments)}}();if(k){const z=L[0].originalImageTag,$=(null===(v=z.cropRegion)||void 0===v?void 0:v.left)||0,q=(null===(y=z.cropRegion)||void 0===y?void 0:y.top)||0,X=(null===(b=z.cropRegion)||void 0===b?void 0:b.right)?z.cropRegion.right-$:z.originalWidth,Q=(null===(A=z.cropRegion)||void 0===A?void 0:A.bottom)?z.cropRegion.bottom-q:z.originalHeight,pe=z.currentWidth,_e=z.currentHeight;let Te;{let Re,P,Ee,Ve,nt;{const D=u.video.videoWidth*(1-U(u,ke,"f").autoZoomDetectionArea)/2,T=u.video.videoWidth*(1+U(u,ke,"f").autoZoomDetectionArea)/2,_=T,C=D,I=u.video.videoHeight*(1-U(u,ke,"f").autoZoomDetectionArea)/2,O=I,x=u.video.videoHeight*(1+U(u,ke,"f").autoZoomDetectionArea)/2;nt=[{x:D,y:I},{x:T,y:O},{x:_,y:x},{x:C,y:x}]}st._onLog&&(st._onLog("detectionArea:"),st._onLog(nt));const S=[];{const D=(T,_)=>{const C=(O,x)=>{if(!O&&!x)throw new Error("Invalid arguments.");return function(M,F,B){let V=!1;const W=M.length;if(W<=2)return!1;for(let G=0;G<W;G++){const Y=M[G],Z=M[(G+1)%W];if(Xj(Y,Z,{x:F,y:B}))return!0;p_(Y.y-B)>0!=p_(Z.y-B)>0&&p_(F-(B-Y.y)*(Y.x-Z.x)/(Y.y-Z.y)-Y.x)<0&&(V=!V)}return V}(x,O.x,O.y)},I=(O,x)=>!!(cd([O[0],O[1]],[O[2],O[3]],[x[0].x,x[0].y],[x[1].x,x[1].y])||cd([O[0],O[1]],[O[2],O[3]],[x[1].x,x[1].y],[x[2].x,x[2].y])||cd([O[0],O[1]],[O[2],O[3]],[x[2].x,x[2].y],[x[3].x,x[3].y])||cd([O[0],O[1]],[O[2],O[3]],[x[3].x,x[3].y],[x[0].x,x[0].y]));return!!(C({x:T[0].x,y:T[0].y},_)||C({x:T[1].x,y:T[1].y},_)||C({x:T[2].x,y:T[2].y},_)||C({x:T[3].x,y:T[3].y},_))||!!(C({x:_[0].x,y:_[0].y},T)||C({x:_[1].x,y:_[1].y},T)||C({x:_[2].x,y:_[2].y},T)||C({x:_[3].x,y:_[3].y},T))||!!(I([_[0].x,_[0].y,_[1].x,_[1].y],T)||I([_[1].x,_[1].y,_[2].x,_[2].y],T)||I([_[2].x,_[2].y,_[3].x,_[3].y],T)||I([_[3].x,_[3].y,_[0].x,_[0].y],T))};for(let T of L)if(T.unitType===ba.IRUT_LOCALIZED_BARCODES)for(let _ of T.localizedBarcodes){if(!_)continue;const C=_.location.points;C.forEach(I=>{ln._transformCoordinates(I,$,q,X,Q,pe,_e)}),D(nt,C)&&S.push(_)}if(st._debug&&U(u,Be,"f")){const T=u.__layer||(u.__layer=U(u,Be,"f")._createDrawingLayer(99));T.clearDrawingItems();const _=u.__styleId2||(u.__styleId2=we.createDrawingStyle({strokeStyle:"red"}));for(let C of L)if(C.unitType===ba.IRUT_LOCALIZED_BARCODES)for(let I of C.localizedBarcodes){if(!I)continue;const x=new C_({points:I.location.points},_);T.addDrawingItems([x])}}}if(st._onLog&&(st._onLog("intersectedResults:"),st._onLog(S)),!S.length)return;let w;if(S.length){let D=S.filter(T=>T.possibleFormats==V_.BF_QR_CODE||T.possibleFormats==V_.BF_DATAMATRIX);if(D.length||(D=S.filter(T=>T.possibleFormats==V_.BF_ONED),D.length||(D=S)),D.length){const T=C=>{const I=C.location.points,O=(I[0].x+I[1].x+I[2].x+I[3].x)/4,x=(I[0].y+I[1].y+I[2].y+I[3].y)/4;return(O-pe/2)*(O-pe/2)+(x-_e/2)*(x-_e/2)};w=D[0];let _=T(w);if(1!=D.length)for(let C=1;C<D.length;C++){const I=T(D[C]);(D[C].confidence>1.1*w.confidence||D[C].confidence>.9*w.confidence&&I<_)&&(w=D[C],_=I)}}}if(st._onLog&&(st._onLog("highPriorityResult:"),st._onLog(w)),w){const D=w.location.points;Re=Math.min(D[0].x,D[1].x,D[2].x,D[3].x),P=Math.max(D[0].x,D[1].x,D[2].x,D[3].x),Ee=Math.min(D[0].y,D[1].y,D[2].y,D[3].y),Ve=Math.max(D[0].y,D[1].y,D[2].y,D[3].y),Te={points:[{x:Re,y:Ee},{x:P,y:Ee},{x:P,y:Ve},{x:Re,y:Ve}],result:w}}}if(st._onLog&&(st._onLog("boundingRect:"),st._onLog(Te)),!Te)return;if(st._debug&&U(u,Be,"f")&&(null==Te?void 0:Te.points)){const Re=u.__layer||(u.__layer=U(u,Be,"f")._createDrawingLayer(99)),P=u.__styleId1||(u.__styleId1=we.createDrawingStyle({strokeStyle:"blue"})),Ee=new C_({points:Te.points},P);Re.addDrawingItems([Ee])}if(U(u,ke,"f").autoZoomOutFrameCount=0,U(u,Jt,"f").autoZoom){const Re=U(u,ke,"f").autoZoomIdealArea[1];let P=(1-U(u,ke,"f").autoZoomTargetBorder)/2;const Ee=Te.points[0].x/X,Ve=(X-Te.points[2].x)/X,nt=Te.points[0].y/Q,S=(Q-Te.points[2].y)/Q;if(Ee>Re&&Ve>Re&&nt>Re&&S>Re&&Te.result.moduleSize<U(u,ke,"f").autoZoomInIdealModuleSize){if(U(u,ke,"f").autoZoomInFrameArray.push(!0),U(u,ke,"f").autoZoomInFrameArray.splice(0,U(u,ke,"f").autoZoomInFrameArray.length-U(u,ke,"f").autoZoomInFrameLimit[0]),U(u,ke,"f").frameArrayInIdealZoom.length=0,U(u,Jt,"f").enhancedFocus&&H({mode:"continuous"}).catch(()=>{}),U(u,ke,"f").autoZoomInFrameArray.filter(w=>!0===w).length>=U(u,ke,"f").autoZoomInFrameLimit[1]){U(u,ke,"f").autoZoomInFrameArray.length=0;const w=[(.5-P)/(.5-Ee),(.5-P)/(.5-Ve),(.5-P)/(.5-nt),(.5-P)/(.5-S)].filter(I=>I>0),D=Math.min(...w,U(u,ke,"f").autoZoomInIdealModuleSize/Te.result.moduleSize),T=u.getZoomSettings().factor;let _=Math.max(Math.pow(T*D,1/U(u,ke,"f").autoZoomInMaxTimes),U(u,ke,"f").autoZoomInMinStep);_=Math.min(_,D);let C=T*_;C=Math.max(U(u,ke,"f").minValue,C),C=Math.min(U(u,ke,"f").maxValue,C);try{yield j({factor:C})}catch(I){console.warn(I.message||I)}u.clearBuffer()}}else if(U(u,ke,"f").autoZoomInFrameArray.length=0,U(u,ke,"f").frameArrayInIdealZoom.push(!0),U(u,ke,"f").frameArrayInIdealZoom.splice(0,U(u,ke,"f").frameArrayInIdealZoom.length-U(u,ke,"f").frameLimitInIdealZoom[0]),U(u,ke,"f").frameArrayInIdealZoom.filter(w=>!0===w).length>=U(u,ke,"f").frameLimitInIdealZoom[1]&&(U(u,ke,"f").frameArrayInIdealZoom.length=0,U(u,Jt,"f").enhancedFocus)){const w=Te.points;try{yield H({mode:"manual",area:{centerPoint:{x:(w[0].x+w[2].x)/2+"px",y:(w[0].y+w[2].y)/2+"px"},width:w[2].x-w[0].x+"px",height:w[2].y-w[0].y+"px"}})}catch(D){console.warn(D.message||D)}u.clearBuffer()}}if(!U(u,Jt,"f").autoZoom&&U(u,Jt,"f").enhancedFocus&&(U(u,ke,"f").autoFocusFrameArray.push(!0),U(u,ke,"f").autoFocusFrameArray.splice(0,U(u,ke,"f").autoFocusFrameArray.length-U(u,ke,"f").autoFocusFrameLimit[0]),U(u,ke,"f").autoFocusFrameArray.filter(Re=>!0===Re).length>=U(u,ke,"f").autoFocusFrameLimit[1])){U(u,ke,"f").autoFocusFrameArray.length=0;try{const Re=Te.points;yield H({mode:"manual",area:{centerPoint:{x:(Re[0].x+Re[2].x)/2+"px",y:(Re[0].y+Re[2].y)/2+"px"},width:Re[2].x-Re[0].x+"px",height:Re[2].y-Re[0].y+"px"}})}catch(Re){console.warn(Re.message||Re)}u.clearBuffer()}}else{if(U(u,Jt,"f").autoZoom){if(U(u,ke,"f").autoZoomInFrameArray.push(!1),U(u,ke,"f").autoZoomInFrameArray.splice(0,U(u,ke,"f").autoZoomInFrameArray.length-U(u,ke,"f").autoZoomInFrameLimit[0]),U(u,ke,"f").autoZoomOutFrameCount++,U(u,ke,"f").frameArrayInIdealZoom.push(!1),U(u,ke,"f").frameArrayInIdealZoom.splice(0,U(u,ke,"f").frameArrayInIdealZoom.length-U(u,ke,"f").frameLimitInIdealZoom[0]),U(u,ke,"f").autoZoomOutFrameCount>=U(u,ke,"f").autoZoomOutFrameLimit){U(u,ke,"f").autoZoomOutFrameCount=0;const z=u.getZoomSettings().factor;let $=z-Math.max((z-1)*U(u,ke,"f").autoZoomOutStepRate,U(u,ke,"f").autoZoomOutMinStep);$=Math.max(U(u,ke,"f").minValue,$),$=Math.min(U(u,ke,"f").maxValue,$);try{yield j({factor:$})}catch(q){console.warn(q.message||q)}u.clearBuffer()}U(u,Jt,"f").enhancedFocus&&H({mode:"continuous"}).catch(()=>{})}!U(u,Jt,"f").autoZoom&&U(u,Jt,"f").enhancedFocus&&(U(u,ke,"f").autoFocusFrameArray.length=0,H({mode:"continuous"}).catch(()=>{}))}}});return function(p,m){return g.apply(this,arguments)}}(),Fe(this,Or,new us(1e4),"f")}setCameraView(l){if(!(l instanceof ln))throw new TypeError("Invalid view.");if(l.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),l._singleFrameMode=this.singleFrameMode,l._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(U(this,Be,"f")._hideDefaultSelection=!0),U(this,yt,"m",Nt).call(this)||U(this,Pe,"f").setVideoEl(l.getVideoElement()),Fe(this,Be,l,"f"),this.addListenerToView()}getCameraView(){return U(this,Be,"f")}releaseCameraView(){U(this,Be,"f")&&(this.removeListenerFromView(),U(this,Be,"f").disposed||(U(this,Be,"f")._singleFrameMode="disabled",U(this,Be,"f")._onSingleFrameAcquired=null,U(this,Be,"f")._hideDefaultSelection=!1),U(this,Pe,"f").releaseVideoEl(),Fe(this,Be,null,"f"))}addListenerToView(){if(!U(this,Be,"f"))return;if(U(this,Be,"f").disposed)throw new Error("'cameraView' has been disposed.");const l=U(this,Be,"f");U(this,yt,"m",Nt).call(this)||this.videoSrc||(l._innerComponent&&(U(this,Pe,"f").tapFocusEventBoundEl=l._innerComponent),l._selCam&&l._selCam.addEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.addEventListener("change",this._onResolutionSelChange)),l._btnClose&&l._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!U(this,Be,"f")||U(this,Be,"f").disposed)return;const l=U(this,Be,"f");U(this,Pe,"f").tapFocusEventBoundEl=null,l._selCam&&l._selCam.removeEventListener("change",this._onCameraSelChange),l._selRsl&&l._selRsl.removeEventListener("change",this._onResolutionSelChange),l._btnClose&&l._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return U(this,yt,"m",Nt).call(this)?U(this,kc,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(U(this,Pe,"f").state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}open(){var l=this;return re(function*(){const u=U(l,Be,"f");if(null==u?void 0:u.disposed)throw new Error("'cameraView' has been disposed.");u&&(u._singleFrameMode=l.singleFrameMode,U(l,yt,"m",Nt).call(l)?u._clickIptSingleFrameMode():(U(l,Pe,"f").setVideoEl(u.getVideoElement()),u._startLoading()));let g={width:0,height:0,deviceId:""};if(!U(l,yt,"m",Nt).call(l)){try{yield U(l,Pe,"f").open()}catch(m){throw u&&u._stopLoading(),m}U(l,bo,"f")&&l.turnOnTorch().catch(()=>{});const p=l.getResolution();g.width=p.width,g.height=p.height,g.deviceId=l.getSelectedCamera().deviceId}return Fe(l,kc,"open","f"),u&&(u._innerComponent.style.display="",U(l,yt,"m",Nt).call(l)||(u._stopLoading(),u._renderCamerasInfo(l.getSelectedCamera(),U(l,Pe,"f")._arrCameras),u._renderResolutionInfo({width:g.width,height:g.height}),u.eventHandler.fire("content:updated",null,{async:!1}),u.eventHandler.fire("videoEl:resized",null,{async:!1}))),U(l,ls,"f").fire("opened",null,{target:l,async:!1}),g})()}close(){const l=U(this,Be,"f");if(null==l?void 0:l.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),U(this,yt,"m",Nt).call(this)||U(this,Pe,"f").close(),Fe(this,kc,"closed","f"),U(this,Or,"f").stopCharging(),l&&(l._innerComponent.style.display="none",U(this,yt,"m",Nt).call(this)&&l._innerComponent.removeElement("content"),l._stopLoading()),U(this,ls,"f").fire("closed",null,{target:this,async:!1})}pause(){if(U(this,yt,"m",Nt).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");U(this,Pe,"f").pause()}isPaused(){var l;return!U(this,yt,"m",Nt).call(this)&&!0===(null===(l=this.video)||void 0===l?void 0:l.paused)}resume(){var l=this;return re(function*(){if(U(l,yt,"m",Nt).call(l))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield U(l,Pe,"f").resume()})()}selectCamera(l){var u=this;return re(function*(){if(!l)throw new Error("Invalid value.");let g;g="string"==typeof l?l:l.deviceId,yield U(u,Pe,"f").setCamera(g),Fe(u,bo,!1,"f");const p=u.getResolution(),m=U(u,Be,"f");return m&&!m.disposed&&(m._stopLoading(),m._renderCamerasInfo(u.getSelectedCamera(),U(u,Pe,"f")._arrCameras),m._renderResolutionInfo({width:p.width,height:p.height})),{width:p.width,height:p.height,deviceId:u.getSelectedCamera().deviceId}})()}getSelectedCamera(){return U(this,Pe,"f").getCamera()}getAllCameras(){var l=this;return re(function*(){return U(l,Pe,"f").getCameras()})()}setResolution(l){var u=this;return re(function*(){yield U(u,Pe,"f").setResolution(l.width,l.height),U(u,bo,"f")&&u.turnOnTorch().catch(()=>{});const g=u.getResolution(),p=U(u,Be,"f");return p&&!p.disposed&&(p._stopLoading(),p._renderResolutionInfo({width:g.width,height:g.height})),{width:g.width,height:g.height,deviceId:u.getSelectedCamera().deviceId}})()}getResolution(){return U(this,Pe,"f").getResolution()}getAvailableResolutions(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getResolutions()}_on(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?U(this,ls,"f").on(l,u):U(this,Pe,"f").on(l,u)}_off(l,u){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(l.toLowerCase())?U(this,ls,"f").off(l,u):U(this,Pe,"f").off(l,u)}on(l,u){const g=l.toLowerCase(),p=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(g);if(!p)throw new Error("Invalid event.");this._on(p,u)}off(l,u){const g=l.toLowerCase(),p=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(g);if(!p)throw new Error("Invalid event.");this._off(p,u)}getVideoSettings(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getMediaStreamConstraints()}updateVideoSettings(l){var u=this;return re(function*(){var g;yield null===(g=U(u,Pe,"f"))||void 0===g?void 0:g.setMediaStreamConstraints(l,!0)})()}getCapabilities(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getCameraCapabilities()}getCameraSettings(){return U(this,Pe,"f").getCameraSettings()}turnOnTorch(){var l=this;return re(function*(){var u;if(U(l,yt,"m",Nt).call(l))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Pe,"f"))||void 0===u?void 0:u.turnOnTorch(),Fe(l,bo,!0,"f")})()}turnOffTorch(){var l=this;return re(function*(){var u;if(U(l,yt,"m",Nt).call(l))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Pe,"f"))||void 0===u?void 0:u.turnOffTorch(),Fe(l,bo,!1,"f")})()}setColorTemperature(l){var u=this;return re(function*(){if(U(u,yt,"m",Nt).call(u))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield U(u,Pe,"f").setColorTemperature(l,!0)})()}getColorTemperature(){return U(this,Pe,"f").getColorTemperature()}setExposureCompensation(l){var u=this;return re(function*(){var g;if(U(u,yt,"m",Nt).call(u))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Pe,"f"))||void 0===g?void 0:g.setExposureCompensation(l,!0)})()}getExposureCompensation(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getExposureCompensation()}_setZoom(l){var u=this;return re(function*(){var g;if(U(u,yt,"m",Nt).call(u))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Pe,"f"))||void 0===g?void 0:g.setZoom(l)})()}setZoom(l){var u=this;return re(function*(){yield u._setZoom(l)})()}getZoomSettings(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getZoom()}resetZoom(){var l=this;return re(function*(){var u;if(U(l,yt,"m",Nt).call(l))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield null===(u=U(l,Pe,"f"))||void 0===u?void 0:u.resetZoom()})()}setFrameRate(l){var u=this;return re(function*(){var g;if(U(u,yt,"m",Nt).call(u))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Pe,"f"))||void 0===g?void 0:g.setFrameRate(l,!0)})()}getFrameRate(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getFrameRate()}setFocus(l){var u=this;return re(function*(){var g;if(U(u,yt,"m",Nt).call(u))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield null===(g=U(u,Pe,"f"))||void 0===g?void 0:g.setFocus(l,!0)})()}getFocusSettings(){var l;return null===(l=U(this,Pe,"f"))||void 0===l?void 0:l.getFocus()}setAutoZoomRange(l){U(this,ke,"f").minValue=l.min,U(this,ke,"f").maxValue=l.max}getAutoZoomRange(){return{min:U(this,ke,"f").minValue,max:U(this,ke,"f").maxValue}}enableEnhancedFeatures(l){var u=this;return re(function*(){var g,p;if(!(null===(p=null===(g=Qt.license)||void 0===g?void 0:g.LicenseManager)||void 0===p?void 0:p.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==Ft.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");l&Fs.EF_ENHANCED_FOCUS&&(U(u,Jt,"f").enhancedFocus=!0),l&Fs.EF_AUTO_ZOOM&&(U(u,Jt,"f").autoZoom=!0),l&Fs.EF_TAP_TO_FOCUS&&(U(u,Jt,"f").tapToFocus=!0,U(u,Pe,"f").enableTapToFocus())})()}disableEnhancedFeatures(l){l&Fs.EF_ENHANCED_FOCUS&&(U(this,Jt,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),l&Fs.EF_AUTO_ZOOM&&(U(this,Jt,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),l&Fs.EF_TAP_TO_FOCUS&&(U(this,Jt,"f").tapToFocus=!1,U(this,Pe,"f").disableTapToFocus()),U(this,yt,"m",dT).call(this)&&U(this,yt,"m",hT).call(this)||U(this,Or,"f").stopCharging()}_setScanRegion(l){if(null!=l&&!g_(l)&&!Jr(l))throw TypeError("Invalid 'region'.");Fe(this,Do,l?JSON.parse(JSON.stringify(l)):null,"f"),U(this,Be,"f")&&!U(this,Be,"f").disposed&&U(this,Be,"f").setScanRegion(l)}setScanRegion(l){this._setScanRegion(l),U(this,Be,"f")&&!U(this,Be,"f").disposed&&(null===l?U(this,Be,"f").setScanRegionMaskVisible(!1):U(this,Be,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(U(this,Do,"f")))}setErrorListener(l){if(!l)throw new TypeError("Invalid 'listener'");Fe(this,Bc,l,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!U(this,Pe,"f").isVideoLoaded()||U(this,yt,"m",Nt).call(this))}startFetching(){if(U(this,yt,"m",Nt).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");U(this,cs,"f")||(Fe(this,cs,!0,"f"),U(this,yt,"m",k_).call(this))}stopFetching(){U(this,cs,"f")&&(st._onLog&&st._onLog("DCE: stop fetching loop: "+Date.now()),U(this,Ei,"f")&&clearTimeout(U(this,Ei,"f")),Fe(this,cs,!1,"f"))}fetchImage(){if(U(this,yt,"m",Nt).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const l=this.getResolution();if(!(null==l?void 0:l.width)||!(null==l?void 0:l.height))throw new Error("The video is not loaded.");let u;if(u=ad.convert(U(this,Do,"f"),l.width,l.height),u||(u={x:0,y:0,width:l.width,height:l.height}),u.x>l.width||u.y>l.height)throw new Error("Invalid scan region.");u.x+u.width>l.width&&(u.width=l.width-u.x),u.y+u.height>l.height&&(u.height=l.height-u.y);const g={sx:u.x,sy:u.y,sWidth:u.width,sHeight:u.height,dWidth:u.width,dHeight:u.height},p=Math.max(g.dWidth,g.dHeight);if(this.canvasSizeLimit&&p>this.canvasSizeLimit){const b=this.canvasSizeLimit/p;g.dWidth>g.dHeight?(g.dWidth=this.canvasSizeLimit,g.dHeight=Math.round(g.dHeight*b)):(g.dWidth=Math.round(g.dWidth*b),g.dHeight=this.canvasSizeLimit)}const m=U(this,Pe,"f").getFrameData({position:g,pixelFormat:fT.get(this.getPixelFormat())});if(!m)return null;let v;v=m.pixelFormat===vt.GREY?m.width:4*m.width;let y=!0;return 0===g.sx&&0===g.sy&&g.sWidth===l.width&&g.sHeight===l.height&&(y=!1),{bytes:m.data,width:m.width,height:m.height,stride:v,format:gT.get(m.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Jh.ITT_VIDEO_FRAME,isCropped:y,cropRegion:{left:u.x,top:u.y,right:u.x+u.width,bottom:u.y+u.height,isMeasuredInPercentage:!1},originalWidth:l.width,originalHeight:l.height,currentWidth:m.width,currentHeight:m.height,timeSpent:m.timeSpent,timeStamp:m.timeStamp},toCanvas:U(this,Md,"f"),isDCEFrame:!0}}setImageFetchInterval(l){this.fetchInterval=l,U(this,cs,"f")&&(U(this,Ei,"f")&&clearTimeout(U(this,Ei,"f")),Fe(this,Ei,setTimeout(()=>{this.disposed||U(this,yt,"m",k_).call(this)},l),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(l){Fe(this,Od,l,"f")}getPixelFormat(){return U(this,Od,"f")}takePhoto(l){var u=this;if(!this.isOpen())throw new Error("Not open.");if(U(this,yt,"m",Nt).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),g.setAttribute("capture",""),g.style.position="absolute",g.style.top="-9999px",g.style.backgroundColor="transparent",g.style.color="transparent",g.addEventListener("click",()=>{const p=this.isOpen();this.close(),window.addEventListener("focus",()=>{p&&this.open(),g.remove()},{once:!0})}),g.addEventListener("change",re(function*(){const p=g.files[0],m=yield(L=re(function*(N){let k=null,j=null;if("undefined"!=typeof createImageBitmap)try{if(k=yield createImageBitmap(N),k)return k}catch(z){}var H;return k||(j=yield(H=N,new Promise((z,$)=>{let q=URL.createObjectURL(H),X=new Image;X.src=q,X.onload=()=>{URL.revokeObjectURL(X.src),z(X)},X.onerror=Q=>{$(new Error("Can't convert blob to image : "+(Q instanceof Event?Q.type:Q)))}}))),j}),function(N){return L.apply(this,arguments)})(p),v=m instanceof HTMLImageElement?m.naturalWidth:m.width,y=m instanceof HTMLImageElement?m.naturalHeight:m.height;var L;let b=ad.convert(U(u,Do,"f"),v,y);b||(b={x:0,y:0,width:v,height:y});const A=U(u,Rd,"f").call(u,m,v,y,b);l&&l(A)})),document.body.appendChild(g),g.click()}convertToPageCoordinates(l){const u=U(this,yt,"m",B_).call(this,l);return{x:u.pageX,y:u.pageY}}convertToClientCoordinates(l){const u=U(this,yt,"m",B_).call(this,l);return{x:u.clientX,y:u.clientY}}dispose(){this.close(),U(this,Pe,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let l in this)delete this[l];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}function Kn(f,l,u,g){if("a"===u&&!g)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof l?f!==l||!g:!l.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?g:"a"===u?g.call(f):g?g.value:l.get(f)}function ur(f,l,u,g,p){if("m"===g)throw new TypeError("Private method is not writable");if("a"===g&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof l?f!==l||!p:!l.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===g?p.call(f,u):p?p.value=u:l.set(f,u),u}F_=st,Pe=new WeakMap,Be=new WeakMap,kc=new WeakMap,ls=new WeakMap,bo=new WeakMap,Ad=new WeakMap,Rd=new WeakMap,Md=new WeakMap,Bc=new WeakMap,Do=new WeakMap,Od=new WeakMap,cs=new WeakMap,Ei=new WeakMap,Jt=new WeakMap,ke=new WeakMap,Or=new WeakMap,N_=new WeakMap,yt=new WeakSet,Nt=function(){return"disabled"!==this.singleFrameMode},hT=function(){return!this.videoSrc&&"opened"===U(this,Pe,"f").state},dT=function(){for(let f in U(this,Jt,"f"))if(1==U(this,Jt,"f")[f])return!0;return!1},k_=function f(){if(this.disposed)return;if("open"!==this.getCameraState()||!U(this,cs,"f"))return U(this,Ei,"f")&&clearTimeout(U(this,Ei,"f")),void Fe(this,Ei,setTimeout(()=>{this.disposed||U(this,yt,"m",f).call(this)},this.fetchInterval),"f");const l=()=>{var u;let g;st._onLog&&st._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{g=this.fetchImage()}catch(p){const m=p.message||p;if("The video is not loaded."===m)return;if(null===(u=U(this,Bc,"f"))||void 0===u?void 0:u.onErrorReceived)return void setTimeout(()=>{var v;null===(v=U(this,Bc,"f"))||void 0===v||v.onErrorReceived(t_.EC_IMAGE_READ_FAILED,m)},0);console.warn(p)}g?(this.addImageToBuffer(g),st._onLog&&st._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),U(this,ls,"f").fire("frameAddedToBuffer",null,{async:!1})):st._onLog&&st._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case go.BOPM_BLOCK:break;case go.BOPM_UPDATE:l()}else l();U(this,Ei,"f")&&clearTimeout(U(this,Ei,"f")),Fe(this,Ei,setTimeout(()=>{this.disposed||U(this,yt,"m",f).call(this)},this.fetchInterval),"f")},B_=function(f){if(!U(this,Be,"f"))throw new Error("Camera view is not set.");if(U(this,Be,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!U(this,yt,"m",Nt).call(this)&&!U(this,Pe,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(U(this,yt,"m",Nt).call(this)&&!U(this,Be,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const l=U(this,Be,"f")._innerComponent.getBoundingClientRect(),u=l.left,g=l.top,p=u+window.scrollX,m=g+window.scrollY,{width:v,height:y}=U(this,Be,"f")._innerComponent.getBoundingClientRect();if(v<=0||y<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let b,A,L;if(U(this,yt,"m",Nt).call(this)){const X=U(this,Be,"f")._innerComponent.getElement("content");b=X.width,A=X.height,L="contain"}else{const X=this.getVideoEl();b=X.videoWidth,A=X.videoHeight,L=U(this,Be,"f").getVideoFit()}const N=v/y,k=b/A;let j,H,z,$,q=1;if("contain"===L)N<k?(q=v/b,j=u+f.x*q,H=g+f.y*q+(y-A*q)/2,z=p+f.x*q,$=m+f.y*q+(y-A*q)/2):(q=y/A,j=u+f.x*q+(v-b*q)/2,H=g+f.y*q,z=p+f.x*q+(v-b*q)/2,$=m+f.y*q);else if("cover"===L)if(N<k){q=y/A;let X=f.x*q-(b*q-v)/2;X=Math.max(X,0),X=Math.min(X,v),j=u+X,H=g+f.y*q,z=p+X,$=m+f.y*q}else{q=v/b;let X=f.y*q-(A*q-y)/2;X=Math.max(X,0),X=Math.min(X,y),j=u+f.x*q,H=g+X,z=p+f.x*q,$=m+X}return{clientX:j,clientY:H,pageX:z,pageY:$}},st._debug=!1,P_={value:void 0},st.browserInfo=Fn,"function"==typeof SuppressedError&&SuppressedError;class bi{static multiply(l,u){const g=[];for(let p=0;p<3;p++){const m=u.slice(3*p,3*p+3);for(let v=0;v<3;v++){const y=[l[v],l[v+3],l[v+6]].reduce((b,A,L)=>b+A*m[L],0);g.push(y)}}return g}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(l,u,g){return bi.multiply(l,[1,0,0,0,1,0,u,g,1])}static rotate(l,u){var g=Math.cos(u),p=Math.sin(u);return bi.multiply(l,[g,-p,0,p,g,0,0,0,1])}static scale(l,u,g){return bi.multiply(l,[u,0,0,0,g,0,0,0,1])}}var Xt,hs,ds,Ld,Ga,Vc,jc,Ha,Fd,Gi,pT,G_,Hc,Wc;!function(f){f.GREY="grey",f.GREY32="grey32",f.RGBA="rgba",f.RBGA="rbga",f.GRBA="grba",f.GBRA="gbra",f.BRGA="brga",f.BGRA="bgra"}(Xt||(Xt={}));class Qe{static get version(){return"1.1.0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(ur(Qe,hs,!1,"f",ds),!1):(ur(Qe,hs,!0,"f",ds),!0)}get disposed(){return Kn(this,Fd,"f")}constructor(){Ld.set(this,Xt.RGBA),Ga.set(this,null),Vc.set(this,null),jc.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Ha.set(this,null),Fd.set(this,!1)}drawImage(l,u,g,p,m,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!g||!p)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Kn(Qe,hs,"f",ds)&&Qe.checkWebGLSupport(),(null==v?void 0:v.bUseWebGL)&&!Kn(Qe,hs,"f",ds))throw new Error("Your browser or machine may not support WebGL.");if(u instanceof HTMLVideoElement&&4!==u.readyState||u instanceof HTMLImageElement&&!u.complete)throw new Error("The source is not loaded.");let y;Qe._onLog&&(y=Date.now(),Qe._onLog("drawImage(), START: "+y));let b=0,A=0,L=g,N=p,k=0,j=0,H=g,z=p;m&&(m.sx&&(b=Math.round(m.sx)),m.sy&&(A=Math.round(m.sy)),m.sWidth&&(L=Math.round(m.sWidth)),m.sHeight&&(N=Math.round(m.sHeight)),m.dx&&(k=Math.round(m.dx)),m.dy&&(j=Math.round(m.dy)),m.dWidth&&(H=Math.round(m.dWidth)),m.dHeight&&(z=Math.round(m.dHeight)));let $,q=Xt.RGBA;if((null==v?void 0:v.pixelFormat)&&(q=v.pixelFormat),(null==v?void 0:v.bufferContainer)&&($=v.bufferContainer,$.length<4*H*z))throw new Error("Unexpected size of the 'bufferContainer'.");const X=l;if(!Kn(Qe,hs,"f",ds)||!(this.useWebGLByDefault&&null==(null==v?void 0:v.bUseWebGL)||(null==v?void 0:v.bUseWebGL))){Qe._onLog&&Qe._onLog("drawImage() in context2d."),X.ctx2d||(X.ctx2d=X.getContext("2d",{willReadFrequently:!0}));const Q=X.ctx2d;if(!Q)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(X.width<k+H||X.height<j+z)&&(X.width=k+H,X.height=j+z),Q.drawImage(u,b,A,L,N,k,j,H,z),Qe._onLog&&Qe._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:Q,pixelFormat:Xt.RGBA,bUseWebGL:!1}}Qe._onLog&&Qe._onLog("drawImage() in WebGL.");try{(X.width<k+H||X.height<j+z)&&(X.width=k+H,X.height=j+z,X.ctxWebGL&&X.ctxWebGL.viewport(0,0,k+H,j+z));const Q=X.ctxWebGL||X.getContext("webgl",{antialias:!1})||X.getContext("experimental-webgl",{antialias:!1});if(!Q){Qe._onLog&&Qe._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const P=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw P.name="WebGLError",P}if(!X.ctxWebGL||q!==Kn(this,Ld,"f")){X.ctxWebGL=Q;const P=_=>{const C=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,C),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW);const I=_.createBuffer();return _.bindBuffer(_.ARRAY_BUFFER,I),_.bufferData(_.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),_.STATIC_DRAW),{positions:C,texCoords:I}},Ee=_=>{const C=_.createTexture();return _.bindTexture(_.TEXTURE_2D,C),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),C},Ve=(_,C)=>{const I=_.createProgram();if(C.forEach(O=>_.attachShader(I,O)),_.linkProgram(I),!_.getProgramParameter(I,_.LINK_STATUS)){const O=new Error(`An error occured linking the program: ${_.getProgramInfoLog(I)}.`);throw O.name="WebGLError",O}return _.useProgram(I),I},nt=(_,C,I)=>{const O=_.createShader(C);if(_.shaderSource(O,I),_.compileShader(O),!_.getShaderParameter(O,_.COMPILE_STATUS)){const x=new Error(`An error occured compiling the shader: ${_.getShaderInfoLog(O)}.`);throw x.name="WebGLError",x}return O},S="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let w="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(q)&&(w=q.slice(0,3));const D=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${w} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,T=Ve(Q,[nt(Q,Q.VERTEX_SHADER,S),nt(Q,Q.FRAGMENT_SHADER,D)]);ur(this,Vc,{program:T,attribLocations:{vertexPosition:Q.getAttribLocation(T,"a_position"),texPosition:Q.getAttribLocation(T,"a_texCoord")},uniformLocations:{uSampler:Q.getUniformLocation(T,"u_image"),uColorFactor:Q.getUniformLocation(T,"uColorFactor"),uMatrix:Q.getUniformLocation(T,"u_matrix"),uTextureMatrix:Q.getUniformLocation(T,"u_textureMatrix")}},"f"),ur(this,jc,P(Q),"f"),ur(this,Ga,Ee(Q),"f"),ur(this,Ld,q,"f")}const pe=(P,Ee,Ve)=>{P.bindBuffer(P.ARRAY_BUFFER,Ee),P.enableVertexAttribArray(Ve),P.vertexAttribPointer(Ve,2,P.FLOAT,!1,0,0)},Te=(P,Ee,Ve,nt)=>{P.clearColor(0,0,0,1),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT),pe(P,Ve.positions,Ee.attribLocations.vertexPosition),pe(P,Ve.texCoords,Ee.attribLocations.texPosition),P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,nt),P.uniform1i(Ee.uniformLocations.uSampler,0),P.uniform1f(Ee.uniformLocations.uColorFactor,[Xt.GREY,Xt.GREY32].includes(q)?1:0);let S,w,D=bi.translate(bi.identity(),-1,-1);D=bi.scale(D,2,2),D=bi.scale(D,1/P.canvas.width,1/P.canvas.height),S=bi.translate(D,k,j),S=bi.scale(S,H,z),P.uniformMatrix3fv(Ee.uniformLocations.uMatrix,!1,S),w=bi.translate(bi.identity(),b/g,A/p),w=bi.scale(w,L/g,N/p),P.uniformMatrix3fv(Ee.uniformLocations.uTextureMatrix,!1,w),P.drawArrays(P.TRIANGLES,0,6)};((P,Ee,Ve)=>{const nt=P.RGBA,S=P.RGBA,w=P.UNSIGNED_BYTE;P.bindTexture(P.TEXTURE_2D,Ee),P.texImage2D(P.TEXTURE_2D,0,nt,S,w,Ve)})(Q,Kn(this,Ga,"f"),u),Te(Q,Kn(this,Vc,"f"),Kn(this,jc,"f"),Kn(this,Ga,"f"));const Re=$||new Uint8Array(4*H*z);if(Q.readPixels(k,j,H,z,Q.RGBA,Q.UNSIGNED_BYTE,Re),255!==Re[3]){Qe._onLog&&Qe._onLog("Incorrect WebGL drawing .");const P=new Error("WebGL error: incorrect drawing.");throw P.name="WebGLError",P}return Qe._onLog&&Qe._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:Q,pixelFormat:q===Xt.GREY?Xt.GREY32:q,bUseWebGL:!0}}catch(Q){if(this.forceLoseContext(),null==(null==v?void 0:v.bUseWebGL))return Qe._onLog&&Qe._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(l,u,g,p,m,Object.assign({},v,{bUseWebGL:!1}));throw Q.name="WebGLError",Q}}readCvsData(l,u,g){if(!(l instanceof CanvasRenderingContext2D||l instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let p,m=0,v=0,y=l.canvas.width,b=l.canvas.height;if(u&&(u.x&&(m=u.x),u.y&&(v=u.y),u.width&&(y=u.width),u.height&&(b=u.height)),(null==g?void 0:g.length)<4*y*b)throw new Error("Unexpected size of the 'bufferContainer'.");if(l instanceof WebGLRenderingContext){const A=l;g?(A.readPixels(m,v,y,b,A.RGBA,A.UNSIGNED_BYTE,g),p=new Uint8Array(g.buffer,0,4*y*b)):(p=new Uint8Array(4*y*b),A.readPixels(m,v,y,b,A.RGBA,A.UNSIGNED_BYTE,p))}else if(l instanceof CanvasRenderingContext2D){let A;A=l.getImageData(m,v,y,b),p=new Uint8Array(A.data.buffer),null==g||g.set(p)}return p}transformPixelFormat(l,u,g,p){let m,v;if(Qe._onLog&&(m=Date.now(),Qe._onLog("transformPixelFormat(), START: "+m)),u===g)return Qe._onLog&&Qe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),p?new Uint8Array(l):l;const y=[Xt.RGBA,Xt.RBGA,Xt.GRBA,Xt.GBRA,Xt.BRGA,Xt.BGRA];if(y.includes(u))if(g===Xt.GREY){v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=.21*l[b]+.71*l[b+1]+.07*l[b+2]}else if(g===Xt.GREY32){v=p?new Uint8Array(l):l;for(let b=0;b<l.length;b+=4){const A=.21*l[b]+.71*l[b+1]+.07*l[b+2];v[b]=A,v[b+1]=A,v[b+2]=A}}else{if(!y.includes(g))throw new Error("Unable to transform.");if(p){v=new Uint8Array(l);const b=u.indexOf("r"),A=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),k=g.indexOf("g"),j=g.indexOf("b");for(let H=0;H<l.length;H+=4)v[H+N]=l[H+b],v[H+k]=l[H+A],v[H+j]=l[H+L]}else{v=l;const b=u.indexOf("r"),A=u.indexOf("g"),L=u.indexOf("b"),N=g.indexOf("r"),k=g.indexOf("g"),j=g.indexOf("b");for(let H=0;H<l.length;H+=4){let z=[l[H],l[H+1],l[H+2]];v[H+N]=z[b],v[H+k]=z[A],v[H+j]=z[L]}}}else if(u===Xt.GREY){if(g!==Xt.GREY32)throw new Error("Unable to transform.");v=new Uint8Array(4*l.length);for(let b=0;b<l.length;b++)v[4*b]=l[b],v[4*b+1]=l[b],v[4*b+2]=l[b],v[4*b+3]=255}else{if(u!==Xt.GREY32)throw new Error("Unable to transform.");if(g!==Xt.GREY)throw new Error("Unable to transform.");v=new Uint8Array(l.length/4);for(let b=0;b<l.length;b+=4)v[b/4]=l[b]}return Qe._onLog&&Qe._onLog("transformPixelFormat() end. Costs: "+(Date.now()-m)),v}getImageData(l,u,g,p,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!u||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==Kn(Qe,hs,"f",ds)&&Qe.checkWebGLSupport(),(null==m?void 0:m.bUseWebGL)&&!Kn(Qe,hs,"f",ds))throw new Error("Your browser or machine may not support WebGL.");if(p.sx>u||p.sy>g||p.sx+p.sWidth>u||p.sy+p.sHeight>g)throw new Error("Invalid position.");if(l instanceof HTMLVideoElement&&4!==l.readyState||l instanceof HTMLImageElement&&!l.complete)throw new Error("The source is not loaded.");let v;Qe._onLog&&(v=Date.now(),Qe._onLog("getImageData(), START: "+v));const y=Math.round(p.sx),b=Math.round(p.sy),A=Math.round(p.sWidth),L=Math.round(p.sHeight),N=Math.round(p.dWidth),k=Math.round(p.dHeight);let j=Xt.RGBA;(null==m?void 0:m.pixelFormat)&&(j=m.pixelFormat);let H,z,$,q=null;if((null==m?void 0:m.bufferContainer)&&(q=m.bufferContainer),Kn(Qe,hs,"f",ds)&&(this.useWebGLByDefault&&null==(null==m?void 0:m.bUseWebGL)||(null==m?void 0:m.bUseWebGL))){Qe._onLog&&Qe._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs;try{if(q)if(j===Xt.GREY){if($=new Uint8Array(4*N*k),z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,z.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}}else z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:q}),$=new Uint8Array(q.buffer,0,4*N*k),$=this.transformPixelFormat($,z.pixelFormat,j);else j===Xt.GREY?((!Kn(this,Ha,"f")||Kn(this,Ha,"f").length<4*N*k)&&ur(this,Ha,new Uint8Array(4*N*k),"f"),$=new Uint8Array(Kn(this,Ha,"f").buffer,0,4*N*k)):$=new Uint8Array(4*N*k),z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:j,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,z.pixelFormat,j)}catch(X){if("WebGLError"===X.name&&(this.forceLoseContext(),null==(null==m?void 0:m.bUseWebGL)))return Qe._onLog&&Qe._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},Object.assign({},m,{bUseWebGL:!1}));throw X}}else if(Qe._onLog&&Qe._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs,z=this.drawImage(H,l,u,g,{sx:y,sy:b,sWidth:A,sHeight:L,dWidth:N,dHeight:k},{pixelFormat:Xt.RGBA,bUseWebGL:!1}),$=this.readCvsData(z.context,{width:N,height:k},null),$=this.transformPixelFormat($,z.pixelFormat,j),q){if(q.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");q.set($)}return Qe._onLog&&Qe._onLog("getImageData() end. Costs: "+(Date.now()-v)),{data:$,pixelFormat:j,width:N,height:k,bUseWebGL:z.bUseWebGL}}convertDataToCvs(l,u,g,p){if(!(l instanceof Uint8Array||l instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof u||u<=0)throw new Error("Invalid 'width'.");if("number"!=typeof g||g<=0)throw new Error("Invalid 'height'.");const m=document.createElement("canvas");let v;if(m.width=u,m.height=g,p===Xt.GREY){v=new Uint8ClampedArray(4*u*g);for(let b=0;b<v.length;b+=4)v[b]=l[b/4],v[b+1]=l[b/4],v[b+2]=l[b/4],v[b+3]=255}else v=new Uint8ClampedArray(l.buffer);const y=new ImageData(v,u,g);return m.getContext("2d").putImageData(y,0,0),m}forceLoseContext(){if(!this._reusedWebGLCvs)return;const l=this._reusedWebGLCvs.ctxWebGL;l&&!l.isContextLost()&&l.getExtension("WEBGL_lose_context")&&l.getExtension("WEBGL_lose_context").loseContext(),ur(this,Ga,null,"f"),ur(this,Vc,null,"f"),ur(this,jc,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),ur(this,Fd,!0,"f")}}hs=Qe,Ld=new WeakMap,Ga=new WeakMap,Vc=new WeakMap,jc=new WeakMap,Ha=new WeakMap,Fd=new WeakMap,ds={value:void 0};class za{static beep(){if(!this.beepSoundSource)return;let l;if(U(this,Gi,"f",Hc).size&&(l=U(this,Gi,"f",Hc).values().next().value,this.beepSoundSource==l.src?(U(this,Gi,"f",Hc).delete(l),l.play()):l=null),!l)if(U(this,Gi,"f",Wc).size<64){l=new Audio(this.beepSoundSource);let u=null,g=()=>{l.removeEventListener("loadedmetadata",g),l.play(),u=setTimeout(()=>{U(this,Gi,"f",Wc).delete(l)},2e3*l.duration)};l.addEventListener("loadedmetadata",g),l.addEventListener("ended",()=>{null!=u&&(clearTimeout(u),u=null),l.pause(),l.currentTime=0,U(this,Gi,"f",Wc).delete(l),U(this,Gi,"f",Hc).add(l)})}else U(this,Gi,"f",G_)||(Fe(this,Gi,!0,"f",G_),console.warn("The requested audio tracks exceed 64 and will not be played."));l&&U(this,Gi,"f",Wc).add(l)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(za.vibrateDuration)}}Gi=za,pT={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},G_={value:!1},Hc={value:new Set},Wc={value:new Set},za.beepSoundSource=U(za,Gi,"f",pT),za.vibrateDuration=300;const _T="undefined"==typeof self,H_=(()=>{if(!_T&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),vT=f=>{if(null==f&&(f="./"),!_T){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};null==Ae.dbr&&(Ae.dbr=H_),ji.dbr={js:!1,wasm:!0,deps:["license","dip"]},Qt.dbr={};"string"!=typeof Ae.std&&pi(Ae.std.version,"1.2.0")<0&&(Ae.std={version:"1.2.0",path:vT(H_+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const z_="2.2.10";var yT,CT,wT,ET;(!Ae.dip||"string"!=typeof Ae.dip&&pi(Ae.dip.version,z_)<0)&&(Ae.dip={version:z_,path:vT(H_+`../../dynamsoft-image-processing@${z_}/dist/`)}),"function"==typeof BigInt&&(BigInt(0),BigInt(0x10000000000000000),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552)),function(f){f[f.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",f[f.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",f[f.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(yT||(yT={})),function(f){f[f.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",f[f.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",f[f.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",f[f.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(CT||(CT={})),function(f){f[f.LM_AUTO=1]="LM_AUTO",f[f.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",f[f.LM_STATISTICS=4]="LM_STATISTICS",f[f.LM_LINES=8]="LM_LINES",f[f.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",f[f.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",f[f.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",f[f.LM_CENTRE=128]="LM_CENTRE",f[f.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",f[f.LM_REV=-2147483648]="LM_REV",f[f.LM_SKIP=0]="LM_SKIP"}(wT||(wT={})),function(f){f[f.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",f[f.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",f[f.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",f[f.DM_SMOOTHING=8]="DM_SMOOTHING",f[f.DM_MORPHING=16]="DM_MORPHING",f[f.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",f[f.DM_SHARPENING=64]="DM_SHARPENING",f[f.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",f[f.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",f[f.DM_REV=-2147483648]="DM_REV",f[f.DM_SKIP=0]="DM_SKIP"}(ET||(ET={}));const DT="undefined"==typeof self,Y_=(()=>{if(!DT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),ST=f=>{if(null==f&&(f="./"),!DT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};null==Ae.utility&&(Ae.utility=Y_),ji.utility={js:!0,wasm:!0};const $_="1.2.10";"string"!=typeof Ae.std&&pi(Ae.std.version,$_)<0&&(Ae.std={version:$_,path:ST(Y_+`../../dynamsoft-capture-vision-std@${$_}/dist/`)});const X_="2.2.30";(!Ae.dip||"string"!=typeof Ae.dip&&pi(Ae.dip.version,X_)<0)&&(Ae.dip={version:X_,path:ST(Y_+`../../dynamsoft-image-processing@${X_}/dist/`)});let Hs="./";if(document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}Hs=f.substring(0,f.lastIndexOf("/")+1)}const So=f=>{null==f&&(f="./");let l=document.createElement("a");return l.href=f,(f=l.href).endsWith("/")||(f+="/"),f};Ft.engineResourcePaths={std:So(Hs+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:So(Hs+"../../dynamsoft-image-processing@2.2.30/dist/"),core:So(Hs+"../../dynamsoft-core@3.2.30/dist/"),license:So(Hs+"../../dynamsoft-license@3.2.21/dist/"),cvr:So(Hs+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:So(Hs+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:So(Hs+"../../dynamsoft-barcode-reader@10.2.10/dist/")};const IT="undefined"==typeof self,K_=(()=>{if(!IT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),TT=f=>{if(null==f&&(f="./"),!IT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f},Q_=f=>{const l=document.createElement("canvas");return l.width=f.width,l.height=f.height,l.getContext("2d",{willReadFrequently:!0}).putImageData(f,0,0),l},xT=function(){var f=re(function*(l,u){const g=Q_(u);return new Promise((p,m)=>{g.toBlob(v=>p(v),l)})});return function(u,g){return f.apply(this,arguments)}}();null==Ae.ddn&&(Ae.ddn=K_),ji.ddn={js:!0,wasm:!0,deps:["license","dip"]},Qt.ddn={handleNormalizedImageResultItem:function(f){let l=f,u=(g=>{let p,m=g.bytes;if(!(m&&m instanceof Uint8Array))throw Error("Parameter type error");if(Number(g.format)===Ge.IPF_BGR_888){const v=m.length/3;p=new Uint8ClampedArray(4*v);for(let y=0;y<v;++y)p[4*y]=m[3*y],p[4*y+1]=m[3*y+1],p[4*y+2]=m[3*y+2],p[4*y+3]=255}else if(Number(g.format)===Ge.IPF_RGB_888){const v=m.length/3;p=new Uint8ClampedArray(4*v);for(let y=0;y<v;++y)p[4*y]=m[3*y+2],p[4*y+1]=m[3*y+1],p[4*y+2]=m[3*y],p[4*y+3]=255}else if(Number(g.format)===Ge.IPF_GRAYSCALED){const v=m.length;p=new Uint8ClampedArray(4*v);for(let y=0;y<v;y++)p[4*y]=p[4*y+1]=p[4*y+2]=m[y],p[4*y+3]=255}else if(Number(g.format)===Ge.IPF_BINARY_8){const v=m.length,y=g.width,A=g.stride;p=new Uint8ClampedArray(y*g.height*4);for(let L=0;L<v;L++){let N=m[L],k=L%A,j=Math.floor(L/A);for(let H=0;H<8;H++){let z=k+H,$=4*(j*y+z);if(z>=y)break;p[$]=p[$+1]=p[$+2]=(128&N)/128*255,p[$+3]=255,N<<=1}}}else if(Number(g.format)===Ge.IPF_ABGR_8888){const v=m.length/4;p=new Uint8ClampedArray(m.length);for(let y=0;y<v;++y)p[4*y]=m[4*y],p[4*y+1]=m[4*y+1],p[4*y+2]=m[4*y+2],p[4*y+3]=m[4*y+3]}else if(Number(g.format)===Ge.IPF_ARGB_8888){const v=m.length/4;p=new Uint8ClampedArray(m.length);for(let y=0;y<v;++y)p[4*y]=m[4*y],p[4*y+1]=m[4*y+1],p[4*y+2]=m[4*y+2],p[4*y+3]=m[4*y+3]}return new ImageData(p,g.width,g.height)})(l.imageData);l.toCanvas=()=>Q_(u),l.toImage=g=>((p,m)=>{const v=Q_(m);let y=new Image,b=v.toDataURL(p);return y.src=b,y})(g,u),l.toBlob=g=>xT(g,u),l.saveToFile=function(){var g=re(function*(p,m){if(!p)return null;if("string"!=typeof p)throw new TypeError("FileName must be of type string.");return(v=re(function*(y,b,A){return yield new Promise(function(){var L=re(function*(N,k){try{const j=b.split(".");let H=j[j.length-1];const z=yield xT(`image/${H}`,y);j.length<=1&&(H="png");const $=new File([z],b,{type:`image/${H}`});if(A){const q=URL.createObjectURL($),X=document.createElement("a");X.href=q,X.download=b,X.click()}return N($)}catch(j){return k()}});return function(N,k){return L.apply(this,arguments)}}())}),function(y,b,A){return v.apply(this,arguments)})(u,p,m);var v});return function(p,m){return g.apply(this,arguments)}}()}};"string"!=typeof Ae.std&&pi(Ae.std.version,"1.2.0")<0&&(Ae.std={version:"1.2.0",path:TT(K_+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});const ev="2.2.10";var Lr;(!Ae.dip||"string"!=typeof Ae.dip&&pi(Ae.dip.version,ev)<0)&&(Ae.dip={version:ev,path:TT(K_+`../../dynamsoft-image-processing@${ev}/dist/`)}),function(f){f[f.ICM_COLOUR=0]="ICM_COLOUR",f[f.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",f[f.ICM_BINARY=2]="ICM_BINARY"}(Lr||(Lr={}));const AT="undefined"==typeof self,zc=(()=>{if(!AT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})(),Yc=f=>{if(null==f&&(f="./"),!AT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f};null==Ae.dlr&&(Ae.dlr=zc),null==Ae.dlrData&&(Ae.dlrData=Yc(zc+"../../dynamsoft-label-recognizer-data@1.0.11/dist/")),ji.dlr={js:!0,wasm:!0,deps:["license","dip","dnn"]},ji.dnn={wasm:!0};const tv="1.2.10";"string"!=typeof Ae.std&&pi(Ae.std.version,tv)<0&&(Ae.std={version:tv,path:Yc(zc+`../../dynamsoft-capture-vision-std@${tv}/dist/`)});const nv="2.2.30";(!Ae.dip||"string"!=typeof Ae.dip&&pi(Ae.dip.version,nv)<0)&&(Ae.dip={version:nv,path:Yc(zc+`../../dynamsoft-image-processing@${nv}/dist/`)});const iv="1.0.20";(!Ae.dnn||"string"!=typeof Ae.dnn&&pi(Ae.dnn.version,iv)<0)&&(Ae.dnn={version:iv,path:Yc(zc+`../../dynamsoft-capture-vision-dnn@${iv}/dist/`)});let RT=!1;class Vd{static getVersion(){return`3.2.30(Worker: ${qn.dlr&&qn.dlr.worker||"Not Loaded"}, Wasm: ${qn.dlr&&qn.dlr.wasm||"Not Loaded"})`}static loadRecognitionData(l,u){return re(function*(){return yield mi("dlr"),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var y=re(function*(b){if(b.success){const A=b.result;if(0!==A.exception){let L=new Error(A.description);return L.errorCode=A.exception,p(L)}return A.bModel||(RT=!0),g(A)}{let A=new Error(b.message);return A.stack=b.stack+"\n"+A.stack,p(A)}});return function(b){return y.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),u||"ConfusableChars"!==l||(u=Ft.engineResourcePaths.dlr);let v=Ft.engineResourcePaths.dlrData;Ft.engineResourcePaths.rootDirectory&&(v.startsWith("http://")||v.startsWith("https://")||(v=Ft.engineResourcePaths.rootDirectory+"/"+v)),Ft.engineResourcePaths.dlrData=Yc(v),Ze.postMessage({type:"dlr_loadData",id:m,body:{dataName:l,dataPath:u||Ft.engineResourcePaths.dlrData}})})})()}}var jd,Ud;function MT(f){delete f.moduleId;const l=JSON.parse(f.jsonString).ResultInfo,u=f.fullCodeString;f.getFieldValue=g=>"fullcodestring"===g.toLowerCase()?u:OT(l,g),f.getFieldMappingStatus=g=>LT(l,g),f.getFieldValidationStatus=g=>FT(l,g),delete f.fullCodeString}function OT(f,l){for(let u of f){if(u.FieldName===l)return u.Value;if(u.ChildFields&&u.ChildFields.length>0){let g;for(let p of u.ChildFields)g=OT(p,l);if(null!==g)return g}}return null}function LT(f,l){for(let u of f){if(u.FieldName===l)return u.MappingStatus?Number(jd[u.MappingStatus]):jd.MS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let g;for(let p of u.ChildFields)g=LT(p,l);if(null!==g)return g}}return null}function FT(f,l){for(let u of f){if(u.FieldName===l&&u.ValidationStatus)return u.ValidationStatus?Number(Ud[u.ValidationStatus]):Ud.VS_NONE;if(u.ChildFields&&u.ChildFields.length>0){let g;for(let p of u.ChildFields)g=FT(p,l);if(null!==g)return g}}return null}function Gd(f){if(f.disposed)throw new Error('"CodeParser" instance has been disposed')}Qt.dlr={filterVINResult:function(f){let l="";if(18===f.characterResults.length){let u=f.characterResults[9].location.points[0].x-f.characterResults[8].location.points[1].x;u<2&&(u=2);let g=f.characterResults[1].location.points[0].x-f.characterResults[0].location.points[1].x,p=f.characterResults[17].location.points[0].x-f.characterResults[16].location.points[1].x,m=2===u?3:u;g-u>=m&&p-u<m?f.characterResults.shift():p-u>=m&&g-u<m||f.characterResults[0].characterHConfidence>f.characterResults[17].characterHConfidence?f.characterResults.pop():f.characterResults.shift()}else if(19===f.characterResults.length){let u=f.characterResults[10].location.points[0].x-f.characterResults[9].location.points[1].x;u<2&&(u=2);let g,p,m,v=f.characterResults[1].location.points[0].x-f.characterResults[0].location.points[1].x,y=f.characterResults[18].location.points[0].x-f.characterResults[17].location.points[1].x,b=f.characterResults[2].location.points[0].x-f.characterResults[1].location.points[1].x,A=f.characterResults[17].location.points[0].x-f.characterResults[16].location.points[1].x,L=2===u?3:u;if("1"===f.characterResults[1].characterH||"1"===f.characterResults[2].characterH||"1"===f.characterResults[16].characterH||"1"===f.characterResults[17].characterH){for(let N=9;N<f.characterResults.length;N++)if("1"!==f.characterResults[N].characterH){m=f.characterResults[N].location.points[1].x-f.characterResults[N].location.points[0].x;break}"1"===f.characterResults[1].characterH&&(g=m-(f.characterResults[1].location.points[1].x-f.characterResults[1].location.points[0].x)+3),"1"===f.characterResults[2].characterH&&(g=m-(f.characterResults[2].location.points[1].x-f.characterResults[2].location.points[0].x)+3),"1"===f.characterResults[16].characterH&&(p=m-(f.characterResults[16].location.points[1].x-f.characterResults[16].location.points[0].x)+3),"1"===f.characterResults[17].characterH&&(p=m-(f.characterResults[17].location.points[1].x-f.characterResults[17].location.points[0].x)+3)}if(b-u>=(g||L)&&A-u<(p||L))f.characterResults.splice(0,2);else if(A-u>=(p||L)&&b-u<(g||L))f.characterResults.splice(17,2);else if(v>u&&y>u)f.characterResults.pop(),f.characterResults.shift();else{let N=f.characterResults[0].characterHConfidence+f.characterResults[1].characterHConfidence,k=f.characterResults[17].characterHConfidence+f.characterResults[18].characterHConfidence,j=f.characterResults[0].characterHConfidence+f.characterResults[18].characterHConfidence,H=Math.min(N,k,j);H===N?f.characterResults.splice(0,2):H===k?f.characterResults.splice(17,2):H===j&&(f.characterResults.pop(),f.characterResults.shift())}}for(let u of f.characterResults)l+=u.characterH;return l},loadRecognitionData:Vd.loadRecognitionData,get bLoadConfusableCharsData(){return RT}},it[-1]=function(){var f=re(function*(l){Vd.onDataLoadProgressChanged&&Vd.onDataLoadProgressChanged(l.resourcesPath,l.tag,{loaded:l.loaded,total:l.total})});return function(l){return f.apply(this,arguments)}}(),function(f){f[f.MS_NONE=0]="MS_NONE",f[f.MS_SUCCEEDED=1]="MS_SUCCEEDED",f[f.MS_FAILED=2]="MS_FAILED"}(jd||(jd={})),function(f){f[f.VS_NONE=0]="VS_NONE",f[f.VS_SUCCEEDED=1]="VS_SUCCEEDED",f[f.VS_FAILED=2]="VS_FAILED"}(Ud||(Ud={}));const PT=f=>f&&"object"==typeof f&&"function"==typeof f.then;class oU extends Promise{constructor(l){let u,g;super((p,m)=>{u=p,g=m}),this._s="pending",this.resolve=p=>{this.isPending&&(PT(p)?this.task=p:(this._s="fulfilled",u(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",g(p))},this.task=l}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(l){var u=this;let g;this._task=l,PT(l)?g=l:"function"==typeof l&&(g=new Promise(l)),g&&re(function*(){try{const p=yield g;l===u._task&&u.resolve(p)}catch(p){l===u._task&&u.reject(p)}})()}get isEmpty(){return null==this._task}}class rv{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static createInstance(){return re(function*(){if(!Qt.license)throw Error("Module `license` is not existed.");yield Qt.license.dynamsoft(),yield mi("dcp");const l=new rv,u=new oU;let g=Et();return it[g]=function(){var p=re(function*(m){if(m.success)l._instanceID=m.instanceID,u.resolve(l);else{const v=Error(m.message);m.stack&&(v.stack=m.stack),u.reject(v)}});return function(m){return p.apply(this,arguments)}}(),Ze.postMessage({type:"dcp_createInstance",id:g}),u})()}dispose(){var l=this;return re(function*(){Gd(l);let u=Et();l.bDestroyed=!0,it[u]=g=>{if(!g.success){let p=new Error(g.message);throw p.stack=g.stack+"\n"+p.stack,p}},Ze.postMessage({type:"dcp_dispose",id:u,instanceID:l._instanceID})})()}get disposed(){return this.bDestroyed}initSettings(l){var u=this;return re(function*(){return Gd(u),l&&["string","object"].includes(typeof l)?("string"==typeof l&&function Mj(f){return/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(f)}(l)&&(l=yield Km(l,"text")),"object"==typeof l&&(l=JSON.stringify(l)),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var v=re(function*(y){if(y.success){const b=JSON.parse(y.response);if(0!==b.exception){let A=new Error(b.description?b.description:"Init Settings Failed.");return A.errorCode=b.exception,p(A)}return g(b)}{let b=new Error(y.message);return b.stack=y.stack+"\n"+b.stack,p(b)}});return function(y){return v.apply(this,arguments)}}(),Ze.postMessage({type:"dcp_initSettings",id:m,instanceID:u._instanceID,body:{settings:l}})})):console.error("Invalid settings.")})()}resetSettings(){var l=this;return re(function*(){return Gd(l),yield new Promise((u,g)=>{let p=Et();it[p]=function(){var m=re(function*(v){if(v.success)return u();{let y=new Error(v.message);return y.stack=v.stack+"\n"+y.stack,g(y)}});return function(v){return m.apply(this,arguments)}}(),Ze.postMessage({type:"dcp_resetSettings",id:p,instanceID:l._instanceID})})})()}parse(l,u=""){var g=this;return re(function*(){if(Gd(g),!l||!(l instanceof Array||l instanceof Uint8Array||"string"==typeof l))throw new Error("`parse` must pass in an Array or Uint8Array or string");return yield new Promise((p,m)=>{let v=Et();l instanceof Array&&(l=Uint8Array.from(l)),"string"==typeof l&&(l=Uint8Array.from(function(y){let b=[];for(let A=0;A<y.length;++A)b.push(y.charCodeAt(A));return b}(l))),it[v]=function(){var y=re(function*(b){if(b.success){let A=JSON.parse(b.parseResponse);return A.exception?m(new Error(A.description)):(MT(A),p(A))}{let A=new Error(b.message);return A.stack=b.stack+"\n"+A.stack,m(A)}});return function(b){return y.apply(this,arguments)}}(),Ze.postMessage({type:"dcp_parse",id:v,instanceID:g._instanceID,body:{source:l,taskSettingName:u}})})})()}}const NT="undefined"==typeof self,kT=(()=>{if(!NT&&document.currentScript){let f=document.currentScript.src,l=f.indexOf("?");if(-1!=l)f=f.substring(0,l);else{let u=f.indexOf("#");-1!=u&&(f=f.substring(0,u))}return f.substring(0,f.lastIndexOf("/")+1)}return"./"})();null==Ae.dcp&&(Ae.dcp=kT),ji.dcp={js:!0,wasm:!0,deps:["license"]},Qt.dcp={handleParsedResultItem:MT};"string"!=typeof Ae.std&&pi(Ae.std.version,"1.2.0")<0&&(Ae.std={version:"1.2.0",path:(f=>{if(null==f&&(f="./"),!NT){let l=document.createElement("a");l.href=f,f=l.href}return f.endsWith("/")||(f+="/"),f})(kT+"../../dynamsoft-capture-vision-std@1.2.0/dist/")});class $a{static getVersion(){return`2.2.10(Worker: ${qn.dcp&&qn.dcp.worker||"Not Loaded"}, Wasm: ${qn.dcp&&qn.dcp.wasm||"Not Loaded"})`}static loadSpec(l,u){return re(function*(){return yield mi("dcp"),yield new Promise((g,p)=>{let m=Et();it[m]=function(){var y=re(function*(b){if(b.success)return g();{let A=new Error(b.message);return A.stack=b.stack+"\n"+A.stack,p(A)}});return function(b){return y.apply(this,arguments)}}(),u&&!u.endsWith("/")&&(u+="/"),Ze.postMessage({type:"dcp_appendResourceBuffer",id:m,body:{specificationPath:u||Ft.engineResourcePaths.dcp+"specification/",specificationNames:l instanceof Array?l:[l]}})})})()}}let lU=(()=>{class f{constructor(){this.showDiv=!1}getShowDiv(){return this.showDiv}setShowDiv(u){this.showDiv=u}toggleShowDiv(){this.showDiv=!this.showDiv}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275prov=Ct({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();const cU=function(){return["/barcode-reader"]};function uU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,cU)),un(1),Dr("> ",u.name," ")}}const hU=function(){return["/barcode-scanner"]};function dU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,hU)),un(1),Dr("> ",u.name," ")}}const fU=function(){return["/file-detection"]};function gU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,fU)),un(1),Dr("> ",u.name," ")}}const pU=function(){return["/camera-detection"]};function mU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,pU)),un(1),Dr("> ",u.name," ")}}const _U=function(){return["/mrz-reader"]};function vU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,_U)),un(1),Dr("> ",u.name," ")}}const yU=function(){return["/mrz-scanner"]};function CU(f,l){if(1&f&&(He(0,"a",6),Lt(1),Ue()),2&f){const u=Hr().$implicit;Zt("title",u.name+" details")("routerLink",Ds(3,yU)),un(1),Dr("> ",u.name," ")}}function wU(f,l){if(1&f&&(He(0,"p"),Lt(1),Ue()),2&f){const u=Hr().$implicit;un(1),Dr("Description: ",u.description,"")}}function EU(f,l){if(1&f&&(He(0,"div")(1,"h3")(2,"div"),Ji(3,uU,2,4,"ng-template",5),Ue(),He(4,"div"),Ji(5,dU,2,4,"ng-template",5),Ue(),He(6,"div"),Ji(7,gU,2,4,"ng-template",5),Ue(),He(8,"div"),Ji(9,mU,2,4,"ng-template",5),Ue(),He(10,"div"),Ji(11,vU,2,4,"ng-template",5),Ue(),He(12,"div"),Ji(13,CU,2,4,"ng-template",5),Ue()(),Ji(14,wU,2,1,"p",3),Ue()),2&f){const u=l.$implicit;un(3),Zt("ngIf","reader"===u.id),un(2),Zt("ngIf","scanner"===u.id),un(2),Zt("ngIf","file-detection"===u.id),un(2),Zt("ngIf","camera-detection"===u.id),un(2),Zt("ngIf","mrz-reader"===u.id),un(2),Zt("ngIf","mrz-scanner"===u.id),un(1),Zt("ngIf",u.description)}}function bU(f,l){if(1&f&&(He(0,"div")(1,"h2"),Lt(2,"Examples"),Ue(),Ji(3,EU,15,7,"div",4),Ue()),2&f){const u=Hr();un(3),Zt("ngForOf",u.products)}}let DU=(()=>{class f{constructor(u){this.sharedService=u,this.products=Sj,this.inputText="",this.processedText="",this.placeholderText="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTcGR6Vm05WDJrcEQ5YUoifQ=="}activate(){var u=this;return re(function*(){u.processedText=u.inputText.toUpperCase(),Ft.engineResourcePaths={std:"/assets/dynamsoft-capture-vision-std/",dip:"/assets/dynamsoft-image-processing/",core:"/assets/dynamsoft-core/",license:"/assets/dynamsoft-license/",cvr:"/assets/dynamsoft-capture-vision-router/",dbr:"/assets/dynamsoft-barcode-reader/",dce:"/assets/dynamsoft-camera-enhancer/",ddn:"/assets/dynamsoft-document-normalizer/",dlr:"/assets/dynamsoft-label-recognizer/",dcp:"/assets/dynamsoft-code-parser/",dnn:"/assets/dynamsoft-capture-vision-dnn/",dlrData:"/assets/dynamsoft-label-recognizer-data"};try{let g=""===u.inputText?u.placeholderText:u.inputText;yield jt.initLicense(g,!0),u.toggleDivVisibility()}catch(g){throw g}})()}toggleDivVisibility(){this.sharedService.toggleShowDiv()}get showDiv(){return this.sharedService.getShowDiv()}}return f.\u0275fac=function(u){return new(u||f)(ye(lU))},f.\u0275cmp=Si({type:f,selectors:[["app-product-list"]],decls:9,vars:3,consts:[["href","https://www.dynamsoft.com/customer/license/trialLicense","target","_blank"],["type","text",3,"ngModel","placeholder","ngModelChange"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngIf"],[3,"title","routerLink"]],template:function(u,g){1&u&&(He(0,"div")(1,"div"),Lt(2," Get a License key from "),He(3,"a",0),Lt(4,"here"),Ue()(),He(5,"input",1),Tt("ngModelChange",function(m){return g.inputText=m}),Ue(),He(6,"button",2),Tt("click",function(){return g.activate()}),Lt(7,"Activate SDK"),Ue()(),Ji(8,bU,4,1,"div",3)),2&u&&(un(5),Zt("ngModel",g.inputText)("placeholder",g.placeholderText),un(3),Zt("ngIf",g.showDiv))},directives:[wh,wD,Cm,Yp,xb,hc],styles:[""]}),f})();class $c{initOverlay(l){this.overlay=l,this.context=this.overlay.getContext("2d")}updateOverlay(l,u){this.overlay&&(this.overlay.width=l,this.overlay.height=u,this.clearOverlay())}clearOverlay(){this.context&&this.overlay&&(this.context.clearRect(0,0,this.overlay.width,this.overlay.height),this.context.strokeStyle="#ff0000",this.context.lineWidth=5)}drawOverlay(l,u){if(this.context){let g=l.points;this.globalPoints=g,this.context.beginPath(),this.context.moveTo(g[0].x,g[0].y),this.context.lineTo(g[1].x,g[1].y),this.context.lineTo(g[2].x,g[2].y),this.context.lineTo(g[3].x,g[3].y),this.context.lineTo(g[0].x,g[0].y),this.context.stroke(),this.context.font="18px Verdana",this.context.fillStyle="#ff0000";let p=[g[0].x,g[1].x,g[2].x,g[3].x],m=[g[0].y,g[1].y,g[2].y,g[3].y];p.sort(function(b,A){return b-A}),m.sort(function(b,A){return A-b}),this.context.fillText(u,p[0],m[0]+50)}}setPoints(l){this.globalPoints=l,this.overlay.addEventListener("mousedown",u=>this.updatePoint(u,this.context,this.overlay)),this.overlay.addEventListener("touchstart",u=>this.updatePoint(u,this.context,this.overlay)),this.drawQuad(this.context,this.overlay)}updatePoint(l,u,g){if(!this.globalPoints)return;let p=this.globalPoints;function m(A){let L=g.getBoundingClientRect(),N=g.clientWidth/g.width,k=g.clientHeight/g.height,j=A instanceof MouseEvent?A.clientX:A.touches[0].clientX,H=A instanceof MouseEvent?A.clientY:A.touches[0].clientY;return N<k?(j-=L.left,H=H-L.top-(g.clientHeight-g.height*N)/2,j/=N,H/=N):(j=j-L.left-(g.clientWidth-g.width*k)/2,H-=L.top,j/=k,H/=k),{x:Math.round(j),y:Math.round(H)}}let y=m(l),b=this;for(let A=0;A<p.length;A++)if(Math.abs(p[A].x-y.x)<10&&Math.abs(p[A].y-y.y)<10){let L=function(k){y=m(k),p[A].x=y.x,p[A].y=y.y,b.drawQuad(u,g)},N=function(){g.removeEventListener("mousemove",L),g.removeEventListener("mouseup",N),g.removeEventListener("touchmove",L),g.removeEventListener("touchend",N)};g.addEventListener("mousemove",L),g.addEventListener("mouseup",N),g.addEventListener("touchmove",L),g.addEventListener("touchend",N);break}}drawQuad(l,u){let g=this.globalPoints;if(g&&!(g.length<4)){l.clearRect(0,0,u.width,u.height),l.strokeStyle="#00ff00",l.lineWidth=2;for(let p=0;p<g.length;p++)l.beginPath(),l.arc(g[p].x,g[p].y,5,0,2*Math.PI),l.stroke();l.beginPath(),l.moveTo(g[0].x,g[0].y),l.lineTo(g[1].x,g[1].y),l.lineTo(g[2].x,g[2].y),l.lineTo(g[3].x,g[3].y),l.lineTo(g[0].x,g[0].y),l.stroke()}}}let SU=(()=>{class f{constructor(){this.isLoaded=!1,this.overlayManager=new $c}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),re(function*(){u.cvr=yield bt.createInstance(),u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(g){}}onChange(u){let p=u.currentTarget.files;if(p){let m=p.item(0);if(m){let v=new FileReader;v.onload=y=>{let b=document.getElementById("image");if(b){b.src=y.target.result;const A=new Image;A.onload=L=>{this.overlayManager.updateOverlay(A.width,A.height),this.cvr&&this.cvr.capture(m,"ReadBarcodes_Balance").then(N=>{console.log(N);let k=[],j=document.getElementById("result");try{let z,$=N.items;if($.length>0){for(var H=0;H<$.length;++H){if($[H].type!==Yt.CRIT_BARCODE)continue;let q=$[H];k.push(q.text),z=q.location,console.log(z),this.overlayManager.drawOverlay(z,q.text)}j&&(j.innerHTML=k.join(", "))}else j&&(j.innerHTML=k.join(", "))}catch(z){alert(z)}})},A.src=y.target.result}},v.readAsDataURL(m)}}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-barcode-reader"]],decls:6,vars:0,consts:[["type","file","id","file","accept","image/*",3,"change"],["id","result"],["id","imageview"],["id","image"],["id","overlay"]],template:function(u,g){1&u&&(He(0,"input",0),Tt("change",function(m){return g.onChange(m)}),Ue(),He(1,"div"),Mn(2,"a",1),Ue(),He(3,"div",2),Mn(4,"img",3)(5,"canvas",4),Ue())},styles:["#imageview[_ngcontent-%COMP%]{position:absolute;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}"]}),f})(),IU=(()=>{class f{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isDestroyed=!1,this.overlayManager=new $c}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),re(function*(){yield u.initBarcodeScanner()})()}ngOnDestroy(){var u,g;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(g=this.cameraEnhancer)||void 0===g||g.dispose()}catch(p){}}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}initBarcodeScanner(){var u=this;return re(function*(){var g,p,m,v;const y=yield ln.createInstance();u.cameraEnhancer=yield st.createInstance(y),u.isLoaded=!0;let b=document.getElementById("videoContainer");if(b){b.append(y.getUIElement()),null===(p=null===(g=y.getUIElement().shadowRoot)||void 0===g?void 0:g.querySelector(".dce-sel-camera"))||void 0===p||p.setAttribute("style","display: none"),null===(v=null===(m=y.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let A=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(A),u.cvr=yield bt.createInstance(),u.isDestroyed||(u.cvr.setInput(u.cameraEnhancer),u.cvr.addResultReceiver({onCapturedResultReceived:L=>{u.overlayManager.clearOverlay();let N=[],k=document.getElementById("result");try{let H,z=L.items;if(z.length>0){for(var j=0;j<z.length;++j){if(z[j].type!==Yt.CRIT_BARCODE)continue;let $=z[j];N.push($.text),H=$.location,console.log(H),u.overlayManager.drawOverlay(H,$.text)}k&&(k.innerHTML=N.join(", "))}else k&&(k.innerHTML=N.join(", "))}catch(H){alert(H)}}}),u.cvr.addResultReceiver({onDecodedBarcodesReceived:L=>{!L.barcodeResultItems.length||console.log(L)}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed)||(yield u.cvr.startCapturing("ReadSingleBarcode"),u.isDestroyed))throw Error("VideoCapture Component Destroyed")}})()}openCamera(){var u=this;return re(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let g=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(g),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var g=0;g<u.length;++g){var p=u[g],m=document.createElement("option");m.value=p.deviceId,m.text=p.label,this.cameraInfo[p.deviceId]=p,this.videoSelect&&this.videoSelect.appendChild(m)}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-barcode-scanner"]],decls:7,vars:0,consts:[[1,"select"],["for","videoSource"],["id","videoSource",3,"change"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"]],template:function(u,g){1&u&&(He(0,"div",0)(1,"label",1),Lt(2,"Video source: "),Ue(),He(3,"select",2),Tt("change",function(){return g.openCamera()}),Ue()(),He(4,"div",3),Mn(5,"div",4)(6,"canvas",5),Ue())},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}"]}),f})(),TU=(()=>{class f{constructor(){this.isLoaded=!1,this.points=[],this.overlayManager=new $c}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(g){}}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),re(function*(){u.cvr=yield bt.createInstance(),u.isLoaded=!0})()}onRadioChange(u){var g=this;if(!this.cvr)return;let p=u.target,m=Lr.ICM_COLOUR;"binary"===p.value?m=Lr.ICM_BINARY:"grayscale"===p.value?m=Lr.ICM_GRAYSCALE:"color"===p.value&&(m=Lr.ICM_COLOUR);let v=this.cvr;re(function*(){let y=yield v.getSimplifiedSettings("NormalizeDocument_Default");y.documentSettings.colourMode=m,yield g.cvr.updateSettings("NormalizeDocument_Default",y),g.normalize(g.currentFile,g.points)})()}normalize(u,g){var p=this;return re(function*(){if(p.cvr){let m=yield p.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=g,m.roiMeasuredInPercentage=!1,yield p.cvr.updateSettings("NormalizeDocument_Default",m),p.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let y=v.items[0];document.getElementById("normalizedImage").src=y.toImage("image/jpeg").src})}})()}onChange(u){var g=this;let m=u.currentTarget.files;if(m){let v=m.item(0);if(v){this.currentFile=v;let y=new FileReader;y.onload=b=>{let A=document.getElementById("image");if(A){A.src=b.target.result;const L=new Image;L.onload=function(){var N=re(function*(k){if(g.overlayManager.updateOverlay(L.width,L.height),g.cvr){let j=yield g.cvr.capture(v,"DetectDocumentBoundaries_Default");j.items.length>0&&(g.points=j.items[0].location.points,g.overlayManager.setPoints(g.points))}});return function(k){return N.apply(this,arguments)}}(),L.src=b.target.result}},y.readAsDataURL(v)}}}rectify(){var u=this;return re(function*(){yield u.normalize(u.currentFile,u.points)})()}save(){return re(function*(){let g=document.getElementById("normalizedImage").src;const p=document.createElement("a");p.href=g,p.download=Date.now()+"",document.body.appendChild(p),p.click(),document.body.removeChild(p)})()}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-file-detection"]],decls:24,vars:2,consts:[["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["type","file","title","file","id","file","accept","image/*",3,"change"],[3,"click"],[1,"container"],["id","imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","resultview",1,"imageview"],["id","normalizedImage","alt",""]],template:function(u,g){1&u&&(He(0,"span",0),Lt(1,"Loading Library..."),Ue(),Mn(2,"br"),He(3,"div",1)(4,"label",2)(5,"input",3),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(6,"Black & White "),Ue(),He(7,"label",4)(8,"input",5),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(9," Grayscale "),Ue(),He(10,"label",6)(11,"input",7),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(12," Color "),Ue()(),He(13,"input",8),Tt("change",function(m){return g.onChange(m)}),Ue(),He(14,"button",9),Tt("click",function(){return g.rectify()}),Lt(15,"Rectify"),Ue(),He(16,"button",9),Tt("click",function(){return g.save()}),Lt(17,"Save"),Ue(),He(18,"div",10)(19,"div",11),Mn(20,"img",12)(21,"canvas",13),Ue(),He(22,"div",14),Mn(23,"img",15),Ue()()),2&u&&(Zt("hidden",g.isLoaded),un(11),Zt("checked",!0))},styles:["#imageview[_ngcontent-%COMP%]{position:relative;width:20vw}#image[_ngcontent-%COMP%]{position:relative;width:100%;height:100%}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}.container[_ngcontent-%COMP%]{align-items:center;border:3px solid rgb(255,255,255)}button[_ngcontent-%COMP%]{margin:4px}"]}),f})();const av="VideoCapture Component Destroyed";let xU=(()=>{class f{constructor(){this.isLoaded=!1,this.cameraInfo={},this.isNormalized=!0,this.captured=[],this.isDestroyed=!1,this.points=[],this.isDetecting=!1,this.overlayManager=new $c}ngOnDestroy(){var u,g;this.isDestroyed=!0;try{null===(u=this.cvr)||void 0===u||u.dispose(),null===(g=this.cameraEnhancer)||void 0===g||g.dispose()}catch(p){}}ngOnInit(){var u=this;this.videoSelect=document.querySelector("select#videoSource"),this.overlayManager.initOverlay(document.getElementById("overlay")),re(function*(){var g,p,m,v;u.cameraView=yield ln.createInstance(),u.cameraEnhancer=yield st.createInstance(u.cameraView),u.isLoaded=!0;let y=document.getElementById("videoContainer");if(y){y.append(u.cameraView.getUIElement()),null===(p=null===(g=u.cameraView.getUIElement().shadowRoot)||void 0===g?void 0:g.querySelector(".dce-sel-camera"))||void 0===p||p.setAttribute("style","display: none"),null===(v=null===(m=u.cameraView.getUIElement().shadowRoot)||void 0===m?void 0:m.querySelector(".dce-sel-resolution"))||void 0===v||v.setAttribute("style","display: none");let b=yield u.cameraEnhancer.getAllCameras();if(u.listCameras(b),u.cvr=yield bt.createInstance(),u.isDestroyed)throw Error(av);u.cvr.setInput(u.cameraEnhancer);let A=yield u.cvr.getSimplifiedSettings("DetectDocumentBoundaries_Default");if(A.capturedResultItemTypes|=Yt.CRIT_ORIGINAL_IMAGE,yield u.cvr.updateSettings("DetectDocumentBoundaries_Default",A),u.cvr.addResultReceiver({onCapturedResultReceived:L=>{u.overlayManager.clearOverlay();try{let j=L.items;if(j.length>0)for(var k=0;k<j.length;++k)if(j[k].type===Yt.CRIT_DETECTED_QUAD)u.detectedResult=j[k],u.points=u.detectedResult.location.points,u.overlayManager.drawOverlay(u.detectedResult.location,"");else if(j[k].type===Yt.CRIT_ORIGINAL_IMAGE&&!u.isNormalized){u.isNormalized=!0;let H=j[k];u.currentData=H.imageData,u.normalize(H.imageData,u.points),u.toggleDetection();break}}catch(j){throw j}}}),u.cameraEnhancer.on("played",()=>{u.updateResolution()}),yield u.openCamera(),u.isDestroyed||u.isDestroyed)throw Error(av)}})()}openCamera(){var u=this;return re(function*(){if(u.overlayManager.clearOverlay(),u.videoSelect){let g=u.videoSelect.value;u.cameraEnhancer&&(yield u.cameraEnhancer.selectCamera(u.cameraInfo[g]),yield u.cameraEnhancer.open())}})()}listCameras(u){for(var g=0;g<u.length;++g){var p=u[g],m=document.createElement("option");m.value=p.deviceId,m.text=p.label,this.cameraInfo[p.deviceId]=p,this.videoSelect&&this.videoSelect.appendChild(m)}}onRadioChange(u){var g=this;if(!this.cvr)return;let p=u.target,m=Lr.ICM_COLOUR;"binary"===p.value?m=Lr.ICM_BINARY:"grayscale"===p.value?m=Lr.ICM_GRAYSCALE:"color"===p.value&&(m=Lr.ICM_COLOUR);let v=this.cvr;re(function*(){let y=yield v.getSimplifiedSettings("NormalizeDocument_Default");y.documentSettings.colourMode=m,yield g.cvr.updateSettings("NormalizeDocument_Default",y),g.normalize(g.currentData,g.points)})()}normalize(u,g){var p=this;return re(function*(){if(p.cvr){let m=yield p.cvr.getSimplifiedSettings("NormalizeDocument_Default");m.roi.points=g,m.roiMeasuredInPercentage=!1,yield p.cvr.updateSettings("NormalizeDocument_Default",m),p.cvr.capture(u,"NormalizeDocument_Default").then(v=>{if(0===v.items.length)return;let y=v.items[0],b=document.getElementById("normalizedImage");b.width=y.imageData.width,b.height=y.imageData.height;const A=b.getContext("2d");null==A||A.drawImage(y.toCanvas(),0,0)})}})()}captureDocument(){this.isNormalized=!1}toggleDetection(){var u,g,p;this.isDetecting?(this.isDetecting=!1,null===(u=this.cvr)||void 0===u||u.stopCapturing(),null===(g=this.cameraView)||void 0===g||g.clearAllInnerDrawingItems(),this.overlayManager.clearOverlay(),document.getElementById("detectButton").textContent="Start Detection"):(this.isDetecting=!0,document.getElementById("detectButton").textContent="Stop Detection",null===(p=this.cvr)||void 0===p||p.startCapturing("DetectDocumentBoundaries_Default"))}updateResolution(){if(this.cameraEnhancer&&this.overlayManager){let u=this.cameraEnhancer.getResolution();this.overlayManager.updateOverlay(u.width,u.height)}}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-camera-detection"]],decls:28,vars:2,consts:[["id","document-scanner"],["id","loading-status",2,"font-size","x-large",3,"hidden"],[1,"row"],["for","binary"],["type","radio","name","templates","value","binary",3,"change"],["for","grayscale"],["type","radio","name","templates","value","grayscale",3,"change"],["for","color"],["type","radio","name","templates","value","color",3,"checked","change"],["for","videoSource"],["id","videoSource",3,"change"],["id","detectButton",3,"click"],["id","captureButton",3,"click"],["id","videoview"],["id","videoContainer",1,"dce-video-container"],["id","overlay"],[1,"container"],["id","resultview"],["id","normalizedImage"]],template:function(u,g){1&u&&(He(0,"div",0)(1,"span",1),Lt(2,"Loading Library..."),Ue(),Mn(3,"br"),He(4,"div",2)(5,"label",3)(6,"input",4),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(7,"Black & White "),Ue(),He(8,"label",5)(9,"input",6),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(10," Grayscale "),Ue(),He(11,"label",7)(12,"input",8),Tt("change",function(m){return g.onRadioChange(m)}),Ue(),Lt(13," Color "),Ue()(),He(14,"div")(15,"label",9),Lt(16,"Video Source: "),He(17,"select",10),Tt("change",function(){return g.openCamera()}),Ue()(),He(18,"button",11),Tt("click",function(){return g.toggleDetection()}),Lt(19,"Start Detection"),Ue(),He(20,"button",12),Tt("click",function(){return g.captureDocument()}),Lt(21,"Capture Document"),Ue()(),He(22,"div",13),Mn(23,"div",14)(24,"canvas",15),Ue(),He(25,"div",16)(26,"div",17),Mn(27,"canvas",18),Ue()()()),2&u&&(un(1),Zt("hidden",g.isLoaded),un(11),Zt("checked",!0))},styles:["#videoview[_ngcontent-%COMP%]{position:absolute;width:40vw;height:40vh}#videoContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;z-index:1}#overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;object-fit:contain}#normalizedImage[_ngcontent-%COMP%]{width:20vw;top:60%;position:absolute;z-index:2}button[_ngcontent-%COMP%]{margin:4px}"]}),f})();function AU(f,l){1&f&&(He(0,"div",8),Mn(1,"div",9),Ue())}const RU=[{path:"",component:DU},{path:"barcode-reader",component:SU},{path:"barcode-scanner",component:IU},{path:"file-detection",component:TU},{path:"camera-detection",component:xU},{path:"mrz-reader",component:(()=>{class f{constructor(){this.isLoaded=!1,this.overlayManager=new $c}ngOnInit(){var u=this;this.overlayManager.initOverlay(document.getElementById("overlay")),re(function*(){yield $a.loadSpec("MRTD_TD1_ID"),yield $a.loadSpec("MRTD_TD2_FRENCH_ID"),yield $a.loadSpec("MRTD_TD2_ID"),yield $a.loadSpec("MRTD_TD2_VISA"),yield $a.loadSpec("MRTD_TD3_PASSPORT"),yield $a.loadSpec("MRTD_TD3_VISA"),yield Vd.loadRecognitionData("MRZ"),u.cvr=yield bt.createInstance(),u.parser=yield rv.createInstance();let g=yield u.cvr.initSettings("/assets/template.json");console.log(g),u.isLoaded=!0})()}ngOnDestroy(){var u;try{null===(u=this.cvr)||void 0===u||u.dispose()}catch(g){}}onChange(u){var g=this;let p=this.parser;const m=u.currentTarget;let v=document.getElementById("detection_result"),y=m.files;if(y){let b=y.item(0);if(b){let A=new FileReader;A.onload=L=>{let N=document.getElementById("image");if(N){N.src=L.target.result;const k=new Image;v.value="",k.onload=j=>{this.overlayManager.updateOverlay(k.width,k.height),this.cvr&&this.cvr.capture(b,"ReadMRZ").then(function(){var H=re(function*(z){let $=[];try{let X=z.items;if(X.length>0)for(var q=0;q<X.length;++q){if(X[q].type!==Yt.CRIT_TEXT_LINE)continue;let Q=X[q],pe=Q.location;console.log(pe),g.overlayManager.drawOverlay(pe,""),$.push(Q.text),v.value=$.join("")+"\n";let _e=yield null==p?void 0:p.parse(Q.text);v.value+=JSON.stringify(g.handleMrzParseResult(_e))+"\n";break}}catch(X){alert(X)}0===$.length&&(v.value="No MRZ detected.")});return function(z){return H.apply(this,arguments)}}())},k.src=L.target.result}},A.readAsDataURL(b)}}}handleMrzParseResult(u){const g={};if(!u.exception){let p=u.getFieldValue("documentCode");g["Document Type"]=JSON.parse(u.jsonString).CodeType;let m=u.getFieldValue("issuingState");g["Issuing State"]=m;let v=u.getFieldValue("primaryIdentifier");g.Surname=v;let y=u.getFieldValue("secondaryIdentifier");g["Given Name"]=y;let b=u.getFieldValue("P"===p?"passportNumber":"documentNumber");g["Passport Number"]=b;let A=u.getFieldValue("nationality");g.Nationality=A;let L=u.getFieldValue("sex");g.Gender=L;let N=u.getFieldValue("birthYear"),k=u.getFieldValue("birthMonth"),j=u.getFieldValue("birthDay");N=parseInt(N)>(new Date).getFullYear()%100?"19"+N:"20"+N,g["Date of Birth (YYYY-MM-DD)"]=N+"-"+k+"-"+j;let H=u.getFieldValue("expiryYear"),z=u.getFieldValue("expiryMonth"),$=u.getFieldValue("expiryDay");H=parseInt(H)>=60?"19"+H:"20"+H,g["Date of Expiry (YYYY-MM-DD)"]=H+"-"+z+"-"+$}return g}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-mrz-reader"]],decls:10,vars:1,consts:[["id","loading-indicator","class","loading-indicator",4,"ngIf"],["type","file","title","file","id","file","accept","image/*",3,"change"],["id","file_container",1,"container"],[1,"row"],["id","imageview",1,"imageview"],["id","image","alt",""],["id","overlay",1,"overlay"],["id","detection_result"],["id","loading-indicator",1,"loading-indicator"],[1,"spinner"]],template:function(u,g){1&u&&(Ji(0,AU,2,0,"div",0),He(1,"div")(2,"input",1),Tt("change",function(m){return g.onChange(m)}),Ue()(),He(3,"div",2)(4,"div",3)(5,"div",4),Mn(6,"img",5)(7,"canvas",6),Ue()()(),He(8,"div"),Mn(9,"textarea",7),Ue()),2&u&&Zt("ngIf",!g.isLoaded)},directives:[Yp],styles:[".imageview[_ngcontent-%COMP%]{max-width:720px;max-height:720px;width:720px;height:720px;background-color:#eaeaea;position:relative}.imageview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%;height:100%;object-fit:contain}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain}textarea[_ngcontent-%COMP%]{width:720px;height:300px;margin:10px auto;padding:20px;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.container[_ngcontent-%COMP%]{margin:0 auto;border:1px solid #ddd;box-shadow:0 0 10px #0000001a}.row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loading-indicator[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid #fff;border-radius:50%;animation:spin 1s linear infinite;background:linear-gradient(to right,#FF0000 0%,#FF8000 17%,#FFFF00 33%,#00FF00 50%,#00FFFF 67%,#0080FF 83%,#0000FF 100%)}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),f})()},{path:"mrz-scanner",component:(()=>{class f{constructor(){}ngOnInit(){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-mrz-scanner"]],decls:2,vars:0,template:function(u,g){1&u&&(He(0,"p"),Lt(1,"mrz-scanner works!"),Ue())},styles:[""]}),f})()}];let MU=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f}),f.\u0275inj=zi({imports:[[oI.forRoot(RU)],oI]}),f})();const OU=function(){return["/"]};let LU=(()=>{class f{constructor(){}ngOnInit(){}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-top-bar"]],decls:3,vars:2,consts:[[3,"routerLink"]],template:function(u,g){1&u&&(He(0,"a",0)(1,"h1"),Lt(2,"Dynamsoft Capture Vision SDK"),Ue()()),2&u&&Zt("routerLink",Ds(1,OU))},directives:[hc],styles:[""]}),f})(),FU=(()=>{class f{constructor(){this.title="angular-barcode-qr-code-scanner"}}return f.\u0275fac=function(u){return new(u||f)},f.\u0275cmp=Si({type:f,selectors:[["app-root"]],decls:3,vars:0,consts:[[1,"container"]],template:function(u,g){1&u&&(Mn(0,"app-top-bar"),He(1,"div",0),Mn(2,"router-outlet"),Ue())},directives:[LU,Um],styles:[""]}),f})(),PU=(()=>{class f{}return f.\u0275fac=function(u){return new(u||f)},f.\u0275mod=fr({type:f,bootstrap:[FU]}),f.\u0275inj=zi({providers:[],imports:[[Xk,MU,hB]]}),f})();(function RP(){rb=!1})(),Yk().bootstrapModule(PU).catch(f=>console.error(f))}},Ut=>{Ut(Ut.s=380)}]);